{
    "author": "gnoff",
    "message": "[dynamicIO] Only report client sync IO errors if they are above a Suspense boundary (#80026)\n\nCurrently if the client has any sync IO during prerenders and no shell\nis produced dynamicIO will assume that the sync IO in the client is the\ncause. This is often incorrect because you might abort the prerender in\na component inside a Suspense boundary but still have some reference to\nRequest data that came from RSC that is not in a Suspense boundary. This\nmisleads the user into thinking the sync IO is the problem when in fact\nit is a misplaced boundary around something else entirely.\n\nThis is a tricky one to solve and it may be that this doesn't fully\ncover all the cases it should. The technique is to abort on sync IO\nbefore stashing the sync IO error. All of the pending render tasks React\nhas stashed away will abort and use normal processing ot decide if they\nviolate the rules. Namely this is where messages like \"A component\naccessed data, headers, params, searchParams, or a short-lived cache\nwithout a Suspense boundary\" come from. Then the sync IO error is\nstashed. If any more (one more to be exact) render tasks abort after\nthis we know that this task was the one that was currently rendering\nwhen the sync IO happened. If this is the case we include the sync IO\nerror in the list of dynamic errors rather than the generic reason and\nonly if it has no Suspense ancestor.\n\nThis fix is probably incomplete. For instance if you perform syncIO\ninside `queueMicrotask` then all of the render tasks will be aborted and\nwe'll have no way to attribute it to any particular component stack and\nthus cannot know if it was inside or outside of a Suspense boundary.\nThis will be solved (if possible) in a follow up change.",
    "sha": "047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
    "files": [
        {
            "sha": "2ab5adda594bade8ce252d262516deb3961e6536",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -132,6 +132,7 @@ import {\n   createDynamicValidationState,\n   trackAllowedDynamicAccess,\n   throwIfDisallowedDynamic,\n+  PreludeState,\n   consumeDynamicAccess,\n   type DynamicAccess,\n } from './dynamic-rendering'\n@@ -2611,7 +2612,8 @@ async function spawnDynamicValidationInDev(\n                     trackAllowedDynamicAccess(\n                       workStore.route,\n                       componentStack,\n-                      dynamicValidation\n+                      dynamicValidation,\n+                      clientDynamicTracking\n                     )\n                   }\n                   return\n@@ -2629,31 +2631,27 @@ async function spawnDynamicValidationInDev(\n       )\n \n     const { preludeIsEmpty } = await processPrelude(unprocessedPrelude)\n-\n     resolveValidation(\n       <LogSafely\n         fn={throwIfDisallowedDynamic.bind(\n           null,\n           workStore,\n-          preludeIsEmpty,\n+          preludeIsEmpty ? PreludeState.Empty : PreludeState.Full,\n           dynamicValidation,\n-          serverDynamicTracking,\n-          clientDynamicTracking\n+          serverDynamicTracking\n         )}\n       />\n     )\n   } catch (thrownValue) {\n     // Even if the root errors we still want to report any dynamic IO errors\n     // that were discovered before the root errored.\n \n-    const preludeIsEmpty = true\n     let loggingFunction = throwIfDisallowedDynamic.bind(\n       null,\n       workStore,\n-      preludeIsEmpty,\n+      PreludeState.Errored,\n       dynamicValidation,\n-      serverDynamicTracking,\n-      clientDynamicTracking\n+      serverDynamicTracking\n     )\n \n     if (process.env.NEXT_DEBUG_BUILD || process.env.__NEXT_VERBOSE_LOGGING) {\n@@ -3222,7 +3220,8 @@ async function prerenderToStream(\n                       trackAllowedDynamicAccess(\n                         workStore.route,\n                         componentStack,\n-                        dynamicValidation\n+                        dynamicValidation,\n+                        clientDynamicTracking\n                       )\n                     }\n                     return\n@@ -3253,10 +3252,9 @@ async function prerenderToStream(\n       if (!allowEmptyStaticShell) {\n         throwIfDisallowedDynamic(\n           workStore,\n-          preludeIsEmpty,\n+          preludeIsEmpty ? PreludeState.Empty : PreludeState.Full,\n           dynamicValidation,\n-          serverDynamicTracking,\n-          clientDynamicTracking\n+          serverDynamicTracking\n         )\n       }\n "
        },
        {
            "sha": "60d7837b043d9534677dfb57e1f7353f0db0eb7f",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 16,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -254,9 +254,6 @@ export function trackDynamicDataInDynamicRender(\n   }\n }\n \n-// Despite it's name we don't actually abort unless we have a controller to call abort on\n-// There are times when we let a prerender run long to discover caches where we want the semantics\n-// of tracking dynamic access without terminating the prerender early\n function abortOnSynchronousDynamicDataAccess(\n   route: string,\n   expression: string,\n@@ -288,13 +285,17 @@ export function abortOnSynchronousPlatformIOAccess(\n   prerenderStore: PrerenderStoreModern\n ): void {\n   const dynamicTracking = prerenderStore.dynamicTracking\n+  abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n+  // It is important that we set this tracking value after aborting. Aborts are executed\n+  // synchronously except for the case where you abort during render itself. By setting this\n+  // value late we can use it to determine if any of the aborted tasks are the task that\n+  // called the sync IO expression in the first place.\n   if (dynamicTracking) {\n     if (dynamicTracking.syncDynamicErrorWithStack === null) {\n       dynamicTracking.syncDynamicExpression = expression\n       dynamicTracking.syncDynamicErrorWithStack = errorWithStack\n     }\n   }\n-  abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n }\n \n export function trackSynchronousPlatformIOAccessInDev(\n@@ -328,14 +329,18 @@ export function abortAndThrowOnSynchronousRequestDataAccess(\n     // since we need the throw semantics regardless of whether we abort it is easier to land\n     // this way. See how this was handled with `abortOnSynchronousPlatformIOAccess` for a closer\n     // to ideal implementation\n+    abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n+    // It is important that we set this tracking value after aborting. Aborts are executed\n+    // synchronously except for the case where you abort during render itself. By setting this\n+    // value late we can use it to determine if any of the aborted tasks are the task that\n+    // called the sync IO expression in the first place.\n     const dynamicTracking = prerenderStore.dynamicTracking\n     if (dynamicTracking) {\n       if (dynamicTracking.syncDynamicErrorWithStack === null) {\n         dynamicTracking.syncDynamicExpression = expression\n         dynamicTracking.syncDynamicErrorWithStack = errorWithStack\n       }\n     }\n-    abortOnSynchronousDynamicDataAccess(route, expression, prerenderStore)\n   }\n   throw createPrerenderInterruptedError(\n     `Route ${route} needs to bail out of prerendering at this point because it used ${expression}.`\n@@ -613,7 +618,8 @@ const hasOutletRegex = new RegExp(`\\\\n\\\\s+at ${OUTLET_BOUNDARY_NAME}[\\\\n\\\\s]`)\n export function trackAllowedDynamicAccess(\n   route: string,\n   componentStack: string,\n-  dynamicValidation: DynamicValidationState\n+  dynamicValidation: DynamicValidationState,\n+  clientDynamic: DynamicTrackingState\n ) {\n   if (hasOutletRegex.test(componentStack)) {\n     // We don't need to track that this is dynamic. It is only so when something else is also dynamic.\n@@ -635,6 +641,12 @@ export function trackAllowedDynamicAccess(\n     // of disallowed\n     dynamicValidation.hasAllowedDynamic = true\n     return\n+  } else if (clientDynamic.syncDynamicErrorWithStack) {\n+    // This task was the task that called the sync error.\n+    dynamicValidation.dynamicErrors.push(\n+      clientDynamic.syncDynamicErrorWithStack\n+    )\n+    return\n   } else {\n     const message = `Route \"${route}\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. We don't have the exact line number added to error messages yet but you can see which component in the stack below. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense`\n     const error = createErrorWithComponentStack(message, componentStack)\n@@ -652,19 +664,24 @@ function createErrorWithComponentStack(\n   return error\n }\n \n+export enum PreludeState {\n+  Full = 0,\n+  Empty = 1,\n+  Errored = 2,\n+}\n+\n export function throwIfDisallowedDynamic(\n   workStore: WorkStore,\n-  hasEmptyShell: boolean,\n+  prelude: PreludeState,\n   dynamicValidation: DynamicValidationState,\n-  serverDynamic: DynamicTrackingState,\n-  clientDynamic: DynamicTrackingState\n+  serverDynamic: DynamicTrackingState\n ): void {\n   if (workStore.invalidDynamicUsageError) {\n     console.error(workStore.invalidDynamicUsageError)\n     throw new StaticGenBailoutError()\n   }\n \n-  if (hasEmptyShell) {\n+  if (prelude !== PreludeState.Full) {\n     if (dynamicValidation.hasSuspenseAboveBody) {\n       // This route has opted into allowing fully dynamic rendering\n       // by including a Suspense boundary above the body. In this case\n@@ -681,12 +698,6 @@ export function throwIfDisallowedDynamic(\n       throw new StaticGenBailoutError()\n     }\n \n-    if (clientDynamic.syncDynamicErrorWithStack) {\n-      // Just like above but within the client render...\n-      console.error(clientDynamic.syncDynamicErrorWithStack)\n-      throw new StaticGenBailoutError()\n-    }\n-\n     // We didn't have any sync bailouts but there may be user code which\n     // blocked the root. We would have captured these during the prerender\n     // and can log them here and then terminate the build/validating render\n@@ -709,6 +720,16 @@ export function throwIfDisallowedDynamic(\n       )\n       throw new StaticGenBailoutError()\n     }\n+\n+    if (prelude === PreludeState.Empty) {\n+      // If we ever get this far then we messed up the tracking of invalid dynamic.\n+      // We still adhere to the constraint that you must produce a shell but invite the\n+      // user to report this as a bug in Next.js.\n+      console.error(\n+        `Route \"${workStore.route}\" did not produce a static shell and Next.js was unable to determine a reason. This is a bug in Next.js.`\n+      )\n+      throw new StaticGenBailoutError()\n+    }\n   } else {\n     if (\n       dynamicValidation.hasAllowedDynamic === false &&"
        },
        {
            "sha": "318251c2e5dab35dabecd8fc7c8bf8dacf718ea4",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.platform-dynamic.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 35,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -1,40 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n \n-const stackStart = /\\s+at /\n-\n-function createExpectError(cliOutput: string) {\n-  let cliIndex = 0\n-  return function expectError(\n-    containing: string,\n-    withStackContaining?: string\n-  ) {\n-    const initialCliIndex = cliIndex\n-    let lines = cliOutput.slice(cliIndex).split('\\n')\n-\n-    let i = 0\n-    while (i < lines.length) {\n-      let line = lines[i++] + '\\n'\n-      cliIndex += line.length\n-      if (line.includes(containing)) {\n-        if (typeof withStackContaining !== 'string') {\n-          return\n-        } else {\n-          while (i < lines.length) {\n-            let stackLine = lines[i++] + '\\n'\n-            if (!stackStart.test(stackLine)) {\n-              expect(stackLine).toContain(withStackContaining)\n-            }\n-            if (stackLine.includes(withStackContaining)) {\n-              return\n-            }\n-          }\n-        }\n-      }\n-    }\n-\n-    expect(cliOutput.slice(initialCliIndex)).toContain(containing)\n-  }\n-}\n+import { createExpectError } from './utils'\n \n function runTests(options: { withMinification: boolean }) {\n   const { withMinification } = options"
        },
        {
            "sha": "7e3f2dccbbadcbe68c104dc3df2868b041fc9539",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.sync-attribution.test.ts",
            "status": "added",
            "additions": 179,
            "deletions": 0,
            "changes": 179,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,179 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+import { createExpectError } from './utils'\n+\n+function runTests(options: { withMinification: boolean }) {\n+  const { withMinification } = options\n+  describe(`Dynamic IO Errors - ${withMinification ? 'With Minification' : 'Without Minification'}`, () => {\n+    describe('Error Attribution with Sync IO - Guarded RSC with guarded Client sync IO', () => {\n+      const { next, isNextDev, skipped } = nextTestSetup({\n+        files:\n+          __dirname +\n+          '/fixtures/sync-attribution/guarded-async-guarded-clientsync',\n+        skipStart: true,\n+        skipDeployment: true,\n+      })\n+\n+      if (skipped) {\n+        return\n+      }\n+\n+      if (isNextDev) {\n+        it('does not run in dev', () => {})\n+        return\n+      }\n+\n+      beforeEach(async () => {\n+        if (!withMinification) {\n+          await next.patchFile('next.config.js', (content) =>\n+            content.replace(\n+              'serverMinification: true,',\n+              'serverMinification: false,'\n+            )\n+          )\n+        }\n+      })\n+\n+      it('should not error the build sync IO is used inside a Suspense Boundary in a client Component and nothing else is dynamic', async () => {\n+        try {\n+          await next.start()\n+        } catch {\n+          throw new Error('expected build not to fail')\n+        }\n+        expect(next.cliOutput).toContain('â— / ')\n+      })\n+    })\n+    describe('Error Attribution with Sync IO - Guarded RSC with unguarded Client sync IO', () => {\n+      const { next, isNextDev, skipped } = nextTestSetup({\n+        files:\n+          __dirname +\n+          '/fixtures/sync-attribution/guarded-async-unguarded-clientsync',\n+        skipStart: true,\n+        skipDeployment: true,\n+      })\n+\n+      if (skipped) {\n+        return\n+      }\n+\n+      if (isNextDev) {\n+        it('does not run in dev', () => {})\n+        return\n+      }\n+\n+      beforeEach(async () => {\n+        if (!withMinification) {\n+          await next.patchFile('next.config.js', (content) =>\n+            content.replace(\n+              'serverMinification: true,',\n+              'serverMinification: false,'\n+            )\n+          )\n+        }\n+      })\n+\n+      it('should error the build with a reason related to sync IO access', async () => {\n+        try {\n+          await next.start()\n+        } catch {\n+          // we expect the build to fail\n+        }\n+        const expectError = createExpectError(next.cliOutput)\n+\n+        expectError(\n+          'Error: Route \"/\" used `new Date()` instead of using `performance` or without explicitly calling `await connection()` beforehand.'\n+        )\n+        expectError('Error occurred prerendering page \"/\"')\n+      })\n+    })\n+    describe('Error Attribution with Sync IO - Unguarded RSC with guarded Client sync IO', () => {\n+      const { next, isNextDev, skipped } = nextTestSetup({\n+        files:\n+          __dirname +\n+          '/fixtures/sync-attribution/unguarded-async-guarded-clientsync',\n+        skipStart: true,\n+        skipDeployment: true,\n+      })\n+\n+      if (skipped) {\n+        return\n+      }\n+\n+      if (isNextDev) {\n+        it('does not run in dev', () => {})\n+        return\n+      }\n+\n+      beforeEach(async () => {\n+        if (!withMinification) {\n+          await next.patchFile('next.config.js', (content) =>\n+            content.replace(\n+              'serverMinification: true,',\n+              'serverMinification: false,'\n+            )\n+          )\n+        }\n+      })\n+\n+      it('should error the build with a reason related dynamic data', async () => {\n+        try {\n+          await next.start()\n+        } catch {\n+          // we expect the build to fail\n+        }\n+        const expectError = createExpectError(next.cliOutput)\n+\n+        expectError(\n+          'Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it.'\n+        )\n+        expectError('Error occurred prerendering page \"/\"')\n+      })\n+    })\n+    describe('Error Attribution with Sync IO - unguarded RSC with unguarded Client sync IO', () => {\n+      const { next, isNextDev, skipped } = nextTestSetup({\n+        files:\n+          __dirname +\n+          '/fixtures/sync-attribution/unguarded-async-unguarded-clientsync',\n+        skipStart: true,\n+        skipDeployment: true,\n+      })\n+\n+      if (skipped) {\n+        return\n+      }\n+\n+      if (isNextDev) {\n+        it('does not run in dev', () => {})\n+        return\n+      }\n+\n+      beforeEach(async () => {\n+        if (!withMinification) {\n+          await next.patchFile('next.config.js', (content) =>\n+            content.replace(\n+              'serverMinification: true,',\n+              'serverMinification: false,'\n+            )\n+          )\n+        }\n+      })\n+\n+      it('should error the build with a reason related to sync IO access', async () => {\n+        try {\n+          await next.start()\n+        } catch {\n+          // we expect the build to fail\n+        }\n+        const expectError = createExpectError(next.cliOutput)\n+\n+        expectError(\n+          'Error: Route \"/\" used `new Date()` instead of using `performance` or without explicitly calling `await connection()` beforehand.'\n+        )\n+        expectError('Error occurred prerendering page \"/\"')\n+      })\n+    })\n+  })\n+}\n+\n+runTests({ withMinification: true })\n+runTests({ withMinification: false })"
        },
        {
            "sha": "8042de2ab93b8147a156395aaa9ef81af35931c2",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.sync-dynamic.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 36,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -1,40 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n \n-const stackStart = /\\s+at /\n-\n-function createExpectError(cliOutput: string) {\n-  let cliIndex = 0\n-  return function expectError(\n-    containing: string,\n-    withStackContaining?: string\n-  ) {\n-    const initialCliIndex = cliIndex\n-    let lines = cliOutput.slice(cliIndex).split('\\n')\n-\n-    let i = 0\n-    while (i < lines.length) {\n-      let line = lines[i++] + '\\n'\n-      cliIndex += line.length\n-      if (line.includes(containing)) {\n-        if (typeof withStackContaining !== 'string') {\n-          return\n-        } else {\n-          while (i < lines.length) {\n-            let stackLine = lines[i++] + '\\n'\n-            if (!stackStart.test(stackLine)) {\n-              expect(stackLine).toContain(withStackContaining)\n-            }\n-            if (stackLine.includes(withStackContaining)) {\n-              return\n-            }\n-          }\n-        }\n-      }\n-    }\n-\n-    expect(cliOutput.slice(initialCliIndex)).toContain(containing)\n-  }\n-}\n+import { createExpectError } from './utils'\n \n function runTests(options: { withMinification: boolean }) {\n   const { withMinification } = options\n@@ -114,7 +80,11 @@ function runTests(options: { withMinification: boolean }) {\n         }\n         const expectError = createExpectError(next.cliOutput)\n \n-        expectError('Route \"/\" used `searchParams.foo`')\n+        // TODO we need to figure out a way to improve this error message. This is the rare case where the sync IO is escaping out of it's parent Suspense because something is rendering too slowly in the root. At the moment we don't have a way of discriminating between this and something like Request data access in the server.\n+        // expectError('Route \"/\" used `searchParams.foo`')\n+        expectError(\n+          'Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it.'\n+        )\n         expectError('Error occurred prerendering page \"/\"')\n         expectError('exiting the build.')\n       })"
        },
        {
            "sha": "1972361a8e07eafb53275da350e148d76df6ea87",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 35,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -1,40 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n \n-const stackStart = /\\s+at /\n-\n-function createExpectError(cliOutput: string) {\n-  let cliIndex = 0\n-  return function expectError(\n-    containing: string,\n-    withStackContaining?: string\n-  ): Array<string> {\n-    const initialCliIndex = cliIndex\n-    let lines = cliOutput.slice(cliIndex).split('\\n')\n-\n-    let i = 0\n-    while (i < lines.length) {\n-      let line = lines[i++] + '\\n'\n-      cliIndex += line.length\n-      if (line.includes(containing)) {\n-        if (typeof withStackContaining !== 'string') {\n-          return\n-        } else {\n-          while (i < lines.length) {\n-            let stackLine = lines[i++] + '\\n'\n-            if (!stackStart.test(stackLine)) {\n-              expect(stackLine).toContain(withStackContaining)\n-            }\n-            if (stackLine.includes(withStackContaining)) {\n-              return\n-            }\n-          }\n-        }\n-      }\n-    }\n-\n-    expect(cliOutput.slice(initialCliIndex)).toContain(containing)\n-  }\n-}\n+import { createExpectError } from './utils'\n \n function runTests(options: { withMinification: boolean }) {\n   const isTurbopack = !!process.env.IS_TURBOPACK_TEST"
        },
        {
            "sha": "21d2c8340ece27d75d6dac1f96e41f430c11dbef",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-guarded-clientsync/app/client.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,13 @@\n+'use client'\n+\n+export function SyncIO() {\n+  // This is a sync IO access that should not cause an error\n+  const data = new Date().toISOString()\n+\n+  return (\n+    <main>\n+      <h1>Sync IO Access</h1>\n+      <p suppressHydrationWarning>Current date and time: {data}</p>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "745e32b8a8d235ef098d1a265f57c0254df40b5d",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-guarded-clientsync/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,9 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <main>{children}</main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "e6ca46d36ef56e40a030a1c2e0086226757b0b6b",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-guarded-clientsync/app/page.tsx",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,42 @@\n+import { cookies } from 'next/headers'\n+import { Suspense } from 'react'\n+\n+import { SyncIO } from './client'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <section>\n+        <p>\n+          In this test we have two components. One reads `new Date()`\n+          synchronously in a client component render. The other awaits cookies\n+          in a Server Component.\n+        </p>\n+        <p>\n+          In this version both components are wrapped in Suspense. We expect\n+          that this page will prerender with fallbacks around both components\n+        </p>\n+      </section>\n+      <section>\n+        <Suspense fallback=\"\">\n+          <SyncIO />\n+        </Suspense>\n+      </section>\n+      <section>\n+        <Suspense fallback=\"\">\n+          <RequestData />\n+        </Suspense>\n+      </section>\n+    </main>\n+  )\n+}\n+\n+async function RequestData() {\n+  ;(await cookies()).get('foo')\n+  return (\n+    <div>\n+      <h2>Request Data Access</h2>\n+      <p>This component accesses request data without a Suspense boundary.</p>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "74b8245cfe26f9fefabad984c9034abb972564c5",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-guarded-clientsync/next.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-guarded-clientsync%2Fnext.config.js?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    dynamicIO: true,\n+    serverMinification: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "21d2c8340ece27d75d6dac1f96e41f430c11dbef",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-unguarded-clientsync/app/client.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,13 @@\n+'use client'\n+\n+export function SyncIO() {\n+  // This is a sync IO access that should not cause an error\n+  const data = new Date().toISOString()\n+\n+  return (\n+    <main>\n+      <h1>Sync IO Access</h1>\n+      <p suppressHydrationWarning>Current date and time: {data}</p>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "745e32b8a8d235ef098d1a265f57c0254df40b5d",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-unguarded-clientsync/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,9 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <main>{children}</main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "4a6f5104f02ce4c756da1098520092deed904030",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-unguarded-clientsync/app/page.tsx",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,41 @@\n+import { cookies } from 'next/headers'\n+import { Suspense } from 'react'\n+\n+import { SyncIO } from './client'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <section>\n+        <p>\n+          In this test we have two components. One reads `new Date()`\n+          synchronously in a client component render. The other awaits cookies\n+          in a Server Component.\n+        </p>\n+        <p>\n+          In this version the client component is not wrapped in a Suspense\n+          boundary. We expect this to be a build failure with the reason\n+          pointing to the line where `new Date()` was called.\n+        </p>\n+      </section>\n+      <section>\n+        <SyncIO />\n+      </section>\n+      <section>\n+        <Suspense fallback=\"\">\n+          <RequestData />\n+        </Suspense>\n+      </section>\n+    </main>\n+  )\n+}\n+\n+async function RequestData() {\n+  ;(await cookies()).get('foo')\n+  return (\n+    <div>\n+      <h2>Request Data Access</h2>\n+      <p>This component accesses request data without a Suspense boundary.</p>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "74b8245cfe26f9fefabad984c9034abb972564c5",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/guarded-async-unguarded-clientsync/next.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Fguarded-async-unguarded-clientsync%2Fnext.config.js?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    dynamicIO: true,\n+    serverMinification: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "21d2c8340ece27d75d6dac1f96e41f430c11dbef",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-guarded-clientsync/app/client.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fclient.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,13 @@\n+'use client'\n+\n+export function SyncIO() {\n+  // This is a sync IO access that should not cause an error\n+  const data = new Date().toISOString()\n+\n+  return (\n+    <main>\n+      <h1>Sync IO Access</h1>\n+      <p suppressHydrationWarning>Current date and time: {data}</p>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "745e32b8a8d235ef098d1a265f57c0254df40b5d",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-guarded-clientsync/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Flayout.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,9 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <main>{children}</main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "9743b298a3d5a69574820379e1c171e0893243ad",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-guarded-clientsync/app/page.tsx",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,41 @@\n+import { cookies } from 'next/headers'\n+\n+import { SyncIO } from './client'\n+import { Suspense } from 'react'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <section>\n+        <p>\n+          In this test we have two components. One reads `new Date()`\n+          synchronously in a client component render. The other awaits cookies\n+          in a Server Component.\n+        </p>\n+        <p>\n+          In this version the server component is not wrapped in a Suspense\n+          boundary. We expect the build to error with the reason referencing\n+          some dynamic data access. It should not mention `new Date()`.\n+        </p>\n+      </section>\n+      <section>\n+        <Suspense fallback={<p>Loading...</p>}>\n+          <SyncIO />\n+        </Suspense>\n+      </section>\n+      <section>\n+        <RequestData />\n+      </section>\n+    </main>\n+  )\n+}\n+\n+async function RequestData() {\n+  ;(await cookies()).get('foo')\n+  return (\n+    <div>\n+      <h2>Request Data Access</h2>\n+      <p>This component accesses request data without a Suspense boundary.</p>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "74b8245cfe26f9fefabad984c9034abb972564c5",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-guarded-clientsync/next.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-guarded-clientsync%2Fnext.config.js?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    dynamicIO: true,\n+    serverMinification: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "21d2c8340ece27d75d6dac1f96e41f430c11dbef",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-unguarded-clientsync/app/client.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fclient.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,13 @@\n+'use client'\n+\n+export function SyncIO() {\n+  // This is a sync IO access that should not cause an error\n+  const data = new Date().toISOString()\n+\n+  return (\n+    <main>\n+      <h1>Sync IO Access</h1>\n+      <p suppressHydrationWarning>Current date and time: {data}</p>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "745e32b8a8d235ef098d1a265f57c0254df40b5d",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-unguarded-clientsync/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Flayout.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,9 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <main>{children}</main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "3372736219bc8d0155361d02623629f6ceb13434",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-unguarded-clientsync/app/page.tsx",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,39 @@\n+import { cookies } from 'next/headers'\n+\n+import { SyncIO } from './client'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <section>\n+        <p>\n+          In this test we have two components. One reads `new Date()`\n+          synchronously in a client component render. The other awaits cookies\n+          in a Server Component.\n+        </p>\n+        <p>\n+          In this version neither component is wrapped in a Suspense boundary.\n+          There are no defined semantics about which reason is more \"valid\" than\n+          another but with the current implementation we report the `new Date()`\n+          reason when failing the build.\n+        </p>\n+      </section>\n+      <section>\n+        <SyncIO />\n+      </section>\n+      <section>\n+        <RequestData />\n+      </section>\n+    </main>\n+  )\n+}\n+\n+async function RequestData() {\n+  ;(await cookies()).get('foo')\n+  return (\n+    <div>\n+      <h2>Request Data Access</h2>\n+      <p>This component accesses request data without a Suspense boundary.</p>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "74b8245cfe26f9fefabad984c9034abb972564c5",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-attribution/unguarded-async-unguarded-clientsync/next.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-attribution%2Funguarded-async-unguarded-clientsync%2Fnext.config.js?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    dynamicIO: true,\n+    serverMinification: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "a6c9e39f581f7f6a0cd3c3764ecbbbbd8db53f90",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-client-search-with-fallback/app/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-with-fallback%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-with-fallback%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-with-fallback%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -71,8 +71,8 @@ function LongRunningComponent() {\n function ShortRunningComponent() {\n   return (\n     <div>\n-      This component runs quickly (in a microtask). It should be finished before\n-      the sync searchParams access happens.\n+      This component renders synchronously. It should be finished before sync IO\n+      is accessed in the other component.\n     </div>\n   )\n }"
        },
        {
            "sha": "7ca10b38c54bb39ddec316ed93af99aab1e87096",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/sync-client-search-without-fallback/app/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-without-fallback%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-without-fallback%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fsync-client-search-without-fallback%2Fapp%2Fpage.tsx?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -69,8 +69,8 @@ function LongRunningComponent() {\n function ShortRunningComponent() {\n   return (\n     <div>\n-      This component runs quickly (in a microtask). It should be finished before\n-      the sync searchParams access happens.\n+      This component renders synchronously. It should be finished before sync IO\n+      is accessed in the other component.\n     </div>\n   )\n }"
        },
        {
            "sha": "bc0a6513f5a253bf466b0739f98030109d1dd843",
            "filename": "test/e2e/app-dir/dynamic-io-errors/utils.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/047cb99a7462b0ea2e8733fb88acda3dfbbb8962/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Futils.ts?ref=047cb99a7462b0ea2e8733fb88acda3dfbbb8962",
            "patch": "@@ -0,0 +1,35 @@\n+const stackStart = /\\s+at /\n+\n+export function createExpectError(cliOutput: string) {\n+  let cliIndex = 0\n+  return function expectError(\n+    containing: string,\n+    withStackContaining?: string\n+  ): void {\n+    const initialCliIndex = cliIndex\n+    let lines = cliOutput.slice(cliIndex).split('\\n')\n+\n+    let i = 0\n+    while (i < lines.length) {\n+      let line = lines[i++] + '\\n'\n+      cliIndex += line.length\n+      if (line.includes(containing)) {\n+        if (typeof withStackContaining !== 'string') {\n+          return\n+        } else {\n+          while (i < lines.length) {\n+            let stackLine = lines[i++] + '\\n'\n+            if (!stackStart.test(stackLine)) {\n+              expect(stackLine).toContain(withStackContaining)\n+            }\n+            if (stackLine.includes(withStackContaining)) {\n+              return\n+            }\n+          }\n+        }\n+      }\n+    }\n+\n+    expect(cliOutput.slice(initialCliIndex)).toContain(containing)\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 708,
        "additions": 569,
        "deletions": 139
    }
}