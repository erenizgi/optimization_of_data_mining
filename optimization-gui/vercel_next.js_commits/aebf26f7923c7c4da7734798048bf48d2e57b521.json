{
    "author": "jantimon",
    "message": "Turbopack: support for CSS Modules in Data URLs (#78040)\n\nCo-authored-by: Tobias Koppers <tobias.koppers@googlemail.com>",
    "sha": "aebf26f7923c7c4da7734798048bf48d2e57b521",
    "files": [
        {
            "sha": "bdae3d658787240cd078a83eec561def3471b7b7",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/data-url/basic/input/dark.svg",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fdark.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fdark.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fdark.svg?ref=aebf26f7923c7c4da7734798048bf48d2e57b521",
            "patch": "@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<svg width=\"114px\" height=\"100px\" viewBox=\"0 0 114 100\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n+    <!-- Generator: Sketch 51.2 (57519) - http://www.bohemiancoding.com/sketch -->\n+    <title>Logotype - Black</title>\n+    <desc>Created with Sketch.</desc>\n+    <defs>\n+        <linearGradient x1=\"100.929941%\" y1=\"181.283245%\" x2=\"41.7687834%\" y2=\"100%\" id=\"linearGradient-1\">\n+            <stop stop-color=\"#FFFFFF\" offset=\"0%\"></stop>\n+            <stop stop-color=\"#000000\" offset=\"100%\"></stop>\n+        </linearGradient>\n+    </defs>\n+    <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n+        <g id=\"Black-Triangle\" transform=\"translate(-293.000000, -150.000000)\" fill=\"url(#linearGradient-1)\">\n+            <polygon id=\"Logotype---Black\" points=\"350 150 407 250 293 250\"></polygon>\n+        </g>\n+    </g>\n+</svg>"
        },
        {
            "sha": "4d23a4441253213674395d0daf45a81d2b7ff2ca",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/data-url/basic/input/index.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Findex.js?ref=aebf26f7923c7c4da7734798048bf48d2e57b521",
            "patch": "@@ -3,10 +3,15 @@ import data from 'data:application/json,{ \"foo\": 1234 }';\n import dataURLEncoded from 'data:application/json,%7B%20%22foo%22%3A%201234%20%7D';\n import dataBase64Encoded from 'data:application/json;base64,eyAiZm9vIjogMTIzNCB9';\n import \"data:text/css,body { color: red }\";\n+import \"data:text/css,body { background: url('./dark.svg') }\";\n+import * as style from \"data:text/css+module,.bar { background: url('./dark.svg') }\";\n+import * as style64 from \"data:text/css+module;base64,LmJhciB7IGJhY2tncm91bmQ6IHVybCgnLi9kYXJrLnN2ZycpIH0=\";\n \n it(\"support data URL imports\", () => {\n   expect(bar).toEqual(1234);\n   expect(data).toEqual({ foo: 1234 });\n   expect(dataURLEncoded).toEqual({ foo: 1234 });\n   expect(dataBase64Encoded).toEqual({ foo: 1234 });\n+  expect(style.bar).toMatch(/bar/);\n+  expect(style64.bar).toMatch(/bar/);\n });"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/data-url/basic/input/other.js",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/debc792466982a063f036de08dba39e1b98ee47d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fother.js",
            "raw_url": "https://github.com/vercel/next.js/raw/debc792466982a063f036de08dba39e1b98ee47d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fother.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdata-url%2Fbasic%2Finput%2Fother.js?ref=debc792466982a063f036de08dba39e1b98ee47d"
        },
        {
            "sha": "f21d6e1e05dd91a9abded73ce43477ea03ceed84",
            "filename": "turbopack/crates/turbopack/src/module_options/mod.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 4,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/aebf26f7923c7c4da7734798048bf48d2e57b521/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs?ref=aebf26f7923c7c4da7734798048bf48d2e57b521",
            "patch": "@@ -450,7 +450,10 @@ impl ModuleOptions {\n                     })],\n                 ),\n                 ModuleRule::new(\n-                    RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                    RuleCondition::any(vec![\n+                        RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                        RuleCondition::ContentTypeStartsWith(\"text/css+module\".to_string()),\n+                    ]),\n                     vec![ModuleRuleEffect::ModuleType(ModuleType::Css {\n                         ty: CssModuleAssetType::Module,\n                     })],\n@@ -509,7 +512,10 @@ impl ModuleOptions {\n                 ),\n                 ModuleRule::new(\n                     RuleCondition::all(vec![\n-                        RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                        RuleCondition::Any(vec![\n+                            RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                            RuleCondition::ContentTypeStartsWith(\"text/css+module\".to_string()),\n+                        ]),\n                         // Only create a module CSS asset if not `@import`ed from CSS already.\n                         // NOTE: `composes` references should not be treated as `@import`s and\n                         // should also create a module CSS asset.\n@@ -533,7 +539,10 @@ impl ModuleOptions {\n                 ),\n                 // Ecmascript CSS Modules referencing the actual CSS module to include it\n                 ModuleRule::new_internal(\n-                    RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                    RuleCondition::Any(vec![\n+                        RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                        RuleCondition::ContentTypeStartsWith(\"text/css+module\".to_string()),\n+                    ]),\n                     vec![ModuleRuleEffect::ModuleType(ModuleType::Css {\n                         ty: CssModuleAssetType::Module,\n                     })],\n@@ -544,7 +553,10 @@ impl ModuleOptions {\n                         RuleCondition::ReferenceType(ReferenceType::Css(\n                             CssReferenceSubType::Analyze,\n                         )),\n-                        RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                        RuleCondition::Any(vec![\n+                            RuleCondition::ResourcePathEndsWith(\".module.css\".to_string()),\n+                            RuleCondition::ContentTypeStartsWith(\"text/css+module\".to_string()),\n+                        ]),\n                     ]),\n                     vec![ModuleRuleEffect::ModuleType(ModuleType::Css {\n                         ty: CssModuleAssetType::Module,"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 38,
        "deletions": 4
    }
}