{
    "author": "eps1lon",
    "message": "[build-sourcemaps] Default `experimental.enablePrerenderSourceMaps` to `experimental.dynamicIO` (#81449)",
    "sha": "11cbba8bd5967ce605ce351956fca4d50b0ead99",
    "files": [
        {
            "sha": "ff665cc30cba337821eec6c0715f876d14a85806",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -1383,7 +1383,8 @@ export const defaultConfig = {\n     appNavFailHandling: false,\n     prerenderEarlyExit: true,\n     serverMinification: true,\n-    enablePrerenderSourceMaps: false,\n+    // Will default to dynamicIO value.\n+    enablePrerenderSourceMaps: undefined,\n     serverSourceMaps: false,\n     linkNoTouchStart: false,\n     caseSensitiveRoutes: false,"
        },
        {
            "sha": "e9020560f73f71d400f79632bd5388cdd546b1f6",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -1414,6 +1414,20 @@ export default async function loadConfig(\n       userConfig.htmlLimitedBots = userConfig.htmlLimitedBots.source\n     }\n \n+    if (\n+      userConfig.experimental &&\n+      userConfig.experimental.enablePrerenderSourceMaps === undefined &&\n+      userConfig.experimental.dynamicIO === true\n+    ) {\n+      userConfig.experimental.enablePrerenderSourceMaps = true\n+      addConfiguredExperimentalFeature(\n+        configuredExperimentalFeatures,\n+        'enablePrerenderSourceMaps',\n+        true,\n+        'enabled by `experimental.dynamicIO`'\n+      )\n+    }\n+\n     if (\n       debugPrerender &&\n       (phase === PHASE_PRODUCTION_BUILD || phase === PHASE_EXPORT)"
        },
        {
            "sha": "d481abf26e2c413196dd7e6948123c48450056be",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.platform-dynamic.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.platform-dynamic.test.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -120,7 +120,14 @@ describe.each(\n           } else {\n             expect(output).toMatchInlineSnapshot(`\n              \"Error: Route \"/\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\n-                 at a (<next-dist-dir>)\n+                 at f (turbopack:///[project]/app/page.tsx:32:14)\n+               30 |\n+               31 | function getRandomNumber() {\n+             > 32 |   return Math.random()\n+                  |              ^\n+               33 | }\n+               34 |\n+               35 | function RandomReadingComponent() {\n              To get a more detailed stack trace and pinpoint the issue, try one of the following:\n                - Start the app in development mode by running \\`next dev\\`, then open \"/\" in your browser to investigate the error.\n                - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces."
        },
        {
            "sha": "21395adb2cebd164e235e980e37a92a09363a37f",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.sync-attribution.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-attribution.test.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -137,7 +137,14 @@ describe.each(\n           } else {\n             expect(output).toMatchInlineSnapshot(`\n              \"Error: Route \"/\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-                 at a (<next-dist-dir>)\n+                 at c (turbopack:///[project]/app/client.tsx:9:6)\n+                7 |   return (\n+                8 |     <main>\n+             >  9 |       <h1>Sync IO Access</h1>\n+                  |      ^\n+               10 |       <p suppressHydrationWarning>Current date and time: {data}</p>\n+               11 |     </main>\n+               12 |   )\n              To get a more detailed stack trace and pinpoint the issue, try one of the following:\n                - Start the app in development mode by running \\`next dev\\`, then open \"/\" in your browser to investigate the error.\n                - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.\n@@ -264,17 +271,7 @@ describe.each(\n              \"Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n                  at a (<anonymous>)\n                  at main (<anonymous>)\n-                 at b (<next-dist-dir>)\n-                 at c (<next-dist-dir>)\n-                 at d (<next-dist-dir>)\n-                 at e (<next-dist-dir>)\n-                 at f (<next-dist-dir>)\n-                 at g (<next-dist-dir>)\n-                 at h (<next-dist-dir>)\n-                 at i (<next-dist-dir>)\n-                 at j (<next-dist-dir>)\n-                 at k (<anonymous>)\n-                 at l (<next-dist-dir>)\n+                 at b (<anonymous>)\n                  at main (<anonymous>)\n                  at body (<anonymous>)\n                  at html (<anonymous>)\n@@ -434,7 +431,14 @@ describe.each(\n           } else {\n             expect(output).toMatchInlineSnapshot(`\n              \"Error: Route \"/\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-                 at a (<next-dist-dir>)\n+                 at c (turbopack:///[project]/app/client.tsx:9:6)\n+                7 |   return (\n+                8 |     <main>\n+             >  9 |       <h1>Sync IO Access</h1>\n+                  |      ^\n+               10 |       <p suppressHydrationWarning>Current date and time: {data}</p>\n+               11 |     </main>\n+               12 |   )\n              To get a more detailed stack trace and pinpoint the issue, try one of the following:\n                - Start the app in development mode by running \\`next dev\\`, then open \"/\" in your browser to investigate the error.\n                - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces."
        },
        {
            "sha": "332f499b96366d619786fceb0abfb5e46e170de9",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.sync-dynamic.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.sync-dynamic.test.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -234,8 +234,15 @@ describe.each(\n             expect(output).toMatchInlineSnapshot(`\n              \"Error occurred prerendering page \"/\". Read more: https://nextjs.org/docs/messages/prerender-error\n              TypeError: <module-function>().get is not a function\n-                 at a (<next-dist-dir>)\n-                 at b (<anonymous>) {\n+                 at e (turbopack:///[project]/app/page.tsx:17:66)\n+                 at a (<anonymous>)\n+               15 |\n+               16 | async function CookiesReadingComponent() {\n+             > 17 |   const _token = (cookies() as unknown as UnsafeUnwrappedCookies).get('token')\n+                  |                                                                  ^\n+               18 |   return <div>this component reads the \\`token\\` cookie synchronously</div>\n+               19 | }\n+               20 | {\n                digest: '<error-digest>'\n              }\n              Export encountered an error on /page: /, exiting the build.\"\n@@ -456,8 +463,15 @@ describe.each(\n             expect(output).toMatchInlineSnapshot(`\n              \"Error occurred prerendering page \"/\". Read more: https://nextjs.org/docs/messages/prerender-error\n              TypeError: <module-function>().get is not a function\n-                 at a (<next-dist-dir>)\n-                 at b (<anonymous>) {\n+                 at e (turbopack:///[project]/app/page.tsx:17:69)\n+                 at a (<anonymous>)\n+               15 |\n+               16 | async function HeadersReadingComponent() {\n+             > 17 |   const userAgent = (headers() as unknown as UnsafeUnwrappedHeaders).get(\n+                  |                                                                     ^\n+               18 |     'user-agent'\n+               19 |   )\n+               20 |   return ( {\n                digest: '<error-digest>'\n              }\n              Export encountered an error on /page: /, exiting the build.\""
        },
        {
            "sha": "bea741e9af9471ec2213c4ca16dbd5d35ebf11cd",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 34,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -181,17 +181,6 @@ describe.each(\n           } else {\n             expect(output).toMatchInlineSnapshot(`\n              \"Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n-                 at a (<next-dist-dir>)\n-                 at b (<next-dist-dir>)\n-                 at c (<next-dist-dir>)\n-                 at d (<next-dist-dir>)\n-                 at e (<next-dist-dir>)\n-                 at f (<next-dist-dir>)\n-                 at g (<next-dist-dir>)\n-                 at h (<next-dist-dir>)\n-                 at i (<next-dist-dir>)\n-                 at j (<next-dist-dir>)\n-                 at k (<next-dist-dir>)\n                  at main (<anonymous>)\n                  at body (<anonymous>)\n                  at html (<anonymous>)\n@@ -673,36 +662,18 @@ describe.each(\n           } else {\n             expect(output).toMatchInlineSnapshot(`\n              \"Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n-                 at a (<next-dist-dir>)\n-                 at b (<next-dist-dir>)\n-                 at c (<next-dist-dir>)\n-                 at d (<next-dist-dir>)\n-                 at e (<next-dist-dir>)\n-                 at f (<next-dist-dir>)\n-                 at g (<next-dist-dir>)\n-                 at h (<next-dist-dir>)\n-                 at i (<next-dist-dir>)\n-                 at j (<next-dist-dir>)\n-                 at k (<next-dist-dir>)\n-                 at l (<next-dist-dir>)\n+                 at c (turbopack:///[project]/app/indirection.tsx:9:0)\n                  at main (<anonymous>)\n                  at body (<anonymous>)\n                  at html (<anonymous>)\n+                7 | export function IndirectionTwo({ children }) {\n+                8 |   return children\n+             >  9 | }\n+               10 |\n              To get a more detailed stack trace and pinpoint the issue, try one of the following:\n                - Start the app in development mode by running \\`next dev\\`, then open \"/\" in your browser to investigate the error.\n                - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.\n              Error: Route \"/\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n-                 at m (<next-dist-dir>)\n-                 at n (<next-dist-dir>)\n-                 at o (<next-dist-dir>)\n-                 at p (<next-dist-dir>)\n-                 at q (<next-dist-dir>)\n-                 at r (<next-dist-dir>)\n-                 at s (<next-dist-dir>)\n-                 at t (<next-dist-dir>)\n-                 at u (<next-dist-dir>)\n-                 at v (<next-dist-dir>)\n-                 at w (<next-dist-dir>)\n                  at main (<anonymous>)\n                  at body (<anonymous>)\n                  at html (<anonymous>)"
        },
        {
            "sha": "3ebbb3f52663d5c5fe8ec2ff9ce94e4208eb6201",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/next.config.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fnext.config.js?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -5,7 +5,6 @@ const nextConfig = {\n   experimental: {\n     cpus: 1,\n     dynamicIO: true,\n-    enablePrerenderSourceMaps: true,\n     serverSourceMaps: true,\n   },\n   serverExternalPackages: ['external-pkg'],"
        },
        {
            "sha": "5f7b69fe70c7f832e8795277f5ef70696435ee41",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/11cbba8bd5967ce605ce351956fca4d50b0ead99/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=11cbba8bd5967ce605ce351956fca4d50b0ead99",
            "patch": "@@ -15,22 +15,29 @@ describe('build-output-prerender', () => {\n         expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n          \"▲ Next.js x.y.z (Turbopack)\n             - Experiments (use with caution):\n-              ✓ dynamicIO\"\n+              ✓ dynamicIO\n+              ✓ enablePrerenderSourceMaps (enabled by \\`experimental.dynamicIO\\`)\"\n         `)\n       } else {\n         expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n          \"▲ Next.js x.y.z\n             - Experiments (use with caution):\n-              ✓ dynamicIO\"\n+              ✓ dynamicIO\n+              ✓ enablePrerenderSourceMaps (enabled by \\`experimental.dynamicIO\\`)\"\n         `)\n       }\n     })\n \n     it('shows only a single prerender error with a mangled stack', async () => {\n       if (isTurbopack) {\n+        // TODO(veil): Why is the location incomplete unless we enable --no-mangling?\n         expect(getPrerenderOutput(next.cliOutput)).toMatchInlineSnapshot(`\n          \"Error: Route \"/client\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-             at x (<next-dist-dir>)\n+             at c (turbopack:///[project]/app/client/page.tsx:5:0)\n+           3 | export default function Page() {\n+           4 |   return <p>Current time: {new Date().toISOString()}</p>\n+         > 5 | }\n+           6 |\n          To get a more detailed stack trace and pinpoint the issue, try one of the following:\n            - Start the app in development mode by running \\`next dev\\`, then open \"/client\" in your browser to investigate the error.\n            - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.\n@@ -70,7 +77,7 @@ describe('build-output-prerender', () => {\n               ⨯ turbopackMinify (disabled by \\`--debug-prerender\\`)\n               ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n               ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-              ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\"\n+              ✓ enablePrerenderSourceMaps (enabled by \\`experimental.dynamicIO\\`)\"\n         `)\n       } else {\n         expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -81,7 +88,7 @@ describe('build-output-prerender', () => {\n               ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n               ⨯ serverMinification (disabled by \\`--debug-prerender\\`)\n               ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-              ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\"\n+              ✓ enablePrerenderSourceMaps (enabled by \\`experimental.dynamicIO\\`)\"\n         `)\n       }\n     })"
        }
    ],
    "stats": {
        "total": 135,
        "additions": 76,
        "deletions": 59
    }
}