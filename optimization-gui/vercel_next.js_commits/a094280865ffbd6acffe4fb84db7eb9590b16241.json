{
    "author": "ztanner",
    "message": "remove unique metadata prop from initial RSC payload (#79388)\n\nThis value is used as a key to re-mount `head` on subsequent client\nnavigations, but as far as I can tell, it's not needed for the initial\nRSC payload that seeds these pages.\n\nIn its current form, these random IDs get serialized as part of the RSC\npayload, leading to non-deterministic HTML outputs.\n\nFixes #77810",
    "sha": "a094280865ffbd6acffe4fb84db7eb9590b16241",
    "files": [
        {
            "sha": "9e3e92b729e22b523e4e0efad8c110a27e802962",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 10,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/a094280865ffbd6acffe4fb84db7eb9590b16241/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a094280865ffbd6acffe4fb84db7eb9590b16241/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=a094280865ffbd6acffe4fb84db7eb9590b16241",
            "patch": "@@ -521,7 +521,6 @@ async function generateDynamicRSCPayload(\n             />\n             {/* Adding requestId as react key to make metadata remount for each render */}\n             <ViewportTree key={getFlightViewportKey(requestId)} />\n-            {/* Not add requestId as react key to ensure segment prefetch could result consistently if nothing changed */}\n             <MetadataTree key={getFlightMetadataKey(requestId)} />\n           </React.Fragment>\n         ),\n@@ -862,8 +861,7 @@ async function getRSCPayload(\n         statusCode={ctx.res.statusCode}\n         isPossibleServerAction={ctx.isPossibleServerAction}\n       />\n-      <ViewportTree key={getFlightViewportKey(ctx.requestId)} />\n-      {/* Not add requestId as react key to ensure segment prefetch could result consistently if nothing changed */}\n+      <ViewportTree />\n       <MetadataTree />\n     </React.Fragment>\n   )\n@@ -931,7 +929,6 @@ async function getErrorRSCPayload(\n       ViewportBoundary,\n     },\n     url,\n-    requestId,\n     workStore,\n   } = ctx\n \n@@ -950,22 +947,18 @@ async function getErrorRSCPayload(\n     serveStreamingMetadata: serveStreamingMetadata,\n   })\n \n-  // {/* Adding requestId as react key to make metadata remount for each render */}\n-  const metadata = <MetadataTree key={getFlightMetadataKey(requestId)} />\n-\n   const initialHead = (\n     <React.Fragment key={flightDataPathHeadKey}>\n       <NonIndex\n         pagePath={ctx.pagePath}\n         statusCode={ctx.res.statusCode}\n         isPossibleServerAction={ctx.isPossibleServerAction}\n       />\n-      {/* Adding requestId as react key to make metadata remount for each render */}\n-      <ViewportTree key={getFlightViewportKey(requestId)} />\n+      <ViewportTree />\n       {process.env.NODE_ENV === 'development' && (\n         <meta name=\"next-error\" content=\"not-found\" />\n       )}\n-      {metadata}\n+      <MetadataTree />\n     </React.Fragment>\n   )\n "
        }
    ],
    "stats": {
        "total": 13,
        "additions": 3,
        "deletions": 10
    }
}