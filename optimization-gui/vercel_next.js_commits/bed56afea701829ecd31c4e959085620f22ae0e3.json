{
    "author": "huozhi",
    "message": "[errors] refactor default global-error into a separate file (#78182)\n\n### What\r\n\r\nMove built-in `global-error` into a new module, separated from `error-boundary`",
    "sha": "bed56afea701829ecd31c4e959085620f22ae0e3",
    "files": [
        {
            "sha": "e0b3aa0b4995ca92c69c117d5b1bb00bf2f016d0",
            "filename": "crates/next-core/src/next_app/app_page_entry.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -88,7 +88,7 @@ pub async fn get_app_page_entry(\n             \"VAR_MODULE_GLOBAL_ERROR\" => if inner_assets.contains_key(GLOBAL_ERROR) {\n                 GLOBAL_ERROR.into()\n              } else {\n-                \"next/dist/client/components/error-boundary\".into()\n+                \"next/dist/client/components/global-error\".into()\n             },\n         },\n         fxindexmap! {"
        },
        {
            "sha": "c9b70eb64f3014e5260d22cc028a08625cf038c0",
            "filename": "packages/next/src/build/webpack/loaders/next-app-loader/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -77,7 +77,7 @@ const GLOBAL_ERROR_FILE_TYPE = 'global-error'\n const PAGE_SEGMENT = 'page$'\n const PARALLEL_CHILDREN_SEGMENT = 'children$'\n \n-const defaultGlobalErrorPath = 'next/dist/client/components/error-boundary'\n+const defaultGlobalErrorPath = 'next/dist/client/components/global-error'\n const defaultLayoutPath = 'next/dist/client/components/default-layout'\n \n type DirResolver = (pathToResolve: string) => string"
        },
        {
            "sha": "640fe2b232f4a43ded9961e6f25b9d57cf58d2ab",
            "filename": "packages/next/src/client/components/app-router.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -23,11 +23,10 @@ import {\n   PathParamsContext,\n } from '../../shared/lib/hooks-client-context.shared-runtime'\n import { dispatchAppRouterAction, useActionQueue } from './use-action-queue'\n-import {\n-  default as DefaultGlobalError,\n-  ErrorBoundary,\n+import { ErrorBoundary } from './error-boundary'\n+import DefaultGlobalError, {\n   type GlobalErrorComponent,\n-} from './error-boundary'\n+} from '../../client/components/global-error'\n import { isBot } from '../../shared/lib/router/utils/is-bot'\n import { addBasePath } from '../add-base-path'\n import { AppRouterAnnouncer } from './app-router-announcer'"
        },
        {
            "sha": "244dba03f2c9e1a528c8592514ce572aeae8042b",
            "filename": "packages/next/src/client/components/error-boundary.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 72,
            "changes": 73,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferror-boundary.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferror-boundary.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferror-boundary.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -4,33 +4,7 @@ import React, { type JSX } from 'react'\n import { useUntrackedPathname } from './navigation-untracked'\n import { isNextRouterError } from './is-next-router-error'\n import { handleHardNavError } from './nav-failure-handler'\n-\n-const workAsyncStorage =\n-  typeof window === 'undefined'\n-    ? (\n-        require('../../server/app-render/work-async-storage.external') as typeof import('../../server/app-render/work-async-storage.external')\n-      ).workAsyncStorage\n-    : undefined\n-\n-const styles = {\n-  error: {\n-    // https://github.com/sindresorhus/modern-normalize/blob/main/modern-normalize.css#L38-L52\n-    fontFamily:\n-      'system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"',\n-    height: '100vh',\n-    textAlign: 'center',\n-    display: 'flex',\n-    flexDirection: 'column',\n-    alignItems: 'center',\n-    justifyContent: 'center',\n-  },\n-  text: {\n-    fontSize: '14px',\n-    fontWeight: 400,\n-    lineHeight: '28px',\n-    margin: '0 8px',\n-  },\n-} as const\n+import { HandleISRError } from './handle-isr-error'\n \n export type ErrorComponent = React.ComponentType<{\n   error: Error\n@@ -56,21 +30,6 @@ interface ErrorBoundaryHandlerState {\n   previousPathname: string | null\n }\n \n-// if we are revalidating we want to re-throw the error so the\n-// function crashes so we can maintain our previous cache\n-// instead of caching the error page\n-function HandleISRError({ error }: { error: any }) {\n-  if (workAsyncStorage) {\n-    const store = workAsyncStorage.getStore()\n-    if (store?.isRevalidate || store?.isStaticGeneration) {\n-      console.error(error)\n-      throw error\n-    }\n-  }\n-\n-  return null\n-}\n-\n export class ErrorBoundaryHandler extends React.Component<\n   ErrorBoundaryHandlerProps,\n   ErrorBoundaryHandlerState\n@@ -152,36 +111,6 @@ export class ErrorBoundaryHandler extends React.Component<\n   }\n }\n \n-export type GlobalErrorComponent = React.ComponentType<{\n-  error: any\n-}>\n-export function GlobalError({ error }: { error: any }) {\n-  const digest: string | undefined = error?.digest\n-  return (\n-    <html id=\"__next_error__\">\n-      <head></head>\n-      <body>\n-        <HandleISRError error={error} />\n-        <div style={styles.error}>\n-          <div>\n-            <h2 style={styles.text}>\n-              Application error: a {digest ? 'server' : 'client'}-side exception\n-              has occurred while loading {window.location.hostname} (see the{' '}\n-              {digest ? 'server logs' : 'browser console'} for more\n-              information).\n-            </h2>\n-            {digest ? <p style={styles.text}>{`Digest: ${digest}`}</p> : null}\n-          </div>\n-        </div>\n-      </body>\n-    </html>\n-  )\n-}\n-\n-// Exported so that the import signature in the loaders can be identical to user\n-// supplied custom global error signatures.\n-export default GlobalError\n-\n /**\n  * Handles errors through `getDerivedStateFromError`.\n  * Renders the provided error component and provides a way to `reset` the error boundary state."
        },
        {
            "sha": "48c983540bec6c5bd0b025d9cd61a54a4d008020",
            "filename": "packages/next/src/client/components/global-error.tsx",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobal-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobal-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobal-error.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -0,0 +1,53 @@\n+'use client'\n+\n+import { HandleISRError } from './handle-isr-error'\n+\n+const styles = {\n+  error: {\n+    // https://github.com/sindresorhus/modern-normalize/blob/main/modern-normalize.css#L38-L52\n+    fontFamily:\n+      'system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"',\n+    height: '100vh',\n+    textAlign: 'center',\n+    display: 'flex',\n+    flexDirection: 'column',\n+    alignItems: 'center',\n+    justifyContent: 'center',\n+  },\n+  text: {\n+    fontSize: '14px',\n+    fontWeight: 400,\n+    lineHeight: '28px',\n+    margin: '0 8px',\n+  },\n+} as const\n+\n+export type GlobalErrorComponent = React.ComponentType<{\n+  error: any\n+}>\n+function GlobalError({ error }: { error: any }) {\n+  const digest: string | undefined = error?.digest\n+  return (\n+    <html id=\"__next_error__\">\n+      <head></head>\n+      <body>\n+        <HandleISRError error={error} />\n+        <div style={styles.error}>\n+          <div>\n+            <h2 style={styles.text}>\n+              Application error: a {digest ? 'server' : 'client'}-side exception\n+              has occurred while loading {window.location.hostname} (see the{' '}\n+              {digest ? 'server logs' : 'browser console'} for more\n+              information).\n+            </h2>\n+            {digest ? <p style={styles.text}>{`Digest: ${digest}`}</p> : null}\n+          </div>\n+        </div>\n+      </body>\n+    </html>\n+  )\n+}\n+\n+// Exported so that the import signature in the loaders can be identical to user\n+// supplied custom global error signatures.\n+export default GlobalError"
        },
        {
            "sha": "c871428d578ccdd924073abcc1dfba0faab91de1",
            "filename": "packages/next/src/client/components/handle-isr-error.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -0,0 +1,21 @@\n+const workAsyncStorage =\n+  typeof window === 'undefined'\n+    ? (\n+        require('../../server/app-render/work-async-storage.external') as typeof import('../../server/app-render/work-async-storage.external')\n+      ).workAsyncStorage\n+    : undefined\n+\n+// if we are revalidating we want to re-throw the error so the\n+// function crashes so we can maintain our previous cache\n+// instead of caching the error page\n+export function HandleISRError({ error }: { error: any }) {\n+  if (workAsyncStorage) {\n+    const store = workAsyncStorage.getStore()\n+    if (store?.isRevalidate || store?.isStaticGeneration) {\n+      console.error(error)\n+      throw error\n+    }\n+  }\n+\n+  return null\n+}"
        },
        {
            "sha": "88a529ee6431fe07261c9b960cac85f142c9d3a1",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay-error-boundary.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -1,10 +1,9 @@\n import { PureComponent } from 'react'\n import { RuntimeErrorHandler } from '../../errors/runtime-error-handler'\n-import {\n-  ErrorBoundary,\n+import { ErrorBoundary } from '../../error-boundary'\n+import DefaultGlobalError, {\n   type GlobalErrorComponent,\n-  GlobalError as DefaultGlobalError,\n-} from '../../error-boundary'\n+} from '../../global-error'\n \n type AppDevOverlayErrorBoundaryProps = {\n   children: React.ReactNode"
        },
        {
            "sha": "72958ff9a472cc9c35975fb3f635682c2c820500",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -1,5 +1,5 @@\n import type { OverlayState } from '../shared'\n-import type { GlobalErrorComponent } from '../../error-boundary'\n+import type { GlobalErrorComponent } from '../../global-error'\n \n import { useCallback, useEffect, useState } from 'react'\n import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'"
        },
        {
            "sha": "b14acd17b7a89775c5fe9ca4f4cc6afcf89bb207",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/client-entry.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -1,7 +1,7 @@\n import React from 'react'\n import { getSocketUrl } from '../utils/get-socket-url'\n import { HMR_ACTIONS_SENT_TO_BROWSER } from '../../../../server/dev/hot-reloader-types'\n-import GlobalError from '../../error-boundary'\n+import GlobalError from '../../global-error'\n import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'\n \n const noop = () => {}"
        },
        {
            "sha": "b19378c0f677d7649e8313248c581dc321506dde",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -42,7 +42,7 @@ import type { DebugInfo } from '../types'\n import { useUntrackedPathname } from '../../navigation-untracked'\n import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n import { handleDevBuildIndicatorHmrEvents } from '../../../dev/dev-build-indicator/internal/handle-dev-build-indicator-hmr-events'\n-import type { GlobalErrorComponent } from '../../error-boundary'\n+import type { GlobalErrorComponent } from '../../global-error'\n import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n import reportHmrLatency from '../utils/report-hmr-latency'\n import { TurbopackHmr } from '../utils/turbopack-hot-reloader-common'"
        },
        {
            "sha": "6b9760d4c2cf8066c0e18887d4992803b2eba6b3",
            "filename": "packages/next/src/client/react-client-callbacks/error-boundary-callbacks.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Freact-client-callbacks%2Ferror-boundary-callbacks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fclient%2Freact-client-callbacks%2Ferror-boundary-callbacks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Freact-client-callbacks%2Ferror-boundary-callbacks.ts?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -11,10 +11,8 @@ import { isNextRouterError } from '../components/is-next-router-error'\n import { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { reportGlobalError } from './report-global-error'\n import { originConsoleError } from '../components/globals/intercept-console-error'\n-import {\n-  ErrorBoundaryHandler,\n-  GlobalError as DefaultErrorBoundary,\n-} from '../components/error-boundary'\n+import { ErrorBoundaryHandler } from '../components/error-boundary'\n+import DefaultErrorBoundary from '../components/global-error'\n \n export function onCaughtError(\n   thrownValue: unknown,"
        },
        {
            "sha": "4ce9a57443c7ef6a73aee7607ca1f342966745c4",
            "filename": "packages/next/src/server/app-render/entry-base.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bed56afea701829ecd31c4e959085620f22ae0e3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts?ref=bed56afea701829ecd31c4e959085620f22ae0e3",
            "patch": "@@ -29,8 +29,11 @@ import * as serverHooks from '../../client/components/hooks-server-context'\n import { HTTPAccessFallbackBoundary } from '../../client/components/http-access-fallback/error-boundary'\n import { createMetadataComponents } from '../../lib/metadata/metadata'\n import { patchFetch as _patchFetch } from '../lib/patch-fetch'\n-// not being used but needs to be included in the client manifest for /_not-found\n+// Not being directly used but should be included in the client manifest for /_not-found\n+// * ErrorBoundary -> client/components/error-boundary\n+// * GlobalError -> client/components/global-error\n import '../../client/components/error-boundary'\n+import '../../client/components/global-error'\n import {\n   MetadataBoundary,\n   ViewportBoundary,"
        }
    ],
    "stats": {
        "total": 182,
        "additions": 92,
        "deletions": 90
    }
}