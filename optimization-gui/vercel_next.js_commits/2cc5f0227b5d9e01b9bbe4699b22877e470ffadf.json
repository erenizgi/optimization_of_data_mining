{
    "author": "devjiwonchoi",
    "message": "Add Learn more docs to Middleware deprecation warning (#84711)\n\nThis PR adds an error doc for the Middleware deprecation warning that it\ncan refer to.\n\n  - Explain why this error occurred\n  - Provide migration guide\n  - Explain the rationale for the renaming to Proxy\n\n---------\n\nCo-authored-by: Joseph <joseph.chamochumbi@vercel.com>\nCo-authored-by: graphite-app[bot] <96075541+graphite-app[bot]@users.noreply.github.com>",
    "sha": "2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
    "files": [
        {
            "sha": "c771197d969e1ac34884007736ace781e63390fb",
            "filename": "docs/01-app/03-api-reference/03-file-conventions/proxy.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx?ref=2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
            "patch": "@@ -690,7 +690,7 @@ Learn how to [configure Proxy](/docs/app/guides/self-hosting#proxy) when self-ho\n \n ### Why the Change\n \n-The reason behind the renaming of `middleware` is that the term \"middleware can often be confused with Express.js middleware, leading to a misinterpretation of its purpose. Also, Middleware is highly capable, so it may encourage the usage; however, this feature is recommended to be used as a last resort.\n+The reason behind the renaming of `middleware` is that the term \"middleware\" can often be confused with Express.js middleware, leading to a misinterpretation of its purpose. Also, Middleware is highly capable, so it may encourage the usage; however, this feature is recommended to be used as a last resort.\n \n Next.js is moving forward to provide better APIs with better ergonomics so that developers can achieve their goals without Middleware. This is the reason behind the renaming of `middleware`.\n "
        },
        {
            "sha": "3b32179803d325845ad81a9111625d564c1238b1",
            "filename": "errors/middleware-to-proxy.mdx",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/errors%2Fmiddleware-to-proxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/errors%2Fmiddleware-to-proxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fmiddleware-to-proxy.mdx?ref=2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
            "patch": "@@ -0,0 +1,44 @@\n+---\n+title: Renaming Middleware to Proxy\n+---\n+\n+## Why This Error Occurred\n+\n+You are using the `middleware` file convention, which is deprecated and has been renamed to [`proxy`](/docs/app/api-reference/file-conventions/proxy).\n+\n+## Migration to Proxy\n+\n+### Why the Change\n+\n+The reason behind the renaming of `middleware` is that the term \"middleware\" can often be confused with Express.js middleware, leading to a misinterpretation of its purpose. Also, Middleware is highly capable, so it may encourage the usage; however, this feature is recommended to be used as a last resort.\n+\n+Next.js is moving forward to provide better APIs with better ergonomics so that developers can achieve their goals without Middleware. This is the reason behind the renaming of `middleware`.\n+\n+### Why \"Proxy\"\n+\n+The name Proxy clarifies what Middleware is capable of. The term \"proxy\" implies that it has a network boundary in front of the app, which is the behavior of Middleware. Also, Middleware defaults to run at the [Edge Runtime](/docs/app/api-reference/edge), which can run closer to the client, separated from the app's region. These behaviors align better with the term \"proxy\" and provide a clearer purpose of the feature.\n+\n+### How to Migrate\n+\n+We recommend users avoid relying on Middleware unless no other options exist. Our goal is to give them APIs with better ergonomics so they can achieve their goals without Middleware.\n+\n+The term “middleware” often confuses users with Express.js middleware, which can encourage misuse. To clarify our direction, we are renaming the file convention to “proxy.” This highlights that we are moving away from Middleware, breaking down its overloaded features, and making the Proxy clear in its purpose.\n+\n+Next.js provides a codemod to migrate from `middleware.ts` to `proxy.ts`. You can run the following command to migrate:\n+\n+```bash\n+npx @next/codemod@canary middleware-to-proxy .\n+```\n+\n+The codemod will rename the file and the function name from `middleware` to `proxy`.\n+\n+```diff\n+// middleware.ts -> proxy.ts\n+\n+- export function middleware() {\n++ export function proxy() {\n+```\n+\n+## Useful Links\n+\n+- [Proxy Docs](/docs/app/api-reference/file-conventions/proxy)"
        },
        {
            "sha": "4611f5fc0f9df58f7831b39248a0d890c1b6fedc",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
            "patch": "@@ -896,5 +896,7 @@\n   \"895\": \"Invalid React HTML document. Should start with doctype prefix.\",\n   \"896\": \"oops\",\n   \"897\": \"Expected HTML document to start with doctype prefix\",\n-  \"898\": \"When using Cache Components, all `generateStaticParams` functions must return at least one result. This is to ensure that we can perform build-time validation that there is no other dynamic accesses that would cause a runtime error.\\n\\nLearn more: https://nextjs.org/docs/messages/empty-generate-static-params\"\n+  \"898\": \"When using Cache Components, all `generateStaticParams` functions must return at least one result. This is to ensure that we can perform build-time validation that there is no other dynamic accesses that would cause a runtime error.\\n\\nLearn more: https://nextjs.org/docs/messages/empty-generate-static-params\",\n+  \"899\": \"Both \\\"%s\\\" and \\\"%s\\\" files are detected. Please use \\\"%s\\\" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy\",\n+  \"900\": \"Both %s file \\\"./%s\\\" and %s file \\\"./%s\\\" are detected. Please use \\\"./%s\\\" only. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy\"\n }"
        },
        {
            "sha": "8c67ea077ba9327d7e158dbec740f6c1adf3040a",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
            "patch": "@@ -1243,11 +1243,11 @@ export default async function build(\n           const absoluteMiddlewarePath = path.join(rootDir, middlewareFilePath)\n \n           throw new Error(\n-            `Both ${MIDDLEWARE_FILENAME} file \"./${path.relative(cwd, absoluteMiddlewarePath)}\" and ${PROXY_FILENAME} file \"./${path.relative(cwd, absoluteProxyPath)}\" are detected. Please use \"./${path.relative(cwd, absoluteProxyPath)}\" only.`\n+            `Both ${MIDDLEWARE_FILENAME} file \"./${path.relative(cwd, absoluteMiddlewarePath)}\" and ${PROXY_FILENAME} file \"./${path.relative(cwd, absoluteProxyPath)}\" are detected. Please use \"./${path.relative(cwd, absoluteProxyPath)}\" only. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n           )\n         }\n         Log.warnOnce(\n-          `The \"${MIDDLEWARE_FILENAME}\" file convention is deprecated. Please use \"${PROXY_FILENAME}\" instead.`\n+          `The \"${MIDDLEWARE_FILENAME}\" file convention is deprecated. Please use \"${PROXY_FILENAME}\" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n         )\n       }\n "
        },
        {
            "sha": "bbb4cf9519ed8a4d02c39e514627fcfdeb679fd1",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2cc5f0227b5d9e01b9bbe4699b22877e470ffadf/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=2cc5f0227b5d9e01b9bbe4699b22877e470ffadf",
            "patch": "@@ -432,11 +432,11 @@ async function startWatcher(\n             const cwd = process.cwd()\n \n             throw new Error(\n-              `Both ${MIDDLEWARE_FILENAME} file \"./${path.relative(cwd, middlewareFilePath)}\" and ${PROXY_FILENAME} file \"./${path.relative(cwd, proxyFilePath)}\" are detected. Please use \"./${path.relative(cwd, proxyFilePath)}\" only.`\n+              `Both ${MIDDLEWARE_FILENAME} file \"./${path.relative(cwd, middlewareFilePath)}\" and ${PROXY_FILENAME} file \"./${path.relative(cwd, proxyFilePath)}\" are detected. Please use \"./${path.relative(cwd, proxyFilePath)}\" only. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n             )\n           }\n           Log.warnOnce(\n-            `The \"${MIDDLEWARE_FILENAME}\" file convention is deprecated. Please use \"${PROXY_FILENAME}\" instead.`\n+            `The \"${MIDDLEWARE_FILENAME}\" file convention is deprecated. Please use \"${PROXY_FILENAME}\" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n           )\n         }\n "
        }
    ],
    "stats": {
        "total": 58,
        "additions": 52,
        "deletions": 6
    }
}