{
    "author": "ijjk",
    "message": "Update more global turbo CLI usage (#76576)\n\nContinues https://github.com/vercel/next.js/pull/76532 as it seems to be\nalleviating the `npm` failures so replaces some more usage of global\n`npm` installing the turbo CLI.\n\nx-ref:\nhttps://github.com/vercel/next.js/actions/runs/13554859494/job/37886841090#step:15:25",
    "sha": "6647a7706f688a3b95e74be32071432d1a5b98b2",
    "files": [
        {
            "sha": "0ffbd7a4a208a64f6180c770a4a1ba326036f576",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6647a7706f688a3b95e74be32071432d1a5b98b2/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/6647a7706f688a3b95e74be32071432d1a5b98b2/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=6647a7706f688a3b95e74be32071432d1a5b98b2",
            "patch": "@@ -304,7 +304,11 @@ jobs:\n         with:\n           node-version: ${{ env.NODE_LTS_VERSION }}\n           check-latest: true\n-      - run: corepack enable\n+\n+      - name: Setup corepack\n+        run: |\n+          npm i -g corepack@0.31\n+          corepack enable\n \n       # we always want to run this to set environment variables\n       - name: Install Rust\n@@ -334,7 +338,7 @@ jobs:\n       # issues with turbo caching\n       - name: pull build cache\n         if: ${{ matrix.settings.docker }}\n-        run: npm i -g turbo@${{ env.TURBO_VERSION }} && node ./scripts/pull-turbo-cache.js ${{ matrix.settings.target }}\n+        run: TURBO_VERSION=${TURBO_VERSION} node ./scripts/pull-turbo-cache.js ${{ matrix.settings.target }}\n \n       - name: check build exists\n         if: ${{ matrix.settings.docker }}\n@@ -423,8 +427,6 @@ jobs:\n         with:\n           targets: wasm32-unknown-unknown\n \n-      - run: npm i -g turbo@${{ env.TURBO_VERSION }}\n-\n       - name: Install wasm-pack\n         run: curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\n "
        },
        {
            "sha": "344dec10d80cf72ecd48164440a862608bc0fa77",
            "filename": "scripts/pull-turbo-cache.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6647a7706f688a3b95e74be32071432d1a5b98b2/scripts%2Fpull-turbo-cache.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6647a7706f688a3b95e74be32071432d1a5b98b2/scripts%2Fpull-turbo-cache.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fpull-turbo-cache.js?ref=6647a7706f688a3b95e74be32071432d1a5b98b2",
            "patch": "@@ -7,11 +7,12 @@ const { spawn } = require('child_process')\n   const target = process.argv[process.argv.length - 1]\n \n   let turboResult = ''\n+  const turboCommand = `pnpm dlx turbo@${process.env.TURBO_VERSION || 'latest'}`\n \n   await new Promise((resolve, reject) => {\n     const child = spawn(\n       '/bin/bash',\n-      ['-c', `pnpm turbo run cache-build-native --dry=json -- ${target}`],\n+      ['-c', `${turboCommand} run cache-build-native --dry=json -- ${target}`],\n       {\n         stdio: 'pipe',\n       }\n@@ -51,7 +52,7 @@ const { spawn } = require('child_process')\n     await new Promise((resolve, reject) => {\n       const child = spawn(\n         '/bin/bash',\n-        ['-c', `pnpm turbo run cache-build-native -- ${target}`],\n+        ['-c', `${turboCommand} run cache-build-native -- ${target}`],\n         {\n           stdio: 'inherit',\n         }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 9,
        "deletions": 6
    }
}