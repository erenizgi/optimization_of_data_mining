{
    "author": "wbinnssmith",
    "message": "devlow-bench: wait for complete ready for server startup event (#77217)\n\nPreviously, we marked the server startup whenever a local url was shown\nin stdio. Next.js shows this url as soon as it can to make it actionable\nsooner, before the server is truly ready.\n\nThis changes makes the event record the time until the “Ready in Nms”\nmessage is shown instead.\n\nTest Plan: `./node_modules/.bin/devlow-bench ./scripts/devlow-bench.mjs`\nand validate server startup is recorded.",
    "sha": "420fa8013bcaf67a13ed694b3a5a89fa72be9ef5",
    "files": [
        {
            "sha": "e39ffcf3d6ece9801a8be1db969a9d8434b20c51",
            "filename": "scripts/devlow-bench.mjs",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/420fa8013bcaf67a13ed694b3a5a89fa72be9ef5/scripts%2Fdevlow-bench.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/420fa8013bcaf67a13ed694b3a5a89fa72be9ef5/scripts%2Fdevlow-bench.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fdevlow-bench.mjs?ref=420fa8013bcaf67a13ed694b3a5a89fa72be9ef5",
            "patch": "@@ -8,6 +8,8 @@ import { command } from '@vercel/devlow-bench/shell'\n import { waitForFile } from '@vercel/devlow-bench/file'\n \n const REPO_ROOT = fileURLToPath(new URL('..', import.meta.url))\n+const START_SERVER_REGEXP = /Ready in \\d+/\n+const URL_REGEXP = /Local:\\s+(?<url>.+)\\n/\n \n const GIT_SHA =\n   process.env.GITHUB_SHA ??\n@@ -101,10 +103,12 @@ const nextBuildWorkflow =\n       cleanupTasks.push(killShell)\n \n       // wait for server to be ready\n-      const START_SERVER_REGEXP = /Local:\\s+(?<url>.+)\\n/\n       const {\n         groups: { url },\n-      } = await shell.waitForOutput(START_SERVER_REGEXP)\n+      } = await shell.waitForOutput(URL_REGEXP)\n+\n+      // wait for server to be ready\n+      await shell.waitForOutput(START_SERVER_REGEXP)\n       await measureTime('server startup', { props: { turbopack, page } })\n       await shell.reportMemUsage('mem usage after startup', {\n         props: { turbopack, page },\n@@ -188,7 +192,7 @@ const nextBuildWorkflow =\n       // wait for server to be ready\n       const {\n         groups: { url: url2 },\n-      } = await shell.waitForOutput(START_SERVER_REGEXP)\n+      } = await shell.waitForOutput(URL_REGEXP)\n       await shell.reportMemUsage('mem usage after startup with cache')\n \n       // open page\n@@ -279,10 +283,12 @@ const nextDevWorkflow =\n       cleanupTasks.push(killShell)\n \n       // wait for server to be ready\n-      const START_SERVER_REGEXP = /Local:\\s+(?<url>.+)\\n/\n       const {\n         groups: { url },\n-      } = await shell.waitForOutput(START_SERVER_REGEXP)\n+      } = await shell.waitForOutput(URL_REGEXP)\n+\n+      // wait for server to be ready\n+      await shell.waitForOutput(START_SERVER_REGEXP)\n       await measureTime('server startup', { props: { turbopack, page } })\n       await shell.reportMemUsage('mem usage after startup', {\n         props: { turbopack, page },\n@@ -508,7 +514,7 @@ const nextDevWorkflow =\n       // wait for server to be ready\n       const {\n         groups: { url: url2 },\n-      } = await shell.waitForOutput(START_SERVER_REGEXP)\n+      } = await shell.waitForOutput(URL_REGEXP)\n       await shell.reportMemUsage('mem usage after startup with cache')\n \n       // open page"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 12,
        "deletions": 6
    }
}