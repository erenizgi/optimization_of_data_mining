{
    "author": "devjiwonchoi",
    "message": "[devtools] set up panel ui issues tab infra (#80727)\n\nAdded infra for the issues tab and its story. Will follow up with the\nsidebar to navigate the issues and their error content.\n\nCloses NEXT-4546",
    "sha": "3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
    "files": [
        {
            "sha": "7b3c379027b23f85fab11752343009deac536048",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/devtools-panel-tab.tsx",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -1,20 +1,30 @@\n import type { DevToolsPanelTabType } from '../devtools-panel'\n import type { Corners } from '../../../shared'\n+import type { DebugInfo } from '../../../../shared/types'\n+import type { ReadyRuntimeError } from '../../../utils/get-error-by-type'\n+import type { HydrationErrorState } from '../../../../shared/hydration-error'\n \n import { SettingsTab } from './settings-tab'\n+import { IssuesTab } from './issues-tab/issues-tab'\n \n export function DevToolsPanelTab({\n   activeTab,\n   devToolsPosition,\n   scale,\n   handlePositionChange,\n   handleScaleChange,\n+  debugInfo,\n+  runtimeErrors,\n+  getSquashedHydrationErrorDetails,\n }: {\n   activeTab: DevToolsPanelTabType\n   devToolsPosition: Corners\n   scale: number\n   handlePositionChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n   handleScaleChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n+  debugInfo: DebugInfo\n+  runtimeErrors: ReadyRuntimeError[]\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n }) {\n   switch (activeTab) {\n     case 'settings':\n@@ -29,7 +39,13 @@ export function DevToolsPanelTab({\n     case 'route':\n       return <div>Route</div>\n     case 'issues':\n-      return <div>Issues</div>\n+      return (\n+        <IssuesTab\n+          debugInfo={debugInfo}\n+          runtimeErrors={runtimeErrors}\n+          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+        />\n+      )\n     default:\n       return null\n   }"
        },
        {
            "sha": "1500394d0ed754c0c1396b1b17f8c3de75729e41",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab.tsx",
            "status": "added",
            "additions": 81,
            "deletions": 0,
            "changes": 81,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -0,0 +1,81 @@\n+import type { DebugInfo } from '../../../../../shared/types'\n+import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n+import type { HydrationErrorState } from '../../../../../shared/hydration-error'\n+\n+import {\n+  GenericErrorDescription,\n+  HydrationErrorDescription,\n+} from '../../../../container/errors'\n+import { EnvironmentNameLabel } from '../../../errors/environment-name-label/environment-name-label'\n+import { ErrorMessage } from '../../../errors/error-message/error-message'\n+import { ErrorOverlayToolbar } from '../../../errors/error-overlay-toolbar/error-overlay-toolbar'\n+import { ErrorTypeLabel } from '../../../errors/error-type-label/error-type-label'\n+import { css } from '../../../../utils/css'\n+import { useActiveRuntimeError } from '../../../../hooks/use-active-runtime-error'\n+\n+export function IssuesTab({\n+  debugInfo,\n+  runtimeErrors,\n+  getSquashedHydrationErrorDetails,\n+}: {\n+  debugInfo: DebugInfo\n+  runtimeErrors: ReadyRuntimeError[]\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n+}) {\n+  const { isLoading, errorCode, errorType, hydrationWarning, activeError } =\n+    useActiveRuntimeError({ runtimeErrors, getSquashedHydrationErrorDetails })\n+\n+  if (isLoading) {\n+    // TODO: better loading state\n+    return null\n+  }\n+\n+  if (!activeError) {\n+    return null\n+  }\n+\n+  const errorMessage = hydrationWarning ? (\n+    <HydrationErrorDescription message={hydrationWarning} />\n+  ) : (\n+    <GenericErrorDescription error={activeError.error} />\n+  )\n+\n+  return (\n+    <div data-nextjs-devtools-panel-tab-issues>\n+      {/* TODO: Sidebar */}\n+      <aside>Sidebar</aside>\n+      <div data-nextjs-devtools-panel-tab-issues-content>\n+        <div className=\"nextjs-container-errors-header\">\n+          <div\n+            className=\"nextjs__container_errors__error_title\"\n+            // allow assertion in tests before error rating is implemented\n+            data-nextjs-error-code={errorCode}\n+          >\n+            <span data-nextjs-error-label-group>\n+              <ErrorTypeLabel errorType={errorType} />\n+              {activeError.error.environmentName && (\n+                <EnvironmentNameLabel\n+                  environmentName={activeError.error.environmentName}\n+                />\n+              )}\n+            </span>\n+            <ErrorOverlayToolbar\n+              error={activeError.error}\n+              debugInfo={debugInfo}\n+            />\n+          </div>\n+          <ErrorMessage errorMessage={errorMessage} />\n+        </div>\n+\n+        {/* TODO: Content */}\n+        <div>Content</div>\n+      </div>\n+    </div>\n+  )\n+}\n+\n+export const DEVTOOLS_PANEL_TAB_ISSUES_STYLES = css`\n+  [data-nextjs-devtools-panel-tab-issues] {\n+    display: flex;\n+  }\n+`"
        },
        {
            "sha": "a1219170d068e470c7393b07973c0598b7ab85a5",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.stories.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -4,6 +4,7 @@ import type { OverlayState } from '../../shared'\n import { DevToolsPanel } from './devtools-panel'\n import { INITIAL_OVERLAY_STATE } from '../../shared'\n import { withShadowPortal } from '../../storybook/with-shadow-portal'\n+import { runtimeErrors } from '../../storybook/errors'\n \n const meta: Meta<typeof DevToolsPanel> = {\n   component: DevToolsPanel,\n@@ -34,6 +35,8 @@ export const Default: Story = {\n     state,\n     dispatch: () => {},\n     issueCount: 0,\n+    runtimeErrors: [],\n+    getSquashedHydrationErrorDetails: () => null,\n   },\n }\n \n@@ -42,6 +45,8 @@ export const WithIssues: Story = {\n     state,\n     dispatch: () => {},\n     issueCount: 3,\n+    runtimeErrors,\n+    getSquashedHydrationErrorDetails: () => null,\n   },\n }\n \n@@ -58,6 +63,8 @@ export const Turbopack: Story = {\n     state,\n     dispatch: () => {},\n     issueCount: 0,\n+    runtimeErrors: [],\n+    getSquashedHydrationErrorDetails: () => null,\n   },\n }\n \n@@ -74,5 +81,7 @@ export const Rspack: Story = {\n     state,\n     dispatch: () => {},\n     issueCount: 0,\n+    runtimeErrors: [],\n+    getSquashedHydrationErrorDetails: () => null,\n   },\n }"
        },
        {
            "sha": "3947ffde198b4e51ad595ecf4535c3a25bf0fa56",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.tsx",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -1,4 +1,6 @@\n import type { OverlayDispatch, OverlayState, Corners } from '../../shared'\n+import type { ReadyRuntimeError } from '../../utils/get-error-by-type'\n+import type { HydrationErrorState } from '../../../shared/hydration-error'\n \n import { useState } from 'react'\n \n@@ -26,10 +28,14 @@ export function DevToolsPanel({\n   state,\n   dispatch,\n   issueCount,\n+  runtimeErrors,\n+  getSquashedHydrationErrorDetails,\n }: {\n   state: OverlayState\n   dispatch: OverlayDispatch\n   issueCount: number\n+  runtimeErrors: ReadyRuntimeError[]\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n }) {\n   const [activeTab, setActiveTab] = useState<'issues' | 'route' | 'settings'>(\n     'settings'\n@@ -144,6 +150,11 @@ export function DevToolsPanel({\n                   scale={state.scale}\n                   handlePositionChange={handlePositionChange}\n                   handleScaleChange={handleScaleChange}\n+                  debugInfo={state.debugInfo}\n+                  runtimeErrors={runtimeErrors}\n+                  getSquashedHydrationErrorDetails={\n+                    getSquashedHydrationErrorDetails\n+                  }\n                 />\n               </DialogBody>\n             </DialogContent>\n@@ -156,6 +167,11 @@ export function DevToolsPanel({\n }\n \n export const DEVTOOLS_PANEL_STYLES = css`\n+  /* TODO: Better override dialog header style. This conflicts with issues tab content. */\n+  [data-nextjs-devtools-panel-dialog-header] {\n+    margin-bottom: 0 !important;\n+  }\n+\n   [data-nextjs-devtools-panel-overlay] {\n     padding: initial;\n     margin: auto;"
        },
        {
            "sha": "1bb681557a489b7115d87885d25256c47d154610",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/dialog/dialog-header.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog-header.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog-header.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog-header.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -1,19 +1,9 @@\n-import * as React from 'react'\n+export type DialogHeaderProps = React.HTMLAttributes<HTMLDivElement>\n \n-export type DialogHeaderProps = {\n-  children?: React.ReactNode\n-  className?: string\n-}\n-\n-const DialogHeader: React.FC<DialogHeaderProps> = function DialogHeader({\n-  children,\n-  className,\n-}) {\n+export function DialogHeader(props: DialogHeaderProps) {\n   return (\n-    <div data-nextjs-dialog-header className={className}>\n-      {children}\n+    <div data-nextjs-dialog-header {...props}>\n+      {props.children}\n     </div>\n   )\n }\n-\n-export { DialogHeader }"
        },
        {
            "sha": "556d225e4fa04d00dcdfc6fd9382d51d757e61cd",
            "filename": "packages/next/src/next-devtools/dev-overlay/container/errors.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -30,11 +30,11 @@ function isNextjsLink(text: string): boolean {\n   return text.startsWith('https://nextjs.org')\n }\n \n-function HydrationErrorDescription({ message }: { message: string }) {\n+export function HydrationErrorDescription({ message }: { message: string }) {\n   return <HotlinkedText text={message} matcher={isNextjsLink} />\n }\n \n-function GenericErrorDescription({ error }: { error: Error }) {\n+export function GenericErrorDescription({ error }: { error: Error }) {\n   const environmentName =\n     'environmentName' in error ? error.environmentName : ''\n   const envPrefix = environmentName ? `[ ${environmentName} ] ` : ''"
        },
        {
            "sha": "8c3d52226cb12bbd98faa629e3405c170c5697fd",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -54,6 +54,10 @@ export function DevOverlay({\n                         state={state}\n                         dispatch={dispatch}\n                         issueCount={totalErrorCount}\n+                        runtimeErrors={runtimeErrors}\n+                        getSquashedHydrationErrorDetails={\n+                          getSquashedHydrationErrorDetails\n+                        }\n                       />\n                     )}\n                   </>"
        },
        {
            "sha": "aad9a7e5fe20a2f7384e61c6d3439765ef49d15a",
            "filename": "packages/next/src/next-devtools/dev-overlay/styles/component-styles.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3797fb921b5a309c90ba5867da9e3fb1d3428b8b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx?ref=3797fb921b5a309c90ba5867da9e3fb1d3428b8b",
            "patch": "@@ -29,6 +29,7 @@ import { DEVTOOLS_PANEL_FOOTER_STYLES } from '../components/devtools-panel/devto\n import { DEVTOOLS_PANEL_VERSION_INFO_STYLES } from '../components/devtools-panel/devtools-panel-version-info'\n import { DEVTOOLS_PANEL_TAB_SETTINGS_STYLES } from '../components/devtools-panel/devtools-panel-tab/settings-tab'\n import { CALL_STACK_STYLES } from '../components/call-stack/call-stack'\n+import { DEVTOOLS_PANEL_TAB_ISSUES_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab'\n \n export function ComponentStyles() {\n   return (\n@@ -64,6 +65,7 @@ export function ComponentStyles() {\n         ${DEVTOOLS_PANEL_FOOTER_STYLES}\n         ${DEVTOOLS_PANEL_VERSION_INFO_STYLES}\n         ${DEVTOOLS_PANEL_TAB_SETTINGS_STYLES}\n+        ${DEVTOOLS_PANEL_TAB_ISSUES_STYLES}\n       `}\n     </style>\n   )"
        }
    ],
    "stats": {
        "total": 152,
        "additions": 135,
        "deletions": 17
    }
}