{
    "author": "bgw",
    "message": "Turbopack: Improve the description on InvalidLoaderRuleConditionIssue (#87008)\n\nIt's near-impossible to get this to error on the Rust side (issues are caught before we get here), but I hacked up the code to make it error. It looks like this:\n\n![Screenshot 2025-12-09 at 4.39.24â€¯PM.png](https://app.graphite.com/user-attachments/assets/796b5efa-b2e5-4a9c-bcf3-03cee0a0861d.png)",
    "sha": "ea927b583d24f42e538001bf13370e38c91d17bf",
    "files": [
        {
            "sha": "e7ca235b642b25e9d50da4d61e16d1e896984638",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 24,
            "deletions": 13,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/ea927b583d24f42e538001bf13370e38c91d17bf/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ea927b583d24f42e538001bf13370e38c91d17bf/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=ea927b583d24f42e538001bf13370e38c91d17bf",
            "patch": "@@ -1283,6 +1283,7 @@ impl Issue for InvalidLoaderRuleRenameAsIssue {\n \n #[turbo_tasks::value(shared)]\n struct InvalidLoaderRuleConditionIssue {\n+    error_string: RcStr,\n     condition: ConfigConditionItem,\n     config_file_path: FileSystemPath,\n }\n@@ -1307,7 +1308,15 @@ impl Issue for InvalidLoaderRuleConditionIssue {\n     #[turbo_tasks::function]\n     async fn description(&self) -> Result<Vc<OptionStyledString>> {\n         Ok(Vc::cell(Some(\n-            StyledString::Text(RcStr::from(format!(\"{:#?}\", self.condition))).resolved_cell(),\n+            StyledString::Stack(vec![\n+                StyledString::Line(vec![\n+                    StyledString::Text(rcstr!(\"Encountered the following error: \")),\n+                    StyledString::Code(self.error_string.clone()),\n+                ]),\n+                StyledString::Text(rcstr!(\"While processing the condition:\")),\n+                StyledString::Code(RcStr::from(format!(\"{:#?}\", self.condition))),\n+            ])\n+            .resolved_cell(),\n         )))\n     }\n \n@@ -1497,19 +1506,21 @@ impl NextConfig {\n                         // convert from Next.js-specific condition type to internal Turbopack\n                         // condition type\n                         let condition = if let Some(condition) = condition {\n-                            if let Ok(cond) = ConditionItem::try_from(condition.clone()) {\n-                                Some(cond)\n-                            } else {\n-                                InvalidLoaderRuleConditionIssue {\n-                                    condition: condition.clone(),\n-                                    config_file_path: self\n-                                        .config_file_path(project_path.clone())\n-                                        .owned()\n-                                        .await?,\n+                            match ConditionItem::try_from(condition.clone()) {\n+                                Ok(cond) => Some(cond),\n+                                Err(err) => {\n+                                    InvalidLoaderRuleConditionIssue {\n+                                        error_string: RcStr::from(err.to_string()),\n+                                        condition: condition.clone(),\n+                                        config_file_path: self\n+                                            .config_file_path(project_path.clone())\n+                                            .owned()\n+                                            .await?,\n+                                    }\n+                                    .resolved_cell()\n+                                    .emit();\n+                                    None\n                                 }\n-                                .resolved_cell()\n-                                .emit();\n-                                None\n                             }\n                         } else {\n                             None"
        },
        {
            "sha": "7143efc0dba0d5f4b6824912951a77ab9b492ee3",
            "filename": "examples/basic-css/next.config.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/ea927b583d24f42e538001bf13370e38c91d17bf/examples%2Fbasic-css%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ea927b583d24f42e538001bf13370e38c91d17bf/examples%2Fbasic-css%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fbasic-css%2Fnext.config.js?ref=ea927b583d24f42e538001bf13370e38c91d17bf",
            "patch": "@@ -0,0 +1,13 @@\n+module.exports = {\n+  turbopack: {\n+    rules: {\n+      \"*.svg\": {\n+        loaders: [\"@svgr/webpack\"],\n+        as: \"*.js\",\n+        condition: {\n+          path: /abc/,\n+        },\n+      },\n+    },\n+  },\n+};"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 37,
        "deletions": 13
    }
}