{
    "author": "eps1lon",
    "message": "[dev-overlay] Remove unused code (#80279)\n\nBest reviewed without whitespace changes.",
    "sha": "ed032b4a2140d74a40b0f71ea331ee45d31c4475",
    "files": [
        {
            "sha": "3854db35535d608bd8ac3dc61b44247bca0895cf",
            "filename": "packages/next/src/client/components/errors/hydration-error-info.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 39,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/f63088d2d1aacc23b0ea0baf4a50f55c71916231/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f63088d2d1aacc23b0ea0baf4a50f55c71916231/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts?ref=f63088d2d1aacc23b0ea0baf4a50f55c71916231",
            "patch": "@@ -1,39 +0,0 @@\n-type NullableText = string | null | undefined\n-\n-// https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\n-const htmlTagsWarnings = new Set([\n-  'Warning: In HTML, %s cannot be a child of <%s>.%s\\nThis will cause a hydration error.%s',\n-  'Warning: In HTML, %s cannot be a descendant of <%s>.\\nThis will cause a hydration error.%s',\n-  'Warning: In HTML, text nodes cannot be a child of <%s>.\\nThis will cause a hydration error.',\n-  \"Warning: In HTML, whitespace text nodes cannot be a child of <%s>. Make sure you don't have any extra whitespace between tags on each line of your source code.\\nThis will cause a hydration error.\",\n-  'Warning: Expected server HTML to contain a matching <%s> in <%s>.%s',\n-  'Warning: Did not expect server HTML to contain a <%s> in <%s>.%s',\n-])\n-const textAndTagsMismatchWarnings = new Set([\n-  'Warning: Expected server HTML to contain a matching text node for \"%s\" in <%s>.%s',\n-  'Warning: Did not expect server HTML to contain the text node \"%s\" in <%s>.%s',\n-])\n-\n-export const getHydrationWarningType = (\n-  message: NullableText\n-): 'tag' | 'text' | 'text-in-tag' => {\n-  if (typeof message !== 'string') {\n-    // TODO: Doesn't make sense to treat no message as a hydration error message.\n-    // We should bail out somewhere earlier.\n-    return 'text'\n-  }\n-\n-  const normalizedMessage = message.startsWith('Warning: ')\n-    ? message\n-    : `Warning: ${message}`\n-\n-  if (isHtmlTagsWarning(normalizedMessage)) return 'tag'\n-  if (isTextInTagsMismatchWarning(normalizedMessage)) return 'text-in-tag'\n-\n-  return 'text'\n-}\n-\n-const isHtmlTagsWarning = (message: string) => htmlTagsWarnings.has(message)\n-\n-const isTextInTagsMismatchWarning = (msg: string) =>\n-  textAndTagsMismatchWarnings.has(msg)"
        },
        {
            "sha": "47835b047b0638be1170c4308130e84e699c3bbf",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/bus.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/f63088d2d1aacc23b0ea0baf4a50f55c71916231/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fbus.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f63088d2d1aacc23b0ea0baf4a50f55c71916231/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fbus.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fbus.ts?ref=f63088d2d1aacc23b0ea0baf4a50f55c71916231",
            "patch": "@@ -1,47 +0,0 @@\n-import type { BusEvent } from '../shared'\n-\n-export type BusEventHandler = (ev: BusEvent) => void\n-\n-let handlers: Set<BusEventHandler> = new Set()\n-let queue: BusEvent[] = []\n-\n-function drain() {\n-  // Draining should never happen synchronously in case multiple handlers are\n-  // registered.\n-  setTimeout(function () {\n-    while (\n-      // Until we are out of events:\n-      Boolean(queue.length) &&\n-      // Or, if all handlers removed themselves as a result of handling the\n-      // event(s)\n-      Boolean(handlers.size)\n-    ) {\n-      const ev = queue.shift()!\n-      handlers.forEach((handler) => handler(ev))\n-    }\n-  }, 1)\n-}\n-\n-export function emit(ev: BusEvent): void {\n-  queue.push(Object.freeze({ ...ev }))\n-  drain()\n-}\n-\n-export function on(fn: BusEventHandler): boolean {\n-  if (handlers.has(fn)) {\n-    return false\n-  }\n-\n-  handlers.add(fn)\n-  drain()\n-  return true\n-}\n-\n-export function off(fn: BusEventHandler): boolean {\n-  if (handlers.has(fn)) {\n-    handlers.delete(fn)\n-    return true\n-  }\n-\n-  return false\n-}"
        },
        {
            "sha": "4a1a5216ab5bab550e48f2e8b1aa82c53c39d3d3",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 96,
            "deletions": 93,
            "changes": 189,
            "blob_url": "https://github.com/vercel/next.js/blob/ed032b4a2140d74a40b0f71ea331ee45d31c4475/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ed032b4a2140d74a40b0f71ea331ee45d31c4475/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=ed032b4a2140d74a40b0f71ea331ee45d31c4475",
            "patch": "@@ -30,7 +30,7 @@ export interface OverlayState {\n   routerType: 'pages' | 'app'\n   isErrorOverlayOpen: boolean\n }\n-export type OverlayDispatch = React.Dispatch<BusEvent>\n+export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n \n export const ACTION_STATIC_INDICATOR = 'static-indicator'\n export const ACTION_BUILD_OK = 'build-ok'\n@@ -121,7 +121,7 @@ export interface RenderingIndicatorHideAction {\n   type: typeof ACTION_RENDERING_INDICATOR_HIDE\n }\n \n-export type BusEvent =\n+export type DispatcherEvent =\n   | BuildOkAction\n   | BuildErrorAction\n   | BeforeFastRefreshAction\n@@ -240,107 +240,110 @@ export function useErrorOverlayReducer(\n     return events\n   }\n \n-  return useReducer((state: OverlayState, action: BusEvent): OverlayState => {\n-    switch (action.type) {\n-      case ACTION_DEBUG_INFO: {\n-        return { ...state, debugInfo: action.debugInfo }\n-      }\n-      case ACTION_STATIC_INDICATOR: {\n-        return { ...state, staticIndicator: action.staticIndicator }\n-      }\n-      case ACTION_BUILD_OK: {\n-        return { ...state, buildError: null }\n-      }\n-      case ACTION_BUILD_ERROR: {\n-        return { ...state, buildError: action.message }\n-      }\n-      case ACTION_BEFORE_REFRESH: {\n-        return { ...state, refreshState: { type: 'pending', errors: [] } }\n-      }\n-      case ACTION_REFRESH: {\n-        return {\n-          ...state,\n-          buildError: null,\n-          errors:\n-            // Errors can come in during updates. In this case, UNHANDLED_ERROR\n-            // and UNHANDLED_REJECTION events might be dispatched between the\n-            // BEFORE_REFRESH and the REFRESH event. We want to keep those errors\n-            // around until the next refresh. Otherwise we run into a race\n-            // condition where those errors would be cleared on refresh completion\n-            // before they can be displayed.\n-            state.refreshState.type === 'pending'\n-              ? state.refreshState.errors\n-              : [],\n-          refreshState: { type: 'idle' },\n+  return useReducer(\n+    (state: OverlayState, action: DispatcherEvent): OverlayState => {\n+      switch (action.type) {\n+        case ACTION_DEBUG_INFO: {\n+          return { ...state, debugInfo: action.debugInfo }\n         }\n-      }\n-      case ACTION_UNHANDLED_ERROR:\n-      case ACTION_UNHANDLED_REJECTION: {\n-        switch (state.refreshState.type) {\n-          case 'idle': {\n-            return {\n-              ...state,\n-              nextId: state.nextId + 1,\n-              errors: pushErrorFilterDuplicates(\n-                state.errors,\n-                state.nextId,\n-                action.reason\n-              ),\n-            }\n+        case ACTION_STATIC_INDICATOR: {\n+          return { ...state, staticIndicator: action.staticIndicator }\n+        }\n+        case ACTION_BUILD_OK: {\n+          return { ...state, buildError: null }\n+        }\n+        case ACTION_BUILD_ERROR: {\n+          return { ...state, buildError: action.message }\n+        }\n+        case ACTION_BEFORE_REFRESH: {\n+          return { ...state, refreshState: { type: 'pending', errors: [] } }\n+        }\n+        case ACTION_REFRESH: {\n+          return {\n+            ...state,\n+            buildError: null,\n+            errors:\n+              // Errors can come in during updates. In this case, UNHANDLED_ERROR\n+              // and UNHANDLED_REJECTION events might be dispatched between the\n+              // BEFORE_REFRESH and the REFRESH event. We want to keep those errors\n+              // around until the next refresh. Otherwise we run into a race\n+              // condition where those errors would be cleared on refresh completion\n+              // before they can be displayed.\n+              state.refreshState.type === 'pending'\n+                ? state.refreshState.errors\n+                : [],\n+            refreshState: { type: 'idle' },\n           }\n-          case 'pending': {\n-            return {\n-              ...state,\n-              nextId: state.nextId + 1,\n-              refreshState: {\n-                ...state.refreshState,\n+        }\n+        case ACTION_UNHANDLED_ERROR:\n+        case ACTION_UNHANDLED_REJECTION: {\n+          switch (state.refreshState.type) {\n+            case 'idle': {\n+              return {\n+                ...state,\n+                nextId: state.nextId + 1,\n                 errors: pushErrorFilterDuplicates(\n                   state.errors,\n                   state.nextId,\n                   action.reason\n                 ),\n-              },\n+              }\n+            }\n+            case 'pending': {\n+              return {\n+                ...state,\n+                nextId: state.nextId + 1,\n+                refreshState: {\n+                  ...state.refreshState,\n+                  errors: pushErrorFilterDuplicates(\n+                    state.errors,\n+                    state.nextId,\n+                    action.reason\n+                  ),\n+                },\n+              }\n             }\n+            default:\n+              return state\n           }\n-          default:\n-            return state\n         }\n-      }\n-      case ACTION_VERSION_INFO: {\n-        return { ...state, versionInfo: action.versionInfo }\n-      }\n-      case ACTION_DEV_INDICATOR: {\n-        return {\n-          ...state,\n-          showIndicator: true,\n-          disableDevIndicator:\n-            shouldDisableDevIndicator || !!action.devIndicator.disabledUntil,\n+        case ACTION_VERSION_INFO: {\n+          return { ...state, versionInfo: action.versionInfo }\n+        }\n+        case ACTION_DEV_INDICATOR: {\n+          return {\n+            ...state,\n+            showIndicator: true,\n+            disableDevIndicator:\n+              shouldDisableDevIndicator || !!action.devIndicator.disabledUntil,\n+          }\n+        }\n+        case ACTION_ERROR_OVERLAY_OPEN: {\n+          return { ...state, isErrorOverlayOpen: true }\n+        }\n+        case ACTION_ERROR_OVERLAY_CLOSE: {\n+          return { ...state, isErrorOverlayOpen: false }\n+        }\n+        case ACTION_ERROR_OVERLAY_TOGGLE: {\n+          return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n+        }\n+        case ACTION_BUILDING_INDICATOR_SHOW: {\n+          return { ...state, buildingIndicator: true }\n+        }\n+        case ACTION_BUILDING_INDICATOR_HIDE: {\n+          return { ...state, buildingIndicator: false }\n+        }\n+        case ACTION_RENDERING_INDICATOR_SHOW: {\n+          return { ...state, renderingIndicator: true }\n+        }\n+        case ACTION_RENDERING_INDICATOR_HIDE: {\n+          return { ...state, renderingIndicator: false }\n+        }\n+        default: {\n+          return state\n         }\n       }\n-      case ACTION_ERROR_OVERLAY_OPEN: {\n-        return { ...state, isErrorOverlayOpen: true }\n-      }\n-      case ACTION_ERROR_OVERLAY_CLOSE: {\n-        return { ...state, isErrorOverlayOpen: false }\n-      }\n-      case ACTION_ERROR_OVERLAY_TOGGLE: {\n-        return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n-      }\n-      case ACTION_BUILDING_INDICATOR_SHOW: {\n-        return { ...state, buildingIndicator: true }\n-      }\n-      case ACTION_BUILDING_INDICATOR_HIDE: {\n-        return { ...state, buildingIndicator: false }\n-      }\n-      case ACTION_RENDERING_INDICATOR_SHOW: {\n-        return { ...state, renderingIndicator: true }\n-      }\n-      case ACTION_RENDERING_INDICATOR_HIDE: {\n-        return { ...state, renderingIndicator: false }\n-      }\n-      default: {\n-        return state\n-      }\n-    }\n-  }, getInitialState(routerType))\n+    },\n+    getInitialState(routerType)\n+  )\n }"
        },
        {
            "sha": "379b8282d08d7c531c73fb3e457bd149c10b0c1b",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 20,
            "deletions": 17,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/ed032b4a2140d74a40b0f71ea331ee45d31c4475/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ed032b4a2140d74a40b0f71ea331ee45d31c4475/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=ed032b4a2140d74a40b0f71ea331ee45d31c4475",
            "patch": "@@ -1,5 +1,5 @@\n import type { Meta, StoryObj } from '@storybook/react'\n-import type { BusEvent, OverlayState } from '../shared'\n+import type { DispatcherEvent, OverlayState } from '../shared'\n \n // @ts-expect-error\n import imgApp from './app.png'\n@@ -97,23 +97,26 @@ const initialState: OverlayState = {\n }\n \n function useOverlayReducer() {\n-  return useReducer<OverlayState, [BusEvent]>((state, action): OverlayState => {\n-    switch (action.type) {\n-      case ACTION_ERROR_OVERLAY_CLOSE: {\n-        return { ...state, isErrorOverlayOpen: false }\n+  return useReducer<OverlayState, [DispatcherEvent]>(\n+    (state, action): OverlayState => {\n+      switch (action.type) {\n+        case ACTION_ERROR_OVERLAY_CLOSE: {\n+          return { ...state, isErrorOverlayOpen: false }\n+        }\n+        case ACTION_ERROR_OVERLAY_OPEN: {\n+          return { ...state, isErrorOverlayOpen: true }\n+        }\n+        case ACTION_ERROR_OVERLAY_TOGGLE: {\n+          return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n+        }\n+        default: {\n+          return state\n+        }\n       }\n-      case ACTION_ERROR_OVERLAY_OPEN: {\n-        return { ...state, isErrorOverlayOpen: true }\n-      }\n-      case ACTION_ERROR_OVERLAY_TOGGLE: {\n-        return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n-      }\n-      default: {\n-        return state\n-      }\n-    }\n-    return state\n-  }, initialState)\n+      return state\n+    },\n+    initialState\n+  )\n }\n \n function getNoSquashedHydrationErrorDetails() {"
        }
    ],
    "stats": {
        "total": 312,
        "additions": 116,
        "deletions": 196
    }
}