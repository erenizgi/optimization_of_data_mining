{
    "author": "SyMind",
    "message": "feat: Rspack support config.experimental.useLightningcss to switch css-minimizer-plugin (#79928)\n\nRspack support config.experimental.useLightningcss to switch\ncss-minimizer-plugin.\n\nRspack using LightningCssMinimizerRspackPlugin by default.\n\nIf users encounter some CSS issues, they can switch back to the\ncss-minimizer-plugin through `config.experimental.useLightningcss:\nfalse`.\n\nIn test mode, Rspack uses css-minimizer-plugin for compatibility.",
    "sha": "074d288a55165c7ec227c868a2d05252a95f7cf0",
    "files": [
        {
            "sha": "f926db0e93582c738b09a4b94020f45ece3880d0",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 17,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/074d288a55165c7ec227c868a2d05252a95f7cf0/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/074d288a55165c7ec227c868a2d05252a95f7cf0/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=074d288a55165c7ec227c868a2d05252a95f7cf0",
            "patch": "@@ -1196,9 +1196,10 @@ export default async function getBaseWebpackConfig(\n         (isClient ||\n           isEdgeServer ||\n           (isNodeServer && config.experimental.serverMinification)),\n-      minimizer: isRspack\n-        ? [\n-            new (getRspackCore().SwcJsMinimizerRspackPlugin)({\n+      minimizer: [\n+        // Minify JavaScript\n+        isRspack\n+          ? new (getRspackCore().SwcJsMinimizerRspackPlugin)({\n               // JS minimizer configuration\n               // options should align with crates/napi/src/minify.rs#patch_opts\n               minimizerOptions: {\n@@ -1213,17 +1214,8 @@ export default async function getBaseWebpackConfig(\n                   disableCharFreq: !isClient,\n                 },\n               },\n-            }),\n-            new (getRspackCore().LightningCssMinimizerRspackPlugin)({\n-              // CSS minimizer configuration\n-              minimizerOptions: {\n-                targets: supportedBrowsers,\n-              },\n-            }),\n-          ]\n-        : [\n-            // Minify JavaScript\n-            (compiler: webpack.Compiler) => {\n+            })\n+          : (compiler: webpack.Compiler) => {\n               // @ts-ignore No typings yet\n               const { MinifyPlugin } =\n                 require('./webpack/plugins/minify-webpack-plugin/src/index.js') as typeof import('./webpack/plugins/minify-webpack-plugin/src')\n@@ -1232,8 +1224,21 @@ export default async function getBaseWebpackConfig(\n                 disableCharFreq: !isClient,\n               }).apply(compiler)\n             },\n-            // Minify CSS\n-            (compiler: webpack.Compiler) => {\n+        // Minify CSS\n+        // By default, Rspack uses LightningCSS for CSS minification.\n+        // Rspack uses css-minimizer-plugin by default for compatibility.\n+        isRspack &&\n+        (process.env.__NEXT_TEST_MODE\n+          ? config.experimental.useLightningcss\n+          : config.experimental?.useLightningcss === undefined ||\n+            config.experimental.useLightningcss)\n+          ? new (getRspackCore().LightningCssMinimizerRspackPlugin)({\n+              // CSS minimizer configuration\n+              minimizerOptions: {\n+                targets: supportedBrowsers,\n+              },\n+            })\n+          : (compiler: webpack.Compiler) => {\n               const {\n                 CssMinimizerPlugin,\n               } = require('./webpack/plugins/css-minimizer-plugin')\n@@ -1250,7 +1255,7 @@ export default async function getBaseWebpackConfig(\n                 },\n               }).apply(compiler)\n             },\n-          ],\n+      ],\n     },\n     context: dir,\n     // Kept as function to be backwards compatible"
        },
        {
            "sha": "a6442592f5a41deabbaab1f57fb4b97a44416bfe",
            "filename": "test/integration/css-minify/test/index.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/074d288a55165c7ec227c868a2d05252a95f7cf0/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/074d288a55165c7ec227c868a2d05252a95f7cf0/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js?ref=074d288a55165c7ec227c868a2d05252a95f7cf0",
            "patch": "@@ -20,7 +20,7 @@ function runTests() {\n     const $ = cheerio.load(html)\n     const href = $('link[rel=\"preload\"]').attr('href')\n     const css = await renderViaHTTP(appPort, href)\n-    if (process.env.IS_TURBOPACK_TEST || process.env.NEXT_RSPACK) {\n+    if (process.env.IS_TURBOPACK_TEST) {\n       expect(css).toContain(\n         '.a{--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:-50%}'\n       )"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 23,
        "deletions": 18
    }
}