{
    "author": "wyattjoh",
    "message": "test: migrate manifest tests to snapshot testing with normalizeManifest utility (#82675)",
    "sha": "b3e9fb9de2920b41d5386d482cf951126e3c52d4",
    "files": [
        {
            "sha": "541fdd646fd2d74222b3c40af0458408a407bc02",
            "filename": "test/integration/custom-routes/test/index.test.js",
            "status": "modified",
            "additions": 1004,
            "deletions": 1078,
            "changes": 2082,
            "blob_url": "https://github.com/vercel/next.js/blob/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.js?ref=b3e9fb9de2920b41d5386d482cf951126e3c52d4",
            "patch": "@@ -8,7 +8,6 @@ import { join } from 'path'\n import WebSocket from 'ws'\n import cheerio from 'cheerio'\n import webdriver from 'next-webdriver'\n-import escapeRegex from 'escape-string-regexp'\n import {\n   assertNoRedbox,\n   launchApp,\n@@ -23,6 +22,7 @@ import {\n   waitFor,\n   normalizeRegEx,\n   check,\n+  normalizeManifest,\n } from 'next-test-utils'\n \n let appDir = join(__dirname, '..')\n@@ -1495,1083 +1495,1009 @@ const runTests = (isDev = false) => {\n         route.dataRouteRegex = normalizeRegEx(route.dataRouteRegex)\n       }\n \n-      expect(manifest).toEqual({\n-        version: 3,\n-        pages404: true,\n-        caseSensitive: true,\n-        basePath: '',\n-        dataRoutes: [\n-          {\n-            dataRouteRegex: normalizeRegEx(\n-              `^/_next/data/${escapeRegex(\n-                buildId\n-              )}/blog\\\\-catchall/(.+?)\\\\.json$`\n-            ),\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/blog\\\\-catchall/(?<nxtPslug>.+?)\\\\.json$`,\n-            page: '/blog-catchall/[...slug]',\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-              buildId\n-            )}\\\\/overridden\\\\/([^\\\\/]+?)\\\\.json$`,\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/overridden/(?<nxtPslug>[^/]+?)\\\\.json$`,\n-            page: '/overridden/[slug]',\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-        ],\n-        redirects: [\n-          {\n-            destination: '/:path+',\n-            regex: normalizeRegEx(\n-              '^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))\\\\/$'\n-            ),\n-            source: '/:path+/',\n-            statusCode: 308,\n-            internal: true,\n-          },\n-          {\n-            destination: '/with-params',\n-            missing: [\n-              {\n-                key: 'x-my-header',\n-                type: 'header',\n-                value: '(?<myHeader>.*)',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/missing-redirect-1(?:\\\\/)?$'\n-            ),\n-            source: '/missing-redirect-1',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/with-params',\n-            missing: [\n-              {\n-                key: 'my-query',\n-                type: 'query',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/missing-redirect-2(?:\\\\/)?$'\n-            ),\n-            source: '/missing-redirect-2',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/with-params?authorized=1',\n-            missing: [\n-              {\n-                key: 'loggedIn',\n-                type: 'cookie',\n-                value: '(?<loggedIn>true)',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/missing-redirect-3(?:\\\\/)?$'\n-            ),\n-            source: '/missing-redirect-3',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/:lang/about',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/redirect\\\\/me\\\\/to-about(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-            ),\n-            source: '/redirect/me/to-about/:lang',\n-            statusCode: 307,\n-          },\n-          {\n-            source: '/docs/router-status/:code',\n-            destination: '/docs/v2/network/status-codes#:code',\n-            statusCode: 301,\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/docs\\\\/router-status(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-            ),\n-          },\n-          {\n-            source: '/docs/github',\n-            destination: '/docs/v2/advanced/now-for-github',\n-            statusCode: 301,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/docs\\\\/github(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/docs/v2/advanced/:all(.*)',\n-            destination: '/docs/v2/more/:all',\n-            statusCode: 301,\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/docs\\\\/v2\\\\/advanced(?:\\\\/(.*))(?:\\\\/)?$'\n-            ),\n-          },\n-          {\n-            source: '/hello/:id/another',\n-            destination: '/blog/:id',\n-            statusCode: 307,\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/hello(?:\\\\/([^\\\\/]+?))\\\\/another(?:\\\\/)?$'\n-            ),\n-          },\n-          {\n-            source: '/redirect1',\n-            destination: '/',\n-            statusCode: 307,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect1(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redirect2',\n-            destination: '/',\n-            statusCode: 301,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect2(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redirect3',\n-            destination: '/another',\n-            statusCode: 302,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect3(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redirect4',\n-            destination: '/',\n-            statusCode: 308,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect4(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redir-chain1',\n-            destination: '/redir-chain2',\n-            statusCode: 301,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain1(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redir-chain2',\n-            destination: '/redir-chain3',\n-            statusCode: 302,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain2(?:\\\\/)?$'),\n-          },\n-          {\n-            source: '/redir-chain3',\n-            destination: '/',\n-            statusCode: 303,\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redir-chain3(?:\\\\/)?$'),\n-          },\n-          {\n-            destination: 'https://google.com',\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/to-external(?:\\\\/)?$'),\n-            source: '/to-external',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/with-params?first=:section&second=:name',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/query-redirect(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-            ),\n-            source: '/query-redirect/:section/:name',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/got-unnamed',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/unnamed(?:\\\\/(first|second))(?:\\\\/(.*))(?:\\\\/)?$'\n-            ),\n-            source: '/unnamed/(first|second)/(.*)',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/:0',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/named-like-unnamed(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-            ),\n-            source: '/named-like-unnamed/:0',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/thank-you-next',\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/redirect-override(?:\\\\/)?$'),\n-            source: '/redirect-override',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/:first/:second',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/docs(?:\\\\/(integrations|now-cli))\\\\/v2(.*)(?:\\\\/)?$'\n-            ),\n-            source: '/docs/:first(integrations|now-cli)/v2:second(.*)',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/somewhere',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/catchall-redirect(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-            ),\n-            source: '/catchall-redirect/:path*',\n-            statusCode: 307,\n-          },\n-          {\n-            destination:\n-              'https://authserver.example.com/set-password?returnUrl=https%3A%2F%2Fwww.example.com/login',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/to-external-with-query(?:\\\\/)?$'\n-            ),\n-            source: '/to-external-with-query',\n-            statusCode: 307,\n-          },\n-          {\n-            destination:\n-              'https://authserver.example.com/set-password?returnUrl=https://www.example.com/login',\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)\\\\/to-external-with-query-2(?:\\\\/)?$'\n-            ),\n-            source: '/to-external-with-query-2',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/another?myHeader=:myHeader',\n-            has: [\n-              {\n-                key: 'x-my-header',\n-                type: 'header',\n-                value: '(?<myHeader>.*)',\n-              },\n-            ],\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-1(?:\\\\/)?$'),\n-            source: '/has-redirect-1',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/another?value=:myquery',\n-            has: [\n-              {\n-                key: 'my-query',\n-                type: 'query',\n-              },\n-            ],\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-2(?:\\\\/)?$'),\n-            source: '/has-redirect-2',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/another?authorized=1',\n-            has: [\n-              {\n-                key: 'loggedIn',\n-                type: 'cookie',\n-                value: 'true',\n-              },\n-            ],\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-3(?:\\\\/)?$'),\n-            source: '/has-redirect-3',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/another?host=1',\n-            has: [\n-              {\n-                type: 'host',\n-                value: 'example.com',\n-              },\n-            ],\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-4(?:\\\\/)?$'),\n-            source: '/has-redirect-4',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: '/somewhere',\n-            has: [\n-              {\n-                key: 'x-test-next',\n-                type: 'header',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^(?!\\\\/_next)(?:\\\\/([^\\\\/]+?))\\\\/has-redirect-5(?:\\\\/)?$'\n-            ),\n-            source: '/:path/has-redirect-5',\n-            statusCode: 307,\n-          },\n-          {\n-            destination: 'https://:subdomain.example.com/some-path/end?a=b',\n-            has: [\n-              {\n-                type: 'host',\n-                value: '(?<subdomain>.*)-test.example.com',\n-              },\n-            ],\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-6(?:\\\\/)?$'),\n-            source: '/has-redirect-6',\n-            statusCode: 307,\n-          },\n-          {\n-            source: '/has-redirect-7',\n-            regex: normalizeRegEx('^(?!\\\\/_next)\\\\/has-redirect-7(?:\\\\/)?$'),\n-            has: [\n-              {\n-                type: 'query',\n-                key: 'hello',\n-                value: '(?<hello>.*)',\n-              },\n-            ],\n-            destination: '/somewhere?value=:hello',\n-            statusCode: 307,\n-          },\n-        ],\n-        headers: [\n-          {\n-            headers: [\n-              {\n-                key: 'x-new-header',\n-                value: 'new-value',\n-              },\n-            ],\n-            missing: [\n-              {\n-                key: 'x-my-header',\n-                type: 'header',\n-                value: '(?<myHeader>.*)',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/missing-headers-1(?:\\\\/)?$'),\n-            source: '/missing-headers-1',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-new-header',\n-                value: 'new-value',\n-              },\n-            ],\n-            missing: [\n-              {\n-                key: 'my-query',\n-                type: 'query',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/missing-headers-2(?:\\\\/)?$'),\n-            source: '/missing-headers-2',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-new-header',\n-                value: 'new-value',\n-              },\n-            ],\n-            missing: [\n-              {\n-                key: 'loggedIn',\n-                type: 'cookie',\n-                value: '(?<loggedIn>true)',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/missing-headers-3(?:\\\\/)?$'),\n-            source: '/missing-headers-3',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-custom-header',\n-                value: 'hello world',\n-              },\n-              {\n-                key: 'x-another-header',\n-                value: 'hello again',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/add-header(?:\\\\/)?$'),\n-            source: '/add-header',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-first-header',\n-                value: 'first',\n-              },\n-              {\n-                key: 'x-second-header',\n-                value: 'second',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/my-headers(?:\\\\/(.*))(?:\\\\/)?$'),\n-            source: '/my-headers/(.*)',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-path',\n-                value: ':path',\n-              },\n-              {\n-                key: 'some:path',\n-                value: 'hi',\n-              },\n-              {\n-                key: 'x-test',\n-                value: 'some:value*',\n-              },\n-              {\n-                key: 'x-test-2',\n-                value: 'value*',\n-              },\n-              {\n-                key: 'x-test-3',\n-                value: ':value?',\n-              },\n-              {\n-                key: 'x-test-4',\n-                value: ':value+',\n-              },\n-              {\n-                key: 'x-test-5',\n-                value: 'something https:',\n-              },\n-              {\n-                key: 'x-test-6',\n-                value: ':hello(world)',\n-              },\n-              {\n-                key: 'x-test-7',\n-                value: 'hello(world)',\n-              },\n-              {\n-                key: 'x-test-8',\n-                value: 'hello{1,}',\n-              },\n-              {\n-                key: 'x-test-9',\n-                value: ':hello{1,2}',\n-              },\n-              {\n-                key: 'content-security-policy',\n-                value:\n-                  \"default-src 'self'; img-src *; media-src media1.com media2.com; script-src userscripts.example.com/:path\",\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^\\\\/my-other-header(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-            ),\n-            source: '/my-other-header/:path',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-origin',\n-                value: 'https://example.com',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/without-params\\\\/url(?:\\\\/)?$'),\n-            source: '/without-params/url',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-url',\n-                value: 'https://example.com/:path*',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^\\\\/with-params\\\\/url(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-            ),\n-            source: '/with-params/url/:path*',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-url',\n-                value: 'https://example.com:8080?hello=:path*',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^\\\\/with-params\\\\/url2(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-            ),\n-            source: '/with-params/url2/:path*',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-something',\n-                value: 'applied-everywhere',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-            ),\n-            source: '/:path*',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-something',\n-                value: 'value=:path',\n-              },\n-              {\n-                key: 'path-:path',\n-                value: 'end',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/named-pattern(?:\\\\/(.*))(?:\\\\/)?$'),\n-            source: '/named-pattern/:path(.*)',\n-          },\n-          {\n-            headers: [\n-              {\n-                key: 'x-value',\n-                value: ':path*',\n-              },\n-            ],\n-            regex: normalizeRegEx(\n-              '^\\\\/catchall-header(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-            ),\n-            source: '/catchall-header/:path*',\n-          },\n-          {\n-            has: [\n-              {\n-                key: 'x-my-header',\n-                type: 'header',\n-                value: '(?<myHeader>.*)',\n-              },\n-            ],\n-            headers: [\n-              {\n-                key: 'x-another',\n-                value: 'header',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/has-header-1(?:\\\\/)?$'),\n-            source: '/has-header-1',\n-          },\n-          {\n-            has: [\n-              {\n-                key: 'my-query',\n-                type: 'query',\n-              },\n-            ],\n-            headers: [\n-              {\n-                key: 'x-added',\n-                value: 'value',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/has-header-2(?:\\\\/)?$'),\n-            source: '/has-header-2',\n-          },\n-          {\n-            has: [\n-              {\n-                key: 'loggedIn',\n-                type: 'cookie',\n-                value: 'true',\n-              },\n-            ],\n-            headers: [\n-              {\n-                key: 'x-is-user',\n-                value: 'yuuuup',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/has-header-3(?:\\\\/)?$'),\n-            source: '/has-header-3',\n-          },\n-          {\n-            has: [\n-              {\n-                type: 'host',\n-                value: 'example.com',\n-              },\n-            ],\n-            headers: [\n-              {\n-                key: 'x-is-host',\n-                value: 'yuuuup',\n-              },\n-            ],\n-            regex: normalizeRegEx('^\\\\/has-header-4(?:\\\\/)?$'),\n-            source: '/has-header-4',\n-          },\n-        ],\n-        rewriteHeaders: {\n-          pathHeader: 'x-nextjs-rewritten-path',\n-          queryHeader: 'x-nextjs-rewritten-query',\n-        },\n-        rewrites: {\n-          beforeFiles: [\n-            {\n-              destination: '/with-params?overridden=1',\n-              has: [\n-                {\n-                  key: 'overrideMe',\n-                  type: 'query',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/hello(?:\\\\/)?$'),\n-              source: '/hello',\n-            },\n-            {\n-              destination: '/blog/:path*',\n-              regex: normalizeRegEx(\n-                '^\\\\/old-blog(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/old-blog/:path*',\n-            },\n-            {\n-              destination: 'https://example.vercel.sh',\n-              regex: normalizeRegEx('^\\\\/overridden(?:\\\\/)?$'),\n-              source: '/overridden',\n-            },\n-            {\n-              destination: '/_sport/nfl/:path*',\n-              regex: normalizeRegEx(\n-                '^\\\\/nfl(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/nfl/:path*',\n-            },\n-          ],\n-          afterFiles: [\n-            {\n-              destination: `http://localhost:${externalServerPort}/_next/webpack-hmr?page=/about`,\n-              regex: normalizeRegEx('^\\\\/to-websocket(?:\\\\/)?$'),\n-              source: '/to-websocket',\n-            },\n-            {\n-              destination: '/hello',\n-              regex: normalizeRegEx('^\\\\/websocket-to-page(?:\\\\/)?$'),\n-              source: '/websocket-to-page',\n-            },\n-            {\n-              destination: 'http://localhost:12233',\n-              regex: normalizeRegEx('^\\\\/to-nowhere(?:\\\\/)?$'),\n-              source: '/to-nowhere',\n-            },\n-            {\n-              destination: '/auto-export/hello?rewrite=1',\n-              regex: normalizeRegEx('^\\\\/rewriting-to-auto-export(?:\\\\/)?$'),\n-              source: '/rewriting-to-auto-export',\n-            },\n-            {\n-              destination: '/auto-export/another?rewrite=1',\n-              regex: normalizeRegEx(\n-                '^\\\\/rewriting-to-another-auto-export(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/rewriting-to-another-auto-export/:path*',\n-            },\n-            {\n-              destination: '/another/one',\n-              regex: normalizeRegEx('^\\\\/to-another(?:\\\\/)?$'),\n-              source: '/to-another',\n-            },\n-            {\n-              destination: '/404',\n-              regex: normalizeRegEx('^\\\\/nav(?:\\\\/)?$'),\n-              source: '/nav',\n-            },\n-            {\n-              source: '/hello-world',\n-              destination: '/static/hello.txt',\n-              regex: normalizeRegEx('^\\\\/hello-world(?:\\\\/)?$'),\n-            },\n-            {\n-              source: '/',\n-              destination: '/another',\n-              regex: normalizeRegEx('^\\\\/(?:\\\\/)?$'),\n-            },\n-            {\n-              source: '/another',\n-              destination: '/multi-rewrites',\n-              regex: normalizeRegEx('^\\\\/another(?:\\\\/)?$'),\n-            },\n-            {\n-              source: '/first',\n-              destination: '/hello',\n-              regex: normalizeRegEx('^\\\\/first(?:\\\\/)?$'),\n-            },\n-            {\n-              source: '/second',\n-              destination: '/hello-again',\n-              regex: normalizeRegEx('^\\\\/second(?:\\\\/)?$'),\n-            },\n-            {\n-              destination: '/hello',\n-              regex: normalizeRegEx('^\\\\/to-hello(?:\\\\/)?$'),\n-              source: '/to-hello',\n-            },\n-            {\n-              destination: '/blog/post-2',\n-              regex: normalizeRegEx('^\\\\/blog\\\\/post-1(?:\\\\/)?$'),\n-              source: '/blog/post-1',\n-            },\n-            {\n-              source: '/test/:path',\n-              destination: '/:path',\n-              regex: normalizeRegEx('^\\\\/test(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'),\n-            },\n-            {\n-              source: '/test-overwrite/:something/:another',\n-              destination: '/params/this-should-be-the-value',\n-              regex: normalizeRegEx(\n-                '^\\\\/test-overwrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-              ),\n-            },\n-            {\n-              source: '/params/:something',\n-              destination: '/with-params',\n-              regex: normalizeRegEx('^\\\\/params(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'),\n-            },\n-            {\n-              destination: '/with-params?first=:section&second=:name',\n-              regex: normalizeRegEx(\n-                '^\\\\/query-rewrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-              ),\n-              source: '/query-rewrite/:section/:name',\n-            },\n-            {\n-              destination: '/_next/:path*',\n-              regex: normalizeRegEx(\n-                '^\\\\/hidden\\\\/_next(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/hidden/_next/:path*',\n-            },\n-            {\n-              destination: `http://localhost:${externalServerPort}/:path*`,\n-              regex: normalizeRegEx(\n-                '^\\\\/proxy-me(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/proxy-me/:path*',\n-            },\n-            {\n-              destination: '/api/hello',\n-              regex: normalizeRegEx('^\\\\/api-hello(?:\\\\/)?$'),\n-              source: '/api-hello',\n-            },\n-            {\n-              destination: '/api/hello?name=:first*',\n-              regex: normalizeRegEx('^\\\\/api-hello-regex(?:\\\\/(.*))(?:\\\\/)?$'),\n-              source: '/api-hello-regex/:first(.*)',\n-            },\n-            {\n-              destination: '/api/hello?hello=:name',\n-              regex: normalizeRegEx(\n-                '^\\\\/api-hello-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-              ),\n-              source: '/api-hello-param/:name',\n-            },\n-            {\n-              destination: '/api/dynamic/:name?hello=:name',\n-              regex: normalizeRegEx(\n-                '^\\\\/api-dynamic-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$'\n-              ),\n-              source: '/api-dynamic-param/:name',\n-            },\n-            {\n-              destination: '/with-params',\n-              regex: normalizeRegEx('^(?:\\\\/([^\\\\/]+?))\\\\/post-321(?:\\\\/)?$'),\n-              source: '/:path/post-321',\n-            },\n-            {\n-              destination: '/with-params',\n-              regex: normalizeRegEx(\n-                '^\\\\/unnamed-params\\\\/nested(?:\\\\/(.*))(?:\\\\/([^\\\\/]+?))(?:\\\\/(.*))(?:\\\\/)?$'\n-              ),\n-              source: '/unnamed-params/nested/(.*)/:test/(.*)',\n-            },\n-            {\n-              destination: '/with-params',\n-              regex: normalizeRegEx(\n-                '^\\\\/catchall-rewrite(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/catchall-rewrite/:path*',\n-            },\n-            {\n-              destination: '/with-params?another=:path*',\n-              regex: normalizeRegEx(\n-                '^\\\\/catchall-query(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$'\n-              ),\n-              source: '/catchall-query/:path*',\n-            },\n-            {\n-              destination: '/with-params?myHeader=:myHeader',\n-              has: [\n-                {\n-                  key: 'x-my-header',\n-                  type: 'header',\n-                  value: '(?<myHeader>.*)',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-1(?:\\\\/)?$'),\n-              source: '/has-rewrite-1',\n-            },\n-            {\n-              destination: '/with-params?value=:myquery',\n-              has: [\n-                {\n-                  key: 'my-query',\n-                  type: 'query',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-2(?:\\\\/)?$'),\n-              source: '/has-rewrite-2',\n-            },\n-            {\n-              destination: '/with-params?authorized=1',\n-              has: [\n-                {\n-                  key: 'loggedIn',\n-                  type: 'cookie',\n-                  value: '(?<loggedIn>true)',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-3(?:\\\\/)?$'),\n-              source: '/has-rewrite-3',\n-            },\n-            {\n-              destination: '/with-params?host=1',\n-              has: [\n-                {\n-                  type: 'host',\n-                  value: 'example.com',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-4(?:\\\\/)?$'),\n-              source: '/has-rewrite-4',\n-            },\n-            {\n-              destination: '/:hasParam',\n-              has: [\n-                {\n-                  key: 'hasParam',\n-                  type: 'query',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-5(?:\\\\/)?$'),\n-              source: '/has-rewrite-5',\n-            },\n-            {\n-              destination: '/with-params',\n-              has: [\n-                {\n-                  key: 'hasParam',\n-                  type: 'header',\n-                  value: 'with-params',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-6(?:\\\\/)?$'),\n-              source: '/has-rewrite-6',\n-            },\n-            {\n-              destination: '/with-params?idk=:idk',\n-              has: [\n-                {\n-                  key: 'hasParam',\n-                  type: 'query',\n-                  value: '(?<idk>with-params|hello)',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-7(?:\\\\/)?$'),\n-              source: '/has-rewrite-7',\n-            },\n-            {\n-              destination: '/blog-catchall/:post',\n-              has: [\n-                {\n-                  key: 'post',\n-                  type: 'query',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/has-rewrite-8(?:\\\\/)?$'),\n-              source: '/has-rewrite-8',\n-            },\n-            {\n-              destination: '/with-params',\n-              missing: [\n-                {\n-                  key: 'x-my-header',\n-                  type: 'header',\n-                  value: '(?<myHeader>.*)',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/missing-rewrite-1(?:\\\\/)?$'),\n-              source: '/missing-rewrite-1',\n-            },\n-            {\n-              destination: '/with-params',\n-              missing: [\n-                {\n-                  key: 'my-query',\n-                  type: 'query',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/missing-rewrite-2(?:\\\\/)?$'),\n-              source: '/missing-rewrite-2',\n-            },\n-            {\n-              destination: '/with-params?authorized=1',\n-              missing: [\n-                {\n-                  key: 'loggedIn',\n-                  type: 'cookie',\n-                  value: '(?<loggedIn>true)',\n-                },\n-              ],\n-              regex: normalizeRegEx('^\\\\/missing-rewrite-3(?:\\\\/)?$'),\n-              source: '/missing-rewrite-3',\n-            },\n-            {\n-              destination: '/hello',\n-              regex: normalizeRegEx('^\\\\/blog\\\\/about(?:\\\\/)?$'),\n-              source: '/blog/about',\n-            },\n-            {\n-              destination: '/overridden',\n-              regex:\n-                '^\\\\/overridden(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$',\n-              source: '/overridden/:path*',\n-            },\n-          ],\n-          fallback: [],\n-        },\n-        dynamicRoutes: [\n-          {\n-            namedRegex: '^/_sport/(?<nxtPslug>[^/]+?)(?:/)?$',\n-            page: '/_sport/[slug]',\n-            regex: normalizeRegEx('^\\\\/_sport\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: '^/_sport/(?<nxtPslug>[^/]+?)/test(?:/)?$',\n-            page: '/_sport/[slug]/test',\n-            regex: normalizeRegEx('^\\\\/_sport\\\\/([^\\\\/]+?)\\\\/test(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: '^/another/(?<nxtPid>[^/]+?)(?:/)?$',\n-            page: '/another/[id]',\n-            regex: normalizeRegEx('^\\\\/another\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPid: 'nxtPid',\n-            },\n-          },\n-          {\n-            namedRegex: '^/api/dynamic/(?<nxtPslug>[^/]+?)(?:/)?$',\n-            page: '/api/dynamic/[slug]',\n-            regex: normalizeRegEx('^\\\\/api\\\\/dynamic\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: '^/auto\\\\-export/(?<nxtPslug>[^/]+?)(?:/)?$',\n-            page: '/auto-export/[slug]',\n-            regex: normalizeRegEx('^\\\\/auto\\\\-export\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: '^/blog/(?<nxtPpost>[^/]+?)(?:/)?$',\n-            page: '/blog/[post]',\n-            regex: normalizeRegEx('^\\\\/blog\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPpost: 'nxtPpost',\n-            },\n-          },\n-          {\n-            namedRegex: '^/blog\\\\-catchall/(?<nxtPslug>.+?)(?:/)?$',\n-            page: '/blog-catchall/[...slug]',\n-            regex: normalizeRegEx('^\\\\/blog\\\\-catchall\\\\/(.+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: '^/overridden/(?<nxtPslug>[^/]+?)(?:/)?$',\n-            page: '/overridden/[slug]',\n-            regex: '^\\\\/overridden\\\\/([^\\\\/]+?)(?:\\\\/)?$',\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-        ],\n-        staticRoutes: [\n-          {\n-            namedRegex: '^/auto\\\\-export/another(?:/)?$',\n-            page: '/auto-export/another',\n-            regex: '^/auto\\\\-export/another(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$',\n-            page: '/docs/v2/more/now-for-github',\n-            regex: '^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/hello(?:/)?$',\n-            page: '/hello',\n-            regex: '^/hello(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/hello\\\\-again(?:/)?$',\n-            page: '/hello-again',\n-            regex: '^/hello\\\\-again(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/multi\\\\-rewrites(?:/)?$',\n-            page: '/multi-rewrites',\n-            regex: '^/multi\\\\-rewrites(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/nav(?:/)?$',\n-            page: '/nav',\n-            regex: '^/nav(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/overridden(?:/)?$',\n-            page: '/overridden',\n-            regex: '^/overridden(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/redirect\\\\-override(?:/)?$',\n-            page: '/redirect-override',\n-            regex: '^/redirect\\\\-override(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/with\\\\-params(?:/)?$',\n-            page: '/with-params',\n-            regex: '^/with\\\\-params(?:/)?$',\n-            routeKeys: {},\n-          },\n-        ],\n-        rsc: {\n-          header: 'rsc',\n-          contentTypeHeader: 'text/x-component',\n-          didPostponeHeader: 'x-nextjs-postponed',\n-          varyHeader:\n-            'rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch',\n-          prefetchHeader: 'next-router-prefetch',\n-          prefetchSegmentDirSuffix: '.segments',\n-          prefetchSegmentHeader: 'next-router-segment-prefetch',\n-          prefetchSegmentSuffix: '.segment.rsc',\n-          prefetchSuffix: '.prefetch.rsc',\n-          suffix: '.rsc',\n-        },\n-      })\n+      expect(\n+        normalizeManifest(manifest, [\n+          [buildId, 'BUILD_ID'],\n+          [`${externalServerPort}`, 'EXTERNAL_SERVER_PORT'],\n+        ])\n+      ).toMatchInlineSnapshot(`\n+       {\n+         \"basePath\": \"\",\n+         \"caseSensitive\": true,\n+         \"dataRoutes\": [\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/blog\\\\-catchall\\\\/(.+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/blog\\\\-catchall/(?<nxtPslug>.+?)\\\\.json$\",\n+             \"page\": \"/blog-catchall/[...slug]\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/overridden\\\\/([^\\\\/]+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/overridden/(?<nxtPslug>[^/]+?)\\\\.json$\",\n+             \"page\": \"/overridden/[slug]\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+         ],\n+         \"dynamicRoutes\": [\n+           {\n+             \"namedRegex\": \"^/_sport/(?<nxtPslug>[^/]+?)(?:/)?$\",\n+             \"page\": \"/_sport/[slug]\",\n+             \"regex\": \"^\\\\/_sport\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/_sport/(?<nxtPslug>[^/]+?)/test(?:/)?$\",\n+             \"page\": \"/_sport/[slug]/test\",\n+             \"regex\": \"^\\\\/_sport\\\\/([^\\\\/]+?)\\\\/test(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/another/(?<nxtPid>[^/]+?)(?:/)?$\",\n+             \"page\": \"/another/[id]\",\n+             \"regex\": \"^\\\\/another\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPid\": \"nxtPid\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/api/dynamic/(?<nxtPslug>[^/]+?)(?:/)?$\",\n+             \"page\": \"/api/dynamic/[slug]\",\n+             \"regex\": \"^\\\\/api\\\\/dynamic\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/auto\\\\-export/(?<nxtPslug>[^/]+?)(?:/)?$\",\n+             \"page\": \"/auto-export/[slug]\",\n+             \"regex\": \"^\\\\/auto\\\\-export\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/blog/(?<nxtPpost>[^/]+?)(?:/)?$\",\n+             \"page\": \"/blog/[post]\",\n+             \"regex\": \"^\\\\/blog\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPpost\": \"nxtPpost\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/blog\\\\-catchall/(?<nxtPslug>.+?)(?:/)?$\",\n+             \"page\": \"/blog-catchall/[...slug]\",\n+             \"regex\": \"^\\\\/blog\\\\-catchall\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/overridden/(?<nxtPslug>[^/]+?)(?:/)?$\",\n+             \"page\": \"/overridden/[slug]\",\n+             \"regex\": \"^\\\\/overridden\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+         ],\n+         \"headers\": [\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-new-header\",\n+                 \"value\": \"new-value\",\n+               },\n+             ],\n+             \"missing\": [\n+               {\n+                 \"key\": \"x-my-header\",\n+                 \"type\": \"header\",\n+                 \"value\": \"(?<myHeader>.*)\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/missing-headers-1(?:\\\\/)?$\",\n+             \"source\": \"/missing-headers-1\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-new-header\",\n+                 \"value\": \"new-value\",\n+               },\n+             ],\n+             \"missing\": [\n+               {\n+                 \"key\": \"my-query\",\n+                 \"type\": \"query\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/missing-headers-2(?:\\\\/)?$\",\n+             \"source\": \"/missing-headers-2\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-new-header\",\n+                 \"value\": \"new-value\",\n+               },\n+             ],\n+             \"missing\": [\n+               {\n+                 \"key\": \"loggedIn\",\n+                 \"type\": \"cookie\",\n+                 \"value\": \"(?<loggedIn>true)\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/missing-headers-3(?:\\\\/)?$\",\n+             \"source\": \"/missing-headers-3\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-custom-header\",\n+                 \"value\": \"hello world\",\n+               },\n+               {\n+                 \"key\": \"x-another-header\",\n+                 \"value\": \"hello again\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/add-header(?:\\\\/)?$\",\n+             \"source\": \"/add-header\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-first-header\",\n+                 \"value\": \"first\",\n+               },\n+               {\n+                 \"key\": \"x-second-header\",\n+                 \"value\": \"second\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/my-headers(?:\\\\/(.*))(?:\\\\/)?$\",\n+             \"source\": \"/my-headers/(.*)\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-path\",\n+                 \"value\": \":path\",\n+               },\n+               {\n+                 \"key\": \"some:path\",\n+                 \"value\": \"hi\",\n+               },\n+               {\n+                 \"key\": \"x-test\",\n+                 \"value\": \"some:value*\",\n+               },\n+               {\n+                 \"key\": \"x-test-2\",\n+                 \"value\": \"value*\",\n+               },\n+               {\n+                 \"key\": \"x-test-3\",\n+                 \"value\": \":value?\",\n+               },\n+               {\n+                 \"key\": \"x-test-4\",\n+                 \"value\": \":value+\",\n+               },\n+               {\n+                 \"key\": \"x-test-5\",\n+                 \"value\": \"something https:\",\n+               },\n+               {\n+                 \"key\": \"x-test-6\",\n+                 \"value\": \":hello(world)\",\n+               },\n+               {\n+                 \"key\": \"x-test-7\",\n+                 \"value\": \"hello(world)\",\n+               },\n+               {\n+                 \"key\": \"x-test-8\",\n+                 \"value\": \"hello{1,}\",\n+               },\n+               {\n+                 \"key\": \"x-test-9\",\n+                 \"value\": \":hello{1,2}\",\n+               },\n+               {\n+                 \"key\": \"content-security-policy\",\n+                 \"value\": \"default-src 'self'; img-src *; media-src media1.com media2.com; script-src userscripts.example.com/:path\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/my-other-header(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+             \"source\": \"/my-other-header/:path\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-origin\",\n+                 \"value\": \"https://example.com\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/without-params\\\\/url(?:\\\\/)?$\",\n+             \"source\": \"/without-params/url\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-url\",\n+                 \"value\": \"https://example.com/:path*\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/with-params\\\\/url(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+             \"source\": \"/with-params/url/:path*\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-url\",\n+                 \"value\": \"https://example.com:8080?hello=:path*\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/with-params\\\\/url2(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+             \"source\": \"/with-params/url2/:path*\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-something\",\n+                 \"value\": \"applied-everywhere\",\n+               },\n+             ],\n+             \"regex\": \"^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+             \"source\": \"/:path*\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-something\",\n+                 \"value\": \"value=:path\",\n+               },\n+               {\n+                 \"key\": \"path-:path\",\n+                 \"value\": \"end\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/named-pattern(?:\\\\/(.*))(?:\\\\/)?$\",\n+             \"source\": \"/named-pattern/:path(.*)\",\n+           },\n+           {\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-value\",\n+                 \"value\": \":path*\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/catchall-header(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+             \"source\": \"/catchall-header/:path*\",\n+           },\n+           {\n+             \"has\": [\n+               {\n+                 \"key\": \"x-my-header\",\n+                 \"type\": \"header\",\n+                 \"value\": \"(?<myHeader>.*)\",\n+               },\n+             ],\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-another\",\n+                 \"value\": \"header\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/has-header-1(?:\\\\/)?$\",\n+             \"source\": \"/has-header-1\",\n+           },\n+           {\n+             \"has\": [\n+               {\n+                 \"key\": \"my-query\",\n+                 \"type\": \"query\",\n+               },\n+             ],\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-added\",\n+                 \"value\": \"value\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/has-header-2(?:\\\\/)?$\",\n+             \"source\": \"/has-header-2\",\n+           },\n+           {\n+             \"has\": [\n+               {\n+                 \"key\": \"loggedIn\",\n+                 \"type\": \"cookie\",\n+                 \"value\": \"true\",\n+               },\n+             ],\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-is-user\",\n+                 \"value\": \"yuuuup\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/has-header-3(?:\\\\/)?$\",\n+             \"source\": \"/has-header-3\",\n+           },\n+           {\n+             \"has\": [\n+               {\n+                 \"type\": \"host\",\n+                 \"value\": \"example.com\",\n+               },\n+             ],\n+             \"headers\": [\n+               {\n+                 \"key\": \"x-is-host\",\n+                 \"value\": \"yuuuup\",\n+               },\n+             ],\n+             \"regex\": \"^\\\\/has-header-4(?:\\\\/)?$\",\n+             \"source\": \"/has-header-4\",\n+           },\n+         ],\n+         \"pages404\": true,\n+         \"redirects\": [\n+           {\n+             \"destination\": \"/:path+\",\n+             \"internal\": true,\n+             \"regex\": \"^(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))\\\\/$\",\n+             \"source\": \"/:path+/\",\n+             \"statusCode\": 308,\n+           },\n+           {\n+             \"destination\": \"/with-params\",\n+             \"missing\": [\n+               {\n+                 \"key\": \"x-my-header\",\n+                 \"type\": \"header\",\n+                 \"value\": \"(?<myHeader>.*)\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/missing-redirect-1(?:\\\\/)?$\",\n+             \"source\": \"/missing-redirect-1\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/with-params\",\n+             \"missing\": [\n+               {\n+                 \"key\": \"my-query\",\n+                 \"type\": \"query\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/missing-redirect-2(?:\\\\/)?$\",\n+             \"source\": \"/missing-redirect-2\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/with-params?authorized=1\",\n+             \"missing\": [\n+               {\n+                 \"key\": \"loggedIn\",\n+                 \"type\": \"cookie\",\n+                 \"value\": \"(?<loggedIn>true)\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/missing-redirect-3(?:\\\\/)?$\",\n+             \"source\": \"/missing-redirect-3\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/:lang/about\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect\\\\/me\\\\/to-about(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+             \"source\": \"/redirect/me/to-about/:lang\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/docs/v2/network/status-codes#:code\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/docs\\\\/router-status(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+             \"source\": \"/docs/router-status/:code\",\n+             \"statusCode\": 301,\n+           },\n+           {\n+             \"destination\": \"/docs/v2/advanced/now-for-github\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/docs\\\\/github(?:\\\\/)?$\",\n+             \"source\": \"/docs/github\",\n+             \"statusCode\": 301,\n+           },\n+           {\n+             \"destination\": \"/docs/v2/more/:all\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/docs\\\\/v2\\\\/advanced(?:\\\\/(.*))(?:\\\\/)?$\",\n+             \"source\": \"/docs/v2/advanced/:all(.*)\",\n+             \"statusCode\": 301,\n+           },\n+           {\n+             \"destination\": \"/blog/:id\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/hello(?:\\\\/([^\\\\/]+?))\\\\/another(?:\\\\/)?$\",\n+             \"source\": \"/hello/:id/another\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect1(?:\\\\/)?$\",\n+             \"source\": \"/redirect1\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect2(?:\\\\/)?$\",\n+             \"source\": \"/redirect2\",\n+             \"statusCode\": 301,\n+           },\n+           {\n+             \"destination\": \"/another\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect3(?:\\\\/)?$\",\n+             \"source\": \"/redirect3\",\n+             \"statusCode\": 302,\n+           },\n+           {\n+             \"destination\": \"/\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect4(?:\\\\/)?$\",\n+             \"source\": \"/redirect4\",\n+             \"statusCode\": 308,\n+           },\n+           {\n+             \"destination\": \"/redir-chain2\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redir-chain1(?:\\\\/)?$\",\n+             \"source\": \"/redir-chain1\",\n+             \"statusCode\": 301,\n+           },\n+           {\n+             \"destination\": \"/redir-chain3\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redir-chain2(?:\\\\/)?$\",\n+             \"source\": \"/redir-chain2\",\n+             \"statusCode\": 302,\n+           },\n+           {\n+             \"destination\": \"/\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redir-chain3(?:\\\\/)?$\",\n+             \"source\": \"/redir-chain3\",\n+             \"statusCode\": 303,\n+           },\n+           {\n+             \"destination\": \"https://google.com\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/to-external(?:\\\\/)?$\",\n+             \"source\": \"/to-external\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/with-params?first=:section&second=:name\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/query-redirect(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+             \"source\": \"/query-redirect/:section/:name\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/got-unnamed\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/unnamed(?:\\\\/(first|second))(?:\\\\/(.*))(?:\\\\/)?$\",\n+             \"source\": \"/unnamed/(first|second)/(.*)\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/:0\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/named-like-unnamed(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+             \"source\": \"/named-like-unnamed/:0\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/thank-you-next\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/redirect-override(?:\\\\/)?$\",\n+             \"source\": \"/redirect-override\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/:first/:second\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/docs(?:\\\\/(integrations|now-cli))\\\\/v2(.*)(?:\\\\/)?$\",\n+             \"source\": \"/docs/:first(integrations|now-cli)/v2:second(.*)\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/somewhere\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/catchall-redirect(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+             \"source\": \"/catchall-redirect/:path*\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"https://authserver.example.com/set-password?returnUrl=https%3A%2F%2Fwww.example.com/login\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/to-external-with-query(?:\\\\/)?$\",\n+             \"source\": \"/to-external-with-query\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"https://authserver.example.com/set-password?returnUrl=https://www.example.com/login\",\n+             \"regex\": \"^(?!\\\\/_next)\\\\/to-external-with-query-2(?:\\\\/)?$\",\n+             \"source\": \"/to-external-with-query-2\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/another?myHeader=:myHeader\",\n+             \"has\": [\n+               {\n+                 \"key\": \"x-my-header\",\n+                 \"type\": \"header\",\n+                 \"value\": \"(?<myHeader>.*)\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-1(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-1\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/another?value=:myquery\",\n+             \"has\": [\n+               {\n+                 \"key\": \"my-query\",\n+                 \"type\": \"query\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-2(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-2\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/another?authorized=1\",\n+             \"has\": [\n+               {\n+                 \"key\": \"loggedIn\",\n+                 \"type\": \"cookie\",\n+                 \"value\": \"true\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-3(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-3\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/another?host=1\",\n+             \"has\": [\n+               {\n+                 \"type\": \"host\",\n+                 \"value\": \"example.com\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-4(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-4\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/somewhere\",\n+             \"has\": [\n+               {\n+                 \"key\": \"x-test-next\",\n+                 \"type\": \"header\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)(?:\\\\/([^\\\\/]+?))\\\\/has-redirect-5(?:\\\\/)?$\",\n+             \"source\": \"/:path/has-redirect-5\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"https://:subdomain.example.com/some-path/end?a=b\",\n+             \"has\": [\n+               {\n+                 \"type\": \"host\",\n+                 \"value\": \"(?<subdomain>.*)-test.example.com\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-6(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-6\",\n+             \"statusCode\": 307,\n+           },\n+           {\n+             \"destination\": \"/somewhere?value=:hello\",\n+             \"has\": [\n+               {\n+                 \"key\": \"hello\",\n+                 \"type\": \"query\",\n+                 \"value\": \"(?<hello>.*)\",\n+               },\n+             ],\n+             \"regex\": \"^(?!\\\\/_next)\\\\/has-redirect-7(?:\\\\/)?$\",\n+             \"source\": \"/has-redirect-7\",\n+             \"statusCode\": 307,\n+           },\n+         ],\n+         \"rewriteHeaders\": {\n+           \"pathHeader\": \"x-nextjs-rewritten-path\",\n+           \"queryHeader\": \"x-nextjs-rewritten-query\",\n+         },\n+         \"rewrites\": {\n+           \"afterFiles\": [\n+             {\n+               \"destination\": \"http://localhost:EXTERNAL_SERVER_PORT/_next/webpack-hmr?page=/about\",\n+               \"regex\": \"^\\\\/to-websocket(?:\\\\/)?$\",\n+               \"source\": \"/to-websocket\",\n+             },\n+             {\n+               \"destination\": \"/hello\",\n+               \"regex\": \"^\\\\/websocket-to-page(?:\\\\/)?$\",\n+               \"source\": \"/websocket-to-page\",\n+             },\n+             {\n+               \"destination\": \"http://localhost:12233\",\n+               \"regex\": \"^\\\\/to-nowhere(?:\\\\/)?$\",\n+               \"source\": \"/to-nowhere\",\n+             },\n+             {\n+               \"destination\": \"/auto-export/hello?rewrite=1\",\n+               \"regex\": \"^\\\\/rewriting-to-auto-export(?:\\\\/)?$\",\n+               \"source\": \"/rewriting-to-auto-export\",\n+             },\n+             {\n+               \"destination\": \"/auto-export/another?rewrite=1\",\n+               \"regex\": \"^\\\\/rewriting-to-another-auto-export(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/rewriting-to-another-auto-export/:path*\",\n+             },\n+             {\n+               \"destination\": \"/another/one\",\n+               \"regex\": \"^\\\\/to-another(?:\\\\/)?$\",\n+               \"source\": \"/to-another\",\n+             },\n+             {\n+               \"destination\": \"/404\",\n+               \"regex\": \"^\\\\/nav(?:\\\\/)?$\",\n+               \"source\": \"/nav\",\n+             },\n+             {\n+               \"destination\": \"/static/hello.txt\",\n+               \"regex\": \"^\\\\/hello-world(?:\\\\/)?$\",\n+               \"source\": \"/hello-world\",\n+             },\n+             {\n+               \"destination\": \"/another\",\n+               \"regex\": \"^\\\\/(?:\\\\/)?$\",\n+               \"source\": \"/\",\n+             },\n+             {\n+               \"destination\": \"/multi-rewrites\",\n+               \"regex\": \"^\\\\/another(?:\\\\/)?$\",\n+               \"source\": \"/another\",\n+             },\n+             {\n+               \"destination\": \"/hello\",\n+               \"regex\": \"^\\\\/first(?:\\\\/)?$\",\n+               \"source\": \"/first\",\n+             },\n+             {\n+               \"destination\": \"/hello-again\",\n+               \"regex\": \"^\\\\/second(?:\\\\/)?$\",\n+               \"source\": \"/second\",\n+             },\n+             {\n+               \"destination\": \"/hello\",\n+               \"regex\": \"^\\\\/to-hello(?:\\\\/)?$\",\n+               \"source\": \"/to-hello\",\n+             },\n+             {\n+               \"destination\": \"/blog/post-2\",\n+               \"regex\": \"^\\\\/blog\\\\/post-1(?:\\\\/)?$\",\n+               \"source\": \"/blog/post-1\",\n+             },\n+             {\n+               \"destination\": \"/:path\",\n+               \"regex\": \"^\\\\/test(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/test/:path\",\n+             },\n+             {\n+               \"destination\": \"/params/this-should-be-the-value\",\n+               \"regex\": \"^\\\\/test-overwrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/test-overwrite/:something/:another\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"regex\": \"^\\\\/params(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/params/:something\",\n+             },\n+             {\n+               \"destination\": \"/with-params?first=:section&second=:name\",\n+               \"regex\": \"^\\\\/query-rewrite(?:\\\\/([^\\\\/]+?))(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/query-rewrite/:section/:name\",\n+             },\n+             {\n+               \"destination\": \"/_next/:path*\",\n+               \"regex\": \"^\\\\/hidden\\\\/_next(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/hidden/_next/:path*\",\n+             },\n+             {\n+               \"destination\": \"http://localhost:EXTERNAL_SERVER_PORT/:path*\",\n+               \"regex\": \"^\\\\/proxy-me(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/proxy-me/:path*\",\n+             },\n+             {\n+               \"destination\": \"/api/hello\",\n+               \"regex\": \"^\\\\/api-hello(?:\\\\/)?$\",\n+               \"source\": \"/api-hello\",\n+             },\n+             {\n+               \"destination\": \"/api/hello?name=:first*\",\n+               \"regex\": \"^\\\\/api-hello-regex(?:\\\\/(.*))(?:\\\\/)?$\",\n+               \"source\": \"/api-hello-regex/:first(.*)\",\n+             },\n+             {\n+               \"destination\": \"/api/hello?hello=:name\",\n+               \"regex\": \"^\\\\/api-hello-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/api-hello-param/:name\",\n+             },\n+             {\n+               \"destination\": \"/api/dynamic/:name?hello=:name\",\n+               \"regex\": \"^\\\\/api-dynamic-param(?:\\\\/([^\\\\/]+?))(?:\\\\/)?$\",\n+               \"source\": \"/api-dynamic-param/:name\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"regex\": \"^(?:\\\\/([^\\\\/]+?))\\\\/post-321(?:\\\\/)?$\",\n+               \"source\": \"/:path/post-321\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"regex\": \"^\\\\/unnamed-params\\\\/nested(?:\\\\/(.*))(?:\\\\/([^\\\\/]+?))(?:\\\\/(.*))(?:\\\\/)?$\",\n+               \"source\": \"/unnamed-params/nested/(.*)/:test/(.*)\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"regex\": \"^\\\\/catchall-rewrite(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/catchall-rewrite/:path*\",\n+             },\n+             {\n+               \"destination\": \"/with-params?another=:path*\",\n+               \"regex\": \"^\\\\/catchall-query(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/catchall-query/:path*\",\n+             },\n+             {\n+               \"destination\": \"/with-params?myHeader=:myHeader\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"x-my-header\",\n+                   \"type\": \"header\",\n+                   \"value\": \"(?<myHeader>.*)\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-1(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-1\",\n+             },\n+             {\n+               \"destination\": \"/with-params?value=:myquery\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"my-query\",\n+                   \"type\": \"query\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-2(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-2\",\n+             },\n+             {\n+               \"destination\": \"/with-params?authorized=1\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"loggedIn\",\n+                   \"type\": \"cookie\",\n+                   \"value\": \"(?<loggedIn>true)\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-3(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-3\",\n+             },\n+             {\n+               \"destination\": \"/with-params?host=1\",\n+               \"has\": [\n+                 {\n+                   \"type\": \"host\",\n+                   \"value\": \"example.com\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-4(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-4\",\n+             },\n+             {\n+               \"destination\": \"/:hasParam\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"hasParam\",\n+                   \"type\": \"query\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-5(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-5\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"hasParam\",\n+                   \"type\": \"header\",\n+                   \"value\": \"with-params\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-6(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-6\",\n+             },\n+             {\n+               \"destination\": \"/with-params?idk=:idk\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"hasParam\",\n+                   \"type\": \"query\",\n+                   \"value\": \"(?<idk>with-params|hello)\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-7(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-7\",\n+             },\n+             {\n+               \"destination\": \"/blog-catchall/:post\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"post\",\n+                   \"type\": \"query\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/has-rewrite-8(?:\\\\/)?$\",\n+               \"source\": \"/has-rewrite-8\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"missing\": [\n+                 {\n+                   \"key\": \"x-my-header\",\n+                   \"type\": \"header\",\n+                   \"value\": \"(?<myHeader>.*)\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/missing-rewrite-1(?:\\\\/)?$\",\n+               \"source\": \"/missing-rewrite-1\",\n+             },\n+             {\n+               \"destination\": \"/with-params\",\n+               \"missing\": [\n+                 {\n+                   \"key\": \"my-query\",\n+                   \"type\": \"query\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/missing-rewrite-2(?:\\\\/)?$\",\n+               \"source\": \"/missing-rewrite-2\",\n+             },\n+             {\n+               \"destination\": \"/with-params?authorized=1\",\n+               \"missing\": [\n+                 {\n+                   \"key\": \"loggedIn\",\n+                   \"type\": \"cookie\",\n+                   \"value\": \"(?<loggedIn>true)\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/missing-rewrite-3(?:\\\\/)?$\",\n+               \"source\": \"/missing-rewrite-3\",\n+             },\n+             {\n+               \"destination\": \"/hello\",\n+               \"regex\": \"^\\\\/blog\\\\/about(?:\\\\/)?$\",\n+               \"source\": \"/blog/about\",\n+             },\n+             {\n+               \"destination\": \"/overridden\",\n+               \"regex\": \"^\\\\/overridden(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/overridden/:path*\",\n+             },\n+           ],\n+           \"beforeFiles\": [\n+             {\n+               \"destination\": \"/with-params?overridden=1\",\n+               \"has\": [\n+                 {\n+                   \"key\": \"overrideMe\",\n+                   \"type\": \"query\",\n+                 },\n+               ],\n+               \"regex\": \"^\\\\/hello(?:\\\\/)?$\",\n+               \"source\": \"/hello\",\n+             },\n+             {\n+               \"destination\": \"/blog/:path*\",\n+               \"regex\": \"^\\\\/old-blog(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/old-blog/:path*\",\n+             },\n+             {\n+               \"destination\": \"https://example.vercel.sh\",\n+               \"regex\": \"^\\\\/overridden(?:\\\\/)?$\",\n+               \"source\": \"/overridden\",\n+             },\n+             {\n+               \"destination\": \"/_sport/nfl/:path*\",\n+               \"regex\": \"^\\\\/nfl(?:\\\\/((?:[^\\\\/]+?)(?:\\\\/(?:[^\\\\/]+?))*))?(?:\\\\/)?$\",\n+               \"source\": \"/nfl/:path*\",\n+             },\n+           ],\n+           \"fallback\": [],\n+         },\n+         \"rsc\": {\n+           \"contentTypeHeader\": \"text/x-component\",\n+           \"didPostponeHeader\": \"x-nextjs-postponed\",\n+           \"header\": \"rsc\",\n+           \"prefetchHeader\": \"next-router-prefetch\",\n+           \"prefetchSegmentDirSuffix\": \".segments\",\n+           \"prefetchSegmentHeader\": \"next-router-segment-prefetch\",\n+           \"prefetchSegmentSuffix\": \".segment.rsc\",\n+           \"prefetchSuffix\": \".prefetch.rsc\",\n+           \"suffix\": \".rsc\",\n+           \"varyHeader\": \"rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch\",\n+         },\n+         \"staticRoutes\": [\n+           {\n+             \"namedRegex\": \"^/auto\\\\-export/another(?:/)?$\",\n+             \"page\": \"/auto-export/another\",\n+             \"regex\": \"^/auto\\\\-export/another(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$\",\n+             \"page\": \"/docs/v2/more/now-for-github\",\n+             \"regex\": \"^/docs/v2/more/now\\\\-for\\\\-github(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/hello(?:/)?$\",\n+             \"page\": \"/hello\",\n+             \"regex\": \"^/hello(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/hello\\\\-again(?:/)?$\",\n+             \"page\": \"/hello-again\",\n+             \"regex\": \"^/hello\\\\-again(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/multi\\\\-rewrites(?:/)?$\",\n+             \"page\": \"/multi-rewrites\",\n+             \"regex\": \"^/multi\\\\-rewrites(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/nav(?:/)?$\",\n+             \"page\": \"/nav\",\n+             \"regex\": \"^/nav(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/overridden(?:/)?$\",\n+             \"page\": \"/overridden\",\n+             \"regex\": \"^/overridden(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/redirect\\\\-override(?:/)?$\",\n+             \"page\": \"/redirect-override\",\n+             \"regex\": \"^/redirect\\\\-override(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/with\\\\-params(?:/)?$\",\n+             \"page\": \"/with-params\",\n+             \"regex\": \"^/with\\\\-params(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+         ],\n+         \"version\": 3,\n+       }\n+      `)\n     })\n \n     it('should have redirects/rewrites in build output with debug flag', async () => {"
        },
        {
            "sha": "14e80177b6743cd3e7ca6c4302d54b29021efbc2",
            "filename": "test/integration/dynamic-routing/test/index.test.js",
            "status": "modified",
            "additions": 307,
            "deletions": 313,
            "changes": 620,
            "blob_url": "https://github.com/vercel/next.js/blob/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.js?ref=b3e9fb9de2920b41d5386d482cf951126e3c52d4",
            "patch": "@@ -17,9 +17,9 @@ import {\n   normalizeRegEx,\n   check,\n   getRedboxHeader,\n+  normalizeManifest,\n } from 'next-test-utils'\n import cheerio from 'cheerio'\n-import escapeRegex from 'escape-string-regexp'\n \n let app\n let appPort\n@@ -1250,325 +1250,319 @@ function runTests({ dev }) {\n         new RegExp(route.namedDataRouteRegex)\n       }\n \n-      expect(manifest).toEqual({\n-        version: 3,\n-        pages404: true,\n-        caseSensitive: false,\n-        basePath: '',\n-        headers: [],\n-        rewrites: {\n-          beforeFiles: [],\n-          afterFiles: [],\n-          fallback: [],\n-        },\n-        staticRoutes: [\n-          {\n-            namedRegex: '^/(?:/)?$',\n-            page: '/',\n-            regex: '^/(?:/)?$',\n-            routeKeys: {},\n-          },\n-          {\n-            namedRegex: '^/another(?:/)?$',\n-            page: '/another',\n-            regex: '^/another(?:/)?$',\n-            routeKeys: {},\n-          },\n-        ],\n-        redirects: expect.arrayContaining([]),\n-        dataRoutes: [\n-          {\n-            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-              buildId\n-            )}\\\\/b\\\\/([^\\\\/]+?)\\\\.json$`,\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/b/(?<nxtP123>[^/]+?)\\\\.json$`,\n-            page: '/b/[123]',\n-            routeKeys: {\n-              nxtP123: 'nxtP123',\n-            },\n-          },\n-          {\n-            dataRouteRegex: `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-              buildId\n-            )}\\\\/c\\\\/([^\\\\/]+?)\\\\.json$`,\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/c/(?<a>[^/]+?)\\\\.json$`,\n-            page: '/c/[alongparamnameshouldbeallowedeventhoughweird]',\n-            routeKeys: {\n-              a: 'nxtPalongparamnameshouldbeallowedeventhoughweird',\n-            },\n-          },\n-          {\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/p1/p2/all\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$`,\n-            dataRouteRegex: normalizeRegEx(\n-              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-                buildId\n-              )}\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)\\\\.json$`\n-            ),\n-            page: '/p1/p2/all-ssg/[...rest]',\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/p1/p2/nested\\\\-all\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$`,\n-            dataRouteRegex: normalizeRegEx(\n-              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-                buildId\n-              )}\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)\\\\.json$`\n-            ),\n-            page: '/p1/p2/nested-all-ssg/[...rest]',\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/p1/p2/predefined\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$`,\n-            dataRouteRegex: normalizeRegEx(\n-              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-                buildId\n-              )}\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)\\\\.json$`\n-            ),\n-            page: '/p1/p2/predefined-ssg/[...rest]',\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            dataRouteRegex: normalizeRegEx(\n-              `^\\\\/_next\\\\/data\\\\/${escapeRegex(\n-                buildId\n-              )}\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\/(.+?)\\\\.json$`\n-            ),\n-            namedDataRouteRegex: `^/_next/data/${escapeRegex(\n-              buildId\n-            )}/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)/(?<nxtPrest>.+?)\\\\.json$`,\n-            page: '/[name]/[comment]/[...rest]',\n-            routeKeys: {\n-              nxtPcomment: 'nxtPcomment',\n-              nxtPname: 'nxtPname',\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-        ],\n-        dynamicRoutes: [\n-          {\n-            namedRegex: '^/b/(?<nxtP123>[^/]+?)(?:/)?$',\n-            page: '/b/[123]',\n-            regex: normalizeRegEx('^\\\\/b\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtP123: 'nxtP123',\n-            },\n-          },\n-          {\n-            namedRegex: `^/blog/(?<nxtPname>[^/]+?)/comment/(?<nxtPid>[^/]+?)(?:/)?$`,\n-            page: '/blog/[name]/comment/[id]',\n-            regex: normalizeRegEx(\n-              '^\\\\/blog\\\\/([^\\\\/]+?)\\\\/comment\\\\/([^\\\\/]+?)(?:\\\\/)?$'\n-            ),\n-            routeKeys: {\n-              nxtPname: 'nxtPname',\n-              nxtPid: 'nxtPid',\n-            },\n-          },\n-          {\n-            namedRegex: '^/c/(?<a>[^/]+?)(?:/)?$',\n-            page: '/c/[alongparamnameshouldbeallowedeventhoughweird]',\n-            regex: normalizeRegEx('^\\\\/c\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              a: 'nxtPalongparamnameshouldbeallowedeventhoughweird',\n-            },\n-          },\n-          {\n-            namedRegex: '^/catchall\\\\-dash/(?<nxtPhelloworld>.+?)(?:/)?$',\n-            page: '/catchall-dash/[...hello-world]',\n-            regex: normalizeRegEx('^\\\\/catchall\\\\-dash\\\\/(.+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPhelloworld: 'nxtPhello-world',\n-            },\n-          },\n-          {\n-            namedRegex: '^/d/(?<nxtPid>[^/]+?)(?:/)?$',\n-            page: '/d/[id]',\n-            regex: normalizeRegEx('^\\\\/d\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPid: 'nxtPid',\n-            },\n-          },\n-          {\n-            namedRegex: '^/dash/(?<nxtPhelloworld>[^/]+?)(?:/)?$',\n-            page: '/dash/[hello-world]',\n-            regex: normalizeRegEx('^\\\\/dash\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPhelloworld: 'nxtPhello-world',\n-            },\n-          },\n-          {\n-            namedRegex: '^/index/(?<nxtPslug>.+?)(?:/)?$',\n-            page: '/index/[...slug]',\n-            regex: normalizeRegEx('^/index/(.+?)(?:/)?$'),\n-            routeKeys: {\n-              nxtPslug: 'nxtPslug',\n-            },\n-          },\n-          {\n-            namedRegex: `^/on\\\\-mount/(?<nxtPpost>[^/]+?)(?:/)?$`,\n-            page: '/on-mount/[post]',\n-            regex: normalizeRegEx('^\\\\/on\\\\-mount\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPpost: 'nxtPpost',\n-            },\n-          },\n-          {\n-            namedRegex: `^/p1/p2/all\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$`,\n-            page: '/p1/p2/all-ssg/[...rest]',\n-            regex: normalizeRegEx('^\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedRegex: `^/p1/p2/all\\\\-ssr/(?<nxtPrest>.+?)(?:/)?$`,\n-            page: '/p1/p2/all-ssr/[...rest]',\n-            regex: normalizeRegEx('^\\\\/p1\\\\/p2\\\\/all\\\\-ssr\\\\/(.+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedRegex: `^/p1/p2/nested\\\\-all\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$`,\n-            page: '/p1/p2/nested-all-ssg/[...rest]',\n-            regex: normalizeRegEx(\n-              '^\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'\n-            ),\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedRegex: `^/p1/p2/predefined\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$`,\n-            page: '/p1/p2/predefined-ssg/[...rest]',\n-            regex: normalizeRegEx(\n-              '^\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)(?:\\\\/)?$'\n-            ),\n-            routeKeys: {\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-          {\n-            namedRegex: `^/(?<nxtPname>[^/]+?)(?:/)?$`,\n-            page: '/[name]',\n-            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPname: 'nxtPname',\n-            },\n-          },\n-          {\n-            namedRegex: `^/(?<nxtPname>[^/]+?)/comments(?:/)?$`,\n-            page: '/[name]/comments',\n-            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)\\\\/comments(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPname: 'nxtPname',\n-            },\n-          },\n-          {\n-            namedRegex: `^/(?<nxtPname>[^/]+?)/on\\\\-mount\\\\-redir(?:/)?$`,\n-            page: '/[name]/on-mount-redir',\n-            regex: normalizeRegEx(\n-              '^\\\\/([^\\\\/]+?)\\\\/on\\\\-mount\\\\-redir(?:\\\\/)?$'\n-            ),\n-            routeKeys: {\n-              nxtPname: 'nxtPname',\n-            },\n-          },\n-          {\n-            namedRegex: `^/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)(?:/)?$`,\n-            page: '/[name]/[comment]',\n-            regex: normalizeRegEx('^\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)(?:\\\\/)?$'),\n-            routeKeys: {\n-              nxtPname: 'nxtPname',\n-              nxtPcomment: 'nxtPcomment',\n-            },\n-          },\n-          {\n-            namedRegex:\n-              '^/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)/(?<nxtPrest>.+?)(?:/)?$',\n-            page: '/[name]/[comment]/[...rest]',\n-            regex: normalizeRegEx(\n-              '^\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\/(.+?)(?:\\\\/)?$'\n-            ),\n-            routeKeys: {\n-              nxtPcomment: 'nxtPcomment',\n-              nxtPname: 'nxtPname',\n-              nxtPrest: 'nxtPrest',\n-            },\n-          },\n-        ],\n-        rewriteHeaders: {\n-          pathHeader: 'x-nextjs-rewritten-path',\n-          queryHeader: 'x-nextjs-rewritten-query',\n-        },\n-        rsc: {\n-          header: 'rsc',\n-          contentTypeHeader: 'text/x-component',\n-          didPostponeHeader: 'x-nextjs-postponed',\n-          varyHeader:\n-            'rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch',\n-          prefetchHeader: 'next-router-prefetch',\n-          prefetchSegmentDirSuffix: '.segments',\n-          prefetchSegmentHeader: 'next-router-segment-prefetch',\n-          prefetchSegmentSuffix: '.segment.rsc',\n-          prefetchSuffix: '.prefetch.rsc',\n-          suffix: '.rsc',\n-        },\n-      })\n+      // Parse the manifest string back into an object.\n+      expect(normalizeManifest(manifest, [[buildId, 'BUILD_ID']]))\n+        .toMatchInlineSnapshot(`\n+       {\n+         \"basePath\": \"\",\n+         \"caseSensitive\": false,\n+         \"dataRoutes\": [\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/b\\\\/([^\\\\/]+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/b/(?<nxtP123>[^/]+?)\\\\.json$\",\n+             \"page\": \"/b/[123]\",\n+             \"routeKeys\": {\n+               \"nxtP123\": \"nxtP123\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/c\\\\/([^\\\\/]+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/c/(?<a>[^/]+?)\\\\.json$\",\n+             \"page\": \"/c/[alongparamnameshouldbeallowedeventhoughweird]\",\n+             \"routeKeys\": {\n+               \"a\": \"nxtPalongparamnameshouldbeallowedeventhoughweird\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/p1/p2/all\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$\",\n+             \"page\": \"/p1/p2/all-ssg/[...rest]\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/p1/p2/nested\\\\-all\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$\",\n+             \"page\": \"/p1/p2/nested-all-ssg/[...rest]\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/p1/p2/predefined\\\\-ssg/(?<nxtPrest>.+?)\\\\.json$\",\n+             \"page\": \"/p1/p2/predefined-ssg/[...rest]\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"dataRouteRegex\": \"^\\\\/_next\\\\/data\\\\/BUILD_ID\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\/(.+?)\\\\.json$\",\n+             \"namedDataRouteRegex\": \"^/_next/data/BUILD_ID/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)/(?<nxtPrest>.+?)\\\\.json$\",\n+             \"page\": \"/[name]/[comment]/[...rest]\",\n+             \"routeKeys\": {\n+               \"nxtPcomment\": \"nxtPcomment\",\n+               \"nxtPname\": \"nxtPname\",\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+         ],\n+         \"dynamicRoutes\": [\n+           {\n+             \"namedRegex\": \"^/b/(?<nxtP123>[^/]+?)(?:/)?$\",\n+             \"page\": \"/b/[123]\",\n+             \"regex\": \"^\\\\/b\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtP123\": \"nxtP123\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/blog/(?<nxtPname>[^/]+?)/comment/(?<nxtPid>[^/]+?)(?:/)?$\",\n+             \"page\": \"/blog/[name]/comment/[id]\",\n+             \"regex\": \"^\\\\/blog\\\\/([^\\\\/]+?)\\\\/comment\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPid\": \"nxtPid\",\n+               \"nxtPname\": \"nxtPname\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/c/(?<a>[^/]+?)(?:/)?$\",\n+             \"page\": \"/c/[alongparamnameshouldbeallowedeventhoughweird]\",\n+             \"regex\": \"^\\\\/c\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"a\": \"nxtPalongparamnameshouldbeallowedeventhoughweird\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/catchall\\\\-dash/(?<nxtPhelloworld>.+?)(?:/)?$\",\n+             \"page\": \"/catchall-dash/[...hello-world]\",\n+             \"regex\": \"^\\\\/catchall\\\\-dash\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPhelloworld\": \"nxtPhello-world\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/d/(?<nxtPid>[^/]+?)(?:/)?$\",\n+             \"page\": \"/d/[id]\",\n+             \"regex\": \"^\\\\/d\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPid\": \"nxtPid\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/dash/(?<nxtPhelloworld>[^/]+?)(?:/)?$\",\n+             \"page\": \"/dash/[hello-world]\",\n+             \"regex\": \"^\\\\/dash\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPhelloworld\": \"nxtPhello-world\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/index/(?<nxtPslug>.+?)(?:/)?$\",\n+             \"page\": \"/index/[...slug]\",\n+             \"regex\": \"^\\\\/index\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPslug\": \"nxtPslug\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/on\\\\-mount/(?<nxtPpost>[^/]+?)(?:/)?$\",\n+             \"page\": \"/on-mount/[post]\",\n+             \"regex\": \"^\\\\/on\\\\-mount\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPpost\": \"nxtPpost\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/p1/p2/all\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$\",\n+             \"page\": \"/p1/p2/all-ssg/[...rest]\",\n+             \"regex\": \"^\\\\/p1\\\\/p2\\\\/all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/p1/p2/all\\\\-ssr/(?<nxtPrest>.+?)(?:/)?$\",\n+             \"page\": \"/p1/p2/all-ssr/[...rest]\",\n+             \"regex\": \"^\\\\/p1\\\\/p2\\\\/all\\\\-ssr\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/p1/p2/nested\\\\-all\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$\",\n+             \"page\": \"/p1/p2/nested-all-ssg/[...rest]\",\n+             \"regex\": \"^\\\\/p1\\\\/p2\\\\/nested\\\\-all\\\\-ssg\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/p1/p2/predefined\\\\-ssg/(?<nxtPrest>.+?)(?:/)?$\",\n+             \"page\": \"/p1/p2/predefined-ssg/[...rest]\",\n+             \"regex\": \"^\\\\/p1\\\\/p2\\\\/predefined\\\\-ssg\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/(?<nxtPname>[^/]+?)(?:/)?$\",\n+             \"page\": \"/[name]\",\n+             \"regex\": \"^\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPname\": \"nxtPname\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/(?<nxtPname>[^/]+?)/comments(?:/)?$\",\n+             \"page\": \"/[name]/comments\",\n+             \"regex\": \"^\\\\/([^\\\\/]+?)\\\\/comments(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPname\": \"nxtPname\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/(?<nxtPname>[^/]+?)/on\\\\-mount\\\\-redir(?:/)?$\",\n+             \"page\": \"/[name]/on-mount-redir\",\n+             \"regex\": \"^\\\\/([^\\\\/]+?)\\\\/on\\\\-mount\\\\-redir(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPname\": \"nxtPname\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)(?:/)?$\",\n+             \"page\": \"/[name]/[comment]\",\n+             \"regex\": \"^\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPcomment\": \"nxtPcomment\",\n+               \"nxtPname\": \"nxtPname\",\n+             },\n+           },\n+           {\n+             \"namedRegex\": \"^/(?<nxtPname>[^/]+?)/(?<nxtPcomment>[^/]+?)/(?<nxtPrest>.+?)(?:/)?$\",\n+             \"page\": \"/[name]/[comment]/[...rest]\",\n+             \"regex\": \"^\\\\/([^\\\\/]+?)\\\\/([^\\\\/]+?)\\\\/(.+?)(?:\\\\/)?$\",\n+             \"routeKeys\": {\n+               \"nxtPcomment\": \"nxtPcomment\",\n+               \"nxtPname\": \"nxtPname\",\n+               \"nxtPrest\": \"nxtPrest\",\n+             },\n+           },\n+         ],\n+         \"headers\": [],\n+         \"pages404\": true,\n+         \"redirects\": [\n+           {\n+             \"destination\": \"/:path+\",\n+             \"internal\": true,\n+             \"regex\": \"^(?:/((?:[^/]+?)(?:/(?:[^/]+?))*))/$\",\n+             \"source\": \"/:path+/\",\n+             \"statusCode\": 308,\n+           },\n+         ],\n+         \"rewriteHeaders\": {\n+           \"pathHeader\": \"x-nextjs-rewritten-path\",\n+           \"queryHeader\": \"x-nextjs-rewritten-query\",\n+         },\n+         \"rewrites\": {\n+           \"afterFiles\": [],\n+           \"beforeFiles\": [],\n+           \"fallback\": [],\n+         },\n+         \"rsc\": {\n+           \"contentTypeHeader\": \"text/x-component\",\n+           \"didPostponeHeader\": \"x-nextjs-postponed\",\n+           \"header\": \"rsc\",\n+           \"prefetchHeader\": \"next-router-prefetch\",\n+           \"prefetchSegmentDirSuffix\": \".segments\",\n+           \"prefetchSegmentHeader\": \"next-router-segment-prefetch\",\n+           \"prefetchSegmentSuffix\": \".segment.rsc\",\n+           \"prefetchSuffix\": \".prefetch.rsc\",\n+           \"suffix\": \".rsc\",\n+           \"varyHeader\": \"rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch\",\n+         },\n+         \"staticRoutes\": [\n+           {\n+             \"namedRegex\": \"^/(?:/)?$\",\n+             \"page\": \"/\",\n+             \"regex\": \"^/(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+           {\n+             \"namedRegex\": \"^/another(?:/)?$\",\n+             \"page\": \"/another\",\n+             \"regex\": \"^/another(?:/)?$\",\n+             \"routeKeys\": {},\n+           },\n+         ],\n+         \"version\": 3,\n+       }\n+      `)\n     })\n \n     it('should output a pages-manifest correctly', async () => {\n       const manifest = await fs.readJson(\n         join(appDir, '.next/server/pages-manifest.json')\n       )\n \n-      expect(manifest).toEqual({\n-        '/[name]/[comment]': 'pages/[name]/[comment].js',\n-        '/[name]/[comment]/[...rest]': 'pages/[name]/[comment]/[...rest].js',\n-        '/[name]/comments': 'pages/[name]/comments.js',\n-        '/[name]': 'pages/[name].js',\n-        '/[name]/on-mount-redir': 'pages/[name]/on-mount-redir.html',\n-        '/another': 'pages/another.html',\n-        '/b/[123]': 'pages/b/[123].js',\n-        '/blog/[name]/comment/[id]': 'pages/blog/[name]/comment/[id].js',\n-        '/c/[alongparamnameshouldbeallowedeventhoughweird]':\n-          'pages/c/[alongparamnameshouldbeallowedeventhoughweird].js',\n-        '/catchall-dash/[...hello-world]':\n-          'pages/catchall-dash/[...hello-world].html',\n-        '/d/[id]': 'pages/d/[id].html',\n-        '/dash/[hello-world]': 'pages/dash/[hello-world].html',\n-        '/': 'pages/index.html',\n-        '/index/[...slug]': process.env.IS_TURBOPACK_TEST\n-          ? 'pages/index/index/[...slug].html'\n-          : 'pages/index/[...slug].html',\n-        '/on-mount/[post]': 'pages/on-mount/[post].html',\n-        '/p1/p2/all-ssg/[...rest]': 'pages/p1/p2/all-ssg/[...rest].js',\n-        '/p1/p2/all-ssr/[...rest]': 'pages/p1/p2/all-ssr/[...rest].js',\n-        '/p1/p2/nested-all-ssg/[...rest]':\n-          'pages/p1/p2/nested-all-ssg/[...rest].js',\n-        '/p1/p2/predefined-ssg/[...rest]':\n-          'pages/p1/p2/predefined-ssg/[...rest].js',\n-        '/_app': 'pages/_app.js',\n-        '/_error': 'pages/_error.js',\n-        '/_document': 'pages/_document.js',\n-        '/404': 'pages/404.html',\n-      })\n+      if (process.env.IS_TURBOPACK_TEST) {\n+        expect(manifest).toMatchInlineSnapshot(`\n+         {\n+           \"/\": \"pages/index.html\",\n+           \"/404\": \"pages/404.html\",\n+           \"/[name]\": \"pages/[name].js\",\n+           \"/[name]/[comment]\": \"pages/[name]/[comment].js\",\n+           \"/[name]/[comment]/[...rest]\": \"pages/[name]/[comment]/[...rest].js\",\n+           \"/[name]/comments\": \"pages/[name]/comments.js\",\n+           \"/[name]/on-mount-redir\": \"pages/[name]/on-mount-redir.html\",\n+           \"/_app\": \"pages/_app.js\",\n+           \"/_document\": \"pages/_document.js\",\n+           \"/_error\": \"pages/_error.js\",\n+           \"/another\": \"pages/another.html\",\n+           \"/b/[123]\": \"pages/b/[123].js\",\n+           \"/blog/[name]/comment/[id]\": \"pages/blog/[name]/comment/[id].js\",\n+           \"/c/[alongparamnameshouldbeallowedeventhoughweird]\": \"pages/c/[alongparamnameshouldbeallowedeventhoughweird].js\",\n+           \"/catchall-dash/[...hello-world]\": \"pages/catchall-dash/[...hello-world].html\",\n+           \"/d/[id]\": \"pages/d/[id].html\",\n+           \"/dash/[hello-world]\": \"pages/dash/[hello-world].html\",\n+           \"/index/[...slug]\": \"pages/index/index/[...slug].html\",\n+           \"/on-mount/[post]\": \"pages/on-mount/[post].html\",\n+           \"/p1/p2/all-ssg/[...rest]\": \"pages/p1/p2/all-ssg/[...rest].js\",\n+           \"/p1/p2/all-ssr/[...rest]\": \"pages/p1/p2/all-ssr/[...rest].js\",\n+           \"/p1/p2/nested-all-ssg/[...rest]\": \"pages/p1/p2/nested-all-ssg/[...rest].js\",\n+           \"/p1/p2/predefined-ssg/[...rest]\": \"pages/p1/p2/predefined-ssg/[...rest].js\",\n+         }\n+        `)\n+      } else {\n+        expect(manifest).toMatchInlineSnapshot(`\n+         {\n+           \"/\": \"pages/index.html\",\n+           \"/404\": \"pages/404.html\",\n+           \"/[name]\": \"pages/[name].js\",\n+           \"/[name]/[comment]\": \"pages/[name]/[comment].js\",\n+           \"/[name]/[comment]/[...rest]\": \"pages/[name]/[comment]/[...rest].js\",\n+           \"/[name]/comments\": \"pages/[name]/comments.js\",\n+           \"/[name]/on-mount-redir\": \"pages/[name]/on-mount-redir.html\",\n+           \"/_app\": \"pages/_app.js\",\n+           \"/_document\": \"pages/_document.js\",\n+           \"/_error\": \"pages/_error.js\",\n+           \"/another\": \"pages/another.html\",\n+           \"/b/[123]\": \"pages/b/[123].js\",\n+           \"/blog/[name]/comment/[id]\": \"pages/blog/[name]/comment/[id].js\",\n+           \"/c/[alongparamnameshouldbeallowedeventhoughweird]\": \"pages/c/[alongparamnameshouldbeallowedeventhoughweird].js\",\n+           \"/catchall-dash/[...hello-world]\": \"pages/catchall-dash/[...hello-world].html\",\n+           \"/d/[id]\": \"pages/d/[id].html\",\n+           \"/dash/[hello-world]\": \"pages/dash/[hello-world].html\",\n+           \"/index/[...slug]\": \"pages/index/[...slug].html\",\n+           \"/on-mount/[post]\": \"pages/on-mount/[post].html\",\n+           \"/p1/p2/all-ssg/[...rest]\": \"pages/p1/p2/all-ssg/[...rest].js\",\n+           \"/p1/p2/all-ssr/[...rest]\": \"pages/p1/p2/all-ssr/[...rest].js\",\n+           \"/p1/p2/nested-all-ssg/[...rest]\": \"pages/p1/p2/nested-all-ssg/[...rest].js\",\n+           \"/p1/p2/predefined-ssg/[...rest]\": \"pages/p1/p2/predefined-ssg/[...rest].js\",\n+         }\n+        `)\n+      }\n     })\n   }\n }"
        },
        {
            "sha": "9a4753a8d23ebda26dd785e66c1bbfed2c45e514",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b3e9fb9de2920b41d5386d482cf951126e3c52d4/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=b3e9fb9de2920b41d5386d482cf951126e3c52d4",
            "patch": "@@ -30,6 +30,8 @@ import { Playwright } from 'next-webdriver'\n \n import { shouldUseTurbopack } from './turbo'\n import stripAnsi from 'strip-ansi'\n+import escapeRegex from 'escape-string-regexp'\n+\n // TODO: Create dedicated Jest environment that sets up these matchers\n // Edge Runtime unit tests fail with \"EvalError: Code generation from strings disallowed for this context\" if these matchers are imported in those tests.\n import './add-redbox-matchers'\n@@ -1830,3 +1832,41 @@ export function trimEndMultiline(str: string) {\n     .map((line) => line.trimEnd())\n     .join('\\n')\n }\n+\n+/**\n+ * Normalizes the manifest by applying the replacements to the manifest. This\n+ * is useful for testing the manifest in a snapshot test.\n+ *\n+ * @param manifest - The manifest to normalize.\n+ * @param replacements - The replacements to perform on the manifest.\n+ * @returns The normalized manifest.\n+ */\n+export function normalizeManifest<T>(\n+  manifest: unknown,\n+  replacements: [search: string, replace: string][]\n+): T {\n+  return JSON.parse(\n+    replacements.reduce(\n+      (acc, [search, replace]) =>\n+        acc.replace(\n+          new RegExp(\n+            // We want to match the literal string, so we need to escape it\n+            // again\n+            escapeRegex(\n+              JSON.stringify(\n+                // The output has already been escaped, so we need to escape our\n+                // search string.\n+                escapeRegex(search)\n+              )\n+                // Remove the quotes added by the JSON.stringify call.\n+                .replace(/^\"(.*)\"/, '$1')\n+            ),\n+            'g'\n+          ),\n+          replace\n+        ),\n+      // We'll perform the replacements on the JSON stringified manifest.\n+      JSON.stringify(manifest)\n+    )\n+  )\n+}"
        }
    ],
    "stats": {
        "total": 2742,
        "additions": 1351,
        "deletions": 1391
    }
}