{
    "author": "mischnic",
    "message": "Properly type ComponentMod (#86765)\n\nMake `ComponentMod` typesafe(r)\n\nBasically no code changes, only types.",
    "sha": "c964caa5ebf3d280f287adabaed4771dce52a3d7",
    "files": [
        {
            "sha": "4c6334db611a2d2a528e7710e950609a2d356b81",
            "filename": "packages/next/src/build/utils.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -73,7 +73,10 @@ import { buildPagesStaticPaths } from './static-paths/pages'\n import type { PrerenderedRoute } from './static-paths/types'\n import type { CacheControl } from '../server/lib/cache-control'\n import { formatExpire, formatRevalidate } from './output/format'\n-import type { AppRouteRouteModule } from '../server/route-modules/app-route/module'\n+import type {\n+  AppRouteModule,\n+  AppRouteRouteModule,\n+} from '../server/route-modules/app-route/module'\n import { formatIssue, isRelevantWarning } from '../shared/lib/turbopack/utils'\n import type { TurbopackResult } from './swc/types'\n import type { FunctionsConfigManifest, ManifestRoute } from './index'\n@@ -829,7 +832,9 @@ export async function isPageStatic({\n       let isRoutePPREnabled: boolean = false\n \n       if (pageType === 'app') {\n-        const ComponentMod: AppPageModule = componentsResult.ComponentMod\n+        // @ts-expect-error pageType is app, so we can assume AppPageModule | AppRouteModule\n+        const ComponentMod: AppPageModule | AppRouteModule =\n+          componentsResult.ComponentMod\n \n         let segments: AppSegment[]\n         try {\n@@ -1078,11 +1083,14 @@ export async function hasCustomGetInitialProps({\n   let mod = ComponentMod\n \n   if (checkingApp) {\n+    // @ts-expect-error very dynamic code\n     mod = (await mod._app) || mod.default || mod\n   } else {\n+    // @ts-expect-error very dynamic code\n     mod = mod.default || mod\n   }\n   mod = await mod\n+  // @ts-expect-error very dynamic code\n   return mod.getInitialProps !== mod.origGetInitialProps\n }\n \n@@ -1105,7 +1113,7 @@ export async function getDefinedNamedExports({\n   })\n \n   return Object.keys(ComponentMod).filter((key) => {\n-    return typeof ComponentMod[key] !== 'undefined'\n+    return typeof ComponentMod[key as keyof typeof ComponentMod] !== 'undefined'\n   })\n }\n "
        },
        {
            "sha": "028526a158f52d4e4d52a9956e91881c3369be57",
            "filename": "packages/next/src/export/types.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -1,6 +1,9 @@\n import type { RenderOptsPartial as AppRenderOptsPartial } from '../server/app-render/types'\n import type { RenderOptsPartial as PagesRenderOptsPartial } from '../server/render'\n-import type { LoadComponentsReturnType } from '../server/load-components'\n+import type {\n+  GenericComponentMod,\n+  LoadComponentsReturnType,\n+} from '../server/load-components'\n import type { OutgoingHttpHeaders } from 'http'\n import type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\n import type { CacheControl } from '../server/lib/cache-control'\n@@ -86,8 +89,9 @@ export type ExportPagesResult = {\n export type WorkerRenderOptsPartial = PagesRenderOptsPartial &\n   AppRenderOptsPartial\n \n-export type WorkerRenderOpts = WorkerRenderOptsPartial &\n-  LoadComponentsReturnType\n+export type WorkerRenderOpts<\n+  NextModule extends GenericComponentMod = GenericComponentMod,\n+> = WorkerRenderOptsPartial & LoadComponentsReturnType<NextModule>\n \n export interface ExportAppOptions {\n   staticWorker?: StaticWorker"
        },
        {
            "sha": "1e5077851c556f6279e1d99a089a8bbc2c167345",
            "filename": "packages/next/src/export/worker.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 31,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -7,6 +7,8 @@ import type {\n   ExportPagesResult,\n   ExportPathEntry,\n } from './types'\n+import type { AppPageModule } from '../server/route-modules/app-page/module'\n+import type { PagesModule } from '../server/route-modules/pages/module.compiled'\n \n import '../server/node-environment'\n \n@@ -278,46 +280,46 @@ async function exportPageImpl(\n       pathname,\n       query,\n       fallbackRouteParams,\n-      renderOpts,\n+      renderOpts as WorkerRenderOpts<AppPageModule>,\n       htmlFilepath,\n       debugOutput,\n       isDynamicError,\n       fileWriter,\n       sharedContext\n     )\n-  }\n+  } else {\n+    const sharedContext: PagesSharedContext = {\n+      buildId,\n+      deploymentId: commonRenderOpts.deploymentId,\n+      customServer: undefined,\n+    }\n \n-  const sharedContext: PagesSharedContext = {\n-    buildId,\n-    deploymentId: commonRenderOpts.deploymentId,\n-    customServer: undefined,\n-  }\n+    const renderContext: PagesRenderContext = {\n+      isFallback: exportPath._pagesFallback ?? false,\n+      isDraftMode: false,\n+      developmentNotFoundSourcePage: undefined,\n+    }\n \n-  const renderContext: PagesRenderContext = {\n-    isFallback: exportPath._pagesFallback ?? false,\n-    isDraftMode: false,\n-    developmentNotFoundSourcePage: undefined,\n+    return exportPagesPage(\n+      req,\n+      res,\n+      path,\n+      page,\n+      query,\n+      params,\n+      htmlFilepath,\n+      htmlFilename,\n+      pagesDataDir,\n+      buildExport,\n+      isDynamic,\n+      sharedContext,\n+      renderContext,\n+      hasOrigQueryValues,\n+      renderOpts as WorkerRenderOpts<PagesModule>,\n+      components,\n+      fileWriter\n+    )\n   }\n-\n-  return exportPagesPage(\n-    req,\n-    res,\n-    path,\n-    page,\n-    query,\n-    params,\n-    htmlFilepath,\n-    htmlFilename,\n-    pagesDataDir,\n-    buildExport,\n-    isDynamic,\n-    sharedContext,\n-    renderContext,\n-    hasOrigQueryValues,\n-    renderOpts,\n-    components,\n-    fileWriter\n-  )\n }\n \n export async function exportPages("
        },
        {
            "sha": "bb458f84ebd2caf9e6e18583b2939e81896aac66",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 17,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -1,5 +1,8 @@\n import type { __ApiPreviewProps } from './api-utils'\n-import type { LoadComponentsReturnType } from './load-components'\n+import type {\n+  GenericComponentMod,\n+  LoadComponentsReturnType,\n+} from './load-components'\n import type { MiddlewareRouteMatch } from '../shared/lib/router/utils/middleware-route-matcher'\n import type { Params } from './request/params'\n import type { NextConfig, NextConfigComplete } from './config-shared'\n@@ -147,9 +150,12 @@ import type { CacheControl } from './lib/cache-control'\n import type { PrerenderedRoute } from '../build/static-paths/types'\n import { createOpaqueFallbackRouteParams } from './request/fallback-params'\n import { RouteKind } from './route-kind'\n+import type { ErrorModule } from './load-default-error-components'\n \n-export type FindComponentsResult = {\n-  components: LoadComponentsReturnType\n+export type FindComponentsResult<\n+  NextModule extends GenericComponentMod = GenericComponentMod,\n+> = {\n+  components: LoadComponentsReturnType<NextModule>\n   query: NextParsedUrlQuery\n }\n \n@@ -231,9 +237,9 @@ export interface Options {\n \n export type RenderOpts = PagesRenderOptsPartial & AppRenderOptsPartial\n \n-export type LoadedRenderOpts = RenderOpts &\n-  LoadComponentsReturnType &\n-  RequestLifecycleOpts\n+export type LoadedRenderOpts<\n+  NextModule extends GenericComponentMod = GenericComponentMod,\n+> = RenderOpts & LoadComponentsReturnType<NextModule> & RequestLifecycleOpts\n \n export type RequestLifecycleOpts = {\n   waitUntil: ((promise: Promise<any>) => void) | undefined\n@@ -2340,15 +2346,7 @@ export default abstract class Server<\n       addRequestMeta(request, 'invokeError', opts.err)\n     }\n \n-    const handler: (\n-      req: ServerRequest | IncomingMessage,\n-      res: ServerResponse | HTTPServerResponse,\n-      ctx: {\n-        waitUntil: ReturnType<Server['getWaitUntil']>\n-      }\n-    ) => Promise<void> = components.ComponentMod.handler\n-\n-    const maybeDevRequest =\n+    const maybeDevRequest: ServerRequest | IncomingMessage =\n       // we need to capture fetch metrics when they are set\n       // and can't wait for handler to resolve as the fetch\n       // metrics are logged on response close which happens\n@@ -2371,7 +2369,14 @@ export default abstract class Server<\n           })\n         : request\n \n-    await handler(maybeDevRequest, response, {\n+    // @ts-expect-error This isn't entirely correct, but the ServerRequest type param seems overly\n+    // generic anyway.\n+    let handlerReq: IncomingMessage = maybeDevRequest\n+    // @ts-expect-error This isn't entirely correct, but the ServerResponse type param seems overly\n+    // generic anyway.\n+    let handlerRes: HTTPServerResponse = response\n+\n+    await components.ComponentMod.handler(handlerReq, handlerRes, {\n       waitUntil: this.getWaitUntil(),\n     })\n \n@@ -2469,7 +2474,7 @@ export default abstract class Server<\n   protected abstract getMiddleware(): Promise<MiddlewareRoutingItem | undefined>\n   protected abstract getFallbackErrorComponents(\n     url?: string\n-  ): Promise<LoadComponentsReturnType | null>\n+  ): Promise<LoadComponentsReturnType<ErrorModule> | null>\n   protected abstract getRoutesManifest(): NormalizedRouteManifest | undefined\n \n   private async renderToResponseImpl("
        },
        {
            "sha": "1b16787787ef553fa932a1e7f69cbe7395d72ee7",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -44,7 +44,10 @@ import { traceGlobals } from '../../trace/shared'\n import { findPageFile } from '../lib/find-page-file'\n import { getFormattedNodeOptionsWithoutInspect } from '../lib/utils'\n import { withCoalescedInvoke } from '../../lib/coalesced-function'\n-import { loadDefaultErrorComponents } from '../load-default-error-components'\n+import {\n+  loadDefaultErrorComponents,\n+  type ErrorModule,\n+} from '../load-default-error-components'\n import { DecodeError, MiddlewareNotFoundError } from '../../shared/lib/utils'\n import * as Log from '../../build/output/log'\n import isError, { getProperError } from '../../lib/is-error'\n@@ -986,7 +989,7 @@ export default class DevServer extends Server {\n \n   protected async getFallbackErrorComponents(\n     url?: string\n-  ): Promise<LoadComponentsReturnType | null> {\n+  ): Promise<LoadComponentsReturnType<ErrorModule> | null> {\n     await this.bundlerService.getFallbackErrorComponents(url)\n     return await loadDefaultErrorComponents(this.distDir)\n   }"
        },
        {
            "sha": "67a65cee0c4e197bb020006a43e01d58d9db6d43",
            "filename": "packages/next/src/server/dev/static-paths-worker.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -1,4 +1,12 @@\n import type { NextConfigComplete } from '../config-shared'\n+import type {\n+  AppPageModule,\n+  AppPageRouteModule,\n+} from '../route-modules/app-page/module'\n+import type {\n+  AppRouteModule,\n+  AppRouteRouteModule,\n+} from '../route-modules/app-route/module.compiled'\n \n import '../require-hook'\n import '../node-environment'\n@@ -18,8 +26,6 @@ import { collectRootParamKeys } from '../../build/segment-config/app/collect-roo\n import { buildAppStaticPaths } from '../../build/static-paths/app'\n import { buildPagesStaticPaths } from '../../build/static-paths/pages'\n import { createIncrementalCache } from '../../export/helpers/create-incremental-cache'\n-import type { AppPageRouteModule } from '../route-modules/app-page/module'\n-import type { AppRouteRouteModule } from '../route-modules/app-route/module'\n import { parseAppRoute } from '../../shared/lib/router/routes/app'\n \n type RuntimeConfig = {\n@@ -94,7 +100,7 @@ export async function loadStaticPaths({\n     httpAgentOptions,\n   })\n \n-  const components = await loadComponents({\n+  const components = await loadComponents<AppPageModule | AppRouteModule>({\n     distDir,\n     // In `pages/`, the page is the same as the pathname.\n     page: page || pathname,"
        },
        {
            "sha": "b9ef663a461c12497d6edaa95e732df826e21f5f",
            "filename": "packages/next/src/server/load-components.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -1,3 +1,4 @@\n+import type { IncomingMessage, ServerResponse } from 'node:http'\n import type {\n   AppType,\n   DocumentType,\n@@ -58,7 +59,19 @@ export interface LoadableManifest {\n   [k: string]: { id: string | number; files: string[] }\n }\n \n-export type LoadComponentsReturnType<NextModule = any> = {\n+export type GenericComponentMod = {\n+  handler(\n+    req: IncomingMessage,\n+    res: ServerResponse,\n+    ctx: {\n+      waitUntil?: (prom: Promise<void>) => void\n+    }\n+  ): Promise<void | null>\n+}\n+\n+export type LoadComponentsReturnType<\n+  NextModule extends GenericComponentMod = GenericComponentMod,\n+> = {\n   Component: NextComponentType\n   pageConfig: PageConfig\n   buildManifest: DeepReadonly<BuildManifest>\n@@ -144,7 +157,9 @@ async function tryLoadClientReferenceManifest(\n   }\n }\n \n-async function loadComponentsImpl<N = any>({\n+async function loadComponentsImpl<\n+  N extends GenericComponentMod = GenericComponentMod,\n+>({\n   distDir,\n   page,\n   isAppPath,"
        },
        {
            "sha": "21002f44d575d050a680d9f599c6ac152bacbad1",
            "filename": "packages/next/src/server/load-default-error-components.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 30,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fload-default-error-components.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fload-default-error-components.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fload-default-error-components.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -1,50 +1,26 @@\n-import type {\n-  AppType,\n-  DocumentType,\n-  NextComponentType,\n-} from '../shared/lib/utils'\n-import type {\n-  PageConfig,\n-  GetStaticPaths,\n-  GetServerSideProps,\n-  GetStaticProps,\n-} from '../types'\n-import type { RouteModule } from './route-modules/route-module'\n import type { BuildManifest } from './get-page-files'\n \n import { BUILD_MANIFEST } from '../shared/lib/constants'\n import { join } from 'path'\n import { interopDefault } from '../lib/interop-default'\n import { getTracer } from './lib/trace/tracer'\n import { LoadComponentsSpan } from './lib/trace/constants'\n-import { loadManifestWithRetries } from './load-components'\n+import {\n+  loadManifestWithRetries,\n+  type LoadComponentsReturnType,\n+} from './load-components'\n export type ManifestItem = {\n   id: number | string\n   files: string[]\n }\n \n export type ReactLoadableManifest = { [moduleId: string]: ManifestItem }\n \n-export type LoadComponentsReturnType = {\n-  Component: NextComponentType\n-  pageConfig: PageConfig\n-  buildManifest: BuildManifest\n-  subresourceIntegrityManifest?: Record<string, string>\n-  reactLoadableManifest: ReactLoadableManifest\n-  Document: DocumentType\n-  App: AppType\n-  getStaticProps?: GetStaticProps\n-  getStaticPaths?: GetStaticPaths\n-  getServerSideProps?: GetServerSideProps\n-  ComponentMod: any\n-  routeModule: RouteModule\n-  isAppPath?: boolean\n-  page: string\n-}\n+export type ErrorModule = typeof import('./route-modules/pages/builtin/_error')\n \n async function loadDefaultErrorComponentsImpl(\n   distDir: string\n-): Promise<LoadComponentsReturnType> {\n+): Promise<LoadComponentsReturnType<ErrorModule>> {\n   // eslint-disable-next-line @next/internal/typechecked-require -- Why not relative imports?\n   const Document = interopDefault(require('next/dist/pages/_document'))\n   // eslint-disable-next-line @next/internal/typechecked-require -- Why not relative imports?"
        },
        {
            "sha": "56ef04cc83bdb508f8bdcb46bc2cd6609dac6866",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 27,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -27,6 +27,10 @@ import type { ParsedUrlQuery } from 'querystring'\n import type { ParsedUrl } from '../shared/lib/router/utils/parse-url'\n import type { CacheControl } from './lib/cache-control'\n import type { WaitUntil } from './after/builtin-request-context'\n+import type { AppPageModule } from './route-modules/app-page/module'\n+import type { AppRouteModule } from './route-modules/app-route/module.compiled'\n+import type { ErrorModule } from './load-default-error-components'\n+import type { PagesModule } from './route-modules/pages/module.compiled'\n \n import fs from 'fs'\n import { join, relative } from 'path'\n@@ -387,7 +391,9 @@ export default class NextNodeServer extends BaseServer<\n \n     for (const page of Object.keys(appPathsManifest || {})) {\n       try {\n-        const { ComponentMod } = await loadComponents({\n+        const { ComponentMod } = await loadComponents<\n+          AppPageModule | AppRouteModule\n+        >({\n           distDir: this.distDir,\n           page,\n           isAppPath: true,\n@@ -709,37 +715,37 @@ export default class NextNodeServer extends BaseServer<\n           // This code path does not service revalidations for unknown param\n           // shells. As a result, we don't need to pass in the unknown params.\n           null,\n-          renderOpts,\n+          renderOpts as LoadedRenderOpts<AppPageModule>,\n           this.getServerComponentsHmrCache(),\n           {\n             buildId: this.buildId,\n           }\n         )\n-      }\n-\n-      // TODO: re-enable this once we've refactored to use implicit matches\n-      // throw new Error('Invariant: render should have used routeModule')\n+      } else {\n+        // TODO: re-enable this once we've refactored to use implicit matches\n+        // throw new Error('Invariant: render should have used routeModule')\n \n-      return lazyRenderPagesPage(\n-        req.originalRequest,\n-        res.originalResponse,\n-        pathname,\n-        query,\n-        renderOpts,\n-        {\n-          buildId: this.buildId,\n-          deploymentId: this.nextConfig.deploymentId,\n-          customServer: this.serverOptions.customServer || undefined,\n-        },\n-        {\n-          isFallback: false,\n-          isDraftMode: renderOpts.isDraftMode,\n-          developmentNotFoundSourcePage: getRequestMeta(\n-            req,\n-            'developmentNotFoundSourcePage'\n-          ),\n-        }\n-      )\n+        return lazyRenderPagesPage(\n+          req.originalRequest,\n+          res.originalResponse,\n+          pathname,\n+          query,\n+          renderOpts as LoadedRenderOpts<PagesModule>,\n+          {\n+            buildId: this.buildId,\n+            deploymentId: this.nextConfig.deploymentId,\n+            customServer: this.serverOptions.customServer || undefined,\n+          },\n+          {\n+            isFallback: false,\n+            isDraftMode: renderOpts.isDraftMode,\n+            developmentNotFoundSourcePage: getRequestMeta(\n+              req,\n+              'developmentNotFoundSourcePage'\n+            ),\n+          }\n+        )\n+      }\n     }\n   }\n \n@@ -2116,7 +2122,7 @@ export default class NextNodeServer extends BaseServer<\n \n   protected async getFallbackErrorComponents(\n     _url?: string\n-  ): Promise<LoadComponentsReturnType | null> {\n+  ): Promise<LoadComponentsReturnType<ErrorModule> | null> {\n     // Not implemented for production use cases, this is implemented on the\n     // development server.\n     return null"
        },
        {
            "sha": "ac9b4474cbd36493b6a9d07cef9200b292dd4ef9",
            "filename": "packages/next/src/server/web/sandbox/sandbox.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fsandbox%2Fsandbox.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c964caa5ebf3d280f287adabaed4771dce52a3d7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fsandbox%2Fsandbox.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fsandbox%2Fsandbox.ts?ref=c964caa5ebf3d280f287adabaed4771dce52a3d7",
            "patch": "@@ -104,6 +104,7 @@ export async function getRuntimeContext(\n export const run = withTaggedErrors(async function runWithTaggedErrors(params) {\n   const runtime = await getRuntimeContext(params)\n \n+  // TODO better typesafety here\n   const edgeFunction: (args: {\n     request: RequestData\n   }) => Promise<FetchEventResult> = ("
        }
    ],
    "stats": {
        "total": 262,
        "additions": 144,
        "deletions": 118
    }
}