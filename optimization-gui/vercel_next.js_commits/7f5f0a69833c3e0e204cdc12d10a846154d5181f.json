{
    "author": "huozhi",
    "message": "enhance debug-build-paths on glob cases (#86953)",
    "sha": "7f5f0a69833c3e0e204cdc12d10a846154d5181f",
    "files": [
        {
            "sha": "b0c5257a03fc4dcbd984db0b381f70733a123561",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -969,5 +969,6 @@\n   \"968\": \"Invariant: getNextConfigEdge must only be called in edge runtime\",\n   \"969\": \"Invariant: nextConfig couldn't be loaded\",\n   \"970\": \"process.env.NEXT_DEPLOYMENT_ID is missing but runtimeServerDeploymentId is enabled\",\n-  \"971\": \"The NEXT_DEPLOYMENT_ID environment variable value \\\"%s\\\" does not match the provided deploymentId \\\"%s\\\" in the config.\"\n+  \"971\": \"The NEXT_DEPLOYMENT_ID environment variable value \\\"%s\\\" does not match the provided deploymentId \\\"%s\\\" in the config.\",\n+  \"972\": \"Failed to resolve pattern \\\"%s\\\": %s\"\n }"
        },
        {
            "sha": "211117216e8882a5b4c6fc7199bc87e35fa2d0ce",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -1132,6 +1132,10 @@ export default async function build(\n         nextBuildSpan,\n         config,\n         cacheDir,\n+        debugBuildPaths:\n+          debugBuildAppPaths !== undefined || debugBuildPagePaths !== undefined\n+            ? { app: debugBuildAppPaths, pages: debugBuildPagePaths }\n+            : undefined,\n       }\n \n       if (appDir && 'exportPathMap' in config) {"
        },
        {
            "sha": "95fad78cedf3bbaec8623dcc54a74bfb0d5e38af",
            "filename": "packages/next/src/build/type-check.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -20,15 +20,17 @@ import { hrtimeDurationToString } from './duration-to-string'\n function verifyTypeScriptSetup(\n   dir: string,\n   distDir: string,\n-  intentDirs: string[],\n   typeCheckPreflight: boolean,\n   tsconfigPath: string | undefined,\n   disableStaticImages: boolean,\n   cacheDir: string | undefined,\n   enableWorkerThreads: boolean | undefined,\n   hasAppDir: boolean,\n   hasPagesDir: boolean,\n-  isolatedDevBuild: boolean | undefined\n+  isolatedDevBuild: boolean | undefined,\n+  appDir: string | undefined,\n+  pagesDir: string | undefined,\n+  debugBuildPaths: { app?: string[]; pages?: string[] } | undefined\n ) {\n   const typeCheckWorker = new Worker(\n     require.resolve('../lib/verify-typescript-setup'),\n@@ -48,14 +50,16 @@ function verifyTypeScriptSetup(\n     .verifyTypeScriptSetup({\n       dir,\n       distDir,\n-      intentDirs,\n       typeCheckPreflight,\n       tsconfigPath,\n       disableStaticImages,\n       cacheDir,\n       hasAppDir,\n       hasPagesDir,\n       isolatedDevBuild,\n+      appDir,\n+      pagesDir,\n+      debugBuildPaths,\n     })\n     .then((result) => {\n       typeCheckWorker.end()\n@@ -76,6 +80,7 @@ export async function startTypeChecking({\n   pagesDir,\n   telemetry,\n   appDir,\n+  debugBuildPaths,\n }: {\n   cacheDir: string\n   config: NextConfigComplete\n@@ -84,6 +89,7 @@ export async function startTypeChecking({\n   pagesDir?: string\n   telemetry: Telemetry\n   appDir?: string\n+  debugBuildPaths?: { app?: string[]; pages?: string[] }\n }) {\n   const ignoreTypeScriptErrors = Boolean(config.typescript.ignoreBuildErrors)\n \n@@ -111,15 +117,17 @@ export async function startTypeChecking({\n         verifyTypeScriptSetup(\n           dir,\n           config.distDir,\n-          [pagesDir, appDir].filter(Boolean) as string[],\n           !ignoreTypeScriptErrors,\n           config.typescript.tsconfigPath,\n           config.images.disableStaticImages,\n           cacheDir,\n           config.experimental.workerThreads,\n           !!appDir,\n           !!pagesDir,\n-          config.experimental.isolatedDevBuild\n+          config.experimental.isolatedDevBuild,\n+          appDir,\n+          pagesDir,\n+          debugBuildPaths\n         ).then((resolved) => {\n           const checkEnd = process.hrtime(typeCheckAndLintStart)\n           return [resolved, checkEnd] as const"
        },
        {
            "sha": "91a76a7e4a924e2d31199239d5ef0660577930e9",
            "filename": "packages/next/src/cli/next-test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-test.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -140,13 +140,14 @@ async function runPlaywright(\n     const { version: typeScriptVersion } = await verifyTypeScriptSetup({\n       dir: baseDir,\n       distDir: nextConfig.distDir,\n-      intentDirs: [pagesDir, appDir].filter(Boolean) as string[],\n       typeCheckPreflight: false,\n       tsconfigPath: nextConfig.typescript.tsconfigPath,\n       disableStaticImages: nextConfig.images.disableStaticImages,\n       hasAppDir: !!appDir,\n       hasPagesDir: !!pagesDir,\n       isolatedDevBuild: nextConfig.experimental.isolatedDevBuild,\n+      appDir: appDir || undefined,\n+      pagesDir: pagesDir || undefined,\n     })\n \n     const isUsingTypeScript = !!typeScriptVersion"
        },
        {
            "sha": "796a5d0e7332d401a2baab5c5130b3bd3c91a939",
            "filename": "packages/next/src/cli/next-typegen.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -57,13 +57,14 @@ const nextTypegen = async (\n   await verifyTypeScriptSetup({\n     dir: baseDir,\n     distDir: nextConfig.distDir,\n-    intentDirs: [pagesDir, appDir].filter(Boolean) as string[],\n     typeCheckPreflight: false,\n     tsconfigPath: nextConfig.typescript.tsconfigPath,\n     disableStaticImages: nextConfig.images.disableStaticImages,\n     hasAppDir: !!appDir,\n     hasPagesDir: !!pagesDir,\n     isolatedDevBuild: nextConfig.experimental.isolatedDevBuild,\n+    appDir: appDir || undefined,\n+    pagesDir: pagesDir || undefined,\n   })\n \n   console.log('Generating route types...')"
        },
        {
            "sha": "ee328129b1920179788026d637514d450cadf03f",
            "filename": "packages/next/src/lib/resolve-build-paths.ts",
            "status": "modified",
            "additions": 52,
            "deletions": 84,
            "changes": 136,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Fresolve-build-paths.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Fresolve-build-paths.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fresolve-build-paths.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -13,12 +13,36 @@ interface ResolvedBuildPaths {\n }\n \n /**\n- * Resolves glob patterns and explicit paths to actual file paths\n- * Categorizes them into App Router and Pages Router paths\n+ * Escapes bracket expressions that correspond to existing directories.\n+ * This allows Next.js dynamic routes like [slug] to work with glob patterns.\n  *\n- * @param patterns - Array of glob patterns or explicit paths\n- * @param projectDir - Root project directory\n- * @returns Object with categorized app and page paths\n+ * e.g., \"app/blog/[slug]/** /page.tsx\" → \"app/blog/\\[slug\\]/** /page.tsx\"\n+ *       (if app/blog/[slug] directory exists)\n+ */\n+function escapeExistingBrackets(pattern: string, projectDir: string): string {\n+  // Match bracket expressions: [name], [...name], [[...name]]\n+  const bracketRegex = /\\[\\[?\\.\\.\\.[^\\]]+\\]?\\]|\\[[^\\]]+\\]/g\n+  let lastIndex = 0\n+  let result = ''\n+  let match: RegExpExecArray | null\n+\n+  while ((match = bracketRegex.exec(pattern)) !== null) {\n+    const pathPrefix = pattern.slice(0, match.index + match[0].length)\n+    const exists = fs.existsSync(path.join(projectDir, pathPrefix))\n+\n+    result += pattern.slice(lastIndex, match.index)\n+    result += exists\n+      ? match[0].replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]')\n+      : match[0]\n+    lastIndex = match.index + match[0].length\n+  }\n+\n+  return result + pattern.slice(lastIndex)\n+}\n+\n+/**\n+ * Resolves glob patterns and explicit paths to actual file paths.\n+ * Categorizes them into App Router and Pages Router paths.\n  */\n export async function resolveBuildPaths(\n   patterns: string[],\n@@ -29,41 +53,30 @@ export async function resolveBuildPaths(\n \n   for (const pattern of patterns) {\n     const trimmed = pattern.trim()\n+    if (!trimmed) continue\n \n-    if (!trimmed) {\n-      continue\n-    }\n-\n-    // Detect if pattern is glob pattern (contains glob special chars)\n-    const isGlobPattern = /[*?[\\]{}!]/.test(trimmed)\n+    try {\n+      // Escape brackets that correspond to existing Next.js dynamic route directories\n+      const escapedPattern = escapeExistingBrackets(trimmed, projectDir)\n+      const matches = (await glob(escapedPattern, {\n+        cwd: projectDir,\n+      })) as string[]\n \n-    if (isGlobPattern) {\n-      try {\n-        // Resolve glob pattern\n-        const matches = (await glob(trimmed, {\n-          cwd: projectDir,\n-        })) as string[]\n-\n-        if (matches.length === 0) {\n-          Log.warn(`Glob pattern \"${trimmed}\" did not match any files`)\n-        }\n+      if (matches.length === 0) {\n+        Log.warn(`Pattern \"${trimmed}\" did not match any files`)\n+      }\n \n-        for (const file of matches) {\n-          // Skip directories, only process files\n-          if (!fs.statSync(path.join(projectDir, file)).isDirectory()) {\n-            categorizeAndAddPath(file, appPaths, pagePaths)\n-          }\n+      for (const file of matches) {\n+        if (!fs.statSync(path.join(projectDir, file)).isDirectory()) {\n+          categorizeAndAddPath(file, appPaths, pagePaths)\n         }\n-      } catch (error) {\n-        throw new Error(\n-          `Failed to resolve glob pattern \"${trimmed}\": ${\n-            isError(error) ? error.message : String(error)\n-          }`\n-        )\n       }\n-    } else {\n-      // Explicit path - categorize based on prefix\n-      categorizeAndAddPath(trimmed, appPaths, pagePaths, projectDir)\n+    } catch (error) {\n+      throw new Error(\n+        `Failed to resolve pattern \"${trimmed}\": ${\n+          isError(error) ? error.message : String(error)\n+        }`\n+      )\n     }\n   }\n \n@@ -74,68 +87,23 @@ export async function resolveBuildPaths(\n }\n \n /**\n- * Categorizes a file path to either app or pages router based on its prefix,\n- * and normalizes it to the format expected by Next.js internal build system.\n- *\n- * The internal build system expects:\n- * - App router: paths with leading slash (e.g., \"/page.tsx\", \"/dashboard/page.tsx\")\n- * - Pages router: paths with leading slash (e.g., \"/index.tsx\", \"/about.tsx\")\n+ * Categorizes a file path to either app or pages router based on its prefix.\n  *\n  * Examples:\n  * - \"app/page.tsx\" → appPaths.add(\"/page.tsx\")\n- * - \"app/dashboard/page.tsx\" → appPaths.add(\"/dashboard/page.tsx\")\n  * - \"pages/index.tsx\" → pagePaths.add(\"/index.tsx\")\n- * - \"pages/about.tsx\" → pagePaths.add(\"/about.tsx\")\n- * - \"/page.tsx\" → appPaths.add(\"/page.tsx\") (already in app router format)\n  */\n function categorizeAndAddPath(\n   filePath: string,\n   appPaths: Set<string>,\n-  pagePaths: Set<string>,\n-  projectDir?: string\n+  pagePaths: Set<string>\n ): void {\n-  // Normalize path separators to forward slashes (Windows compatibility)\n   const normalized = filePath.replace(/\\\\/g, '/')\n \n-  // Skip non-file entries (like directories without extensions)\n-  if (normalized.endsWith('/')) {\n-    return\n-  }\n-\n   if (normalized.startsWith('app/')) {\n-    // App router path: remove 'app/' prefix and ensure leading slash\n-    // \"app/page.tsx\" → \"/page.tsx\"\n-    // \"app/dashboard/page.tsx\" → \"/dashboard/page.tsx\"\n-    const withoutPrefix = normalized.slice(4) // Remove \"app/\"\n-    appPaths.add('/' + withoutPrefix)\n+    appPaths.add('/' + normalized.slice(4))\n   } else if (normalized.startsWith('pages/')) {\n-    // Pages router path: remove 'pages/' prefix and add leading slash\n-    // \"pages/index.tsx\" → \"/index.tsx\"\n-    // \"pages/about.tsx\" → \"/about.tsx\"\n-    const withoutPrefix = normalized.slice(6) // Remove \"pages/\"\n-    pagePaths.add('/' + withoutPrefix)\n-  } else if (normalized.startsWith('/')) {\n-    // Leading slash suggests app router format (already in correct format)\n-    // \"/page.tsx\" → \"/page.tsx\" (no change needed)\n-    appPaths.add(normalized)\n-  } else {\n-    // No obvious prefix - try to detect based on file existence\n-    if (projectDir) {\n-      const appPath = path.join(projectDir, 'app', normalized)\n-      const pagesPath = path.join(projectDir, 'pages', normalized)\n-\n-      if (fs.existsSync(appPath)) {\n-        appPaths.add('/' + normalized)\n-      } else if (fs.existsSync(pagesPath)) {\n-        pagePaths.add('/' + normalized)\n-      } else {\n-        // Default to pages router for paths without clear indicator\n-        pagePaths.add('/' + normalized)\n-      }\n-    } else {\n-      // Without projectDir context, default to pages router\n-      pagePaths.add('/' + normalized)\n-    }\n+    pagePaths.add('/' + normalized.slice(6))\n   }\n }\n "
        },
        {
            "sha": "e930ac0bef0f21cda05e793636f5812447a7b55f",
            "filename": "packages/next/src/lib/typescript/runTypeCheck.ts",
            "status": "modified",
            "additions": 65,
            "deletions": 1,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FrunTypeCheck.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FrunTypeCheck.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FrunTypeCheck.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -16,14 +16,37 @@ export interface TypeCheckResult {\n   incremental: boolean\n }\n \n+export interface TypeCheckDirs {\n+  app?: string\n+  pages?: string\n+}\n+\n+export interface DebugBuildPaths {\n+  app?: string[]\n+  pages?: string[]\n+}\n+\n+/**\n+ * Check if a file path matches any of the debug build paths.\n+ * Both filePath and debugPaths are resolved file paths from glob.\n+ */\n+function fileMatchesDebugPaths(\n+  filePath: string,\n+  debugPaths: string[]\n+): boolean {\n+  return debugPaths.includes(filePath)\n+}\n+\n export async function runTypeCheck(\n   typescript: typeof import('typescript'),\n   baseDir: string,\n   distDir: string,\n   tsConfigPath: string,\n   cacheDir?: string,\n   isAppDirEnabled?: boolean,\n-  isolatedDevBuild?: boolean\n+  isolatedDevBuild?: boolean,\n+  dirs?: TypeCheckDirs,\n+  debugBuildPaths?: DebugBuildPaths\n ): Promise<TypeCheckResult> {\n   const effectiveConfiguration = await getTypeScriptConfiguration(\n     typescript,\n@@ -52,6 +75,47 @@ export async function runTypeCheck(\n     )\n   }\n \n+  // Apply debug build paths filter if specified\n+  if (dirs && debugBuildPaths) {\n+    const { app: appDir, pages: pagesDir } = dirs\n+    const { app: debugAppPaths, pages: debugPagePaths } = debugBuildPaths\n+\n+    fileNames = fileNames.filter((fileName) => {\n+      // Check if file is in app directory\n+      if (appDir && fileName.startsWith(appDir + path.sep)) {\n+        // If debugAppPaths is undefined, include all app files\n+        if (debugAppPaths === undefined) {\n+          return true\n+        }\n+        // If debugAppPaths is empty array, exclude all app files\n+        if (debugAppPaths.length === 0) {\n+          return false\n+        }\n+        // Check if file matches any of the debug paths\n+        const relativeToApp = fileName.slice(appDir.length)\n+        return fileMatchesDebugPaths(relativeToApp, debugAppPaths)\n+      }\n+\n+      // Check if file is in pages directory\n+      if (pagesDir && fileName.startsWith(pagesDir + path.sep)) {\n+        // If debugPagePaths is undefined, include all pages files\n+        if (debugPagePaths === undefined) {\n+          return true\n+        }\n+        // If debugPagePaths is empty array, exclude all pages files\n+        if (debugPagePaths.length === 0) {\n+          return false\n+        }\n+        // Check if file matches any of the debug paths\n+        const relativeToPages = fileName.slice(pagesDir.length)\n+        return fileMatchesDebugPaths(relativeToPages, debugPagePaths)\n+      }\n+\n+      // Keep files outside app/pages directories (shared code, etc.)\n+      return true\n+    })\n+  }\n+\n   if (fileNames.length < 1) {\n     return {\n       hasWarnings: false,"
        },
        {
            "sha": "bec4cedd8a50dd1f3b6af2653ff23a2971c938b2",
            "filename": "packages/next/src/lib/verify-typescript-setup.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -37,28 +37,35 @@ export async function verifyTypeScriptSetup({\n   dir,\n   distDir,\n   cacheDir,\n-  intentDirs,\n   tsconfigPath,\n   typeCheckPreflight,\n   disableStaticImages,\n   hasAppDir,\n   hasPagesDir,\n   isolatedDevBuild,\n+  appDir,\n+  pagesDir,\n+  debugBuildPaths,\n }: {\n   dir: string\n   distDir: string\n   cacheDir?: string\n   tsconfigPath: string | undefined\n-  intentDirs: string[]\n   typeCheckPreflight: boolean\n   disableStaticImages: boolean\n   hasAppDir: boolean\n   hasPagesDir: boolean\n   isolatedDevBuild: boolean | undefined\n+  appDir?: string\n+  pagesDir?: string\n+  debugBuildPaths?: { app?: string[]; pages?: string[] }\n }): Promise<{ result?: TypeCheckResult; version: string | null }> {\n   const tsConfigFileName = tsconfigPath || 'tsconfig.json'\n   const resolvedTsConfigPath = path.join(dir, tsConfigFileName)\n \n+  // Construct intentDirs from appDir and pagesDir for getTypeScriptIntent\n+  const intentDirs = [pagesDir, appDir].filter(Boolean) as string[]\n+\n   try {\n     // Check if the project uses TypeScript:\n     const intent = await getTypeScriptIntent(dir, intentDirs, tsConfigFileName)\n@@ -159,7 +166,9 @@ export async function verifyTypeScriptSetup({\n         resolvedTsConfigPath,\n         cacheDir,\n         hasAppDir,\n-        isolatedDevBuild\n+        isolatedDevBuild,\n+        { app: appDir, pages: pagesDir },\n+        debugBuildPaths\n       )\n     }\n     return { result, version: typescriptVersion }"
        },
        {
            "sha": "def090ff6d7696a8403532a47d6ec2b34a0b28cf",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -143,13 +143,14 @@ async function verifyTypeScript(opts: SetupOpts) {\n   const verifyResult = await verifyTypeScriptSetup({\n     dir: opts.dir,\n     distDir: opts.nextConfig.distDir,\n-    intentDirs: [opts.pagesDir, opts.appDir].filter(Boolean) as string[],\n     typeCheckPreflight: false,\n     tsconfigPath: opts.nextConfig.typescript.tsconfigPath,\n     disableStaticImages: opts.nextConfig.images.disableStaticImages,\n     hasAppDir: !!opts.appDir,\n     hasPagesDir: !!opts.pagesDir,\n     isolatedDevBuild: opts.nextConfig.experimental.isolatedDevBuild,\n+    appDir: opts.appDir,\n+    pagesDir: opts.pagesDir,\n   })\n \n   if (verifyResult.version) {"
        },
        {
            "sha": "f8695f565e1b810b88333cfda879c8156b8766e0",
            "filename": "test/production/debug-build-path/app/blog/[slug]/comments/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fcomments%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fcomments%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fcomments%2Fpage.tsx?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -0,0 +1,8 @@\n+export default async function Comments({\n+  params,\n+}: {\n+  params: Promise<{ slug: string }>\n+}) {\n+  const { slug } = await params\n+  return <h1>Comments for: {slug}</h1>\n+}"
        },
        {
            "sha": "43ed8bc3bfb42b5176b47b4e094f74cb966c0637",
            "filename": "test/production/debug-build-path/app/blog/[slug]/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -0,0 +1,8 @@\n+export default async function BlogPost({\n+  params,\n+}: {\n+  params: Promise<{ slug: string }>\n+}) {\n+  const { slug } = await params\n+  return <h1>Blog Post: {slug}</h1>\n+}"
        },
        {
            "sha": "4c2bd20f52cfdc254a612b12dcb28b0e56434b02",
            "filename": "test/production/debug-build-path/app/with-type-error/page.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fwith-type-error%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fwith-type-error%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fdebug-build-path%2Fapp%2Fwith-type-error%2Fpage.tsx?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -0,0 +1,6 @@\n+// This file has an intentional type error\n+const invalidValue: string = 123\n+\n+export default function WithTypeError() {\n+  return <div>WithTypeError: {invalidValue}</div>\n+}"
        },
        {
            "sha": "783633711e5f1d957981aa38e5eb3291455f0f4f",
            "filename": "test/production/debug-build-path/debug-build-paths.test.ts",
            "status": "modified",
            "additions": 108,
            "deletions": 0,
            "changes": 108,
            "blob_url": "https://github.com/vercel/next.js/blob/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fdebug-build-paths.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7f5f0a69833c3e0e204cdc12d10a846154d5181f/test%2Fproduction%2Fdebug-build-path%2Fdebug-build-paths.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fdebug-build-path%2Fdebug-build-paths.test.ts?ref=7f5f0a69833c3e0e204cdc12d10a846154d5181f",
            "patch": "@@ -40,6 +40,26 @@ describe('debug-build-paths', () => {\n       // Should not build app routes\n       expect(buildResult.cliOutput).not.toContain('Route (app)')\n     })\n+\n+    it('should build dynamic route with literal [slug] path', async () => {\n+      // Test that literal paths with brackets work without escaping\n+      // The path is checked for file existence before being treated as glob\n+      const buildResult = await next.build({\n+        args: ['--debug-build-paths', 'app/blog/[slug]/page.tsx'],\n+      })\n+      expect(buildResult.exitCode).toBe(0)\n+      expect(buildResult.cliOutput).toBeDefined()\n+\n+      // Should build only the blog/[slug] route\n+      expect(buildResult.cliOutput).toContain('Route (app)')\n+      expect(buildResult.cliOutput).toContain('/blog/[slug]')\n+      // Should not build other app routes\n+      expect(buildResult.cliOutput).not.toMatch(/○ \\/\\n/)\n+      expect(buildResult.cliOutput).not.toContain('○ /about')\n+      expect(buildResult.cliOutput).not.toContain('○ /dashboard')\n+      // Should not build pages routes\n+      expect(buildResult.cliOutput).not.toContain('Route (pages)')\n+    })\n   })\n \n   describe('glob pattern matching', () => {\n@@ -62,5 +82,93 @@ describe('debug-build-paths', () => {\n       expect(buildResult.cliOutput).not.toContain('○ /about')\n       expect(buildResult.cliOutput).not.toContain('○ /dashboard')\n     })\n+\n+    it('should match nested routes with app/blog/**/page.tsx pattern', async () => {\n+      const buildResult = await next.build({\n+        args: ['--debug-build-paths', 'app/blog/**/page.tsx'],\n+      })\n+      expect(buildResult.exitCode).toBe(0)\n+      expect(buildResult.cliOutput).toBeDefined()\n+\n+      // Should build the blog route\n+      expect(buildResult.cliOutput).toContain('Route (app)')\n+      expect(buildResult.cliOutput).toContain('/blog/[slug]')\n+      // Should not build other app routes (check for exact route, not substring)\n+      expect(buildResult.cliOutput).not.toMatch(/○ \\/\\n/)\n+      expect(buildResult.cliOutput).not.toContain('○ /about')\n+      expect(buildResult.cliOutput).not.toContain('○ /dashboard')\n+      // Should not build pages routes\n+      expect(buildResult.cliOutput).not.toContain('Route (pages)')\n+    })\n+\n+    it('should match hybrid pattern with literal [slug] and glob **', async () => {\n+      // Test pattern: app/blog/[slug]/**/page.tsx\n+      // [slug] should be treated as literal directory (exists on disk)\n+      // ** should be treated as glob (match any depth)\n+      const buildResult = await next.build({\n+        args: ['--debug-build-paths', 'app/blog/[slug]/**/page.tsx'],\n+      })\n+      expect(buildResult.exitCode).toBe(0)\n+      expect(buildResult.cliOutput).toBeDefined()\n+\n+      // Should build both blog/[slug] and blog/[slug]/comments routes\n+      expect(buildResult.cliOutput).toContain('Route (app)')\n+      expect(buildResult.cliOutput).toContain('/blog/[slug]')\n+      expect(buildResult.cliOutput).toContain('/blog/[slug]/comments')\n+      // Should not build other app routes\n+      expect(buildResult.cliOutput).not.toMatch(/○ \\/\\n/)\n+      expect(buildResult.cliOutput).not.toContain('○ /about')\n+      expect(buildResult.cliOutput).not.toContain('○ /dashboard')\n+      // Should not build pages routes\n+      expect(buildResult.cliOutput).not.toContain('Route (pages)')\n+    })\n+\n+    it('should match multiple app routes with explicit patterns', async () => {\n+      const buildResult = await next.build({\n+        args: [\n+          '--debug-build-paths',\n+          'app/page.tsx,app/about/page.tsx,app/dashboard/page.tsx,app/blog/**/page.tsx',\n+        ],\n+      })\n+      expect(buildResult.exitCode).toBe(0)\n+      expect(buildResult.cliOutput).toBeDefined()\n+\n+      // Should build specified app routes\n+      expect(buildResult.cliOutput).toContain('Route (app)')\n+      expect(buildResult.cliOutput).toContain('○ /')\n+      expect(buildResult.cliOutput).toContain('○ /about')\n+      expect(buildResult.cliOutput).toContain('○ /dashboard')\n+      expect(buildResult.cliOutput).toContain('/blog/[slug]')\n+      // Should not build routes not specified\n+      expect(buildResult.cliOutput).not.toContain('/with-type-error')\n+      // Should not build pages routes\n+      expect(buildResult.cliOutput).not.toContain('Route (pages)')\n+    })\n+  })\n+\n+  describe('typechecking with debug-build-paths', () => {\n+    it('should skip typechecking for excluded app routes', async () => {\n+      // Build only pages routes, excluding app routes with type error\n+      const buildResult = await next.build({\n+        args: ['--debug-build-paths', 'pages/foo.tsx'],\n+      })\n+      // Build should succeed because the file with type error is not checked\n+      expect(buildResult.exitCode).toBe(0)\n+      expect(buildResult.cliOutput).toContain('Route (pages)')\n+      expect(buildResult.cliOutput).toContain('○ /foo')\n+      // Should not include app routes\n+      expect(buildResult.cliOutput).not.toContain('Route (app)')\n+    })\n+\n+    it('should fail typechecking when route with type error is included', async () => {\n+      // Build all app routes including the one with type error\n+      const buildResult = await next.build({\n+        args: ['--debug-build-paths', 'app/**/page.tsx'],\n+      })\n+      // Build should fail due to type error in with-type-error/page.tsx\n+      expect(buildResult.exitCode).toBe(1)\n+      expect(buildResult.cliOutput).toContain('Type error')\n+      expect(buildResult.cliOutput).toContain('with-type-error/page.tsx')\n+    })\n   })\n })"
        }
    ],
    "stats": {
        "total": 381,
        "additions": 284,
        "deletions": 97
    }
}