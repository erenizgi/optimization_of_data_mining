{
    "author": "styfle",
    "message": "feat(next/legacy/image)!: deprecate and warn on `next/legacy/image` usage (#84622)\n\n`next/legacy/image` was introduced in Next.js 13 as way to allow\ndevelopers to upgrade from 12 to 13 with minimal effort.\n\nNow that its been 3 years, its time to deprecate `next/legacy/image` in\nNext.js 16 so we can remove it in a future version.\n\nThis will print a warning the first time the component is used.",
    "sha": "b41b737b2479bd83f22229b96085bdb13f177b8a",
    "files": [
        {
            "sha": "3fa1f5a49639a908ca4d88e64826feb3fde8d3b6",
            "filename": "docs/02-pages/04-api-reference/01-components/image-legacy.mdx",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b41b737b2479bd83f22229b96085bdb13f177b8a/docs%2F02-pages%2F04-api-reference%2F01-components%2Fimage-legacy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b41b737b2479bd83f22229b96085bdb13f177b8a/docs%2F02-pages%2F04-api-reference%2F01-components%2Fimage-legacy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F02-pages%2F04-api-reference%2F01-components%2Fimage-legacy.mdx?ref=b41b737b2479bd83f22229b96085bdb13f177b8a",
            "patch": "@@ -6,7 +6,7 @@ version: legacy\n \n Starting with Next.js 13, the `next/image` component was rewritten to improve both the performance and developer experience. In order to provide a backwards compatible upgrade solution, the old `next/image` was renamed to `next/legacy/image`.\n \n-View the **new** [`next/image` API Reference](/docs/pages/api-reference/components/image)\n+> **Warning**: `next/legacy/image` is deprecated and will be removed in a future version of Next.js. Please use [`next/image`](/docs/app/api-reference/components/image) instead.\n \n ## Comparison\n \n@@ -642,6 +642,7 @@ Auto-detection for animated files is best-effort and supports GIF, APNG, and Web\n \n ## Version History\n \n-| Version   | Changes                                     |\n-| --------- | ------------------------------------------- |\n-| `v13.0.0` | `next/image` renamed to `next/legacy/image` |\n+| Version   | Changes                                                                                                             |\n+| --------- | ------------------------------------------------------------------------------------------------------------------- |\n+| `v16.0.0` | `next/legacy/image` deprecated and will be removed in a future version of Next.js. Please use `next/image` instead. |\n+| `v13.0.0` | `next/image` renamed to `next/legacy/image`                                                                         |"
        },
        {
            "sha": "3e2a34d47062c4b80e4ddeda3a3ed893fd8b20fa",
            "filename": "packages/next/src/client/legacy/image.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/b41b737b2479bd83f22229b96085bdb13f177b8a/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b41b737b2479bd83f22229b96085bdb13f177b8a/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx?ref=b41b737b2479bd83f22229b96085bdb13f177b8a",
            "patch": "@@ -616,6 +616,9 @@ const ImageElement = ({\n   )\n }\n \n+/**\n+ * @deprecated The `next/legacy/image` component is deprecated and will be removed in a future version of Next.js. Please use `next/image` instead.\n+ */\n export default function Image({\n   src,\n   sizes,\n@@ -697,6 +700,10 @@ export default function Image({\n   }\n   src = typeof src === 'string' ? src : staticSrc\n \n+  warnOnce(\n+    `Image with src \"${src}\" is using next/legacy/image which is deprecated and will be removed in a future version of Next.js.`\n+  )\n+\n   let isLazy =\n     !priority && (loading === 'lazy' || typeof loading === 'undefined')\n   if (src.startsWith('data:') || src.startsWith('blob:')) {"
        },
        {
            "sha": "e3c3971ed969bd0eb541e7f115401057bb0a3a6e",
            "filename": "test/integration/next-image-legacy/default/test/index.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/b41b737b2479bd83f22229b96085bdb13f177b8a/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b41b737b2479bd83f22229b96085bdb13f177b8a/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts?ref=b41b737b2479bd83f22229b96085bdb13f177b8a",
            "patch": "@@ -1057,13 +1057,17 @@ function runTests(mode) {\n       const warnings = (await browser.log())\n         .map((log) => log.message)\n         .filter((log) => log.startsWith('Image with src'))\n+\n       expect(warnings[0]).toMatch(\n-        'Image with src \"/test.png\" has \"sizes\" property but it will be ignored.'\n+        'Image with src \"/test.png\" is using next/legacy/image which is deprecated and will be removed in a future version of Next.js.'\n       )\n       expect(warnings[1]).toMatch(\n+        'Image with src \"/test.png\" has \"sizes\" property but it will be ignored.'\n+      )\n+      expect(warnings[2]).toMatch(\n         'Image with src \"/test.png\" was detected as the Largest Contentful Paint (LCP).'\n       )\n-      expect(warnings.length).toBe(2)\n+      expect(warnings.length).toBe(3)\n     })\n   } else {\n     //server-only tests"
        },
        {
            "sha": "5f1cc0595de72e9f2f426fa61fc0aea5403c6d16",
            "filename": "test/integration/next-image-new/app-dir/test/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/b41b737b2479bd83f22229b96085bdb13f177b8a/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b41b737b2479bd83f22229b96085bdb13f177b8a/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts?ref=b41b737b2479bd83f22229b96085bdb13f177b8a",
            "patch": "@@ -398,6 +398,9 @@ function runTests(mode: 'dev' | 'server') {\n       expect(warnings).not.toMatch(\n         /was detected as the Largest Contentful Paint/gm\n       )\n+      expect(warnings).not.toMatch(\n+        'using next/legacy/image which is deprecated and will be removed in a future version'\n+      )\n       expect(warnings).not.toMatch(/React does not recognize the (.+) prop/gm)\n     } finally {\n       if (browser) {"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 21,
        "deletions": 6
    }
}