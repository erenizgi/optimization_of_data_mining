{
    "author": "timneutkens",
    "message": "Development: Addres comments on request log PR (#84945)\n\n## What?\n\nAdds the feedback from #84906. Added comments to the functions and\nchanged the inconsistency in parameters.",
    "sha": "b02583b7d373c68051331d770c93691e4c3dfc3a",
    "files": [
        {
            "sha": "efcf369f050452ddeb1c3e1771a7d22a90c5b1a3",
            "filename": "packages/next/src/build/duration-to-string.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fbuild%2Fduration-to-string.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fbuild%2Fduration-to-string.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fduration-to-string.ts?ref=b02583b7d373c68051331d770c93691e4c3dfc3a",
            "patch": "@@ -15,6 +15,18 @@ const SECONDS_THRESHOLD_HIGH_NANOSECONDS = 40_000_000_000 // 40 seconds in nanos\n const SECONDS_THRESHOLD_LOW_NANOSECONDS = 2_000_000_000 // 2 seconds in nanoseconds\n const MILLISECONDS_THRESHOLD_NANOSECONDS = 1_000_000 // 1 millisecond in nanoseconds\n \n+/**\n+ * Converts a duration in seconds to a human-readable string format.\n+ * Formats duration based on magnitude for optimal readability:\n+ * - >= 2 minutes: show in minutes with 1 decimal place (e.g., \"2.5min\")\n+ * - >= 40 seconds: show in whole seconds (e.g., \"45s\")\n+ * - >= 2 seconds: show in seconds with 1 decimal place (e.g., \"3.2s\")\n+ * - < 2 seconds: show in milliseconds with 1 decimal place (e.g., \"1500.0ms\")\n+ *\n+ * @deprecated Use durationToStringWithNanoseconds instead, collect time in nanoseconds using process.hrtime.bigint().\n+ * @param compilerDuration - Duration in seconds as a number\n+ * @returns Formatted duration string with appropriate unit and precision\n+ */\n export function durationToString(compilerDuration: number) {\n   if (compilerDuration > MINUTES_THRESHOLD_SECONDS) {\n     return `${(compilerDuration / SECONDS_IN_MINUTE).toFixed(1)}min`\n@@ -27,6 +39,18 @@ export function durationToString(compilerDuration: number) {\n   }\n }\n \n+/**\n+ * Converts a nanosecond duration to a human-readable string format.\n+ * Formats duration based on magnitude for optimal readability:\n+ * - >= 2 minutes: show in minutes with 1 decimal place (e.g., \"2.5min\")\n+ * - >= 40 seconds: show in whole seconds (e.g., \"45s\")\n+ * - >= 2 seconds: show in seconds with 1 decimal place (e.g., \"3.2s\")\n+ * - >= 1 millisecond: show in whole milliseconds (e.g., \"250ms\")\n+ * - < 1 millisecond: show in whole microseconds (e.g., \"500Âµs\")\n+ *\n+ * @param durationBigInt - Duration in nanoseconds as a BigInt\n+ * @returns Formatted duration string with appropriate unit and precision\n+ */\n function durationToStringWithNanoseconds(durationBigInt: bigint): string {\n   const duration = Number(durationBigInt)\n   if (duration > MINUTES_THRESHOLD_NANOSECONDS) {\n@@ -42,15 +66,35 @@ function durationToStringWithNanoseconds(durationBigInt: bigint): string {\n   }\n }\n \n+/**\n+ * Converts a high-resolution time tuple to seconds.\n+ *\n+ * @param hrtime - High-resolution time tuple of [seconds, nanoseconds]\n+ * @returns Duration in seconds as a floating-point number\n+ */\n export function hrtimeToSeconds(hrtime: [number, number]): number {\n   // hrtime is a tuple of [seconds, nanoseconds]\n   return hrtime[0] + hrtime[1] / NANOSECONDS_PER_SECOND\n }\n \n+/**\n+ * Converts a BigInt nanosecond duration to a human-readable string format.\n+ * This is the preferred method for formatting high-precision durations.\n+ *\n+ * @param hrtime - Duration in nanoseconds as a BigInt (typically from process.hrtime.bigint())\n+ * @returns Formatted duration string with appropriate unit and precision\n+ */\n export function hrtimeBigIntDurationToString(hrtime: bigint) {\n   return durationToStringWithNanoseconds(hrtime)\n }\n \n+/**\n+ * Converts a high-resolution time tuple to a human-readable string format.\n+ *\n+ * @deprecated Use hrtimeBigIntDurationToString with process.hrtime.bigint() for better precision.\n+ * @param hrtime - High-resolution time tuple of [seconds, nanoseconds]\n+ * @returns Formatted duration string with appropriate unit and precision\n+ */\n export function hrtimeDurationToString(hrtime: [number, number]): string {\n   return durationToString(hrtimeToSeconds(hrtime))\n }"
        },
        {
            "sha": "bd47e796bdee47a2a5d030328cae990568f827f9",
            "filename": "packages/next/src/server/dev/log-requests.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Flog-requests.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Flog-requests.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Flog-requests.ts?ref=b02583b7d373c68051331d770c93691e4c3dfc3a",
            "patch": "@@ -46,7 +46,8 @@ export function logRequests(\n   requestStartTime: bigint,\n   requestEndTime: bigint,\n   devRequestTimingMiddlewareStart: bigint | undefined,\n-  devRequestTimingMiddlewareEnd: bigint | undefined\n+  devRequestTimingMiddlewareEnd: bigint | undefined,\n+  devRequestTimingInternalsEnd: bigint | undefined\n ): void {\n   if (!ignoreLoggingIncomingRequests(request, loggingConfig)) {\n     logIncomingRequests(\n@@ -55,7 +56,8 @@ export function logRequests(\n       requestEndTime,\n       response.statusCode,\n       devRequestTimingMiddlewareStart,\n-      devRequestTimingMiddlewareEnd\n+      devRequestTimingMiddlewareEnd,\n+      devRequestTimingInternalsEnd\n     )\n   }\n \n@@ -72,13 +74,10 @@ function logIncomingRequests(\n   requestEndTime: bigint,\n   statusCode: number,\n   devRequestTimingMiddlewareStart: bigint | undefined,\n-  devRequestTimingMiddlewareEnd: bigint | undefined\n+  devRequestTimingMiddlewareEnd: bigint | undefined,\n+  devRequestTimingInternalsEnd: bigint | undefined\n ): void {\n   const isRSC = getRequestMeta(request, 'isRSCRequest')\n-  const devRequestTimingInternalsEnd = getRequestMeta(\n-    request,\n-    'devRequestTimingInternalsEnd'\n-  )\n   const url = isRSC ? stripNextRscUnionQuery(request.url) : request.url\n \n   const statusCodeColor ="
        },
        {
            "sha": "2b327decaa12ff9bbd6ea982c0c0b4c69f296ea0",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b02583b7d373c68051331d770c93691e4c3dfc3a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=b02583b7d373c68051331d770c93691e4c3dfc3a",
            "patch": "@@ -500,7 +500,8 @@ export default class DevServer extends Server {\n               requestStart,\n               requestEnd,\n               getRequestMeta(req, 'devRequestTimingMiddlewareStart'),\n-              getRequestMeta(req, 'devRequestTimingMiddlewareEnd')\n+              getRequestMeta(req, 'devRequestTimingMiddlewareEnd'),\n+              getRequestMeta(req, 'devRequestTimingInternalsEnd')\n             )\n           })\n         }"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 52,
        "deletions": 8
    }
}