{
    "author": "gnoff",
    "message": "directly import param resolver in metadata (#77401)\n\nThis function is indirectly routed through componentMod when it doesn't\nneed to be. Both it and it's consumer are part of the RSC layer.",
    "sha": "3dde482100d737831cb897f8314845ac51cca4f9",
    "files": [
        {
            "sha": "7132fb0ec1c6d27e2315f4b9c01e331698cdb2a3",
            "filename": "packages/next/src/lib/metadata/metadata.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx?ref=3dde482100d737831cb897f8314845ac51cca4f9",
            "patch": "@@ -2,7 +2,6 @@ import React, { Suspense, cache, cloneElement } from 'react'\n import type { ParsedUrlQuery } from 'querystring'\n import type { GetDynamicParamFromSegment } from '../../server/app-render/app-render'\n import type { LoaderTree } from '../../server/lib/app-dir-module'\n-import type { CreateServerParamsForMetadata } from '../../server/request/params'\n import type { StreamingMetadataResolvedState } from '../../client/components/metadata/types'\n import {\n   AppleWebAppMeta,\n@@ -57,7 +56,6 @@ export function createMetadataComponents({\n   getDynamicParamFromSegment,\n   appUsingSizeAdjustment,\n   errorType,\n-  createServerParamsForMetadata,\n   workStore,\n   MetadataBoundary,\n   ViewportBoundary,\n@@ -69,7 +67,6 @@ export function createMetadataComponents({\n   getDynamicParamFromSegment: GetDynamicParamFromSegment\n   appUsingSizeAdjustment: boolean\n   errorType?: MetadataErrorType | 'redirect'\n-  createServerParamsForMetadata: CreateServerParamsForMetadata\n   workStore: WorkStore\n   MetadataBoundary: (props: { children: React.ReactNode }) => React.ReactNode\n   ViewportBoundary: (props: { children: React.ReactNode }) => React.ReactNode\n@@ -108,7 +105,6 @@ export function createMetadataComponents({\n       tree,\n       searchParams,\n       getDynamicParamFromSegment,\n-      createServerParamsForMetadata,\n       workStore,\n       errorType\n     )\n@@ -124,7 +120,6 @@ export function createMetadataComponents({\n             tree,\n             searchParams,\n             getDynamicParamFromSegment,\n-            createServerParamsForMetadata,\n             workStore\n           )\n         } catch {}\n@@ -144,7 +139,6 @@ export function createMetadataComponents({\n       searchParams,\n       getDynamicParamFromSegment,\n       metadataContext,\n-      createServerParamsForMetadata,\n       workStore,\n       errorType\n     )\n@@ -169,7 +163,6 @@ export function createMetadataComponents({\n             searchParams,\n             getDynamicParamFromSegment,\n             metadataContext,\n-            createServerParamsForMetadata,\n             workStore\n           )\n           return {\n@@ -253,7 +246,6 @@ async function getResolvedMetadataImpl(\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n   metadataContext: MetadataContext,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore,\n   errorType?: MetadataErrorType | 'redirect'\n ): Promise<React.ReactNode> {\n@@ -263,7 +255,6 @@ async function getResolvedMetadataImpl(\n     searchParams,\n     getDynamicParamFromSegment,\n     metadataContext,\n-    createServerParamsForMetadata,\n     workStore,\n     errorConvention\n   )\n@@ -275,7 +266,6 @@ async function getNotFoundMetadataImpl(\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n   metadataContext: MetadataContext,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore\n ): Promise<React.ReactNode> {\n   const notFoundErrorConvention = 'not-found'\n@@ -284,7 +274,6 @@ async function getNotFoundMetadataImpl(\n     searchParams,\n     getDynamicParamFromSegment,\n     metadataContext,\n-    createServerParamsForMetadata,\n     workStore,\n     notFoundErrorConvention\n   )\n@@ -295,7 +284,6 @@ async function getResolvedViewportImpl(\n   tree: LoaderTree,\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore,\n   errorType?: MetadataErrorType | 'redirect'\n ): Promise<React.ReactNode> {\n@@ -304,7 +292,6 @@ async function getResolvedViewportImpl(\n     tree,\n     searchParams,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore,\n     errorConvention\n   )\n@@ -315,15 +302,13 @@ async function getNotFoundViewportImpl(\n   tree: LoaderTree,\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore\n ): Promise<React.ReactNode> {\n   const notFoundErrorConvention = 'not-found'\n   return renderViewport(\n     tree,\n     searchParams,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore,\n     notFoundErrorConvention\n   )\n@@ -334,7 +319,6 @@ async function renderMetadata(\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n   metadataContext: MetadataContext,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore,\n   errorConvention?: MetadataErrorType\n ) {\n@@ -343,7 +327,6 @@ async function renderMetadata(\n     searchParams,\n     errorConvention,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore,\n     metadataContext\n   )\n@@ -362,7 +345,6 @@ async function renderViewport(\n   tree: LoaderTree,\n   searchParams: Promise<ParsedUrlQuery>,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore,\n   errorConvention?: MetadataErrorType\n ) {\n@@ -371,7 +353,6 @@ async function renderViewport(\n     searchParams,\n     errorConvention,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore\n   )\n "
        },
        {
            "sha": "ad8342feb8560deed10af6486ede22dfc6604c5a",
            "filename": "packages/next/src/lib/metadata/resolve-metadata.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 13,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fresolve-metadata.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fresolve-metadata.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fresolve-metadata.ts?ref=3dde482100d737831cb897f8314845ac51cca4f9",
            "patch": "@@ -20,6 +20,8 @@ import type {\n } from './types/metadata-types'\n import type { ParsedUrlQuery } from 'querystring'\n import type { StaticMetadata } from './types/icons'\n+import type { WorkStore } from '../../server/app-render/work-async-storage.external'\n+import type { Params } from '../../server/request/params'\n \n // eslint-disable-next-line import/no-extraneous-dependencies\n import 'server-only'\n@@ -53,11 +55,7 @@ import { getTracer } from '../../server/lib/trace/tracer'\n import { ResolveMetadataSpan } from '../../server/lib/trace/constants'\n import { PAGE_SEGMENT_KEY } from '../../shared/lib/segment'\n import * as Log from '../../build/output/log'\n-import type { WorkStore } from '../../server/app-render/work-async-storage.external'\n-import type {\n-  Params,\n-  CreateServerParamsForMetadata,\n-} from '../../server/request/params'\n+import { createServerParamsForMetadata } from '../../server/request/params'\n \n type StaticIcons = Pick<ResolvedIcons, 'icon' | 'apple'>\n \n@@ -483,7 +481,6 @@ const resolveMetadataItems = cache(async function (\n   searchParams: Promise<ParsedUrlQuery>,\n   errorConvention: MetadataErrorType | undefined,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore\n ) {\n   const parentParams = {}\n@@ -499,7 +496,6 @@ const resolveMetadataItems = cache(async function (\n     errorConvention,\n     errorMetadataItem,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore\n   )\n })\n@@ -514,7 +510,6 @@ async function resolveMetadataItemsImpl(\n   errorConvention: MetadataErrorType | undefined,\n   errorMetadataItem: MetadataItems[number],\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore\n ): Promise<MetadataItems> {\n   const [segment, parallelRoutes, { page }] = tree\n@@ -572,7 +567,6 @@ async function resolveMetadataItemsImpl(\n       errorConvention,\n       errorMetadataItem,\n       getDynamicParamFromSegment,\n-      createServerParamsForMetadata,\n       workStore\n     )\n   }\n@@ -914,7 +908,6 @@ export async function resolveMetadata(\n   searchParams: Promise<ParsedUrlQuery>,\n   errorConvention: MetadataErrorType | undefined,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore,\n   metadataContext: MetadataContext\n ): Promise<ResolvedMetadata> {\n@@ -923,7 +916,6 @@ export async function resolveMetadata(\n     searchParams,\n     errorConvention,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore\n   )\n   return accumulateMetadata(metadataItems, metadataContext)\n@@ -935,15 +927,13 @@ export async function resolveViewport(\n   searchParams: Promise<ParsedUrlQuery>,\n   errorConvention: MetadataErrorType | undefined,\n   getDynamicParamFromSegment: GetDynamicParamFromSegment,\n-  createServerParamsForMetadata: CreateServerParamsForMetadata,\n   workStore: WorkStore\n ): Promise<ResolvedViewport> {\n   const metadataItems = await resolveMetadataItems(\n     tree,\n     searchParams,\n     errorConvention,\n     getDynamicParamFromSegment,\n-    createServerParamsForMetadata,\n     workStore\n   )\n   return accumulateViewport(metadataItems)"
        },
        {
            "sha": "3680c972d53621f5e93a0f27edebb066770a6c14",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=3dde482100d737831cb897f8314845ac51cca4f9",
            "patch": "@@ -469,7 +469,6 @@ async function generateDynamicRSCPayload(\n     componentMod: {\n       tree: loaderTree,\n       createServerSearchParamsForMetadata,\n-      createServerParamsForMetadata,\n       createMetadataComponents,\n       MetadataBoundary,\n       ViewportBoundary,\n@@ -505,7 +504,6 @@ async function generateDynamicRSCPayload(\n       ),\n       getDynamicParamFromSegment,\n       appUsingSizeAdjustment,\n-      createServerParamsForMetadata,\n       workStore,\n       MetadataBoundary,\n       ViewportBoundary,\n@@ -789,7 +787,6 @@ async function getRSCPayload(\n     componentMod: {\n       GlobalError,\n       createServerSearchParamsForMetadata,\n-      createServerParamsForMetadata,\n       createMetadataComponents,\n       MetadataBoundary,\n       ViewportBoundary,\n@@ -823,7 +820,6 @@ async function getRSCPayload(\n     ),\n     getDynamicParamFromSegment,\n     appUsingSizeAdjustment,\n-    createServerParamsForMetadata,\n     workStore,\n     MetadataBoundary,\n     ViewportBoundary,\n@@ -931,7 +927,6 @@ async function getErrorRSCPayload(\n     componentMod: {\n       GlobalError,\n       createServerSearchParamsForMetadata,\n-      createServerParamsForMetadata,\n       createMetadataComponents,\n       MetadataBoundary,\n       ViewportBoundary,\n@@ -952,7 +947,6 @@ async function getErrorRSCPayload(\n     errorType,\n     getDynamicParamFromSegment,\n     appUsingSizeAdjustment,\n-    createServerParamsForMetadata,\n     workStore,\n     MetadataBoundary,\n     ViewportBoundary,"
        },
        {
            "sha": "048fd5f79701f1ed09e5ea797c46cfdcf7d08803",
            "filename": "packages/next/src/server/app-render/entry-base.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3dde482100d737831cb897f8314845ac51cca4f9/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts?ref=3dde482100d737831cb897f8314845ac51cca4f9",
            "patch": "@@ -24,7 +24,6 @@ import {\n } from '../request/search-params'\n import {\n   createServerParamsForServerSegment,\n-  createServerParamsForMetadata,\n   createPrerenderParamsForClientSegment,\n } from '../request/params'\n import * as serverHooks from '../../client/components/hooks-server-context'\n@@ -63,7 +62,6 @@ export {\n   createServerSearchParamsForMetadata,\n   createPrerenderSearchParamsForClientPage,\n   createServerParamsForServerSegment,\n-  createServerParamsForMetadata,\n   createPrerenderParamsForClientSegment,\n   serverHooks,\n   preloadStyle,"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 3,
        "deletions": 40
    }
}