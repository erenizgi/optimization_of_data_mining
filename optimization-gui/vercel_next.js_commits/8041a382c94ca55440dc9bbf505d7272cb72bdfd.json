{
    "author": "devjiwonchoi",
    "message": "[Breaking] Require `images.localPatterns` for query in Image src (#84406)\n\nThis PR modifies Image behavior to require `images.localPatterns.search`\nvalue when used with search queries in the `src` property:\n\n```jsx\n// Error\n<Image src=\"/api/user?id=1\" width=\"50\" height=\"50\" />\n```\n\n```ts\n// next.config.ts\n\nexport default {\n  images: {\n    localPatterns: [\n      {\n        pathname: '/api/user',\n        // Either set explicit query string or leave undefined to match all\n        search: '?v=2',\n      },\n    ],\n  },\n}\n```\n\nIt is to prevent malicious actors like Denial of Wallet (DoW) attacks\nand strictly match the search queries for image optimization.\n\nThe deprecation warning was added at\nhttps://github.com/vercel/next.js/pull/82627\n\n---------\n\nCo-authored-by: Steven <steven@ceriously.com>",
    "sha": "8041a382c94ca55440dc9bbf505d7272cb72bdfd",
    "files": [
        {
            "sha": "3c4088671d45ecf11697ee6c59b6d70f15e996ec",
            "filename": "docs/01-app/03-api-reference/02-components/image.mdx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/docs%2F01-app%2F03-api-reference%2F02-components%2Fimage.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/docs%2F01-app%2F03-api-reference%2F02-components%2Fimage.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F02-components%2Fimage.mdx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -528,6 +528,8 @@ module.exports = {\n \n The example above will ensure the `src` property of `next/image` must start with `/assets/images/` and must not have a query string. Attempting to optimize any other path will respond with `400` Bad Request error.\n \n+> **Good to know**: Omitting the `search` property allows all search parameters which could allow malicious actors to optimize URLs you did not intend. Try using a specific value like `search: '?v=2'` to ensure an exact match.\n+\n #### `remotePatterns`\n \n Use `remotePatterns` in your `next.config.js` file to allow images from specific external paths and block all others. This ensures that only external images from your account can be served."
        },
        {
            "sha": "a24f4959aa1943131c28822599c8f672648c5169",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -868,5 +868,6 @@\n   \"867\": \"The %s \\\"%s\\\" must export a %s or a \\\\`default\\\\` function\",\n   \"868\": \"No reference found for param: %s in reference: %s\",\n   \"869\": \"No reference found for segment: %s with reference: %s\",\n-  \"870\": \"refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh\"\n+  \"870\": \"refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh\",\n+  \"871\": \"Image with src \\\"%s\\\" is using a query string which is not configured in images.localPatterns.\\\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns\"\n }"
        },
        {
            "sha": "2f87dad4ef29755f6602d6658c53c172defae9ea",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -546,6 +546,7 @@ export async function handler(\n           nextConfigOutput: nextConfig.output,\n           crossOrigin: nextConfig.crossOrigin,\n           trailingSlash: nextConfig.trailingSlash,\n+          images: nextConfig.images,\n           previewProps: prerenderManifest.preview,\n           deploymentId: nextConfig.deploymentId,\n           enableTainting: nextConfig.experimental.taint,"
        },
        {
            "sha": "0bfdb850dc673457a5a9d422c92f7b9bb8b1982c",
            "filename": "packages/next/src/build/templates/edge-ssr-app.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -144,6 +144,7 @@ async function requestHandler(\n       nextConfigOutput: nextConfig.output,\n       crossOrigin: nextConfig.crossOrigin,\n       trailingSlash: nextConfig.trailingSlash,\n+      images: nextConfig.images,\n       previewProps: prerenderManifest.preview,\n       deploymentId: nextConfig.deploymentId,\n       enableTainting: nextConfig.experimental.taint,"
        },
        {
            "sha": "1e635c82935476a6d68703000e520958daabe7e0",
            "filename": "packages/next/src/client/image-component.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fclient%2Fimage-component.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fclient%2Fimage-component.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fimage-component.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -364,10 +364,24 @@ export const Image = forwardRef<HTMLImageElement | null, ImageProps>(\n     const configContext = useContext(ImageConfigContext)\n     const config = useMemo(() => {\n       const c = configEnv || configContext || imageConfigDefault\n+\n       const allSizes = [...c.deviceSizes, ...c.imageSizes].sort((a, b) => a - b)\n       const deviceSizes = c.deviceSizes.sort((a, b) => a - b)\n       const qualities = c.qualities?.sort((a, b) => a - b)\n-      return { ...c, allSizes, deviceSizes, qualities }\n+      return {\n+        ...c,\n+        allSizes,\n+        deviceSizes,\n+        qualities,\n+        // During the SSR, configEnv (__NEXT_IMAGE_OPTS) does not include\n+        // security sensitive configs like `localPatterns`, which is needed\n+        // during the server render to ensure it's validated. Therefore use\n+        // configContext, which holds the config from the server for validation.\n+        localPatterns:\n+          typeof window === 'undefined'\n+            ? configContext?.localPatterns\n+            : c.localPatterns,\n+      }\n     }, [configContext])\n \n     const { onLoad, onLoadingComplete } = props\n@@ -385,7 +399,6 @@ export const Image = forwardRef<HTMLImageElement | null, ImageProps>(\n \n     const [blurComplete, setBlurComplete] = useState(false)\n     const [showAltText, setShowAltText] = useState(false)\n-\n     const { props: imgAttributes, meta: imgMeta } = getImgProps(props, {\n       defaultLoader,\n       imgConf: config,"
        },
        {
            "sha": "ffd8ab57384aab72a7aa3146775cbae12b61259a",
            "filename": "packages/next/src/client/legacy/image.tsx",
            "status": "modified",
            "additions": 32,
            "deletions": 20,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -120,6 +120,25 @@ function defaultLoader({\n   width,\n   quality,\n }: ImageLoaderPropsWithConfig): string {\n+  if (!config.dangerouslyAllowSVG && src.split('?', 1)[0].endsWith('.svg')) {\n+    // Special case to make svg serve as-is to avoid proxying\n+    // through the built-in Image Optimization API.\n+    return src\n+  }\n+\n+  if (\n+    src.startsWith('/') &&\n+    src.includes('?') &&\n+    config.localPatterns?.length === 1 &&\n+    config.localPatterns[0].pathname === '**' &&\n+    config.localPatterns[0].search === ''\n+  ) {\n+    throw new Error(\n+      `Image with src \"${src}\" is using a query string which is not configured in images.localPatterns.` +\n+        `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`\n+    )\n+  }\n+\n   if (process.env.NODE_ENV !== 'production') {\n     const missingValues = []\n \n@@ -192,12 +211,6 @@ function defaultLoader({\n \n   const q = findClosestQuality(quality, config)\n \n-  if (!config.dangerouslyAllowSVG && src.split('?', 1)[0].endsWith('.svg')) {\n-    // Special case to make svg serve as-is to avoid proxying\n-    // through the built-in Image Optimization API.\n-    return src\n-  }\n-\n   return `${normalizePathTrailingSlash(config.path)}?url=${encodeURIComponent(\n     src\n   )}&w=${width}&q=${q}`\n@@ -645,7 +658,19 @@ export default function Image({\n     const allSizes = [...c.deviceSizes, ...c.imageSizes].sort((a, b) => a - b)\n     const deviceSizes = c.deviceSizes.sort((a, b) => a - b)\n     const qualities = c.qualities?.sort((a, b) => a - b)\n-    return { ...c, allSizes, deviceSizes, qualities }\n+    return {\n+      ...c,\n+      allSizes,\n+      deviceSizes,\n+      qualities, // During the SSR, configEnv (__NEXT_IMAGE_OPTS) does not include\n+      // security sensitive configs like `localPatterns`, which is needed\n+      // during the server render to ensure it's validated. Therefore use\n+      // configContext, which holds the config from the server for validation.\n+      localPatterns:\n+        typeof window === 'undefined'\n+          ? configContext?.localPatterns\n+          : c.localPatterns,\n+    }\n   }, [configContext])\n \n   let rest: Partial<ImageProps> = all\n@@ -865,19 +890,6 @@ export default function Image({\n         )\n       }\n \n-      if (\n-        src.startsWith('/') &&\n-        src.includes('?') &&\n-        (!config?.localPatterns?.length ||\n-          (config.localPatterns.length === 1 &&\n-            config.localPatterns[0].pathname === '/_next/static/media/**'))\n-      ) {\n-        warnOnce(\n-          `Image with src \"${src}\" is using a query string which is not configured in images.localPatterns. This config will be required starting in Next.js 16.` +\n-            `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`\n-        )\n-      }\n-\n       if (!unoptimized && loader !== defaultImageLoader) {\n         const urlStr = loader({\n           config,"
        },
        {
            "sha": "7ace45d66e4940d72a296ed1affb45542a3e9610",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 28,
            "deletions": 6,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -209,6 +209,8 @@ import {\n import type { ExperimentalConfig } from '../config-shared'\n import type { Params } from '../request/params'\n import { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolvers'\n+import { ImageConfigContext } from '../../shared/lib/image-config-context.shared-runtime'\n+import { imageConfigDefault } from '../../shared/lib/image-config'\n \n export type GetDynamicParamFromSegment = (\n   // [slug] / [[slug]] / [...slug]\n@@ -1359,12 +1361,14 @@ function App<T>({\n   clientReferenceManifest,\n   ServerInsertedHTMLProvider,\n   nonce,\n+  images,\n }: {\n   reactServerStream: BinaryStreamOf<T>\n   reactDebugStream: ReadableStream<Uint8Array> | undefined\n   preinitScripts: () => void\n   clientReferenceManifest: NonNullable<RenderOpts['clientReferenceManifest']>\n   ServerInsertedHTMLProvider: React.ComponentType<{ children: JSX.Element }>\n+  images: RenderOpts['images']\n   nonce?: string\n }): JSX.Element {\n   preinitScripts()\n@@ -1404,9 +1408,11 @@ function App<T>({\n         nonce,\n       }}\n     >\n-      <ServerInsertedHTMLProvider>\n-        <AppRouter actionQueue={actionQueue} globalErrorState={response.G} />\n-      </ServerInsertedHTMLProvider>\n+      <ImageConfigContext.Provider value={images ?? imageConfigDefault}>\n+        <ServerInsertedHTMLProvider>\n+          <AppRouter actionQueue={actionQueue} globalErrorState={response.G} />\n+        </ServerInsertedHTMLProvider>\n+      </ImageConfigContext.Provider>\n     </HeadManagerContext.Provider>\n   )\n }\n@@ -1421,13 +1427,15 @@ function ErrorApp<T>({\n   clientReferenceManifest,\n   ServerInsertedHTMLProvider,\n   nonce,\n+  images,\n }: {\n   reactServerStream: BinaryStreamOf<T>\n   reactDebugStream: ReadableStream<Uint8Array> | undefined\n   preinitScripts: () => void\n   clientReferenceManifest: NonNullable<RenderOpts['clientReferenceManifest']>\n   ServerInsertedHTMLProvider: React.ComponentType<{ children: JSX.Element }>\n   nonce?: string\n+  images: RenderOpts['images']\n }): JSX.Element {\n   preinitScripts()\n   const response = React.use(\n@@ -1457,9 +1465,11 @@ function ErrorApp<T>({\n   const actionQueue = createMutableActionQueue(initialState, null)\n \n   return (\n-    <ServerInsertedHTMLProvider>\n-      <AppRouter actionQueue={actionQueue} globalErrorState={response.G} />\n-    </ServerInsertedHTMLProvider>\n+    <ImageConfigContext.Provider value={images ?? imageConfigDefault}>\n+      <ServerInsertedHTMLProvider>\n+        <AppRouter actionQueue={actionQueue} globalErrorState={response.G} />\n+      </ServerInsertedHTMLProvider>\n+    </ImageConfigContext.Provider>\n   )\n }\n \n@@ -2422,6 +2432,7 @@ async function renderToStream(\n             clientReferenceManifest={clientReferenceManifest}\n             ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n             nonce={nonce}\n+            images={ctx.renderOpts.images}\n           />,\n           postponed,\n           { onError: htmlRendererErrorHandler, nonce }\n@@ -2467,6 +2478,7 @@ async function renderToStream(\n         clientReferenceManifest={clientReferenceManifest}\n         ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n         nonce={nonce}\n+        images={ctx.renderOpts.images}\n       />,\n       {\n         onError: htmlRendererErrorHandler,\n@@ -2627,6 +2639,7 @@ async function renderToStream(\n               preinitScripts={errorPreinitScripts}\n               clientReferenceManifest={clientReferenceManifest}\n               nonce={nonce}\n+              images={ctx.renderOpts.images}\n             />\n           ),\n           streamOptions: {\n@@ -3010,6 +3023,7 @@ async function spawnDynamicValidationInDev(\n         clientReferenceManifest={clientReferenceManifest}\n         ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n         nonce={nonce}\n+        images={ctx.renderOpts.images}\n       />,\n       {\n         signal: initialClientReactController.signal,\n@@ -3239,6 +3253,7 @@ async function spawnDynamicValidationInDev(\n               clientReferenceManifest={clientReferenceManifest}\n               ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n               nonce={nonce}\n+              images={ctx.renderOpts.images}\n             />,\n             {\n               signal: finalClientReactController.signal,\n@@ -3753,6 +3768,7 @@ async function prerenderToStream(\n             clientReferenceManifest={clientReferenceManifest}\n             ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n             nonce={nonce}\n+            images={ctx.renderOpts.images}\n           />,\n           {\n             signal: initialClientReactController.signal,\n@@ -3987,6 +4003,7 @@ async function prerenderToStream(\n                 clientReferenceManifest={clientReferenceManifest}\n                 ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n                 nonce={nonce}\n+                images={ctx.renderOpts.images}\n               />,\n               {\n                 signal: finalClientReactController.signal,\n@@ -4151,6 +4168,7 @@ async function prerenderToStream(\n               clientReferenceManifest={clientReferenceManifest}\n               ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n               nonce={nonce}\n+              images={ctx.renderOpts.images}\n             />,\n             JSON.parse(JSON.stringify(postponed)),\n             {\n@@ -4258,6 +4276,7 @@ async function prerenderToStream(\n             clientReferenceManifest={clientReferenceManifest}\n             ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n             nonce={nonce}\n+            images={ctx.renderOpts.images}\n           />,\n           {\n             onError: htmlRendererErrorHandler,\n@@ -4399,6 +4418,7 @@ async function prerenderToStream(\n               clientReferenceManifest={clientReferenceManifest}\n               ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n               nonce={nonce}\n+              images={ctx.renderOpts.images}\n             />,\n             JSON.parse(JSON.stringify(postponed)),\n             {\n@@ -4483,6 +4503,7 @@ async function prerenderToStream(\n           clientReferenceManifest={clientReferenceManifest}\n           ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n           nonce={nonce}\n+          images={ctx.renderOpts.images}\n         />,\n         {\n           onError: htmlRendererErrorHandler,\n@@ -4657,6 +4678,7 @@ async function prerenderToStream(\n               preinitScripts={errorPreinitScripts}\n               clientReferenceManifest={clientReferenceManifest}\n               nonce={nonce}\n+              images={ctx.renderOpts.images}\n             />\n           ),\n           streamOptions: {"
        },
        {
            "sha": "55298d6702d47e03f0253d0ea921943739cdf0eb",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -9,6 +9,7 @@ import type { NextFontManifest } from '../../build/webpack/plugins/next-font-man\n import type { ParsedUrlQuery } from 'querystring'\n import type { AppPageModule } from '../route-modules/app-page/module'\n import type { DeepReadonly } from '../../shared/lib/deep-readonly'\n+import type { ImageConfigComplete } from '../../shared/lib/image-config'\n import type { __ApiPreviewProps } from '../api-utils'\n \n import s from 'next/dist/compiled/superstruct'\n@@ -77,6 +78,7 @@ export interface RenderOptsPartial {\n   dev?: boolean\n   basePath: string\n   trailingSlash: boolean\n+  images: ImageConfigComplete\n   clientReferenceManifest?: DeepReadonly<ClientReferenceManifest>\n   supportsDynamicResponse: boolean\n   runtime?: ServerRuntime"
        },
        {
            "sha": "53d7cebe493e0be0d6a9a742596a2149bfec5a03",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -477,6 +477,14 @@ function assignDefaultsAndValidate(\n           search: '',\n         })\n       }\n+    } else {\n+      // All paths are not allowed for a search query by default.\n+      images.localPatterns = [\n+        {\n+          pathname: '**',\n+          search: '',\n+        },\n+      ]\n     }\n \n     if (images.remotePatterns) {"
        },
        {
            "sha": "50073562aa20b287d1cf4416caa171092108e46e",
            "filename": "packages/next/src/shared/lib/get-img-props.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -560,18 +560,6 @@ export function getImgProps(\n           `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-qualities`\n       )\n     }\n-    if (\n-      src.startsWith('/') &&\n-      src.includes('?') &&\n-      (!config?.localPatterns?.length ||\n-        (config.localPatterns.length === 1 &&\n-          config.localPatterns[0].pathname === '/_next/static/media/**'))\n-    ) {\n-      warnOnce(\n-        `Image with src \"${src}\" is using a query string which is not configured in images.localPatterns. This config will be required starting in Next.js 16.` +\n-          `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`\n-      )\n-    }\n     if (placeholder === 'blur' && !blurDataURL) {\n       const VALID_BLUR_EXT = ['jpeg', 'png', 'webp', 'avif'] // should match next-image-loader\n "
        },
        {
            "sha": "8be9d54d8f1cbf97ba66f9db6e78825737ed2aa1",
            "filename": "packages/next/src/shared/lib/image-loader.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fimage-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fimage-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fimage-loader.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -7,6 +7,19 @@ function defaultLoader({\n   width,\n   quality,\n }: ImageLoaderPropsWithConfig): string {\n+  if (\n+    src.startsWith('/') &&\n+    src.includes('?') &&\n+    config.localPatterns?.length === 1 &&\n+    config.localPatterns[0].pathname === '**' &&\n+    config.localPatterns[0].search === ''\n+  ) {\n+    throw new Error(\n+      `Image with src \"${src}\" is using a query string which is not configured in images.localPatterns.` +\n+        `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`\n+    )\n+  }\n+\n   if (process.env.NODE_ENV !== 'production') {\n     const missingValues = []\n "
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/e2e/app-dir/next-image-legacy-src-with-query-without-local-patterns/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ae502dc06f3b173604328f70a417f04e7f7b5459",
            "filename": "test/e2e/app-dir/next-image-legacy-src-with-query-without-local-patterns/app/page.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+import Image from 'next/legacy/image'\n+\n+export default function Page() {\n+  // src with query without localPatterns will throw an error\n+  return <Image src=\"/test.png?v=1\" alt=\"test\" width={100} height={100} />\n+}"
        },
        {
            "sha": "c67f8f06261ac7a0cfb14a99c96fa2c6e59b0bd5",
            "filename": "test/e2e/app-dir/next-image-legacy-src-with-query-without-local-patterns/next-image-legacy-src-with-query-without-local-patterns.test.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,28 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('next-image-legacy-src-with-query-without-local-patterns', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: true,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should throw error for relative image with query without localPatterns for legacy Image', async () => {\n+    if (isNextDev) {\n+      await next.start()\n+      await next.browser('/')\n+      expect(next.cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    } else {\n+      const { cliOutput } = await next.build()\n+      expect(cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    }\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/app-dir/next-image-legacy-src-with-query-without-local-patterns/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "aea7f5ff8ad3e3c7c084080bda8ac3b95e9a71cd",
            "filename": "test/e2e/app-dir/next-image-legacy-src-with-query-without-local-patterns/public/test.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd"
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/e2e/app-dir/next-image-src-with-query-without-local-patterns/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Flayout.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "48b6eeeafd74f38ddbf05fe129c13a83bd7fb283",
            "filename": "test/e2e/app-dir/next-image-src-with-query-without-local-patterns/app/page.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fapp%2Fpage.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+import Image from 'next/image'\n+\n+export default function Page() {\n+  // src with query without localPatterns will throw an error\n+  return <Image src=\"/test.png?v=1\" alt=\"test\" width={100} height={100} />\n+}"
        },
        {
            "sha": "4a577b1c5493a56fa3a2125570983ea5e9cebaef",
            "filename": "test/e2e/app-dir/next-image-src-with-query-without-local-patterns/next-image-src-with-query-without-local-patterns.test.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,28 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('next-image-src-with-query-without-local-patterns', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: true,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should throw error for relative image with query without localPatterns', async () => {\n+    if (isNextDev) {\n+      await next.start()\n+      await next.browser('/')\n+      expect(next.cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    } else {\n+      const { cliOutput } = await next.build()\n+      expect(cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    }\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/app-dir/next-image-src-with-query-without-local-patterns/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "aea7f5ff8ad3e3c7c084080bda8ac3b95e9a71cd",
            "filename": "test/e2e/app-dir/next-image-src-with-query-without-local-patterns/public/test.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd"
        },
        {
            "sha": "c67f8f06261ac7a0cfb14a99c96fa2c6e59b0bd5",
            "filename": "test/e2e/next-image-legacy-src-with-query-without-local-patterns/next-image-legacy-src-with-query-without-local-patterns.test.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext-image-legacy-src-with-query-without-local-patterns.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,28 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('next-image-legacy-src-with-query-without-local-patterns', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: true,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should throw error for relative image with query without localPatterns for legacy Image', async () => {\n+    if (isNextDev) {\n+      await next.start()\n+      await next.browser('/')\n+      expect(next.cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    } else {\n+      const { cliOutput } = await next.build()\n+      expect(cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    }\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/next-image-legacy-src-with-query-without-local-patterns/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fnext.config.js?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "ae502dc06f3b173604328f70a417f04e7f7b5459",
            "filename": "test/e2e/next-image-legacy-src-with-query-without-local-patterns/pages/index.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpages%2Findex.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+import Image from 'next/legacy/image'\n+\n+export default function Page() {\n+  // src with query without localPatterns will throw an error\n+  return <Image src=\"/test.png?v=1\" alt=\"test\" width={100} height={100} />\n+}"
        },
        {
            "sha": "aea7f5ff8ad3e3c7c084080bda8ac3b95e9a71cd",
            "filename": "test/e2e/next-image-legacy-src-with-query-without-local-patterns/public/test.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-legacy-src-with-query-without-local-patterns%2Fpublic%2Ftest.png?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd"
        },
        {
            "sha": "4a577b1c5493a56fa3a2125570983ea5e9cebaef",
            "filename": "test/e2e/next-image-src-with-query-without-local-patterns/next-image-src-with-query-without-local-patterns.test.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext-image-src-with-query-without-local-patterns.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,28 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('next-image-src-with-query-without-local-patterns', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: true,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should throw error for relative image with query without localPatterns', async () => {\n+    if (isNextDev) {\n+      await next.start()\n+      await next.browser('/')\n+      expect(next.cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    } else {\n+      const { cliOutput } = await next.build()\n+      expect(cliOutput).toContain(\n+        'Image with src \"/test.png?v=1\" is using a query string which is not configured in images.localPatterns.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns'\n+      )\n+    }\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/next-image-src-with-query-without-local-patterns/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fnext.config.js?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "48b6eeeafd74f38ddbf05fe129c13a83bd7fb283",
            "filename": "test/e2e/next-image-src-with-query-without-local-patterns/pages/index.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpages%2Findex.tsx?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -0,0 +1,6 @@\n+import Image from 'next/image'\n+\n+export default function Page() {\n+  // src with query without localPatterns will throw an error\n+  return <Image src=\"/test.png?v=1\" alt=\"test\" width={100} height={100} />\n+}"
        },
        {
            "sha": "aea7f5ff8ad3e3c7c084080bda8ac3b95e9a71cd",
            "filename": "test/e2e/next-image-src-with-query-without-local-patterns/public/test.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-image-src-with-query-without-local-patterns%2Fpublic%2Ftest.png?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd"
        },
        {
            "sha": "67efd5f01a0113b65bcc4e1bbf6cef291afd4b35",
            "filename": "test/integration/next-image-new/app-dir-qualities/test/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Fapp-dir-qualities%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Fapp-dir-qualities%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fapp-dir-qualities%2Ftest%2Findex.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -101,7 +101,13 @@ function runTests(mode: 'dev' | 'server') {\n           loader: 'default',\n           loaderFile: '',\n           remotePatterns: [],\n-          localPatterns: undefined,\n+          localPatterns: [\n+            {\n+              pathname:\n+                '^(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$))(?:(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$)).)*?)\\\\/?)$',\n+              search: '',\n+            },\n+          ],\n           minimumCacheTTL: 14400,\n           path: '/_next/image',\n           qualities: [42, 69, 88],"
        },
        {
            "sha": "c316d738c5b984e9dc4d33f9012b7a0ca44e7ee8",
            "filename": "test/integration/next-image-new/app-dir/test/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -1787,7 +1787,13 @@ function runTests(mode: 'dev' | 'server') {\n           loader: 'default',\n           loaderFile: '',\n           remotePatterns: [],\n-          localPatterns: undefined,\n+          localPatterns: [\n+            {\n+              pathname:\n+                '^(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$))(?:(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$)).)*?)\\\\/?)$',\n+              search: '',\n+            },\n+          ],\n           minimumCacheTTL: 14400,\n           path: '/_next/image',\n           qualities: [75],"
        },
        {
            "sha": "34c6996e4350353a2a2cc3f2f13f4082eaf268a3",
            "filename": "test/integration/next-image-new/unicode/test/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Funicode%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Funicode%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Funicode%2Ftest%2Findex.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -94,6 +94,13 @@ function runTests(mode: 'server' | 'dev') {\n               search: '',\n             },\n           ],\n+          localPatterns: [\n+            {\n+              pathname:\n+                '^(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$))(?:(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$)).)*?)\\\\/?)$',\n+              search: '',\n+            },\n+          ],\n           minimumCacheTTL: 14400,\n           path: '/_next/image',\n           qualities: [75],"
        },
        {
            "sha": "2304d3e784cd43882d50fb7e8bf4b1b34d606aa1",
            "filename": "test/integration/next-image-new/unoptimized/test/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Funoptimized%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Fintegration%2Fnext-image-new%2Funoptimized%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Funoptimized%2Ftest%2Findex.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -109,7 +109,13 @@ function runTests(url: string, mode: 'dev' | 'server') {\n           loader: 'default',\n           loaderFile: '',\n           remotePatterns: [],\n-          localPatterns: undefined,\n+          localPatterns: [\n+            {\n+              pathname:\n+                '^(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$))(?:(?:(?!(?:^|\\\\/)\\\\.{1,2}(?:\\\\/|$)).)*?)\\\\/?)$',\n+              search: '',\n+            },\n+          ],\n           minimumCacheTTL: 14400,\n           path: '/_next/image',\n           qualities: [75],"
        },
        {
            "sha": "3900b588e5ecaa31926f2790c956424cd4cc4cc3",
            "filename": "test/unit/next-image-get-img-props.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Funit%2Fnext-image-get-img-props.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8041a382c94ca55440dc9bbf505d7272cb72bdfd/test%2Funit%2Fnext-image-get-img-props.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Funit%2Fnext-image-get-img-props.test.ts?ref=8041a382c94ca55440dc9bbf505d7272cb72bdfd",
            "patch": "@@ -574,26 +574,6 @@ describe('getImageProps()', () => {\n       ['src', '/test.svg'],\n     ])\n   })\n-  it('should auto unoptimized for relative svg with query', async () => {\n-    const { props } = getImageProps({\n-      alt: 'a nice desc',\n-      src: '/test.svg?v=1',\n-      width: 100,\n-      height: 200,\n-    })\n-    expect(warningMessages).toStrictEqual([\n-      'Image with src \"/test.svg?v=1\" is using a query string which is not configured in images.localPatterns. This config will be required starting in Next.js 16.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns',\n-    ])\n-    expect(Object.entries(props)).toStrictEqual([\n-      ['alt', 'a nice desc'],\n-      ['loading', 'lazy'],\n-      ['width', 100],\n-      ['height', 200],\n-      ['decoding', 'async'],\n-      ['style', { color: 'transparent' }],\n-      ['src', '/test.svg?v=1'],\n-    ])\n-  })\n   it('should auto unoptimized for absolute svg', async () => {\n     const { props } = getImageProps({\n       alt: 'a nice desc',"
        }
    ],
    "stats": {
        "total": 372,
        "additions": 308,
        "deletions": 64
    }
}