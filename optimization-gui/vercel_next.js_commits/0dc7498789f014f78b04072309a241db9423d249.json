{
    "author": "ztanner",
    "message": "[create-next-app]: prompt to use recommended options (#84570)\n\n`create-next-app` by default asks a lot of questions that new users\nmight not be familiar with or necessarily know the answer to. This\nupdates the flow to start by asking if you want to use the recommended\ndefaults. If you already have preferences saved from previous runs, it\nbecomes an option to re-use those preferences. Otherwise you can proceed\nwith the step-by-step flow.\n\n\nhttps://github.com/user-attachments/assets/92e815df-5484-4235-841b-eb231df8377c",
    "sha": "0dc7498789f014f78b04072309a241db9423d249",
    "files": [
        {
            "sha": "8b2c936bf09f7f361e6b1f0cbda859cd735b3495",
            "filename": "packages/create-next-app/index.ts",
            "status": "modified",
            "additions": 120,
            "deletions": 3,
            "changes": 123,
            "blob_url": "https://github.com/vercel/next.js/blob/0dc7498789f014f78b04072309a241db9423d249/packages%2Fcreate-next-app%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0dc7498789f014f78b04072309a241db9423d249/packages%2Fcreate-next-app%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Findex.ts?ref=0dc7498789f014f78b04072309a241db9423d249",
            "patch": "@@ -227,7 +227,8 @@ async function run(): Promise<void> {\n    * If the user does not provide the necessary flags, prompt them for their\n    * preferences, unless `--yes` option was specified, or when running in CI.\n    */\n-  const skipPrompt = ciInfo.isCI || opts.yes\n+  let skipPrompt = ciInfo.isCI || opts.yes\n+  let useRecommendedDefaults = false\n \n   if (!example) {\n     const defaults: typeof preferences = {\n@@ -244,8 +245,124 @@ async function run(): Promise<void> {\n       disableGit: false,\n       reactCompiler: false,\n     }\n-    const getPrefOrDefault = (field: string) =>\n-      preferences[field] ?? defaults[field]\n+\n+    type DisplayConfigItem = {\n+      key: keyof typeof defaults\n+      values?: Record<string, string>\n+    }\n+\n+    const displayConfig: DisplayConfigItem[] = [\n+      {\n+        key: 'typescript',\n+        values: { true: 'TypeScript', false: 'JavaScript' },\n+      },\n+      { key: 'linter', values: { eslint: 'ESLint', biome: 'Biome' } },\n+      { key: 'reactCompiler', values: { true: 'React Compiler' } },\n+      { key: 'tailwind', values: { true: 'Tailwind CSS' } },\n+      { key: 'srcDir', values: { true: 'src/ dir' } },\n+      { key: 'app', values: { true: 'App Router', false: 'Pages Router' } },\n+      { key: 'turbopack', values: { true: 'Turbopack' } },\n+    ]\n+\n+    // Helper to format settings for display based on displayConfig\n+    const formatSettingsDescription = (\n+      settings: Record<string, boolean | string>\n+    ) => {\n+      const descriptions: string[] = []\n+\n+      for (const config of displayConfig) {\n+        const value = settings[config.key]\n+\n+        if (config.values) {\n+          // Look up the display label for this value\n+          const label = config.values[String(value)]\n+          if (label) {\n+            descriptions.push(label)\n+          }\n+        }\n+      }\n+\n+      return descriptions.join(', ')\n+    }\n+\n+    // Check if we have saved preferences\n+    const hasSavedPreferences = Object.keys(preferences).length > 0\n+\n+    // Check if user provided any configuration flags\n+    // If they did, skip the \"recommended defaults\" prompt and go straight to\n+    // individual prompts for any missing options\n+    const hasProvidedOptions = process.argv.some((arg) => arg.startsWith('--'))\n+\n+    // Only show the \"recommended defaults\" prompt if:\n+    // - Not in CI and not using --yes flag\n+    // - User hasn't provided any custom options\n+    if (!skipPrompt && !hasProvidedOptions) {\n+      const choices: Array<{\n+        title: string\n+        value: string\n+        description?: string\n+      }> = [\n+        {\n+          title: 'Yes, use recommended defaults',\n+          value: 'recommended',\n+          description: formatSettingsDescription(defaults),\n+        },\n+        {\n+          title: 'No, customize settings',\n+          value: 'customize',\n+          description: 'Choose your own preferences',\n+        },\n+      ]\n+\n+      // Add \"reuse previous settings\" option if we have saved preferences\n+      if (hasSavedPreferences) {\n+        const prefDescription = formatSettingsDescription(preferences)\n+        choices.splice(1, 0, {\n+          title: 'No, reuse previous settings',\n+          value: 'reuse',\n+          description: prefDescription,\n+        })\n+      }\n+\n+      const { setupChoice } = await prompts(\n+        {\n+          type: 'select',\n+          name: 'setupChoice',\n+          message: 'Would you like to use the recommended Next.js defaults?',\n+          choices,\n+          initial: 0,\n+        },\n+        {\n+          onCancel: () => {\n+            console.error('Exiting.')\n+            process.exit(1)\n+          },\n+        }\n+      )\n+\n+      if (setupChoice === 'recommended') {\n+        useRecommendedDefaults = true\n+        skipPrompt = true\n+      } else if (setupChoice === 'reuse') {\n+        skipPrompt = true\n+      }\n+    }\n+\n+    // If using recommended defaults, populate preferences with defaults\n+    // This ensures they are saved for reuse next time\n+    if (useRecommendedDefaults) {\n+      Object.assign(preferences, defaults)\n+    }\n+\n+    const getPrefOrDefault = (field: string) => {\n+      // If using recommended defaults, always use hardcoded defaults\n+      if (useRecommendedDefaults) {\n+        return defaults[field]\n+      }\n+\n+      // If not using the recommended template, we prefer saved preferences, otherwise defaults.\n+      return preferences[field] ?? defaults[field]\n+    }\n \n     if (!opts.typescript && !opts.javascript) {\n       if (skipPrompt) {"
        },
        {
            "sha": "2464ad18ca85e7705d042d5859207ccfd41ea3f2",
            "filename": "test/integration/create-next-app/lib/utils.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/0dc7498789f014f78b04072309a241db9423d249/test%2Fintegration%2Fcreate-next-app%2Flib%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0dc7498789f014f78b04072309a241db9423d249/test%2Fintegration%2Fcreate-next-app%2Flib%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcreate-next-app%2Flib%2Futils.ts?ref=0dc7498789f014f78b04072309a241db9423d249",
            "patch": "@@ -30,10 +30,13 @@ const cli = require.resolve('create-next-app/dist/index.js')\n export const createNextApp = (\n   args: string[],\n   options?: SpawnOptions,\n-  testVersion?: string\n+  testVersion?: string,\n+  clearPreferences: boolean = true\n ) => {\n   const conf = new Conf({ projectName: 'create-next-app' })\n-  conf.clear()\n+  if (clearPreferences) {\n+    conf.clear()\n+  }\n \n   console.log(`[TEST] $ ${cli} ${args.join(' ')}`, { options })\n "
        },
        {
            "sha": "597625d68b7f22e5d74294d0b191f236e6dc24b8",
            "filename": "test/integration/create-next-app/prompts.test.ts",
            "status": "modified",
            "additions": 100,
            "deletions": 0,
            "changes": 100,
            "blob_url": "https://github.com/vercel/next.js/blob/0dc7498789f014f78b04072309a241db9423d249/test%2Fintegration%2Fcreate-next-app%2Fprompts.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0dc7498789f014f78b04072309a241db9423d249/test%2Fintegration%2Fcreate-next-app%2Fprompts.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcreate-next-app%2Fprompts.test.ts?ref=0dc7498789f014f78b04072309a241db9423d249",
            "patch": "@@ -220,6 +220,106 @@ describe('create-next-app prompts', () => {\n     })\n   })\n \n+  it('should use recommended defaults when user selects that option', async () => {\n+    await useTempDir(async (cwd) => {\n+      const projectName = 'recommended-defaults'\n+      const childProcess = createNextApp(\n+        [projectName],\n+        {\n+          cwd,\n+        },\n+        nextTgzFilename\n+      )\n+\n+      await new Promise<void>((resolve) => {\n+        childProcess.on('exit', async (exitCode) => {\n+          expect(exitCode).toBe(0)\n+          projectFilesShouldExist({\n+            cwd,\n+            projectName,\n+            files: [\n+              'app',\n+              'package.json',\n+              'postcss.config.mjs', // tailwind\n+              'tsconfig.json', // typescript\n+            ],\n+          })\n+          resolve()\n+        })\n+\n+        // Select \"Yes, use recommended defaults\" (default option, just press enter)\n+        childProcess.stdin.write('\\n')\n+      })\n+\n+      const pkg = require(join(cwd, projectName, 'package.json'))\n+      expect(pkg.name).toBe(projectName)\n+      // Verify turbopack is in dev script\n+      expect(pkg.scripts.dev).toContain('--turbo')\n+    })\n+  })\n+\n+  it('should show reuse previous settings option when preferences exist', async () => {\n+    const Conf = require('next/dist/compiled/conf')\n+\n+    await useTempDir(async (cwd) => {\n+      // Manually set preferences to simulate a previous run\n+      const conf = new Conf({ projectName: 'create-next-app' })\n+      conf.set('preferences', {\n+        typescript: false,\n+        eslint: true,\n+        linter: 'eslint',\n+        tailwind: false,\n+        app: false,\n+        srcDir: false,\n+        importAlias: '@/*',\n+        customizeImportAlias: false,\n+        turbopack: false,\n+        reactCompiler: false,\n+      })\n+\n+      const projectName = 'reuse-prefs-project'\n+      const childProcess = createNextApp(\n+        [projectName],\n+        {\n+          cwd,\n+        },\n+        nextTgzFilename,\n+        false // Don't clear preferences\n+      )\n+\n+      await new Promise<void>(async (resolve) => {\n+        let output = ''\n+        childProcess.stdout.on('data', (data) => {\n+          output += data\n+          process.stdout.write(data)\n+        })\n+\n+        // Select \"reuse previous settings\" (cursor down once, then enter)\n+        childProcess.stdin.write('\\u001b[B\\n')\n+\n+        // Wait for the prompt to appear with \"reuse previous settings\"\n+        await check(() => output, /No, reuse previous settings/)\n+\n+        childProcess.on('exit', async (exitCode) => {\n+          expect(exitCode).toBe(0)\n+          projectFilesShouldExist({\n+            cwd,\n+            projectName,\n+            files: [\n+              'pages', // pages router (not app)\n+              'package.json',\n+              'jsconfig.json', // javascript\n+            ],\n+          })\n+          resolve()\n+        })\n+      })\n+\n+      const pkg = require(join(cwd, projectName, 'package.json'))\n+      expect(pkg.name).toBe(projectName)\n+    })\n+  })\n+\n   it('should prompt user to confirm reset preferences', async () => {\n     await useTempDir(async (cwd) => {\n       const childProcess = createNextApp("
        }
    ],
    "stats": {
        "total": 230,
        "additions": 225,
        "deletions": 5
    }
}