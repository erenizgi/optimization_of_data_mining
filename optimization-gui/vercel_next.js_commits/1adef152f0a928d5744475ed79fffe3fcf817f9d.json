{
    "author": "mischnic",
    "message": "Turbopack: correctly track `await import(\"path\")` in static analysis (#77811)\n\n1. There was a problem where the module name was `\"path\"` in the static analyzer (and not `path`), so the lookup to the Node builtin modules list silently failed as `\"\\\"path\\\"\" != \"path\"`\r\n2. Then, to make this actually correct, introduce `JsValue::Promise` and `JsValue::Awaited` so that `import(\"path\")` and `await import(\"path\")` actually are different JsValues\r\n\r\nThis is correctly tracked now and includes the Wasm asset in the NFT list:\r\n```js\r\n    const { readFileSync } = await import('fs')\r\n    const { join } = await import('path')\r\n    const wasm = readFileSync(\r\n      join(process.cwd(), '../web/lib/results/parser/biome_wasm_bg_opt.wasm')\r\n    )\r\n```\r\n\r\nCloses PACK-4269",
    "sha": "1adef152f0a928d5744475ed79fffe3fcf817f9d",
    "files": [
        {
            "sha": "b84ca3026bd5f8759bf425760f61cab1b71d6048",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/builtin.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fbuiltin.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fbuiltin.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fbuiltin.rs?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -662,6 +662,16 @@ pub fn replace_builtin(value: &mut JsValue) -> bool {\n             }\n         }\n \n+        JsValue::Awaited(_, operand) => {\n+            if let JsValue::Promise(_, inner) = &mut **operand {\n+                *value = take(inner);\n+                true\n+            } else {\n+                *value = take(operand);\n+                true\n+            }\n+        }\n+\n         _ => false,\n     }\n }"
        },
        {
            "sha": "649b596815655b420cd8411b1cc63b2234835365",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -543,7 +543,7 @@ impl EvalContext {\n                 SyntaxContext::empty(),\n             )),\n \n-            Expr::Await(AwaitExpr { arg, .. }) => self.eval(arg),\n+            Expr::Await(AwaitExpr { arg, .. }) => JsValue::awaited(Box::new(self.eval(arg))),\n \n             Expr::Seq(e) => {\n                 let mut seq = e.exprs.iter().map(|e| self.eval(e)).peekable();"
        },
        {
            "sha": "583e5a95e19be0ac468862c0a921da9cd2820f79",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/mod.rs",
            "status": "modified",
            "additions": 82,
            "deletions": 31,
            "changes": 113,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -111,6 +111,13 @@ impl ConstantString {\n         }\n     }\n \n+    pub fn as_atom(&self) -> Cow<Atom> {\n+        match self {\n+            Self::Atom(s) => Cow::Borrowed(s),\n+            Self::RcStr(s) => Cow::Owned(s.as_str().into()),\n+        }\n+    }\n+\n     pub fn is_empty(&self) -> bool {\n         self.as_str().is_empty()\n     }\n@@ -482,6 +489,12 @@ pub enum JsValue {\n     /// A tenary operator `test ? cons : alt`\n     /// `(total_node_count, test, cons, alt)`\n     Tenary(u32, Box<JsValue>, Box<JsValue>, Box<JsValue>),\n+    /// A promise resolving to some value\n+    /// `(total_node_count, value)`\n+    Promise(u32, Box<JsValue>),\n+    /// An await call (potentially) unwrapping a promise.\n+    /// `(total_node_count, value)`\n+    Awaited(u32, Box<JsValue>),\n \n     /// A for-of loop\n     ///\n@@ -734,6 +747,8 @@ impl Display for JsValue {\n             }\n             JsValue::Iterated(_, iterable) => write!(f, \"Iterated({})\", iterable),\n             JsValue::TypeOf(_, operand) => write!(f, \"typeof({})\", operand),\n+            JsValue::Promise(_, operand) => write!(f, \"Promise<{}>\", operand),\n+            JsValue::Awaited(_, operand) => write!(f, \"await({})\", operand),\n         }\n     }\n }\n@@ -795,6 +810,7 @@ impl JsValue {\n             | JsValue::Object { .. }\n             | JsValue::Alternatives { .. }\n             | JsValue::Function(..)\n+            | JsValue::Promise(..)\n             | JsValue::Member(..) => JsValueMetaKind::Nested,\n             JsValue::Concat(..)\n             | JsValue::Add(..)\n@@ -807,6 +823,7 @@ impl JsValue {\n             | JsValue::Tenary(..)\n             | JsValue::MemberCall(..)\n             | JsValue::Iterated(..)\n+            | JsValue::Awaited(..)\n             | JsValue::TypeOf(..) => JsValueMetaKind::Operation,\n             JsValue::Variable(..)\n             | JsValue::Argument(..)\n@@ -991,6 +1008,14 @@ impl JsValue {\n         Self::Member(1 + o.total_nodes() + p.total_nodes(), o, p)\n     }\n \n+    pub fn promise(operand: Box<JsValue>) -> Self {\n+        Self::Promise(1 + operand.total_nodes(), operand)\n+    }\n+\n+    pub fn awaited(operand: Box<JsValue>) -> Self {\n+        Self::Awaited(1 + operand.total_nodes(), operand)\n+    }\n+\n     pub fn unknown(\n         value: impl Into<Arc<JsValue>>,\n         side_effects: bool,\n@@ -1063,6 +1088,8 @@ impl JsValue {\n             | JsValue::Member(c, _, _)\n             | JsValue::Function(c, _, _)\n             | JsValue::Iterated(c, ..)\n+            | JsValue::Promise(c, ..)\n+            | JsValue::Awaited(c, ..)\n             | JsValue::TypeOf(c, ..) => *c,\n         }\n     }\n@@ -1104,6 +1131,12 @@ impl JsValue {\n             JsValue::Not(c, r) => {\n                 *c = 1 + r.total_nodes();\n             }\n+            JsValue::Promise(c, r) => {\n+                *c = 1 + r.total_nodes();\n+            }\n+            JsValue::Awaited(c, r) => {\n+                *c = 1 + r.total_nodes();\n+            }\n \n             JsValue::Object {\n                 total_nodes: c,\n@@ -1252,6 +1285,12 @@ impl JsValue {\n                 JsValue::TypeOf(_, operand) => {\n                     operand.make_unknown_without_content(false, \"node limit reached\");\n                 }\n+                JsValue::Awaited(_, operand) => {\n+                    operand.make_unknown_without_content(false, \"node limit reached\");\n+                }\n+                JsValue::Promise(_, operand) => {\n+                    operand.make_unknown_without_content(false, \"node limit reached\");\n+                }\n                 JsValue::Member(_, o, p) => {\n                     make_max_unknown([&mut **o, &mut **p].into_iter());\n                     self.update_total_nodes();\n@@ -1494,6 +1533,18 @@ impl JsValue {\n                     operand.explain_internal_inner(hints, indent_depth, depth, unknown_depth)\n                 )\n             }\n+            JsValue::Promise(_, operand) => {\n+                format!(\n+                    \"Promise<{}>\",\n+                    operand.explain_internal_inner(hints, indent_depth, depth, unknown_depth)\n+                )\n+            }\n+            JsValue::Awaited(_, operand) => {\n+                format!(\n+                    \"await({})\",\n+                    operand.explain_internal_inner(hints, indent_depth, depth, unknown_depth)\n+                )\n+            }\n             JsValue::New(_, callee, list) => {\n                 format!(\n                     \"new {}({})\",\n@@ -2111,6 +2162,8 @@ impl JsValue {\n             JsValue::Argument(_, _) => false,\n             JsValue::Iterated(_, iterable) => iterable.has_side_effects(),\n             JsValue::TypeOf(_, operand) => operand.has_side_effects(),\n+            JsValue::Promise(_, operand) => operand.has_side_effects(),\n+            JsValue::Awaited(_, operand) => operand.has_side_effects(),\n         }\n     }\n \n@@ -2307,7 +2360,8 @@ impl JsValue {\n             | JsValue::Module(..)\n             | JsValue::Function(..)\n             | JsValue::WellKnownObject(_)\n-            | JsValue::WellKnownFunction(_) => Some(false),\n+            | JsValue::WellKnownFunction(_)\n+            | JsValue::Promise(_, _) => Some(false),\n \n             // Booleans are not strings\n             JsValue::Not(..) | JsValue::Binary(..) => Some(false),\n@@ -2346,6 +2400,11 @@ impl JsValue {\n                 _,\n             ) => Some(true),\n \n+            JsValue::Awaited(_, operand) => match &**operand {\n+                JsValue::Promise(_, v) => v.is_string(),\n+                v => v.is_string(),\n+            },\n+\n             JsValue::FreeVar(..)\n             | JsValue::Variable(_)\n             | JsValue::Unknown { .. }\n@@ -2650,14 +2709,10 @@ macro_rules! for_each_children_async {\n                 $value.update_total_nodes();\n                 ($value, m1 || m2)\n             }\n-            JsValue::Iterated(_, box iterable) => {\n-                let (new_iterable, modified) = $visit_fn(take(iterable), $($args),+).await?;\n-                *iterable = new_iterable;\n-\n-                $value.update_total_nodes();\n-                ($value, modified)\n-            }\n-            JsValue::TypeOf(_, box operand) => {\n+            JsValue::Iterated(_, box operand)\n+            | JsValue::TypeOf(_, box operand)\n+            | JsValue::Promise(_, box operand)\n+            | JsValue::Awaited(_, box operand) => {\n                 let (new_operand, modified) = $visit_fn(take(operand), $($args),+).await?;\n                 *operand = new_operand;\n \n@@ -2962,15 +3017,10 @@ impl JsValue {\n                 modified\n             }\n \n-            JsValue::Iterated(_, iterable) => {\n-                let modified = visitor(iterable);\n-                if modified {\n-                    self.update_total_nodes();\n-                }\n-                modified\n-            }\n-\n-            JsValue::TypeOf(_, operand) => {\n+            JsValue::Iterated(_, operand)\n+            | JsValue::TypeOf(_, operand)\n+            | JsValue::Promise(_, operand)\n+            | JsValue::Awaited(_, operand) => {\n                 let modified = visitor(operand);\n                 if modified {\n                     self.update_total_nodes();\n@@ -3164,11 +3214,10 @@ impl JsValue {\n                 visitor(alt);\n             }\n \n-            JsValue::Iterated(_, iterable) => {\n-                visitor(iterable);\n-            }\n-\n-            JsValue::TypeOf(_, operand) => {\n+            JsValue::Iterated(_, operand)\n+            | JsValue::TypeOf(_, operand)\n+            | JsValue::Promise(_, operand)\n+            | JsValue::Awaited(_, operand) => {\n                 visitor(operand);\n             }\n \n@@ -3566,10 +3615,10 @@ impl JsValue {\n                 cons.similar_hash(state, depth - 1);\n                 alt.similar_hash(state, depth - 1);\n             }\n-            JsValue::Iterated(_, iterable) => {\n-                iterable.similar_hash(state, depth - 1);\n-            }\n-            JsValue::TypeOf(_, operand) => {\n+            JsValue::Iterated(_, operand)\n+            | JsValue::TypeOf(_, operand)\n+            | JsValue::Promise(_, operand)\n+            | JsValue::Awaited(_, operand) => {\n                 operand.similar_hash(state, depth - 1);\n             }\n             JsValue::Module(ModuleValue {\n@@ -3879,10 +3928,12 @@ pub mod test_utils {\n                 box JsValue::WellKnownFunction(WellKnownFunctionKind::Import),\n                 ref args,\n             ) => match &args[0] {\n-                JsValue::Constant(v) => JsValue::Module(ModuleValue {\n-                    module: v.to_string().into(),\n-                    annotations: ImportAnnotations::default(),\n-                }),\n+                JsValue::Constant(ConstantValue::Str(v)) => {\n+                    JsValue::promise(Box::new(JsValue::Module(ModuleValue {\n+                        module: v.as_atom().into_owned(),\n+                        annotations: ImportAnnotations::default(),\n+                    })))\n+                }\n                 _ => v.into_unknown(true, \"import() non constant\"),\n             },\n             JsValue::Call("
        },
        {
            "sha": "0f4e7c8d1151d9b374971c5ab8a35936e5aeb693",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/well_known.rs",
            "status": "modified",
            "additions": 22,
            "deletions": 5,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -57,11 +57,7 @@ pub async fn well_known_function_call(\n         WellKnownFunctionKind::PathJoin => path_join(args),\n         WellKnownFunctionKind::PathDirname => path_dirname(args),\n         WellKnownFunctionKind::PathResolve(cwd) => path_resolve(*cwd, args),\n-        WellKnownFunctionKind::Import => JsValue::unknown(\n-            JsValue::call(Box::new(JsValue::WellKnownFunction(kind)), args),\n-            true,\n-            \"import() is not supported\",\n-        ),\n+        WellKnownFunctionKind::Import => import(args),\n         WellKnownFunctionKind::Require => require(args),\n         WellKnownFunctionKind::RequireContextRequire(value) => {\n             require_context_require(value, args).await?\n@@ -322,6 +318,27 @@ pub fn path_dirname(mut args: Vec<JsValue>) -> JsValue {\n     )\n }\n \n+/// Resolve the contents of an import call, throwing errors\n+/// if we come across any unsupported syntax.\n+pub fn import(args: Vec<JsValue>) -> JsValue {\n+    match &args[..] {\n+        [JsValue::Constant(ConstantValue::Str(v))] => {\n+            JsValue::promise(Box::new(JsValue::Module(ModuleValue {\n+                module: v.as_atom().into_owned(),\n+                annotations: ImportAnnotations::default(),\n+            })))\n+        }\n+        _ => JsValue::unknown(\n+            JsValue::call(\n+                Box::new(JsValue::WellKnownFunction(WellKnownFunctionKind::Import)),\n+                args,\n+            ),\n+            true,\n+            \"only a single constant argument is supported\",\n+        ),\n+    }\n+}\n+\n /// Resolve the contents of a require call, throwing errors\n /// if we come across any unsupported syntax.\n pub fn require(args: Vec<JsValue>) -> JsValue {"
        },
        {
            "sha": "b010a97c17f9cb5341dd713115eb519892ffa5aa",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/conditional-import/resolved-explained.snapshot",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fconditional-import%2Fresolved-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fconditional-import%2Fresolved-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fconditional-import%2Fresolved-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,6 +1,6 @@\n-a = module<\"a\", {}>\n+a = Promise<module<a, {}>>\n \n-b = (???*0* | module<\"a\", {}> | module<\"b\", {}>)\n+b = (???*0* | Promise<module<a, {}>> | Promise<module<b, {}>>)\n - *0* b\n   ⚠️  pattern without value\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/imports/resolved-effects.snapshot",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fimports%2Fresolved-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fimports%2Fresolved-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fimports%2Fresolved-effects.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d"
        },
        {
            "sha": "7093c7abda13204bf66caef1e33e546c90761f6a",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/graph-effects.snapshot",
            "status": "modified",
            "additions": 413,
            "deletions": 30,
            "changes": 443,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-effects.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -5,13 +5,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     0,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -59,13 +62,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     0,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -94,13 +100,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     1,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -148,13 +157,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     1,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -193,13 +205,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     2,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -266,13 +281,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     2,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -311,13 +329,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     3,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -384,13 +405,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     3,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -429,13 +453,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     4,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -502,13 +529,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     4,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -547,13 +577,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     5,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -620,13 +653,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     5,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -665,13 +701,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     6,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -708,13 +747,16 @@\n         ),\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     6,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -824,13 +866,16 @@\n         ],\n         ast_path: [\n             Program(\n-                Script,\n+                Module,\n             ),\n-            Script(\n+            Module(\n                 Body(\n                     6,\n                 ),\n             ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n             Stmt(\n                 Decl,\n             ),\n@@ -853,4 +898,342 @@\n         in_try: false,\n         new: false,\n     },\n+    FreeVar {\n+        var: FreeVar(\n+            \"require\",\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    7,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 362..369,\n+        in_try: false,\n+    },\n+    Call {\n+        func: FreeVar(\n+            \"require\",\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"path\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    7,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 362..377,\n+        in_try: false,\n+        new: false,\n+    },\n+    Member {\n+        obj: Variable(\n+            (\n+                \"p1\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"join\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    10,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 458..465,\n+        in_try: false,\n+    },\n+    Member {\n+        obj: Member(\n+            3,\n+            Module(\n+                ModuleValue {\n+                    module: \"path\",\n+                    annotations: ImportAnnotations {\n+                        map: {},\n+                    },\n+                },\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"default\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"join\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    11,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 486..493,\n+        in_try: false,\n+    },\n+    ImportedBinding {\n+        esm_reference_index: 1,\n+        export: Some(\n+            \"default\",\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    11,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+            MemberExpr(\n+                Obj,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 486..488,\n+        in_try: false,\n+    },\n+    ImportedBinding {\n+        esm_reference_index: 2,\n+        export: Some(\n+            \"join\",\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    12,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 514..519,\n+        in_try: false,\n+    },\n+    Call {\n+        func: FreeVar(\n+            \"import\",\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"path\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    13,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Await,\n+            ),\n+            AwaitExpr(\n+                Arg,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 556..570,\n+        in_try: false,\n+        new: false,\n+    },\n ]"
        },
        {
            "sha": "ecdb98c186d31d4989bf516d4083969ae600646c",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/graph-explained.snapshot",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,7 +1,17 @@\n a = FreeVar(require)(\"foo\")\n \n+p1 = FreeVar(require)(\"path\")\n+\n path = FreeVar(require)(\"path\")\n \n+path_join1 = p1[\"join\"]\n+\n+path_join2 = module<path, {}>[\"default\"][\"join\"]\n+\n+path_join3 = module<path, {}>[\"join\"]\n+\n+path_join4 = await(FreeVar(import)(\"path\"))[\"join\"]\n+\n z1_joined = path[\"join\"](\"foo\", \"bar\")\n \n z2_joined = path[\"join\"](\"foo/\", \"bar\")"
        },
        {
            "sha": "5b73e69fc56efa3d3627e45b284531fc5f9b1d4a",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/graph.snapshot",
            "status": "modified",
            "additions": 120,
            "deletions": 0,
            "changes": 120,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fgraph.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -17,6 +17,24 @@\n             ],\n         ),\n     ),\n+    (\n+        \"p1\",\n+        Call(\n+            3,\n+            FreeVar(\n+                \"require\",\n+            ),\n+            [\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"path\",\n+                        ),\n+                    ),\n+                ),\n+            ],\n+        ),\n+    ),\n     (\n         \"path\",\n         Call(\n@@ -35,6 +53,108 @@\n             ],\n         ),\n     ),\n+    (\n+        \"path_join1\",\n+        Member(\n+            3,\n+            Variable(\n+                (\n+                    \"p1\",\n+                    #2,\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"join\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+    ),\n+    (\n+        \"path_join2\",\n+        Member(\n+            5,\n+            Member(\n+                3,\n+                Module(\n+                    ModuleValue {\n+                        module: \"path\",\n+                        annotations: ImportAnnotations {\n+                            map: {},\n+                        },\n+                    },\n+                ),\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"default\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"join\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+    ),\n+    (\n+        \"path_join3\",\n+        Member(\n+            3,\n+            Module(\n+                ModuleValue {\n+                    module: \"path\",\n+                    annotations: ImportAnnotations {\n+                        map: {},\n+                    },\n+                },\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"join\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+    ),\n+    (\n+        \"path_join4\",\n+        Member(\n+            6,\n+            Awaited(\n+                4,\n+                Call(\n+                    3,\n+                    FreeVar(\n+                        \"import\",\n+                    ),\n+                    [\n+                        Constant(\n+                            Str(\n+                                Atom(\n+                                    \"path\",\n+                                ),\n+                            ),\n+                        ),\n+                    ],\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"join\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+    ),\n     (\n         \"z1_joined\",\n         MemberCall("
        },
        {
            "sha": "9f83edb9bc6192d7baafd3112b0608ae09e22831",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/input.js",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Finput.js?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -9,3 +9,12 @@ const z2_joined = path.join(\"foo/\", \"bar\");\n const z3_joined = path.join(\"foo\", \"/bar\");\n const z4_joined = path.join(\"foo/\", \"/bar\");\n const z5_joined = path.join(\"foo\", \"bar\", \"..\", \"baz\", global, \"..\", \"foo\");\n+\n+const p1 = require(\"path\");\n+import p2 from \"path\";\n+import {join as pjoin} from \"path\";\n+\n+const path_join1 = p1.join;\n+const path_join2 = p2.join;\n+const path_join3 = pjoin;\n+const { join: path_join4 } = await import('path')"
        },
        {
            "sha": "ecba3cdcbad57e8492207a3349a81b2020d99bcc",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/resolved-effects.snapshot",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-effects.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -27,3 +27,11 @@\n - *1* FreeVar(global)\n   ⚠️  unknown global\n   ⚠️  This value might have side effects\n+\n+0 -> 16 free var = FreeVar(require)\n+\n+0 -> 17 call = require*0*(\"path\")\n+- *0* require: The require method from CommonJS\n+\n+0 -> 22 call = import*0*(\"path\")\n+- *0* import: The dynamic import() method from the ESM specification: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import#dynamic_imports"
        },
        {
            "sha": "101bbd1145827270055d50d18ac86b1c1b5aeaf6",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/path-join/resolved-explained.snapshot",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpath-join%2Fresolved-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,8 +1,23 @@\n a = module<foo, {}>\n \n+p1 = path*0*\n+- *0* path: The Node.js path module: https://nodejs.org/api/path.html\n+\n path = path*0*\n - *0* path: The Node.js path module: https://nodejs.org/api/path.html\n \n+path_join1 = path.join*0*\n+- *0* path.join: The Node.js path.join method: https://nodejs.org/api/path.html#pathjoinpaths\n+\n+path_join2 = path.join*0*\n+- *0* path.join: The Node.js path.join method: https://nodejs.org/api/path.html#pathjoinpaths\n+\n+path_join3 = path.join*0*\n+- *0* path.join: The Node.js path.join method: https://nodejs.org/api/path.html#pathjoinpaths\n+\n+path_join4 = path.join*0*\n+- *0* path.join: The Node.js path.join method: https://nodejs.org/api/path.html#pathjoinpaths\n+\n z1_joined = \"foo/bar\"\n \n z2_joined = \"foo/bar\""
        },
        {
            "sha": "3698e266e627b2ac05a35cd0d567b6a0ec574429",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/turbopack-ignore/graph-effects.snapshot",
            "status": "modified",
            "additions": 28,
            "deletions": 16,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-effects.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -40,11 +40,17 @@\n             VarDeclarator(\n                 Init,\n             ),\n+            Expr(\n+                Await,\n+            ),\n+            AwaitExpr(\n+                Arg,\n+            ),\n             Expr(\n                 Call,\n             ),\n         ],\n-        span: 13..52,\n+        span: 19..58,\n         in_try: false,\n         new: false,\n     },\n@@ -91,7 +97,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 65..72,\n+        span: 71..78,\n         in_try: false,\n     },\n     Call {\n@@ -139,7 +145,7 @@\n                 Call,\n             ),\n         ],\n-        span: 65..108,\n+        span: 71..114,\n         in_try: false,\n         new: false,\n     },\n@@ -184,11 +190,17 @@\n             VarDeclarator(\n                 Init,\n             ),\n+            Expr(\n+                Await,\n+            ),\n+            AwaitExpr(\n+                Arg,\n+            ),\n             Expr(\n                 Call,\n             ),\n         ],\n-        span: 121..162,\n+        span: 133..174,\n         in_try: false,\n         new: false,\n     },\n@@ -235,7 +247,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 175..182,\n+        span: 187..194,\n         in_try: false,\n     },\n     Call {\n@@ -283,7 +295,7 @@\n                 Call,\n             ),\n         ],\n-        span: 175..220,\n+        span: 187..232,\n         in_try: false,\n         new: false,\n     },\n@@ -330,7 +342,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 233..240,\n+        span: 245..252,\n         in_try: false,\n     },\n     Call {\n@@ -378,7 +390,7 @@\n                 Call,\n             ),\n         ],\n-        span: 233..275,\n+        span: 245..287,\n         in_try: false,\n         new: false,\n     },\n@@ -425,7 +437,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 288..295,\n+        span: 300..307,\n         in_try: false,\n     },\n     Call {\n@@ -473,7 +485,7 @@\n                 Call,\n             ),\n         ],\n-        span: 288..331,\n+        span: 300..343,\n         in_try: false,\n         new: false,\n     },\n@@ -520,7 +532,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 344..351,\n+        span: 356..363,\n         in_try: false,\n     },\n     Call {\n@@ -568,7 +580,7 @@\n                 Call,\n             ),\n         ],\n-        span: 344..388,\n+        span: 356..400,\n         in_try: false,\n         new: false,\n     },\n@@ -615,7 +627,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 401..408,\n+        span: 413..420,\n         in_try: false,\n     },\n     Call {\n@@ -663,7 +675,7 @@\n                 Call,\n             ),\n         ],\n-        span: 401..446,\n+        span: 413..458,\n         in_try: false,\n         new: false,\n     },\n@@ -713,7 +725,7 @@\n                 Ident,\n             ),\n         ],\n-        span: 476..483,\n+        span: 488..495,\n         in_try: false,\n     },\n     Call {\n@@ -764,7 +776,7 @@\n                 Call,\n             ),\n         ],\n-        span: 476..527,\n+        span: 488..539,\n         in_try: false,\n         new: false,\n     },"
        },
        {
            "sha": "79bc8bf23c03a4a07015580f9f89e742790092d2",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/turbopack-ignore/graph-explained.snapshot",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,6 +1,6 @@\n exported_t_r = FreeVar(require)(\"exported_t_r\")\n \n-t_i = FreeVar(import)(\"t_i\")\n+t_i = await(FreeVar(import)(\"t_i\"))\n \n t_r = (\n   | FreeVar(require)(\"w_i_f\")\n@@ -9,6 +9,6 @@ t_r = (\n   | FreeVar(require)(\"t_r_f\")\n )\n \n-w_i = FreeVar(import)(\"w_i\")\n+w_i = await(FreeVar(import)(\"w_i\"))\n \n w_r = (FreeVar(require)(\"w_r_t\") | FreeVar(require)(\"w_r_f\"))"
        },
        {
            "sha": "c96b2452e38d9ac9cb89006156829be08275886e",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/turbopack-ignore/graph.snapshot",
            "status": "modified",
            "additions": 30,
            "deletions": 24,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fgraph.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -19,20 +19,23 @@\n     ),\n     (\n         \"t_i\",\n-        Call(\n-            3,\n-            FreeVar(\n-                \"import\",\n-            ),\n-            [\n-                Constant(\n-                    Str(\n-                        Atom(\n-                            \"t_i\",\n+        Awaited(\n+            4,\n+            Call(\n+                3,\n+                FreeVar(\n+                    \"import\",\n+                ),\n+                [\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"t_i\",\n+                            ),\n                         ),\n                     ),\n-                ),\n-            ],\n+                ],\n+            ),\n         ),\n     ),\n     (\n@@ -106,20 +109,23 @@\n     ),\n     (\n         \"w_i\",\n-        Call(\n-            3,\n-            FreeVar(\n-                \"import\",\n-            ),\n-            [\n-                Constant(\n-                    Str(\n-                        Atom(\n-                            \"w_i\",\n+        Awaited(\n+            4,\n+            Call(\n+                3,\n+                FreeVar(\n+                    \"import\",\n+                ),\n+                [\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"w_i\",\n+                            ),\n                         ),\n                     ),\n-                ),\n-            ],\n+                ],\n+            ),\n         ),\n     ),\n     ("
        },
        {
            "sha": "258c5e8b9d93e5d2632cb752d6c986ea82367227",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/turbopack-ignore/input.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Finput.js?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,6 +1,6 @@\n-const w_i = import(/* webpackIgnore: true */ 'w_i')\n+const w_i = await import(/* webpackIgnore: true */ 'w_i')\n const t_r = require(/* webpackIgnore: false */ 'w_i_f')\n-const t_i = import(/* turbopackIgnore: true */ 't_i')\n+const t_i = await import(/* turbopackIgnore: true */ 't_i')\n const t_r = require(/* turbopackIgnore: false */ 't_i_f')\n const w_r = require(/* webpackIgnore: true */ 'w_r_t')\n const w_r = require(/* webpackIgnore: false */ 'w_r_f')"
        },
        {
            "sha": "c19f6655a98004592af50238997304fe26aa9cfc",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/turbopack-ignore/resolved-explained.snapshot",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fresolved-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fresolved-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fturbopack-ignore%2Fresolved-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -1,9 +1,9 @@\n exported_t_r = module<exported_t_r, {}>\n \n-t_i = module<\"t_i\", {}>\n+t_i = module<t_i, {}>\n \n t_r = (module<w_i_f, {}> | module<t_i_f, {}> | module<t_r_t, {}> | module<t_r_f, {}>)\n \n-w_i = module<\"w_i\", {}>\n+w_i = module<w_i, {}>\n \n w_r = (module<w_r_t, {}> | module<w_r_f, {}>)"
        },
        {
            "sha": "7dad9c7b197e536466f320d7a1e8b0b3d953d6f6",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/webpack-target-node/graph-explained.snapshot",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph-explained.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -24,7 +24,7 @@ exports = {}\n \n handler = (...) => undefined\n \n-hello = promises_namespaceObject[\"readFile\"](\"./hello.txt\", \"utf-8\")\n+hello = await(promises_namespaceObject[\"readFile\"](\"./hello.txt\", \"utf-8\"))\n \n moduleId = arguments[0]\n "
        },
        {
            "sha": "8edd9e55680f81a5005c16a86315db5ff8b04d9c",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/webpack-target-node/graph.snapshot",
            "status": "modified",
            "additions": 24,
            "deletions": 21,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/1adef152f0a928d5744475ed79fffe3fcf817f9d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fwebpack-target-node%2Fgraph.snapshot?ref=1adef152f0a928d5744475ed79fffe3fcf817f9d",
            "patch": "@@ -141,37 +141,40 @@\n     ),\n     (\n         \"hello\",\n-        MemberCall(\n-            5,\n-            Variable(\n-                (\n-                    \"promises_namespaceObject\",\n-                    #4,\n-                ),\n-            ),\n-            Constant(\n-                Str(\n-                    Atom(\n-                        \"readFile\",\n+        Awaited(\n+            6,\n+            MemberCall(\n+                5,\n+                Variable(\n+                    (\n+                        \"promises_namespaceObject\",\n+                        #4,\n                     ),\n                 ),\n-            ),\n-            [\n                 Constant(\n                     Str(\n                         Atom(\n-                            \"./hello.txt\",\n+                            \"readFile\",\n                         ),\n                     ),\n                 ),\n-                Constant(\n-                    Str(\n-                        Atom(\n-                            \"utf-8\",\n+                [\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"./hello.txt\",\n+                            ),\n                         ),\n                     ),\n-                ),\n-            ],\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"utf-8\",\n+                            ),\n+                        ),\n+                    ),\n+                ],\n+            ),\n         ),\n     ),\n     ("
        }
    ],
    "stats": {
        "total": 918,
        "additions": 781,
        "deletions": 137
    }
}