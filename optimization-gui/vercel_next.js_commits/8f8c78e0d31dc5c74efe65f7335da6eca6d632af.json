{
    "author": "sokra",
    "message": "Turbopack: add more side effects test cases (#82465)\n\n### What?\r\n\r\nAdd more test cases for the side effects optimization that are currently broken\r\n\r\nCloses https://github.com/vercel/next.js/pull/82411",
    "sha": "8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
    "files": [
        {
            "sha": "d9361ac0bfada89f64023fcbb15586176304e585",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/input/index.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Findex.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,11 @@\n+import { something } from './main'\n+\n+it('correct order', () => {\n+  expect(something).toBe('inner')\n+  expect(globalThis.order).toEqual([\n+    // TODO Order should be 'inner throws', 'module'\n+    'module',\n+    'inner no-throws',\n+    'main',\n+  ])\n+})"
        },
        {
            "sha": "ed628856f99a1419aa91fb9e8960a6208aa8dfea",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/input/inner.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Finner.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Finner.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Finner.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,9 @@\n+import { value } from './module.js'\n+export const something = 'inner'\n+let throws = false\n+try {\n+  value\n+} catch {\n+  throws = true\n+}\n+;(globalThis.order ??= []).push(`inner ${throws ? 'throws' : 'no-throws'}`)"
        },
        {
            "sha": "6711b3975bbce340079801e7277605f3576f4d4e",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/input/main.js",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmain.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmain.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmain.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,2 @@\n+export { something } from './module.js'\n+;(globalThis.order ??= []).push('main')"
        },
        {
            "sha": "389da74194b4b528ba3ddd24b281f733166ce9bd",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/input/module.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fmodule.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,3 @@\n+export { something } from './inner.js'\n+export const value = 42\n+;(globalThis.order ??= []).push('module')"
        },
        {
            "sha": "3dbc1ca591c0557e35b6004aeba250e6a70b56e3",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/input/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Finput%2Fpackage.json?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"type\": \"module\"\n+}"
        },
        {
            "sha": "4003131fcb60b7d5f1025af892f5a8b398d1bd67",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/cycle-order/options.json",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fcycle-order%2Foptions.json?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,4 @@\n+{\n+  \"scopeHoisting\": false,\n+  \"treeShakingMode\": \"reexports-only\"\n+}"
        },
        {
            "sha": "67927c1713961ebb0c3b6d434b3ea158af296fff",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-named-side-effect/check-side-effect.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fcheck-side-effect.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fcheck-side-effect.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fcheck-side-effect.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export const effects = []\n+\n+export function effect(name) {\n+  effects.push(name)\n+}"
        },
        {
            "sha": "8c5985194ebc4a5d8a4b40234b870ba34638b8d1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-named-side-effect/index.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Findex.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export { a } from './side-effect.js'\n+\n+import { effect } from './check-side-effect.js'\n+\n+effect('index.js')"
        },
        {
            "sha": "9ee1b0babce9ce6d76420f545d38187050233f2b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-named-side-effect/package.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fpackage.json?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"sideEffects\": [\n+    \"./side-effect.js\"\n+  ]\n+}"
        },
        {
            "sha": "0592455dc83a31dcdfc77f65245a078474876bdb",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-named-side-effect/side-effect.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fside-effect.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fside-effect.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-named-side-effect%2Fside-effect.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export { a } from 'package-star'\n+\n+import { effect } from './check-side-effect.js'\n+\n+effect('side-effect.js')"
        },
        {
            "sha": "67927c1713961ebb0c3b6d434b3ea158af296fff",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-side-effect/check-side-effect.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fcheck-side-effect.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fcheck-side-effect.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fcheck-side-effect.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export const effects = []\n+\n+export function effect(name) {\n+  effects.push(name)\n+}"
        },
        {
            "sha": "dfc6be796d9ba42a6a95461386ed80ab6a6ce83c",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-side-effect/index.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Findex.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export * from './side-effect.js'\n+\n+import { effect } from './check-side-effect.js'\n+\n+effect('index.js')"
        },
        {
            "sha": "9ee1b0babce9ce6d76420f545d38187050233f2b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-side-effect/package.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fpackage.json?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"sideEffects\": [\n+    \"./side-effect.js\"\n+  ]\n+}"
        },
        {
            "sha": "e412421397855d7782f99c541b9c6567e3fa47ea",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/node_modules/package-intermediate-side-effect/side-effect.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fside-effect.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fside-effect.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fnode_modules%2Fpackage-intermediate-side-effect%2Fside-effect.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -0,0 +1,5 @@\n+export * from 'package-star'\n+\n+import { effect } from './check-side-effect.js'\n+\n+effect('side-effect.js')"
        },
        {
            "sha": "a44ac8e5682411fefecc3cc61cf027ac5ffdadec",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/reexport-side-effects/input/index.js",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Freexport-side-effects%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8f8c78e0d31dc5c74efe65f7335da6eca6d632af/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Freexport-side-effects%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Freexport-side-effects%2Finput%2Findex.js?ref=8f8c78e0d31dc5c74efe65f7335da6eca6d632af",
            "patch": "@@ -18,3 +18,23 @@ it('should run side effects of a reexporting module with side effects (async mod\n   require('package-require-side-effect')\n   expect(effects8).toEqual(['side-effect.js', 'side-effect2.js', 'index.js'])\n })\n+\n+import { a as a9 } from 'package-intermediate-side-effect'\n+import { effects as effects9 } from 'package-intermediate-side-effect/check-side-effect'\n+it('should run side effects of an intermediate module with side effects (star reexports)', () => {\n+  expect(a9).toBe('a')\n+  expect(effects9).toEqual([\n+    // TODO This should execute the side effect of the intermediate module\n+    // 'side-effect.js'\n+  ])\n+})\n+\n+import { a as a10 } from 'package-intermediate-named-side-effect'\n+import { effects as effects10 } from 'package-intermediate-named-side-effect/check-side-effect'\n+it('should run side effects of an intermediate module with side effects (named reexports)', () => {\n+  expect(a10).toBe('a')\n+  expect(effects10).toEqual([\n+    // TODO This should execute the side effect of the intermediate module\n+    // 'side-effect.js'\n+  ])\n+})"
        }
    ],
    "stats": {
        "total": 92,
        "additions": 92,
        "deletions": 0
    }
}