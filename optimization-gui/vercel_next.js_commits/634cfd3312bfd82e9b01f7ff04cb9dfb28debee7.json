{
    "author": "wbinnssmith",
    "message": "bundle analyzer: remove custom output option (#87267)\n\nThis functionality was added late in #87258 but was broken as we needed\nto pass this along to the Rust side. We'd also need to be able to write\nto arbitrary absolute paths there, so let's punt on it.\n\nTest Plan: e2e tests",
    "sha": "634cfd3312bfd82e9b01f7ff04cb9dfb28debee7",
    "files": [
        {
            "sha": "f160ea2acaf6694a93ee0e6eb227aeb43312ca23",
            "filename": "packages/next/src/bin/next.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts?ref=634cfd3312bfd82e9b01f7ff04cb9dfb28debee7",
            "patch": "@@ -213,8 +213,8 @@ program\n   .option('--no-mangling', 'Disables mangling.')\n   .option('--profile', 'Enables production profiling for React.')\n   .option(\n-    '-o, --output [path]',\n-    'Only write analysis files to disk. Does not start the server. Optionally specify a custom output path (defaults to .next/diagnostics/analyze).'\n+    '-o, --output',\n+    'Only write analysis files to disk. Does not start the server.'\n   )\n   .addOption(\n     new Option("
        },
        {
            "sha": "bc9b099743544e82a3ec765c5a7175fb346f0ee1",
            "filename": "packages/next/src/build/analyze/index.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 25,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts?ref=634cfd3312bfd82e9b01f7ff04cb9dfb28debee7",
            "patch": "@@ -30,14 +30,12 @@ import { eventAnalyzeCompleted } from '../../telemetry/events'\n import { traceGlobals } from '../../trace/shared'\n import type { RoutesManifest } from '..'\n \n-const ANALYZE_PATH = '.next/diagnostics/analyze'\n-\n export type AnalyzeOptions = {\n   dir: string\n   reactProductionProfiling?: boolean\n   noMangling?: boolean\n   appDirOnly?: boolean\n-  output?: boolean | string\n+  output?: boolean\n   port?: number\n }\n \n@@ -77,36 +75,27 @@ export default async function analyze({\n       await turbopackAnalyze(analyzeContext)\n \n     const durationString = durationToString(analyzeDuration)\n-\n-    // Determine the output path: use custom path if provided, otherwise default\n-    const outputPath = typeof output === 'string' ? output : ANALYZE_PATH\n-    const resolvedOutputPath = path.isAbsolute(outputPath)\n-      ? outputPath\n-      : path.join(dir, outputPath)\n-\n-    let logMessage = `Analyze completed in ${durationString}.`\n-    if (output) {\n-      logMessage += ` Results written to ${outputPath}.\\nTo explore the analyze results interactively, run \\`next experimental-analyze\\` without \\`--output\\`.`\n-    }\n-    Log.event(logMessage)\n+    const analyzeDir = path.join(distDir, 'diagnostics/analyze')\n \n     await shutdownPromise\n \n-    await cp(\n-      path.join(__dirname, '../../bundle-analyzer'),\n-      resolvedOutputPath,\n-      { recursive: true }\n-    )\n-\n-    // Collect and write routes for the bundle analyzer\n     const routes = await collectRoutesForAnalyze(dir, config, appDirOnly)\n \n-    await mkdir(path.join(resolvedOutputPath, 'data'), { recursive: true })\n+    await cp(path.join(__dirname, '../../bundle-analyzer'), analyzeDir, {\n+      recursive: true,\n+    })\n+    await mkdir(path.join(analyzeDir, 'data'), { recursive: true })\n     await writeFile(\n-      path.join(resolvedOutputPath, 'data', 'routes.json'),\n+      path.join(analyzeDir, 'data', 'routes.json'),\n       JSON.stringify(routes, null, 2)\n     )\n \n+    let logMessage = `Analyze completed in ${durationString}.`\n+    if (output) {\n+      logMessage += ` Results written to ${analyzeDir}.\\nTo explore the analyze results interactively, run \\`next experimental-analyze\\` without \\`--output\\`.`\n+    }\n+    Log.event(logMessage)\n+\n     telemetry.record(\n       eventAnalyzeCompleted({\n         success: true,\n@@ -116,7 +105,7 @@ export default async function analyze({\n     )\n \n     if (!output) {\n-      await startServer(resolvedOutputPath, port)\n+      await startServer(analyzeDir, port)\n     }\n   } catch (e) {\n     const telemetry = traceGlobals.get('telemetry') as Telemetry | undefined"
        },
        {
            "sha": "566d8a9a2a58070080c0208b6774934e8eb1dee4",
            "filename": "packages/next/src/cli/next-analyze.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fcli%2Fnext-analyze.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/packages%2Fnext%2Fsrc%2Fcli%2Fnext-analyze.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-analyze.ts?ref=634cfd3312bfd82e9b01f7ff04cb9dfb28debee7",
            "patch": "@@ -13,7 +13,7 @@ export type NextAnalyzeOptions = {\n   profile?: boolean\n   mangling: boolean\n   port: number\n-  output: boolean | string\n+  output: boolean\n   experimentalAppOnly?: boolean\n }\n "
        },
        {
            "sha": "3fe1f603a6519dac017c9f3949d39de79acbeb01",
            "filename": "test/e2e/next-analyze/next-analyze.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 40,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/test%2Fe2e%2Fnext-analyze%2Fnext-analyze.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/634cfd3312bfd82e9b01f7ff04cb9dfb28debee7/test%2Fe2e%2Fnext-analyze%2Fnext-analyze.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-analyze%2Fnext-analyze.test.ts?ref=634cfd3312bfd82e9b01f7ff04cb9dfb28debee7",
            "patch": "@@ -49,7 +49,7 @@ describe('next experimental-analyze', () => {\n   })\n   ;['-o', '--output'].forEach((flag) => {\n     describe(`with ${flag} flag`, () => {\n-      it('writes output to default path when no path is specified', async () => {\n+      it('writes output to .next/diagnostics/analyze path', async () => {\n         const defaultOutputPath = path.join(\n           next.testDir,\n           '.next/diagnostics/analyze'\n@@ -69,12 +69,14 @@ describe('next experimental-analyze', () => {\n         expect(stdout).toContain('.next/diagnostics/analyze')\n \n         expect(existsSync(defaultOutputPath)).toBe(true)\n-        expect(existsSync(path.join(defaultOutputPath, 'index.html'))).toBe(\n-          true\n-        )\n-        expect(\n-          existsSync(path.join(defaultOutputPath, 'data', 'routes.json'))\n-        ).toBe(true)\n+        for (const file of [\n+          'index.html',\n+          'data/routes.json',\n+          'data/modules.data',\n+          'data/analyze.data',\n+        ]) {\n+          expect(existsSync(path.join(defaultOutputPath, file))).toBe(true)\n+        }\n \n         const routesJson = readFileSync(\n           path.join(defaultOutputPath, 'data', 'routes.json'),\n@@ -83,39 +85,6 @@ describe('next experimental-analyze', () => {\n         const routes = JSON.parse(routesJson)\n         expect(routes).toEqual(['/', '/_not-found'])\n       })\n-\n-      it('writes output to custom path', async () => {\n-        const customOutputPath = path.join(\n-          next.testDir,\n-          'nested/output/directory'\n-        )\n-\n-        const { code, stderr, stdout } = await runNextCommand(\n-          ['experimental-analyze', flag, 'nested/output/directory'],\n-          {\n-            cwd: next.testDir,\n-            stderr: true,\n-            stdout: true,\n-          }\n-        )\n-\n-        expect(code).toBe(0)\n-        expect(stderr).not.toContain('Error')\n-        expect(stdout).toContain('nested/output/directory')\n-\n-        expect(existsSync(customOutputPath)).toBe(true)\n-        expect(existsSync(path.join(customOutputPath, 'index.html'))).toBe(true)\n-        expect(\n-          existsSync(path.join(customOutputPath, 'data', 'routes.json'))\n-        ).toBe(true)\n-\n-        const routesJson = readFileSync(\n-          path.join(customOutputPath, 'data', 'routes.json'),\n-          'utf-8'\n-        )\n-        const routes = JSON.parse(routesJson)\n-        expect(routes).toEqual(['/', '/_not-found'])\n-      })\n     })\n   })\n })"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 26,
        "deletions": 68
    }
}