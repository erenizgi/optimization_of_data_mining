{
    "author": "kdy1",
    "message": "chore(ci): Configure codspeed (#76884)\n\n### What?\n\nConfigure codspeed\n\n### Why?\n\nTo track performance changes of small functions correctly.\n\n### How?\n\n---------\n\nCo-authored-by: Benjamin Woodruff <benjamin.woodruff@vercel.com>",
    "sha": "49b000831aa9de469408c897f823bfd50d218822",
    "files": [
        {
            "sha": "f116ec5a09e42110169d03362b4511f405d6f9ef",
            "filename": ".github/workflows/bench.yml",
            "status": "added",
            "additions": 70,
            "deletions": 0,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/49b000831aa9de469408c897f823bfd50d218822/.github%2Fworkflows%2Fbench.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/49b000831aa9de469408c897f823bfd50d218822/.github%2Fworkflows%2Fbench.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbench.yml?ref=49b000831aa9de469408c897f823bfd50d218822",
            "patch": "@@ -0,0 +1,70 @@\n+name: Benchmark\n+\n+on:\n+  push:\n+    branches:\n+      - canary\n+    paths:\n+      - '**/crates/**'\n+  pull_request:\n+    types: ['labeled']\n+\n+concurrency:\n+  group: ${{ github.workflow }}-${{ github.sha }}\n+  cancel-in-progress: ${{ github.event_name == 'pull_request' }}\n+\n+env:\n+  CI: 1\n+  CARGO_INCREMENTAL: 0\n+  # For faster CI\n+  RUST_LOG: 'off'\n+\n+jobs:\n+  list-crates:\n+    name: List crates to benchmark\n+    runs-on:\n+      - 'self-hosted'\n+      - 'linux'\n+      - 'x64'\n+      - 'metal'\n+    if: ${{ github.event.label.name == 'benchmark' }}\n+    outputs:\n+      crates: ${{ steps.list-crates.outputs.crates }}\n+    steps:\n+      - uses: actions/checkout@v4\n+\n+      - name: List crates\n+        id: list-crates\n+        run: echo \"crates=$(./scripts/cargo/bench/list-crates-with-bench.sh)\" >> $GITHUB_OUTPUT\n+\n+  benchmark-crate:\n+    name: Benchmark ${{ matrix.crate }}\n+    runs-on: ubuntu-22.04\n+    needs: list-crates\n+    # Limit the number of concurrent jobs to 1\n+    concurrency:\n+      group: ${{ github.workflow }}\n+    strategy:\n+      matrix:\n+        crate: ${{fromJson(needs.list-crates.outputs.crates)}}\n+    steps:\n+      - uses: actions/checkout@v4\n+\n+      - name: Install Rust\n+        uses: actions-rs/toolchain@v1\n+        with:\n+          profile: minimal\n+\n+      - name: Install cargo-codspeed\n+        uses: taiki-e/install-action@v2\n+        with:\n+          tool: cargo-codspeed@2.8.1\n+\n+      - name: Build the benchmark target(s)\n+        run: cargo codspeed build -p ${{ matrix.crate }}\n+\n+      - name: Run the benchmarks\n+        uses: CodSpeedHQ/action@v3\n+        with:\n+          run: cargo codspeed run\n+          token: ${{ secrets.CODSPEED_TOKEN }}"
        },
        {
            "sha": "538269209d36c7afdcc8f44f48dd8f644baba895",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/49b000831aa9de469408c897f823bfd50d218822/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/49b000831aa9de469408c897f823bfd50d218822/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=49b000831aa9de469408c897f823bfd50d218822",
            "patch": "@@ -2239,9 +2239,9 @@ checksum = \"5443807d6dff69373d433ab9ef5378ad8df50ca6298caf15de6e52e24aaf54d5\"\n \n [[package]]\n name = \"erased-serde\"\n-version = \"0.4.5\"\n+version = \"0.4.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"24e2389d65ab4fab27dc2a5de7b191e1f6617d1f1c8855c0dc569c94a4cbb18d\"\n+checksum = \"e004d887f51fcb9fef17317a2f3525c887d8aa3f4f50fed920816a688284a5b7\"\n dependencies = [\n  \"serde\",\n  \"typeid\",\n@@ -5581,13 +5581,13 @@ checksum = \"a993555f31e5a609f617c12db6250dedcac1b0a85076912c436e6fc9b2c8e6a3\"\n \n [[package]]\n name = \"quick_cache\"\n-version = \"0.6.9\"\n+version = \"0.6.11\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7d7c94f8935a9df96bb6380e8592c70edf497a643f94bd23b2f76b399385dbf4\"\n+checksum = \"0af25b4e960ffdf0dead61cf0cec0c2e44c76927bf933ab4f02e2858fb449397\"\n dependencies = [\n  \"ahash 0.8.11\",\n  \"equivalent\",\n- \"hashbrown 0.14.5\",\n+ \"hashbrown 0.15.2\",\n  \"parking_lot\",\n ]\n \n@@ -9134,7 +9134,7 @@ dependencies = [\n  \"serde\",\n  \"tempfile\",\n  \"thread_local\",\n- \"twox-hash 2.0.1\",\n+ \"twox-hash 2.1.0\",\n  \"zstd\",\n ]\n \n@@ -10115,9 +10115,9 @@ dependencies = [\n \n [[package]]\n name = \"twox-hash\"\n-version = \"2.0.1\"\n+version = \"2.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a6db6856664807f43c17fbaf2718e2381ac1476a449aa104f5f64622defa1245\"\n+checksum = \"e7b17f197b3050ba473acf9181f7b1d3b66d1cf7356c6cc57886662276e65908\"\n dependencies = [\n  \"rand\",\n ]\n@@ -10130,9 +10130,9 @@ checksum = \"6af6ae20167a9ece4bcb41af5b80f8a1f1df981f6391189ce00fd257af04126a\"\n \n [[package]]\n name = \"typeid\"\n-version = \"1.0.2\"\n+version = \"1.0.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0e13db2e0ccd5e14a544e8a246ba2312cd25223f616442d7f2cb0e3db614236e\"\n+checksum = \"bc7d623258602320d5c55d1bc22793b57daff0ec7efc270ea7d55ce1d5f5471c\"\n \n [[package]]\n name = \"typenum\""
        },
        {
            "sha": "9f304daaa8cf6430310164511498df481e698327",
            "filename": "scripts/cargo/bench/get-workspace-crates.sh",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/49b000831aa9de469408c897f823bfd50d218822/scripts%2Fcargo%2Fbench%2Fget-workspace-crates.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/49b000831aa9de469408c897f823bfd50d218822/scripts%2Fcargo%2Fbench%2Fget-workspace-crates.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcargo%2Fbench%2Fget-workspace-crates.sh?ref=49b000831aa9de469408c897f823bfd50d218822",
            "patch": "@@ -0,0 +1,5 @@\n+#!/usr/bin/env bash\n+\n+set -eu\n+\n+cargo metadata --format-version 1 --no-deps | jq -r -j '[.packages[] | select(.source == null)]'\n\\ No newline at end of file"
        },
        {
            "sha": "18f16c293d48150c3b9a9751e9791477ffb00311",
            "filename": "scripts/cargo/bench/list-crates-with-bench.sh",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/49b000831aa9de469408c897f823bfd50d218822/scripts%2Fcargo%2Fbench%2Flist-crates-with-bench.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/49b000831aa9de469408c897f823bfd50d218822/scripts%2Fcargo%2Fbench%2Flist-crates-with-bench.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcargo%2Fbench%2Flist-crates-with-bench.sh?ref=49b000831aa9de469408c897f823bfd50d218822",
            "patch": "@@ -0,0 +1,8 @@\n+#!/usr/bin/env bash\n+\n+set -eu\n+\n+SCRIPT_DIR=\"$( cd -- \"$( dirname -- \"${BASH_SOURCE[0]}\" )\" &> /dev/null && pwd )\"\n+\n+WS_CRATES=\"$(\"$SCRIPT_DIR\"/get-workspace-crates.sh)\"\n+echo \"$WS_CRATES\" | jq -r -c '[.[] | select(.targets[] | .kind | contains([\"bench\"])) | .name] | sort | unique' | jq -r -c '[.[] | select(. != \"napi\" and . != \"wasm\")]'"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 93,
        "deletions": 10
    }
}