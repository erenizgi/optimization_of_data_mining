{
    "author": "eps1lon",
    "message": "Enforce consistency between packages in preview builds (#79610)",
    "sha": "522793548a23298bd17cae272802959ba5fc7f98",
    "files": [
        {
            "sha": "83c82b2e3260b6b1c8ed335cf8146d1ed1dd56e2",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/522793548a23298bd17cae272802959ba5fc7f98/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/522793548a23298bd17cae272802959ba5fc7f98/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=522793548a23298bd17cae272802959ba5fc7f98",
            "patch": "@@ -532,7 +532,7 @@ jobs:\n           path: crates/wasm\n \n       - name: Create tarballs\n-        run: GH_PR_NUMBER=${{ github.event.pull_request && github.event.pull_request.number || '' }} node scripts/create-preview-tarballs.js \"${{ github.sha }}\" \"${{ runner.temp }}/preview-tarballs\"\n+        run: node scripts/create-preview-tarballs.js \"${{ github.sha }}\" \"${{ runner.temp }}/preview-tarballs\"\n \n       - name: Upload tarballs\n         uses: actions/upload-artifact@v4"
        },
        {
            "sha": "0fa359d85b3f88112cc47d496798204bc93c9520",
            "filename": "scripts/create-preview-tarballs.js",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/522793548a23298bd17cae272802959ba5fc7f98/scripts%2Fcreate-preview-tarballs.js",
            "raw_url": "https://github.com/vercel/next.js/raw/522793548a23298bd17cae272802959ba5fc7f98/scripts%2Fcreate-preview-tarballs.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcreate-preview-tarballs.js?ref=522793548a23298bd17cae272802959ba5fc7f98",
            "patch": "@@ -82,7 +82,7 @@ async function main() {\n         }\n       )\n       // tarball name is printed as the last line of npm-pack\n-      const tarballName = stdout.trim().split('\\n').pop() || ''\n+      const tarballName = stdout.trim().split('\\n').pop()\n       console.info(`Created tarball ${path.join(packDestination, tarballName)}`)\n \n       nextSwcPackageNames.add(manifest.name)\n@@ -97,21 +97,16 @@ async function main() {\n   ])\n   const packages = JSON.parse(lernaListJson.stdout)\n   const packagesByVersion = new Map()\n-  const PR_NUMBER = process.env.GH_PR_NUMBER\n-  const basePackageUrl = PR_NUMBER\n-    ? `https://vercel-packages.vercel.app/next/prs/${PR_NUMBER}/`\n-    : `https://vercel-packages.vercel.app/next/commits/${commitSha}/`\n-\n   for (const packageInfo of packages) {\n     packagesByVersion.set(\n       packageInfo.name,\n-      `${basePackageUrl}${packageInfo.name}`\n+      `https://vercel-packages.vercel.app/next/commits/${commitSha}/${packageInfo.name}`\n     )\n   }\n   for (const nextSwcPackageName of nextSwcPackageNames) {\n     packagesByVersion.set(\n       nextSwcPackageName,\n-      `${basePackageUrl}${nextSwcPackageName}`\n+      `https://vercel-packages.vercel.app/next/commits/${commitSha}/${nextSwcPackageName}`\n     )\n   }\n \n@@ -169,7 +164,7 @@ async function main() {\n       }\n     )\n     // tarball name is printed as the last line of npm-pack\n-    const tarballName = stdout.trim().split('\\n').pop() || ''\n+    const tarballName = stdout.trim().split('\\n').pop()\n     console.info(`Created tarball ${path.join(packDestination, tarballName)}`)\n   }\n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 5,
        "deletions": 10
    }
}