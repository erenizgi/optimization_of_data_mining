{
    "author": "huozhi",
    "message": "[turbopack] fix build of empty entries of pages (#84873)",
    "sha": "34dd8d42fc06371831e2ed3f578e08eff3710d90",
    "files": [
        {
            "sha": "d50740cb89790013658893383f3fb78080876f65",
            "filename": "packages/next/src/build/entries.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/34dd8d42fc06371831e2ed3f578e08eff3710d90/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/34dd8d42fc06371831e2ed3f578e08eff3710d90/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts?ref=34dd8d42fc06371831e2ed3f578e08eff3710d90",
            "patch": "@@ -552,6 +552,12 @@ export async function createPagesMapping({\n       // added or removed.\n       const root = isDev && pagesDir ? PAGES_DIR_ALIAS : 'next/dist/pages'\n \n+      // If there are no user pages routes, treat this as app-dir-only mode.\n+      // The pages/ folder could be present and the initial appDirOnly is treated as false, but no valid routes are found.\n+      if (Object.keys(pages).length === 0 && !appDirOnly) {\n+        appDirOnly = true\n+      }\n+\n       return {\n         // Don't add default pages entries if this is an app-router-only build\n         ...((isDev || !appDirOnly) && {"
        },
        {
            "sha": "c6663f2bc0c9747abdb8c38b9bf9fe1cf116f9f8",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/34dd8d42fc06371831e2ed3f578e08eff3710d90/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/34dd8d42fc06371831e2ed3f578e08eff3710d90/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=34dd8d42fc06371831e2ed3f578e08eff3710d90",
            "patch": "@@ -1276,6 +1276,11 @@ export default async function build(\n         )\n       NextBuildContext.mappedPages = mappedPages\n \n+      // Update appDirOnly if no user pages routes are found\n+      if (Object.keys(mappedPages).length === 0 && !appDirOnly) {\n+        NextBuildContext.appDirOnly = appDirOnly = true\n+      }\n+\n       let mappedAppPages: MappedPages | undefined\n       let mappedAppLayouts: MappedPages | undefined\n       let denormalizedAppPages: string[] | undefined"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "test/production/500-page/app-router-only/pages/.gitkeep",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/34dd8d42fc06371831e2ed3f578e08eff3710d90/test%2Fproduction%2F500-page%2Fapp-router-only%2Fpages%2F.gitkeep",
            "raw_url": "https://github.com/vercel/next.js/raw/34dd8d42fc06371831e2ed3f578e08eff3710d90/test%2Fproduction%2F500-page%2Fapp-router-only%2Fpages%2F.gitkeep",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2F500-page%2Fapp-router-only%2Fpages%2F.gitkeep?ref=34dd8d42fc06371831e2ed3f578e08eff3710d90"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}