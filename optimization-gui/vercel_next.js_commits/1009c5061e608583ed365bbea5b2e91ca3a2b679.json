{
    "author": "lukesandberg",
    "message": "[turbopack] Remove uses of `Value<..>` instead make the payloads impl Taskinput (#80141)\n\nRemove uses of `Value<..>` instead make the payloads impl Taskinput\n\n### Why?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "1009c5061e608583ed365bbea5b2e91ca3a2b679",
    "files": [
        {
            "sha": "6873a69121ec4cc4bb5fd2ae0dfcb2acae88776e",
            "filename": "crates/next-core/src/next_font/google/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -6,7 +6,7 @@ use indoc::formatdoc;\n use rustc_hash::FxHashMap;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{Completion, FxIndexMap, ResolvedVc, Value, Vc};\n+use turbo_tasks::{Completion, FxIndexMap, ResolvedVc, Vc};\n use turbo_tasks_bytes::stream::SingleValue;\n use turbo_tasks_env::{CommandLineProcessEnv, ProcessEnv};\n use turbo_tasks_fetch::{HttpResponseBody, fetch};\n@@ -624,7 +624,7 @@ async fn font_options_from_query_map(\n \n     let options =\n         options_from_request(&parse_json_with_source_context(&json)?, &*font_data.await?)?;\n-    Ok(NextFontGoogleOptions::new(Value::new(options)))\n+    Ok(NextFontGoogleOptions::new(options))\n }\n fn font_file_options_from_query_map(query: &RcStr) -> Result<NextFontGoogleFontFileOptions> {\n     let query_map = qstring::QString::from(query.as_str());"
        },
        {
            "sha": "4efd8ae974f3ba492904d06573da54e2c9981ab9",
            "filename": "crates/next-core/src/next_font/google/options.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Foptions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Foptions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Foptions.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -2,7 +2,7 @@ use anyhow::{Context, Result};\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexMap, FxIndexSet, NonLocalValue, Value, Vc, fxindexset, trace::TraceRawVcs,\n+    FxIndexMap, FxIndexSet, NonLocalValue, TaskInput, Vc, fxindexset, trace::TraceRawVcs,\n };\n \n use super::request::{NextFontRequest, OneOrManyStrings};\n@@ -11,8 +11,8 @@ const ALLOWED_DISPLAY_VALUES: &[&str] = &[\"auto\", \"block\", \"swap\", \"fallback\", \"\n \n pub(super) type FontData = FxIndexMap<RcStr, FontDataEntry>;\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Clone, Debug, PartialOrd, Ord, Hash)]\n+#[turbo_tasks::value]\n+#[derive(Clone, Debug, PartialOrd, Ord, Hash, TaskInput)]\n pub(super) struct NextFontGoogleOptions {\n     /// Name of the requested font from Google. Contains literal spaces.\n     pub font_family: RcStr,\n@@ -38,8 +38,8 @@ impl NextFontGoogleOptions {\n #[turbo_tasks::value_impl]\n impl NextFontGoogleOptions {\n     #[turbo_tasks::function]\n-    pub fn new(options: Value<NextFontGoogleOptions>) -> Vc<NextFontGoogleOptions> {\n-        Self::cell(options.into_value())\n+    pub fn new(options: NextFontGoogleOptions) -> Vc<NextFontGoogleOptions> {\n+        Self::cell(options)\n     }\n }\n \n@@ -55,6 +55,7 @@ impl NextFontGoogleOptions {\n     Deserialize,\n     TraceRawVcs,\n     NonLocalValue,\n+    TaskInput,\n )]\n pub(super) enum FontWeights {\n     Variable,"
        },
        {
            "sha": "2391cfdb27671094b94f583adb9df07f4ea8a822",
            "filename": "crates/next-core/src/next_font/local/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -3,7 +3,7 @@ use font_fallback::FontFallbackResult;\n use indoc::formatdoc;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{\n     FileContent, FileSystemPath, glob::Glob, json::parse_json_with_source_context,\n };\n@@ -226,7 +226,7 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n                     path,\n                     preload,\n                     has_size_adjust: size_adjust,\n-                } = font_file_options_from_query_map(query).await?;\n+                } = font_file_options_from_query_map(query)?;\n \n                 let (filename, ext) = split_extension(&path);\n                 let ext = ext.with_context(|| format!(\"font {} needs an extension\", &path))?;\n@@ -303,11 +303,10 @@ fn font_options_from_query_map(query: RcStr) -> Result<Vc<NextFontLocalOptions>>\n         bail!(\"Expected one entry\");\n     };\n \n-    options_from_request(&parse_json_with_source_context(&json)?)\n-        .map(|o| NextFontLocalOptions::new(Value::new(o)))\n+    options_from_request(&parse_json_with_source_context(&json)?).map(NextFontLocalOptions::new)\n }\n \n-async fn font_file_options_from_query_map(query: &RcStr) -> Result<NextFontLocalFontFileOptions> {\n+fn font_file_options_from_query_map(query: &RcStr) -> Result<NextFontLocalFontFileOptions> {\n     let query_map = qstring::QString::from(query.as_str());\n \n     if query_map.len() != 1 {"
        },
        {
            "sha": "92435d977a8f059d968e84f12b7ab4844116d1f8",
            "filename": "crates/next-core/src/next_font/local/options.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Foptions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Foptions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Foptions.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -3,7 +3,7 @@ use std::{fmt::Display, str::FromStr};\n use anyhow::{Context, Result};\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{NonLocalValue, Value, Vc, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, TaskInput, Vc, trace::TraceRawVcs};\n \n use super::request::{\n     AdjustFontFallback, NextFontLocalRequest, NextFontLocalRequestArguments, SrcDescriptor,\n@@ -12,8 +12,8 @@ use super::request::{\n \n /// A normalized, Vc-friendly struct derived from validating and transforming\n /// [[NextFontLocalRequest]]\n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Clone, Debug, PartialOrd, Ord, Hash)]\n+#[turbo_tasks::value]\n+#[derive(Clone, Debug, PartialOrd, Ord, Hash, TaskInput)]\n pub(super) struct NextFontLocalOptions {\n     pub fonts: FontDescriptors,\n     pub default_weight: Option<FontWeight>,\n@@ -43,8 +43,8 @@ impl NextFontLocalOptions {\n #[turbo_tasks::value_impl]\n impl NextFontLocalOptions {\n     #[turbo_tasks::function]\n-    pub fn new(options: Value<NextFontLocalOptions>) -> Vc<NextFontLocalOptions> {\n-        Self::cell(options.into_value())\n+    pub fn new(options: NextFontLocalOptions) -> Vc<NextFontLocalOptions> {\n+        Self::cell(options)\n     }\n }\n \n@@ -62,6 +62,7 @@ impl NextFontLocalOptions {\n     Serialize,\n     TraceRawVcs,\n     NonLocalValue,\n+    TaskInput,\n )]\n pub(super) struct FontDescriptor {\n     pub weight: Option<FontWeight>,\n@@ -103,6 +104,7 @@ impl FontDescriptor {\n     Serialize,\n     TraceRawVcs,\n     NonLocalValue,\n+    TaskInput,\n )]\n pub(super) enum FontDescriptors {\n     /// `One` is a special case when the user did not provide a `src` field and\n@@ -125,6 +127,7 @@ pub(super) enum FontDescriptors {\n     Hash,\n     TraceRawVcs,\n     NonLocalValue,\n+    TaskInput,\n )]\n pub(super) enum FontWeight {\n     Variable(RcStr, RcStr),"
        },
        {
            "sha": "7944e4e38c410b5a4037ae956c10239b5e0ce04a",
            "filename": "crates/next-core/src/next_font/local/request.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Frequest.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Frequest.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Frequest.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -1,6 +1,6 @@\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{NonLocalValue, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, TaskInput, trace::TraceRawVcs};\n \n /// The top-most structure encoded into the query param in requests to\n /// `next/font/local` generated by the next/font swc transform. e.g.\n@@ -58,6 +58,7 @@ pub(super) struct SrcDescriptor {\n     Serialize,\n     TraceRawVcs,\n     NonLocalValue,\n+    TaskInput,\n )]\n pub(super) enum AdjustFontFallback {\n     Arial,"
        },
        {
            "sha": "fdedc6d1436af0145430e36cc3159799adf7fe1f",
            "filename": "crates/next-core/src/next_image/module.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_tasks::{ResolvedVc, TaskInput, Value, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, TaskInput, Vc, fxindexmap};\n use turbopack::{ModuleAssetContext, module_options::CustomModuleType};\n use turbopack_core::{\n     context::AssetContext, module::Module, reference_type::ReferenceType, resolve::ModulePart,\n@@ -58,9 +58,9 @@ impl StructuredImageModuleType {\n     }\n \n     #[turbo_tasks::function]\n-    pub fn new(blur_placeholder_mode: Value<BlurPlaceholderMode>) -> Vc<Self> {\n+    pub fn new(blur_placeholder_mode: BlurPlaceholderMode) -> Vc<Self> {\n         StructuredImageModuleType::cell(StructuredImageModuleType {\n-            blur_placeholder_mode: blur_placeholder_mode.into_value(),\n+            blur_placeholder_mode,\n         })\n     }\n }"
        },
        {
            "sha": "8eef5ef840c699b41bc83ebc52ccda8f1db52aea",
            "filename": "crates/next-core/src/next_shared/transforms/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fmod.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -33,7 +33,7 @@ pub use next_lint::get_next_lint_transform_rule;\n pub use next_strip_page_exports::get_next_pages_transforms_rule;\n pub use next_track_dynamic_imports::get_next_track_dynamic_imports_transform_rule;\n pub use server_actions::get_server_actions_transform_rule;\n-use turbo_tasks::{ReadRef, ResolvedVc, Value};\n+use turbo_tasks::{ReadRef, ResolvedVc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::module_options::{ModuleRule, ModuleRuleEffect, ModuleType, RuleCondition};\n use turbopack_core::reference_type::{ReferenceType, UrlReferenceSubType};\n@@ -67,7 +67,7 @@ pub async fn get_next_image_rule() -> Result<ModuleRule> {\n         ]),\n         vec![ModuleRuleEffect::ModuleType(ModuleType::Custom(\n             ResolvedVc::upcast(\n-                StructuredImageModuleType::new(Value::new(BlurPlaceholderMode::DataUrl))\n+                StructuredImageModuleType::new(BlurPlaceholderMode::DataUrl)\n                     .to_resolved()\n                     .await?,\n             ),"
        },
        {
            "sha": "ceef4646e4e6621e26f9beaa2c0bf23251d319e0",
            "filename": "turbopack/crates/turbopack-css/src/references/compose.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     chunk::ChunkableModuleReference,\n     reference::ModuleReference,\n@@ -37,7 +37,7 @@ impl ModuleReference for CssModuleComposeReference {\n         css_resolve(\n             *self.origin,\n             *self.request,\n-            Value::new(CssReferenceSubType::Compose),\n+            CssReferenceSubType::Compose,\n             // TODO: add real issue source, currently impossible because `CssClassName` doesn't\n             // contain the source span\n             // https://docs.rs/swc_css_modules/0.21.16/swc_css_modules/enum.CssClassName.html"
        },
        {
            "sha": "4b642ab02fca63504d59af3b6542ab4e2572e5f0",
            "filename": "turbopack/crates/turbopack-css/src/references/import.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -5,7 +5,7 @@ use lightningcss::{\n     traits::ToCss,\n };\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     chunk::{ChunkableModuleReference, ChunkingContext},\n     issue::IssueSource,\n@@ -138,7 +138,7 @@ impl ModuleReference for ImportAssetReference {\n         Ok(css_resolve(\n             *self.origin,\n             *self.request,\n-            Value::new(CssReferenceSubType::AtImport(import_context)),\n+            CssReferenceSubType::AtImport(import_context),\n             Some(self.issue_source.clone()),\n         ))\n     }"
        },
        {
            "sha": "77f161fdf9348e954f428bb4ad0ad89efed07b78",
            "filename": "turbopack/crates/turbopack-css/src/references/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -8,7 +8,7 @@ use lightningcss::{\n     visitor::{Visit, Visitor},\n };\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     issue::IssueSource,\n     reference::ModuleReference,\n@@ -177,14 +177,8 @@ impl Visitor<'_> for ModuleReferencesVisitor<'_> {\n pub fn css_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n-    ty: Value<CssReferenceSubType>,\n+    ty: CssReferenceSubType,\n     issue_source: Option<IssueSource>,\n ) -> Vc<ModuleResolveResult> {\n-    url_resolve(\n-        origin,\n-        request,\n-        ReferenceType::Css(ty.into_value()),\n-        issue_source,\n-        false,\n-    )\n+    url_resolve(origin, request, ReferenceType::Css(ty), issue_source, false)\n }"
        },
        {
            "sha": "3c55d12c0cd5251e386ed0be7dabf1bfbd4fcad1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1009c5061e608583ed365bbea5b2e91ca3a2b679/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=1009c5061e608583ed365bbea5b2e91ca3a2b679",
            "patch": "@@ -13,7 +13,7 @@ use serde::{Deserialize, Serialize};\n use tracing_subscriber::{Registry, layer::SubscriberExt, util::SubscriberInitExt};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    Completion, NonLocalValue, OperationVc, ResolvedVc, TurboTasks, Value, Vc, apply_effects,\n+    Completion, NonLocalValue, OperationVc, ResolvedVc, TaskInput, TurboTasks, Vc, apply_effects,\n     debug::ValueDebugFormat, fxindexmap, trace::TraceRawVcs,\n };\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n@@ -74,7 +74,7 @@ struct JsResult {\n }\n \n #[turbo_tasks::value]\n-#[derive(Copy, Clone, Debug, Hash)]\n+#[derive(Copy, Clone, Debug, Hash, TaskInput)]\n enum IssueSnapshotMode {\n     Snapshots,\n     NoSnapshots,\n@@ -200,8 +200,7 @@ async fn run(resource: PathBuf, snapshot_mode: IssueSnapshotMode) -> Result<JsRe\n     ));\n     let result = tt\n         .run_once(async move {\n-            let emit_op =\n-                run_inner_operation(resource.to_str().unwrap().into(), Value::new(snapshot_mode));\n+            let emit_op = run_inner_operation(resource.to_str().unwrap().into(), snapshot_mode);\n             let result = emit_op.read_strongly_consistent().owned().await?;\n             apply_effects(emit_op).await?;\n \n@@ -217,11 +216,11 @@ async fn run(resource: PathBuf, snapshot_mode: IssueSnapshotMode) -> Result<JsRe\n #[turbo_tasks::function(operation)]\n async fn run_inner_operation(\n     resource: RcStr,\n-    snapshot_mode: Value<IssueSnapshotMode>,\n+    snapshot_mode: IssueSnapshotMode,\n ) -> Result<Vc<JsResult>> {\n     let prepared_test = prepare_test(resource).to_resolved().await?;\n     let run_result_op = run_test_operation(prepared_test);\n-    if *snapshot_mode == IssueSnapshotMode::Snapshots {\n+    if snapshot_mode == IssueSnapshotMode::Snapshots {\n         snapshot_issues(*prepared_test, run_result_op).await?;\n     }\n "
        }
    ],
    "stats": {
        "total": 81,
        "additions": 39,
        "deletions": 42
    }
}