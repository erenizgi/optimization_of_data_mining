{
    "author": "timneutkens",
    "message": "Update generateMetadata in client component error (#88172)\n\n## What?\n\nImproves the error shown when `generateMetadata` or `metadata` is\nexported from a Client Component.\n\nAlso updated the documentation to further explain why it can only be\nused in a server component and the steps to follow to resolve the error.",
    "sha": "ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
    "files": [
        {
            "sha": "fb66abd2ec553aabc658fba3d2c29ba417318bb3",
            "filename": "crates/next-custom-transforms/src/transforms/react_server_components.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs?ref=ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
            "patch": "@@ -334,7 +334,7 @@ fn report_error(app_dir: &Option<PathBuf>, filepath: &str, error_kind: RSCErrorK\n             )\n         },\n         RSCErrorKind::NextRscErrClientMetadataExport((source, span)) => {\n-            (format!(\"You are attempting to export \\\"{source}\\\" from a component marked with \\\"use client\\\", which is disallowed. Either remove the export, or the \\\"use client\\\" directive. Read more: https://nextjs.org/docs/app/api-reference/directives/use-client\\n\\n\"), vec![span])\n+            (format!(\"You are attempting to export \\\"{source}\\\" from a component marked with \\\"use client\\\", which is disallowed. \\\"{source}\\\" must be resolved on the server before the page component is rendered. Keep your page as a Server Component and move Client Component logic to a separate file. Read more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#why-generatemetadata-is-server-component-only\\n\\n\"), vec![span])\n         },\n         RSCErrorKind::NextRscErrConflictMetadataExport((span1, span2)) => (\n             \"\\\"metadata\\\" and \\\"generateMetadata\\\" cannot be exported at the same time, please keep one of them. Read more: https://nextjs.org/docs/app/api-reference/file-conventions/metadata\\n\\n\".to_string(),"
        },
        {
            "sha": "cebb4fe174eedc9f83ed7ef1e0b8a1f33293ab4a",
            "filename": "crates/next-custom-transforms/tests/errors/react-server-components/client-graph/generate-metadata/output.stderr",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fgenerate-metadata%2Foutput.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fgenerate-metadata%2Foutput.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fgenerate-metadata%2Foutput.stderr?ref=ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
            "patch": "@@ -1,5 +1,6 @@\n-  x You are attempting to export \"generateMetadata\" from a component marked with \"use client\", which is disallowed. Either remove the export, or the \"use client\" directive. Read more: https://\n-  | nextjs.org/docs/app/api-reference/directives/use-client\n+  x You are attempting to export \"generateMetadata\" from a component marked with \"use client\", which is disallowed. \"generateMetadata\" must be resolved on the server before the page component is\n+  | rendered. Keep your page as a Server Component and move Client Component logic to a separate file. Read more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#why-\n+  | generatemetadata-is-server-component-only\n   | \n   | \n    ,-[input.js:1:1]"
        },
        {
            "sha": "cfcc7c3e90e6bfe78a43323bf8fd5b58d135bfc6",
            "filename": "crates/next-custom-transforms/tests/errors/react-server-components/client-graph/metadata/output.stderr",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmetadata%2Foutput.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmetadata%2Foutput.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmetadata%2Foutput.stderr?ref=ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
            "patch": "@@ -1,5 +1,6 @@\n-  x You are attempting to export \"metadata\" from a component marked with \"use client\", which is disallowed. Either remove the export, or the \"use client\" directive. Read more: https://nextjs.org/\n-  | docs/app/api-reference/directives/use-client\n+  x You are attempting to export \"metadata\" from a component marked with \"use client\", which is disallowed. \"metadata\" must be resolved on the server before the page component is rendered. Keep your\n+  | page as a Server Component and move Client Component logic to a separate file. Read more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#why-generatemetadata-is-server-\n+  | component-only\n   | \n   | \n    ,-[input.js:1:1]"
        },
        {
            "sha": "937d0a36520e9680dd772829fba354d100111714",
            "filename": "crates/next-custom-transforms/tests/errors/react-server-components/client-graph/multiple/output.stderr",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmultiple%2Foutput.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmultiple%2Foutput.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ferrors%2Freact-server-components%2Fclient-graph%2Fmultiple%2Foutput.stderr?ref=ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
            "patch": "@@ -1,13 +1,15 @@\n-  x You are attempting to export \"metadata\" from a component marked with \"use client\", which is disallowed. Either remove the export, or the \"use client\" directive. Read more: https://nextjs.org/\n-  | docs/app/api-reference/directives/use-client\n+  x You are attempting to export \"metadata\" from a component marked with \"use client\", which is disallowed. \"metadata\" must be resolved on the server before the page component is rendered. Keep your\n+  | page as a Server Component and move Client Component logic to a separate file. Read more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#why-generatemetadata-is-server-\n+  | component-only\n   | \n   | \n    ,-[input.js:1:1]\n  1 | export const metadata = {}\n    :              ^^^^^^^^\n    `----\n-  x You are attempting to export \"generateMetadata\" from a component marked with \"use client\", which is disallowed. Either remove the export, or the \"use client\" directive. Read more: https://\n-  | nextjs.org/docs/app/api-reference/directives/use-client\n+  x You are attempting to export \"generateMetadata\" from a component marked with \"use client\", which is disallowed. \"generateMetadata\" must be resolved on the server before the page component is\n+  | rendered. Keep your page as a Server Component and move Client Component logic to a separate file. Read more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#why-\n+  | generatemetadata-is-server-component-only\n   | \n   | \n    ,-[input.js:3:1]"
        },
        {
            "sha": "410c4d377295a3f4e3f681085ee93843cb809ba1",
            "filename": "docs/01-app/03-api-reference/04-functions/generate-metadata.mdx",
            "status": "modified",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/ae17e48bbfb1982b787520c1d260d7a1f7acb0fa/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx?ref=ae17e48bbfb1982b787520c1d260d7a1f7acb0fa",
            "patch": "@@ -113,6 +113,53 @@ For type completion of `params` and `searchParams`, you can type the first argum\n > - React [`cache` can be used](/docs/app/guides/caching#react-cache-function) if `fetch` is unavailable.\n > - [File-based metadata](/docs/app/api-reference/file-conventions/metadata) has the higher priority and will override the `metadata` object and `generateMetadata` function.\n \n+## Why `generateMetadata` is Server Component only\n+\n+`generateMetadata` and the `metadata` export are only supported in Server Components because metadata must be resolved on the server before the page component is rendered. This allows Next.js to include the metadata in the initial HTML response.\n+\n+If you need to use Client Component features, keep your `page.tsx` as a Server Component and move the Client Component logic to a separate file:\n+\n+```tsx filename=\"app/page.tsx\" switcher\n+import type { Metadata } from 'next'\n+import { InteractiveComponent } from './interactive-component'\n+\n+export const metadata: Metadata = {\n+  title: 'My Page',\n+}\n+\n+export default function Page() {\n+  return <InteractiveComponent />\n+}\n+```\n+\n+```jsx filename=\"app/page.js\" switcher\n+import { InteractiveComponent } from './interactive-component'\n+\n+export const metadata = {\n+  title: 'My Page',\n+}\n+\n+export default function Page() {\n+  return <InteractiveComponent />\n+}\n+```\n+\n+```tsx filename=\"app/interactive-component.tsx\" switcher\n+'use client'\n+\n+export function InteractiveComponent() {\n+  // Client-side interactivity (hooks, event handlers, etc.)\n+}\n+```\n+\n+```jsx filename=\"app/interactive-component.js\" switcher\n+'use client'\n+\n+export function InteractiveComponent() {\n+  // Client-side interactivity (hooks, event handlers, etc.)\n+}\n+```\n+\n ## Reference\n \n ### Parameters"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 60,
        "deletions": 9
    }
}