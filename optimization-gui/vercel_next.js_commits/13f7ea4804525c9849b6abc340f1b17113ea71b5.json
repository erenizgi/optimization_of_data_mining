{
    "author": "unstubbable",
    "message": "Optimize server runtime bundles (#77723)",
    "sha": "13f7ea4804525c9849b6abc340f1b17113ea71b5",
    "files": [
        {
            "sha": "c868ada85b295e04963652d87b74677270cf8f0b",
            "filename": "packages/next/next-runtime.webpack-config.js",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-runtime.webpack-config.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -40,7 +40,9 @@ const appExternals = [\n   'next/dist/compiled/react-dom-experimental/cjs/react-dom-server-legacy.browser.production.js',\n ]\n \n-function makeAppAliases(reactChannel = '') {\n+function makeAppAliases({ experimental, bundler }) {\n+  const reactChannel = experimental ? '-experimental' : ''\n+\n   return {\n     react$: `next/dist/compiled/react${reactChannel}`,\n     'react/react.react-server$': `next/dist/compiled/react${reactChannel}/react.react-server`,\n@@ -61,19 +63,16 @@ function makeAppAliases(reactChannel = '') {\n     'react-server-dom-turbopack/server.edge$': `next/dist/compiled/react-server-dom-turbopack${reactChannel}/server.edge`,\n     'react-server-dom-turbopack/server.node$': `next/dist/compiled/react-server-dom-turbopack${reactChannel}/server.node`,\n     'react-server-dom-turbopack/static.edge$': `next/dist/compiled/react-server-dom-turbopack${reactChannel}/static.edge`,\n-    'react-server-dom-webpack/client$': `next/dist/compiled/react-server-dom-webpack${reactChannel}/client`,\n-    'react-server-dom-webpack/client.edge$': `next/dist/compiled/react-server-dom-webpack${reactChannel}/client.edge`,\n-    'react-server-dom-webpack/server.edge$': `next/dist/compiled/react-server-dom-webpack${reactChannel}/server.edge`,\n-    'react-server-dom-webpack/server.node$': `next/dist/compiled/react-server-dom-webpack${reactChannel}/server.node`,\n-    'react-server-dom-webpack/static.edge$': `next/dist/compiled/react-server-dom-webpack${reactChannel}/static.edge`,\n+    'react-server-dom-webpack/client$': `next/dist/compiled/react-server-dom-${bundler}${reactChannel}/client`,\n+    'react-server-dom-webpack/client.edge$': `next/dist/compiled/react-server-dom-${bundler}${reactChannel}/client.edge`,\n+    'react-server-dom-webpack/server.edge$': `next/dist/compiled/react-server-dom-${bundler}${reactChannel}/server.edge`,\n+    'react-server-dom-webpack/server.node$': `next/dist/compiled/react-server-dom-${bundler}${reactChannel}/server.node`,\n+    'react-server-dom-webpack/static.edge$': `next/dist/compiled/react-server-dom-${bundler}${reactChannel}/static.edge`,\n     '@vercel/turbopack-ecmascript-runtime/browser/dev/hmr-client/hmr-client.ts':\n       'next/dist/client/dev/noop-turbopack-hmr',\n   }\n }\n \n-const appAliases = makeAppAliases()\n-const appExperimentalAliases = makeAppAliases('-experimental')\n-\n const sharedExternals = [\n   'styled-jsx',\n   'styled-jsx/style',\n@@ -230,7 +229,7 @@ module.exports = ({ dev, turbo, bundleType, experimental, ...rest }) => {\n           experimental ? true : false\n         ),\n         'process.env.NEXT_RUNTIME': JSON.stringify('nodejs'),\n-        ...(!dev ? { 'process.env.TURBOPACK': JSON.stringify(turbo) } : {}),\n+        'process.env.TURBOPACK': JSON.stringify(turbo),\n       }),\n       !!process.env.ANALYZE &&\n         new BundleAnalyzerPlugin({\n@@ -262,9 +261,10 @@ module.exports = ({ dev, turbo, bundleType, experimental, ...rest }) => {\n     resolve: {\n       alias:\n         bundleType === 'app'\n-          ? experimental\n-            ? appExperimentalAliases\n-            : appAliases\n+          ? makeAppAliases({\n+              experimental,\n+              bundler: turbo ? 'turbopack' : 'webpack',\n+            })\n           : {},\n     },\n     module: {"
        },
        {
            "sha": "07aa8c75a0a2bf18bd00a573a55d7752faf4236c",
            "filename": "packages/next/src/build/webpack/plugins/flight-manifest-plugin.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fflight-manifest-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fflight-manifest-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fflight-manifest-plugin.ts?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -99,7 +99,7 @@ interface UninlinedCssFile {\n export interface ClientReferenceManifest extends ClientReferenceManifestForRsc {\n   readonly moduleLoading: {\n     prefix: string\n-    crossOrigin: string | null\n+    crossOrigin?: 'use-credentials' | ''\n   }\n   ssrModuleMapping: {\n     [moduleId: string]: ManifestNode\n@@ -246,8 +246,8 @@ export class ClientReferenceManifestPlugin {\n       typeof configuredCrossOriginLoading === 'string'\n         ? configuredCrossOriginLoading === 'use-credentials'\n           ? configuredCrossOriginLoading\n-          : 'anonymous'\n-        : null\n+          : '' // === 'anonymous'\n+        : undefined\n \n     if (typeof compilation.outputOptions.publicPath !== 'string') {\n       throw new Error("
        },
        {
            "sha": "43bd2175ac2f45734975903b48598e0a6e142e02",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 10,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -4149,16 +4149,9 @@ export async function warmFlightResponse(\n   flightStream: ReadableStream<Uint8Array>,\n   clientReferenceManifest: DeepReadonly<ClientReferenceManifest>\n ) {\n-  let createFromReadableStream\n-  if (process.env.TURBOPACK) {\n-    createFromReadableStream =\n-      // eslint-disable-next-line import/no-extraneous-dependencies\n-      require('react-server-dom-turbopack/client.edge').createFromReadableStream\n-  } else {\n-    createFromReadableStream =\n-      // eslint-disable-next-line import/no-extraneous-dependencies\n-      require('react-server-dom-webpack/client.edge').createFromReadableStream\n-  }\n+  const { createFromReadableStream } =\n+    // eslint-disable-next-line import/no-extraneous-dependencies\n+    require('react-server-dom-webpack/client.edge') as typeof import('react-server-dom-webpack/client.edge')\n \n   try {\n     createFromReadableStream(flightStream, {"
        },
        {
            "sha": "4f4465c9435b5b9cb47cac5ddab0cd677dc6d721",
            "filename": "packages/next/src/server/app-render/use-flight-response.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -30,19 +30,11 @@ export function useFlightStream<T>(\n   }\n \n   // react-server-dom-webpack/client.edge must not be hoisted for require cache clearing to work correctly\n-  let createFromReadableStream\n-  // @TODO: investigate why the aliasing for turbopack doesn't pick this up, requiring this runtime check\n-  if (process.env.TURBOPACK) {\n-    createFromReadableStream =\n-      // eslint-disable-next-line import/no-extraneous-dependencies\n-      require('react-server-dom-turbopack/client.edge').createFromReadableStream\n-  } else {\n-    createFromReadableStream =\n-      // eslint-disable-next-line import/no-extraneous-dependencies\n-      require('react-server-dom-webpack/client.edge').createFromReadableStream\n-  }\n+  const { createFromReadableStream } =\n+    // eslint-disable-next-line import/no-extraneous-dependencies\n+    require('react-server-dom-webpack/client.edge') as typeof import('react-server-dom-webpack/client.edge')\n \n-  const newResponse = createFromReadableStream(flightStream, {\n+  const newResponse = createFromReadableStream<T>(flightStream, {\n     serverConsumerManifest: {\n       moduleLoading: clientReferenceManifest.moduleLoading,\n       moduleMap: isEdgeRuntime"
        },
        {
            "sha": "3e925ed54eab1e55093103ac5a3e460a55f8bf12",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -37,7 +37,7 @@ import {\n } from '../../client/components/react-dev-overlay/server/middleware-turbopack'\n import { PageNotFoundError } from '../../shared/lib/utils'\n import { debounce } from '../utils'\n-import { deleteAppClientCache, deleteCache } from './require-cache'\n+import { deleteCache, deleteFromRequireCache } from './require-cache'\n import {\n   clearAllModuleContexts,\n   clearModuleContext,\n@@ -339,7 +339,16 @@ export async function createHotReloaderTurbopack(\n     )\n \n     if (hasAppPaths) {\n-      deleteAppClientCache()\n+      deleteFromRequireCache(\n+        require.resolve(\n+          'next/dist/compiled/next-server/app-page-turbo.runtime.dev.js'\n+        )\n+      )\n+      deleteFromRequireCache(\n+        require.resolve(\n+          'next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js'\n+        )\n+      )\n     }\n \n     const serverPaths = writtenEndpoint.serverPaths.map(({ path: p }) =>"
        },
        {
            "sha": "37454f62b69b8604f7188b12ac44cbae35b0aaa1",
            "filename": "packages/next/src/server/dev/require-cache.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Frequire-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Frequire-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Frequire-cache.ts?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -2,7 +2,7 @@ import isError from '../../lib/is-error'\n import { realpathSync } from '../../lib/realpath'\n import { clearManifestCache } from '../load-manifest'\n \n-function deleteFromRequireCache(filePath: string) {\n+export function deleteFromRequireCache(filePath: string) {\n   try {\n     filePath = realpathSync(filePath)\n   } catch (e) {\n@@ -27,17 +27,6 @@ function deleteFromRequireCache(filePath: string) {\n   return false\n }\n \n-export function deleteAppClientCache() {\n-  deleteFromRequireCache(\n-    require.resolve('next/dist/compiled/next-server/app-page.runtime.dev.js')\n-  )\n-  deleteFromRequireCache(\n-    require.resolve(\n-      'next/dist/compiled/next-server/app-page-experimental.runtime.dev.js'\n-    )\n-  )\n-}\n-\n export function deleteCache(filePath: string) {\n   // try to clear it from the fs cache\n   clearManifestCache(filePath)"
        },
        {
            "sha": "c8f2b64a6393b40f6a1f9896d96f402e70f42c79",
            "filename": "packages/next/src/server/route-modules/app-page/module.compiled.js",
            "status": "modified",
            "additions": 20,
            "deletions": 8,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.compiled.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.compiled.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.compiled.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -3,19 +3,31 @@ if (process.env.NEXT_RUNTIME === 'edge') {\n } else {\n   if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n     if (process.env.NODE_ENV === 'development') {\n-      module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n-    } else if (process.env.TURBOPACK) {\n-      module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n+      }\n     } else {\n-      module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n+      }\n     }\n   } else {\n     if (process.env.NODE_ENV === 'development') {\n-      module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n-    } else if (process.env.TURBOPACK) {\n-      module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n+      }\n     } else {\n-      module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n+      }\n     }\n   }\n }"
        },
        {
            "sha": "e6304118c2dc312c21fb970213501612d54bd42d",
            "filename": "packages/next/src/server/route-modules/app-route/module.compiled.js",
            "status": "modified",
            "additions": 20,
            "deletions": 8,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.compiled.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.compiled.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.compiled.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -3,19 +3,31 @@ if (process.env.NEXT_RUNTIME === 'edge') {\n } else {\n   if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n     if (process.env.NODE_ENV === 'development') {\n-      module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.dev.js')\n-    } else if (process.env.TURBOPACK) {\n-      module.exports = require('next/dist/compiled/next-server/app-route-turbo-experimental.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-route-turbo-experimental.runtime.dev.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.dev.js')\n+      }\n     } else {\n-      module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-route-turbo-experimental.runtime.prod.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-route-experimental.runtime.prod.js')\n+      }\n     }\n   } else {\n     if (process.env.NODE_ENV === 'development') {\n-      module.exports = require('next/dist/compiled/next-server/app-route.runtime.dev.js')\n-    } else if (process.env.TURBOPACK) {\n-      module.exports = require('next/dist/compiled/next-server/app-route-turbo.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-route-turbo.runtime.dev.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-route.runtime.dev.js')\n+      }\n     } else {\n-      module.exports = require('next/dist/compiled/next-server/app-route.runtime.prod.js')\n+      if (process.env.TURBOPACK) {\n+        module.exports = require('next/dist/compiled/next-server/app-route-turbo.runtime.prod.js')\n+      } else {\n+        module.exports = require('next/dist/compiled/next-server/app-route.runtime.prod.js')\n+      }\n     }\n   }\n }"
        },
        {
            "sha": "440e4c646a74633ad7356199d7f7965d266c04a6",
            "filename": "packages/next/src/server/route-modules/pages-api/module.compiled.js",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages-api%2Fmodule.compiled.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages-api%2Fmodule.compiled.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages-api%2Fmodule.compiled.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -2,10 +2,16 @@ if (process.env.NEXT_RUNTIME === 'edge') {\n   module.exports = require('next/dist/server/route-modules/pages-api/module.js')\n } else {\n   if (process.env.NODE_ENV === 'development') {\n-    module.exports = require('next/dist/compiled/next-server/pages-api.runtime.dev.js')\n-  } else if (process.env.TURBOPACK) {\n-    module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js')\n+    if (process.env.TURBOPACK) {\n+      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.dev.js')\n+    } else {\n+      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.dev.js')\n+    }\n   } else {\n-    module.exports = require('next/dist/compiled/next-server/pages-api.runtime.prod.js')\n+    if (process.env.TURBOPACK) {\n+      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js')\n+    } else {\n+      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.prod.js')\n+    }\n   }\n }"
        },
        {
            "sha": "ae8c5109015bd5bd24e6ee62a8107d4f4277705a",
            "filename": "packages/next/src/server/route-modules/pages/module.compiled.js",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fmodule.compiled.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fmodule.compiled.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fmodule.compiled.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -2,10 +2,16 @@ if (process.env.NEXT_RUNTIME === 'edge') {\n   module.exports = require('next/dist/server/route-modules/pages/module.js')\n } else {\n   if (process.env.NODE_ENV === 'development') {\n-    module.exports = require('next/dist/compiled/next-server/pages.runtime.dev.js')\n-  } else if (process.env.TURBOPACK) {\n-    module.exports = require('next/dist/compiled/next-server/pages-turbo.runtime.prod.js')\n+    if (process.env.TURBOPACK) {\n+      module.exports = require('next/dist/compiled/next-server/pages-turbo.runtime.dev.js')\n+    } else {\n+      module.exports = require('next/dist/compiled/next-server/pages.runtime.dev.js')\n+    }\n   } else {\n-    module.exports = require('next/dist/compiled/next-server/pages.runtime.prod.js')\n+    if (process.env.TURBOPACK) {\n+      module.exports = require('next/dist/compiled/next-server/pages-turbo.runtime.prod.js')\n+    } else {\n+      module.exports = require('next/dist/compiled/next-server/pages.runtime.prod.js')\n+    }\n   }\n }"
        },
        {
            "sha": "72433e03847da8d31a090e3cc022c1951e017864",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 49,
            "deletions": 9,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/13f7ea4804525c9849b6abc340f1b17113ea71b5/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=13f7ea4804525c9849b6abc340f1b17113ea71b5",
            "patch": "@@ -2813,14 +2813,14 @@ export async function release(task) {\n   await task.clear('dist').start('build')\n }\n \n-export async function next_bundle_app_turbo(task, opts) {\n+export async function next_bundle_app_prod_turbo(task, opts) {\n   await task.source('dist').webpack({\n     watch: opts.dev,\n     config: require('./next-runtime.webpack-config')({\n       turbo: true,\n       bundleType: 'app',\n     }),\n-    name: 'next-bundle-app-turbo',\n+    name: 'next-bundle-app-prod-turbo',\n   })\n }\n \n@@ -2835,6 +2835,18 @@ export async function next_bundle_app_prod(task, opts) {\n   })\n }\n \n+export async function next_bundle_app_dev_turbo(task, opts) {\n+  await task.source('dist').webpack({\n+    watch: opts.dev,\n+    config: require('./next-runtime.webpack-config')({\n+      turbo: true,\n+      dev: true,\n+      bundleType: 'app',\n+    }),\n+    name: 'next-bundle-app-dev-turbo',\n+  })\n+}\n+\n export async function next_bundle_app_dev(task, opts) {\n   await task.source('dist').webpack({\n     watch: opts.dev,\n@@ -2846,15 +2858,15 @@ export async function next_bundle_app_dev(task, opts) {\n   })\n }\n \n-export async function next_bundle_app_turbo_experimental(task, opts) {\n+export async function next_bundle_app_prod_turbo_experimental(task, opts) {\n   await task.source('dist').webpack({\n     watch: opts.dev,\n     config: require('./next-runtime.webpack-config')({\n       turbo: true,\n       bundleType: 'app',\n       experimental: true,\n     }),\n-    name: 'next-bundle-app-turbo-experimental',\n+    name: 'next-bundle-app-prod-turbo-experimental',\n   })\n }\n \n@@ -2870,6 +2882,19 @@ export async function next_bundle_app_prod_experimental(task, opts) {\n   })\n }\n \n+export async function next_bundle_app_dev_turbo_experimental(task, opts) {\n+  await task.source('dist').webpack({\n+    watch: opts.dev,\n+    config: require('./next-runtime.webpack-config')({\n+      turbo: true,\n+      dev: true,\n+      bundleType: 'app',\n+      experimental: true,\n+    }),\n+    name: 'next-bundle-app-dev-turbo-experimental',\n+  })\n+}\n+\n export async function next_bundle_app_dev_experimental(task, opts) {\n   await task.source('dist').webpack({\n     watch: opts.dev,\n@@ -2904,14 +2929,26 @@ export async function next_bundle_pages_dev(task, opts) {\n   })\n }\n \n-export async function next_bundle_pages_turbo(task, opts) {\n+export async function next_bundle_pages_prod_turbo(task, opts) {\n   await task.source('dist').webpack({\n     watch: opts.dev,\n     config: require('./next-runtime.webpack-config')({\n       turbo: true,\n       bundleType: 'pages',\n     }),\n-    name: 'next-bundle-pages-turbo',\n+    name: 'next-bundle-pages-prod-turbo',\n+  })\n+}\n+\n+export async function next_bundle_pages_dev_turbo(task, opts) {\n+  await task.source('dist').webpack({\n+    watch: opts.dev,\n+    config: require('./next-runtime.webpack-config')({\n+      turbo: true,\n+      dev: true,\n+      bundleType: 'pages',\n+    }),\n+    name: 'next-bundle-pages-dev-turbo',\n   })\n }\n \n@@ -2930,17 +2967,20 @@ export async function next_bundle(task, opts) {\n   await task.parallel(\n     [\n       // builds the app (route/page) bundles\n-      'next_bundle_app_turbo',\n+      'next_bundle_app_prod_turbo',\n       'next_bundle_app_prod',\n+      'next_bundle_app_dev_turbo',\n       'next_bundle_app_dev',\n       // builds the app (route/page) bundles with react experimental\n-      'next_bundle_app_turbo_experimental',\n+      'next_bundle_app_prod_turbo_experimental',\n       'next_bundle_app_prod_experimental',\n+      'next_bundle_app_dev_turbo_experimental',\n       'next_bundle_app_dev_experimental',\n       // builds the pages (page/api) bundles\n       'next_bundle_pages_prod',\n       'next_bundle_pages_dev',\n-      'next_bundle_pages_turbo',\n+      'next_bundle_pages_prod_turbo',\n+      'next_bundle_pages_dev_turbo',\n       // builds the minimal server\n       'next_bundle_server',\n     ],"
        }
    ],
    "stats": {
        "total": 229,
        "additions": 144,
        "deletions": 85
    }
}