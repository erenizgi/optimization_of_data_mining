{
    "author": "bgw",
    "message": "Turbopack: Track variable usage inside of visit_assign_target_pat (#81654)\n\nFixes #81462\n\n## Bug Report\n\n> Turbopack does not recognise such pattern:\n\n```ts\nconst func = () => {\n  return { bool: true };\n};\n\nlet bool = false;\n\n({ bool } = func()); // This is not recognised\n```\n\n> This means `bool` variable will be reassigned. But turbopack will convert later usage of this\n\n```ts\nif(bool) {\n  // Whatever here\n  return 123;\n}\n```\n\n> To this:\n\n```js\nif (\"TURBOPACK compile-time falsy\", 0) //TURBOPACK unreachable\n    ;\n```",
    "sha": "3db946deea1829c9a8da0a0a8861b24c8e8e060e",
    "files": [
        {
            "sha": "22ca9d63c05e2665ad75e53af9c8f7174ea9726a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 77,
            "deletions": 50,
            "changes": 127,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -765,7 +765,8 @@ struct Analyzer<'a> {\n \n     var_decl_kind: Option<VarDeclKind>,\n \n-    /// Used for patterns\n+    /// The RHS (or some part of it) of a pattern assignment, read by the individual parts of the\n+    /// pattern assignment.\n     current_value: Option<JsValue>,\n \n     /// Return values of the current function.\n@@ -1740,6 +1741,34 @@ impl VisitAstPath for Analyzer<'_> {\n         n.visit_children_with_ast_path(self, ast_path);\n     }\n \n+    fn visit_assign_target_pat<'ast: 'r, 'r>(\n+        &mut self,\n+        pat: &'ast AssignTargetPat,\n+        ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n+    ) {\n+        let value = self\n+            .current_value\n+            .take()\n+            .unwrap_or_else(|| JsValue::unknown_empty(false, \"pattern without value\"));\n+        match pat {\n+            AssignTargetPat::Array(arr) => {\n+                let mut ast_path = ast_path.with_guard(AstParentNodeRef::AssignTargetPat(\n+                    pat,\n+                    AssignTargetPatField::Array,\n+                ));\n+                self.handle_array_pat_with_value(arr, value, &mut ast_path);\n+            }\n+            AssignTargetPat::Object(obj) => {\n+                let mut ast_path = ast_path.with_guard(AstParentNodeRef::AssignTargetPat(\n+                    pat,\n+                    AssignTargetPatField::Object,\n+                ));\n+                self.handle_object_pat_with_value(obj, value, &mut ast_path);\n+            }\n+            AssignTargetPat::Invalid(_) => {}\n+        }\n+    }\n+\n     fn visit_pat<'ast: 'r, 'r>(\n         &mut self,\n         pat: &'ast Pat,\n@@ -1761,60 +1790,22 @@ impl VisitAstPath for Analyzer<'_> {\n             }\n \n             Pat::Array(arr) => {\n-                match &value {\n-                    Some(JsValue::Array { items, .. }) => {\n-                        let mut ast_path =\n-                            ast_path.with_guard(AstParentNodeRef::Pat(pat, PatField::Array));\n-                        for (idx, elem) in arr.elems.iter().enumerate() {\n-                            self.current_value = items.get(idx).cloned();\n-                            let mut ast_path = ast_path.with_guard(AstParentNodeRef::ArrayPat(\n-                                arr,\n-                                ArrayPatField::Elems(idx),\n-                            ));\n-                            elem.visit_with_ast_path(self, &mut ast_path);\n-                        }\n-\n-                        // We should not call visit_children_with\n-                        return;\n-                    }\n-\n-                    Some(value) => {\n-                        let mut ast_path =\n-                            ast_path.with_guard(AstParentNodeRef::Pat(pat, PatField::Array));\n-                        for (idx, elem) in arr.elems.iter().enumerate() {\n-                            self.current_value = Some(JsValue::member(\n-                                Box::new(value.clone()),\n-                                Box::new(JsValue::Constant(ConstantValue::Num(ConstantNumber(\n-                                    idx as f64,\n-                                )))),\n-                            ));\n-                            let mut ast_path = ast_path.with_guard(AstParentNodeRef::ArrayPat(\n-                                arr,\n-                                ArrayPatField::Elems(idx),\n-                            ));\n-                            elem.visit_with_ast_path(self, &mut ast_path);\n-                        }\n-                        // We should not call visit_children_with\n-                        return;\n-                    }\n-\n-                    None => {}\n-                }\n+                let mut ast_path = ast_path.with_guard(AstParentNodeRef::Pat(pat, PatField::Array));\n+                let value =\n+                    value.unwrap_or_else(|| JsValue::unknown_empty(false, \"pattern without value\"));\n+                self.handle_array_pat_with_value(arr, value, &mut ast_path);\n             }\n \n             Pat::Object(obj) => {\n+                let mut ast_path =\n+                    ast_path.with_guard(AstParentNodeRef::Pat(pat, PatField::Object));\n                 let value =\n                     value.unwrap_or_else(|| JsValue::unknown_empty(false, \"pattern without value\"));\n-\n-                self.visit_pat_with_value(pat, obj, value, ast_path);\n-\n-                // We should not call visit_children_with\n-                return;\n+                self.handle_object_pat_with_value(obj, value, &mut ast_path);\n             }\n \n-            _ => {}\n+            _ => pat.visit_children_with_ast_path(self, ast_path),\n         }\n-        pat.visit_children_with_ast_path(self, ast_path);\n     }\n \n     fn visit_return_stmt<'ast: 'r, 'r>(\n@@ -2368,14 +2359,50 @@ impl Analyzer<'_> {\n         }\n     }\n \n-    fn visit_pat_with_value<'ast: 'r, 'r>(\n+    fn handle_array_pat_with_value<'ast: 'r, 'r>(\n+        &mut self,\n+        arr: &'ast ArrayPat,\n+        current_value: JsValue,\n+        ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n+    ) {\n+        match current_value {\n+            JsValue::Array { items, .. } => {\n+                for (idx, (elem_pat, value_item)) in arr\n+                    .elems\n+                    .iter()\n+                    // TODO: This does not handle inline spreads correctly\n+                    // e.g. `let [a,..b,c] = [1,2,3]`\n+                    .zip(items.into_iter().map(Some).chain(iter::repeat(None)))\n+                    .enumerate()\n+                {\n+                    self.current_value = value_item;\n+                    let mut ast_path = ast_path\n+                        .with_guard(AstParentNodeRef::ArrayPat(arr, ArrayPatField::Elems(idx)));\n+                    elem_pat.visit_with_ast_path(self, &mut ast_path);\n+                }\n+            }\n+            value => {\n+                for (idx, elem) in arr.elems.iter().enumerate() {\n+                    self.current_value = Some(JsValue::member(\n+                        Box::new(value.clone()),\n+                        Box::new(JsValue::Constant(ConstantValue::Num(ConstantNumber(\n+                            idx as f64,\n+                        )))),\n+                    ));\n+                    let mut ast_path = ast_path\n+                        .with_guard(AstParentNodeRef::ArrayPat(arr, ArrayPatField::Elems(idx)));\n+                    elem.visit_with_ast_path(self, &mut ast_path);\n+                }\n+            }\n+        }\n+    }\n+\n+    fn handle_object_pat_with_value<'ast: 'r, 'r>(\n         &mut self,\n-        pat: &'ast Pat,\n         obj: &'ast ObjectPat,\n         current_value: JsValue,\n         ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n     ) {\n-        let mut ast_path = ast_path.with_guard(AstParentNodeRef::Pat(pat, PatField::Object));\n         for (i, prop) in obj.props.iter().enumerate() {\n             let mut ast_path =\n                 ast_path.with_guard(AstParentNodeRef::ObjectPat(obj, ObjectPatField::Props(i)));"
        },
        {
            "sha": "fe51488c7066f6687ef680d6bfaa4f7768ef205c",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/pattern-assignment/graph-effects.snapshot",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-effects.snapshot?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1 @@\n+[]"
        },
        {
            "sha": "3844257b7f5893d1ab2836dd6c83a2d96223bb0b",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/pattern-assignment/graph-explained.snapshot",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph-explained.snapshot?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1,7 @@\n+arrPatternBool = (true | false)\n+\n+nestedPatternBool = ({\"inner\": [true]}[\"inner\"][0] | {\"inner\": [false]}[\"inner\"][0])\n+\n+objPatternBool = ({\"objPatternBool\": true}[\"objPatternBool\"] | {\"objPatternBool\": false}[\"objPatternBool\"])\n+\n+singleAssignBool = {\"singleAssignBool\": true}[\"singleAssignBool\"]"
        },
        {
            "sha": "c31b8183bcc1724ca06c1d8ec3e1e79be59989b9",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/pattern-assignment/graph.snapshot",
            "status": "added",
            "additions": 210,
            "deletions": 0,
            "changes": 210,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fgraph.snapshot?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1,210 @@\n+[\n+    (\n+        \"arrPatternBool\",\n+        Alternatives {\n+            total_nodes: 3,\n+            values: [\n+                Constant(\n+                    True,\n+                ),\n+                Constant(\n+                    False,\n+                ),\n+            ],\n+            logical_property: None,\n+        },\n+    ),\n+    (\n+        \"nestedPatternBool\",\n+        Alternatives {\n+            total_nodes: 17,\n+            values: [\n+                Member(\n+                    8,\n+                    Member(\n+                        6,\n+                        Object {\n+                            total_nodes: 4,\n+                            parts: [\n+                                KeyValue(\n+                                    Constant(\n+                                        Str(\n+                                            Atom(\n+                                                \"inner\",\n+                                            ),\n+                                        ),\n+                                    ),\n+                                    Array {\n+                                        total_nodes: 2,\n+                                        items: [\n+                                            Constant(\n+                                                True,\n+                                            ),\n+                                        ],\n+                                        mutable: true,\n+                                    },\n+                                ),\n+                            ],\n+                            mutable: true,\n+                        },\n+                        Constant(\n+                            Str(\n+                                Atom(\n+                                    \"inner\",\n+                                ),\n+                            ),\n+                        ),\n+                    ),\n+                    Constant(\n+                        Num(\n+                            ConstantNumber(\n+                                0.0,\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+                Member(\n+                    8,\n+                    Member(\n+                        6,\n+                        Object {\n+                            total_nodes: 4,\n+                            parts: [\n+                                KeyValue(\n+                                    Constant(\n+                                        Str(\n+                                            Atom(\n+                                                \"inner\",\n+                                            ),\n+                                        ),\n+                                    ),\n+                                    Array {\n+                                        total_nodes: 2,\n+                                        items: [\n+                                            Constant(\n+                                                False,\n+                                            ),\n+                                        ],\n+                                        mutable: true,\n+                                    },\n+                                ),\n+                            ],\n+                            mutable: true,\n+                        },\n+                        Constant(\n+                            Str(\n+                                Atom(\n+                                    \"inner\",\n+                                ),\n+                            ),\n+                        ),\n+                    ),\n+                    Constant(\n+                        Num(\n+                            ConstantNumber(\n+                                0.0,\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ],\n+            logical_property: None,\n+        },\n+    ),\n+    (\n+        \"objPatternBool\",\n+        Alternatives {\n+            total_nodes: 11,\n+            values: [\n+                Member(\n+                    5,\n+                    Object {\n+                        total_nodes: 3,\n+                        parts: [\n+                            KeyValue(\n+                                Constant(\n+                                    Str(\n+                                        Atom(\n+                                            \"objPatternBool\",\n+                                        ),\n+                                    ),\n+                                ),\n+                                Constant(\n+                                    True,\n+                                ),\n+                            ),\n+                        ],\n+                        mutable: true,\n+                    },\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"objPatternBool\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+                Member(\n+                    5,\n+                    Object {\n+                        total_nodes: 3,\n+                        parts: [\n+                            KeyValue(\n+                                Constant(\n+                                    Str(\n+                                        Atom(\n+                                            \"objPatternBool\",\n+                                        ),\n+                                    ),\n+                                ),\n+                                Constant(\n+                                    False,\n+                                ),\n+                            ),\n+                        ],\n+                        mutable: true,\n+                    },\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"objPatternBool\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ],\n+            logical_property: None,\n+        },\n+    ),\n+    (\n+        \"singleAssignBool\",\n+        Member(\n+            5,\n+            Object {\n+                total_nodes: 3,\n+                parts: [\n+                    KeyValue(\n+                        Constant(\n+                            Str(\n+                                Atom(\n+                                    \"singleAssignBool\",\n+                                ),\n+                            ),\n+                        ),\n+                        Constant(\n+                            True,\n+                        ),\n+                    ),\n+                ],\n+                mutable: true,\n+            },\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"singleAssignBool\",\n+                    ),\n+                ),\n+            ),\n+        ),\n+    ),\n+]"
        },
        {
            "sha": "2de4e84c2c981616386efdea457b57ee99beb20b",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/pattern-assignment/input.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Finput.js?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1,10 @@\n+const { singleAssignBool } = { singleAssignBool: true };\n+\n+let { objPatternBool } = { objPatternBool: true };\n+({ objPatternBool } = { objPatternBool: false });\n+\n+let [ arrPatternBool ] = [ true ];\n+[arrPatternBool] = [false];\n+\n+let [{inner: [ nestedPatternBool ]}] = [{inner: [ true ]}];\n+[{inner: [ nestedPatternBool ]}] = [{inner: [ false ]}];"
        },
        {
            "sha": "c520d461fad82d162ea65f6d44ff46d2aa3777b3",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/pattern-assignment/resolved-explained.snapshot",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fresolved-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fresolved-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2Fpattern-assignment%2Fresolved-explained.snapshot?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1,18 @@\n+arrPatternBool = (true | false)\n+\n+nestedPatternBool = (true | ???*0* | ???*1* | false)\n+- *0* unknown mutation\n+  ⚠️  This value might have side effects\n+- *1* ???*2*[0]\n+  ⚠️  unknown object\n+  ⚠️  This value might have side effects\n+- *2* unknown mutation\n+  ⚠️  This value might have side effects\n+\n+objPatternBool = (true | ???*0* | false)\n+- *0* unknown mutation\n+  ⚠️  This value might have side effects\n+\n+singleAssignBool = (true | ???*0*)\n+- *0* unknown mutation\n+  ⚠️  This value might have side effects"
        },
        {
            "sha": "e9499cfb8535ea575931ecaa548d67ddbeb65e67",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/assignment/input/index.js",
            "status": "added",
            "additions": 213,
            "deletions": 0,
            "changes": 213,
            "blob_url": "https://github.com/vercel/next.js/blob/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fassignment%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3db946deea1829c9a8da0a0a8861b24c8e8e060e/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fassignment%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fassignment%2Finput%2Findex.js?ref=3db946deea1829c9a8da0a0a8861b24c8e8e060e",
            "patch": "@@ -0,0 +1,213 @@\n+let count = 0\n+\n+describe('Simple Assignment', () => {\n+  it('handles static declaration', () => {\n+    const bool = true\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles static expression', () => {\n+    let bool = false\n+    bool = true\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic declaration', () => {\n+    function dynamic() {\n+      return true\n+    }\n+    const bool = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic expression', () => {\n+    function dynamic() {\n+      return true\n+    }\n+    let bool = false\n+    bool = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+})\n+\n+describe('Object Patterns', () => {\n+  it('handles static declaration', () => {\n+    const { bool } = {\n+      bool: true,\n+    }\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles static expression', () => {\n+    let bool = false\n+    ;({ bool } = {\n+      bool: true,\n+    })\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic declaration', () => {\n+    function dynamic() {\n+      return {\n+        bool: true,\n+      }\n+    }\n+    const { bool } = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic expression', () => {\n+    function dynamic() {\n+      return {\n+        bool: true,\n+      }\n+    }\n+    let bool = false\n+    ;({ bool } = dynamic())\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+})\n+\n+describe('Array Patterns', () => {\n+  it('handles static declaration', () => {\n+    const [bool] = [true]\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles static expression', () => {\n+    let bool = false\n+    ;[bool] = [true]\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic declaration', () => {\n+    function dynamic() {\n+      return [true]\n+    }\n+    const [bool] = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic expression', () => {\n+    function dynamic() {\n+      return [true]\n+    }\n+    let bool = false\n+    ;[bool] = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+})\n+\n+describe('Nested Patterns', () => {\n+  it('handles static declaration', () => {\n+    const {\n+      inner: [bool],\n+    } = {\n+      inner: [true],\n+    }\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles static expression', () => {\n+    let bool = false\n+    ;({\n+      inner: [bool],\n+    } = {\n+      inner: [true],\n+    })\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic declaration', () => {\n+    function dynamic() {\n+      return {\n+        inner: [true],\n+      }\n+    }\n+    const {\n+      inner: [bool],\n+    } = dynamic()\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+\n+  it('handles dynamic expression', () => {\n+    function dynamic() {\n+      return {\n+        inner: [true],\n+      }\n+    }\n+    let bool = false\n+    ;({\n+      inner: [bool],\n+    } = dynamic())\n+    if (bool) {\n+      count++\n+    } else {\n+      throw Error('this branch is not taken')\n+    }\n+  })\n+})\n+\n+it('took the right number of branches', () => {\n+  expect(count).toEqual(16)\n+})"
        }
    ],
    "stats": {
        "total": 586,
        "additions": 536,
        "deletions": 50
    }
}