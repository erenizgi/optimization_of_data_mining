{
    "author": "wbinnssmith",
    "message": "bundle-analyzer: Add sizes to treemap, status bar (#86966)\n\n![CleanShot 2025-12-08 at 19.58.55@2x.png](https://app.graphite.com/user-attachments/assets/43f13844-abe2-4a1b-bbc4-764554ca6634.png)",
    "sha": "585126e2b32fca1d3da6f85939b98a4e23c73d30",
    "files": [
        {
            "sha": "8bb3f094e9e4ca645c97a6bab1ec6b1c385d6ab6",
            "filename": "apps/bundle-analyzer/app/page.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -11,12 +11,14 @@ import {\n import { Sidebar } from '@/components/sidebar'\n import { TreemapVisualizer } from '@/components/treemap-visualizer'\n \n+import { Badge } from '@/components/ui/badge'\n import { Input } from '@/components/ui/input'\n import { TreemapSkeleton } from '@/components/ui/skeleton'\n import { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group'\n import { AnalyzeData, ModulesData } from '@/lib/analyze-data'\n import { computeActiveEntries, computeModuleDepthMap } from '@/lib/module-graph'\n import { fetchStrict } from '@/lib/utils'\n+import { formatBytes } from '@/lib/utils'\n \n export default function Home() {\n   const [selectedRoute, setSelectedRoute] = useState<string | null>(null)\n@@ -65,6 +67,7 @@ export default function Home() {\n   const [isMouseInTreemap, setIsMouseInTreemap] = useState(false)\n   const [hoveredNodeInfo, setHoveredNodeInfo] = useState<{\n     name: string\n+    size: number\n     server?: boolean\n     client?: boolean\n   } | null>(null)\n@@ -284,30 +287,30 @@ export default function Home() {\n \n       {analyzeData && (\n         <div className=\"flex-none border-t border-border bg-background px-4 py-2 h-10\">\n-          <p className=\"text-sm text-muted-foreground\">\n+          <div className=\"text-sm text-muted-foreground\">\n             {hoveredNodeInfo ? (\n               <>\n                 <span className=\"font-medium text-foreground\">\n                   {hoveredNodeInfo.name}\n                 </span>\n+                <span className=\"ml-2 text-muted-foreground\">\n+                  {formatBytes(hoveredNodeInfo.size)}\n+                </span>\n                 {(hoveredNodeInfo.server || hoveredNodeInfo.client) && (\n-                  <span className=\"ml-2 text-xs\">\n+                  <span className=\"ml-2 inline-flex gap-1\">\n                     {hoveredNodeInfo.client && (\n-                      <span className=\"text-primary\">[client]</span>\n-                    )}\n-                    {hoveredNodeInfo.server && hoveredNodeInfo.client && (\n-                      <span> </span>\n+                      <Badge variant=\"client\">client</Badge>\n                     )}\n                     {hoveredNodeInfo.server && (\n-                      <span className=\"text-primary\">[server]</span>\n+                      <Badge variant=\"server\">server</Badge>\n                     )}\n                   </span>\n                 )}\n               </>\n             ) : (\n               'Hover over a file to see details'\n             )}\n-          </p>\n+          </div>\n         </div>\n       )}\n     </main>"
        },
        {
            "sha": "2cfaa38761671eafc835bc6bfb35f6906ce92fad",
            "filename": "apps/bundle-analyzer/components/sidebar.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -6,6 +6,7 @@ import { Skeleton } from '@/components/ui/skeleton'\n import { AnalyzeData, ModulesData } from '@/lib/analyze-data'\n import { SpecialModule } from '@/lib/types'\n import { getSpecialModuleType } from '@/lib/utils'\n+import { Badge } from './ui/badge'\n \n interface SidebarProps {\n   sidebarWidth: number\n@@ -121,14 +122,16 @@ export function Sidebar({\n           analyzeData.source(selectedSourceIndex) &&\n           (specialModuleType === SpecialModule.POLYFILL_MODULE ||\n             specialModuleType === SpecialModule.POLYFILL_NOMODULE) && (\n-            <div className=\"flex items-center gap-2\">\n-              <dt className=\"inline-flex items-center rounded-md bg-polyfill/10 dark:bg-polyfill/30 px-2 py-1 text-xs font-medium text-polyfill dark:text-polyfill-foreground ring-1 ring-inset ring-polyfill/20 shrink-0\">\n-                Polyfill\n-              </dt>\n-              <dd className=\"text-xs text-muted-foreground\">\n-                Next.js built-in polyfills\n-              </dd>\n-            </div>\n+            <dl>\n+              <div className=\"flex items-center gap-2\">\n+                <dt className=\"inline-flex items-center\">\n+                  <Badge variant=\"polyfill\">Polyfill</Badge>\n+                </dt>\n+                <dd className=\"text-xs text-muted-foreground\">\n+                  Next.js built-in polyfills\n+                </dd>\n+              </div>\n+            </dl>\n           )}\n \n         {selectedSourceIndex != null &&"
        },
        {
            "sha": "e5c5a4342eba21ecd1fc139990b96d8e34d39a1d",
            "filename": "apps/bundle-analyzer/components/treemap-visualizer.tsx",
            "status": "modified",
            "additions": 39,
            "deletions": 8,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -10,6 +10,7 @@ import {\n   type LayoutNodeInfo,\n } from '@/lib/treemap-layout'\n import { SpecialModule } from '@/lib/types'\n+import { formatBytes } from '@/lib/utils'\n \n interface TreemapVisualizerProps {\n   analyzeData: AnalyzeData\n@@ -337,15 +338,24 @@ function drawTreemap(\n     if (rect.width > 60 && rect.height > 30) {\n       const textColor = readableColor(color)\n       ctx.fillStyle = textColor\n-      ctx.font = '12px sans-serif'\n       ctx.textAlign = 'center'\n       ctx.textBaseline = 'middle'\n \n       const maxWidth = rect.width - 8\n       let displayName = name\n-      const metrics = ctx.measureText(displayName)\n \n-      if (metrics.width > maxWidth) {\n+      const sizeText = formatBytes(node.size)\n+      const fontSize = 12\n+      const sizeFontSize = 10\n+      const lineHeight = fontSize + 2\n+\n+      // Check if we have space for both name and size\n+      const hasSpaceForSize = rect.height > 50\n+\n+      ctx.font = `${fontSize}px sans-serif`\n+      const nameMetrics = ctx.measureText(displayName)\n+\n+      if (nameMetrics.width > maxWidth) {\n         while (\n           displayName.length > 0 &&\n           ctx.measureText(`${displayName}...`).width > maxWidth\n@@ -355,11 +365,31 @@ function drawTreemap(\n         displayName += '...'\n       }\n \n-      ctx.fillText(\n-        displayName,\n-        rect.x + rect.width / 2,\n-        rect.y + rect.height / 2\n-      )\n+      if (hasSpaceForSize) {\n+        ctx.font = `${fontSize}px sans-serif`\n+        ctx.fillText(\n+          displayName,\n+          rect.x + rect.width / 2,\n+          rect.y + rect.height / 2 - lineHeight / 2\n+        )\n+\n+        ctx.globalAlpha = opacity * 0.75\n+        ctx.font = `${sizeFontSize}px sans-serif`\n+        ctx.fillText(\n+          sizeText,\n+          rect.x + rect.width / 2,\n+          rect.y + rect.height / 2 + lineHeight / 2\n+        )\n+        ctx.globalAlpha = opacity\n+      } else {\n+        // Only name fits, draw it centered\n+        ctx.font = `${fontSize}px sans-serif`\n+        ctx.fillText(\n+          displayName,\n+          rect.x + rect.width / 2,\n+          rect.y + rect.height / 2\n+        )\n+      }\n     }\n \n     ctx.globalAlpha = 1.0\n@@ -797,6 +827,7 @@ export function TreemapVisualizer({\n     if (node) {\n       const nodeInfo = {\n         name: node.name,\n+        size: node.size,\n         server: node.server,\n         client: node.client,\n       }"
        },
        {
            "sha": "85cca5f7fc83381055053bbabc01aa0615f3fd34",
            "filename": "apps/bundle-analyzer/components/ui/badge.tsx",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbadge.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbadge.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbadge.tsx?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -0,0 +1,42 @@\n+import { cva, type VariantProps } from 'class-variance-authority'\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+const badgeVariants = cva(\n+  'inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2',\n+  {\n+    variants: {\n+      variant: {\n+        default:\n+          'border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80',\n+        secondary:\n+          'border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80',\n+        destructive:\n+          'border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80',\n+        outline: 'text-foreground',\n+        client:\n+          'border-transparent bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-300 ring-1 ring-inset ring-blue-700/10 dark:ring-blue-300/20',\n+        server:\n+          'border-transparent bg-purple-50 dark:bg-purple-950 text-purple-700 dark:text-purple-300 ring-1 ring-inset ring-purple-700/10 dark:ring-purple-300/20',\n+        polyfill:\n+          'border-transparent bg-polyfill/10 dark:bg-polyfill/30 text-polyfill dark:text-polyfill-foreground ring-1 ring-inset ring-polyfill/20',\n+      },\n+    },\n+    defaultVariants: {\n+      variant: 'default',\n+    },\n+  }\n+)\n+\n+export interface BadgeProps\n+  extends React.HTMLAttributes<HTMLSpanElement>,\n+    VariantProps<typeof badgeVariants> {}\n+\n+function Badge({ className, variant, ...props }: BadgeProps) {\n+  return (\n+    <span className={cn(badgeVariants({ variant }), className)} {...props} />\n+  )\n+}\n+\n+export { Badge, badgeVariants }"
        },
        {
            "sha": "0ccb3c7348147982ed94112ce3075b14b60ed8ca",
            "filename": "apps/bundle-analyzer/lib/treemap-layout.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -12,6 +12,7 @@ export interface LayoutRect {\n \n export interface LayoutNodeInfo {\n   name: string\n+  size: number\n   server?: boolean\n   client?: boolean\n }"
        },
        {
            "sha": "a16367141f7e70e49b26dc2453e015976baafffc",
            "filename": "apps/bundle-analyzer/lib/utils.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Flib%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/585126e2b32fca1d3da6f85939b98a4e23c73d30/apps%2Fbundle-analyzer%2Flib%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Futils.ts?ref=585126e2b32fca1d3da6f85939b98a4e23c73d30",
            "patch": "@@ -43,6 +43,15 @@ export function getSpecialModuleType(\n   return null\n }\n \n+export function formatBytes(bytes: number): string {\n+  if (bytes === 0) return '0 B'\n+  if (bytes < 1024) return `${bytes} B`\n+  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} KB`\n+  if (bytes < 1024 * 1024 * 1024)\n+    return `${(bytes / (1024 * 1024)).toFixed(2)} MB`\n+  return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n+}\n+\n let IDENT_ATTRIBUTES_REGEXP =\n   /^(.+?)(?: \\{(.*)\\})?(?: \\[(.*)\\])?(?: \\((.*?)\\))?(?: <(.*?)>)?$/\n "
        }
    ],
    "stats": {
        "total": 137,
        "additions": 113,
        "deletions": 24
    }
}