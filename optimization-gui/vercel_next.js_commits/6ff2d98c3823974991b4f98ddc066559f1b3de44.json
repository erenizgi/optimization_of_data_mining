{
    "author": "mischnic",
    "message": "Turbopack: remove pages router double template (#86842)\n\nWebpack does:\r\n`templates/edge-ssr.js -> user's pages/index.js`\r\n\r\nTurbopack does\r\n`templates/edge-ssr.js { INNER_PAGE_ENTRY => \\\"[project]/packages/next/dist/esm/build/templates/pages.js { INNER_PAGE => \\\\\\\"[project]/test/tmp/next-test-1764875742357-479/pages/index.js`\r\n\r\n\r\n\r\n`VAR_USERLAND` here: https://github.com/vercel/next.js/blob/ee3d017e43eb953a62746a0e6110a94dc7a3c980/packages/next/src/build/templates/edge-ssr.ts#L12-L13\r\nfor Webpack is actually the user's page file with the `export default Page()`\r\nfor Turbopack is actually whatever `templates/pages.js` exports and it relies on this default reexport: https://github.com/vercel/next.js/blob/38ef2360e1e133f329a9061ce17aad8aaab33cb2/packages/next/src/build/templates/pages.ts#L15 while ignoring everything else in there",
    "sha": "6ff2d98c3823974991b4f98ddc066559f1b3de44",
    "files": [
        {
            "sha": "8a0d42340666e7475be702c43034262049d7e71d",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 22,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -890,40 +890,24 @@ impl PageEndpoint {\n                     runtime: NextRuntime::NodeJs,\n                     regions: config.preferred_region.clone(),\n                 }\n-            } else if runtime == NextRuntime::Edge {\n-                let modules = create_page_ssr_entry_module(\n-                    this.pathname.clone(),\n-                    reference_type,\n-                    project_root,\n-                    Vc::upcast(edge_module_context),\n-                    self.source(),\n-                    this.original_name.clone(),\n-                    *this.pages_structure,\n-                    runtime,\n-                    this.pages_project.project().next_config(),\n-                )\n-                .await?;\n-\n-                InternalSsrChunkModule {\n-                    ssr_module: modules.ssr_module,\n-                    app_module: modules.app_module,\n-                    document_module: modules.document_module,\n-                    runtime,\n-                    regions: config.preferred_region.clone(),\n-                }\n             } else {\n                 let modules = create_page_ssr_entry_module(\n                     this.pathname.clone(),\n                     reference_type,\n                     project_root,\n-                    Vc::upcast(module_context),\n+                    if runtime == NextRuntime::Edge {\n+                        Vc::upcast(edge_module_context)\n+                    } else {\n+                        Vc::upcast(module_context)\n+                    },\n                     self.source(),\n                     this.original_name.clone(),\n                     *this.pages_structure,\n                     runtime,\n                     this.pages_project.project().next_config(),\n                 )\n                 .await?;\n+\n                 InternalSsrChunkModule {\n                     ssr_module: modules.ssr_module,\n                     app_module: modules.app_module,"
        },
        {
            "sha": "a8bb436cc4385e5200a16b459439b433974dc743",
            "filename": "crates/next-core/src/middleware.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -91,9 +91,9 @@ pub async fn get_middleware_module(\n     let source = load_next_js_template(\n         \"middleware.js\",\n         project_root,\n-        &[(\"VAR_USERLAND\", INNER), (\"VAR_DEFINITION_PAGE\", page_path)],\n-        &[],\n-        &[],\n+        [(\"VAR_USERLAND\", INNER), (\"VAR_DEFINITION_PAGE\", page_path)],\n+        [],\n+        [],\n     )\n     .await?;\n "
        },
        {
            "sha": "002d280aa666d6618aca0a27eeb8655104cdc3af",
            "filename": "crates/next-core/src/next_app/app_page_entry.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -76,7 +76,7 @@ pub async fn get_app_page_entry(\n     let source = load_next_js_template(\n         \"app-page.js\",\n         project_root.clone(),\n-        &[\n+        [\n             (\"VAR_DEFINITION_PAGE\", &*page.to_string()),\n             (\"VAR_DEFINITION_PATHNAME\", &pathname),\n             (\n@@ -88,12 +88,12 @@ pub async fn get_app_page_entry(\n                 },\n             ),\n         ],\n-        &[\n+        [\n             (\"tree\", &*loader_tree_code),\n             (\"__next_app_require__\", &TURBOPACK_REQUIRE.bound()),\n             (\"__next_app_load_chunk__\", &TURBOPACK_LOAD.bound()),\n         ],\n-        &[],\n+        [],\n     )\n     .await?;\n \n@@ -150,13 +150,13 @@ async fn wrap_edge_page(\n     let source = load_next_js_template(\n         \"edge-ssr-app.js\",\n         project_root.clone(),\n-        &[(\"VAR_USERLAND\", INNER), (\"VAR_PAGE\", &page.to_string())],\n-        &[\n+        [(\"VAR_USERLAND\", INNER), (\"VAR_PAGE\", &page.to_string())],\n+        [\n             // TODO do we really need to pass the entire next config here?\n             // This is bad for invalidation as any config change will invalidate this\n             (\"nextConfig\", &*serde_json::to_string(next_config_val)?),\n         ],\n-        &[(\"incrementalCacheHandler\", None)],\n+        [(\"incrementalCacheHandler\", None)],\n     )\n     .await?;\n "
        },
        {
            "sha": "0761f3247213b73f4b5d1d4db112f34800d39814",
            "filename": "crates/next-core/src/next_app/app_route_entry.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -73,7 +73,7 @@ pub async fn get_app_route_entry(\n     let virtual_source = load_next_js_template(\n         \"app-route.js\",\n         project_root.clone(),\n-        &[\n+        [\n             (\"VAR_DEFINITION_PAGE\", &*page.to_string()),\n             (\"VAR_DEFINITION_PATHNAME\", &pathname),\n             (\"VAR_DEFINITION_FILENAME\", path.file_stem().unwrap()),\n@@ -82,8 +82,8 @@ pub async fn get_app_route_entry(\n             (\"VAR_RESOLVED_PAGE_PATH\", &path.value_to_string().await?),\n             (\"VAR_USERLAND\", &inner),\n         ],\n-        &[(\"nextConfigOutput\", output_type)],\n-        &[],\n+        [(\"nextConfigOutput\", output_type)],\n+        [],\n     )\n     .await?;\n \n@@ -141,9 +141,9 @@ async fn wrap_edge_route(\n     let source = load_next_js_template(\n         \"edge-app-route.js\",\n         project_root.clone(),\n-        &[(\"VAR_USERLAND\", &*inner), (\"VAR_PAGE\", &page.to_string())],\n-        &[(\"nextConfig\", &*serde_json::to_string(next_config)?)],\n-        &[],\n+        [(\"VAR_USERLAND\", &*inner), (\"VAR_PAGE\", &page.to_string())],\n+        [(\"nextConfig\", &*serde_json::to_string(next_config)?)],\n+        [],\n     )\n     .await?;\n "
        },
        {
            "sha": "bd167b6e3d4fc01aa9949ac9700093e4bd50f789",
            "filename": "crates/next-core/src/next_pages/page_entry.rs",
            "status": "modified",
            "additions": 110,
            "deletions": 159,
            "changes": 269,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -50,52 +50,101 @@ pub async fn create_page_ssr_entry_module(\n         .to_resolved()\n         .await?;\n \n-    let template_file = match (&reference_type, runtime) {\n-        (ReferenceType::Entry(EntryReferenceSubType::Page), _)\n-        | (ReferenceType::Entry(EntryReferenceSubType::PageData), _) => {\n+    let template_file = match &reference_type {\n+        ReferenceType::Entry(EntryReferenceSubType::Page)\n+        | ReferenceType::Entry(EntryReferenceSubType::PageData) => {\n             // Load the Page entry file.\n-            \"pages.js\"\n-        }\n-        (ReferenceType::Entry(EntryReferenceSubType::PagesApi), NextRuntime::NodeJs) => {\n-            // Load the Pages API entry file.\n-            \"pages-api.js\"\n+            match runtime {\n+                NextRuntime::NodeJs => \"pages.js\",\n+                NextRuntime::Edge => \"edge-ssr.js\",\n+            }\n         }\n-        (ReferenceType::Entry(EntryReferenceSubType::PagesApi), NextRuntime::Edge) => {\n+        ReferenceType::Entry(EntryReferenceSubType::PagesApi) => {\n             // Load the Pages API entry file.\n-            \"pages-edge-api.js\"\n+            match runtime {\n+                NextRuntime::NodeJs => \"pages-api.js\",\n+                NextRuntime::Edge => \"pages-edge-api.js\",\n+            }\n         }\n         _ => bail!(\"Invalid path type\"),\n     };\n \n     let inner = rcstr!(\"INNER_PAGE\");\n-\n     let inner_document = rcstr!(\"INNER_DOCUMENT\");\n     let inner_app = rcstr!(\"INNER_APP\");\n+    let inner_error = rcstr!(\"INNER_ERROR\");\n+    let inner_error_500 = rcstr!(\"INNER_500\");\n \n     let mut replacements = vec![\n-        (\"VAR_DEFINITION_PAGE\", &*definition_page),\n-        (\"VAR_DEFINITION_PATHNAME\", &definition_pathname),\n-        (\"VAR_USERLAND\", &inner),\n+        (\"VAR_DEFINITION_PATHNAME\", &*definition_pathname),\n+        (\"VAR_USERLAND\", &*inner),\n     ];\n \n     let is_page = matches!(\n         reference_type,\n         ReferenceType::Entry(EntryReferenceSubType::Page)\n             | ReferenceType::Entry(EntryReferenceSubType::PageData)\n     );\n+    if !(is_page && runtime == NextRuntime::Edge) {\n+        replacements.push((\"VAR_DEFINITION_PAGE\", &*definition_page));\n+    }\n     if is_page {\n-        replacements.push((\"VAR_MODULE_DOCUMENT\", &inner_document));\n-        replacements.push((\"VAR_MODULE_APP\", &inner_app));\n+        replacements.push((\"VAR_MODULE_DOCUMENT\", &*inner_document));\n+        replacements.push((\"VAR_MODULE_APP\", &*inner_app));\n+        if is_page && runtime == NextRuntime::Edge {\n+            replacements.push((\"VAR_MODULE_GLOBAL_ERROR\", &*inner_error));\n+        }\n     }\n-    let source_ident = source.ident().await?;\n-    // for PagesData we apply a ?server-data query parameter to avoid conflicts with the Page\n-    // module.\n-    // We need to copy that to all the modules we create.\n-    let source_query = source_ident.query.clone();\n+\n+    let pages_structure_ref = pages_structure.await?;\n+\n+    let (injections, imports) = if is_page && runtime == NextRuntime::Edge {\n+        let next_config_val = &*next_config.await?;\n+        let injections = vec![\n+            // TODO do we really need to pass the entire next config here?\n+            // This is bad for invalidation as any config change will invalidate this\n+            (\"nextConfig\", serde_json::to_string(next_config_val)?),\n+            (\n+                \"pageRouteModuleOptions\",\n+                serde_json::to_string(&get_route_module_options(\n+                    definition_page.clone(),\n+                    definition_pathname.clone(),\n+                ))?,\n+            ),\n+            (\n+                \"errorRouteModuleOptions\",\n+                serde_json::to_string(&get_route_module_options(\n+                    rcstr!(\"/_error\"),\n+                    rcstr!(\"/_error\"),\n+                ))?,\n+            ),\n+            (\n+                \"user500RouteModuleOptions\",\n+                serde_json::to_string(&get_route_module_options(rcstr!(\"/500\"), rcstr!(\"/500\")))?,\n+            ),\n+        ];\n+        let imports = vec![\n+            // TODO\n+            (\"incrementalCacheHandler\", None),\n+            (\n+                \"userland500Page\",\n+                pages_structure_ref.error_500.map(|_| &*inner_error_500),\n+            ),\n+        ];\n+        (injections, imports)\n+    } else {\n+        (vec![], vec![])\n+    };\n \n     // Load the file from the next.js codebase.\n-    let mut source =\n-        load_next_js_template(template_file, project_root.clone(), &replacements, &[], &[]).await?;\n+    let mut source = load_next_js_template(\n+        template_file,\n+        project_root.clone(),\n+        replacements,\n+        injections.iter().map(|(k, v)| (*k, &**v)),\n+        imports,\n+    )\n+    .await?;\n \n     // When we're building the instrumentation page (only when the\n     // instrumentation file conflicts with a page also labeled\n@@ -125,7 +174,10 @@ pub async fn create_page_ssr_entry_module(\n         inner => ssr_module,\n     };\n \n-    let pages_structure_ref = pages_structure.await?;\n+    // for PagesData we apply a ?server-data query parameter to avoid conflicts with the Page\n+    // module.\n+    // We need to copy that to all the modules we create.\n+    let source_query = source.ident().await?.query.clone();\n \n     let (app_module, document_module) = if is_page {\n         // We process the document and app modules in the same context and reference type.\n@@ -147,6 +199,34 @@ pub async fn create_page_ssr_entry_module(\n         .await?;\n         inner_assets.insert(inner_document, document_module);\n         inner_assets.insert(inner_app, app_module);\n+\n+        if is_page && runtime == NextRuntime::Edge {\n+            inner_assets.insert(\n+                inner_error,\n+                process_global_item(\n+                    *pages_structure_ref.error,\n+                    reference_type.clone(),\n+                    source_query.clone(),\n+                    ssr_module_context,\n+                )\n+                .to_resolved()\n+                .await?,\n+            );\n+\n+            if let Some(error_500) = pages_structure_ref.error_500 {\n+                inner_assets.insert(\n+                    inner_error_500,\n+                    process_global_item(\n+                        *error_500,\n+                        reference_type.clone(),\n+                        source_query.clone(),\n+                        ssr_module_context,\n+                    )\n+                    .to_resolved()\n+                    .await?,\n+                );\n+            }\n+        }\n         (Some(app_module), Some(document_module))\n     } else {\n         (None, None)\n@@ -160,26 +240,12 @@ pub async fn create_page_ssr_entry_module(\n         .module();\n \n     if matches!(runtime, NextRuntime::Edge) {\n-        if is_page {\n-            ssr_module = wrap_edge_page(\n-                ssr_module_context,\n-                project_root,\n-                ssr_module,\n-                definition_page.clone(),\n-                definition_pathname.clone(),\n-                reference_type,\n-                pages_structure,\n-                next_config,\n-                source_query.clone(),\n-            );\n-        } else {\n-            ssr_module = wrap_edge_entry(\n-                ssr_module_context,\n-                project_root,\n-                ssr_module,\n-                pages_function_name(&definition_page).into(),\n-            );\n-        }\n+        ssr_module = wrap_edge_entry(\n+            ssr_module_context,\n+            project_root,\n+            ssr_module,\n+            pages_function_name(&definition_page).into(),\n+        );\n     }\n \n     Ok(PageSsrEntryModule {\n@@ -204,121 +270,6 @@ async fn process_global_item(\n     Ok(module_context.process(source, reference_type).module())\n }\n \n-#[turbo_tasks::function]\n-async fn wrap_edge_page(\n-    asset_context: Vc<Box<dyn AssetContext>>,\n-    project_root: FileSystemPath,\n-    entry: ResolvedVc<Box<dyn Module>>,\n-    page: RcStr,\n-    pathname: RcStr,\n-    reference_type: ReferenceType,\n-    pages_structure: Vc<PagesStructure>,\n-    next_config: Vc<NextConfig>,\n-    source_query: RcStr,\n-) -> Result<Vc<Box<dyn Module>>> {\n-    const INNER: &str = \"INNER_PAGE_ENTRY\";\n-\n-    const INNER_DOCUMENT: &str = \"INNER_DOCUMENT\";\n-    const INNER_APP: &str = \"INNER_APP\";\n-    const INNER_ERROR: &str = \"INNER_ERROR\";\n-    const INNER_ERROR_500: &str = \"INNER_500\";\n-\n-    let next_config_val = &*next_config.await?;\n-\n-    let source = load_next_js_template(\n-        \"edge-ssr.js\",\n-        project_root.clone(),\n-        &[\n-            (\"VAR_USERLAND\", INNER),\n-            (\"VAR_PAGE\", &pathname),\n-            (\"VAR_MODULE_DOCUMENT\", INNER_DOCUMENT),\n-            (\"VAR_MODULE_APP\", INNER_APP),\n-            (\"VAR_MODULE_GLOBAL_ERROR\", INNER_ERROR),\n-        ],\n-        &[\n-            // TODO do we really need to pass the entire next config here?\n-            // This is bad for invalidation as any config change will invalidate this\n-            (\"nextConfig\", &*serde_json::to_string(next_config_val)?),\n-            (\n-                \"pageRouteModuleOptions\",\n-                &serde_json::to_string(&get_route_module_options(page.clone(), pathname.clone()))?,\n-            ),\n-            (\n-                \"errorRouteModuleOptions\",\n-                &serde_json::to_string(&get_route_module_options(\n-                    rcstr!(\"/_error\"),\n-                    rcstr!(\"/_error\"),\n-                ))?,\n-            ),\n-            (\n-                \"user500RouteModuleOptions\",\n-                &serde_json::to_string(&get_route_module_options(rcstr!(\"/500\"), rcstr!(\"/500\")))?,\n-            ),\n-        ],\n-        &[\n-            // TODO\n-            (\"incrementalCacheHandler\", None),\n-            (\n-                \"userland500Page\",\n-                pages_structure.await?.error_500.map(|_| INNER_ERROR_500),\n-            ),\n-        ],\n-    )\n-    .await?;\n-\n-    let pages_structure_ref = pages_structure.await?;\n-\n-    let mut inner_assets = fxindexmap! {\n-        INNER.into() => entry,\n-        INNER_DOCUMENT.into() => process_global_item(\n-            *pages_structure_ref.document,\n-            reference_type.clone(),\n-            source_query.clone(),\n-            asset_context,\n-        ).to_resolved().await?,\n-        INNER_APP.into() => process_global_item(\n-            *pages_structure_ref.app,\n-            reference_type.clone(),\n-            source_query.clone(),\n-            asset_context,\n-        ).to_resolved().await?,\n-        INNER_ERROR.into() => process_global_item(\n-            *pages_structure_ref.error,\n-            reference_type.clone(),\n-            source_query.clone(),\n-            asset_context,\n-        ).to_resolved().await?,\n-    };\n-\n-    if let Some(error_500) = pages_structure_ref.error_500 {\n-        inner_assets.insert(\n-            INNER_ERROR_500.into(),\n-            process_global_item(\n-                *error_500,\n-                reference_type.clone(),\n-                source_query.clone(),\n-                asset_context,\n-            )\n-            .to_resolved()\n-            .await?,\n-        );\n-    }\n-\n-    let wrapped = asset_context\n-        .process(\n-            source,\n-            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n-        )\n-        .module();\n-\n-    Ok(wrap_edge_entry(\n-        asset_context,\n-        project_root,\n-        wrapped,\n-        pages_function_name(&page).into(),\n-    ))\n-}\n-\n #[derive(Serialize)]\n struct PartialRouteModuleOptions {\n     definition: RouteDefinition,"
        },
        {
            "sha": "1d3086bb62120c0955a0192bae775a9821826980",
            "filename": "crates/next-core/src/util.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Futil.rs?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -243,12 +243,12 @@ pub enum MiddlewareMatcherKind {\n \n /// Loads a next.js template, replaces `replacements` and `injections` and makes\n /// sure there are none left over.\n-pub async fn load_next_js_template(\n-    template_path: &str,\n+pub async fn load_next_js_template<'b>(\n+    template_path: &'b str,\n     project_path: FileSystemPath,\n-    replacements: &[(&str, &str)],\n-    injections: &[(&str, &str)],\n-    imports: &[(&str, Option<&str>)],\n+    replacements: impl IntoIterator<Item = (&'b str, &'b str)>,\n+    injections: impl IntoIterator<Item = (&'b str, &'b str)>,\n+    imports: impl IntoIterator<Item = (&'b str, Option<&'b str>)>,\n ) -> Result<Vc<Box<dyn Source>>> {\n     let template_path = virtual_next_js_template_path(project_path.clone(), template_path).await?;\n \n@@ -261,9 +261,9 @@ pub async fn load_next_js_template(\n         &content,\n         &template_path.path,\n         &package_root.path,\n-        replacements.iter().copied(),\n-        injections.iter().copied(),\n-        imports.iter().copied(),\n+        replacements,\n+        injections,\n+        imports,\n     )?;\n \n     let file = File::from(content);"
        },
        {
            "sha": "69a0c699b5e6e20c8aa86bf1214bfd5eb83a995b",
            "filename": "packages/next/src/build/templates/edge-ssr.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -91,7 +91,7 @@ async function requestHandler(\n   req: NextRequestHint,\n   _event: NextFetchEvent\n ): Promise<Response> {\n-  let srcPage = 'VAR_PAGE'\n+  let srcPage = 'VAR_DEFINITION_PATHNAME'\n \n   const relativeUrl = `${req.nextUrl.pathname}${req.nextUrl.search}`\n   const baseReq = new WebNextRequest(req)\n@@ -364,7 +364,7 @@ const handler: EdgeHandler = (opts) => {\n     handler: requestHandler,\n     incrementalCacheHandler,\n     bypassNextUrl: true,\n-    page: 'VAR_PAGE',\n+    page: 'VAR_DEFINITION_PATHNAME',\n   })\n }\n export default handler"
        },
        {
            "sha": "9bd4b00aec9c7644582cca02a9e370fc65f25c4e",
            "filename": "packages/next/src/build/webpack/loaders/next-edge-ssr-loader/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6ff2d98c3823974991b4f98ddc066559f1b3de44/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6ff2d98c3823974991b4f98ddc066559f1b3de44/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts?ref=6ff2d98c3823974991b4f98ddc066559f1b3de44",
            "patch": "@@ -172,7 +172,7 @@ const edgeSSRLoader: webpack.LoaderDefinitionFunction<EdgeSSRLoaderQuery> =\n         'edge-ssr',\n         {\n           VAR_USERLAND: pageModPath,\n-          VAR_PAGE: page,\n+          VAR_DEFINITION_PATHNAME: page,\n           VAR_MODULE_DOCUMENT: documentPath,\n           VAR_MODULE_APP: appPath,\n           VAR_MODULE_GLOBAL_ERROR: errorPath,"
        }
    ],
    "stats": {
        "total": 349,
        "additions": 142,
        "deletions": 207
    }
}