{
    "author": "wbinnssmith",
    "message": "Turbopack builds: Remove canary-gate and add experimental warning (#77808)",
    "sha": "2b54a007d4455c2faa5a09f320412edb8704861b",
    "files": [
        {
            "sha": "a066207a7a5e721a235e83623aa3cc1b6362a2d2",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/2b54a007d4455c2faa5a09f320412edb8704861b/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b54a007d4455c2faa5a09f320412edb8704861b/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=2b54a007d4455c2faa5a09f320412edb8704861b",
            "patch": "@@ -3709,6 +3709,10 @@ export default async function build(\n     // Ensure we wait for lockfile patching if present\n     await lockfilePatchPromise.cur\n \n+    if (isTurbopack && !process.env.__NEXT_TEST_MODE) {\n+      warnAboutTurbopackBuilds(loadedConfig)\n+    }\n+\n     // Ensure all traces are flushed before finishing the command\n     await flushAllTraces()\n     teardownTraceSubscriber()\n@@ -3725,3 +3729,25 @@ export default async function build(\n     }\n   }\n }\n+\n+function warnAboutTurbopackBuilds(config?: NextConfigComplete) {\n+  let warningStr =\n+    `Support for Turbopack builds is experimental. ` +\n+    bold(\n+      `We don't recommend deploying mission-critical applications to production.`\n+    )\n+  warningStr +=\n+    '\\n\\n- It is expected that your bundle size might be different from `next build` with webpack. This will be improved as we work towards stability.'\n+\n+  if (!config?.experimental.turbo?.unstablePersistentCaching) {\n+    warningStr +=\n+      '\\n- This build is without disk caching; subsequent builds will become faster when disk caching becomes available.'\n+  }\n+\n+  warningStr +=\n+    '\\n- When comparing output to webpack builds, make sure to first clear the Next.js cache by deleting the `.next` directory.'\n+  warningStr +=\n+    '\\n\\nProvide feedback for Turbopack builds at https://github.com/vercel/next.js/discussions/77721'\n+\n+  Log.warn(warningStr)\n+}"
        },
        {
            "sha": "e933fda67ca8e8723376540bf8b7eeacd149550d",
            "filename": "packages/next/src/build/turbopack-build/impl.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2b54a007d4455c2faa5a09f320412edb8704861b/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b54a007d4455c2faa5a09f320412edb8704861b/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts?ref=2b54a007d4455c2faa5a09f320412edb8704861b",
            "patch": "@@ -19,19 +19,12 @@ import loadConfig from '../../server/config'\n import { hasCustomExportOutput } from '../../export/utils'\n import { Telemetry } from '../../telemetry/storage'\n import { setGlobal } from '../../trace'\n-import { isStableBuild, CanaryOnlyError } from '../../shared/lib/canary-only'\n \n export async function turbopackBuild(): Promise<{\n   duration: number\n   buildTraceContext: undefined\n   shutdownPromise: Promise<void>\n }> {\n-  if (isStableBuild()) {\n-    throw new CanaryOnlyError(\n-      'Turbopack builds are only available in canary builds of Next.js.'\n-    )\n-  }\n-\n   await validateTurboNextConfig({\n     dir: NextBuildContext.dir!,\n     isDev: false,"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 26,
        "deletions": 7
    }
}