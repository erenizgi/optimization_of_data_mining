{
    "author": "devjiwonchoi",
    "message": "fix: return plain text 404 for invalid static asset paths (#75111)",
    "sha": "df71f956e54e3c215387af0ab238faebf6c81d08",
    "files": [
        {
            "sha": "da6f05a482d895f3fd0b7e3c5c5d141d0c3c1125",
            "filename": "packages/next/src/server/lib/router-server.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -587,6 +587,36 @@ export async function initialize(opts: {\n         'private, no-cache, no-store, max-age=0, must-revalidate'\n       )\n \n+      let realRequestPathname = parsedUrl.pathname ?? ''\n+      if (realRequestPathname) {\n+        if (config.basePath) {\n+          realRequestPathname = removePathPrefix(\n+            realRequestPathname,\n+            config.basePath\n+          )\n+        }\n+        if (config.assetPrefix) {\n+          realRequestPathname = removePathPrefix(\n+            realRequestPathname,\n+            config.assetPrefix\n+          )\n+        }\n+        if (config.i18n) {\n+          realRequestPathname = removePathPrefix(\n+            realRequestPathname,\n+            '/' + (getRequestMeta(req, 'locale') ?? '')\n+          )\n+        }\n+      }\n+      // For not found static assets, return plain text 404 instead of\n+      // full HTML 404 pages to save bandwidth.\n+      if (realRequestPathname.startsWith('/_next/static/')) {\n+        res.statusCode = 404\n+        res.setHeader('Content-Type', 'text/plain; charset=utf-8')\n+        res.end('Not Found')\n+        return null\n+      }\n+\n       // Short-circuit favicon.ico serving so that the 404 page doesn't get built as favicon is requested by the browser when loading any route.\n       if (opts.dev && !matchedOutput && parsedUrl.pathname === '/favicon.ico') {\n         res.statusCode = 404"
        },
        {
            "sha": "ee010875400eea84d438511a27307008eea4d866",
            "filename": "test/development/basic/allowed-dev-origins.test.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 4,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fdevelopment%2Fbasic%2Fallowed-dev-origins.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fdevelopment%2Fbasic%2Fallowed-dev-origins.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fallowed-dev-origins.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -45,13 +45,19 @@ describe.each([['', '/docs']])(\n           },\n         })\n \n+        // render 404 page to generate\n+        // \"/_next/static/chunks/pages/_app.js\"\n+        // we need this because not found static assets\n+        // served as plain text 404 instead of HTML.\n+        await next.render('/404')\n+\n         await retry(async () => {\n           // make sure host server is running\n-          const asset = await fetchViaHTTP(\n+          const res = await fetchViaHTTP(\n             next.appPort,\n             '/_next/static/chunks/pages/_app.js'\n           )\n-          expect(asset.status).toBe(200)\n+          expect(res.status).toBe(200)\n         })\n       })\n       afterAll(() => next.destroy())\n@@ -199,13 +205,19 @@ describe.each([['', '/docs']])(\n           },\n         })\n \n+        // render 404 page to generate\n+        // \"/_next/static/chunks/pages/_app.js\"\n+        // since we haven't built any paths by this point\n+        // causing this chunk to not be written to disk yet\n+        await next.render('/404')\n+\n         await retry(async () => {\n           // make sure host server is running\n-          const asset = await fetchViaHTTP(\n+          const res = await fetchViaHTTP(\n             next.appPort,\n             '/_next/static/chunks/pages/_app.js'\n           )\n-          expect(asset.status).toBe(200)\n+          expect(res.status).toBe(200)\n         })\n       })\n       afterAll(() => next.destroy())"
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/e2e/invalid-static-asset-404-app/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Flayout.tsx?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "1ad2730b10653ec3b9078678785a5c51ffe55ea9",
            "filename": "test/e2e/invalid-static-asset-404-app/app/not-found.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fnot-found.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fnot-found.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fnot-found.tsx?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,3 @@\n+export default function NotFound() {\n+  return <p>Custom Not Found</p>\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/invalid-static-asset-404-app/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Fapp%2Fpage.tsx?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "1d1498abb23c2b3f06f2f1da69cd84b61a5cea2e",
            "filename": "test/e2e/invalid-static-asset-404-app/invalid-static-asset-404-app-asset-prefix.test.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-asset-prefix.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-asset-prefix.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-asset-prefix.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,35 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-app-asset-prefix', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      assetPrefix: '/assets',\n+    },\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/assets/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/assets/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "b5f94f42ba8b2afa901d02179d69cff6b5336f32",
            "filename": "test/e2e/invalid-static-asset-404-app/invalid-static-asset-404-app-base-path.test.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-base-path.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-base-path.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app-base-path.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,35 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-app-base-path', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      basePath: '/base',\n+    },\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/base/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/base/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/base/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "25eef0d12a526d2a47157b72566b4196094f07f8",
            "filename": "test/e2e/invalid-static-asset-404-app/invalid-static-asset-404-app.test.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-app%2Finvalid-static-asset-404-app.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,32 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-app', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "f894a3ebe91dc4ca9a50f8bba6a44b4bba91d23d",
            "filename": "test/e2e/invalid-static-asset-404-pages/invalid-static-asset-404-pages-asset-prefix.test.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-asset-prefix.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-asset-prefix.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-asset-prefix.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,35 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-pages-asset-prefix', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      assetPrefix: '/assets',\n+    },\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/assets/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/assets/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "6c09f9a868a7198d3a77318d8ad0c84e9eea5499",
            "filename": "test/e2e/invalid-static-asset-404-pages/invalid-static-asset-404-pages-base-path.test.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-base-path.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-base-path.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages-base-path.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,35 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-pages-base-path', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      basePath: '/base',\n+    },\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/base/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/base/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/base/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "1c4ccd8405059687a68fac0098aa1bb4a21d20b4",
            "filename": "test/e2e/invalid-static-asset-404-pages/invalid-static-asset-404-pages.test.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-pages%2Finvalid-static-asset-404-pages.test.ts?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,32 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('invalid-static-asset-404-pages', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should return correct output with status 200 on valid asset path', async () => {\n+    const buildManifestPath = `/_next/static/${\n+      isNextDev ? 'development' : next.buildId\n+    }/_buildManifest.js`\n+\n+    const res = await next.fetch(buildManifestPath)\n+    expect(res.status).toBe(200)\n+    const text = await res.text()\n+    expect(text).toContain('__BUILD_MANIFEST')\n+  })\n+\n+  it('should return custom 404 page when fetching invalid non-asset path', async () => {\n+    const res = await next.fetch('/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toContain('Custom Not Found')\n+  })\n+\n+  it('should return 404 with plain text when fetching invalid asset path', async () => {\n+    const res = await next.fetch('/_next/static/invalid-path')\n+    expect(res.status).toBe(404)\n+    const text = await res.text()\n+    expect(text).toBe('Not Found')\n+  })\n+})"
        },
        {
            "sha": "1ad2730b10653ec3b9078678785a5c51ffe55ea9",
            "filename": "test/e2e/invalid-static-asset-404-pages/pages/404.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2F404.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2F404.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2F404.tsx?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,3 @@\n+export default function NotFound() {\n+  return <p>Custom Not Found</p>\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/invalid-static-asset-404-pages/pages/index.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finvalid-static-asset-404-pages%2Fpages%2Findex.tsx?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "694765d78671c4faea1d87589dd46dcc4f622afe",
            "filename": "test/integration/i18n-support/test/shared.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fintegration%2Fi18n-support%2Ftest%2Fshared.js",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fintegration%2Fi18n-support%2Ftest%2Fshared.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fi18n-support%2Ftest%2Fshared.js?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -78,7 +78,10 @@ export function runTests(ctx) {\n \n         if (!defaultLocales.includes(locale)) {\n           expect(res.status).toBe(404)\n-          expect(await res.text()).toContain('could not be found')\n+          expect(res.headers.get('content-type')).toBe(\n+            'text/plain; charset=utf-8'\n+          )\n+          expect(await res.text()).toBe('Not Found')\n         } else {\n           // We only 404 for non-default locale\n           expect(res.status).toBe(200)"
        },
        {
            "sha": "ffea3e802e8645a47fe9940a959c01248301d4fd",
            "filename": "test/integration/required-server-files-ssr-404/test/index.test.js",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fintegration%2Frequired-server-files-ssr-404%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/df71f956e54e3c215387af0ab238faebf6c81d08/test%2Fintegration%2Frequired-server-files-ssr-404%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Frequired-server-files-ssr-404%2Ftest%2Findex.test.js?ref=df71f956e54e3c215387af0ab238faebf6c81d08",
            "patch": "@@ -642,8 +642,6 @@ describe('Required Server Files', () => {\n \n       it('should handle 404s properly', async () => {\n         for (const pathname of [\n-          '/_next/static/chunks/pages/index-abc123.js',\n-          '/_next/static/some-file.js',\n           '/static/some-file.js',\n           '/non-existent',\n           '/404',\n@@ -657,6 +655,23 @@ describe('Required Server Files', () => {\n           expect(res.status).toBe(404)\n           expect(await res.text()).toContain('custom 404')\n         }\n+\n+        for (const pathname of [\n+          '/_next/static/chunks/pages/index-abc123.js',\n+          '/_next/static/some-file.js',\n+        ]) {\n+          const res = await fetchViaHTTP(appPort, pathname, undefined, {\n+            headers: {\n+              'x-matched-path': '/404',\n+              redirect: 'manual',\n+            },\n+          })\n+          expect(res.status).toBe(404)\n+          expect(res.headers.get('content-type')).toBe(\n+            'text/plain; charset=utf-8'\n+          )\n+          expect(await res.text()).toBe('Not Found')\n+        }\n       })\n     }\n   )"
        }
    ],
    "stats": {
        "total": 298,
        "additions": 291,
        "deletions": 7
    }
}