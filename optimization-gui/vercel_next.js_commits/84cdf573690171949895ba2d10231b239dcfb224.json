{
    "author": "devjiwonchoi",
    "message": "CI: Enable `experimental.isolatedDevBuild` for `test-unit` (#84559)\n\nEnabling `experimental.isolatedDevBuild` required many changes to the\ncurrent workflow, so we will incrementally roll out to the tests.\n\n1. ~~test-experimental-dev\n([link](https://github.com/vercel/next.js/pull/84099))~~\n2. test-dev ([link](https://github.com/vercel/next.js/pull/84562))\n2. test-prod ([link](https://github.com/vercel/next.js/pull/84556))\n3. test-integration\n([link](https://github.com/vercel/next.js/pull/84558))\n4. test-unit (here)\n5. Enable by default, remove the flag, and update the rest\n\nx-ref: https://github.com/vercel/next.js/pull/84043",
    "sha": "84cdf573690171949895ba2d10231b239dcfb224",
    "files": [
        {
            "sha": "e61138181324f9d64f3e843dbf58a4c539db2199",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/84cdf573690171949895ba2d10231b239dcfb224/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/84cdf573690171949895ba2d10231b239dcfb224/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=84cdf573690171949895ba2d10231b239dcfb224",
            "patch": "@@ -542,7 +542,9 @@ jobs:\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n       nodeVersion: ${{ matrix.node }}\n-      afterBuild: node run-tests.js --type unit\n+      afterBuild: |\n+        export __NEXT_EXPERIMENTAL_ISOLATED_DEV_BUILD=true\n+        node run-tests.js --type unit\n       stepName: 'test-unit-${{ matrix.node }}'\n \n     secrets: inherit"
        },
        {
            "sha": "0a2a7f519f3e6f490c87f01aff083d08dd359e6e",
            "filename": "test/unit/isolated/config.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/84cdf573690171949895ba2d10231b239dcfb224/test%2Funit%2Fisolated%2Fconfig.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/84cdf573690171949895ba2d10231b239dcfb224/test%2Funit%2Fisolated%2Fconfig.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Funit%2Fisolated%2Fconfig.test.ts?ref=84cdf573690171949895ba2d10231b239dcfb224",
            "patch": "@@ -38,7 +38,12 @@ describe('config', () => {\n \n   it('Should assign object defaults deeply to user config', async () => {\n     const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n-    expect(config.distDir).toEqual('.next')\n+    // In isolatedDevBuild, the default distDir is \".next/dev\" during PHASE_DEVELOPMENT_SERVER.\n+    if (process.env.__NEXT_EXPERIMENTAL_ISOLATED_DEV_BUILD === 'true') {\n+      expect(config.distDir).toEqual('.next/dev')\n+    } else {\n+      expect(config.distDir).toEqual('.next')\n+    }\n     expect(config.onDemandEntries.maxInactiveAge).toBeDefined()\n   })\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 9,
        "deletions": 2
    }
}