{
    "author": "bgw",
    "message": "fix(turbopack-cli): Make turbopack_cli::dev::source a persistent (non-transient) task (#77798)\n\nThis was identified using the extra checks in #77760 and debugged using the tracing in #77798.\n\n![Screenshot 2025-04-03 at 1.30.53â€¯PM.png](https://graphite-user-uploaded-assets-prod.s3.amazonaws.com/HAZVitxRNnZz8QMiPn4a/a576884b-f8ab-4266-b9df-916e9733bc85.png)",
    "sha": "2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39",
    "files": [
        {
            "sha": "eab945c78aa0111eb13c0a37f19f86bf0ec75fed",
            "filename": "turbopack/crates/turbo-tasks/src/task/task_input.rs",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs?ref=2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39",
            "patch": "@@ -1,4 +1,4 @@\n-use std::{any::Any, fmt::Debug, future::Future, hash::Hash, time::Duration};\n+use std::{any::Any, fmt::Debug, future::Future, hash::Hash, sync::Arc, time::Duration};\n \n use anyhow::Result;\n use either::Either;\n@@ -89,6 +89,23 @@ where\n     }\n }\n \n+impl<T> TaskInput for Arc<T>\n+where\n+    T: TaskInput,\n+{\n+    fn is_resolved(&self) -> bool {\n+        self.as_ref().is_resolved()\n+    }\n+\n+    fn is_transient(&self) -> bool {\n+        self.as_ref().is_transient()\n+    }\n+\n+    async fn resolve_input(&self) -> Result<Self> {\n+        Ok(Arc::new(Box::pin(self.as_ref().resolve_input()).await?))\n+    }\n+}\n+\n impl<T> TaskInput for Option<T>\n where\n     T: TaskInput,"
        },
        {
            "sha": "9f5e9ab31bb3d0aba81060c3166d215a3a0e2856",
            "filename": "turbopack/crates/turbopack-cli/src/dev/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs?ref=2270c2d169ee0f408d7b5c4a1e26ed8c430a1e39",
            "patch": "@@ -209,7 +209,7 @@ impl TurbopackDevServerBuilder {\n             log_detail,\n             log_level: self.log_level,\n         });\n-        let entry_requests = TransientInstance::new(self.entry_requests);\n+        let entry_requests = Arc::new(self.entry_requests);\n         let tasks = turbo_tasks.clone();\n         let issue_provider = self.issue_reporter.unwrap_or_else(|| {\n             // Initialize a ConsoleUi reporter if no custom reporter was provided\n@@ -220,7 +220,7 @@ impl TurbopackDevServerBuilder {\n         struct ServerSourceProvider {\n             root_dir: RcStr,\n             project_dir: RcStr,\n-            entry_requests: TransientInstance<Vec<EntryRequest>>,\n+            entry_requests: Arc<Vec<EntryRequest>>,\n             eager_compile: bool,\n             browserslist_query: RcStr,\n         }\n@@ -252,7 +252,7 @@ impl TurbopackDevServerBuilder {\n async fn source(\n     root_dir: RcStr,\n     project_dir: RcStr,\n-    entry_requests: TransientInstance<Vec<EntryRequest>>,\n+    entry_requests: Arc<Vec<EntryRequest>>,\n     eager_compile: bool,\n     browserslist_query: RcStr,\n ) -> Result<Vc<Box<dyn ContentSource>>> {"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 21,
        "deletions": 4
    }
}