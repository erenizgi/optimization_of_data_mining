{
    "author": "wbinnssmith",
    "message": "turbo-tasks: Encode location information into panics (#78945)\n\nReplaces #78796\r\n\r\nThis is the basis of the Rust side of things to report location information with panics.\r\n\r\nTo do:\r\n\r\n- [x] Automated test\r\n\r\n\r\nCloses PACK-4546",
    "sha": "ffea3e9366eda5727623798012d1ae78ad3e7391",
    "files": [
        {
            "sha": "240fe9077c1b7dfb81d4698cf508635bb533c5da",
            "filename": "crates/napi/src/lib.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/crates%2Fnapi%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/crates%2Fnapi%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Flib.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -68,11 +68,19 @@ static ALLOC: dhat::Alloc = dhat::Alloc;\n \n #[cfg(not(target_arch = \"wasm32\"))]\n #[napi::module_init]\n-\n fn init() {\n+    use std::panic::{set_hook, take_hook};\n+\n     use tokio::runtime::Builder;\n+    use turbo_tasks::handle_panic;\n     use turbo_tasks_malloc::TurboMalloc;\n \n+    let prev_hook = take_hook();\n+    set_hook(Box::new(move |info| {\n+        handle_panic(info);\n+        prev_hook(info);\n+    }));\n+\n     let rt = Builder::new_multi_thread()\n         .enable_all()\n         .on_thread_stop(|| {"
        },
        {
            "sha": "33a2e75d4ac8d75ea277f6ba7622b4b869bcc240",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -28,7 +28,7 @@ use turbo_tasks::{\n     SessionId, TRANSIENT_TASK_BIT, TaskId, TraitTypeId, TurboTasksBackendApi, ValueTypeId,\n     backend::{\n         Backend, BackendJobId, CachedTaskType, CellContent, TaskExecutionSpec, TransientTaskRoot,\n-        TransientTaskType, TypedCellContent,\n+        TransientTaskType, TurboTasksExecutionError, TypedCellContent,\n     },\n     event::{Event, EventListener},\n     registry::{self, get_value_type_global_name},\n@@ -553,9 +553,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             let result = match output {\n                 OutputValue::Cell(cell) => Some(Ok(Ok(RawVc::TaskCell(cell.task, cell.cell)))),\n                 OutputValue::Output(task) => Some(Ok(Ok(RawVc::TaskOutput(*task)))),\n-                OutputValue::Error | OutputValue::Panic => {\n-                    get!(task, Error).map(|error| Err(error.clone().into()))\n-                }\n+                OutputValue::Error => get!(task, Error).map(|error| Err(error.clone().into())),\n             };\n             if let Some(result) = result {\n                 if self.should_track_dependencies() {\n@@ -1406,7 +1404,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n     fn task_execution_result(\n         &self,\n         task_id: TaskId,\n-        result: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        result: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         turbo_tasks: &dyn TurboTasksBackendApi<TurboTasksBackend<B>>,\n     ) {\n         operation::UpdateOutputOperation::run(task_id, result, self.execute_context(turbo_tasks));\n@@ -2338,7 +2336,7 @@ impl<B: BackingStorage> Backend for TurboTasksBackend<B> {\n     fn task_execution_result(\n         &self,\n         task_id: TaskId,\n-        result: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        result: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         turbo_tasks: &dyn TurboTasksBackendApi<Self>,\n     ) {\n         self.0.task_execution_result(task_id, result, turbo_tasks);"
        },
        {
            "sha": "92fe8b62211d60eba6a99bc995501731cd6ff809",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/update_output.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 19,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,8 +1,8 @@\n-use std::{borrow::Cow, mem::take};\n+use std::{mem::take, sync::Arc};\n \n-use anyhow::{Result, anyhow};\n+use anyhow::Result;\n use serde::{Deserialize, Serialize};\n-use turbo_tasks::{RawVc, TaskId, util::SharedError};\n+use turbo_tasks::{RawVc, TaskId, backend::TurboTasksExecutionError, util::SharedError};\n \n #[cfg(feature = \"trace_task_dirty\")]\n use crate::backend::operation::invalidate::TaskDirtyCause;\n@@ -44,7 +44,7 @@ pub enum UpdateOutputOperation {\n impl UpdateOutputOperation {\n     pub fn run(\n         task_id: TaskId,\n-        output: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        output: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         mut ctx: impl ExecuteContext,\n     ) {\n         let mut task = ctx.task(task_id, TaskDataCategory::All);\n@@ -69,15 +69,15 @@ impl UpdateOutputOperation {\n         let old_error = task.remove(&CachedDataItemKey::Error {});\n         let current_output = get!(task, Output);\n         let output_value = match output {\n-            Ok(Ok(RawVc::TaskOutput(output_task_id))) => {\n+            Ok(RawVc::TaskOutput(output_task_id)) => {\n                 if let Some(OutputValue::Output(current_task_id)) = current_output {\n                     if *current_task_id == output_task_id {\n                         return;\n                     }\n                 }\n                 OutputValue::Output(output_task_id)\n             }\n-            Ok(Ok(RawVc::TaskCell(output_task_id, cell))) => {\n+            Ok(RawVc::TaskCell(output_task_id, cell)) => {\n                 if let Some(OutputValue::Cell(CellRef {\n                     task: current_task_id,\n                     cell: current_cell,\n@@ -92,28 +92,18 @@ impl UpdateOutputOperation {\n                     cell,\n                 })\n             }\n-            Ok(Ok(RawVc::LocalOutput(..))) => {\n+            Ok(RawVc::LocalOutput(..)) => {\n                 panic!(\"Non-local tasks must not return a local Vc\");\n             }\n-            Ok(Err(err)) => {\n+            Err(err) => {\n                 task.insert(CachedDataItem::Error {\n-                    value: SharedError::new(err.context(format!(\n+                    value: SharedError::new(anyhow::Error::new(err).context(format!(\n                         \"Execution of {} failed\",\n                         ctx.get_task_description(task_id)\n                     ))),\n                 });\n                 OutputValue::Error\n             }\n-            Err(panic) => {\n-                task.insert(CachedDataItem::Error {\n-                    value: SharedError::new(anyhow!(\n-                        \"Panic in {}: {:?}\",\n-                        ctx.get_task_description(task_id),\n-                        panic\n-                    )),\n-                });\n-                OutputValue::Panic\n-            }\n         };\n         let old_content = task.insert(CachedDataItem::Output {\n             value: output_value,"
        },
        {
            "sha": "7c6e40426484da2d3caf09ab48b63e48cac3a8ff",
            "filename": "turbopack/crates/turbo-tasks-backend/src/data.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -57,15 +57,13 @@ pub enum OutputValue {\n     Cell(CellRef),\n     Output(TaskId),\n     Error,\n-    Panic,\n }\n impl OutputValue {\n     fn is_transient(&self) -> bool {\n         match self {\n             OutputValue::Cell(cell) => cell.task.is_transient(),\n             OutputValue::Output(task) => task.is_transient(),\n             OutputValue::Error => false,\n-            OutputValue::Panic => false,\n         }\n     }\n }"
        },
        {
            "sha": "3b934eecd59a3827105b200b7469e68e6bded6a4",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/panics.rs",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -0,0 +1,49 @@\n+use core::panic;\n+use std::{\n+    panic::{set_hook, take_hook},\n+    sync::{Arc, LazyLock},\n+};\n+\n+use anyhow::Result;\n+use regex::Regex;\n+use turbo_tasks::{Vc, backend::TurboTasksExecutionError, handle_panic};\n+use turbo_tasks_testing::{Registration, register, run_without_cache_check};\n+\n+static REGISTRATION: Registration = register!();\n+\n+static FILE_PATH_REGEX: LazyLock<Regex> =\n+    LazyLock::new(|| Regex::new(r\"panics\\.rs:\\d+:\\d+$\").unwrap());\n+\n+#[tokio::test]\n+async fn test_panics_include_location() {\n+    let prev_hook = take_hook();\n+    set_hook(Box::new(move |info| {\n+        handle_panic(info);\n+        prev_hook(info);\n+    }));\n+\n+    let result =\n+        run_without_cache_check(&REGISTRATION, async move { anyhow::Ok(*double(3).await?) }).await;\n+\n+    let error = result.unwrap_err();\n+    let root_cause = error.root_cause();\n+\n+    let Some(panic) = root_cause.downcast_ref::<Arc<TurboTasksExecutionError>>() else {\n+        panic!(\"Expected a TurboTasksExecutionError\");\n+    };\n+\n+    let TurboTasksExecutionError::Panic(panic) = &**panic else {\n+        panic!(\"Expected a TurboTasksExecutionError::Panic\");\n+    };\n+\n+    assert!(\n+        FILE_PATH_REGEX.is_match(panic.location.as_ref().unwrap()),\n+        \"Panic location '{}' should be a line in panics.rs\",\n+        panic.location.as_ref().unwrap()\n+    );\n+}\n+\n+#[turbo_tasks::function]\n+fn double(_val: u64) -> Result<Vc<u64>> {\n+    panic!(\"oh no\");\n+}"
        },
        {
            "sha": "74c21fcaebb65996f5b37a03831eca2abc5277b5",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/trace_transient.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -32,12 +32,9 @@ async fn test_trace_transient() {\n         anyhow::Ok(())\n     })\n     .await;\n-    assert!(\n-        result\n-            .unwrap_err()\n-            .to_string()\n-            .contains(&EXPECTED_TRACE.escape_debug().to_string())\n-    );\n+\n+    let message = format!(\"{:#}\", result.unwrap_err());\n+    assert!(message.contains(&EXPECTED_TRACE.to_string()));\n }\n \n #[turbo_tasks::value]"
        },
        {
            "sha": "eabd5541065037a3c38c5d72bd087be0e78a35b7",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/transient_collectible.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -19,12 +19,9 @@ async fn test_transient_emit_from_persistent() {\n         anyhow::Ok(())\n     })\n     .await;\n-    assert!(\n-        result\n-            .unwrap_err()\n-            .to_string()\n-            .contains(&EXPECTED_MSG.escape_debug().to_string())\n-    );\n+\n+    let message = format!(\"{:#}\", result.unwrap_err());\n+    assert!(message.contains(&EXPECTED_MSG.to_string()));\n }\n \n #[turbo_tasks::function(operation)]"
        },
        {
            "sha": "4fcd2d6ce47b51093f71c55e023fb746f20bdd3c",
            "filename": "turbopack/crates/turbo-tasks-memory/src/memory_backend.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,5 +1,5 @@\n use std::{\n-    borrow::{Borrow, Cow},\n+    borrow::Borrow,\n     future::Future,\n     hash::{BuildHasher, BuildHasherDefault, Hash},\n     num::NonZeroU32,\n@@ -22,7 +22,7 @@ use turbo_tasks::{\n     TaskIdSet, TraitTypeId, TurboTasksBackendApi, Unused, ValueTypeId,\n     backend::{\n         Backend, BackendJobId, CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec,\n-        TransientTaskType, TypedCellContent,\n+        TransientTaskType, TurboTasksExecutionError, TypedCellContent,\n     },\n     event::EventListener,\n     task_statistics::TaskStatisticsApi,\n@@ -415,12 +415,12 @@ impl Backend for MemoryBackend {\n     fn task_execution_result(\n         &self,\n         task_id: TaskId,\n-        result: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        result: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         turbo_tasks: &dyn TurboTasksBackendApi<MemoryBackend>,\n     ) {\n         self.with_task(task_id, |task| {\n             #[cfg(debug_assertions)]\n-            if let Ok(Ok(RawVc::TaskOutput(result))) = result.as_ref() {\n+            if let Ok(RawVc::TaskOutput(result)) = result.as_ref() {\n                 if *result == task_id {\n                     panic!(\"Task {} returned itself as output\", task.get_description());\n                 }"
        },
        {
            "sha": "94d2fa14ea8ffa271ead2b91686520cdecc200a3",
            "filename": "turbopack/crates/turbo-tasks-memory/src/output.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 13,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,4 +1,4 @@\n-use std::{borrow::Cow, fmt::Debug, mem::take};\n+use std::{fmt::Debug, mem::take};\n \n use anyhow::{Error, Result, anyhow};\n use turbo_tasks::{\n@@ -51,18 +51,6 @@ impl Output {\n         }\n     }\n \n-    pub fn panic(\n-        &mut self,\n-        message: Option<Cow<'static, str>>,\n-        turbo_tasks: &dyn TurboTasksBackendApi<MemoryBackend>,\n-    ) {\n-        self.content = Some(OutputContent::Panic(message.map(Box::new)));\n-        // notify\n-        if !self.dependent_tasks.is_empty() {\n-            turbo_tasks.schedule_notify_tasks_set(&take(&mut self.dependent_tasks));\n-        }\n-    }\n-\n     pub fn gc_drop(self, turbo_tasks: &dyn TurboTasksBackendApi<MemoryBackend>) {\n         // notify\n         if !self.dependent_tasks.is_empty() {"
        },
        {
            "sha": "8a861c3d5ce8f718601bac64a988e8e89f810f96",
            "filename": "turbopack/crates/turbo-tasks-memory/src/task.rs",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,5 +1,4 @@\n use std::{\n-    borrow::Cow,\n     fmt::{self, Debug, Display, Formatter},\n     future::Future,\n     hash::{BuildHasherDefault, Hash},\n@@ -21,7 +20,10 @@ use turbo_prehash::PreHashed;\n use turbo_tasks::{\n     CellId, Invalidator, RawVc, ReadConsistency, TaskId, TaskIdSet, TraitTypeId,\n     TurboTasksBackendApi, TurboTasksBackendApiExt, ValueTypeId,\n-    backend::{CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec},\n+    backend::{\n+        CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec,\n+        TurboTasksExecutionError,\n+    },\n     event::{Event, EventListener},\n     get_invalidator, registry,\n };\n@@ -837,7 +839,7 @@ impl Task {\n \n     pub(crate) fn execution_result(\n         &self,\n-        result: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        result: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         backend: &MemoryBackend,\n         turbo_tasks: &dyn TurboTasksBackendApi<MemoryBackend>,\n     ) {\n@@ -849,7 +851,7 @@ impl Task {\n                 // TODO maybe this should be controlled by a heuristic\n             }\n             InProgress(..) => match result {\n-                Ok(Ok(result)) => {\n+                Ok(result) => {\n                     if state.output != result {\n                         if backend.print_task_invalidation && state.output.content.is_some() {\n                             println!(\n@@ -865,13 +867,17 @@ impl Task {\n                         state.output.link(result, turbo_tasks)\n                     }\n                 }\n-                Ok(Err(mut err)) => {\n-                    if let Some(name) = self.get_function_name() {\n-                        err = err.context(format!(\"Execution of {name} failed\"));\n-                    }\n+                Err(err) => {\n+                    let err = anyhow::Error::new(err).context(\n+                        if let Some(name) = self.get_function_name() {\n+                            format!(\"Execution of {name} failed\")\n+                        } else {\n+                            \"Execution failed\".to_string()\n+                        },\n+                    );\n+\n                     state.output.error(err, turbo_tasks)\n                 }\n-                Err(message) => state.output.panic(message, turbo_tasks),\n             },\n \n             Dirty { .. } | Scheduled { .. } | Done { .. } => {"
        },
        {
            "sha": "dbe2d8ab0711f0e86bdf820a12bfcb3354cd58b2",
            "filename": "turbopack/crates/turbo-tasks/src/backend.rs",
            "status": "modified",
            "additions": 79,
            "deletions": 4,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,9 +1,10 @@\n use std::{\n-    borrow::Cow,\n+    error::Error,\n     fmt::{self, Debug, Display},\n     future::Future,\n     hash::{BuildHasherDefault, Hash},\n     pin::Pin,\n+    sync::Arc,\n     time::Duration,\n };\n \n@@ -15,7 +16,7 @@ use tracing::Span;\n pub use crate::id::BackendJobId;\n use crate::{\n     FunctionId, RawVc, ReadCellOptions, ReadRef, SharedReference, TaskId, TaskIdSet, TraitRef,\n-    TraitTypeId, ValueTypeId, VcRead, VcValueTrait, VcValueType,\n+    TraitTypeId, TurboTasksPanic, ValueTypeId, VcRead, VcValueTrait, VcValueType,\n     event::EventListener,\n     magic_any::MagicAny,\n     manager::{ReadConsistency, TurboTasksBackendApi},\n@@ -398,6 +399,80 @@ impl TryFrom<CellContent> for SharedReference {\n \n pub type TaskCollectiblesMap = AutoMap<RawVc, i32, BuildHasherDefault<FxHasher>, 1>;\n \n+// Structurally and functionally similar to Cow<&'static, str> but explicitly notes the importance\n+// of non-static strings potentially containing PII.\n+#[derive(Clone, Debug)]\n+pub enum TurboTasksExecutionErrorMessage {\n+    PIISafe(&'static str),\n+    NonPIISafe(String),\n+}\n+\n+impl Display for TurboTasksExecutionErrorMessage {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        match self {\n+            TurboTasksExecutionErrorMessage::PIISafe(msg) => write!(f, \"{msg}\"),\n+            TurboTasksExecutionErrorMessage::NonPIISafe(msg) => write!(f, \"{msg}\"),\n+        }\n+    }\n+}\n+\n+#[derive(Clone, Debug)]\n+pub enum TurboTasksExecutionError {\n+    Panic(Arc<TurboTasksPanic>),\n+    Error {\n+        message: TurboTasksExecutionErrorMessage,\n+        source: Option<Arc<TurboTasksExecutionError>>,\n+    },\n+}\n+\n+impl Error for TurboTasksExecutionError {\n+    fn source(&self) -> Option<&(dyn Error + 'static)> {\n+        match self {\n+            TurboTasksExecutionError::Panic(_panic) => None,\n+            TurboTasksExecutionError::Error { source, .. } => {\n+                source.as_ref().map(|s| s as &dyn Error)\n+            }\n+        }\n+    }\n+}\n+\n+impl Display for TurboTasksExecutionError {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        match self {\n+            TurboTasksExecutionError::Panic(panic) => write!(f, \"{}\", &panic),\n+            TurboTasksExecutionError::Error { message, .. } => {\n+                write!(f, \"{message}\")\n+            }\n+        }\n+    }\n+}\n+\n+impl From<anyhow::Error> for TurboTasksExecutionError {\n+    fn from(err: anyhow::Error) -> Self {\n+        let mut current: &dyn std::error::Error = err.as_ref();\n+        let mut message = current.to_string();\n+        let mut source_exec_error = None;\n+\n+        // Flatten non-TurboTasksExecutionErrors in the error chain into a single message.\n+        // Once a TurboTasksExecutionError is found, use that as the source.\n+        while let Some(current_source) = current.source() {\n+            if let Some(turbo_error) =\n+                current_source.downcast_ref::<Arc<TurboTasksExecutionError>>()\n+            {\n+                source_exec_error = Some(turbo_error.clone());\n+                break;\n+            }\n+            message.push_str(&format!(\"\\n{current_source}\"));\n+            current = current_source;\n+        }\n+\n+        TurboTasksExecutionError::Error {\n+            message: TurboTasksExecutionErrorMessage::NonPIISafe(message),\n+            source: source_exec_error,\n+        }\n+    }\n+}\n+\n pub trait Backend: Sync + Send {\n     #[allow(unused_variables)]\n     fn startup(&self, turbo_tasks: &dyn TurboTasksBackendApi<Self>) {}\n@@ -459,8 +534,8 @@ pub trait Backend: Sync + Send {\n \n     fn task_execution_result(\n         &self,\n-        task: TaskId,\n-        result: Result<Result<RawVc>, Option<Cow<'static, str>>>,\n+        task_id: TaskId,\n+        result: Result<RawVc, Arc<TurboTasksExecutionError>>,\n         turbo_tasks: &dyn TurboTasksBackendApi<Self>,\n     );\n "
        },
        {
            "sha": "e4996d791584530f63fa05922ce774cd5041e263",
            "filename": "turbopack/crates/turbo-tasks/src/capture_future.rs",
            "status": "modified",
            "additions": 49,
            "deletions": 5,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcapture_future.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcapture_future.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcapture_future.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,14 +1,19 @@\n use std::{\n     cell::RefCell,\n+    fmt::Display,\n     future::Future,\n+    panic,\n     pin::Pin,\n     task::{Context, Poll},\n     time::{Duration, Instant},\n };\n \n+use anyhow::Result;\n use pin_project_lite::pin_project;\n use turbo_tasks_malloc::{AllocationInfo, TurboMalloc};\n \n+use crate::{LAST_ERROR_LOCATION, backend::TurboTasksExecutionErrorMessage};\n+\n struct ThreadLocalData {\n     duration: Duration,\n     allocations: usize,\n@@ -64,8 +69,20 @@ pub fn add_allocation_info(alloc_info: AllocationInfo) {\n     });\n }\n \n+#[derive(Debug, Clone)]\n+pub struct TurboTasksPanic {\n+    pub message: TurboTasksExecutionErrorMessage,\n+    pub location: Option<String>,\n+}\n+\n+impl Display for TurboTasksPanic {\n+    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n+        write!(f, \"{}\", self.message)\n+    }\n+}\n+\n impl<T, F: Future<Output = T>> Future for CaptureFuture<T, F> {\n-    type Output = (T, Duration, usize);\n+    type Output = (Result<T, TurboTasksPanic>, Duration, usize);\n \n     fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {\n         let this = self.project();\n@@ -80,19 +97,46 @@ impl<T, F: Future<Output = T>> Future for CaptureFuture<T, F> {\n         EXTRA.with_borrow_mut(|cell| {\n             *cell = Some(&mut data as *mut ThreadLocalData);\n         });\n-        let result = this.future.poll(cx);\n+\n+        let result =\n+            panic::catch_unwind(panic::AssertUnwindSafe(|| this.future.poll(cx))).map_err(|err| {\n+                let message = match err.downcast_ref::<&'static str>() {\n+                    Some(s) => TurboTasksExecutionErrorMessage::PIISafe(s),\n+                    None => match err.downcast_ref::<String>() {\n+                        Some(s) => TurboTasksExecutionErrorMessage::NonPIISafe(s.clone()),\n+                        None => {\n+                            let error_message = err\n+                                .downcast_ref::<Box<dyn Display>>()\n+                                .map(|e| e.to_string())\n+                                .unwrap_or_else(|| String::from(\"<unknown panic>\"));\n+\n+                            TurboTasksExecutionErrorMessage::NonPIISafe(error_message)\n+                        }\n+                    },\n+                };\n+\n+                LAST_ERROR_LOCATION.with_borrow(|loc| TurboTasksPanic {\n+                    message,\n+                    location: loc.clone(),\n+                })\n+            });\n+\n         drop(guard);\n         let elapsed = start.elapsed();\n         let allocations = start_allocations.until_now();\n         *this.duration += elapsed + data.duration;\n         *this.allocations += allocations.allocations + data.allocations;\n         *this.deallocations += allocations.deallocations + data.deallocations;\n         match result {\n-            Poll::Ready(r) => {\n+            Err(err) => {\n+                let memory_usage = this.allocations.saturating_sub(*this.deallocations);\n+                Poll::Ready((Err(err), *this.duration, memory_usage))\n+            }\n+            Ok(Poll::Ready(r)) => {\n                 let memory_usage = this.allocations.saturating_sub(*this.deallocations);\n-                Poll::Ready((r, *this.duration, memory_usage))\n+                Poll::Ready((Ok(r), *this.duration, memory_usage))\n             }\n-            Poll::Pending => Poll::Pending,\n+            Ok(Poll::Pending) => Poll::Pending,\n         }\n     }\n }"
        },
        {
            "sha": "95b09b3c72947b94fcd9f8ec84cb816cccb4f011",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -28,6 +28,7 @@\n \n #![feature(trivial_bounds)]\n #![feature(min_specialization)]\n+#![feature(thread_local)]\n #![feature(try_trait_v2)]\n #![deny(unsafe_op_in_unsafe_fn)]\n #![feature(result_flattening)]\n@@ -83,10 +84,11 @@ mod value;\n mod value_type;\n mod vc;\n \n-use std::hash::BuildHasherDefault;\n+use std::{cell::RefCell, hash::BuildHasherDefault, panic};\n \n pub use anyhow::{Error, Result};\n use auto_hash_map::AutoSet;\n+pub use capture_future::TurboTasksPanic;\n pub use collectibles::CollectiblesSource;\n pub use completion::{Completion, Completions};\n pub use display::ValueToString;\n@@ -304,6 +306,19 @@ pub mod test_helpers {\n     pub use super::manager::{current_task_for_testing, with_turbo_tasks_for_testing};\n }\n \n+thread_local! {\n+    /// The location of the last error that occurred in the current thread.\n+    ///\n+    /// Used for debugging when errors are sent to telemetry\n+    pub(crate) static LAST_ERROR_LOCATION: RefCell<Option<String>> = const { RefCell::new(None) };\n+}\n+\n+pub fn handle_panic(info: &panic::PanicHookInfo<'_>) {\n+    LAST_ERROR_LOCATION.with_borrow_mut(|loc| {\n+        *loc = info.location().map(|l| l.to_string());\n+    });\n+}\n+\n pub fn register() {\n     include!(concat!(env!(\"OUT_DIR\"), \"/register.rs\"));\n }"
        },
        {
            "sha": "b859a95130dd1bee3c2832c268ae56ee780ee4d7",
            "filename": "turbopack/crates/turbo-tasks/src/manager.rs",
            "status": "modified",
            "additions": 32,
            "deletions": 26,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -4,7 +4,6 @@ use std::{\n     future::Future,\n     hash::BuildHasherDefault,\n     mem::take,\n-    panic::AssertUnwindSafe,\n     pin::Pin,\n     sync::{\n         Arc, Mutex, RwLock, Weak,\n@@ -16,7 +15,6 @@ use std::{\n \n use anyhow::{Result, anyhow};\n use auto_hash_map::AutoMap;\n-use futures::FutureExt;\n use rustc_hash::FxHasher;\n use serde::{Deserialize, Serialize};\n use tokio::{runtime::Handle, select, task_local};\n@@ -30,7 +28,7 @@ use crate::{\n     VcValueType,\n     backend::{\n         Backend, CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec,\n-        TransientTaskType, TypedCellContent,\n+        TransientTaskType, TurboTasksExecutionError, TypedCellContent,\n     },\n     capture_future::{self, CaptureFuture},\n     event::{Event, EventListener},\n@@ -44,7 +42,7 @@ use crate::{\n     task_statistics::TaskStatisticsApi,\n     trace::TraceRawVcs,\n     trait_helpers::get_trait_method,\n-    util::{IdFactory, StaticOrArc},\n+    util::{IdFactory, SharedError, StaticOrArc},\n     vc::ReadVcFuture,\n };\n \n@@ -694,22 +692,22 @@ impl<B: Backend + 'static> TurboTasks<B> {\n                     };\n \n                     async {\n-                        let (result, duration, memory_usage) =\n-                            CaptureFuture::new(AssertUnwindSafe(future).catch_unwind()).await;\n+                        let (result, duration, memory_usage) = CaptureFuture::new(future).await;\n \n                         // wait for all spawned local tasks using `local` to finish\n                         let ltt = CURRENT_TASK_STATE\n                             .with(|ts| ts.read().unwrap().local_task_tracker.clone());\n                         ltt.close();\n                         ltt.wait().await;\n \n-                        let result = result.map_err(|any| match any.downcast::<String>() {\n-                            Ok(owned) => Some(Cow::Owned(*owned)),\n-                            Err(any) => match any.downcast::<&'static str>() {\n-                                Ok(str) => Some(Cow::Borrowed(*str)),\n-                                Err(_) => None,\n-                            },\n-                        });\n+                        let result = match result {\n+                            Ok(Ok(raw_vc)) => Ok(raw_vc),\n+                            Ok(Err(err)) => Err(Arc::new(err.into())),\n+                            Err(err) => {\n+                                Err(Arc::new(TurboTasksExecutionError::Panic(Arc::new(err))))\n+                            }\n+                        };\n+\n                         this.backend.task_execution_result(task_id, result, &*this);\n                         let stateful = this.finish_current_task_state();\n                         let cell_counters = CURRENT_TASK_STATE\n@@ -794,22 +792,30 @@ impl<B: Backend + 'static> TurboTasks<B> {\n         let future = async move {\n             let TaskExecutionSpec { future, span } =\n                 crate::task::local_task::get_local_task_execution_spec(&*this, &ty, persistence);\n+            let ty = ty.clone();\n             async move {\n-                let (result, _duration, _memory_usage) =\n-                    CaptureFuture::new(AssertUnwindSafe(future).catch_unwind()).await;\n-\n-                let result = result.map_err(|any| match any.downcast::<String>() {\n-                    Ok(owned) => Some(Cow::Owned(*owned)),\n-                    Err(any) => match any.downcast::<&'static str>() {\n-                        Ok(str) => Some(Cow::Borrowed(*str)),\n-                        Err(_) => None,\n-                    },\n-                });\n+                let (result, _duration, _memory_usage) = CaptureFuture::new(future).await;\n+\n+                let result = match result {\n+                    Ok(Ok(raw_vc)) => Ok(raw_vc),\n+                    Ok(Err(err)) => Err(Arc::new(err.into())),\n+                    Err(err) => Err(Arc::new(TurboTasksExecutionError::Panic(Arc::new(err)))),\n+                };\n+\n                 let local_task = LocalTask::Done {\n                     output: match result {\n-                        Ok(Ok(raw_vc)) => OutputContent::Link(raw_vc),\n-                        Ok(Err(err)) => OutputContent::Error(err.into()),\n-                        Err(panic_err) => OutputContent::Panic(panic_err.map(Box::new)),\n+                        Ok(raw_vc) => OutputContent::Link(raw_vc),\n+                        Err(err) => match &*err {\n+                            TurboTasksExecutionError::Error { .. } => {\n+                                OutputContent::Error(SharedError::new(\n+                                    anyhow::Error::new(err)\n+                                        .context(format!(\"Execution of {ty} failed\")),\n+                                ))\n+                            }\n+                            TurboTasksExecutionError::Panic(err) => {\n+                                OutputContent::Panic(err.clone())\n+                            }\n+                        },\n                     },\n                 };\n "
        },
        {
            "sha": "cf32adfa56cecacf710cbc856155fafa2132917a",
            "filename": "turbopack/crates/turbo-tasks/src/output.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Foutput.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Foutput.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Foutput.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -1,27 +1,26 @@\n use std::{\n-    borrow::Cow,\n     fmt::{self, Display},\n+    sync::Arc,\n };\n \n use anyhow::anyhow;\n \n-use crate::{RawVc, util::SharedError};\n+use crate::{RawVc, TurboTasksPanic, util::SharedError};\n \n /// A helper type representing the output of a resolved task.\n #[derive(Clone, Debug)]\n pub enum OutputContent {\n     Link(RawVc),\n     Error(SharedError),\n-    Panic(Option<Box<Cow<'static, str>>>),\n+    Panic(Arc<TurboTasksPanic>),\n }\n \n impl OutputContent {\n     pub fn as_read_result(&self) -> anyhow::Result<RawVc> {\n         match &self {\n-            Self::Error(err) => Err(anyhow::Error::new(err.clone())),\n+            Self::Error(err) => Err(anyhow!(err.clone())),\n             Self::Link(raw_vc) => Ok(*raw_vc),\n-            Self::Panic(Some(message)) => Err(anyhow!(\"A task panicked: {message}\")),\n-            Self::Panic(None) => Err(anyhow!(\"A task panicked\")),\n+            Self::Panic(err) => Err(anyhow!(err.clone())),\n         }\n     }\n }\n@@ -31,8 +30,7 @@ impl Display for OutputContent {\n         match self {\n             Self::Link(raw_vc) => write!(f, \"link {raw_vc:?}\"),\n             Self::Error(err) => write!(f, \"error {err}\"),\n-            Self::Panic(Some(message)) => write!(f, \"panic {message}\"),\n-            Self::Panic(None) => write!(f, \"panic\"),\n+            Self::Panic(err) => write!(f, \"panic {err}\"),\n         }\n     }\n }"
        },
        {
            "sha": "92c5ec71faf602ca73c67f1ea166773fe9fd4ddd",
            "filename": "turbopack/crates/turbo-tasks/src/util.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Futil.rs?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -23,11 +23,11 @@ pub use super::{\n /// A error struct that is backed by an Arc to allow cloning errors\n #[derive(Debug, Clone)]\n pub struct SharedError {\n-    inner: Arc<Error>,\n+    inner: Arc<anyhow::Error>,\n }\n \n impl SharedError {\n-    pub fn new(err: Error) -> Self {\n+    pub fn new(err: anyhow::Error) -> Self {\n         Self {\n             inner: Arc::new(err),\n         }"
        },
        {
            "sha": "0a90933ef22adaef7f091fd2007e5c05a0d444fc",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/json/issues/Code generation for chunk item errored-2c5cf4.txt",
            "status": "renamed",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-2c5cf4.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-2c5cf4.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-2c5cf4.txt?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -6,6 +6,7 @@ error - [code gen] [project]/turbopack/crates/turbopack-tests/tests/snapshot/imp\n   \n   Debug info:\n   - An error occurred while generating the chunk item [project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\n+  - Execution of *EcmascriptChunkItemContent::module_factory failed\n   - Execution of <JsonChunkItem as EcmascriptChunkItem>::content failed\n   - Unable to make a module from invalid JSON: expected `,` or `}` at line 3 column 26\n       at nested.?",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/json/issues/Code generation for chunk item errored-1c3f39.txt"
        },
        {
            "sha": "90a8810c3663054cb08c40250aec9ed59d4c4985",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/json/output/turbopack_crates_turbopack-tests_tests_snapshot_imports_json_input_52abdb3f._.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_imports_json_input_52abdb3f._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ffea3e9366eda5727623798012d1ae78ad3e7391/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_imports_json_input_52abdb3f._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_imports_json_input_52abdb3f._.js?ref=ffea3e9366eda5727623798012d1ae78ad3e7391",
            "patch": "@@ -6,7 +6,7 @@\n __turbopack_context__.v(JSON.parse(\"{\\\"name\\\":\\\"json-snapshot\\\"}\"));}}),\n \"[project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\": (() => {{\n \n-throw new Error(\"An error occurred while generating the chunk item [project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\\n\\nCaused by:\\n- Unable to make a module from invalid JSON: expected `,` or `}` at line 3 column 26\\n\\nDebug info:\\n- An error occurred while generating the chunk item [project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\\n- Execution of <JsonChunkItem as EcmascriptChunkItem>::content failed\\n- Unable to make a module from invalid JSON: expected `,` or `}` at line 3 column 26\\n    at nested.?\\n       1 | {\\n       2 |   \\\"nested\\\": {\\n         |                          v\\n       3 +     \\\"this-is\\\": \\\"invalid\\\" // lint-staged will remove trailing commas, so here's a comment\\n         |                          ^\\n       4 |   }\\n       5 | }\");\n+throw new Error(\"An error occurred while generating the chunk item [project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\\n\\nCaused by:\\n- Unable to make a module from invalid JSON: expected `,` or `}` at line 3 column 26\\n\\nDebug info:\\n- An error occurred while generating the chunk item [project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json (json)\\n- Execution of *EcmascriptChunkItemContent::module_factory failed\\n- Execution of <JsonChunkItem as EcmascriptChunkItem>::content failed\\n- Unable to make a module from invalid JSON: expected `,` or `}` at line 3 column 26\\n    at nested.?\\n       1 | {\\n       2 |   \\\"nested\\\": {\\n         |                          v\\n       3 +     \\\"this-is\\\": \\\"invalid\\\" // lint-staged will remove trailing commas, so here's a comment\\n         |                          ^\\n       4 |   }\\n       5 | }\");\n \n }}),\n \"[project]/turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/index.js [test] (ecmascript)\": ((__turbopack_context__) => {"
        }
    ],
    "stats": {
        "total": 396,
        "additions": 283,
        "deletions": 113
    }
}