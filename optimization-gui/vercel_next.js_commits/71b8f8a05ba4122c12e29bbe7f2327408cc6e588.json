{
    "author": "sokra",
    "message": "Turbopack: trace all state changes (#84053)\n\n### What?\n\nadd a tracing span when state changes to make this visible in the tracing.\n\nfollow up from #83977",
    "sha": "71b8f8a05ba4122c12e29bbe7f2327408cc6e588",
    "files": [
        {
            "sha": "84720648ad0cd3d01a1f77a9d9b1eed39837994c",
            "filename": "turbopack/crates/turbo-tasks/src/state.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/71b8f8a05ba4122c12e29bbe7f2327408cc6e588/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fstate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/71b8f8a05ba4122c12e29bbe7f2327408cc6e588/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fstate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fstate.rs?ref=71b8f8a05ba4122c12e29bbe7f2327408cc6e588",
            "patch": "@@ -35,6 +35,7 @@ impl<T> StateInner<T> {\n \n     pub fn set_unconditionally(&mut self, value: T) {\n         self.value = value;\n+        let _span = trace_span!(\"state value changed\", value_type = type_name::<T>()).entered();\n         for invalidator in take(&mut self.invalidators) {\n             invalidator.invalidate();\n         }\n@@ -44,6 +45,7 @@ impl<T> StateInner<T> {\n         if !update(&mut self.value) {\n             return false;\n         }\n+        let _span = trace_span!(\"state value changed\", value_type = type_name::<T>()).entered();\n         for invalidator in take(&mut self.invalidators) {\n             invalidator.invalidate();\n         }\n@@ -89,6 +91,7 @@ impl<T> DerefMut for StateRef<'_, T> {\n impl<T> Drop for StateRef<'_, T> {\n     fn drop(&mut self) {\n         if self.mutated {\n+            let _span = trace_span!(\"state value changed\", value_type = type_name::<T>()).entered();\n             for invalidator in take(&mut self.inner.invalidators) {\n                 invalidator.invalidate();\n             }"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 3,
        "deletions": 0
    }
}