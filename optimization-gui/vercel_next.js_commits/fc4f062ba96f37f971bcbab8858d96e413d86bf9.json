{
    "author": "dijonmusters",
    "message": "Chore: Update with-supabase example to Next.js 16 (#86105)\n\n### What?\n\nUpgrade with-supabase example to be compatible with Next.js 16\n\n### Why?\n\n1. Users get console warnings about middleware vs proxy\n2. Enabling Cache Components config results in build errors for async\nbehaviour outside Suspense boundary\n3. Turbopack flag is default and therefore, no longer necessary on `npm\nrun dev`\n\n### How?\n\n1. Renamed all instances of `middleware` to `proxy`\n2. Wraped async behaviour in Suspense boundaries\n3. Removed --turbopack flag from `npm run dev`\n\n---------\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "fc4f062ba96f37f971bcbab8858d96e413d86bf9",
    "files": [
        {
            "sha": "d417bffbf964fd61107e48f4c08ba5590d9b0232",
            "filename": "examples/with-supabase/README.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2FREADME.md",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2FREADME.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2FREADME.md?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -22,7 +22,7 @@\n - Works across the entire [Next.js](https://nextjs.org) stack\n   - App Router\n   - Pages Router\n-  - Middleware\n+  - Proxy\n   - Client\n   - Server\n   - It just works!"
        },
        {
            "sha": "18b83060a3567590a3f4fc9e08ffaf861e6e62f2",
            "filename": "examples/with-supabase/app/auth/error/page.tsx",
            "status": "modified",
            "additions": 25,
            "deletions": 10,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fauth%2Ferror%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fauth%2Ferror%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fapp%2Fauth%2Ferror%2Fpage.tsx?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -1,12 +1,33 @@\n import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n+import { Suspense } from \"react\";\n \n-export default async function Page({\n+async function ErrorContent({\n   searchParams,\n }: {\n   searchParams: Promise<{ error: string }>;\n }) {\n   const params = await searchParams;\n \n+  return (\n+    <>\n+      {params?.error ? (\n+        <p className=\"text-sm text-muted-foreground\">\n+          Code error: {params.error}\n+        </p>\n+      ) : (\n+        <p className=\"text-sm text-muted-foreground\">\n+          An unspecified error occurred.\n+        </p>\n+      )}\n+    </>\n+  );\n+}\n+\n+export default function Page({\n+  searchParams,\n+}: {\n+  searchParams: Promise<{ error: string }>;\n+}) {\n   return (\n     <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n       <div className=\"w-full max-w-sm\">\n@@ -18,15 +39,9 @@ export default async function Page({\n               </CardTitle>\n             </CardHeader>\n             <CardContent>\n-              {params?.error ? (\n-                <p className=\"text-sm text-muted-foreground\">\n-                  Code error: {params.error}\n-                </p>\n-              ) : (\n-                <p className=\"text-sm text-muted-foreground\">\n-                  An unspecified error occurred.\n-                </p>\n-              )}\n+              <Suspense>\n+                <ErrorContent searchParams={searchParams} />\n+              </Suspense>\n             </CardContent>\n           </Card>\n         </div>"
        },
        {
            "sha": "ac33981d8ff24da4c074765c9044997457f05940",
            "filename": "examples/with-supabase/app/page.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fapp%2Fpage.tsx?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -7,6 +7,7 @@ import { ConnectSupabaseSteps } from \"@/components/tutorial/connect-supabase-ste\n import { SignUpUserSteps } from \"@/components/tutorial/sign-up-user-steps\";\n import { hasEnvVars } from \"@/lib/utils\";\n import Link from \"next/link\";\n+import { Suspense } from \"react\";\n \n export default function Home() {\n   return (\n@@ -20,7 +21,13 @@ export default function Home() {\n                 <DeployButton />\n               </div>\n             </div>\n-            {!hasEnvVars ? <EnvVarWarning /> : <AuthButton />}\n+            {!hasEnvVars ? (\n+              <EnvVarWarning />\n+            ) : (\n+              <Suspense>\n+                <AuthButton />\n+              </Suspense>\n+            )}\n           </div>\n         </nav>\n         <div className=\"flex-1 flex flex-col gap-20 max-w-5xl p-5\">"
        },
        {
            "sha": "99b0966201881c2e5a4a72dc221b7d2fe1d1f6c2",
            "filename": "examples/with-supabase/app/protected/layout.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fprotected%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fprotected%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fapp%2Fprotected%2Flayout.tsx?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -4,6 +4,7 @@ import { AuthButton } from \"@/components/auth-button\";\n import { ThemeSwitcher } from \"@/components/theme-switcher\";\n import { hasEnvVars } from \"@/lib/utils\";\n import Link from \"next/link\";\n+import { Suspense } from \"react\";\n \n export default function ProtectedLayout({\n   children,\n@@ -21,7 +22,13 @@ export default function ProtectedLayout({\n                 <DeployButton />\n               </div>\n             </div>\n-            {!hasEnvVars ? <EnvVarWarning /> : <AuthButton />}\n+            {!hasEnvVars ? (\n+              <EnvVarWarning />\n+            ) : (\n+              <Suspense>\n+                <AuthButton />\n+              </Suspense>\n+            )}\n           </div>\n         </nav>\n         <div className=\"flex-1 flex flex-col gap-20 max-w-5xl p-5\">"
        },
        {
            "sha": "4f6caa7476c97cdbed63ba513ed5d5e56b13db7e",
            "filename": "examples/with-supabase/app/protected/page.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fprotected%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fapp%2Fprotected%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fapp%2Fprotected%2Fpage.tsx?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -3,15 +3,20 @@ import { redirect } from \"next/navigation\";\n import { createClient } from \"@/lib/supabase/server\";\n import { InfoIcon } from \"lucide-react\";\n import { FetchDataSteps } from \"@/components/tutorial/fetch-data-steps\";\n+import { Suspense } from \"react\";\n \n-export default async function ProtectedPage() {\n+async function UserDetails() {\n   const supabase = await createClient();\n-\n   const { data, error } = await supabase.auth.getClaims();\n+\n   if (error || !data?.claims) {\n     redirect(\"/auth/login\");\n   }\n \n+  return JSON.stringify(data.claims, null, 2);\n+}\n+\n+export default function ProtectedPage() {\n   return (\n     <div className=\"flex-1 w-full flex flex-col gap-12\">\n       <div className=\"w-full\">\n@@ -24,7 +29,9 @@ export default async function ProtectedPage() {\n       <div className=\"flex flex-col gap-2 items-start\">\n         <h2 className=\"font-bold text-2xl mb-4\">Your user details</h2>\n         <pre className=\"text-xs font-mono p-3 rounded border max-h-32 overflow-auto\">\n-          {JSON.stringify(data.claims, null, 2)}\n+          <Suspense>\n+            <UserDetails />\n+          </Suspense>\n         </pre>\n       </div>\n       <div>"
        },
        {
            "sha": "c705a815c610a2ac6896540698f2dc994756c4f2",
            "filename": "examples/with-supabase/lib/supabase/proxy.ts",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fproxy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fproxy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fproxy.ts?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -7,7 +7,7 @@ export async function updateSession(request: NextRequest) {\n     request,\n   });\n \n-  // If the env vars are not set, skip middleware check. You can remove this\n+  // If the env vars are not set, skip proxy check. You can remove this\n   // once you setup the project.\n   if (!hasEnvVars) {\n     return supabaseResponse;",
            "previous_filename": "examples/with-supabase/lib/supabase/middleware.ts"
        },
        {
            "sha": "fb35301ab9c71aebbbff9f63d8f26d02bc91170d",
            "filename": "examples/with-supabase/lib/supabase/server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fserver.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fserver.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Flib%2Fsupabase%2Fserver.ts?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -24,7 +24,7 @@ export async function createClient() {\n             );\n           } catch {\n             // The `setAll` method was called from a Server Component.\n-            // This can be ignored if you have middleware refreshing\n+            // This can be ignored if you have proxy refreshing\n             // user sessions.\n           }\n         },"
        },
        {
            "sha": "584cbfce33972f370558f1ad60727809c32e2246",
            "filename": "examples/with-supabase/next.config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fnext.config.ts?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -1,7 +1,7 @@\n import type { NextConfig } from \"next\";\n \n const nextConfig: NextConfig = {\n-  /* config options here */\n+  cacheComponents: true,\n };\n \n export default nextConfig;"
        },
        {
            "sha": "d5b180461bf3088933240857bbe40dc1b1da96b4",
            "filename": "examples/with-supabase/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fpackage.json?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -1,7 +1,7 @@\n {\n   \"private\": true,\n   \"scripts\": {\n-    \"dev\": \"next dev --turbopack\",\n+    \"dev\": \"next dev\",\n     \"build\": \"next build\",\n     \"start\": \"next start\",\n     \"lint\": \"eslint .\""
        },
        {
            "sha": "503ab1220ef62cb02e382298f0bc1919c3580d00",
            "filename": "examples/with-supabase/proxy.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fproxy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Fproxy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Fproxy.ts?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -1,7 +1,7 @@\n-import { updateSession } from \"@/lib/supabase/middleware\";\n+import { updateSession } from \"@/lib/supabase/proxy\";\n import { type NextRequest } from \"next/server\";\n \n-export async function middleware(request: NextRequest) {\n+export async function proxy(request: NextRequest) {\n   return await updateSession(request);\n }\n ",
            "previous_filename": "examples/with-supabase/middleware.ts"
        },
        {
            "sha": "61d9b442e286416ac843a4d7d5f8e29a2f639672",
            "filename": "examples/with-supabase/tsconfig.json",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/fc4f062ba96f37f971bcbab8858d96e413d86bf9/examples%2Fwith-supabase%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Fwith-supabase%2Ftsconfig.json?ref=fc4f062ba96f37f971bcbab8858d96e413d86bf9",
            "patch": "@@ -23,6 +23,12 @@\n       \"@/*\": [\"./*\"]\n     }\n   },\n-  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\"],\n+  \"include\": [\n+    \"next-env.d.ts\",\n+    \"**/*.ts\",\n+    \"**/*.tsx\",\n+    \".next/types/**/*.ts\",\n+    \".next/dev/types/**/*.ts\"\n+  ],\n   \"exclude\": [\"node_modules\"]\n }"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 65,
        "deletions": 23
    }
}