{
    "author": "eps1lon",
    "message": "Enable preview builds for forks (#79648)",
    "sha": "257c3f8c5143b0a513d4f839204f311fcd63772f",
    "files": [
        {
            "sha": "5e4605689b540e4dc901b0108438b4ffca088596",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/257c3f8c5143b0a513d4f839204f311fcd63772f/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/257c3f8c5143b0a513d4f839204f311fcd63772f/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=257c3f8c5143b0a513d4f839204f311fcd63772f",
            "patch": "@@ -532,7 +532,7 @@ jobs:\n           path: crates/wasm\n \n       - name: Create tarballs\n-        run: node scripts/create-preview-tarballs.js \"${{ github.sha }}\" \"${{ runner.temp }}/preview-tarballs\"\n+        run: node scripts/create-preview-tarballs.js \"${{ github.sha }}\" \"${{ github.workflow_sha }}\" \"${{ runner.temp }}/preview-tarballs\"\n \n       - name: Upload tarballs\n         uses: actions/upload-artifact@v4"
        },
        {
            "sha": "bc62ae651db718b5a1980e3b0605c85dd86f004d",
            "filename": "scripts/create-preview-tarballs.js",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/257c3f8c5143b0a513d4f839204f311fcd63772f/scripts%2Fcreate-preview-tarballs.js",
            "raw_url": "https://github.com/vercel/next.js/raw/257c3f8c5143b0a513d4f839204f311fcd63772f/scripts%2Fcreate-preview-tarballs.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcreate-preview-tarballs.js?ref=257c3f8c5143b0a513d4f839204f311fcd63772f",
            "patch": "@@ -6,23 +6,24 @@ const path = require('node:path')\n \n async function main() {\n   const [\n-    commitSha,\n+    githubSha,\n+    githubWorkflowSha,\n     tarballDirectory = path.join(os.tmpdir(), 'vercel-nextjs-preview-tarballs'),\n   ] = process.argv.slice(2)\n   const repoRoot = path.resolve(__dirname, '..')\n \n   await fs.mkdir(tarballDirectory, { recursive: true })\n \n   const [{ stdout: shortSha }, { stdout: dateString }] = await Promise.all([\n-    execa('git', ['rev-parse', '--short', commitSha]),\n+    execa('git', ['rev-parse', '--short', githubSha]),\n     // Source: https://github.com/facebook/react/blob/767f52237cf7892ad07726f21e3e8bacfc8af839/scripts/release/utils.js#L114\n     execa(`git`, [\n       'show',\n       '-s',\n       '--no-show-signature',\n       '--format=%cd',\n       '--date=format:%Y%m%d',\n-      commitSha,\n+      githubSha,\n     ]),\n   ])\n \n@@ -97,16 +98,18 @@ async function main() {\n   ])\n   const packages = JSON.parse(lernaListJson.stdout)\n   const packagesByVersion = new Map()\n+  // vercel-packages finds GH artifacts via the head SHA because that's the only\n+  // API GitHub offers.\n   for (const packageInfo of packages) {\n     packagesByVersion.set(\n       packageInfo.name,\n-      `https://vercel-packages.vercel.app/next/commits/${commitSha}/${packageInfo.name}`\n+      `https://vercel-packages.vercel.app/next/commits/${githubWorkflowSha}/${packageInfo.name}`\n     )\n   }\n   for (const nextSwcPackageName of nextSwcPackageNames) {\n     packagesByVersion.set(\n       nextSwcPackageName,\n-      `https://vercel-packages.vercel.app/next/commits/${commitSha}/${nextSwcPackageName}`\n+      `https://vercel-packages.vercel.app/next/commits/${githubWorkflowSha}/${nextSwcPackageName}`\n     )\n   }\n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 9,
        "deletions": 6
    }
}