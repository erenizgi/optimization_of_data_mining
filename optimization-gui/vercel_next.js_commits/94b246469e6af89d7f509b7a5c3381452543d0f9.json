{
    "author": "wbinnssmith",
    "message": "next.config.ts: Implement `compiler.defineServer` for server-only constants (#79225)\n\nLike `compiler.define`, this allows users to create compile-time\nconstants both Turbopack and webpack from a single API.\n`compiler.defineServer` instead only makes these constants available for\nserver or edge environments, not the client environment.",
    "sha": "94b246469e6af89d7f509b7a5c3381452543d0f9",
    "files": [
        {
            "sha": "ea29d52968f4d269af4b35e6bdcfdfa42d5e4ded",
            "filename": "docs/03-architecture/nextjs-compiler.mdx",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/docs%2F03-architecture%2Fnextjs-compiler.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/docs%2F03-architecture%2Fnextjs-compiler.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F03-architecture%2Fnextjs-compiler.mdx?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -265,14 +265,17 @@ This option has been superseded by [`optimizePackageImports`](/docs/app/api-refe\n The `define` option allows you to statically replace variables in your code at build-time.\n The option takes an object as key-value pairs, where the keys are the variables that should be replaced with the corresponding values.\n \n-Use the `compiler.define` field in `next.config.js`:\n+Use the `compiler.define` field in `next.config.js` to define variables for all environments (server, edge, and client). Or, use `compiler.defineServer` to define variables only for server-side (server and edge) code:\n \n ```js filename=\"next.config.js\"\n module.exports = {\n   compiler: {\n     define: {\n-      MY_STRING_VARIABLE: JSON.stringify('my-string'),\n-      MY_NUMBER_VARIABLE: '42',\n+      MY_VARIABLE: 'my-string',\n+      'process.env.MY_ENV_VAR': 'my-env-var',\n+    },\n+    defineServer: {\n+      MY_SERVER_VARIABLE: 'my-server-var',\n     },\n   },\n }"
        },
        {
            "sha": "dc824d03e7e2066a578083b98997d5e26132d577",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -680,5 +680,7 @@\n   \"679\": \"A CacheSignal cannot subscribe to itself\",\n   \"680\": \"CacheSignal cannot be used in the edge runtime, because `dynamicIO` does not support it.\",\n   \"681\": \"Dynamic imports should not be instrumented in the edge runtime, because `dynamicIO` doesn't support it\",\n-  \"682\": \"\\\\`experimental.ppr\\\\` can not be \\\\`%s\\\\` when \\\\`experimental.dynamicIO\\\\` is \\\\`true\\\\`. PPR is implicitly enabled when Dynamic IO is enabled.\"\n+  \"682\": \"\\\\`experimental.ppr\\\\` can not be \\\\`%s\\\\` when \\\\`experimental.dynamicIO\\\\` is \\\\`true\\\\`. PPR is implicitly enabled when Dynamic IO is enabled.\",\n+  \"683\": \"The \\\\`compiler.define\\\\` option is configured to replace the \\\\`%s\\\\` variable. This variable is either part of a Next.js built-in or is already configured.\",\n+  \"684\": \"The \\\\`compiler.defineServer\\\\` option is configured to replace the \\\\`%s\\\\` variable. This variable is either part of a Next.js built-in or is already configured.\"\n }"
        },
        {
            "sha": "6e1b8321b64c61a6d60d8e2fe6732adf8a23cd68",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -24,7 +24,6 @@ export interface DefineEnvOptions {\n   hasRewrites: boolean\n   isClient: boolean\n   isEdgeServer: boolean\n-  isNodeOrEdgeCompilation: boolean\n   isNodeServer: boolean\n   middlewareMatchers: MiddlewareMatcher[] | undefined\n   omitNonDeterministic?: boolean\n@@ -94,7 +93,6 @@ export function getDefineEnv({\n   hasRewrites,\n   isClient,\n   isEdgeServer,\n-  isNodeOrEdgeCompilation,\n   isNodeServer,\n   middlewareMatchers,\n   omitNonDeterministic,\n@@ -250,15 +248,15 @@ export function getDefineEnv({\n     'process.env.__NEXT_TELEMETRY_DISABLED': Boolean(\n       process.env.NEXT_TELEMETRY_DISABLED\n     ),\n-    ...(isNodeOrEdgeCompilation\n+    ...(isNodeServer || isEdgeServer\n       ? {\n           // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)\n           // This is typically found in unmaintained modules from the\n           // pre-webpack era (common in server-side code)\n           'global.GENTLY': false,\n         }\n       : undefined),\n-    ...(isNodeOrEdgeCompilation\n+    ...(isNodeServer || isEdgeServer\n       ? {\n           'process.env.__NEXT_EXPERIMENTAL_REACT':\n             needsExperimentalReact(config),\n@@ -287,12 +285,24 @@ export function getDefineEnv({\n   for (const key in userDefines) {\n     if (defineEnv.hasOwnProperty(key)) {\n       throw new Error(\n-        `The \\`compiler.define\\` option is configured to replace the \\`${key}\\` variable. This variable is either part of a Next.js built-in or is already configured via the \\`env\\` option.`\n+        `The \\`compiler.define\\` option is configured to replace the \\`${key}\\` variable. This variable is either part of a Next.js built-in or is already configured.`\n       )\n     }\n     defineEnv[key] = userDefines[key]\n   }\n \n+  if (isNodeServer || isEdgeServer) {\n+    const userDefinesServer = config.compiler?.defineServer ?? {}\n+    for (const key in userDefinesServer) {\n+      if (defineEnv.hasOwnProperty(key)) {\n+        throw new Error(\n+          `The \\`compiler.defineServer\\` option is configured to replace the \\`${key}\\` variable. This variable is either part of a Next.js built-in or is already configured.`\n+        )\n+      }\n+      defineEnv[key] = userDefinesServer[key]\n+    }\n+  }\n+\n   const serializedDefineEnv = serializeDefineEnv(defineEnv)\n \n   // we delay inlining these values until after the build"
        },
        {
            "sha": "d8d72da83128a193fe41a712c79da51b8b9a6ee6",
            "filename": "packages/next/src/build/swc/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -411,7 +411,6 @@ export function createDefineEnv({\n         hasRewrites,\n         isClient: variant === 'client',\n         isEdgeServer: variant === 'edge',\n-        isNodeOrEdgeCompilation: variant === 'nodejs' || variant === 'edge',\n         isNodeServer: variant === 'nodejs',\n         middlewareMatchers,\n       })"
        },
        {
            "sha": "8682f67791ccc673bff696f4c58d5c20fa3765d2",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -1937,7 +1937,6 @@ export default async function getBaseWebpackConfig(\n           hasRewrites,\n           isClient,\n           isEdgeServer,\n-          isNodeOrEdgeCompilation,\n           isNodeServer,\n           middlewareMatchers,\n           omitNonDeterministic: isCompileMode,"
        },
        {
            "sha": "9bb2cb10b52baabebca14532daa4560ac4d90b16",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -270,6 +270,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n           }),\n         ]),\n         define: z.record(z.string(), z.string()).optional(),\n+        defineServer: z.record(z.string(), z.string()).optional(),\n         runAfterProductionCompile: z\n           .function()\n           .returns(z.promise(z.void()))"
        },
        {
            "sha": "a0e61bb6eda164ac7bff9e23fb4cc665feee4847",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -1085,6 +1085,12 @@ export interface NextConfig extends Record<string, any> {\n      */\n     define?: Record<string, string>\n \n+    /**\n+     * Replaces server-only (Node.js and Edge) variables in your code during compile time.\n+     * Each key will be replaced with the respective values.\n+     */\n+    defineServer?: Record<string, string>\n+\n     /**\n      * A hook function that executes after production build compilation finishes,\n      * but before running post-compilation tasks such as type checking and"
        },
        {
            "sha": "f9abd350e5f92e15fb3335d458b2ec1d5563b8bc",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -738,7 +738,6 @@ async function startWatcher(opts: SetupOpts) {\n                   hasRewrites,\n                   isClient,\n                   isEdgeServer,\n-                  isNodeOrEdgeCompilation: isNodeServer || isEdgeServer,\n                   isNodeServer,\n                   middlewareMatchers: undefined,\n                 })"
        },
        {
            "sha": "77036e77b0ff754207eb06e9f8fbb77d66c979d7",
            "filename": "test/e2e/define/app/client-component.js",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fclient-component.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fclient-component.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fapp%2Fclient-component.js?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -6,3 +6,13 @@ export function ClientValue() {\n     <>{typeof MY_MAGIC_VARIABLE === 'string' ? MY_MAGIC_VARIABLE : 'not set'}</>\n   )\n }\n+\n+export function ClientExpr() {\n+  return (\n+    <>\n+      {typeof process.env.MY_MAGIC_EXPR === 'string'\n+        ? process.env.MY_MAGIC_EXPR\n+        : 'not set'}\n+    </>\n+  )\n+}"
        },
        {
            "sha": "a732c53173cebcde783ddcdb1e89a95208cf895c",
            "filename": "test/e2e/define/app/page.js",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fapp%2Fpage.js?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -1,5 +1,5 @@\n /* eslint-disable no-undef */\n-import { ClientValue } from './client-component'\n+import { ClientValue, ClientExpr } from './client-component'\n \n export default function Page() {\n   return (\n@@ -11,6 +11,15 @@ export default function Page() {\n       <li>\n         Client value: <ClientValue />\n       </li>\n+      <li>\n+        Server expr:{' '}\n+        {typeof process.env.MY_MAGIC_EXPR === 'string'\n+          ? process.env.MY_MAGIC_EXPR\n+          : 'not set'}\n+      </li>\n+      <li>\n+        Client expr: <ClientExpr />\n+      </li>\n     </ul>\n   )\n }"
        },
        {
            "sha": "506098bf93fe8423ae7c219e82cd46553bdaf703",
            "filename": "test/e2e/define/app/with-server-only/client-component.js",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fclient-component.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fclient-component.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fclient-component.js?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -0,0 +1,30 @@\n+/* eslint-disable no-undef */\n+'use client'\n+\n+import { useState, useEffect } from 'react'\n+\n+export function ClientValue() {\n+  const [serverVar, setServerVar] = useState('<loading>')\n+  // Use `useEffect` to only evaluate this in the actual browser as client\n+  // components are still SSRed\n+  useEffect(() => {\n+    setServerVar(\n+      typeof MY_SERVER_VARIABLE === 'string' ? MY_SERVER_VARIABLE : 'not set'\n+    )\n+  }, [setServerVar])\n+\n+  return <>{serverVar}</>\n+}\n+\n+export function ClientExpr() {\n+  const [serverExpr, setServerExpr] = useState('<loading>')\n+  useEffect(() => {\n+    setServerExpr(\n+      typeof process.env.MY_MAGIC_SERVER_EXPR === 'string'\n+        ? process.env.MY_MAGIC_SERVER_EXPR\n+        : 'not set'\n+    )\n+  }, [setServerExpr])\n+\n+  return <>{serverExpr}</>\n+}"
        },
        {
            "sha": "98d979ab9215902456f152010cbafa556650d4ed",
            "filename": "test/e2e/define/app/with-server-only/page.js",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fapp%2Fwith-server-only%2Fpage.js?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -0,0 +1,27 @@\n+/* eslint-disable no-undef */\n+import { ClientValue, ClientExpr } from './client-component'\n+\n+export default function Page() {\n+  return (\n+    <ul>\n+      <li>\n+        Server value:{' '}\n+        {typeof MY_SERVER_VARIABLE === 'string'\n+          ? MY_SERVER_VARIABLE\n+          : 'not set'}\n+      </li>\n+      <li>\n+        Client value: <ClientValue />\n+      </li>\n+      <li>\n+        Server expr:{' '}\n+        {typeof process.env.MY_MAGIC_SERVER_EXPR === 'string'\n+          ? process.env.MY_MAGIC_SERVER_EXPR\n+          : 'not set'}\n+      </li>\n+      <li>\n+        Client expr: <ClientExpr />\n+      </li>\n+    </ul>\n+  )\n+}"
        },
        {
            "sha": "d7a967a64f456784ba5f3e395467e9bce4c18bd0",
            "filename": "test/e2e/define/define.test.ts",
            "status": "modified",
            "additions": 48,
            "deletions": 10,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fdefine.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fdefine.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fdefine.test.ts?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -5,17 +5,55 @@ describe('compiler.define', () => {\n     files: __dirname,\n   })\n \n-  it('should render the magic variable on server side', async () => {\n-    const res = await next.fetch('/')\n-    const html = (await res.text()).replaceAll(/<!-- -->/g, '')\n-    expect(html).toContain('Server value: foobar')\n-    expect(html).toContain('Client value: foobar')\n+  describe('compiler.define', () => {\n+    let loadedText\n+    beforeEach(async () => {\n+      let browser = await next.browser('/')\n+      loadedText = await browser.elementByCss('body').text()\n+    })\n+\n+    it('should render the magic variable on server side', async () => {\n+      expect(loadedText).toContain('Server value: foobar')\n+      expect(loadedText).toContain('Client value: foobar')\n+    })\n+\n+    it('should render the magic variable on client side', async () => {\n+      expect(loadedText).toContain('Server value: foobar')\n+      expect(loadedText).toContain('Client value: foobar')\n+    })\n+\n+    it('should render the magic expression on server side', async () => {\n+      expect(loadedText).toContain('Server expr: barbaz')\n+      expect(loadedText).toContain('Client expr: barbaz')\n+    })\n+\n+    it('should render the magic expression on client side', async () => {\n+      expect(loadedText).toContain('Server expr: barbaz')\n+      expect(loadedText).toContain('Client expr: barbaz')\n+    })\n   })\n \n-  it('should render the magic variable on client side', async () => {\n-    const browser = await next.browser('/')\n-    const text = await browser.elementByCss('body').text()\n-    expect(text).toContain('Server value: foobar')\n-    expect(text).toContain('Client value: foobar')\n+  describe('compiler.defineServer', () => {\n+    let loadedText\n+    beforeEach(async () => {\n+      let browser = await next.browser('/with-server-only')\n+      loadedText = await browser.elementByCss('body').text()\n+    })\n+\n+    it('should render the inlined variable on server side', async () => {\n+      expect(loadedText).toContain('Server value: server')\n+    })\n+\n+    it('should not render the inlined variable on client side', async () => {\n+      expect(loadedText).toContain('Client value: not set')\n+    })\n+\n+    it('should render the inlined expression on server side', async () => {\n+      expect(loadedText).toContain('Server expr: serverbarbaz')\n+    })\n+\n+    it('should not render the inlined expression on client side', async () => {\n+      expect(loadedText).toContain('Client expr: not set')\n+    })\n   })\n })"
        },
        {
            "sha": "6c9253dfe794f08db41a09b3ba1b32bd7f4960a1",
            "filename": "test/e2e/define/next.config.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94b246469e6af89d7f509b7a5c3381452543d0f9/test%2Fe2e%2Fdefine%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdefine%2Fnext.config.js?ref=94b246469e6af89d7f509b7a5c3381452543d0f9",
            "patch": "@@ -2,6 +2,11 @@ module.exports = {\n   compiler: {\n     define: {\n       MY_MAGIC_VARIABLE: 'foobar',\n+      'process.env.MY_MAGIC_EXPR': 'barbaz',\n+    },\n+    defineServer: {\n+      MY_SERVER_VARIABLE: 'server',\n+      'process.env.MY_MAGIC_SERVER_EXPR': 'serverbarbaz',\n     },\n   },\n }"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 161,
        "deletions": 23
    }
}