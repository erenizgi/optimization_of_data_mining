{
    "author": "huozhi",
    "message": "[test] consolidate hmr test for react 18.3 (#76975)\n\nUpdate flaky 18.3 test\n\nx-ref:\nhttps://github.com/vercel/next.js/actions/runs/13770136279/job/38509693811",
    "sha": "bbf542631c7a874c249622c0b843a2bfc00a483f",
    "files": [
        {
            "sha": "89ad0a52414d6820829c3c1c093500afcfd3ba1c",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/bbf542631c7a874c249622c0b843a2bfc00a483f/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bbf542631c7a874c249622c0b843a2bfc00a483f/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=bbf542631c7a874c249622c0b843a2bfc00a483f",
            "patch": "@@ -2,7 +2,9 @@\n import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import {\n+  getRedboxTotalErrorCount,\n   getStackFramesContent,\n+  retry,\n   toggleCollapseCallStackFrames,\n } from 'next-test-utils'\n import path from 'path'\n@@ -1103,8 +1105,11 @@ describe('ReactRefreshLogBox', () => {\n     const { browser } = sandbox\n \n     if (isReact18) {\n-      // TODO(veil): Why different error count between Turbopack and Webpack?\n       if (isTurbopack) {\n+        // Wait for the error to reach the correct count\n+        await retry(async () => {\n+          expect(await getRedboxTotalErrorCount(browser)).toBe(3)\n+        })\n         await expect(browser).toDisplayRedbox(`\n          {\n            \"count\": 3,\n@@ -1120,9 +1125,13 @@ describe('ReactRefreshLogBox', () => {\n          }\n         `)\n       } else {\n+        // Wait for the error to reach the correct count\n+        await retry(async () => {\n+          expect(await getRedboxTotalErrorCount(browser)).toBe(3)\n+        })\n         await expect(browser).toDisplayRedbox(`\n          {\n-           \"count\": 2,\n+           \"count\": 3,\n            \"description\": \"Error: Client error\",\n            \"environmentLabel\": null,\n            \"label\": \"Unhandled Runtime Error\","
        }
    ],
    "stats": {
        "total": 13,
        "additions": 11,
        "deletions": 2
    }
}