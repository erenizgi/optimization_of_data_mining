{
    "author": "sokra",
    "message": "Turbopack: run more unit tests in multi thread runtime (#82889)\n\n### What?\n\nWe want to run all unit tests in multi thread runtime, otherwise they would panic on block_in_place.",
    "sha": "6f59914bcdf3e919bb288ccbb5bd7159193235fa",
    "files": [
        {
            "sha": "188d62dd2bdb10810ad4ef9f71294151bfd82048",
            "filename": "crates/next-api/src/nft_json.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/crates%2Fnext-api%2Fsrc%2Fnft_json.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/crates%2Fnext-api%2Fsrc%2Fnft_json.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fnft_json.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -431,7 +431,7 @@ mod tests {\n         }\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_relativize_glob_normal_patterns() {\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n             BackendOptions::default(),\n@@ -458,7 +458,7 @@ mod tests {\n         .unwrap();\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_relativize_glob_current_directory_prefix() {\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n             BackendOptions::default(),\n@@ -487,7 +487,7 @@ mod tests {\n         .unwrap();\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_relativize_glob_parent_directory_navigation() {\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n             BackendOptions::default(),\n@@ -517,7 +517,7 @@ mod tests {\n         .unwrap();\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_relativize_glob_mixed_prefixes() {\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n             BackendOptions::default(),\n@@ -547,7 +547,7 @@ mod tests {\n         .unwrap();\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_relativize_glob_error_navigation_out_of_root() {\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n             BackendOptions::default(),"
        },
        {
            "sha": "1c255ed96170768ff8362bd57509c1cb76ffe310",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -2423,7 +2423,7 @@ mod tests {\n         );\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn with_extension() {\n         crate::register();\n \n@@ -2460,7 +2460,7 @@ mod tests {\n         .unwrap()\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn file_stem() {\n         crate::register();\n "
        },
        {
            "sha": "2ced12176fd1b1a435818dbb256acc18804b4cf2",
            "filename": "turbopack/crates/turbo-tasks-fs/src/read_glob.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fread_glob.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fread_glob.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fread_glob.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -240,7 +240,7 @@ pub mod tests {\n         DirectoryEntry, DiskFileSystem, FileContent, FileSystem, FileSystemPath, glob::Glob,\n     };\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn read_glob_basic() {\n         crate::register();\n         let scratch = tempfile::tempdir().unwrap();\n@@ -304,7 +304,7 @@ pub mod tests {\n     }\n \n     #[cfg(unix)]\n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn read_glob_symlinks() {\n         crate::register();\n         let scratch = tempfile::tempdir().unwrap();\n@@ -407,7 +407,7 @@ pub mod tests {\n     }\n \n     #[cfg(unix)]\n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn track_glob_invalidations() {\n         use std::os::unix::fs::symlink;\n         crate::register();\n@@ -494,7 +494,7 @@ pub mod tests {\n     }\n \n     #[cfg(unix)]\n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn track_glob_symlinks_loop() {\n         crate::register();\n         let scratch = tempfile::tempdir().unwrap();\n@@ -552,7 +552,7 @@ pub mod tests {\n     }\n \n     #[cfg(unix)]\n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn read_glob_symlinks_loop() {\n         crate::register();\n         let scratch = tempfile::tempdir().unwrap();"
        },
        {
            "sha": "f708b5d3d786f0f6580c14f90d89977313d56966",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/task_input.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ftask_input.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ftask_input.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ftask_input.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -18,7 +18,7 @@ fn one_unnamed_field(input: OneUnnamedField) -> Vc<Completion> {\n     Completion::immutable()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn tests() {\n     run(&REGISTRATION, || async {\n         assert!(ReadRef::ptr_eq("
        },
        {
            "sha": "93597910638fe0346806dddf0e7d070d4cb1ffdf",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/value_debug.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_debug.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_debug.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_debug.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -5,7 +5,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn ignored_indexes() {\n     #[allow(dead_code)]\n     #[derive(ValueDebugFormat)]"
        },
        {
            "sha": "ddc632664690679ffac3ce30b5aaef662520de52",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -1877,7 +1877,7 @@ pub mod tests {\n         resolve::ExportUsage,\n     };\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn traverse_dfs_from_entries_diamond() {\n         run_graph_test(\n             vec![rcstr!(\"a.js\")],\n@@ -1939,7 +1939,7 @@ pub mod tests {\n         .await;\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn traverse_dfs_from_entries_cycle() {\n         run_graph_test(\n             vec![rcstr!(\"a.js\")],\n@@ -1999,7 +1999,7 @@ pub mod tests {\n         .await;\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn traverse_edges_from_entries_fixed_point_cycle() {\n         run_graph_test(\n             vec![rcstr!(\"a.js\")],"
        },
        {
            "sha": "e771411f8764da551bb7b15613075a3d03395886",
            "filename": "turbopack/crates/turbopack-dev-server/src/update/stream.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -425,7 +425,7 @@ pub mod test {\n         ResolveSourceRequestResult::NotFound.cell()\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_get_content_fn() {\n         crate::register();\n         let tt = TurboTasks::new(TurboTasksBackend::new("
        },
        {
            "sha": "8cf0941339346846fb4285a346d2f2200c6d8af0",
            "filename": "turbopack/crates/turbopack/src/module_options/rule_condition.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6f59914bcdf3e919bb288ccbb5bd7159193235fa/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs?ref=6f59914bcdf3e919bb288ccbb5bd7159193235fa",
            "patch": "@@ -240,7 +240,7 @@ pub mod tests {\n \n     use super::*;\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_rule_condition_leaves() {\n         crate::register();\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new(\n@@ -374,7 +374,7 @@ pub mod tests {\n         anyhow::Ok(())\n     }\n \n-    #[tokio::test]\n+    #[tokio::test(flavor = \"multi_thread\")]\n     async fn test_rule_condition_tree() {\n         crate::register();\n         let tt = turbo_tasks::TurboTasks::new(TurboTasksBackend::new("
        }
    ],
    "stats": {
        "total": 40,
        "additions": 20,
        "deletions": 20
    }
}