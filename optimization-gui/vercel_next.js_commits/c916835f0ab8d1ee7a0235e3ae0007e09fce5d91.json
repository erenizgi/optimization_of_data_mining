{
    "author": "timneutkens",
    "message": "Turbopack Build: Fix _error loading test (#79455)\n\n## What?\n\nFixes the test but also uses a better implementation that makes the\nrequest block by Playwright instead of deleting files on disk. Making it\ncloser to the actual behavior we expect, i.e. browser fails to load the\nfile -> hard navigation.",
    "sha": "c916835f0ab8d1ee7a0235e3ae0007e09fce5d91",
    "files": [
        {
            "sha": "4fe1edefbb90bf0c282599b95980b6bd252ac668",
            "filename": "test/integration/error-load-fail/test/index.test.js",
            "status": "modified",
            "additions": 9,
            "deletions": 39,
            "changes": 48,
            "blob_url": "https://github.com/vercel/next.js/blob/c916835f0ab8d1ee7a0235e3ae0007e09fce5d91/test%2Fintegration%2Ferror-load-fail%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c916835f0ab8d1ee7a0235e3ae0007e09fce5d91/test%2Fintegration%2Ferror-load-fail%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ferror-load-fail%2Ftest%2Findex.test.js?ref=c916835f0ab8d1ee7a0235e3ae0007e09fce5d91",
            "patch": "@@ -1,16 +1,8 @@\n /* eslint-env jest */\n \n import { join } from 'path'\n-import fs from 'fs-extra'\n import webdriver from 'next-webdriver'\n-import {\n-  nextBuild,\n-  nextStart,\n-  findPort,\n-  killApp,\n-  check,\n-  getPageFileFromBuildManifest,\n-} from 'next-test-utils'\n+import { nextBuild, nextStart, findPort, killApp, check } from 'next-test-utils'\n \n const appDir = join(__dirname, '..')\n let app\n@@ -26,38 +18,16 @@ describe('Failing to load _error', () => {\n         const appPort = await findPort()\n         app = await nextStart(appDir, appPort)\n \n-        const browser = await webdriver(appPort, '/')\n-        await browser.eval(`window.beforeNavigate = true`)\n-\n-        await browser.elementByCss('#to-broken').moveTo()\n-        await check(\n-          async () => {\n-            const scripts = await browser.elementsByCss('script')\n-            let found = false\n-\n-            for (const script of scripts) {\n-              const src = await script.getAttribute('src')\n-              if (src.includes('broken-')) {\n-                found = true\n-                break\n-              }\n-            }\n-            return found\n+        const browser = await webdriver(appPort, '/', {\n+          beforePageLoad(page) {\n+            // Make _error route fail to load\n+            page.route('**/_error*.js', (route) => {\n+              route.abort('blockedbyclient')\n+            })\n           },\n-          {\n-            test(content) {\n-              return content === true\n-            },\n-          }\n-        )\n-\n-        const errorPageFilePath = getPageFileFromBuildManifest(\n-          appDir,\n-          '/_error'\n-        )\n-        // remove _error client bundle so that it can't be loaded\n-        await fs.remove(join(appDir, '.next', errorPageFilePath))\n+        })\n \n+        await browser.eval(`window.beforeNavigate = true`)\n         await browser.elementByCss('#to-broken').click()\n \n         await check(async () => {"
        },
        {
            "sha": "367a896c33d2bca0d14275f8d3c95e9db54291f0",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/c916835f0ab8d1ee7a0235e3ae0007e09fce5d91/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c916835f0ab8d1ee7a0235e3ae0007e09fce5d91/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=c916835f0ab8d1ee7a0235e3ae0007e09fce5d91",
            "patch": "@@ -11639,10 +11639,10 @@\n     \"runtimeError\": false\n   },\n   \"test/integration/error-load-fail/test/index.test.js\": {\n-    \"passed\": [],\n-    \"failed\": [\n+    \"passed\": [\n       \"Failing to load _error production mode handles failing to load _error correctly\"\n     ],\n+    \"failed\": [],\n     \"pending\": [],\n     \"flakey\": [],\n     \"runtimeError\": false"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 11,
        "deletions": 41
    }
}