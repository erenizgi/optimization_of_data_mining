{
    "author": "wyattjoh",
    "message": "refactor: consolidate PPR into cacheComponents architecture (#88243)\n\n### What?\n\nRemoves the `experimental.ppr` configuration flag and consolidates\nPartial Prerendering (PPR) functionality into the `cacheComponents`\narchitecture.\n\n### Why?\n\nHaving two separate systems (PPR flag and cacheComponents) created dual\ncode paths and complexity. PPR is now implicitly enabled when\ncacheComponents is enabled, simplifying the codebase.\n\n### How?\n\n- Deleted `postpone.ts` and `ppr.ts` utility files\n- Removed `PrerenderStorePPR` work unit type and all PPR-specific work\nunit cases\n- Removed React.unstable_postpone-based dynamic rendering logic\n- Deprecated `experimental.ppr` config (kept for backwards\ncompatibility)\n- Simplified build system to check only `cacheComponents` flag\n- Updated tests to remove PPR-specific behavior expectations\n\nThis removes ~986 lines of code across 48 files.",
    "sha": "a85d888a77707e60c55f1880b7307e4ba285e7a7",
    "files": [
        {
            "sha": "a336e90d9495a44f5ac1c8958c38d2e00bb1bf37",
            "filename": "packages/next/src/build/analyze/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fanalyze%2Findex.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -19,7 +19,6 @@ import { findPagesDir } from '../../lib/find-pages-dir'\n import { PAGE_TYPES } from '../../lib/page-types'\n import loadCustomRoutes from '../../lib/load-custom-routes'\n import { generateRoutesManifest } from '../generate-routes-manifest'\n-import { checkIsAppPPREnabled } from '../../server/lib/experimental/ppr'\n import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n import http from 'node:http'\n \n@@ -188,7 +187,7 @@ async function collectRoutesForAnalyze(\n     config.basePath ? `${config.basePath}${pathPrefix}` : pathPrefix\n   )\n \n-  const isAppPPREnabled = checkIsAppPPREnabled(config.experimental.ppr)\n+  const isAppPPREnabled = !!config.cacheComponents\n \n   // Generate routes manifest\n   const { routesManifest } = generateRoutesManifest({"
        },
        {
            "sha": "3457f663ff078c5b7620f1a086fa83267fddd355",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -7,7 +7,6 @@ import type { ProxyMatcher } from './analysis/get-page-static-info'\n import type { Rewrite } from '../lib/load-custom-routes'\n import path from 'node:path'\n import { needsExperimentalReact } from '../lib/needs-experimental-react'\n-import { checkIsAppPPREnabled } from '../server/lib/experimental/ppr'\n import {\n   getNextConfigEnv,\n   getNextPublicEnvironmentVariables,\n@@ -115,7 +114,6 @@ export function getDefineEnv({\n   const nextPublicEnv = getNextPublicEnvironmentVariables()\n   const nextConfigEnv = getNextConfigEnv(config)\n \n-  const isPPREnabled = checkIsAppPPREnabled(config.experimental.ppr)\n   const isCacheComponentsEnabled = !!config.cacheComponents\n   const isUseCacheEnabled = !!config.experimental.useCache\n \n@@ -161,7 +159,6 @@ export function getDefineEnv({\n     'process.env.__NEXT_APP_NAV_FAIL_HANDLING': Boolean(\n       config.experimental.appNavFailHandling\n     ),\n-    'process.env.__NEXT_PPR': isPPREnabled,\n     'process.env.__NEXT_CACHE_COMPONENTS': isCacheComponentsEnabled,\n     'process.env.__NEXT_USE_CACHE': isUseCacheEnabled,\n "
        },
        {
            "sha": "50054ca9bf560c110fde8b6014185ec330ce0b1e",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -199,10 +199,6 @@ import { traceMemoryUsage } from '../lib/memory/trace'\n import { generateEncryptionKeyBase64 } from '../server/app-render/encryption-utils-server'\n import type { DeepReadonly } from '../shared/lib/deep-readonly'\n import uploadTrace from '../trace/upload-trace'\n-import {\n-  checkIsAppPPREnabled,\n-  checkIsRoutePPREnabled,\n-} from '../server/lib/experimental/ppr'\n import { FallbackMode, fallbackModeToFallbackField } from '../lib/fallback'\n import { RenderingMode } from './rendering-mode'\n import { InvariantError } from '../shared/lib/invariant-error'\n@@ -1596,7 +1592,7 @@ export default async function build(\n       const isAuthInterruptsEnabled = Boolean(\n         config.experimental.authInterrupts\n       )\n-      const isAppPPREnabled = checkIsAppPPREnabled(config.experimental.ppr)\n+      const isAppPPREnabled = isAppCacheComponentsEnabled\n \n       const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n \n@@ -2151,7 +2147,6 @@ export default async function build(\n               locales: config.i18n?.locales,\n               defaultLocale: config.i18n?.defaultLocale,\n               nextConfigOutput: config.output,\n-              pprConfig: config.experimental.ppr,\n               cacheLifeProfiles: config.cacheLife,\n               buildId,\n               sriEnabled,\n@@ -2373,7 +2368,6 @@ export default async function build(\n                               : config.experimental.isrFlushToDisk,\n                             cacheMaxMemorySize: config.cacheMaxMemorySize,\n                             nextConfigOutput: config.output,\n-                            pprConfig: config.experimental.ppr,\n                             cacheLifeProfiles: config.cacheLife,\n                             buildId,\n                             sriEnabled,\n@@ -2948,9 +2942,8 @@ export default async function build(\n                 const appConfig = appDefaultConfigs.get(originalAppPath)\n                 const isDynamicError = appConfig?.dynamic === 'error'\n \n-                const isRoutePPREnabled: boolean = appConfig\n-                  ? checkIsRoutePPREnabled(config.experimental.ppr)\n-                  : false\n+                const isRoutePPREnabled: boolean =\n+                  !!appConfig && isAppCacheComponentsEnabled\n \n                 routes.forEach((route) => {\n                   // If the route has any dynamic root segments, we need to skip\n@@ -3139,8 +3132,7 @@ export default async function build(\n             // When this is an app page and PPR is enabled, the route supports\n             // partial pre-rendering.\n             const isRoutePPREnabled: true | undefined =\n-              !isAppRouteHandler &&\n-              checkIsRoutePPREnabled(config.experimental.ppr)\n+              !isAppRouteHandler && isAppCacheComponentsEnabled\n                 ? true\n                 : undefined\n "
        },
        {
            "sha": "519b64478aea560baf7e71b4822fce3809e681b6",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -20,7 +20,6 @@ import { BaseServerSpan } from '../../server/lib/trace/constants'\n import { interopDefault } from '../../server/app-render/interop-default'\n import { stripFlightHeaders } from '../../server/app-render/strip-flight-headers'\n import { NodeNextRequest, NodeNextResponse } from '../../server/base-http/node'\n-import { checkIsAppPPREnabled } from '../../server/lib/experimental/ppr'\n import {\n   getFallbackRouteParams,\n   createOpaqueFallbackRouteParams,\n@@ -222,12 +221,10 @@ export async function handler(\n   const isPossibleServerAction = getIsPossibleServerAction(req)\n \n   /**\n-   * If the route being rendered is an app page, and the ppr feature has been\n-   * enabled, then the given route _could_ support PPR.\n+   * If the route being rendered is an app page, and the cacheComponents feature\n+   * has been enabled, then the given route _could_ support PPR.\n    */\n-  const couldSupportPPR: boolean = checkIsAppPPREnabled(\n-    nextConfig.experimental.ppr\n-  )\n+  const couldSupportPPR: boolean = !!nextConfig.cacheComponents\n \n   if (\n     !getRequestMeta(req, 'postponed') &&"
        },
        {
            "sha": "5716789be08fc9a9a9ff1734c98dcd8eb5366e09",
            "filename": "packages/next/src/build/utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -2,8 +2,6 @@ import type {\n   NextConfigComplete,\n   NextConfigRuntime,\n } from '../server/config-shared'\n-import type { ExperimentalPPRConfig } from '../server/lib/experimental/ppr'\n-import { checkIsRoutePPREnabled } from '../server/lib/experimental/ppr'\n import type { AssetBinding } from './webpack/loaders/get-module-build-info'\n import type { ServerRuntime } from '../types'\n import type { BuildManifest } from '../server/get-page-files'\n@@ -751,7 +749,6 @@ export async function isPageStatic({\n   cacheHandler,\n   cacheHandlers,\n   cacheLifeProfiles,\n-  pprConfig,\n   buildId,\n   sriEnabled,\n }: {\n@@ -777,7 +774,6 @@ export async function isPageStatic({\n     [profile: string]: import('../server/use-cache/cache-life').CacheLife\n   }\n   nextConfigOutput: 'standalone' | 'export' | undefined\n-  pprConfig: ExperimentalPPRConfig | undefined\n   buildId: string\n   sriEnabled: boolean\n }): Promise<PageIsStaticResult> {\n@@ -902,12 +898,10 @@ export async function isPageStatic({\n \n         rootParamKeys = collectRootParamKeys(routeModule)\n \n-        // A page supports partial prerendering if it is an app page and either\n-        // the whole app has PPR enabled or this page has PPR enabled when we're\n-        // in incremental mode.\n+        // A page supports partial prerendering if it is an app page and\n+        // cacheComponents is enabled.\n         isRoutePPREnabled =\n-          routeModule.definition.kind === RouteKind.APP_PAGE &&\n-          checkIsRoutePPREnabled(pprConfig)\n+          routeModule.definition.kind === RouteKind.APP_PAGE && cacheComponents\n \n         // If force dynamic was set and we don't have PPR enabled, then set the\n         // revalidate to 0."
        },
        {
            "sha": "7bce26554a15a3a71d644b7b5924fb6832b1b91a",
            "filename": "packages/next/src/client/components/navigation-untracked.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation-untracked.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation-untracked.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation-untracked.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -20,7 +20,6 @@ function hasFallbackRouteParams(): boolean {\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n         const fallbackParams = workUnitStore.fallbackRouteParams\n         return fallbackParams ? fallbackParams.size > 0 : false\n       case 'prerender-legacy':"
        },
        {
            "sha": "a30ffebeac07e3335f0a6abc61a58386390a977c",
            "filename": "packages/next/src/client/components/router-reducer/fetch-server-response.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -167,15 +167,11 @@ export async function fetchServerResponse(\n \n     // Typically, during a navigation, we decode the response using Flight's\n     // `createFromFetch` API, which accepts a `fetch` promise.\n-    // TODO: Remove this check once the old PPR flag is removed\n-    const isLegacyPPR =\n-      process.env.__NEXT_PPR && !process.env.__NEXT_CACHE_COMPONENTS\n-    const shouldImmediatelyDecode = !isLegacyPPR\n     const res = await createFetch<NavigationFlightResponse>(\n       url,\n       headers,\n       'auto',\n-      shouldImmediatelyDecode\n+      true\n     )\n \n     const responseUrl = urlToUrlWithoutFlightMarker(new URL(res.url))"
        },
        {
            "sha": "e469ce6cdea6126593378281708263a57be2f9b8",
            "filename": "packages/next/src/client/components/unstable-rethrow.server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Funstable-rethrow.server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Funstable-rethrow.server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Funstable-rethrow.server.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -2,18 +2,14 @@ import { isHangingPromiseRejectionError } from '../../server/dynamic-rendering-u\n import { isPostpone } from '../../server/lib/router-utils/is-postpone'\n import { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { isNextRouterError } from './is-next-router-error'\n-import {\n-  isDynamicPostpone,\n-  isPrerenderInterruptedError,\n-} from '../../server/app-render/dynamic-rendering'\n+import { isPrerenderInterruptedError } from '../../server/app-render/dynamic-rendering'\n import { isDynamicServerError } from './hooks-server-context'\n \n export function unstable_rethrow(error: unknown): void {\n   if (\n     isNextRouterError(error) ||\n     isBailoutToCSRError(error) ||\n     isDynamicServerError(error) ||\n-    isDynamicPostpone(error) ||\n     isPostpone(error) ||\n     isHangingPromiseRejectionError(error) ||\n     isPrerenderInterruptedError(error)"
        },
        {
            "sha": "d6df2454094afed063ec9555edeb03731746a5c7",
            "filename": "packages/next/src/export/helpers/is-dynamic-usage-error.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fexport%2Fhelpers%2Fis-dynamic-usage-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fexport%2Fhelpers%2Fis-dynamic-usage-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Fhelpers%2Fis-dynamic-usage-error.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,10 +1,8 @@\n import { isDynamicServerError } from '../../client/components/hooks-server-context'\n import { isBailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { isNextRouterError } from '../../client/components/is-next-router-error'\n-import { isDynamicPostpone } from '../../server/app-render/dynamic-rendering'\n \n export const isDynamicUsageError = (err: unknown) =>\n   isDynamicServerError(err) ||\n   isBailoutToCSRError(err) ||\n-  isNextRouterError(err) ||\n-  isDynamicPostpone(err)\n+  isNextRouterError(err)"
        },
        {
            "sha": "8f144155da1724f21c00b8808abf0373fbdc5508",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 249,
            "changes": 249,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1862,7 +1862,6 @@ async function renderToHTMLOrFlightImpl(\n         case 'cache':\n         case 'private-cache':\n           return true\n-        case 'prerender-ppr':\n         case 'prerender-legacy':\n         case 'request':\n         case 'unstable-cache':\n@@ -4963,254 +4962,6 @@ async function prerenderToStream(\n           renderResumeDataCache: createRenderResumeDataCache(resumeDataCache),\n         }\n       }\n-    } else if (experimental.isRoutePPREnabled) {\n-      // We're statically generating with PPR and need to do dynamic tracking\n-      let dynamicTracking = createDynamicTrackingState(isDebugDynamicAccesses)\n-\n-      const prerenderResumeDataCache = createPrerenderResumeDataCache()\n-      const reactServerPrerenderStore: PrerenderStore = (prerenderStore = {\n-        type: 'prerender-ppr',\n-        phase: 'render',\n-        rootParams,\n-        fallbackRouteParams,\n-        implicitTags,\n-        dynamicTracking,\n-        revalidate: INFINITE_CACHE,\n-        expire: INFINITE_CACHE,\n-        stale: INFINITE_CACHE,\n-        tags: [...implicitTags.tags],\n-        prerenderResumeDataCache,\n-      })\n-      const RSCPayload = await workUnitAsyncStorage.run(\n-        reactServerPrerenderStore,\n-        getRSCPayload,\n-        tree,\n-        ctx,\n-        res.statusCode === 404\n-      )\n-      const reactServerResult = (reactServerPrerenderResult =\n-        await createReactServerPrerenderResultFromRender(\n-          workUnitAsyncStorage.run(\n-            reactServerPrerenderStore,\n-            ComponentMod.renderToReadableStream,\n-            // ... the arguments for the function to run\n-            RSCPayload,\n-            clientModules,\n-            {\n-              filterStackFrame,\n-              onError: serverComponentsErrorHandler,\n-            }\n-          )\n-        ))\n-\n-      const ssrPrerenderStore: PrerenderStore = {\n-        type: 'prerender-ppr',\n-        phase: 'render',\n-        rootParams,\n-        fallbackRouteParams,\n-        implicitTags,\n-        dynamicTracking,\n-        revalidate: INFINITE_CACHE,\n-        expire: INFINITE_CACHE,\n-        stale: INFINITE_CACHE,\n-        tags: [...implicitTags.tags],\n-        prerenderResumeDataCache,\n-      }\n-      const prerender = (\n-        require('react-dom/static') as typeof import('react-dom/static')\n-      ).prerender\n-      const { prelude: unprocessedPrelude, postponed } =\n-        await workUnitAsyncStorage.run(\n-          ssrPrerenderStore,\n-          prerender,\n-          // eslint-disable-next-line @next/internal/no-ambiguous-jsx\n-          <App\n-            reactServerStream={reactServerResult.asUnclosingStream()}\n-            reactDebugStream={undefined}\n-            debugEndTime={undefined}\n-            preinitScripts={preinitScripts}\n-            ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n-            nonce={nonce}\n-            images={ctx.renderOpts.images}\n-          />,\n-          {\n-            onError: htmlRendererErrorHandler,\n-            onHeaders: (headers: Headers) => {\n-              headers.forEach((value, key) => {\n-                appendHeader(key, value)\n-              })\n-            },\n-            maxHeadersLength: reactMaxHeadersLength,\n-            bootstrapScripts: [bootstrapScript],\n-          }\n-        )\n-      const getServerInsertedHTML = makeGetServerInsertedHTML({\n-        polyfills,\n-        renderServerInsertedHTML,\n-        serverCapturedErrors: allCapturedErrors,\n-        basePath,\n-        tracingMetadata: tracingMetadata,\n-      })\n-\n-      // After awaiting here we've waited for the entire RSC render to complete. Crucially this means\n-      // that when we detect whether we've used dynamic APIs below we know we'll have picked up even\n-      // parts of the React Server render that might not be used in the SSR render.\n-      const flightData = await streamToBuffer(reactServerResult.asStream())\n-\n-      if (shouldGenerateStaticFlightData(workStore)) {\n-        metadata.flightData = flightData\n-        metadata.segmentData = await collectSegmentData(\n-          flightData,\n-          ssrPrerenderStore,\n-          ComponentMod,\n-          renderOpts\n-        )\n-      }\n-\n-      const { prelude, preludeIsEmpty } =\n-        await processPrelude(unprocessedPrelude)\n-\n-      /**\n-       * When prerendering there are three outcomes to consider\n-       *\n-       *   Dynamic HTML:      The prerender has dynamic holes (caused by using Next.js Dynamic Rendering APIs)\n-       *                      We will need to resume this result when requests are handled and we don't include\n-       *                      any server inserted HTML or inlined flight data in the static HTML\n-       *\n-       *   Dynamic Data:      The prerender has no dynamic holes but dynamic APIs were used. We will not\n-       *                      resume this render when requests are handled but we will generate new inlined\n-       *                      flight data since it is dynamic and differences may end up reconciling on the client\n-       *\n-       *   Static:            The prerender has no dynamic holes and no dynamic APIs were used. We statically encode\n-       *                      all server inserted HTML and flight data\n-       */\n-      // First we check if we have any dynamic holes in our HTML prerender\n-      if (accessedDynamicData(dynamicTracking.dynamicAccesses)) {\n-        if (postponed != null) {\n-          // Dynamic HTML case.\n-          metadata.postponed = await getDynamicHTMLPostponedState(\n-            postponed,\n-            preludeIsEmpty\n-              ? DynamicHTMLPreludeState.Empty\n-              : DynamicHTMLPreludeState.Full,\n-            fallbackRouteParams,\n-            prerenderResumeDataCache,\n-            cacheComponents\n-          )\n-        } else {\n-          // Dynamic Data case.\n-          metadata.postponed = await getDynamicDataPostponedState(\n-            prerenderResumeDataCache,\n-            cacheComponents\n-          )\n-        }\n-        // Regardless of whether this is the Dynamic HTML or Dynamic Data case we need to ensure we include\n-        // server inserted html in the static response because the html that is part of the prerender may depend on it\n-        // It is possible in the set of stream transforms for Dynamic HTML vs Dynamic Data may differ but currently both states\n-        // require the same set so we unify the code path here\n-        reactServerResult.consume()\n-        return {\n-          digestErrorsMap: reactServerErrorsByDigest,\n-          ssrErrors: allCapturedErrors,\n-          stream: await continueDynamicPrerender(prelude, {\n-            getServerInsertedHTML,\n-            getServerInsertedMetadata,\n-          }),\n-          dynamicAccess: dynamicTracking.dynamicAccesses,\n-          // TODO: Should this include the SSR pass?\n-          collectedRevalidate: reactServerPrerenderStore.revalidate,\n-          collectedExpire: reactServerPrerenderStore.expire,\n-          collectedStale: selectStaleTime(reactServerPrerenderStore.stale),\n-          collectedTags: reactServerPrerenderStore.tags,\n-        }\n-      } else if (fallbackRouteParams && fallbackRouteParams.size > 0) {\n-        // Rendering the fallback case.\n-        metadata.postponed = await getDynamicDataPostponedState(\n-          prerenderResumeDataCache,\n-          cacheComponents\n-        )\n-\n-        return {\n-          digestErrorsMap: reactServerErrorsByDigest,\n-          ssrErrors: allCapturedErrors,\n-          stream: await continueDynamicPrerender(prelude, {\n-            getServerInsertedHTML,\n-            getServerInsertedMetadata,\n-          }),\n-          dynamicAccess: dynamicTracking.dynamicAccesses,\n-          // TODO: Should this include the SSR pass?\n-          collectedRevalidate: reactServerPrerenderStore.revalidate,\n-          collectedExpire: reactServerPrerenderStore.expire,\n-          collectedStale: selectStaleTime(reactServerPrerenderStore.stale),\n-          collectedTags: reactServerPrerenderStore.tags,\n-        }\n-      } else {\n-        // Static case\n-        // We still have not used any dynamic APIs. At this point we can produce an entirely static prerender response\n-        if (workStore.forceDynamic) {\n-          throw new StaticGenBailoutError(\n-            'Invariant: a Page with `dynamic = \"force-dynamic\"` did not trigger the dynamic pathway. This is a bug in Next.js'\n-          )\n-        }\n-\n-        let htmlStream = prelude\n-        if (postponed != null) {\n-          // We postponed but nothing dynamic was used. We resume the render now and immediately abort it\n-          // so we can set all the postponed boundaries to client render mode before we store the HTML response\n-          const resume = (\n-            require('react-dom/server') as typeof import('react-dom/server')\n-          ).resume\n-\n-          // We don't actually want to render anything so we just pass a stream\n-          // that never resolves. The resume call is going to abort immediately anyway\n-          const foreverStream = new ReadableStream<Uint8Array>()\n-\n-          const resumeStream = await resume(\n-            // eslint-disable-next-line @next/internal/no-ambiguous-jsx\n-            <App\n-              reactServerStream={foreverStream}\n-              reactDebugStream={undefined}\n-              debugEndTime={undefined}\n-              preinitScripts={() => {}}\n-              ServerInsertedHTMLProvider={ServerInsertedHTMLProvider}\n-              nonce={nonce}\n-              images={ctx.renderOpts.images}\n-            />,\n-            JSON.parse(JSON.stringify(postponed)),\n-            {\n-              signal: createRenderInBrowserAbortSignal(),\n-              onError: htmlRendererErrorHandler,\n-              nonce,\n-            }\n-          )\n-\n-          // First we write everything from the prerender, then we write everything from the aborted resume render\n-          htmlStream = chainStreams(prelude, resumeStream)\n-        }\n-\n-        return {\n-          digestErrorsMap: reactServerErrorsByDigest,\n-          ssrErrors: allCapturedErrors,\n-          stream: await continueStaticPrerender(htmlStream, {\n-            inlinedDataStream: createInlinedDataReadableStream(\n-              reactServerResult.consumeAsStream(),\n-              nonce,\n-              formState\n-            ),\n-            getServerInsertedHTML,\n-            getServerInsertedMetadata,\n-            isBuildTimePrerendering:\n-              ctx.workStore.isBuildTimePrerendering === true,\n-            buildId: ctx.workStore.buildId,\n-          }),\n-          dynamicAccess: dynamicTracking.dynamicAccesses,\n-          // TODO: Should this include the SSR pass?\n-          collectedRevalidate: reactServerPrerenderStore.revalidate,\n-          collectedExpire: reactServerPrerenderStore.expire,\n-          collectedStale: selectStaleTime(reactServerPrerenderStore.stale),\n-          collectedTags: reactServerPrerenderStore.tags,\n-        }\n-      }\n     } else {\n       const prerenderLegacyStore: PrerenderStore = (prerenderStore = {\n         type: 'prerender-legacy',"
        },
        {
            "sha": "c7d40d2efc9f9a555db02980726c862d853cf4da",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -119,7 +119,6 @@ async function createComponentTreeInternal(\n       createServerParamsForServerSegment,\n       createPrerenderParamsForClientSegment,\n       serverHooks: { DynamicServerError },\n-      Postpone,\n     },\n     pagePath,\n     getDynamicParamFromSegment,\n@@ -304,7 +303,6 @@ async function createComponentTreeInternal(\n         case 'prerender':\n         case 'prerender-runtime':\n         case 'prerender-legacy':\n-        case 'prerender-ppr':\n           if (workUnitStore.revalidate > defaultRevalidate) {\n             workUnitStore.revalidate = defaultRevalidate\n           }\n@@ -689,40 +687,6 @@ async function createComponentTreeInternal(\n   }\n \n   const Component = MaybeComponent\n-  // If force-dynamic is used and the current render supports postponing, we\n-  // replace it with a node that will postpone the render. This ensures that the\n-  // postpone is invoked during the react render phase and not during the next\n-  // render phase.\n-  // @TODO this does not actually do what it seems like it would or should do. The idea is that\n-  // if we are rendering in a force-dynamic mode and we can postpone we should only make the segments\n-  // that ask for force-dynamic to be dynamic, allowing other segments to still prerender. However\n-  // because this comes after the children traversal and the static generation store is mutated every segment\n-  // along the parent path of a force-dynamic segment will hit this condition effectively making the entire\n-  // render force-dynamic. We should refactor this function so that we can correctly track which segments\n-  // need to be dynamic\n-  if (\n-    workStore.isStaticGeneration &&\n-    workStore.forceDynamic &&\n-    experimental.isRoutePPREnabled\n-  ) {\n-    return [\n-      createElement(\n-        Fragment,\n-        {\n-          key: cacheNodeKey,\n-        },\n-        createElement(Postpone, {\n-          reason: 'dynamic = \"force-dynamic\" was used',\n-          route: workStore.route,\n-        }),\n-        layerAssets\n-      ),\n-      parallelRouteCacheNodeSeedData,\n-      loadingData,\n-      true,\n-      hasRuntimePrefetch,\n-    ]\n-  }\n \n   const isClientComponent = isClientReference(layoutOrPageMod)\n "
        },
        {
            "sha": "c6201b9722f6bf6ea94fb049502c9b4137750953",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 104,
            "changes": 105,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -50,8 +50,6 @@ import { scheduleOnNextTick } from '../../lib/scheduler'\n import { BailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { InvariantError } from '../../shared/lib/invariant-error'\n \n-const hasPostpone = typeof React.unstable_postpone === 'function'\n-\n export type DynamicAccess = {\n   /**\n    * If debugging, this will contain the stack trace of where the dynamic access\n@@ -143,7 +141,6 @@ export function markCurrentScopeAsDynamic(\n         // A private cache scope is already dynamic by definition.\n         return\n       case 'prerender-legacy':\n-      case 'prerender-ppr':\n       case 'request':\n         break\n       default:\n@@ -164,12 +161,6 @@ export function markCurrentScopeAsDynamic(\n \n   if (workUnitStore) {\n     switch (workUnitStore.type) {\n-      case 'prerender-ppr':\n-        return postponeWithTracking(\n-          store.route,\n-          expression,\n-          workUnitStore.dynamicTracking\n-        )\n       case 'prerender-legacy':\n         workUnitStore.revalidate = 0\n \n@@ -239,7 +230,6 @@ export function trackDynamicDataInDynamicRender(workUnitStore: WorkUnitStore) {\n     case 'prerender':\n     case 'prerender-runtime':\n     case 'prerender-legacy':\n-    case 'prerender-ppr':\n     case 'prerender-client':\n       break\n     case 'request':\n@@ -335,78 +325,6 @@ export function abortAndThrowOnSynchronousRequestDataAccess(\n   )\n }\n \n-/**\n- * This component will call `React.postpone` that throws the postponed error.\n- */\n-type PostponeProps = {\n-  reason: string\n-  route: string\n-}\n-export function Postpone({ reason, route }: PostponeProps): never {\n-  const prerenderStore = workUnitAsyncStorage.getStore()\n-  const dynamicTracking =\n-    prerenderStore && prerenderStore.type === 'prerender-ppr'\n-      ? prerenderStore.dynamicTracking\n-      : null\n-  postponeWithTracking(route, reason, dynamicTracking)\n-}\n-\n-export function postponeWithTracking(\n-  route: string,\n-  expression: string,\n-  dynamicTracking: null | DynamicTrackingState\n-): never {\n-  assertPostpone()\n-  if (dynamicTracking) {\n-    dynamicTracking.dynamicAccesses.push({\n-      // When we aren't debugging, we don't need to create another error for the\n-      // stack trace.\n-      stack: dynamicTracking.isDebugDynamicAccesses\n-        ? new Error().stack\n-        : undefined,\n-      expression,\n-    })\n-  }\n-\n-  React.unstable_postpone(createPostponeReason(route, expression))\n-}\n-\n-function createPostponeReason(route: string, expression: string) {\n-  return (\n-    `Route ${route} needs to bail out of prerendering at this point because it used ${expression}. ` +\n-    `React throws this special object to indicate where. It should not be caught by ` +\n-    `your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`\n-  )\n-}\n-\n-export function isDynamicPostpone(err: unknown) {\n-  if (\n-    typeof err === 'object' &&\n-    err !== null &&\n-    typeof (err as any).message === 'string'\n-  ) {\n-    return isDynamicPostponeReason((err as any).message)\n-  }\n-  return false\n-}\n-\n-function isDynamicPostponeReason(reason: string) {\n-  return (\n-    reason.includes(\n-      'needs to bail out of prerendering at this point because it used'\n-    ) &&\n-    reason.includes(\n-      'Learn more: https://nextjs.org/docs/messages/ppr-caught-error'\n-    )\n-  )\n-}\n-\n-if (isDynamicPostponeReason(createPostponeReason('%%%', '^^^')) === false) {\n-  throw new Error(\n-    'Invariant: isDynamicPostpone misidentified a postpone reason. This is a bug in Next.js'\n-  )\n-}\n-\n const NEXT_PRERENDER_INTERRUPTED = 'NEXT_PRERENDER_INTERRUPTED'\n \n function createPrerenderInterruptedError(message: string): Error {\n@@ -487,14 +405,6 @@ export function formatDynamicAPIAccesses(\n     })\n }\n \n-function assertPostpone() {\n-  if (!hasPostpone) {\n-    throw new Error(\n-      `Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js`\n-    )\n-  }\n-}\n-\n /**\n  * This is a bit of a hack to allow us to abort a render using a Postpone instance instead of an Error which changes React's\n  * abort semantics slightly.\n@@ -550,7 +460,6 @@ export function createHangingInputAbortSignal(\n \n       return controller.signal\n     case 'prerender-client':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'request':\n     case 'cache':\n@@ -600,17 +509,6 @@ export function useDynamicRouteParams(expression: string) {\n         }\n         break\n       }\n-      case 'prerender-ppr': {\n-        const fallbackParams = workUnitStore.fallbackRouteParams\n-        if (fallbackParams && fallbackParams.size > 0) {\n-          return postponeWithTracking(\n-            workStore.route,\n-            expression,\n-            workUnitStore.dynamicTracking\n-          )\n-        }\n-        break\n-      }\n       case 'prerender-runtime':\n         throw new InvariantError(\n           `\\`${expression}\\` was called during a runtime prerender. Next.js should be preventing ${expression} from being included in server components statically, but did not in this case.`\n@@ -654,8 +552,7 @@ export function useDynamicSearchParams(expression: string) {\n       )\n       break\n     }\n-    case 'prerender-legacy':\n-    case 'prerender-ppr': {\n+    case 'prerender-legacy': {\n       if (workStore.forceStatic) {\n         return\n       }"
        },
        {
            "sha": "2825d80ee2865337c73047074ab3e139a78cda38",
            "filename": "packages/next/src/server/app-render/encryption.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fencryption.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fencryption.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fencryption.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -276,7 +276,6 @@ export async function decryptActionBoundArgs(\n             }\n             break\n           case 'prerender-client':\n-          case 'prerender-ppr':\n           case 'prerender-legacy':\n           case 'request':\n           case 'cache':"
        },
        {
            "sha": "b52bb2fa89c6669e5b7208f669064308b35f0df8",
            "filename": "packages/next/src/server/app-render/entry-base.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -35,7 +35,6 @@ export { createMetadataComponents } from '../../lib/metadata/metadata'\n export { RootLayoutBoundary } from '../../lib/framework/boundary-components'\n \n export { preloadStyle, preloadFont, preconnect } from './rsc/preloads'\n-export { Postpone } from './rsc/postpone'\n export { taintObjectReference } from './rsc/taint'\n export { collectSegmentData } from './collect-segment-data'\n "
        },
        {
            "sha": "e486523811b51ad52de37cfa06540531f90b7bef",
            "filename": "packages/next/src/server/app-render/rsc/postpone.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/ee9e68872eaffd2c974103503e928d60c83e7075/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Frsc%2Fpostpone.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee9e68872eaffd2c974103503e928d60c83e7075/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Frsc%2Fpostpone.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Frsc%2Fpostpone.ts?ref=ee9e68872eaffd2c974103503e928d60c83e7075",
            "patch": "@@ -1,8 +0,0 @@\n-/*\n-\n-Files in the rsc directory are meant to be packaged as part of the RSC graph using next-app-loader.\n-\n-*/\n-\n-// When postpone is available in canary React we can switch to importing it directly\n-export { Postpone } from '../dynamic-rendering'"
        },
        {
            "sha": "b103c4cbbdcba9e172908e9e36e206a1e3c381c4",
            "filename": "packages/next/src/server/app-render/use-flight-response.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fuse-flight-response.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -123,7 +123,6 @@ export function getFlightStream<T>(\n         return responseOnNextTick\n       case 'prerender':\n       case 'prerender-runtime':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'request':\n       case 'cache':"
        },
        {
            "sha": "a10acf552ec43e1fcbd7da85288c91a757e3fabd",
            "filename": "packages/next/src/server/app-render/work-unit-async-storage.external.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 34,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-unit-async-storage.external.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-unit-async-storage.external.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-unit-async-storage.external.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -225,36 +225,14 @@ interface StaticPrerenderStoreCommon {\n   readonly allowEmptyStaticShell: boolean\n }\n \n-export interface PrerenderStorePPR\n-  extends CommonWorkUnitStore,\n-    RevalidateStore {\n-  readonly type: 'prerender-ppr'\n-  readonly rootParams: Params\n-  readonly dynamicTracking: null | DynamicTrackingState\n-\n-  /**\n-   * The set of unknown route parameters. Accessing these will be tracked as\n-   * a dynamic access.\n-   */\n-  readonly fallbackRouteParams: OpaqueFallbackRouteParams | null\n-\n-  /**\n-   * The resume data cache for this prerender.\n-   */\n-  prerenderResumeDataCache: PrerenderResumeDataCache\n-}\n-\n export interface PrerenderStoreLegacy\n   extends CommonWorkUnitStore,\n     RevalidateStore {\n   readonly type: 'prerender-legacy'\n   readonly rootParams: Params\n }\n \n-export type PrerenderStore =\n-  | PrerenderStoreLegacy\n-  | PrerenderStorePPR\n-  | PrerenderStoreModern\n+export type PrerenderStore = PrerenderStoreLegacy | PrerenderStoreModern\n \n // /** Like `PrerenderStoreModern`, but only including static prerenders (i.e. not runtime prerenders) */\n export type StaticPrerenderStore = Exclude<\n@@ -355,7 +333,6 @@ export function getPrerenderResumeDataCache(\n   switch (workUnitStore.type) {\n     case 'prerender':\n     case 'prerender-runtime':\n-    case 'prerender-ppr':\n       return workUnitStore.prerenderResumeDataCache\n     case 'prerender-client':\n       // TODO eliminate fetch caching in client scope and stop exposing this data\n@@ -391,10 +368,8 @@ export function getRenderResumeDataCache(\n         // that is used to read from prefilled caches.\n         return workUnitStore.renderResumeDataCache\n       }\n-    // fallthrough\n-    case 'prerender-ppr':\n-      // Otherwise we return the mutable resume data cache here as an immutable\n-      // version of the cache as it can also be used for reading.\n+      // Otherwise we return the mutable prerender resume data cache here as an\n+      // immutable version of the cache as it can also be used for reading.\n       return workUnitStore.prerenderResumeDataCache ?? null\n     case 'cache':\n     case 'private-cache':\n@@ -420,7 +395,6 @@ export function getHmrRefreshHash(\n       case 'request':\n         return workUnitStore.cookies.get(NEXT_HMR_REFRESH_HASH_COOKIE)?.value\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'unstable-cache':\n         break\n@@ -445,7 +419,6 @@ export function isHmrRefresh(\n       case 'prerender':\n       case 'prerender-client':\n       case 'prerender-runtime':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'unstable-cache':\n         break\n@@ -470,7 +443,6 @@ export function getServerComponentsHmrCache(\n       case 'prerender':\n       case 'prerender-client':\n       case 'prerender-runtime':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'unstable-cache':\n         break\n@@ -499,7 +471,6 @@ export function getDraftModeProviderForCacheScope(\n         return workUnitStore.draftMode\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         break\n       default:\n@@ -525,7 +496,6 @@ export function getCacheSignal(\n       }\n       // fallthrough\n     }\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'cache':\n     case 'private-cache':\n@@ -545,7 +515,6 @@ export function getRuntimeStagePromise(\n       return workUnitStore.runtimeStagePromise\n     case 'prerender':\n     case 'prerender-client':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'request':\n     case 'cache':"
        },
        {
            "sha": "7912a77e1004c8a0740adbed2ac3fdf77a9ed3f8",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -134,7 +134,6 @@ import { toRoute } from './lib/to-route'\n import type { DeepReadonly } from '../shared/lib/deep-readonly'\n import { isNodeNextRequest, isNodeNextResponse } from './base-http/helpers'\n import { patchSetHeaderWithCookieSupport } from './lib/patch-set-header'\n-import { checkIsAppPPREnabled } from './lib/experimental/ppr'\n import {\n   getBuiltinRequestContext,\n   type WaitUntil,\n@@ -423,7 +422,7 @@ export default abstract class Server<\n     readonly data: NextDataPathnameNormalizer | undefined\n   }\n \n-  private readonly isAppPPREnabled: boolean\n+  private readonly isCacheComponentsEnabled: boolean\n \n   /**\n    * This is used to persist cache scopes across\n@@ -505,9 +504,8 @@ export default abstract class Server<\n \n     this.enabledDirectories = this.getEnabledDirectories(dev)\n \n-    this.isAppPPREnabled =\n-      this.enabledDirectories.app &&\n-      checkIsAppPPREnabled(this.nextConfig.experimental.ppr)\n+    this.isCacheComponentsEnabled =\n+      this.enabledDirectories.app && !!this.nextConfig.cacheComponents\n \n     this.normalizers = {\n       // We should normalize the pathname from the RSC prefix only in minimal\n@@ -1056,7 +1054,7 @@ export default abstract class Server<\n           // It's important to execute the following block even it the request\n           // matches a pages data route from above.\n           if (\n-            this.isAppPPREnabled &&\n+            this.isCacheComponentsEnabled &&\n             this.minimalMode &&\n             req.headers[NEXT_RESUME_HEADER] === '1' &&\n             req.method === 'POST'\n@@ -2177,7 +2175,7 @@ export default abstract class Server<\n      * enabled, then the given route _could_ support PPR.\n      */\n     const couldSupportPPR: boolean =\n-      this.isAppPPREnabled &&\n+      this.isCacheComponentsEnabled &&\n       typeof routeModule !== 'undefined' &&\n       isAppPageRouteModule(routeModule)\n "
        },
        {
            "sha": "5b99ffad204b72111fb335f6e9ff049ecea6bb23",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -11,7 +11,10 @@ import type { WEB_VITALS } from '../shared/lib/utils'\n import type { NextParsedUrlQuery } from './request-meta'\n import type { SizeLimit } from '../types'\n import type { SupportedTestRunners } from '../cli/next-test'\n-import type { ExperimentalPPRConfig } from './lib/experimental/ppr'\n+/**\n+ * @deprecated This type is only kept for backwards compatibility with the deprecated `experimental.ppr` config option.\n+ */\n+export type ExperimentalPPRConfig = boolean | 'incremental'\n import { INFINITE_CACHE } from '../lib/constants'\n import { isStableBuild } from '../shared/lib/errors/canary-only-config-error'\n import type { FallbackRouteParam } from '../build/static-paths/types'"
        },
        {
            "sha": "481ea411951a58228392b72cccc9730724653242",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1350,9 +1350,6 @@ function assignDefaultsAndValidate(\n   }\n \n   if (result.cacheComponents) {\n-    // TODO: remove once we've finished migrating internally to cacheComponents.\n-    result.experimental.ppr = true\n-\n     // Prerender sourcemaps are enabled by default when using cacheComponents, unless explicitly disabled.\n     if (result.enablePrerenderSourceMaps === undefined) {\n       result.enablePrerenderSourceMaps = true"
        },
        {
            "sha": "774fbb70ba265634b363d84c54cba4735aba64f8",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -778,7 +778,6 @@ export default class DevServer extends Server {\n           distDir: this.distDir,\n           pathname,\n           config: {\n-            pprConfig: this.nextConfig.experimental.ppr,\n             configFileName,\n             cacheComponents: Boolean(this.nextConfig.cacheComponents),\n           },"
        },
        {
            "sha": "bbf71ade272dbb2d1c552bca81c777ed5a80a357",
            "filename": "packages/next/src/server/dev/static-paths-worker.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -17,10 +17,6 @@ import { loadComponents } from '../load-components'\n import { setHttpClientAndAgentOptions } from '../setup-http-agent-env'\n import type { IncrementalCache } from '../lib/incremental-cache'\n import { isAppPageRouteModule } from '../route-modules/checks'\n-import {\n-  checkIsRoutePPREnabled,\n-  type ExperimentalPPRConfig,\n-} from '../lib/experimental/ppr'\n import { InvariantError } from '../../shared/lib/invariant-error'\n import { collectRootParamKeys } from '../../build/segment-config/app/collect-root-param-keys'\n import { buildAppStaticPaths } from '../../build/static-paths/app'\n@@ -29,7 +25,6 @@ import { createIncrementalCache } from '../../export/helpers/create-incremental-\n import { parseAppRoute } from '../../shared/lib/router/routes/app'\n \n type RuntimeConfig = {\n-  pprConfig: ExperimentalPPRConfig | undefined\n   configFileName: string\n   cacheComponents: boolean\n }\n@@ -126,8 +121,7 @@ export async function loadStaticPaths({\n     }\n \n     const isRoutePPREnabled =\n-      isAppPageRouteModule(routeModule) &&\n-      checkIsRoutePPREnabled(config.pprConfig)\n+      isAppPageRouteModule(routeModule) && config.cacheComponents\n \n     const rootParamKeys = collectRootParamKeys(routeModule)\n "
        },
        {
            "sha": "50d441068ef9c7b779128589fe048eae996056cb",
            "filename": "packages/next/src/server/lib/experimental/ppr.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/ee9e68872eaffd2c974103503e928d60c83e7075/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee9e68872eaffd2c974103503e928d60c83e7075/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts?ref=ee9e68872eaffd2c974103503e928d60c83e7075",
            "patch": "@@ -1,52 +0,0 @@\n-/**\n- * If set to `incremental`, only those leaf pages that export\n- * `experimental_ppr = true` will have partial prerendering enabled. If any\n- * page exports this value as `false` or does not export it at all will not\n- * have partial prerendering enabled. If set to a boolean, the options for\n- * `experimental_ppr` will be ignored.\n- */\n-\n-export type ExperimentalPPRConfig = boolean | 'incremental'\n-\n-/**\n- * Returns true if partial prerendering is enabled for the application. It does\n- * not tell you if a given route has PPR enabled, as that requires analysis of\n- * the route's configuration.\n- *\n- * @see {@link checkIsRoutePPREnabled} - for checking if a specific route has PPR enabled.\n- */\n-export function checkIsAppPPREnabled(\n-  config: ExperimentalPPRConfig | undefined\n-): boolean {\n-  // If the config is undefined, partial prerendering is disabled.\n-  if (typeof config === 'undefined') return false\n-\n-  // If the config is a boolean, use it directly.\n-  if (typeof config === 'boolean') return config\n-\n-  // If the config is a string, it must be 'incremental' to enable partial\n-  // prerendering.\n-  if (config === 'incremental') return true\n-\n-  return false\n-}\n-\n-/**\n- * Returns true if partial prerendering is supported for the current page with\n- * the provided app configuration. If the application doesn't have partial\n- * prerendering enabled, this function will always return false. If you want to\n- * check if the application has partial prerendering enabled\n- *\n- * @see {@link checkIsAppPPREnabled} for checking if the application has PPR enabled.\n- */\n-export function checkIsRoutePPREnabled(\n-  config: ExperimentalPPRConfig | undefined\n-): boolean {\n-  // If the config is undefined, partial prerendering is disabled.\n-  if (typeof config === 'undefined') return false\n-\n-  // If the config is a boolean, use it directly.\n-  if (typeof config === 'boolean') return config\n-\n-  return false\n-}"
        },
        {
            "sha": "7fdfa9b62bdc48f39ce04e5080aa889de3d5de0e",
            "filename": "packages/next/src/server/lib/patch-fetch.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -358,7 +358,6 @@ export function createPatchedFetcher(\n             case 'prerender-runtime':\n             // TODO: Stop accumulating tags in client prerender. (fallthrough)\n             case 'prerender-client':\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'cache':\n             case 'private-cache':\n@@ -399,7 +398,6 @@ export function createPatchedFetcher(\n             case 'prerender':\n             case 'prerender-client':\n             case 'prerender-runtime':\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'request':\n             case 'cache':\n@@ -568,7 +566,6 @@ export function createPatchedFetcher(\n                 )\n               }\n               break\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'cache':\n             case 'private-cache':\n@@ -694,7 +691,6 @@ export function createPatchedFetcher(\n                     )\n                   }\n                   break\n-                case 'prerender-ppr':\n                 case 'prerender-legacy':\n                 case 'cache':\n                 case 'private-cache':\n@@ -739,7 +735,6 @@ export function createPatchedFetcher(\n             case 'prerender':\n             case 'prerender-client':\n             case 'prerender-runtime':\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'unstable-cache':\n               break\n@@ -885,7 +880,6 @@ export function createPatchedFetcher(\n                       )\n                     }\n                   // fallthrough\n-                  case 'prerender-ppr':\n                   case 'prerender-legacy':\n                   case 'cache':\n                   case 'private-cache':\n@@ -966,7 +960,6 @@ export function createPatchedFetcher(\n                     )\n                   }\n                   break\n-                case 'prerender-ppr':\n                 case 'prerender-legacy':\n                 case 'cache':\n                 case 'private-cache':\n@@ -1094,7 +1087,6 @@ export function createPatchedFetcher(\n                     )\n                   }\n                   break\n-                case 'prerender-ppr':\n                 case 'prerender-legacy':\n                 case 'cache':\n                 case 'private-cache':\n@@ -1144,7 +1136,6 @@ export function createPatchedFetcher(\n                   case 'private-cache':\n                   case 'unstable-cache':\n                   case 'prerender-legacy':\n-                  case 'prerender-ppr':\n                     break\n                   default:\n                     workUnitStore satisfies never"
        },
        {
            "sha": "678789d97fd5dafdbcb6283375b407dfeaa9216e",
            "filename": "packages/next/src/server/node-environment-extensions/console-dim.external.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Fconsole-dim.external.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Fconsole-dim.external.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Fconsole-dim.external.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -244,7 +244,6 @@ function patchConsoleMethod(methodName: InterceptableConsoleMethod): void {\n           }\n         // intentional fallthrough\n         case 'prerender-legacy':\n-        case 'prerender-ppr':\n         case 'cache':\n         case 'unstable-cache':\n         case 'private-cache':"
        },
        {
            "sha": "e37855801457aa3a2937f128572684bcbee89fbe",
            "filename": "packages/next/src/server/node-environment-extensions/unhandled-rejection.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Funhandled-rejection.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Funhandled-rejection.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Funhandled-rejection.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -599,7 +599,6 @@ function filteringUnhandledRejectionHandler(\n         }\n         break\n       }\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'request':\n       case 'cache':"
        },
        {
            "sha": "247c13a38b4cfe31c8d050749cedd5c9b74dbcfd",
            "filename": "packages/next/src/server/node-environment-extensions/utils.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -142,7 +142,6 @@ export function io(expression: string, type: ApiType) {\n         }\n       }\n       break\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'cache':\n     case 'private-cache':"
        },
        {
            "sha": "3d41c980b42cf7ad23de3371b2c82b1d01b82e8e",
            "filename": "packages/next/src/server/request/connection.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -4,7 +4,6 @@ import {\n   workUnitAsyncStorage,\n } from '../app-render/work-unit-async-storage.external'\n import {\n-  postponeWithTracking,\n   throwToInterruptStaticGeneration,\n   trackDynamicDataInDynamicRender,\n } from '../app-render/dynamic-rendering'\n@@ -84,14 +83,6 @@ export function connection(): Promise<void> {\n             workStore.route,\n             '`connection()`'\n           )\n-        case 'prerender-ppr':\n-          // We use React's postpone API to interrupt rendering here to create a\n-          // dynamic hole\n-          return postponeWithTracking(\n-            workStore.route,\n-            'connection',\n-            workUnitStore.dynamicTracking\n-          )\n         case 'prerender-legacy':\n           // We throw an error here to interrupt prerendering to mark the route\n           // as dynamic"
        },
        {
            "sha": "593483466c7265e740916717ed23fe3680a96747",
            "filename": "packages/next/src/server/request/cookies.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -16,7 +16,6 @@ import {\n } from '../app-render/work-unit-async-storage.external'\n import {\n   delayUntilRuntimeStage,\n-  postponeWithTracking,\n   throwToInterruptStaticGeneration,\n   trackDynamicDataInDynamicRender,\n } from '../app-render/dynamic-rendering'\n@@ -80,14 +79,6 @@ export function cookies(): Promise<ReadonlyRequestCookies> {\n           throw new InvariantError(\n             `${exportName} must not be used within a Client Component. Next.js should be preventing ${exportName} from being included in Client Components statically, but did not in this case.`\n           )\n-        case 'prerender-ppr':\n-          // We need track dynamic access here eagerly to keep continuity with\n-          // how cookies has worked in PPR without cacheComponents.\n-          return postponeWithTracking(\n-            workStore.route,\n-            callingExpression,\n-            workUnitStore.dynamicTracking\n-          )\n         case 'prerender-legacy':\n           // We track dynamic access here so we don't need to wrap the cookies\n           // in individual property access tracking."
        },
        {
            "sha": "856df4c813d7e832f35787e646a412ca55dce845",
            "filename": "packages/next/src/server/request/draft-mode.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fdraft-mode.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fdraft-mode.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fdraft-mode.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -13,7 +13,6 @@ import { workUnitAsyncStorage } from '../app-render/work-unit-async-storage.exte\n import {\n   abortAndThrowOnSynchronousRequestDataAccess,\n   delayUntilRuntimeStage,\n-  postponeWithTracking,\n   trackDynamicDataInDynamicRender,\n } from '../app-render/dynamic-rendering'\n import { createDedupedByCallsiteServerErrorLoggerDev } from '../create-deduped-by-callsite-server-error-logger'\n@@ -60,7 +59,6 @@ export function draftMode(): Promise<DraftMode> {\n     // eslint-disable-next-line no-fallthrough\n     case 'prerender':\n     case 'prerender-client':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n       // Return empty draft mode\n       return createOrGetCachedDraftMode(null, workStore)\n@@ -221,12 +219,6 @@ function trackDynamicDraftMode(expression: string, constructorOpt: Function) {\n           throw new InvariantError(\n             `${exportName} must not be used within a Client Component. Next.js should be preventing ${exportName} from being included in Client Components statically, but did not in this case.`\n           )\n-        case 'prerender-ppr':\n-          return postponeWithTracking(\n-            workStore.route,\n-            expression,\n-            workUnitStore.dynamicTracking\n-          )\n         case 'prerender-legacy':\n           workUnitStore.revalidate = 0\n "
        },
        {
            "sha": "8c4f189858063c389556cec512cc2925d2c1aa44",
            "filename": "packages/next/src/server/request/headers.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -14,7 +14,6 @@ import {\n } from '../app-render/work-unit-async-storage.external'\n import {\n   delayUntilRuntimeStage,\n-  postponeWithTracking,\n   throwToInterruptStaticGeneration,\n   trackDynamicDataInDynamicRender,\n } from '../app-render/dynamic-rendering'\n@@ -78,7 +77,6 @@ export function headers(): Promise<ReadonlyHeaders> {\n         case 'prerender-client':\n         case 'private-cache':\n         case 'prerender-runtime':\n-        case 'prerender-ppr':\n         case 'prerender-legacy':\n         case 'request':\n           break\n@@ -102,16 +100,6 @@ export function headers(): Promise<ReadonlyHeaders> {\n           throw new InvariantError(\n             `${exportName} must not be used within a client component. Next.js should be preventing ${exportName} from being included in client components statically, but did not in this case.`\n           )\n-        case 'prerender-ppr':\n-          // PPR Prerender (no cacheComponents)\n-          // We are prerendering with PPR. We need track dynamic access here eagerly\n-          // to keep continuity with how headers has worked in PPR without cacheComponents.\n-          // TODO consider switching the semantic to throw on property access instead\n-          return postponeWithTracking(\n-            workStore.route,\n-            callingExpression,\n-            workUnitStore.dynamicTracking\n-          )\n         case 'prerender-legacy':\n           // Legacy Prerender\n           // We are in a legacy static generation mode while prerendering"
        },
        {
            "sha": "5fb18700ace0268ad4c17a62b5fd3dd769ffee33",
            "filename": "packages/next/src/server/request/params.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 86,
            "changes": 87,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -5,16 +5,10 @@ import {\n import type { OpaqueFallbackRouteParams } from './fallback-params'\n \n import { ReflectAdapter } from '../web/spec-extension/adapters/reflect'\n-import {\n-  throwToInterruptStaticGeneration,\n-  postponeWithTracking,\n-  delayUntilRuntimeStage,\n-} from '../app-render/dynamic-rendering'\n+import { delayUntilRuntimeStage } from '../app-render/dynamic-rendering'\n \n import {\n   workUnitAsyncStorage,\n-  type PrerenderStorePPR,\n-  type PrerenderStoreLegacy,\n   type StaticPrerenderStoreModern,\n   type StaticPrerenderStore,\n   throwInvariantForMissingStore,\n@@ -46,7 +40,6 @@ export function createParamsFromClient(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         return createStaticPrerenderParams(\n           underlyingParams,\n@@ -99,7 +92,6 @@ export function createServerParamsForRoute(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         return createStaticPrerenderParams(\n           underlyingParams,\n@@ -145,7 +137,6 @@ export function createServerParamsForServerSegment(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         return createStaticPrerenderParams(\n           underlyingParams,\n@@ -220,7 +211,6 @@ export function createPrerenderParamsForClientSegment(\n         throw new InvariantError(\n           'createPrerenderParamsForClientSegment should not be called in cache contexts.'\n         )\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'prerender-runtime':\n       case 'request':\n@@ -261,22 +251,6 @@ function createStaticPrerenderParams(\n       }\n       break\n     }\n-    case 'prerender-ppr': {\n-      const fallbackParams = prerenderStore.fallbackRouteParams\n-      if (fallbackParams) {\n-        for (const key in underlyingParams) {\n-          if (fallbackParams.has(key)) {\n-            return makeErroringParams(\n-              underlyingParams,\n-              fallbackParams,\n-              workStore,\n-              prerenderStore\n-            )\n-          }\n-        }\n-      }\n-      break\n-    }\n     case 'prerender-legacy':\n       break\n     default:\n@@ -378,65 +352,6 @@ function makeHangingParams(\n   return promise\n }\n \n-function makeErroringParams(\n-  underlyingParams: Params,\n-  fallbackParams: OpaqueFallbackRouteParams,\n-  workStore: WorkStore,\n-  prerenderStore: PrerenderStorePPR | PrerenderStoreLegacy\n-): Promise<Params> {\n-  const cachedParams = CachedParams.get(underlyingParams)\n-  if (cachedParams) {\n-    return cachedParams\n-  }\n-\n-  const augmentedUnderlying = { ...underlyingParams }\n-\n-  // We don't use makeResolvedReactPromise here because params\n-  // supports copying with spread and we don't want to unnecessarily\n-  // instrument the promise with spreadable properties of ReactPromise.\n-  const promise = Promise.resolve(augmentedUnderlying)\n-  CachedParams.set(underlyingParams, promise)\n-\n-  Object.keys(underlyingParams).forEach((prop) => {\n-    if (wellKnownProperties.has(prop)) {\n-      // These properties cannot be shadowed because they need to be the\n-      // true underlying value for Promises to work correctly at runtime\n-    } else {\n-      if (fallbackParams.has(prop)) {\n-        Object.defineProperty(augmentedUnderlying, prop, {\n-          get() {\n-            const expression = describeStringPropertyAccess('params', prop)\n-            // In most dynamic APIs we also throw if `dynamic = \"error\"` however\n-            // for params is only dynamic when we're generating a fallback shell\n-            // and even when `dynamic = \"error\"` we still support generating dynamic\n-            // fallback shells\n-            // TODO remove this comment when cacheComponents is the default since there\n-            // will be no `dynamic = \"error\"`\n-            if (prerenderStore.type === 'prerender-ppr') {\n-              // PPR Prerender (no cacheComponents)\n-              postponeWithTracking(\n-                workStore.route,\n-                expression,\n-                prerenderStore.dynamicTracking\n-              )\n-            } else {\n-              // Legacy Prerender\n-              throwToInterruptStaticGeneration(\n-                expression,\n-                workStore,\n-                prerenderStore\n-              )\n-            }\n-          },\n-          enumerable: true,\n-        })\n-      }\n-    }\n-  })\n-\n-  return promise\n-}\n-\n function makeUntrackedParams(underlyingParams: Params): Promise<Params> {\n   const cachedParams = CachedParams.get(underlyingParams)\n   if (cachedParams) {"
        },
        {
            "sha": "3912379a58872823356051fe90da54785140f205",
            "filename": "packages/next/src/server/request/pathname.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 48,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,10 +1,6 @@\n import type { WorkStore } from '../app-render/work-async-storage.external'\n \n-import {\n-  delayUntilRuntimeStage,\n-  postponeWithTracking,\n-  type DynamicTrackingState,\n-} from '../app-render/dynamic-rendering'\n+import { delayUntilRuntimeStage } from '../app-render/dynamic-rendering'\n \n import {\n   throwInvariantForMissingStore,\n@@ -23,7 +19,6 @@ export function createServerPathnameForMetadata(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy': {\n         return createPrerenderPathname(\n           underlyingPathname,\n@@ -73,13 +68,6 @@ function createPrerenderPathname(\n       }\n       break\n     }\n-    case 'prerender-ppr': {\n-      const fallbackParams = prerenderStore.fallbackRouteParams\n-      if (fallbackParams && fallbackParams.size > 0) {\n-        return makeErroringPathname(workStore, prerenderStore.dynamicTracking)\n-      }\n-      break\n-    }\n     case 'prerender-legacy':\n       break\n     default:\n@@ -90,41 +78,6 @@ function createPrerenderPathname(\n   return Promise.resolve(underlyingPathname)\n }\n \n-function makeErroringPathname<T>(\n-  workStore: WorkStore,\n-  dynamicTracking: null | DynamicTrackingState\n-): Promise<T> {\n-  let reject: null | ((reason: unknown) => void) = null\n-  const promise = new Promise<T>((_, re) => {\n-    reject = re\n-  })\n-\n-  const originalThen = promise.then.bind(promise)\n-\n-  // We instrument .then so that we can generate a tracking event only if you actually\n-  // await this promise, not just that it is created.\n-  promise.then = (onfulfilled, onrejected) => {\n-    if (reject) {\n-      try {\n-        postponeWithTracking(\n-          workStore.route,\n-          'metadata relative url resolving',\n-          dynamicTracking\n-        )\n-      } catch (error) {\n-        reject(error)\n-        reject = null\n-      }\n-    }\n-    return originalThen(onfulfilled, onrejected)\n-  }\n-\n-  // We wrap in a noop proxy to trick the runtime into thinking it\n-  // isn't a native promise (it's not really). This is so that awaiting\n-  // the promise will call the `then` property triggering the lazy postpone\n-  return new Proxy(promise, {})\n-}\n-\n function createRenderPathname(underlyingPathname: string): Promise<string> {\n   return Promise.resolve(underlyingPathname)\n }"
        },
        {
            "sha": "0f42556c69bb6585c50e0a634ee6f1ac2fb993b5",
            "filename": "packages/next/src/server/request/root-params.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 58,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,21 +1,14 @@\n import { InvariantError } from '../../shared/lib/invariant-error'\n-import {\n-  postponeWithTracking,\n-  throwToInterruptStaticGeneration,\n-} from '../app-render/dynamic-rendering'\n import {\n   workAsyncStorage,\n   type WorkStore,\n } from '../app-render/work-async-storage.external'\n import {\n   workUnitAsyncStorage,\n-  type PrerenderStoreLegacy,\n-  type PrerenderStorePPR,\n   type StaticPrerenderStore,\n } from '../app-render/work-unit-async-storage.external'\n import { makeHangingPromise } from '../dynamic-rendering-utils'\n import type { ParamValue } from './params'\n-import { describeStringPropertyAccess } from '../../shared/lib/utils/reflect-utils'\n import { actionAsyncStorage } from '../app-render/action-async-storage.external'\n \n /**\n@@ -65,7 +58,6 @@ export function getRootParam(paramName: string): Promise<ParamValue> {\n     }\n     case 'prerender':\n     case 'prerender-client':\n-    case 'prerender-ppr':\n     case 'prerender-legacy': {\n       return createPrerenderRootParamPromise(\n         paramName,\n@@ -100,7 +92,6 @@ function createPrerenderRootParamPromise(\n     }\n     case 'prerender':\n     case 'prerender-legacy':\n-    case 'prerender-ppr':\n     default:\n   }\n \n@@ -122,22 +113,6 @@ function createPrerenderRootParamPromise(\n       }\n       break\n     }\n-    case 'prerender-ppr': {\n-      // We aren't in a cacheComponents prerender, but the param is a fallback,\n-      // so we need to make an erroring params object which will postpone/error if you access it\n-      if (\n-        prerenderStore.fallbackRouteParams &&\n-        prerenderStore.fallbackRouteParams.has(paramName)\n-      ) {\n-        return makeErroringRootParamPromise(\n-          paramName,\n-          workStore,\n-          prerenderStore,\n-          apiName\n-        )\n-      }\n-      break\n-    }\n     case 'prerender-legacy': {\n       // legacy prerenders can't have fallback params\n       break\n@@ -150,36 +125,3 @@ function createPrerenderRootParamPromise(\n   // If the param is not a fallback param, we just return the statically available value.\n   return Promise.resolve(underlyingParams[paramName])\n }\n-\n-/** Deliberately async -- we want to create a rejected promise, not error synchronously. */\n-async function makeErroringRootParamPromise(\n-  paramName: string,\n-  workStore: WorkStore,\n-  prerenderStore: PrerenderStorePPR | PrerenderStoreLegacy,\n-  apiName: string\n-): Promise<ParamValue> {\n-  const expression = describeStringPropertyAccess(apiName, paramName)\n-  // In most dynamic APIs, we also throw if `dynamic = \"error\"`.\n-  // However, root params are only dynamic when we're generating a fallback shell,\n-  // and even with `dynamic = \"error\"` we still support generating dynamic fallback shells.\n-  // TODO: remove this comment when cacheComponents is the default since there will be no `dynamic = \"error\"`\n-  switch (prerenderStore.type) {\n-    case 'prerender-ppr': {\n-      return postponeWithTracking(\n-        workStore.route,\n-        expression,\n-        prerenderStore.dynamicTracking\n-      )\n-    }\n-    case 'prerender-legacy': {\n-      return throwToInterruptStaticGeneration(\n-        expression,\n-        workStore,\n-        prerenderStore\n-      )\n-    }\n-    default: {\n-      prerenderStore satisfies never\n-    }\n-  }\n-}"
        },
        {
            "sha": "11c29029f11d8c578ab4df2646e5c57022a2c7f6",
            "filename": "packages/next/src/server/request/search-params.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 14,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -3,15 +3,13 @@ import type { WorkStore } from '../app-render/work-async-storage.external'\n import { ReflectAdapter } from '../web/spec-extension/adapters/reflect'\n import {\n   throwToInterruptStaticGeneration,\n-  postponeWithTracking,\n   annotateDynamicAccess,\n   delayUntilRuntimeStage,\n } from '../app-render/dynamic-rendering'\n \n import {\n   workUnitAsyncStorage,\n   type PrerenderStoreLegacy,\n-  type PrerenderStorePPR,\n   type PrerenderStoreModern,\n   type PrerenderStoreModernRuntime,\n   type StaticPrerenderStore,\n@@ -46,7 +44,6 @@ export function createSearchParamsFromClient(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         return createStaticPrerenderSearchParams(workStore, workUnitStore)\n       case 'prerender-runtime':\n@@ -85,7 +82,6 @@ export function createServerSearchParamsForServerPage(\n     switch (workUnitStore.type) {\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         return createStaticPrerenderSearchParams(workStore, workUnitStore)\n       case 'cache':\n@@ -143,7 +139,6 @@ export function createPrerenderSearchParamsForClientPage(\n         throw new InvariantError(\n           'createPrerenderSearchParamsForClientPage should not be called in cache contexts.'\n         )\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'request':\n         return Promise.resolve({})\n@@ -169,7 +164,6 @@ function createStaticPrerenderSearchParams(\n     case 'prerender-client':\n       // We are in a cacheComponents (PPR or otherwise) prerender\n       return makeHangingSearchParams(workStore, prerenderStore)\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n       // We are in a legacy static generation and need to interrupt the\n       // prerender when search params are accessed.\n@@ -273,7 +267,7 @@ function makeHangingSearchParams(\n \n function makeErroringSearchParams(\n   workStore: WorkStore,\n-  prerenderStore: PrerenderStoreLegacy | PrerenderStorePPR\n+  prerenderStore: PrerenderStoreLegacy\n ): Promise<SearchParams> {\n   const cachedSearchParams = CachedSearchParams.get(workStore)\n   if (cachedSearchParams) {\n@@ -303,13 +297,6 @@ function makeErroringSearchParams(\n             workStore.route,\n             expression\n           )\n-        } else if (prerenderStore.type === 'prerender-ppr') {\n-          // PPR Prerender (no cacheComponents)\n-          postponeWithTracking(\n-            workStore.route,\n-            expression,\n-            prerenderStore.dynamicTracking\n-          )\n         } else {\n           // Legacy Prerender\n           throwToInterruptStaticGeneration("
        },
        {
            "sha": "d114557ddf327c47e1a752d6bb075e817a86b636",
            "filename": "packages/next/src/server/route-modules/app-route/module.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -60,7 +60,6 @@ import { StaticGenBailoutError } from '../../../client/components/static-generat\n import { isStaticGenEnabled } from './helpers/is-static-gen-enabled'\n import {\n   abortAndThrowOnSynchronousRequestDataAccess,\n-  postponeWithTracking,\n   createDynamicTrackingState,\n   getFirstDynamicReason,\n } from '../../app-render/dynamic-rendering'\n@@ -1209,12 +1208,6 @@ function trackDynamic(\n         throw new InvariantError(\n           'A runtime prerender store should not be used for a route handler.'\n         )\n-      case 'prerender-ppr':\n-        return postponeWithTracking(\n-          store.route,\n-          expression,\n-          workUnitStore.dynamicTracking\n-        )\n       case 'prerender-legacy':\n         workUnitStore.revalidate = 0\n "
        },
        {
            "sha": "61af0affc03c2ef3edbc1efaa1ce222bc675312f",
            "filename": "packages/next/src/server/use-cache/cache-life.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -87,7 +87,6 @@ export function cacheLife(profile: CacheLifeProfiles | CacheLife): void {\n     case 'prerender':\n     case 'prerender-client':\n     case 'prerender-runtime':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'request':\n     case 'unstable-cache':"
        },
        {
            "sha": "2cea695de05480b2bde65facd59438c02eb3c994",
            "filename": "packages/next/src/server/use-cache/cache-tag.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-tag.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-tag.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-tag.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -14,7 +14,6 @@ export function cacheTag(...tags: string[]): void {\n     case 'prerender':\n     case 'prerender-client':\n     case 'prerender-runtime':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'request':\n     case 'unstable-cache':"
        },
        {
            "sha": "337a29065a6b9c11ec1bb481b9a66ac4836c33ac",
            "filename": "packages/next/src/server/use-cache/use-cache-wrapper.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 21,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -58,7 +58,6 @@ import { getCacheHandler } from './handlers'\n import { UseCacheTimeoutError } from './use-cache-errors'\n import {\n   createHangingInputAbortSignal,\n-  postponeWithTracking,\n   throwToInterruptStaticGeneration,\n } from '../app-render/dynamic-rendering'\n import {\n@@ -230,7 +229,6 @@ function createUseCacheStore(\n           break\n         case 'prerender-runtime':\n         case 'prerender':\n-        case 'prerender-ppr':\n         case 'prerender-legacy':\n         case 'unstable-cache':\n           break\n@@ -364,7 +362,6 @@ function propagateCacheLifeAndTags(\n       case 'private-cache':\n       case 'prerender':\n       case 'prerender-runtime':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n         propagateCacheLifeAndTagsToRevalidateStore(\n           cacheContext.outerWorkUnitStore,\n@@ -487,8 +484,7 @@ async function collectResult(\n       case 'private-cache':\n       case 'cache':\n       case 'unstable-cache':\n-      case 'prerender-legacy':\n-      case 'prerender-ppr': {\n+      case 'prerender-legacy': {\n         propagateCacheLifeAndTags(cacheContext, entry)\n         break\n       }\n@@ -564,7 +560,6 @@ async function generateCacheEntryImpl(\n                       }\n                     })\n                     break\n-                  case 'prerender-ppr':\n                   case 'prerender-legacy':\n                   case 'request':\n                   case 'cache':\n@@ -706,7 +701,6 @@ async function generateCacheEntryImpl(\n         await new Promise((resolve) => setTimeout(resolve))\n       }\n     // fallthrough\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'cache':\n     case 'private-cache':\n@@ -887,12 +881,6 @@ export async function cache(\n           workStore.route,\n           expression\n         )\n-      case 'prerender-ppr':\n-        return postponeWithTracking(\n-          workStore.route,\n-          expression,\n-          workUnitStore.dynamicTracking\n-        )\n       case 'prerender-legacy':\n         return throwToInterruptStaticGeneration(\n           expression,\n@@ -952,7 +940,6 @@ export async function cache(\n         )\n       case 'prerender':\n       case 'prerender-runtime':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'request':\n       case 'cache':\n@@ -1198,7 +1185,6 @@ export async function cache(\n         break\n       }\n     // fallthrough\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'request':\n     // TODO(restart-on-cache-miss): We need to handle params/searchParams on page components.\n@@ -1301,7 +1287,6 @@ export async function cache(\n               }\n               break\n             }\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'cache':\n             case 'private-cache':\n@@ -1350,7 +1335,6 @@ export async function cache(\n               break\n             }\n             case 'prerender':\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n             case 'cache':\n             case 'private-cache':\n@@ -1413,7 +1397,6 @@ export async function cache(\n             }\n             break\n           case 'prerender-runtime':\n-          case 'prerender-ppr':\n           case 'prerender-legacy':\n           case 'request':\n           case 'cache':\n@@ -1542,7 +1525,6 @@ export async function cache(\n           break\n         }\n         case 'prerender-runtime':\n-        case 'prerender-ppr':\n         case 'prerender-legacy':\n         case 'cache':\n         case 'private-cache':\n@@ -1783,7 +1765,6 @@ function shouldForceRevalidate(\n       case 'prerender-runtime':\n       case 'prerender':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'unstable-cache':\n         break\n@@ -1826,7 +1807,6 @@ function shouldDiscardCacheEntry(\n         return false\n       case 'prerender-runtime':\n       case 'prerender-client':\n-      case 'prerender-ppr':\n       case 'prerender-legacy':\n       case 'request':\n       case 'cache':"
        },
        {
            "sha": "6e4b6695ff90ed3822030a68d541d013933f68ef",
            "filename": "packages/next/src/server/web/spec-extension/revalidate.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Frevalidate.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Frevalidate.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Frevalidate.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,7 +1,4 @@\n-import {\n-  abortAndThrowOnSynchronousRequestDataAccess,\n-  postponeWithTracking,\n-} from '../../app-render/dynamic-rendering'\n+import { abortAndThrowOnSynchronousRequestDataAccess } from '../../app-render/dynamic-rendering'\n import { isDynamicRoute } from '../../../shared/lib/router/utils'\n import {\n   NEXT_CACHE_IMPLICIT_TAG_ID,\n@@ -162,12 +159,6 @@ function revalidate(\n         throw new InvariantError(\n           `${expression} must not be used within a client component. Next.js should be preventing ${expression} from being included in client components statically, but did not in this case.`\n         )\n-      case 'prerender-ppr':\n-        return postponeWithTracking(\n-          store.route,\n-          expression,\n-          workUnitStore.dynamicTracking\n-        )\n       case 'prerender-legacy':\n         workUnitStore.revalidate = 0\n "
        },
        {
            "sha": "7537eb4b7678d414950dfd790133f97d2247ef3d",
            "filename": "packages/next/src/server/web/spec-extension/unstable-cache.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -164,7 +164,6 @@ export function unstable_cache<T extends Callback>(\n             case 'private-cache':\n             case 'prerender':\n             case 'prerender-runtime':\n-            case 'prerender-ppr':\n             case 'prerender-legacy':\n               // We update the store's revalidate property if the option.revalidate is a higher precedence\n               // options.revalidate === undefined doesn't affect timing.\n@@ -409,7 +408,6 @@ function getFetchUrlPrefix(\n     case 'prerender':\n     case 'prerender-client':\n     case 'prerender-runtime':\n-    case 'prerender-ppr':\n     case 'prerender-legacy':\n     case 'cache':\n     case 'private-cache':"
        },
        {
            "sha": "7d1e569525fe627d79dee7af35e14e0ed8f650e3",
            "filename": "packages/next/src/server/web/spec-extension/unstable-no-store.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-no-store.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-no-store.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-no-store.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -37,7 +37,6 @@ export function unstable_noStore() {\n         case 'prerender-runtime':\n           // unstable_noStore() is a noop in Dynamic I/O.\n           return\n-        case 'prerender-ppr':\n         case 'prerender-legacy':\n         case 'request':\n         case 'cache':"
        },
        {
            "sha": "658f32720618ea570e775feab5529eb1c58c83f6",
            "filename": "test/e2e/app-dir/static-shell-debugging/static-shell-debugging.test.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 51,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fe2e%2Fapp-dir%2Fstatic-shell-debugging%2Fstatic-shell-debugging.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fe2e%2Fapp-dir%2Fstatic-shell-debugging%2Fstatic-shell-debugging.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fstatic-shell-debugging%2Fstatic-shell-debugging.test.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,61 +1,25 @@\n import { nextTestSetup } from 'e2e-utils'\n \n-// TODO(NAR-423): Migrate to Cache Components.\n-describe.skip('static-shell-debugging', () => {\n-  const ppr = Boolean(process.env.__NEXT_CACHE_COMPONENTS)\n-  const context = {\n-    ppr,\n-    debugging: ppr,\n-  }\n-\n-  const { next, skipped, isNextDev } = nextTestSetup({\n+describe('static-shell-debugging', () => {\n+  // TODO: The static shell debugging feature (__nextppronly) needs to be\n+  // reimplemented for the cacheComponents architecture. The feature was\n+  // previously tied to the PPR render path which has been consolidated.\n+  // For now, this test verifies the basic page rendering works correctly.\n+  // When the feature is reimplemented, re-enable the static shell assertions.\n+\n+  const { next, skipped } = nextTestSetup({\n     files: __dirname,\n-    // This test skips deployment because env vars that are doubled underscore prefixed\n-    // are not supported. This is also intended to be used in development.\n     skipDeployment: true,\n-    env: {\n-      __NEXT_EXPERIMENTAL_STATIC_SHELL_DEBUGGING: context.debugging\n-        ? '1'\n-        : undefined,\n-    },\n-    nextConfig: {\n-      experimental: { ppr: context.ppr },\n-    },\n   })\n \n   if (skipped) return\n \n-  if (context.debugging && context.ppr) {\n-    it('should only render the static shell', async () => {\n-      const res = await next.fetch('/?__nextppronly=1')\n-      expect(res.status).toBe(200)\n-\n-      const html = await res.text()\n-      expect(html).toContain('Fallback')\n-      expect(html).not.toContain('Dynamic')\n-    })\n-\n-    // The __nextppronly query param is currently only supported in dev mode.\n-    if (isNextDev) {\n-      it('should skip hydration to avoid blanking out the page', async () => {\n-        const browser = await next.browser('/?__nextppronly=1', {\n-          waitHydration: false,\n-        })\n+  it('should render the full page', async () => {\n+    const res = await next.fetch('/')\n+    expect(res.status).toBe(200)\n \n-        expect(await browser.elementByCss('div').text()).toBe('Fallback')\n-\n-        // Must not log the page error \"Error: Connection closed.\"\n-        expect(await browser.log()).toEqual([])\n-      })\n-    }\n-  } else {\n-    it('should render the full page', async () => {\n-      const res = await next.fetch('/?__nextppronly=1')\n-      expect(res.status).toBe(200)\n-\n-      const html = await res.text()\n-      expect(html).toContain('Fallback')\n-      expect(html).toContain('Dynamic')\n-    })\n-  }\n+    const html = await res.text()\n+    expect(html).toContain('Fallback')\n+    expect(html).toContain('Dynamic')\n+  })\n })"
        },
        {
            "sha": "ce587238185193d3836725e98044ebc02f2716ad",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 74,
            "changes": 74,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -4,8 +4,6 @@ const { version: nextVersion } = require('next/package.json')\n \n const cacheComponentsEnabled = process.env.__NEXT_CACHE_COMPONENTS === 'true'\n \n-const pprEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n-\n describe('build-output-prerender', () => {\n   describe('with a next config file', () => {\n     describe('without --debug-prerender', () => {\n@@ -32,20 +30,6 @@ describe('build-output-prerender', () => {\n                 reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           }\n-        } else if (pprEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (Turbopack, Cache Components)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (webpack, Cache Components)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -134,28 +118,6 @@ describe('build-output-prerender', () => {\n                 serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n-        } else if (pprEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-              Next.js x.y.z (Turbopack, Cache Components)\n-             - Experiments (use with caution):\n-                ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                serverSourceMaps (enabled by \\`--debug-prerender\\`)\n-                turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-              Next.js x.y.z (webpack, Cache Components)\n-             - Experiments (use with caution):\n-                ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                serverMinification (disabled by \\`--debug-prerender\\`)\n-                serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -278,20 +240,6 @@ describe('build-output-prerender', () => {\n                 reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           }\n-        } else if (pprEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (Turbopack)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (webpack)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -347,28 +295,6 @@ describe('build-output-prerender', () => {\n                 serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n-        } else if (pprEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-               Next.js x.y.z (Turbopack)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                 prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                 serverSourceMaps (enabled by \\`--debug-prerender\\`)\n-                 turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-               Next.js x.y.z (webpack)\n-              - Experiments (use with caution):\n-                 ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                 prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                 serverMinification (disabled by \\`--debug-prerender\\`)\n-                 serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`"
        },
        {
            "sha": "7059b9bbf06798b5f3a3f203a81ff14d5f30323f",
            "filename": "test/production/app-dir/metadata-streaming-config/app/dynamic/page.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fdynamic%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fdynamic%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fdynamic%2Fpage.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,6 +1,15 @@\n+import { Suspense } from 'react'\n import { connection } from 'next/server'\n \n-export default async function Page() {\n+async function DynamicContent() {\n   await connection()\n   return <p>dynamic</p>\n }\n+\n+export default function Page() {\n+  return (\n+    <Suspense fallback={<p>Loading...</p>}>\n+      <DynamicContent />\n+    </Suspense>\n+  )\n+}"
        },
        {
            "sha": "595e05c841bdcc66c69d14f1900382cf3c3984dd",
            "filename": "test/production/app-dir/metadata-streaming-config/app/ppr/page.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fppr%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fppr%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fapp%2Fppr%2Fpage.tsx?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,8 +1,15 @@\n+import { Suspense } from 'react'\n import { connection } from 'next/server'\n \n-export default async function Page() {\n+async function DynamicContent() {\n   await connection()\n   return <p>ppr</p>\n }\n \n-export const experimental_ppr = true\n+export default function Page() {\n+  return (\n+    <Suspense fallback={<p>Loading...</p>}>\n+      <DynamicContent />\n+    </Suspense>\n+  )\n+}"
        },
        {
            "sha": "8bcc212475ab2c86cdb009a27fb20073f4a036bd",
            "filename": "test/production/app-dir/metadata-streaming-config/metadata-streaming-config-customized.test.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 5,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config-customized.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config-customized.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config-customized.test.ts?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -1,17 +1,14 @@\n import { nextTestSetup } from 'e2e-utils'\n \n-// TODO: the incremental option has been removed, update to use cacheComponents\n-describe.skip('app-dir - metadata-streaming-config-customized', () => {\n+describe('app-dir - metadata-streaming-config-customized', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n     skipDeployment: true,\n     overrideFiles: {\n       'next.config.js': `\n         module.exports = {\n           htmlLimitedBots: /MyBot/i,\n-            experimental: {\n-            ppr: 'incremental',\n-          }\n+          cacheComponents: true,\n         }\n       `,\n     },\n@@ -33,6 +30,26 @@ describe.skip('app-dir - metadata-streaming-config-customized', () => {\n \n     expect(bypassConfigs).toMatchInlineSnapshot(`\n      {\n+       \"/\": {\n+         \"key\": \"user-agent\",\n+         \"type\": \"header\",\n+         \"value\": \"MyBot\",\n+       },\n+       \"/_global-error\": {\n+         \"key\": \"user-agent\",\n+         \"type\": \"header\",\n+         \"value\": \"MyBot\",\n+       },\n+       \"/_not-found\": {\n+         \"key\": \"user-agent\",\n+         \"type\": \"header\",\n+         \"value\": \"MyBot\",\n+       },\n+       \"/dynamic\": {\n+         \"key\": \"user-agent\",\n+         \"type\": \"header\",\n+         \"value\": \"MyBot\",\n+       },\n        \"/ppr\": {\n          \"key\": \"user-agent\",\n          \"type\": \"header\","
        },
        {
            "sha": "e64bae22d658030ef118a8b53c925258ae17563f",
            "filename": "test/production/app-dir/metadata-streaming-config/next.config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a85d888a77707e60c55f1880b7307e4ba285e7a7/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fnext.config.js?ref=a85d888a77707e60c55f1880b7307e4ba285e7a7",
            "patch": "@@ -2,9 +2,7 @@\n  * @type {import('next').NextConfig}\n  */\n const nextConfig = {\n-  experimental: {\n-    ppr: 'incremental',\n-  },\n+  cacheComponents: true,\n }\n \n module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 1076,
        "additions": 90,
        "deletions": 986
    }
}