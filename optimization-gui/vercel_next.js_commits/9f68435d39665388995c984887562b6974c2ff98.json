{
    "author": "sokra",
    "message": "Turbopack: implement optimized css production chunking (#77284)\n\n### What?\n\nPort the webpack css chunking implementation for app dir to Turbopack.\n\nIt also computes ordered entries in module batches\n\nPages router also uses the app dir chunking, but that's incorrect and leads to some breaking test cases.",
    "sha": "9f68435d39665388995c984887562b6974c2ff98",
    "files": [
        {
            "sha": "7c0818da559de142ede7828eb8b44a38b582ae74",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -471,7 +471,7 @@ pub async fn get_client_chunking_context(\n         builder = builder.chunking_config(\n             Vc::<CssChunkType>::default().to_resolved().await?,\n             ChunkingConfig {\n-                min_chunk_size: 0,\n+                max_merge_chunk_size: 100_000,\n                 ..Default::default()\n             },\n         );"
        },
        {
            "sha": "a6f71f0366d30dd3a8192f61b3115f46795b77a4",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -256,7 +256,7 @@ pub async fn get_edge_chunking_context_with_client_assets(\n         builder = builder.chunking_config(\n             Vc::<CssChunkType>::default().to_resolved().await?,\n             ChunkingConfig {\n-                min_chunk_size: 0,\n+                max_merge_chunk_size: 100_000,\n                 ..Default::default()\n             },\n         );\n@@ -319,7 +319,7 @@ pub async fn get_edge_chunking_context(\n         builder = builder.chunking_config(\n             Vc::<CssChunkType>::default().to_resolved().await?,\n             ChunkingConfig {\n-                min_chunk_size: 0,\n+                max_merge_chunk_size: 100_000,\n                 ..Default::default()\n             },\n         );"
        },
        {
            "sha": "9bc78bffac8d9709121ec8ed3195145d230d96ff",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -1041,7 +1041,7 @@ pub async fn get_server_chunking_context_with_client_assets(\n         builder = builder.chunking_config(\n             Vc::<CssChunkType>::default().to_resolved().await?,\n             ChunkingConfig {\n-                min_chunk_size: 0,\n+                max_merge_chunk_size: 100_000,\n                 ..Default::default()\n             },\n         );\n@@ -1106,7 +1106,7 @@ pub async fn get_server_chunking_context(\n         builder = builder.chunking_config(\n             Vc::<CssChunkType>::default().to_resolved().await?,\n             ChunkingConfig {\n-                min_chunk_size: 0,\n+                max_merge_chunk_size: 100_000,\n                 ..Default::default()\n             },\n         );"
        },
        {
            "sha": "232a546c325ac77706045c034153d47c7d883d75",
            "filename": "test/e2e/app-dir/app-css/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fapp-css%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fapp-css%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-css%2Findex.test.ts?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -192,11 +192,7 @@ describe('app dir - css', () => {\n         const $ = await next.render$('/loading-bug/hi')\n         // The link tag should be hoist into head with precedence properties\n         const styles = $('head link[data-precedence]').length\n-        if (process.env.TURBOPACK && !isNextDev) {\n-          expect(styles).toBe(3)\n-        } else {\n-          expect(styles).toBe(2)\n-        }\n+        expect(styles).toBe(2)\n \n         expect($('body h2').text()).toBe('Loading...')\n       })\n@@ -313,11 +309,7 @@ describe('app dir - css', () => {\n             /<link rel=\"stylesheet\" href=\"[^<]+\\.css(\\?v=\\d+)?\"/g\n           ),\n         ].length\n-        if (process.env.TURBOPACK && !isNextDev) {\n-          expect(stylesheets).toBe(5)\n-        } else {\n-          expect(stylesheets).toBe(3)\n-        }\n+        expect(stylesheets).toBe(3)\n       })\n     })\n "
        },
        {
            "sha": "de2353068888461aaf45a92fc42220376dae9bda",
            "filename": "test/e2e/app-dir/css-chunking/css-chunking.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-chunking%2Fcss-chunking.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-chunking%2Fcss-chunking.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-chunking%2Fcss-chunking.test.ts?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -7,15 +7,19 @@ describe('css-chunking', () => {\n   // do not contain styles for the `/other` page, which can happen\n   // when the CSSChunkingPlugin is enabled and styles are shared across\n   // both routes.\n-  it('should be possible to disable the chunking plugin', async () => {\n-    const $ = await next.render$('/')\n-    const stylesheets = $('link[rel=\"stylesheet\"]')\n-    stylesheets.each(async (_, element) => {\n-      const href = element.attribs.href\n-      const result = await next.fetch(href)\n-      const css = await result.text()\n+  ;(process.env.TURBOPACK ? it.skip : it)(\n+    'should be possible to disable the chunking plugin',\n+    async () => {\n+      const $ = await next.render$('/')\n+      const stylesheets = $('link[rel=\"stylesheet\"]')\n+      stylesheets.each(async (_, element) => {\n+        const href = element.attribs.href\n+        const result = await next.fetch(href)\n+        const css = await result.text()\n \n-      expect(css).not.toContain('.otherPage')\n-    })\n-  })\n+        // eslint-disable-next-line jest/no-standalone-expect\n+        expect(css).not.toContain('.otherPage')\n+      })\n+    }\n+  )\n })"
        },
        {
            "sha": "5c070795830acc3a40b7c773ee0bff64f893ffcf",
            "filename": "test/e2e/app-dir/css-order/app/big-interleaved/style0.module.css",
            "status": "modified",
            "additions": 1022,
            "deletions": 436,
            "changes": 1458,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle0.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle0.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle0.module.css?ref=9f68435d39665388995c984887562b6974c2ff98"
        },
        {
            "sha": "07953d93b993e83bb8d56bdb389c41eb91152dee",
            "filename": "test/e2e/app-dir/css-order/app/big-interleaved/style1.module.css",
            "status": "modified",
            "additions": 1022,
            "deletions": 436,
            "changes": 1458,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle1.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle1.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle1.module.css?ref=9f68435d39665388995c984887562b6974c2ff98"
        },
        {
            "sha": "8259a09d1d74f87ddf8f6d20db02ceeba4f17cd0",
            "filename": "test/e2e/app-dir/css-order/app/big-interleaved/style2.module.css",
            "status": "modified",
            "additions": 1022,
            "deletions": 436,
            "changes": 1458,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle2.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle2.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle2.module.css?ref=9f68435d39665388995c984887562b6974c2ff98"
        },
        {
            "sha": "97190981448d3c19c861eba4ba40e394781aa7f7",
            "filename": "test/e2e/app-dir/css-order/app/big-interleaved/style3.module.css",
            "status": "modified",
            "additions": 1022,
            "deletions": 436,
            "changes": 1458,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle3.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle3.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle3.module.css?ref=9f68435d39665388995c984887562b6974c2ff98"
        },
        {
            "sha": "4028f85b9472bede17f3f8a2f55c3f0e738c768c",
            "filename": "test/e2e/app-dir/css-order/app/big-interleaved/style4.module.css",
            "status": "modified",
            "additions": 1022,
            "deletions": 436,
            "changes": 1458,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle4.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle4.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fbig-interleaved%2Fstyle4.module.css?ref=9f68435d39665388995c984887562b6974c2ff98"
        },
        {
            "sha": "6a17d7f7386d171888bdb9f2928e6e6e39b4a42a",
            "filename": "test/e2e/app-dir/css-order/app/vendor/node_modules/my-dep2/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fvendor%2Fnode_modules%2Fmy-dep2%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fvendor%2Fnode_modules%2Fmy-dep2%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fapp%2Fvendor%2Fnode_modules%2Fmy-dep2%2Findex.js?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -2,7 +2,7 @@ import { jsx as _jsx } from 'react/jsx-runtime'\n import styles from './index.module.css'\n \n export function MyContainer({ children, className, ...props }) {\n-  return /*#__PURE__*/ _jsx('dev', {\n+  return /*#__PURE__*/ _jsx('p', {\n     ...props,\n     className: `${styles.button_my_container} ${className ?? ''}`,\n     children: children,"
        },
        {
            "sha": "083cc6f0a822ccac633dab0a1617e431922efdcc",
            "filename": "test/e2e/app-dir/css-order/css-order.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 14,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fcss-order.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fcss-order.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-order%2Fcss-order.test.ts?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -27,7 +27,6 @@ const PAGES: Record<\n     conflict?: boolean\n     brokenLoading?: boolean\n     brokenLoadingDev?: boolean\n-    brokenLoadingTurbo?: boolean\n   }\n > = {\n   first: {\n@@ -62,16 +61,12 @@ const PAGES: Record<\n   },\n   'interleaved-a': {\n     group: 'interleaved',\n-    // TODO fix this case\n-    brokenLoadingTurbo: true,\n     url: '/interleaved/a',\n     selector: '#helloia',\n     color: 'rgb(0, 255, 0)',\n   },\n   'interleaved-b': {\n     group: 'interleaved',\n-    // TODO fix this case\n-    brokenLoadingTurbo: true,\n     url: '/interleaved/b',\n     selector: '#helloib',\n     color: 'rgb(255, 0, 255)',\n@@ -244,10 +239,6 @@ describe.each(process.env.TURBOPACK ? ['turbo'] : ['strict', true])(\n       // TODO fix this case\n       let broken =\n         isNextDev || ordering.some((page) => PAGES[page].brokenLoading)\n-      if (mode === 'turbo') {\n-        // TODO fix this case\n-        broken ||= ordering.some((page) => PAGES[page].brokenLoadingTurbo)\n-      }\n       if (broken) {\n         it.todo(name)\n         continue\n@@ -304,10 +295,6 @@ describe.each(process.env.TURBOPACK ? ['turbo'] : ['strict', 'loose'])(\n           PAGES[page].brokenLoading ||\n           (isNextDev && PAGES[page].brokenLoadingDev)\n       )\n-      if (mode === 'turbo') {\n-        // TODO fix this case\n-        broken ||= ordering.some((page) => PAGES[page].brokenLoadingTurbo)\n-      }\n       if (broken) {\n         it.todo(name)\n         continue\n@@ -341,7 +328,7 @@ describe.each(process.env.TURBOPACK ? ['turbo'] : ['strict', 'loose'])(\n     const { next } = nextTestSetup(options(mode))\n     for (const [page, pageInfo] of Object.entries(PAGES)) {\n       const name = `should load correct styles on ${page}`\n-      if (mode === 'loose' && pageInfo.conflict) {\n+      if (mode !== 'strict' && pageInfo.conflict) {\n         // Conflict scenarios won't support that case\n         continue\n       }"
        },
        {
            "sha": "4590197ecffc66d7b3c318f49c8290e46cc710d7",
            "filename": "test/integration/css-fixtures/url-global/styles/global1.css",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss-fixtures%2Furl-global%2Fstyles%2Fglobal1.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss-fixtures%2Furl-global%2Fstyles%2Fglobal1.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-fixtures%2Furl-global%2Fstyles%2Fglobal1.css?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -1,4 +1,4 @@\n .red-text {\n   color: red;\n-  background-image: url('./dark.svg') url(dark2.svg);\n+  background-image: url('./dark.svg'), url(dark2.svg);\n }"
        },
        {
            "sha": "aff47e9f358cf25ab61a827efb8e07ec5013f380",
            "filename": "test/integration/css/test/basic-global-support.test.js",
            "status": "modified",
            "additions": 20,
            "deletions": 16,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -576,9 +576,10 @@ module.exports = {\n           if (process.env.TURBOPACK && useLightningcss) {\n             expect(cssContent).toMatchInlineSnapshot(`\n              [\n-               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_global1_69590c47.css:\n-             .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\",\n-               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_3a258468._.css:\n+               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_46281715._.css:\n+             .red-text{color:red;background-image:url(../media/dark.993bedd3.svg),url(../media/dark2.993bedd3.svg)}\n+\n+\n              .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n \n@@ -588,9 +589,10 @@ module.exports = {\n           } else if (process.env.TURBOPACK && !useLightningcss) {\n             expect(cssContent).toMatchInlineSnapshot(`\n              [\n-               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_global1_69590c47.css:\n-             .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\",\n-               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_3a258468._.css:\n+               \"/_next/static/chunks/test_integration_css-fixtures_url-global_styles_46281715._.css:\n+             .red-text{color:red;background-image:url(../media/dark.993bedd3.svg),url(../media/dark2.993bedd3.svg)}\n+\n+\n              .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n \n@@ -600,15 +602,15 @@ module.exports = {\n           } else if (useLightningcss) {\n             expect(cssContent).toMatchInlineSnapshot(`\n              [\n-               \"/_next/static/css/b52d68d7050c7314.css:\n-             .red-text{color:red;background-image:url(/_next/static/media/dark.6b01655b.svg) url(/_next/static/media/dark2.6b01655b.svg)}.blue-text{color:orange;background-image:url(/_next/static/media/light.2da1d3d6.svg);font-weight:bolder;color:#00f}\",\n+               \"/_next/static/css/02830b0dd136adeb.css:\n+             .red-text{color:red;background-image:url(/_next/static/media/dark.6b01655b.svg),url(/_next/static/media/dark2.6b01655b.svg)}.blue-text{color:orange;background-image:url(/_next/static/media/light.2da1d3d6.svg);font-weight:bolder;color:#00f}\",\n              ]\n             `)\n           } else {\n             expect(cssContent).toMatchInlineSnapshot(`\n              [\n-               \"/_next/static/css/766d42b9536ee6bb.css:\n-             .red-text{color:red;background-image:url(/_next/static/media/dark.6b01655b.svg) url(/_next/static/media/dark2.6b01655b.svg)}.blue-text{color:orange;font-weight:bolder;background-image:url(/_next/static/media/light.2da1d3d6.svg);color:blue}\",\n+               \"/_next/static/css/bf86b6e30872ca37.css:\n+             .red-text{color:red;background-image:url(/_next/static/media/dark.6b01655b.svg),url(/_next/static/media/dark2.6b01655b.svg)}.blue-text{color:orange;font-weight:bolder;background-image:url(/_next/static/media/light.2da1d3d6.svg);color:blue}\",\n              ]\n             `)\n           }\n@@ -651,9 +653,10 @@ describe('CSS URL via `file-loader` and asset prefix (1)', () => {\n         if (process.env.TURBOPACK) {\n           expect(cssContent).toMatchInlineSnapshot(`\n            [\n-             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-1_styles_global1_64764808.css:\n-           .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\",\n-             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-1_styles_0a127993._.css:\n+             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-1_styles_e99cb7f8._.css:\n+           .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\n+\n+\n            .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n \n@@ -706,9 +709,10 @@ describe('CSS URL via `file-loader` and asset prefix (2)', () => {\n         if (process.env.TURBOPACK) {\n           expect(cssContent).toMatchInlineSnapshot(`\n            [\n-             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-2_styles_global1_cfbf8de3.css:\n-           .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\",\n-             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-2_styles_764eafae._.css:\n+             \"/_next/static/chunks/test_integration_css-fixtures_url-global-asset-prefix-2_styles_7b29c72b._.css:\n+           .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\n+\n+\n            .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n "
        },
        {
            "sha": "2e70879fda99ac38108e0f0e38a6745dc7619a1f",
            "filename": "test/integration/css/test/css-rendering.test.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss%2Ftest%2Fcss-rendering.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fintegration%2Fcss%2Ftest%2Fcss-rendering.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fcss-rendering.test.js?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -362,7 +362,8 @@ module.exports = {\n         })\n       }\n \n-      ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n+      // This test case will fail in Turbopack when both pages share some css chunks. Deleting them will cause the / page to fail too.\n+      ;(process.env.TURBOPACK ? describe.skip : describe)(\n         'production mode',\n         () => {\n           beforeAll(async () => {"
        },
        {
            "sha": "997cdb5c80a80ad10ec821c43f03f35350d69a85",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 12,
            "deletions": 15,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -1565,6 +1565,7 @@\n       \"css-order turbo should load correct styles navigating back again pages-first -> pages-second -> pages-first -> pages-second\",\n       \"css-order turbo should load correct styles navigating back again pages-first -> pages-third -> pages-first -> pages-third\",\n       \"css-order turbo should load correct styles navigating back again pages-interleaved-a -> pages-interleaved-b -> pages-interleaved-a -> pages-interleaved-b\",\n+      \"css-order turbo should load correct styles navigating back again pages-interleaved-b -> pages-interleaved-a -> pages-interleaved-b -> pages-interleaved-a\",\n       \"css-order turbo should load correct styles navigating back again pages-second -> pages-first -> pages-second -> pages-first\",\n       \"css-order turbo should load correct styles navigating back again pages-second -> pages-third -> pages-second -> pages-third\",\n       \"css-order turbo should load correct styles navigating back again pages-third -> pages-first -> pages-third -> pages-first\",\n@@ -1592,6 +1593,7 @@\n       \"css-order turbo should load correct styles navigating pages-first -> pages-second\",\n       \"css-order turbo should load correct styles navigating pages-first -> pages-third\",\n       \"css-order turbo should load correct styles navigating pages-interleaved-a -> pages-interleaved-b\",\n+      \"css-order turbo should load correct styles navigating pages-interleaved-b -> pages-interleaved-a\",\n       \"css-order turbo should load correct styles navigating pages-second -> pages-first\",\n       \"css-order turbo should load correct styles navigating pages-second -> pages-third\",\n       \"css-order turbo should load correct styles navigating pages-third -> pages-first\",\n@@ -1620,31 +1622,25 @@\n       \"css-order turbo should load correct styles on pages-interleaved-a\",\n       \"css-order turbo should load correct styles on pages-interleaved-b\",\n       \"css-order turbo should load correct styles on pages-partial-reversed-a\",\n-      \"css-order turbo should load correct styles on pages-partial-reversed-b\",\n       \"css-order turbo should load correct styles on pages-reversed-a\",\n-      \"css-order turbo should load correct styles on pages-reversed-b\",\n       \"css-order turbo should load correct styles on pages-second\",\n       \"css-order turbo should load correct styles on pages-third\",\n-      \"css-order turbo should load correct styles on partial-reversed-a\",\n-      \"css-order turbo should load correct styles on partial-reversed-b\",\n-      \"css-order turbo should load correct styles on reversed-a\",\n-      \"css-order turbo should load correct styles on reversed-b\",\n       \"css-order turbo should load correct styles on second\",\n       \"css-order turbo should load correct styles on second-client\",\n       \"css-order turbo should load correct styles on third\",\n       \"css-order turbo should load correct styles on vendor\"\n     ],\n     \"failed\": [\n-      \"css-order turbo should load correct styles navigating back again pages-interleaved-b -> pages-interleaved-a -> pages-interleaved-b -> pages-interleaved-a\",\n       \"css-order turbo should load correct styles navigating back again pages-partial-reversed-a -> pages-partial-reversed-b -> pages-partial-reversed-a -> pages-partial-reversed-b\",\n       \"css-order turbo should load correct styles navigating back again pages-partial-reversed-b -> pages-partial-reversed-a -> pages-partial-reversed-b -> pages-partial-reversed-a\",\n       \"css-order turbo should load correct styles navigating back again pages-reversed-a -> pages-reversed-b -> pages-reversed-a -> pages-reversed-b\",\n       \"css-order turbo should load correct styles navigating back again pages-reversed-b -> pages-reversed-a -> pages-reversed-b -> pages-reversed-a\",\n-      \"css-order turbo should load correct styles navigating pages-interleaved-b -> pages-interleaved-a\",\n       \"css-order turbo should load correct styles navigating pages-partial-reversed-a -> pages-partial-reversed-b\",\n       \"css-order turbo should load correct styles navigating pages-partial-reversed-b -> pages-partial-reversed-a\",\n       \"css-order turbo should load correct styles navigating pages-reversed-a -> pages-reversed-b\",\n-      \"css-order turbo should load correct styles navigating pages-reversed-b -> pages-reversed-a\"\n+      \"css-order turbo should load correct styles navigating pages-reversed-b -> pages-reversed-a\",\n+      \"css-order turbo should load correct styles on pages-partial-reversed-b\",\n+      \"css-order turbo should load correct styles on pages-reversed-b\"\n     ],\n     \"pending\": [\n       \"css-order turbo should load correct styles navigating back again big-interleaved-a -> big-interleaved-b -> big-interleaved-a -> big-interleaved-b\",\n@@ -7274,15 +7270,16 @@\n       \"next/font import values Variable font without weight range\",\n       \"next/font import values page with font\",\n       \"next/font import values page with local fonts\",\n+      \"next/font preload page with fonts\",\n+      \"next/font should not have deprecation warning\"\n+    ],\n+    \"failed\": [\n       \"next/font preload font without preloadable subsets\",\n       \"next/font preload font without size adjust\",\n       \"next/font preload google fonts with multiple weights/styles\",\n-      \"next/font preload page with fonts\",\n       \"next/font preload page with local fonts\",\n-      \"next/font preload page without fonts\",\n-      \"next/font should not have deprecation warning\"\n+      \"next/font preload page without fonts\"\n     ],\n-    \"failed\": [],\n     \"pending\": [],\n     \"flakey\": [],\n     \"runtimeError\": false\n@@ -9705,13 +9702,13 @@\n       \"CSS Support Page hydrates with CSS and not waiting on dependencies useLightnincsss(true) production mode should hydrate black without dependencies manifest\",\n       \"CSS Support Page hydrates with CSS and not waiting on dependencies useLightnincsss(true) production mode should hydrate red without dependencies manifest\",\n       \"CSS Support Page hydrates with CSS and not waiting on dependencies useLightnincsss(true) production mode should route from black to red without dependencies\",\n-      \"CSS Support Page reload on CSS missing useLightnincsss(false) production mode should fall back to server-side transition on missing CSS\",\n-      \"CSS Support Page reload on CSS missing useLightnincsss(true) production mode should fall back to server-side transition on missing CSS\",\n       \"CSS Support production mode CSS Import from node_modules useLightnincsss(false) should fail the build\",\n       \"CSS Support production mode CSS Import from node_modules useLightnincsss(true) should fail the build\"\n     ],\n     \"failed\": [],\n     \"pending\": [\n+      \"CSS Support Page reload on CSS missing useLightnincsss(false) production mode should fall back to server-side transition on missing CSS\",\n+      \"CSS Support Page reload on CSS missing useLightnincsss(true) production mode should fall back to server-side transition on missing CSS\",\n       \"CSS Support CSS Cleanup on Render Failure useLightnincsss(false) production mode not have intermediary page styles on error rendering\",\n       \"CSS Support CSS Cleanup on Render Failure useLightnincsss(true) production mode not have intermediary page styles on error rendering\"\n     ],"
        },
        {
            "sha": "01d38d4ce28c80321416fc9d3174bc9835a9548d",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -350,7 +350,7 @@ async fn build_internal(\n                     builder = builder.chunking_config(\n                         Vc::<CssChunkType>::default().to_resolved().await?,\n                         ChunkingConfig {\n-                            min_chunk_size: 0,\n+                            max_merge_chunk_size: 100_000,\n                             ..Default::default()\n                         },\n                     );\n@@ -393,7 +393,7 @@ async fn build_internal(\n                     builder = builder.chunking_config(\n                         Vc::<CssChunkType>::default().to_resolved().await?,\n                         ChunkingConfig {\n-                            min_chunk_size: 0,\n+                            max_merge_chunk_size: 100_000,\n                             ..Default::default()\n                         },\n                     );"
        },
        {
            "sha": "15335508e494911f4729d72d764292bd8bcc25cc",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunk_item_batch.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_item_batch.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_item_batch.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_item_batch.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -20,7 +20,7 @@ use crate::{\n     },\n };\n \n-async fn attach_async_info_to_chunkable_module(\n+pub async fn attach_async_info_to_chunkable_module(\n     module: ResolvedVc<Box<dyn ChunkableModule>>,\n     async_module_info: &ReadRef<AsyncModulesInfo>,\n     module_graph: Vc<ModuleGraph>,\n@@ -105,13 +105,23 @@ impl ChunkItemOrBatchWithAsyncModuleInfo {\n }\n \n #[turbo_tasks::value]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n pub struct ChunkItemBatchWithAsyncModuleInfo {\n     pub chunk_items: Vec<ChunkItemWithAsyncModuleInfo>,\n     pub chunk_groups: Option<RoaringBitmapWrapper>,\n }\n \n #[turbo_tasks::value_impl]\n impl ChunkItemBatchWithAsyncModuleInfo {\n+    #[turbo_tasks::function]\n+    pub fn new(chunk_items: Vec<ChunkItemWithAsyncModuleInfo>) -> Vc<Self> {\n+        Self {\n+            chunk_items,\n+            chunk_groups: None,\n+        }\n+        .cell()\n+    }\n+\n     #[turbo_tasks::function]\n     pub async fn from_module_batch(\n         batch: Vc<ModuleBatch>,"
        },
        {
            "sha": "bc036f738ef6e2491a42cd55d6cae181b398c75c",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking/mod.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 13,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fmod.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -21,17 +21,17 @@ use crate::{\n         },\n         chunking::{\n             dev::{app_vendors_split, expand_batches},\n-            ordered_production::make_production_chunks_keeping_order,\n             production::make_production_chunks,\n+            style_production::make_style_production_chunks,\n         },\n     },\n     module_graph::ModuleGraph,\n     output::OutputAssets,\n };\n \n mod dev;\n-mod ordered_production;\n mod production;\n+mod style_production;\n \n #[turbo_tasks::value]\n struct ChunkItemsWithInfo {\n@@ -336,17 +336,18 @@ pub async fn make_chunks(\n \n             if let Some(chunking_config) = chunking_configs.get(&ty) {\n                 // Production chunking\n-                if !*ty.must_keep_item_order().await? {\n-                    make_production_chunks(\n+                if *ty.is_style().await? {\n+                    make_style_production_chunks(\n                         chunk_items,\n                         batch_groups.into_iter().collect(),\n                         module_graph,\n+                        chunking_context,\n                         chunking_config,\n                         split_context,\n                     )\n                     .await?;\n                 } else {\n-                    make_production_chunks_keeping_order(\n+                    make_production_chunks(\n                         chunk_items,\n                         batch_groups.into_iter().collect(),\n                         module_graph,\n@@ -357,20 +358,20 @@ pub async fn make_chunks(\n                 }\n             } else {\n                 // Development chunking\n-                if !*ty.must_keep_item_order().await? {\n-                    let chunk_items = expand_batches(chunk_items, ty, chunking_context).await?;\n-                    let chunk_items = chunk_items.iter().collect();\n-                    app_vendors_split(\n+                if *ty.is_style().await? {\n+                    make_chunk(\n                         chunk_items,\n-                        format!(\"{key_prefix}{ty_name}\"),\n+                        Vec::new(),\n+                        &mut format!(\"{key_prefix}{ty_name}\"),\n                         &mut split_context,\n                     )\n                     .await?;\n                 } else {\n-                    make_chunk(\n+                    let chunk_items = expand_batches(chunk_items, ty, chunking_context).await?;\n+                    let chunk_items = chunk_items.iter().collect();\n+                    app_vendors_split(\n                         chunk_items,\n-                        Vec::new(),\n-                        &mut format!(\"{key_prefix}{ty_name}\"),\n+                        format!(\"{key_prefix}{ty_name}\"),\n                         &mut split_context,\n                     )\n                     .await?;"
        },
        {
            "sha": "ff0000600deaa3206e60349c28f7064cbcc99f88",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking/ordered_production.rs",
            "status": "removed",
            "additions": 0,
            "deletions": 39,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/13ad46619db5a49160972ab46288e78e9e35519d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fordered_production.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/13ad46619db5a49160972ab46288e78e9e35519d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fordered_production.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fordered_production.rs?ref=13ad46619db5a49160972ab46288e78e9e35519d",
            "patch": "@@ -1,39 +0,0 @@\n-use anyhow::Result;\n-use tracing::Instrument;\n-use turbo_tasks::{ResolvedVc, Vc};\n-\n-use crate::{\n-    chunk::{\n-        chunking::{make_chunk, ChunkItemOrBatchWithInfo, SplitContext},\n-        ChunkItemBatchGroup, ChunkingConfig,\n-    },\n-    module_graph::ModuleGraph,\n-};\n-\n-pub async fn make_production_chunks_keeping_order(\n-    chunk_items: Vec<&ChunkItemOrBatchWithInfo>,\n-    _batch_groups: Vec<ResolvedVc<ChunkItemBatchGroup>>,\n-    _module_graph: Vc<ModuleGraph>,\n-    _chunking_config: &ChunkingConfig,\n-    mut split_context: SplitContext<'_>,\n-) -> Result<()> {\n-    let span_outer = tracing::info_span!(\n-        \"make production chunks keeping order\",\n-        chunk_items = chunk_items.len(),\n-    );\n-    async move {\n-        for chunk_item in chunk_items {\n-            make_chunk(\n-                vec![chunk_item],\n-                vec![],\n-                &mut String::new(),\n-                &mut split_context,\n-            )\n-            .await?;\n-        }\n-\n-        Ok(())\n-    }\n-    .instrument(span_outer)\n-    .await\n-}"
        },
        {
            "sha": "1278520c13429649349823aa29995940a61bd340",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking/style_production.rs",
            "status": "added",
            "additions": 79,
            "deletions": 0,
            "changes": 79,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fstyle_production.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fstyle_production.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking%2Fstyle_production.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -0,0 +1,79 @@\n+use anyhow::Result;\n+use rustc_hash::FxHashSet;\n+use tracing::Instrument;\n+use turbo_tasks::{ResolvedVc, Vc};\n+\n+use crate::{\n+    chunk::{\n+        chunking::{make_chunk, ChunkItemOrBatchWithInfo, SplitContext},\n+        ChunkItemBatchGroup, ChunkItemWithAsyncModuleInfo, ChunkingConfig, ChunkingContext,\n+    },\n+    module_graph::{style_groups::StyleGroupsConfig, ModuleGraph},\n+};\n+\n+pub async fn make_style_production_chunks(\n+    chunk_items: Vec<&ChunkItemOrBatchWithInfo>,\n+    _batch_groups: Vec<ResolvedVc<ChunkItemBatchGroup>>,\n+    module_graph: Vc<ModuleGraph>,\n+    chunking_context: Vc<Box<dyn ChunkingContext>>,\n+    chunking_config: &ChunkingConfig,\n+    mut split_context: SplitContext<'_>,\n+) -> Result<()> {\n+    let span_outer = tracing::info_span!(\n+        \"make production chunks keeping order\",\n+        chunk_items = chunk_items.len(),\n+    );\n+    async move {\n+        let style_groups = module_graph\n+            .style_groups(\n+                chunking_context,\n+                StyleGroupsConfig {\n+                    max_chunk_size: chunking_config.max_merge_chunk_size,\n+                },\n+            )\n+            .await?;\n+        let mut handled = FxHashSet::default();\n+        let mut handle_chunk_item = async |chunk_item: &ChunkItemWithAsyncModuleInfo| {\n+            if let Some(&batch) = style_groups.shared_chunk_items.get(chunk_item) {\n+                if handled.insert(batch) {\n+                    make_chunk(\n+                        vec![&ChunkItemOrBatchWithInfo::Batch { batch, size: 0 }],\n+                        vec![],\n+                        &mut String::new(),\n+                        &mut split_context,\n+                    )\n+                    .await?;\n+                }\n+            } else {\n+                make_chunk(\n+                    vec![&ChunkItemOrBatchWithInfo::ChunkItem {\n+                        chunk_item: chunk_item.clone(),\n+                        size: 0,\n+                        asset_ident: \"\".into(),\n+                    }],\n+                    vec![],\n+                    &mut String::new(),\n+                    &mut split_context,\n+                )\n+                .await?;\n+            }\n+            anyhow::Ok(())\n+        };\n+        for chunk_item in chunk_items {\n+            match chunk_item {\n+                ChunkItemOrBatchWithInfo::ChunkItem { chunk_item, .. } => {\n+                    handle_chunk_item(chunk_item).await?;\n+                }\n+                ChunkItemOrBatchWithInfo::Batch { batch, .. } => {\n+                    for chunk_item in &batch.await?.chunk_items {\n+                        handle_chunk_item(chunk_item).await?;\n+                    }\n+                }\n+            };\n+        }\n+\n+        Ok(())\n+    }\n+    .instrument(span_outer)\n+    .await\n+}"
        },
        {
            "sha": "4419e08d5ca253fbec11447f4533ff9e12987147",
            "filename": "turbopack/crates/turbopack-core/src/chunk/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -310,7 +310,7 @@ pub trait ChunkItem {\n #[turbo_tasks::value_trait]\n pub trait ChunkType: ValueToString {\n     /// Whether the source (reference) order of items needs to be retained during chunking.\n-    fn must_keep_item_order(self: Vc<Self>) -> Vc<bool>;\n+    fn is_style(self: Vc<Self>) -> Vc<bool>;\n \n     /// Create a new chunk for the given chunk items\n     fn chunk(\n@@ -417,6 +417,8 @@ mod tests {\n         assert_eq!(round_chunk_item_size(6), 6);\n         assert_eq!(round_chunk_item_size(7), 6);\n         assert_eq!(round_chunk_item_size(8), 8);\n+        assert_eq!(round_chunk_item_size(49000), 32_768);\n+        assert_eq!(round_chunk_item_size(50000), 49_152);\n \n         assert_eq!(changes_in_range(0..1000), 19);\n         assert_eq!(changes_in_range(1000..2000), 2);"
        },
        {
            "sha": "31f4f68a12110f819791fcdb90507cf8a3f2c5d0",
            "filename": "turbopack/crates/turbopack-core/src/module.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -1,7 +1,17 @@\n-use turbo_tasks::{ResolvedVc, Vc};\n+use serde::{Deserialize, Serialize};\n+use turbo_tasks::{trace::TraceRawVcs, NonLocalValue, ResolvedVc, Vc};\n \n use crate::{asset::Asset, ident::AssetIdent, reference::ModuleReferences};\n \n+#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq, Eq, TraceRawVcs, NonLocalValue)]\n+pub enum StyleType {\n+    IsolatedStyle,\n+    GlobalStyle,\n+}\n+\n+#[turbo_tasks::value(transparent)]\n+pub struct OptionStyleType(Option<StyleType>);\n+\n /// A module. This usually represents parsed source code, which has references\n /// to other modules.\n #[turbo_tasks::value_trait]\n@@ -20,6 +30,11 @@ pub trait Module: Asset {\n     fn is_self_async(self: Vc<Self>) -> Vc<bool> {\n         Vc::cell(false)\n     }\n+\n+    /// The style type of the module.\n+    fn style_type(self: Vc<Self>) -> Vc<OptionStyleType> {\n+        Vc::cell(None)\n+    }\n }\n \n #[turbo_tasks::value(transparent)]"
        },
        {
            "sha": "5bf545577c9c7c0679dcf72773d26a4d8115d869",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -20,13 +20,14 @@ use turbo_tasks::{\n };\n \n use crate::{\n-    chunk::{AsyncModuleInfo, ChunkingType},\n+    chunk::{AsyncModuleInfo, ChunkingContext, ChunkingType},\n     issue::Issue,\n     module::Module,\n     module_graph::{\n         async_module_info::{compute_async_module_info, AsyncModulesInfo},\n         chunk_group_info::{compute_chunk_group_info, ChunkGroupEntry, ChunkGroupInfo},\n         module_batches::{compute_module_batches, ModuleBatchesGraph},\n+        style_groups::{compute_style_groups, StyleGroups, StyleGroupsConfig},\n         traced_di_graph::{iter_neighbors_rev, TracedDiGraph},\n     },\n     reference::primary_chunkable_referenced_modules,\n@@ -36,6 +37,7 @@ pub mod async_module_info;\n pub mod chunk_group_info;\n pub mod module_batch;\n pub(crate) mod module_batches;\n+pub(crate) mod style_groups;\n mod traced_di_graph;\n \n pub use self::module_batches::BatchingConfig;\n@@ -730,10 +732,18 @@ impl ModuleGraph {\n         self: Vc<Self>,\n         config: Vc<BatchingConfig>,\n     ) -> Result<Vc<ModuleBatchesGraph>> {\n-        // TODO dev: Return modules only\n         compute_module_batches(self, &*config.await?).await\n     }\n \n+    #[turbo_tasks::function]\n+    pub async fn style_groups(\n+        self: Vc<Self>,\n+        chunking_context: Vc<Box<dyn ChunkingContext>>,\n+        config: StyleGroupsConfig,\n+    ) -> Result<Vc<StyleGroups>> {\n+        compute_style_groups(self, chunking_context, &config).await\n+    }\n+\n     #[turbo_tasks::function]\n     pub async fn async_module_info(self: Vc<Self>) -> Result<Vc<AsyncModulesInfo>> {\n         // `compute_async_module_info` calls `module.is_self_async()`, so we need to again ignore"
        },
        {
            "sha": "628e7130860c6b47c591ea15864f722b34294ba5",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/style_groups.rs",
            "status": "added",
            "additions": 401,
            "deletions": 0,
            "changes": 401,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fstyle_groups.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fstyle_groups.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fstyle_groups.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -0,0 +1,401 @@\n+use std::cmp::Reverse;\n+\n+use anyhow::Result;\n+use indexmap::map::Entry;\n+use rustc_hash::{FxHashMap, FxHashSet};\n+use serde::{Deserialize, Serialize};\n+use turbo_rcstr::RcStr;\n+use turbo_tasks::{\n+    trace::TraceRawVcs, FxIndexMap, FxIndexSet, NonLocalValue, ResolvedVc, TaskInput,\n+    TryJoinIterExt, ValueToString, Vc,\n+};\n+\n+use crate::{\n+    chunk::{\n+        chunk_item_batch::attach_async_info_to_chunkable_module, ChunkItem,\n+        ChunkItemBatchWithAsyncModuleInfo, ChunkItemWithAsyncModuleInfo, ChunkType,\n+        ChunkableModule, ChunkingContext, ChunkingType,\n+    },\n+    module::{Module, StyleType},\n+    module_graph::{\n+        module_batch::ModuleOrBatch, module_batches::ModuleBatchesGraphEdge, GraphTraversalAction,\n+        ModuleGraph,\n+    },\n+};\n+\n+#[derive(\n+    TaskInput, Debug, Clone, PartialEq, Eq, Hash, Serialize, Deserialize, NonLocalValue, TraceRawVcs,\n+)]\n+pub struct StyleGroupsConfig {\n+    pub max_chunk_size: usize,\n+}\n+\n+/// Styling must not be duplicated in the application. The simplest way to achieve this is to put\n+/// every styling chunk item into a separate chunk. That works, but isn't efficient since it would\n+/// cause a lot of requests. Instead we multiple chunk items are groups together and placed in a\n+/// single shared chunk. `StyleGroups` specifies how chunk items are grouped together.\n+#[turbo_tasks::value]\n+pub struct StyleGroups {\n+    /// The key chunk item is contained in the value chunk item batch. All chunk items that are not\n+    /// contained in this map are placed in a separate chunk per chunk item.\n+    pub shared_chunk_items:\n+        FxIndexMap<ChunkItemWithAsyncModuleInfo, ResolvedVc<ChunkItemBatchWithAsyncModuleInfo>>,\n+}\n+\n+#[derive(Debug)]\n+struct ModuleInfo {\n+    style_type: StyleType,\n+    ident: RcStr,\n+    chunk_group_indicies: FxHashMap<usize, usize>,\n+    index_sum: usize,\n+    size: usize,\n+    chunk_item: Option<ChunkItemWithAsyncModuleInfo>,\n+}\n+\n+impl ModuleInfo {\n+    fn new(style_type: StyleType, ident: RcStr) -> Self {\n+        Self {\n+            style_type,\n+            ident,\n+            chunk_group_indicies: Default::default(),\n+            index_sum: 0,\n+            size: 0,\n+            chunk_item: None,\n+        }\n+    }\n+}\n+\n+struct ChunkGroupState {\n+    styles: FxIndexSet<ResolvedVc<Box<dyn ChunkableModule>>>,\n+    requests: usize,\n+}\n+\n+pub async fn compute_style_groups(\n+    module_graph: Vc<ModuleGraph>,\n+    chunking_context: Vc<Box<dyn ChunkingContext>>,\n+    config: &StyleGroupsConfig,\n+) -> Result<Vc<StyleGroups>> {\n+    let chunk_group_info = module_graph.chunk_group_info().await?;\n+    let batches_graph = module_graph\n+        .module_batches(chunking_context.batching_config())\n+        .await?;\n+    let async_info = module_graph.async_module_info().await?;\n+    let mut module_info_map: FxIndexMap<ResolvedVc<Box<dyn ChunkableModule>>, Option<ModuleInfo>> =\n+        FxIndexMap::default();\n+\n+    // Compute the style modules in each chunk group\n+    let mut chunk_group_state = Vec::new();\n+    let mut idx = 0;\n+    for (i, chunk_group) in chunk_group_info.chunk_groups.iter().enumerate() {\n+        let ordered_entries = batches_graph.get_ordered_entries(&chunk_group_info, i);\n+        let mut entries = Vec::with_capacity(chunk_group.entries_count());\n+        for entry in ordered_entries {\n+            entries.push(batches_graph.get_entry_index(entry).await?);\n+        }\n+        let mut visited = FxHashSet::default();\n+        let mut items_in_postorder = FxIndexSet::default();\n+        batches_graph.traverse_edges_from_entries_topological(\n+            entries.iter().copied(),\n+            &mut (),\n+            |parent_info, module, _| {\n+                if let Some((_, ModuleBatchesGraphEdge { ty, .. })) = parent_info {\n+                    if !matches!(\n+                        ty,\n+                        ChunkingType::Parallel | ChunkingType::ParallelInheritAsync\n+                    ) {\n+                        return Ok(GraphTraversalAction::Exclude);\n+                    }\n+                }\n+                if visited.insert(module) {\n+                    Ok(GraphTraversalAction::Continue)\n+                } else {\n+                    Ok(GraphTraversalAction::Exclude)\n+                }\n+            },\n+            |parent_info, item, _| {\n+                if let Some((_, ModuleBatchesGraphEdge { ty, .. })) = parent_info {\n+                    if !matches!(\n+                        ty,\n+                        ChunkingType::Parallel | ChunkingType::ParallelInheritAsync\n+                    ) {\n+                        return;\n+                    }\n+                }\n+                items_in_postorder.insert(*item);\n+            },\n+        )?;\n+\n+        let mut styles = FxIndexSet::default();\n+        let mut handle_module = async |module| {\n+            match module_info_map.entry(module) {\n+                Entry::Occupied(mut e) => {\n+                    if let Some(info) = e.get_mut() {\n+                        info.chunk_group_indicies.insert(idx, styles.len());\n+                        info.index_sum += styles.len();\n+                        styles.insert(module);\n+                    }\n+                }\n+                Entry::Vacant(e) => {\n+                    let style_type = *module.style_type().await?;\n+                    if let Some(style_type) = style_type {\n+                        let mut info =\n+                            ModuleInfo::new(style_type, module.ident().to_string().owned().await?);\n+                        info.chunk_group_indicies.insert(idx, styles.len());\n+                        info.index_sum += styles.len();\n+                        styles.insert(module);\n+                        e.insert(Some(info));\n+                    } else {\n+                        e.insert(None);\n+                    }\n+                }\n+            }\n+            anyhow::Ok(())\n+        };\n+\n+        for item in items_in_postorder {\n+            match item {\n+                ModuleOrBatch::Batch(batch) => {\n+                    for &module in &batch.await?.modules {\n+                        handle_module(module).await?;\n+                    }\n+                }\n+                ModuleOrBatch::Module(module) => {\n+                    if let Some(chunkable_module) = ResolvedVc::try_downcast(module) {\n+                        handle_module(chunkable_module).await?;\n+                    }\n+                }\n+                ModuleOrBatch::None(_) => {}\n+            }\n+        }\n+\n+        if !styles.is_empty() {\n+            chunk_group_state.push(ChunkGroupState {\n+                requests: styles.len(),\n+                styles,\n+            });\n+            idx += 1;\n+        }\n+    }\n+\n+    module_info_map.retain(|_, info| info.is_some());\n+\n+    module_info_map.sort_by(|_, a, _, b| {\n+        let a = a.as_ref().unwrap();\n+        let b = b.as_ref().unwrap();\n+        a.index_sum\n+            .cmp(&b.index_sum)\n+            .then_with(|| a.ident.cmp(&b.ident))\n+    });\n+\n+    // Compute the dependents of each module\n+    let mut module_dependents: FxHashMap<_, Vec<_>> = FxHashMap::default();\n+    for (&module, info) in &module_info_map {\n+        let info = info.as_ref().unwrap();\n+        // Find the shortest chunk group as it's most efficient to iterate\n+        let (&idx, &start_pos) = info\n+            .chunk_group_indicies\n+            .iter()\n+            .min_by_key(|&(&idx, _)| chunk_group_state[idx].styles.len())\n+            .unwrap();\n+        let potential_dependents = &chunk_group_state[idx].styles[start_pos + 1..];\n+\n+        let dependents = potential_dependents\n+            .iter()\n+            .copied()\n+            .filter(|dependent| {\n+                let dependent_info = module_info_map.get(dependent).unwrap();\n+                let dependent_info = dependent_info.as_ref().unwrap();\n+\n+                // module is a dependency of dependent when it's included in all chunk groups of\n+                // dependent with an index lower than the index of the dependent\n+                let is_dependent =\n+                    info.chunk_group_indicies.len() >= dependent_info.chunk_group_indicies.len()\n+                        && dependent_info.chunk_group_indicies.iter().all(\n+                            |(idx, &dependent_pos)| {\n+                                info.chunk_group_indicies\n+                                    .get(idx)\n+                                    .is_some_and(|&module_pos| module_pos < dependent_pos)\n+                            },\n+                        );\n+                is_dependent\n+            })\n+            .collect::<Vec<_>>();\n+\n+        if !dependents.is_empty() {\n+            module_dependents.insert(module, dependents);\n+        }\n+    }\n+\n+    // Compute the chunk item and size of each module\n+    let chunk_item_and_sizes = module_info_map\n+        .keys()\n+        .map(async |&module| {\n+            let chunk_item = attach_async_info_to_chunkable_module(\n+                module,\n+                &async_info,\n+                module_graph,\n+                chunking_context,\n+            )\n+            .await?;\n+            let ty = chunk_item.chunk_item.ty();\n+            let size = *ty\n+                .chunk_item_size(chunking_context, *chunk_item.chunk_item, None)\n+                .await?;\n+            Ok((chunk_item, size))\n+        })\n+        .try_join()\n+        .await?;\n+    module_info_map\n+        .iter_mut()\n+        .zip(chunk_item_and_sizes)\n+        .for_each(|((_, info), (chunk_item, size))| {\n+            let info = info.as_mut().unwrap();\n+            info.size = size;\n+            info.chunk_item = Some(chunk_item);\n+        });\n+\n+    let mut ordered_modules_with_state = module_info_map\n+        .keys()\n+        .copied()\n+        .map(|m| (m, false))\n+        .collect::<FxIndexMap<_, _>>();\n+\n+    let mut shared_chunk_items = FxIndexMap::default();\n+    for i in 0..ordered_modules_with_state.len() {\n+        let (&module, processed) = ordered_modules_with_state.get_index_mut(i).unwrap();\n+        if *processed {\n+            continue;\n+        }\n+        *processed = true;\n+\n+        let info = module_info_map.get(&module).unwrap().as_ref().unwrap();\n+        let mut global_mode = info.style_type == StyleType::GlobalStyle;\n+\n+        // The current position of processing in all selected chunk groups\n+        let mut all_chunk_states = info.chunk_group_indicies.clone();\n+\n+        // The list of modules and chunk items that go into the new chunk\n+        let mut new_chunk_modules = [module].into_iter().collect::<FxHashSet<_>>();\n+        let mut new_chunk_items = vec![info.chunk_item.as_ref().unwrap().clone()];\n+\n+        // The current size of the new chunk\n+        let mut current_size = info.size;\n+\n+        // A pool of potential modules where the next module is selected from.\n+        // It's filled from the next module of the selected modules in every chunk group.\n+        let mut potential_next_modules = all_chunk_states\n+            .iter()\n+            .filter_map(|(&idx, pos)| {\n+                let following_styles = &chunk_group_state[idx].styles[pos + 1..];\n+                let i = following_styles\n+                    .iter()\n+                    .position(|m| !*ordered_modules_with_state.get(m).unwrap());\n+                i.map(|i| following_styles[i])\n+            })\n+            .collect::<FxHashSet<_>>();\n+\n+        // Try to add modules to the chunk until a break condition is met\n+        'outer: loop {\n+            // We try to select a module that reduces request count and\n+            // has the highest number of requests\n+            let mut ordered_potential_next_modules = potential_next_modules\n+                .iter()\n+                .copied()\n+                .map(|module| {\n+                    let info = module_info_map.get(&module).unwrap().as_ref().unwrap();\n+                    let requests = info\n+                        .chunk_group_indicies\n+                        .keys()\n+                        .filter(|idx| all_chunk_states.contains_key(idx))\n+                        .map(|&idx| chunk_group_state[idx].requests)\n+                        .max()\n+                        .unwrap();\n+                    (module, info, requests)\n+                })\n+                .collect::<Vec<_>>();\n+            ordered_potential_next_modules\n+                .sort_by_key(|(_, info, requests)| (Reverse(*requests), &info.ident));\n+\n+            // Try every potential module\n+            for (module, info, _) in ordered_potential_next_modules {\n+                if current_size + info.size > config.max_chunk_size {\n+                    // Chunk would be too large\n+                    continue;\n+                }\n+                // In loose mode we only check if the dependencies are not violated\n+                if let Some(dependents) = module_dependents.get(&module) {\n+                    if dependents.iter().any(|m| new_chunk_modules.contains(m)) {\n+                        // A dependent of the module is already in the chunk, which would violate\n+                        // the order\n+                        continue;\n+                    }\n+                }\n+\n+                // Global CSS must not leak into unrelated chunks\n+                let is_global = info.style_type == StyleType::GlobalStyle;\n+                if is_global\n+                    && global_mode\n+                    && all_chunk_states.len() != info.chunk_group_indicies.len()\n+                {\n+                    // Fast check: chunk groups need to be identical\n+                    continue;\n+                }\n+                if global_mode\n+                    && info\n+                        .chunk_group_indicies\n+                        .keys()\n+                        .any(|idx| !all_chunk_states.contains_key(idx))\n+                {\n+                    // Global CSS in new_chunk_items would leak into new chunk_group\n+                    continue;\n+                }\n+                if is_global\n+                    && all_chunk_states\n+                        .keys()\n+                        .any(|idx| !info.chunk_group_indicies.contains_key(idx))\n+                {\n+                    // Global CSS would leak into existing chunk_group\n+                    continue;\n+                }\n+                potential_next_modules.remove(&module);\n+                current_size += info.size;\n+                if is_global {\n+                    global_mode = true;\n+                }\n+                for &idx in info.chunk_group_indicies.keys() {\n+                    if all_chunk_states.contains_key(&idx) {\n+                        // This reduces the request count of the chunk group\n+                        chunk_group_state[idx].requests -= 1;\n+                    }\n+                    let pos = chunk_group_state[idx].styles.get_index_of(&module).unwrap();\n+                    all_chunk_states.insert(idx, pos);\n+                    let following_styles = &chunk_group_state[idx].styles[pos + 1..];\n+                    if let Some(i) = following_styles.iter().position(|m| {\n+                        !*ordered_modules_with_state.get(m).unwrap()\n+                            && !new_chunk_modules.contains(m)\n+                    }) {\n+                        let module = following_styles[i];\n+                        potential_next_modules.insert(module);\n+                    }\n+                }\n+\n+                new_chunk_items.push(info.chunk_item.as_ref().unwrap().clone());\n+                new_chunk_modules.insert(module);\n+                *ordered_modules_with_state.get_mut(&module).unwrap() = true;\n+                continue 'outer;\n+            }\n+            break;\n+        }\n+\n+        if new_chunk_items.len() > 1 {\n+            let style_group = ChunkItemBatchWithAsyncModuleInfo::new(new_chunk_items.clone())\n+                .to_resolved()\n+                .await?;\n+            for chunk_item in new_chunk_items {\n+                shared_chunk_items.insert(chunk_item, style_group);\n+            }\n+        }\n+    }\n+\n+    Ok(StyleGroups { shared_chunk_items }.cell())\n+}"
        },
        {
            "sha": "06abe767af7f43119170ddba2d96fea5a060fde1",
            "filename": "turbopack/crates/turbopack-css/src/asset.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -7,7 +7,7 @@ use turbopack_core::{\n     chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, MinifyType},\n     context::AssetContext,\n     ident::AssetIdent,\n-    module::Module,\n+    module::{Module, OptionStyleType, StyleType},\n     module_graph::ModuleGraph,\n     output::OutputAssets,\n     reference::{ModuleReference, ModuleReferences},\n@@ -133,6 +133,15 @@ impl Module for CssModuleAsset {\n             ParseCssResult::NotFound => Ok(ModuleReferences::empty()),\n         }\n     }\n+\n+    #[turbo_tasks::function]\n+    fn style_type(&self) -> Vc<OptionStyleType> {\n+        let style_type = match self.ty {\n+            CssModuleAssetType::Default => StyleType::GlobalStyle,\n+            CssModuleAssetType::Module => StyleType::IsolatedStyle,\n+        };\n+        Vc::cell(Some(style_type))\n+    }\n }\n \n #[turbo_tasks::value_impl]"
        },
        {
            "sha": "e893bede318f520d7fe6128c91077fa9c280b152",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -498,7 +498,7 @@ impl ValueToString for CssChunkType {\n #[turbo_tasks::value_impl]\n impl ChunkType for CssChunkType {\n     #[turbo_tasks::function]\n-    fn must_keep_item_order(self: Vc<Self>) -> Vc<bool> {\n+    fn is_style(self: Vc<Self>) -> Vc<bool> {\n         Vc::cell(true)\n     }\n "
        },
        {
            "sha": "e6879a874bf78f129c2344917f8846db688e3089",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/chunk_type.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -27,7 +27,7 @@ impl ValueToString for EcmascriptChunkType {\n #[turbo_tasks::value_impl]\n impl ChunkType for EcmascriptChunkType {\n     #[turbo_tasks::function]\n-    fn must_keep_item_order(self: Vc<Self>) -> Vc<bool> {\n+    fn is_style(self: Vc<Self>) -> Vc<bool> {\n         Vc::cell(false)\n     }\n "
        },
        {
            "sha": "0e58d2b0288edbea83ba9037ec54cb04528e88bf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9f68435d39665388995c984887562b6974c2ff98/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=9f68435d39665388995c984887562b6974c2ff98",
            "patch": "@@ -427,7 +427,7 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n     .chunking_config(\n         Vc::<CssChunkType>::default().to_resolved().await?,\n         ChunkingConfig {\n-            min_chunk_size: 0,\n+            max_merge_chunk_size: 100_000,\n             ..Default::default()\n         },\n     )"
        }
    ],
    "stats": {
        "total": 8035,
        "additions": 5719,
        "deletions": 2316
    }
}