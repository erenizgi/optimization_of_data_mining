{
    "author": "xusd320",
    "message": "chore(turbo-tasks-malloc): replace mimalloc-rspack to mimalloc (#87815)\n\nReplace the `mimalloc_rspack` to the orign `mimalloc`, since\n`mimalloc_rspack` is formerly aimed to support the `mimalloc` `v3`, but\n`mimalloc` already support `v3` feature now.",
    "sha": "a2502bdfdcd65854073f4ae94ce1872877ac7c15",
    "files": [
        {
            "sha": "2f3df224c9561d673cdbdf519db31618d809cc0a",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 16,
            "deletions": 17,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/a2502bdfdcd65854073f4ae94ce1872877ac7c15/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/a2502bdfdcd65854073f4ae94ce1872877ac7c15/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=a2502bdfdcd65854073f4ae94ce1872877ac7c15",
            "patch": "@@ -3642,6 +3642,17 @@ dependencies = [\n  \"windows-sys 0.48.0\",\n ]\n \n+[[package]]\n+name = \"libmimalloc-sys\"\n+version = \"0.1.44\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"667f4fec20f29dfc6bc7357c582d91796c169ad7e2fce709468aefeb2c099870\"\n+dependencies = [\n+ \"cc\",\n+ \"cty\",\n+ \"libc\",\n+]\n+\n [[package]]\n name = \"libunwind\"\n version = \"1.3.3\"\n@@ -3997,12 +4008,12 @@ dependencies = [\n ]\n \n [[package]]\n-name = \"mimalloc-rspack\"\n-version = \"0.2.4\"\n+name = \"mimalloc\"\n+version = \"0.1.48\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"de20bb33bf95d9c060030d53bcb5d5dc03cbbedfbd1dcda5f6f285b946dae2c0\"\n+checksum = \"e1ee66a4b64c74f4ef288bcbb9192ad9c3feaad75193129ac8509af543894fd8\"\n dependencies = [\n- \"rspack-libmimalloc-sys\",\n+ \"libmimalloc-sys\",\n ]\n \n [[package]]\n@@ -6042,17 +6053,6 @@ dependencies = [\n  \"serde\",\n ]\n \n-[[package]]\n-name = \"rspack-libmimalloc-sys\"\n-version = \"0.2.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4c741844b1fbe0cfbae8dfeb73b5e5fdc95daf7be58bdd72afb3fd85c86bccdb\"\n-dependencies = [\n- \"cc\",\n- \"cty\",\n- \"libc\",\n-]\n-\n [[package]]\n name = \"rstest\"\n version = \"0.16.0\"\n@@ -9444,8 +9444,7 @@ dependencies = [\n name = \"turbo-tasks-malloc\"\n version = \"0.1.0\"\n dependencies = [\n- \"mimalloc-rspack\",\n- \"rspack-libmimalloc-sys\",\n+ \"mimalloc\",\n ]\n \n [[package]]"
        },
        {
            "sha": "6fd2dc79406caf102e9b7ee637b6ce458c950363",
            "filename": "turbopack/crates/turbo-tasks-malloc/Cargo.toml",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/a2502bdfdcd65854073f4ae94ce1872877ac7c15/turbopack%2Fcrates%2Fturbo-tasks-malloc%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/a2502bdfdcd65854073f4ae94ce1872877ac7c15/turbopack%2Fcrates%2Fturbo-tasks-malloc%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-malloc%2FCargo.toml?ref=a2502bdfdcd65854073f4ae94ce1872877ac7c15",
            "patch": "@@ -10,21 +10,21 @@ autobenches = false\n bench = false\n \n [dependencies]\n-rspack-libmimalloc-sys = { version = \"0.2.4\", default-features = false, features = [], optional = true }\n+\n \n [target.'cfg(not(any(target_os = \"linux\", target_family = \"wasm\", target_env = \"musl\")))'.dependencies]\n-mimalloc-rspack = { version = \"0.2.4\", features = [\n+mimalloc = { version = \"0.1.48\", features = [\n   \"v3\",\n-  \"extended\"\n+  \"extended\",\n ], optional = true }\n \n [target.'cfg(all(target_os = \"linux\", not(any(target_family = \"wasm\", target_env = \"musl\"))))'.dependencies]\n-mimalloc-rspack = { version = \"0.2.4\", features = [\n+mimalloc = { version = \"0.1.48\", features = [\n   \"v3\",\n   \"extended\",\n   \"local_dynamic_tls\",\n ], optional = true }\n \n [features]\n-custom_allocator = [\"dep:mimalloc-rspack\", \"dep:rspack-libmimalloc-sys\"]\n+custom_allocator = [\"dep:mimalloc\"]\n default = [\"custom_allocator\"]"
        },
        {
            "sha": "4c13caec0aa6a77063da071d37c4572aa220a34e",
            "filename": "turbopack/crates/turbo-tasks-malloc/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a2502bdfdcd65854073f4ae94ce1872877ac7c15/turbopack%2Fcrates%2Fturbo-tasks-malloc%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a2502bdfdcd65854073f4ae94ce1872877ac7c15/turbopack%2Fcrates%2Fturbo-tasks-malloc%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-malloc%2Fsrc%2Flib.rs?ref=a2502bdfdcd65854073f4ae94ce1872877ac7c15",
            "patch": "@@ -118,7 +118,7 @@ fn base_alloc() -> &'static impl GlobalAlloc {\n         feature = \"custom_allocator\",\n         not(any(target_family = \"wasm\", target_env = \"musl\"))\n     ))]\n-    return &mimalloc_rspack::MiMalloc;\n+    return &mimalloc::MiMalloc;\n     #[cfg(any(\n         not(feature = \"custom_allocator\"),\n         any(target_family = \"wasm\", target_env = \"musl\")\n@@ -132,7 +132,7 @@ unsafe fn base_alloc_size(ptr: *const u8, layout: Layout) -> usize {\n         feature = \"custom_allocator\",\n         not(any(target_family = \"wasm\", target_env = \"musl\"))\n     ))]\n-    return unsafe { mimalloc_rspack::MiMalloc.usable_size(ptr) };\n+    return unsafe { mimalloc::MiMalloc.usable_size(ptr) };\n     #[cfg(any(\n         not(feature = \"custom_allocator\"),\n         any(target_family = \"wasm\", target_env = \"musl\")"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 23,
        "deletions": 24
    }
}