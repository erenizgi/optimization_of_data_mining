{
    "author": "bgw",
    "message": "chore: Update patricia_tree dependency, remove manual serde impls (#85785)\n\nRecent versions of `patricia_tree` have their own serde implementation which is more efficient than what we can do because it serializes the internal nodes in the tree, rather than the public observable key/value entry API.",
    "sha": "f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7",
    "files": [
        {
            "sha": "e186925b866baf58c70d7790c657a03a77827ed6",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7",
            "patch": "@@ -4944,11 +4944,11 @@ checksum = \"8835116a5c179084a830efb3adc117ab007512b535bc1a21c991d3b32a6b44dd\"\n \n [[package]]\n name = \"patricia_tree\"\n-version = \"0.5.5\"\n+version = \"0.10.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"062a6297f2cd3969a780156ccb288eafb34bb5ed0f3c9a2b4500dbde869d4b86\"\n+checksum = \"4df0e43512f12f23a6b08c7b893192b7d6ec937b95ee03af040847907fe5cef7\"\n dependencies = [\n- \"bitflags 1.3.2\",\n+ \"serde\",\n ]\n \n [[package]]"
        },
        {
            "sha": "51f16c5af379fb7884699d3b348de61d3240acb2",
            "filename": "turbopack/crates/turbopack-core/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/turbopack%2Fcrates%2Fturbopack-core%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/turbopack%2Fcrates%2Fturbopack-core%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2FCargo.toml?ref=f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7",
            "patch": "@@ -23,7 +23,7 @@ data-encoding = { workspace = true }\n either = { workspace = true }\n indexmap = { workspace = true }\n once_cell = { workspace = true }\n-patricia_tree = \"0.5.5\"\n+patricia_tree = { version = \"0.10.1\", features = [\"serde\"] }\n petgraph = { workspace = true, features = [\"serde-1\"] }\n roaring = { workspace = true, features = [\"serde\"] }\n ref-cast = \"1.0.20\""
        },
        {
            "sha": "a6c85fdd18fe9bf49a6ea5748716f58f5f678f50",
            "filename": "turbopack/crates/turbopack-core/src/resolve/alias_map.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 66,
            "changes": 71,
            "blob_url": "https://github.com/vercel/next.js/blob/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Falias_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Falias_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Falias_map.rs?ref=f7b4a8f4a8697ff6324c2b2f5e8933ee7754b9e7",
            "patch": "@@ -6,12 +6,7 @@ use std::{\n \n use anyhow::Result;\n use patricia_tree::PatriciaMap;\n-use serde::{\n-    Deserialize, Deserializer, Serialize, Serializer,\n-    de::{MapAccess, Visitor},\n-    ser::SerializeMap,\n-};\n-use serde_bytes::{ByteBuf, Bytes};\n+use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n     NonLocalValue,\n@@ -29,7 +24,8 @@ use super::pattern::Pattern;\n ///\n /// If the pattern does not have a wildcard character, it will only match the\n /// exact string, and return the template as-is.\n-#[derive(Clone)]\n+#[derive(Clone, Serialize, Deserialize)]\n+#[serde(transparent)]\n pub struct AliasMap<T> {\n     map: PatriciaMap<BTreeMap<AliasKey, T>>,\n }\n@@ -55,63 +51,6 @@ where\n \n impl<T> Eq for AliasMap<T> where T: Eq {}\n \n-impl<T> Serialize for AliasMap<T>\n-where\n-    T: Serialize,\n-{\n-    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\n-    where\n-        S: Serializer,\n-    {\n-        let mut map = serializer.serialize_map(Some(self.map.len()))?;\n-        for (prefix, value) in self.map.iter() {\n-            let key = ByteBuf::from(prefix);\n-            map.serialize_entry(&key, value)?;\n-        }\n-        map.end()\n-    }\n-}\n-\n-struct AliasMapVisitor<T> {\n-    marker: std::marker::PhantomData<T>,\n-}\n-\n-impl<'de, T> Visitor<'de> for AliasMapVisitor<T>\n-where\n-    T: Deserialize<'de>,\n-{\n-    type Value = AliasMap<T>;\n-\n-    fn expecting(&self, formatter: &mut std::fmt::Formatter) -> std::fmt::Result {\n-        formatter.write_str(\"a map of alias patterns to templates\")\n-    }\n-\n-    fn visit_map<M>(self, mut access: M) -> Result<Self::Value, M::Error>\n-    where\n-        M: MapAccess<'de>,\n-    {\n-        let mut map = AliasMap::new();\n-        while let Some((key, value)) = access.next_entry::<&Bytes, _>()? {\n-            map.map.insert(key, value);\n-        }\n-        Ok(map)\n-    }\n-}\n-\n-impl<'a, T> Deserialize<'a> for AliasMap<T>\n-where\n-    T: Deserialize<'a>,\n-{\n-    fn deserialize<D>(deserializer: D) -> Result<Self, D::Error>\n-    where\n-        D: Deserializer<'a>,\n-    {\n-        deserializer.deserialize_map(AliasMapVisitor {\n-            marker: std::marker::PhantomData,\n-        })\n-    }\n-}\n-\n impl<T> TraceRawVcs for AliasMap<T>\n where\n     T: TraceRawVcs,\n@@ -392,7 +331,7 @@ impl<'a, T> IntoIterator for &'a AliasMap<T> {\n ///\n /// [PATTERN_KEY_COMPARE]: https://nodejs.org/api/esm.html#resolver-algorithm-specification\n pub struct AliasMapIntoIter<T> {\n-    iter: patricia_tree::map::IntoIter<BTreeMap<AliasKey, T>>,\n+    iter: patricia_tree::map::IntoIter<Vec<u8>, BTreeMap<AliasKey, T>>,\n     current_prefix_iterator: Option<AliasMapIntoIterItem<T>>,\n }\n \n@@ -457,7 +396,7 @@ impl<T> Iterator for AliasMapIntoIter<T> {\n ///\n /// [PATTERN_KEY_COMPARE]: https://nodejs.org/api/esm.html#resolver-algorithm-specification\n pub struct AliasMapIter<'a, T> {\n-    iter: patricia_tree::map::Iter<'a, BTreeMap<AliasKey, T>>,\n+    iter: patricia_tree::map::Iter<'a, Vec<u8>, BTreeMap<AliasKey, T>>,\n     current_prefix_iterator: Option<AliasMapIterItem<'a, T>>,\n }\n "
        }
    ],
    "stats": {
        "total": 79,
        "additions": 9,
        "deletions": 70
    }
}