{
    "author": "mischnic",
    "message": "Turbopack: less turbo tasks for `chunk_item.id()` (#76110)\n\n- Every `EcmascriptChunkItem` already had a `chunking_context()` getter via the `ChunkItem` supertrait.\r\n- Produce less turbo tasks for `chunk_item.id()`\r\n- In the future, we really want to move `chunking_context.chunk_item_id()` to the module graph, (or split it out and instead pass a `Vc<ModuleIdStrategy>`). That is however a refactoring we don't need to do right now.\r\n\r\nThis showed up in the traces, but overall it doesn't seem to have an effect on perf.\r\nBefore:\r\n![Bildschirmfoto 2025-02-17 um 09 34 05](https://github.com/user-attachments/assets/99b4816e-9056-418c-8d69-4d6535b9d296)\r\n\r\nAfter:\r\n![Bildschirmfoto 2025-02-17 um 13 43 04](https://github.com/user-attachments/assets/e4409ef6-831e-464f-900c-ec071b916a88)",
    "sha": "6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
    "files": [
        {
            "sha": "52d894256c09e0a599124ce47955ed09e36939e9",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -1365,7 +1365,6 @@ impl AppEndpoint {\n                     client_references_chunks,\n                     rsc_app_entry_chunks: **app_entry_chunks,\n                     rsc_app_entry_chunks_availability: Value::new(*app_entry_chunks_availability),\n-                    module_graph: *module_graphs.full,\n                     client_chunking_context,\n                     ssr_chunking_context,\n                     next_config: project.next_config(),"
        },
        {
            "sha": "c15c6eed2198d375c31ff174d30c939afd6b69f1",
            "filename": "crates/next-api/src/dynamic_imports.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -31,8 +31,8 @@ use turbo_tasks::{\n };\n use turbopack_core::{\n     chunk::{\n-        availability_info::AvailabilityInfo, ChunkItem, ChunkItemExt, ChunkableModule,\n-        ChunkingContext, ModuleId,\n+        availability_info::AvailabilityInfo, ChunkItem, ChunkableModule, ChunkingContext,\n+        ModuleChunkItemIdExt, ModuleId,\n     },\n     module::Module,\n     module_graph::{ModuleGraph, SingleModuleGraph, SingleModuleGraphModuleNode},\n@@ -83,8 +83,7 @@ pub(crate) async fn collect_next_dynamic_chunks(\n             let async_chunk_group = async_loader.references().to_resolved().await?;\n \n             let module_id = dynamic_entry\n-                .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-                .id()\n+                .chunk_item_id(Vc::upcast(chunking_context))\n                 .to_resolved()\n                 .await?;\n "
        },
        {
            "sha": "a378e8c80240afe77b802d1e36cb91fb8357cd54",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -1647,8 +1647,6 @@ async fn whole_app_module_graph_operation(\n     let base = ModuleGraph::from_single_graph(base_single_module_graph);\n     let additional_entries = project.get_all_additional_entries(base);\n \n-    base.chunk_group_info().await?;\n-\n     let additional_module_graph = SingleModuleGraph::new_with_entries_visited(\n         additional_entries.await?.into_iter().map(|m| **m).collect(),\n         base_visited_modules,"
        },
        {
            "sha": "f7b98d5df105e476d65ef86798e636ced800a0dd",
            "filename": "crates/next-core/src/hmr_entry.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -172,11 +172,6 @@ impl ChunkItem for HmrEntryChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for HmrEntryChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let this = self.module.await?;"
        },
        {
            "sha": "8aa7b5f154de581c9b7094c735fa58eb630ae0d9",
            "filename": "crates/next-core/src/next_app/include_modules_module.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_app%2Finclude_modules_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_app%2Finclude_modules_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Finclude_modules_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -126,11 +126,6 @@ impl ChunkItem for IncludeModulesChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for IncludeModulesChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     fn content(&self) -> Vc<EcmascriptChunkItemContent> {\n         EcmascriptChunkItemContent {"
        },
        {
            "sha": "0f41f70c3ab6a7b957df1f79e8c64822c21a50d7",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_module.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -336,11 +336,6 @@ impl EcmascriptChunkItem for EcmascriptClientReferenceProxyChunkItem {\n         self.inner_chunk_item\n             .content_with_async_module_info(async_module_info)\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        EcmascriptChunkItem::chunking_context(*self.inner_chunk_item)\n-    }\n }\n \n #[turbo_tasks::value]"
        },
        {
            "sha": "f3988615af2f95b0702e6c5238e5d7ef123ccfc9",
            "filename": "crates/next-core/src/next_dynamic/dynamic_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -6,7 +6,7 @@ use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext},\n+    chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, ModuleChunkItemIdExt},\n     ident::AssetIdent,\n     module::Module,\n     module_graph::ModuleGraph,\n@@ -133,19 +133,13 @@ struct NextDynamicEntryChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for NextDynamicEntryChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n         let module_id = inner\n             .module\n-            .as_chunk_item(*self.module_graph, Vc::upcast(*self.chunking_context))\n-            .id()\n+            .chunk_item_id(Vc::upcast(*self.chunking_context))\n             .await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!("
        },
        {
            "sha": "7a36300db70ffad92e1710a0bab0e400b7cd4ce6",
            "filename": "crates/next-core/src/next_manifests/client_reference_manifest.rs",
            "status": "modified",
            "additions": 15,
            "deletions": 25,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -12,10 +12,9 @@ use turbo_tasks_fs::{File, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n-        availability_info::AvailabilityInfo, ChunkItemExt, ChunkableModule, ChunkingContext,\n-        ModuleId as TurbopackModuleId,\n+        availability_info::AvailabilityInfo, ChunkableModule, ChunkingContext,\n+        ModuleChunkItemIdExt, ModuleId as TurbopackModuleId,\n     },\n-    module_graph::ModuleGraph,\n     output::{OutputAsset, OutputAssets},\n     virtual_output::VirtualOutputAsset,\n };\n@@ -39,7 +38,6 @@ pub struct ClientReferenceManifestOptions {\n     pub client_references_chunks: Vc<ClientReferencesChunks>,\n     pub rsc_app_entry_chunks: Vc<OutputAssets>,\n     pub rsc_app_entry_chunks_availability: Value<AvailabilityInfo>,\n-    pub module_graph: Vc<ModuleGraph>,\n     pub client_chunking_context: Vc<Box<dyn ChunkingContext>>,\n     pub ssr_chunking_context: Option<Vc<Box<dyn ChunkingContext>>>,\n     pub next_config: Vc<NextConfig>,\n@@ -61,7 +59,6 @@ impl ClientReferenceManifest {\n             client_references_chunks,\n             rsc_app_entry_chunks,\n             rsc_app_entry_chunks_availability,\n-            module_graph,\n             client_chunking_context,\n             ssr_chunking_context,\n             next_config,\n@@ -149,13 +146,10 @@ impl ClientReferenceManifest {\n \n                     let server_path = client_reference_module_ref.server_ident.to_string().await?;\n                     let client_module = client_reference_module_ref.client_module;\n-                    let client_chunk_item = client_module\n-                        .as_chunk_item(module_graph, Vc::upcast(client_chunking_context))\n-                        .to_resolved()\n+                    let client_chunk_item_id = client_module\n+                        .chunk_item_id(Vc::upcast(client_chunking_context))\n                         .await?;\n \n-                    let client_module_id = client_chunk_item.id().await?;\n-\n                     let (client_chunks_paths, client_is_async) =\n                         if let Some((client_chunks, client_availability_info)) =\n                             client_component_client_chunks.get(&app_client_reference_ty)\n@@ -193,17 +187,13 @@ impl ClientReferenceManifest {\n \n                     if let Some(ssr_chunking_context) = ssr_chunking_context {\n                         let ssr_module = client_reference_module_ref.ssr_module;\n-                        let ssr_chunk_item = ssr_module\n-                            .as_chunk_item(module_graph, Vc::upcast(ssr_chunking_context))\n-                            .to_resolved()\n+                        let ssr_chunk_item_id = ssr_module\n+                            .chunk_item_id(Vc::upcast(ssr_chunking_context))\n                             .await?;\n-                        let ssr_module_id = ssr_chunk_item.id().await?;\n \n-                        let rsc_chunk_item = client_reference_module\n-                            .as_chunk_item(module_graph, Vc::upcast(ssr_chunking_context))\n-                            .to_resolved()\n+                        let rsc_chunk_item_id = client_reference_module\n+                            .chunk_item_id(Vc::upcast(ssr_chunking_context))\n                             .await?;\n-                        let rsc_module_id = rsc_chunk_item.id().await?;\n \n                         let (ssr_chunks_paths, ssr_is_async) = if runtime == NextRuntime::Edge {\n                             // the chunks get added to the middleware-manifest.json instead\n@@ -277,7 +267,7 @@ impl ClientReferenceManifest {\n                             get_client_reference_module_key(&server_path, \"*\"),\n                             ManifestNodeEntry {\n                                 name: \"*\".into(),\n-                                id: (&*client_module_id).into(),\n+                                id: (&*client_chunk_item_id).into(),\n                                 chunks: client_chunks_paths,\n                                 // This should of course be client_is_async, but SSR can become\n                                 // async due to ESM externals, and\n@@ -292,7 +282,7 @@ impl ClientReferenceManifest {\n                             \"*\".into(),\n                             ManifestNodeEntry {\n                                 name: \"*\".into(),\n-                                id: (&*ssr_module_id).into(),\n+                                id: (&*ssr_chunk_item_id).into(),\n                                 chunks: ssr_chunks_paths,\n                                 // See above\n                                 r#async: client_is_async || ssr_is_async,\n@@ -304,7 +294,7 @@ impl ClientReferenceManifest {\n                             \"*\".into(),\n                             ManifestNodeEntry {\n                                 name: \"*\".into(),\n-                                id: (&*rsc_module_id).into(),\n+                                id: (&*rsc_chunk_item_id).into(),\n                                 chunks: rsc_chunks_paths,\n                                 r#async: rsc_is_async,\n                             },\n@@ -314,18 +304,18 @@ impl ClientReferenceManifest {\n                             NextRuntime::NodeJs => {\n                                 entry_manifest\n                                     .ssr_module_mapping\n-                                    .insert((&*client_module_id).into(), ssr_manifest_node);\n+                                    .insert((&*client_chunk_item_id).into(), ssr_manifest_node);\n                                 entry_manifest\n                                     .rsc_module_mapping\n-                                    .insert((&*client_module_id).into(), rsc_manifest_node);\n+                                    .insert((&*client_chunk_item_id).into(), rsc_manifest_node);\n                             }\n                             NextRuntime::Edge => {\n                                 entry_manifest\n                                     .edge_ssr_module_mapping\n-                                    .insert((&*client_module_id).into(), ssr_manifest_node);\n+                                    .insert((&*client_chunk_item_id).into(), ssr_manifest_node);\n                                 entry_manifest\n                                     .edge_rsc_module_mapping\n-                                    .insert((&*client_module_id).into(), rsc_manifest_node);\n+                                    .insert((&*client_chunk_item_id).into(), rsc_manifest_node);\n                             }\n                         }\n                     }"
        },
        {
            "sha": "d5e1d2fadb7a6f4b643989835e912855943711c3",
            "filename": "crates/next-core/src/next_server_component/server_component_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -7,7 +7,7 @@ use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext},\n+    chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, ModuleChunkItemIdExt},\n     ident::AssetIdent,\n     module::Module,\n     module_graph::ModuleGraph,\n@@ -128,19 +128,13 @@ struct NextServerComponentChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for NextServerComponentChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n         let module_id = inner\n             .module\n-            .as_chunk_item(*self.module_graph, Vc::upcast(*self.chunking_context))\n-            .id()\n+            .chunk_item_id(Vc::upcast(*self.chunking_context))\n             .await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!("
        },
        {
            "sha": "753b312068ebd6dc82236e2b48f1b26ed58983be",
            "filename": "crates/next-core/src/next_server_utility/server_utility_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -7,7 +7,7 @@ use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext},\n+    chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, ModuleChunkItemIdExt},\n     ident::AssetIdent,\n     module::Module,\n     module_graph::ModuleGraph,\n@@ -128,19 +128,13 @@ struct NextServerComponentChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for NextServerComponentChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n         let module_id = inner\n             .module\n-            .as_chunk_item(*self.module_graph, Vc::upcast(*self.chunking_context))\n-            .id()\n+            .chunk_item_id(Vc::upcast(*self.chunking_context))\n             .await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!("
        },
        {
            "sha": "833c0739b966880fff0604e53473bfcf974d9d1e",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/evaluate/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -9,8 +9,8 @@ use turbo_tasks_fs::{File, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n-        ChunkData, ChunkItemExt, ChunkableModule, ChunkingContext, ChunksData, EvaluatableAssets,\n-        MinifyType, ModuleId,\n+        ChunkData, ChunkingContext, ChunksData, EvaluatableAssets, MinifyType,\n+        ModuleChunkItemIdExt, ModuleId,\n     },\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n@@ -104,15 +104,13 @@ impl EcmascriptDevEvaluateChunk {\n             .iter()\n             .map({\n                 let chunking_context = this.chunking_context;\n-                let module_graph = this.module_graph;\n                 move |entry| async move {\n                     if let Some(placeable) =\n                         ResolvedVc::try_sidecast::<Box<dyn EcmascriptChunkPlaceable>>(*entry)\n                     {\n                         Ok(Some(\n                             placeable\n-                                .as_chunk_item(*module_graph, Vc::upcast(*chunking_context))\n-                                .id()\n+                                .chunk_item_id(Vc::upcast(*chunking_context))\n                                 .await?,\n                         ))\n                     } else {"
        },
        {
            "sha": "8fd32572ff975526452ae83dd0d0126618dd92df",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -224,8 +224,11 @@ pub trait ChunkingContext {\n         ident: Vc<AssetIdent>,\n     ) -> Result<Vc<ModuleId>>;\n \n-    fn chunk_item_id(self: Vc<Self>, chunk_item: Vc<Box<dyn ChunkItem>>) -> Vc<ModuleId> {\n-        self.chunk_item_id_from_ident(chunk_item.asset_ident())\n+    fn chunk_item_id(self: Vc<Self>, module: Vc<Box<dyn ChunkItem>>) -> Vc<ModuleId> {\n+        self.chunk_item_id_from_ident(module.asset_ident())\n+    }\n+    fn chunk_item_id_from_module(self: Vc<Self>, module: Vc<Box<dyn Module>>) -> Vc<ModuleId> {\n+        self.chunk_item_id_from_ident(module.ident())\n     }\n }\n "
        },
        {
            "sha": "d1c72c5c780c9ba95e2220eb34bda8f0b2699b14",
            "filename": "turbopack/crates/turbopack-core/src/chunk/mod.rs",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -347,6 +347,25 @@ where\n     }\n }\n \n+pub trait ModuleChunkItemIdExt {\n+    /// Returns the chunk item id of this module.\n+    fn chunk_item_id(\n+        self: Vc<Self>,\n+        chunking_context: Vc<Box<dyn ChunkingContext>>,\n+    ) -> Vc<ModuleId>;\n+}\n+impl<T> ModuleChunkItemIdExt for T\n+where\n+    T: Upcast<Box<dyn Module>>,\n+{\n+    fn chunk_item_id(\n+        self: Vc<Self>,\n+        chunking_context: Vc<Box<dyn ChunkingContext>>,\n+    ) -> Vc<ModuleId> {\n+        chunking_context.chunk_item_id_from_module(Vc::upcast(self))\n+    }\n+}\n+\n #[cfg(test)]\n mod tests {\n     use super::*;"
        },
        {
            "sha": "50805632999f160e302cd8ff15b98caaeeb2d99c",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -9,7 +9,7 @@ use turbo_tasks::{FxIndexMap, ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::{rope::Rope, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext},\n+    chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, ModuleChunkItemIdExt},\n     context::{AssetContext, ProcessResult},\n     ident::AssetIdent,\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n@@ -320,11 +320,6 @@ impl ChunkItem for ModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let classes = self.module.classes().await?;\n@@ -378,8 +373,7 @@ impl EcmascriptChunkItem for ModuleChunkItem {\n                             ResolvedVc::upcast(css_module);\n \n                         let module_id = placeable\n-                            .as_chunk_item(*self.module_graph, Vc::upcast(*self.chunking_context))\n-                            .id()\n+                            .chunk_item_id(Vc::upcast(*self.chunking_context))\n                             .await?;\n                         let module_id = StringifyJs(&*module_id);\n                         let original_name = StringifyJs(&original_name);"
        },
        {
            "sha": "656bffced73731d6e27b5e55772964f362ce4598",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 12,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -4,8 +4,8 @@ use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n use turbopack_core::{\n     chunk::{\n-        ChunkData, ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext,\n-        ChunkingContextExt, ChunksData,\n+        ChunkData, ChunkItem, ChunkType, ChunkingContext, ChunkingContextExt, ChunksData,\n+        ModuleChunkItemIdExt,\n     },\n     ident::AssetIdent,\n     module::Module,\n@@ -59,11 +59,6 @@ impl AsyncLoaderChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for AsyncLoaderChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let this = self.await?;\n@@ -74,11 +69,7 @@ impl EcmascriptChunkItem for AsyncLoaderChunkItem {\n         {\n             Some(\n                 placeable\n-                    .as_chunk_item(\n-                        *this.module_graph,\n-                        *ResolvedVc::upcast(this.chunking_context),\n-                    )\n-                    .id()\n+                    .chunk_item_id(*ResolvedVc::upcast(this.chunking_context))\n                     .await?,\n             )\n         } else {"
        },
        {
            "sha": "3e374e06993e8134cbaff83a6466e0f1b235d53e",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/item.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -7,7 +7,7 @@ use turbo_tasks::{\n };\n use turbo_tasks_fs::{rope::Rope, FileSystemPath};\n use turbopack_core::{\n-    chunk::{AsyncModuleInfo, ChunkItem, ChunkItemExt, ChunkItemTy, ChunkingContext},\n+    chunk::{AsyncModuleInfo, ChunkItem, ChunkItemTy, ChunkingContext},\n     code_builder::{Code, CodeBuilder},\n     error::PrettyPrintError,\n     issue::{code_gen::CodeGenerationIssue, IssueExt, IssueSeverity, StyledString},\n@@ -202,7 +202,6 @@ pub trait EcmascriptChunkItem: ChunkItem {\n     ) -> Vc<EcmascriptChunkItemContent> {\n         self.content()\n     }\n-    fn chunking_context(self: Vc<Self>) -> Vc<Box<dyn ChunkingContext>>;\n \n     /// Specifies which availablility information the chunk item needs for code\n     /// generation\n@@ -240,7 +239,11 @@ async fn module_factory_with_code_generation_issue(\n         {\n             Ok(factory) => factory,\n             Err(error) => {\n-                let id = chunk_item.id().to_string().await;\n+                let id = chunk_item\n+                    .chunking_context()\n+                    .chunk_item_id(Vc::upcast(chunk_item))\n+                    .to_string()\n+                    .await;\n                 let id = id.as_ref().map_or_else(|_| \"unknown\", |id| &**id);\n                 let error = error.context(format!(\n                     \"An error occurred while generating the chunk item {}\","
        },
        {
            "sha": "a00400a8aeda2aacb14147ac88aad5e078646ba1",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk_group_files_asset.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk_group_files_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk_group_files_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk_group_files_asset.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -167,11 +167,6 @@ impl ChunkGroupFilesChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ChunkGroupFilesChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let chunks = self.chunks();"
        },
        {
            "sha": "fec390aefefaf364b7970977f5766b049d5cfe00",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 41,
            "deletions": 42,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -58,6 +58,7 @@ use swc_core::{\n         visit::{VisitMutWith, VisitMutWithAstPath},\n     },\n };\n+use tracing::Instrument;\n pub use transform::{\n     CustomTransformer, EcmascriptInputTransform, EcmascriptInputTransforms, TransformContext,\n     TransformPlugin, UnsupportedServerActionIssue,\n@@ -709,11 +710,6 @@ impl ChunkItem for ModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     fn content(self: Vc<Self>) -> Vc<EcmascriptChunkItemContent> {\n         panic!(\"content() should not be called\");\n@@ -798,49 +794,51 @@ impl EcmascriptModuleContent {\n             async_module_info,\n         } = input;\n \n-        let additional_code_gens = [\n-            if let Some(async_module) = &*async_module.await? {\n-                Some(\n-                    async_module\n-                        .code_generation(\n-                            async_module_info,\n-                            references,\n-                            module_graph,\n-                            chunking_context,\n-                        )\n-                        .await?,\n-                )\n-            } else {\n-                None\n-            },\n-            if let EcmascriptExports::EsmExports(exports) = *exports.await? {\n-                Some(\n-                    exports\n-                        .code_generation(module_graph, chunking_context)\n-                        .await?,\n-                )\n-            } else {\n-                None\n-            },\n-        ];\n+        let (esm_code_gens, additional_code_gens, code_gens) = async {\n+            let additional_code_gens = [\n+                if let Some(async_module) = &*async_module.await? {\n+                    Some(\n+                        async_module\n+                            .code_generation(async_module_info, references, chunking_context)\n+                            .await?,\n+                    )\n+                } else {\n+                    None\n+                },\n+                if let EcmascriptExports::EsmExports(exports) = *exports.await? {\n+                    Some(\n+                        exports\n+                            .code_generation(module_graph, chunking_context)\n+                            .await?,\n+                    )\n+                } else {\n+                    None\n+                },\n+            ];\n \n-        let esm_code_gens = esm_references\n-            .await?\n-            .iter()\n-            .map(|r| r.code_generation(module_graph, chunking_context))\n-            .try_join()\n-            .await?;\n-        let code_gens = code_generation\n-            .await?\n-            .iter()\n-            .map(|c| c.code_generation(module_graph, chunking_context))\n-            .try_join()\n-            .await?;\n+            let esm_code_gens = esm_references\n+                .await?\n+                .iter()\n+                .map(|r| r.code_generation(chunking_context))\n+                .try_join()\n+                .await?;\n+            let code_gens = code_generation\n+                .await?\n+                .iter()\n+                .map(|c| c.code_generation(module_graph, chunking_context))\n+                .try_join()\n+                .await?;\n+\n+            anyhow::Ok((esm_code_gens, additional_code_gens, code_gens))\n+        }\n+        .instrument(tracing::info_span!(\"precompute code generation\"))\n+        .await?;\n \n         let code_gens = esm_code_gens\n             .iter()\n             .chain(additional_code_gens.iter().flatten())\n             .chain(code_gens.iter());\n+\n         gen_content_with_code_gens(\n             parsed,\n             ident,\n@@ -849,6 +847,7 @@ impl EcmascriptModuleContent {\n             generate_source_map,\n             original_source_map,\n         )\n+        .instrument(tracing::info_span!(\"gen content with code gens\"))\n         .await\n     }\n "
        },
        {
            "sha": "12e188f2b14ebaad15cddf669cfd96f79aee2ce0",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/chunk_item.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -37,11 +37,6 @@ impl ManifestChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ManifestChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let chunks_data = self.chunks_data().await?;"
        },
        {
            "sha": "917d83552fb1c88a8f38d8c3fc194328b22b8e46",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/loader_item.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 16,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -6,7 +6,8 @@ use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     chunk::{\n-        ChunkData, ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext, ChunksData,\n+        ChunkData, ChunkItem, ChunkType, ChunkableModule, ChunkingContext, ChunksData,\n+        ModuleChunkItemIdExt,\n     },\n     ident::AssetIdent,\n     module::Module,\n@@ -130,11 +131,6 @@ impl ChunkItem for ManifestLoaderChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ManifestLoaderChunkItem {\n-    #[turbo_tasks::function]\n-    async fn chunking_context(&self) -> Result<Vc<Box<dyn ChunkingContext>>> {\n-        Ok(*self.manifest.await?.chunking_context)\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let this = &*self.await?;\n@@ -152,11 +148,7 @@ impl EcmascriptChunkItem for ManifestLoaderChunkItem {\n         // exports a promise for all of the necessary chunk loads.\n         let item_id = &*this\n             .manifest\n-            .as_chunk_item(\n-                *this.module_graph,\n-                *ResolvedVc::upcast(manifest.chunking_context),\n-            )\n-            .id()\n+            .chunk_item_id(*ResolvedVc::upcast(manifest.chunking_context))\n             .await?;\n \n         // Finally, we need the id of the module that we're actually trying to\n@@ -165,11 +157,7 @@ impl EcmascriptChunkItem for ManifestLoaderChunkItem {\n             ResolvedVc::try_downcast::<Box<dyn EcmascriptChunkPlaceable>>(manifest.inner)\n                 .ok_or_else(|| anyhow!(\"asset is not placeable in ecmascript chunk\"))?;\n         let dynamic_id = &*placeable\n-            .as_chunk_item(\n-                *this.module_graph,\n-                *ResolvedVc::upcast(manifest.chunking_context),\n-            )\n-            .id()\n+            .chunk_item_id(*ResolvedVc::upcast(manifest.chunking_context))\n             .await?;\n \n         // This is the code that will be executed when the dynamic import is reached."
        },
        {
            "sha": "84fee019550c7609645fbb75c574e9ae0ef14b2b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/amd.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -157,7 +157,7 @@ impl AmdDefineWithDependenciesCodeGen {\n \n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let mut visitors = Vec::new();\n@@ -174,7 +174,6 @@ impl AmdDefineWithDependenciesCodeGen {\n                         pattern_mapping: PatternMapping::resolve_request(\n                             **request,\n                             *self.origin,\n-                            module_graph,\n                             Vc::upcast(chunking_context),\n                             cjs_resolve(\n                                 *self.origin,"
        },
        {
            "sha": "19bcef60c143794fa320d913602f38b8142e3f14",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/async_module.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 15,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -11,7 +11,6 @@ use turbo_tasks::{\n };\n use turbopack_core::{\n     chunk::{AsyncModuleInfo, ChunkableModuleReference, ChunkingContext, ChunkingType},\n-    module_graph::ModuleGraph,\n     reference::{ModuleReference, ModuleReferences},\n     resolve::ExternalType,\n };\n@@ -103,7 +102,6 @@ impl AsyncModule {\n         &self,\n         async_module_info: Vc<AsyncModuleInfo>,\n         references: Vc<ModuleReferences>,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<Vc<AsyncModuleIdents>> {\n         let async_module_info = async_module_info.await?;\n@@ -118,9 +116,7 @@ impl AsyncModule {\n                 Ok(match &*referenced_asset {\n                     ReferencedAsset::External(_, ExternalType::EcmaScriptModule) => {\n                         if self.import_externals {\n-                            referenced_asset\n-                                .get_ident(module_graph, chunking_context)\n-                                .await?\n+                            referenced_asset.get_ident(chunking_context).await?\n                         } else {\n                             None\n                         }\n@@ -130,9 +126,7 @@ impl AsyncModule {\n                             .referenced_async_modules\n                             .contains(&ResolvedVc::upcast(*placeable))\n                         {\n-                            referenced_asset\n-                                .get_ident(module_graph, chunking_context)\n-                                .await?\n+                            referenced_asset.get_ident(chunking_context).await?\n                         } else {\n                             None\n                         }\n@@ -197,17 +191,11 @@ impl AsyncModule {\n         self: Vc<Self>,\n         async_module_info: Option<Vc<AsyncModuleInfo>>,\n         references: Vc<ModuleReferences>,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         if let Some(async_module_info) = async_module_info {\n             let async_idents = self\n-                .get_async_idents(\n-                    async_module_info,\n-                    references,\n-                    module_graph,\n-                    chunking_context,\n-                )\n+                .get_async_idents(async_module_info, references, chunking_context)\n                 .await?;\n \n             if !async_idents.is_empty() {"
        },
        {
            "sha": "7117547b5af21eda917421cb3c9144d73273b787",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/cjs.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -157,15 +157,14 @@ pub struct CjsRequireAssetReferenceCodeGen {\n impl CjsRequireAssetReferenceCodeGen {\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let reference = self.reference.await?;\n \n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            module_graph,\n             Vc::upcast(chunking_context),\n             self.reference.resolve_reference(),\n             ResolveType::ChunkItem,\n@@ -276,15 +275,14 @@ pub struct CjsRequireResolveAssetReferenceCodeGen {\n impl CjsRequireResolveAssetReferenceCodeGen {\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let reference = self.reference.await?;\n \n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            module_graph,\n             Vc::upcast(chunking_context),\n             self.reference.resolve_reference(),\n             ResolveType::ChunkItem,"
        },
        {
            "sha": "838ffd1fab2306a91e510b74f74ad712384699da",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/base.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 19,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -10,15 +10,14 @@ use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     chunk::{\n-        ChunkItemExt, ChunkableModule, ChunkableModuleReference, ChunkingContext, ChunkingType,\n-        ChunkingTypeOption,\n+        ChunkableModuleReference, ChunkingContext, ChunkingType, ChunkingTypeOption,\n+        ModuleChunkItemIdExt,\n     },\n     issue::{\n         Issue, IssueExt, IssueSeverity, IssueSource, IssueStage, OptionIssueSource,\n         OptionStyledString, StyledString,\n     },\n     module::Module,\n-    module_graph::ModuleGraph,\n     reference::ModuleReference,\n     reference_type::{EcmaScriptModulesReferenceSubType, ImportWithType},\n     resolve::{\n@@ -52,12 +51,11 @@ pub enum ReferencedAsset {\n impl ReferencedAsset {\n     pub async fn get_ident(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<Option<String>> {\n         Ok(match self {\n             ReferencedAsset::Some(asset) => {\n-                Some(Self::get_ident_from_placeable(asset, module_graph, chunking_context).await?)\n+                Some(Self::get_ident_from_placeable(asset, chunking_context).await?)\n             }\n             ReferencedAsset::External(request, ty) => Some(magic_identifier::mangle(&format!(\n                 \"{ty} external {request}\"\n@@ -68,13 +66,9 @@ impl ReferencedAsset {\n \n     pub(crate) async fn get_ident_from_placeable(\n         asset: &Vc<Box<dyn EcmascriptChunkPlaceable>>,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<String> {\n-        let id = asset\n-            .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-            .id()\n-            .await?;\n+        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n         Ok(magic_identifier::mangle(&format!(\"imported module {}\", id)))\n     }\n }\n@@ -258,7 +252,6 @@ impl ChunkableModuleReference for EsmAssetReference {\n impl EsmAssetReference {\n     pub async fn code_generation(\n         self: Vc<Self>,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let this = &*self.await?;\n@@ -276,10 +269,7 @@ impl EsmAssetReference {\n                     span: DUMMY_SP,\n                 });\n                 Some((format!(\"throw {request}\").into(), stmt))\n-            } else if let Some(ident) = referenced_asset\n-                .get_ident(module_graph, chunking_context)\n-                .await?\n-            {\n+            } else if let Some(ident) = referenced_asset.get_ident(chunking_context).await? {\n                 let span = this\n                     .issue_source\n                     .to_swc_offsets()\n@@ -292,10 +282,7 @@ impl EsmAssetReference {\n                         unreachable!()\n                     }\n                     ReferencedAsset::Some(asset) => {\n-                        let id = asset\n-                            .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-                            .id()\n-                            .await?;\n+                        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n                         let name = ident;\n                         Some((\n                             id.to_string().into(),"
        },
        {
            "sha": "eec3199ba3896252b68201bb8912333d816bc1cd",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/binding.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -43,17 +43,14 @@ impl EsmBinding {\n \n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let mut visitors = vec![];\n \n         let export = self.export.clone();\n         let imported_module = self.reference.get_referenced_asset();\n-        let imported_module = imported_module\n-            .await?\n-            .get_ident(module_graph, chunking_context)\n-            .await?;\n+        let imported_module = imported_module.await?.get_ident(chunking_context).await?;\n \n         let mut ast_path = self.ast_path.0.clone();\n         loop {"
        },
        {
            "sha": "c0264738aa837ab3408fbe904ef6915fc3413521",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/dynamic.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -132,15 +132,14 @@ pub struct EsmAsyncAssetReferenceCodeGen {\n impl EsmAsyncAssetReferenceCodeGen {\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let reference = self.reference.await?;\n \n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            module_graph,\n             Vc::upcast(chunking_context),\n             self.reference.resolve_reference(),\n             if matches!("
        },
        {
            "sha": "c1240d6aecc4cdc35f2ca0564c828b9460a4eb87",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/export.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -492,19 +492,16 @@ impl EsmExports {\n impl EsmExports {\n     pub async fn code_generation(\n         self: Vc<Self>,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let expanded = self.expand_exports().await?;\n \n         let mut dynamic_exports = Vec::<Box<Expr>>::new();\n         for dynamic_export_asset in &expanded.dynamic_exports {\n-            let ident = ReferencedAsset::get_ident_from_placeable(\n-                dynamic_export_asset,\n-                module_graph,\n-                chunking_context,\n-            )\n-            .await?;\n+            let ident =\n+                ReferencedAsset::get_ident_from_placeable(dynamic_export_asset, chunking_context)\n+                    .await?;\n \n             dynamic_exports.push(quote_expr!(\n                 \"$turbopack_dynamic($arg)\",\n@@ -546,7 +543,6 @@ impl EsmExports {\n                     let referenced_asset =\n                         ReferencedAsset::from_resolve_result(esm_ref.resolve_reference()).await?;\n                     referenced_asset.get_ident(\n-                        module_graph,\n                         chunking_context\n                     ).await?.map(|ident| {\n                         let expr = MemberExpr {\n@@ -588,7 +584,7 @@ impl EsmExports {\n                     let referenced_asset =\n                         ReferencedAsset::from_resolve_result(esm_ref.resolve_reference()).await?;\n                     referenced_asset\n-                        .get_ident(module_graph, chunking_context)\n+                        .get_ident(chunking_context)\n                         .await?\n                         .map(|ident| {\n                             quote!("
        },
        {
            "sha": "09e75bccc66536be0ce142e15c53e1569bc26b98",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/module_id.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -6,10 +6,7 @@ use turbo_tasks::{\n     debug::ValueDebugFormat, trace::TraceRawVcs, NonLocalValue, ResolvedVc, ValueToString, Vc,\n };\n use turbopack_core::{\n-    chunk::{\n-        ChunkItemExt, ChunkableModule, ChunkableModuleReference, ChunkingContext,\n-        ChunkingTypeOption,\n-    },\n+    chunk::{ChunkableModuleReference, ChunkingContext, ChunkingTypeOption, ModuleChunkItemIdExt},\n     module_graph::ModuleGraph,\n     reference::ModuleReference,\n     resolve::ModuleResolveResult,\n@@ -86,18 +83,15 @@ pub struct EsmModuleIdAssetReferenceCodeGen {\n impl EsmModuleIdAssetReferenceCodeGen {\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let mut visitors = Vec::new();\n \n         if let ReferencedAsset::Some(asset) =\n             &*self.reference.await?.inner.get_referenced_asset().await?\n         {\n-            let id = asset\n-                .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-                .id()\n-                .await?;\n+            let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n             let id = module_id_to_lit(&id);\n             visitors.push(create_visitor!(self.path, visit_mut_expr(expr: &mut Expr) {\n                 *expr = id.clone()"
        },
        {
            "sha": "42ce906f8865c9669065ab201421aff1fcf52b3d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/url.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -11,8 +11,8 @@ use turbo_tasks::{\n };\n use turbopack_core::{\n     chunk::{\n-        ChunkItemExt, ChunkableModule, ChunkableModuleReference, ChunkingContext, ChunkingType,\n-        ChunkingTypeOption,\n+        ChunkableModuleReference, ChunkingContext, ChunkingType, ChunkingTypeOption,\n+        ModuleChunkItemIdExt,\n     },\n     environment::Rendering,\n     issue::IssueSource,\n@@ -170,7 +170,7 @@ impl UrlAssetReferenceCodeGen {\n     */\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let mut visitors = vec![];\n@@ -191,10 +191,7 @@ impl UrlAssetReferenceCodeGen {\n                     ReferencedAsset::Some(asset) => {\n                         // We rewrite the first `new URL()` arguments to be a require() of the chunk\n                         // item, which exports the static asset path to the linked file.\n-                        let id = asset\n-                            .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-                            .id()\n-                            .await?;\n+                        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n \n                         visitors.push(create_visitor!(self.path, visit_mut_expr(new_expr: &mut Expr) {\n                             let should_rewrite_to_relative = if let Expr::New(NewExpr { args: Some(args), .. }) = new_expr {\n@@ -259,10 +256,7 @@ impl UrlAssetReferenceCodeGen {\n                     ReferencedAsset::Some(asset) => {\n                         // We rewrite the first `new URL()` arguments to be a require() of the\n                         // chunk item, which returns the asset path as its exports.\n-                        let id = asset\n-                            .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-                            .id()\n-                            .await?;\n+                        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n \n                         // If there's a rewrite to the base url, then the current rendering\n                         // environment should able to resolve the asset path"
        },
        {
            "sha": "4929420328fde99cf3d07450e31221aab2bb0051",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/external_module.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -245,11 +245,6 @@ impl ChunkItem for CachedExternalModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for CachedExternalModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     fn content(self: Vc<Self>) -> Vc<EcmascriptChunkItemContent> {\n         panic!(\"content() should not be called\");"
        },
        {
            "sha": "0a1716b24bc39dace5e9a359d71197d4c5a0b99b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/pattern_mapping.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 22,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -16,12 +16,11 @@ use turbo_tasks::{\n     TryJoinIterExt, Vc,\n };\n use turbopack_core::{\n-    chunk::{ChunkItemExt, ChunkableModule, ChunkingContext, ModuleId},\n+    chunk::{ChunkableModule, ChunkingContext, ModuleChunkItemIdExt, ModuleId},\n     issue::{\n         code_gen::CodeGenerationIssue, module::emit_unknown_module_type_error, IssueExt,\n         IssueSeverity, StyledString,\n     },\n-    module_graph::ModuleGraph,\n     resolve::{\n         origin::ResolveOrigin, parse::Request, ExternalType, ModuleResolveResult,\n         ModuleResolveResultItem,\n@@ -321,7 +320,6 @@ impl PatternMapping {\n \n async fn to_single_pattern_mapping(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n-    module_graph: Vc<ModuleGraph>,\n     chunking_context: Vc<Box<dyn ChunkingContext>>,\n     resolve_item: &ModuleResolveResultItem,\n     resolve_type: ResolveType,\n@@ -374,8 +372,8 @@ async fn to_single_pattern_mapping(\n                 return Ok(SinglePatternMapping::ModuleLoader(loader_id.owned().await?));\n             }\n             ResolveType::ChunkItem => {\n-                let chunk_item = chunkable.as_chunk_item(module_graph, chunking_context);\n-                return Ok(SinglePatternMapping::Module(chunk_item.id().owned().await?));\n+                let item_id = chunkable.chunk_item_id(chunking_context);\n+                return Ok(SinglePatternMapping::Module(item_id.owned().await?));\n             }\n         }\n     }\n@@ -402,7 +400,6 @@ impl PatternMapping {\n     pub async fn resolve_request(\n         request: Vc<Request>,\n         origin: Vc<Box<dyn ResolveOrigin>>,\n-        module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n         resolve_result: Vc<ModuleResolveResult>,\n         resolve_type: ResolveType,\n@@ -415,14 +412,9 @@ impl PatternMapping {\n             .cell()),\n             1 => {\n                 let resolve_item = result.primary.first().unwrap().1;\n-                let single_pattern_mapping = to_single_pattern_mapping(\n-                    origin,\n-                    module_graph,\n-                    chunking_context,\n-                    resolve_item,\n-                    resolve_type,\n-                )\n-                .await?;\n+                let single_pattern_mapping =\n+                    to_single_pattern_mapping(origin, chunking_context, resolve_item, resolve_type)\n+                        .await?;\n                 Ok(PatternMapping::Single(single_pattern_mapping).cell())\n             }\n             _ => {\n@@ -435,14 +427,9 @@ impl PatternMapping {\n                         set.insert(request).then(|| (request.to_string(), v))\n                     })\n                     .map(|(k, v)| async move {\n-                        let single_pattern_mapping = to_single_pattern_mapping(\n-                            origin,\n-                            module_graph,\n-                            chunking_context,\n-                            v,\n-                            resolve_type,\n-                        )\n-                        .await?;\n+                        let single_pattern_mapping =\n+                            to_single_pattern_mapping(origin, chunking_context, v, resolve_type)\n+                                .await?;\n                         Ok((k, single_pattern_mapping))\n                     })\n                     .try_join()"
        },
        {
            "sha": "774b3cd753f83e64f7340c3575372f65562679f4",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/require_context.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -22,8 +22,8 @@ use turbo_tasks_fs::{DirectoryContent, DirectoryEntry, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n-        ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkableModuleReference,\n-        ChunkingContext,\n+        ChunkItem, ChunkType, ChunkableModule, ChunkableModuleReference, ChunkingContext,\n+        ModuleChunkItemIdExt,\n     },\n     ident::AssetIdent,\n     issue::IssueSource,\n@@ -311,15 +311,15 @@ pub struct RequireContextAssetReferenceCodeGen {\n impl RequireContextAssetReferenceCodeGen {\n     pub async fn code_generation(\n         &self,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n-        let chunk_item = self\n+        let module_id = self\n             .reference\n             .await?\n             .inner\n-            .as_chunk_item(module_graph, Vc::upcast(chunking_context));\n-        let module_id = chunk_item.id().owned().await?;\n+            .chunk_item_id(Vc::upcast(chunking_context))\n+            .await?;\n \n         let mut visitors = Vec::new();\n \n@@ -457,11 +457,6 @@ pub struct RequireContextChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for RequireContextChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let map = &*self.map.await?;\n@@ -475,7 +470,6 @@ impl EcmascriptChunkItem for RequireContextChunkItem {\n             let pm = PatternMapping::resolve_request(\n                 *entry.request,\n                 *self.origin,\n-                *self.module_graph,\n                 *ResolvedVc::upcast(self.chunking_context),\n                 *entry.result,\n                 ResolveType::ChunkItem,"
        },
        {
            "sha": "70bf431c6d650c79b6d255098431b6fa78f531db",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/chunk_item.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -76,7 +76,6 @@ impl EcmascriptChunkItem for EcmascriptModuleFacadeChunkItem {\n                 .code_generation(\n                     async_module_info,\n                     self.module.references(),\n-                    *self.module_graph,\n                     *chunking_context,\n                 )\n                 .await?,\n@@ -117,11 +116,6 @@ impl EcmascriptChunkItem for EcmascriptModuleFacadeChunkItem {\n         }\n         .cell())\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n }\n \n #[turbo_tasks::value_impl]"
        },
        {
            "sha": "1b8954f4301f14ab3bfd4bda57b92653581ee882",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -82,7 +82,7 @@ impl EcmascriptModuleFacadeModule {\n                     .esm_evaluation_references\n                     .await?\n                     .iter()\n-                    .map(|r| r.code_generation(module_graph, chunking_context))\n+                    .map(|r| r.code_generation(chunking_context))\n                     .try_join()\n                     .await?;\n                 code_gens.push(\n@@ -106,7 +106,7 @@ impl EcmascriptModuleFacadeModule {\n                     .esm_reexport_references\n                     .await?\n                     .iter()\n-                    .map(|r| r.code_generation(module_graph, chunking_context))\n+                    .map(|r| r.code_generation(chunking_context))\n                     .try_join()\n                     .await?;\n                 code_gens.push("
        },
        {
            "sha": "8fa16f5a1edcd223a1fbdd6c03c068011f8a7bf5",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/locals/chunk_item.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -76,11 +76,6 @@ impl EcmascriptChunkItem for EcmascriptModuleLocalsChunkItem {\n             async_module_options,\n         ))\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n }\n \n #[turbo_tasks::value_impl]"
        },
        {
            "sha": "cbe54a4c9ac83296ce17e203e55bc2f7aae40f48",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/reference.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -4,8 +4,8 @@ use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     chunk::{\n-        ChunkItemExt, ChunkableModule, ChunkableModuleReference, ChunkingContext, ChunkingType,\n-        ChunkingTypeOption,\n+        ChunkableModuleReference, ChunkingContext, ChunkingType, ChunkingTypeOption,\n+        ModuleChunkItemIdExt,\n     },\n     module::Module,\n     module_graph::ModuleGraph,\n@@ -112,23 +112,20 @@ impl ChunkableModuleReference for EcmascriptModulePartReference {\n impl EcmascriptModulePartReference {\n     pub async fn code_generation(\n         self: Vc<Self>,\n-        module_graph: Vc<ModuleGraph>,\n+        _module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<CodeGeneration> {\n         let referenced_asset = ReferencedAsset::from_resolve_result(self.resolve_reference());\n         let referenced_asset = referenced_asset.await?;\n         let ident = referenced_asset\n-            .get_ident(module_graph, chunking_context)\n+            .get_ident(chunking_context)\n             .await?\n             .context(\"part module reference should have an ident\")?;\n \n         let ReferencedAsset::Some(module) = *referenced_asset else {\n             bail!(\"part module reference should have an module reference\");\n         };\n-        let id = module\n-            .as_chunk_item(module_graph, Vc::upcast(chunking_context))\n-            .id()\n-            .await?;\n+        let id = module.chunk_item_id(Vc::upcast(chunking_context)).await?;\n \n         Ok(CodeGeneration::hoisted_stmt(\n             ident.clone().into(),"
        },
        {
            "sha": "a676f55f9a59250ad55a4a2909678319a49c4dac",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/chunk_item.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 21,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -2,9 +2,7 @@ use anyhow::Result;\n use turbo_tasks::{ResolvedVc, ValueDefault, Vc};\n use turbo_tasks_fs::rope::RopeBuilder;\n use turbopack_core::{\n-    chunk::{\n-        AsyncModuleInfo, ChunkItem, ChunkItemExt, ChunkType, ChunkableModule, ChunkingContext,\n-    },\n+    chunk::{AsyncModuleInfo, ChunkItem, ChunkType, ChunkingContext, ModuleChunkItemIdExt},\n     ident::AssetIdent,\n     module::Module,\n     module_graph::ModuleGraph,\n@@ -85,11 +83,6 @@ impl EcmascriptChunkItem for EcmascriptModulePartChunkItem {\n             async_module_options,\n         ))\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n }\n \n #[turbo_tasks::value_impl]\n@@ -175,12 +168,7 @@ impl EcmascriptChunkItem for SideEffectsModuleChunkItem {\n                 format!(\n                     \"{}{TURBOPACK_IMPORT}({});\\n\",\n                     if need_await { \"await \" } else { \"\" },\n-                    StringifyModuleId(\n-                        &*side_effect\n-                            .as_chunk_item(*self.module_graph, *self.chunking_context)\n-                            .id()\n-                            .await?\n-                    )\n+                    StringifyModuleId(&*side_effect.chunk_item_id(*self.chunking_context).await?)\n                 )\n                 .as_bytes(),\n             );\n@@ -192,8 +180,7 @@ impl EcmascriptChunkItem for SideEffectsModuleChunkItem {\n                 StringifyModuleId(\n                     &*module\n                         .resolved_as\n-                        .as_chunk_item(*self.module_graph, *self.chunking_context)\n-                        .id()\n+                        .chunk_item_id(*self.chunking_context)\n                         .await?\n                 )\n             )\n@@ -222,9 +209,4 @@ impl EcmascriptChunkItem for SideEffectsModuleChunkItem {\n         }\n         .cell())\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n }"
        },
        {
            "sha": "e7e5d1ddab70f29b0e355be629054e9fb5f9d5a0",
            "filename": "turbopack/crates/turbopack-ecmascript/src/worker_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -73,11 +73,6 @@ impl WorkerLoaderChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for WorkerLoaderChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let chunks_data = self.chunks_data().await?;"
        },
        {
            "sha": "f54f9cd971e7b0a10b5cb0d174cbd92a18335e75",
            "filename": "turbopack/crates/turbopack-json/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -121,11 +121,6 @@ impl ChunkItem for JsonChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for JsonChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         // We parse to JSON and then stringify again to ensure that the"
        },
        {
            "sha": "23d298e0ab80c83beaeead686767575227995f04",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/entry/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -7,7 +7,7 @@ use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{File, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{ChunkItemExt, ChunkableModule, ChunkingContext, EvaluatableAssets},\n+    chunk::{ChunkingContext, EvaluatableAssets, ModuleChunkItemIdExt},\n     code_builder::{Code, CodeBuilder},\n     module_graph::ModuleGraph,\n     output::{OutputAsset, OutputAssets},\n@@ -115,8 +115,7 @@ impl EcmascriptBuildNodeEntryChunk {\n                 ResolvedVc::try_sidecast::<Box<dyn EcmascriptChunkPlaceable>>(*evaluatable_asset)\n             {\n                 let runtime_module_id = placeable\n-                    .as_chunk_item(*this.module_graph, Vc::upcast(*this.chunking_context))\n-                    .id()\n+                    .chunk_item_id(Vc::upcast(*this.chunking_context))\n                     .await?;\n \n                 writedoc!(\n@@ -131,8 +130,7 @@ impl EcmascriptBuildNodeEntryChunk {\n \n         let runtime_module_id = this\n             .exported_module\n-            .as_chunk_item(*this.module_graph, Vc::upcast(*this.chunking_context))\n-            .id()\n+            .chunk_item_id(Vc::upcast(*this.chunking_context))\n             .await?;\n \n         writedoc!("
        },
        {
            "sha": "4d3eee86b2469bf4fea6d48a6137bfe45ddf98de",
            "filename": "turbopack/crates/turbopack-static/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Flib.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -148,11 +148,6 @@ impl ChunkItem for ModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         Ok(EcmascriptChunkItemContent {"
        },
        {
            "sha": "a35f47e9b7df13f6df6ca80ace600ad3aa1846b8",
            "filename": "turbopack/crates/turbopack-wasm/src/module_asset.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -242,11 +242,6 @@ impl ChunkItem for ModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for ModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     fn content(self: Vc<Self>) -> Vc<EcmascriptChunkItemContent> {\n         panic!(\"content() should not be called\");"
        },
        {
            "sha": "49a86557d104c74fd96df842a3d9f2d9106c6520",
            "filename": "turbopack/crates/turbopack-wasm/src/raw.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b0724bad7fa4a9a1c37a9d38d0f969e525bb224/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs?ref=6b0724bad7fa4a9a1c37a9d38d0f969e525bb224",
            "patch": "@@ -142,11 +142,6 @@ impl ChunkItem for RawModuleChunkItem {\n \n #[turbo_tasks::value_impl]\n impl EcmascriptChunkItem for RawModuleChunkItem {\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n-\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let path = self.wasm_asset.path().await?;"
        }
    ],
    "stats": {
        "total": 519,
        "additions": 163,
        "deletions": 356
    }
}