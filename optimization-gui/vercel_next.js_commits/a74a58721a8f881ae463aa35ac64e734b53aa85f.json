{
    "author": "ztanner",
    "message": "fix React 18 test failures (#80119)\n\nFixes failing assertions related to the forked React 18 tests.\n\n[x-ref](https://github.com/vercel/next.js/actions/runs/15417191195/job/43385564776#step:34:533)",
    "sha": "a74a58721a8f881ae463aa35ac64e734b53aa85f",
    "files": [
        {
            "sha": "e6d1c9eb8fd6587ff83646160fb66f12bc79505d",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/a74a58721a8f881ae463aa35ac64e734b53aa85f/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a74a58721a8f881ae463aa35ac64e734b53aa85f/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=a74a58721a8f881ae463aa35ac64e734b53aa85f",
            "patch": "@@ -267,7 +267,7 @@ describe('ReactRefreshLogBox', () => {\n       `export default function FunctionDefault() { throw new Error('no'); }`\n     )\n \n-    if (isReact18) {\n+    if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n          {\n@@ -280,8 +280,8 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"FunctionDefault FunctionDefault.js (1:51)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n          {\n@@ -294,8 +294,8 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"FunctionDefault FunctionDefault.js (1:51)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n        ]\n@@ -468,7 +468,7 @@ describe('ReactRefreshLogBox', () => {\n \n     // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n-    if (isReact18) {\n+    if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n          {\n@@ -481,8 +481,8 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"ClickCount.render Child.js (4:11)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n          {\n@@ -495,8 +495,8 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"ClickCount.render Child.js (4:11)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n        ]"
        },
        {
            "sha": "440460aed1ecd3a0797489c76a32db3e7cebff57",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/a74a58721a8f881ae463aa35ac64e734b53aa85f/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a74a58721a8f881ae463aa35ac64e734b53aa85f/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=a74a58721a8f881ae463aa35ac64e734b53aa85f",
            "patch": "@@ -247,8 +247,8 @@ describe('pages/ error recovery', () => {\n \n     // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n-    // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n-    if (isReact18) {\n+    // Somehow we end up with two in React 18 + Turbopack due to React's attempt to recover from this error.\n+    if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n          {\n@@ -261,8 +261,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"Child child.js (3:9)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n          {\n@@ -275,8 +275,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"Child child.js (3:9)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n        ]\n@@ -536,7 +536,7 @@ describe('pages/ error recovery', () => {\n     // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n-    if (isReact18) {\n+    if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n          {\n@@ -549,8 +549,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"ClassDefault.render index.js (5:11)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n          {\n@@ -563,8 +563,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"ClassDefault.render index.js (5:11)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n        ]\n@@ -652,7 +652,7 @@ describe('pages/ error recovery', () => {\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // We get an error because Foo didn't import React. Fair.\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n-    if (isReact18) {\n+    if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n          {\n@@ -665,8 +665,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"Foo Foo.js (3:3)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n          {\n@@ -679,8 +679,8 @@ describe('pages/ error recovery', () => {\n            \"stack\": [\n              \"Foo Foo.js (3:3)\",\n              \"Set.forEach <anonymous> (0:0)\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n            ],\n          },\n        ]"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 26,
        "deletions": 26
    }
}