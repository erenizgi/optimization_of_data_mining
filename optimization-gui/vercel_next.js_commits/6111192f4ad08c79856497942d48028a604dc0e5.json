{
    "author": "fireairforce",
    "message": "feat(turbopack): turbo-esregex support captures method (#81119)\n\nEsRegex support captures method, in utoo situation, we need Esregexp to\nsupport captures the match string from user's regex config item.",
    "sha": "6111192f4ad08c79856497942d48028a604dc0e5",
    "files": [
        {
            "sha": "17ced28fb257d8974c5c886aa76e404020a63d0c",
            "filename": "turbopack/crates/turbo-esregex/src/lib.rs",
            "status": "modified",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/6111192f4ad08c79856497942d48028a604dc0e5/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6111192f4ad08c79856497942d48028a604dc0e5/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs?ref=6111192f4ad08c79856497942d48028a604dc0e5",
            "patch": "@@ -123,6 +123,21 @@ impl EsRegex {\n             EsRegexImpl::Regress(r) => r.find(haystack).is_some(),\n         }\n     }\n+\n+    pub fn captures<'h>(&self, haystack: &'h str) -> Option<Vec<&'h str>> {\n+        match &self.delegate {\n+            EsRegexImpl::Regex(r) => r.captures(haystack).map(|caps| {\n+                caps.iter()\n+                    .map(|m| m.map(|m| m.as_str()).unwrap_or(\"\"))\n+                    .collect::<Vec<_>>()\n+            }),\n+            EsRegexImpl::Regress(r) => r.find(haystack).map(|m| {\n+                m.groups()\n+                    .map(|range_opt| range_opt.map(|range| &haystack[range]).unwrap_or(\"\"))\n+                    .collect::<Vec<_>>()\n+            }),\n+        }\n+    }\n }\n \n #[cfg(test)]\n@@ -160,4 +175,35 @@ mod tests {\n         // that to the underlying implementations.\n         assert!(matches!(EsRegex::new(\"*\", \"\"), Err { .. }))\n     }\n+\n+    #[test]\n+    fn captures_with_regex() {\n+        let regex = EsRegex::new(r\"(\\d{4})-(\\d{2})-(\\d{2})\", \"\").unwrap();\n+        assert!(matches!(regex.delegate, EsRegexImpl::Regex { .. }));\n+\n+        let captures = regex.captures(\"Today is 2024-01-15\");\n+        assert!(captures.is_some());\n+        let caps: Vec<&str> = captures.unwrap();\n+        assert_eq!(caps.len(), 4); // full match + 3 groups\n+        assert_eq!(caps[0], \"2024-01-15\"); // full match\n+        assert_eq!(caps[1], \"2024\"); // year\n+        assert_eq!(caps[2], \"01\"); // month\n+        assert_eq!(caps[3], \"15\"); // day\n+    }\n+\n+    #[test]\n+    fn captures_with_regress() {\n+        let regex = EsRegex::new(r\"(\\w+)(?=baz)\", \"\").unwrap();\n+        assert!(matches!(regex.delegate, EsRegexImpl::Regress { .. }));\n+\n+        let captures = regex.captures(\"foobar\");\n+        assert!(captures.is_none());\n+\n+        let captures = regex.captures(\"foobaz\");\n+        assert!(captures.is_some());\n+        let caps: Vec<&str> = captures.unwrap();\n+        assert_eq!(caps.len(), 2); // full match + 1 group\n+        assert_eq!(caps[0], \"foo\"); // full match\n+        assert_eq!(caps[1], \"foo\"); // captured group\n+    }\n }"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 46,
        "deletions": 0
    }
}