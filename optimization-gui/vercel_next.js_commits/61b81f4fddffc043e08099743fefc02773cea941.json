{
    "author": "huozhi",
    "message": "[metadata] fix duplicate metadata for parallel routes (#76669)",
    "sha": "61b81f4fddffc043e08099743fefc02773cea941",
    "files": [
        {
            "sha": "ccb0dcbfa6831401066d647fcfc7150d1e79539a",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -527,7 +527,7 @@ async function createComponentTreeInternal({\n             missingSlots,\n             preloadCallbacks,\n             authInterrupts,\n-            StreamingMetadata,\n+            StreamingMetadata: isChildrenRouteKey ? StreamingMetadata : null,\n             // `StreamingMetadataOutlet` is used to conditionally throw. In the case of parallel routes we will have more than one page\n             // but we only want to throw on the first one.\n             StreamingMetadataOutlet: isChildrenRouteKey"
        },
        {
            "sha": "e355998a4433c4d5dbc1dd3722978a2c5abe0b4a",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@bar/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fdefault.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default @bar'\n+}"
        },
        {
            "sha": "1e18e748cf81e93f454e9cd71ce7617948880703",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@bar/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Flayout.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h2>@bar Layout</h2>\n+      <div id=\"bar-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "eb4a3e2e9df71d0f81f102128ee52511d9c00b22",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@bar/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40bar%2Fpage.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'page @bar'\n+}"
        },
        {
            "sha": "408576f1876b586e90b61480df9db74ef6568ea8",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@foo/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fdefault.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default @foo'\n+}"
        },
        {
            "sha": "05a3bda4f7be80fce7cf6de65a53e33e8c9bab6f",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@foo/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Flayout.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h2>@foo Layout</h2>\n+      <div id=\"foo-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "3536981cea3ff4875f8b1ffea941e755e6268832",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/@foo/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2F%40foo%2Fpage.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'page @foo'\n+}"
        },
        {
            "sha": "088fb97919687fa7964eae4da038ec06dfe1b3b9",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/layout.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Flayout.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,10 @@\n+export default function Layout({ children, bar, foo }) {\n+  return (\n+    <div>\n+      <h1>Parallel Routes Layout</h1>\n+      <div id=\"nested-children\">{children}</div>\n+      <div id=\"foo-slot\">{foo}</div>\n+      <div id=\"bar-slot\">{bar}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "605d53d215519c69f25ce99aa3977ae37cda69f7",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/page.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Page() {\n+  return <div>Hello from Nested</div>\n+}\n+\n+export const metadata = {\n+  title: 'parallel title',\n+}"
        },
        {
            "sha": "2aabf91805369836488c752810f7ef054a388aaa",
            "filename": "test/e2e/app-dir/metadata-streaming/metadata-streaming.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61b81f4fddffc043e08099743fefc02773cea941/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts?ref=61b81f4fddffc043e08099743fefc02773cea941",
            "patch": "@@ -88,6 +88,16 @@ describe('app-dir - metadata-streaming', () => {\n     expect((await browser.elementsByCss('body meta')).length).toBe(9)\n   })\n \n+  it('should only insert metadata once for parallel routes', async () => {\n+    const browser = await next.browser('/parallel-routes')\n+\n+    expect((await browser.elementsByCss('head title')).length).toBe(1)\n+    expect((await browser.elementsByCss('body title')).length).toBe(0)\n+\n+    const $ = await next.render$('/parallel-routes')\n+    expect($('title').length).toBe(1)\n+  })\n+\n   describe('dynamic api', () => {\n     it('should render metadata to body', async () => {\n       const $ = await next.render$('/dynamic-api')"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 56,
        "deletions": 1
    }
}