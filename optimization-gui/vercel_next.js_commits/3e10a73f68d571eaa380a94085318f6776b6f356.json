{
    "author": "ztanner",
    "message": "guard navigation `use` hooks for React 18 (#85151)\n\nWe need to guard these calls, otherwise they fail in our React 18.3.1\ntests. x-ref:\nhttps://github.com/vercel/next.js/actions/runs/18671327784/job/53236002824",
    "sha": "3e10a73f68d571eaa380a94085318f6776b6f356",
    "files": [
        {
            "sha": "bfd7af32aa0e10ae451f24f38b7d08bc2f7716dc",
            "filename": "packages/next/src/client/components/navigation.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/3e10a73f68d571eaa380a94085318f6776b6f356/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3e10a73f68d571eaa380a94085318f6776b6f356/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fnavigation.ts?ref=3e10a73f68d571eaa380a94085318f6776b6f356",
            "patch": "@@ -1,6 +1,6 @@\n import type { Params } from '../../server/request/params'\n \n-import { useContext, useMemo, use } from 'react'\n+import React, { useContext, useMemo, use } from 'react'\n import {\n   AppRouterContext,\n   LayoutRouterContext,\n@@ -72,7 +72,7 @@ export function useSearchParams(): ReadonlyURLSearchParams {\n   }, [searchParams]) as ReadonlyURLSearchParams\n \n   // Instrument with Suspense DevTools (dev-only)\n-  if (process.env.NODE_ENV !== 'production') {\n+  if (process.env.NODE_ENV !== 'production' && 'use' in React) {\n     const navigationPromises = use(NavigationPromisesContext)\n     if (navigationPromises) {\n       return use(navigationPromises.searchParams)\n@@ -108,7 +108,7 @@ export function usePathname(): string {\n   const pathname = useContext(PathnameContext) as string\n \n   // Instrument with Suspense DevTools (dev-only)\n-  if (process.env.NODE_ENV !== 'production') {\n+  if (process.env.NODE_ENV !== 'production' && 'use' in React) {\n     const navigationPromises = use(NavigationPromisesContext)\n     if (navigationPromises) {\n       return use(navigationPromises.pathname)\n@@ -176,7 +176,7 @@ export function useParams<T extends Params = Params>(): T {\n   const params = useContext(PathParamsContext) as T\n \n   // Instrument with Suspense DevTools (dev-only)\n-  if (process.env.NODE_ENV !== 'production') {\n+  if (process.env.NODE_ENV !== 'production' && 'use' in React) {\n     const navigationPromises = use(NavigationPromisesContext)\n     if (navigationPromises) {\n       return use(navigationPromises.params) as T\n@@ -222,7 +222,7 @@ export function useSelectedLayoutSegments(\n   if (!context) return null\n \n   // Instrument with Suspense DevTools (dev-only)\n-  if (process.env.NODE_ENV !== 'production') {\n+  if (process.env.NODE_ENV !== 'production' && 'use' in React) {\n     const navigationPromises = use(NavigationPromisesContext)\n     if (navigationPromises) {\n       const promise =\n@@ -265,7 +265,11 @@ export function useSelectedLayoutSegment(\n   const selectedLayoutSegments = useSelectedLayoutSegments(parallelRouteKey)\n \n   // Instrument with Suspense DevTools (dev-only)\n-  if (process.env.NODE_ENV !== 'production' && navigationPromises) {\n+  if (\n+    process.env.NODE_ENV !== 'production' &&\n+    navigationPromises &&\n+    'use' in React\n+  ) {\n     const promise =\n       navigationPromises.selectedLayoutSegmentPromises?.get(parallelRouteKey)\n     if (promise) {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 10,
        "deletions": 6
    }
}