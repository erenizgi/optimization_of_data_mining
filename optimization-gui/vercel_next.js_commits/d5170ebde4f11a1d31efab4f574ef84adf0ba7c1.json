{
    "author": "devjiwonchoi",
    "message": "test: split app-middleware test per describe (#84130)\n\nA single test file is starting 3 next instances sequentially. This can be paralleled from different test files. This PR splits tests per \"describe\" and does not change its content.",
    "sha": "d5170ebde4f11a1d31efab4f574ef84adf0ba7c1",
    "files": [
        {
            "sha": "a063bc1aebfecaa04096dd7f774b43a6eab04d9b",
            "filename": "test/e2e/app-dir/app-middleware/app-middleware-in-src-dir.test.ts",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-in-src-dir.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-in-src-dir.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-in-src-dir.test.ts?ref=d5170ebde4f11a1d31efab4f574ef84adf0ba7c1",
            "patch": "@@ -0,0 +1,34 @@\n+/* eslint-env jest */\n+import path from 'path'\n+import { nextTestSetup, FileRef } from 'e2e-utils'\n+\n+describe('app dir - middleware with middleware in src dir', () => {\n+  const { next } = nextTestSetup({\n+    files: {\n+      'src/app': new FileRef(path.join(__dirname, 'app')),\n+      'next.config.js': new FileRef(path.join(__dirname, 'next.config.js')),\n+      'src/middleware.js': `\n+      import { NextResponse } from 'next/server'\n+      import { cookies } from 'next/headers'\n+\n+      export async function middleware(request) {\n+        const cookie = (await cookies()).get('test-cookie')\n+        return NextResponse.json({ cookie })\n+      }\n+    `,\n+    },\n+  })\n+\n+  it('works without crashing when using RequestStore', async () => {\n+    const browser = await next.browser('/')\n+    await browser.addCookie({\n+      name: 'test-cookie',\n+      value: 'test-cookie-response',\n+    })\n+    await browser.refresh()\n+\n+    const html = await browser.eval('document.documentElement.innerHTML')\n+\n+    expect(html).toContain('test-cookie-response')\n+  })\n+})"
        },
        {
            "sha": "f45bf69bfb778ebfc82539ba95f176031d2d333b",
            "filename": "test/e2e/app-dir/app-middleware/app-middleware-without-pages-dir.test.ts",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-without-pages-dir.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-without-pages-dir.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware-without-pages-dir.test.ts?ref=d5170ebde4f11a1d31efab4f574ef84adf0ba7c1",
            "patch": "@@ -0,0 +1,29 @@\n+/* eslint-env jest */\n+import path from 'path'\n+import { nextTestSetup, FileRef } from 'e2e-utils'\n+\n+describe('app dir - middleware without pages dir', () => {\n+  const { next } = nextTestSetup({\n+    files: {\n+      app: new FileRef(path.join(__dirname, 'app')),\n+      'next.config.js': new FileRef(path.join(__dirname, 'next.config.js')),\n+      'middleware.js': `\n+      import { NextResponse } from 'next/server'\n+\n+      export async function middleware(request) {\n+        return new NextResponse('redirected')\n+      }\n+\n+      export const config = {\n+        matcher: '/headers'\n+      }\n+    `,\n+    },\n+  })\n+\n+  it('Updates headers', async () => {\n+    const html = await next.render('/headers')\n+\n+    expect(html).toContain('redirected')\n+  })\n+})"
        },
        {
            "sha": "ebf1b357d2ebe9f3ec8f5029209d71415330de41",
            "filename": "test/e2e/app-dir/app-middleware/app-middleware.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 60,
            "changes": 61,
            "blob_url": "https://github.com/vercel/next.js/blob/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-middleware%2Fapp-middleware.test.ts?ref=d5170ebde4f11a1d31efab4f574ef84adf0ba7c1",
            "patch": "@@ -1,8 +1,7 @@\n /* eslint-env jest */\n-import path from 'path'\n import cheerio from 'cheerio'\n import { check, retry, withQuery } from 'next-test-utils'\n-import { nextTestSetup, FileRef } from 'e2e-utils'\n+import { nextTestSetup } from 'e2e-utils'\n import type { Response } from 'node-fetch'\n \n describe('app-dir with middleware', () => {\n@@ -272,61 +271,3 @@ describe('app-dir with middleware', () => {\n     })\n   }\n })\n-\n-describe('app dir - middleware without pages dir', () => {\n-  const { next } = nextTestSetup({\n-    files: {\n-      app: new FileRef(path.join(__dirname, 'app')),\n-      'next.config.js': new FileRef(path.join(__dirname, 'next.config.js')),\n-      'middleware.js': `\n-      import { NextResponse } from 'next/server'\n-\n-      export async function middleware(request) {\n-        return new NextResponse('redirected')\n-      }\n-\n-      export const config = {\n-        matcher: '/headers'\n-      }\n-    `,\n-    },\n-  })\n-\n-  // eslint-disable-next-line jest/no-identical-title\n-  it('Updates headers', async () => {\n-    const html = await next.render('/headers')\n-\n-    expect(html).toContain('redirected')\n-  })\n-})\n-\n-describe('app dir - middleware with middleware in src dir', () => {\n-  const { next } = nextTestSetup({\n-    files: {\n-      'src/app': new FileRef(path.join(__dirname, 'app')),\n-      'next.config.js': new FileRef(path.join(__dirname, 'next.config.js')),\n-      'src/middleware.js': `\n-      import { NextResponse } from 'next/server'\n-      import { cookies } from 'next/headers'\n-\n-      export async function middleware(request) {\n-        const cookie = (await cookies()).get('test-cookie')\n-        return NextResponse.json({ cookie })\n-      }\n-    `,\n-    },\n-  })\n-\n-  it('works without crashing when using RequestStore', async () => {\n-    const browser = await next.browser('/')\n-    await browser.addCookie({\n-      name: 'test-cookie',\n-      value: 'test-cookie-response',\n-    })\n-    await browser.refresh()\n-\n-    const html = await browser.eval('document.documentElement.innerHTML')\n-\n-    expect(html).toContain('test-cookie-response')\n-  })\n-})"
        },
        {
            "sha": "b6aa4987e8a754bf1a1b075be013453d6f5872a1",
            "filename": "test/experimental-tests-manifest.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fexperimental-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d5170ebde4f11a1d31efab4f574ef84adf0ba7c1/test%2Fexperimental-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fexperimental-tests-manifest.json?ref=d5170ebde4f11a1d31efab4f574ef84adf0ba7c1",
            "patch": "@@ -122,6 +122,8 @@\n       \"test/e2e/app-dir/app-inline-css/index.test.ts\",\n       \"test/e2e/app-dir/app-invalid-revalidate/app-invalid-revalidate.test.ts\",\n       \"test/e2e/app-dir/app-middleware/app-middleware.test.ts\",\n+      \"test/e2e/app-dir/app-middleware/app-middleware-in-src-dir.test.ts\",\n+      \"test/e2e/app-dir/app-middleware/app-middleware-without-pages-dir.test.ts\",\n       \"test/e2e/app-dir/app-prefetch*/**/*\",\n       \"test/e2e/app-dir/app-rendering/rendering.test.ts\",\n       \"test/e2e/app-dir/app-root-params/generate-static-params.test.ts\","
        }
    ],
    "stats": {
        "total": 126,
        "additions": 66,
        "deletions": 60
    }
}