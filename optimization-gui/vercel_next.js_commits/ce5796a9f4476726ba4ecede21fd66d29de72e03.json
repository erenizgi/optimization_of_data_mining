{
    "author": "kdy1",
    "message": "refactor(turbopack): Refactor `turbo-tasks-fs` to take `&self` instead (#80633)\n\n### What?\n\nTake `&self` from some trivial methods.\n\n### Why?\n\nTo prepare `Vc<FileSystemPath>` to `FileSystemPath`.",
    "sha": "ce5796a9f4476726ba4ecede21fd66d29de72e03",
    "files": [
        {
            "sha": "f1aa916f1f9dfa3b53e322c142ef2f9fd05eba6a",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 20,
            "deletions": 24,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/ce5796a9f4476726ba4ecede21fd66d29de72e03/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ce5796a9f4476726ba4ecede21fd66d29de72e03/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=ce5796a9f4476726ba4ecede21fd66d29de72e03",
            "patch": "@@ -1180,57 +1180,54 @@ impl FileSystemPath {\n     /// contain \"..\" or \".\" seqments, but it must not leave the root of the\n     /// filesystem.\n     #[turbo_tasks::function]\n-    pub async fn join(self: Vc<Self>, path: RcStr) -> Result<Vc<Self>> {\n-        let this = self.await?;\n-        if let Some(path) = join_path(&this.path, &path) {\n-            Ok(Self::new_normalized(*this.fs, path.into()))\n+    pub fn join(&self, path: RcStr) -> Result<Vc<Self>> {\n+        if let Some(path) = join_path(&self.path, &path) {\n+            Ok(Self::new_normalized(*self.fs, path.into()))\n         } else {\n             bail!(\n                 \"Vc<FileSystemPath>(\\\"{}\\\").join(\\\"{}\\\") leaves the filesystem root\",\n-                this.path,\n+                self.path,\n                 path\n             );\n         }\n     }\n \n     /// Adds a suffix to the filename. [path] must not contain `/`.\n     #[turbo_tasks::function]\n-    pub async fn append(self: Vc<Self>, path: RcStr) -> Result<Vc<Self>> {\n-        let this = self.await?;\n+    pub fn append(&self, path: RcStr) -> Result<Vc<Self>> {\n         if path.contains('/') {\n             bail!(\n-                \"Vc<FileSystemPath>(\\\"{}\\\").append(\\\"{}\\\") must not append '/'\",\n-                this.path,\n+                \"FileSystemPath(\\\"{}\\\").append(\\\"{}\\\") must not append '/'\",\n+                self.path,\n                 path\n             )\n         }\n         Ok(Self::new_normalized(\n-            *this.fs,\n-            format!(\"{}{}\", this.path, path).into(),\n+            *self.fs,\n+            format!(\"{}{}\", self.path, path).into(),\n         ))\n     }\n \n     /// Adds a suffix to the basename of the filename. [appending] must not\n     /// contain `/`. Extension will stay intact.\n     #[turbo_tasks::function]\n-    pub async fn append_to_stem(self: Vc<Self>, appending: RcStr) -> Result<Vc<Self>> {\n-        let this = self.await?;\n+    pub fn append_to_stem(&self, appending: RcStr) -> Result<Vc<Self>> {\n         if appending.contains('/') {\n             bail!(\n-                \"Vc<FileSystemPath>(\\\"{}\\\").append_to_stem(\\\"{}\\\") must not append '/'\",\n-                this.path,\n+                \"FileSystemPath(\\\"{}\\\").append_to_stem(\\\"{}\\\") must not append '/'\",\n+                self.path,\n                 appending\n             )\n         }\n-        if let (path, Some(ext)) = this.split_extension() {\n+        if let (path, Some(ext)) = self.split_extension() {\n             return Ok(Self::new_normalized(\n-                *this.fs,\n+                *self.fs,\n                 format!(\"{path}{appending}.{ext}\").into(),\n             ));\n         }\n         Ok(Self::new_normalized(\n-            *this.fs,\n-            format!(\"{}{}\", this.path, appending).into(),\n+            *self.fs,\n+            format!(\"{}{}\", self.path, appending).into(),\n         ))\n     }\n \n@@ -2119,17 +2116,16 @@ impl FileContent {\n #[turbo_tasks::value_impl]\n impl FileContent {\n     #[turbo_tasks::function]\n-    pub async fn len(self: Vc<Self>) -> Result<Vc<Option<u64>>> {\n-        Ok(Vc::cell(match &*self.await? {\n+    pub fn len(&self) -> Result<Vc<Option<u64>>> {\n+        Ok(Vc::cell(match self {\n             FileContent::Content(file) => Some(file.content.len() as u64),\n             FileContent::NotFound => None,\n         }))\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn parse_json(self: Vc<Self>) -> Result<Vc<FileJsonContent>> {\n-        let this = self.await?;\n-        Ok(this.parse_json_ref().into())\n+    pub fn parse_json(&self) -> Result<Vc<FileJsonContent>> {\n+        Ok(self.parse_json_ref().into())\n     }\n \n     #[turbo_tasks::function]"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 20,
        "deletions": 24
    }
}