{
    "author": "sokra",
    "message": "Turbopack: commit compaction only when there are updates (#78651)\n\n### What?\n\nAn empty compaction should not commit",
    "sha": "c0d833620580058df2b45eff4f20e7d134707e8e",
    "files": [
        {
            "sha": "75e28036ebbc99c43cfeffcee05f3fbfa0ef2011",
            "filename": "turbopack/crates/turbo-persistence/src/db.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d833620580058df2b45eff4f20e7d134707e8e/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fdb.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d833620580058df2b45eff4f20e7d134707e8e/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fdb.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fdb.rs?ref=c0d833620580058df2b45eff4f20e7d134707e8e",
            "patch": "@@ -571,12 +571,14 @@ impl TurboPersistence {\n             )?;\n         }\n \n-        self.commit(\n-            new_sst_files,\n-            Vec::new(),\n-            indicies_to_delete,\n-            *sequence_number.get_mut(),\n-        )?;\n+        if !new_sst_files.is_empty() {\n+            self.commit(\n+                new_sst_files,\n+                Vec::new(),\n+                indicies_to_delete,\n+                *sequence_number.get_mut(),\n+            )?;\n+        }\n \n         self.active_write_operation.store(false, Ordering::Release);\n \n@@ -592,9 +594,9 @@ impl TurboPersistence {\n         indicies_to_delete: &mut Vec<usize>,\n         max_coverage: f32,\n         max_merge_sequence: usize,\n-    ) -> Result<bool> {\n+    ) -> Result<()> {\n         if static_sorted_files.is_empty() {\n-            return Ok(false);\n+            return Ok(());\n         }\n \n         struct SstWithRange {\n@@ -869,7 +871,7 @@ impl TurboPersistence {\n             indicies_to_delete.append(&mut inner_indicies_to_delete);\n         }\n \n-        Ok(true)\n+        Ok(())\n     }\n \n     /// Get a value from the database. Returns None if the key is not found. The returned value"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 11,
        "deletions": 9
    }
}