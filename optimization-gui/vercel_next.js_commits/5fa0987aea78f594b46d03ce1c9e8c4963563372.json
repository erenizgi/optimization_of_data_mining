{
    "author": "eps1lon",
    "message": "Remove React 17 logic from Pages Router static generation (#82604)\n\n`allReady` is available in all supported React versions so we can remove the conditional check.  The helper type can be replaced with the actual type from React.",
    "sha": "5fa0987aea78f594b46d03ce1c9e8c4963563372",
    "files": [
        {
            "sha": "59fbc852304a67d1bc26f5080687f68b1524ab6d",
            "filename": "packages/next/src/server/render.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5fa0987aea78f594b46d03ce1c9e8c4963563372/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5fa0987aea78f594b46d03ce1c9e8c4963563372/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=5fa0987aea78f594b46d03ce1c9e8c4963563372",
            "patch": "@@ -1,5 +1,6 @@\n import type { IncomingMessage, ServerResponse } from 'http'\n import type { ParsedUrlQuery } from 'querystring'\n+import type { ReactDOMServerReadableStream } from 'react-dom/server'\n import type { NextRouter } from '../shared/lib/router/router'\n import type { HtmlProps } from '../shared/lib/html-context.shared-runtime'\n import type { DomainLocale } from './config'\n@@ -30,7 +31,6 @@ import type {\n   SizeLimit,\n } from '../types'\n import type { UnwrapPromise } from '../lib/coalesced-function'\n-import type { ReactReadableStream } from './stream-utils/node-web-streams-helper'\n import type { ClientReferenceManifest } from '../build/webpack/plugins/flight-manifest-plugin'\n import type { NextFontManifest } from '../build/webpack/plugins/next-font-manifest-plugin'\n import type { PagesModule } from './route-modules/pages/module'\n@@ -1305,7 +1305,7 @@ export async function renderToHTMLImpl(\n       renderShell: (\n         _App: AppType,\n         _Component: NextComponentType\n-      ) => Promise<ReactReadableStream>\n+      ) => Promise<ReactDOMServerReadableStream>\n     ) {\n       const renderPage: RenderPage = async (\n         options: ComponentsEnhancer = {}"
        },
        {
            "sha": "0e7f0196a7d903de559b153d94aacac7972ead54",
            "filename": "packages/next/src/server/stream-utils/node-web-streams-helper.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/5fa0987aea78f594b46d03ce1c9e8c4963563372/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5fa0987aea78f594b46d03ce1c9e8c4963563372/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts?ref=5fa0987aea78f594b46d03ce1c9e8c4963563372",
            "patch": "@@ -1,3 +1,4 @@\n+import type { ReactDOMServerReadableStream } from 'react-dom/server'\n import { getTracer } from '../lib/trace/tracer'\n import { AppRenderSpan } from '../lib/trace/constants'\n import { DetachedPromise } from '../../lib/detached-promise'\n@@ -17,10 +18,6 @@ function voidCatch() {\n   // and be unhandled\n }\n \n-export type ReactReadableStream = ReadableStream<Uint8Array> & {\n-  allReady?: Promise<void> | undefined\n-}\n-\n // We can share the same encoder instance everywhere\n // Notably we cannot do the same for TextDecoder because it is stateful\n // when handling streaming data\n@@ -221,7 +218,7 @@ export function renderToInitialFizzStream({\n   }\n   element: React.ReactElement\n   streamOptions?: Parameters<typeof ReactDOMServer.renderToReadableStream>[1]\n-}): Promise<ReactReadableStream> {\n+}): Promise<ReactDOMServerReadableStream> {\n   return getTracer().trace(AppRenderSpan.renderToReadableStream, async () =>\n     ReactDOMServer.renderToReadableStream(element, streamOptions)\n   )\n@@ -678,7 +675,7 @@ export type ContinueStreamOptions = {\n }\n \n export async function continueFizzStream(\n-  renderStream: ReactReadableStream,\n+  renderStream: ReactDOMServerReadableStream,\n   {\n     suffix,\n     inlinedDataStream,\n@@ -693,9 +690,8 @@ export async function continueFizzStream(\n   // Suffix itself might contain close tags at the end, so we need to split it.\n   const suffixUnclosed = suffix ? suffix.split(CLOSE_TAG, 1)[0] : null\n \n-  // If we're generating static HTML and there's an `allReady` promise on the\n-  // stream, we need to wait for it to resolve before continuing.\n-  if (isStaticGeneration && 'allReady' in renderStream) {\n+  // If we're generating static HTML we need to wait for it to resolve before continuing.\n+  if (isStaticGeneration) {\n     await renderStream.allReady\n   }\n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 7,
        "deletions": 11
    }
}