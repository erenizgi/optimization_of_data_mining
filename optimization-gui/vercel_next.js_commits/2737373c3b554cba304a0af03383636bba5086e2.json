{
    "author": "gaojude",
    "message": "doc: instrumentation-client (#77649)",
    "sha": "2737373c3b554cba304a0af03383636bba5086e2",
    "files": [
        {
            "sha": "49ff948349a07f03c83207454397b247e97d30a4",
            "filename": "docs/01-app/03-building-your-application/06-optimizing/08-analytics.mdx",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/2737373c3b554cba304a0af03383636bba5086e2/docs%2F01-app%2F03-building-your-application%2F06-optimizing%2F08-analytics.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/2737373c3b554cba304a0af03383636bba5086e2/docs%2F01-app%2F03-building-your-application%2F06-optimizing%2F08-analytics.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-building-your-application%2F06-optimizing%2F08-analytics.mdx?ref=2737373c3b554cba304a0af03383636bba5086e2",
            "patch": "@@ -7,6 +7,23 @@ description: Measure and track page performance using Next.js Speed Insights\n \n Next.js has built-in support for measuring and reporting performance metrics. You can either use the `useReportWebVitals` hook to manage reporting yourself, or alternatively, Vercel provides a [managed service](https://vercel.com/analytics?utm_source=next-site&utm_medium=docs&utm_campaign=next-website) to automatically collect and visualize metrics for you.\n \n+## Client Instrumentation\n+\n+For more advanced analytics and monitoring needs, Next.js provides a `instrumentation-client.js|ts` file that runs before your application's frontend code starts executing. This is ideal for setting up global analytics, error tracking, or performance monitoring tools.\n+\n+To use it, create an `instrumentation-client.js` or `instrumentation-client.ts` file in your application's root directory:\n+\n+```js filename=\"instrumentation-client.js\"\n+// Initialize analytics before the app starts\n+console.log('Analytics initialized')\n+\n+// Set up global error tracking\n+window.addEventListener('error', (event) => {\n+  // Send to your error tracking service\n+  reportError(event.error)\n+})\n+```\n+\n ## Build Your Own\n \n <PagesOnly>"
        },
        {
            "sha": "6ffe7f0bb69ed8b9db7385dfbbd876d3bf26242e",
            "filename": "docs/01-app/04-api-reference/03-file-conventions/instrumentation-client.mdx",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/2737373c3b554cba304a0af03383636bba5086e2/docs%2F01-app%2F04-api-reference%2F03-file-conventions%2Finstrumentation-client.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/2737373c3b554cba304a0af03383636bba5086e2/docs%2F01-app%2F04-api-reference%2F03-file-conventions%2Finstrumentation-client.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F04-api-reference%2F03-file-conventions%2Finstrumentation-client.mdx?ref=2737373c3b554cba304a0af03383636bba5086e2",
            "patch": "@@ -0,0 +1,40 @@\n+---\n+title: instrumentation-client.js\n+description: Learn how to add client-side instrumentation to track and monitor your Next.js application's frontend performance.\n+---\n+\n+The `instrumentation-client.js|ts` file allows you to add monitoring and analytics code that runs before your application's frontend code starts executing. This is useful for setting up performance tracking, error monitoring, or any other client-side observability tools.\n+\n+To use it, place the file in the **root** of your application or inside a `src` folder.\n+\n+## Usage\n+\n+Unlike [server-side instrumentation](/docs/app/building-your-application/optimizing/instrumentation), you don't need to export any specific functions. Simply write your monitoring code directly in the file:\n+\n+```ts filename=\"instrumentation-client.ts\" switcher\n+// Set up performance monitoring\n+performance.mark('app-init')\n+\n+// Initialize analytics\n+console.log('Analytics initialized')\n+\n+// Set up error tracking\n+window.addEventListener('error', (event) => {\n+  // Send to your error tracking service\n+  reportError(event.error)\n+})\n+```\n+\n+```js filename=\"instrumentation-client.js\" switcher\n+// Set up performance monitoring\n+performance.mark('app-init')\n+\n+// Initialize analytics\n+console.log('Analytics initialized')\n+\n+// Set up error tracking\n+window.addEventListener('error', (event) => {\n+  // Send to your error tracking service\n+  reportError(event.error)\n+})\n+```"
        },
        {
            "sha": "1c66cb5702bb58e4ad58fbfde839320a154a96c5",
            "filename": "docs/01-app/04-api-reference/05-config/01-next-config-js/clientInstrumentationHook.mdx",
            "status": "removed",
            "additions": 0,
            "deletions": 66,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/docs%2F01-app%2F04-api-reference%2F05-config%2F01-next-config-js%2FclientInstrumentationHook.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/docs%2F01-app%2F04-api-reference%2F05-config%2F01-next-config-js%2FclientInstrumentationHook.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F04-api-reference%2F05-config%2F01-next-config-js%2FclientInstrumentationHook.mdx?ref=906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106",
            "patch": "@@ -1,66 +0,0 @@\n----\n-title: clientInstrumentationHook\n-description: Enable client-side instrumentation.\n-version: experimental\n----\n-\n-## Usage\n-\n-When enabled, Next.js searches for an `instrumentation-client.ts` file at the project root and executes it synchronously before hydration. This file is bundled into the initial JavaScript chunk, allowing you to run analytics or monitoring before any other code executes. The code in this file runs exclusively on the client side and is not executed during server-side rendering (SSR).\n-\n-> **Good to know:**\n->\n-> - Client instrumentation increases bundle size and execution time, so keep it minimal to avoid delaying interactivity.\n-\n-```ts filename=\"next.config.ts\" switcher\n-import type { NextConfig } from 'next'\n-\n-const nextConfig: NextConfig = {\n-  experimental: {\n-    clientInstrumentationHook: true,\n-  },\n-}\n-\n-export default nextConfig\n-```\n-\n-```js filename=\"next.config.js\" switcher\n-/** @type {import('next').NextConfig} */\n-const nextConfig = {\n-  experimental: {\n-    clientInstrumentationHook: true,\n-  },\n-}\n-\n-module.exports = nextConfig\n-```\n-\n-## Example\n-\n-Unlike server-side [instrumentation](/docs/app/building-your-application/optimizing/instrumentation), `instrumentation-client.ts` does not need to export a `register` function. You can write your synchronous code directly in the file:\n-\n-```ts filename=\"instrumentation-client.ts\" switcher\n-// No need to export a register function\n-// This code runs synchronously before hydration\n-console.log('Client instrumentation initialized')\n-// Set up performance monitoring\n-performance.mark('app-init')\n-// Set up error tracking\n-window.addEventListener('error', (event) => {\n-  console.error('Captured in instrumentation:', event.error)\n-  // Send to your error tracking service\n-})\n-```\n-\n-```js filename=\"instrumentation-client.js\" switcher\n-// No need to export a register function\n-// This code runs synchronously before hydration\n-console.log('Client instrumentation initialized')\n-// Set up performance monitoring\n-performance.mark('app-init')\n-// Set up error tracking\n-window.addEventListener('error', (event) => {\n-  console.error('Captured in instrumentation:', event.error)\n-  // Send to your error tracking service\n-})\n-```"
        },
        {
            "sha": "8c98ad8c54842e720bcf83c6c5505883f752fdbe",
            "filename": "packages/next/src/build/webpack/plugins/define-env-plugin.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts?ref=2737373c3b554cba304a0af03383636bba5086e2",
            "patch": "@@ -240,9 +240,6 @@ export function getDefineEnv({\n     'process.env.__NEXT_TELEMETRY_DISABLED': Boolean(\n       process.env.NEXT_TELEMETRY_DISABLED\n     ),\n-    'process.env.__NEXT_EXPERIMENTAL_CLIENT_INSTRUMENTATION_HOOK': Boolean(\n-      config.experimental.clientInstrumentationHook\n-    ),\n     ...(isNodeOrEdgeCompilation\n       ? {\n           // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)"
        },
        {
            "sha": "a6415e3bb99d6fd9ebfc3e18d1732840296e7e2a",
            "filename": "packages/next/src/lib/require-instrumentation-client.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 23,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts?ref=2737373c3b554cba304a0af03383636bba5086e2",
            "patch": "@@ -4,30 +4,28 @@\n  * The `private-next-instrumentation-client` module is automatically aliased to\n  * the `instrumentation-client.ts` file in the project root by webpack or turbopack.\n  */\n-if (process.env.__NEXT_EXPERIMENTAL_CLIENT_INSTRUMENTATION_HOOK) {\n-  if (process.env.NODE_ENV === 'development') {\n-    const measureName = 'Client Instrumentation Hook'\n-    const startTime = performance.now()\n-    require('private-next-instrumentation-client')\n-    const endTime = performance.now()\n+if (process.env.NODE_ENV === 'development') {\n+  const measureName = 'Client Instrumentation Hook'\n+  const startTime = performance.now()\n+  require('private-next-instrumentation-client')\n+  const endTime = performance.now()\n \n-    const duration = endTime - startTime\n-    performance.measure(measureName, {\n-      start: startTime,\n-      end: endTime,\n-      detail: 'Client instrumentation initialization',\n-    })\n+  const duration = endTime - startTime\n+  performance.measure(measureName, {\n+    start: startTime,\n+    end: endTime,\n+    detail: 'Client instrumentation initialization',\n+  })\n \n-    // Using 16ms threshold as it represents one frame (1000ms/60fps)\n-    // This helps identify if the instrumentation hook initialization\n-    // could potentially cause frame drops during development.\n-    const THRESHOLD = 16\n-    if (duration > THRESHOLD) {\n-      console.log(\n-        `[${measureName}] Slow execution detected: ${duration.toFixed(0)}ms (Note: Code download overhead is not included in this measurement)`\n-      )\n-    }\n-  } else {\n-    require('private-next-instrumentation-client')\n+  // Using 16ms threshold as it represents one frame (1000ms/60fps)\n+  // This helps identify if the instrumentation hook initialization\n+  // could potentially cause frame drops during development.\n+  const THRESHOLD = 16\n+  if (duration > THRESHOLD) {\n+    console.log(\n+      `[${measureName}] Slow execution detected: ${duration.toFixed(0)}ms (Note: Code download overhead is not included in this measurement)`\n+    )\n   }\n+} else {\n+  require('private-next-instrumentation-client')\n }"
        },
        {
            "sha": "47e01139da7fa8299357483a1693021def51efbf",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2737373c3b554cba304a0af03383636bba5086e2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=2737373c3b554cba304a0af03383636bba5086e2",
            "patch": "@@ -457,7 +457,6 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n             buildTimeThresholdMs: z.number().int(),\n           })\n           .optional(),\n-        clientInstrumentationHook: z.boolean().optional(),\n       })\n       .optional(),\n     exportPathMap: z"
        },
        {
            "sha": "810aff4255c66e95fc6a54797a847b68c5e24927",
            "filename": "test/e2e/instrumentation-client-hook/app-router/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-router%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-router%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-router%2Fnext.config.js?ref=906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106",
            "patch": "@@ -1,5 +0,0 @@\n-module.exports = {\n-  experimental: {\n-    clientInstrumentationHook: true,\n-  },\n-}"
        },
        {
            "sha": "810aff4255c66e95fc6a54797a847b68c5e24927",
            "filename": "test/e2e/instrumentation-client-hook/app-with-src/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-with-src%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-with-src%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finstrumentation-client-hook%2Fapp-with-src%2Fnext.config.js?ref=906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106",
            "patch": "@@ -1,5 +0,0 @@\n-module.exports = {\n-  experimental: {\n-    clientInstrumentationHook: true,\n-  },\n-}"
        },
        {
            "sha": "810aff4255c66e95fc6a54797a847b68c5e24927",
            "filename": "test/e2e/instrumentation-client-hook/pages-router/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fpages-router%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106/test%2Fe2e%2Finstrumentation-client-hook%2Fpages-router%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finstrumentation-client-hook%2Fpages-router%2Fnext.config.js?ref=906dfd2b76e5c4d6f04f37dabd8d15f1cdf42106",
            "patch": "@@ -1,5 +0,0 @@\n-module.exports = {\n-  experimental: {\n-    clientInstrumentationHook: true,\n-  },\n-}"
        }
    ],
    "stats": {
        "total": 186,
        "additions": 78,
        "deletions": 108
    }
}