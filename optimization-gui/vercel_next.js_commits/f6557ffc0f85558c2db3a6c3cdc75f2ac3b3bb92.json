{
    "author": "mischnic",
    "message": "Turbopack: fix `sideEffects` matching for non-relative globs (#77693)\n\nPreviously, `\"sideEffects\": [\"lib/common.js\"]` never matched.\r\n\r\nCloses #66348\r\nCloses PACK-4241",
    "sha": "f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
    "files": [
        {
            "sha": "65173eb921fc6aec84ec9f178a561fd477a6971a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/placeable.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -50,7 +50,9 @@ async fn side_effects_from_package_json(\n                     .filter_map(|side_effect| {\n                         if let Some(side_effect) = side_effect.as_str() {\n                             if side_effect.contains('/') {\n-                                Some(Glob::new(side_effect.into()))\n+                                Some(Glob::new(\n+                                    side_effect.strip_prefix(\"./\").unwrap_or(side_effect).into(),\n+                                ))\n                             } else {\n                                 Some(Glob::new(format!(\"**/{side_effect}\").into()))\n                             }\n@@ -179,7 +181,8 @@ pub async fn is_marked_as_side_effect_free(\n                     .await?\n                     .get_relative_path_to(&*path.await?)\n                 {\n-                    return Ok(Vc::cell(!glob.await?.execute(&rel_path)));\n+                    let rel_path = rel_path.strip_prefix(\"./\").unwrap_or(&rel_path);\n+                    return Ok(Vc::cell(!glob.await?.execute(rel_path)));\n                 }\n             }\n         }"
        },
        {
            "sha": "e1befbe63a6f6483bb5057d5a2595ed4b612cbe9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/basic/input/index.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Findex.js?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -102,7 +102,12 @@ import { effects } from \"package-partial/effect\";\n it(\"should handle globs in sideEffects field\", () => {\n   expect(a9).toBe(\"a\");\n   expect(b9).toBe(\"b\");\n-  expect(effects).toEqual([\"file.side.js\", \"dir/file.js\"]);\n+  expect(effects).toEqual([\n+    \"file.side.js\",\n+    \"sub/file.side.js\",\n+    \"sub/bare.js\",\n+    \"dir/file.js\"\n+  ]);\n });\n \n it(\"should generate a correct facade from async modules\", async () => {"
        },
        {
            "sha": "1773b8f9bfa68cff4bac89f3d60993a6b6dd5df2",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/basic/input/node_modules/package-partial/index.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Findex.js?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -5,6 +5,9 @@ export * from \"./not-compiled.js\";\n // export * from \"./not-existing.js\";\n export * from \"./not-executed.js\";\n export * from \"./file.side.js\";\n+export * from \"./sub/file.side.js\";\n+export * from \"./sub/bare.js\";\n export { named } from \"./dir/file.js\";\n+\n export { a } from \"./a.js\";\n export { b } from \"./b.js\";"
        },
        {
            "sha": "f517360e885ac6f7b41ed3f7c8269de4c91ecc66",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/basic/input/node_modules/package-partial/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fpackage.json?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -2,6 +2,7 @@\n   \"sideEffects\": [\n     \"./index.js\",\n     \"*.side.js\",\n+    \"sub/bare.js\",\n     \"./dir/*.js\"\n   ]\n }"
        },
        {
            "sha": "f11d8dd692eec96cd74ecdd5f2b3fea665b46f37",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/basic/input/node_modules/package-partial/sub/bare.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Fbare.js",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Fbare.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Fbare.js?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -0,0 +1,5 @@\n+import { effects } from \"../effect.js\";\n+\n+export const bare = \"bare\";\n+\n+effects.push(\"sub/bare.js\");"
        },
        {
            "sha": "24c1f1b86cf6943182d21c4aa796030fae8aff00",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/side-effects-optimization/basic/input/node_modules/package-partial/sub/file.side.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Ffile.side.js",
            "raw_url": "https://github.com/vercel/next.js/raw/f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Ffile.side.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fside-effects-optimization%2Fbasic%2Finput%2Fnode_modules%2Fpackage-partial%2Fsub%2Ffile.side.js?ref=f6557ffc0f85558c2db3a6c3cdc75f2ac3b3bb92",
            "patch": "@@ -0,0 +1,5 @@\n+import { effects } from \"../effect.js\";\n+\n+export const namedDir = \"named-dir\";\n+\n+effects.push(\"sub/file.side.js\");"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 25,
        "deletions": 3
    }
}