{
    "author": "huozhi",
    "message": "Handle graceful fallback for custom error boundaries (#78121)",
    "sha": "35864749113a10d7943a2df9d046c218e7ade023",
    "files": [
        {
            "sha": "8a825c6efa1f7004f3d68ba677aa4bb319109a0c",
            "filename": "packages/next/src/client/components/layout-router.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -487,6 +487,10 @@ function LoadingBoundary({\n   return <>{children}</>\n }\n \n+function RenderChildren({ children }: { children: React.ReactNode }) {\n+  return <>{children}</>\n+}\n+\n /**\n  * OuterLayoutRouter handles the current segment as well as <Offscreen> rendering of other segments.\n  * It can be rendered next to each other with a different `parallelRouterKey`, allowing for Parallel routes.\n@@ -502,6 +506,7 @@ export default function OuterLayoutRouter({\n   notFound,\n   forbidden,\n   unauthorized,\n+  gracefullyDegrade,\n }: {\n   parallelRouterKey: string\n   error: ErrorComponent | undefined\n@@ -513,6 +518,7 @@ export default function OuterLayoutRouter({\n   notFound: React.ReactNode | undefined\n   forbidden: React.ReactNode | undefined\n   unauthorized: React.ReactNode | undefined\n+  gracefullyDegrade?: boolean\n }) {\n   const context = useContext(LayoutRouterContext)\n   if (!context) {\n@@ -596,12 +602,17 @@ export default function OuterLayoutRouter({\n     - Error boundary\n       - Only renders error boundary if error component is provided.\n       - Rendered for each segment to ensure they have their own error state.\n+      - When gracefully degrade for bots, skip rendering error boundary.\n     - Loading boundary\n       - Only renders suspense boundary if loading components is provided.\n       - Rendered for each segment to ensure they have their own loading state.\n       - Passed to the router during rendering to ensure it can be immediately rendered when suspending on a Flight fetch.\n   */\n \n+    const ErrorBoundaryComponent = gracefullyDegrade\n+      ? RenderChildren\n+      : ErrorBoundary\n+\n     // TODO: The loading module data for a segment is stored on the parent, then\n     // applied to each of that parent segment's parallel route slots. In the\n     // simple case where there's only one parallel route (the `children` slot),\n@@ -616,7 +627,7 @@ export default function OuterLayoutRouter({\n         key={stateKey}\n         value={\n           <ScrollAndFocusHandler segmentPath={segmentPath}>\n-            <ErrorBoundary\n+            <ErrorBoundaryComponent\n               errorComponent={error}\n               errorStyles={errorStyles}\n               errorScripts={errorScripts}\n@@ -637,7 +648,7 @@ export default function OuterLayoutRouter({\n                   </RedirectBoundary>\n                 </HTTPAccessFallbackBoundary>\n               </LoadingBoundary>\n-            </ErrorBoundary>\n+            </ErrorBoundaryComponent>\n           </ScrollAndFocusHandler>\n         }\n       >"
        },
        {
            "sha": "17e1bb060fb74433d6aa4861fe0099dfbd57e736",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -189,6 +189,8 @@ async function createComponentTreeInternal({\n     () => getLayoutOrPageModule(tree)\n   )\n \n+  const gracefullyDegrade = !!ctx.renderOpts.botType\n+\n   /**\n    * Checks if the current segment is a root layout.\n    */\n@@ -541,6 +543,9 @@ async function createComponentTreeInternal({\n             notFound={notFoundComponent}\n             forbidden={forbiddenComponent}\n             unauthorized={unauthorizedComponent}\n+            // Since gracefullyDegrade only applies to bots, only\n+            // pass it when we're in a bot context to avoid extra bytes.\n+            {...(gracefullyDegrade && { gracefullyDegrade })}\n           />,\n           childCacheNodeSeedData,\n         ]"
        },
        {
            "sha": "f5bc87188a045de711d147b0b254a8dfeefed1a7",
            "filename": "test/production/app-dir/graceful-degrade-error/app/async-layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Fasync-layout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Fasync-layout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Fasync-layout.tsx?ref=499eb1a4cde5c36e5f269c98b6067a8979b570d2",
            "patch": "@@ -1,7 +0,0 @@\n-'use client'\n-\n-import dynamic from 'next/dynamic'\n-\n-const AsyncLayout = dynamic(async () => import('./layout-wrapper'))\n-\n-export default AsyncLayout"
        },
        {
            "sha": "7622c0e3e0a559a43090e4f7a02b7adbc8dc2887",
            "filename": "test/production/app-dir/graceful-degrade-error/app/layout-wrapper.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout-wrapper.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout-wrapper.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout-wrapper.tsx?ref=499eb1a4cde5c36e5f269c98b6067a8979b570d2",
            "patch": "@@ -1,7 +0,0 @@\n-'use client'\n-\n-export default ({ children }: any) => (\n-  <html className=\"layout-cls\">\n-    <body className=\"body-cls\">{children}</body>\n-  </html>\n-)"
        },
        {
            "sha": "c6cf49049d63efddbdb05b4932e01b2f1f402f13",
            "filename": "test/production/app-dir/graceful-degrade-error/app/layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/499eb1a4cde5c36e5f269c98b6067a8979b570d2/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade-error%2Fapp%2Flayout.tsx?ref=499eb1a4cde5c36e5f269c98b6067a8979b570d2",
            "patch": "@@ -1,7 +0,0 @@\n-'use client'\n-\n-import AsyncLayout from './async-layout'\n-\n-export default function Root({ children }: { children: React.ReactNode }) {\n-  return <AsyncLayout>{children}</AsyncLayout>\n-}"
        },
        {
            "sha": "436cd68a7caecf8d1ef5db1d3e04f52c31cbf5a8",
            "filename": "test/production/app-dir/graceful-degrade/basic/app/async-content.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fasync-content.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fasync-content.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fasync-content.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/app/async-content.tsx"
        },
        {
            "sha": "5f723c0b11c023d58b677b4af9064efbfbac14bf",
            "filename": "test/production/app-dir/graceful-degrade/basic/app/content.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fcontent.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fcontent.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fcontent.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/app/content.tsx"
        },
        {
            "sha": "4584d389e5fdc6f0a24ac0125e73a74171fd70a1",
            "filename": "test/production/app-dir/graceful-degrade/basic/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Flayout.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,9 @@\n+'use client'\n+\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html className=\"layout-cls\">\n+      <body className=\"body-cls\">{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "1314b13f0d034687c53daa8a1fb840078c646f23",
            "filename": "test/production/app-dir/graceful-degrade/basic/app/page-client.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage-client.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/app/page-client.tsx"
        },
        {
            "sha": "67686cd31a09097770bb03df083f013fbca17251",
            "filename": "test/production/app-dir/graceful-degrade/basic/app/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fapp%2Fpage.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/app/page.tsx"
        },
        {
            "sha": "fd7bd4cc16aab8670897c6608362ea400a945592",
            "filename": "test/production/app-dir/graceful-degrade/basic/graceful-degrade-non-bot.test.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade-non-bot.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade-non-bot.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade-non-bot.test.ts?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -3,9 +3,9 @@\n // will not be closed and reset properly. TODO: investigate why browser.close didn't help.\n \n import { nextTestSetup } from 'e2e-utils'\n-import { deleteBrowserDynamicChunks } from './delete-dynamic-chunk'\n+import { deleteBrowserDynamicChunks } from '../delete-dynamic-chunk'\n \n-describe('graceful-degrade-error - non bot', () => {\n+describe('graceful-degrade - non bot', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n   })",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/graceful-degrade-error-non-bot.test.ts"
        },
        {
            "sha": "57c6a2e8a8eb0c4862c6605b8c9676464e35e38e",
            "filename": "test/production/app-dir/graceful-degrade/basic/graceful-degrade.test.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fbasic%2Fgraceful-degrade.test.ts?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -1,7 +1,7 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { deleteBrowserDynamicChunks } from './delete-dynamic-chunk'\n+import { deleteBrowserDynamicChunks } from '../delete-dynamic-chunk'\n \n-describe('graceful-degrade-error', () => {\n+describe('graceful-degrade', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n   })",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/graceful-degrade-error.test.ts"
        },
        {
            "sha": "436cd68a7caecf8d1ef5db1d3e04f52c31cbf5a8",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/blog/async-content.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fasync-content.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fasync-content.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fasync-content.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+import dynamic from 'next/dynamic'\n+\n+export const Large = dynamic(() => import('./content'))"
        },
        {
            "sha": "5f723c0b11c023d58b677b4af9064efbfbac14bf",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/blog/content.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fcontent.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fcontent.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fcontent.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function Large() {\n+  return <p>large test content</p>\n+}"
        },
        {
            "sha": "e02e4395af3d877e744f615e7df293958bd2b746",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/blog/error.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Ferror.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Ferror.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Ferror.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,9 @@\n+'use client'\n+\n+export default function Error() {\n+  return (\n+    <div className=\"error-boundary\">\n+      <h1>Custom error boundary</h1>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "1314b13f0d034687c53daa8a1fb840078c646f23",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/blog/page-client.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage-client.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,12 @@\n+'use client'\n+\n+import { Large } from './async-content'\n+\n+export default function Page() {\n+  return (\n+    <div className=\"page\">\n+      <p>hello world von server</p>\n+      <Large />\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "67686cd31a09097770bb03df083f013fbca17251",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/blog/page.tsx",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Fblog%2Fpage.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,2 @@\n+export { default } from './page-client'\n+export const dynamic = 'force-dynamic'"
        },
        {
            "sha": "4584d389e5fdc6f0a24ac0125e73a74171fd70a1",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fapp%2Flayout.tsx?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,9 @@\n+'use client'\n+\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html className=\"layout-cls\">\n+      <body className=\"body-cls\">{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "3d39df9e239c0160d0d17645473725662b62a424",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/graceful-degrade-custom-error-non-bot.test.ts",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error-non-bot.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error-non-bot.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error-non-bot.test.ts?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,40 @@\n+// Duplicate the test file of graceful-degrade-error-bot.test.ts since we need to\n+// restart with a new browser context for UA setting. Otherwise the browser context\n+// will not be closed and reset properly. TODO: investigate why browser.close didn't help.\n+\n+import { nextTestSetup } from 'e2e-utils'\n+import { deleteBrowserDynamicChunks } from '../delete-dynamic-chunk'\n+\n+describe('graceful-degrade - custom-error - non bot', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  // Delete client chunks to simulate chunk loading failure\n+  beforeAll(() => {\n+    deleteBrowserDynamicChunks(next)\n+  })\n+\n+  it('should not degrade to graceful error when chunk loading fails in ssr for non-bot user agents', async () => {\n+    const browser = await next.browser('/blog')\n+\n+    const logs = await browser.log()\n+    const errors = logs\n+      .filter((x) => x.source === 'error')\n+      .map((x) => x.message)\n+      .join('\\n')\n+\n+    expect(errors).toMatch(/Failed to load resource./)\n+    // Should show the same layout content\n+    const html = await browser.elementByCss('html')\n+    const body = await browser.elementByCss('body')\n+    expect(await html.getAttribute('class')).toBe('layout-cls')\n+    expect(await body.getAttribute('class')).toBe('body-cls')\n+\n+    // Show the custom error boundary text\n+    const errorBoundaryText = await browser\n+      .elementByCss('.error-boundary')\n+      .text()\n+    expect(errorBoundaryText).toMatch(/Custom error boundary/)\n+  })\n+})"
        },
        {
            "sha": "cfbc116133eb108caaa3d34966563868c3234a33",
            "filename": "test/production/app-dir/graceful-degrade/custom-error/graceful-degrade-custom-error.test.ts",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fcustom-error%2Fgraceful-degrade-custom-error.test.ts?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "patch": "@@ -0,0 +1,36 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { deleteBrowserDynamicChunks } from '../delete-dynamic-chunk'\n+\n+describe('graceful-degrade - custom error', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  // Delete client chunks to simulate chunk loading failure\n+  beforeAll(() => {\n+    deleteBrowserDynamicChunks(next)\n+  })\n+\n+  it('should degrade to graceful error when chunk loading fails in ssr for bot', async () => {\n+    const browser = await next.browser('/blog', {\n+      userAgent: 'Googlebot',\n+    })\n+\n+    const logs = await browser.log()\n+    const errors = logs\n+      .filter((x) => x.source === 'error')\n+      .map((x) => x.message)\n+      .join('\\n')\n+\n+    expect(errors).toMatch(/Failed to load resource./)\n+    // Should show the original content\n+    const html = await browser.elementByCss('html')\n+    const body = await browser.elementByCss('body')\n+    expect(await html.getAttribute('class')).toBe('layout-cls')\n+    expect(await body.getAttribute('class')).toBe('body-cls')\n+\n+    // Do not contain the custom error boundary text\n+    const bodyText = await body.text()\n+    expect(bodyText).not.toMatch(/Custom error boundary/)\n+  })\n+})"
        },
        {
            "sha": "a9f8513249fc92709c334226ea2ca64725ba555a",
            "filename": "test/production/app-dir/graceful-degrade/delete-dynamic-chunk.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fdelete-dynamic-chunk.js",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fdelete-dynamic-chunk.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fdelete-dynamic-chunk.js?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/delete-dynamic-chunk.js"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/app-dir/graceful-degrade/next.config.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/35864749113a10d7943a2df9d046c218e7ade023/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fgraceful-degrade%2Fnext.config.js?ref=35864749113a10d7943a2df9d046c218e7ade023",
            "previous_filename": "test/production/app-dir/graceful-degrade-error/next.config.js"
        }
    ],
    "stats": {
        "total": 176,
        "additions": 149,
        "deletions": 27
    }
}