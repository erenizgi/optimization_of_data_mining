{
    "author": "unstubbable",
    "message": "Honour `NEXT_TEST_PREFER_OFFLINE` in `install-native.mjs` (#85850)\n\nThe `scripts/install-native.mjs` script is run in the postinstall step\nof the Next.js monorepo to install the published binary packages of the\nlatest Next.js canary version. This change makes the script respect the\n`NEXT_TEST_PREFER_OFFLINE` environment variable, allowing it to prefer\ninstalling previously downloaded packages from the local cache. This is\nuseful for scenarios where network access is limited or unavailable.",
    "sha": "f43f339cc5c2126d6cb34ef461763e5f45b0ceff",
    "files": [
        {
            "sha": "1374be3ab708042e2eba2835f176b54a644a1596",
            "filename": "scripts/install-native.mjs",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/f43f339cc5c2126d6cb34ef461763e5f45b0ceff/scripts%2Finstall-native.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/f43f339cc5c2126d6cb34ef461763e5f45b0ceff/scripts%2Finstall-native.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Finstall-native.mjs?ref=f43f339cc5c2126d6cb34ef461763e5f45b0ceff",
            "patch": "@@ -10,6 +10,9 @@ import fsp from 'fs/promises'\n     )\n     return\n   }\n+\n+  const preferOffline = process.env.NEXT_TEST_PREFER_OFFLINE === '1'\n+\n   let cwd = process.cwd()\n   const { version: nextVersion } = JSON.parse(\n     fs.readFileSync(path.join(cwd, 'packages', 'next', 'package.json'))\n@@ -57,9 +60,11 @@ import fsp from 'fs/promises'\n     fs.writeFileSync(path.join(tmpdir, 'package.json'), JSON.stringify(pkgJson))\n     fs.writeFileSync(path.join(tmpdir, '.npmrc'), 'node-linker=hoisted')\n \n-    let { stdout } = await execa('pnpm', ['add', `next@${nextVersion}`], {\n-      cwd: tmpdir,\n-    })\n+    const args = ['add', `next@${nextVersion}`]\n+    if (preferOffline) {\n+      args.push('--prefer-offline')\n+    }\n+    let { stdout } = await execa('pnpm', args, { cwd: tmpdir })\n     console.log(stdout)\n \n     let pkgs = fs.readdirSync(path.join(tmpdir, 'node_modules/@next'))"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 8,
        "deletions": 3
    }
}