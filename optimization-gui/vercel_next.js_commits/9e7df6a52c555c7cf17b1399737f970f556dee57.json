{
    "author": "huozhi",
    "message": "[segment explorer] missing file suggestion (#81617)",
    "sha": "9e7df6a52c555c7cf17b1399737f970f556dee57",
    "files": [
        {
            "sha": "025c10605664f88d2b619595115f1a11c0de3804",
            "filename": "packages/next/src/next-devtools/components/tooltip.css",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.css?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -11,6 +11,8 @@\n   font-size: 14px;\n   line-height: 1.4;\n   pointer-events: none;\n+  color: var(--color-gray-100);\n+  background-color: var(--color-gray-1000);\n }\n \n .tooltip-arrow {\n@@ -25,31 +27,31 @@\n .tooltip-arrow--top {\n   border-width: var(--arrow-size, 6px) var(--arrow-size, 6px) 0\n     var(--arrow-size, 6px);\n-  border-top-color: var(--tooltip-bg-color);\n+  border-top-color: var(--color-gray-1000);\n   bottom: 0;\n   transform: translateY(100%);\n }\n \n .tooltip-arrow--bottom {\n   border-width: 0 var(--arrow-size, 6px) var(--arrow-size, 6px)\n     var(--arrow-size, 6px);\n-  border-bottom-color: var(--tooltip-bg-color);\n+  border-bottom-color: var(--color-gray-1000);\n   top: 0;\n   transform: translateY(-100%);\n }\n \n .tooltip-arrow--left {\n   border-width: var(--arrow-size, 6px) 0 var(--arrow-size, 6px)\n     var(--arrow-size, 6px);\n-  border-left-color: var(--tooltip-bg-color);\n+  border-left-color: var(--color-gray-1000);\n   right: 0;\n   transform: translateX(100%);\n }\n \n .tooltip-arrow--right {\n   border-width: var(--arrow-size, 6px) var(--arrow-size, 6px)\n     var(--arrow-size, 6px) 0;\n-  border-right-color: var(--tooltip-bg-color);\n+  border-right-color: var(--color-gray-1000);\n   left: 0;\n   transform: translateX(-100%);\n }"
        },
        {
            "sha": "33102dd25702f629552a6b9ad0f11afa977eeac2",
            "filename": "packages/next/src/next-devtools/components/tooltip.stories.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.stories.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -31,14 +31,6 @@ const meta: Meta<typeof Tooltip> = {\n       control: { type: 'range', min: 0, max: 20, step: 1 },\n       description: 'Distance between tooltip and trigger element',\n     },\n-    bgcolor: {\n-      control: { type: 'color' },\n-      description: 'Background color of the tooltip',\n-    },\n-    color: {\n-      control: { type: 'color' },\n-      description: 'Text color of the tooltip',\n-    },\n   },\n }\n \n@@ -52,8 +44,6 @@ export const Default: Story = {\n     direction: 'top',\n     arrowSize: 6,\n     offset: 8,\n-    bgcolor: 'var(--color-gray-1000)',\n-    color: 'var(--color-gray-100)',\n   },\n   render: (args) => (\n     <div>"
        },
        {
            "sha": "e14c0c3b835b083b17216a3d2e7d678c7696025d",
            "filename": "packages/next/src/next-devtools/components/tooltip.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fcomponents%2Ftooltip.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -11,8 +11,6 @@ interface TooltipProps {\n   direction?: TooltipDirection\n   arrowSize?: number\n   offset?: number\n-  bgcolor?: string\n-  color?: string\n   className?: string\n }\n \n@@ -25,8 +23,6 @@ export const Tooltip = forwardRef<HTMLDivElement, TooltipProps>(\n       direction = 'top',\n       arrowSize = 6,\n       offset = 8,\n-      bgcolor = '#000',\n-      color = '#fff',\n     },\n     ref\n   ) {\n@@ -67,9 +63,6 @@ export const Tooltip = forwardRef<HTMLDivElement, TooltipProps>(\n                 className={cx('tooltip', className)}\n                 style={\n                   {\n-                    backgroundColor: bgcolor,\n-                    color: color,\n-                    '--tooltip-bg-color': bgcolor,\n                     '--arrow-size': `${arrowSize}px`,\n                   } as React.CSSProperties\n                 }\n@@ -80,7 +73,6 @@ export const Tooltip = forwardRef<HTMLDivElement, TooltipProps>(\n                   style={\n                     {\n                       '--arrow-size': `${arrowSize}px`,\n-                      '--tooltip-bg-color': bgcolor,\n                     } as React.CSSProperties\n                   }\n                 />"
        },
        {
            "sha": "ea5d043055a15add4618c82688eb540674a8fef1",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-boundary-trigger.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -1,7 +1,10 @@\n import './segment-boundary-trigger.css'\n import { useCallback, useState, useRef, useMemo } from 'react'\n import { Menu } from '@base-ui-components/react/menu'\n-import type { SegmentNodeState } from '../../../userspace/app/segment-explorer-node'\n+import type {\n+  SegmentBoundaryType,\n+  SegmentNodeState,\n+} from '../../../userspace/app/segment-explorer-node'\n import { normalizeBoundaryFilename } from '../../../../server/app-render/segment-explorer-path'\n import { useClickOutsideAndEscape } from '../errors/dev-tools-indicator/utils'\n \n@@ -22,7 +25,7 @@ export function SegmentBoundaryTrigger({\n   boundaries,\n }: {\n   nodeState: SegmentNodeState\n-  boundaries: Record<'not-found' | 'loading' | 'error', string | null>\n+  boundaries: Record<SegmentBoundaryType, string | null>\n }) {\n   const currNode = nodeState\n   const { pagePath, boundaryType, setBoundaryType: onSelectBoundary } = currNode\n@@ -50,9 +53,8 @@ export function SegmentBoundaryTrigger({\n   )\n \n   const firstDefinedBoundary = Object.values(boundaries).find((v) => v !== null)\n-  const possibleExtension = firstDefinedBoundary\n-    ? firstDefinedBoundary.split('.')?.pop()\n-    : 'js'\n+  const possibleExtension =\n+    (firstDefinedBoundary || '').split('.').pop() || 'js'\n \n   const fileNames = useMemo(() => {\n     return Object.fromEntries("
        },
        {
            "sha": "2505a8c9068293c9733ff52fcc9c46ccae3c2cbc",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.css",
            "status": "modified",
            "additions": 21,
            "deletions": 6,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -3,7 +3,6 @@\n   padding: 0 8px;\n   width: 100%;\n   height: 100%;\n-  overflow-y: hidden;\n }\n \n .segment-explorer-page-route-bar {\n@@ -31,13 +30,16 @@\n .segment-explorer-item:nth-child(even) {\n   background-color: var(--color-background-200);\n }\n-\n .segment-explorer-item-row {\n   display: flex;\n-  align-items: center;\n+  flex-direction: column;\n   padding-top: 10px;\n   padding-bottom: 10px;\n   padding-right: 4px;\n+}\n+.segment-explorer-item-row-main {\n+  display: flex;\n+  align-items: center;\n   white-space: pre;\n   cursor: default;\n   color: var(--color-gray-1000);\n@@ -56,9 +58,8 @@\n .segment-explorer-filename select {\n   margin-left: auto;\n }\n-\n .segment-explorer-filename--path {\n-  margin-right: auto;\n+  margin-right: 8px;\n }\n .segment-explorer-filename--path small {\n   display: inline-block;\n@@ -83,7 +84,8 @@\n   display: inline-flex;\n   align-items: center;\n   justify-content: center;\n-  padding: 4px 6px;\n+  padding: 0 6px;\n+  height: 20px;\n   border-radius: 16px;\n   line-height: 16px;\n   font-size: var(--size-12);\n@@ -93,6 +95,10 @@\n   background-color: var(--color-gray-300);\n   color: var(--color-gray-1000);\n }\n+.segment-explorer-file-label-text {\n+  display: inline-flex;\n+  align-items: center;\n+}\n \n .segment-explorer-file-label--overridden {\n   background-color: var(--color-amber-300);\n@@ -185,3 +191,12 @@\n .segment-explorer-file-label-tooltip--lg {\n   min-width: 200px;\n }\n+\n+.segment-explorer-suggestions {\n+  display: inline-flex;\n+  gap: 8px;\n+}\n+\n+.segment-explorer-suggestions-tooltip {\n+  width: 200px;\n+}"
        },
        {
            "sha": "c9f3ee4c8656b998ddb5cc6a93b16b995d8470d3",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 110,
            "deletions": 54,
            "changes": 164,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -11,8 +11,11 @@ import {\n   BUILTIN_PREFIX,\n   getBoundaryOriginFileType,\n   isBoundaryFile,\n+  isBuiltinBoundaryFile,\n   normalizeBoundaryFilename,\n } from '../../../../server/app-render/segment-explorer-path'\n+import { SegmentSuggestion } from './segment-suggestion'\n+import type { SegmentBoundaryType } from '../../../userspace/app/segment-explorer-node'\n \n const isFileNode = (node: SegmentTrieNode) => {\n   return !!node.value?.type && !!node.value?.pagePath\n@@ -96,6 +99,37 @@ function SegmentExplorerFooter({\n   )\n }\n \n+export function FilePill({\n+  type,\n+  isBuiltin,\n+  isOverridden,\n+  filePath,\n+  fileName,\n+}: {\n+  type: string\n+  isBuiltin: boolean\n+  isOverridden: boolean\n+  filePath: string\n+  fileName: string\n+}) {\n+  return (\n+    <span\n+      className={cx(\n+        'segment-explorer-file-label',\n+        `segment-explorer-file-label--${type}`,\n+        isBuiltin && 'segment-explorer-file-label--builtin',\n+        isOverridden && 'segment-explorer-file-label--overridden'\n+      )}\n+      onClick={() => {\n+        openInEditor({ filePath })\n+      }}\n+    >\n+      <span className=\"segment-explorer-file-label-text\">{fileName}</span>\n+      {isBuiltin ? <InfoIcon /> : <CodeIcon className=\"code-icon\" />}\n+    </span>\n+  )\n+}\n+\n export function PageSegmentTree({ page }: { page: string }) {\n   const tree = useSegmentTree()\n \n@@ -137,6 +171,8 @@ export function PageSegmentTree({ page }: { page: string }) {\n   )\n }\n \n+const GLOBAL_ERROR_BOUNDARY_TYPE = 'global-error'\n+\n function PageSegmentTreeLayerPresentation({\n   segment,\n   node,\n@@ -146,7 +182,34 @@ function PageSegmentTreeLayerPresentation({\n   node: SegmentTrieNode\n   level: number\n }) {\n-  const childrenKeys = Object.keys(node.children)\n+  const childrenKeys = useMemo(\n+    () => Object.keys(node.children),\n+    [node.children]\n+  )\n+\n+  const missingGlobalError = useMemo(() => {\n+    const existingBoundaries: string[] = []\n+    childrenKeys.forEach((key) => {\n+      const childNode = node.children[key]\n+      if (!childNode || !childNode.value) return\n+      const boundaryType = getBoundaryOriginFileType(childNode.value.type)\n+      const isGlobalConvention = boundaryType === GLOBAL_ERROR_BOUNDARY_TYPE\n+      if (\n+        // If global-* convention is not built-in, it's existed\n+        (isGlobalConvention &&\n+          !isBuiltinBoundaryFile(childNode.value.pagePath)) ||\n+        (!isGlobalConvention &&\n+          // If it's non global boundary, we check if file is boundary type\n+          isBoundaryFile(childNode.value.type))\n+      ) {\n+        existingBoundaries.push(boundaryType)\n+      }\n+    })\n+\n+    return (\n+      level === 0 && !existingBoundaries.includes(GLOBAL_ERROR_BOUNDARY_TYPE)\n+    )\n+  }, [node.children, childrenKeys, level])\n \n   const sortedChildrenKeys = childrenKeys.sort((a, b) => {\n     // Prioritize files with extensions over directories\n@@ -208,6 +271,11 @@ function PageSegmentTreeLayerPresentation({\n     folderChildrenKeys.push(childKey)\n   }\n \n+  const possibleExtension =\n+    normalizeBoundaryFilename(filesChildrenKeys[0] || '')\n+      .split('.')\n+      .pop() || 'js'\n+\n   let firstChild = null\n \n   for (let i = sortedChildrenKeys.length - 1; i >= 0; i--) {\n@@ -233,10 +301,11 @@ function PageSegmentTreeLayerPresentation({\n   firstChild = firstChild || firstBoundaryChild\n \n   const hasFilesChildren = filesChildrenKeys.length > 0\n-  const boundaries: Record<'not-found' | 'loading' | 'error', string | null> = {\n+  const boundaries: Record<SegmentBoundaryType, string | null> = {\n     'not-found': null,\n     loading: null,\n     error: null,\n+    'global-error': null,\n   }\n \n   filesChildrenKeys.forEach((childKey) => {\n@@ -252,8 +321,6 @@ function PageSegmentTreeLayerPresentation({\n     }\n   })\n \n-  const filesChildrenKeysBesidesSelectedBoundary = filesChildrenKeys\n-\n   return (\n     <>\n       {hasFilesChildren && (\n@@ -269,19 +336,25 @@ function PageSegmentTreeLayerPresentation({\n               ...{ paddingLeft: `${(level + 1) * 8}px` },\n             }}\n           >\n-            <div className=\"segment-explorer-filename\">\n-              {folderName && (\n-                <span className=\"segment-explorer-filename--path\">\n-                  {folderName}\n-                  {/* hidden slashes for testing snapshots */}\n-                  <small>{'/'}</small>\n-                </span>\n-              )}\n-              {/* display all the file segments in this level */}\n-              {filesChildrenKeysBesidesSelectedBoundary.length > 0 && (\n-                <span className=\"segment-explorer-files\">\n-                  {filesChildrenKeysBesidesSelectedBoundary.map(\n-                    (fileChildSegment) => {\n+            <div className=\"segment-explorer-item-row-main\">\n+              <div className=\"segment-explorer-filename\">\n+                {folderName && (\n+                  <span className=\"segment-explorer-filename--path\">\n+                    {folderName}\n+                    {/* hidden slashes for testing snapshots */}\n+                    <small>{'/'}</small>\n+                  </span>\n+                )}\n+                {missingGlobalError && (\n+                  <SegmentSuggestion\n+                    possibleExtension={possibleExtension}\n+                    missingGlobalError={missingGlobalError}\n+                  />\n+                )}\n+                {/* display all the file segments in this level */}\n+                {filesChildrenKeys.length > 0 && (\n+                  <span className=\"segment-explorer-files\">\n+                    {filesChildrenKeys.map((fileChildSegment) => {\n                       const childNode = node.children[fileChildSegment]\n                       if (!childNode || !childNode.value) {\n                         return null\n@@ -319,43 +392,26 @@ function PageSegmentTreeLayerPresentation({\n                           direction={isBuiltin ? 'right' : 'top'}\n                           title={tooltipMessage}\n                           offset={12}\n-                          bgcolor=\"var(--color-gray-1000)\"\n-                          color=\"var(--color-gray-100)\"\n                         >\n-                          <span\n-                            className={cx(\n-                              'segment-explorer-file-label',\n-                              `segment-explorer-file-label--${childNode.value.type}`,\n-                              isBuiltin &&\n-                                'segment-explorer-file-label--builtin',\n-                              isOverridden &&\n-                                'segment-explorer-file-label--overridden'\n-                            )}\n-                            onClick={() => {\n-                              openInEditor({ filePath })\n-                            }}\n-                          >\n-                            <span className=\"segment-explorer-file-label-text\">\n-                              {fileName}\n-                            </span>\n-                            {isBuiltin ? (\n-                              <InfoIcon />\n-                            ) : (\n-                              <CodeIcon className=\"code-icon\" />\n-                            )}\n-                          </span>\n+                          <FilePill\n+                            type={childNode.value.type}\n+                            isBuiltin={isBuiltin}\n+                            isOverridden={isOverridden}\n+                            filePath={filePath}\n+                            fileName={fileName}\n+                          />\n                         </Tooltip>\n                       )\n-                    }\n-                  )}\n-                </span>\n-              )}\n-              {firstChild && firstChild.value && (\n-                <SegmentBoundaryTrigger\n-                  nodeState={firstChild.value}\n-                  boundaries={boundaries}\n-                />\n-              )}\n+                    })}\n+                  </span>\n+                )}\n+                {firstChild && firstChild.value && (\n+                  <SegmentBoundaryTrigger\n+                    nodeState={firstChild.value}\n+                    boundaries={boundaries}\n+                  />\n+                )}\n+              </div>\n             </div>\n           </div>\n         </div>\n@@ -385,7 +441,7 @@ function PageSegmentTreeLayerPresentation({\n   )\n }\n \n-function openInEditor({ filePath }: { filePath: string }) {\n+export function openInEditor({ filePath }: { filePath: string }) {\n   const params = new URLSearchParams({\n     file: filePath,\n     // Mark the file path is relative to the app directory,\n@@ -399,7 +455,7 @@ function openInEditor({ filePath }: { filePath: string }) {\n   )\n }\n \n-function InfoIcon(props: React.SVGProps<SVGSVGElement>) {\n+export function InfoIcon(props: React.SVGProps<SVGSVGElement>) {\n   return (\n     <svg\n       width=\"16\"\n@@ -435,7 +491,7 @@ function BackArrowIcon() {\n   )\n }\n \n-function CodeIcon(props: React.SVGProps<SVGSVGElement>) {\n+export function CodeIcon(props: React.SVGProps<SVGSVGElement>) {\n   return (\n     <svg\n       width=\"12\""
        },
        {
            "sha": "b8e23243d025c57a07297cdfa279aa686accdb39",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-suggestion.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-suggestion.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-suggestion.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-suggestion.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,21 @@\n+import { Tooltip } from '../../../components/tooltip'\n+import { InfoIcon } from './segment-explorer'\n+\n+export function SegmentSuggestion({\n+  possibleExtension,\n+  missingGlobalError,\n+}: {\n+  possibleExtension: string\n+  missingGlobalError: boolean\n+}) {\n+  const tooltip = missingGlobalError\n+    ? `No global-error.${possibleExtension} found: Add one to ensure users see a helpful message when an unexpected error occurs.`\n+    : null\n+  return (\n+    <span className=\"segment-explorer-suggestions\">\n+      <Tooltip className=\"segment-explorer-suggestions-tooltip\" title={tooltip}>\n+        <InfoIcon />\n+      </Tooltip>\n+    </span>\n+  )\n+}"
        },
        {
            "sha": "003c95d654822c3040dba7c19dbe652c170033d9",
            "filename": "packages/next/src/next-devtools/userspace/app/segment-explorer-node.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -13,14 +13,20 @@ import { useLayoutEffect } from 'react'\n import { dispatcher } from 'next/dist/compiled/next-devtools'\n import { notFound } from '../../../client/components/not-found'\n \n+export type SegmentBoundaryType =\n+  | 'not-found'\n+  | 'error'\n+  | 'loading'\n+  | 'global-error'\n+\n export const SEGMENT_EXPLORER_SIMULATED_ERROR_MESSAGE =\n   'NEXT_DEVTOOLS_SIMULATED_ERROR'\n \n export type SegmentNodeState = {\n   type: string\n   pagePath: string\n   boundaryType: string | null\n-  setBoundaryType: (type: 'error' | 'not-found' | 'loading' | null) => void\n+  setBoundaryType: (type: SegmentBoundaryType | null) => void\n }\n \n function SegmentTrieNode({\n@@ -111,17 +117,17 @@ export function SegmentViewNode({\n }\n \n const SegmentStateContext = createContext<{\n-  boundaryType: 'not-found' | 'error' | 'loading' | null\n-  setBoundaryType: (type: 'not-found' | 'error' | 'loading' | null) => void\n+  boundaryType: SegmentBoundaryType | null\n+  setBoundaryType: (type: SegmentBoundaryType | null) => void\n }>({\n   boundaryType: null,\n   setBoundaryType: () => {},\n })\n \n export function SegmentStateProvider({ children }: { children: ReactNode }) {\n-  const [boundaryType, setBoundaryType] = useState<\n-    'not-found' | 'error' | 'loading' | null\n-  >(null)\n+  const [boundaryType, setBoundaryType] = useState<SegmentBoundaryType | null>(\n+    null\n+  )\n \n   const [errorBoundaryKey, setErrorBoundaryKey] = useState(0)\n   const reloadBoundary = useCallback(\n@@ -130,7 +136,7 @@ export function SegmentStateProvider({ children }: { children: ReactNode }) {\n   )\n \n   const setBoundaryTypeAndReload = useCallback(\n-    (type: 'not-found' | 'error' | 'loading' | null) => {\n+    (type: SegmentBoundaryType | null) => {\n       if (type === null) {\n         reloadBoundary()\n       }"
        },
        {
            "sha": "be358f87244842cc5b78ae87f1d3420ec2f0bab1",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 77,
            "deletions": 55,
            "changes": 132,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -29,7 +29,9 @@ import { DEFAULT_SEGMENT_KEY } from '../../shared/lib/segment'\n import {\n   BOUNDARY_PREFIX,\n   BOUNDARY_SUFFIX,\n+  BUILTIN_PREFIX,\n   getConventionPathByType,\n+  isNextjsBuiltinFilePath,\n } from './segment-explorer-path'\n \n /**\n@@ -55,7 +57,7 @@ export function createComponentTree(props: {\n     {\n       spanName: 'build component tree',\n     },\n-    () => createComponentTreeInternal(props)\n+    () => createComponentTreeInternal(props, true)\n   )\n }\n \n@@ -71,35 +73,38 @@ function errorMissingDefaultExport(\n \n const cacheNodeKey = 'c'\n \n-async function createComponentTreeInternal({\n-  loaderTree: tree,\n-  parentParams,\n-  rootLayoutIncluded,\n-  injectedCSS,\n-  injectedJS,\n-  injectedFontPreloadTags,\n-  getViewportReady,\n-  getMetadataReady,\n-  ctx,\n-  missingSlots,\n-  preloadCallbacks,\n-  authInterrupts,\n-  StreamingMetadataOutlet,\n-}: {\n-  loaderTree: LoaderTree\n-  parentParams: Params\n-  rootLayoutIncluded: boolean\n-  injectedCSS: Set<string>\n-  injectedJS: Set<string>\n-  injectedFontPreloadTags: Set<string>\n-  getViewportReady: () => Promise<void>\n-  getMetadataReady: () => Promise<void>\n-  ctx: AppRenderContext\n-  missingSlots?: Set<string>\n-  preloadCallbacks: PreloadCallbacks\n-  authInterrupts: boolean\n-  StreamingMetadataOutlet: React.ComponentType | null\n-}): Promise<CacheNodeSeedData> {\n+async function createComponentTreeInternal(\n+  {\n+    loaderTree: tree,\n+    parentParams,\n+    rootLayoutIncluded,\n+    injectedCSS,\n+    injectedJS,\n+    injectedFontPreloadTags,\n+    getViewportReady,\n+    getMetadataReady,\n+    ctx,\n+    missingSlots,\n+    preloadCallbacks,\n+    authInterrupts,\n+    StreamingMetadataOutlet,\n+  }: {\n+    loaderTree: LoaderTree\n+    parentParams: Params\n+    rootLayoutIncluded: boolean\n+    injectedCSS: Set<string>\n+    injectedJS: Set<string>\n+    injectedFontPreloadTags: Set<string>\n+    getViewportReady: () => Promise<void>\n+    getMetadataReady: () => Promise<void>\n+    ctx: AppRenderContext\n+    missingSlots?: Set<string>\n+    preloadCallbacks: PreloadCallbacks\n+    authInterrupts: boolean\n+    StreamingMetadataOutlet: React.ComponentType | null\n+  },\n+  isRoot: boolean\n+): Promise<CacheNodeSeedData> {\n   const {\n     renderOpts: { nextConfigOutput, experimental },\n     workStore,\n@@ -524,31 +529,34 @@ async function createComponentTreeInternal({\n             }\n           }\n \n-          const seedData = await createComponentTreeInternal({\n-            loaderTree: parallelRoute,\n-            parentParams: currentParams,\n-            rootLayoutIncluded: rootLayoutIncludedAtThisLevelOrAbove,\n-            injectedCSS: injectedCSSWithCurrentLayout,\n-            injectedJS: injectedJSWithCurrentLayout,\n-            injectedFontPreloadTags: injectedFontPreloadTagsWithCurrentLayout,\n-            // `getMetadataReady` and `getViewportReady` are used to conditionally throw. In the case of parallel routes we will have more than one page\n-            // but we only want to throw on the first one.\n-            getMetadataReady: isChildrenRouteKey\n-              ? getMetadataReady\n-              : () => Promise.resolve(),\n-            getViewportReady: isChildrenRouteKey\n-              ? getViewportReady\n-              : () => Promise.resolve(),\n-            ctx,\n-            missingSlots,\n-            preloadCallbacks,\n-            authInterrupts,\n-            // `StreamingMetadataOutlet` is used to conditionally throw. In the case of parallel routes we will have more than one page\n-            // but we only want to throw on the first one.\n-            StreamingMetadataOutlet: isChildrenRouteKey\n-              ? StreamingMetadataOutlet\n-              : null,\n-          })\n+          const seedData = await createComponentTreeInternal(\n+            {\n+              loaderTree: parallelRoute,\n+              parentParams: currentParams,\n+              rootLayoutIncluded: rootLayoutIncludedAtThisLevelOrAbove,\n+              injectedCSS: injectedCSSWithCurrentLayout,\n+              injectedJS: injectedJSWithCurrentLayout,\n+              injectedFontPreloadTags: injectedFontPreloadTagsWithCurrentLayout,\n+              // `getMetadataReady` and `getViewportReady` are used to conditionally throw. In the case of parallel routes we will have more than one page\n+              // but we only want to throw on the first one.\n+              getMetadataReady: isChildrenRouteKey\n+                ? getMetadataReady\n+                : () => Promise.resolve(),\n+              getViewportReady: isChildrenRouteKey\n+                ? getViewportReady\n+                : () => Promise.resolve(),\n+              ctx,\n+              missingSlots,\n+              preloadCallbacks,\n+              authInterrupts,\n+              // `StreamingMetadataOutlet` is used to conditionally throw. In the case of parallel routes we will have more than one page\n+              // but we only want to throw on the first one.\n+              StreamingMetadataOutlet: isChildrenRouteKey\n+                ? StreamingMetadataOutlet\n+                : null,\n+            },\n+            false\n+          )\n \n           childCacheNodeSeedData = seedData\n         }\n@@ -562,6 +570,9 @@ async function createComponentTreeInternal({\n         const templateFilePath = getConventionPathByType(tree, dir, 'template')\n         const errorFilePath = getConventionPathByType(tree, dir, 'error')\n         const loadingFilePath = getConventionPathByType(tree, dir, 'loading')\n+        const globalErrorFilePath = isRoot\n+          ? getConventionPathByType(tree, dir, 'global-error')\n+          : undefined\n \n         const wrappedErrorStyles =\n           isSegmentViewEnabled && errorFilePath ? (\n@@ -596,6 +607,17 @@ async function createComponentTreeInternal({\n                 pagePath={errorFilePath + fileNameSuffix}\n               />\n             )}\n+            {/* Only show global-error when it's the builtin one */}\n+            {globalErrorFilePath && (\n+              <SegmentViewNode\n+                type={`${BOUNDARY_PREFIX}global-error`}\n+                pagePath={\n+                  isNextjsBuiltinFilePath(globalErrorFilePath)\n+                    ? `${BUILTIN_PREFIX}global-error.js${fileNameSuffix}`\n+                    : globalErrorFilePath\n+                }\n+              />\n+            )}\n             {/* do not surface forbidden and unauthorized boundaries yet as they're unstable */}\n           </>\n         ) : null"
        },
        {
            "sha": "b5f7482eb6e57654b6a1d4cf0feb78642e643a26",
            "filename": "packages/next/src/server/app-render/segment-explorer-path.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -2,13 +2,14 @@ import type { LoaderTree } from '../lib/app-dir-module'\n \n export const BUILTIN_PREFIX = '__next_builtin__'\n \n+const nextInternalPrefixRegex =\n+  /^(.*[\\\\/])?next[\\\\/]dist[\\\\/]client[\\\\/]components[\\\\/]builtin[\\\\/]/\n+\n export function normalizeConventionFilePath(\n   projectDir: string,\n   conventionPath: string | undefined\n ) {\n   const cwd = process.env.NEXT_RUNTIME === 'edge' ? '' : process.cwd()\n-  const nextInternalPrefixRegex =\n-    /^(.*[\\\\/])?next[\\\\/]dist[\\\\/]client[\\\\/]components[\\\\/]builtin[\\\\/]/\n \n   let relativePath = (conventionPath || '')\n     // remove turbopack [project] prefix\n@@ -30,6 +31,13 @@ export function normalizeConventionFilePath(\n   return relativePath\n }\n \n+// if a filepath is a builtin file. e.g.\n+// .../project/node_modules/next/dist/client/components/builtin/global-error.js -> true\n+// .../project/app/global-error.js -> false\n+export const isNextjsBuiltinFilePath = (filePath: string) => {\n+  return nextInternalPrefixRegex.test(filePath)\n+}\n+\n export const BOUNDARY_SUFFIX = '@boundary'\n export function normalizeBoundaryFilename(filename: string) {\n   return filename\n@@ -42,6 +50,13 @@ export function isBoundaryFile(fileType: string) {\n   return fileType.startsWith(BOUNDARY_PREFIX)\n }\n \n+// if a filename is a builtin file.\n+// __next_builtin__global-error.js -> true\n+// page.js -> false\n+export function isBuiltinBoundaryFile(fileType: string) {\n+  return fileType.startsWith(BUILTIN_PREFIX)\n+}\n+\n export function getBoundaryOriginFileType(fileType: string) {\n   return fileType.replace(BOUNDARY_PREFIX, '')\n }\n@@ -59,6 +74,7 @@ export function getConventionPathByType(\n     | 'forbidden'\n     | 'unauthorized'\n     | 'defaultPage'\n+    | 'global-error'\n ) {\n   const modules = tree[2]\n   const conventionPath = modules[conventionType]"
        },
        {
            "sha": "7b05ff5b8b8f8ea2c2e47d9262a82c555f2af927",
            "filename": "test/development/app-dir/segment-explorer/app/dynamic/blog/[slug]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2F%5Bslug%5D%2Fpage.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Blog Slug</div>\n+}"
        },
        {
            "sha": "4b990b06d68be64d10471ad58d56d9b6db3970a4",
            "filename": "test/development/app-dir/segment-explorer/app/dynamic/blog/error.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2Ferror.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2Ferror.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Fblog%2Ferror.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function Error() {\n+  return <div>Error</div>\n+}"
        },
        {
            "sha": "4b990b06d68be64d10471ad58d56d9b6db3970a4",
            "filename": "test/development/app-dir/segment-explorer/app/dynamic/full/error.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Ferror.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Ferror.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Ferror.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function Error() {\n+  return <div>Error</div>\n+}"
        },
        {
            "sha": "791ae962ec986ed728cc063b1913de620aa29a34",
            "filename": "test/development/app-dir/segment-explorer/app/dynamic/full/not-found.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fnot-found.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fnot-found.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fnot-found.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function NotFound() {\n+  return <div>Not Found</div>\n+}"
        },
        {
            "sha": "dc6fa499ab66209fae26d5abe9e4efc258847bc0",
            "filename": "test/development/app-dir/segment-explorer/app/dynamic/full/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e7df6a52c555c7cf17b1399737f970f556dee57/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fdynamic%2Ffull%2Fpage.tsx?ref=9e7df6a52c555c7cf17b1399737f970f556dee57",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Full</div>\n+}"
        }
    ],
    "stats": {
        "total": 445,
        "additions": 294,
        "deletions": 151
    }
}