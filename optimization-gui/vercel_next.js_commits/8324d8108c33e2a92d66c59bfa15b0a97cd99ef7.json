{
    "author": "huozhi",
    "message": "[segment explorer] handle custom error boundary (#80714)\n\nDisplay custom error boundary `error.js` in segement explorer when it's rendered\r\n\r\n![image](https://github.com/user-attachments/assets/4abad442-0703-4609-8202-b4f41f007afe)\r\n\r\nCloses NEXT-4331",
    "sha": "8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
    "files": [
        {
            "sha": "bdfdb0d7db66ba0ef11bb87e1ce0de496daed0fe",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -260,4 +260,9 @@ export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n     background-color: var(--color-green-300);\n     color: var(--color-green-900);\n   }\n+  .segment-explorer-file-label--error,\n+  .segment-explorer-file-label--global-error {\n+    background-color: var(--color-red-300);\n+    color: var(--color-red-900);\n+  }\n `"
        },
        {
            "sha": "8c00cbcf99455d5e316242b98a3a5eb1bc617b73",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -544,18 +544,26 @@ async function createComponentTreeInternal({\n           </Template>\n         )\n \n-        const templateFilePath = getConventionPathByType(\n-          parallelRoute,\n-          dir,\n-          'template'\n-        )\n+        const templateFilePath = getConventionPathByType(tree, dir, 'template')\n+\n+        const errorFilePath = getConventionPathByType(tree, dir, 'error')\n+\n+        const wrappedErrorStyles =\n+          isSegmentViewEnabled && errorFilePath ? (\n+            <SegmentViewNode type=\"error\" pagePath={errorFilePath}>\n+              {errorStyles}\n+            </SegmentViewNode>\n+          ) : (\n+            errorStyles\n+          )\n+\n         return [\n           parallelRouteKey,\n           <LayoutRouter\n             parallelRouterKey={parallelRouteKey}\n             // TODO-APP: Add test for loading returning `undefined`. This currently can't be tested as the `webdriver()` tab will wait for the full page to load before returning.\n             error={ErrorComponent}\n-            errorStyles={errorStyles}\n+            errorStyles={wrappedErrorStyles}\n             errorScripts={errorScripts}\n             template={\n               // Only render SegmentViewNode when there's an actual template"
        },
        {
            "sha": "4e2022b1f3f913619f2ac544e2d1d4a36900bdcd",
            "filename": "test/development/app-dir/segment-explorer/app/runtime-error/boundary/error.css",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.css",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.css?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -0,0 +1,5 @@\n+.error-title {\n+  color: red;\n+  font-size: 24px;\n+  font-weight: bold;\n+}"
        },
        {
            "sha": "bfd34c3e71c2c5ee079843be9709183955cdea8a",
            "filename": "test/development/app-dir/segment-explorer/app/runtime-error/boundary/error.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Ferror.tsx?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -0,0 +1,7 @@\n+'use client'\n+\n+import './error.css'\n+\n+export default function CustomError() {\n+  return <h2 className=\"error-title\">Custom Error</h2>\n+}"
        },
        {
            "sha": "22b2c3e4065c2a9d4bdf4f2f0bd0b6c6547470a6",
            "filename": "test/development/app-dir/segment-explorer/app/runtime-error/boundary/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fruntime-error%2Fboundary%2Fpage.tsx?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -0,0 +1,8 @@\n+'use client'\n+\n+export default function Page() {\n+  if (typeof window !== 'undefined') {\n+    throw new Error('Error on client')\n+  }\n+  return <p>page</p>\n+}"
        },
        {
            "sha": "cd5907bd9f4de63daa921e2c20991f521d7da644",
            "filename": "test/development/app-dir/segment-explorer/segment-explorer.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8324d8108c33e2a92d66c59bfa15b0a97cd99ef7/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts?ref=8324d8108c33e2a92d66c59bfa15b0a97cd99ef7",
            "patch": "@@ -179,4 +179,14 @@ describe('segment-explorer', () => {\n      loading.tsx\"\n     `)\n   })\n+\n+  it('should show the custom error boundary when present', async () => {\n+    const browser = await next.browser('/runtime-error/boundary')\n+    expect(await getSegmentExplorerContent(browser)).toMatchInlineSnapshot(`\n+     \"app/\n+     layout.tsx\n+     runtime-error / boundary/\n+     error.tsx\"\n+    `)\n+  })\n })"
        }
    ],
    "stats": {
        "total": 55,
        "additions": 49,
        "deletions": 6
    }
}