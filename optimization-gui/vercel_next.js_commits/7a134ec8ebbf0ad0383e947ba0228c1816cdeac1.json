{
    "author": "eps1lon",
    "message": "[test] Stop asserting on internal stackframes when features are working as intended (#78015)",
    "sha": "7a134ec8ebbf0ad0383e947ba0228c1816cdeac1",
    "files": [
        {
            "sha": "d7c6ca75af94e986d27999f5935f7972acc76d39",
            "filename": "test/development/app-dir/error-overlay/error-ignored-frames/error-ignored-frames.test.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 131,
            "changes": 155,
            "blob_url": "https://github.com/vercel/next.js/blob/7a134ec8ebbf0ad0383e947ba0228c1816cdeac1/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7a134ec8ebbf0ad0383e947ba0228c1816cdeac1/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts?ref=7a134ec8ebbf0ad0383e947ba0228c1816cdeac1",
            "patch": "@@ -10,14 +10,6 @@ describe('error-ignored-frames', () => {\n     files: __dirname,\n   })\n \n-  if (\n-    // Skip react 18 test as the call stacks are different\n-    process.env.NEXT_TEST_REACT_VERSION === '18.3.1'\n-  ) {\n-    it('skip test', () => {})\n-    return\n-  }\n-\n   it('should be able to collapse ignored frames in server component', async () => {\n     const browser = await next.browser('/')\n     await assertHasRedbox(browser)\n@@ -27,28 +19,12 @@ describe('error-ignored-frames', () => {\n \n     await toggleCollapseCallStackFrames(browser)\n \n-    const expendedStack = await getStackFramesContent(browser)\n-    if (isTurbopack) {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (app/page.tsx (2:9))\n-       at resolveErrorDev ()\n-       at processFullStringRow ()\n-       at processFullBinaryRow ()\n-       at progress ()\n-       at InnerLayoutRouter ()\n-       at OuterLayoutRouter ()\"\n-      `)\n-    } else {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (app/page.tsx (2:9))\n-       at resolveErrorDev ()\n-       at processFullStringRow ()\n-       at processFullBinaryRow ()\n-       at progress ()\n-       at InnerLayoutRouter (../src/client/components/layout-router.tsx (415:5))\n-       at OuterLayoutRouter (../src/client/components/layout-router.tsx (615:19))\"\n-      `)\n-    }\n+    const expandedStack = await getStackFramesContent(browser)\n+    const ignoreListedStack = expandedStack.replace(defaultStack, '')\n+    // We don't care about the exact stack trace that was ignore-listed.\n+    // It'll contain implementation details that may change and\n+    // shouldn't break this test.\n+    expect(ignoreListedStack.trim()).toMatch(/at .*/)\n   })\n \n   it('should be able to collapse ignored frames in client component', async () => {\n@@ -62,18 +38,12 @@ describe('error-ignored-frames', () => {\n \n     await toggleCollapseCallStackFrames(browser)\n \n-    const expendedStack = await getStackFramesContent(browser)\n-    if (isTurbopack) {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (app/client/page.tsx (4:9))\n-       at ClientPageRoot ()\"\n-      `)\n-    } else {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (app/client/page.tsx (4:9))\n-       at ClientPageRoot (../src/client/components/client-page.tsx (60:12))\"\n-      `)\n-    }\n+    const expandedStack = await getStackFramesContent(browser)\n+    const ignoreListedStack = expandedStack.replace(defaultStack, '')\n+    // We don't care about the exact stack trace that was ignore-listed.\n+    // It'll contain implementation details that may change and\n+    // shouldn't break this test.\n+    expect(ignoreListedStack.trim()).toMatch(/at .*/)\n   })\n \n   it('should be able to collapse ignored frames in interleaved call stack', async () => {\n@@ -95,22 +65,12 @@ describe('error-ignored-frames', () => {\n \n     await toggleCollapseCallStackFrames(browser)\n \n-    const expendedStack = await getStackFramesContent(browser)\n-    if (isTurbopack) {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at <unknown> (app/interleaved/page.tsx (7:11))\n-       at invokeCallback ()\n-       at Page (app/interleaved/page.tsx (6:35))\n-       at ClientPageRoot ()\"\n-      `)\n-    } else {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at eval (app/interleaved/page.tsx (7:11))\n-       at invokeCallback (node_modules/interleave/index.js (2:1))\n-       at Page (app/interleaved/page.tsx (6:36))\n-       at ClientPageRoot (../src/client/components/client-page.tsx (60:12))\"\n-      `)\n-    }\n+    const expandedStack = await getStackFramesContent(browser)\n+    const ignoreListedStack = expandedStack.replace(defaultStack, '')\n+    // We don't care about the exact stack trace that was ignore-listed.\n+    // It'll contain implementation details that may change and\n+    // shouldn't break this test.\n+    expect(ignoreListedStack.trim()).toMatch(/at .*/)\n   })\n \n   it('should be able to collapse pages router ignored frames', async () => {\n@@ -124,78 +84,11 @@ describe('error-ignored-frames', () => {\n \n     await toggleCollapseCallStackFrames(browser)\n \n-    const expendedStack = await getStackFramesContent(browser)\n-    if (isTurbopack) {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (pages/pages.tsx (2:9))\n-       at react-stack-bottom-frame ()\n-       at renderWithHooks ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at finishFunctionComponent ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderNode ()\n-       at renderChildrenArray ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderNode ()\n-       at renderChildrenArray ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at finishFunctionComponent ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\"\n-      `)\n-    } else {\n-      expect(expendedStack).toMatchInlineSnapshot(`\n-       \"at Page (pages/pages.tsx (2:9))\n-       at react-stack-bottom-frame ()\n-       at renderWithHooks ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at finishFunctionComponent ()\n-       at renderElement ()\n-       at retryNode ()\n-       at renderNodeDestructive ()\n-       at renderNode ()\n-       at renderChildrenArray ()\"\n-      `)\n-    }\n+    const expandedStack = await getStackFramesContent(browser)\n+    const ignoreListedStack = expandedStack.replace(defaultStack, '')\n+    // We don't care about the exact stack trace that was ignore-listed.\n+    // It'll contain implementation details that may change and\n+    // shouldn't break this test.\n+    expect(ignoreListedStack.trim()).toMatch(/at .*/)\n   })\n })"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 24,
        "deletions": 131
    }
}