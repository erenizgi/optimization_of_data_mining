{
    "author": "bgw",
    "message": "fix(dev-overlay): Better handle edge-case file paths in launchEditor (#79526)\n\nWithout this, some files may fail to open correctly.\n\nInternal discussion:\nhttps://vercel.slack.com/archives/C07UWUAF95Z/p1747261772629689",
    "sha": "278f0f099cb67918bb4855cdaf52c97ecfb6c6c6",
    "files": [
        {
            "sha": "f73202139fe9a8f0dbde6a3071e5a1765703c785",
            "filename": "packages/next/src/client/components/react-dev-overlay/utils/launch-editor.test.ts",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/278f0f099cb67918bb4855cdaf52c97ecfb6c6c6/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/278f0f099cb67918bb4855cdaf52c97ecfb6c6c6/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.test.ts?ref=278f0f099cb67918bb4855cdaf52c97ecfb6c6c6",
            "patch": "@@ -0,0 +1,8 @@\n+import { escapeApplescriptStringFragment } from './launch-editor'\n+\n+describe('applescript string escaping', () => {\n+  it('should escape strings correctly', () => {\n+    const result = escapeApplescriptStringFragment(`abc\\\\def\"ghi\\\\\\\\`)\n+    expect(result).toBe(`abc\\\\\\\\def\\\\\"ghi\\\\\\\\\\\\\\\\`)\n+  })\n+})"
        },
        {
            "sha": "31bacccaac0a4e46ce5909f515e4b4aad0b2eed5",
            "filename": "packages/next/src/client/components/react-dev-overlay/utils/launch-editor.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/278f0f099cb67918bb4855cdaf52c97ecfb6c6c6/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/278f0f099cb67918bb4855cdaf52c97ecfb6c6c6/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Flaunch-editor.ts?ref=278f0f099cb67918bb4855cdaf52c97ecfb6c6c6",
            "patch": "@@ -303,7 +303,22 @@ function printInstructions(fileName: string, errorMessage: string | null) {\n   console.log()\n }\n \n-function launchEditor(fileName: string, lineNumber: number, colNumber: number) {\n+export function escapeApplescriptStringFragment(input: string): string {\n+  // The only two special characters in a quoted applescript string are\n+  // backslash and double quote. Both are escaped with a preceeding backslash.\n+  //\n+  // Some whitespace characters (like newlines) can be escaped (as `\\n`), but\n+  // aren't required to be escaped (so we're not bothering to do that).\n+  //\n+  // https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/reference/ASLR_classes.html#//apple_ref/doc/uid/TP40000983-CH1g-BBCIAHJF:~:text=Special%20String%20Characters\n+  return input.replaceAll(/[\\\\\"]/g, (original) => `\\\\${original}`)\n+}\n+\n+export function launchEditor(\n+  fileName: string,\n+  lineNumber: number,\n+  colNumber: number\n+) {\n   if (!fs.existsSync(fileName)) {\n     return\n   }\n@@ -387,15 +402,12 @@ function launchEditor(fileName: string, lineNumber: number, colNumber: number) {\n     })\n   } else if (isTerminalEditor(editor)) {\n     if (process.platform === 'darwin') {\n+      const escapedScript = escapeApplescriptStringFragment(\n+        shellQuote.quote([editor, ...args])\n+      )\n       p = child_process.spawn(\n         'osascript',\n-        [\n-          '-e',\n-          `tell application \"Terminal\" to do script \"${shellQuote.quote([\n-            editor,\n-            ...args,\n-          ])}\"`,\n-        ],\n+        ['-e', `tell application \"Terminal\" to do script \"${escapedScript}\"`],\n         { stdio: 'ignore' }\n       )\n     } else {\n@@ -416,5 +428,3 @@ function launchEditor(fileName: string, lineNumber: number, colNumber: number) {\n     })\n   }\n }\n-\n-export { launchEditor }"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 28,
        "deletions": 10
    }
}