{
    "author": "eps1lon",
    "message": "Flag excess properties in Next.js config with TypeScript (#84069)",
    "sha": "1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
    "files": [
        {
            "sha": "f4a4f13f7790049aca7bd7144a81f21fd318a55c",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -2459,7 +2459,7 @@ export default async function getBaseWebpackConfig(\n     assetPrefix: config.assetPrefix || '',\n     sassOptions: config.sassOptions,\n     productionBrowserSourceMaps: config.productionBrowserSourceMaps,\n-    future: config.future,\n+    future: (config as any).future,\n     experimental: config.experimental,\n     disableStaticImages: config.images.disableStaticImages,\n     transpilePackages: config.transpilePackages,\n@@ -2636,8 +2636,8 @@ export default async function getBaseWebpackConfig(\n   }\n \n   // Backwards compat with webpack-dev-middleware options object\n-  if (typeof config.webpackDevMiddleware === 'function') {\n-    const options = config.webpackDevMiddleware({\n+  if (typeof (config as any).webpackDevMiddleware === 'function') {\n+    const options = (config as any).webpackDevMiddleware({\n       watchOptions: webpackConfig.watchOptions,\n     })\n     if (options.watchOptions) {"
        },
        {
            "sha": "496b1574a08c5e96848beab7e3532a4bc25923b2",
            "filename": "packages/next/src/build/webpack/config/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Findex.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -39,9 +39,10 @@ export async function buildConfiguration(\n     sassOptions: any\n     productionBrowserSourceMaps: boolean\n     transpilePackages: NextConfigComplete['transpilePackages']\n+    // @ts-expect-error TODO: remove any\n     future: NextConfigComplete['future']\n     experimental: NextConfigComplete['experimental']\n-    disableStaticImages: NextConfigComplete['disableStaticImages']\n+    disableStaticImages: NextConfigComplete['images']['disableStaticImages']\n     serverSourceMaps: NextConfigComplete['experimental']['serverSourceMaps']\n   }\n ): Promise<webpack.Configuration> {"
        },
        {
            "sha": "bb7668bfe70bb95de78ddac919445f7755eba480",
            "filename": "packages/next/src/build/webpack/config/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Futils.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -26,6 +26,7 @@ export type ConfigurationContext = {\n \n   transpilePackages: NextConfigComplete['transpilePackages']\n \n+  // @ts-expect-error TODO: remove any\n   future: NextConfigComplete['future']\n   experimental: NextConfigComplete['experimental']\n }"
        },
        {
            "sha": "0823be6f13028c9db424a2d5cfa092e29946e191",
            "filename": "packages/next/src/export/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -127,7 +127,7 @@ async function exportAppImpl(\n     )\n   }\n \n-  const customRoutes = ['rewrites', 'redirects', 'headers'].filter(\n+  const customRoutes = (['rewrites', 'redirects', 'headers'] as const).filter(\n     (config) => typeof nextConfig[config] === 'function'\n   )\n "
        },
        {
            "sha": "02f2867f10449f6c26a3507a11f744809ea059f0",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 4,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -16,11 +16,10 @@ import { INFINITE_CACHE } from '../lib/constants'\n import { isStableBuild } from '../shared/lib/canary-only'\n import type { FallbackRouteParam } from '../build/static-paths/types'\n \n-export type NextConfigComplete = Required<NextConfig> & {\n+export type NextConfigComplete = Required<Omit<NextConfig, 'configFile'>> & {\n   images: Required<ImageConfigComplete>\n   typescript: TypeScriptConfig\n-  configOrigin?: string\n-  configFile?: string\n+  configFile: string | undefined\n   configFileName: string\n   // override NextConfigComplete.experimental.htmlLimitedBots to string\n   // because it's not defined in NextConfigComplete.experimental\n@@ -876,7 +875,7 @@ export type ExportPathMap = {\n  *\n  * Read more: [Next.js Docs: `next.config.js`](https://nextjs.org/docs/app/api-reference/config/next-config-js)\n  */\n-export interface NextConfig extends Record<string, any> {\n+export interface NextConfig {\n   allowedDevOrigins?: string[]\n \n   exportPathMap?: (\n@@ -1291,6 +1290,26 @@ export interface NextConfig extends Record<string, any> {\n    * /Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview/i\n    */\n   htmlLimitedBots?: RegExp\n+\n+  /**\n+   * @internal\n+   */\n+  configFile?: string | undefined\n+\n+  /**\n+   * @internal\n+   */\n+  configOrigin?: string | undefined\n+\n+  /**\n+   * @internal\n+   */\n+  _originalRedirects?: any\n+\n+  /**\n+   * @internal\n+   */\n+  _originalRewrites?: any\n }\n \n export const defaultConfig = Object.freeze({"
        },
        {
            "sha": "2b0e270c46fba5f7e6b72841b31811373c08ed6d",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 14,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -76,8 +76,8 @@ export function warnOptionHasBeenDeprecated(\n     let found = true\n     const nestedPropertyKeys = nestedPropertyKey.split('.')\n     for (const key of nestedPropertyKeys) {\n-      if (current[key] !== undefined) {\n-        current = current[key]\n+      if ((current as any)[key] !== undefined) {\n+        current = (current as any)[key]\n       } else {\n         found = false\n         break\n@@ -167,10 +167,12 @@ export function warnOptionHasBeenMovedOutOfExperimental(\n     const newKeys = newKey.split('.')\n     while (newKeys.length > 1) {\n       const key = newKeys.shift()!\n-      current[key] = current[key] || {}\n-      current = current[key]\n+      ;(current as any)[key] = (current as any)[key] || {}\n+      current = (current as any)[key]\n     }\n-    current[newKeys.shift()!] = (config.experimental as any)[oldExperimentalKey]\n+    ;(current as any)[newKeys.shift()!] = (config.experimental as any)[\n+      oldExperimentalKey\n+    ]\n   }\n \n   return config\n@@ -192,7 +194,7 @@ function warnCustomizedOption(\n     if (!(seg in current)) {\n       return\n     }\n-    current = current[seg]\n+    current = (current as any)[seg]\n   }\n \n   if (!silent && current !== defaultValue) {\n@@ -218,16 +220,16 @@ function assignDefaultsAndValidate(\n   phase: PHASE_TYPE\n ): NextConfigComplete {\n   const configFileName = userConfig.configFileName\n-  if (typeof userConfig.exportTrailingSlash !== 'undefined') {\n+  if (typeof (userConfig as any).exportTrailingSlash !== 'undefined') {\n     if (!silent) {\n       Log.warn(\n         `The \"exportTrailingSlash\" option has been renamed to \"trailingSlash\". Please update your ${configFileName}.`\n       )\n     }\n     if (typeof userConfig.trailingSlash === 'undefined') {\n-      userConfig.trailingSlash = userConfig.exportTrailingSlash\n+      userConfig.trailingSlash = (userConfig as any).exportTrailingSlash\n     }\n-    delete userConfig.exportTrailingSlash\n+    delete (userConfig as any).exportTrailingSlash\n   }\n \n   // Handle migration of experimental.dynamicIO to experimental.cacheComponents\n@@ -245,7 +247,7 @@ function assignDefaultsAndValidate(\n \n   const config = Object.keys(userConfig).reduce<{ [key: string]: any }>(\n     (currentConfig, key) => {\n-      const value = userConfig[key]\n+      const value = (userConfig as any)[key]\n \n       if (value === undefined || value === null) {\n         return currentConfig\n@@ -1266,7 +1268,6 @@ function getCacheKey(\n \n   return djb2Hash(keyData).toString(36)\n }\n-\n export default async function loadConfig(\n   phase: PHASE_TYPE,\n   dir: string,\n@@ -1371,7 +1372,7 @@ export default async function loadConfig(\n         silent,\n         configuredExperimentalFeatures,\n         phase\n-      ) as NextConfigComplete,\n+      ),\n       phase,\n       silent\n     )\n@@ -1481,7 +1482,7 @@ export default async function loadConfig(\n       validateConfigSchema(userConfig, configFileName, curLog.warn)\n     }\n \n-    if (userConfig.target && userConfig.target !== 'server') {\n+    if ((userConfig as any).target && (userConfig as any).target !== 'server') {\n       throw new Error(\n         `The \"target\" property is no longer supported in ${configFileName}.\\n` +\n           'See more info here https://nextjs.org/docs/messages/deprecated-target-config'\n@@ -1538,7 +1539,7 @@ export default async function loadConfig(\n       silent,\n       configuredExperimentalFeatures,\n       phase\n-    ) as NextConfigComplete\n+    )\n \n     const finalConfig = await applyModifyConfig(completeConfig, phase, silent)\n "
        },
        {
            "sha": "eb578ac326d0b09a45420d04a24328ed41579a8e",
            "filename": "test/unit/isolated/config.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/test%2Funit%2Fisolated%2Fconfig.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1fffbcac27bc81c2b35cc1ca915c48bd3219e067/test%2Funit%2Fisolated%2Fconfig.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Funit%2Fisolated%2Fconfig.test.ts?ref=1fffbcac27bc81c2b35cc1ca915c48bd3219e067",
            "patch": "@@ -23,17 +23,17 @@ describe('config', () => {\n   })\n   it('Should get the configuration', async () => {\n     const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfig)\n-    expect(config.customConfig).toBe(true)\n+    expect((config as any).customConfig).toBe(true)\n   })\n \n   it('Should pass the phase correctly', async () => {\n     const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n-    expect(config.phase).toBe(PHASE_DEVELOPMENT_SERVER)\n+    expect((config as any).phase).toBe(PHASE_DEVELOPMENT_SERVER)\n   })\n \n   it('Should pass the defaultConfig correctly', async () => {\n     const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, pathToConfigFn)\n-    expect(config.defaultConfig).toBeDefined()\n+    expect((config as any).defaultConfig).toBeDefined()\n   })\n \n   it('Should assign object defaults deeply to user config', async () => {\n@@ -48,7 +48,7 @@ describe('config', () => {\n         customConfigKey: 'customConfigValue',\n       },\n     })\n-    expect(config.customConfigKey).toBe('customConfigValue')\n+    expect((config as any).customConfigKey).toBe('customConfigValue')\n   })\n \n   it('Should assign object defaults deeply to customConfig', async () => {\n@@ -58,7 +58,7 @@ describe('config', () => {\n         onDemandEntries: { custom: true },\n       },\n     })\n-    expect(config.customConfig).toBe(true)\n+    expect((config as any).customConfig).toBe(true)\n     expect(config.onDemandEntries.maxInactiveAge).toBeDefined()\n   })\n \n@@ -68,8 +68,8 @@ describe('config', () => {\n         bogusSetting: { custom: true },\n       },\n     })\n-    expect(config.bogusSetting).toBeDefined()\n-    expect(config.bogusSetting.custom).toBe(true)\n+    expect((config as any).bogusSetting).toBeDefined()\n+    expect((config as any).bogusSetting.custom).toBe(true)\n   })\n \n   it('Should override defaults for arrays from user arrays', async () => {\n@@ -107,15 +107,15 @@ describe('config', () => {\n       PHASE_DEVELOPMENT_SERVER,\n       join(__dirname, '_resolvedata', 'js-ts-config')\n     )\n-    expect(config.__test__ext).toBe('js')\n+    expect((config as any).__test__ext).toBe('js')\n   })\n \n   it('Should not throw an error when next.config.ts is present', async () => {\n     const config = await loadConfig(\n       PHASE_DEVELOPMENT_SERVER,\n       join(__dirname, '_resolvedata', 'typescript-config')\n     )\n-    expect(config.__test__ext).toBe('ts')\n+    expect((config as any).__test__ext).toBe('ts')\n   })\n \n   describe('outputFileTracingRoot and turbopack.root consistency', () => {"
        }
    ],
    "stats": {
        "total": 86,
        "additions": 54,
        "deletions": 32
    }
}