{
    "author": "devjiwonchoi",
    "message": "fix: Proxy not picked up on Windows (#85443)\n\nProxy is not being picked up during prod on Windows. It is because of\ntwo reasons:\n\n1. `isAtConventionLevel` condition was false as the dir was `\\\\` in\nWindows, but was checking with explicit `/`.\n2. `page` value passed to `getStaticInfoIncludingLayouts` function was\nin `\\\\proxy` but was expected to be `/proxy`, which is later used for\n`isProxy` condition.\n\nTherefore, the given paths needed to be normalized.\n\nCurrent behavior:\nhttps://github.com/vercel/next.js/actions/runs/18872127141/job/53853048061?pr=85443#step:34:160\n\nCloses NEXT-4756",
    "sha": "b95dbe6a3a79a459173557a3b670eb6cb2c6d060",
    "files": [
        {
            "sha": "4f89b6c05d92e44e8efc47527ce6db1e6d7edc20",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=b95dbe6a3a79a459173557a3b670eb6cb2c6d060",
            "patch": "@@ -764,6 +764,7 @@ jobs:\n         node run-tests.js \\\n           test/e2e/app-dir/app/index.test.ts \\\n           test/e2e/app-dir/app-edge/app-edge.test.ts \\\n+          test/e2e/app-dir/proxy-runtime-nodejs/proxy-runtime-nodejs.test.ts \\\n           test/development/app-dir/segment-explorer/segment-explorer.test.ts\n       stepName: 'test-dev-windows'\n       runs_on_labels: '[\"windows\",\"self-hosted\",\"x64\"]'\n@@ -821,7 +822,8 @@ jobs:\n           test/e2e/app-dir/app/index.test.ts \\\n           test/e2e/app-dir/app-edge/app-edge.test.ts \\\n           test/e2e/app-dir/metadata-edge/index.test.ts \\\n-          test/e2e/app-dir/non-root-project-monorepo/non-root-project-monorepo.test.ts\n+          test/e2e/app-dir/non-root-project-monorepo/non-root-project-monorepo.test.ts \\\n+          test/e2e/app-dir/proxy-runtime-nodejs/proxy-runtime-nodejs.test.ts\n       stepName: 'test-prod-windows'\n       runs_on_labels: '[\"windows\",\"self-hosted\",\"x64\"]'\n       buildNativeTarget: 'x86_64-pc-windows-msvc'"
        },
        {
            "sha": "37a4cddca30aa1e979900cf522369ac9c38b363f",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=b95dbe6a3a79a459173557a3b670eb6cb2c6d060",
            "patch": "@@ -1215,7 +1215,10 @@ export default async function build(\n \n       for (const rootPath of rootPaths) {\n         const { name: fileBaseName, dir: fileDir } = path.parse(rootPath)\n-        const isAtConventionLevel = fileDir === '/' || fileDir === '/src'\n+\n+        const normalizedFileDir = normalizePathSep(fileDir)\n+        const isAtConventionLevel =\n+          normalizedFileDir === '/' || normalizedFileDir === '/src'\n \n         if (isAtConventionLevel && fileBaseName === MIDDLEWARE_FILENAME) {\n           middlewareFilePath = rootPath\n@@ -2610,7 +2613,9 @@ export default async function build(\n           return serverFilesManifest\n         })\n \n-      const middlewareFile = proxyFilePath || middlewareFilePath\n+      const middlewareFile = normalizePathSep(\n+        proxyFilePath || middlewareFilePath || ''\n+      )\n       let hasNodeMiddleware = false\n \n       if (middlewareFile) {"
        },
        {
            "sha": "d56f10fba042dbf360f1bbd618e8bdc244bb289c",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b95dbe6a3a79a459173557a3b670eb6cb2c6d060/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=b95dbe6a3a79a459173557a3b670eb6cb2c6d060",
            "patch": "@@ -1574,10 +1574,6 @@ export default class NextNodeServer extends BaseServer<\n           functionsConfig?.functions?.['/_middleware']\n         ) {\n           // if used with top level await, this will be a promise\n-          // Try loading middleware.js first, then proxy.js. Instead\n-          // of mapping proxy to middleware as the entry, just fallback\n-          // to proxy.\n-          // TODO: Remove this once we handle as the single entrypoint.\n           return require(\n             join(\n               /* turbopackIgnore: true */ this.distDir,"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}