{
    "author": "wyattjoh",
    "message": "feat: add route context to prerender error messages (#82283)\n\n### What?\n\nThis PR improves error debugging during prerendering by adding route\ncontext to hanging promise rejection errors and related error messages.\n\n### Why?\n\nWhen developers encounter dynamic access issues during static\ngeneration, the current error messages don't provide enough context\nabout which specific route is causing the problem. This makes debugging\ndifficult, especially in large applications with many routes.\n\nBy including route information in error messages, developers can quickly\nidentify the problematic route and resolve the issue more efficiently.\n\n### How?\n\n- Updates `makeHangingPromise` function signature to accept a `route`\nparameter\n- Modifies `HangingPromiseRejectionError` to include route information\nin error messages\n- Adds route context to all hanging promise calls across the codebase:\n  - Dynamic rendering utilities\n  - Fetch patching\n  - Request APIs (cookies, headers, params, etc.)\n  - Use cache wrapper\n- Adds new error code 773 for missing workStore scenarios\n- Ensures workStore validation where needed to prevent missing route\ncontext\n\nThe changes are backward compatible and only enhance existing error\nmessages with additional debugging information.\n\n### Fixing a bug\n\n- Tests will be added in follow-up PR\n- Error messages now include helpful route context for debugging\n\nNAR-225",
    "sha": "804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
    "files": [
        {
            "sha": "9e155b1db1bfc3cb8b56b8a21245b144018c4176",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -770,5 +770,6 @@\n   \"769\": \"createSearchParamsFromClient should not be called in a runtime prerender.\",\n   \"770\": \"createParamsFromClient should not be called in a runtime prerender.\",\n   \"771\": \"\\\\`%s\\\\` was called during a runtime prerender. Next.js should be preventing %s from being included in server components statically, but did not in this case.\",\n-  \"772\": \"FetchStrategy.PPRRuntime should never be used when `experimental.clientSegmentCache` is disabled\"\n+  \"772\": \"FetchStrategy.PPRRuntime should never be used when `experimental.clientSegmentCache` is disabled\",\n+  \"773\": \"Missing workStore in createPrerenderParamsForClientSegment\"\n }"
        },
        {
            "sha": "f7d601592c3dd5f020f9129c9f1f3145f9d071a0",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -585,8 +585,9 @@ export function annotateDynamicAccess(\n }\n \n export function useDynamicRouteParams(expression: string) {\n+  const workStore = workAsyncStorage.getStore()\n   const workUnitStore = workUnitAsyncStorage.getStore()\n-  if (workUnitStore) {\n+  if (workStore && workUnitStore) {\n     switch (workUnitStore.type) {\n       case 'prerender-client':\n       case 'prerender': {\n@@ -595,19 +596,19 @@ export function useDynamicRouteParams(expression: string) {\n           // We are in a prerender with cacheComponents semantics. We are going to\n           // hang here and never resolve. This will cause the currently\n           // rendering component to effectively be a dynamic hole.\n-          React.use(makeHangingPromise(workUnitStore.renderSignal, expression))\n+          React.use(\n+            makeHangingPromise(\n+              workUnitStore.renderSignal,\n+              workStore.route,\n+              expression\n+            )\n+          )\n         }\n         break\n       }\n       case 'prerender-ppr': {\n         const fallbackParams = workUnitStore.fallbackRouteParams\n         if (fallbackParams && fallbackParams.size > 0) {\n-          const workStore = workAsyncStorage.getStore()\n-          if (!workStore) {\n-            throw new InvariantError(\n-              'Missing workStore in useDynamicRouteParams'\n-            )\n-          }\n           return postponeWithTracking(\n             workStore.route,\n             expression,"
        },
        {
            "sha": "26083d2e39cb785b141cbd1cbae9902a088394bd",
            "filename": "packages/next/src/server/dynamic-rendering-utils.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fdynamic-rendering-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fdynamic-rendering-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdynamic-rendering-utils.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -13,9 +13,12 @@ const HANGING_PROMISE_REJECTION = 'HANGING_PROMISE_REJECTION'\n class HangingPromiseRejectionError extends Error {\n   public readonly digest = HANGING_PROMISE_REJECTION\n \n-  constructor(public readonly expression: string) {\n+  constructor(\n+    public readonly route: string,\n+    public readonly expression: string\n+  ) {\n     super(\n-      `During prerendering, ${expression} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${expression} to a different context by using \\`setTimeout\\`, \\`after\\`, or similar functions you may observe this error and you should handle it in that context.`\n+      `During prerendering, ${expression} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${expression} to a different context by using \\`setTimeout\\`, \\`after\\`, or similar functions you may observe this error and you should handle it in that context. This occurred at route \"${route}\".`\n     )\n   }\n }\n@@ -32,15 +35,16 @@ const abortListenersBySignal = new WeakMap<AbortSignal, AbortListeners>()\n  */\n export function makeHangingPromise<T>(\n   signal: AbortSignal,\n+  route: string,\n   expression: string\n ): Promise<T> {\n   if (signal.aborted) {\n-    return Promise.reject(new HangingPromiseRejectionError(expression))\n+    return Promise.reject(new HangingPromiseRejectionError(route, expression))\n   } else {\n     const hangingPromise = new Promise<T>((_, reject) => {\n       const boundRejection = reject.bind(\n         null,\n-        new HangingPromiseRejectionError(expression)\n+        new HangingPromiseRejectionError(route, expression)\n       )\n       let currentListeners = abortListenersBySignal.get(signal)\n       if (currentListeners) {"
        },
        {
            "sha": "1320ca31955c0b084051163de14ce297714aef8b",
            "filename": "packages/next/src/server/lib/patch-fetch.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -566,6 +566,7 @@ export function createPatchedFetcher(\n \n               return makeHangingPromise<Response>(\n                 workUnitStore.renderSignal,\n+                workStore.route,\n                 'fetch()'\n               )\n             case 'prerender-ppr':\n@@ -678,6 +679,7 @@ export function createPatchedFetcher(\n                   }\n                   return makeHangingPromise<Response>(\n                     workUnitStore.renderSignal,\n+                    workStore.route,\n                     'fetch()'\n                   )\n                 case 'prerender-ppr':\n@@ -1027,6 +1029,7 @@ export function createPatchedFetcher(\n                   }\n                   return makeHangingPromise<Response>(\n                     workUnitStore.renderSignal,\n+                    workStore.route,\n                     'fetch()'\n                   )\n                 case 'prerender-ppr':\n@@ -1063,6 +1066,7 @@ export function createPatchedFetcher(\n                   case 'prerender-runtime':\n                     return makeHangingPromise<Response>(\n                       workUnitStore.renderSignal,\n+                      workStore.route,\n                       'fetch()'\n                     )\n                   case 'request':"
        },
        {
            "sha": "e20c7d84feaedaeb212aebdd9bf20aec592e6684",
            "filename": "packages/next/src/server/request/connection.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fconnection.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -73,6 +73,7 @@ export function connection(): Promise<void> {\n           // stall at this point.\n           return makeHangingPromise(\n             workUnitStore.renderSignal,\n+            workStore.route,\n             '`connection()`'\n           )\n         case 'prerender-ppr':"
        },
        {
            "sha": "992a9c99d5864ad8c5b5a2236b184e50ecf4b79b",
            "filename": "packages/next/src/server/request/cookies.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fcookies.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -5,7 +5,10 @@ import {\n   RequestCookiesAdapter,\n } from '../web/spec-extension/adapters/request-cookies'\n import { RequestCookies } from '../web/spec-extension/cookies'\n-import { workAsyncStorage } from '../app-render/work-async-storage.external'\n+import {\n+  workAsyncStorage,\n+  type WorkStore,\n+} from '../app-render/work-async-storage.external'\n import {\n   throwForMissingRequestStore,\n   workUnitAsyncStorage,\n@@ -92,7 +95,7 @@ export function cookies(): Promise<ReadonlyRequestCookies> {\n             `Route ${workStore.route} used \"cookies\" inside a function cached with \"unstable_cache(...)\". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \"cookies\" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`\n           )\n         case 'prerender':\n-          return makeHangingCookies(workUnitStore)\n+          return makeHangingCookies(workStore, workUnitStore)\n         case 'prerender-client':\n           const exportName = '`cookies`'\n           throw new InvariantError(\n@@ -170,6 +173,7 @@ const CachedCookies = new WeakMap<\n >()\n \n function makeHangingCookies(\n+  workStore: WorkStore,\n   prerenderStore: PrerenderStoreModern\n ): Promise<ReadonlyRequestCookies> {\n   const cachedPromise = CachedCookies.get(prerenderStore)\n@@ -179,6 +183,7 @@ function makeHangingCookies(\n \n   const promise = makeHangingPromise<ReadonlyRequestCookies>(\n     prerenderStore.renderSignal,\n+    workStore.route,\n     '`cookies()`'\n   )\n   CachedCookies.set(prerenderStore, promise)"
        },
        {
            "sha": "5561a18e56dd72a2009f6315cbce5d89e3393fd1",
            "filename": "packages/next/src/server/request/headers.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fheaders.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -2,7 +2,10 @@ import {\n   HeadersAdapter,\n   type ReadonlyHeaders,\n } from '../web/spec-extension/adapters/headers'\n-import { workAsyncStorage } from '../app-render/work-async-storage.external'\n+import {\n+  workAsyncStorage,\n+  type WorkStore,\n+} from '../app-render/work-async-storage.external'\n import { throwForMissingRequestStore } from '../app-render/work-unit-async-storage.external'\n import {\n   workUnitAsyncStorage,\n@@ -121,7 +124,7 @@ export function headers(): Promise<ReadonlyHeaders> {\n       switch (workUnitStore.type) {\n         case 'prerender':\n         case 'prerender-runtime':\n-          return makeHangingHeaders(workUnitStore)\n+          return makeHangingHeaders(workStore, workUnitStore)\n         case 'prerender-client':\n           const exportName = '`headers`'\n           throw new InvariantError(\n@@ -183,6 +186,7 @@ interface CacheLifetime {}\n const CachedHeaders = new WeakMap<CacheLifetime, Promise<ReadonlyHeaders>>()\n \n function makeHangingHeaders(\n+  workStore: WorkStore,\n   prerenderStore: PrerenderStoreModern\n ): Promise<ReadonlyHeaders> {\n   const cachedHeaders = CachedHeaders.get(prerenderStore)\n@@ -192,6 +196,7 @@ function makeHangingHeaders(\n \n   const promise = makeHangingPromise<ReadonlyHeaders>(\n     prerenderStore.renderSignal,\n+    workStore.route,\n     '`headers()`'\n   )\n   CachedHeaders.set(prerenderStore, promise)"
        },
        {
            "sha": "197f8b7120540ceeb8b66ca5853ae54d0bf53bc8",
            "filename": "packages/next/src/server/request/params.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 4,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fparams.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -1,4 +1,7 @@\n-import type { WorkStore } from '../app-render/work-async-storage.external'\n+import {\n+  workAsyncStorage,\n+  type WorkStore,\n+} from '../app-render/work-async-storage.external'\n import type { FallbackRouteParams } from './fallback-params'\n \n import { ReflectAdapter } from '../web/spec-extension/adapters/reflect'\n@@ -151,6 +154,13 @@ export function createServerParamsForServerSegment(\n export function createPrerenderParamsForClientSegment(\n   underlyingParams: Params\n ): Promise<Params> {\n+  const workStore = workAsyncStorage.getStore()\n+  if (!workStore) {\n+    throw new InvariantError(\n+      'Missing workStore in createPrerenderParamsForClientSegment'\n+    )\n+  }\n+\n   const workUnitStore = workUnitAsyncStorage.getStore()\n   if (workUnitStore) {\n     switch (workUnitStore.type) {\n@@ -164,7 +174,11 @@ export function createPrerenderParamsForClientSegment(\n               // to consider the awaiting of this params object \"dynamic\". Since\n               // we are in cacheComponents mode we encode this as a promise that never\n               // resolves.\n-              return makeHangingPromise(workUnitStore.renderSignal, '`params`')\n+              return makeHangingPromise(\n+                workUnitStore.renderSignal,\n+                workStore.route,\n+                '`params`'\n+              )\n             }\n           }\n         }\n@@ -206,7 +220,11 @@ function createPrerenderParams(\n             // to consider the awaiting of this params object \"dynamic\". Since\n             // we are in cacheComponents mode we encode this as a promise that never\n             // resolves.\n-            return makeHangingParams(underlyingParams, prerenderStore)\n+            return makeHangingParams(\n+              underlyingParams,\n+              workStore,\n+              prerenderStore\n+            )\n           }\n         }\n       }\n@@ -298,6 +316,7 @@ const fallbackParamsProxyHandler: ProxyHandler<Promise<Params>> = {\n \n function makeHangingParams(\n   underlyingParams: Params,\n+  workStore: WorkStore,\n   prerenderStore: StaticPrerenderStoreModern\n ): Promise<Params> {\n   const cachedParams = CachedParams.get(underlyingParams)\n@@ -306,7 +325,11 @@ function makeHangingParams(\n   }\n \n   const promise = new Proxy(\n-    makeHangingPromise<Params>(prerenderStore.renderSignal, '`params`'),\n+    makeHangingPromise<Params>(\n+      prerenderStore.renderSignal,\n+      workStore.route,\n+      '`params`'\n+    ),\n     fallbackParamsProxyHandler\n   )\n "
        },
        {
            "sha": "f077ed93058eb761e87ffb05fd79fae25e849063",
            "filename": "packages/next/src/server/request/pathname.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fpathname.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -61,6 +61,7 @@ function createPrerenderPathname(\n       if (fallbackParams && fallbackParams.size > 0) {\n         return makeHangingPromise<string>(\n           prerenderStore.renderSignal,\n+          workStore.route,\n           '`pathname`'\n         )\n       }"
        },
        {
            "sha": "56f00fac2efadfad1cdca718576d98b481af7cd3",
            "filename": "packages/next/src/server/request/root-params.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -88,6 +88,7 @@ function createPrerenderRootParams(\n \n             const promise = makeHangingPromise<Params>(\n               prerenderStore.renderSignal,\n+              workStore.route,\n               '`unstable_rootParams`'\n             )\n             CachedParams.set(underlyingParams, promise)\n@@ -287,6 +288,7 @@ function createPrerenderRootParamPromise(\n       ) {\n         return makeHangingPromise<ParamValue>(\n           prerenderStore.renderSignal,\n+          workStore.route,\n           apiName\n         )\n       }"
        },
        {
            "sha": "adced9b911a6fdc0f247d364717f281356f5fd1a",
            "filename": "packages/next/src/server/request/search-params.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Fsearch-params.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -139,7 +139,11 @@ export function createPrerenderSearchParamsForClientPage(\n       case 'prerender-client':\n         // We're prerendering in a mode that aborts (cacheComponents) and should stall\n         // the promise to ensure the RSC side is considered dynamic\n-        return makeHangingPromise(workUnitStore.renderSignal, '`searchParams`')\n+        return makeHangingPromise(\n+          workUnitStore.renderSignal,\n+          workStore.route,\n+          '`searchParams`'\n+        )\n       case 'prerender-runtime':\n         throw new InvariantError(\n           'createPrerenderSearchParamsForClientPage should not be called in a runtime prerender.'\n@@ -178,7 +182,7 @@ function createPrerenderSearchParams(\n     case 'prerender':\n     case 'prerender-client':\n       // We are in a cacheComponents (PPR or otherwise) prerender\n-      return makeHangingSearchParams(prerenderStore)\n+      return makeHangingSearchParams(workStore, prerenderStore)\n     case 'prerender-ppr':\n     case 'prerender-legacy':\n       // We are in a legacy static generation and need to interrupt the\n@@ -232,6 +236,7 @@ const CachedSearchParamsForUseCache = new WeakMap<\n >()\n \n function makeHangingSearchParams(\n+  workStore: WorkStore,\n   prerenderStore: PrerenderStoreModern\n ): Promise<SearchParams> {\n   const cachedSearchParams = CachedSearchParams.get(prerenderStore)\n@@ -241,6 +246,7 @@ function makeHangingSearchParams(\n \n   const promise = makeHangingPromise<SearchParams>(\n     prerenderStore.renderSignal,\n+    workStore.route,\n     '`searchParams`'\n   )\n "
        },
        {
            "sha": "3c91499f0f71c5312670ab5ce88dbc40a3c073fb",
            "filename": "packages/next/src/server/use-cache/use-cache-wrapper.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/804cbc410639fd4ae2c5ef5cd93ceb710e49af63/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fuse-cache-wrapper.ts?ref=804cbc410639fd4ae2c5ef5cd93ceb710e49af63",
            "patch": "@@ -641,6 +641,7 @@ async function generateCacheEntryImpl(\n         // the \"use cache\" function dynamic.\n         const hangingPromise = makeHangingPromise<never>(\n           outerWorkUnitStore.renderSignal,\n+          workStore.route,\n           abortSignal.reason\n         )\n \n@@ -835,7 +836,11 @@ export function cache(\n         switch (workUnitStore?.type) {\n           // \"use cache: private\" is dynamic in prerendering contexts.\n           case 'prerender':\n-            return makeHangingPromise(workUnitStore.renderSignal, expression)\n+            return makeHangingPromise(\n+              workUnitStore.renderSignal,\n+              workStore.route,\n+              expression\n+            )\n           case 'prerender-ppr':\n             return postponeWithTracking(\n               workStore.route,\n@@ -1082,6 +1087,7 @@ export function cache(\n             if (dynamicAccessAbortController.signal.aborted) {\n               return makeHangingPromise(\n                 workUnitStore.renderSignal,\n+                workStore.route,\n                 dynamicAccessAbortController.signal.reason.message\n               )\n             }\n@@ -1147,6 +1153,7 @@ export function cache(\n                   }\n                   return makeHangingPromise(\n                     workUnitStore.renderSignal,\n+                    workStore.route,\n                     'dynamic \"use cache\"'\n                   )\n                 case 'prerender-runtime':\n@@ -1174,6 +1181,7 @@ export function cache(\n                   }\n                   return makeHangingPromise(\n                     workUnitStore.renderSignal,\n+                    workStore.route,\n                     'dynamic \"use cache\"'\n                   )\n                 case 'prerender':\n@@ -1226,6 +1234,7 @@ export function cache(\n                 if (workUnitStore.allowEmptyStaticShell) {\n                   return makeHangingPromise(\n                     workUnitStore.renderSignal,\n+                    workStore.route,\n                     'dynamic \"use cache\"'\n                   )\n                 }\n@@ -1325,6 +1334,7 @@ export function cache(\n               }\n               return makeHangingPromise(\n                 workUnitStore.renderSignal,\n+                workStore.route,\n                 'dynamic \"use cache\"'\n               )\n             case 'prerender-runtime':"
        }
    ],
    "stats": {
        "total": 111,
        "additions": 87,
        "deletions": 24
    }
}