{
    "author": "lukesandberg",
    "message": "[turbopack] Remove the final uses of `Value<..>` and delete the type (#80144)\n\nRemove the final uses of `Value<..>` and destroy it.\n\n### Why?\nThe `Value<>` type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "f607d0cf976d6cbe654dd3b7914113701d5a93f9",
    "files": [
        {
            "sha": "e52ab140f4338abbc458c3c47915850fec36314d",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -29,8 +29,8 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    Completion, FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, Value, ValueToString, Vc,\n-    fxindexmap, fxindexset, trace::TraceRawVcs,\n+    Completion, FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, ValueToString, Vc, fxindexmap,\n+    fxindexset, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{\n     self, File, FileContent, FileSystem, FileSystemPath, FileSystemPathOption, VirtualFileSystem,\n@@ -635,7 +635,7 @@ impl PagesProject {\n                     NextMode::Build => rcstr!(\"next/dist/client/next-turbopack.js\"),\n                 },\n             )),\n-            Value::new(EcmaScriptModulesReferenceSubType::Undefined),\n+            EcmaScriptModulesReferenceSubType::Undefined,\n             false,\n             None,\n         )"
        },
        {
            "sha": "dc2442aeb14826ba698dd6149da75c1481219ec5",
            "filename": "crates/next-core/src/app_segment_config.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -272,7 +272,7 @@ pub async fn parse_segment_config_from_source(\n \n     let result = &*parse(\n         *source,\n-        turbo_tasks::Value::new(if path.path.ends_with(\".ts\") {\n+        if path.path.ends_with(\".ts\") {\n             EcmascriptModuleAssetType::Typescript {\n                 tsx: false,\n                 analyze_types: false,\n@@ -284,7 +284,7 @@ pub async fn parse_segment_config_from_source(\n             }\n         } else {\n             EcmascriptModuleAssetType::Ecmascript\n-        }),\n+        },\n         EcmascriptInputTransforms::empty(),\n     )\n     .await?;"
        },
        {
            "sha": "abb82dcde57df3bf8efd5b40e162ae1b98c5950c",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/all_in_one.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fall_in_one.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fall_in_one.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fall_in_one.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -4,7 +4,7 @@\n \n use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TaskInput, ValueToString, Vc};\n use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n@@ -27,7 +27,7 @@ async fn all_in_one() {\n         }\n         .into();\n \n-        let result = my_function(a, b.get_last(), c, Value::new(MyEnumValue::Yeah(42)));\n+        let result = my_function(a, b.get_last(), c, MyEnumValue::Yeah(42));\n         assert_eq!(*result.my_trait_function().await?, \"42\");\n         assert_eq!(*result.my_trait_function2().await?, \"42\");\n         assert_eq!(*result.my_trait_function3().await?, \"4242\");\n@@ -63,12 +63,12 @@ async fn all_in_one() {\n     .unwrap()\n }\n \n-#[turbo_tasks::value(transparent, serialization = \"auto_for_input\")]\n+#[turbo_tasks::value(transparent)]\n #[derive(Debug, Clone, Hash)]\n struct MyTransparentValue(u32);\n \n-#[turbo_tasks::value(shared, serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[turbo_tasks::value(shared)]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n enum MyEnumValue {\n     Yeah(u32),\n     Nah,\n@@ -159,12 +159,12 @@ async fn my_function(\n     a: Vc<MyTransparentValue>,\n     b: Vc<MyEnumValue>,\n     c: Vc<MyStructValue>,\n-    d: Value<MyEnumValue>,\n+    d: MyEnumValue,\n ) -> Result<Vc<MyStructValue>> {\n     assert_eq!(*a.await?, 4242);\n     assert_eq!(*b.await?, MyEnumValue::Yeah(42));\n     assert_eq!(c.await?.value, 42);\n-    assert_eq!(d.into_value(), MyEnumValue::Yeah(42));\n+    assert_eq!(d, MyEnumValue::Yeah(42));\n     Ok(c)\n }\n "
        },
        {
            "sha": "3fa72d874cba96977e7108b09d370026b016d945",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -123,7 +123,7 @@ pub use state::{State, TransientState};\n pub use task::{SharedReference, TypedSharedReference, task_input::TaskInput};\n pub use trait_ref::{IntoTraitRef, TraitRef};\n pub use turbo_tasks_macros::{TaskInput, function, value_impl};\n-pub use value::{TransientInstance, TransientValue, Value};\n+pub use value::{TransientInstance, TransientValue};\n pub use value_type::{TraitMethod, TraitType, ValueType};\n pub use vc::{\n     Dynamic, NonLocalValue, OperationValue, OperationVc, OptionVcExt, ReadVcFuture, ResolvedVc,"
        },
        {
            "sha": "b993eef5d11b8d9b9b0665d39a79385cd933c9a2",
            "filename": "turbopack/crates/turbo-tasks/src/marker_trait.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmarker_trait.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmarker_trait.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmarker_trait.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -78,7 +78,6 @@ macro_rules! impl_auto_marker_trait {\n         {}\n         unsafe impl<T: $trait> $trait for $crate::State<T> {}\n         unsafe impl<T: $trait> $trait for $crate::TransientState<T> {}\n-        unsafe impl<T: $trait> $trait for $crate::Value<T> {}\n         unsafe impl<T: $trait> $trait for $crate::TransientValue<T> {}\n         unsafe impl<T: $trait> $trait for $crate::TransientInstance<T> {}\n "
        },
        {
            "sha": "11eae0c5f7064441ebaa686ca15d1956c40295fc",
            "filename": "turbopack/crates/turbo-tasks/src/task/task_input.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 26,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_input.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,6 +1,5 @@\n use std::{\n-    any::Any, collections::BTreeMap, fmt::Debug, future::Future, hash::Hash, sync::Arc,\n-    time::Duration,\n+    collections::BTreeMap, fmt::Debug, future::Future, hash::Hash, sync::Arc, time::Duration,\n };\n \n use anyhow::Result;\n@@ -9,7 +8,7 @@ use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n \n use crate::{\n-    MagicAny, ResolvedVc, TaskId, TransientInstance, TransientValue, Value, ValueTypeId, Vc,\n+    MagicAny, ResolvedVc, TaskId, TransientInstance, TransientValue, ValueTypeId, Vc,\n     trace::TraceRawVcs,\n };\n \n@@ -170,29 +169,6 @@ where\n     }\n }\n \n-impl<T> TaskInput for Value<T>\n-where\n-    T: Any\n-        + std::fmt::Debug\n-        + Clone\n-        + std::hash::Hash\n-        + Eq\n-        + Send\n-        + Sync\n-        + Serialize\n-        + for<'de> Deserialize<'de>\n-        + TraceRawVcs\n-        + 'static,\n-{\n-    fn is_resolved(&self) -> bool {\n-        true\n-    }\n-\n-    fn is_transient(&self) -> bool {\n-        false\n-    }\n-}\n-\n impl<T> TaskInput for TransientValue<T>\n where\n     T: MagicAny + Clone + Debug + Hash + Eq + TraceRawVcs + 'static,"
        },
        {
            "sha": "69a1becb286045d2f08201e40a5f79573a9aef07",
            "filename": "turbopack/crates/turbo-tasks/src/value.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 57,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,68 +1,12 @@\n use std::{fmt::Debug, marker::PhantomData, ops::Deref};\n \n use anyhow::Result;\n-use serde::{Deserialize, Serialize};\n \n use crate::{\n-    ReadRef, SharedReference,\n-    debug::{ValueDebugFormat, ValueDebugString},\n+    SharedReference,\n     trace::{TraceRawVcs, TraceRawVcsContext},\n };\n \n-/// Pass a value by value (`Value<Xxx>`) instead of by reference (`Vc<Xxx>`).\n-///\n-/// Persistent, requires serialization.\n-#[derive(Debug, PartialEq, Eq, Clone, Hash, Serialize, Deserialize)]\n-pub struct Value<T> {\n-    inner: T,\n-}\n-\n-impl<T> Value<T> {\n-    pub fn new(value: T) -> Self {\n-        Self { inner: value }\n-    }\n-\n-    pub fn into_value(self) -> T {\n-        self.inner\n-    }\n-}\n-\n-impl<T> Deref for Value<T> {\n-    type Target = T;\n-\n-    fn deref(&self) -> &Self::Target {\n-        &self.inner\n-    }\n-}\n-\n-impl<T: Copy> Copy for Value<T> {}\n-\n-impl<T: Default> Default for Value<T> {\n-    fn default() -> Self {\n-        Value::new(Default::default())\n-    }\n-}\n-\n-impl<T: ValueDebugFormat> Value<T> {\n-    pub async fn dbg(&self) -> Result<ReadRef<ValueDebugString>> {\n-        self.dbg_depth(usize::MAX).await\n-    }\n-\n-    pub async fn dbg_depth(&self, depth: usize) -> Result<ReadRef<ValueDebugString>> {\n-        self.inner\n-            .value_debug_format(depth)\n-            .try_to_value_debug_string()\n-            .await?\n-            .await\n-    }\n-}\n-\n-impl<T: TraceRawVcs> TraceRawVcs for Value<T> {\n-    fn trace_raw_vcs(&self, trace_context: &mut TraceRawVcsContext) {\n-        self.inner.trace_raw_vcs(trace_context)\n-    }\n-}\n-\n /// Pass a value by value (`Value<Xxx>`) instead of by reference (`Vc<Xxx>`).\n ///\n /// Doesn't require serialization, and won't be stored in the persistent cache"
        },
        {
            "sha": "dcf8bc54774939fb0642f95f47f1bab5d5b5debb",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -3,7 +3,7 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, Upcast, Value, ValueToString, Vc,\n+    NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, Upcast, ValueToString, Vc,\n     trace::TraceRawVcs,\n };\n use turbo_tasks_fs::FileSystemPath;\n@@ -38,7 +38,7 @@ use crate::ecmascript::{\n };\n \n #[turbo_tasks::value]\n-#[derive(Debug, Clone, Copy, Hash)]\n+#[derive(Debug, Clone, Copy, Hash, TaskInput)]\n pub enum CurrentChunkMethod {\n     StringLiteral,\n     DocumentCurrentScript,\n@@ -161,7 +161,7 @@ impl BrowserChunkingContextBuilder {\n     }\n \n     pub fn build(self) -> Vc<BrowserChunkingContext> {\n-        BrowserChunkingContext::new(Value::new(self.chunking_context))\n+        BrowserChunkingContext::new(self.chunking_context)\n     }\n }\n \n@@ -172,7 +172,7 @@ impl BrowserChunkingContextBuilder {\n /// It splits \"node_modules\" separately as these are less likely to change\n /// during development\n #[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n pub struct BrowserChunkingContext {\n     name: Option<RcStr>,\n     /// The root path of the project\n@@ -295,8 +295,8 @@ impl BrowserChunkingContext {\n #[turbo_tasks::value_impl]\n impl BrowserChunkingContext {\n     #[turbo_tasks::function]\n-    fn new(this: Value<BrowserChunkingContext>) -> Vc<Self> {\n-        this.into_value().cell()\n+    fn new(this: BrowserChunkingContext) -> Vc<Self> {\n+        this.cell()\n     }\n \n     #[turbo_tasks::function]\n@@ -323,7 +323,7 @@ impl BrowserChunkingContext {\n         ident: Vc<AssetIdent>,\n         evaluatable_assets: Vc<EvaluatableAssets>,\n         other_chunks: Vc<OutputAssets>,\n-        source: Value<EcmascriptDevChunkListSource>,\n+        source: EcmascriptDevChunkListSource,\n     ) -> Vc<Box<dyn OutputAsset>> {\n         Vc::upcast(EcmascriptDevChunkList::new(\n             self,\n@@ -565,7 +565,7 @@ impl ChunkingContext for BrowserChunkingContext {\n                         ident,\n                         EvaluatableAssets::empty(),\n                         Vc::cell(assets.clone()),\n-                        Value::new(EcmascriptDevChunkListSource::Dynamic),\n+                        EcmascriptDevChunkListSource::Dynamic,\n                     )\n                     .to_resolved()\n                     .await?,\n@@ -634,7 +634,7 @@ impl ChunkingContext for BrowserChunkingContext {\n                         ident,\n                         entries,\n                         other_assets,\n-                        Value::new(EcmascriptDevChunkListSource::Entry),\n+                        EcmascriptDevChunkListSource::Entry,\n                     )\n                     .to_resolved()\n                     .await?,"
        },
        {
            "sha": "6ded556269772775ea72bc223b18f43fd764f015",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/evaluate/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -5,7 +5,7 @@ use either::Either;\n use indoc::writedoc;\n use serde::Serialize;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ReadRef, ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc};\n+use turbo_tasks::{ReadRef, ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n use turbo_tasks_fs::{File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -171,7 +171,7 @@ impl EcmascriptBrowserEvaluateChunk {\n                     environment,\n                     chunking_context.chunk_base_path(),\n                     chunking_context.chunk_suffix_path(),\n-                    Value::new(chunking_context.runtime_type()),\n+                    chunking_context.runtime_type(),\n                     output_root_to_root_path,\n                     source_maps,\n                 );\n@@ -182,7 +182,7 @@ impl EcmascriptBrowserEvaluateChunk {\n                     environment,\n                     chunking_context.chunk_base_path(),\n                     chunking_context.chunk_suffix_path(),\n-                    Value::new(chunking_context.runtime_type()),\n+                    chunking_context.runtime_type(),\n                     output_root_to_root_path,\n                     source_maps,\n                 );"
        },
        {
            "sha": "1b245111b4c9b0a2e4b443d4380fc15f272d8ac1",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/list/asset.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 5,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,6 +1,7 @@\n use anyhow::Result;\n+use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, ValueToString, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -42,14 +43,14 @@ impl EcmascriptDevChunkList {\n         ident: ResolvedVc<AssetIdent>,\n         evaluatable_assets: ResolvedVc<EvaluatableAssets>,\n         chunks: ResolvedVc<OutputAssets>,\n-        source: Value<EcmascriptDevChunkListSource>,\n+        source: EcmascriptDevChunkListSource,\n     ) -> Vc<Self> {\n         EcmascriptDevChunkList {\n             chunking_context,\n             ident,\n             evaluatable_assets,\n             chunks,\n-            source: source.into_value(),\n+            source,\n         }\n         .cell()\n     }\n@@ -112,8 +113,19 @@ impl Asset for EcmascriptDevChunkList {\n     }\n }\n \n-#[derive(Debug, Clone, Copy, Hash)]\n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n+#[derive(\n+    Eq,\n+    PartialEq,\n+    Debug,\n+    Clone,\n+    Copy,\n+    Hash,\n+    TaskInput,\n+    NonLocalValue,\n+    TraceRawVcs,\n+    Serialize,\n+    Deserialize,\n+)]\n #[serde(rename_all = \"camelCase\")]\n pub enum EcmascriptDevChunkListSource {\n     /// The chunk list is from a runtime entry."
        },
        {
            "sha": "12472129c2eba055f8ba7b2926f40c4dc37d8730",
            "filename": "turbopack/crates/turbopack-core/src/compile_time_info.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcompile_time_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcompile_time_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcompile_time_info.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, NonLocalValue, ResolvedVc, Vc, trace::TraceRawVcs};\n+use turbo_tasks::{FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::FileSystemPath;\n \n use crate::environment::Environment;\n@@ -101,8 +101,8 @@ macro_rules! free_var_references {\n \n // TODO: replace with just a `serde_json::Value`\n // https://linear.app/vercel/issue/WEB-1641/compiletimedefinevalue-should-just-use-serde-jsonvalue\n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[turbo_tasks::value]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n pub enum CompileTimeDefineValue {\n     Bool(bool),\n     String(RcStr),"
        },
        {
            "sha": "89b6e4d5ecdc1fa0afb236eda2e99e89cb596020",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/src/browser_runtime.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -3,7 +3,7 @@ use std::io::Write;\n use anyhow::Result;\n use indoc::writedoc;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{Value, Vc};\n+use turbo_tasks::Vc;\n use turbopack_core::{\n     code_builder::{Code, CodeBuilder},\n     context::AssetContext,\n@@ -19,7 +19,7 @@ pub async fn get_browser_runtime_code(\n     environment: Vc<Environment>,\n     chunk_base_path: Option<RcStr>,\n     chunk_suffix_path: Option<RcStr>,\n-    runtime_type: Value<RuntimeType>,\n+    runtime_type: RuntimeType,\n     output_root_to_root_path: RcStr,\n     generate_source_map: bool,\n ) -> Result<Vc<Code>> {\n@@ -32,7 +32,7 @@ pub async fn get_browser_runtime_code(\n     );\n \n     let mut runtime_base_code = vec![\"browser/runtime/base/runtime-base.ts\"];\n-    match *runtime_type {\n+    match runtime_type {\n         RuntimeType::Production => runtime_base_code.push(\"browser/runtime/base/build-base.ts\"),\n         RuntimeType::Development => {\n             runtime_base_code.push(\"browser/runtime/base/dev-base.ts\");\n@@ -50,7 +50,7 @@ pub async fn get_browser_runtime_code(\n         .await?;\n \n     let mut runtime_backend_code = vec![];\n-    match (chunk_loading, *runtime_type) {\n+    match (chunk_loading, runtime_type) {\n         (ChunkLoading::Edge, RuntimeType::Development) => {\n             runtime_backend_code.push(\"browser/runtime/edge/runtime-backend-edge.ts\");\n             runtime_backend_code.push(\"browser/runtime/edge/dev-backend-edge.ts\");\n@@ -157,7 +157,7 @@ pub async fn get_browser_runtime_code(\n             chunksToRegister.forEach(registerChunk);\n         \"#\n     )?;\n-    if matches!(*runtime_type, RuntimeType::Development) {\n+    if matches!(runtime_type, RuntimeType::Development) {\n         writedoc!(\n             code,\n             r#\""
        },
        {
            "sha": "77c9db0bba58ec7cfa76001871058cd0148efb87",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 24,
            "deletions": 13,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -70,8 +70,8 @@ pub use transform::{\n };\n use turbo_rcstr::rcstr;\n use turbo_tasks::{\n-    FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Value,\n-    ValueToString, Vc, trace::TraceRawVcs,\n+    FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, ValueToString, Vc,\n+    trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{FileJsonContent, FileSystemPath, glob::Glob, rope::Rope};\n use turbopack_core::{\n@@ -110,8 +110,20 @@ use crate::{\n     transform::remove_shebang,\n };\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Hash, Debug, Clone, Copy, Default, TaskInput)]\n+#[derive(\n+    Eq,\n+    PartialEq,\n+    Hash,\n+    Debug,\n+    Clone,\n+    Copy,\n+    Default,\n+    TaskInput,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    Serialize,\n+    Deserialize,\n+)]\n pub enum SpecifiedModuleType {\n     #[default]\n     Automatic,\n@@ -174,7 +186,7 @@ pub struct EcmascriptOptions {\n }\n \n #[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Hash, Debug, Copy, Clone)]\n+#[derive(Hash, Debug, Copy, Clone, TaskInput)]\n pub enum EcmascriptModuleAssetType {\n     /// Module with EcmaScript code\n     Ecmascript,\n@@ -235,7 +247,7 @@ impl EcmascriptModuleAssetBuilder {\n             EcmascriptModuleAsset::new_with_inner_assets(\n                 *self.source,\n                 *self.asset_context,\n-                Value::new(self.ty),\n+                self.ty,\n                 *self.transforms,\n                 *self.options,\n                 *self.compile_time_info,\n@@ -245,7 +257,7 @@ impl EcmascriptModuleAssetBuilder {\n             EcmascriptModuleAsset::new(\n                 *self.source,\n                 *self.asset_context,\n-                Value::new(self.ty),\n+                self.ty,\n                 *self.transforms,\n                 *self.options,\n                 *self.compile_time_info,\n@@ -501,16 +513,15 @@ impl EcmascriptModuleAsset {\n     pub fn new(\n         source: ResolvedVc<Box<dyn Source>>,\n         asset_context: ResolvedVc<Box<dyn AssetContext>>,\n-\n-        ty: Value<EcmascriptModuleAssetType>,\n+        ty: EcmascriptModuleAssetType,\n         transforms: ResolvedVc<EcmascriptInputTransforms>,\n         options: ResolvedVc<EcmascriptOptions>,\n         compile_time_info: ResolvedVc<CompileTimeInfo>,\n     ) -> Vc<Self> {\n         Self::cell(EcmascriptModuleAsset {\n             source,\n             asset_context,\n-            ty: ty.into_value(),\n+            ty,\n             transforms,\n             options,\n \n@@ -524,7 +535,7 @@ impl EcmascriptModuleAsset {\n     pub async fn new_with_inner_assets(\n         source: ResolvedVc<Box<dyn Source>>,\n         asset_context: ResolvedVc<Box<dyn AssetContext>>,\n-        ty: Value<EcmascriptModuleAssetType>,\n+        ty: EcmascriptModuleAssetType,\n         transforms: ResolvedVc<EcmascriptInputTransforms>,\n         options: ResolvedVc<EcmascriptOptions>,\n         compile_time_info: ResolvedVc<CompileTimeInfo>,\n@@ -543,7 +554,7 @@ impl EcmascriptModuleAsset {\n             Ok(Self::cell(EcmascriptModuleAsset {\n                 source,\n                 asset_context,\n-                ty: ty.into_value(),\n+                ty,\n                 transforms,\n                 options,\n                 compile_time_info,\n@@ -570,7 +581,7 @@ impl EcmascriptModuleAsset {\n \n     #[turbo_tasks::function]\n     pub fn parse(&self) -> Vc<ParseResult> {\n-        parse(*self.source, Value::new(self.ty), *self.transforms)\n+        parse(*self.source, self.ty, *self.transforms)\n     }\n }\n "
        },
        {
            "sha": "89cbc5a939d7680b36a0f3d1c6753a72d2172eec",
            "filename": "turbopack/crates/turbopack-ecmascript/src/parse.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -24,7 +24,7 @@ use swc_core::{\n };\n use tracing::{Instrument, Level, instrument};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc, util::WrapFuture};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc, util::WrapFuture};\n use turbo_tasks_fs::{FileContent, FileSystemPath, rope::Rope};\n use turbo_tasks_hash::hash_xxh3_hash64;\n use turbopack_core::{\n@@ -176,11 +176,11 @@ impl SourceMapGenConfig for InlineSourcesContentConfig {\n #[turbo_tasks::function]\n pub async fn parse(\n     source: ResolvedVc<Box<dyn Source>>,\n-    ty: Value<EcmascriptModuleAssetType>,\n+    ty: EcmascriptModuleAssetType,\n     transforms: Vc<EcmascriptInputTransforms>,\n ) -> Result<Vc<ParseResult>> {\n     let name = source.ident().to_string().await?.to_string();\n-    let span = tracing::info_span!(\"parse ecmascript\", name = name, ty = display(&*ty));\n+    let span = tracing::info_span!(\"parse ecmascript\", name = name, ty = display(&ty));\n \n     match parse_internal(source, ty, transforms)\n         .instrument(span)\n@@ -196,15 +196,14 @@ pub async fn parse(\n \n async fn parse_internal(\n     source: ResolvedVc<Box<dyn Source>>,\n-    ty: Value<EcmascriptModuleAssetType>,\n+    ty: EcmascriptModuleAssetType,\n     transforms: Vc<EcmascriptInputTransforms>,\n ) -> Result<Vc<ParseResult>> {\n     let content = source.content();\n     let fs_path_vc = source.ident().path();\n     let fs_path = &*fs_path_vc.await?;\n     let ident = &*source.ident().to_string().await?;\n     let file_path_hash = hash_xxh3_hash64(&*source.ident().to_string().await?) as u128;\n-    let ty = ty.into_value();\n     let content = match content.await {\n         Ok(content) => content,\n         Err(error) => {"
        },
        {
            "sha": "ca70809371dc5897ce54334de5335083606f7d2f",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/constant_value.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fconstant_value.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fconstant_value.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fconstant_value.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n use swc_core::quote;\n-use turbo_tasks::{NonLocalValue, Value, Vc, debug::ValueDebugFormat, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, TaskInput, Vc, debug::ValueDebugFormat, trace::TraceRawVcs};\n use turbopack_core::{\n     chunk::ChunkingContext, compile_time_info::CompileTimeDefineValue, module_graph::ModuleGraph,\n };\n@@ -12,18 +12,27 @@ use crate::{\n     create_visitor,\n };\n \n-#[derive(PartialEq, Eq, Serialize, Deserialize, TraceRawVcs, ValueDebugFormat, NonLocalValue)]\n+#[derive(\n+    Clone,\n+    Debug,\n+    PartialEq,\n+    Eq,\n+    Hash,\n+    Serialize,\n+    Deserialize,\n+    TraceRawVcs,\n+    ValueDebugFormat,\n+    NonLocalValue,\n+    TaskInput,\n+)]\n pub struct ConstantValueCodeGen {\n     value: CompileTimeDefineValue,\n     path: AstPath,\n }\n \n impl ConstantValueCodeGen {\n-    pub fn new(value: Value<CompileTimeDefineValue>, path: AstPath) -> Self {\n-        ConstantValueCodeGen {\n-            value: value.into_value(),\n-            path,\n-        }\n+    pub fn new(value: CompileTimeDefineValue, path: AstPath) -> Self {\n+        ConstantValueCodeGen { value, path }\n     }\n     pub async fn code_generation(\n         &self,"
        },
        {
            "sha": "e37d6a561d97a06cba4fb98f2fef50f58dcff10c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/base.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -6,7 +6,7 @@ use swc_core::{\n     quote,\n };\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     chunk::{\n@@ -143,15 +143,15 @@ impl EsmAssetReference {\n         origin: ResolvedVc<Box<dyn ResolveOrigin>>,\n         request: ResolvedVc<Request>,\n         issue_source: IssueSource,\n-        annotations: Value<ImportAnnotations>,\n+        annotations: ImportAnnotations,\n         export_name: Option<ModulePart>,\n         import_externals: bool,\n     ) -> Self {\n         EsmAssetReference {\n             origin,\n             request,\n             issue_source,\n-            annotations: annotations.into_value(),\n+            annotations,\n             export_name,\n             import_externals,\n         }\n@@ -225,7 +225,7 @@ impl ModuleReference for EsmAssetReference {\n         let result = esm_resolve(\n             self.get_origin().resolve().await?,\n             *self.request,\n-            Value::new(ty),\n+            ty,\n             false,\n             Some(self.issue_source.clone()),\n         )"
        },
        {
            "sha": "4ca75b32903321019bac2019a0f58e2275bc5eed",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/dynamic.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -7,8 +7,7 @@ use swc_core::{\n };\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    NonLocalValue, ResolvedVc, Value, ValueToString, Vc, debug::ValueDebugFormat,\n-    trace::TraceRawVcs,\n+    NonLocalValue, ResolvedVc, ValueToString, Vc, debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n use turbopack_core::{\n     chunk::{ChunkableModuleReference, ChunkingContext, ChunkingType, ChunkingTypeOption},\n@@ -59,15 +58,15 @@ impl EsmAsyncAssetReference {\n         origin: ResolvedVc<Box<dyn ResolveOrigin>>,\n         request: ResolvedVc<Request>,\n         issue_source: IssueSource,\n-        annotations: Value<ImportAnnotations>,\n+        annotations: ImportAnnotations,\n         in_try: bool,\n         import_externals: bool,\n     ) -> Self {\n         EsmAsyncAssetReference {\n             origin,\n             request,\n             issue_source,\n-            annotations: annotations.into_value(),\n+            annotations,\n             in_try,\n             import_externals,\n         }\n@@ -81,7 +80,7 @@ impl ModuleReference for EsmAsyncAssetReference {\n         esm_resolve(\n             self.get_origin().resolve().await?,\n             *self.request,\n-            Value::new(EcmaScriptModulesReferenceSubType::DynamicImport),\n+            EcmaScriptModulesReferenceSubType::DynamicImport,\n             self.in_try,\n             Some(self.issue_source.clone()),\n         )"
        },
        {
            "sha": "c6ea7645d0f01cef9246a4799b11437077a941a3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -54,7 +54,7 @@ use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     FxIndexMap, FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Upcast,\n-    Value, ValueToString, Vc, trace::TraceRawVcs,\n+    ValueToString, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -511,7 +511,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n     let raw_module = module.await?;\n \n     let source = raw_module.source;\n-    let ty = Value::new(raw_module.ty);\n+    let ty = raw_module.ty;\n     let transforms = raw_module.transforms;\n     let options = raw_module.options;\n     let options = options.await?;\n@@ -523,7 +523,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n     let path = origin.origin_path();\n \n     // Is this a typescript file that requires analzying type references?\n-    let analyze_types = match &*ty {\n+    let analyze_types = match &ty {\n         EcmascriptModuleAssetType::Typescript { analyze_types, .. } => *analyze_types,\n         EcmascriptModuleAssetType::TypescriptDeclaration => true,\n         EcmascriptModuleAssetType::Ecmascript => false,\n@@ -744,7 +744,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n                 r.issue_source\n                     .clone()\n                     .unwrap_or_else(|| IssueSource::from_source_only(source)),\n-                Value::new(r.annotations.clone()),\n+                r.annotations.clone(),\n                 match options.tree_shaking_mode {\n                     Some(TreeShakingMode::ModuleFragments) => match &r.imported_symbol {\n                         ImportedSymbol::ModuleEvaluation => {\n@@ -1381,7 +1381,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n                                             r_ref.origin,\n                                             r_ref.request,\n                                             r_ref.issue_source.clone(),\n-                                            Value::new(r_ref.annotations.clone()),\n+                                            r_ref.annotations.clone(),\n                                             Some(ModulePart::export(export.clone())),\n                                             r_ref.import_externals,\n                                         )\n@@ -1747,7 +1747,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                         origin,\n                         Request::parse(pat).to_resolved().await?,\n                         issue_source(source, span),\n-                        Value::new(import_annotations),\n+                        import_annotations,\n                         in_try,\n                         state.import_externals,\n                     ),\n@@ -2540,7 +2540,7 @@ async fn handle_free_var_reference(\n         ),\n         FreeVarReference::Value(value) => {\n             analysis.add_code_gen(ConstantValueCodeGen::new(\n-                Value::new(value.clone()),\n+                value.clone(),\n                 ast_path.to_vec().into(),\n             ));\n         }\n@@ -2610,7 +2610,7 @@ async fn handle_free_var_reference(\n                 InputRelativeConstant::FileName => source_path,\n             };\n             analysis.add_code_gen(ConstantValueCodeGen::new(\n-                Value::new(as_abs_path(source_path).await?.into()),\n+                as_abs_path(source_path).await?.into(),\n                 ast_path.to_vec().into(),\n             ));\n         }"
        },
        {
            "sha": "aa27119f97651c5d6d0c333f3dc17cc45d6eb030",
            "filename": "turbopack/crates/turbopack-ecmascript/src/webpack/parse.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fparse.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -12,7 +12,7 @@ use swc_core::{\n         visit::{Visit, VisitWith},\n     },\n };\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::source::Source;\n \n@@ -190,12 +190,7 @@ pub async fn webpack_runtime(\n     source: Vc<Box<dyn Source>>,\n     transforms: Vc<EcmascriptInputTransforms>,\n ) -> Result<Vc<WebpackRuntime>> {\n-    let parsed = parse(\n-        source,\n-        Value::new(EcmascriptModuleAssetType::Ecmascript),\n-        transforms,\n-    )\n-    .await?;\n+    let parsed = parse(source, EcmascriptModuleAssetType::Ecmascript, transforms).await?;\n     match &*parsed {\n         ParseResult::Ok {\n             program,"
        },
        {
            "sha": "9f52f03659428fbc964869b5b153468308710914",
            "filename": "turbopack/crates/turbopack-ecmascript/src/webpack/references.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Freferences.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Freferences.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Freferences.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -7,7 +7,7 @@ use swc_core::{\n     },\n };\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     reference::{ModuleReference, ModuleReferences},\n     source::Source,\n@@ -26,12 +26,7 @@ pub async fn module_references(\n     runtime: ResolvedVc<WebpackRuntime>,\n     transforms: ResolvedVc<EcmascriptInputTransforms>,\n ) -> Result<Vc<ModuleReferences>> {\n-    let parsed = parse(\n-        *source,\n-        Value::new(EcmascriptModuleAssetType::Ecmascript),\n-        *transforms,\n-    )\n-    .await?;\n+    let parsed = parse(*source, EcmascriptModuleAssetType::Ecmascript, *transforms).await?;\n     match &*parsed {\n         ParseResult::Ok {\n             program,"
        },
        {
            "sha": "2686c629e86114f68605f6859de1372d2ffa3c72",
            "filename": "turbopack/crates/turbopack-resolve/src/ecmascript.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f607d0cf976d6cbe654dd3b7914113701d5a93f9/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs?ref=f607d0cf976d6cbe654dd3b7914113701d5a93f9",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     issue::IssueSource,\n     reference_type::{CommonJsReferenceSubType, EcmaScriptModulesReferenceSubType, ReferenceType},\n@@ -90,11 +90,11 @@ pub async fn apply_cjs_specific_options(options: Vc<ResolveOptions>) -> Result<V\n pub async fn esm_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n-    ty: Value<EcmaScriptModulesReferenceSubType>,\n+    ty: EcmaScriptModulesReferenceSubType,\n     is_optional: bool,\n     issue_source: Option<IssueSource>,\n ) -> Result<Vc<ModuleResolveResult>> {\n-    let ty = ReferenceType::EcmaScriptModules(ty.into_value());\n+    let ty = ReferenceType::EcmaScriptModules(ty);\n     let options = apply_esm_specific_options(origin.resolve_options(ty.clone()), ty.clone())\n         .resolve()\n         .await?;"
        }
    ],
    "stats": {
        "total": 301,
        "additions": 120,
        "deletions": 181
    }
}