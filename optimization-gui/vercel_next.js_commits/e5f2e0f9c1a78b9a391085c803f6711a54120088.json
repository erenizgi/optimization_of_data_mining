{
    "author": "devjiwonchoi",
    "message": "[release-new] fix: release pr commit contains `(#number)` at last (#79611)\n\nWhen the \"Version Packages\" PR is merged, the created commit is the\nformat of \"Version Packages (#number)\". Therefore, the\ncheck-is-release.js script won't match the current regex. Also, I\nmodified the workflows that use the `check-is-release.js` to consider\nthe new release as a release workflow as well.",
    "sha": "e5f2e0f9c1a78b9a391085c803f6711a54120088",
    "files": [
        {
            "sha": "e237c94f2fb697e4e167d0ab2bfbb901b756a54a",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/e5f2e0f9c1a78b9a391085c803f6711a54120088/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/e5f2e0f9c1a78b9a391085c803f6711a54120088/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=e5f2e0f9c1a78b9a391085c803f6711a54120088",
            "patch": "@@ -19,8 +19,9 @@ env:\n   #\n   # See https://doc.rust-lang.org/rustc/platform-support/apple-darwin.html#os-version for more details\n   MACOSX_DEPLOYMENT_TARGET: 11.0\n-  # This will become \"true\" if the latest commit is\n-  # \"Version Packages\" or \"Version Pacakges \\((canary|rc)\\)\"\n+  # This will become \"true\" if the latest commit (merged release PR) is either:\n+  # - \"Version Packages (#<number>)\"\n+  # - \"Version Pacakges (canary/rc) (#<number>)\"\n   # set from scripts/check-is-release.js\n   __NEW_RELEASE: 'false'\n \n@@ -50,10 +51,11 @@ jobs:\n         run: |\n           # TODO: Remove the new release check once the new release workflow is fully replaced.\n           RELEASE_CHECK=$(node ./scripts/check-is-release.js 2> /dev/null || :)\n-          if [[ $RELEASE_CHECK =~ ^Version\\ Packages(\\ \\((canary|rc)\\))?$ ]];\n+          if [[ $RELEASE_CHECK == 'new-release' ]];\n           then\n             echo \"__NEW_RELEASE=true\" >> $GITHUB_ENV\n-          elif [[ $RELEASE_CHECK = v* ]];\n+            echo \"value=production\" >> $GITHUB_OUTPUT\n+          elif [[ $RELEASE_CHECK == v* ]];\n           then\n             echo \"value=production\" >> $GITHUB_OUTPUT\n           elif [ '${{ github.ref }}' == 'refs/heads/canary' ]"
        },
        {
            "sha": "fb2edbc5198f2ff63abce01d26314c45990dffcc",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e5f2e0f9c1a78b9a391085c803f6711a54120088/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/e5f2e0f9c1a78b9a391085c803f6711a54120088/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=e5f2e0f9c1a78b9a391085c803f6711a54120088",
            "patch": "@@ -39,7 +39,8 @@ jobs:\n       - name: check for release\n         id: is-release\n         run: |\n-          if [[ $(node ./scripts/check-is-release.js 2> /dev/null || :) = v* ]];\n+          RELEASE_CHECK=$(node ./scripts/check-is-release.js 2> /dev/null || :)\n+          if [[ $RELEASE_CHECK == \"new-release\" || $RELEASE_CHECK == v* ]];\n             then\n               echo \"IS_RELEASE=true\" >> $GITHUB_OUTPUT\n             else"
        },
        {
            "sha": "a9e8648be8825f98e351b14365efbda51df80aaa",
            "filename": "scripts/check-is-release.js",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/e5f2e0f9c1a78b9a391085c803f6711a54120088/scripts%2Fcheck-is-release.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e5f2e0f9c1a78b9a391085c803f6711a54120088/scripts%2Fcheck-is-release.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcheck-is-release.js?ref=e5f2e0f9c1a78b9a391085c803f6711a54120088",
            "patch": "@@ -13,13 +13,16 @@ const checkIsRelease = async () => {\n \n   const versionString = commitMsg.split(' ').pop().trim()\n   const publishMsgRegex = /^v\\d{1,}\\.\\d{1,}\\.\\d{1,}(-\\w{1,}\\.\\d{1,})?$/\n-  const newPublishMsgRegex = /^Version Packages( \\((canary|rc)\\))?$/\n+  const newPublishMsgRegex = /^Version Packages( \\((canary|rc)\\))?( \\(#\\d+\\))?$/\n+  // When the \"Version Packages\" PR is merged, it may contain \"\\n\"\n+  // in the message when co-authored, so split and get the first one.\n+  const newPublishPrMessage = commitMsg.split('\\n')[0]\n \n   if (publishMsgRegex.test(versionString)) {\n     console.log(versionString)\n     process.exit(0)\n-  } else if (newPublishMsgRegex.test(commitMsg)) {\n-    console.log(commitMsg)\n+  } else if (newPublishMsgRegex.test(newPublishPrMessage)) {\n+    console.log('new-release')\n     process.exit(0)\n   } else {\n     console.log('not publish commit', { commitId, commitMsg, versionString })"
        },
        {
            "sha": "b83b033e0b337297a1c244ce685a45ec0265fa6e",
            "filename": "scripts/release-stats.sh",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e5f2e0f9c1a78b9a391085c803f6711a54120088/scripts%2Frelease-stats.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/e5f2e0f9c1a78b9a391085c803f6711a54120088/scripts%2Frelease-stats.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Frelease-stats.sh?ref=e5f2e0f9c1a78b9a391085c803f6711a54120088",
            "patch": "@@ -1,6 +1,7 @@\n #!/usr/bin/env bash\n \n-if [[ $(node ./scripts/check-is-release.js 2> /dev/null || :) = v* ]];\n+RELEASE_CHECK=$(node ./scripts/check-is-release.js 2> /dev/null || :)\n+if [[ $RELEASE_CHECK == \"new-release\" || $RELEASE_CHECK == v* ]];\n   then\n     echo \"Publish occurred, running release stats...\"\n   else"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 16,
        "deletions": 9
    }
}