{
    "author": "mischnic",
    "message": "Generate deterministic requestId for SSG (#79959)\n\nUse a deterministic requestId so that this code has a deterministic key and thus a deterministic RSC payload to generate deterministic SSG output.\r\n```javascript\r\n            {/* Adding requestId as react key to make metadata remount for each render */}\r\n            <ViewportTree key={getFlightViewportKey(requestId)} />\r\n```\r\n\r\nThis was previously changing on every run:\r\n\r\n<img width=\"1398\" alt=\"Bildschirmfoto 2025-05-30 um 10 45 08\" src=\"https://github.com/user-attachments/assets/36cb9864-9b27-4107-93d6-689c9d147e86\" />",
    "sha": "0b5196f4d9bdd70789db4b4cf5723a3040ab4c0c",
    "files": [
        {
            "sha": "b61bd61909f4638d4c2018c1290989a194f5692c",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/0b5196f4d9bdd70789db4b4cf5723a3040ab4c0c/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0b5196f4d9bdd70789db4b4cf5723a3040ab4c0c/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=0b5196f4d9bdd70789db4b4cf5723a3040ab4c0c",
            "patch": "@@ -1331,13 +1331,19 @@ async function renderToHTMLOrFlightImpl(\n     nonce,\n   } = parsedRequestHeaders\n \n+  const { isStaticGeneration, fallbackRouteParams } = workStore\n+\n   /**\n    * The metadata items array created in next-app-loader with all relevant information\n    * that we need to resolve the final metadata.\n    */\n   let requestId: string\n \n-  if (process.env.NEXT_RUNTIME === 'edge') {\n+  if (isStaticGeneration) {\n+    requestId = Buffer.from(\n+      await crypto.subtle.digest('SHA-1', Buffer.from(req.url))\n+    ).toString('hex')\n+  } else if (process.env.NEXT_RUNTIME === 'edge') {\n     requestId = crypto.randomUUID()\n   } else {\n     requestId = require('next/dist/compiled/nanoid').nanoid()\n@@ -1348,8 +1354,6 @@ async function renderToHTMLOrFlightImpl(\n    */\n   const params = renderOpts.params ?? {}\n \n-  const { isStaticGeneration, fallbackRouteParams } = workStore\n-\n   const getDynamicParamFromSegment = makeGetDynamicParamFromSegment(\n     params,\n     pagePath,"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 7,
        "deletions": 3
    }
}