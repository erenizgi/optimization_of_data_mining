{
    "author": "ijjk",
    "message": "Update deploy adapters outputs and handler interfaces for node and edge (#88247)\n\nThis updates to expand our normalized interface of handler(req, ctx) to\nedge runtime as well and middleware. This also applies some fixes for\noutputs and routes for app router. Validated against our test suite here\nhttps://github.com/vercel/vercel/pull/14102 to start.\n\nOnce https://github.com/nextjs/adapter-vercel/pull/6 is landed we can\nstart wiring up the full E2E test suite for validating.",
    "sha": "586c1ed7f88045415691b26f9fb549d47c4062d8",
    "files": [
        {
            "sha": "1af503c507551d4ecfb54d55861a332c1671e99c",
            "filename": "packages/next/src/build/adapter/build-complete.ts",
            "status": "modified",
            "additions": 87,
            "deletions": 12,
            "changes": 99,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -38,6 +38,7 @@ import {\n   JSON_CONTENT_TYPE_HEADER,\n   NEXT_RESUME_HEADER,\n } from '../../lib/constants'\n+\n import { normalizeLocalePath } from '../../shared/lib/i18n/normalize-locale-path'\n import { addPathPrefix } from '../../shared/lib/router/utils/add-path-prefix'\n import { getRedirectStatus, modifyRouteRegex } from '../../lib/redirect-status'\n@@ -47,6 +48,7 @@ import { sortSortableRoutes } from '../../shared/lib/router/utils/sortable-route\n import { nodeFileTrace } from 'next/dist/compiled/@vercel/nft'\n import { defaultOverrides } from '../../server/require-hook'\n import { makeIgnoreFn } from '../collect-build-traces'\n+import { generateRoutesManifest } from '../generate-routes-manifest'\n \n interface SharedRouteFields {\n   /**\n@@ -356,6 +358,7 @@ export interface NextAdapter {\n        * and there are pages router items to resolve.\n        */\n       shouldNormalizeNextData: boolean\n+      rsc: RoutesManifest['rsc']\n     }\n     outputs: AdapterOutputs\n     /**\n@@ -410,6 +413,7 @@ function normalizePathnames(\n export async function handleBuildComplete({\n   dir,\n   config,\n+  appType,\n   buildId,\n   configOutDir,\n   distDir,\n@@ -431,6 +435,7 @@ export async function handleBuildComplete({\n   functionsConfigManifest,\n }: {\n   dir: string\n+  appType: 'app' | 'pages' | 'hybrid'\n   distDir: string\n   buildId: string\n   configOutDir: string\n@@ -888,6 +893,16 @@ export async function handleBuildComplete({\n               pathname: dataPathname,\n               id: dataPathname,\n             })\n+\n+            if (appPageKeys && appPageKeys.length > 0) {\n+              const rscPage = `${page === '/' ? '/index' : page}.rsc`\n+              outputs.staticFiles.push({\n+                id: rscPage,\n+                pathname: rscPage,\n+                type: AdapterOutputType.STATIC_FILE,\n+                filePath: rscFallbackPath,\n+              })\n+            }\n           }\n \n           for (const locale of config.i18n?.locales || []) {\n@@ -911,20 +926,19 @@ export async function handleBuildComplete({\n                 pathname: dataPathname,\n                 id: dataPathname,\n               })\n+              if (appPageKeys && appPageKeys.length > 0) {\n+                outputs.staticFiles.push({\n+                  id: `${localePage}.rsc`,\n+                  pathname: `${localePage}.rsc`,\n+                  type: AdapterOutputType.STATIC_FILE,\n+                  filePath: rscFallbackPath,\n+                })\n+              }\n             }\n           }\n         } else {\n           outputs.pagesApi.push(output)\n         }\n-\n-        if (appPageKeys && appPageKeys.length > 0) {\n-          outputs.staticFiles.push({\n-            id: `${output.id}.rsc`,\n-            pathname: `${output.pathname}.rsc`,\n-            type: AdapterOutputType.STATIC_FILE,\n-            filePath: rscFallbackPath,\n-          })\n-        }\n       }\n \n       if (hasNodeMiddleware) {\n@@ -1025,6 +1039,11 @@ export async function handleBuildComplete({\n             outputs.appPages.push(output)\n           } else {\n             outputs.appRoutes.push(output)\n+            outputs.appRoutes.push({\n+              ...output,\n+              pathname: normalizePagePath(output.pathname) + '.rsc',\n+              id: normalizePagePath(output.pathname) + '.rsc',\n+            })\n           }\n         }\n       }\n@@ -1284,6 +1303,16 @@ export async function handleBuildComplete({\n         }\n         outputs.prerenders.push(initialOutput)\n \n+        if (!isAppPage && appPageKeys && appPageKeys.length > 0) {\n+          const rscPage = `${route === '/' ? '/index' : route}.rsc`\n+          outputs.staticFiles.push({\n+            id: rscPage,\n+            pathname: rscPage,\n+            type: AdapterOutputType.STATIC_FILE,\n+            filePath: rscFallbackPath,\n+          })\n+        }\n+\n         if (dataRoute) {\n           let dataFilePath: string | undefined = path.join(\n             pagesDistDir,\n@@ -1412,6 +1441,21 @@ export async function handleBuildComplete({\n         if (!config.i18n || isAppPage) {\n           outputs.prerenders.push(initialOutput)\n \n+          if (\n+            !isAppPage &&\n+            fallback !== false &&\n+            appPageKeys &&\n+            appPageKeys.length > 0\n+          ) {\n+            const rscPage = `${srcRoute === '/' ? '/index' : srcRoute}.rsc`\n+            outputs.staticFiles.push({\n+              id: rscPage,\n+              pathname: rscPage,\n+              type: AdapterOutputType.STATIC_FILE,\n+              filePath: rscFallbackPath,\n+            })\n+          }\n+\n           if (isAppPage) {\n             await handleAppMeta(dynamicRoute, initialOutput, meta)\n           }\n@@ -1468,6 +1512,21 @@ export async function handleBuildComplete({\n             }\n             outputs.prerenders.push(currentOutput)\n \n+            if (\n+              !isAppPage &&\n+              fallback !== false &&\n+              appPageKeys &&\n+              appPageKeys.length > 0\n+            ) {\n+              const rscPage = `${path.posix.join(`/${locale}`, initialOutput.pathname)}.rsc`\n+              outputs.staticFiles.push({\n+                id: rscPage,\n+                pathname: rscPage,\n+                type: AdapterOutputType.STATIC_FILE,\n+                filePath: rscFallbackPath,\n+              })\n+            }\n+\n             if (dataRoute) {\n               const dataPathname = path.posix.join(\n                 `/_next/data`,\n@@ -1592,10 +1651,13 @@ export async function handleBuildComplete({\n             // enabled.\n             shouldSkipSuffixes\n               ? '(?<rscSuffix>\\\\.rsc|\\\\.segments/.+\\\\.segment\\\\.rsc)(?:/)?$'\n-              : '(?<rscSuffix>\\\\.rsc|\\\\.prefetch\\\\.rsc|\\\\.segments/.+\\\\.segment\\\\.rsc)(?:/)?$'\n+              : '(?<rscSuffix>\\\\.rsc|\\\\.segments/.+\\\\.segment\\\\.rsc)(?:/)?$'\n           ),\n           destination: destination?.replace(/($|\\?)/, '$rscSuffix$1'),\n-          has: isFallbackFalse ? fallbackFalseHasCondition : undefined,\n+          has:\n+            isFallbackFalse && !pageKeys.includes(route.page)\n+              ? fallbackFalseHasCondition\n+              : undefined,\n           missing: undefined,\n         })\n       }\n@@ -1765,7 +1827,7 @@ export async function handleBuildComplete({\n             {\n               // This ensures we only match known emitted-by-Next.js files and not\n               // user-emitted files which may be missing a hash in their filename.\n-              sourceRegex: `^/${escapeStringRegexp(buildId)}/_next/static/(?:[^/]+/pages|pages|chunks|runtime|css|image|media|${escapeStringRegexp(buildId)})/.+`,\n+              sourceRegex: `${path.posix.join(config.basePath || '/', '_next/static', `/(?:[^/]+/pages|pages|chunks|runtime|css|image|media|${escapeStringRegexp(buildId)})/.+`)}`,\n               // Next.js assets contain a hash or entropy in their filenames, so they\n               // are guaranteed to be unique and cacheable indefinitely.\n               headers: {\n@@ -1775,6 +1837,19 @@ export async function handleBuildComplete({\n           ],\n           fallback: rewrites.fallback,\n           shouldNormalizeNextData: !!needsMiddlewareResolveRoutes,\n+          rsc: generateRoutesManifest({\n+            appType,\n+            pageKeys: {\n+              pages: pageKeys as string[],\n+              app: appPageKeys as string[],\n+            },\n+            config,\n+            redirects: [],\n+            headers: [],\n+            rewrites,\n+            restrictedRedirectPaths: [],\n+            isAppPPREnabled: config.cacheComponents,\n+          }).routesManifest.rsc,\n         },\n         outputs,\n "
        },
        {
            "sha": "725223d76f67743a0075dd6336b0bc5551140c6f",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -343,6 +343,9 @@ export function getDefineEnv({\n       config.experimental.reactDebugChannel ?? false,\n     'process.env.__NEXT_TRANSITION_INDICATOR':\n       config.experimental.transitionIndicator ?? false,\n+    'process.env.__NEXT_CACHE_LIFE': config.cacheLife,\n+    'process.env.__NEXT_CLIENT_PARAM_PARSING_ORIGINS':\n+      config.experimental.clientParamParsingOrigins || [],\n   }\n \n   const userDefines = config.compiler?.define ?? {}"
        },
        {
            "sha": "ed2a90d8ebe0f604143c843a325754782f0dceb4",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -4138,6 +4138,7 @@ export default async function build(\n               dir,\n               distDir,\n               config,\n+              appType,\n               buildId,\n               configOutDir: path.join(dir, configOutDir),\n               staticPages,"
        },
        {
            "sha": "3419ecac020210bab70e28bf6f4efffadbc81813",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -10,7 +10,12 @@ import { RouteKind } from '../../server/route-kind' with { 'turbopack-transition\n \n import { getRevalidateReason } from '../../server/instrumentation/utils'\n import { getTracer, SpanKind, type Span } from '../../server/lib/trace/tracer'\n-import { addRequestMeta, getRequestMeta } from '../../server/request-meta'\n+import type { RequestMeta } from '../../server/request-meta'\n+import {\n+  addRequestMeta,\n+  getRequestMeta,\n+  setRequestMeta,\n+} from '../../server/request-meta'\n import { BaseServerSpan } from '../../server/lib/trace/constants'\n import { interopDefault } from '../../server/app-render/interop-default'\n import { stripFlightHeaders } from '../../server/app-render/strip-flight-headers'\n@@ -116,9 +121,14 @@ export async function handler(\n   req: IncomingMessage,\n   res: ServerResponse,\n   ctx: {\n-    waitUntil: (prom: Promise<void>) => void\n+    waitUntil?: (prom: Promise<void>) => void\n+    requestMeta?: RequestMeta\n   }\n ) {\n+  if (ctx.requestMeta) {\n+    setRequestMeta(req, ctx.requestMeta)\n+  }\n+\n   if (routeModule.isDev) {\n     addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n   }"
        },
        {
            "sha": "2c5348dd7be25551d23fa33b088dba3d8ecab22d",
            "filename": "packages/next/src/build/templates/app-route.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -6,7 +6,12 @@ import {\n import { RouteKind } from '../../server/route-kind'\n import { patchFetch as _patchFetch } from '../../server/lib/patch-fetch'\n import type { IncomingMessage, ServerResponse } from 'node:http'\n-import { addRequestMeta, getRequestMeta } from '../../server/request-meta'\n+import {\n+  addRequestMeta,\n+  getRequestMeta,\n+  setRequestMeta,\n+  type RequestMeta,\n+} from '../../server/request-meta'\n import { getTracer, type Span, SpanKind } from '../../server/lib/trace/tracer'\n import { setManifestsSingleton } from '../../server/app-render/manifests-singleton'\n import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n@@ -81,9 +86,13 @@ export async function handler(\n   req: IncomingMessage,\n   res: ServerResponse,\n   ctx: {\n-    waitUntil: (prom: Promise<void>) => void\n+    waitUntil?: (prom: Promise<void>) => void\n+    requestMeta?: RequestMeta\n   }\n ) {\n+  if (ctx.requestMeta) {\n+    setRequestMeta(req, ctx.requestMeta)\n+  }\n   if (routeModule.isDev) {\n     addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n   }"
        },
        {
            "sha": "6d5dc459ad9dd2506f9b00f70490c4295c21004d",
            "filename": "packages/next/src/build/templates/edge-app-route.ts",
            "status": "modified",
            "additions": 55,
            "deletions": 4,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-app-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-app-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-app-route.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -1,9 +1,11 @@\n import { setManifestsSingleton } from '../../server/app-render/manifests-singleton'\n+import type { RequestMeta } from '../../server/request-meta'\n import type { EdgeHandler } from '../../server/web/adapter'\n import { EdgeRouteModuleWrapper } from '../../server/web/edge-route-module-wrapper'\n \n // Import the userland code.\n import * as module from 'VAR_USERLAND'\n+import { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\n \n // injected by the loader afterwards.\n \n@@ -22,7 +24,56 @@ if (rscManifest && rscServerManifest) {\n \n export const ComponentMod = module\n \n-const handler: EdgeHandler = EdgeRouteModuleWrapper.wrap(module.routeModule, {\n-  page: 'VAR_PAGE',\n-})\n-export default handler\n+const internalHandler: EdgeHandler = EdgeRouteModuleWrapper.wrap(\n+  module.routeModule,\n+  {\n+    page: 'VAR_PAGE',\n+  }\n+)\n+\n+export async function handler(\n+  request: Request,\n+  ctx: {\n+    waitUntil?: (prom: Promise<void>) => void\n+    signal?: AbortSignal\n+    requestMeta?: RequestMeta\n+  }\n+): Promise<Response> {\n+  const result = await internalHandler({\n+    request: {\n+      url: request.url,\n+      method: request.method,\n+      headers: toNodeOutgoingHttpHeaders(request.headers),\n+      nextConfig: {\n+        basePath: process.env.__NEXT_BASE_PATH,\n+        i18n: process.env.__NEXT_I18N_CONFIG as any,\n+        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n+        experimental: {\n+          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n+          authInterrupts: Boolean(\n+            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n+          ),\n+          clientParamParsingOrigins: process.env\n+            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n+        },\n+      },\n+      page: {\n+        name: 'VAR_PAGE',\n+      },\n+      body:\n+        request.method !== 'GET' && request.method !== 'HEAD'\n+          ? (request.body ?? undefined)\n+          : undefined,\n+      waitUntil: ctx.waitUntil,\n+      requestMeta: ctx.requestMeta,\n+      signal: ctx.signal || new AbortController().signal,\n+    },\n+  })\n+\n+  ctx.waitUntil?.(result.waitUntil)\n+\n+  return result.response\n+}\n+\n+// backwards compat\n+export default internalHandler"
        },
        {
            "sha": "bce4aa65dfaa05ee04c38289fc643ce06182572c",
            "filename": "packages/next/src/build/templates/edge-ssr-app.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 2,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -27,6 +27,8 @@ import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n import { checkIsOnDemandRevalidate } from '../../server/api-utils'\n import { CloseController } from '../../server/web/web-on-close'\n import { parseMaxPostponedStateSize } from '../../shared/lib/size-limit'\n+import { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\n+import type { RequestMeta } from '../../server/request-meta'\n \n declare const incrementalCacheHandler: any\n // OPTIONAL_IMPORT:incrementalCacheHandler\n@@ -359,7 +361,7 @@ async function requestHandler(\n   )\n }\n \n-const handler: EdgeHandler = (opts) => {\n+const internalHandler: EdgeHandler = (opts) => {\n   return adapter({\n     ...opts,\n     IncrementalCache,\n@@ -368,4 +370,50 @@ const handler: EdgeHandler = (opts) => {\n     page: 'VAR_PAGE',\n   })\n }\n-export default handler\n+\n+export async function handler(\n+  request: Request,\n+  ctx: {\n+    waitUntil?: (prom: Promise<void>) => void\n+    signal?: AbortSignal\n+    requestMeta?: RequestMeta\n+  }\n+): Promise<Response> {\n+  const result = await internalHandler({\n+    request: {\n+      url: request.url,\n+      method: request.method,\n+      headers: toNodeOutgoingHttpHeaders(request.headers),\n+      nextConfig: {\n+        basePath: process.env.__NEXT_BASE_PATH,\n+        i18n: process.env.__NEXT_I18N_CONFIG as any,\n+        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n+        experimental: {\n+          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n+          authInterrupts: Boolean(\n+            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n+          ),\n+          clientParamParsingOrigins: process.env\n+            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n+        },\n+      },\n+      page: {\n+        name: 'VAR_PAGE',\n+      },\n+      body:\n+        request.method !== 'GET' && request.method !== 'HEAD'\n+          ? (request.body ?? undefined)\n+          : undefined,\n+      waitUntil: ctx.waitUntil,\n+      requestMeta: ctx.requestMeta,\n+      signal: ctx.signal || new AbortController().signal,\n+    },\n+  })\n+\n+  ctx.waitUntil?.(result.waitUntil)\n+\n+  return result.response\n+}\n+\n+// backwards compat\n+export default internalHandler"
        },
        {
            "sha": "de73a03c0df656c2b6dadcd6603fc5186da7d12b",
            "filename": "packages/next/src/build/templates/edge-ssr.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 2,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -28,6 +28,8 @@ import type { RenderResultMetadata } from '../../server/render-result'\n import { getTracer, SpanKind, type Span } from '../../server/lib/trace/tracer'\n import { BaseServerSpan } from '../../server/lib/trace/constants'\n import { HTML_CONTENT_TYPE_HEADER } from '../../lib/constants'\n+import type { RequestMeta } from '../../server/request-meta'\n+import { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\n \n // injected by the loader afterwards.\n declare const pageRouteModuleOptions: any\n@@ -357,7 +359,7 @@ async function requestHandler(\n   )\n }\n \n-const handler: EdgeHandler = (opts) => {\n+const internalHandler: EdgeHandler = (opts) => {\n   return adapter({\n     ...opts,\n     IncrementalCache,\n@@ -367,4 +369,50 @@ const handler: EdgeHandler = (opts) => {\n     page: 'VAR_DEFINITION_PATHNAME',\n   })\n }\n-export default handler\n+\n+export async function handler(\n+  request: Request,\n+  ctx: {\n+    waitUntil?: (prom: Promise<void>) => void\n+    signal?: AbortSignal\n+    requestMeta?: RequestMeta\n+  }\n+): Promise<Response> {\n+  const result = await internalHandler({\n+    request: {\n+      url: request.url,\n+      method: request.method,\n+      headers: toNodeOutgoingHttpHeaders(request.headers),\n+      nextConfig: {\n+        basePath: process.env.__NEXT_BASE_PATH,\n+        i18n: process.env.__NEXT_I18N_CONFIG as any,\n+        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n+        experimental: {\n+          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n+          authInterrupts: Boolean(\n+            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n+          ),\n+          clientParamParsingOrigins: process.env\n+            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n+        },\n+      },\n+      page: {\n+        name: 'VAR_DEFINITION_PATHNAME',\n+      },\n+      body:\n+        request.method !== 'GET' && request.method !== 'HEAD'\n+          ? (request.body ?? undefined)\n+          : undefined,\n+      waitUntil: ctx.waitUntil,\n+      requestMeta: ctx.requestMeta,\n+      signal: ctx.signal || new AbortController().signal,\n+    },\n+  })\n+\n+  ctx.waitUntil?.(result.waitUntil)\n+\n+  return result.response\n+}\n+\n+// backwards compat\n+export default internalHandler"
        },
        {
            "sha": "2941aa929a0936462a20b8adcc73cc2e1e3921fa",
            "filename": "packages/next/src/build/templates/middleware.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 2,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -8,6 +8,8 @@ import { adapter } from '../../server/web/adapter'\n import * as _mod from 'VAR_USERLAND'\n import { edgeInstrumentationOnRequestError } from '../../server/web/globals'\n import { isNextRouterError } from '../../client/components/is-next-router-error'\n+import { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\n+import type { RequestMeta } from '../../server/request-meta'\n \n const mod = { ..._mod }\n \n@@ -69,11 +71,57 @@ function errorHandledHandler(fn: AdapterOptions['handler']) {\n   }\n }\n \n-const handler: EdgeHandler = (opts) => {\n+const internalHandler: EdgeHandler = (opts) => {\n   return adapter({\n     ...opts,\n     page,\n     handler: errorHandledHandler(handlerUserland),\n   })\n }\n-export default handler\n+\n+export async function handler(\n+  request: Request,\n+  ctx: {\n+    waitUntil?: (prom: Promise<void>) => void\n+    signal?: AbortSignal\n+    requestMeta?: RequestMeta\n+  }\n+): Promise<Response> {\n+  const result = await internalHandler({\n+    request: {\n+      url: request.url,\n+      method: request.method,\n+      headers: toNodeOutgoingHttpHeaders(request.headers),\n+      nextConfig: {\n+        basePath: process.env.__NEXT_BASE_PATH,\n+        i18n: process.env.__NEXT_I18N_CONFIG as any,\n+        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n+        experimental: {\n+          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n+          authInterrupts: Boolean(\n+            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n+          ),\n+          clientParamParsingOrigins: process.env\n+            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n+        },\n+      },\n+      page: {\n+        name: page,\n+      },\n+      body:\n+        request.method !== 'GET' && request.method !== 'HEAD'\n+          ? (request.body ?? undefined)\n+          : undefined,\n+      waitUntil: ctx.waitUntil,\n+      requestMeta: ctx.requestMeta,\n+      signal: ctx.signal || new AbortController().signal,\n+    },\n+  })\n+\n+  ctx.waitUntil?.(result.waitUntil)\n+\n+  return result.response\n+}\n+\n+// backwards compat\n+export default internalHandler"
        },
        {
            "sha": "08915e0d21063f4d276fee9ddd44e42293614292",
            "filename": "packages/next/src/build/templates/pages-api.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-api.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-api.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-api.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -13,7 +13,11 @@ import * as userland from 'VAR_USERLAND'\n import { getTracer, SpanKind } from '../../server/lib/trace/tracer'\n import { BaseServerSpan } from '../../server/lib/trace/constants'\n import type { InstrumentationOnRequestError } from '../../server/instrumentation/types'\n-import { addRequestMeta } from '../../server/request-meta'\n+import {\n+  addRequestMeta,\n+  setRequestMeta,\n+  type RequestMeta,\n+} from '../../server/request-meta'\n \n // Re-export the handler (should be the default export).\n export default hoist(userland, 'default')\n@@ -41,8 +45,12 @@ export async function handler(\n   res: ServerResponse,\n   ctx: {\n     waitUntil?: (prom: Promise<void>) => void\n+    requestMeta?: RequestMeta\n+  }\n+) {\n+  if (ctx.requestMeta) {\n+    setRequestMeta(req, ctx.requestMeta)\n   }\n-): Promise<void> {\n   if (routeModule.isDev) {\n     addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n   }"
        },
        {
            "sha": "6f37b0d2b8a0925d446232df4437223894f07e82",
            "filename": "packages/next/src/build/templates/pages-edge-api.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 2,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-edge-api.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-edge-api.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages-edge-api.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -8,6 +8,8 @@ import { wrapApiHandler } from '../../server/api-utils'\n \n // Import the userland code.\n import handlerUserland from 'VAR_USERLAND'\n+import { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\n+import type { RequestMeta } from '../../server/request-meta'\n \n const page = 'VAR_DEFINITION_PAGE'\n \n@@ -17,12 +19,58 @@ if (typeof handlerUserland !== 'function') {\n   )\n }\n \n-const handler: EdgeHandler = (opts) => {\n+const internalHandler: EdgeHandler = (opts) => {\n   return adapter({\n     ...opts,\n     IncrementalCache,\n     page: 'VAR_DEFINITION_PATHNAME',\n     handler: wrapApiHandler(page, handlerUserland),\n   })\n }\n-export default handler\n+\n+export async function handler(\n+  request: Request,\n+  ctx: {\n+    waitUntil?: (prom: Promise<void>) => void\n+    signal?: AbortSignal\n+    requestMeta?: RequestMeta\n+  }\n+): Promise<Response> {\n+  const result = await internalHandler({\n+    request: {\n+      url: request.url,\n+      method: request.method,\n+      headers: toNodeOutgoingHttpHeaders(request.headers),\n+      nextConfig: {\n+        basePath: process.env.__NEXT_BASE_PATH,\n+        i18n: process.env.__NEXT_I18N_CONFIG as any,\n+        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n+        experimental: {\n+          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n+          authInterrupts: Boolean(\n+            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n+          ),\n+          clientParamParsingOrigins: process.env\n+            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n+        },\n+      },\n+      page: {\n+        name: 'VAR_DEFINITION_PATHNAME',\n+      },\n+      body:\n+        request.method !== 'GET' && request.method !== 'HEAD'\n+          ? (request.body ?? undefined)\n+          : undefined,\n+      waitUntil: ctx.waitUntil,\n+      requestMeta: ctx.requestMeta,\n+      signal: ctx.signal || new AbortController().signal,\n+    },\n+  })\n+\n+  ctx.waitUntil?.(result.waitUntil)\n+\n+  return result.response\n+}\n+\n+// backwards compat\n+export default internalHandler"
        },
        {
            "sha": "0ba5639bb2d9557eb3a09de543fb6b4dd1bcdb31",
            "filename": "packages/next/src/server/request-meta.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -11,11 +11,16 @@ import type {\n import type { PagesDevOverlayBridgeType } from '../next-devtools/userspace/pages/pages-dev-overlay-setup'\n import type { OpaqueFallbackRouteParams } from './request/fallback-params'\n import type { IncrementalCache } from './lib/incremental-cache'\n+import type { NextRequest } from './web/exports'\n \n // FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\n export const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta')\n \n-export type NextIncomingMessage = (BaseNextRequest | IncomingMessage) & {\n+export type NextIncomingMessage = (\n+  | BaseNextRequest\n+  | IncomingMessage\n+  | NextRequest\n+) & {\n   [NEXT_REQUEST_META]?: RequestMeta\n }\n "
        },
        {
            "sha": "8b2524ed51d22c9966293b846c9a17c2d7a781d6",
            "filename": "packages/next/src/server/route-modules/app-page/module.ts",
            "status": "modified",
            "additions": 45,
            "deletions": 1,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-page%2Fmodule.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -1,7 +1,7 @@\n import type { AppPageRouteDefinition } from '../../route-definitions/app-page-route-definition'\n import type RenderResult from '../../render-result'\n import type { RenderOpts } from '../../app-render/types'\n-import type { NextParsedUrlQuery } from '../../request-meta'\n+import { addRequestMeta, type NextParsedUrlQuery } from '../../request-meta'\n import type { LoaderTree } from '../../lib/app-dir-module'\n import type { PrerenderManifest } from '../../../build'\n \n@@ -28,6 +28,10 @@ import {\n   RSC_HEADER,\n } from '../../../client/components/app-router-headers'\n import { isInterceptionRouteAppPath } from '../../../shared/lib/router/utils/interception-routes'\n+import { RSCPathnameNormalizer } from '../../normalizers/request/rsc'\n+import { SegmentPrefixRSCPathnameNormalizer } from '../../normalizers/request/segment-prefix-rsc'\n+import type { UrlWithParsedQuery } from 'url'\n+import type { IncomingMessage } from 'http'\n \n let vendoredReactRSC\n let vendoredReactSSR\n@@ -100,6 +104,46 @@ export class AppPageRouteModule extends RouteModule<\n     return matcher.match(pathname)\n   }\n \n+  private normalizers = {\n+    rsc: new RSCPathnameNormalizer(),\n+    segmentPrefetchRSC: new SegmentPrefixRSCPathnameNormalizer(),\n+  }\n+\n+  public normalizeUrl(\n+    req: IncomingMessage | BaseNextRequest,\n+    parsedUrl: UrlWithParsedQuery\n+  ) {\n+    if (this.normalizers.segmentPrefetchRSC.match(parsedUrl.pathname || '/')) {\n+      const result = this.normalizers.segmentPrefetchRSC.extract(\n+        parsedUrl.pathname || '/'\n+      )\n+      if (!result) return false\n+\n+      const { originalPathname, segmentPath } = result\n+      parsedUrl.pathname = originalPathname\n+\n+      // Mark the request as a router prefetch request.\n+      req.headers[RSC_HEADER] = '1'\n+      req.headers[NEXT_ROUTER_PREFETCH_HEADER] = '1'\n+      req.headers[NEXT_ROUTER_SEGMENT_PREFETCH_HEADER] = segmentPath\n+\n+      addRequestMeta(req, 'isRSCRequest', true)\n+      addRequestMeta(req, 'isPrefetchRSCRequest', true)\n+      addRequestMeta(req, 'segmentPrefetchRSCRequest', segmentPath)\n+    } else if (this.normalizers.rsc.match(parsedUrl.pathname || '/')) {\n+      parsedUrl.pathname = this.normalizers.rsc.normalize(\n+        parsedUrl.pathname || '/',\n+        true\n+      )\n+\n+      // Mark the request as a RSC request.\n+      req.headers[RSC_HEADER] = '1'\n+      addRequestMeta(req, 'isRSCRequest', true)\n+    } else {\n+      super.normalizeUrl(req, parsedUrl)\n+    }\n+  }\n+\n   public render(\n     req: BaseNextRequest,\n     res: BaseNextResponse,"
        },
        {
            "sha": "f6a81000e386408f5f46a48a67a139867724d495",
            "filename": "packages/next/src/server/route-modules/pages/pages-handler.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -4,7 +4,12 @@ import { RouteKind } from '../../route-kind'\n import { BaseServerSpan } from '../../lib/trace/constants'\n import { getTracer, SpanKind, type Span } from '../../lib/trace/tracer'\n import { formatUrl } from '../../../shared/lib/router/utils/format-url'\n-import { addRequestMeta, getRequestMeta } from '../../request-meta'\n+import {\n+  addRequestMeta,\n+  getRequestMeta,\n+  setRequestMeta,\n+  type RequestMeta,\n+} from '../../request-meta'\n import { interopDefault } from '../../app-render/interop-default'\n import { getRevalidateReason } from '../../instrumentation/utils'\n import { normalizeDataPath } from '../../../shared/lib/page-path/normalize-data-path'\n@@ -67,9 +72,13 @@ export const getHandler = ({\n     req: IncomingMessage,\n     res: ServerResponse,\n     ctx: {\n-      waitUntil: (prom: Promise<void>) => void\n+      waitUntil?: (prom: Promise<void>) => void\n+      requestMeta?: RequestMeta\n+    }\n+  ) {\n+    if (ctx.requestMeta) {\n+      setRequestMeta(req, ctx.requestMeta)\n     }\n-  ): Promise<void> {\n     if (routeModule.isDev) {\n       addRequestMeta(\n         req,"
        },
        {
            "sha": "7110a2fa6a861982e3681802f315b1db2c13b5a8",
            "filename": "packages/next/src/server/route-modules/route-module.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -141,6 +141,11 @@ export abstract class RouteModule<\n     this.relativeProjectDir = relativeProjectDir\n   }\n \n+  public normalizeUrl(\n+    _req: IncomingMessage | BaseNextRequest,\n+    _parsedUrl: UrlWithParsedQuery\n+  ) {}\n+\n   public async instrumentationOnRequestError(\n     req: IncomingMessage | BaseNextRequest,\n     ...args: Parameters<InstrumentationOnRequestError>\n@@ -641,6 +646,7 @@ export abstract class RouteModule<\n       isNextDataRequest = true\n       parsedUrl.pathname = normalizeDataPath(parsedUrl.pathname || '/')\n     }\n+    this.normalizeUrl(req, parsedUrl)\n     let originalPathname = parsedUrl.pathname || '/'\n     const originalQuery = { ...parsedUrl.query }\n     const pageIsDynamic = isDynamicRoute(srcPage)\n@@ -684,9 +690,15 @@ export abstract class RouteModule<\n       getHostname(parsedUrl, req.headers),\n       detectedLocale\n     )\n-    addRequestMeta(req, 'isLocaleDomain', Boolean(domainLocale))\n \n-    const defaultLocale = domainLocale?.defaultLocale || i18n?.defaultLocale\n+    if (Boolean(domainLocale)) {\n+      addRequestMeta(req, 'isLocaleDomain', Boolean(domainLocale))\n+    }\n+\n+    const defaultLocale =\n+      getRequestMeta(req, 'defaultLocale') ||\n+      domainLocale?.defaultLocale ||\n+      i18n?.defaultLocale\n \n     // Ensure parsedUrl.pathname includes locale before processing\n     // rewrites or they won't match correctly."
        },
        {
            "sha": "3ebd3ec1b1ee3751ed6df3e2b2d6d9f7d66d296d",
            "filename": "packages/next/src/server/web/adapter.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fadapter.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fadapter.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fadapter.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -35,6 +35,7 @@ import { CloseController } from './web-on-close'\n import { getEdgePreviewProps } from './get-edge-preview-props'\n import { getBuiltinRequestContext } from '../after/builtin-request-context'\n import { getImplicitTags } from '../lib/implicit-tags'\n+import { setRequestMeta } from '../request-meta'\n \n export class NextRequestHint extends NextRequest {\n   sourcePage: string\n@@ -187,6 +188,10 @@ export async function adapter(\n     },\n   })\n \n+  if (params.request.requestMeta) {\n+    setRequestMeta(request, params.request.requestMeta)\n+  }\n+\n   /**\n    * This allows to identify the request as a data request. The user doesn't\n    * need to know about this property neither use it. We add it for testing"
        },
        {
            "sha": "96e2138d58fc1356bb8fd40b82ca6e9004ccd88d",
            "filename": "packages/next/src/server/web/types.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -5,6 +5,7 @@ import type { NextResponse } from './spec-extension/response'\n import type { CloneableBody } from '../body-streams'\n import type { OutgoingHttpHeaders } from 'http'\n import type { FetchMetrics } from '../base-http'\n+import type { RequestMeta } from '../request-meta'\n \n /**\n  * @deprecated Use `ProxyConfig` instead. Middleware has been renamed to Proxy.\n@@ -32,6 +33,7 @@ export interface RequestData {\n   url: string\n   body?: ReadableStream<Uint8Array>\n   signal: AbortSignal\n+  requestMeta?: RequestMeta\n   /** passed in when running in edge runtime sandbox */\n   waitUntil?: (promise: Promise<any>) => void\n }"
        },
        {
            "sha": "8719f05bda59b135948a659c2655a91e5f439440",
            "filename": "test/production/adapter-config/adapter-config-export.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -88,6 +88,7 @@ describe('adapter-config export', () => {\n       onMatch: expect.toBeArray(),\n       fallback: expect.toBeArray(),\n       shouldNormalizeNextData: expect.toBeBoolean(),\n+      rsc: expect.toBeObject(),\n     })\n   })\n })"
        },
        {
            "sha": "e675b29486e9d321983569c6526028c8c6c462d2",
            "filename": "test/production/adapter-config/adapter-config.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/586c1ed7f88045415691b26f9fb549d47c4062d8/test%2Fproduction%2Fadapter-config%2Fadapter-config.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/586c1ed7f88045415691b26f9fb549d47c4062d8/test%2Fproduction%2Fadapter-config%2Fadapter-config.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fadapter-config.test.ts?ref=586c1ed7f88045415691b26f9fb549d47c4062d8",
            "patch": "@@ -217,6 +217,7 @@ describe('adapter-config', () => {\n       onMatch: expect.toBeArray(),\n       fallback: expect.toBeArray(),\n       shouldNormalizeNextData: expect.toBeBoolean(),\n+      rsc: expect.toBeObject(),\n     })\n   })\n })"
        }
    ],
    "stats": {
        "total": 502,
        "additions": 465,
        "deletions": 37
    }
}