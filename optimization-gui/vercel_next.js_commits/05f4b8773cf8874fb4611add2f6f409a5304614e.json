{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in pages/ error-recovery test (#76348)",
    "sha": "05f4b8773cf8874fb4611add2f6f409a5304614e",
    "files": [
        {
            "sha": "729a695b8ed299e4a9537ed6a73e6345b72f0fae",
            "filename": "test/development/acceptance/__snapshots__/error-recovery.test.ts.snap",
            "status": "removed",
            "additions": 0,
            "deletions": 25,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/49c26c7b4b05c988def6806473c9b524d33b8dbd/test%2Fdevelopment%2Facceptance%2F__snapshots__%2Ferror-recovery.test.ts.snap",
            "raw_url": "https://github.com/vercel/next.js/raw/49c26c7b4b05c988def6806473c9b524d33b8dbd/test%2Fdevelopment%2Facceptance%2F__snapshots__%2Ferror-recovery.test.ts.snap",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2F__snapshots__%2Ferror-recovery.test.ts.snap?ref=49c26c7b4b05c988def6806473c9b524d33b8dbd",
            "patch": "@@ -1,25 +0,0 @@\n-// Jest Snapshot v1, https://goo.gl/fbAQLP\n-\n-exports[`ReactRefreshLogBox default syntax > runtime error 1`] = `\n-\"index.js (5:9) @ eval\n-\n-  3 | setInterval(() => {\n-  4 |   i++\n-> 5 |   throw Error('no ' + i)\n-    |         ^\n-  6 | }, 1000)\n-  7 | export default function FunctionNamed() {\n-  8 |   return <div />\"\n-`;\n-\n-exports[`ReactRefreshLogBox turbo syntax > runtime error 1`] = `\n-\"index.js (5:9) @ eval\n-\n-  3 | setInterval(() => {\n-  4 |   i++\n-> 5 |   throw Error('no ' + i)\n-    |         ^\n-  6 | }, 1000)\n-  7 | export default function FunctionNamed() {\n-  8 |   return <div />\"\n-`;"
        },
        {
            "sha": "681e6241abf31dbc389f6394a1d65217fdda93e2",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 343,
            "deletions": 115,
            "changes": 458,
            "blob_url": "https://github.com/vercel/next.js/blob/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=05f4b8773cf8874fb4611add2f6f409a5304614e",
            "patch": "@@ -1,19 +1,21 @@\n /* eslint-env jest */\n import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n-import { check, describeVariants as describe, retry } from 'next-test-utils'\n+import { check, retry } from 'next-test-utils'\n import { outdent } from 'outdent'\n import path from 'path'\n \n-describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n+const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+\n+describe('pages/ error recovery', () => {\n   const { next, isTurbopack } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n     skipStart: true,\n   })\n \n   test('logbox: can recover from a syntax error without losing state', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'index.js',\n@@ -40,10 +42,41 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n \n     await session.patch('index.js', `export default () => <div/`)\n \n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxSource()).toInclude(\n-      'export default () => <div/'\n-    )\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Parsing ecmascript source code failed\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (1:27)\n+       Parsing ecmascript source code failed\n+       > 1 | export default () => <div/\n+           |                           ^\",\n+         \"stack\": [],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x Unexpected eof\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+       Error:   x Unexpected eof\n+          ,----\n+        1 | export default () => <div/\n+          \\`----\n+       Caused by:\n+           Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n+    }\n \n     await session.patch(\n       'index.js',\n@@ -73,7 +106,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n \n   test('logbox: can recover from a event handler error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'index.js',\n@@ -104,32 +137,22 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n       await session.evaluate(() => document.querySelector('p').textContent)\n     ).toBe('1')\n \n-    await session.assertHasRedbox()\n-    if (isTurbopack) {\n-      expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"index.js (7:11) @ Index.useCallback[increment]\n-\n-           5 |   const increment = useCallback(() => {\n-           6 |     setCount(c => c + 1)\n-        >  7 |     throw new Error('oops')\n-             |           ^\n-           8 |   }, [setCount])\n-           9 |   return (\n-          10 |     <main>\"\n-      `)\n-    } else {\n-      expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"index.js (7:11) @ Index.useCallback[increment]\n-\n-           5 |   const increment = useCallback(() => {\n-           6 |     setCount(c => c + 1)\n-        >  7 |     throw new Error('oops')\n-             |           ^\n-           8 |   }, [setCount])\n-           9 |   return (\n-          10 |     <main>\"\n-      `)\n-    }\n+    await expect(browser).toDisplayRedbox(`\n+     {\n+       \"count\": 1,\n+       \"description\": \"Error: oops\",\n+       \"environmentLabel\": null,\n+       \"label\": \"Unhandled Runtime Error\",\n+       \"source\": \"index.js (7:11) @ Index.useCallback[increment]\n+     >  7 |     throw new Error('oops')\n+          |           ^\",\n+       \"stack\": [\n+         \"Index.useCallback[increment] index.js (7:11)\",\n+         \"UtilityScript.evaluate <anonymous> (236:17)\",\n+         \"UtilityScript.<anonymous> <anonymous> (1:44)\",\n+       ],\n+     }\n+    `)\n     await session.patch(\n       'index.js',\n       outdent`\n@@ -163,7 +186,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n \n   test('logbox: can recover from a component error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.write(\n       'child.js',\n@@ -203,10 +226,44 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n       `\n     )\n \n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxSource()).toInclude(\n-      'export default function Child()'\n-    )\n+    // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n+    if (isReact18) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 2,\n+         \"description\": \"Error: oops\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"child.js (3:9) @ Child\n+       > 3 |   throw new Error('oops')\n+           |         ^\",\n+         \"stack\": [\n+           \"Child child.js (3:9)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: oops\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"child.js (3:9) @ Child\n+       > 3 |   throw new Error('oops')\n+           |         ^\",\n+         \"stack\": [\n+           \"Child child.js (3:9)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    }\n \n     const didNotReload = await session.patch(\n       'child.js',\n@@ -225,9 +282,9 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n   })\n \n   // https://github.com/pmmmwh/react-refresh-webpack-plugin/pull/3#issuecomment-554137262\n-  test('render error not shown right after syntax error', async () => {\n+  it('render error not shown right after syntax error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     // Starting here:\n     await session.patch(\n@@ -263,7 +320,48 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         export default ClassDefault;\n       `\n     )\n-    await session.assertHasRedbox()\n+\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Parsing ecmascript source code failed\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (5:5)\n+       Parsing ecmascript source code failed\n+       > 5 |     return <h1>Default Export</h1>;\n+           |     ^^^^^^\",\n+         \"stack\": [],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x Expected '{', got 'return'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+       Error:   x Expected '{', got 'return'\n+          ,-[5:1]\n+        2 | \n+        3 | class ClassDefault extends React.Component {\n+        4 |   render()\n+        5 |     return <h1>Default Export</h1>;\n+          :     ^^^^^^\n+        6 |   }\n+        7 | }\n+          \\`----\n+       Caused by:\n+           Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n+    }\n \n     // Now change the code to introduce a runtime error without fixing the syntax error:\n     await session.patch(\n@@ -281,7 +379,49 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         export default ClassDefault;\n       `\n     )\n-    await session.assertHasRedbox()\n+\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Parsing ecmascript source code failed\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (5:5)\n+       Parsing ecmascript source code failed\n+       > 5 |     throw new Error('nooo');\n+           |     ^^^^^\",\n+         \"stack\": [],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x Expected '{', got 'throw'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+       Error:   x Expected '{', got 'throw'\n+          ,-[5:1]\n+        2 | \n+        3 | class ClassDefault extends React.Component {\n+        4 |   render()\n+        5 |     throw new Error('nooo');\n+          :     ^^^^^\n+        6 |     return <h1>Default Export</h1>;\n+        7 |   }\n+        8 | }\n+          \\`----\n+       Caused by:\n+           Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n+    }\n \n     // Now fix the syntax error:\n     await session.patch(\n@@ -299,22 +439,56 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         export default ClassDefault;\n       `\n     )\n-    await session.assertHasRedbox()\n \n     // wait for patch to get applied\n     await retry(async () => {\n       await expect(session.getRedboxSource()).resolves.toInclude('render() {')\n     })\n \n-    expect(await session.getRedboxSource()).toInclude(\n-      \"throw new Error('nooo');\"\n-    )\n+    // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n+    if (isReact18) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 2,\n+         \"description\": \"Error: nooo\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"index.js (5:11) @ ClassDefault.render\n+       > 5 |     throw new Error('nooo');\n+           |           ^\",\n+         \"stack\": [\n+           \"ClassDefault.render index.js (5:11)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: nooo\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"index.js (5:11) @ ClassDefault.render\n+       > 5 |     throw new Error('nooo');\n+           |           ^\",\n+         \"stack\": [\n+           \"ClassDefault.render index.js (5:11)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    }\n   })\n \n   // https://github.com/pmmmwh/react-refresh-webpack-plugin/pull/3#issuecomment-554144016\n-  test('stuck error', async () => {\n+  it('stuck error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     // We start here.\n     await session.patch(\n@@ -355,10 +529,44 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     )\n \n     // We get an error because Foo didn't import React. Fair.\n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxSource()).toInclude(\n-      \"return React.createElement('h1', null, 'Foo');\"\n-    )\n+    // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n+    if (isReact18) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 2,\n+         \"description\": \"ReferenceError: React is not defined\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"Foo.js (3:3) @ Foo\n+       > 3 |   return React.createElement('h1', null, 'Foo');\n+           |   ^\",\n+         \"stack\": [\n+           \"Foo Foo.js (3:3)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"ReferenceError: React is not defined\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"Foo.js (3:3) @ Foo\n+       > 3 |   return React.createElement('h1', null, 'Foo');\n+           |   ^\",\n+         \"stack\": [\n+           \"Foo Foo.js (3:3)\",\n+           \"Set.forEach <anonymous> (0:0)\",\n+           \"<FIXME-file-protocol>\",\n+           \"<FIXME-file-protocol>\",\n+         ],\n+       }\n+      `)\n+    }\n \n     // Let's add that to Foo.\n     await session.patch(\n@@ -378,7 +586,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n   // https://github.com/pmmmwh/react-refresh-webpack-plugin/pull/3#issuecomment-554150098\n   test('syntax > runtime error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     // Start here.\n     await session.patch(\n@@ -406,14 +614,22 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         }\n       `\n     )\n-\n     await new Promise((resolve) => setTimeout(resolve, 1000))\n-    await session.assertHasRedbox()\n-    if (process.platform === 'win32') {\n-      expect(await session.getRedboxSource()).toMatchSnapshot()\n-    } else {\n-      expect(await session.getRedboxSource()).toMatchSnapshot()\n-    }\n+\n+    await expect(browser).toDisplayRedbox(`\n+     {\n+       \"count\": 1,\n+       \"description\": \"Error: no 1\",\n+       \"environmentLabel\": null,\n+       \"label\": \"Unhandled Runtime Error\",\n+       \"source\": \"index.js (5:9) @ eval\n+     > 5 |   throw Error('no ' + i)\n+         |         ^\",\n+       \"stack\": [\n+         \"eval index.js (5:9)\",\n+       ],\n+     }\n+    `)\n \n     // Make a syntax error.\n     await session.patch(\n@@ -429,78 +645,90 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     )\n \n     await new Promise((resolve) => setTimeout(resolve, 1000))\n-    await session.assertHasRedbox()\n-    let redboxSource = next.normalizeTestDirContent(\n-      await session.getRedboxSource()\n-    )\n \n     if (isTurbopack) {\n       // TODO: Remove this branching once import traces are implemented in Turbopack\n-      expect(redboxSource).toMatchInlineSnapshot(`\n-       \"./index.js (7:41)\n+\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Parsing ecmascript source code failed\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (7:41)\n        Parsing ecmascript source code failed\n-         5 |   throw Error('no ' + i)\n-         6 | }, 1000)\n        > 7 | export default function FunctionNamed() {\n-           |                                         ^\n-\n-       Expected '}', got '<eof>'\"\n+           |                                         ^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(redboxSource).toMatchInlineSnapshot(`\n-        \"./index.js\n-        Error:   x Expected '}', got '<eof>'\n-           ,-[7:1]\n-         4 |   i++\n-         5 |   throw Error('no ' + i)\n-         6 | }, 1000)\n-         7 | export default function FunctionNamed() {\n-           :                                         ^\n-           \\`----\n-\n-        Caused by:\n-            Syntax Error\n-\n-        Import trace for requested module:\n-        ./index.js\n-        ./pages/index.js\"\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x Expected '}', got '<eof>'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+       Error:   x Expected '}', got '<eof>'\n+          ,-[7:1]\n+        4 |   i++\n+        5 |   throw Error('no ' + i)\n+        6 | }, 1000)\n+        7 | export default function FunctionNamed() {\n+          :                                         ^\n+          \\`----\n+       Caused by:\n+           Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n \n     // Test that runtime error does not take over:\n     await new Promise((resolve) => setTimeout(resolve, 2000))\n-    await session.assertHasRedbox()\n-    redboxSource = next.normalizeTestDirContent(await session.getRedboxSource())\n+\n     if (isTurbopack) {\n       // TODO: Remove this branching once import traces are implemented in Turbopack\n-      expect(redboxSource).toMatchInlineSnapshot(`\n-       \"./index.js (7:41)\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Parsing ecmascript source code failed\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (7:41)\n        Parsing ecmascript source code failed\n-         5 |   throw Error('no ' + i)\n-         6 | }, 1000)\n        > 7 | export default function FunctionNamed() {\n-           |                                         ^\n-\n-       Expected '}', got '<eof>'\"\n+           |                                         ^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(redboxSource).toMatchInlineSnapshot(`\n-        \"./index.js\n-        Error:   x Expected '}', got '<eof>'\n-           ,-[7:1]\n-         4 |   i++\n-         5 |   throw Error('no ' + i)\n-         6 | }, 1000)\n-         7 | export default function FunctionNamed() {\n-           :                                         ^\n-           \\`----\n-\n-        Caused by:\n-            Syntax Error\n-\n-        Import trace for requested module:\n-        ./index.js\n-        ./pages/index.js\"\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x Expected '}', got '<eof>'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+       Error:   x Expected '}', got '<eof>'\n+          ,-[7:1]\n+        4 |   i++\n+        5 |   throw Error('no ' + i)\n+        6 | }, 1000)\n+        7 | export default function FunctionNamed() {\n+          :                                         ^\n+          \\`----\n+       Caused by:\n+           Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n   })"
        },
        {
            "sha": "fce815a1587d71a80cb642a09676381320409309",
            "filename": "test/e2e/app-dir/non-root-project-monorepo/non-root-project-monorepo.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 17,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts?ref=05f4b8773cf8874fb4611add2f6f409a5304614e",
            "patch": "@@ -86,13 +86,7 @@ describe('non-root-project-monorepo', () => {\n         if (stack === null) {\n           return null\n         }\n-        const isolatedPath = /file:\\/\\/.*\\/next-install-[^/]+\\//g\n-        const nonIsolatedPath =\n-          /file:\\/\\/.*\\/test\\/e2e\\/app-dir\\/non-root-project-monorepo\\//g\n-        return stack\n-          .join('\\n')\n-          .replaceAll(nonIsolatedPath, 'file://<full-path>/')\n-          .replaceAll(isolatedPath, 'file://<full-path>/')\n+        return stack.join('\\n')\n       }\n \n       it('should work on RSC', async () => {\n@@ -134,8 +128,8 @@ describe('non-root-project-monorepo', () => {\n           expect(normalizeStackTrace(await getRedboxCallStack(browser)))\n             .toMatchInlineSnapshot(`\n            \"eval app/separate-file.ts (1:11)\n-           <unknown> rsc)/./app/separate-file.ts (rsc://React/Server/file://<full-path>/apps/web/.next/server/app/source-maps-rsc/page.js?3 (63:1)\n-           __webpack_require__ rsc:/Server/file://<full-path>/apps/web/.next/server/webpack-runtime.js (33:42)\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n            innerArrowFunction app/source-maps-rsc/page.tsx (14:3)\n            innerFunction app/source-maps-rsc/page.tsx (10:3)\n            Page app/source-maps-rsc/page.tsx (4:5)\"\n@@ -177,10 +171,10 @@ describe('non-root-project-monorepo', () => {\n           expect(normalizeStackTrace(await getRedboxCallStack(browser)))\n             .toMatchInlineSnapshot(`\n            \"eval app/separate-file.ts (1:7)\n-           ./app/separate-file.ts file://<full-path>/apps/web/.next/static/chunks/app/source-maps-ssr/page.js (49:1)\n-           options.factory file://<full-path>/apps/web/.next/static/chunks/webpack.js (700:31)\n-           __webpack_require__ file://<full-path>/apps/web/.next/static/chunks/webpack.js (37:33)\n-           fn file://<full-path>/apps/web/.next/static/chunks/webpack.js (357:21)\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n            innerArrowFunction app/source-maps-ssr/page.tsx (16:3)\n            innerFunction app/source-maps-ssr/page.tsx (12:3)\n            Page app/source-maps-ssr/page.tsx (6:5)\"\n@@ -222,10 +216,10 @@ describe('non-root-project-monorepo', () => {\n           expect(normalizeStackTrace(await getRedboxCallStack(browser)))\n             .toMatchInlineSnapshot(`\n            \"eval app/separate-file.ts (1:7)\n-           ./app/separate-file.ts file://<full-path>/apps/web/.next/static/chunks/app/source-maps-client/page.js (49:1)\n-           options.factory file://<full-path>/apps/web/.next/static/chunks/webpack.js (712:31)\n-           __webpack_require__ file://<full-path>/apps/web/.next/static/chunks/webpack.js (37:33)\n-           fn file://<full-path>/apps/web/.next/static/chunks/webpack.js (369:21)\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n+           <FIXME-file-protocol>\n            innerArrowFunction app/source-maps-client/page.tsx (17:3)\n            innerFunction app/source-maps-client/page.tsx (13:3)\n            effectCallback app/source-maps-client/page.tsx (7:5)\""
        },
        {
            "sha": "3ae9bd6ccfd131ebd57bc5eb505380824ec49d30",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/05f4b8773cf8874fb4611add2f6f409a5304614e/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=05f4b8773cf8874fb4611add2f6f409a5304614e",
            "patch": "@@ -1417,6 +1417,8 @@ export async function getRedboxCallStack(\n             stack.push('<FIXME-internal-frame>')\n           }\n           foundInternalFrame = true\n+        } else if (frame.includes('file://')) {\n+          stack.push('<FIXME-file-protocol>')\n         } else {\n           stack.push(frame)\n         }"
        }
    ],
    "stats": {
        "total": 513,
        "additions": 356,
        "deletions": 157
    }
}