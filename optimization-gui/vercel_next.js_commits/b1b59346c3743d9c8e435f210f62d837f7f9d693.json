{
    "author": "icyJoseph",
    "message": "docs: use cache private redo (#87111)",
    "sha": "b1b59346c3743d9c8e435f210f62d837f7f9d693",
    "files": [
        {
            "sha": "00ffe1398201e6233296a0722c159279ab8ba23c",
            "filename": "docs/01-app/03-api-reference/01-directives/use-cache-private.mdx",
            "status": "modified",
            "additions": 31,
            "deletions": 7,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/b1b59346c3743d9c8e435f210f62d837f7f9d693/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b1b59346c3743d9c8e435f210f62d837f7f9d693/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx?ref=b1b59346c3743d9c8e435f210f62d837f7f9d693",
            "patch": "@@ -1,21 +1,31 @@\n ---\n title: 'use cache: private'\n-description: 'Learn how to use the `\"use cache: private\"` directive to enable runtime prefetching of personalized content in your Next.js application.'\n+description: 'Learn how to use the \"use cache: private\" directive to cache functions that access runtime request APIs.'\n+version: experimental\n related:\n   title: Related\n   description: View related API references.\n   links:\n     - app/api-reference/directives/use-cache\n     - app/api-reference/config/next-config-js/cacheComponents\n-    - app/api-reference/config/next-config-js/cacheHandlers\n     - app/api-reference/functions/cacheLife\n     - app/api-reference/functions/cacheTag\n-    - app/guides/prefetching\n ---\n \n-The `'use cache: private'` directive works just like [`use cache`](/docs/app/api-reference/directives/use-cache), but allows you to use runtime APIs like cookies, headers, or search params.\n+The `'use cache: private'` directive allows functions to access runtime request APIs like `cookies()`, `headers()`, and `searchParams` within a cached scope. However, results are **never stored on the server**, they're cached only in the browser's memory and do not persist across page reloads.\n \n-> **Good to know:** Unlike `use cache`, private caches are not prerendered statically as they contain personalized data that is not shared between users.\n+Reach for `'use cache: private'` when:\n+\n+- You want to cache a function that already accesses runtime data, and refactoring to [move the runtime access outside and pass values as arguments](/docs/app/getting-started/cache-components#with-runtime-data) is not practical.\n+- Compliance requirements prevent storing certain data on the server, even temporarily\n+\n+Because this directive accesses runtime data, the function executes on every server render and is excluded from running during [static shell](/docs/app/getting-started/cache-components#how-rendering-works-with-cache-components) generation.\n+\n+It is **not** possible to configure custom cache handlers for `'use cache: private'`.\n+\n+For a comparison of the different cache directives, see [How `use cache: remote` differs from `use cache` and `use cache: private`](/docs/app/api-reference/directives/use-cache-remote#how-use-cache-remote-differs-from-use-cache-and-use-cache-private).\n+\n+> **Good to know**: This directive is marked as `experimental` because it depends on runtime prefetching, which is not yet stable. Runtime prefetching is an upcoming feature that will let the router prefetch past the [static shell](/docs/app/getting-started/cache-components#how-rendering-works-with-cache-components) into **any** cached scope, not just private caches.\n \n ## Usage\n \n@@ -42,13 +52,21 @@ export default nextConfig\n \n Then add `'use cache: private'` to your function along with a `cacheLife` configuration.\n \n+> **Good to know**: This directive is not available in Route Handlers.\n+\n ### Basic example\n \n+In this example, we demonstrate that you can access cookies within a `'use cache: private'` scope:\n+\n ```tsx filename=\"app/product/[id]/page.tsx\" switcher\n import { Suspense } from 'react'\n import { cookies } from 'next/headers'\n import { cacheLife, cacheTag } from 'next/cache'\n \n+export async function generateStaticParams() {\n+  return [{ id: '1' }]\n+}\n+\n export default async function ProductPage({\n   params,\n }: {\n@@ -81,7 +99,7 @@ async function Recommendations({ productId }: { productId: string }) {\n async function getRecommendations(productId: string) {\n   'use cache: private'\n   cacheTag(`recommendations-${productId}`)\n-  cacheLife({ stale: 60 }) // Minimum 30 seconds required for runtime prefetch\n+  cacheLife({ stale: 60 })\n \n   // Access cookies within private cache functions\n   const sessionId = (await cookies()).get('session-id')?.value || 'guest'\n@@ -95,6 +113,10 @@ import { Suspense } from 'react'\n import { cookies } from 'next/headers'\n import { cacheLife, cacheTag } from 'next/cache'\n \n+export async function generateStaticParams() {\n+  return [{ id: '1' }]\n+}\n+\n export default async function ProductPage({ params }) {\n   const { id } = await params\n \n@@ -123,7 +145,7 @@ async function Recommendations({ productId }) {\n async function getRecommendations(productId) {\n   'use cache: private'\n   cacheTag(`recommendations-${productId}`)\n-  cacheLife({ stale: 60 }) // Minimum 30 seconds required for runtime prefetch\n+  cacheLife({ stale: 60 })\n \n   // Access cookies within private cache functions\n   const sessionId = (await cookies()).get('session-id')?.value || 'guest'\n@@ -132,6 +154,8 @@ async function getRecommendations(productId) {\n }\n ```\n \n+> **Good to know**: The `stale` time must be at least 30 seconds for runtime prefetching to work. See [`cacheLife` client router cache behavior](/docs/app/api-reference/functions/cacheLife#client-router-cache-behavior) for details.\n+\n ## Request APIs allowed in private caches\n \n The following request-specific APIs can be used inside `'use cache: private'` functions:"
        },
        {
            "sha": "d75de012f1349c1a89af0d6812725bbb10c26bab",
            "filename": "docs/01-app/03-api-reference/01-directives/use-cache.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b1b59346c3743d9c8e435f210f62d837f7f9d693/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b1b59346c3743d9c8e435f210f62d837f7f9d693/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache.mdx?ref=b1b59346c3743d9c8e435f210f62d837f7f9d693",
            "patch": "@@ -1,6 +1,6 @@\n ---\n title: use cache\n-description: Learn how to use the use cache directive to cache data in your Next.js application.\n+description: Learn how to use the \"use cache\" directive to cache data in your Next.js application.\n related:\n   title: Related\n   description: View related API references."
        }
    ],
    "stats": {
        "total": 40,
        "additions": 32,
        "deletions": 8
    }
}