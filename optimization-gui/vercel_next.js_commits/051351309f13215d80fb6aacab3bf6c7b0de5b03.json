{
    "author": "greguintow",
    "message": "Fix build compile mode if pages dir does not exist in Next.js 16 (#84783)\n\n## Fixing a bug\n\n### What?\n\nFixes `next build --experimental-build-mode=compile` for standalone\noutput when there is no pages directory (app-dir only projects) in Next\n16.\n\n### Why?\n\nWhen building a Next.js 16 application with:\n- `output: 'standalone'` configuration\n- App Router only (no Pages Router)\n- Compile mode enabled\n\nThe build would fail because the standalone directory writing logic\nattempted to recursively copy a non-existent `pages` directory. This\ncaused build failures for app-only projects using standalone output.\n\n### How?\n\nAdded an existence check (`existsSync`) before attempting to copy the\npages directory to the standalone output, similar to the existing check\nfor the app directory. This allows the build to proceed successfully\nwhen there is no pages directory.\n\n**Testing:**\n\n**Before**\n\n<img width=\"1078\" height=\"383\" alt=\"image\"\nsrc=\"https://github.com/user-attachments/assets/bdf74165-af4d-462e-aa34-bf75a4532aa0\"\n/>\n\n**After**\n\n<img width=\"975\" height=\"323\" alt=\"image\"\nsrc=\"https://github.com/user-attachments/assets/a4708f12-940d-4304-af3f-ed246c963f8c\"\n/>\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "051351309f13215d80fb6aacab3bf6c7b0de5b03",
    "files": [
        {
            "sha": "a895177b858afcb7adb423c900449816211cde8d",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 11,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/051351309f13215d80fb6aacab3bf6c7b0de5b03/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/051351309f13215d80fb6aacab3bf6c7b0de5b03/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=051351309f13215d80fb6aacab3bf6c7b0de5b03",
            "patch": "@@ -765,17 +765,22 @@ async function writeStandaloneDirectory(\n         )\n       }\n \n-      await recursiveCopy(\n-        path.join(distDir, SERVER_DIRECTORY, 'pages'),\n-        path.join(\n-          distDir,\n-          STANDALONE_DIRECTORY,\n-          path.relative(outputFileTracingRoot, distDir),\n-          SERVER_DIRECTORY,\n-          'pages'\n-        ),\n-        { overwrite: true }\n-      )\n+      const originalPagesDir = path.join(distDir, SERVER_DIRECTORY, 'pages')\n+\n+      if (existsSync(originalPagesDir)) {\n+        await recursiveCopy(\n+          originalPagesDir,\n+          path.join(\n+            distDir,\n+            STANDALONE_DIRECTORY,\n+            path.relative(outputFileTracingRoot, distDir),\n+            SERVER_DIRECTORY,\n+            'pages'\n+          ),\n+          { overwrite: true }\n+        )\n+      }\n+\n       if (appDir) {\n         const originalServerApp = path.join(distDir, SERVER_DIRECTORY, 'app')\n         if (existsSync(originalServerApp)) {"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 16,
        "deletions": 11
    }
}