{
    "author": "kdy1",
    "message": "fix(turbopack): Apply `hygiene` if mangling is disabled (#77815)\n\n### What?\n\nApply the normal variable renamer when we are not going to apply minfiying var renamer.\n\n### Why?\n\nVar renamer should be applied at least once.\n\n### How?\n\nCloses PACK-4245",
    "sha": "c3bb0f182fadec67d1ebd63a001e339ff2d30f80",
    "files": [
        {
            "sha": "19979aafaff30eb6518303a28f3b0cfb59d33988",
            "filename": "turbopack/crates/turbopack-ecmascript/src/minify.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/c3bb0f182fadec67d1ebd63a001e339ff2d30f80/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fminify.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c3bb0f182fadec67d1ebd63a001e339ff2d30f80/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fminify.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fminify.rs?ref=c3bb0f182fadec67d1ebd63a001e339ff2d30f80",
            "patch": "@@ -16,7 +16,10 @@ use swc_core::{\n         },\n         minifier::option::{CompressOptions, ExtraOptions, MangleOptions, MinifyOptions},\n         parser::{lexer::Lexer, Parser, StringInput, Syntax},\n-        transforms::base::fixer::paren_remover,\n+        transforms::base::{\n+            fixer::paren_remover,\n+            hygiene::{self, hygiene_with_config},\n+        },\n     },\n };\n use tracing::{instrument, Level};\n@@ -99,6 +102,13 @@ pub fn minify(path: &FileSystemPath, code: &Code, source_maps: bool, mangle: boo\n                     },\n                 );\n \n+                if !mangle {\n+                    program.mutate(hygiene_with_config(hygiene::Config {\n+                        top_level_mark,\n+                        ..Default::default()\n+                    }));\n+                }\n+\n                 Ok(program.apply(ecma::transforms::base::fixer::fixer(Some(\n                     &comments as &dyn Comments,\n                 ))))"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 11,
        "deletions": 1
    }
}