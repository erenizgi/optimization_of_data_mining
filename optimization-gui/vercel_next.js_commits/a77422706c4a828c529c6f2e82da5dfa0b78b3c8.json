{
    "author": "wbinnssmith",
    "message": "Turbopack: use hashbrown HashMaps instead of now-removed std raw entry api (#78032)\n\n[HashMap’s raw_entry api](https://github.com/rust-lang/rust/issues/56167), an unstable nightly feature, was removed from the Rust compiler entirely.\n\nThis migrates us to use the equivalent API in HashBrown’s HashMap.",
    "sha": "a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
    "files": [
        {
            "sha": "be4ebea6f3f80fb0e82d10288d1fb12d27da4fc4",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -10145,6 +10145,7 @@ dependencies = [\n  \"anyhow\",\n  \"either\",\n  \"flate2\",\n+ \"hashbrown 0.14.5\",\n  \"indexmap 2.7.1\",\n  \"itertools 0.10.5\",\n  \"postcard\","
        },
        {
            "sha": "41998db9992d94aede8f3b74d3859eff8bf98627",
            "filename": "turbopack/crates/turbo-tasks-auto-hash-map/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -1,4 +1,3 @@\n-#![feature(hash_raw_entry)]\n #![feature(hash_extract_if)]\n \n pub mod map;"
        },
        {
            "sha": "799dab84c76149086db68ecb6572533855603823",
            "filename": "turbopack/crates/turbopack-trace-server/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2FCargo.toml?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -15,6 +15,7 @@ bench = false\n anyhow = { workspace = true, features = [\"backtrace\"] }\n either = { workspace = true }\n flate2 = { version = \"1.0.28\" }\n+hashbrown = { workspace = true, features = [\"raw\"] }\n indexmap = { workspace = true, features = [\"serde\"] }\n itertools = { workspace = true }\n postcard = { workspace = true }"
        },
        {
            "sha": "76397fc0ea558c2245ee1ea3e94082543fcea654",
            "filename": "turbopack/crates/turbopack-trace-server/src/bottom_up.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fbottom_up.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fbottom_up.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fbottom_up.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -1,6 +1,6 @@\n use std::{env, sync::Arc};\n \n-use rustc_hash::FxHashMap;\n+use hashbrown::HashMap;\n \n use crate::{\n     span::{SpanBottomUp, SpanIndex},\n@@ -10,15 +10,15 @@ use crate::{\n pub struct SpanBottomUpBuilder {\n     // These values won't change after creation:\n     pub self_spans: Vec<SpanIndex>,\n-    pub children: FxHashMap<String, SpanBottomUpBuilder>,\n+    pub children: HashMap<String, SpanBottomUpBuilder>,\n     pub example_span: SpanIndex,\n }\n \n impl SpanBottomUpBuilder {\n     pub fn new(example_span: SpanIndex) -> Self {\n         Self {\n             self_spans: vec![],\n-            children: FxHashMap::default(),\n+            children: HashMap::default(),\n             example_span,\n         }\n     }\n@@ -42,7 +42,7 @@ pub fn build_bottom_up_graph<'a>(\n         .ok()\n         .and_then(|s| s.parse().ok())\n         .unwrap_or(usize::MAX);\n-    let mut roots = FxHashMap::default();\n+    let mut roots: HashMap<String, SpanBottomUpBuilder> = HashMap::default();\n \n     // unfortunately there is a rustc bug that fails the typechecking here\n     // when using Either<impl Iterator, impl Iterator>. This error appears"
        },
        {
            "sha": "ef164659a8a6e22e107270f6e652f1eadf0c85fa",
            "filename": "turbopack/crates/turbopack-trace-server/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Flib.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -1,5 +1,4 @@\n #![feature(iter_intersperse)]\n-#![feature(hash_raw_entry)]\n #![feature(box_patterns)]\n \n use std::{hash::BuildHasherDefault, path::PathBuf, sync::Arc};"
        },
        {
            "sha": "6e49291fca768c4455a1d27b182cb972c4110a31",
            "filename": "turbopack/crates/turbopack-trace-server/src/main.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fmain.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fmain.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fmain.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -1,5 +1,4 @@\n #![feature(iter_intersperse)]\n-#![feature(hash_raw_entry)]\n #![feature(box_patterns)]\n \n use std::{hash::BuildHasherDefault, sync::Arc};"
        },
        {
            "sha": "0cca4825fbb426abdf76c9c99ca448be0c385b6d",
            "filename": "turbopack/crates/turbopack-trace-server/src/span.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -3,7 +3,7 @@ use std::{\n     sync::{Arc, OnceLock},\n };\n \n-use rustc_hash::FxHashMap;\n+use hashbrown::HashMap;\n \n use crate::timestamp::Timestamp;\n \n@@ -64,7 +64,7 @@ pub struct SpanTimeData {\n pub struct SpanExtra {\n     pub graph: OnceLock<Vec<SpanGraphEvent>>,\n     pub bottom_up: OnceLock<Vec<Arc<SpanBottomUp>>>,\n-    pub search_index: OnceLock<FxHashMap<String, Vec<SpanIndex>>>,\n+    pub search_index: OnceLock<HashMap<String, Vec<SpanIndex>>>,\n }\n \n #[derive(Default)]"
        },
        {
            "sha": "8f42f30527a70f7c7322a7fd2084e1402e74e6a8",
            "filename": "turbopack/crates/turbopack-trace-server/src/span_ref.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan_ref.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a77422706c4a828c529c6f2e82da5dfa0b78b3c8/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan_ref.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fspan_ref.rs?ref=a77422706c4a828c529c6f2e82da5dfa0b78b3c8",
            "patch": "@@ -5,8 +5,9 @@ use std::{\n     vec,\n };\n \n+use hashbrown::HashMap;\n use rayon::iter::{IntoParallelRefIterator, ParallelIterator};\n-use rustc_hash::{FxHashMap, FxHashSet};\n+use rustc_hash::FxHashSet;\n \n use crate::{\n     bottom_up::build_bottom_up_graph,\n@@ -414,9 +415,9 @@ impl<'a> SpanRef<'a> {\n         })\n     }\n \n-    fn search_index(&self) -> &FxHashMap<String, Vec<SpanIndex>> {\n+    fn search_index(&self) -> &HashMap<String, Vec<SpanIndex>> {\n         self.extra().search_index.get_or_init(|| {\n-            let mut index: FxHashMap<String, Vec<SpanIndex>> = FxHashMap::default();\n+            let mut index: HashMap<String, Vec<SpanIndex>> = HashMap::default();\n             let mut queue = VecDeque::with_capacity(8);\n             queue.push_back(*self);\n             while let Some(span) = queue.pop_front() {"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}