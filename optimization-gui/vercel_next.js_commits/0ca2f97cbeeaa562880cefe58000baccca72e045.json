{
    "author": "sokra",
    "message": "fix broken extend implementation on DynamicStorage (#86204)\n\n### What?\n\nThis implementation was broken. It did call `add` instead of `insert` and that doesn't override existing values as it should.\n\nIt could also be a bit more efficient by using `extend`.",
    "sha": "0ca2f97cbeeaa562880cefe58000baccca72e045",
    "files": [
        {
            "sha": "19aa63156477bea32833d25e22b94edc8e034153",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/dynamic_storage.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/0ca2f97cbeeaa562880cefe58000baccca72e045/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fdynamic_storage.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0ca2f97cbeeaa562880cefe58000baccca72e045/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fdynamic_storage.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fdynamic_storage.rs?ref=0ca2f97cbeeaa562880cefe58000baccca72e045",
            "patch": "@@ -61,14 +61,9 @@ impl DynamicStorage {\n     pub fn extend(\n         &mut self,\n         ty: CachedDataItemType,\n-        item: impl Iterator<Item = CachedDataItem>,\n+        iterator: impl Iterator<Item = CachedDataItem>,\n     ) -> bool {\n-        let map = self.get_or_create_map_mut(ty);\n-        let mut added = true;\n-        for item in item {\n-            added = map.add(item) && added;\n-        }\n-        added\n+        self.get_or_create_map_mut(ty).extend(iterator)\n     }\n \n     pub fn insert(&mut self, item: CachedDataItem) -> Option<CachedDataItemValue> {"
        },
        {
            "sha": "9802fd467fa880190c9dbef2ac9caee6b7d7956d",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/key_value_pair_macro.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/0ca2f97cbeeaa562880cefe58000baccca72e045/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0ca2f97cbeeaa562880cefe58000baccca72e045/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs?ref=0ca2f97cbeeaa562880cefe58000baccca72e045",
            "patch": "@@ -360,6 +360,20 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n                 }\n             }\n \n+            pub fn extend(&mut self, iterator: impl Iterator<Item = #ident>) -> bool {\n+                match self {\n+                    #(\n+                        #storage_name::#variant_names { storage } => {\n+                            storage.extend(iterator.map(|item| match item {\n+                                #storage_pattern => (#storage_key, value),\n+                                _ => unreachable!(),\n+                            }))\n+                        }\n+                    )*\n+                    _ => unreachable!(),\n+                }\n+            }\n+\n             pub fn remove(&mut self, key: &#key_name) -> Option<#value_name> {\n                 match (self, *key) {\n                     #("
        }
    ],
    "stats": {
        "total": 23,
        "additions": 16,
        "deletions": 7
    }
}