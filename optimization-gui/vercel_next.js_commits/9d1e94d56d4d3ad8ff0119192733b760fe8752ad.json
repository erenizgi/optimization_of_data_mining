{
    "author": "wyattjoh",
    "message": "fix: revert client segment route changes for sub shell generation (#81731)\n\nReverts changes to the `routes-manifest.json` from #81321. Incorrect\nroute sorting was causing some routing errors.",
    "sha": "9d1e94d56d4d3ad8ff0119192733b760fe8752ad",
    "files": [
        {
            "sha": "4a34ad711c3360ab382959f5345a02ebff5fafb7",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 30,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1e94d56d4d3ad8ff0119192733b760fe8752ad/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1e94d56d4d3ad8ff0119192733b760fe8752ad/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=9d1e94d56d4d3ad8ff0119192733b760fe8752ad",
            "patch": "@@ -3103,44 +3103,18 @@ export default async function build(\n                 }\n \n                 let prefetchDataRoute: string | undefined\n-                let dynamicRoute = routesManifest.dynamicRoutes.find(\n-                  (r) => r.page === route.pathname\n-                )\n                 if (!isAppRouteHandler && isAppPPREnabled) {\n                   prefetchDataRoute = path.posix.join(\n                     `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n                   )\n-\n-                  // If the dynamic route wasn't found, then we need to create\n-                  // it. This ensures that for each fallback shell there's an\n-                  // entry in the app routes manifest which enables routing for\n-                  // this fallback shell.\n-                  if (!dynamicRoute) {\n-                    dynamicRoute = pageToRoute(route.pathname)\n-\n-                    // This route is not for the internal router, but instead\n-                    // for external routers.\n-                    dynamicRoute.skipInternalRouting = true\n-\n-                    // Push this to the end of the array. The dynamic routes are\n-                    // sorted by page later.\n-                    routesManifest.dynamicRoutes.push(dynamicRoute)\n-                  }\n                 }\n \n                 if (!isAppRouteHandler && metadata?.segmentPaths) {\n-                  // If PPR isn't enabled, then we might not find the dynamic\n-                  // route by pathname. If that's the case, we need to find the\n-                  // route by page.\n+                  const dynamicRoute = routesManifest.dynamicRoutes.find(\n+                    (r) => r.page === page\n+                  )\n                   if (!dynamicRoute) {\n-                    dynamicRoute = routesManifest.dynamicRoutes.find(\n-                      (r) => r.page === page\n-                    )\n-\n-                    // If it can't be found by page, we must throw an error.\n-                    if (!dynamicRoute) {\n-                      throw new InvariantError('Dynamic route not found')\n-                    }\n+                    throw new InvariantError('Dynamic route not found')\n                   }\n \n                   dynamicRoute.prefetchSegmentDataRoutes ??= []"
        },
        {
            "sha": "8f9c0b769c67b872b7c1ce5080f307c41b77a0c4",
            "filename": "test/e2e/app-dir/sub-shell-generation/sub-shell-generation.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1e94d56d4d3ad8ff0119192733b760fe8752ad/test%2Fe2e%2Fapp-dir%2Fsub-shell-generation%2Fsub-shell-generation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1e94d56d4d3ad8ff0119192733b760fe8752ad/test%2Fe2e%2Fapp-dir%2Fsub-shell-generation%2Fsub-shell-generation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsub-shell-generation%2Fsub-shell-generation.test.ts?ref=9d1e94d56d4d3ad8ff0119192733b760fe8752ad",
            "patch": "@@ -4,6 +4,8 @@ import * as cheerio from 'cheerio'\n describe('sub-shell-generation', () => {\n   const { next, isNextDev, isNextDeploy } = nextTestSetup({\n     files: __dirname,\n+    // FIXME: re-enable once we've re-enabled the sub-shell generation in Vercel\n+    skipDeployment: true,\n   })\n \n   if (isNextDev) {"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 6,
        "deletions": 30
    }
}