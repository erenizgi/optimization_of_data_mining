{
    "author": "bgw",
    "message": "chore(turbopack): Fix building local crates with `--all-features` (#80117)\n\nThis is a prerequisite for using https://github.com/boshen/cargo-shear, which uses `--all-features`. This also avoids some noise in Rust Analyzer, which also uses `--all-features`.",
    "sha": "a9b5f9b64adbc425038f6eb3631de250346332c2",
    "files": [
        {
            "sha": "72a59327e80e3df8c68a0de23cbd6539852c2dc4",
            "filename": "turbopack/crates/turbo-persistence/src/static_sorted_file.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs?ref=a9b5f9b64adbc425038f6eb3631de250346332c2",
            "patch": "@@ -344,7 +344,7 @@ impl StaticSortedFile {\n             bail!(\n                 \"Corrupted file seq:{} block:{} > number of blocks {} (block_offsets: {:x}, \\\n                  blocks: {:x})\",\n-                self.sequence_number,\n+                self.meta.sequence_number,\n                 block_index,\n                 self.meta.block_count,\n                 self.meta.block_offsets_start(),\n@@ -357,7 +357,7 @@ impl StaticSortedFile {\n             bail!(\n                 \"Corrupted file seq:{} block:{} block offset locations {} + 4 bytes > file end {} \\\n                  (block_offsets: {:x}, blocks: {:x})\",\n-                self.sequence_number,\n+                self.meta.sequence_number,\n                 block_index,\n                 offset,\n                 self.mmap.len(),\n@@ -377,7 +377,7 @@ impl StaticSortedFile {\n             bail!(\n                 \"Corrupted file seq:{} block:{} block {} - {} > file end {} (block_offsets: {:x}, \\\n                  blocks: {:x})\",\n-                self.sequence_number,\n+                self.meta.sequence_number,\n                 block_index,\n                 block_start,\n                 block_end,"
        },
        {
            "sha": "aa75def55446936dda946ed1e8f2343b6c6c43d9",
            "filename": "turbopack/crates/turbo-rcstr/src/tagged_value.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 22,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs?ref=a9b5f9b64adbc425038f6eb3631de250346332c2",
            "patch": "@@ -2,37 +2,37 @@\n \n use std::{num::NonZeroU8, os::raw::c_void, ptr::NonNull, slice};\n \n-#[cfg(feature = \"atom_size_128\")]\n-type RawTaggedValue = u128;\n-#[cfg(any(\n-    target_pointer_width = \"32\",\n-    target_pointer_width = \"16\",\n-    feature = \"atom_size_64\"\n-))]\n-type RawTaggedValue = u64;\n-#[cfg(not(any(\n-    target_pointer_width = \"32\",\n-    target_pointer_width = \"16\",\n-    feature = \"atom_size_64\",\n-    feature = \"atom_size_128\"\n-)))]\n-type RawTaggedValue = usize;\n+use self::raw_types::*;\n \n #[cfg(feature = \"atom_size_128\")]\n-type RawTaggedNonZeroValue = std::num::NonZeroU128;\n-#[cfg(any(\n-    target_pointer_width = \"32\",\n-    target_pointer_width = \"16\",\n-    feature = \"atom_size_64\"\n+mod raw_types {\n+    pub type RawTaggedValue = u128;\n+    pub type RawTaggedNonZeroValue = std::num::NonZeroU128;\n+}\n+\n+#[cfg(all(\n+    any(\n+        target_pointer_width = \"32\",\n+        target_pointer_width = \"16\",\n+        feature = \"atom_size_64\"\n+    ),\n+    not(feature = \"atom_size_128\")\n ))]\n-type RawTaggedNonZeroValue = std::num::NonZeroU64;\n+mod raw_types {\n+    pub type RawTaggedValue = u64;\n+    pub type RawTaggedNonZeroValue = std::num::NonZeroU64;\n+}\n+\n #[cfg(not(any(\n     target_pointer_width = \"32\",\n     target_pointer_width = \"16\",\n     feature = \"atom_size_64\",\n     feature = \"atom_size_128\"\n )))]\n-type RawTaggedNonZeroValue = std::ptr::NonNull<()>;\n+mod raw_types {\n+    pub type RawTaggedValue = usize;\n+    pub type RawTaggedNonZeroValue = std::ptr::NonNull<()>;\n+}\n \n pub(crate) const MAX_INLINE_LEN: usize = std::mem::size_of::<TaggedValue>() - 1;\n \n@@ -75,6 +75,7 @@ impl TaggedValue {\n     pub const fn new_tag(value: NonZeroU8) -> Self {\n         let value = value.get() as RawTaggedValue;\n         Self {\n+            #[allow(clippy::transmute_int_to_non_zero)]\n             value: unsafe { std::mem::transmute(value) },\n         }\n     }"
        },
        {
            "sha": "a9a86f5f666a0350a2e237670caf5a7e0650231b",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=a9b5f9b64adbc425038f6eb3631de250346332c2",
            "patch": "@@ -787,13 +787,13 @@ impl FileSystem for DiskFileSystem {\n                         f.flush()?;\n                         #[cfg(feature = \"write_version\")]\n                         {\n-                            let mut full_path = full_path.into_owned();\n+                            let mut full_path = full_path.to_owned();\n                             let hash = hash_xxh3_hash64(file);\n                             let ext = full_path.extension();\n                             let ext = if let Some(ext) = ext {\n                                 format!(\"{:016x}.{}\", hash, ext.to_string_lossy())\n                             } else {\n-                                format!(\"{:016x}\", hash)\n+                                format!(\"{hash:016x}\")\n                             };\n                             full_path.set_extension(ext);\n                             let mut f = std::fs::File::create(&full_path)?;"
        },
        {
            "sha": "3807580446f389a218fcc0e73fe0d4c869501730",
            "filename": "turbopack/crates/turbo-tasks-macros-shared/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/a9b5f9b64adbc425038f6eb3631de250346332c2/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2FCargo.toml?ref=a9b5f9b64adbc425038f6eb3631de250346332c2",
            "patch": "@@ -14,4 +14,4 @@ workspace = true\n [dependencies]\n proc-macro2 = { workspace = true }\n quote = { workspace = true }\n-syn = { workspace = true, features = [\"full\", \"extra-traits\"] }\n+syn = { workspace = true, features = [\"full\", \"extra-traits\", \"visit\"] }"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 29,
        "deletions": 28
    }
}