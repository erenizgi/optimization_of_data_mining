{
    "author": "huozhi",
    "message": "[segment explorer] hide for pages router (#81813)\n\nHide the segment explorer menu item in pages router \r\n\r\nCloses NEXT-4635",
    "sha": "afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
    "files": [
        {
            "sha": "65062c242a5c19e90f7213e554e5f2efbb6a1a5d",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 25,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
            "patch": "@@ -96,26 +96,18 @@ function SegmentExplorerFooter({\n   )\n }\n \n-export function PageSegmentTree({\n-  isAppRouter,\n-  page,\n-}: {\n-  isAppRouter: boolean\n-  page: string\n-}) {\n+export function PageSegmentTree({ page }: { page: string }) {\n   const tree = useSegmentTree()\n \n   // Count active boundaries for the badge\n   const activeBoundariesCount = useMemo(() => {\n-    return isAppRouter ? countActiveBoundaries(tree) : 0\n-  }, [tree, isAppRouter])\n+    return countActiveBoundaries(tree)\n+  }, [tree])\n \n   // Global reset handler\n   const handleGlobalReset = useCallback(() => {\n-    if (isAppRouter) {\n-      traverseTreeAndResetBoundaries(tree)\n-    }\n-  }, [tree, isAppRouter])\n+    traverseTreeAndResetBoundaries(tree)\n+  }, [tree])\n \n   return (\n     <div\n@@ -126,7 +118,7 @@ export function PageSegmentTree({\n         height: '100%',\n       }}\n     >\n-      {isAppRouter && <PageRouteBar page={page} />}\n+      <PageRouteBar page={page} />\n       <div\n         className=\"segment-explorer-content\"\n         data-nextjs-devtool-segment-explorer\n@@ -135,18 +127,12 @@ export function PageSegmentTree({\n           overflow: 'auto',\n         }}\n       >\n-        {isAppRouter ? (\n-          <PageSegmentTreeLayerPresentation node={tree} level={0} segment=\"\" />\n-        ) : (\n-          <p>Route Info currently is only available for the App Router.</p>\n-        )}\n+        <PageSegmentTreeLayerPresentation node={tree} level={0} segment=\"\" />\n       </div>\n-      {isAppRouter && (\n-        <SegmentExplorerFooter\n-          activeBoundariesCount={activeBoundariesCount}\n-          onGlobalReset={handleGlobalReset}\n-        />\n-      )}\n+      <SegmentExplorerFooter\n+        activeBoundariesCount={activeBoundariesCount}\n+        onGlobalReset={handleGlobalReset}\n+      />\n     </div>\n   )\n }"
        },
        {
            "sha": "2644b31783037eb400ba86a887e140355bec4038",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
            "patch": "@@ -34,6 +34,8 @@ const MenuPanel = () => {\n   const { setPanel, setSelectedIndex } = usePanelRouterContext()\n   const { state, dispatch } = useDevOverlayContext()\n   const { totalErrorCount } = useRenderErrorContext()\n+  const isAppRouter = state.routerType === 'app'\n+\n   return (\n     <DevtoolMenu\n       items={[\n@@ -82,14 +84,15 @@ const MenuPanel = () => {\n               value: <ChevronRight />,\n               onClick: () => setPanel('turbo-info'),\n             },\n-        !!process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER && {\n-          label: 'Route Info',\n-          value: <ChevronRight />,\n-          onClick: () => setPanel('segment-explorer'),\n-          attributes: {\n-            'data-segment-explorer': true,\n+        !!process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER &&\n+          isAppRouter && {\n+            label: 'Route Info',\n+            value: <ChevronRight />,\n+            onClick: () => setPanel('segment-explorer'),\n+            attributes: {\n+              'data-segment-explorer': true,\n+            },\n           },\n-        },\n         {\n           label: 'Preferences',\n           value: <GearIcon />,\n@@ -137,6 +140,7 @@ export const PanelRouter = () => {\n   const { state } = useDevOverlayContext()\n   const { triggerRef } = usePanelRouterContext()\n   const toggleDevtools = useToggleDevtoolsVisibility()\n+  const isAppRouter = state.routerType === 'app'\n \n   const [hideShortcut, setHideShortcut] = useHideShortcutStorage()\n   useShortcuts(\n@@ -206,7 +210,7 @@ export const PanelRouter = () => {\n         </DynamicPanel>\n       </PanelRoute>\n \n-      {process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER && (\n+      {process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER && isAppRouter && (\n         <PanelRoute name=\"segment-explorer\">\n           <DynamicPanel\n             sharePanelSizeGlobally={false}\n@@ -225,10 +229,7 @@ export const PanelRouter = () => {\n             }}\n             header={<DevToolsHeader title=\"Route Info\" />}\n           >\n-            <PageSegmentTree\n-              isAppRouter={state.routerType === 'app'}\n-              page={state.page}\n-            />\n+            <PageSegmentTree page={state.page} />\n           </DynamicPanel>\n         </PanelRoute>\n       )}"
        },
        {
            "sha": "e5921f5affbf36f486d23eb2aaf874688e9875b9",
            "filename": "test/development/app-dir/segment-explorer/segment-explorer.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts?ref=afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
            "patch": "@@ -73,9 +73,9 @@ describe('segment-explorer', () => {\n     expect(await getSegmentExplorerRoute(browser)).toBe('/file-segments')\n   })\n \n-  it('should indicate segment explorer is not available for pages router', async () => {\n+  it('should not have route info panel for pages router', async () => {\n     const browser = await next.browser('/pages-router')\n-    expect(await getSegmentExplorerContent(browser)).toMatchInlineSnapshot(`\"\"`)\n+    expect(await browser.hasElementByCss('[data-segment-explorer]')).toBe(false)\n   })\n \n   it('should handle special built-in not-found segments', async () => {"
        },
        {
            "sha": "428ab08aede6f0a6bc71009cff22252b4fbdb488",
            "filename": "test/development/client-dev-overlay/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts?ref=afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
            "patch": "@@ -142,7 +142,6 @@ describe('client-dev-overlay', () => {\n        Static\n        Turbopack\n        Enabled\n-       Route Info\n        Preferences\"\n       `)\n     } else {\n@@ -152,7 +151,6 @@ describe('client-dev-overlay', () => {\n        Route\n        Static\n        Try Turbopack\n-       Route Info\n        Preferences\"\n       `)\n     }"
        },
        {
            "sha": "9b32d99ae19fb0d351bff097f8d7cb14b5b4d81e",
            "filename": "test/lib/browsers/playwright.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afec9909a066154c4ccc1e1d9ee10e3678ec2e2f/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fbrowsers%2Fplaywright.ts?ref=afec9909a066154c4ccc1e1d9ee10e3678ec2e2f",
            "patch": "@@ -375,6 +375,10 @@ export class Playwright<TCurrent = undefined> {\n     return this.waitForElementByCss(selector, 5_000)\n   }\n \n+  hasElementByCss(selector: string) {\n+    return this.startChain(() => page.locator(selector).isVisible())\n+  }\n+\n   elementById(id: string) {\n     return this.elementByCss(`#${id}`)\n   }"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 30,
        "deletions": 41
    }
}