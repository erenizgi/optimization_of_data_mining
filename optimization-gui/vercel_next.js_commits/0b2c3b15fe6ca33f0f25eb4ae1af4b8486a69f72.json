{
    "author": "gnoff",
    "message": "[Cache Components] Only validate the shell on SSR render (#82381)\n\nPrior to this change on every navigation we would validate that the\ninitial static shell satisified the rules of cache components. This\noffers more protection as you edit pages but it slows down navigations\nand we are already concerned with dev speed and the extra CPU contention\ncan potenially hide or exacerbate other performance characteristics you\nmight notice in dev.\n\nSo for now we will only validate a page on initial load. This means that\nif you are trying to debug a page's static shell suitability you will\nneed to refresh the page not just navigate to and from it.",
    "sha": "0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72",
    "files": [
        {
            "sha": "77f5bfced8c7f46851c05a7f855f27b6e1d0119d",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 25,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72",
            "patch": "@@ -572,31 +572,6 @@ async function generateDynamicFlightRenderResult(\n     options\n   )\n \n-  if (\n-    // We only want this behavior when running `next dev`\n-    renderOpts.dev &&\n-    // We only want this behavior when we have React's dev builds available\n-    process.env.NODE_ENV === 'development' &&\n-    // We only have a Prerender environment for projects opted into cacheComponents\n-    renderOpts.experimental.cacheComponents\n-  ) {\n-    const [resolveValidation, validationOutlet] = createValidationOutlet()\n-    RSCPayload._validation = validationOutlet\n-\n-    const devValidatingFallbackParams =\n-      getRequestMeta(req, 'devValidatingFallbackParams') || null\n-\n-    spawnDynamicValidationInDev(\n-      resolveValidation,\n-      ctx.componentMod.tree,\n-      ctx,\n-      false,\n-      ctx.clientReferenceManifest,\n-      requestStore,\n-      devValidatingFallbackParams\n-    )\n-  }\n-\n   // For app dir, use the bundled version of Flight server renderer (renderToReadableStream)\n   // which contains the subset React.\n   const flightReadableStream = workUnitAsyncStorage.run("
        },
        {
            "sha": "a03c25d217c8bb88beee87bdcbc21bec9bca2268",
            "filename": "test/development/app-dir/cache-components-dev-errors/cache-components-dev-errors.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts?ref=0b2c3b15fe6ca33f0f25eb4ae1af4b8486a69f72",
            "patch": "@@ -1,6 +1,11 @@\n import stripAnsi from 'strip-ansi'\n import { nextTestSetup } from 'e2e-utils'\n-import { assertNoRedbox, hasErrorToast, retry } from 'next-test-utils'\n+import {\n+  assertNoRedbox,\n+  assertNoErrorToast,\n+  hasErrorToast,\n+  retry,\n+} from 'next-test-utils'\n import { createSandbox } from 'development-sandbox'\n import { outdent } from 'outdent'\n \n@@ -32,14 +37,17 @@ describe('Cache Components Dev Errors', () => {\n     `)\n   })\n \n-  it('should show a red box error on client navigations', async () => {\n+  it('should not show a red box error on client navigations', async () => {\n     const browser = await next.browser('/no-error')\n \n     await retry(async () => {\n       expect(await hasErrorToast(browser)).toBe(false)\n     })\n \n     await browser.elementByCss(\"[href='/error']\").click()\n+    await assertNoErrorToast(browser)\n+\n+    await browser.loadPage(`${next.url}/error`)\n \n     // TODO: React should not include the anon stack in the Owner Stack.\n     await expect(browser).toDisplayCollapsedRedbox(`"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 10,
        "deletions": 27
    }
}