{
    "author": "ztanner",
    "message": "remove unstable_forceStale prefetch option & restore `prefetch={true}` functionality (#85411)\n\n`prefetch={true}` with `cacheComponents` was opting into runtime\nprefetching, with `unstable_forceStale` preserving the old behavior of\nfetching the full (stale) data. However we only intended to expose\nruntime prefetching via the `export const prefetch` segment config.\n\nThis removes `unstable_forceStale` and restores previous\n`prefetch={true}` behavior. I've disabled some of the tests that were\nrelying on the old link behavior for opting into runtime prefetching -\nwe'll need to refactor those to use the segment opt-in or just remove\nthem all together.\n\nFixes #85162 \nCloses NAR-320",
    "sha": "5e282808c0d5dd72124c718e54e863b7ace4b623",
    "files": [
        {
            "sha": "056f15ea24dec70e3f8a171400338d51662bf85d",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 12,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -153,7 +153,7 @@ type InternalLinkProps = {\n    * </Link>\n    * ```\n    */\n-  prefetch?: boolean | 'auto' | null | 'unstable_forceStale'\n+  prefetch?: boolean | 'auto' | null\n \n   /**\n    * (unstable) Switch to a full prefetch on hover. Effectively the same as\n@@ -468,12 +468,11 @@ export default function LinkComponent(\n         if (\n           props[key] != null &&\n           valType !== 'boolean' &&\n-          props[key] !== 'auto' &&\n-          props[key] !== 'unstable_forceStale'\n+          props[key] !== 'auto'\n         ) {\n           throw createPropError({\n             key,\n-            expected: '`boolean | \"auto\" | \"unstable_forceStale\"`',\n+            expected: '`boolean | \"auto\"`',\n             actual: valType,\n           })\n         }\n@@ -751,15 +750,7 @@ function getFetchStrategyFromPrefetchProp(\n     process.env.__NEXT_CACHE_COMPONENTS &&\n     process.env.__NEXT_CLIENT_SEGMENT_CACHE\n   ) {\n-    // In the new implementation:\n-    // - `prefetch={true}` is a runtime prefetch\n-    //   (includes cached IO + params + cookies, with dynamic holes for uncached IO).\n-    // - `unstable_forceStale` is a \"full\" prefetch\n-    //   (forces inclusion of all dynamic data, i.e. the old behavior of `prefetch={true}`)\n     if (prefetchProp === true) {\n-      return FetchStrategy.PPRRuntime\n-    }\n-    if (prefetchProp === 'unstable_forceStale') {\n       return FetchStrategy.Full\n     }\n "
        },
        {
            "sha": "55aa68e0f6c628c6075e11bb715b1f505b177dca",
            "filename": "packages/next/src/client/link.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -82,7 +82,7 @@ type InternalLinkProps = {\n    * - `false`: Prefetching will not happen when entering the viewport, but will still happen on hover.\n    * @defaultValue `true` (pages router) or `null` (app router)\n    */\n-  prefetch?: boolean | 'auto' | null | 'unstable_forceStale'\n+  prefetch?: boolean | 'auto' | null\n   /**\n    * The active locale is automatically prepended. `locale` allows for providing a different locale.\n    * When `false` `href` has to include the locale as the default behavior is disabled."
        },
        {
            "sha": "4e4f5ff05f95d08def4f765fd4cebff270cacaf4",
            "filename": "test/e2e/app-dir/searchparams-reuse-loading/app/page.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -16,13 +16,13 @@ export default async function Page(props) {\n           <Link href=\"/search-params?id=2\">/search-params?id=2</Link>\n         </li>\n         <li>\n-          <Link href=\"/search-params?id=3\" prefetch=\"unstable_forceStale\">\n-            /search-params?id=3 (prefetch: unstable_forceStale)\n+          <Link href=\"/search-params?id=3\" prefetch={true}>\n+            /search-params?id=3 (prefetch: true)\n           </Link>\n         </li>\n         <li>\n-          <Link href=\"/search-params\" prefetch=\"unstable_forceStale\">\n-            /search-params (prefetch: unstable_forceStale)\n+          <Link href=\"/search-params\" prefetch={true}>\n+            /search-params (prefetch: true)\n           </Link>\n         </li>\n         <li>"
        },
        {
            "sha": "18cfffca04f38e9213e76b3ea1cc94e61d086af8",
            "filename": "test/e2e/app-dir/searchparams-reuse-loading/app/with-middleware/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fwith-middleware%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fwith-middleware%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fapp%2Fwith-middleware%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -14,18 +14,12 @@ export default function Page() {\n         </Link>\n       </li>\n       <li>\n-        <Link\n-          href=\"/with-middleware/search-params?id=3\"\n-          prefetch=\"unstable_forceStale\"\n-        >\n+        <Link href=\"/with-middleware/search-params?id=3\" prefetch={true}>\n           /search-params?id=3 (prefetch: true)\n         </Link>\n       </li>\n       <li>\n-        <Link\n-          href=\"/with-middleware/search-params\"\n-          prefetch=\"unstable_forceStale\"\n-        >\n+        <Link href=\"/with-middleware/search-params\" prefetch={true}>\n           /search-params (prefetch: true)\n         </Link>\n       </li>"
        },
        {
            "sha": "9841c98fcd7d71ba47ff933ec5613797249844d9",
            "filename": "test/e2e/app-dir/segment-cache/metadata/app/page.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fapp%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -5,35 +5,32 @@ export default function Page() {\n     <>\n       <ul>\n         <li>\n-          <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n-            href=\"/page-with-dynamic-head\"\n-          >\n-            Page with dynamic head (prefetch=unstable_forceStale)\n+          <LinkAccordion prefetch={true} href=\"/page-with-dynamic-head\">\n+            Page with dynamic head (prefetch=true)\n           </LinkAccordion>\n         </li>\n         <li>\n           <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n+            prefetch={true}\n             href=\"/rewrite-to-page-with-dynamic-head\"\n           >\n-            Rewrite to page with dynamic head (prefetch=unstable_forceStale)\n+            Rewrite to page with dynamic head (prefetch=true)\n           </LinkAccordion>\n         </li>\n       </ul>\n       <hr />\n       <ul>\n         <li>\n           <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n+            prefetch={true}\n             href=\"/page-with-runtime-prefetchable-head\"\n           >\n             Page with runtime-prefetchable head (prefetch=true)\n           </LinkAccordion>\n         </li>\n         <li>\n           <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n+            prefetch={true}\n             href=\"/rewrite-to-page-with-runtime-prefetchable-head\"\n           >\n             Rewrite to page with runtime-prefetchable head (prefetch=true)"
        },
        {
            "sha": "e02462547adca0d185343688d422ef5179dc41d0",
            "filename": "test/e2e/app-dir/segment-cache/metadata/segment-cache-metadata.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fsegment-cache-metadata.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fsegment-cache-metadata.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmetadata%2Fsegment-cache-metadata.test.ts?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -25,7 +25,7 @@ describe('segment cache (metadata)', () => {\n         )\n         await checkbox.click()\n       }, [\n-        // Because the link is prefetched with prefetch=\"unstable_forceStale\",\n+        // Because the link is prefetched with prefetch={true},\n         // we should be able to prefetch the title, even though it's dynamic.\n         {\n           includes: 'Dynamic Title',\n@@ -90,7 +90,7 @@ describe('segment cache (metadata)', () => {\n         )\n         await checkbox.click()\n       }, [\n-        // Because the link is prefetched with prefetch=\"unstable_forceStale\",\n+        // Because the link is prefetched with prefetch={true},\n         // we should be able to prefetch the title, even though it's dynamic.\n         {\n           includes: 'Runtime-prefetchable title',"
        },
        {
            "sha": "253997975361ea2cb937897531a6198212b18f12",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-layout-sharing/app/page.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fapp%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -11,12 +11,6 @@ export default async function Page() {\n         <li>\n           <DebugLinkAccordion href=\"/shared-layout/one\" prefetch={true} />\n         </li>\n-        <li>\n-          <DebugLinkAccordion\n-            href=\"/shared-layout/one\"\n-            prefetch={'unstable_forceStale'}\n-          />\n-        </li>\n       </ul>\n       <ul>\n         <li>\n@@ -25,12 +19,6 @@ export default async function Page() {\n         <li>\n           <DebugLinkAccordion href=\"/shared-layout/two\" prefetch={true} />\n         </li>\n-        <li>\n-          <DebugLinkAccordion\n-            href=\"/shared-layout/two\"\n-            prefetch={'unstable_forceStale'}\n-          />\n-        </li>\n       </ul>\n       <h2>shared layout prefetching - layout with cookies</h2>\n       <ul>\n@@ -46,12 +34,6 @@ export default async function Page() {\n             prefetch={'auto'}\n           />\n         </li>\n-        <li>\n-          <DebugLinkAccordion\n-            href=\"/runtime-prefetchable-layout/two\"\n-            prefetch={'unstable_forceStale'}\n-          />\n-        </li>\n       </ul>\n \n       <h2>shared layout prefetching - segment config</h2>"
        },
        {
            "sha": "0e1786510951e3c52539e4f5233a846dae6e91df",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-layout-sharing/components/link-accordion.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fcomponents%2Flink-accordion.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fcomponents%2Flink-accordion.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fcomponents%2Flink-accordion.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -54,8 +54,6 @@ function getPrefetchKind(prefetch: LinkProps['prefetch']) {\n     case 'auto':\n       return 'auto'\n     case true:\n-      return 'runtime'\n-    case 'unstable_forceStale':\n       return 'full'\n     default:\n       prefetch satisfies never"
        },
        {
            "sha": "89f90f1f30e3c30bfbf2cf17653823e023da3651",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-layout-sharing/prefetch-layout-sharing.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fprefetch-layout-sharing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fprefetch-layout-sharing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-layout-sharing%2Fprefetch-layout-sharing.test.ts?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -14,13 +14,14 @@ describe('layout sharing in non-static prefetches', () => {\n \n   // Glossary:\n   //\n-  // - A \"full prefetch\" is `<Link prefetch=\"unstable_forceStale\">` (a.k.a old `prefetch={true}`, before cacheComponents).\n+  // - A \"full prefetch\" is `<Link prefetch=\"true\">`\n   //  It includes cached and uncached IO.\n \n-  // - A \"runtime prefetch\" is the new `<Link prefetch={true}>` (only available in cacheComponents mode).\n+  // - A \"runtime prefetch\" is the new `unstable_prefetch` segment config (only available in cacheComponents mode).\n   //   It includes cached IO, and allows access to cookies/params/searchParams/\"use cache: private\", but excludes uncached IO.\n \n-  it('runtime prefetches should omit layouts that were already prefetched with a runtime prefetch', async () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  it.skip('runtime prefetches should omit layouts that were already prefetched with a runtime prefetch', async () => {\n     // Prefetches should re-use results from previous prefetches with the same fetch strategy.\n \n     let page: Playwright.Page\n@@ -243,7 +244,8 @@ describe('layout sharing in non-static prefetches', () => {\n     )\n   })\n \n-  it('runtime prefetches should omit layouts that were already prefetched with a full prefetch', async () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  it.skip('runtime prefetches should omit layouts that were already prefetched with a full prefetch', async () => {\n     // A prefetch should re-use layouts from past prefetches with more specific fetch strategies.\n \n     let page: Playwright.Page\n@@ -339,7 +341,8 @@ describe('layout sharing in non-static prefetches', () => {\n     )\n   })\n \n-  it('full prefetches should include layouts that were only prefetched with a runtime prefetch', async () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  it.skip('full prefetches should include layouts that were only prefetched with a runtime prefetch', async () => {\n     // A prefetch should NOT re-use layouts from past prefetches if they used a less specific fetch strategy.\n \n     let page: Playwright.Page\n@@ -408,7 +411,8 @@ describe('layout sharing in non-static prefetches', () => {\n     )\n   })\n \n-  it('full prefetches should omit layouts that were prefetched with a runtime prefetch and had no dynamic holes', async () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  it.skip('full prefetches should omit layouts that were prefetched with a runtime prefetch and had no dynamic holes', async () => {\n     // If a runtime prefetch gave us a complete segment with no dynamic holes left, then it's equivalent to a full prefetch.\n     //\n     // TODO: This doesn't work in all cases -- if any segment in a runtime prefetch was partial, we'll mark all of them as partial,\n@@ -488,7 +492,8 @@ describe('layout sharing in non-static prefetches', () => {\n     )\n   })\n \n-  it('navigations should omit layouts that were prefetched with a runtime prefetch and had no dynamic holes', async () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  it.skip('navigations should omit layouts that were prefetched with a runtime prefetch and had no dynamic holes', async () => {\n     // If a runtime prefetch gave us a complete segment with no dynamic holes left, then it's equivalent to a full prefetch.\n     //\n     // TODO: This doesn't work in all cases -- if any segment in a runtime prefetch was partial, we'll mark all of them as partial,"
        },
        {
            "sha": "0e1786510951e3c52539e4f5233a846dae6e91df",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-runtime/components/link-accordion.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fcomponents%2Flink-accordion.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fcomponents%2Flink-accordion.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fcomponents%2Flink-accordion.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -54,8 +54,6 @@ function getPrefetchKind(prefetch: LinkProps['prefetch']) {\n     case 'auto':\n       return 'auto'\n     case true:\n-      return 'runtime'\n-    case 'unstable_forceStale':\n       return 'full'\n     default:\n       prefetch satisfies never"
        },
        {
            "sha": "e7cdf3a9e830043bb4f14e32a5f1e531bbf44e5a",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-runtime/prefetch-runtime.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fprefetch-runtime.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fprefetch-runtime.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-runtime%2Fprefetch-runtime.test.ts?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -4,11 +4,13 @@ import type * as Playwright from 'playwright'\n import { createRouterAct } from 'router-act'\n \n describe('runtime prefetching', () => {\n-  const { next, isNextDev, isNextDeploy } = nextTestSetup({\n+  const { next, isNextDev, isNextDeploy, skipped } = nextTestSetup({\n     files: __dirname,\n+    // TODO (runtime-prefetching): investigate failures when deployed to Vercel.\n+    skipDeployment: true,\n   })\n-  if (isNextDev) {\n-    it('disabled in development', () => {})\n+  if (isNextDev || skipped) {\n+    it('is skipped', () => {})\n     return\n   }\n \n@@ -711,7 +713,8 @@ describe('runtime prefetching', () => {\n     )\n   })\n \n-  describe('cache stale time handling', () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  describe.skip('cache stale time handling', () => {\n     it.each([\n       {\n         // If a cache has an expiration time under 5min (DYNAMIC_EXPIRE), we omit it from static prerenders.\n@@ -992,7 +995,8 @@ describe('runtime prefetching', () => {\n     })\n   })\n \n-  describe('errors', () => {\n+  // TODO (runtime-prefetching): link-level opt-in has been removed. These tests need to be updated to use the segment configuration.\n+  describe.skip('errors', () => {\n     it.each([\n       {\n         description: 'when sync IO is used after awaiting cookies()',"
        },
        {
            "sha": "1f0eef1102b602d917148ee33b89c34ebfaa391d",
            "filename": "test/e2e/app-dir/segment-cache/revalidation/app/refetch-on-new-base-tree/layout.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 16,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Flayout.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -10,17 +10,16 @@ export default function RefetchOnNewBaseTreeLayout({\n       <div style={{ backgroundColor: 'lightgray', padding: '1rem' }}>\n         <p>\n           This demonstrates what happens when a link is prefetched using{' '}\n-          <code>{'prefetch=\"unstable_forceStale\"'}</code> and the URL changes.\n-          Next.js should re-prefetch the link in case the delta between the base\n-          tree and the target tree has changed.\n+          <code>{'prefetch={true}'}</code> and the URL changes. Next.js should\n+          re-prefetch the link in case the delta between the base tree and the\n+          target tree has changed.\n         </p>\n         <p>\n           Everything in this gray section is part of a shared layout. The links\n-          below are prefetched using{' '}\n-          <code>{'prefetch=\"unstable_forceStale\"'}</code>. If the first loaded\n-          page is \"/refetch-on-new-base-tree/a\", the prefetch for this link will\n-          be empty, because there's no delta between the base tree and the\n-          target tree.\n+          below are prefetched using <code>{'prefetch={true}'}</code>. If the\n+          first loaded page is \"/refetch-on-new-base-tree/a\", the prefetch for\n+          this link will be empty, because there's no delta between the base\n+          tree and the target tree.\n         </p>\n         <p>\n           However, if you then navigate to page B, we should re-prefetch the\n@@ -49,16 +48,10 @@ export default function RefetchOnNewBaseTreeLayout({\n             because it was fully prefetched.\n           </li>\n         </ul>\n-        <LinkAccordion\n-          prefetch=\"unstable_forceStale\"\n-          href=\"/refetch-on-new-base-tree/a\"\n-        >\n+        <LinkAccordion prefetch={true} href=\"/refetch-on-new-base-tree/a\">\n           Page A\n         </LinkAccordion>\n-        <LinkAccordion\n-          prefetch=\"unstable_forceStale\"\n-          href=\"/refetch-on-new-base-tree/b\"\n-        >\n+        <LinkAccordion prefetch={true} href=\"/refetch-on-new-base-tree/b\">\n           Page B\n         </LinkAccordion>\n       </div>"
        },
        {
            "sha": "0ba17b9532d5ff584f8a61d67488a69f1903f4af",
            "filename": "test/e2e/app-dir/segment-cache/search-params/app/search-params/page.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fapp%2Fsearch-params%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fapp%2Fsearch-params%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fapp%2Fsearch-params%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -19,10 +19,10 @@ export default function SearchParamsPage({\n         </li>\n         <li>\n           <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n+            prefetch={true}\n             href=\"/search-params/target-page?searchParam=b_full\"\n           >\n-            searchParam=b_full, prefetch=\"unstable_forceStale\"\n+            searchParam=b_full, prefetch={true}\n           </LinkAccordion>\n         </li>\n         <li>\n@@ -32,10 +32,10 @@ export default function SearchParamsPage({\n         </li>\n         <li>\n           <LinkAccordion\n-            prefetch=\"unstable_forceStale\"\n+            prefetch={true}\n             href=\"/search-params/target-page?searchParam=d_full\"\n           >\n-            searchParam=d_full, prefetch=\"unstable_forceStale\"\n+            searchParam=d_full, prefetch={true}\n           </LinkAccordion>\n         </li>\n       </ul>"
        },
        {
            "sha": "617f16b7a2e1d1fd251d2cc6599a9dceef42e236",
            "filename": "test/e2e/app-dir/segment-cache/staleness/app/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -21,12 +21,12 @@ export default function Page() {\n           </LinkAccordion>\n         </li>\n         <li>\n-          <LinkAccordion href=\"/runtime-stale-5-minutes\" prefetch={true}>\n+          <LinkAccordion href=\"/runtime-stale-5-minutes\">\n             Page whose runtime prefetch has a stale time of 5 minutes\n           </LinkAccordion>\n         </li>\n         <li>\n-          <LinkAccordion href=\"/runtime-stale-10-minutes\" prefetch={true}>\n+          <LinkAccordion href=\"/runtime-stale-10-minutes\">\n             Page whose runtime prefetch has a stale time of 10 minutes\n           </LinkAccordion>\n         </li>"
        },
        {
            "sha": "948c6d19d6ec3a6bcaf6ab5e7cafa80905f61b67",
            "filename": "test/e2e/app-dir/segment-cache/staleness/app/runtime-stale-10-minutes/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-10-minutes%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-10-minutes%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-10-minutes%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -2,6 +2,8 @@ import { Suspense } from 'react'\n import { cacheLife } from 'next/cache'\n import { cookies } from 'next/headers'\n \n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n export default function Page() {\n   return (\n     <Suspense fallback=\"Loading...\">"
        },
        {
            "sha": "7baec63e1cad370e6d6463200bf9a343f61d862d",
            "filename": "test/e2e/app-dir/segment-cache/staleness/app/runtime-stale-5-minutes/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-5-minutes%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-5-minutes%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fstaleness%2Fapp%2Fruntime-stale-5-minutes%2Fpage.tsx?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -2,6 +2,8 @@ import { Suspense } from 'react'\n import { cacheLife } from 'next/cache'\n import { cookies } from 'next/headers'\n \n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n export default function Page() {\n   return (\n     <Suspense fallback=\"Loading...\">"
        },
        {
            "sha": "b0cb5cb1d6234ccbe788dec6fbd801b93d160d9e",
            "filename": "test/e2e/next-link-errors/next-link-errors.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fnext-link-errors%2Fnext-link-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5e282808c0d5dd72124c718e54e863b7ace4b623/test%2Fe2e%2Fnext-link-errors%2Fnext-link-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-link-errors%2Fnext-link-errors.test.ts?ref=5e282808c0d5dd72124c718e54e863b7ace4b623",
            "patch": "@@ -39,7 +39,7 @@ describe('next-link', () => {\n     if (isNextDev) {\n       await expect(browser).toDisplayRedbox(`\n        {\n-         \"description\": \"Failed prop type: The prop \\`prefetch\\` expects a \\`boolean | \"auto\" | \"unstable_forceStale\"\\` in \\`<Link>\\`, but got \\`string\\` instead.\n+         \"description\": \"Failed prop type: The prop \\`prefetch\\` expects a \\`boolean | \"auto\"\\` in \\`<Link>\\`, but got \\`string\\` instead.\n        Open your browser's console to view the Component stack trace.\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\","
        }
    ],
    "stats": {
        "total": 152,
        "additions": 59,
        "deletions": 93
    }
}