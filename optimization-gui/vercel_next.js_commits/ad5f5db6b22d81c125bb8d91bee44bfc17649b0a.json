{
    "author": "huozhi",
    "message": "Revert \"fix: make sure body can be read using `nodejs` runtime in middleware\" (#77690)\n\nReverts vercel/next.js#77553\n\nCloses #77646",
    "sha": "ad5f5db6b22d81c125bb8d91bee44bfc17649b0a",
    "files": [
        {
            "sha": "1c785ed1dba6c5ab8cbfc24c6821f4d6ab74efea",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=ad5f5db6b22d81c125bb8d91bee44bfc17649b0a",
            "patch": "@@ -1626,12 +1626,7 @@ export default class NextNodeServer extends BaseServer<\n \n       result = await adapterFn({\n         handler: middlewareModule.middleware || middlewareModule,\n-        request: {\n-          ...requestData,\n-          body: !['HEAD', 'GET'].includes(params.request.method)\n-            ? requestData.body?.cloneBodyStream()\n-            : undefined,\n-        },\n+        request: requestData,\n         page: 'middleware',\n       })\n     } else {"
        },
        {
            "sha": "a98f9794c03e71fc96476162438dd5402e282837",
            "filename": "test/e2e/middleware-general/app/middleware-node.js",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware-node.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware-node.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware-node.js?ref=ad5f5db6b22d81c125bb8d91bee44bfc17649b0a",
            "patch": "@@ -253,10 +253,6 @@ export async function middleware(request) {\n     throw new Error('test error')\n   }\n \n-  if (url.pathname === '/request-body' && request.method === 'POST') {\n-    return NextResponse.json(await request.json())\n-  }\n-\n   const original = new URL(request.url)\n   return NextResponse.next({\n     headers: {"
        },
        {
            "sha": "146288f85059a75e8efb8c6b5b02b8ac02d9222f",
            "filename": "test/e2e/middleware-general/app/middleware.js",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-general%2Fapp%2Fmiddleware.js?ref=ad5f5db6b22d81c125bb8d91bee44bfc17649b0a",
            "patch": "@@ -252,10 +252,6 @@ export async function middleware(request) {\n     throw new Error('test error')\n   }\n \n-  if (url.pathname === '/request-body' && request.method === 'POST') {\n-    return NextResponse.json(await request.json())\n-  }\n-\n   const original = new URL(request.url)\n   return NextResponse.next({\n     headers: {"
        },
        {
            "sha": "00977bbbedc229f350d1545800c57d16beac84bc",
            "filename": "test/e2e/middleware-general/test/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ad5f5db6b22d81c125bb8d91bee44bfc17649b0a/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts?ref=ad5f5db6b22d81c125bb8d91bee44bfc17649b0a",
            "patch": "@@ -824,17 +824,6 @@ describe('Middleware Runtime', () => {\n         }/sha.json?hello=goodbye`,\n       ])\n     })\n-\n-    it(`should read request body`, async () => {\n-      const body = { hello: 'world' }\n-      const res = await fetchViaHTTP(next.url, '/request-body', undefined, {\n-        body: JSON.stringify(body),\n-        headers: { 'content-type': 'application/json' },\n-        method: 'POST',\n-      })\n-\n-      expect(await res.json()).toEqual(body)\n-    })\n   }\n   describe('with i18n', () => {\n     setup({ i18n: true })"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 1,
        "deletions": 25
    }
}