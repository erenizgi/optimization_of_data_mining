{
    "author": "lukesandberg",
    "message": "[turbopack] Only send the filesystem caching timing messages for slow events (#84646)\n\nThese are not very actionable for end users, but if they take more than 10s it might be a useful clue about system performance.",
    "sha": "18c99b60c4eb880cd2ffd475d68633f57f63fd93",
    "files": [
        {
            "sha": "1bc2aad5f634931b9e38ccc7844d3b4d8574d1e0",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/18c99b60c4eb880cd2ffd475d68633f57f63fd93/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/18c99b60c4eb880cd2ffd475d68633f57f63fd93/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=18c99b60c4eb880cd2ffd475d68633f57f63fd93",
            "patch": "@@ -1184,10 +1184,13 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n \n         if new_items {\n             let elapsed = start.elapsed();\n-            turbo_tasks().send_compilation_event(Arc::new(TimingEvent::new(\n-                \"Finished writing to filesystem cache\".to_string(),\n-                elapsed,\n-            )));\n+            // avoid spamming the event queue with information about fast operations\n+            if elapsed > Duration::from_secs(10) {\n+                turbo_tasks().send_compilation_event(Arc::new(TimingEvent::new(\n+                    \"Finished writing to filesystem cache\".to_string(),\n+                    elapsed,\n+                )));\n+            }\n         }\n \n         Some((snapshot_time, new_items))"
        },
        {
            "sha": "f4414f90099cca3c931c444e6afa6387b225dc77",
            "filename": "turbopack/crates/turbo-tasks-backend/src/database/turbo/mod.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/18c99b60c4eb880cd2ffd475d68633f57f63fd93/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/18c99b60c4eb880cd2ffd475d68633f57f63fd93/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs?ref=18c99b60c4eb880cd2ffd475d68633f57f63fd93",
            "patch": "@@ -1,4 +1,10 @@\n-use std::{cmp::max, path::PathBuf, sync::Arc, thread::available_parallelism, time::Instant};\n+use std::{\n+    cmp::max,\n+    path::PathBuf,\n+    sync::Arc,\n+    thread::available_parallelism,\n+    time::{Duration, Instant},\n+};\n \n use anyhow::{Ok, Result};\n use parking_lot::Mutex;\n@@ -135,8 +141,11 @@ fn do_compact(\n     })?;\n     if ran {\n         let elapsed = start.elapsed();\n-        turbo_tasks()\n-            .send_compilation_event(Arc::new(TimingEvent::new(message.to_string(), elapsed)));\n+        // avoid spamming the event queue with information about fast operations\n+        if elapsed > Duration::from_secs(10) {\n+            turbo_tasks()\n+                .send_compilation_event(Arc::new(TimingEvent::new(message.to_string(), elapsed)));\n+        }\n     }\n     Ok(())\n }"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 19,
        "deletions": 7
    }
}