{
    "author": "wbinnssmith",
    "message": "Update error-recovery test snapshots for alternative bundler (#76299)\n\nPasses an additional 4 tests for Rspack. Rspack error messages included\ntrailing whitespace when written to the DOM, so these are stripped out.",
    "sha": "ad4977a757b50c333378d334f06abb36eb639569",
    "files": [
        {
            "sha": "9d9196bbd1afa9a77220e3430dbb1706fa1fa308",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ad4977a757b50c333378d334f06abb36eb639569/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/ad4977a757b50c333378d334f06abb36eb639569/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=ad4977a757b50c333378d334f06abb36eb639569",
            "patch": "@@ -382,6 +382,7 @@ jobs:\n     with:\n       afterBuild: node scripts/test-new-tests.mjs --flake-detection --mode dev --group ${{ matrix.group }}\n       stepName: 'test-new-tests-dev-${{matrix.group}}'\n+      timeout_minutes: 60 # Increase the default timeout as tests are intentionally run multiple times to detect flakes\n \n     secrets: inherit\n \n@@ -399,6 +400,7 @@ jobs:\n     with:\n       afterBuild: node scripts/test-new-tests.mjs --flake-detection --mode start --group ${{ matrix.group }}\n       stepName: 'test-new-tests-start-${{matrix.group}}'\n+      timeout_minutes: 60 # Increase the default timeout as tests are intentionally run multiple times to detect flakes\n \n     secrets: inherit\n "
        },
        {
            "sha": "5c2baee8c97da6175e7c9bda9169532c8b5d363b",
            "filename": "test/development/basic/hmr/error-recovery.test.ts",
            "status": "modified",
            "additions": 125,
            "deletions": 23,
            "changes": 148,
            "blob_url": "https://github.com/vercel/next.js/blob/ad4977a757b50c333378d334f06abb36eb639569/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ad4977a757b50c333378d334f06abb36eb639569/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts?ref=ad4977a757b50c333378d334f06abb36eb639569",
            "patch": "@@ -10,6 +10,7 @@ import {\n   renderViaHTTP,\n   retry,\n   waitFor,\n+  trimEndMultiline,\n } from 'next-test-utils'\n import { nextTestSetup } from 'e2e-utils'\n import { outdent } from 'outdent'\n@@ -169,7 +170,47 @@ describe.each([\n       const source = next.normalizeTestDirContent(\n         await getRedboxSource(browser)\n       )\n-      if (basePath === '' && !process.env.TURBOPACK) {\n+\n+      if (basePath === '' && process.env.TURBOPACK) {\n+        expect(source).toMatchInlineSnapshot(`\n+         \"./pages/hmr/about2.js (7:1)\n+         Parsing ecmascript source code failed\n+           5 |     div\n+           6 |   )\n+         > 7 | }\n+             | ^\n+           8 |\n+\n+         Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+        `)\n+      } else if (basePath === '' && process.env.NEXT_RSPACK) {\n+        expect(trimEndMultiline(source)).toMatchInlineSnapshot(`\n+         \"./pages/hmr/about2.js\n+           × Module build failed:\n+           ├─▶   ×\n+           │     │   x Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\n+           │     │    ,-[TEST_DIR/pages/hmr/about2.js:7:1]\n+           │     │  4 |       <p>This is the about page.</p>\n+           │     │  5 |     div\n+           │     │  6 |   )\n+           │     │  7 | }\n+           │     │    : ^\n+           │     │    \\`----\n+           │     │\n+           │     │   x Unexpected eof\n+           │     │    ,-[TEST_DIR/pages/hmr/about2.js:7:3]\n+           │     │  5 |     div\n+           │     │  6 |   )\n+           │     │  7 | }\n+           │     │    \\`----\n+           │     │\n+           │\n+           ╰─▶ Syntax Error\n+\n+         Import trace for requested module:\n+         ./pages/hmr/about2.js\"\n+        `)\n+      } else if (basePath === '') {\n         expect(source).toMatchInlineSnapshot(`\n           \"./pages/hmr/about2.js\n           Error:   x Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\n@@ -193,19 +234,46 @@ describe.each([\n           Import trace for requested module:\n           ./pages/hmr/about2.js\"\n         `)\n-      } else if (basePath === '' && process.env.TURBOPACK) {\n+      } else if (basePath === '/docs' && process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n-         \"./pages/hmr/about2.js (7:1)\n-         Parsing ecmascript source code failed\n-           5 |     div\n-           6 |   )\n-         > 7 | }\n-             | ^\n-           8 |\n+            \"./pages/hmr/about2.js (7:1)\n+            Parsing ecmascript source code failed\n+              5 |     div\n+              6 |   )\n+            > 7 | }\n+                | ^\n+              8 |\n \n-         Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+            Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+          `)\n+      } else if (basePath === '/docs' && process.env.NEXT_RSPACK) {\n+        expect(trimEndMultiline(source)).toMatchInlineSnapshot(`\n+         \"./pages/hmr/about2.js\n+           × Module build failed:\n+           ├─▶   ×\n+           │     │   x Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\n+           │     │    ,-[TEST_DIR/pages/hmr/about2.js:7:1]\n+           │     │  4 |       <p>This is the about page.</p>\n+           │     │  5 |     div\n+           │     │  6 |   )\n+           │     │  7 | }\n+           │     │    : ^\n+           │     │    \\`----\n+           │     │\n+           │     │   x Unexpected eof\n+           │     │    ,-[TEST_DIR/pages/hmr/about2.js:7:3]\n+           │     │  5 |     div\n+           │     │  6 |   )\n+           │     │  7 | }\n+           │     │    \\`----\n+           │     │\n+           │\n+           ╰─▶ Syntax Error\n+\n+         Import trace for requested module:\n+         ./pages/hmr/about2.js\"\n         `)\n-      } else if (basePath === '/docs' && !process.env.TURBOPACK) {\n+      } else if (basePath === '/docs') {\n         expect(source).toMatchInlineSnapshot(`\n           \"./pages/hmr/about2.js\n           Error:   x Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\n@@ -229,18 +297,6 @@ describe.each([\n           Import trace for requested module:\n           ./pages/hmr/about2.js\"\n         `)\n-      } else if (basePath === '/docs' && process.env.TURBOPACK) {\n-        expect(source).toMatchInlineSnapshot(`\n-            \"./pages/hmr/about2.js (7:1)\n-            Parsing ecmascript source code failed\n-              5 |     div\n-              6 |   )\n-            > 7 | }\n-                | ^\n-              8 |\n-\n-            Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n-          `)\n       }\n \n       await next.patchFile(aboutPage, aboutContent)\n@@ -529,6 +585,28 @@ describe.each([\n \n               Read more: https://nextjs.org/docs/app/api-reference/next-config-js/turbo#webpack-loaders\"\n             `)\n+        } else if (process.env.NEXT_RSPACK) {\n+          expect(trimEndMultiline(await getRedboxSource(browser)))\n+            .toMatchInlineSnapshot(`\n+           \"./components/parse-error.xyz\n+             × Module parse failed:\n+             ╰─▶   × JavaScript parsing error: Expression expected\n+                    ╭─[3:0]\n+                  1 │ This\n+                  2 │ is\n+                  3 │ }}}\n+                    · ─\n+                  4 │ invalid\n+                  5 │ js\n+                    ╰────\n+\n+             help:\n+                   You may need an appropriate loader to handle this file type.\n+\n+           Import trace for requested module:\n+           ./components/parse-error.xyz\n+           ./pages/hmr/about8.js\"\n+          `)\n         } else {\n           expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n                       \"./components/parse-error.xyz\n@@ -545,6 +623,7 @@ describe.each([\n                       ./pages/hmr/about8.js\"\n                   `)\n         }\n+\n         await next.patchFile(aboutPage, aboutContent)\n \n         await retry(async () => {\n@@ -605,6 +684,29 @@ describe.each([\n \n            Expression expected\"\n           `)\n+        } else if (process.env.NEXT_RSPACK) {\n+          expect(trimEndMultiline(next.normalizeTestDirContent(redboxSource)))\n+            .toMatchInlineSnapshot(`\n+           \"./components/parse-error.js\n+             × Module build failed:\n+             ├─▶   ×\n+             │     │   x Expression expected\n+             │     │    ,-[./components/parse-error.js:3:1]\n+             │     │  1 | This\n+             │     │  2 | is\n+             │     │  3 | }}}\n+             │     │    : ^\n+             │     │  4 | invalid\n+             │     │  5 | js\n+             │     │    \\`----\n+             │     │\n+             │\n+             ╰─▶ Syntax Error\n+\n+           Import trace for requested module:\n+           ./components/parse-error.js\n+           ./pages/hmr/about9.js\"\n+          `)\n         } else {\n           redboxSource = redboxSource.substring(\n             0,"
        },
        {
            "sha": "0fdf8d41ba038ae4558df76c6509ef343e1fcc93",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/ad4977a757b50c333378d334f06abb36eb639569/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ad4977a757b50c333378d334f06abb36eb639569/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=ad4977a757b50c333378d334f06abb36eb639569",
            "patch": "@@ -1740,3 +1740,10 @@ export async function getHighlightedDiffLines(\n     ])\n   )\n }\n+\n+export function trimEndMultiline(str: string) {\n+  return str\n+    .split('\\n')\n+    .map((line) => line.trimEnd())\n+    .join('\\n')\n+}"
        }
    ],
    "stats": {
        "total": 157,
        "additions": 134,
        "deletions": 23
    }
}