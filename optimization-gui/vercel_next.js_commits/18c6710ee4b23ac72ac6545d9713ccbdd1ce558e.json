{
    "author": "lubieowoce",
    "message": "refactor: rename isAction to isPossibleServerAction (#77011)\n\nthis is a pure rename, with no behavioral changes.\n\n`getServerActionMetadata()` only checks if something:\n- is definitely a fetch action (sent from the router, with a 'Next-Action' header set)\n- is *potentially* a no-js action (a multipart POST where we need to run decodeAction to check)\n\nso `isAction` is a bit misleading. I've renamed it to `isPossibleServerAction`, and updated related names in other places accordingly.",
    "sha": "18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
    "files": [
        {
            "sha": "389be8cc180437df28f612d601d329665eb83dca",
            "filename": "packages/next/src/server/app-render/action-handler.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -483,11 +483,13 @@ export async function handleAction({\n     isURLEncodedAction,\n     isMultipartAction,\n     isFetchAction,\n-    isServerAction,\n+    isPossibleServerAction,\n   } = getServerActionRequestMetadata(req)\n \n-  // If it's not a Server Action, skip handling.\n-  if (!isServerAction) {\n+  // If it can't be a Server Action, skip handling.\n+  // Note that this can be a false positive -- any multipart/urlencoded POST can get us here,\n+  // But won't know if it's an MPA action or not until we call `decodeAction` below.\n+  if (!isPossibleServerAction) {\n     return\n   }\n "
        },
        {
            "sha": "b3b1cadf8043092721f87476528ef04eb15aecff",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -147,7 +147,7 @@ import { parseRelativeUrl } from '../../shared/lib/router/utils/parse-relative-u\n import AppRouter from '../../client/components/app-router'\n import type { ServerComponentsHmrCache } from '../response-cache'\n import type { RequestErrorContext } from '../instrumentation/types'\n-import { getServerActionRequestMetadata } from '../lib/server-action-request-meta'\n+import { getIsPossibleServerAction } from '../lib/server-action-request-meta'\n import { createInitialRouterState } from '../../client/components/router-reducer/create-initial-router-state'\n import { createMutableActionQueue } from '../../client/components/app-router-instance'\n import { getRevalidateReason } from '../instrumentation/utils'\n@@ -216,7 +216,7 @@ export type AppRenderContext = {\n   getDynamicParamFromSegment: GetDynamicParamFromSegment\n   query: NextParsedUrlQuery\n   isPrefetch: boolean\n-  isAction: boolean\n+  isPossibleServerAction: boolean\n   requestTimestamp: number\n   appUsingSizeAdjustment: boolean\n   flightRouterState?: FlightRouterState\n@@ -443,17 +443,18 @@ function makeGetDynamicParamFromSegment(\n function NonIndex({\n   pagePath,\n   statusCode,\n-  isAction,\n+  isPossibleServerAction,\n }: {\n   pagePath: string\n   statusCode: number | undefined\n-  isAction: boolean\n+  isPossibleServerAction: boolean\n }) {\n   const is404Page = pagePath === '/404'\n   const isInvalidStatusCode = typeof statusCode === 'number' && statusCode > 400\n \n   // Only render noindex for page request, skip for server actions\n-  if (!isAction && (is404Page || isInvalidStatusCode)) {\n+  // TODO: is this correct if `isPossibleServerAction` is a false positive?\n+  if (!isPossibleServerAction && (is404Page || isInvalidStatusCode)) {\n     return <meta name=\"robots\" content=\"noindex\" />\n   }\n   return null\n@@ -544,7 +545,7 @@ async function generateDynamicRSCPayload(\n             <NonIndex\n               pagePath={ctx.pagePath}\n               statusCode={ctx.res.statusCode}\n-              isAction={ctx.isAction}\n+              isPossibleServerAction={ctx.isPossibleServerAction}\n             />\n             {/* Adding requestId as react key to make metadata remount for each render */}\n             <ViewportTree key={requestId} />\n@@ -590,7 +591,8 @@ function createErrorContext(\n   return {\n     routerKind: 'App Router',\n     routePath: ctx.pagePath,\n-    routeType: ctx.isAction ? 'action' : 'render',\n+    // TODO: is this correct if `isPossibleServerAction` is a false positive?\n+    routeType: ctx.isPossibleServerAction ? 'action' : 'render',\n     renderSource,\n     revalidateReason: getRevalidateReason(ctx.workStore),\n   }\n@@ -889,7 +891,7 @@ async function getRSCPayload(\n       <NonIndex\n         pagePath={ctx.pagePath}\n         statusCode={ctx.res.statusCode}\n-        isAction={ctx.isAction}\n+        isPossibleServerAction={ctx.isPossibleServerAction}\n       />\n       <ViewportTree key={ctx.requestId} />\n       <StaticMetadata />\n@@ -995,7 +997,7 @@ async function getErrorRSCPayload(\n       <NonIndex\n         pagePath={ctx.pagePath}\n         statusCode={ctx.res.statusCode}\n-        isAction={ctx.isAction}\n+        isPossibleServerAction={ctx.isPossibleServerAction}\n       />\n       {/* Adding requestId as react key to make metadata remount for each render */}\n       <ViewportTree key={requestId} />\n@@ -1355,7 +1357,7 @@ async function renderToHTMLOrFlightImpl(\n     fallbackRouteParams\n   )\n \n-  const isActionRequest = getServerActionRequestMetadata(req).isServerAction\n+  const isPossibleActionRequest = getIsPossibleServerAction(req)\n \n   const implicitTags = await getImplicitTags(\n     workStore.page,\n@@ -1372,7 +1374,7 @@ async function renderToHTMLOrFlightImpl(\n     getDynamicParamFromSegment,\n     query,\n     isPrefetch: isPrefetchRequest,\n-    isAction: isActionRequest,\n+    isPossibleServerAction: isPossibleActionRequest,\n     requestTimestamp,\n     appUsingSizeAdjustment,\n     flightRouterState,\n@@ -1559,7 +1561,7 @@ async function renderToHTMLOrFlightImpl(\n     )\n \n     let formState: null | any = null\n-    if (isActionRequest) {\n+    if (isPossibleActionRequest) {\n       // For action requests, we handle them differently with a special render result.\n       const actionRequestResult = await handleAction({\n         req,"
        },
        {
            "sha": "1e85f208821339d24a90d1648008ba9581d44310",
            "filename": "packages/next/src/server/async-storage/work-store.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -31,7 +31,7 @@ export type WorkStoreContext = {\n     incrementalCache?: IncrementalCache\n     isOnDemandRevalidate?: boolean\n     fetchCache?: AppSegmentConfig['fetchCache']\n-    isServerAction?: boolean\n+    isPossibleServerAction?: boolean\n     pendingWaitUntil?: Promise<any>\n     experimental: Pick<\n       RenderOpts['experimental'],\n@@ -108,7 +108,7 @@ export function createWorkStore({\n     !renderOpts.shouldWaitOnAllReady &&\n     !renderOpts.supportsDynamicResponse &&\n     !renderOpts.isDraftMode &&\n-    !renderOpts.isServerAction\n+    !renderOpts.isPossibleServerAction\n \n   const store: WorkStore = {\n     isStaticGeneration,"
        },
        {
            "sha": "651221909f03581c500ccd66e0fed4980967fad2",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -150,7 +150,7 @@ import {\n } from './route-modules/checks'\n import { PrefetchRSCPathnameNormalizer } from './normalizers/request/prefetch-rsc'\n import { NextDataPathnameNormalizer } from './normalizers/request/next-data'\n-import { getIsServerAction } from './lib/server-action-request-meta'\n+import { getIsPossibleServerAction } from './lib/server-action-request-meta'\n import { isInterceptionRouteAppPath } from '../shared/lib/router/utils/interception-routes'\n import { toRoute } from './lib/to-route'\n import type { DeepReadonly } from '../shared/lib/deep-readonly'\n@@ -2019,7 +2019,7 @@ export default abstract class Server<\n \n     const hasServerProps = !!components.getServerSideProps\n     let hasGetStaticPaths = !!components.getStaticPaths\n-    const isServerAction = getIsServerAction(req)\n+    const isPossibleServerAction = getIsPossibleServerAction(req)\n     const hasGetInitialProps = !!components.Component?.getInitialProps\n     let isSSG = !!components.getStaticProps\n \n@@ -2242,7 +2242,7 @@ export default abstract class Server<\n \n     if (\n       // Server actions can use non-GET/HEAD methods.\n-      !isServerAction &&\n+      !isPossibleServerAction &&\n       // Resume can use non-GET/HEAD methods.\n       !minimalPostponed &&\n       !is404Page &&\n@@ -2382,7 +2382,7 @@ export default abstract class Server<\n       !isPreviewMode &&\n       isSSG &&\n       !opts.supportsDynamicResponse &&\n-      !isServerAction &&\n+      !isPossibleServerAction &&\n       !minimalPostponed &&\n       !isDynamicRSCRequest\n     ) {\n@@ -2528,7 +2528,7 @@ export default abstract class Server<\n         shouldWaitOnAllReady,\n         isOnDemandRevalidate,\n         isDraftMode: isPreviewMode,\n-        isServerAction,\n+        isPossibleServerAction,\n         postponed,\n         waitUntil: this.getWaitUntil(),\n         onClose: res.onClose.bind(res),\n@@ -2768,7 +2768,7 @@ export default abstract class Server<\n               this.nextConfig.experimental.dynamicIO &&\n               this.renderOpts.dev &&\n               !isPrefetchRSCRequest &&\n-              !isServerAction\n+              !isPossibleServerAction\n             ) {\n               const warmup = await module.warmup(req, res, context)\n "
        },
        {
            "sha": "5f4f245456c14e28b8476c549cc72ed792d457dc",
            "filename": "packages/next/src/server/lib/server-action-request-meta.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fserver-action-request-meta.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fserver-action-request-meta.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fserver-action-request-meta.ts?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -10,7 +10,7 @@ export function getServerActionRequestMetadata(\n   isURLEncodedAction: boolean\n   isMultipartAction: boolean\n   isFetchAction: boolean\n-  isServerAction: boolean\n+  isPossibleServerAction: boolean\n } {\n   let actionId: string | null\n   let contentType: string | null\n@@ -35,7 +35,7 @@ export function getServerActionRequestMetadata(\n       req.method === 'POST'\n   )\n \n-  const isServerAction = Boolean(\n+  const isPossibleServerAction = Boolean(\n     isFetchAction || isURLEncodedAction || isMultipartAction\n   )\n \n@@ -44,12 +44,12 @@ export function getServerActionRequestMetadata(\n     isURLEncodedAction,\n     isMultipartAction,\n     isFetchAction,\n-    isServerAction,\n+    isPossibleServerAction,\n   }\n }\n \n-export function getIsServerAction(\n+export function getIsPossibleServerAction(\n   req: IncomingMessage | BaseNextRequest | NextRequest\n ): boolean {\n-  return getServerActionRequestMetadata(req).isServerAction\n+  return getServerActionRequestMetadata(req).isPossibleServerAction\n }"
        },
        {
            "sha": "8f320613e76755c89de6b948abc17b639b9bde75",
            "filename": "packages/next/src/server/render.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -280,7 +280,7 @@ export type RenderOptsPartial = {\n   largePageDataBytes?: number\n   isOnDemandRevalidate?: boolean\n   strictNextHead: boolean\n-  isServerAction?: boolean\n+  isPossibleServerAction?: boolean\n   isExperimentalCompile?: boolean\n   isPrefetch?: boolean\n   expireTime?: number"
        },
        {
            "sha": "f970e7f12efc01a47a09714f55751f79de03f08e",
            "filename": "packages/next/src/server/route-modules/app-route/module.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18c6710ee4b23ac72ac6545d9713ccbdd1ce558e/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fapp-route%2Fmodule.ts?ref=18c6710ee4b23ac72ac6545d9713ccbdd1ce558e",
            "patch": "@@ -51,7 +51,7 @@ import {\n   type ActionStore,\n } from '../../app-render/action-async-storage.external'\n import * as sharedModules from './shared-modules'\n-import { getIsServerAction } from '../../lib/server-action-request-meta'\n+import { getIsPossibleServerAction } from '../../lib/server-action-request-meta'\n import { RequestCookies } from 'next/dist/compiled/@edge-runtime/cookies'\n import { cleanURL } from './helpers/clean-url'\n import { StaticGenBailoutError } from '../../../client/components/static-generation-bailout'\n@@ -669,7 +669,7 @@ export class AppRouteRouteModule extends RouteModule<\n \n     const actionStore: ActionStore = {\n       isAppRoute: true,\n-      isAction: getIsServerAction(req),\n+      isAction: getIsPossibleServerAction(req),\n     }\n \n     const implicitTags = await getImplicitTags("
        }
    ],
    "stats": {
        "total": 66,
        "additions": 35,
        "deletions": 31
    }
}