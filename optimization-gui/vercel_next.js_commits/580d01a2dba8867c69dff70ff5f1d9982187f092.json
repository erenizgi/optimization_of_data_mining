{
    "author": "huozhi",
    "message": "[metadata] remove falsy dynamicParams approach (#84405)",
    "sha": "580d01a2dba8867c69dff70ff5f1d9982187f092",
    "files": [
        {
            "sha": "371ace80ad5fe8179cb512c7f79baa2ef3cb47df",
            "filename": "crates/next-core/src/next_app/metadata/route.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 36,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/580d01a2dba8867c69dff70ff5f1d9982187f092/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Froute.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/580d01a2dba8867c69dff70ff5f1d9982187f092/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Froute.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Froute.rs?ref=580d01a2dba8867c69dff70ff5f1d9982187f092",
            "patch": "@@ -291,26 +291,24 @@ async fn dynamic_sitemap_route_with_generate_source(\n                 const paramsPromise = ctx.params\n                 const idPromise = paramsPromise.then(params => params?.__metadata_id__)\n \n-                if (process.env.NODE_ENV !== 'production') {{\n-                    const id = await idPromise\n-                    const hasXmlExtension = id ? id.endsWith('.xml') : false\n-                    const sitemaps = await generateSitemaps()\n-                    let foundId\n-                    for (const item of sitemaps) {{\n-                        if (item?.id == null) {{\n-                            throw new Error('id property is required for every item returned from generateSitemaps')\n-                        }}\n-                        const baseId = id && hasXmlExtension ? id.slice(0, -4) : undefined\n-                        if (item.id.toString() === baseId) {{\n-                            foundId = item.id\n-                        }}\n+                const id = await idPromise\n+                const hasXmlExtension = id ? id.endsWith('.xml') : false\n+                const sitemaps = await generateSitemaps()\n+                let foundId\n+                for (const item of sitemaps) {{\n+                    if (item?.id == null) {{\n+                        throw new Error('id property is required for every item returned from generateSitemaps')\n                     }}\n-                    if (foundId == null) {{\n-                        return new NextResponse('Not Found', {{\n-                            status: 404,\n-                        }})\n+                    const baseId = id && hasXmlExtension ? id.slice(0, -4) : undefined\n+                    if (item.id.toString() === baseId) {{\n+                        foundId = item.id\n                     }}\n                 }}\n+                if (foundId == null) {{\n+                    return new NextResponse('Not Found', {{\n+                        status: 404,\n+                    }})\n+                }}\n                 \n                 const targetIdPromise = idPromise.then(id => {{\n                     const hasXmlExtension = id ? id.endsWith('.xml') : false\n@@ -329,7 +327,6 @@ async fn dynamic_sitemap_route_with_generate_source(\n \n             export * from {resource_path}\n \n-            export const dynamicParams = false\n             export async function generateStaticParams() {{\n                 const sitemaps = await generateSitemaps()\n                 const params = []\n@@ -445,32 +442,29 @@ async fn dynamic_image_route_with_metadata_source(\n                     const {{ __metadata_id__, ...rest }} = params\n                     return rest\n                 }})\n-                \n-                if (process.env.NODE_ENV !== 'production') {{\n-                    const restParams = await restParamsPromise\n-                    const __metadata_id__ = await idPromise\n-                    const imageMetadata = await generateImageMetadata({{ params: restParams }})\n-                    const id = imageMetadata.find((item) => {{\n-                        if (item?.id == null) {{\n-                            throw new Error('id property is required for every item returned from generateImageMetadata')\n-                        }}\n-\n-                        return item.id.toString() === __metadata_id__\n-                    }})?.id\n-\n-                    if (id == null) {{\n-                        return new NextResponse('Not Found', {{\n-                            status: 404,\n-                        }})\n+\n+                const restParams = await restParamsPromise\n+                const __metadata_id__ = await idPromise\n+                const imageMetadata = await generateImageMetadata({{ params: restParams }})\n+                const id = imageMetadata.find((item) => {{\n+                    if (item?.id == null) {{\n+                        throw new Error('id property is required for every item returned from generateImageMetadata')\n                     }}\n+\n+                    return item.id.toString() === __metadata_id__\n+                }})?.id\n+\n+                if (id == null) {{\n+                    return new NextResponse('Not Found', {{\n+                        status: 404,\n+                    }})\n                 }}\n \n                 return handler({{ params: restParamsPromise, id: idPromise }})\n             }}\n \n             export * from {resource_path}\n \n-            export const dynamicParams = false\n             export async function generateStaticParams({{ params }}) {{\n                 const imageMetadata = await generateImageMetadata({{ params }})\n                 const staticParams = []"
        },
        {
            "sha": "27791f5dc00f17c505c0daa192f4dada47112eaa",
            "filename": "packages/next/src/build/webpack/loaders/next-metadata-route-loader.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 37,
            "changes": 67,
            "blob_url": "https://github.com/vercel/next.js/blob/580d01a2dba8867c69dff70ff5f1d9982187f092/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-metadata-route-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/580d01a2dba8867c69dff70ff5f1d9982187f092/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-metadata-route-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-metadata-route-loader.ts?ref=580d01a2dba8867c69dff70ff5f1d9982187f092",
            "patch": "@@ -176,31 +176,27 @@ export async function GET(_, ctx) {\n     const { __metadata_id__, ...rest } = params\n     return rest\n   })\n-  \n-  ${/* we need a dev assertion for id since dynamicParams=false won't work well in dev */ ''}\n-  if (process.env.NODE_ENV !== 'production') {\n-    const restParams = await restParamsPromise\n-    const __metadata_id__ = await idPromise\n-    const imageMetadata = await generateImageMetadata({ params: restParams })\n-    const id = imageMetadata.find((item) => {\n-      if (item?.id == null) {\n-        throw new Error('id property is required for every item returned from generateImageMetadata')\n-      }\n-\n-      return item.id.toString() === __metadata_id__\n-    })?.id\n \n-    if (id == null) {\n-      return new NextResponse('Not Found', {\n-        status: 404,\n-      })\n+  const restParams = await restParamsPromise\n+  const __metadata_id__ = await idPromise\n+  const imageMetadata = await generateImageMetadata({ params: restParams })\n+  const id = imageMetadata.find((item) => {\n+    if (item?.id == null) {\n+      throw new Error('id property is required for every item returned from generateImageMetadata')\n     }\n+\n+    return item.id.toString() === __metadata_id__\n+  })?.id\n+\n+  if (id == null) {\n+    return new NextResponse('Not Found', {\n+      status: 404,\n+    })\n   }\n \n   return handler({ params: restParamsPromise, id: idPromise })\n }\n \n-export const dynamicParams = false\n export async function generateStaticParams({ params }) {\n   const imageMetadata = await generateImageMetadata({ params })\n   const staticParams = []\n@@ -303,27 +299,25 @@ export async function GET(_, ctx) {\n   const paramsPromise = ctx.params\n   const idPromise = paramsPromise.then(params => params?.__metadata_id__)\n \n-  if (process.env.NODE_ENV !== 'production') {\n-    const id = await idPromise\n-    const hasXmlExtension = id ? id.endsWith('.xml') : false\n-    const sitemaps = await generateSitemaps()\n-    let foundId\n-    for (const item of sitemaps) {\n-      if (item?.id == null) {\n-        throw new Error('id property is required for every item returned from generateSitemaps')\n-      }\n-      \n-      const baseId = id && hasXmlExtension ? id.slice(0, -4) : undefined\n-      if (item.id.toString() === baseId) {\n-        foundId = item.id\n-      }\n+  const id = await idPromise\n+  const hasXmlExtension = id ? id.endsWith('.xml') : false\n+  const sitemaps = await generateSitemaps()\n+  let foundId\n+  for (const item of sitemaps) {\n+    if (item?.id == null) {\n+      throw new Error('id property is required for every item returned from generateSitemaps')\n     }\n-    if (foundId == null) {\n-      return new NextResponse('Not Found', {\n-        status: 404,\n-      })\n+\n+    const baseId = id && hasXmlExtension ? id.slice(0, -4) : undefined\n+    if (item.id.toString() === baseId) {\n+      foundId = item.id\n     }\n   }\n+  if (foundId == null) {\n+    return new NextResponse('Not Found', {\n+      status: 404,\n+    })\n+  }\n \n   const targetIdPromise = idPromise.then(id => {\n     const hasXmlExtension = id ? id.endsWith('.xml') : false\n@@ -340,7 +334,6 @@ export async function GET(_, ctx) {\n   })\n }\n \n-export const dynamicParams = false\n export async function generateStaticParams() {\n   const sitemaps = await generateSitemaps()\n   const params = []"
        }
    ],
    "stats": {
        "total": 133,
        "additions": 60,
        "deletions": 73
    }
}