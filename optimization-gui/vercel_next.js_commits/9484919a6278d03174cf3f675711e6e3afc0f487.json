{
    "author": "gnoff",
    "message": "[CacheComponents] Use fallback params when validating dynamic routes in dev (#82069)\n\nWhen validating a dynamic route in dev with Cache Components we must not\nuse more params than would be know at build time because we want to\nensure dev acts as an appropriate debug environment for build validation\nissues. Any time a validation fails for reasons other than fallback\nparams it would have failed as well with fallback params. So we find the\nsmallest set of fallback params that would be used during the build\n(which might be empty if you provide a complete set through\ngenerateStaticParams) and we use that.",
    "sha": "9484919a6278d03174cf3f675711e6e3afc0f487",
    "files": [
        {
            "sha": "d8c90e1ea249c625c7d5b5cf64dc71e7f3518241",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -195,6 +195,7 @@ import {\n import { isReactLargeShellError } from './react-large-shell-error'\n import type { GlobalErrorComponent } from '../../client/components/builtin/global-error'\n import { normalizeConventionFilePath } from './segment-explorer-path'\n+import { getRequestMeta } from '../request-meta'\n \n export type GetDynamicParamFromSegment = (\n   // [slug] / [[slug]] / [...slug]\n@@ -627,13 +628,17 @@ async function generateDynamicFlightRenderResult(\n     const [resolveValidation, validationOutlet] = createValidationOutlet()\n     RSCPayload._validation = validationOutlet\n \n+    const devValidatingFallbackParams =\n+      getRequestMeta(req, 'devValidatingFallbackParams') || null\n+\n     spawnDynamicValidationInDev(\n       resolveValidation,\n       ctx.componentMod.tree,\n       ctx,\n       false,\n       ctx.clientReferenceManifest,\n-      requestStore\n+      requestStore,\n+      devValidatingFallbackParams\n     )\n   }\n \n@@ -1947,13 +1952,17 @@ async function renderToStream(\n         }\n       )\n \n+      const devValidatingFallbackParams =\n+        getRequestMeta(req, 'devValidatingFallbackParams') || null\n+\n       spawnDynamicValidationInDev(\n         resolveValidation,\n         tree,\n         ctx,\n         res.statusCode === 404,\n         clientReferenceManifest,\n-        requestStore\n+        requestStore,\n+        devValidatingFallbackParams\n       )\n \n       reactServerResult = new ReactServerResult(reactServerStream)\n@@ -2304,7 +2313,8 @@ async function spawnDynamicValidationInDev(\n   ctx: AppRenderContext,\n   isNotFound: boolean,\n   clientReferenceManifest: NonNullable<RenderOpts['clientReferenceManifest']>,\n-  requestStore: RequestStore\n+  requestStore: RequestStore,\n+  fallbackRouteParams: FallbackRouteParams | null\n ): Promise<void> {\n   const {\n     componentMod: ComponentMod,\n@@ -2369,7 +2379,7 @@ async function spawnDynamicValidationInDev(\n     type: 'prerender',\n     phase: 'render',\n     rootParams,\n-    fallbackRouteParams: null,\n+    fallbackRouteParams,\n     implicitTags,\n     renderSignal: initialServerRenderController.signal,\n     controller: initialServerPrerenderController,\n@@ -2501,7 +2511,7 @@ async function spawnDynamicValidationInDev(\n       type: 'prerender-client',\n       phase: 'render',\n       rootParams,\n-      fallbackRouteParams: null,\n+      fallbackRouteParams,\n       implicitTags,\n       renderSignal: initialClientRenderController.signal,\n       controller: initialClientPrerenderController,\n@@ -2610,7 +2620,7 @@ async function spawnDynamicValidationInDev(\n     type: 'prerender',\n     phase: 'render',\n     rootParams,\n-    fallbackRouteParams: null,\n+    fallbackRouteParams,\n     implicitTags,\n     renderSignal: finalServerRenderController.signal,\n     controller: finalServerReactController,\n@@ -2698,7 +2708,7 @@ async function spawnDynamicValidationInDev(\n     type: 'prerender-client',\n     phase: 'render',\n     rootParams,\n-    fallbackRouteParams: null,\n+    fallbackRouteParams,\n     implicitTags,\n     renderSignal: finalClientRenderController.signal,\n     controller: finalClientReactController,"
        },
        {
            "sha": "41b487093ff9e7432ef0ba73de32f01a57b500dc",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 1,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -141,6 +141,7 @@ import { fixMojibake } from './lib/fix-mojibake'\n import { computeCacheBustingSearchParam } from '../shared/lib/router/utils/cache-busting-search-param'\n import { setCacheBustingSearchParamWithHash } from '../client/components/router-reducer/set-cache-busting-search-param'\n import type { CacheControl } from './lib/cache-control'\n+import type { PrerenderedRoute } from '../build/static-paths/types'\n \n export type FindComponentsResult = {\n   components: LoadComponentsReturnType\n@@ -1910,6 +1911,7 @@ export default abstract class Server<\n     isAppPath: boolean\n   }): Promise<{\n     staticPaths?: string[]\n+    prerenderedRoutes?: PrerenderedRoute[]\n     fallbackMode?: FallbackMode\n   }> {\n     // Read whether or not fallback should exist from the manifest.\n@@ -2266,13 +2268,42 @@ export default abstract class Server<\n       isDynamicRoute(pathname) &&\n       (components.getStaticPaths || isAppPath)\n     ) {\n-      await this.getStaticPaths({\n+      const pathsResults = await this.getStaticPaths({\n         pathname,\n         urlPathname,\n         requestHeaders: req.headers,\n         page: components.page,\n         isAppPath,\n       })\n+      if (isAppPath && this.nextConfig.experimental.cacheComponents) {\n+        if (pathsResults.prerenderedRoutes?.length) {\n+          let smallestFallbackRouteParams = null\n+          for (const route of pathsResults.prerenderedRoutes) {\n+            const fallbackRouteParams = route.fallbackRouteParams\n+            if (!fallbackRouteParams || fallbackRouteParams.length === 0) {\n+              // There are no fallback route params so we don't need to continue\n+              smallestFallbackRouteParams = null\n+              break\n+            }\n+            if (\n+              smallestFallbackRouteParams === null ||\n+              fallbackRouteParams.length < smallestFallbackRouteParams.length\n+            ) {\n+              smallestFallbackRouteParams = fallbackRouteParams\n+            }\n+          }\n+          if (smallestFallbackRouteParams) {\n+            const devValidatingFallbackParams = new Map<string, string>(\n+              smallestFallbackRouteParams.map((v) => [v, ''])\n+            )\n+            addRequestMeta(\n+              req,\n+              'devValidatingFallbackParams',\n+              devValidatingFallbackParams\n+            )\n+          }\n+        }\n+      }\n     }\n \n     // An OPTIONS request to a page handler is invalid."
        },
        {
            "sha": "5ddbbe53d82d35cafa574296289daec9d5a221b7",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -76,6 +76,7 @@ import {\n } from '../lib/router-utils/instrumentation-globals.external'\n import type { PrerenderManifest } from '../../build'\n import { getRouteRegex } from '../../shared/lib/router/utils/route-regex'\n+import type { PrerenderedRoute } from '../../build/static-paths/types'\n \n // Load ReactDevOverlay only when needed\n let PagesDevOverlayBridgeImpl: PagesDevOverlayBridgeType\n@@ -795,6 +796,7 @@ export default class DevServer extends Server {\n     page: string\n     isAppPath: boolean\n   }): Promise<{\n+    prerenderedRoutes?: PrerenderedRoute[]\n     staticPaths?: string[]\n     fallbackMode?: FallbackMode\n   }> {\n@@ -855,18 +857,19 @@ export default class DevServer extends Server {\n       []\n     )\n       .then(async (res) => {\n-        const { prerenderedRoutes: staticPaths, fallbackMode: fallback } =\n-          res.value\n+        const { prerenderedRoutes, fallbackMode: fallback } = res.value\n \n         if (isAppPath) {\n           if (this.nextConfig.output === 'export') {\n-            if (!staticPaths) {\n+            if (!prerenderedRoutes) {\n               throw new Error(\n                 `Page \"${page}\" is missing exported function \"generateStaticParams()\", which is required with \"output: export\" config.`\n               )\n             }\n \n-            if (!staticPaths.some((item) => item.pathname === urlPathname)) {\n+            if (\n+              !prerenderedRoutes.some((item) => item.pathname === urlPathname)\n+            ) {\n               throw new Error(\n                 `Page \"${page}\" is missing param \"${pathname}\" in \"generateStaticParams()\", which is required with \"output: export\" config.`\n               )\n@@ -888,17 +891,19 @@ export default class DevServer extends Server {\n \n         const value: {\n           staticPaths: string[] | undefined\n+          prerenderedRoutes: PrerenderedRoute[] | undefined\n           fallbackMode: FallbackMode | undefined\n         } = {\n-          staticPaths: staticPaths?.map((route) => route.pathname),\n+          staticPaths: prerenderedRoutes?.map((route) => route.pathname),\n+          prerenderedRoutes,\n           fallbackMode: fallback,\n         }\n \n         if (\n           res.value?.fallbackMode !== undefined &&\n           // This matches the hasGenerateStaticParams logic\n           // we do during build\n-          (!isAppPath || (staticPaths && staticPaths.length > 0))\n+          (!isAppPath || (prerenderedRoutes && prerenderedRoutes.length > 0))\n         ) {\n           // we write the static paths to partial manifest for\n           // fallback handling inside of entry handler's"
        },
        {
            "sha": "155ce9184238eb1eead4d17de3fed79a4e14ea05",
            "filename": "packages/next/src/server/request-meta.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -231,6 +231,11 @@ export interface RequestMeta {\n    * specific flags in future)\n    */\n   minimalMode?: boolean\n+\n+  /**\n+   * DEV only: The fallback params that should be used when validating prerenders during dev\n+   */\n+  devValidatingFallbackParams?: Map<string, string>\n }\n \n /**"
        },
        {
            "sha": "4c7385a9916fee2a245b8f08ba8c85c9734a6042",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/complete/[top]/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,11 @@\n+export function generateStaticParams() {\n+  return [{ top: 'prerendered' }]\n+}\n+\n+export default async function Layout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return children\n+}"
        },
        {
            "sha": "e036b7e61003c42b0216bda257a0b35859a9929f",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/complete/[top]/unwrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,13 @@\n+export function generateStaticParams() {\n+  return [{ bottom: 'prerendered' }]\n+}\n+\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "381617e72245e251dd83e9b549a5971410faab4e",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/complete/[top]/unwrapped/layout.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Funwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,10 @@\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return children\n+}"
        },
        {
            "sha": "e036b7e61003c42b0216bda257a0b35859a9929f",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/complete/[top]/wrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,13 @@\n+export function generateStaticParams() {\n+  return [{ bottom: 'prerendered' }]\n+}\n+\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "d916c38b11bad194a39559b1b48d8a4ec70b8457",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/complete/[top]/wrapped/layout.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fcomplete%2F%5Btop%5D%2Fwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,12 @@\n+import { Suspense } from 'react'\n+\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return <Suspense fallback={<div>Loading...</div>}>{children}</Suspense>\n+}"
        },
        {
            "sha": "4965832f2c9b0605eaa189b7c7fb11124d24e48a",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/favicon.ico",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Ffavicon.ico",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Ffavicon.ico",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Ffavicon.ico?ref=9484919a6278d03174cf3f675711e6e3afc0f487"
        },
        {
            "sha": "1f35a8619bf1f1881bc539174b812f8b46cb29c7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/layout.tsx",
            "status": "added",
            "additions": 172,
            "deletions": 0,
            "changes": 172,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,172 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        {children}\n+        <main>\n+          <h1>Validating Fallback Shells in Dev</h1>\n+          <p>\n+            This App is made up of a number of sub-pages which exercise the\n+            Cache Components validation performed in dev to ensure it matches up\n+            with the validation performed during the build.\n+          </p>\n+          <p>\n+            When Building routes with dynamic params we validate that the\n+            prerender produces an acceptable static shell. If we do not have a\n+            complete set of params for any given page we will use a special kind\n+            of param called a fallback param which suspends as dynamic and is\n+            required to be wrapped in Suspense if accessed so we can ensure\n+            there is still an acceptable shell even when we don't know about\n+            specific values for that param.\n+          </p>\n+          <p>\n+            In Dev, our validation needs to match and the way we do this is we\n+            look at the current route and determine the most specific set of\n+            params that would be availalbe during the build and then use the\n+            remaining fallback params for the validation render. This way if you\n+            see an error during the build you should be able to debug that error\n+            during development too.\n+          </p>\n+          <p>\n+            Click on some of the sample links for the routes\n+            '.../[top]/.../[bottom]'\n+          </p>\n+          <section>\n+            <h2>Complete Params</h2>\n+            <p>\n+              These links are for routes where the build has a complete set of\n+              params to prerender with. We don't expect these to fail at all\n+              during validation because nothing is dynamic on these pages other\n+              than possible param access\n+            </p>\n+            <h3>Suspense between [top] and [bottom]</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/complete/prerendered/wrapped/prerendered\">\n+                  /complete/prerendered/wrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/complete/prerendered/wrapped/novel\">\n+                  /complete/prerendered/wrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/complete/novel/wrapped/novel\">\n+                  /complete/novel/wrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+            <h3>No Suspense</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/complete/prerendered/unwrapped/prerendered\">\n+                  /complete/prerendered/unwrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/complete/prerendered/unwrapped/novel\">\n+                  /complete/prerendered/unwrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/complete/novel/unwrapped/novel\">\n+                  /complete/novel/unwrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+          </section>\n+          <section>\n+            <h2>Partial Params</h2>\n+            <p>\n+              These links are for routes where the top param is prerendered\n+              during the build but the bottom param is not. We expect that if\n+              you attempt to access the bottom param without a wrapping Suspense\n+              boundary it will fail validation\n+            </p>\n+            <h3>Suspense between [top] and [bottom]</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/partial/prerendered/wrapped/prerendered\">\n+                  /partial/prerendered/wrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/partial/prerendered/wrapped/novel\">\n+                  /partial/prerendered/wrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/partial/novel/wrapped/novel\">\n+                  /partial/novel/wrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+            <h3>No Suspense</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/partial/prerendered/unwrapped/prerendered\">\n+                  /partial/prerendered/unwrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/partial/prerendered/unwrapped/novel\">\n+                  /partial/prerendered/unwrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/partial/novel/unwrapped/novel\">\n+                  /partial/novel/unwrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+          </section>\n+          <section>\n+            <h2>No Params</h2>\n+            <p>\n+              These links are for routes where there are no params provided\n+              during the build at all. We expect these to fail validation if you\n+              attempt to access the params above a Suspense boundary.\n+            </p>\n+            <h3>Suspense between [top] and [bottom]</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/none/prerendered/wrapped/prerendered\">\n+                  /none/prerendered/wrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/none/prerendered/wrapped/novel\">\n+                  /none/prerendered/wrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/none/novel/wrapped/novel\">\n+                  /none/novel/wrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+            <h3>No Suspense</h3>\n+            <ul>\n+              <li>\n+                <a href=\"/none/prerendered/unwrapped/prerendered\">\n+                  /none/prerendered/unwrapped/prerendered\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/none/prerendered/unwrapped/novel\">\n+                  /none/prerendered/unwrapped/novel\n+                </a>\n+              </li>\n+              <li>\n+                <a href=\"/none/novel/unwrapped/novel\">\n+                  /none/novel/unwrapped/novel\n+                </a>\n+              </li>\n+            </ul>\n+          </section>\n+        </main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "cd3c528dcf79505bb2c7d75a62273ccd3bd5a8c7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/none/[top]/layout.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,7 @@\n+export default async function Layout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return children\n+}"
        },
        {
            "sha": "7696bb9ed1ccca81d28099f9243d6087044b97b7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/none/[top]/unwrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,9 @@\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "381617e72245e251dd83e9b549a5971410faab4e",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/none/[top]/unwrapped/layout.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Funwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,10 @@\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return children\n+}"
        },
        {
            "sha": "7696bb9ed1ccca81d28099f9243d6087044b97b7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/none/[top]/wrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,9 @@\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "d916c38b11bad194a39559b1b48d8a4ec70b8457",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/none/[top]/wrapped/layout.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fnone%2F%5Btop%5D%2Fwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,12 @@\n+import { Suspense } from 'react'\n+\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return <Suspense fallback={<div>Loading...</div>}>{children}</Suspense>\n+}"
        },
        {
            "sha": "c17431379f962fe20c05804b55df0aadc97b97d5",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return null\n+}"
        },
        {
            "sha": "4c7385a9916fee2a245b8f08ba8c85c9734a6042",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/partial/[top]/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,11 @@\n+export function generateStaticParams() {\n+  return [{ top: 'prerendered' }]\n+}\n+\n+export default async function Layout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return children\n+}"
        },
        {
            "sha": "7696bb9ed1ccca81d28099f9243d6087044b97b7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/partial/[top]/unwrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,9 @@\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "381617e72245e251dd83e9b549a5971410faab4e",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/partial/[top]/unwrapped/layout.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Funwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,10 @@\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return children\n+}"
        },
        {
            "sha": "7696bb9ed1ccca81d28099f9243d6087044b97b7",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/partial/[top]/wrapped/[bottom]/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2F%5Bbottom%5D%2Fpage.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,9 @@\n+export default async function Page(props: {\n+  params: Promise<{ top: string; bottom: string }>\n+}) {\n+  return (\n+    <p>\n+      Top: {(await props.params).top}, Bottom: {(await props.params).bottom}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "d916c38b11bad194a39559b1b48d8a4ec70b8457",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/app/partial/[top]/wrapped/layout.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fapp%2Fpartial%2F%5Btop%5D%2Fwrapped%2Flayout.tsx?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,12 @@\n+import { Suspense } from 'react'\n+\n+export default async function Layout({\n+  children,\n+  params,\n+}: {\n+  children: React.ReactNode\n+  params: Promise<{ top: string }>\n+}) {\n+  await params\n+  return <Suspense fallback={<div>Loading...</div>}>{children}</Suspense>\n+}"
        },
        {
            "sha": "4bfe97ebf0bd01eef945747b67493ef165f601ef",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/cache-components-dev-fallback-validation.test.ts",
            "status": "added",
            "additions": 352,
            "deletions": 0,
            "changes": 352,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,352 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { assertNoRedbox } from 'next-test-utils'\n+\n+describe('Cache Components Fallback Validation', () => {\n+  const { isTurbopack, next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should not warn about missing Suspense when accessing params if static params are completely known at build time', async () => {\n+    // when the params are complete we don't expect to see any errors await params regarless of where there\n+    // are Suspense boundaries.\n+    const browser = await next.browser(\n+      '/complete/prerendered/wrapped/prerendered'\n+    )\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/complete/prerendered/wrapped/novel`)\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/complete/novel/wrapped/novel`)\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(\n+      `${next.url}/complete/prerendered/unwrapped/prerendered`\n+    )\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/complete/prerendered/unwrapped/novel`)\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/complete/novel/unwrapped/novel`)\n+    await assertNoRedbox(browser)\n+  })\n+\n+  it('should warn about missing Suspense when accessing params if static params are partially known at build time', async () => {\n+    // when the params are partially complete we don't expect to see any errors awaiting the params that are known\n+    // but do expect errors awaiting the params that are not known if not inside a Suspense boundary.\n+    const browser = await next.browser(\n+      '/partial/prerendered/wrapped/prerendered'\n+    )\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/partial/prerendered/wrapped/novel`)\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(`${next.url}/partial/novel/wrapped/novel`)\n+    await assertNoRedbox(browser)\n+\n+    await browser.loadPage(\n+      `${next.url}/partial/prerendered/unwrapped/prerendered`\n+    )\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/partial/prerendered/unwrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/partial/novel/unwrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/partial/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31) @ Page\n+       > 1 | export default async function Page(props: {\n+           |                               ^\",\n+         \"stack\": [\n+           \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+  })\n+\n+  it('should warn about missing Suspense when accessing params if static params are entirely missing at build time', async () => {\n+    // when the params are partially complete we don't expect to see any errors awaiting the params that are known\n+    // but do expect errors awaiting the params that are not known if not inside a Suspense boundary.\n+    const browser = await next.browser('/none/prerendered/wrapped/prerendered')\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/none/prerendered/wrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/none/novel/wrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/wrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/wrapped/layout.tsx (3:31) @ Layout\n+       > 3 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/wrapped/layout.tsx (3:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/none/prerendered/unwrapped/prerendered`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/none/prerendered/unwrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+\n+    await browser.loadPage(`${next.url}/none/novel/unwrapped/novel`)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayCollapsedRedbox(`\n+       {\n+         \"description\": \"Route \"/none/[top]/unwrapped/[bottom]\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\",\n+         \"environmentLabel\": \"Server\",\n+         \"label\": \"Console Error\",\n+         \"source\": \"app/none/[top]/unwrapped/layout.tsx (1:31) @ Layout\n+       > 1 | export default async function Layout({\n+           |                               ^\",\n+         \"stack\": [\n+           \"Layout app/none/[top]/unwrapped/layout.tsx (1:31)\",\n+           \"LogSafely <anonymous>\",\n+         ],\n+       }\n+      `)\n+    }\n+  })\n+})"
        },
        {
            "sha": "30a826fdacc568ffb8cd6641fe15330a3c9d618d",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/next.config.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fnext.config.js?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    cacheComponents: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "30a826fdacc568ffb8cd6641fe15330a3c9d618d",
            "filename": "test/e2e/app-dir/hello-world/next.config.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fe2e%2Fapp-dir%2Fhello-world%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9484919a6278d03174cf3f675711e6e3afc0f487/test%2Fe2e%2Fapp-dir%2Fhello-world%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fhello-world%2Fnext.config.js?ref=9484919a6278d03174cf3f675711e6e3afc0f487",
            "patch": "@@ -1,6 +1,10 @@\n /**\n  * @type {import('next').NextConfig}\n  */\n-const nextConfig = {}\n+const nextConfig = {\n+  experimental: {\n+    cacheComponents: true,\n+  },\n+}\n \n module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 779,
        "additions": 764,
        "deletions": 15
    }
}