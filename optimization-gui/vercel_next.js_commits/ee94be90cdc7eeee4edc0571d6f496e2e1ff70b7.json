{
    "author": "eps1lon",
    "message": "[dev-overlay] Use same bundle for Pages and App Router (#80019)",
    "sha": "ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
    "files": [
        {
            "sha": "d34edfc5e415db305bbd0b27331a03959a291275",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -695,5 +695,7 @@\n   \"694\": \"createPrerenderPathname was called inside a client component scope.\",\n   \"695\": \"Expected workUnitAsyncStorage to have a store.\",\n   \"696\": \"Next DevTools: Can't dispatch %s in this environment. This is a bug in Next.js\",\n-  \"697\": \"Next DevTools: Can't render in this environment. This is a bug in Next.js\"\n+  \"697\": \"Next DevTools: Can't render in this environment. This is a bug in Next.js\",\n+  \"698\": \"Next DevTools: App Dev Overlay is already mounted. This is a bug in Next.js\",\n+  \"699\": \"Next DevTools: Pages Dev Overlay is already mounted. This is a bug in Next.js\"\n }"
        },
        {
            "sha": "c4b14ad8796ed71369b7f99dada0784e5afadd18",
            "filename": "packages/next/next-devtools.webpack-config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fnext-devtools.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fnext-devtools.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-devtools.webpack-config.js?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -27,7 +27,7 @@ module.exports = ({ dev, ...rest }) => {\n   return {\n     entry: path.join(\n       __dirname,\n-      'src/client/components/react-dev-overlay/app/entrypoint.js'\n+      'src/client/components/react-dev-overlay/entrypoint.js'\n     ),\n     target,\n     mode: dev ? 'development' : 'production',"
        },
        {
            "sha": "39b3bc1a7ec93236ad96a0c93387a23649f05e5a",
            "filename": "packages/next/next-runtime.webpack-config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-runtime.webpack-config.js?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -93,7 +93,7 @@ const sharedExternals = [\n const externalsMap = {\n   './web/sandbox': 'next/dist/server/web/sandbox',\n   'next/dist/compiled/next-devtools':\n-    'commonjs next/dist/client/components/react-dev-overlay/app/app-dev-overlay.shim.js',\n+    'commonjs next/dist/client/components/react-dev-overlay/dev-overlay.shim.js',\n }\n \n const externalsRegexMap = {"
        },
        {
            "sha": "4fb734ff93bee0be28f34d88aa3dd19c29366adb",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/entrypoint.d.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts?ref=9e9d13fb4d43fa0cb7bc4f51180678fc5099950c",
            "patch": "@@ -1 +0,0 @@\n-export * from './app-dev-overlay.browser'"
        },
        {
            "sha": "4fb734ff93bee0be28f34d88aa3dd19c29366adb",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/entrypoint.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js?ref=9e9d13fb4d43fa0cb7bc4f51180678fc5099950c",
            "patch": "@@ -1 +0,0 @@\n-export * from './app-dev-overlay.browser'"
        },
        {
            "sha": "9d0cb7445122fac05cec37b7f857cb7d0984d4dd",
            "filename": "packages/next/src/client/components/react-dev-overlay/dev-overlay.browser.tsx",
            "status": "renamed",
            "additions": 98,
            "deletions": 17,
            "changes": 115,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.browser.tsx?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -17,15 +17,16 @@ import {\n   ACTION_BUILDING_INDICATOR_SHOW,\n   ACTION_RENDERING_INDICATOR_HIDE,\n   ACTION_RENDERING_INDICATOR_SHOW,\n-} from '../shared'\n+} from './shared'\n \n import { startTransition, useInsertionEffect } from 'react'\n import { createRoot } from 'react-dom/client'\n-import { FontStyles } from '../font/font-styles'\n-import type { DebugInfo } from '../types'\n-import { DevOverlay } from '../ui/dev-overlay'\n-import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n-import type { VersionInfo } from '../../../../server/dev/parse-version-info'\n+import { FontStyles } from './font/font-styles'\n+import type { HydrationErrorState } from './pages/hydration-error-state'\n+import type { DebugInfo } from './types'\n+import { DevOverlay } from './ui/dev-overlay'\n+import type { DevIndicatorServerState } from '../../../server/dev/dev-indicator-server-state'\n+import type { VersionInfo } from '../../../server/dev/parse-version-info'\n \n export interface Dispatcher {\n   onBuildOk(): void\n@@ -143,22 +144,21 @@ function replayQueuedEvents(dispatch: NonNullable<typeof maybeDispatch>) {\n   }\n }\n \n-function getSquashedHydrationErrorDetails() {\n-  // We don't squash hydration errors in the App Router.\n-  return null\n-}\n-\n-function AppDevOverlay({\n+function DevOverlayRoot({\n   getComponentStack,\n   getOwnerStack,\n+  getSquashedHydrationErrorDetails,\n   isRecoverableError,\n+  routerType,\n }: {\n   getComponentStack: (error: Error) => string | undefined\n   getOwnerStack: (error: Error) => string | null | undefined\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n   isRecoverableError: (error: Error) => boolean\n+  routerType: 'app' | 'pages'\n }) {\n   const [state, dispatch] = useErrorOverlayReducer(\n-    'app',\n+    routerType,\n     getComponentStack,\n     getOwnerStack,\n     isRecoverableError\n@@ -193,13 +193,28 @@ function AppDevOverlay({\n   )\n }\n \n-let isMounted = false\n+let isPagesMounted = false\n+let isAppMounted = false\n+\n+function getSquashedHydrationErrorDetailsApp() {\n+  // We don't squash hydration errors in the App Router.\n+  return null\n+}\n+\n export function renderAppDevOverlay(\n   getComponentStack: (error: Error) => string | undefined,\n   getOwnerStack: (error: Error) => string | null | undefined,\n   isRecoverableError: (error: Error) => boolean\n ): void {\n-  if (!isMounted) {\n+  if (isPagesMounted) {\n+    // Switching between App and Pages Router is always a hard navigation\n+    // TODO: Support soft navigation between App and Pages Router\n+    throw new Error(\n+      'Next DevTools: Pages Dev Overlay is already mounted. This is a bug in Next.js'\n+    )\n+  }\n+\n+  if (!isAppMounted) {\n     // React 19 will not throw away `<script>` elements in a container it owns.\n     // This ensures the actual user-space React does not unmount the Dev Overlay.\n     const script = document.createElement('script')\n@@ -225,14 +240,80 @@ export function renderAppDevOverlay(\n       // TODO: Dedicated error boundary or root error callbacks?\n       // At least it won't unmount any user code if it errors.\n       root.render(\n-        <AppDevOverlay\n+        <DevOverlayRoot\n+          getComponentStack={getComponentStack}\n+          getOwnerStack={getOwnerStack}\n+          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetailsApp}\n+          isRecoverableError={isRecoverableError}\n+          routerType=\"app\"\n+        />\n+      )\n+    })\n+\n+    isAppMounted = true\n+  }\n+}\n+\n+export function renderPagesDevOverlay(\n+  getComponentStack: (error: Error) => string | undefined,\n+  getOwnerStack: (error: Error) => string | null | undefined,\n+  getSquashedHydrationErrorDetails: (\n+    error: Error\n+  ) => HydrationErrorState | null,\n+  isRecoverableError: (error: Error) => boolean\n+): void {\n+  if (isAppMounted) {\n+    // Switching between App and Pages Router is always a hard navigation\n+    // TODO: Support soft navigation between App and Pages Router\n+    throw new Error(\n+      'Next DevTools: App Dev Overlay is already mounted. This is a bug in Next.js'\n+    )\n+  }\n+\n+  if (!isPagesMounted) {\n+    const container = document.createElement('nextjs-portal')\n+    // Although the style applied to the shadow host is isolated,\n+    // the element that attached the shadow host (i.e. \"script\")\n+    // is still affected by the parent's style (e.g. \"body\"). This may\n+    // occur style conflicts like \"display: flex\", with other children\n+    // elements therefore give the shadow host an absolute position.\n+    container.style.position = 'absolute'\n+\n+    // Pages Router runs with React 18 or 19 so we can't use the same trick as with\n+    // App Router. We just reconnect the container if React wipes it e.g. when\n+    // we recover from a shell error via createRoot()\n+    new MutationObserver((records) => {\n+      for (const record of records) {\n+        if (record.type === 'childList') {\n+          for (const node of record.removedNodes) {\n+            if (node === container) {\n+              // Reconnect the container to the body\n+              document.body.appendChild(container)\n+            }\n+          }\n+        }\n+      }\n+    }).observe(document.body, {\n+      childList: true,\n+    })\n+    document.body.appendChild(container)\n+\n+    const root = createRoot(container)\n+\n+    startTransition(() => {\n+      // TODO: Dedicated error boundary or root error callbacks?\n+      // At least it won't unmount any user code if it errors.\n+      root.render(\n+        <DevOverlayRoot\n           getComponentStack={getComponentStack}\n           getOwnerStack={getOwnerStack}\n+          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n           isRecoverableError={isRecoverableError}\n+          routerType=\"pages\"\n         />\n       )\n     })\n \n-    isMounted = true\n+    isPagesMounted = true\n   }\n }",
            "previous_filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.browser.tsx"
        },
        {
            "sha": "579fe5a5391c737d4c7bbe3b9e466c72c4f92f83",
            "filename": "packages/next/src/client/components/react-dev-overlay/dev-overlay.shim.ts",
            "status": "renamed",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.shim.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.shim.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fdev-overlay.shim.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -4,6 +4,12 @@ export function renderAppDevOverlay() {\n   )\n }\n \n+export function renderPagesDevOverlay() {\n+  throw new Error(\n+    \"Next DevTools: Can't render in this environment. This is a bug in Next.js\"\n+  )\n+}\n+\n // TODO: Extract into separate functions that are imported\n export const dispatcher = new Proxy(\n   {},",
            "previous_filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.shim.ts"
        },
        {
            "sha": "58c7bc2caff063febd159620a95fc7a7ff0505fc",
            "filename": "packages/next/src/client/components/react-dev-overlay/entrypoint.d.ts",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.d.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -0,0 +1 @@\n+export * from './dev-overlay.browser'"
        },
        {
            "sha": "58c7bc2caff063febd159620a95fc7a7ff0505fc",
            "filename": "packages/next/src/client/components/react-dev-overlay/entrypoint.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fentrypoint.js?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -0,0 +1 @@\n+export * from './dev-overlay.browser'"
        },
        {
            "sha": "dd9c4f9c423e7f64f9fdffc9a832cb2b1585984b",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/client.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 31,
            "changes": 43,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -1,21 +1,8 @@\n-import * as Bus from './bus'\n+import { dispatcher } from 'next/dist/compiled/next-devtools'\n import {\n   attachHydrationErrorState,\n   storeHydrationErrorStateFromConsoleArgs,\n } from './hydration-error-state'\n-import {\n-  ACTION_BEFORE_REFRESH,\n-  ACTION_BUILDING_INDICATOR_HIDE,\n-  ACTION_BUILD_ERROR,\n-  ACTION_BUILD_OK,\n-  ACTION_BUILDING_INDICATOR_SHOW,\n-  ACTION_DEV_INDICATOR,\n-  ACTION_REFRESH,\n-  ACTION_STATIC_INDICATOR,\n-  ACTION_UNHANDLED_ERROR,\n-  ACTION_UNHANDLED_REJECTION,\n-  ACTION_VERSION_INFO,\n-} from '../shared'\n import type { VersionInfo } from '../../../../server/dev/parse-version-info'\n import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n \n@@ -35,10 +22,7 @@ function handleError(error: unknown) {\n     error.name !== 'ModuleBuildError' &&\n     error.name !== 'ModuleNotFoundError'\n   ) {\n-    Bus.emit({\n-      type: ACTION_UNHANDLED_ERROR,\n-      reason: error,\n-    })\n+    dispatcher.onUnhandledError(error)\n   }\n }\n \n@@ -68,10 +52,7 @@ function onUnhandledRejection(ev: PromiseRejectionEvent) {\n     return\n   }\n \n-  Bus.emit({\n-    type: ACTION_UNHANDLED_REJECTION,\n-    reason: reason,\n-  })\n+  dispatcher.onUnhandledRejection(reason)\n }\n \n export function register() {\n@@ -90,39 +71,39 @@ export function register() {\n }\n \n export function onBuildOk() {\n-  Bus.emit({ type: ACTION_BUILD_OK })\n+  dispatcher.onBuildOk()\n }\n \n export function onBuildError(message: string) {\n-  Bus.emit({ type: ACTION_BUILD_ERROR, message })\n+  dispatcher.onBuildError(message)\n }\n \n export function onRefresh() {\n-  Bus.emit({ type: ACTION_REFRESH })\n+  dispatcher.onRefresh()\n }\n \n export function onBeforeRefresh() {\n-  Bus.emit({ type: ACTION_BEFORE_REFRESH })\n+  dispatcher.onBeforeRefresh()\n }\n \n export function onVersionInfo(versionInfo: VersionInfo) {\n-  Bus.emit({ type: ACTION_VERSION_INFO, versionInfo })\n+  dispatcher.onVersionInfo(versionInfo)\n }\n \n export function onStaticIndicator(isStatic: boolean) {\n-  Bus.emit({ type: ACTION_STATIC_INDICATOR, staticIndicator: isStatic })\n+  dispatcher.onStaticIndicator(isStatic)\n }\n \n export function onDevIndicator(devIndicatorsState: DevIndicatorServerState) {\n-  Bus.emit({ type: ACTION_DEV_INDICATOR, devIndicator: devIndicatorsState })\n+  dispatcher.onDevIndicator(devIndicatorsState)\n }\n \n export function buildingIndicatorShow() {\n-  Bus.emit({ type: ACTION_BUILDING_INDICATOR_SHOW })\n+  dispatcher.buildingIndicatorShow()\n }\n \n export function buildingIndicatorHide() {\n-  Bus.emit({ type: ACTION_BUILDING_INDICATOR_HIDE })\n+  dispatcher.buildingIndicatorHide()\n }\n \n export { getErrorByType } from '../utils/get-error-by-type'"
        },
        {
            "sha": "a2b4eefde1b003feaba0552ebef7b6a3620dd986",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hooks.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 18,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -1,34 +1,30 @@\n import React from 'react'\n-import * as Bus from './bus'\n-import { useErrorOverlayReducer } from '../shared'\n import { Router } from '../../../router'\n+import { renderPagesDevOverlay } from 'next/dist/compiled/next-devtools'\n import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n import { isRecoverableError } from '../../../react-client-callbacks/on-recoverable-error'\n+import { getSquashedHydrationErrorDetails } from './hydration-error-state'\n \n-export const usePagesDevOverlay = () => {\n-  const [state, dispatch] = useErrorOverlayReducer(\n-    'pages',\n-    getComponentStack,\n-    getOwnerStack,\n-    isRecoverableError\n-  )\n+export const usePagesDevOverlayBridge = () => {\n+  React.useInsertionEffect(() => {\n+    // NDT uses a different React instance so it's not technically a state update\n+    // scheduled from useInsertionEffect.\n+    renderPagesDevOverlay(\n+      getComponentStack,\n+      getOwnerStack,\n+      getSquashedHydrationErrorDetails,\n+      isRecoverableError\n+    )\n+  }, [])\n \n   React.useEffect(() => {\n-    Bus.on(dispatch)\n-\n     const { handleStaticIndicator } =\n       require('./hot-reloader-client') as typeof import('./hot-reloader-client')\n \n     Router.events.on('routeChangeComplete', handleStaticIndicator)\n \n     return function () {\n       Router.events.off('routeChangeComplete', handleStaticIndicator)\n-      Bus.off(dispatch)\n     }\n-  }, [dispatch])\n-\n-  return {\n-    state,\n-    dispatch,\n-  }\n+  }, [])\n }"
        },
        {
            "sha": "7882f0b6bdd645bbd3553c501a687df75cf108e0",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/pages-dev-overlay-bridge.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay-bridge.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay-bridge.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay-bridge.tsx?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -0,0 +1,18 @@\n+import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary'\n+import { usePagesDevOverlayBridge } from './hooks'\n+\n+export type ErrorType = 'runtime' | 'build'\n+\n+export type PagesDevOverlayBridgeType = typeof PagesDevOverlayBridge\n+\n+interface PagesDevOverlayBridgeProps {\n+  children?: React.ReactNode\n+}\n+\n+export function PagesDevOverlayBridge({\n+  children,\n+}: PagesDevOverlayBridgeProps) {\n+  usePagesDevOverlayBridge()\n+\n+  return <PagesDevOverlayErrorBoundary>{children}</PagesDevOverlayErrorBoundary>\n+}"
        },
        {
            "sha": "20e68fc55a1b90acb020fa3136e08a8fa75e1564",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/pages-dev-overlay.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9e9d13fb4d43fa0cb7bc4f51180678fc5099950c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx?ref=9e9d13fb4d43fa0cb7bc4f51180678fc5099950c",
            "patch": "@@ -1,38 +0,0 @@\n-import { useInsertionEffect } from 'react'\n-import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary'\n-import { usePagesDevOverlay } from './hooks'\n-import { FontStyles } from '../font/font-styles'\n-import { DevOverlay } from '../ui/dev-overlay'\n-import { getSquashedHydrationErrorDetails } from './hydration-error-state'\n-\n-export type ErrorType = 'runtime' | 'build'\n-\n-export type PagesDevOverlayType = typeof PagesDevOverlay\n-\n-interface PagesDevOverlayProps {\n-  children?: React.ReactNode\n-}\n-\n-export function PagesDevOverlay({ children }: PagesDevOverlayProps) {\n-  const { state, dispatch } = usePagesDevOverlay()\n-\n-  // TODO: Remove once Root initializer creates this element\n-  useInsertionEffect(() => {\n-    const container = document.createElement('nextjs-portal')\n-    document.body.appendChild(container)\n-  }, [])\n-\n-  return (\n-    <>\n-      <PagesDevOverlayErrorBoundary>{children}</PagesDevOverlayErrorBoundary>\n-\n-      {/* Fonts can only be loaded outside the Shadow DOM. */}\n-      <FontStyles />\n-      <DevOverlay\n-        state={state}\n-        dispatch={dispatch}\n-        getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n-      />\n-    </>\n-  )\n-}"
        },
        {
            "sha": "1620f24d34fbff1f2136ee2dc8cdaeaf5f2b9c11",
            "filename": "packages/next/src/client/index.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -179,9 +179,11 @@ class Container extends React.Component<{\n     if (process.env.NODE_ENV === 'production') {\n       return this.props.children\n     } else {\n-      const { PagesDevOverlay } =\n-        require('./components/react-dev-overlay/pages/pages-dev-overlay') as typeof import('./components/react-dev-overlay/pages/pages-dev-overlay')\n-      return <PagesDevOverlay>{this.props.children}</PagesDevOverlay>\n+      const { PagesDevOverlayBridge } =\n+        require('./components/react-dev-overlay/pages/pages-dev-overlay-bridge') as typeof import('./components/react-dev-overlay/pages/pages-dev-overlay-bridge')\n+      return (\n+        <PagesDevOverlayBridge>{this.props.children}</PagesDevOverlayBridge>\n+      )\n     }\n   }\n }"
        },
        {
            "sha": "2b87a3d21a1d5cf651d139142c3708b7ffc3405d",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -21,6 +21,7 @@ import type { NodeNextResponse, NodeNextRequest } from '../base-http/node'\n import type { RouteEnsurer } from '../route-matcher-managers/dev-route-matcher-manager'\n import type { PagesManifest } from '../../build/webpack/plugins/pages-manifest-plugin'\n \n+import * as React from 'react'\n import fs from 'fs'\n import { Worker } from 'next/dist/compiled/jest-worker'\n import { join as pathJoin } from 'path'\n@@ -67,21 +68,21 @@ import type { ServerOnInstrumentationRequestError } from '../app-render/types'\n import type { ServerComponentsHmrCache } from '../response-cache'\n import { logRequests } from './log-requests'\n import { FallbackMode } from '../../lib/fallback'\n-import type { PagesDevOverlayType } from '../../client/components/react-dev-overlay/pages/pages-dev-overlay'\n+import type { PagesDevOverlayBridgeType } from '../../client/components/react-dev-overlay/pages/pages-dev-overlay-bridge'\n import {\n   ensureInstrumentationRegistered,\n   getInstrumentationModule,\n } from '../lib/router-utils/instrumentation-globals.external'\n \n // Load ReactDevOverlay only when needed\n-let ReactDevOverlayImpl: PagesDevOverlayType\n-const ReactDevOverlay: PagesDevOverlayType = (props) => {\n-  if (ReactDevOverlayImpl === undefined) {\n-    ReactDevOverlayImpl = (\n-      require('../../client/components/react-dev-overlay/pages/pages-dev-overlay') as typeof import('../../client/components/react-dev-overlay/pages/pages-dev-overlay')\n-    ).PagesDevOverlay as PagesDevOverlayType\n-  }\n-  return ReactDevOverlayImpl(props)\n+let PagesDevOverlayBridgeImpl: PagesDevOverlayBridgeType\n+const ReactDevOverlay: PagesDevOverlayBridgeType = (props) => {\n+  if (PagesDevOverlayBridgeImpl === undefined) {\n+    PagesDevOverlayBridgeImpl = (\n+      require('../../client/components/react-dev-overlay/pages/pages-dev-overlay-bridge') as typeof import('../../client/components/react-dev-overlay/pages/pages-dev-overlay-bridge')\n+    ).PagesDevOverlayBridge\n+  }\n+  return React.createElement(PagesDevOverlayBridgeImpl, props)\n }\n \n export interface Options extends ServerOptions {"
        },
        {
            "sha": "46423f240578d552b185261c7bd935f147da6ac5",
            "filename": "packages/next/src/server/render.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 11,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -103,7 +103,7 @@ import { ReflectAdapter } from './web/spec-extension/adapters/reflect'\n import { getCacheControlHeader } from './lib/cache-control'\n import { getErrorSource } from '../shared/lib/error-source'\n import type { DeepReadonly } from '../shared/lib/deep-readonly'\n-import type { PagesDevOverlayType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay'\n+import type { PagesDevOverlayBridgeType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay-bridge'\n import { getScriptNonceFromHeader } from './app-render/get-script-nonce-from-header'\n \n let tryGetPreviewData: typeof import('./api-utils/node/try-get-preview-data').tryGetPreviewData\n@@ -247,7 +247,7 @@ export type RenderOptsPartial = {\n   nextExport?: boolean\n   dev?: boolean\n   ampPath?: string\n-  ErrorDebug?: PagesDevOverlayType\n+  ErrorDebug?: PagesDevOverlayBridgeType\n   ampValidator?: (html: string, pathname: string) => Promise<void>\n   ampSkipValidation?: boolean\n   ampOptimizerConfig?: { [key: string]: any }\n@@ -813,15 +813,7 @@ export async function renderToHTMLImpl(\n         <Noop />\n         <AppContainer>\n           <>\n-            {/* <ReactDevOverlay/> */}\n-            {dev ? (\n-              <>\n-                {children}\n-                <Noop />\n-              </>\n-            ) : (\n-              children\n-            )}\n+            {children}\n             {/* <RouteAnnouncer/> */}\n             <Noop />\n           </>"
        },
        {
            "sha": "00b8bdb07d8fbbab670a488ea47992e47f5573ef",
            "filename": "packages/next/src/server/request-meta.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -7,7 +7,7 @@ import type { CloneableBody } from './body-streams'\n import type { RouteMatch } from './route-matches/route-match'\n import type { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\n import type { ServerComponentsHmrCache } from './response-cache'\n-import type { PagesDevOverlayType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay'\n+import type { PagesDevOverlayBridgeType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay-bridge'\n \n // FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\n export const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta')\n@@ -224,7 +224,7 @@ export interface RequestMeta {\n   /**\n    * ErrorOverlay component to use in development for pages router\n    */\n-  PagesErrorDebug?: PagesDevOverlayType\n+  PagesErrorDebug?: PagesDevOverlayBridgeType\n }\n \n /**"
        },
        {
            "sha": "adecb564e151a87e3304405b694bc4c74b39e6c4",
            "filename": "packages/next/tsconfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/packages%2Fnext%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftsconfig.json?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -27,7 +27,7 @@\n       // TODO: Enable types by telling Turbopack to ignore this alias.\n       // tsconfig#paths are for type locations not source locations.\n       // \"next/dist/compiled/next-devtools\": [\n-      //   \"./src/client/components/react-dev-overlay/app/entrypoint.d.ts\"\n+      //   \"./src/client/components/react-dev-overlay/entrypoint.d.ts\"\n       // ],\n       \"next/dist/shared/lib/image-loader\": [\"./src/shared/lib/image-loader.ts\"]\n     }"
        },
        {
            "sha": "a0373069b6c8dc0b1adec52658e38c8d5409eae6",
            "filename": "test/development/acceptance/hydration-error.test.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 36,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -104,7 +104,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n          \"componentStack\": \"...\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -113,8 +113,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                            <main className=\"child\">\n        +                     client\n        -                     server\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -210,15 +209,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n          \"componentStack\": \"...\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        +                   <main className=\"only\">\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -301,7 +299,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n          \"componentStack\": \"...\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -311,8 +309,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        +                   second\n        -                   <footer className=\"3\">\n                            ...\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -377,15 +374,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        -                   <main className=\"only\">\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -448,15 +444,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        -                   only\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -538,7 +533,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        {\n          \"componentStack\": \"...\n            <Container fn={function fn}>\n-             <PagesDevOverlay>\n+             <PagesDevOverlayBridge>\n                <PagesDevOverlayErrorBoundary>\n                  <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                    <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -547,8 +542,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                          <tbody>\n                            <tr>\n        >                     test\n-                   ...\n-               ...\",\n+                   ...\",\n          \"description\": \"In HTML, text nodes cannot be a child of <tr>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,\n@@ -627,16 +621,15 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        >                 <table>\n        >                   {\" 123\"}\n                            ...\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"In HTML, text nodes cannot be a child of <table>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,\n@@ -721,7 +714,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n       await expect(browser).toDisplayRedbox(`\n        {\n          \"componentStack\": \"...\n-           <PagesDevOverlay>\n+           <PagesDevOverlayBridge>\n              <PagesDevOverlayErrorBoundary>\n                <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                  <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -732,8 +725,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        +                 <main className=\"second\">\n        -                 <footer className=\"3\">\n                          ...\n-                 ...\n-             ...\",\n+                 ...\",\n          \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Recoverable Error\",\n@@ -845,15 +837,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        >                 <p>\n        >                   <p>\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,\n@@ -939,7 +930,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        {\n          \"componentStack\": \"...\n            <Container fn={function fn}>\n-             <PagesDevOverlay>\n+             <PagesDevOverlayBridge>\n                <PagesDevOverlayErrorBoundary>\n                  <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                    <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -948,8 +939,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                          <div>\n        >                   <p>\n        >                     <div>\n-                   ...\n-               ...\",\n+                   ...\",\n          \"description\": \"In HTML, <div> cannot be a descendant of <p>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,\n@@ -1025,15 +1015,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        >                 <div>\n        >                   <tr>\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"In HTML, <tr> cannot be a child of <div>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,\n@@ -1119,7 +1108,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <Head>\n            <AppContainer>\n              <Container fn={function fn}>\n-               <PagesDevOverlay>\n+               <PagesDevOverlayBridge>\n                  <PagesDevOverlayErrorBoundary>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n@@ -1130,8 +1119,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                                <span>\n                                  <span>\n        >                           <p>\n-                     ...\n-                 ...\",\n+                     ...\",\n          \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n        This will cause a hydration error.\",\n          \"environmentLabel\": null,"
        },
        {
            "sha": "f46c58a1175a75d01f3c53b3f2b0a875e27ca6bd",
            "filename": "test/integration/react-current-version/app/tsconfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fintegration%2Freact-current-version%2Fapp%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fintegration%2Freact-current-version%2Fapp%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-current-version%2Fapp%2Ftsconfig.json?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -16,5 +16,5 @@\n     \"incremental\": true\n   },\n   \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\"],\n-  \"exclude\": [\"node_modules\"]\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n }"
        },
        {
            "sha": "05e56cf6199b30d25ffa05fd40250333fce6fcf1",
            "filename": "test/integration/react-current-version/tsconfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fintegration%2Freact-current-version%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/test%2Fintegration%2Freact-current-version%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-current-version%2Ftsconfig.json?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -20,5 +20,5 @@\n     ]\n   },\n   \"include\": [\"next-env.d.ts\", \".next/types/**/*.ts\", \"**/*.ts\", \"**/*.tsx\"],\n-  \"exclude\": [\"node_modules\"]\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n }"
        },
        {
            "sha": "65baa44de7de6caeaeedfad0cf28aec03a7be408",
            "filename": "tsec-exemptions.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/tsec-exemptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7/tsec-exemptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/tsec-exemptions.json?ref=ee94be90cdc7eeee4edc0571d6f496e2e1ff70b7",
            "patch": "@@ -16,7 +16,7 @@\n     \"packages/next/src/client/components/errors/graceful-degrade-boundary.tsx\"\n   ],\n   \"ban-script-appendchild-calls\": [\n-    \"packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.browser.tsx\"\n+    \"packages/next/src/client/components/react-dev-overlay/dev-overlay.browser.tsx\"\n   ],\n   \"ban-script-content-assignments\": [\"packages/next/src/client/script.tsx\"],\n   \"ban-script-src-assignments\": ["
        }
    ],
    "stats": {
        "total": 377,
        "additions": 203,
        "deletions": 174
    }
}