{
    "author": "sokra",
    "message": "Turbopack: avoid depending on the Project (#78730)\n\n### What?\n\navoid depending on the Project value directly, since it will change on\nevery build.",
    "sha": "e72a76e4d2c1dcb9256cf0bb3acadc0626e23793",
    "files": [
        {
            "sha": "dc1c3144a1cce466650fc096e908832dc0f37db0",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e72a76e4d2c1dcb9256cf0bb3acadc0626e23793/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/e72a76e4d2c1dcb9256cf0bb3acadc0626e23793/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=e72a76e4d2c1dcb9256cf0bb3acadc0626e23793",
            "patch": "@@ -44,7 +44,6 @@ use crate::{\n #[turbo_tasks::value]\n pub struct MiddlewareEndpoint {\n     project: ResolvedVc<Project>,\n-    build_id: RcStr,\n     asset_context: ResolvedVc<Box<dyn AssetContext>>,\n     source: ResolvedVc<Box<dyn Source>>,\n     app_dir: Option<ResolvedVc<FileSystemPath>>,\n@@ -56,15 +55,13 @@ impl MiddlewareEndpoint {\n     #[turbo_tasks::function]\n     pub fn new(\n         project: ResolvedVc<Project>,\n-        build_id: RcStr,\n         asset_context: ResolvedVc<Box<dyn AssetContext>>,\n         source: ResolvedVc<Box<dyn Source>>,\n         app_dir: Option<ResolvedVc<FileSystemPath>>,\n         ecmascript_client_reference_transition_name: Option<ResolvedVc<RcStr>>,\n     ) -> Vc<Self> {\n         Self {\n             project,\n-            build_id,\n             asset_context,\n             source,\n             app_dir,"
        },
        {
            "sha": "dd7f33929d386f8092b4df02ac4f670b14e27729",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/e72a76e4d2c1dcb9256cf0bb3acadc0626e23793/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/e72a76e4d2c1dcb9256cf0bb3acadc0626e23793/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=e72a76e4d2c1dcb9256cf0bb3acadc0626e23793",
            "patch": "@@ -738,6 +738,11 @@ impl Project {\n         *self.mode\n     }\n \n+    #[turbo_tasks::function]\n+    pub(super) async fn is_watch_enabled(&self) -> Result<Vc<bool>> {\n+        Ok(Vc::cell(self.watch.enable))\n+    }\n+\n     #[turbo_tasks::function]\n     pub(super) async fn per_page_module_graph(&self) -> Result<Vc<bool>> {\n         Ok(Vc::cell(*self.mode.await? == NextMode::Development))\n@@ -944,7 +949,7 @@ impl Project {\n \n             // At this point all modules have been computed and we can get rid of the node.js\n             // process pools\n-            if self.await?.watch.enable {\n+            if *self.is_watch_enabled().await? {\n                 turbopack_node::evaluate::scale_down();\n             } else {\n                 turbopack_node::evaluate::scale_zero();\n@@ -1412,7 +1417,6 @@ impl Project {\n \n         Ok(Vc::upcast(MiddlewareEndpoint::new(\n             self,\n-            self.await?.build_id.clone(),\n             middleware_asset_context,\n             source,\n             app_dir.as_deref().copied(),"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}