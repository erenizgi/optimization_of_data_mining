{
    "author": "lukesandberg",
    "message": "[turbopack] Allow `value_trait` items to not be annotated with `turbo_tasks::function` (#79217)\n\nAllow items in `value_trait` definitions to not be marked with `turbo_tasks::function`\n\nAs a POC remove the `function` attribute from `Issue::severity` and all implementors.  In a followup i will explore removing `turbo_task::function` from more `Issue` items.\n\nNow if you define a `turbo_tasks::value_trait` because you want to pass around values like `Vc<Box<dyn Trait>>` or emit it as a collectible you don't have to make every trait item a `turbo_tasks::function`.   To call these items you will need to `vc.into_trait_ref().await?` and then you can call the methods normally.\n\nThis has an odd effect of kind of splitting the `trait` in half, some methods can be called on `Vc<Self>` and some can be called on `&self`.  Annoyingly you cannot make these items `async` since `value_trait` needs to dyn-compatible, but still this unlocks a lot of opportunities.\n\nh/t to kdy1@ for unblocking me on how to use ptr_metadata and how to resolve the issues i was having with Rust-Analyzer",
    "sha": "1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
    "files": [
        {
            "sha": "e203f8b4abc85d9d8d91e9a16c3602721fcbfc17",
            "filename": "Cargo.toml",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/Cargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/Cargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.toml?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -19,6 +19,9 @@ exclude = [\"crates/next-error-code-swc-plugin\"]\n [workspace.lints.clippy]\n too_many_arguments = \"allow\"\n \n+[workspace.lints.rust]\n+unexpected_cfgs = { level = \"warn\", check-cfg = ['cfg(rust_analyzer)'] }\n+\n # This crate is particularly sensitive to compiler optimizations\n [profile.dev.package.turbo-persistence]\n opt-level = 1"
        },
        {
            "sha": "0fdeefc827c14b683ff1608fb7fbfe8b718e2c05",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -598,7 +598,7 @@ struct ConflictIssue {\n     path: ResolvedVc<FileSystemPath>,\n     title: ResolvedVc<StyledString>,\n     description: ResolvedVc<StyledString>,\n-    severity: ResolvedVc<IssueSeverity>,\n+    severity: IssueSeverity,\n }\n \n #[turbo_tasks::value_impl]\n@@ -608,9 +608,8 @@ impl Issue for ConflictIssue {\n         IssueStage::AppStructure.cell()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]\n@@ -1209,7 +1208,7 @@ impl Project {\n                                 .into(),\n                         )\n                         .resolved_cell(),\n-                        severity: IssueSeverity::Error.resolved_cell(),\n+                        severity: IssueSeverity::Error,\n                     }\n                     .resolved_cell()\n                     .emit();"
        },
        {
            "sha": "3df7fc7d215ab3e6215bbaff30ff16fc90dcaa7e",
            "filename": "crates/next-core/src/app_segment_config.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fapp_segment_config.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -7,7 +7,7 @@ use swc_core::{\n     common::{GLOBALS, Span, Spanned, source_map::SmallPos},\n     ecma::ast::{Decl, Expr, FnExpr, Ident, Program},\n };\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     NonLocalValue, ResolvedVc, TryJoinIterExt, ValueDefault, Vc, trace::TraceRawVcs,\n     util::WrapFuture,\n@@ -199,15 +199,16 @@ impl NextSegmentConfigParsingIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for NextSegmentConfigParsingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]\n     fn title(&self) -> Vc<StyledString> {\n-        StyledString::Text(\"Next.js can't recognize the exported `config` field in route\".into())\n-            .cell()\n+        StyledString::Text(rcstr!(\n+            \"Next.js can't recognize the exported `config` field in route\"\n+        ))\n+        .cell()\n     }\n \n     #[turbo_tasks::function]\n@@ -223,11 +224,10 @@ impl Issue for NextSegmentConfigParsingIssue {\n     #[turbo_tasks::function]\n     fn description(&self) -> Vc<OptionStyledString> {\n         Vc::cell(Some(\n-            StyledString::Text(\n+            StyledString::Text(rcstr!(\n                 \"The exported configuration object in a source file needs to have a very specific \\\n                  format from which some properties can be statically parsed at compiled-time.\"\n-                    .into(),\n-            )\n+            ))\n             .resolved_cell(),\n         ))\n     }\n@@ -239,10 +239,9 @@ impl Issue for NextSegmentConfigParsingIssue {\n \n     #[turbo_tasks::function]\n     fn documentation_link(&self) -> Vc<RcStr> {\n-        Vc::cell(\n+        Vc::cell(rcstr!(\n             \"https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config\"\n-                .into(),\n-        )\n+        ))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "7ecb39a6c8a531d089dbafdbf58acac9e476a812",
            "filename": "crates/next-core/src/app_structure.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -590,7 +590,7 @@ fn conflict_issue(\n             .into(),\n         )\n         .resolved_cell(),\n-        severity: IssueSeverity::Error.resolved_cell(),\n+        severity: IssueSeverity::Error,\n     }\n     .resolved_cell()\n     .emit();\n@@ -1529,16 +1529,15 @@ pub async fn get_global_metadata(\n \n #[turbo_tasks::value(shared)]\n struct DirectoryTreeIssue {\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub app_dir: ResolvedVc<FileSystemPath>,\n     pub message: ResolvedVc<StyledString>,\n }\n \n #[turbo_tasks::value_impl]\n impl Issue for DirectoryTreeIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "e36d0b53328adeba94cf66767cc151d535fe0c2c",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1653,9 +1653,8 @@ struct OutdatedConfigIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for OutdatedConfigIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "478d6e68f3da06eadad7e668e69bc0f15a150ff5",
            "filename": "crates/next-core/src/next_font/google/font_fallback.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Ffont_fallback.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Ffont_fallback.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Ffont_fallback.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -87,7 +87,7 @@ pub(super) async fn get_font_fallback(\n                             \"Skipping generating a fallback font.\"\n                         ))\n                         .resolved_cell(),\n-                        severity: IssueSeverity::Warning.resolved_cell(),\n+                        severity: IssueSeverity::Warning,\n                     }\n                     .resolved_cell()\n                     .emit();"
        },
        {
            "sha": "fb22c1185858878a19b4f68d797db33ac29baa25",
            "filename": "crates/next-core/src/next_font/google/mod.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -248,8 +248,8 @@ impl NextFontGoogleCssModuleReplacer {\n                         NextFontIssue {\n                             path: css_virtual_path.to_resolved().await?,\n                             title: StyledString::Line(vec![\n-                                StyledString::Code(\"next/font:\".into()),\n-                                StyledString::Text(\" error:\".into()),\n+                                StyledString::Code(rcstr!(\"next/font:\")),\n+                                StyledString::Text(rcstr!(\" error:\")),\n                             ])\n                             .resolved_cell(),\n                             description: StyledString::Text(\n@@ -260,7 +260,7 @@ impl NextFontGoogleCssModuleReplacer {\n                                 .into(),\n                             )\n                             .resolved_cell(),\n-                            severity: IssueSeverity::Error.resolved_cell(),\n+                            severity: IssueSeverity::Error,\n                         }\n                         .resolved_cell()\n                         .emit();\n@@ -272,8 +272,8 @@ impl NextFontGoogleCssModuleReplacer {\n                         NextFontIssue {\n                             path: css_virtual_path.to_resolved().await?,\n                             title: StyledString::Line(vec![\n-                                StyledString::Code(\"next/font:\".into()),\n-                                StyledString::Text(\" warning:\".into()),\n+                                StyledString::Code(rcstr!(\"next/font:\")),\n+                                StyledString::Text(rcstr!(\" warning:\")),\n                             ])\n                             .resolved_cell(),\n                             description: StyledString::Text(\n@@ -285,7 +285,7 @@ impl NextFontGoogleCssModuleReplacer {\n                                 .into(),\n                             )\n                             .resolved_cell(),\n-                            severity: IssueSeverity::Warning.resolved_cell(),\n+                            severity: IssueSeverity::Warning,\n                         }\n                         .resolved_cell()\n                         .emit();\n@@ -663,7 +663,7 @@ async fn fetch_from_google_fonts(\n     Ok(match *result {\n         Ok(r) => Some(*r.await?.body),\n         Err(err) => {\n-            err.to_issue(IssueSeverity::Warning.into(), virtual_path)\n+            err.to_issue(IssueSeverity::Warning, virtual_path)\n                 .to_resolved()\n                 .await?\n                 .emit();"
        },
        {
            "sha": "f8822296597ec39fc9b3b381aeb438b0e5ae50fc",
            "filename": "crates/next-core/src/next_font/issue.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fissue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fissue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fissue.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -7,7 +7,7 @@ pub(crate) struct NextFontIssue {\n     pub(crate) path: ResolvedVc<FileSystemPath>,\n     pub(crate) title: ResolvedVc<StyledString>,\n     pub(crate) description: ResolvedVc<StyledString>,\n-    pub(crate) severity: ResolvedVc<IssueSeverity>,\n+    pub(crate) severity: IssueSeverity,\n }\n \n #[turbo_tasks::value_impl]\n@@ -17,9 +17,8 @@ impl Issue for NextFontIssue {\n         IssueStage::CodeGen.into()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "3f6065e6c939755a0b126f8b10516472abdcf91c",
            "filename": "crates/next-core/src/next_font/local/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -328,9 +328,8 @@ struct FontResolvingIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for FontResolvingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.cell()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "99baa001519378710319b9be94a12c4d6c48f801",
            "filename": "crates/next-core/src/next_font/util.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -97,7 +97,7 @@ pub(crate) async fn can_use_next_font(\n                 StyledString::Code(request.path),\n             ])\n             .resolved_cell(),\n-            severity: IssueSeverity::Error.resolved_cell(),\n+            severity: IssueSeverity::Error,\n         }\n         .resolved_cell()\n         .emit();"
        },
        {
            "sha": "9c58747d4c04c49cd489ec549dd0a88cde7ff177",
            "filename": "crates/next-core/src/next_image/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,5 +1,6 @@\n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Vc, fxindexmap, trace::TraceRawVcs};\n use turbopack::{ModuleAssetContext, module_options::CustomModuleType};\n use turbopack_core::{\n@@ -65,7 +66,7 @@ impl StructuredImageModuleType {\n                     .cell(),\n                 ),\n                 ReferenceType::Internal(ResolvedVc::cell(fxindexmap!(\n-                    \"IMAGE\".into() => ResolvedVc::upcast(static_asset)\n+                    rcstr!(\"IMAGE\") => ResolvedVc::upcast(static_asset)\n                 ))),\n             )\n             .module())"
        },
        {
            "sha": "033b1a305e1fcf3b75096231814433d231660540",
            "filename": "crates/next-core/src/next_server/resolve.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -459,9 +459,8 @@ struct ExternalizeIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for ExternalizeIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.cell()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "4803b11c42105a843881f538b4de452e171971c8",
            "filename": "crates/next-core/src/next_shared/resolve.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -2,7 +2,7 @@ use std::sync::LazyLock;\n \n use anyhow::Result;\n use rustc_hash::FxHashMap;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n use turbopack_core::{\n@@ -52,9 +52,8 @@ pub struct InvalidImportModuleIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for InvalidImportModuleIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]\n@@ -64,7 +63,7 @@ impl Issue for InvalidImportModuleIssue {\n \n     #[turbo_tasks::function]\n     fn title(&self) -> Vc<StyledString> {\n-        StyledString::Text(\"Invalid import\".into()).cell()\n+        StyledString::Text(rcstr!(\"Invalid import\")).cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "d88a4743d6ca3ad968e53a0192a005b389b36d9d",
            "filename": "crates/next-core/src/next_shared/transforms/next_page_static_info.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fnext_page_static_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fnext_page_static_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fnext_page_static_info.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -8,6 +8,7 @@ use swc_core::{\n     atoms::{Atom, atom},\n     ecma::ast::Program,\n };\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::module_options::{ModuleRule, ModuleRuleEffect};\n@@ -151,9 +152,8 @@ pub struct PageStaticInfoIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for PageStaticInfoIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        self.severity.into()\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]\n@@ -163,7 +163,7 @@ impl Issue for PageStaticInfoIssue {\n \n     #[turbo_tasks::function]\n     fn title(&self) -> Vc<StyledString> {\n-        StyledString::Text(\"Invalid page configuration\".into()).cell()\n+        StyledString::Text(rcstr!(\"Invalid page configuration\")).cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "dcb78545530866ab7538776dbb98bbaeaead2f31",
            "filename": "crates/next-core/src/next_shared/webpack_rules/babel.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,4 +1,5 @@\n use anyhow::Result;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{self, FileSystemEntryType, FileSystemPath};\n use turbopack::module_options::{LoaderRuleItem, OptionWebpackRules, WebpackRules};\n@@ -66,15 +67,15 @@ pub async fn maybe_add_babel_loader(\n                 {\n                     BabelIssue {\n                         path: project_root.to_resolved().await?,\n-                        title: StyledString::Text(\n-                            \"Unable to resolve babel-loader, but a babel config is present\".into(),\n-                        )\n+                        title: StyledString::Text(rcstr!(\n+                            \"Unable to resolve babel-loader, but a babel config is present\"\n+                        ))\n                         .resolved_cell(),\n-                        description: StyledString::Text(\n-                            \"Make sure babel-loader is installed via your package manager.\".into(),\n-                        )\n+                        description: StyledString::Text(rcstr!(\n+                            \"Make sure babel-loader is installed via your package manager.\"\n+                        ))\n                         .resolved_cell(),\n-                        severity: IssueSeverity::Fatal.resolved_cell(),\n+                        severity: IssueSeverity::Fatal,\n                     }\n                     .resolved_cell()\n                     .emit();\n@@ -83,7 +84,7 @@ pub async fn maybe_add_babel_loader(\n                 }\n \n                 let loader = WebpackLoaderItem {\n-                    loader: \"babel-loader\".into(),\n+                    loader: rcstr!(\"babel-loader\"),\n                     options: Default::default(),\n                 };\n                 if let Some(rule) = rule {\n@@ -95,7 +96,7 @@ pub async fn maybe_add_babel_loader(\n                         pattern.into(),\n                         LoaderRuleItem {\n                             loaders: ResolvedVc::cell(vec![loader]),\n-                            rename_as: Some(\"*\".into()),\n+                            rename_as: Some(rcstr!(\"*\")),\n                         },\n                     );\n                 }\n@@ -127,7 +128,7 @@ struct BabelIssue {\n     path: ResolvedVc<FileSystemPath>,\n     title: ResolvedVc<StyledString>,\n     description: ResolvedVc<StyledString>,\n-    severity: ResolvedVc<IssueSeverity>,\n+    severity: IssueSeverity,\n }\n \n #[turbo_tasks::value_impl]\n@@ -137,9 +138,8 @@ impl Issue for BabelIssue {\n         IssueStage::Transform.into()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "253809e0d0cf5bef45d5177021fc6dcab15d3b34",
            "filename": "crates/next-core/src/util.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Futil.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -243,9 +243,8 @@ impl NextSourceConfigParsingIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for NextSourceConfigParsingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "321dbaf6b65648ef8d0ecc9fe3f36a77fd0df6be",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -688,7 +688,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             add_cell_dependency(self, task, reader, cell, task_id, &mut ctx);\n             return Ok(Ok(TypedCellContent(\n                 cell.type_id,\n-                CellContent(Some(content.1)),\n+                CellContent(Some(content.reference)),\n             )));\n         }\n \n@@ -2012,7 +2012,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n         let mut ctx = self.execute_context(turbo_tasks);\n         let task = ctx.task(task_id, TaskDataCategory::Data);\n         if let Some(content) = get!(task, CellData { cell }) {\n-            Ok(CellContent(Some(content.1.clone())).into_typed(cell.type_id))\n+            Ok(CellContent(Some(content.reference.clone())).into_typed(cell.type_id))\n         } else {\n             Ok(CellContent(None).into_typed(cell.type_id))\n         }"
        },
        {
            "sha": "2a2b852d79c671abd27341bbd0cf03f206ec8dde",
            "filename": "turbopack/crates/turbo-tasks-backend/src/data.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdata.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -702,7 +702,7 @@ impl CachedDataItemValueRef<'_> {\n         match self {\n             CachedDataItemValueRef::Output { value } => !value.is_transient(),\n             CachedDataItemValueRef::CellData { value } => {\n-                registry::get_value_type(value.0).is_serializable()\n+                registry::get_value_type(value.type_id).is_serializable()\n             }\n             _ => true,\n         }"
        },
        {
            "sha": "9961161c178c29fbfd453b72bda4e23aa833e25e",
            "filename": "turbopack/crates/turbo-tasks-build/src/lib.rs",
            "status": "modified",
            "additions": 26,
            "deletions": 9,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-build%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-build%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-build%2Fsrc%2Flib.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -16,9 +16,9 @@ use syn::{\n };\n use turbo_tasks_macros_shared::{\n     GenericTypeInput, PrimitiveInput, get_impl_function_ident, get_native_function_ident,\n-    get_path_ident, get_register_trait_methods_ident, get_register_value_type_ident,\n-    get_trait_default_impl_function_ident, get_trait_impl_function_ident, get_trait_type_ident,\n-    get_type_ident,\n+    get_path_ident, get_register_trait_impls_ident, get_register_trait_methods_ident,\n+    get_register_value_type_ident, get_trait_default_impl_function_ident,\n+    get_trait_impl_function_ident, get_trait_type_ident, get_type_ident,\n };\n \n pub fn generate_register() {\n@@ -154,12 +154,25 @@ pub fn generate_register() {\n                 entry.global_name,\n             )\n             .unwrap();\n-            for trait_ident in entry.trait_idents {\n+            // Register all the trait items for each impl so we can dispatch to them as turbotasks\n+            for trait_ident in &entry.trait_idents {\n                 writeln!(\n                     values_code,\n                     \"    crate{}::{}(value);\",\n                     mod_path,\n-                    get_register_trait_methods_ident(&trait_ident, &ident),\n+                    get_register_trait_methods_ident(trait_ident, &ident),\n+                )\n+                .unwrap();\n+            }\n+            writeln!(values_code, \"}}, #[allow(unused_variables)] |value_id| {{\").unwrap();\n+            // Register all the vtables for the impls so we can dispatch to them as normal indirect\n+            // trait calls.\n+            for trait_ident in &entry.trait_idents {\n+                writeln!(\n+                    values_code,\n+                    \"    crate{}::{}(value_id);\",\n+                    mod_path,\n+                    get_register_trait_impls_ident(trait_ident, &ident),\n                 )\n                 .unwrap();\n             }\n@@ -286,10 +299,12 @@ impl RegisterContext<'_> {\n             }\n \n             for item in &impl_item.items {\n-                if let syn::ImplItem::Fn(method_item) = item {\n-                    // TODO: if method_item.attrs.iter().any(|a|\n-                    // is_attribute(a,\n-                    // \"function\")) {\n+                if let syn::ImplItem::Fn(method_item) = item\n+                    && method_item\n+                        .attrs\n+                        .iter()\n+                        .any(|a| is_turbo_attribute(a, \"function\"))\n+                {\n                     let method_ident = &method_item.sig.ident;\n                     let function_type_ident = if let Some(trait_ident) = &trait_ident {\n                         get_trait_impl_function_ident(&struct_ident, trait_ident, method_ident)\n@@ -374,8 +389,10 @@ impl RegisterContext<'_> {\n                 if let TraitItem::Fn(TraitItemFn {\n                     default: Some(_),\n                     sig,\n+                    attrs,\n                     ..\n                 }) = item\n+                    && attrs.iter().any(|a| is_turbo_attribute(a, \"function\"))\n                 {\n                     let method_ident = &sig.ident;\n                     let function_type_ident ="
        },
        {
            "sha": "82f5e97d0f95dc8eec2386ac7473662b0af2b74c",
            "filename": "turbopack/crates/turbo-tasks-fetch/src/lib.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Flib.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -141,7 +141,7 @@ impl FetchError {\n     #[turbo_tasks::function]\n     pub async fn to_issue(\n         self: Vc<Self>,\n-        severity: ResolvedVc<IssueSeverity>,\n+        severity: IssueSeverity,\n         issue_context: ResolvedVc<FileSystemPath>,\n     ) -> Result<Vc<FetchIssue>> {\n         let this = &*self.await?;\n@@ -152,14 +152,14 @@ impl FetchError {\n             kind: this.kind,\n             detail: this.detail,\n         }\n-        .into())\n+        .cell())\n     }\n }\n \n #[turbo_tasks::value(shared)]\n pub struct FetchIssue {\n     pub issue_context: ResolvedVc<FileSystemPath>,\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub url: ResolvedVc<RcStr>,\n     pub kind: ResolvedVc<FetchErrorKind>,\n     pub detail: ResolvedVc<StyledString>,\n@@ -172,9 +172,8 @@ impl Issue for FetchIssue {\n         *self.issue_context\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "6a25f623197e18ed8c36ed6493d176a7d5344e7a",
            "filename": "turbopack/crates/turbo-tasks-fetch/tests/fetch.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -125,8 +125,8 @@ async fn errors_on_failed_connection() {\n         assert_eq!(*err.kind.await?, FetchErrorKind::Connect);\n         assert_eq!(*err.url.await?, url);\n \n-        let issue = err_vc.to_issue(IssueSeverity::Error.into(), get_issue_context());\n-        assert_eq!(*issue.severity().await?, IssueSeverity::Error);\n+        let issue = err_vc.to_issue(IssueSeverity::Error, get_issue_context());\n+        assert_eq!(issue.await?.severity(), IssueSeverity::Error);\n         assert_eq!(\n             *issue.description().await?.unwrap().await?,\n             StyledString::Text(rcstr!(\n@@ -159,8 +159,8 @@ async fn errors_on_404() {\n         assert!(matches!(*err.kind.await?, FetchErrorKind::Status(404)));\n         assert_eq!(*err.url.await?, url);\n \n-        let issue = err_vc.to_issue(IssueSeverity::Error.into(), get_issue_context());\n-        assert_eq!(*issue.severity().await?, IssueSeverity::Error);\n+        let issue = err_vc.to_issue(IssueSeverity::Error, get_issue_context());\n+        assert_eq!(issue.await?.severity(), IssueSeverity::Error);\n         assert_eq!(\n             *issue.description().await?.unwrap().await?,\n             StyledString::Text(RcStr::from(format!("
        },
        {
            "sha": "f3f4dd749ec4a1cf172aa073bf75ee6abcefc636",
            "filename": "turbopack/crates/turbo-tasks-macros-shared/src/ident.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2Fsrc%2Fident.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2Fsrc%2Fident.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-shared%2Fsrc%2Fident.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -15,6 +15,13 @@ pub fn get_register_trait_methods_ident(trait_ident: &Ident, struct_ident: &Iden\n     )\n }\n \n+pub fn get_register_trait_impls_ident(trait_ident: &Ident, struct_ident: &Ident) -> Ident {\n+    Ident::new(\n+        &format!(\"__register_{struct_ident}_{trait_ident}_trait_impls\"),\n+        trait_ident.span(),\n+    )\n+}\n+\n pub fn get_native_function_ident(ident: &Ident) -> Ident {\n     Ident::new(\n         &format!(\"{}_FUNCTION\", ident.to_string().to_uppercase()),\n@@ -212,6 +219,15 @@ pub fn get_trait_type_id_ident(ident: &Ident) -> Ident {\n         ident.span(),\n     )\n }\n+pub fn get_trait_type_vtable_registry(ident: &Ident) -> Ident {\n+    Ident::new(\n+        &format!(\n+            \"{}_TRAIT_TYPE_VTABLE_REGISTRY\",\n+            ident.to_string().to_uppercase()\n+        ),\n+        ident.span(),\n+    )\n+}\n \n pub fn get_trait_default_impl_function_id_ident(trait_ident: &Ident, ident: &Ident) -> Ident {\n     Ident::new("
        },
        {
            "sha": "54e38531e026243eab0cf19257f1e86b6a15f4ed",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/function/fail_attribute_invalid_args_inherent_impl.stderr",
            "status": "modified",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -3,17 +3,3 @@ error: unexpected token, expected one of: \"fs\", \"network\", \"operation\", \"local\"\n    |\n 14 |     #[turbo_tasks::function(invalid_argument)]\n    |                             ^^^^^^^^^^^^^^^^\n-\n-warning: unused import: `Vc`\n- --> tests/function/fail_attribute_invalid_args_inherent_impl.rs:4:31\n-  |\n-4 | use turbo_tasks::{ResolvedVc, Vc};\n-  |                               ^^\n-  |\n-  = note: `#[warn(unused_imports)]` on by default\n-\n-error[E0599]: no method named `return_contains_resolved_vc` found for struct `Vc<ExampleStruct>` in the current scope\n-  --> tests/function/fail_attribute_invalid_args_inherent_impl.rs:23:34\n-   |\n-23 |     let _ = ExampleStruct.cell().return_contains_resolved_vc();\n-   |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^ method not found in `Vc<ExampleStruct>`"
        },
        {
            "sha": "a3e6fe2559e7358e646b8d54f7121791506b2e8f",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/value_trait/fail_missing_function_annotation.stderr",
            "status": "modified",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Ffail_missing_function_annotation.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Ffail_missing_function_annotation.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Ffail_missing_function_annotation.stderr?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -3,17 +3,3 @@ error: trait items cannot be operations\n    |\n 13 |     #[turbo_tasks::function(operation)]\n    |                             ^^^^^^^^^\n-\n-error: #[turbo_tasks::function] attribute missing\n- --> tests/value_trait/fail_missing_function_annotation.rs:8:5\n-  |\n-8 |     fn item(&self) -> bool;\n-  |     ^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: #[turbo_tasks::function] attribute missing\n-  --> tests/value_trait/fail_missing_function_annotation.rs:22:5\n-   |\n-22 | /     fn item(&self) -> bool {\n-23 | |         true\n-24 | |     }\n-   | |_____^"
        },
        {
            "sha": "a2a35297591d89a65f6dcf42f82b99781d2c68af",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/value_trait/pass_trait_items.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Fpass_trait_items.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Fpass_trait_items.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Fvalue_trait%2Fpass_trait_items.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -5,8 +5,7 @@ use turbo_tasks::Vc;\n \n #[turbo_tasks::value_trait]\n trait MyTrait {\n-    #[turbo_tasks::function]\n-    fn item(&self) -> Vc<bool>;\n+    fn item(&self) -> bool;\n \n     #[turbo_tasks::function]\n     fn item2(&self) -> Vc<bool>;\n@@ -20,9 +19,8 @@ struct MyStruct;\n \n #[turbo_tasks::value_impl]\n impl MyTrait for MyStruct {\n-    #[turbo_tasks::function]\n-    fn item(&self) -> Vc<bool> {\n-        Vc::cell(true)\n+    fn item(&self) -> bool {\n+        true\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "212ede00c853f9ee22adf62db1a0fd9fae6887a2",
            "filename": "turbopack/crates/turbo-tasks-macros/src/func.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1214,17 +1214,16 @@ fn is_attribute(attr: &Attribute, name: &str) -> bool {\n \n /// Parses a `turbo_tasks::function` attribute out of the given attributes and then returns the\n /// remaining attributes.\n-pub fn split_function_attributes<'a>(\n-    item: &'a impl Spanned,\n-    attrs: &'a [Attribute],\n-) -> (syn::Result<FunctionArguments>, Vec<&'a Attribute>) {\n+pub fn split_function_attributes(\n+    attrs: &[Attribute],\n+) -> (syn::Result<Option<FunctionArguments>>, Vec<&Attribute>) {\n     let (func_attrs_vec, attrs): (Vec<_>, Vec<_>) = attrs\n         .iter()\n         // TODO(alexkirsz) Replace this with function\n         .partition(|attr| is_attribute(attr, \"function\"));\n     let func_args = if let Some(func_attr) = func_attrs_vec.first() {\n         if func_attrs_vec.len() == 1 {\n-            parse_with_optional_parens::<FunctionArguments>(func_attr)\n+            parse_with_optional_parens::<FunctionArguments>(func_attr).map(Some)\n         } else {\n             Err(syn::Error::new(\n                 // Report the error on the second annotation.\n@@ -1233,10 +1232,7 @@ pub fn split_function_attributes<'a>(\n             ))\n         }\n     } else {\n-        Err(syn::Error::new(\n-            item.span(),\n-            \"#[turbo_tasks::function] attribute missing\",\n-        ))\n+        Ok(None)\n     };\n     (func_args, attrs)\n }"
        },
        {
            "sha": "6c0f25b3b032ac5ea2061b67f1d3e6fa1518d113",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_impl_macro.rs",
            "status": "modified",
            "additions": 48,
            "deletions": 16,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -6,15 +6,17 @@ use syn::{\n     MetaNameValue, Path, Token, Type,\n     parse::{Parse, ParseStream},\n     parse_macro_input, parse_quote,\n+    spanned::Spanned,\n };\n use turbo_tasks_macros_shared::{\n     get_inherent_impl_function_id_ident, get_inherent_impl_function_ident, get_path_ident,\n-    get_register_trait_methods_ident, get_trait_impl_function_id_ident,\n-    get_trait_impl_function_ident, get_type_ident, is_self_used,\n+    get_register_trait_impls_ident, get_register_trait_methods_ident,\n+    get_trait_impl_function_id_ident, get_trait_impl_function_ident, get_type_ident, is_self_used,\n };\n \n use crate::func::{\n-    DefinitionContext, NativeFn, TurboFn, filter_inline_attributes, split_function_attributes,\n+    DefinitionContext, FunctionArguments, NativeFn, TurboFn, filter_inline_attributes,\n+    split_function_attributes,\n };\n \n struct ValueImplArguments {\n@@ -77,11 +79,20 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n             }) = item\n             {\n                 let ident = &sig.ident;\n-                let (func_args, attrs) = split_function_attributes(item, attrs);\n-                let Ok(func_args) =\n-                    func_args.inspect_err(|err| errors.push(err.to_compile_error()))\n-                else {\n-                    continue;\n+                let (func_args, attrs) = split_function_attributes(attrs);\n+                let func_args = match func_args {\n+                    Ok(None) => {\n+                        item.span()\n+                            .unwrap()\n+                            .error(\"#[turbo_tasks::function] attribute missing\")\n+                            .emit();\n+                        FunctionArguments::default()\n+                    }\n+                    Ok(Some(func_args)) => func_args,\n+                    Err(error) => {\n+                        errors.push(error.to_compile_error());\n+                        FunctionArguments::default()\n+                    }\n                 };\n                 let local = func_args.local.is_some();\n                 let is_self_used = func_args.operation.is_some() || is_self_used(block);\n@@ -169,10 +180,13 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n \n         let (impl_generics, _, where_clause) = generics.split_for_impl();\n \n-        let register = get_register_trait_methods_ident(&trait_ident, ty_ident);\n+        let register_trait_methods: Ident =\n+            get_register_trait_methods_ident(&trait_ident, ty_ident);\n+        let register_trait_impls: Ident = get_register_trait_impls_ident(&trait_ident, ty_ident);\n \n         let mut trait_registers = Vec::new();\n         let mut trait_functions = Vec::with_capacity(items.len());\n+        let mut trait_items = Vec::new();\n         let mut all_definitions = Vec::with_capacity(items.len());\n         let mut errors = Vec::new();\n \n@@ -183,13 +197,20 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n             {\n                 let ident = &sig.ident;\n \n-                let (func_args, attrs) = split_function_attributes(item, attrs);\n-                let Ok(func_args) =\n-                    func_args.inspect_err(|err| errors.push(err.to_compile_error()))\n-                else {\n-                    continue;\n+                let (func_args, attrs) = split_function_attributes(attrs);\n+                let func_args = match func_args {\n+                    Ok(None) => {\n+                        // Missing annotations are allowed if a turbo tasks trait has a trait item\n+                        // that is not a turbo tasks function.\n+                        trait_items.push(item);\n+                        continue;\n+                    }\n+                    Ok(Some(func_args)) => func_args,\n+                    Err(error) => {\n+                        errors.push(error.to_compile_error());\n+                        continue;\n+                    }\n                 };\n-\n                 let local = func_args.local.is_some();\n                 let is_self_used = func_args.operation.is_some() || is_self_used(block);\n \n@@ -280,17 +301,28 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n         quote! {\n             #[doc(hidden)]\n             #[allow(non_snake_case)]\n-            pub(crate) fn #register(value: &mut turbo_tasks::ValueType) {\n+            pub(crate) fn #register_trait_methods(value: &mut turbo_tasks::ValueType) {\n                 value.register_trait(<Box<dyn #trait_path> as turbo_tasks::VcValueTrait>::get_trait_type_id());\n                 #(#trait_registers)*\n             }\n+            #[doc(hidden)]\n+            #[allow(non_snake_case)]\n+            pub(crate) fn #register_trait_impls(value_id: turbo_tasks::ValueTypeId) {\n+                // NOTE(lukesandberg): This relies on the nightly ptr_metadata feature.  Alternatively\n+                // we could generate a function that does the downcasting and pass that up to register_trait.\n+                // This would avoid the nightly feature.\n+                let fat_pointer: *const dyn #trait_path = ::std::ptr::null::<#ty>() as *const dyn #trait_path;\n+                let metadata = turbo_tasks::macro_helpers::metadata(fat_pointer);\n+                turbo_tasks::macro_helpers::register_trait_impl::<dyn #trait_path, Box<dyn #trait_path>>(value_id, metadata);\n+            }\n \n             // NOTE(alexkirsz) We can't have a general `turbo_tasks::Upcast<Box<dyn Trait>> for T where T: Trait` because\n             // rustc complains: error[E0210]: type parameter `T` must be covered by another type when it appears before\n             // the first local type (`dyn Trait`).\n             unsafe impl #impl_generics turbo_tasks::Upcast<Box<dyn #trait_path>> for #ty #where_clause {}\n \n             impl #impl_generics #trait_path for #ty #where_clause {\n+                #(#trait_items)*\n                 #(#trait_functions)*\n             }\n "
        },
        {
            "sha": "03089f2b991510a77500c6d98c8a16c827033f82",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_macro.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -496,13 +496,14 @@ pub fn value_type_and_register(\n         #[allow(non_snake_case)]\n         pub(crate) fn #register_value_type_ident(\n             global_name: &'static str,\n-            f: impl FnOnce(&mut turbo_tasks::ValueType),\n+            init: impl FnOnce(&mut turbo_tasks::ValueType),\n+            register_traits: impl FnOnce(turbo_tasks::ValueTypeId),\n         ) {\n             #value_type_init_ident.get_or_init(|| {\n                 let mut value = #new_value_type;\n-                f(&mut value);\n+                init(&mut value);\n                 value\n-            }).register(global_name);\n+            }).register(global_name, register_traits);\n         }\n \n         unsafe impl #impl_generics turbo_tasks::VcValueType for #ty #where_clause {"
        },
        {
            "sha": "cfdd4306166c1c38e0b1ddc00ace20d7e5479502",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_trait_macro.rs",
            "status": "modified",
            "additions": 68,
            "deletions": 5,
            "changes": 73,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,11 +1,13 @@\n use proc_macro::TokenStream;\n use proc_macro2::{Ident, TokenStream as TokenStream2};\n use quote::{quote, quote_spanned};\n-use syn::{ItemTrait, TraitItem, TraitItemFn, parse_macro_input, parse_quote, spanned::Spanned};\n+use syn::{\n+    FnArg, ItemTrait, Pat, TraitItem, TraitItemFn, parse_macro_input, parse_quote, spanned::Spanned,\n+};\n use turbo_tasks_macros_shared::{\n     ValueTraitArguments, get_trait_default_impl_function_id_ident,\n     get_trait_default_impl_function_ident, get_trait_type_id_ident, get_trait_type_ident,\n-    is_self_used,\n+    get_trait_type_vtable_registry, is_self_used,\n };\n \n use crate::func::{\n@@ -65,6 +67,7 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n \n     let trait_type_ident = get_trait_type_ident(trait_ident);\n     let trait_type_id_ident = get_trait_type_id_ident(trait_ident);\n+    let trait_type_vtable_registry = get_trait_type_vtable_registry(trait_ident);\n     let mut dynamic_trait_fns = Vec::new();\n     let mut trait_methods: Vec<TokenStream2> = Vec::new();\n     let mut native_functions = Vec::new();\n@@ -89,10 +92,61 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n         let ident = &sig.ident;\n         // This effectively parses and removes the function annotation ensuring that that macro\n         // doesn't run after us.\n-        let (func_args, attrs) = split_function_attributes(item, attrs);\n-        let Ok(func_args) = func_args.inspect_err(|err| errors.push(err.to_compile_error())) else {\n-            continue;\n+        let (func_args, attrs) = split_function_attributes(attrs);\n+        let func_args = match func_args {\n+            Ok(None) => {\n+                // There is no turbo_tasks::function annotation, preserve this item\n+                items.push(item.clone());\n+                // But we still need to add a forwarding implementation to the\n+                // impl for `turbo_tasks::Dynamic<Box<dyn T>>`\n+                // This will have the same signature, but simply forward the call\n+                let mut args = Vec::new();\n+                for arg in &sig.inputs {\n+                    let ident = match arg {\n+                        FnArg::Receiver(_) => {\n+                            continue;\n+                        }\n+                        FnArg::Typed(pat) => match &*pat.pat {\n+                            Pat::Ident(pat_ident) => &pat_ident.ident,\n+                            // We could support more complex patterns without too much effort just\n+                            // as we do for normal functions.  For now we just disallow them.\n+                            _ => {\n+                                pat.span()\n+                                    .unwrap()\n+                                    .error(\"can only support simple patterns\")\n+                                    .emit();\n+                                continue;\n+                            }\n+                        },\n+                    };\n+                    args.push(ident);\n+                }\n+                // Add a dummy implementation that derefences the box and delegates to the\n+                // actual implementation.\n+                dynamic_trait_fns.push(if sig.asyncness.is_some() {\n+                    quote! {\n+                        #sig {\n+                            let reference: &dyn #trait_ident = &*self;\n+                            reference.#ident(#(#args),*).await\n+                        }\n+                    }\n+                } else {\n+                    quote! {\n+                        #sig {\n+                            let reference: &dyn #trait_ident = &*self;\n+                            reference.#ident(#(#args),*)\n+                        }\n+                    }\n+                });\n+                continue;\n+            }\n+            Ok(Some(func_args)) => func_args,\n+            Err(err) => {\n+                errors.push(err.to_compile_error());\n+                continue;\n+            }\n         };\n+\n         if let Some(span) = func_args.operation {\n             span.unwrap()\n                 .error(\"trait items cannot be operations\")\n@@ -243,11 +297,20 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n             turbo_tasks::macro_helpers::Lazy::new(|| {\n                 turbo_tasks::registry::get_trait_type_id(&#trait_type_ident)\n             });\n+        #[doc(hidden)]\n+        static #trait_type_vtable_registry: turbo_tasks::macro_helpers::Lazy<turbo_tasks::macro_helpers::VTableRegistry<dyn # trait_ident>> =\n+            turbo_tasks::macro_helpers::Lazy::new(turbo_tasks::macro_helpers::VTableRegistry::new);\n \n         impl turbo_tasks::VcValueTrait for Box<dyn #trait_ident> {\n+            type ValueTrait = dyn #trait_ident;\n+\n             fn get_trait_type_id() -> turbo_tasks::TraitTypeId {\n                 *#trait_type_id_ident\n             }\n+\n+            fn get_impl_vtables() -> &'static turbo_tasks::macro_helpers::VTableRegistry<Self::ValueTrait> {\n+                &*#trait_type_vtable_registry\n+            }\n         }\n \n         unsafe impl turbo_tasks::Dynamic<Box<dyn #trait_ident>> for Box<dyn #trait_ident> {}"
        },
        {
            "sha": "60ac70b8b5a9c7a9e782706a57b48a0759301150",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/trait_ref_cell.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -28,11 +28,10 @@ async fn trait_ref() {\n         assert_eq!(*counter_value.strongly_consistent().await?, 1);\n \n         // `ref_counter` will still point to the same `counter` instance as `counter`.\n-        let ref_counter = TraitRef::cell(\n-            Vc::upcast::<Box<dyn CounterTrait>>(counter)\n-                .into_trait_ref()\n-                .await?,\n-        );\n+        let trait_ref_counter = Vc::upcast::<Box<dyn CounterTrait>>(counter)\n+            .into_trait_ref()\n+            .await?;\n+        let ref_counter = TraitRef::cell(trait_ref_counter.clone());\n         let ref_counter_value = ref_counter.get_value();\n \n         // However, `local_counter_value` will point to the value of `counter_value`\n@@ -46,7 +45,7 @@ async fn trait_ref() {\n         .get_value();\n \n         counter.await?.incr();\n-\n+        assert_eq!(trait_ref_counter.get_value_sync().0, 2);\n         assert_eq!(*counter.get_value().strongly_consistent().await?, 2);\n         assert_eq!(*counter_value.strongly_consistent().await?, 2);\n         assert_eq!(*ref_counter_value.strongly_consistent().await?, 2);\n@@ -59,6 +58,7 @@ async fn trait_ref() {\n }\n \n #[turbo_tasks::value(transparent)]\n+#[derive(Copy, Clone)]\n struct CounterValue(usize);\n \n #[turbo_tasks::value(serialization = \"none\", cell = \"new\", eq = \"manual\")]\n@@ -81,6 +81,8 @@ impl Counter {\n trait CounterTrait {\n     #[turbo_tasks::function]\n     fn get_value(&self) -> Vc<CounterValue>;\n+\n+    fn get_value_sync(&self) -> CounterValue;\n }\n \n #[turbo_tasks::value_impl]\n@@ -91,6 +93,10 @@ impl CounterTrait for Counter {\n         lock.1 = Some(get_invalidator());\n         Ok(Vc::cell(lock.0))\n     }\n+\n+    fn get_value_sync(&self) -> CounterValue {\n+        CounterValue(self.value.lock().unwrap().0)\n+    }\n }\n \n #[turbo_tasks::value_trait]"
        },
        {
            "sha": "4c48f6b9676d983953b291dfc4ea0cf204f6d3bf",
            "filename": "turbopack/crates/turbo-tasks/src/backend.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fbackend.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -354,16 +354,16 @@ impl TypedCellContent {\n \n impl From<TypedSharedReference> for TypedCellContent {\n     fn from(value: TypedSharedReference) -> Self {\n-        TypedCellContent(value.0, CellContent(Some(value.1)))\n+        TypedCellContent(value.type_id, CellContent(Some(value.reference)))\n     }\n }\n \n impl TryFrom<TypedCellContent> for TypedSharedReference {\n     type Error = TypedCellContent;\n \n     fn try_from(content: TypedCellContent) -> Result<Self, TypedCellContent> {\n-        if let TypedCellContent(type_id, CellContent(Some(shared_reference))) = content {\n-            Ok(TypedSharedReference(type_id, shared_reference))\n+        if let TypedCellContent(type_id, CellContent(Some(reference))) = content {\n+            Ok(TypedSharedReference { type_id, reference })\n         } else {\n             Err(content)\n         }"
        },
        {
            "sha": "e7e2490c82539b3796cdff792c72bb1895bafa0e",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -36,6 +36,7 @@\n #![feature(new_zeroed_alloc)]\n #![feature(never_type)]\n #![feature(downcast_unchecked)]\n+#![feature(ptr_metadata)]\n \n pub mod backend;\n mod capture_future;"
        },
        {
            "sha": "7c0766689c7b823bf4d1092372e2cc37f9545233",
            "filename": "turbopack/crates/turbo-tasks/src/macro_helpers.rs",
            "status": "modified",
            "additions": 43,
            "deletions": 2,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmacro_helpers.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmacro_helpers.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmacro_helpers.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,14 +1,16 @@\n //! Runtime helpers for [turbo-tasks-macro].\n \n+use std::ptr::DynMetadata;\n+\n pub use async_trait::async_trait;\n pub use once_cell::sync::{Lazy, OnceCell};\n pub use serde;\n pub use shrink_to_fit;\n pub use tracing;\n \n use crate::{\n-    NonLocalValue, RawVc, TaskInput, TaskPersistence, Vc, debug::ValueDebugFormatString,\n-    task::TaskOutput,\n+    FxDashMap, NonLocalValue, RawVc, TaskInput, TaskPersistence, ValueTypeId, Vc, VcValueTrait,\n+    debug::ValueDebugFormatString, task::TaskOutput,\n };\n pub use crate::{\n     magic_any::MagicAny,\n@@ -61,3 +63,42 @@ macro_rules! stringify_path {\n         stringify!($path)\n     };\n }\n+\n+/// Rexport std::ptr::metadata so not every crate needs to enable the feature when they use our\n+/// macros.\n+#[inline(always)]\n+pub fn metadata<T: ?Sized>(ptr: *const T) -> <T as std::ptr::Pointee>::Metadata {\n+    // Ideally we would just `pub use std::ptr::metadata;` but this doesn't seem to work.\n+    std::ptr::metadata(ptr)\n+}\n+\n+/// A registry of all the impl vtables for a given VcValue trait\n+/// This is constructed in the macro gencode and populated by the registry.\n+#[derive(Default)]\n+pub struct VTableRegistry<T: ?Sized> {\n+    map: FxDashMap<ValueTypeId, std::ptr::DynMetadata<T>>,\n+}\n+\n+impl<T: ?Sized> VTableRegistry<T> {\n+    pub fn new() -> Self {\n+        Self {\n+            map: FxDashMap::default(),\n+        }\n+    }\n+\n+    pub(crate) fn register(&self, id: ValueTypeId, vtable: std::ptr::DynMetadata<T>) {\n+        let prev = self.map.insert(id, vtable);\n+        debug_assert!(prev.is_none(), \"{id} was already registered\");\n+    }\n+\n+    pub(crate) fn get(&self, id: ValueTypeId) -> DynMetadata<T> {\n+        *self.map.get(&id).unwrap().value()\n+    }\n+}\n+\n+pub fn register_trait_impl<V: 'static + ?Sized, T: VcValueTrait<ValueTrait = V>>(\n+    id: ValueTypeId,\n+    metadata: std::ptr::DynMetadata<V>,\n+) {\n+    <T as VcValueTrait>::get_impl_vtables().register(id, metadata);\n+}"
        },
        {
            "sha": "29a2b030554a76ab96d2c0c13a4ffe512f468dbc",
            "filename": "turbopack/crates/turbo-tasks/src/registry.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fregistry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fregistry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fregistry.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -41,6 +41,7 @@ static TRAIT_TYPES_BY_VALUE: Lazy<FxDashMap<&'static TraitType, TraitTypeId>> =\n     Lazy::new(FxDashMap::default);\n static TRAIT_TYPES: Lazy<NoMoveVec<(&'static TraitType, &'static str)>> = Lazy::new(NoMoveVec::new);\n \n+/// Registers the value and returns its id if this is the initial\n fn register_thing<\n     K: Copy + Deref<Target = u32> + TryFrom<NonZeroU64>,\n     V: Copy + Hash + Eq,\n@@ -52,7 +53,7 @@ fn register_thing<\n     store: &NoMoveVec<(V, &'static str), INITIAL_CAPACITY_BITS>,\n     map_by_name: &FxDashMap<&'static str, K>,\n     map_by_value: &FxDashMap<V, K>,\n-) {\n+) -> Option<K> {\n     if let Entry::Vacant(e) = map_by_value.entry(value) {\n         let new_id = id_factory.get();\n         // SAFETY: this is a fresh id\n@@ -61,6 +62,9 @@ fn register_thing<\n         }\n         map_by_name.insert(global_name, new_id);\n         e.insert(new_id);\n+        Some(new_id)\n+    } else {\n+        None\n     }\n }\n \n@@ -84,7 +88,7 @@ pub fn register_function(global_name: &'static str, func: &'static NativeFunctio\n         &FUNCTIONS,\n         &FUNCTIONS_BY_NAME,\n         &FUNCTIONS_BY_VALUE,\n-    )\n+    );\n }\n \n pub fn get_function_id(func: &'static NativeFunction) -> FunctionId {\n@@ -103,7 +107,10 @@ pub fn get_function_global_name(id: FunctionId) -> &'static str {\n     FUNCTIONS.get(*id as usize).unwrap().1\n }\n \n-pub fn register_value_type(global_name: &'static str, ty: &'static ValueType) {\n+pub fn register_value_type(\n+    global_name: &'static str,\n+    ty: &'static ValueType,\n+) -> Option<ValueTypeId> {\n     register_thing(\n         global_name,\n         ty,\n@@ -138,7 +145,7 @@ pub fn register_trait_type(global_name: &'static str, ty: &'static TraitType) {\n         &TRAIT_TYPES,\n         &TRAIT_TYPES_BY_NAME,\n         &TRAIT_TYPES_BY_VALUE,\n-    )\n+    );\n }\n \n pub fn get_trait_type_id(func: &'static TraitType) -> TraitTypeId {"
        },
        {
            "sha": "cd63e25a9fea3dc3f0a2e6602296380fab341d03",
            "filename": "turbopack/crates/turbo-tasks/src/task/shared_reference.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Fshared_reference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Fshared_reference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Fshared_reference.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -26,7 +26,10 @@ impl SharedReference {\n \n /// A reference to a piece of data with type information\n #[derive(Clone, Hash, PartialEq, Eq, PartialOrd, Ord, Debug)]\n-pub struct TypedSharedReference(pub ValueTypeId, pub SharedReference);\n+pub struct TypedSharedReference {\n+    pub type_id: ValueTypeId,\n+    pub reference: SharedReference,\n+}\n \n impl SharedReference {\n     pub fn downcast<T: Any + Send + Sync>(self) -> Result<triomphe::Arc<T>, Self> {\n@@ -41,21 +44,24 @@ impl SharedReference {\n     }\n \n     pub fn into_typed(self, type_id: ValueTypeId) -> TypedSharedReference {\n-        TypedSharedReference(type_id, self)\n+        TypedSharedReference {\n+            type_id,\n+            reference: self,\n+        }\n     }\n }\n \n impl TypedSharedReference {\n     pub fn into_untyped(self) -> SharedReference {\n-        self.1\n+        self.reference\n     }\n }\n \n impl Deref for TypedSharedReference {\n     type Target = SharedReference;\n \n     fn deref(&self) -> &Self::Target {\n-        &self.1\n+        &self.reference\n     }\n }\n \n@@ -97,7 +103,10 @@ impl Serialize for TypedSharedReference {\n     where\n         S: serde::Serializer,\n     {\n-        let TypedSharedReference(ty, SharedReference(arc)) = self;\n+        let TypedSharedReference {\n+            type_id: ty,\n+            reference: SharedReference(arc),\n+        } = self;\n         let value_type = registry::get_value_type(*ty);\n         if let Some(serializable) = value_type.any_as_serializable(arc) {\n             let mut t = serializer.serialize_tuple(2)?;\n@@ -121,7 +130,11 @@ impl Display for SharedReference {\n \n impl Display for TypedSharedReference {\n     fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n-        write!(f, \"value of type {}\", registry::get_value_type(self.0).name)\n+        write!(\n+            f,\n+            \"value of type {}\",\n+            registry::get_value_type(self.type_id).name\n+        )\n     }\n }\n \n@@ -149,7 +162,10 @@ impl<'de> Deserialize<'de> for TypedSharedReference {\n                         {\n                             if let Some(value) = seq.next_element_seed(seed)? {\n                                 let arc = triomphe::Arc::<dyn Any + Send + Sync>::from(value);\n-                                Ok(TypedSharedReference(ty, SharedReference(arc)))\n+                                Ok(TypedSharedReference {\n+                                    type_id: ty,\n+                                    reference: SharedReference(arc),\n+                                })\n                             } else {\n                                 Err(serde::de::Error::invalid_length(\n                                     1,"
        },
        {
            "sha": "00b4a973262b364d8d9b1db8bd64788c8cb70dbd",
            "filename": "turbopack/crates/turbo-tasks/src/trait_ref.rs",
            "status": "modified",
            "additions": 42,
            "deletions": 2,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftrait_ref.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftrait_ref.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftrait_ref.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -72,6 +72,43 @@ impl<'de, T> Deserialize<'de> for TraitRef<T> {\n     }\n }\n \n+// This is a workaround for https://github.com/rust-lang/rust-analyzer/issues/19971\n+// that ensures type inference keeps working with ptr_metadata.\n+\n+#[cfg(rust_analyzer)]\n+impl<U> std::ops::Deref for TraitRef<Box<U>>\n+where\n+    U: ?Sized,\n+    Box<U>: VcValueTrait,\n+{\n+    type Target = U;\n+\n+    fn deref(&self) -> &Self::Target {\n+        unimplemented!(\"only exists for rust-analyzer type inference\")\n+    }\n+}\n+\n+#[cfg(not(rust_analyzer))]\n+impl<U> std::ops::Deref for TraitRef<Box<U>>\n+where\n+    Box<U>: VcValueTrait<ValueTrait = U>,\n+    U: std::ptr::Pointee<Metadata = std::ptr::DynMetadata<U>> + ?Sized,\n+{\n+    type Target = U;\n+\n+    fn deref(&self) -> &Self::Target {\n+        // This lookup will fail if the value type stored does not actually implement the trait,\n+        // which implies a bug in either the registry code or the macro code.\n+        let metadata =\n+            <Box<U> as VcValueTrait>::get_impl_vtables().get(self.shared_reference.type_id);\n+        let downcast_ptr = std::ptr::from_raw_parts(\n+            self.shared_reference.reference.0.as_ptr() as *const (),\n+            metadata,\n+        );\n+        unsafe { &*downcast_ptr }\n+    }\n+}\n+\n // Otherwise, TraitRef<Box<dyn Trait>> would not be Sync.\n // SAFETY: TraitRef doesn't actually contain a T.\n unsafe impl<T> Sync for TraitRef<T> where T: ?Sized {}\n@@ -94,7 +131,10 @@ where\n     }\n \n     pub fn ptr_eq(this: &Self, other: &Self) -> bool {\n-        triomphe::Arc::ptr_eq(&this.shared_reference.1.0, &other.shared_reference.1.0)\n+        triomphe::Arc::ptr_eq(\n+            &this.shared_reference.reference.0,\n+            &other.shared_reference.reference.0,\n+        )\n     }\n }\n \n@@ -108,7 +148,7 @@ where\n         let TraitRef {\n             shared_reference, ..\n         } = trait_ref;\n-        let value_type = get_value_type(shared_reference.0);\n+        let value_type = get_value_type(shared_reference.type_id);\n         (value_type.raw_cell)(shared_reference).into()\n     }\n }"
        },
        {
            "sha": "c88c31f96543534c820d8d027e43d01f95e121c5",
            "filename": "turbopack/crates/turbo-tasks/src/value_type.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,9 +1,7 @@\n use std::{\n     any::{Any, type_name},\n     borrow::Cow,\n-    fmt::{\n-        Debug, Display, Formatter, {self},\n-    },\n+    fmt::{self, Debug, Display, Formatter},\n     hash::Hash,\n     sync::Arc,\n };\n@@ -38,7 +36,7 @@ type RawCellFactoryFn = fn(TypedSharedReference) -> RawVc;\n pub struct ValueType {\n     /// A readable name of the type\n     pub name: String,\n-    /// List of traits available\n+    /// Set of traits available\n     pub traits: AutoSet<TraitTypeId>,\n     /// List of trait methods available\n     pub trait_methods: AutoMap<(TraitTypeId, Cow<'static, str>), FunctionId>,\n@@ -191,11 +189,18 @@ impl ValueType {\n     }\n \n     pub fn traits_iter(&self) -> impl Iterator<Item = TraitTypeId> + '_ {\n-        self.traits.iter().copied()\n+        self.traits.iter().cloned()\n     }\n \n-    pub fn register(&'static self, global_name: &'static str) {\n-        register_value_type(global_name, self)\n+    pub fn register(\n+        &'static self,\n+        global_name: &'static str,\n+        register_traits: impl FnOnce(crate::ValueTypeId),\n+    ) {\n+        let id = register_value_type(global_name, self);\n+        if let Some(id) = id {\n+            register_traits(id);\n+        }\n     }\n }\n "
        },
        {
            "sha": "4e1e602dd106e4bcee9f6af70559a9cff7e76ce8",
            "filename": "turbopack/crates/turbo-tasks/src/vc/cell_mode.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fcell_mode.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fcell_mode.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fcell_mode.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -46,8 +46,8 @@ where\n \n     fn raw_cell(content: TypedSharedReference) -> RawVc {\n         debug_assert_repr::<T>(&content);\n-        let cell = find_cell_by_type(content.0);\n-        cell.update_with_shared_reference(content.1);\n+        let cell = find_cell_by_type(content.type_id);\n+        cell.update_with_shared_reference(content.reference);\n         cell.into()\n     }\n }\n@@ -73,15 +73,15 @@ where\n \n     fn raw_cell(content: TypedSharedReference) -> RawVc {\n         debug_assert_repr::<T>(&content);\n-        let cell = find_cell_by_type(content.0);\n-        cell.compare_and_update_with_shared_reference::<T>(content.1);\n+        let cell = find_cell_by_type(content.type_id);\n+        cell.compare_and_update_with_shared_reference::<T>(content.reference);\n         cell.into()\n     }\n }\n \n fn debug_assert_repr<T: VcValueType>(content: &TypedSharedReference) {\n     debug_assert!(\n-        (*content.1.0).is::<VcReadRepr<T>>(),\n+        (*content.reference.0).is::<VcReadRepr<T>>(),\n         \"SharedReference for type {} must use representation type {}\",\n         type_name::<T>(),\n         type_name::<VcReadRepr<T>>(),"
        },
        {
            "sha": "41d9274c8ac2772ad475d73abd33ffc886f86f53",
            "filename": "turbopack/crates/turbo-tasks/src/vc/traits.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,5 +1,6 @@\n use crate::{\n-    NonLocalValue, ShrinkToFit, TraitTypeId, ValueTypeId, VcRead, vc::cell_mode::VcCellMode,\n+    NonLocalValue, ShrinkToFit, TraitTypeId, ValueTypeId, VcRead, macro_helpers::VTableRegistry,\n+    vc::cell_mode::VcCellMode,\n };\n \n /// A trait implemented on all values types that can be put into a Value Cell\n@@ -26,7 +27,15 @@ pub unsafe trait VcValueType: ShrinkToFit + Sized + Send + Sync + 'static {\n /// A trait implemented on all values trait object references that can be put\n /// into a Value Cell ([`Vc<Box<dyn Trait>>`][crate::Vc]).\n pub trait VcValueTrait: NonLocalValue + Send + Sync + 'static {\n+    // The conrete type of the value_trait implementing VcValueTrait\n+    type ValueTrait: ?Sized;\n+\n+    /// Returns the type id of the trait object.\n     fn get_trait_type_id() -> TraitTypeId;\n+\n+    /// Returns the vtable for an implementation of this trait.\n+    /// Panics if ValueTypeId does not implement the trait.\n+    fn get_impl_vtables() -> &'static VTableRegistry<Self::ValueTrait>;\n }\n \n /// Marker trait that indicates that a [`Vc<Self>`][crate::Vc] can be upcasted"
        },
        {
            "sha": "7d49baa9e0300f714995818295dca7fa1902a8d3",
            "filename": "turbopack/crates/turbopack-browser/src/react_refresh.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -80,9 +80,8 @@ pub struct ReactRefreshResolvingIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for ReactRefreshResolvingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "14511be30130a44905d05f19cba0c100f46f7c01",
            "filename": "turbopack/crates/turbopack-cli-utils/src/issue.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -430,7 +430,7 @@ impl IssueReporter for ConsoleUi {\n         &self,\n         issues: TransientInstance<CapturedIssues>,\n         source: TransientValue<RawVc>,\n-        min_failing_severity: Vc<IssueSeverity>,\n+        min_failing_severity: IssueSeverity,\n     ) -> Result<Vc<bool>> {\n         let issues = &*issues;\n         let LogOptions {\n@@ -466,7 +466,7 @@ impl IssueReporter for ConsoleUi {\n             }\n \n             let severity = plain_issue.severity;\n-            if severity <= *min_failing_severity.await? {\n+            if severity <= min_failing_severity {\n                 has_fatal = true;\n             }\n "
        },
        {
            "sha": "6ecf86c8dd74cd8d8c300d79c238535b19cb6936",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -170,7 +170,7 @@ impl TurbopackBuildBuilder {\n             handle_issues(\n                 build_result_op,\n                 issue_reporter,\n-                IssueSeverity::Error.into(),\n+                IssueSeverity::Error,\n                 None,\n                 None,\n             )"
        },
        {
            "sha": "49844eebf8a957f74b42ab00b96033aedbf35981",
            "filename": "turbopack/crates/turbopack-core/src/issue/analyze.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fanalyze.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fanalyze.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fanalyze.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -11,7 +11,7 @@ use crate::ident::AssetIdent;\n \n #[turbo_tasks::value(shared)]\n pub struct AnalyzeIssue {\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub source_ident: ResolvedVc<AssetIdent>,\n     pub title: ResolvedVc<RcStr>,\n     pub message: ResolvedVc<StyledString>,\n@@ -31,7 +31,7 @@ impl AnalyzeIssue {\n         source: Option<IssueSource>,\n     ) -> Vc<Self> {\n         Self {\n-            severity: severity.resolved_cell(),\n+            severity,\n             source_ident,\n             title,\n             message,\n@@ -44,9 +44,8 @@ impl AnalyzeIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for AnalyzeIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "e16de9dd188671239c80fd8e3ef9a48ae08772f8",
            "filename": "turbopack/crates/turbopack-core/src/issue/code_gen.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fcode_gen.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fcode_gen.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fcode_gen.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -5,17 +5,16 @@ use super::{Issue, IssueSeverity, IssueStage, OptionStyledString, StyledString};\n \n #[turbo_tasks::value(shared)]\n pub struct CodeGenerationIssue {\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub path: ResolvedVc<FileSystemPath>,\n     pub title: ResolvedVc<StyledString>,\n     pub message: ResolvedVc<StyledString>,\n }\n \n #[turbo_tasks::value_impl]\n impl Issue for CodeGenerationIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "518119ed940021ddb37afe88e75dfb3b6642255c",
            "filename": "turbopack/crates/turbopack-core/src/issue/mod.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -15,9 +15,9 @@ use auto_hash_map::AutoSet;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    CollectiblesSource, NonLocalValue, OperationVc, RawVc, ReadRef, ResolvedVc, TaskInput,\n-    TransientInstance, TransientValue, TryJoinIterExt, Upcast, ValueDefault, ValueToString, Vc,\n-    emit, trace::TraceRawVcs,\n+    CollectiblesSource, IntoTraitRef, NonLocalValue, OperationVc, RawVc, ReadRef, ResolvedVc,\n+    TaskInput, TransientInstance, TransientValue, TryJoinIterExt, Upcast, ValueDefault,\n+    ValueToString, Vc, emit, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{FileContent, FileLine, FileLinesContent, FileSystem, FileSystemPath};\n use turbo_tasks_hash::{DeterministicHash, Xxh3Hash64Hasher};\n@@ -104,9 +104,8 @@ pub enum StyledString {\n pub trait Issue {\n     /// Severity allows the user to filter out unimportant issues, with Bug\n     /// being the highest priority and Info being the lowest.\n-    #[turbo_tasks::function]\n-    fn severity(self: Vc<Self>) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     /// The file path that generated the issue, displayed to the user as message\n@@ -860,9 +859,12 @@ impl PlainIssue {\n             Some(detail) => Some((*detail.await?).clone()),\n             None => None,\n         };\n+        let trait_ref = issue.into_trait_ref().await?;\n+\n+        let severity = trait_ref.severity();\n \n         Ok(Self::cell(Self {\n-            severity: *issue.severity().await?,\n+            severity,\n             file_path: issue.file_path().to_string().owned().await?,\n             stage: issue.stage().owned().await?,\n             title: issue.title().owned().await?,\n@@ -974,7 +976,7 @@ pub trait IssueReporter {\n         self: Vc<Self>,\n         issues: TransientInstance<CapturedIssues>,\n         source: TransientValue<RawVc>,\n-        min_failing_severity: Vc<IssueSeverity>,\n+        min_failing_severity: IssueSeverity,\n     ) -> Vc<bool>;\n }\n \n@@ -1118,7 +1120,7 @@ where\n pub async fn handle_issues<T: Send>(\n     source_op: OperationVc<T>,\n     issue_reporter: Vc<Box<dyn IssueReporter>>,\n-    min_failing_severity: Vc<IssueSeverity>,\n+    min_failing_severity: IssueSeverity,\n     path: Option<&str>,\n     operation: Option<&str>,\n ) -> Result<()> {"
        },
        {
            "sha": "3bd76e644dfc18edeca27b6ff5d5a0c7c9fbe386",
            "filename": "turbopack/crates/turbopack-core/src/issue/resolve.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fresolve.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -17,7 +17,7 @@ use crate::{\n \n #[turbo_tasks::value(shared)]\n pub struct ResolvingIssue {\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub request_type: String,\n     pub request: ResolvedVc<Request>,\n     pub file_path: ResolvedVc<FileSystemPath>,\n@@ -28,9 +28,8 @@ pub struct ResolvingIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for ResolvingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "af664d486c5efa04ca67411469d4c0a381cebf20",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -3105,9 +3105,9 @@ async fn emit_resolve_error_issue(\n     source: Option<IssueSource>,\n ) -> Result<()> {\n     let severity = if is_optional || resolve_options.await?.loose_errors {\n-        IssueSeverity::Warning.resolved_cell()\n+        IssueSeverity::Warning\n     } else {\n-        IssueSeverity::Error.resolved_cell()\n+        IssueSeverity::Error\n     };\n     ResolvingIssue {\n         severity,\n@@ -3132,9 +3132,9 @@ async fn emit_unresolvable_issue(\n     source: Option<IssueSource>,\n ) -> Result<()> {\n     let severity = if is_optional || resolve_options.await?.loose_errors {\n-        IssueSeverity::Warning.resolved_cell()\n+        IssueSeverity::Warning\n     } else {\n-        IssueSeverity::Error.resolved_cell()\n+        IssueSeverity::Error\n     };\n     ResolvingIssue {\n         severity,\n@@ -3150,11 +3150,11 @@ async fn emit_unresolvable_issue(\n     Ok(())\n }\n \n-async fn error_severity(resolve_options: Vc<ResolveOptions>) -> Result<ResolvedVc<IssueSeverity>> {\n+async fn error_severity(resolve_options: Vc<ResolveOptions>) -> Result<IssueSeverity> {\n     Ok(if resolve_options.await?.loose_errors {\n-        IssueSeverity::Warning.resolved_cell()\n+        IssueSeverity::Warning\n     } else {\n-        IssueSeverity::Error.resolved_cell()\n+        IssueSeverity::Error\n     })\n }\n "
        },
        {
            "sha": "c7fb868c84b8c7e760d68051c64347c6cb4b0989",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -328,7 +328,7 @@ impl EcmascriptChunkItem for ModuleChunkItem {\n \n                         let Some(resolved_module) = &*resolved_module else {\n                             CssModuleComposesIssue {\n-                                severity: IssueSeverity::Error.resolved_cell(),\n+                                severity: IssueSeverity::Error,\n                                 source: self.module.ident().to_resolved().await?,\n                                 message: formatdoc! {\n                                     r#\"\n@@ -344,7 +344,7 @@ impl EcmascriptChunkItem for ModuleChunkItem {\n                             ResolvedVc::try_downcast_type::<ModuleCssAsset>(*resolved_module)\n                         else {\n                             CssModuleComposesIssue {\n-                                severity: IssueSeverity::Error.resolved_cell(),\n+                                severity: IssueSeverity::Error,\n                                     source: self.module.ident().to_resolved().await?,\n                                 message: formatdoc! {\n                                     r#\"\n@@ -429,16 +429,15 @@ fn generate_minimal_source_map(filename: String, source: String) -> Result<Rope>\n \n #[turbo_tasks::value(shared)]\n struct CssModuleComposesIssue {\n-    severity: ResolvedVc<IssueSeverity>,\n+    severity: IssueSeverity,\n     source: ResolvedVc<AssetIdent>,\n     message: RcStr,\n }\n \n #[turbo_tasks::value_impl]\n impl Issue for CssModuleComposesIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "ba0215a4465a34e94b897fbf9352fdca36ccada4",
            "filename": "turbopack/crates/turbopack-dev-server/src/http.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -89,7 +89,7 @@ pub async fn process_request_with_content_source(\n     handle_issues(\n         result_op,\n         issue_reporter,\n-        IssueSeverity::Fatal.cell(),\n+        IssueSeverity::Fatal,\n         Some(&original_path),\n         Some(\"get_from_source_operation\"),\n     )"
        },
        {
            "sha": "1f37c63b89d0c93f199bdc4f175a3c4f8ad330d5",
            "filename": "turbopack/crates/turbopack-dev-server/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Flib.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -219,7 +219,7 @@ impl DevServerBuilder {\n                             handle_issues(\n                                 source_op,\n                                 issue_reporter,\n-                                IssueSeverity::Fatal.cell(),\n+                                IssueSeverity::Fatal,\n                                 Some(&path),\n                                 Some(\"get source\"),\n                             )"
        },
        {
            "sha": "da7d7feb99d08cfb02e8534c6f5185ef6f10b882",
            "filename": "turbopack/crates/turbopack-dev-server/src/update/stream.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -5,7 +5,7 @@ use futures::prelude::*;\n use tokio::sync::mpsc::Sender;\n use tokio_stream::wrappers::ReceiverStream;\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     IntoTraitRef, NonLocalValue, OperationVc, ReadRef, ResolvedVc, TransientInstance, Vc,\n     trace::{TraceRawVcs, TraceRawVcsContext},\n@@ -379,9 +379,8 @@ struct FatalStreamIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for FatalStreamIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Fatal.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Fatal\n     }\n \n     #[turbo_tasks::function]\n@@ -396,7 +395,7 @@ impl Issue for FatalStreamIssue {\n \n     #[turbo_tasks::function]\n     fn title(&self) -> Vc<StyledString> {\n-        StyledString::Text(\"Fatal error while getting content to stream\".into()).cell()\n+        StyledString::Text(rcstr!(\"Fatal error while getting content to stream\")).cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "044e49c87654a9081f27155e98c26181c2b4084c",
            "filename": "turbopack/crates/turbopack-ecmascript-plugins/src/transform/swc_ecma_transform_plugins.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Fswc_ecma_transform_plugins.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Fswc_ecma_transform_plugins.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Fswc_ecma_transform_plugins.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -55,9 +55,8 @@ struct UnsupportedSwcEcmaTransformPluginsIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for UnsupportedSwcEcmaTransformPluginsIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]\n@@ -81,11 +80,10 @@ impl Issue for UnsupportedSwcEcmaTransformPluginsIssue {\n     #[turbo_tasks::function]\n     fn description(&self) -> Vc<OptionStyledString> {\n         Vc::cell(Some(\n-            StyledString::Text(\n+            StyledString::Text(rcstr!(\n                 \"Turbopack does not yet support running SWC EcmaScript transform plugins on this \\\n                  platform.\"\n-                    .into(),\n-            )\n+            ))\n             .resolved_cell(),\n         ))\n     }"
        },
        {
            "sha": "7a42f5acb913e75d424c73249fc192f133a00011",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -273,7 +273,7 @@ async fn module_factory_with_code_generation_issue(\n                 let error_message = format!(\"{}\", PrettyPrintError(&error)).into();\n                 let js_error_message = serde_json::to_string(&error_message)?;\n                 CodeGenerationIssue {\n-                    severity: IssueSeverity::Error.resolved_cell(),\n+                    severity: IssueSeverity::Error,\n                     path: chunk_item.asset_ident().path().to_resolved().await?,\n                     title: StyledString::Text(rcstr!(\"Code generation for chunk item errored\"))\n                         .resolved_cell(),"
        },
        {
            "sha": "7752edf2242084197f13f739c62dadff4386dc62",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/placeable.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fplaceable.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -141,9 +141,8 @@ impl Issue for SideEffectsInPackageJsonIssue {\n         IssueStage::Parse.into()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.cell()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "f7545147470a0a2efc62c6359306586020f3ee6d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/parse.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -536,9 +536,8 @@ impl Issue for ReadSourceIssue {\n         ))\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.cell()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "977b88a609fe84c213786d188e17299315947eb9",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/base.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -455,9 +455,8 @@ pub struct InvalidExport {\n \n #[turbo_tasks::value_impl]\n impl Issue for InvalidExport {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "669158e87bf20e41c4e0f3e2a92929216b2f85a7",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/pattern_mapping.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -341,7 +341,7 @@ async fn to_single_pattern_mapping(\n         | ModuleResolveResultItem::Custom(_) => {\n             // TODO implement mapping\n             CodeGenerationIssue {\n-                severity: IssueSeverity::Bug.resolved_cell(),\n+                severity: IssueSeverity::Bug,\n                 title: StyledString::Text(\n                     \"pattern mapping is not implemented for this result\".into(),\n                 )\n@@ -374,7 +374,7 @@ async fn to_single_pattern_mapping(\n         }\n     }\n     CodeGenerationIssue {\n-        severity: IssueSeverity::Bug.resolved_cell(),\n+        severity: IssueSeverity::Bug,\n         title: StyledString::Text(\"non-ecmascript placeable asset\".into()).resolved_cell(),\n         message: StyledString::Text(\n             \"asset is not placeable in ESM chunks, so it doesn't have a module id\".into(),"
        },
        {
            "sha": "b418d71d7ce48622f1996512e78fba7931011f19",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/type_issue.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftype_issue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftype_issue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftype_issue.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -70,12 +70,11 @@ impl Issue for SpecifiedModuleTypeIssue {\n         ))\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n+    fn severity(&self) -> IssueSeverity {\n         match self.specified_type {\n-            SpecifiedModuleType::CommonJs => IssueSeverity::Error.cell(),\n-            SpecifiedModuleType::EcmaScript => IssueSeverity::Warning.cell(),\n-            SpecifiedModuleType::Automatic => IssueSeverity::Hint.cell(),\n+            SpecifiedModuleType::CommonJs => IssueSeverity::Error,\n+            SpecifiedModuleType::EcmaScript => IssueSeverity::Warning,\n+            SpecifiedModuleType::Automatic => IssueSeverity::Hint,\n         }\n     }\n "
        },
        {
            "sha": "4e5838a85c3ff5c3f502a51852c7668f090d66f3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/worker.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -70,7 +70,7 @@ impl WorkerAssetReference {\n         };\n         let Some(chunkable) = ResolvedVc::try_downcast::<Box<dyn ChunkableModule>>(module) else {\n             CodeGenerationIssue {\n-                severity: IssueSeverity::Bug.resolved_cell(),\n+                severity: IssueSeverity::Bug,\n                 title: StyledString::Text(rcstr!(\"non-ecmascript placeable asset\")).resolved_cell(),\n                 message: StyledString::Text(rcstr!(\"asset is not placeable in ESM chunks\"))\n                     .resolved_cell(),"
        },
        {
            "sha": "56730db35220ef580f42b08bb939aa5b8aeac34a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/transform/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -298,9 +298,8 @@ pub struct UnsupportedServerActionIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for UnsupportedServerActionIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Error.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Error\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "a0ab69b13da20be55135432abbc6fe716bd3dfd0",
            "filename": "turbopack/crates/turbopack-image/src/process/mod.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-image%2Fsrc%2Fprocess%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-image%2Fsrc%2Fprocess%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-image%2Fsrc%2Fprocess%2Fmod.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -172,7 +172,7 @@ fn load_image_internal(\n             )\n             .resolved_cell(),\n             title: Some(StyledString::Text(rcstr!(\"AVIF image not supported\")).resolved_cell()),\n-            issue_severity: Some(IssueSeverity::Warning.resolved_cell()),\n+            issue_severity: Some(IssueSeverity::Warning),\n         }\n         .resolved_cell()\n         .emit();\n@@ -190,7 +190,7 @@ fn load_image_internal(\n             )\n             .resolved_cell(),\n             title: Some(StyledString::Text(rcstr!(\"WEBP image not supported\")).resolved_cell()),\n-            issue_severity: Some(IssueSeverity::Warning.resolved_cell()),\n+            issue_severity: Some(IssueSeverity::Warning),\n         }\n         .resolved_cell()\n         .emit();\n@@ -489,16 +489,13 @@ struct ImageProcessingIssue {\n     path: ResolvedVc<FileSystemPath>,\n     message: ResolvedVc<StyledString>,\n     title: Option<ResolvedVc<StyledString>>,\n-    issue_severity: Option<ResolvedVc<IssueSeverity>>,\n+    issue_severity: Option<IssueSeverity>,\n }\n \n #[turbo_tasks::value_impl]\n impl Issue for ImageProcessingIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        self.issue_severity\n-            .map(|s| *s)\n-            .unwrap_or(IssueSeverity::Error.into())\n+    fn severity(&self) -> IssueSeverity {\n+        self.issue_severity.unwrap_or(IssueSeverity::Error)\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "584bd29790385ff13f306d90576cbcceb9122293",
            "filename": "turbopack/crates/turbopack-node/src/transforms/postcss.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -563,7 +563,7 @@ impl PostCssTransformedAsset {\n struct PostCssTransformIssue {\n     source: ResolvedVc<FileSystemPath>,\n     description: RcStr,\n-    severity: ResolvedVc<IssueSeverity>,\n+    severity: IssueSeverity,\n     title: RcStr,\n }\n \n@@ -586,9 +586,8 @@ impl Issue for PostCssTransformIssue {\n         ))\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "4a79c54f71df4ab7f6519e782832f610ed6b0823",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 14,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -538,7 +538,7 @@ impl EvaluateContext for WebpackLoaderContext {\n                 EvaluateEmittedErrorIssue {\n                     file_path: self.context_ident_for_issue.path().to_resolved().await?,\n                     error,\n-                    severity: severity.resolved_cell(),\n+                    severity,\n                     assets_for_source_mapping: pool.assets_for_source_mapping,\n                     assets_root: pool.assets_root,\n                     project_dir: self.chunking_context.root_path().to_resolved().await?,\n@@ -621,9 +621,9 @@ impl EvaluateContext for WebpackLoaderContext {\n                 file_path: self.context_ident_for_issue.path().to_resolved().await?,\n                 logging: logs,\n                 severity: if has_errors {\n-                    IssueSeverity::Error.resolved_cell()\n+                    IssueSeverity::Error\n                 } else {\n-                    IssueSeverity::Warning.resolved_cell()\n+                    IssueSeverity::Warning\n                 },\n                 assets_for_source_mapping: pool.assets_for_source_mapping,\n                 assets_root: pool.assets_root,\n@@ -728,9 +728,8 @@ pub struct BuildDependencyIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for BuildDependencyIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]\n@@ -769,7 +768,7 @@ impl Issue for BuildDependencyIssue {\n #[turbo_tasks::value(shared)]\n pub struct EvaluateEmittedErrorIssue {\n     pub file_path: ResolvedVc<FileSystemPath>,\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub error: StructuredError,\n     pub assets_for_source_mapping: ResolvedVc<AssetsForSourceMapping>,\n     pub assets_root: ResolvedVc<FileSystemPath>,\n@@ -788,9 +787,8 @@ impl Issue for EvaluateEmittedErrorIssue {\n         IssueStage::Transform.cell()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]\n@@ -820,7 +818,7 @@ impl Issue for EvaluateEmittedErrorIssue {\n #[turbo_tasks::value(shared)]\n pub struct EvaluateErrorLoggingIssue {\n     pub file_path: ResolvedVc<FileSystemPath>,\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     #[turbo_tasks(trace_ignore)]\n     pub logging: Vec<LogInfo>,\n     pub assets_for_source_mapping: ResolvedVc<AssetsForSourceMapping>,\n@@ -840,9 +838,8 @@ impl Issue for EvaluateErrorLoggingIssue {\n         IssueStage::Transform.cell()\n     }\n \n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "72b68ea8cfc6258c13b32e5af216890b130c6a31",
            "filename": "turbopack/crates/turbopack-resolve/src/typescript.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -31,7 +31,7 @@ use crate::ecmascript::get_condition_maps;\n \n #[turbo_tasks::value(shared)]\n pub struct TsConfigIssue {\n-    pub severity: ResolvedVc<IssueSeverity>,\n+    pub severity: IssueSeverity,\n     pub source_ident: ResolvedVc<AssetIdent>,\n     pub message: RcStr,\n }\n@@ -72,7 +72,7 @@ pub async fn read_tsconfigs(\n                     write!(message, \"{e}\")?;\n                 }\n                 TsConfigIssue {\n-                    severity: IssueSeverity::Error.resolved_cell(),\n+                    severity: IssueSeverity::Error,\n                     source_ident: tsconfig.ident().to_resolved().await?,\n                     message: message.into(),\n                 }\n@@ -81,7 +81,7 @@ pub async fn read_tsconfigs(\n             }\n             FileJsonContent::NotFound => {\n                 TsConfigIssue {\n-                    severity: IssueSeverity::Error.resolved_cell(),\n+                    severity: IssueSeverity::Error,\n                     source_ident: tsconfig.ident().to_resolved().await?,\n                     message: rcstr!(\"tsconfig not found\"),\n                 }\n@@ -98,7 +98,7 @@ pub async fn read_tsconfigs(\n                         continue;\n                     } else {\n                         TsConfigIssue {\n-                            severity: IssueSeverity::Error.resolved_cell(),\n+                            severity: IssueSeverity::Error,\n                             source_ident: tsconfig.ident().to_resolved().await?,\n                             message: format!(\"extends: \\\"{extends}\\\" doesn't resolve correctly\")\n                                 .into(),\n@@ -295,7 +295,7 @@ pub async fn tsconfig_resolve_options(\n                     );\n                 } else {\n                     TsConfigIssue {\n-                        severity: IssueSeverity::Warning.resolved_cell(),\n+                        severity: IssueSeverity::Warning,\n                         source_ident: source.ident().to_resolved().await?,\n                         message: format!(\n                             \"compilerOptions.paths[{key}] doesn't contains an array as \\\n@@ -501,9 +501,8 @@ async fn apply_typescript_types_options(\n \n #[turbo_tasks::value_impl]\n impl Issue for TsConfigIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        *self.severity\n+    fn severity(&self) -> IssueSeverity {\n+        self.severity\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "fd6dd69230fca5b6ee65cd761ffb5828c91c2863",
            "filename": "turbopack/crates/turbopack/src/unsupported_sass.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs?ref=1d2c31d5907fb5d9c4ed0bfbf73b2430f27c48a7",
            "patch": "@@ -1,6 +1,7 @@\n //! TODO(WEB-741) Remove this file once Sass is supported.\n \n use anyhow::Result;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n use turbopack_core::{\n@@ -64,17 +65,16 @@ struct UnsupportedSassModuleIssue {\n \n #[turbo_tasks::value_impl]\n impl Issue for UnsupportedSassModuleIssue {\n-    #[turbo_tasks::function]\n-    fn severity(&self) -> Vc<IssueSeverity> {\n-        IssueSeverity::Warning.into()\n+    fn severity(&self) -> IssueSeverity {\n+        IssueSeverity::Warning\n     }\n \n     #[turbo_tasks::function]\n     async fn title(&self) -> Result<Vc<StyledString>> {\n         Ok(StyledString::Text(\n             format!(\n                 \"Unsupported Sass request: {}\",\n-                self.request.await?.request().as_deref().unwrap_or(\"N/A\")\n+                self.request.await?.request().unwrap_or(rcstr!(\"N/A\"))\n             )\n             .into(),\n         )\n@@ -89,8 +89,10 @@ impl Issue for UnsupportedSassModuleIssue {\n     #[turbo_tasks::function]\n     fn description(&self) -> Vc<OptionStyledString> {\n         Vc::cell(Some(\n-            StyledString::Text(\"Turbopack does not yet support importing Sass modules.\".into())\n-                .resolved_cell(),\n+            StyledString::Text(rcstr!(\n+                \"Turbopack does not yet support importing Sass modules.\"\n+            ))\n+            .resolved_cell(),\n         ))\n     }\n "
        }
    ],
    "stats": {
        "total": 817,
        "additions": 507,
        "deletions": 310
    }
}