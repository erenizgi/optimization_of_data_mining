{
    "author": "sokra",
    "message": "Turbopack: run unit tests in multi threaded runtime (#82665)\n\n### What?\n\nrun unit tests in multi threaded runtime\n\nfix cache hit tracking",
    "sha": "5033dcb9d3820317c7a79326228fe5834a68d5b0",
    "files": [
        {
            "sha": "793631379585c1ac37f6633af0c77133f21587ff",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -1267,7 +1267,6 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             return task_id;\n         }\n \n-        self.track_cache_miss(&task_type);\n         let tx = self\n             .should_restore()\n             .then(|| self.backing_storage.start_read_transaction())\n@@ -1279,6 +1278,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n                     .forward_lookup_task_cache(tx.as_ref(), &task_type)\n                     .expect(\"Failed to lookup task id\")\n             } {\n+                self.track_cache_hit(&task_type);\n                 let _ = self.task_cache.try_insert(Arc::new(task_type), task_id);\n                 task_id\n             } else {\n@@ -1287,12 +1287,14 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n                 let task_id = if let Err(existing_task_id) =\n                     self.task_cache.try_insert(task_type.clone(), task_id)\n                 {\n+                    self.track_cache_hit(&task_type);\n                     // Safety: We just created the id and failed to insert it.\n                     unsafe {\n                         self.persisted_task_id_factory.reuse(task_id);\n                     }\n                     existing_task_id\n                 } else {\n+                    self.track_cache_miss(&task_type);\n                     task_id\n                 };\n                 if let Some(log) = &self.persisted_task_cache_log {\n@@ -1327,10 +1329,10 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             return task_id;\n         }\n \n-        self.track_cache_miss(&task_type);\n         let task_type = Arc::new(task_type);\n         let task_id = self.transient_task_id_factory.get();\n-        if let Err(existing_task_id) = self.task_cache.try_insert(task_type, task_id) {\n+        if let Err(existing_task_id) = self.task_cache.try_insert(task_type.clone(), task_id) {\n+            self.track_cache_hit(&task_type);\n             // Safety: We just created the id and failed to insert it.\n             unsafe {\n                 self.transient_task_id_factory.reuse(task_id);\n@@ -1339,6 +1341,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             return existing_task_id;\n         }\n \n+        self.track_cache_miss(&task_type);\n         self.connect_child(parent_task, task_id, turbo_tasks);\n \n         task_id"
        },
        {
            "sha": "add31c32ecd358cb6f50aaac62de0921b96d58a8",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/all_in_one.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -9,7 +9,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn all_in_one() {\n     run(&REGISTRATION, || async {\n         let a: Vc<u32> = Vc::cell(4242);"
        },
        {
            "sha": "a22cb96ade456c3284206a7f67ea181eda9a3652",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/basic.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbasic.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbasic.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbasic.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn basic() {\n     run(&REGISTRATION, || async {\n         let output1 = func_without_args();"
        },
        {
            "sha": "5d225bdb8c48e8c3af7cdf74316a69e846e78631",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/bug.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -24,7 +24,7 @@ struct TaskSpec {\n #[turbo_tasks::value(transparent)]\n struct TasksSpec(Vec<TaskSpec>);\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn graph_bug() {\n     // see https://github.com/vercel/next.js/pull/79451\n     run(&REGISTRATION, || async {"
        },
        {
            "sha": "a1495eeeca91bae792374014b11611cb8c797224",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/bug2.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug2.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug2.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fbug2.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -33,7 +33,7 @@ pub struct TaskSpec {\n #[turbo_tasks::value(transparent)]\n struct Iteration(State<usize>);\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn graph_bug() {\n     run(&REGISTRATION, move || async move {\n         let spec = vec!["
        },
        {
            "sha": "f06430ada2bd0ce6afc525bcffca794e270f24eb",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/call_types.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcall_types.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcall_types.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcall_types.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn functions() {\n     run(&REGISTRATION, || async {\n         assert_eq!(*fn_plain().await?, 42);\n@@ -53,7 +53,7 @@ async fn async_fn_vc_arg(n: Vc<u32>) -> Result<Vc<u32>> {\n     Ok(Vc::cell(*n.await?))\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn methods() {\n     run(&REGISTRATION, || async {\n         assert_eq!(*Value::static_method().await?, 42);\n@@ -106,7 +106,7 @@ impl Value {\n     }\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn trait_methods() {\n     run(&REGISTRATION, || async {\n         assert_eq!(*Value::static_trait_method().await?, 42);"
        },
        {
            "sha": "945845a86e3a2490b5f833c6f080bf4b01aa4fef",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/collectibles.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcollectibles.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcollectibles.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fcollectibles.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -14,7 +14,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn transitive_emitting() {\n     run(&REGISTRATION, || async {\n         let result_op = my_transitive_emitting_function(rcstr!(\"\"), rcstr!(\"\"));\n@@ -32,7 +32,7 @@ async fn transitive_emitting() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn transitive_emitting_indirect() {\n     run(&REGISTRATION, || async {\n         let result_op = my_transitive_emitting_function(rcstr!(\"\"), rcstr!(\"\"));\n@@ -50,7 +50,7 @@ async fn transitive_emitting_indirect() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn multi_emitting() {\n     run(&REGISTRATION, || async {\n         let result_op = my_multi_emitting_function();\n@@ -68,7 +68,7 @@ async fn multi_emitting() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn taking_collectibles() {\n     run(&REGISTRATION, || async {\n         let result_op = my_collecting_function();\n@@ -84,7 +84,7 @@ async fn taking_collectibles() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn taking_collectibles_extra_layer() {\n     run(&REGISTRATION, || async {\n         let result_op = my_collecting_function_indirect();\n@@ -100,7 +100,7 @@ async fn taking_collectibles_extra_layer() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn taking_collectibles_parallel() {\n     run(&REGISTRATION, || async {\n         let result_op = my_transitive_emitting_function(rcstr!(\"\"), rcstr!(\"a\"));\n@@ -142,7 +142,7 @@ async fn taking_collectibles_parallel() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn taking_collectibles_with_resolve() {\n     run(&REGISTRATION, || async {\n         let result_op = my_transitive_emitting_function_with_resolve(rcstr!(\"resolve\"));"
        },
        {
            "sha": "ccc833eeb85d8b820c31fb12a565a8a8d397c3ea",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/debug.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdebug.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdebug.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdebug.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -9,7 +9,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn primitive_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<u32> = Vc::cell(42);\n@@ -20,7 +20,7 @@ async fn primitive_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn transparent_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<Transparent> = Transparent(42).cell();\n@@ -32,7 +32,7 @@ async fn transparent_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn enum_none_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<Enum> = Enum::None.cell();\n@@ -44,7 +44,7 @@ async fn enum_none_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn enum_transparent_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<Enum> = Enum::Transparent(Transparent(42).resolved_cell()).cell();\n@@ -60,7 +60,7 @@ async fn enum_transparent_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn enum_inner_vc_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<Enum> = Enum::Enum(Enum::None.resolved_cell()).cell();\n@@ -76,7 +76,7 @@ async fn enum_inner_vc_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn struct_unit_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<StructUnit> = StructUnit.cell();\n@@ -87,7 +87,7 @@ async fn struct_unit_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn struct_transparent_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<StructWithTransparent> = StructWithTransparent {\n@@ -106,7 +106,7 @@ async fn struct_transparent_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn struct_vec_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<StructWithVec> = StructWithVec { vec: vec![] }.cell();\n@@ -135,7 +135,7 @@ async fn struct_vec_debug() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn struct_ignore_debug() {\n     run(&REGISTRATION, || async {\n         let a: Vc<StructWithIgnore> = StructWithIgnore {"
        },
        {
            "sha": "b1c80929fad6aab584f41dca42c620f4b85e5b2a",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/detached.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdetached.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdetached.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdetached.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -15,7 +15,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_spawns_detached() -> anyhow::Result<()> {\n     run(&REGISTRATION, || async {\n         // HACK: The watch channel we use has an incorrect implementation of `TraceRawVcs`, just\n@@ -82,7 +82,7 @@ async fn spawns_detached(\n     Vc::cell(())\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_spawns_detached_changing() -> anyhow::Result<()> {\n     run(&REGISTRATION, || async {\n         // HACK: The watch channel we use has an incorrect implementation of `TraceRawVcs`"
        },
        {
            "sha": "89aa8998fae808a4b3e0d9a26aee3251875567dd",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/dirty_in_progress.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdirty_in_progress.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdirty_in_progress.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fdirty_in_progress.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -11,7 +11,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn dirty_in_progress() {\n     run(&REGISTRATION, || async {\n         let cases = ["
        },
        {
            "sha": "87c2d6672e468160242e2406a327e42eec227fd1",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/emptied_cells.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Femptied_cells.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Femptied_cells.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Femptied_cells.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn recompute() {\n     run(&REGISTRATION, || async {\n         let input = ChangingInput {"
        },
        {
            "sha": "31933821102152421aec2f84e5e21cd30f75a4a8",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/filter_unused_args.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ffilter_unused_args.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ffilter_unused_args.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ffilter_unused_args.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn filtered_trait_method_args() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let uses_arg = UsesArg.cell();"
        },
        {
            "sha": "0c716c7544744d3717c7bdd0bf63aa1e895d460f",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/immutable.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fimmutable.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fimmutable.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fimmutable.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn hidden_mutate() {\n     run(&REGISTRATION, || async {\n         let input = create_input().resolve().await?;"
        },
        {
            "sha": "f66363d374635e8db5c672736382823195c43f75",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/local_tasks.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Flocal_tasks.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Flocal_tasks.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Flocal_tasks.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_local_task_id() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let local_vc = get_local_task_id();"
        },
        {
            "sha": "457971d0667c7d893ae9ede21f3d595f65a81c8c",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/operation_vc.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Foperation_vc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Foperation_vc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Foperation_vc.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -26,7 +26,7 @@ fn use_operations() -> Vc<i32> {\n     forty_two.connect()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_use_operations() -> Result<()> {\n     run(&REGISTRATION, || async {\n         assert_eq!(*use_operations().await?, 42);"
        },
        {
            "sha": "8b9458ab4f046d08fce33af8f1b75d3a292d5881",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/panics.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fpanics.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -25,7 +25,7 @@ static FILE_PATH_REGEX: LazyLock<Regex> =\n //\n // This test depends on the process-wide global panic handler. This test must be run in its own\n // process in isolation of any other tests.\n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_panic_hook() {\n     let prev_hook = take_hook();\n     set_hook(Box::new(move |info| {"
        },
        {
            "sha": "13b76582af6330c1c27bdc2c6be812dce68cdf64",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/performance.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fperformance.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fperformance.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fperformance.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -142,7 +142,7 @@ fn check_skip() -> bool {\n     false\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_many_children() {\n     if check_skip() {\n         return;\n@@ -157,7 +157,7 @@ async fn many_calls_to_many_children() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_uncached_many_children() {\n     if check_skip() {\n         return;\n@@ -189,7 +189,7 @@ fn run_big_graph_test(counts: Vec<u32>) -> impl Future<Output = Result<()>> + Se\n     )\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_1() {\n     if check_skip() {\n         return;\n@@ -199,7 +199,7 @@ async fn many_calls_to_big_graph_1() {\n         .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_2() {\n     if check_skip() {\n         return;\n@@ -211,7 +211,7 @@ async fn many_calls_to_big_graph_2() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_3() {\n     if check_skip() {\n         return;\n@@ -221,7 +221,7 @@ async fn many_calls_to_big_graph_3() {\n         .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_4() {\n     if check_skip() {\n         return;\n@@ -231,7 +231,7 @@ async fn many_calls_to_big_graph_4() {\n         .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_5() {\n     if check_skip() {\n         return;\n@@ -243,7 +243,7 @@ async fn many_calls_to_big_graph_5() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_6() {\n     if check_skip() {\n         return;\n@@ -255,7 +255,7 @@ async fn many_calls_to_big_graph_6() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_7() {\n     if check_skip() {\n         return;\n@@ -270,7 +270,7 @@ async fn many_calls_to_big_graph_7() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_8() {\n     if check_skip() {\n         return;\n@@ -282,7 +282,7 @@ async fn many_calls_to_big_graph_8() {\n     .unwrap();\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn many_calls_to_big_graph_9() {\n     if check_skip() {\n         return;"
        },
        {
            "sha": "089490ab1c79ce60ff94ec0a0d231a52fca966f5",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/random_change.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frandom_change.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frandom_change.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frandom_change.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -9,7 +9,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn random_change() {\n     run(&REGISTRATION, || async {\n         let state = make_state();"
        },
        {
            "sha": "ac8b7f8583aea75cbda9445f92fbd2d652a58571",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/read_ref_cell.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fread_ref_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fread_ref_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fread_ref_cell.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -10,7 +10,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn read_ref() {\n     run(&REGISTRATION, || async {\n         let counter = Counter::cell(Counter {"
        },
        {
            "sha": "dcad783b06e08c5da6b9c85243e84bdccd355e89",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/recompute.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn recompute() {\n     run(&REGISTRATION, || async {\n         let input = ChangingInput {\n@@ -58,7 +58,7 @@ async fn recompute() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn immutable_analysis() {\n     run(&REGISTRATION, || async {\n         let input = ChangingInput {"
        },
        {
            "sha": "d7c0be301ac7077e8ccc3326e44fd57c4826c44d",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/recompute_collectibles.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute_collectibles.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute_collectibles.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Frecompute_collectibles.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -9,7 +9,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn recompute() {\n     run(&REGISTRATION, || async {\n         let input = ChangingInput::new(1).resolve().await?;"
        },
        {
            "sha": "a0b9914b7f8bb9802678e235b72f4360614abd9f",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/resolved_vc.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fresolved_vc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fresolved_vc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fresolved_vc.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -23,7 +23,7 @@ fn assert_resolved(input: ResolvedVc<u32>) {\n     assert!(input_vc.is_resolved());\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_conversion() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let unresolved: Vc<u32> = Vc::cell(42);\n@@ -38,7 +38,7 @@ async fn test_conversion() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_cell_construction() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let a: ResolvedVc<u32> = ResolvedVc::cell(42);\n@@ -50,7 +50,7 @@ async fn test_cell_construction() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_resolved_vc_as_arg() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let unresolved: Vc<u32> = returns_int(42);\n@@ -62,7 +62,7 @@ async fn test_resolved_vc_as_arg() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_into_future() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let mut resolved = ResolvedVc::cell(42);\n@@ -78,7 +78,7 @@ async fn test_into_future() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_sidecast() -> Result<()> {\n     run(&REGISTRATION, || async {\n         let concrete_value = ImplementsAAndB.resolved_cell();"
        },
        {
            "sha": "dc82e82174de5f216f9755fd0c76f8ddda5a5162",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/shrink_to_fit.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fshrink_to_fit.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fshrink_to_fit.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fshrink_to_fit.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -11,7 +11,7 @@ static REGISTRATION: Registration = register!();\n #[turbo_tasks::value(transparent)]\n struct Wrapper(Vec<u32>);\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_shrink_to_fit() -> Result<()> {\n     run(&REGISTRATION, || async {\n         // `Vec::shrink_to_fit` is implicitly called when a cell is constructed."
        },
        {
            "sha": "869c944bcb5c7c8e16d05590fc647ccb00168034",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/task_statistics.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -13,7 +13,7 @@ use turbo_tasks_testing::{Registration, register, run_without_cache_check};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_simple_task() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n@@ -39,7 +39,7 @@ async fn test_simple_task() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_await_same_vc_multiple_times() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n@@ -61,7 +61,7 @@ async fn test_await_same_vc_multiple_times() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_vc_receiving_task() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n@@ -93,7 +93,7 @@ async fn test_vc_receiving_task() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_trait_methods() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n@@ -130,7 +130,7 @@ async fn test_trait_methods() -> Result<()> {\n     .await\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_dyn_trait_methods() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n@@ -174,7 +174,7 @@ async fn test_dyn_trait_methods() -> Result<()> {\n }\n \n // creates Vcs, but doesn't ever execute them\n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_no_execution() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();"
        },
        {
            "sha": "f553a83a52c5b96a38d42846f41545698353b9ef",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/trace_transient.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrace_transient.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -18,7 +18,7 @@ Adder::add_method (read cell of type turbo-tasks@TODO::::primitives::u64)\n     unknown transient task (read cell of type turbo-tasks@TODO::::primitives::u16)\n     unknown transient task (read cell of type turbo-tasks@TODO::::primitives::u32)\";\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_trace_transient() {\n     let result = run_without_cache_check(&REGISTRATION, async {\n         read_incorrect_task_input_operation(IncorrectTaskInput("
        },
        {
            "sha": "237294730336008f7a66fcf9145bf94f48b141ea",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/trait_ref_cell.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -10,7 +10,7 @@ use turbo_tasks_testing::{Registration, register, run};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn trait_ref() {\n     run(&REGISTRATION, || async {\n         let counter = Counter::cell(Counter {"
        },
        {
            "sha": "3b8d1cb15c02acc2b39f49546105c4a03b0f7a2b",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/trait_ref_cell_mode.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -9,7 +9,7 @@ static REGISTRATION: Registration = register!();\n \n // Test that with `cell = \"shared\"`, the cell will be re-used as long as the\n // value is equal.\n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_trait_ref_shared_cell_mode() {\n     run(&REGISTRATION, || async {\n         let input = CellIdSelector {\n@@ -44,7 +44,7 @@ async fn test_trait_ref_shared_cell_mode() {\n \n // Test that with `cell = \"new\"`, the cell will is never re-used, even if the\n // value is equal.\n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_trait_ref_new_cell_mode() {\n     run(&REGISTRATION, || async {\n         let input = CellIdSelector {"
        },
        {
            "sha": "b144319ed4763725cf8265bca4ec9cccc25ff5d7",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/transient_collectible.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_collectible.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -10,7 +10,7 @@ static REGISTRATION: Registration = register!();\n const EXPECTED_MSG: &str =\n     \"Collectible is transient, transient collectibles cannot be emitted from persistent tasks\";\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_transient_emit_from_persistent() {\n     let result = run_without_cache_check(&REGISTRATION, async {\n         emit_incorrect_task_input_operation(IncorrectTaskInput(U32Wrapper(123).resolved_cell()))"
        },
        {
            "sha": "100008c755c5cb2673fd3bcdc9f2078c812cd903",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/transient_vc.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_vc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_vc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftransient_vc.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -7,7 +7,7 @@ use turbo_tasks_testing::{Registration, register, run_without_cache_check};\n \n static REGISTRATION: Registration = register!();\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn test_transient_vc() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async {\n         test_transient_operation(TransientValue::new(123))"
        },
        {
            "sha": "b44f2a3a00522d3cef9e57023d89454d8b207f51",
            "filename": "turbopack/crates/turbo-tasks-fetch/tests/fetch.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Ftests%2Ffetch.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -18,7 +18,7 @@ static REGISTRATION: Registration = register!(turbo_tasks_fetch::register);\n /// acquire and hold this lock to prevent potential flakiness.\n static GLOBAL_TEST_LOCK: TokioMutex<()> = TokioMutex::const_new(());\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn basic_get() {\n     let _guard = GLOBAL_TEST_LOCK.lock().await;\n     run(&REGISTRATION, || async {\n@@ -49,7 +49,7 @@ async fn basic_get() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn sends_user_agent() {\n     let _guard = GLOBAL_TEST_LOCK.lock().await;\n     run(&REGISTRATION, || async {\n@@ -85,7 +85,7 @@ async fn sends_user_agent() {\n \n // This is temporary behavior.\n // TODO: Implement invalidation that respects Cache-Control headers.\n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn invalidation_does_not_invalidate() {\n     let _guard = GLOBAL_TEST_LOCK.lock().await;\n     run(&REGISTRATION, || async {\n@@ -130,7 +130,7 @@ fn get_issue_context() -> Vc<FileSystemPath> {\n     DiskFileSystem::new(rcstr!(\"root\"), rcstr!(\"/\")).root()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn errors_on_failed_connection() {\n     let _guard = GLOBAL_TEST_LOCK.lock().await;\n     run(&REGISTRATION, || async {\n@@ -161,7 +161,7 @@ async fn errors_on_failed_connection() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn errors_on_404() {\n     let _guard = GLOBAL_TEST_LOCK.lock().await;\n     run(&REGISTRATION, || async {\n@@ -196,7 +196,7 @@ async fn errors_on_404() {\n     .unwrap()\n }\n \n-#[tokio::test]\n+#[tokio::test(flavor = \"multi_thread\")]\n async fn client_cache() {\n     // a simple fetch that should always succeed\n     async fn simple_fetch(path: &str, client: FetchClient) -> anyhow::Result<()> {"
        },
        {
            "sha": "8f4b0aa3d00be02b4e51b7428603f9af34d6792d",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 39,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5033dcb9d3820317c7a79326228fe5834a68d5b0/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=5033dcb9d3820317c7a79326228fe5834a68d5b0",
            "patch": "@@ -272,7 +272,7 @@ fn test_cases() {}\n \n #[apply(test_cases)]\n fn node_file_trace_noop_backing_storage(#[case] input: CaseInput) {\n-    node_file_trace(input, \"noop_backing_storage\", false, 1, 120, |_| {\n+    node_file_trace(input, \"noop_backing_storage\", 1, 120, |_| {\n         TurboTasks::new(TurboTasksBackend::new(\n             turbo_tasks_backend::BackendOptions::default(),\n             turbo_tasks_backend::noop_backing_storage(),\n@@ -282,7 +282,7 @@ fn node_file_trace_noop_backing_storage(#[case] input: CaseInput) {\n \n #[apply(test_cases)]\n fn node_file_trace_persistent(#[case] input: CaseInput) {\n-    node_file_trace(input, \"persistent_cache\", false, 2, 240, |directory_path| {\n+    node_file_trace(input, \"persistent_cache\", 2, 240, |directory_path| {\n         TurboTasks::new(TurboTasksBackend::new(\n             turbo_tasks_backend::BackendOptions::default(),\n             turbo_tasks_backend::default_backing_storage(\n@@ -302,31 +302,18 @@ fn node_file_trace_persistent(#[case] input: CaseInput) {\n \n #[cfg(feature = \"bench_against_node_nft\")]\n #[apply(test_cases)]\n-fn bench_against_node_nft_st(#[case] input: CaseInput) {\n-    bench_against_node_nft_inner(input, false);\n+fn bench_against_node_nft(#[case] input: CaseInput) {\n+    bench_against_node_nft_inner(input);\n }\n \n #[cfg(feature = \"bench_against_node_nft\")]\n-#[apply(test_cases)]\n-fn bench_against_node_nft_mt(#[case] input: CaseInput) {\n-    bench_against_node_nft_inner(input, true);\n-}\n-\n-#[cfg(feature = \"bench_against_node_nft\")]\n-fn bench_against_node_nft_inner(input: CaseInput, multi_threaded: bool) {\n-    node_file_trace(\n-        input,\n-        \"noop_backing_storage\",\n-        multi_threaded,\n-        1,\n-        120,\n-        |_| {\n-            TurboTasks::new(TurboTasksBackend::new(\n-                turbo_tasks_backend::BackendOptions::default(),\n-                turbo_tasks_backend::noop_backing_storage(),\n-            ))\n-        },\n-    );\n+fn bench_against_node_nft_inner(input: CaseInput) {\n+    node_file_trace(input, \"noop_backing_storage\", 1, 120, |_| {\n+        TurboTasks::new(TurboTasksBackend::new(\n+            turbo_tasks_backend::BackendOptions::default(),\n+            turbo_tasks_backend::noop_backing_storage(),\n+        ))\n+    });\n }\n \n #[turbo_tasks::function(operation)]\n@@ -401,7 +388,6 @@ fn node_file_trace<B: Backend + 'static>(\n         expected_stderr,\n     }: CaseInput,\n     mode: &str,\n-    multi_threaded: bool,\n     run_count: i32,\n     timeout_len: u64,\n     create_turbo_tasks: impl Fn(&Path) -> Arc<TurboTasks<B>>,\n@@ -410,15 +396,9 @@ fn node_file_trace<B: Backend + 'static>(\n         LazyLock::new(|| Arc::new(Mutex::new(Vec::new())));\n \n     let r = &mut {\n-        let mut builder = if multi_threaded {\n-            tokio::runtime::Builder::new_multi_thread()\n-        } else {\n-            tokio::runtime::Builder::new_current_thread()\n-        };\n+        let mut builder = tokio::runtime::Builder::new_multi_thread();\n         builder.enable_all();\n-        if !multi_threaded {\n-            builder.max_blocking_threads(20);\n-        }\n+        builder.max_blocking_threads(20);\n         builder.build().unwrap()\n     };\n     r.block_on(async move {\n@@ -490,12 +470,7 @@ fn node_file_trace<B: Backend + 'static>(\n                         bench_suites_lock.push(BenchSuite {\n                             suite: input\n                                 .trim_start_matches(\"node-file-trace/integration/\")\n-                                .to_string()\n-                                + (if multi_threaded {\n-                                    \" (multi-threaded)\"\n-                                } else {\n-                                    \"\"\n-                                }),\n+                                .to_string(),\n                             is_faster,\n                             rust_duration,\n                             node_duration,"
        }
    ],
    "stats": {
        "total": 206,
        "additions": 92,
        "deletions": 114
    }
}