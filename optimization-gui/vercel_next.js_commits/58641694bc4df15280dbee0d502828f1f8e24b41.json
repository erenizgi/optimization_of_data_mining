{
    "author": "ztanner",
    "message": "fix: dev should produce the correct default fallback regex to match builds/Turbopack (#83701)\n\n`test/e2e/middleware-general/test/index.test.ts` has been frequently\nflaking recently in dev likely due to a timing change. If a default\nmiddleware matcher isn't written to disk, `setup-dev-bundler` returns a\ndefault regex of `.*`. However in webpack [prod\nbuilds](https://github.com/vercel/next.js/blob/5abb663b96493292031b04ef977686949f0a4445/packages/next/src/build/webpack/plugins/middleware-plugin.ts#L207-L212)/[Turbopack\ndev,](https://github.com/vercel/next.js/blob/5abb663b96493292031b04ef977686949f0a4445/crates/next-api/src/middleware.rs#L245-L249)\nthis value is `^/.*$`.\n\nThis updates dev to produce the same values in both environments. This\nshould have no behavioral difference because all routes should start\nwith `/`, anyway.\n\n\n### Test plan\nThis change passes [flake\ndetection](https://github.com/vercel/next.js/actions/runs/17656597547/job/50181663593?pr=83701#step:34:187).",
    "sha": "58641694bc4df15280dbee0d502828f1f8e24b41",
    "files": [
        {
            "sha": "69ab72c08de69aac31955c52f9965650ecd73e7f",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/58641694bc4df15280dbee0d502828f1f8e24b41/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/58641694bc4df15280dbee0d502828f1f8e24b41/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=58641694bc4df15280dbee0d502828f1f8e24b41",
            "patch": "@@ -474,7 +474,7 @@ async function startWatcher(\n             serverFields.actualMiddlewareFile\n           )\n           middlewareMatchers = staticInfo.middleware?.matchers || [\n-            { regexp: '.*', originalSource: '/:path*' },\n+            { regexp: '^/.*$', originalSource: '/:path*' },\n           ]\n           continue\n         }"
        },
        {
            "sha": "0d616d10b5132d5006bf88f4c17547e82ad80c9a",
            "filename": "test/e2e/middleware-general/test/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/58641694bc4df15280dbee0d502828f1f8e24b41/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/58641694bc4df15280dbee0d502828f1f8e24b41/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts?ref=58641694bc4df15280dbee0d502828f1f8e24b41",
            "patch": "@@ -200,7 +200,9 @@ describe('Middleware Runtime', () => {\n           `/_next/static/${next.buildId}/_devMiddlewareManifest.json`\n         )\n         const matchers = await res.json()\n-        expect(matchers).toEqual([{ regexp: '.*', originalSource: '/:path*' }])\n+        expect(matchers).toEqual([\n+          { regexp: '^/.*$', originalSource: '/:path*' },\n+        ])\n       })\n     }\n "
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}