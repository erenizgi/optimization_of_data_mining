{
    "author": "mischnic",
    "message": "Turbopack: set `window.next.turbopack` instead (#82580)\n\nCloses PACK-5239\r\n\r\nhttps://vercel.slack.com/archives/C04RPSD7EPM/p1753968554253779",
    "sha": "3c24a5cb47b2ba4c94c76a68c896389f29e1ab12",
    "files": [
        {
            "sha": "9a5b36409fa3afd4e8151479f3027128b9002d75",
            "filename": "packages/next/src/client/app-next-turbopack.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts?ref=3c24a5cb47b2ba4c94c76a68c896389f29e1ab12",
            "patch": "@@ -1,7 +1,7 @@\n import { appBootstrap } from './app-bootstrap'\n import { isRecoverableError } from './react-client-callbacks/on-recoverable-error'\n \n-window.next.version += '-turbo'\n+window.next.turbopack = true\n ;(self as any).__webpack_hash__ = ''\n \n // eslint-disable-next-line @next/internal/typechecked-require"
        },
        {
            "sha": "87ad434c28d601fff16de094c474186cfc76e9e6",
            "filename": "packages/next/src/client/next-dev-turbopack.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fnext-dev-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fnext-dev-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fnext-dev-turbopack.ts?ref=3c24a5cb47b2ba4c94c76a68c896389f29e1ab12",
            "patch": "@@ -8,7 +8,8 @@ import { connect } from '@vercel/turbopack-ecmascript-runtime/browser/dev/hmr-cl\n import type { TurbopackMsgToBrowser } from '../server/dev/hot-reloader-types'\n \n window.next = {\n-  version: `${version}-turbo`,\n+  version,\n+  turbopack: true,\n   // router is initialized later so it has to be live-binded\n   get router() {\n     return router"
        },
        {
            "sha": "407db2123c5e45d6720014e97c546ae0279e6ba3",
            "filename": "packages/next/src/client/next-turbopack.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fnext-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/packages%2Fnext%2Fsrc%2Fclient%2Fnext-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fnext-turbopack.ts?ref=3c24a5cb47b2ba4c94c76a68c896389f29e1ab12",
            "patch": "@@ -9,7 +9,8 @@ import { initialize, version, router, emitter, hydrate } from './'\n import { displayContent } from './dev/fouc'\n \n window.next = {\n-  version: `${version}-turbo`,\n+  version,\n+  turbopack: true,\n   // router is initialized later so it has to be live-binded\n   get router() {\n     return router"
        },
        {
            "sha": "fc107b2c581f04d4a1fbf103195af0d78235fa82",
            "filename": "test/production/pages-dir/production/test/index.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c24a5cb47b2ba4c94c76a68c896389f29e1ab12/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts?ref=3c24a5cb47b2ba4c94c76a68c896389f29e1ab12",
            "patch": "@@ -1156,9 +1156,15 @@ describe('Production Usage', () => {\n       const version = await browser.eval('window.next.version')\n       expect(version).toBeTruthy()\n       expect(version).toBe(\n-        (await next.readJSON('node_modules/next/package.json')).version +\n-          (process.env.IS_TURBOPACK_TEST ? '-turbo' : '')\n+        (await next.readJSON('node_modules/next/package.json')).version\n       )\n+\n+      const turbopack = await browser.eval('window.next.turbopack')\n+      if (process.env.IS_TURBOPACK_TEST) {\n+        expect(turbopack).toBeTrue()\n+      } else {\n+        expect(turbopack).toBeFalsy()\n+      }\n     } finally {\n       if (browser) {\n         await browser.close()"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 13,
        "deletions": 5
    }
}