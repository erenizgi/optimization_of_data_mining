{
    "author": "gaojude",
    "message": "log the instrumentation-client execution time (#77121)\n\nFollow up to\nhttps://github.com/vercel/next.js/pull/76916#discussion_r1994126285\n\n\n![CleanShot 2025-03-14 at\n10.33.51@2x.png](https://graphite-user-uploaded-assets-prod.s3.amazonaws.com/rKSEEwxbNzdFs9t0yyxN/13cbdcea-02c2-41b4-9219-103b1dbf545e.png)",
    "sha": "3c2670df920b15937dc276a9539a90c21c52f2a0",
    "files": [
        {
            "sha": "4830e6f96e95da4254374e50346f54f3fa6c8d36",
            "filename": "packages/next/src/lib/require-instrumentation-client.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/3c2670df920b15937dc276a9539a90c21c52f2a0/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c2670df920b15937dc276a9539a90c21c52f2a0/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Frequire-instrumentation-client.ts?ref=3c2670df920b15937dc276a9539a90c21c52f2a0",
            "patch": "@@ -4,7 +4,15 @@\n  * The `private-next-instrumentation-client` module is automatically aliased to\n  * the `instrumentation-client.ts` file in the project root by webpack or turbopack.\n  */\n-\n if (process.env.__NEXT_EXPERIMENTAL_CLIENT_INSTRUMENTATION_HOOK) {\n-  require('private-next-instrumentation-client')\n+  if (process.env.NODE_ENV === 'development') {\n+    const startTime = performance.now()\n+    require('private-next-instrumentation-client')\n+    const endTime = performance.now()\n+    console.log(\n+      `[Client Instrumentation Hook] executed in ${(endTime - startTime).toFixed(0)}ms (Note: Code download overhead is not included in this measurement)`\n+    )\n+  } else {\n+    require('private-next-instrumentation-client')\n+  }\n }"
        },
        {
            "sha": "0571eb002579a4aa105e88d02c1b6e6c127b741e",
            "filename": "test/e2e/instrumentation-client-hook/instrumentation-client-hook.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3c2670df920b15937dc276a9539a90c21c52f2a0/test%2Fe2e%2Finstrumentation-client-hook%2Finstrumentation-client-hook.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3c2670df920b15937dc276a9539a90c21c52f2a0/test%2Fe2e%2Finstrumentation-client-hook%2Finstrumentation-client-hook.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Finstrumentation-client-hook%2Finstrumentation-client-hook.test.ts?ref=3c2670df920b15937dc276a9539a90c21c52f2a0",
            "patch": "@@ -20,7 +20,7 @@ describe('Instrumentation Client Hook', () => {\n \n   testCases.forEach(({ name, appDir }) => {\n     describe(name, () => {\n-      const { next } = nextTestSetup({\n+      const { next, isNextDev } = nextTestSetup({\n         files: path.join(__dirname, appDir),\n       })\n \n@@ -35,6 +35,11 @@ describe('Instrumentation Client Hook', () => {\n         expect(instrumentationTime).toBeDefined()\n         expect(hydrationTime).toBeDefined()\n         expect(instrumentationTime).toBeLessThan(hydrationTime)\n+        expect(\n+          (await browser.log()).some((log) =>\n+            log.message.startsWith('[Client Instrumentation Hook]')\n+          )\n+        ).toBe(isNextDev)\n       })\n     })\n   })"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 16,
        "deletions": 3
    }
}