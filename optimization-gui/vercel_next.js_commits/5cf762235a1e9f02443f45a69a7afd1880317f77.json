{
    "author": "icyJoseph",
    "message": "docs: Improve troubleshooting and awareness around useSearchParams (#83226)\n\nCloses: https://linear.app/vercel/issue/DOC-5030/usesearchparams",
    "sha": "5cf762235a1e9f02443f45a69a7afd1880317f77",
    "files": [
        {
            "sha": "4a32d95c9fb1b8f178f691c69e68db332ca91864",
            "filename": "docs/01-app/03-api-reference/03-file-conventions/route-segment-config.mdx",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/5cf762235a1e9f02443f45a69a7afd1880317f77/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Froute-segment-config.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/5cf762235a1e9f02443f45a69a7afd1880317f77/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Froute-segment-config.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Froute-segment-config.mdx?ref=5cf762235a1e9f02443f45a69a7afd1880317f77",
            "patch": "@@ -3,7 +3,11 @@ title: Route Segment Config\n description: Learn about how to configure options for Next.js route segments.\n ---\n \n-> The options outlined on this page are disabled if the [`cacheComponents`](/docs/app/api-reference/config/next-config-js/cacheComponents) flag is on, and will eventually be deprecated in the future.\n+> **Good to know**:\n+>\n+> - The options outlined on this page are disabled if the [`cacheComponents`](/docs/app/api-reference/config/next-config-js/cacheComponents) flag is on, and will eventually be deprecated in the future.\n+> - Route Segment options only take effect in Server Component Pages, Layouts, or Route Handlers.\n+> - `generateStaticParams` cannot be used inside a `'use client'` file.\n \n The Route Segment options allows you to configure the behavior of a [Page](/docs/app/api-reference/file-conventions/layout), [Layout](/docs/app/api-reference/file-conventions/layout), or [Route Handler](/docs/app/api-reference/file-conventions/route) by directly exporting the following variables:\n "
        },
        {
            "sha": "2abf7ef9efc90da3275a5c1931ea9cb9e221fc62",
            "filename": "docs/01-app/03-api-reference/04-functions/use-search-params.mdx",
            "status": "modified",
            "additions": 16,
            "deletions": 8,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/5cf762235a1e9f02443f45a69a7afd1880317f77/docs%2F01-app%2F03-api-reference%2F04-functions%2Fuse-search-params.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/5cf762235a1e9f02443f45a69a7afd1880317f77/docs%2F01-app%2F03-api-reference%2F04-functions%2Fuse-search-params.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F04-functions%2Fuse-search-params.mdx?ref=5cf762235a1e9f02443f45a69a7afd1880317f77",
            "patch": "@@ -173,7 +173,13 @@ export default function Page() {\n }\n ```\n \n-> **Good to know**: In development, all pages are rendered on-demand, so `useSearchParams` doesn't suspend. However, pre-rendering a [static page](/docs/app/getting-started/partial-prerendering#static-rendering) that worked in development will fail the build if `useSearchParams` is used in a Client Component that isnâ€™t directly or indirectly wrapped in a `Suspense` boundary.\n+> **Good to know**:\n+>\n+> - In development, routes are rendered on-demand, so `useSearchParams` doesn't suspend and things may appear to work without `Suspense`.\n+> - During production builds, a [static page](/docs/app/getting-started/partial-prerendering#static-rendering) that calls `useSearchParams` from a Client Component must be wrapped in a `Suspense` boundary, otherwise the build fails with the [Missing Suspense boundary with useSearchParams](/docs/messages/missing-suspense-with-csr-bailout) error.\n+> - If you intend the route to be dynamically rendered, prefer using the [`connection`](/docs/app/api-reference/functions/connection) function first in a Server Component to wait for an incoming request, this excludes everything below from prerendering. See what makes a route dynamic in the [Dynamic Rendering guide](/docs/app/getting-started/partial-prerendering#dynamic-rendering).\n+> - If you're already in a Server Component Page, consider using the [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional) and passing the values to Client Components.\n+> - You can also pass the Page [`searchParams` prop](/docs/app/api-reference/file-conventions/page#searchparams-optional) directly to a Client Component and unwrap it with React's `use()`. Although this will suspend, so the Client Component should be wrapped with a `Suspense` boundary.\n \n ### Dynamic Rendering\n \n@@ -218,11 +224,11 @@ export default function SearchBar() {\n ```\n \n ```tsx filename=\"app/dashboard/page.tsx\" switcher\n+import { connection } from 'next/server'\n import SearchBar from './search-bar'\n \n-export const dynamic = 'force-dynamic'\n-\n-export default function Page() {\n+export default async function Page() {\n+  await connection()\n   return (\n     <>\n       <nav>\n@@ -235,11 +241,11 @@ export default function Page() {\n ```\n \n ```jsx filename=\"app/dashboard/page.js\" switcher\n+import { connection } from 'next/server'\n import SearchBar from './search-bar'\n \n-export const dynamic = 'force-dynamic'\n-\n-export default function Page() {\n+export default async function Page() {\n+  await connection()\n   return (\n     <>\n       <nav>\n@@ -251,7 +257,9 @@ export default function Page() {\n }\n ```\n \n-> **Good to know**: Setting the [`dynamic` route segment config option](/docs/app/api-reference/file-conventions/route-segment-config#dynamic) to `force-dynamic` can be used to force dynamic rendering.\n+> **Good to know**:\n+>\n+> - Previously, setting `export const dynamic = 'force-dynamic'` on the page was used to force dynamic rendering. Prefer using [`connection()`](/docs/app/api-reference/functions/connection) instead, as it semantically ties dynamic rendering to the incoming request.\n \n ### Server Components\n "
        },
        {
            "sha": "b453e54d6ccf0b72b8205fe40b8381d6afe72745",
            "filename": "errors/missing-suspense-with-csr-bailout.mdx",
            "status": "modified",
            "additions": 106,
            "deletions": 3,
            "changes": 109,
            "blob_url": "https://github.com/vercel/next.js/blob/5cf762235a1e9f02443f45a69a7afd1880317f77/errors%2Fmissing-suspense-with-csr-bailout.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/5cf762235a1e9f02443f45a69a7afd1880317f77/errors%2Fmissing-suspense-with-csr-bailout.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fmissing-suspense-with-csr-bailout.mdx?ref=5cf762235a1e9f02443f45a69a7afd1880317f77",
            "patch": "@@ -8,7 +8,110 @@ Reading search parameters through `useSearchParams()` without a Suspense boundar\n \n ## Possible Ways to Fix It\n \n-Ensure that calls to `useSearchParams()` are wrapped in a Suspense boundary.\n+You have a few options depending on your intent:\n+\n+- To keep the route statically generated, wrap the smallest subtree that calls `useSearchParams()` in `Suspense`, for example you may move its usage into a child Client Component and render that component wrapped with `Suspense`. This preserves the static shell and avoids a full CSR bailout.\n+- To make the route dynamically rendered, use the [`connection`](/docs/app/api-reference/functions/connection) function in a Server Component (e.g. the Page or a wrapping Layout). This waits for an incoming request and excludes everything below from prerendering.\n+\n+```tsx filename=\"app/page.tsx\" switcher\n+import { connection } from 'next/server'\n+\n+export default async function Page() {\n+  await connection()\n+  return <div>...</div>\n+}\n+```\n+\n+```jsx filename=\"app/page.js\" switcher\n+import { connection } from 'next/server'\n+\n+export default async function Page() {\n+  await connection()\n+  return <div>...</div>\n+}\n+```\n+\n+- Before the `connection` API was available setting `export const dynamic = 'force-dynamic'` in a Server Component `page.tsx`, or `layout.tsx`, opted the route into on-demand rendering. Note that setting `dynamic` in a Client Component (`'use client'`) `page.tsx` has no effect.\n+\n+```tsx filename=\"app/layout.tsx\" switcher\n+export const dynamic = 'force-dynamic'\n+\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return children\n+}\n+```\n+\n+```jsx filename=\"app/layout.js\" switcher\n+export const dynamic = 'force-dynamic'\n+\n+export default function RootLayout({ children }) {\n+  return children\n+}\n+```\n+\n+- Alternatively, a Server Component Page can pass the `searchParams` value down to Client Components. In a Client Component, you can unwrap it with React's `use()` (ensure a surrounding `Suspense` boundary). See [What to use and when](/docs/app/getting-started/layouts-and-pages#what-to-use-and-when).\n+\n+```tsx filename=\"app/page.tsx\" switcher\n+import { Suspense } from 'react'\n+import ClientSearch from './client-search'\n+\n+export default function Page({\n+  searchParams,\n+}: {\n+  searchParams: Promise<{ q?: string }>\n+}) {\n+  return (\n+    <Suspense fallback={<>...</>}>\n+      <ClientSearch searchParams={searchParams} />\n+    </Suspense>\n+  )\n+}\n+```\n+\n+```tsx filename=\"app/client-search.tsx\" switcher\n+'use client'\n+\n+import { use } from 'react'\n+\n+export default function ClientSearch({\n+  searchParams,\n+}: {\n+  searchParams: Promise<{ q?: string }>\n+}) {\n+  const params = use(searchParams)\n+  return <div>Query: {params.q}</div>\n+}\n+```\n+\n+```jsx filename=\"app/page.js\" switcher\n+import { Suspense } from 'react'\n+import ClientSearch from './client-search'\n+\n+export default function Page({ searchParams }) {\n+  return (\n+    <Suspense fallback={<>...</>}>\n+      <ClientSearch searchParams={searchParams} />\n+    </Suspense>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/client-search.js\" switcher\n+'use client'\n+\n+import { use } from 'react'\n+\n+export default function ClientSearch({ searchParams }) {\n+  const params = use(searchParams)\n+  return <div>Query: {params.q}</div>\n+}\n+```\n+\n+- Consider making the Page a Server Component again and isolating Client-only code (that uses `useSearchParams`) into child Client Components.\n \n ```tsx filename=\"app/search.tsx\" switcher\n 'use client'\n@@ -54,8 +157,6 @@ export function Searchbar() {\n }\n ```\n \n-This will ensure the page does not de-opt to client-side rendering.\n-\n ## Disabling\n \n > **Note**: This is only available with Next.js version 14.x. If you're in versions above 14 please fix it with the approach above.\n@@ -75,3 +176,5 @@ This configuration option will be removed in a future major version.\n ## Useful Links\n \n - [`useSearchParams`](/docs/app/api-reference/functions/use-search-params)\n+- [`connection`](/docs/app/api-reference/functions/connection)\n+- [Dynamic Rendering guide](/docs/app/getting-started/partial-prerendering#dynamic-rendering)"
        }
    ],
    "stats": {
        "total": 139,
        "additions": 127,
        "deletions": 12
    }
}