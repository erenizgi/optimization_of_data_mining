{
    "author": "unstubbable",
    "message": "Prevent typescript errors in IDE for newly generated tests (#78247)\n\nWhen generating a new test with `pnpm new-test`, the IDE will show the\nfollowing error when opening the generated `page.tsx` or `layout.tsx`\nfiles:\n\n```sh\n'React' refers to a UMD global, but the current file is a module. Consider adding an import instead.ts (2686)\n```\n\nThis is because by default, the generated test app is covered by the\nroot `tsconfig.json`, containing `{\"jsx\": \"react-jsx\"}` which expects\nthere to be a `React` import that the template files don't have.\n\nWhen first running `pnpm next dev` or `pnpm next build`, a local\n`tsconfig.json` file is generated for the test app. This config contains\n`{\"jsx\": \"preserve\"}`, which fixes the initial errors.\n\nTo avoid this step, and prevent the initial compiler errors, we can just\ncopy the `tsconfig.json` as well as the `next-env.d.ts` from the CNA\ntemplate files into the new test app. (Those two files are git-ignored,\nby the way.)",
    "sha": "653ac8373339e707687accd313f08e540f902f31",
    "files": [
        {
            "sha": "77dd6eed1032cc4af8221ac5d95e8ffcf5d28222",
            "filename": "turbo/generators/config.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 6,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/653ac8373339e707687accd313f08e540f902f31/turbo%2Fgenerators%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/653ac8373339e707687accd313f08e540f902f31/turbo%2Fgenerators%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbo%2Fgenerators%2Fconfig.ts?ref=653ac8373339e707687accd313f08e540f902f31",
            "patch": "@@ -5,6 +5,7 @@ import * as helpers from './helpers'\n interface TestResponse {\n   appDir: string\n   type: 'e2e' | 'production' | 'development' | 'unit'\n+  name: string\n }\n \n interface ErrorResponse {\n@@ -61,25 +62,44 @@ export default function generator(plop: NodePlopAPI): void {\n       },\n     ],\n     actions: function (answers) {\n-      const { appDir, type } = answers as TestResponse\n-      const testRoot = path.join(plop.getDestBasePath(), 'test')\n-\n+      const { appDir, type, name } = answers as TestResponse\n+      const basePath = plop.getDestBasePath()\n+      const testRoot = path.join(basePath, 'test')\n       const appDirPath = appDir ? 'app-dir/' : ''\n-      let templatePath = path.join(\n+\n+      const templatePath = path.join(\n         testRoot,\n         type === 'unit' ? 'unit' : 'e2e',\n         appDirPath,\n         'test-template'\n       )\n-      let targetPath = path.join(testRoot, type, appDirPath)\n+\n+      const targetPath = path.join(testRoot, type, appDirPath)\n+\n+      const cnaTemplatePath = path.join(\n+        basePath,\n+        'packages/create-next-app/templates',\n+        appDir ? 'app-empty' : 'default-empty',\n+        'ts'\n+      )\n \n       return [\n         {\n           type: 'addMany',\n-          templateFiles: `${templatePath}/**/*`,\n+          templateFiles: path.join(templatePath, '**/*'),\n           base: templatePath,\n           destination: targetPath,\n         },\n+        {\n+          type: 'add',\n+          templateFile: path.join(cnaTemplatePath, 'tsconfig.json'),\n+          path: path.join(targetPath, name, 'tsconfig.json'),\n+        },\n+        {\n+          type: 'add',\n+          templateFile: path.join(cnaTemplatePath, 'next-env.d.ts'),\n+          path: path.join(targetPath, name, 'next-env.d.ts'),\n+        },\n       ]\n     },\n   })"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 26,
        "deletions": 6
    }
}