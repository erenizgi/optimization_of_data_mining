{
    "author": "kdy1",
    "message": "fix(turbopack): Do not run `inject_helpers` pass multiple times (#80755)\n\n### What?\n\nRemove `inject_helpers` passes from `apply_transforms`\n\n### Why?\n\nWe run `inject_helpers` from `fn parse` anyway, so we don't need to run\nit from `apply_transforms`.",
    "sha": "8a5545633e97063a1bc45dde0571a6e7a1955da8",
    "files": [
        {
            "sha": "17793f64eb3ca8090a20b8f4678ceb4024bbcb77",
            "filename": "turbopack/crates/turbopack-ecmascript/src/transform/mod.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftransform%2Fmod.rs?ref=8a5545633e97063a1bc45dde0571a6e7a1955da8",
            "patch": "@@ -10,11 +10,7 @@ use swc_core::{\n     ecma::{\n         ast::{Module, ModuleItem, Program, Script},\n         preset_env::{self, Targets},\n-        transforms::{\n-            base::{assumptions::Assumptions, helpers::inject_helpers},\n-            optimization::inline_globals,\n-            react::react,\n-        },\n+        transforms::{base::assumptions::Assumptions, optimization::inline_globals, react::react},\n     },\n     quote,\n };\n@@ -238,15 +234,13 @@ impl EcmascriptInputTransform {\n \n                 // Explicit type annotation to ensure that we don't duplicate transforms in the\n                 // final binary\n-                *program = module_program.apply((\n-                    preset_env::transform_from_env::<&'_ dyn Comments>(\n+                *program =\n+                    module_program.apply(preset_env::transform_from_env::<&'_ dyn Comments>(\n                         top_level_mark,\n                         Some(&comments),\n                         config,\n                         Assumptions::default(),\n-                    ),\n-                    inject_helpers(unresolved_mark),\n-                ));\n+                    ));\n             }\n             EcmascriptInputTransform::TypeScript {\n                 // TODO(WEB-1213)\n@@ -270,7 +264,7 @@ impl EcmascriptInputTransform {\n                     ..Default::default()\n                 };\n \n-                program.mutate((decorators(config), inject_helpers(unresolved_mark)));\n+                program.mutate(decorators(config));\n             }\n             EcmascriptInputTransform::Plugin(transform) => {\n                 transform.await?.transform(program, ctx).await?"
        },
        {
            "sha": "342883f689d93f7c3c18d75c489bb508aee3b47f",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/swc_transforms/preset_env/output/turbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js?ref=8a5545633e97063a1bc45dde0571a6e7a1955da8",
            "patch": "@@ -5,7 +5,6 @@\n \n var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$node_modules$2f40$swc$2f$helpers$2f$_$2f$_class_call_check$2e$js__$5b$test$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/node_modules/@swc/helpers/_/_class_call_check.js [test] (ecmascript)\");\n ;\n-;\n var Foo = function Foo() {\n     \"use strict\";\n     (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$node_modules$2f40$swc$2f$helpers$2f$_$2f$_class_call_check$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"_\"])(this, Foo);"
        },
        {
            "sha": "d58c22c949e428fe41f95aff800c3a3bc9500fd4",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/swc_transforms/preset_env/output/turbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js.map",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/8a5545633e97063a1bc45dde0571a6e7a1955da8/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fswc_transforms%2Fpreset_env%2Foutput%2Fturbopack_crates_turbopack-tests_tests_snapshot_bff03a32._.js.map?ref=8a5545633e97063a1bc45dde0571a6e7a1955da8",
            "patch": "@@ -2,6 +2,6 @@\n   \"version\": 3,\n   \"sources\": [],\n   \"sections\": [\n-    {\"offset\": {\"line\": 5, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/swc_transforms/preset_env/input/index.js\"],\"sourcesContent\":[\"class Foo {}\\n\\nconsole.log(Foo, [].includes('foo'))\\n\"],\"names\":[],\"mappings\":\";;;AAAA,IAAA,AAAM,MAAN,SAAM;;2OAAA;;AAEN,QAAQ,GAAG,CAAC,KAAK,EAAE,CAAC,QAAQ,CAAC\"}},\n-    {\"offset\": {\"line\": 18, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/node_modules/@swc/helpers/_/_class_call_check.js\"],\"sourcesContent\":[\"\\\"purposefully empty stub\\\";\\n\\\"@swc/helpers/_/_class_call_check.js\\\";\\n\"],\"names\":[],\"mappings\":\"AAAA;AACA\",\"ignoreList\":[0]}}]\n+    {\"offset\": {\"line\": 5, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/swc_transforms/preset_env/input/index.js\"],\"sourcesContent\":[\"class Foo {}\\n\\nconsole.log(Foo, [].includes('foo'))\\n\"],\"names\":[],\"mappings\":\";;AAAA,IAAA,AAAM,MAAN,SAAM;;2OAAA;;AAEN,QAAQ,GAAG,CAAC,KAAK,EAAE,CAAC,QAAQ,CAAC\"}},\n+    {\"offset\": {\"line\": 17, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/node_modules/@swc/helpers/_/_class_call_check.js\"],\"sourcesContent\":[\"\\\"purposefully empty stub\\\";\\n\\\"@swc/helpers/_/_class_call_check.js\\\";\\n\"],\"names\":[],\"mappings\":\"AAAA;AACA\",\"ignoreList\":[0]}}]\n }\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 7,
        "deletions": 14
    }
}