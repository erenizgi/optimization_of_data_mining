{
    "author": "timneutkens",
    "message": "Build: Highlight TypeScript and ESLint being run clearer (#84606)\n\n## What?\n\nFollow-up to #84602.\n\n- Renamed `Linting and checking validity of types` to `Running ESLint\nand TypeScript concurrently`\n- When `Running ESLint and TypeScript concurrently` finishes it logs the\nindividual times for `TypeScript` and `ESLint` separately\n\nPrevious PR only showed the time for TypeScript, hiding the time it took\nto run ESlint.\n\nThe reason for renaming it to `Running ESLint and TypeScript` is that it\ndoes not hide what is happening under the hood. Someone might assume\nNext.js is doing extra work here, but it is calling the underlying tools\nin the application to check linting and types. We've seen cases where\nrunning TypeScript here is 1 minute or more, that would previously be\nhidden or hard to investigate for the developer as they didn't know what\n\"linting and type checking\" entails in this context.\n\n```\n   Creating an optimized production build ...\n ✓ Compiled successfully in 764ms\n ✓ Finished TypeScript in 968ms    \n ✓ Finished ESLint in 824ms    \n ✓ Collecting page data in 203ms    \n ✓ Generating static pages (4/4) in 318ms\n ✓ Collecting build traces in 3.3s    \n ✓ Finalizing page optimization in 3.3s    \n```\n\n---------\n\nCo-authored-by: vercel[bot] <35613825+vercel[bot]@users.noreply.github.com>",
    "sha": "8f5ed83b72f84c39b9951756a57c1155a988f4e9",
    "files": [
        {
            "sha": "592e551917774217387859f2720765c973678494",
            "filename": "packages/next/src/build/type-check.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 10,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/8f5ed83b72f84c39b9951756a57c1155a988f4e9/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f5ed83b72f84c39b9951756a57c1155a988f4e9/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftype-check.ts?ref=8f5ed83b72f84c39b9951756a57c1155a988f4e9",
            "patch": "@@ -110,11 +110,11 @@ export async function startTypeChecking({\n \n   if (!ignoreTypeScriptErrors && shouldLint) {\n     typeCheckingAndLintingSpinnerPrefixText =\n-      'Linting and checking validity of types'\n+      'Running ESLint and TypeScript concurrently'\n   } else if (!ignoreTypeScriptErrors) {\n-    typeCheckingAndLintingSpinnerPrefixText = 'Checking validity of types'\n+    typeCheckingAndLintingSpinnerPrefixText = 'Running TypeScript'\n   } else if (shouldLint) {\n-    typeCheckingAndLintingSpinnerPrefixText = 'Linting'\n+    typeCheckingAndLintingSpinnerPrefixText = 'Running ESLint'\n   }\n \n   // we will not create a spinner if both ignoreTypeScriptErrors and ignoreESLint are\n@@ -125,10 +125,10 @@ export async function startTypeChecking({\n     )\n   }\n \n-  const typeCheckStart = process.hrtime()\n+  const typeCheckAndLintStart = process.hrtime()\n \n   try {\n-    const [[verifyResult, typeCheckEnd]] = await Promise.all([\n+    const [[verifyResult, typeCheckEnd], lintCheckEnd] = await Promise.all([\n       nextBuildSpan.traceChild('run-typescript').traceAsyncFn(() =>\n         verifyTypeScriptSetup(\n           dir,\n@@ -142,7 +142,7 @@ export async function startTypeChecking({\n           !!appDir,\n           !!pagesDir\n         ).then((resolved) => {\n-          const checkEnd = process.hrtime(typeCheckStart)\n+          const checkEnd = process.hrtime(typeCheckAndLintStart)\n           return [resolved, checkEnd] as const\n         })\n       ),\n@@ -155,14 +155,22 @@ export async function startTypeChecking({\n             config.experimental.workerThreads,\n             telemetry\n           )\n+          const checkEnd = process.hrtime(typeCheckAndLintStart)\n+          return checkEnd\n         }),\n     ])\n \n     if (typeCheckingAndLintingSpinner) {\n-      typeCheckingAndLintingSpinner.setText(\n-        `${typeCheckingAndLintingSpinnerPrefixText} in ${hrtimeDurationToString(typeCheckEnd)}`\n-      )\n-      typeCheckingAndLintingSpinner.stopAndPersist()\n+      typeCheckingAndLintingSpinner.stop()\n+\n+      createSpinner(\n+        `Finished TypeScript${ignoreTypeScriptErrors ? ' config validation' : ''} in ${hrtimeDurationToString(typeCheckEnd)}`\n+      )?.stopAndPersist()\n+      if (lintCheckEnd) {\n+        createSpinner(\n+          `Finished ESLint in ${hrtimeDurationToString(lintCheckEnd)}`\n+        )?.stopAndPersist()\n+      }\n     }\n \n     if (!ignoreTypeScriptErrors && verifyResult) {"
        },
        {
            "sha": "7c0c81390dbbcb927d484588166616ad8e2adbb5",
            "filename": "test/production/app-dir/build-output/index.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/8f5ed83b72f84c39b9951756a57c1155a988f4e9/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f5ed83b72f84c39b9951756a57c1155a988f4e9/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts?ref=8f5ed83b72f84c39b9951756a57c1155a988f4e9",
            "patch": "@@ -24,7 +24,7 @@ describe('production - app dir - build output', () => {\n       'Creating an optimized production build'\n     )\n     const indexOfLinting = output.indexOf(\n-      'Linting and checking validity of types'\n+      'Running ESLint and TypeScript concurrently'\n     )\n     expect(indexOfVersion).toBeLessThan(indexOfLinting)\n     expect(indexOfStartCompiling).toBeLessThan(indexOfLinting)"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 19,
        "deletions": 11
    }
}