{
    "author": "ijjk",
    "message": "Fix PPR no fallback case (#80908)\n\nWhen we are resuming with postponed state we don't handle SSG behavior\nso this ensures we only trigger the `NoFallback` case if we have created\na cache key.",
    "sha": "ac51a18d626d899d4e1512ff5a803eeb51a9109d",
    "files": [
        {
            "sha": "28c2d4c2ba59d2a252a43492f734c8928dbc1ea5",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 7,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/ac51a18d626d899d4e1512ff5a803eeb51a9109d/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ac51a18d626d899d4e1512ff5a803eeb51a9109d/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=ac51a18d626d899d4e1512ff5a803eeb51a9109d",
            "patch": "@@ -186,12 +186,6 @@ export async function handler(\n       prerenderManifest.routes[normalizedSrcPage]\n   )\n \n-  // if the page is dynamicParams: false and this pathname wasn't prerender\n-  // trigger the no fallback handling\n-  if (isSSG && prerenderInfo?.fallback === false && !isPrerendered) {\n-    throw new NoFallbackError()\n-  }\n-\n   const userAgent = req.headers['user-agent'] || ''\n   const botType = getBotType(userAgent)\n   const isHtmlBot = isHtmlBotRequest(req)\n@@ -317,6 +311,11 @@ export async function handler(\n     ssgCacheKey = resolvedPathname\n   }\n \n+  let staticPathKey = ssgCacheKey\n+  if (!staticPathKey && routeModule.isDev) {\n+    staticPathKey = resolvedPathname\n+  }\n+\n   const ComponentMod = {\n     ...entryBase,\n     tree,\n@@ -650,12 +649,24 @@ export async function handler(\n       if (\n         !minimalMode &&\n         fallbackMode !== FallbackMode.BLOCKING_STATIC_RENDER &&\n-        ssgCacheKey &&\n+        staticPathKey &&\n         !didRespond &&\n         !isDraftMode &&\n         pageIsDynamic &&\n         (isProduction || !isPrerendered)\n       ) {\n+        // if the page has dynamicParams: false and this pathname wasn't\n+        // prerendered trigger the no fallback handling\n+        if (\n+          // In development, fall through to render to handle missing\n+          // getStaticPaths.\n+          (isProduction || prerenderInfo) &&\n+          // When fallback isn't present, abort this render so we 404\n+          fallbackMode === FallbackMode.NOT_FOUND\n+        ) {\n+          throw new NoFallbackError()\n+        }\n+\n         let fallbackResponse: ResponseCacheEntry | null | undefined\n \n         if (isRoutePPREnabled && !isRSCRequest) {"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 18,
        "deletions": 7
    }
}