{
    "author": "timneutkens",
    "message": "Turbopack: Ensure server actions sourcemaps tests pass (#76157)\n\n## What?\n\nFollow-up to #76129. Fixes the sourcemap, ensures the mappings are not\ncarried over when compiling for the client. For the server these\nmappings are preserved.\n\n<!-- Thanks for opening a PR! Your contribution is much appreciated.\nTo make sure your PR is handled as smoothly as possible we request that\nyou follow the checklist sections below.\nChoose the right checklist for the change(s) that you're making:\n\n## For Contributors\n\n### Improving Documentation\n\n- Run `pnpm prettier-fix` to fix formatting issues before opening the\nPR.\n- Read the Docs Contribution Guide to ensure your contribution follows\nthe docs guidelines:\nhttps://nextjs.org/docs/community/contribution-guide\n\n### Adding or Updating Examples\n\n- The \"examples guidelines\" are followed from our contributing doc\nhttps://github.com/vercel/next.js/blob/canary/contributing/examples/adding-examples.md\n- Make sure the linting passes by running `pnpm build && pnpm lint`. See\nhttps://github.com/vercel/next.js/blob/canary/contributing/repository/linting.md\n\n### Fixing a bug\n\n- Related issues linked using `fixes #number`\n- Tests added. See:\nhttps://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n### Adding a feature\n\n- Implements an existing feature request or RFC. Make sure the feature\nrequest has been accepted for implementation before opening a PR. (A\ndiscussion must be opened, see\nhttps://github.com/vercel/next.js/discussions/new?category=ideas)\n- Related issues/discussions are linked using `fixes #number`\n- e2e tests added\n(https://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs)\n- Documentation added\n- Telemetry added. In case of a feature if it's used or not.\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n\n## For Maintainers\n\n- Minimal description (aim for explaining to someone not on the team to\nunderstand the PR)\n- When linking to a Slack thread, you might want to share details of the\nconclusion\n- Link both the Linear (Fixes NEXT-xxx) and the GitHub issues\n- Add review comments if necessary to explain to the reviewer the logic\nbehind a change\n\n### What?\n\n### Why?\n\n### How?\n\nCloses NEXT-\nFixes #\n\n-->",
    "sha": "9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
    "files": [
        {
            "sha": "62c03e87604ab1acb6517e80b1cc963cabb25fa3",
            "filename": "crates/next-core/src/next_client/transforms.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_client%2Ftransforms.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_client%2Ftransforms.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Ftransforms.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -73,13 +73,17 @@ pub async fn get_next_client_transforms_rules(\n         }\n         ClientContextType::App { .. } => {\n             is_app_dir = true;\n-            rules.push(get_server_actions_transform_rule(\n-                ActionsTransform::Client,\n-                encryption_key,\n-                enable_mdx_rs,\n-                use_cache_enabled,\n-                cache_kinds,\n-            ));\n+            rules.push(\n+                get_server_actions_transform_rule(\n+                    mode,\n+                    ActionsTransform::Client,\n+                    encryption_key,\n+                    enable_mdx_rs,\n+                    use_cache_enabled,\n+                    cache_kinds,\n+                )\n+                .await?,\n+            );\n         }\n         ClientContextType::Fallback | ClientContextType::Other => {}\n     };"
        },
        {
            "sha": "ed2c7561bc2e8faeb6cbfde585da980336cbaf3d",
            "filename": "crates/next-core/src/next_server/transforms.rs",
            "status": "modified",
            "additions": 33,
            "deletions": 21,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_server%2Ftransforms.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_server%2Ftransforms.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Ftransforms.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -111,39 +111,51 @@ pub async fn get_next_server_transforms_rules(\n         ServerContextType::AppSSR { .. } => {\n             // Yah, this is SSR, but this is still treated as a Client transform layer.\n             // need to apply to foreign code too\n-            rules.push(get_server_actions_transform_rule(\n-                ActionsTransform::Client,\n-                encryption_key,\n-                mdx_rs,\n-                use_cache_enabled,\n-                cache_kinds,\n-            ));\n+            rules.push(\n+                get_server_actions_transform_rule(\n+                    mode,\n+                    ActionsTransform::Client,\n+                    encryption_key,\n+                    mdx_rs,\n+                    use_cache_enabled,\n+                    cache_kinds,\n+                )\n+                .await?,\n+            );\n \n             is_app_dir = true;\n \n             false\n         }\n         ServerContextType::AppRSC { .. } => {\n-            rules.push(get_server_actions_transform_rule(\n-                ActionsTransform::Server,\n-                encryption_key,\n-                mdx_rs,\n-                use_cache_enabled,\n-                cache_kinds,\n-            ));\n+            rules.push(\n+                get_server_actions_transform_rule(\n+                    mode,\n+                    ActionsTransform::Server,\n+                    encryption_key,\n+                    mdx_rs,\n+                    use_cache_enabled,\n+                    cache_kinds,\n+                )\n+                .await?,\n+            );\n \n             is_app_dir = true;\n \n             true\n         }\n         ServerContextType::AppRoute { .. } => {\n-            rules.push(get_server_actions_transform_rule(\n-                ActionsTransform::Server,\n-                encryption_key,\n-                mdx_rs,\n-                use_cache_enabled,\n-                cache_kinds,\n-            ));\n+            rules.push(\n+                get_server_actions_transform_rule(\n+                    mode,\n+                    ActionsTransform::Server,\n+                    encryption_key,\n+                    mdx_rs,\n+                    use_cache_enabled,\n+                    cache_kinds,\n+                )\n+                .await?,\n+            );\n \n             is_app_dir = true;\n "
        },
        {
            "sha": "2dd0ab3bed87159c83949cbe5b0850f7fd8c49de",
            "filename": "crates/next-core/src/next_shared/transforms/server_actions.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -3,12 +3,12 @@ use async_trait::async_trait;\n use next_custom_transforms::transforms::server_actions::{server_actions, Config};\n use swc_core::{common::FileName, ecma::ast::Program};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::ResolvedVc;\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack::module_options::{ModuleRule, ModuleRuleEffect};\n use turbopack_ecmascript::{CustomTransformer, EcmascriptInputTransform, TransformContext};\n \n use super::module_rule_match_js_no_url;\n-use crate::next_config::CacheKinds;\n+use crate::{mode::NextMode, next_config::CacheKinds};\n \n #[derive(Debug)]\n pub enum ActionsTransform {\n@@ -17,27 +17,29 @@ pub enum ActionsTransform {\n }\n \n /// Returns a rule which applies the Next.js Server Actions transform.\n-pub fn get_server_actions_transform_rule(\n+pub async fn get_server_actions_transform_rule(\n+    mode: Vc<NextMode>,\n     transform: ActionsTransform,\n     encryption_key: ResolvedVc<RcStr>,\n     enable_mdx_rs: bool,\n     use_cache_enabled: bool,\n     cache_kinds: ResolvedVc<CacheKinds>,\n-) -> ModuleRule {\n+) -> Result<ModuleRule> {\n     let transformer =\n         EcmascriptInputTransform::Plugin(ResolvedVc::cell(Box::new(NextServerActions {\n+            mode: *mode.await?,\n             transform,\n             encryption_key,\n             use_cache_enabled,\n             cache_kinds,\n         }) as _));\n-    ModuleRule::new(\n+    Ok(ModuleRule::new(\n         module_rule_match_js_no_url(enable_mdx_rs),\n         vec![ModuleRuleEffect::ExtendEcmascriptTransforms {\n             prepend: ResolvedVc::cell(vec![]),\n             append: ResolvedVc::cell(vec![transformer]),\n         }],\n-    )\n+    ))\n }\n \n #[derive(Debug)]\n@@ -46,6 +48,7 @@ struct NextServerActions {\n     encryption_key: ResolvedVc<RcStr>,\n     use_cache_enabled: bool,\n     cache_kinds: ResolvedVc<CacheKinds>,\n+    mode: NextMode,\n }\n \n #[async_trait]\n@@ -56,6 +59,7 @@ impl CustomTransformer for NextServerActions {\n             &FileName::Real(ctx.file_path_str.into()),\n             Config {\n                 is_react_server_layer: matches!(self.transform, ActionsTransform::Server),\n+                is_development: self.mode.is_development(),\n                 use_cache_enabled: self.use_cache_enabled,\n                 hash_salt: self.encryption_key.await?.to_string(),\n                 cache_kinds: self.cache_kinds.owned().await?,"
        },
        {
            "sha": "c2ec19f192400237685d880a13ab1dc26b3f0843",
            "filename": "crates/next-custom-transforms/src/transforms/server_actions.rs",
            "status": "modified",
            "additions": 32,
            "deletions": 5,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -16,6 +16,7 @@ use swc_core::{\n     common::{\n         comments::{Comment, CommentKind, Comments},\n         errors::HANDLER,\n+        source_map::PURE_SP,\n         util::take::Take,\n         BytePos, FileName, Mark, Span, SyntaxContext, DUMMY_SP,\n     },\n@@ -32,6 +33,7 @@ use turbo_rcstr::RcStr;\n #[serde(deny_unknown_fields, rename_all = \"camelCase\")]\n pub struct Config {\n     pub is_react_server_layer: bool,\n+    pub is_development: bool,\n     pub use_cache_enabled: bool,\n     pub hash_salt: String,\n     pub cache_kinds: FxHashSet<RcStr>,\n@@ -1859,7 +1861,17 @@ impl<C: Comments> VisitMut for ServerActions<C> {\n                             ExportDefaultExpr {\n                                 span: DUMMY_SP,\n                                 expr: Box::new(Expr::Call(CallExpr {\n-                                    span: ident.span,\n+                                    // In development we generate these spans for sourcemapping with\n+                                    // better logs/errors\n+                                    // For production this is not generated because it would leak\n+                                    // server code when available from the browser.\n+                                    span: if self.config.is_react_server_layer\n+                                        || self.config.is_development\n+                                    {\n+                                        ident.span\n+                                    } else {\n+                                        PURE_SP\n+                                    },\n                                     callee: Callee::Expr(Box::new(Expr::Ident(\n                                         create_ref_ident.clone(),\n                                     ))),\n@@ -1876,8 +1888,8 @@ impl<C: Comments> VisitMut for ServerActions<C> {\n                         ));\n                         new.push(export_expr);\n                     } else {\n-                        let call_expr_span = Span::dummy_with_cmt();\n-                        self.comments.add_pure_comment(call_expr_span.lo);\n+                        let dummy_pure_span = Span::dummy_with_cmt();\n+                        self.comments.add_pure_comment(dummy_pure_span.lo);\n \n                         let export_expr =\n                             ModuleItem::ModuleDecl(ModuleDecl::ExportDecl(ExportDecl {\n@@ -1888,10 +1900,25 @@ impl<C: Comments> VisitMut for ServerActions<C> {\n                                     decls: vec![VarDeclarator {\n                                         span: DUMMY_SP,\n                                         name: Pat::Ident(\n-                                            IdentName::new(export_name.clone(), ident.span).into(),\n+                                            IdentName::new(\n+                                                export_name.clone(),\n+                                                // In development we generate these spans for\n+                                                // sourcemapping with better logs/errors\n+                                                // For production this is not generated because it\n+                                                // would leak server code when available from the\n+                                                // browser.\n+                                                if self.config.is_react_server_layer\n+                                                    || self.config.is_development\n+                                                {\n+                                                    ident.span\n+                                                } else {\n+                                                    DUMMY_SP\n+                                                },\n+                                            )\n+                                            .into(),\n                                         ),\n                                         init: Some(Box::new(Expr::Call(CallExpr {\n-                                            span: call_expr_span,\n+                                            span: dummy_pure_span,\n                                             callee: Callee::Expr(Box::new(Expr::Ident(\n                                                 create_ref_ident.clone(),\n                                             ))),"
        },
        {
            "sha": "054604c7641178082b3678c5b4e8514471799708",
            "filename": "crates/next-custom-transforms/tests/errors.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -165,6 +165,7 @@ fn react_server_actions_errors(input: PathBuf) {\n                     &FileName::Real(\"/app/item.js\".into()),\n                     server_actions::Config {\n                         is_react_server_layer,\n+                        is_development: true,\n                         use_cache_enabled: true,\n                         hash_salt: \"\".into(),\n                         cache_kinds: FxHashSet::default(),\n@@ -225,6 +226,7 @@ fn use_cache_not_allowed(input: PathBuf) {\n                     &FileName::Real(\"/app/item.js\".into()),\n                     server_actions::Config {\n                         is_react_server_layer: true,\n+                        is_development: true,\n                         use_cache_enabled: false,\n                         hash_salt: \"\".into(),\n                         cache_kinds: FxHashSet::from_iter([\"x\".into()]),"
        },
        {
            "sha": "4b889f675fc87bd308722a26d8ccd97dfed79a5b",
            "filename": "crates/next-custom-transforms/tests/fixture.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -541,6 +541,7 @@ fn next_font_loaders_fixture(input: PathBuf) {\n fn server_actions_fixture(input: PathBuf) {\n     let output = input.parent().unwrap().join(\"output.js\");\n     let is_react_server_layer = input.iter().any(|s| s.to_str() == Some(\"server-graph\"));\n+    let is_development = input.iter().any(|s| s.to_str() == Some(\"development\"));\n     test_fixture(\n         syntax(),\n         &|_tr| {\n@@ -550,6 +551,7 @@ fn server_actions_fixture(input: PathBuf) {\n                     &FileName::Real(\"/app/item.js\".into()),\n                     server_actions::Config {\n                         is_react_server_layer,\n+                        is_development,\n                         use_cache_enabled: true,\n                         hash_salt: \"\".into(),\n                         cache_kinds: FxHashSet::from_iter([\"x\".into()]),\n@@ -584,6 +586,7 @@ fn next_font_with_directive_fixture(input: PathBuf) {\n                     &FileName::Real(\"/app/test.tsx\".into()),\n                     server_actions::Config {\n                         is_react_server_layer: true,\n+                        is_development: true,\n                         use_cache_enabled: true,\n                         hash_salt: \"\".into(),\n                         cache_kinds: FxHashSet::default(),\n@@ -875,7 +878,10 @@ fn test_edge_assert(input: PathBuf) {\n \n #[fixture(\"tests/fixture/source-maps/**/input.js\")]\n fn test_source_maps(input: PathBuf) {\n-    let output = input.parent().unwrap().join(\"output.js\");\n+    let output: PathBuf = input.parent().unwrap().join(\"output.js\");\n+    let is_react_server_layer = input.iter().any(|s| s.to_str() == Some(\"server-graph\"));\n+    let is_development = input.iter().any(|s| s.to_str() == Some(\"development\"));\n+\n     test_fixture(\n         syntax(),\n         &|_tr| {\n@@ -884,7 +890,8 @@ fn test_source_maps(input: PathBuf) {\n                 server_actions(\n                     &FileName::Real(\"/app/item.js\".into()),\n                     server_actions::Config {\n-                        is_react_server_layer: true,\n+                        is_react_server_layer,\n+                        is_development,\n                         use_cache_enabled: true,\n                         hash_salt: \"\".into(),\n                         cache_kinds: FxHashSet::from_iter([]),"
        },
        {
            "sha": "0da3fc36e220fbc5240e9470a82ed36813c84b1b",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/development/server-actions/1/input.js",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Finput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1,38 @@\n+'use server'\n+\n+import 'server-only'\n+\n+import { redirect } from 'next/navigation'\n+import { headers, cookies } from 'next/headers'\n+\n+export async function getHeaders() {\n+  console.log('accept header:', (await headers()).get('accept'))\n+  ;(await cookies()).set('test-cookie', Date.now())\n+}\n+\n+export async function inc(value) {\n+  return value + 1\n+}\n+\n+export async function slowInc(value) {\n+  await new Promise((resolve) => setTimeout(resolve, 10000))\n+  return value + 1\n+}\n+\n+export async function dec(value) {\n+  return value - 1\n+}\n+\n+export default async function (value) {\n+  console.log('this_is_sensitive_info')\n+  return value * 2\n+}\n+\n+export async function redirectAction(path) {\n+  redirect(path)\n+}\n+\n+const original = async () => {\n+  console.log('action')\n+}\n+export { original as renamed }"
        },
        {
            "sha": "e34370d76db7c1a0108f06721ceb09f3cccbad85",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/development/server-actions/1/output.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1,8 @@\n+/* __next_internal_action_entry_do_not_use__ {\"006c24672f968b0713dae406536f7dd6fe7d9a7fa0\":\"getHeaders\",\"4028baf972d345b86b747ad0df73d75a0088a42214\":\"dec\",\"403724e93433a7e950ef2f8479f31225e4b0dd0cc5\":\"redirectAction\",\"40c18c215a6b7cdc64bf709f3a714ffdef1bf9651d\":\"default\",\"40e44b877cc9d02556f56639c94229621ab0af0f5f\":\"inc\",\"40f4ad91903d1bf66bfd4e0788888852badc924261\":\"slowInc\",\"7f1e1a741f85a589443b50c4863618893572cfb178\":\"renamed\"} */ import { createServerReference, callServer, findSourceMapURL } from \"private-next-rsc-action-client-wrapper\";\n+export var getHeaders = /*#__PURE__*/ createServerReference(\"006c24672f968b0713dae406536f7dd6fe7d9a7fa0\", callServer, void 0, findSourceMapURL, \"getHeaders\");\n+export var inc = /*#__PURE__*/ createServerReference(\"40e44b877cc9d02556f56639c94229621ab0af0f5f\", callServer, void 0, findSourceMapURL, \"inc\");\n+export var slowInc = /*#__PURE__*/ createServerReference(\"40f4ad91903d1bf66bfd4e0788888852badc924261\", callServer, void 0, findSourceMapURL, \"slowInc\");\n+export var dec = /*#__PURE__*/ createServerReference(\"4028baf972d345b86b747ad0df73d75a0088a42214\", callServer, void 0, findSourceMapURL, \"dec\");\n+export default /*#__PURE__*/ createServerReference(\"40c18c215a6b7cdc64bf709f3a714ffdef1bf9651d\", callServer, void 0, findSourceMapURL, \"default\");\n+export var redirectAction = /*#__PURE__*/ createServerReference(\"403724e93433a7e950ef2f8479f31225e4b0dd0cc5\", callServer, void 0, findSourceMapURL, \"redirectAction\");\n+export var renamed = /*#__PURE__*/ createServerReference(\"7f1e1a741f85a589443b50c4863618893572cfb178\", callServer, void 0, findSourceMapURL, \"renamed\");"
        },
        {
            "sha": "854d1bf46fc729cf6daae4ddfdcb2b9f7c7146db",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/development/server-actions/1/output.map",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.map",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fdevelopment%2Fserver-actions%2F1%2Foutput.map?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1 @@\n+{\"version\":3,\"sources\":[\"input.js\"],\"sourcesContent\":[\"'use server'\\n\\nimport 'server-only'\\n\\nimport { redirect } from 'next/navigation'\\nimport { headers, cookies } from 'next/headers'\\n\\nexport async function getHeaders() {\\n  console.log('accept header:', (await headers()).get('accept'))\\n  ;(await cookies()).set('test-cookie', Date.now())\\n}\\n\\nexport async function inc(value) {\\n  return value + 1\\n}\\n\\nexport async function slowInc(value) {\\n  await new Promise((resolve) => setTimeout(resolve, 10000))\\n  return value + 1\\n}\\n\\nexport async function dec(value) {\\n  return value - 1\\n}\\n\\nexport default async function (value) {\\n  console.log('this_is_sensitive_info')\\n  return value * 2\\n}\\n\\nexport async function redirectAction(path) {\\n  redirect(path)\\n}\\n\\nconst original = async () => {\\n  console.log('action')\\n}\\nexport { original as renamed }\\n\"],\"names\":[],\"mappings\":\";WAOsB;WAKA;WAIA;WAKA;6BAIP;WAKO;WAOb\"}"
        },
        {
            "sha": "0da3fc36e220fbc5240e9470a82ed36813c84b1b",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/production/server-actions/1/input.js",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Finput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1,38 @@\n+'use server'\n+\n+import 'server-only'\n+\n+import { redirect } from 'next/navigation'\n+import { headers, cookies } from 'next/headers'\n+\n+export async function getHeaders() {\n+  console.log('accept header:', (await headers()).get('accept'))\n+  ;(await cookies()).set('test-cookie', Date.now())\n+}\n+\n+export async function inc(value) {\n+  return value + 1\n+}\n+\n+export async function slowInc(value) {\n+  await new Promise((resolve) => setTimeout(resolve, 10000))\n+  return value + 1\n+}\n+\n+export async function dec(value) {\n+  return value - 1\n+}\n+\n+export default async function (value) {\n+  console.log('this_is_sensitive_info')\n+  return value * 2\n+}\n+\n+export async function redirectAction(path) {\n+  redirect(path)\n+}\n+\n+const original = async () => {\n+  console.log('action')\n+}\n+export { original as renamed }"
        },
        {
            "sha": "e34370d76db7c1a0108f06721ceb09f3cccbad85",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/production/server-actions/1/output.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1,8 @@\n+/* __next_internal_action_entry_do_not_use__ {\"006c24672f968b0713dae406536f7dd6fe7d9a7fa0\":\"getHeaders\",\"4028baf972d345b86b747ad0df73d75a0088a42214\":\"dec\",\"403724e93433a7e950ef2f8479f31225e4b0dd0cc5\":\"redirectAction\",\"40c18c215a6b7cdc64bf709f3a714ffdef1bf9651d\":\"default\",\"40e44b877cc9d02556f56639c94229621ab0af0f5f\":\"inc\",\"40f4ad91903d1bf66bfd4e0788888852badc924261\":\"slowInc\",\"7f1e1a741f85a589443b50c4863618893572cfb178\":\"renamed\"} */ import { createServerReference, callServer, findSourceMapURL } from \"private-next-rsc-action-client-wrapper\";\n+export var getHeaders = /*#__PURE__*/ createServerReference(\"006c24672f968b0713dae406536f7dd6fe7d9a7fa0\", callServer, void 0, findSourceMapURL, \"getHeaders\");\n+export var inc = /*#__PURE__*/ createServerReference(\"40e44b877cc9d02556f56639c94229621ab0af0f5f\", callServer, void 0, findSourceMapURL, \"inc\");\n+export var slowInc = /*#__PURE__*/ createServerReference(\"40f4ad91903d1bf66bfd4e0788888852badc924261\", callServer, void 0, findSourceMapURL, \"slowInc\");\n+export var dec = /*#__PURE__*/ createServerReference(\"4028baf972d345b86b747ad0df73d75a0088a42214\", callServer, void 0, findSourceMapURL, \"dec\");\n+export default /*#__PURE__*/ createServerReference(\"40c18c215a6b7cdc64bf709f3a714ffdef1bf9651d\", callServer, void 0, findSourceMapURL, \"default\");\n+export var redirectAction = /*#__PURE__*/ createServerReference(\"403724e93433a7e950ef2f8479f31225e4b0dd0cc5\", callServer, void 0, findSourceMapURL, \"redirectAction\");\n+export var renamed = /*#__PURE__*/ createServerReference(\"7f1e1a741f85a589443b50c4863618893572cfb178\", callServer, void 0, findSourceMapURL, \"renamed\");"
        },
        {
            "sha": "2adb393ce458c9ea03653dc179ad5285b0aac33c",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/client-graph/production/server-actions/1/output.map",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.map",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fclient-graph%2Fproduction%2Fserver-actions%2F1%2Foutput.map?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -0,0 +1 @@\n+{\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\"}"
        },
        {
            "sha": "447c7775ed121d6139da8cf9dbd376c2842fbd21",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/server-graph/use-cache/1/input.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Finput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "previous_filename": "crates/next-custom-transforms/tests/fixture/source-maps/use-cache/1/input.js"
        },
        {
            "sha": "1cc448e784ad93e0856617e163e88ba782651f09",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/server-graph/use-cache/1/output.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.js?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "previous_filename": "crates/next-custom-transforms/tests/fixture/source-maps/use-cache/1/output.js"
        },
        {
            "sha": "191a72d02e77877a86cdf87015826326b0881ba1",
            "filename": "crates/next-custom-transforms/tests/fixture/source-maps/server-graph/use-cache/1/output.map",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.map",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fsource-maps%2Fserver-graph%2Fuse-cache%2F1%2Foutput.map?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "previous_filename": "crates/next-custom-transforms/tests/fixture/source-maps/use-cache/1/output.map"
        },
        {
            "sha": "bc800dfd478c2ca2d8a839b1c4dca95e6dd40783",
            "filename": "packages/next/src/build/swc/options.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Foptions.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9d1c6fddf0ea94707b34a35a7d08389f0777d28c/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Foptions.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Foptions.ts?ref=9d1c6fddf0ea94707b34a35a7d08389f0777d28c",
            "patch": "@@ -219,6 +219,7 @@ function getBaseSWCOptions({\n       isAppRouterPagesLayer && !jest\n         ? {\n             isReactServerLayer,\n+            isDevelopment: development,\n             useCacheEnabled,\n             hashSalt: serverReferenceHashSalt,\n             cacheKinds: ['default', 'remote'].concat("
        }
    ],
    "stats": {
        "total": 233,
        "additions": 192,
        "deletions": 41
    }
}