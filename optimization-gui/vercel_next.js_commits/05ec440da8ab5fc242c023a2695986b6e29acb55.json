{
    "author": "gnoff",
    "message": "Reference the workUnitStore when determining bailout to CSR (#79118)\n\nWhen useSearchParams is determining if it should bail out to client side\nrendering it currently consults the worksStore. This is not semantically\ncorrect since the workStore does not represent a particular render. This\nchange updates it to reference the workUnitStore where we can correctly\nidentify what type of render we are within",
    "sha": "05ec440da8ab5fc242c023a2695986b6e29acb55",
    "files": [
        {
            "sha": "8c537914275fad3109018c7b05bd822c6b25c76d",
            "filename": "packages/next/src/client/components/bailout-to-client-rendering.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/05ec440da8ab5fc242c023a2695986b6e29acb55/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fbailout-to-client-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/05ec440da8ab5fc242c023a2695986b6e29acb55/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fbailout-to-client-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fbailout-to-client-rendering.ts?ref=05ec440da8ab5fc242c023a2695986b6e29acb55",
            "patch": "@@ -1,10 +1,21 @@\n import { BailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { workAsyncStorage } from '../../server/app-render/work-async-storage.external'\n+import { workUnitAsyncStorage } from '../../server/app-render/work-unit-async-storage.external'\n \n export function bailoutToClientRendering(reason: string): void | never {\n   const workStore = workAsyncStorage.getStore()\n \n   if (workStore?.forceStatic) return\n \n-  if (workStore?.isStaticGeneration) throw new BailoutToCSRError(reason)\n+  const workUnitStore = workUnitAsyncStorage.getStore()\n+\n+  if (workUnitStore) {\n+    switch (workUnitStore.type) {\n+      case 'prerender':\n+      case 'prerender-ppr':\n+      case 'prerender-legacy':\n+        throw new BailoutToCSRError(reason)\n+      default:\n+    }\n+  }\n }"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
    }
}