{
    "author": "wyattjoh",
    "message": "Remove deprecated experimental_ppr route-level configuration (#84871)\n\n### What?\n\nRemoves the deprecated `experimental_ppr` route-level configuration\noption from Next.js.\n\n### Why?\n\nThe PPR configuration feature has been deprecated in favor of the cache\ncomponents feature flag. The `experimental_ppr` route-level option no\nlonger has any effect since incremental PPR is not supported with cache\ncomponents.\n\nRather than silently ignoring this configuration, this change ensures\nthat users receive an explicit error when they attempt to export\n`experimental_ppr` from their routes. This provides clear feedback that\nthe configuration needs to be removed when migrating to the cache\ncomponents approach.\n\n### How?\n\n- Removed `experimental_ppr` from the segment config schema and types\n(both Rust and TypeScript)\n- Updated `checkIsRoutePPREnabled` to no longer accept the `appConfig`\nparameter since route-level config is removed\n- Added `experimental_ppr` to the list of possibly invalid exports when\ncache components are enabled, ensuring users get an error instead of\nsilent failure\n- Removed unused `reduceAppConfig` import that was no longer needed\nafter these changes",
    "sha": "776625634df4260cf7c6f5459ffc74c98ba9f136",
    "files": [
        {
            "sha": "257f20202c6ed4ced69d54c8fb43ad4e1b429f9d",
            "filename": "crates/next-core/src/segment_config.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -89,7 +89,6 @@ pub struct NextSegmentConfig {\n     pub fetch_cache: Option<NextSegmentFetchCache>,\n     pub runtime: Option<NextRuntime>,\n     pub preferred_region: Option<Vec<RcStr>>,\n-    pub experimental_ppr: Option<bool>,\n     pub middleware_matcher: Option<Vec<MiddlewareMatcherKind>>,\n \n     /// Whether these exports are defined in the source file.\n@@ -118,7 +117,6 @@ impl NextSegmentConfig {\n             fetch_cache,\n             runtime,\n             preferred_region,\n-            experimental_ppr,\n             ..\n         } = self;\n         *dynamic = dynamic.or(parent.dynamic);\n@@ -127,7 +125,6 @@ impl NextSegmentConfig {\n         *fetch_cache = fetch_cache.or(parent.fetch_cache);\n         *runtime = runtime.or(parent.runtime);\n         *preferred_region = preferred_region.take().or(parent.preferred_region.clone());\n-        *experimental_ppr = experimental_ppr.or(parent.experimental_ppr);\n     }\n \n     /// Applies a config from a parallel route to this config, returning an\n@@ -161,7 +158,6 @@ impl NextSegmentConfig {\n             fetch_cache,\n             runtime,\n             preferred_region,\n-            experimental_ppr,\n             ..\n         } = self;\n         merge_parallel(dynamic, &parallel_config.dynamic, \"dynamic\")?;\n@@ -178,11 +174,6 @@ impl NextSegmentConfig {\n             &parallel_config.preferred_region,\n             \"preferredRegion\",\n         )?;\n-        merge_parallel(\n-            experimental_ppr,\n-            &parallel_config.experimental_ppr,\n-            \"experimental_ppr\",\n-        )?;\n         Ok(())\n     }\n }\n@@ -930,35 +921,6 @@ async fn parse_config_value(\n         \"generateStaticParams\" => {\n             config.generate_static_params = Some(span);\n         }\n-        \"experimental_ppr\" => {\n-            let Some(value) = get_value() else {\n-                return invalid_config(\n-                    source,\n-                    \"experimental_ppr\",\n-                    span,\n-                    rcstr!(\"It mustn't be reexported.\"),\n-                    None,\n-                    IssueSeverity::Error,\n-                )\n-                .await;\n-            };\n-            if matches!(value, JsValue::Constant(ConstantValue::Undefined)) {\n-                return Ok(());\n-            }\n-            let Some(val) = value.as_bool() else {\n-                return invalid_config(\n-                    source,\n-                    \"experimental_ppr\",\n-                    span,\n-                    rcstr!(\"`experimental_ppr` needs to be a static boolean.\"),\n-                    Some(&value),\n-                    IssueSeverity::Error,\n-                )\n-                .await;\n-            };\n-\n-            config.experimental_ppr = Some(val);\n-        }\n         _ => {}\n     }\n "
        },
        {
            "sha": "62253693e4e6bb3cf80023e3f3c0b3d676e7975e",
            "filename": "crates/next-custom-transforms/src/transforms/react_server_components.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -843,7 +843,8 @@ impl ReactServerComponentValidator {\n                             );\n                         }\n                     }\n-                    \"dynamicParams\" | \"dynamic\" | \"fetchCache\" | \"revalidate\" => {\n+                    \"dynamicParams\" | \"dynamic\" | \"fetchCache\" | \"revalidate\"\n+                    | \"experimental_ppr\" => {\n                         if self.cache_components_enabled {\n                             possibly_invalid_exports.insert(\n                                 export_name.clone(),"
        },
        {
            "sha": "ec7599d529b5d7f7eeec5a41e513d68b90272a46",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -2912,7 +2912,7 @@ export default async function build(\n                 const isDynamicError = appConfig?.dynamic === 'error'\n \n                 const isRoutePPREnabled: boolean = appConfig\n-                  ? checkIsRoutePPREnabled(config.experimental.ppr, appConfig)\n+                  ? checkIsRoutePPREnabled(config.experimental.ppr)\n                   : false\n \n                 routes.forEach((route) => {\n@@ -3105,7 +3105,7 @@ export default async function build(\n             // partial pre-rendering.\n             const isRoutePPREnabled: true | undefined =\n               !isAppRouteHandler &&\n-              checkIsRoutePPREnabled(config.experimental.ppr, appConfig)\n+              checkIsRoutePPREnabled(config.experimental.ppr)\n                 ? true\n                 : undefined\n "
        },
        {
            "sha": "f5c8be6c91bbc524f5156453ecf46c977a5d4131",
            "filename": "packages/next/src/build/segment-config/app/app-segment-config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segment-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segment-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segment-config.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -135,13 +135,6 @@ const AppSegmentConfigSchema = z.object({\n    */\n   preferredRegion: z.union([z.string(), z.array(z.string())]).optional(),\n \n-  /**\n-   * Whether the page supports partial prerendering. When true, the page will be\n-   * served using partial prerendering. This setting will only take affect if\n-   * it's enabled via the `experimental.ppr = \"incremental\"` option.\n-   */\n-  experimental_ppr: z.boolean().optional(),\n-\n   /**\n    * The runtime to use for the page.\n    */\n@@ -240,13 +233,6 @@ export type AppSegmentConfig = {\n    */\n   preferredRegion?: string | string[]\n \n-  /**\n-   * Whether the page supports partial prerendering. When true, the page will be\n-   * served using partial prerendering. This setting will only take affect if\n-   * it's enabled via the `experimental.ppr = \"incremental\"` option.\n-   */\n-  experimental_ppr?: boolean\n-\n   /**\n    * The runtime to use for the page.\n    */"
        },
        {
            "sha": "40ddd9556c7c460622f75e674f249194a64cdcfc",
            "filename": "packages/next/src/build/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -823,7 +823,7 @@ export async function isPageStatic({\n         // in incremental mode.\n         isRoutePPREnabled =\n           routeModule.definition.kind === RouteKind.APP_PAGE &&\n-          checkIsRoutePPREnabled(pprConfig, appConfig)\n+          checkIsRoutePPREnabled(pprConfig)\n \n         // If force dynamic was set and we don't have PPR enabled, then set the\n         // revalidate to 0.\n@@ -948,7 +948,6 @@ type ReducedAppConfig = Pick<\n   | 'dynamic'\n   | 'fetchCache'\n   | 'preferredRegion'\n-  | 'experimental_ppr'\n   | 'runtime'\n   | 'maxDuration'\n >\n@@ -971,7 +970,6 @@ export function reduceAppConfig(\n       fetchCache,\n       preferredRegion,\n       revalidate,\n-      experimental_ppr,\n       runtime,\n       maxDuration,\n     } = segment.config || {}\n@@ -1004,12 +1002,6 @@ export function reduceAppConfig(\n       config.revalidate = revalidate\n     }\n \n-    // If partial prerendering has been set, only override it if the current\n-    // value is provided as it's resolved from root layout to leaf page.\n-    if (typeof experimental_ppr !== 'undefined') {\n-      config.experimental_ppr = experimental_ppr\n-    }\n-\n     if (typeof runtime !== 'undefined') {\n       config.runtime = runtime\n     }"
        },
        {
            "sha": "1180f220722da49c082d825cf8289795eced4f8d",
            "filename": "packages/next/src/build/webpack/plugins/next-types-plugin/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -85,7 +85,6 @@ checkFields<Diff<{\n   generateMetadata?: Function\n   viewport?: any\n   generateViewport?: Function\n-  experimental_ppr?: boolean\n   `\n   }\n }, TEntry, ''>>()"
        },
        {
            "sha": "95acac89a7a6e981fffd6b338c9367b8e5c2da3c",
            "filename": "packages/next/src/server/dev/static-paths-worker.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fstatic-paths-worker.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -3,7 +3,6 @@ import type { NextConfigComplete } from '../config-shared'\n import '../require-hook'\n import '../node-environment'\n \n-import { reduceAppConfig } from '../../build/utils'\n import { collectSegments } from '../../build/segment-config/app/app-segments'\n import type { StaticPathsResult } from '../../build/static-paths/types'\n import { loadComponents } from '../load-components'\n@@ -114,7 +113,7 @@ export async function loadStaticPaths({\n \n     const isRoutePPREnabled =\n       isAppPageRouteModule(routeModule) &&\n-      checkIsRoutePPREnabled(config.pprConfig, reduceAppConfig(segments))\n+      checkIsRoutePPREnabled(config.pprConfig)\n \n     const rootParamKeys = collectRootParamKeys(routeModule)\n "
        },
        {
            "sha": "50d441068ef9c7b779128589fe048eae996056cb",
            "filename": "packages/next/src/server/lib/experimental/ppr.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fexperimental%2Fppr.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -40,22 +40,13 @@ export function checkIsAppPPREnabled(\n  * @see {@link checkIsAppPPREnabled} for checking if the application has PPR enabled.\n  */\n export function checkIsRoutePPREnabled(\n-  config: ExperimentalPPRConfig | undefined,\n-  appConfig: {\n-    experimental_ppr?: boolean\n-  }\n+  config: ExperimentalPPRConfig | undefined\n ): boolean {\n   // If the config is undefined, partial prerendering is disabled.\n   if (typeof config === 'undefined') return false\n \n   // If the config is a boolean, use it directly.\n   if (typeof config === 'boolean') return config\n \n-  // If the config is a string, it must be 'incremental' to enable partial\n-  // prerendering.\n-  if (config === 'incremental' && appConfig.experimental_ppr === true) {\n-    return true\n-  }\n-\n   return false\n }"
        },
        {
            "sha": "4103c9661dbd7befa076deef55ed3b40d0f78ac5",
            "filename": "packages/next/src/server/typescript/rules/config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -145,17 +145,6 @@ const API_DOCS: Record<\n       '`maxDuration` allows you to set max default execution time for your function. If it is not specified, the default value is dependent on your deployment platform and plan.',\n     link: 'https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#maxduration',\n   },\n-  experimental_ppr: {\n-    description: `Enables experimental Partial Prerendering (PPR) for this page / layout, when PPR is set to \"incremental\" mode.`,\n-    link: 'https://nextjs.org/docs/app/api-reference/next-config-js/ppr',\n-    options: {\n-      true: 'Enable PPR for this route',\n-      false: 'Disable PPR for this route',\n-    } satisfies DocsOptionsObject<FullAppSegmentConfig['experimental_ppr']>,\n-    isValid: (value: string) => {\n-      return value === 'true' || value === 'false'\n-    },\n-  },\n   unstable_prefetch: {\n     description: `Specifies the default prefetching behavior for this segment. This configuration is currently under development and will change.`,\n     link: '(docs coming soon)',"
        },
        {
            "sha": "fc9039e39ba8f7d74020b4c9d0d02ccea88c3efd",
            "filename": "test/e2e/app-dir/metadata/app/large-shell/[slug]/page.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/776625634df4260cf7c6f5459ffc74c98ba9f136/test%2Fe2e%2Fapp-dir%2Fmetadata%2Fapp%2Flarge-shell%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/776625634df4260cf7c6f5459ffc74c98ba9f136/test%2Fe2e%2Fapp-dir%2Fmetadata%2Fapp%2Flarge-shell%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata%2Fapp%2Flarge-shell%2F%5Bslug%5D%2Fpage.tsx?ref=776625634df4260cf7c6f5459ffc74c98ba9f136",
            "patch": "@@ -1,7 +1,5 @@\n import type { Metadata } from 'next'\n \n-export const experimental_ppr = true\n-\n export const generateMetadata = async ({ params }): Promise<Metadata> => {\n   const { slug } = await params\n   return { title: `${slug}` }"
        }
    ],
    "stats": {
        "total": 97,
        "additions": 7,
        "deletions": 90
    }
}