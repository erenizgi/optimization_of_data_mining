{
    "author": "eps1lon",
    "message": "[test] Remove `maxRetries` and `hardError` parameters (#85536)",
    "sha": "920b2c0073c519d43a6b6b087c08aaf55e9c80b1",
    "files": [
        {
            "sha": "011bee4e772026bf5df88763936547f8985e4928",
            "filename": "test/e2e/app-dir/actions/app-action.test.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 7,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts?ref=920b2c0073c519d43a6b6b087c08aaf55e9c80b1",
            "patch": "@@ -2,7 +2,6 @@ import { FileRef, nextTestSetup } from 'e2e-utils'\n import {\n   assertHasRedbox,\n   retry,\n-  check,\n   waitFor,\n   getRedboxSource,\n   getDistDir,\n@@ -527,17 +526,29 @@ describe('app-dir action handling', () => {\n \n     // navigate to server\n     await browser.elementByCss('#navigate-server').click()\n-    // intentionally bailing after 2 retries so we don't retry to the point where the async function resolves\n-    await check(() => browser.url(), `${next.url}/server`, true, 2)\n+    // intentionally bailing after 2s so we don't retry to the point where the async function resolves\n+    await retry(\n+      async () => {\n+        expect(await browser.url()).toEqual(`${next.url}/server`)\n+      },\n+      2000,\n+      1000\n+    )\n \n     browser = await next.browser('/server')\n \n     await browser.elementByCss('#slow-inc').click()\n \n     // navigate to client\n     await browser.elementByCss('#navigate-client').click()\n-    // intentionally bailing after 2 retries so we don't retry to the point where the async function resolves\n-    await check(() => browser.url(), `${next.url}/client`, true, 2)\n+    // intentionally bailing after 2s so we don't retry to the point where the async function resolves\n+    await retry(\n+      async () => {\n+        expect(await browser.url()).toEqual(`${next.url}/client`)\n+      },\n+      2000,\n+      1000\n+    )\n   })\n \n   it('should not block router.back() while a server action is in flight', async () => {\n@@ -549,8 +560,14 @@ describe('app-dir action handling', () => {\n \n     await browser.back()\n \n-    // intentionally bailing after 2 retries so we don't retry to the point where the async function resolves\n-    await check(() => browser.url(), `${next.url}/`, true, 2)\n+    // intentionally bailing after 2s so we don't retry to the point where the async function resolves\n+    await retry(\n+      async () => {\n+        expect(await browser.url()).toEqual(`${next.url}/`)\n+      },\n+      2000,\n+      1000\n+    )\n   })\n \n   it('should trigger a refresh for a server action that also dispatches a navigation event', async () => {"
        },
        {
            "sha": "ea7bc6fb6cc73696afb7be96a0abb6f33e84516c",
            "filename": "test/e2e/getserversideprops/test/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Fe2e%2Fgetserversideprops%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Fe2e%2Fgetserversideprops%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fgetserversideprops%2Ftest%2Findex.test.ts?ref=920b2c0073c519d43a6b6b087c08aaf55e9c80b1",
            "patch": "@@ -598,13 +598,9 @@ const runTests = (isDev = false, isDeploy = false) => {\n \n   it('should load a fast refresh page', async () => {\n     const browser = await webdriver(next.url, '/refresh')\n-    expect(\n-      await check(\n-        () => browser.elementByCss('p').text(),\n-        /client loaded/,\n-        false\n-      )\n-    ).toBe(true)\n+    await retry(async () => {\n+      expect(await browser.elementByCss('p').text()).toMatch(/client loaded/)\n+    })\n   })\n \n   it('should provide correct query value for dynamic page', async () => {"
        },
        {
            "sha": "0bdf1fc7836876167048c56df506374cf77fdb3f",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 19,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/920b2c0073c519d43a6b6b087c08aaf55e9c80b1/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=920b2c0073c519d43a6b6b087c08aaf55e9c80b1",
            "patch": "@@ -697,25 +697,18 @@ export async function startCleanStaticServer(dir: string) {\n /**\n  * Check for content in 1 second intervals timing out after 30 seconds.\n  * @deprecated use retry + expect instead\n- * @param {() => Promise<unknown> | unknown} contentFn\n- * @param {RegExp | string | number} regex\n- * @param {boolean} hardError\n- * @param {number} maxRetries\n- * @returns {Promise<boolean>}\n  */\n export async function check(\n-  contentFn: () => any | Promise<any>,\n-  regex: any,\n-  hardError = true,\n-  maxRetries = 30\n-) {\n-  let content\n-  let lastErr\n+  contentFn: () => unknown | Promise<unknown>,\n+  regex: any\n+): Promise<boolean> {\n+  let content: unknown\n+  let lastErr: unknown\n \n-  for (let tries = 0; tries < maxRetries; tries++) {\n+  for (let tries = 0; tries < 30; tries++) {\n     try {\n       content = await contentFn()\n-      if (typeof regex !== typeof /regex/) {\n+      if (typeof regex !== 'object') {\n         if (regex === content) {\n           return true\n         }\n@@ -730,11 +723,7 @@ export async function check(\n     }\n   }\n   console.error('TIMED OUT CHECK: ', { regex, content, lastErr })\n-\n-  if (hardError) {\n-    throw new Error('TIMED OUT: ' + regex + '\\n\\n' + content + '\\n\\n' + lastErr)\n-  }\n-  return false\n+  throw new Error('TIMED OUT: ' + regex + '\\n\\n' + content + '\\n\\n' + lastErr)\n }\n \n export class File {"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 35,
        "deletions": 33
    }
}