{
    "author": "eps1lon",
    "message": "[dev-overlay] Isolate overlay from user space Components (#76277)",
    "sha": "69333f5140bc9aaec2f113807461c9b4e7d67766",
    "files": [
        {
            "sha": "247e9f8c1d620a63342a62798cd64cfb4f8e681e",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay-error-boundary.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx?ref=69333f5140bc9aaec2f113807461c9b4e7d67766",
            "patch": "@@ -5,7 +5,6 @@ import { RuntimeErrorHandler } from '../../errors/runtime-error-handler'\n \n type AppDevOverlayErrorBoundaryProps = {\n   children: React.ReactNode\n-  devOverlay: React.ReactNode\n   globalError: [GlobalErrorComponent, React.ReactNode]\n   onError: (value: boolean) => void\n }\n@@ -62,18 +61,13 @@ export class AppDevOverlayErrorBoundary extends PureComponent<\n   }\n \n   render() {\n-    const { children, globalError, devOverlay } = this.props\n+    const { children, globalError } = this.props\n     const { isReactError, reactError } = this.state\n \n     const fallback = (\n       <ErroredHtml globalError={globalError} error={reactError} />\n     )\n \n-    return (\n-      <>\n-        {isReactError ? fallback : children}\n-        {devOverlay}\n-      </>\n-    )\n+    return isReactError ? fallback : children\n   }\n }"
        },
        {
            "sha": "ecee4260c52a728354c252d82ba3a739357c5523",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=69333f5140bc9aaec2f113807461c9b4e7d67766",
            "patch": "@@ -16,8 +16,16 @@ export function AppDevOverlay({\n   children: React.ReactNode\n }) {\n   const [isErrorOverlayOpen, setIsErrorOverlayOpen] = useState(false)\n-  const devOverlay = (\n+\n+  return (\n     <>\n+      <AppDevOverlayErrorBoundary\n+        globalError={globalError}\n+        onError={setIsErrorOverlayOpen}\n+      >\n+        {children}\n+      </AppDevOverlayErrorBoundary>\n+\n       {/* Fonts can only be loaded outside the Shadow DOM. */}\n       <FontStyles />\n       <DevOverlay\n@@ -27,14 +35,4 @@ export function AppDevOverlay({\n       />\n     </>\n   )\n-\n-  return (\n-    <AppDevOverlayErrorBoundary\n-      devOverlay={devOverlay}\n-      globalError={globalError}\n-      onError={setIsErrorOverlayOpen}\n-    >\n-      {children}\n-    </AppDevOverlayErrorBoundary>\n-  )\n }"
        },
        {
            "sha": "3c269f2a6f2655f914f318eeacc47d9552f33698",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay/error-overlay.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69333f5140bc9aaec2f113807461c9b4e7d67766/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx?ref=69333f5140bc9aaec2f113807461c9b4e7d67766",
            "patch": "@@ -1,5 +1,6 @@\n import type { OverlayState } from '../../../../shared'\n \n+import { Suspense } from 'react'\n import { BuildError } from '../../../container/build-error'\n import { Errors } from '../../../container/errors'\n import { RootLayoutMissingTagsError } from '../../../container/root-layout-missing-tags-error'\n@@ -64,11 +65,15 @@ export function ErrorOverlay({\n \n   // No Runtime Errors.\n   if (!runtimeErrors.length) {\n-    return null\n+    // Workaround React quirk that triggers \"Switch to client-side rendering\" if\n+    // we return no Suspense boundary here.\n+    return <Suspense />\n   }\n \n   if (!mounted) {\n-    return null\n+    // Workaround React quirk that triggers \"Switch to client-side rendering\" if\n+    // we return no Suspense boundary here.\n+    return <Suspense />\n   }\n \n   return ("
        },
        {
            "sha": "fd5a9ae1cb30ee9fbae73337475fec33c1f7e42b",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/69333f5140bc9aaec2f113807461c9b4e7d67766/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69333f5140bc9aaec2f113807461c9b4e7d67766/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=69333f5140bc9aaec2f113807461c9b4e7d67766",
            "patch": "@@ -216,7 +216,7 @@ describe('Error overlay for hydration errors in App router', () => {\n        \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary devOverlay={<Fragment>} globalError={[...]} onError={function bound dispatchSetState}>\n+               <AppDevOverlayErrorBoundary globalError={[...]} onError={function bound dispatchSetState}>\n                  <DevRootHTTPAccessFallbackBoundary>\n                    <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n                      <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n@@ -232,14 +232,14 @@ describe('Error overlay for hydration errors in App router', () => {\n        -                         className=\"server-html\"\n                                >\n                            ...\n-                 ...\"\n+               ...\"\n       `)\n     } else {\n       expect(pseudoHtml).toMatchInlineSnapshot(`\n        \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary devOverlay={<Fragment>} globalError={[...]} onError={function bound dispatchSetState}>\n+               <AppDevOverlayErrorBoundary globalError={[...]} onError={function bound dispatchSetState}>\n                  <DevRootHTTPAccessFallbackBoundary>\n                    <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n                      <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n@@ -252,7 +252,7 @@ describe('Error overlay for hydration errors in App router', () => {\n        -                         className=\"server-html\"\n                                >\n                            ...\n-                 ...\"\n+               ...\"\n       `)\n     }\n "
        },
        {
            "sha": "005a5fd2e3bbd609767878615b34190a05ec0991",
            "filename": "test/e2e/app-dir/server-source-maps/server-source-maps.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/69333f5140bc9aaec2f113807461c9b4e7d67766/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69333f5140bc9aaec2f113807461c9b4e7d67766/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts?ref=69333f5140bc9aaec2f113807461c9b4e7d67766",
            "patch": "@@ -216,10 +216,9 @@ describe('app-dir - server source maps', () => {\n       )\n       expect(cliOutput).toMatch(/digest: '\\d+'/)\n \n-      // TODO(veil): Should be a single error\n       await expect(browser).toDisplayRedbox(`\n        {\n-         \"count\": 2,\n+         \"count\": 1,\n          \"description\": \"Error: Boom\",\n          \"environmentLabel\": null,\n          \"label\": \"Unhandled Runtime Error\","
        }
    ],
    "stats": {
        "total": 50,
        "additions": 23,
        "deletions": 27
    }
}