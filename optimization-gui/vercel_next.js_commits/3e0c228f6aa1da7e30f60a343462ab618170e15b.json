{
    "author": "huozhi",
    "message": "[test] separate tracing error test from action test suite (#80324)",
    "sha": "3e0c228f6aa1da7e30f60a343462ab618170e15b",
    "files": [
        {
            "sha": "78c4d0dd78db7cecfa93808d762b6d2e664c05da",
            "filename": "test/e2e/app-dir/actions/app-action.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -10,7 +10,7 @@ import {\n import type { Request, Response } from 'playwright'\n import fs from 'fs-extra'\n import nodeFs from 'fs'\n-import path, { join } from 'path'\n+import { join } from 'path'\n import { outdent } from 'outdent'\n \n const GENERIC_RSC_ERROR =\n@@ -31,17 +31,6 @@ describe('app-dir action handling', () => {\n       },\n     })\n \n-  if (isNextStart) {\n-    it('should trace server action imported by client correctly', async () => {\n-      const traceData = await next.readJSON(\n-        path.join('.next', 'server', 'app', 'client', 'page.js.nft.json')\n-      )\n-      expect(traceData.files.some((file) => file.includes('data.txt'))).toBe(\n-        true\n-      )\n-    })\n-  }\n-\n   it('should handle action correctly with middleware rewrite', async () => {\n     const browser = await next.browser('/rewrite-to-static-first')\n     let actionRequestStatus: number | undefined"
        },
        {
            "sha": "0da3fc36e220fbc5240e9470a82ed36813c84b1b",
            "filename": "test/e2e/app-dir/actions/app/client/actions.js",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fclient%2Factions.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fclient%2Factions.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fclient%2Factions.js?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -5,13 +5,6 @@ import 'server-only'\n import { redirect } from 'next/navigation'\n import { headers, cookies } from 'next/headers'\n \n-try {\n-  require('fs').readFileSync(\n-    require('path').join(process.cwd(), 'data.txt'),\n-    'utf8'\n-  )\n-} catch {}\n-\n export async function getHeaders() {\n   console.log('accept header:', (await headers()).get('accept'))\n   ;(await cookies()).set('test-cookie', Date.now())"
        },
        {
            "sha": "95d09f2b10159347eece71399a7e2e907ea3df4f",
            "filename": "test/e2e/app-dir/actions/data.txt",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d69496704a433acefb7784b2c5e0897ac75a1c21/test%2Fe2e%2Fapp-dir%2Factions%2Fdata.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/d69496704a433acefb7784b2c5e0897ac75a1c21/test%2Fe2e%2Fapp-dir%2Factions%2Fdata.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fdata.txt?ref=d69496704a433acefb7784b2c5e0897ac75a1c21",
            "patch": "@@ -1 +0,0 @@\n-hello world\n\\ No newline at end of file"
        },
        {
            "sha": "942f648a58a1c99511ac623947e449c8f409f9f2",
            "filename": "test/production/app-dir/action-tracing/action-tracing.test.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Faction-tracing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Faction-tracing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Faction-tracing.test.ts?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1,19 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import path from 'path'\n+\n+describe('action-tracing', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+  if (skipped) return\n+\n+  it('should trace server action imported by client correctly', async () => {\n+    const traceData = (await next.readJSON(\n+      path.join('.next', 'server', 'app', 'page.js.nft.json')\n+    )) as {\n+      files: string[]\n+    }\n+    expect(traceData.files.some((file) => file.includes('data.txt'))).toBe(true)\n+  })\n+})"
        },
        {
            "sha": "219a2f7774afb98502a68889bc753cc49ea209e9",
            "filename": "test/production/app-dir/action-tracing/app/action.ts",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Faction.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Faction.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Faction.ts?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1,14 @@\n+'use server'\n+\n+try {\n+  if (process.env.NEXT_RUNTIME !== 'edge') {\n+    require('fs').readFileSync(\n+      require('path').join(process.cwd(), 'data.txt'),\n+      'utf8'\n+    )\n+  }\n+} catch {}\n+\n+export async function action() {\n+  return 'action'\n+}"
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/production/app-dir/action-tracing/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Flayout.tsx?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "031e63d8bf0a582adec759ffd66c7ac591f144e2",
            "filename": "test/production/app-dir/action-tracing/app/page.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fapp%2Fpage.tsx?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1,15 @@\n+'use client'\n+\n+import { action } from './action'\n+\n+export default function Page() {\n+  return (\n+    <button\n+      onClick={() => {\n+        action()\n+      }}\n+    >\n+      click\n+    </button>\n+  )\n+}"
        },
        {
            "sha": "6320cd248dd8aeaab759d5871f8781b5c0505172",
            "filename": "test/production/app-dir/action-tracing/data.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fdata.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fdata.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fdata.txt?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1 @@\n+data\n\\ No newline at end of file"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/app-dir/action-tracing/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3e0c228f6aa1da7e30f60a343462ab618170e15b/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Faction-tracing%2Fnext.config.js?ref=3e0c228f6aa1da7e30f60a343462ab618170e15b",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 84,
        "additions": 64,
        "deletions": 20
    }
}