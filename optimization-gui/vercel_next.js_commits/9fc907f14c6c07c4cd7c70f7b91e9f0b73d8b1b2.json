{
    "author": "bgub",
    "message": "feat: [create-next-app] generate route types after setup (#82956)\n\n## Run `next typegen` after project creation in create-next-app\n\n### What?\nThis PR adds automatic type generation after a Next.js project is\ncreated with create-next-app.\n\n### Why?\nRunning `next typegen` immediately after project creation ensures that\nroute type definitions are available right away, improving the developer\nexperience by providing proper TypeScript support from the start.\n\n### How?\n- Added a new helper function `runTypegen()` that executes the local\nNext.js binary with the `typegen` command\n- Integrated this function into both the main app creation flow and the\ntemplate installation process\n- Implemented error handling to ensure that typegen failures don't\ninterrupt the app creation process\n\n---------\n\nCo-authored-by: Sebastian Sebbie Silbermann <sebastian.silbermann@vercel.com>",
    "sha": "9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2",
    "files": [
        {
            "sha": "d2f922043b54eef72f9475daa6dbdea835265040",
            "filename": "packages/create-next-app/create-app.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Fcreate-app.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Fcreate-app.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Fcreate-app.ts?ref=9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2",
            "patch": "@@ -17,6 +17,7 @@ import { install } from './helpers/install'\n import { isFolderEmpty } from './helpers/is-folder-empty'\n import { getOnline } from './helpers/is-online'\n import { isWriteable } from './helpers/is-writeable'\n+import { runTypegen } from './helpers/typegen'\n \n import type { TemplateMode, TemplateType } from './templates'\n import { getTemplateFile, installTemplate } from './templates'\n@@ -222,6 +223,14 @@ export async function createApp({\n \n       await install(packageManager, isOnline)\n       console.log()\n+      try {\n+        console.log()\n+        await runTypegen(packageManager)\n+        console.log()\n+      } catch (err) {\n+        // Best effort: do not fail app creation if typegen fails\n+        console.error('Error running typegen:', err)\n+      }\n     }\n   } else {\n     /**"
        },
        {
            "sha": "0ce534c5872f0bec043e6e6e51683b2e6423e112",
            "filename": "packages/create-next-app/helpers/typegen.ts",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/vercel/next.js/blob/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Fhelpers%2Ftypegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Fhelpers%2Ftypegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Fhelpers%2Ftypegen.ts?ref=9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2",
            "patch": "@@ -0,0 +1,56 @@\n+/* eslint-disable import/no-extraneous-dependencies */\n+import spawn from 'cross-spawn'\n+import type { PackageManager } from './get-pkg-manager'\n+\n+/**\n+ * Runs `next typegen` using the package manager to execute the locally installed Next.js binary.\n+ * Assumes the current working directory is the project root where Next is installed.\n+ */\n+export async function runTypegen(\n+  packageManager: PackageManager\n+): Promise<void> {\n+  return new Promise((resolve, reject) => {\n+    // Determine the command and arguments based on the package manager\n+    let command: string\n+    let args: string[]\n+\n+    switch (packageManager) {\n+      case 'npm':\n+        command = 'npm'\n+        args = ['exec', 'next', '--', 'typegen']\n+        break\n+      case 'yarn':\n+        command = 'yarn'\n+        args = ['exec', 'next', '--', 'typegen']\n+        break\n+      case 'pnpm':\n+        command = 'pnpm'\n+        args = ['exec', 'next', '--', 'typegen']\n+        break\n+      case 'bun':\n+        command = 'bun'\n+        // Bun only has `bun x` which is not the same thing.\n+        // We need to hope Bun never implements their own `bun next`.\n+        args = ['next', 'typegen']\n+        break\n+      default:\n+        packageManager satisfies never\n+        throw new Error(`Unsupported package manager: ${packageManager}`)\n+    }\n+\n+    const child = spawn(command, args, {\n+      stdio: 'inherit',\n+      env: {\n+        ...process.env,\n+      },\n+    })\n+\n+    child.on('close', (code) => {\n+      if (code !== 0) {\n+        reject(new Error(`next typegen exited with code ${code}`))\n+        return\n+      }\n+      resolve()\n+    })\n+  })\n+}"
        },
        {
            "sha": "e53ca7e2a8eb1a137b08faee353b26cb82050146",
            "filename": "packages/create-next-app/templates/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts?ref=9fc907f14c6c07c4cd7c70f7b91e9f0b73d8b1b2",
            "patch": "@@ -1,4 +1,5 @@\n import { install } from \"../helpers/install\";\n+import { runTypegen } from \"../helpers/typegen\";\n import { copy } from \"../helpers/copy\";\n \n import { async as glob } from \"fast-glob\";\n@@ -302,6 +303,14 @@ export const installTemplate = async ({\n   console.log();\n \n   await install(packageManager, isOnline);\n+  try {\n+    console.log();\n+    await runTypegen(packageManager);\n+    console.log();\n+  } catch (err) {\n+    console.error(\"Error running typegen:\", err);\n+    // Best effort: do not fail app creation if typegen fails\n+  }\n };\n \n export * from \"./types\";"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 74,
        "deletions": 0
    }
}