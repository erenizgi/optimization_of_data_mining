{
    "author": "eps1lon",
    "message": "[strict-route-types] Enforce common React Component return types in App Router (#87389)\n\nFlagged behind `experimental.strictRouteTypes`.\r\n\r\nMost notably this disallows `void`. We generally treat `void` as \"forgot to add return\" in React e.g. \r\n```tsx\r\nasync function Page() {\r\n  <div />;\r\n}\r\n```\r\nwhich is a common beginner mistake. The downside is that this breaks unconditional `notFound()` or `redirect()` in Next.js. Those function throw but even with `never` as a return type, [TypeScript will not infer that this causes the caller to return `never` as well](https://github.com/microsoft/TypeScript/issues/26537).\r\n\r\n```tsx\r\n// implicit `void` return type instead of `never` due to calling `notFound(): never`\r\nfunction Page() {\r\n  notFound()\r\n}\r\n```\r\n\r\nThe fix is to explicitly annotate unconditional `notFound` usage:\r\n```tsx\r\nfunction Page(): never {\r\n  notFound()\r\n}\r\n```\r\n\r\nConditional usage would already have another `return` statement. If that's missing still, we'd consider this a mistake. You can always do `return` without a value to fix the type-issue.\r\n\r\nPages in Pages Router are not affected. Tightening types for Pages Router is out-of-scope for this project.\r\n\r\nCloses https://linear.app/vercel/issue/NXT-127/",
    "sha": "0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
    "files": [
        {
            "sha": "3520b4cbf8408d2134c52b9ff607cae3c8340b0c",
            "filename": "packages/next/src/server/lib/router-utils/typegen.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -739,7 +739,7 @@ export function generateValidatorFileStrict(\n \n   if (appPageValidations) {\n     typeDefinitions += `type AppPageConfig<Route extends AppRoutes = AppRoutes> = {\n-  default: React.ComponentType<PageProps<Route>> | ((props: PageProps<Route>) => React.ReactNode | Promise<React.ReactNode> | never | void | Promise<void>)\n+  default: React.JSXElementConstructor<PageProps<Route>>\n   generateStaticParams?: (props: { params: ParamMap[Route] }) => Promise<any[]> | any[]\n   generateMetadata?: (\n     props: PageProps<Route>,"
        },
        {
            "sha": "fc6ceb07e6e471a931a20bd6f56150a5ee089782",
            "filename": "test/e2e/app-dir/error-boundary-navigation/app/trigger-404/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-404%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-404%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-404%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@ import { notFound } from 'next/navigation'\n \n export const dynamic = 'force-dynamic'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "53d1aee20240e3df7626fa275eeac171e8bac8a4",
            "filename": "test/e2e/app-dir/error-boundary-navigation/app/trigger-error/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-error%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-error%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ferror-boundary-navigation%2Fapp%2Ftrigger-error%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,5 +1,5 @@\n export const dynamic = 'force-dynamic'\n \n-export default function Page() {\n+export default function Page(): never {\n   throw new Error('This is an error')\n }"
        },
        {
            "sha": "0eae2fe9b16616de61f273d6a28129a6c6ddead5",
            "filename": "test/e2e/app-dir/global-not-found/basic/app/call-not-found/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fbasic%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fbasic%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fbasic%2Fapp%2Fcall-not-found%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@\n \n import { notFound } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "0eae2fe9b16616de61f273d6a28129a6c6ddead5",
            "filename": "test/e2e/app-dir/global-not-found/both-present/app/call-not-found/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fboth-present%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fboth-present%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fboth-present%2Fapp%2Fcall-not-found%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@\n \n import { notFound } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "0eae2fe9b16616de61f273d6a28129a6c6ddead5",
            "filename": "test/e2e/app-dir/global-not-found/css/app/call-not-found/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fcss%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fcss%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fcss%2Fapp%2Fcall-not-found%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@\n \n import { notFound } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "0eae2fe9b16616de61f273d6a28129a6c6ddead5",
            "filename": "test/e2e/app-dir/global-not-found/metadata/app/call-not-found/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fapp%2Fcall-not-found%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@\n \n import { notFound } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "0eae2fe9b16616de61f273d6a28129a6c6ddead5",
            "filename": "test/e2e/app-dir/global-not-found/not-present/app/call-not-found/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fnot-present%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fnot-present%2Fapp%2Fcall-not-found%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fnot-present%2Fapp%2Fcall-not-found%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -2,6 +2,6 @@\n \n import { notFound } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   notFound()\n }"
        },
        {
            "sha": "0a4f0c0662ce6916d9857a2fbaf1966c2b32d1eb",
            "filename": "test/e2e/app-dir/navigation/app/redirect/redirect-with-loading/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fredirect%2Fredirect-with-loading%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fredirect%2Fredirect-with-loading%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fredirect%2Fredirect-with-loading%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,6 +1,6 @@\n import { redirect } from 'next/navigation'\n \n-export default async function Page() {\n+export default async function Page(): Promise<never> {\n   // fake delay 1s to trigger loading state\n   await new Promise((res) => setTimeout(res, 1000))\n "
        },
        {
            "sha": "b3703c9857c4157bd6bb57066163532a715549f5",
            "filename": "test/e2e/app-dir/parallel-route-not-found/app/has-both-slots/not-found-error/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fparallel-route-not-found%2Fapp%2Fhas-both-slots%2Fnot-found-error%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fparallel-route-not-found%2Fapp%2Fhas-both-slots%2Fnot-found-error%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-not-found%2Fapp%2Fhas-both-slots%2Fnot-found-error%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,5 +1,5 @@\n import { notFound } from 'next/navigation'\n \n-export default function NotFoundError() {\n+export default function NotFoundError(): never {\n   notFound()\n }"
        },
        {
            "sha": "071eb991f63e7f16148f0c6f468708715fdbb24e",
            "filename": "test/e2e/app-dir/rsc-redirect/app/origin/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Frsc-redirect%2Fapp%2Forigin%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Frsc-redirect%2Fapp%2Forigin%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-redirect%2Fapp%2Forigin%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,5 +1,5 @@\n import { redirect } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   redirect('/dest')\n }"
        },
        {
            "sha": "7f930161e3cd34c05c294cb8a8d006a3554a0a0b",
            "filename": "test/e2e/app-dir/segment-cache/revalidation/app/refetch-on-new-base-tree/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fapp%2Frefetch-on-new-base-tree%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,5 +1,5 @@\n import { redirect } from 'next/navigation'\n \n-export default function Page() {\n+export default function Page(): never {\n   redirect('/refetch-on-new-base-tree/a')\n }"
        },
        {
            "sha": "16739047441ecdab5d443294d839968f3cbb12d1",
            "filename": "test/e2e/app-dir/unstable-rethrow/app/redirect/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Funstable-rethrow%2Fapp%2Fredirect%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Funstable-rethrow%2Fapp%2Fredirect%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Funstable-rethrow%2Fapp%2Fredirect%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -8,4 +8,5 @@ export default function Page() {\n     unstable_rethrow(err)\n     console.error('[test assertion]: error leaked', err)\n   }\n+  return null\n }"
        },
        {
            "sha": "ade4524b04ae776fc6d4c638d15e768f75473ea3",
            "filename": "test/e2e/app-dir/use-cache/app/(dynamic)/hoc/[slug]/with-slug.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F(dynamic)%2Fhoc%2F%5Bslug%5D%2Fwith-slug.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F(dynamic)%2Fhoc%2F%5Bslug%5D%2Fwith-slug.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F(dynamic)%2Fhoc%2F%5Bslug%5D%2Fwith-slug.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,7 +1,6 @@\n export function withSlug(\n   Component: React.ComponentType<{ slug: string }>\n-): // TODO(NXT-127): Use ComponentType\n-React.JSXElementConstructor<{ params: Promise<{ slug: string }> }> {\n+): React.ComponentType<{ params: Promise<{ slug: string }> }> {\n   return async function ComponentWithSlug(props: {\n     params: Promise<{ slug: string }>\n   }) {"
        },
        {
            "sha": "483f269e799dc66e151445ec9788bfe61eb8c6d9",
            "filename": "test/e2e/opentelemetry/instrumentation/app/app/[param]/loading/error/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fapp%2Fapp%2F%5Bparam%5D%2Floading%2Ferror%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fapp%2Fapp%2F%5Bparam%5D%2Floading%2Ferror%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fapp%2Fapp%2F%5Bparam%5D%2Floading%2Ferror%2Fpage.tsx?ref=0f2bbc9a2d07adbcfa5ec1ebe22e3e2f61a2a63a",
            "patch": "@@ -1,6 +1,6 @@\n import { connection } from 'next/server'\n \n-export default async function Page() {\n+export default async function Page(): Promise<never> {\n   await connection()\n   // Simulate async work before throwing\n   await new Promise((resolve) => setTimeout(resolve, 100))"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 15,
        "deletions": 15
    }
}