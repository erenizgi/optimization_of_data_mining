{
    "author": "ztanner",
    "message": "[segment cache]: collectSegmentData should respect experimental.staleTime config (#84520)\n\nWhen we calculate the desired `staleTime` value we leverage the\n`selectStaleTime` util which has some logic to fallback to the\n`experimental.staleTimes` configuration if not otherwise overridden in\nthe prerenderStore. Without this change, the static staleTime from the\n`/_tree` requests would always be the max (1 year), regardless of user\nconfiguration.\n\nThis was caught by `prefetching.stale-times.test.ts` which I have\nre-enabled & refactored in the next PR in the stack.",
    "sha": "b16e10133edf7a9d34425404afbc342b7b84c9e3",
    "files": [
        {
            "sha": "b69bc44863d59f82ea18e6e0c235929ab7f69d01",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/b16e10133edf7a9d34425404afbc342b7b84c9e3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b16e10133edf7a9d34425404afbc342b7b84c9e3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=b16e10133edf7a9d34425404afbc342b7b84c9e3",
            "patch": "@@ -4833,7 +4833,8 @@ async function collectSegmentData(\n     serverModuleMap: getServerModuleMap(),\n   }\n \n-  const staleTime = prerenderStore.stale\n+  const selectStaleTime = createSelectStaleTime(renderOpts.experimental)\n+  const staleTime = selectStaleTime(prerenderStore.stale)\n   return await ComponentMod.collectSegmentData(\n     renderOpts.experimental.clientParamParsing,\n     fullPageDataBuffer,"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 2,
        "deletions": 1
    }
}