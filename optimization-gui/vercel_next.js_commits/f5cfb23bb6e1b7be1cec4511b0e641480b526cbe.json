{
    "author": "huozhi",
    "message": "fix overlay frames cannot be opened sometimes (#88210)",
    "sha": "f5cfb23bb6e1b7be1cec4511b0e641480b526cbe",
    "files": [
        {
            "sha": "7b3e57333f7acaf6ed94cfa6eda736ba7632bbfd",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/error-overlay-call-stack/error-overlay-call-stack.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 8,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/f5cfb23bb6e1b7be1cec4511b0e641480b526cbe/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-call-stack%2Ferror-overlay-call-stack.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5cfb23bb6e1b7be1cec4511b0e641480b526cbe/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-call-stack%2Ferror-overlay-call-stack.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-call-stack%2Ferror-overlay-call-stack.tsx?ref=f5cfb23bb6e1b7be1cec4511b0e641480b526cbe",
            "patch": "@@ -21,17 +21,20 @@ export function ErrorOverlayCallStack({\n   function onToggleIgnoreList() {\n     const dialog = dialogResizerRef?.current\n \n-    if (!dialog) {\n-      return\n-    }\n+    if (isIgnoreListOpen) {\n+      // Closing requires dialog for animation\n+      if (!dialog) {\n+        // No dialog ref available, just close without animation\n+        setIsIgnoreListOpen(false)\n+        return\n+      }\n \n-    const { height: currentHeight } = dialog.getBoundingClientRect()\n+      const { height: currentHeight } = dialog.getBoundingClientRect()\n \n-    if (!initialDialogHeight.current) {\n-      initialDialogHeight.current = currentHeight\n-    }\n+      if (!initialDialogHeight.current) {\n+        initialDialogHeight.current = currentHeight\n+      }\n \n-    if (isIgnoreListOpen) {\n       function onTransitionEnd() {\n         // TS bug. We closed over a non-nullable value here.\n         dialog!.removeEventListener('transitionend', onTransitionEnd)\n@@ -41,6 +44,14 @@ export function ErrorOverlayCallStack({\n       dialog.style.height = `${initialDialogHeight.current}px`\n       dialog.addEventListener('transitionend', onTransitionEnd)\n     } else {\n+      if (dialog) {\n+        const { height: currentHeight } = dialog.getBoundingClientRect()\n+        // When the ignore list is closed, we need to store the initial height of the dialog,\n+        // we need this value to restore the dialog to its original height when the ignore list is opened again.\n+        if (!initialDialogHeight.current) {\n+          initialDialogHeight.current = currentHeight\n+        }\n+      }\n       setIsIgnoreListOpen(true)\n     }\n   }"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 19,
        "deletions": 8
    }
}