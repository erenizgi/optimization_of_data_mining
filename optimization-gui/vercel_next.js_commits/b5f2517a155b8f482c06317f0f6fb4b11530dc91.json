{
    "author": "huozhi",
    "message": "[segment explorer] fix boundary trigger state (#81623)",
    "sha": "b5f2517a155b8f482c06317f0f6fb4b11530dc91",
    "files": [
        {
            "sha": "c48b6ebc9ac820a91147da91b8465d4c518c0707",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-boundary-trigger.css",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.css",
            "raw_url": "https://github.com/vercel/next.js/raw/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.css?ref=b5f2517a155b8f482c06317f0f6fb4b11530dc91",
            "patch": "@@ -47,15 +47,6 @@\n   cursor: not-allowed;\n }\n \n-.segment-boundary-trigger--boundary {\n-  background: var(--color-background-100);\n-  box-shadow: inset 0 0 0 1px var(--color-gray-400);\n-}\n-\n-.segment-boundary-trigger--boundary:hover {\n-  background: var(--color-gray-200);\n-}\n-\n .segment-boundary-dropdown {\n   padding: 8px;\n   background: var(--color-background-100);"
        },
        {
            "sha": "35f602ae4fc3b333dda689f3f88e96e368d05e47",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-boundary-trigger.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 25,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx?ref=b5f2517a155b8f482c06317f0f6fb4b11530dc91",
            "patch": "@@ -2,11 +2,7 @@ import './segment-boundary-trigger.css'\n import { useCallback, useState, useRef, useMemo } from 'react'\n import { Menu } from '@base-ui-components/react/menu'\n import type { SegmentNodeState } from '../../../userspace/app/segment-explorer-node'\n-import {\n-  isBoundaryFile,\n-  normalizeBoundaryFilename,\n-} from '../../../../server/app-render/segment-explorer-path'\n-import { cx } from '../../utils/cx'\n+import { normalizeBoundaryFilename } from '../../../../server/app-render/segment-explorer-path'\n import { useClickOutside } from '../errors/dev-tools-indicator/utils'\n \n const composeRefs = (...refs: (React.Ref<HTMLButtonElement> | undefined)[]) => {\n@@ -29,13 +25,7 @@ export function SegmentBoundaryTrigger({\n   boundaries: Record<'not-found' | 'loading' | 'error', string | null>\n }) {\n   const currNode = nodeState\n-  const {\n-    pagePath,\n-    boundaryType,\n-    type,\n-    setBoundaryType: onSelectBoundary,\n-  } = currNode\n-  const fileType = type\n+  const { pagePath, boundaryType, setBoundaryType: onSelectBoundary } = currNode\n \n   const [isOpen, setIsOpen] = useState(false)\n   // TODO: move this shadowRoot ref util to a shared hook or into context\n@@ -76,15 +66,12 @@ export function SegmentBoundaryTrigger({\n   }, [boundaries, possibleExtension])\n \n   const fileName = (pagePath || '').split('/').pop() || ''\n-  const isBoundary = isBoundaryFile(fileType)\n   const pageFileName = normalizeBoundaryFilename(\n     boundaryType\n       ? `page.${possibleExtension}`\n       : fileName || `page.${possibleExtension}`\n   )\n \n-  const isPageOrBoundary = fileType && !isBoundary\n-\n   const triggerOptions = [\n     {\n       label: fileNames.loading,\n@@ -158,15 +145,21 @@ export function SegmentBoundaryTrigger({\n     return <Trigger {...triggerProps} ref={mergedRef} />\n   }\n \n+  const hasBoundary = useMemo(() => {\n+    const hasPageOrBoundary =\n+      nodeState.type !== 'layout' && nodeState.type !== 'template'\n+    return (\n+      hasPageOrBoundary && Object.values(boundaries).some((v) => v !== null)\n+    )\n+  }, [nodeState.type, boundaries])\n+\n   return (\n     <Menu.Root delay={0} modal={false} open={isOpen} onOpenChange={setIsOpen}>\n       <Menu.Trigger\n-        className={cx(\n-          'segment-boundary-trigger',\n-          !isPageOrBoundary && 'segment-boundary-trigger--boundary'\n-        )}\n+        className=\"segment-boundary-trigger\"\n         data-nextjs-dev-overlay-segment-boundary-trigger-button\n         render={MergedRefTrigger}\n+        disabled={!hasBoundary}\n       />\n \n       {/* @ts-expect-error remove this expect-error once shadowRoot is supported as container */}\n@@ -330,13 +323,9 @@ function SwitchIcon(props: React.SVGProps<SVGSVGElement>) {\n   )\n }\n \n-export function Trigger(props: React.ComponentProps<'button'>) {\n+function Trigger(props: React.ComponentProps<'button'>) {\n   return (\n-    <button\n-      {...props}\n-      className={cx('segment-boundary-trigger', props.className)}\n-      role=\"button\"\n-    >\n+    <button {...props}>\n       <span className=\"segment-boundary-trigger-text\">\n         <SwitchIcon className=\"plus-icon\" />\n       </span>"
        },
        {
            "sha": "f7efb8b9b41fedfa7e2dfb5ad77a72a2f0028a05",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b5f2517a155b8f482c06317f0f6fb4b11530dc91/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=b5f2517a155b8f482c06317f0f6fb4b11530dc91",
            "patch": "@@ -4,7 +4,7 @@ import {\n   type SegmentTrieNode,\n } from '../../segment-explorer-trie'\n import { cx } from '../../utils/cx'\n-import { SegmentBoundaryTrigger, Trigger } from './segment-boundary-trigger'\n+import { SegmentBoundaryTrigger } from './segment-boundary-trigger'\n import { Tooltip } from '../../../components/tooltip'\n import { useCallback, useMemo } from 'react'\n import {\n@@ -257,12 +257,6 @@ function PageSegmentTreeLayerPresentation({\n \n   const filesChildrenKeysBesidesSelectedBoundary = filesChildrenKeys\n \n-  const isChildPageOrBoundary =\n-    firstChild &&\n-    firstChild.value &&\n-    firstChild.value.type !== 'layout' &&\n-    firstChild.value.type !== 'template'\n-\n   return (\n     <>\n       {hasFilesChildren && (\n@@ -359,13 +353,12 @@ function PageSegmentTreeLayerPresentation({\n                   )}\n                 </span>\n               )}\n-              {firstChild && firstChild.value && isChildPageOrBoundary && (\n+              {firstChild && firstChild.value && (\n                 <SegmentBoundaryTrigger\n                   nodeState={firstChild.value}\n                   boundaries={boundaries}\n                 />\n               )}\n-              {!isChildPageOrBoundary && <Trigger disabled />}\n             </div>\n           </div>\n         </div>"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 16,
        "deletions": 43
    }
}