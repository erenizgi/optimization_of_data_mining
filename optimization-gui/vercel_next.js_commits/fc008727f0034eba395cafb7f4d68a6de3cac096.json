{
    "author": "mischnic",
    "message": "Turbopack: guard against more eventual consistency (#81080)\n\nThese might be `None` due to eventual consistency. Don't crash the build because of that.",
    "sha": "fc008727f0034eba395cafb7f4d68a6de3cac096",
    "files": [
        {
            "sha": "180503d2a92cea9db993103dde6a00e36a5d63f0",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/fc008727f0034eba395cafb7f4d68a6de3cac096/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fc008727f0034eba395cafb7f4d68a6de3cac096/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=fc008727f0034eba395cafb7f4d68a6de3cac096",
            "patch": "@@ -1302,8 +1302,16 @@ async fn merge_modules(\n \n     let export_contexts = contents\n         .iter()\n-        .map(|(module, content)| (*module, content.export_contexts.as_ref().unwrap()))\n-        .collect::<FxHashMap<_, _>>();\n+        .map(|(module, content)| {\n+            Ok((\n+                *module,\n+                content\n+                    .export_contexts\n+                    .as_ref()\n+                    .context(\"expected exports contexts\")?,\n+            ))\n+        })\n+        .collect::<Result<FxHashMap<_, _>>>()?;\n \n     let (merged_ast, inserted) = GLOBALS.set(globals_merged, || {\n         // As an optimization, assume an average number of 5 contexts per module.\n@@ -1325,7 +1333,9 @@ async fn merge_modules(\n                                 .next_power_of_two()\n                                 .trailing_zeros(),\n                             current_module: *module,\n-                            current_module_idx: module_contexts.get_index_of(module).unwrap()\n+                            current_module_idx: module_contexts\n+                                .get_index_of(module)\n+                                .context(\"expected module in module_contexts\")?\n                                 as u32,\n                             reverse_module_contexts: module_contexts\n                                 .iter()\n@@ -1334,7 +1344,8 @@ async fn merge_modules(\n                             export_contexts: &export_contexts,\n                             unique_contexts_cache: &mut unique_contexts_cache,\n                         });\n-                    });\n+                        anyhow::Ok(())\n+                    })?;\n \n                     Ok(match program.take() {\n                         Program::Module(module) => Either::Left(module.body.into_iter()),"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 15,
        "deletions": 4
    }
}