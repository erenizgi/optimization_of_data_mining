{
    "author": "mischnic",
    "message": "Turbopack: exclude resolve-rewrites if possible (#80939)\n\nImplement this\nhttps://github.com/vercel/next.js/blob/6c4ca1cb12a36d23ddd86fd13e0c87c72d628317/packages/next/src/build/create-compiler-aliases.ts#L174-L181\nin Turbopack as well.\n\nThis would not be necessary if we consumed Next.js internal files in ESM and they were marked as `sideEffects: free`...",
    "sha": "2212ea72dd1dd87df95d9b5090d42157daea24cd",
    "files": [
        {
            "sha": "afd8d3e16c6247a6a4f51c2b33d0e9ea4489b717",
            "filename": "packages/next/src/build/create-compiler-aliases.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts?ref=2212ea72dd1dd87df95d9b5090d42157daea24cd",
            "patch": "@@ -35,7 +35,6 @@ export function createWebpackAliases({\n   appDir,\n   dir,\n   reactProductionProfiling,\n-  hasRewrites,\n }: {\n   distDir: string\n   isClient: boolean\n@@ -46,12 +45,8 @@ export function createWebpackAliases({\n   appDir: string | undefined\n   dir: string\n   reactProductionProfiling: boolean\n-  hasRewrites: boolean\n }): CompilerAliases {\n   const pageExtensions = config.pageExtensions\n-  const clientResolveRewrites = require.resolve(\n-    '../shared/lib/router/utils/resolve-rewrites'\n-  )\n   const customAppAliases: CompilerAliases = {}\n   const customDocumentAliases: CompilerAliases = {}\n \n@@ -170,15 +165,6 @@ export function createWebpackAliases({\n     [RSC_DYNAMIC_IMPORT_WRAPPER_ALIAS]:\n       'next/dist/build/webpack/loaders/next-flight-loader/track-dynamic-import',\n \n-    ...(isClient || isEdgeServer\n-      ? {\n-          [clientResolveRewrites]: hasRewrites\n-            ? clientResolveRewrites\n-            : // With webpack 5 an alias can be pointed to false to noop\n-              false,\n-        }\n-      : {}),\n-\n     '@swc/helpers/_': path.join(\n       path.dirname(require.resolve('@swc/helpers/package.json')),\n       '_'"
        },
        {
            "sha": "6c2d47c5d0fb06628fe6a1e64a98d9dc259b0d23",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=2212ea72dd1dd87df95d9b5090d42157daea24cd",
            "patch": "@@ -777,7 +777,6 @@ export default async function getBaseWebpackConfig(\n       appDir,\n       dir,\n       reactProductionProfiling,\n-      hasRewrites,\n     }),\n     ...(isClient\n       ? {"
        },
        {
            "sha": "f799067b7091796fbfbdcd5ee65edd7de190e48f",
            "filename": "packages/next/src/shared/lib/router/router.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2212ea72dd1dd87df95d9b5090d42157daea24cd/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts?ref=2212ea72dd1dd87df95d9b5090d42157daea24cd",
            "patch": "@@ -22,7 +22,6 @@ import mitt from '../mitt'\n import { getLocationOrigin, getURL, loadGetInitialProps, ST } from '../utils'\n import { isDynamicRoute } from './utils/is-dynamic'\n import { parseRelativeUrl } from './utils/parse-relative-url'\n-import resolveRewrites from './utils/resolve-rewrites'\n import { getRouteMatcher } from './utils/route-matcher'\n import { getRouteRegex } from './utils/route-regex'\n import { formatWithValidation } from './utils/format-url'\n@@ -46,6 +45,13 @@ import { handleSmoothScroll } from './utils/handle-smooth-scroll'\n import type { Params } from '../../../server/request/params'\n import { MATCHED_PATH_HEADER } from '../../../lib/constants'\n \n+let resolveRewrites: typeof import('./utils/resolve-rewrites').default\n+if (process.env.__NEXT_HAS_REWRITES) {\n+  resolveRewrites = (\n+    require('./utils/resolve-rewrites') as typeof import('./utils/resolve-rewrites')\n+  ).default\n+}\n+\n declare global {\n   interface Window {\n     /* prod */"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 7,
        "deletions": 16
    }
}