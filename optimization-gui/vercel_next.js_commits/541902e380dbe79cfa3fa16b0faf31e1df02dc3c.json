{
    "author": "ijjk",
    "message": "Ensure setAssetPrefix updates config instance (#82160)\n\nThis ensures we update `nextConfig.assetPrefix` instead of `renderOpts`\nas we aren't relying on `renderOpts` for these values anymore.\n\nCloses: https://github.com/vercel/next.js/issues/82150",
    "sha": "541902e380dbe79cfa3fa16b0faf31e1df02dc3c",
    "files": [
        {
            "sha": "3f1bc2bbd27d751f9307bdd01924de935558d097",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=541902e380dbe79cfa3fa16b0faf31e1df02dc3c",
            "patch": "@@ -1652,7 +1652,7 @@ export default abstract class Server<\n   ): Promise<void>\n \n   public setAssetPrefix(prefix?: string): void {\n-    this.renderOpts.assetPrefix = prefix ? prefix.replace(/\\/$/, '') : ''\n+    this.nextConfig.assetPrefix = prefix ? prefix.replace(/\\/$/, '') : ''\n   }\n \n   protected prepared: boolean = false"
        },
        {
            "sha": "ce846633e88eb68fef4273d3545cc2d81357fe37",
            "filename": "test/e2e/app-dir/asset-prefix-absolute/asset-prefix-absolute-no-path.test.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute-no-path.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute-no-path.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute-no-path.test.ts?ref=541902e380dbe79cfa3fa16b0faf31e1df02dc3c",
            "patch": "@@ -0,0 +1,32 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('app-dir absolute assetPrefix', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      assetPrefix: 'https://example.vercel.sh/',\n+    },\n+  })\n+\n+  it('bundles should return 200 on served assetPrefix', async () => {\n+    const $ = await next.render$('/')\n+\n+    let bundles = []\n+    for (const script of $('script').toArray()) {\n+      const { src } = script.attribs\n+      if (src?.includes('https://example.vercel.sh/_next/static')) {\n+        bundles.push(src)\n+      }\n+    }\n+\n+    expect(bundles.length).toBeGreaterThan(0)\n+\n+    for (const src of bundles) {\n+      // Remove hostname to check if pathname is still used for serving the bundles\n+      const bundlePathWithoutHost = decodeURI(new URL(src).pathname)\n+      const { status } = await next.fetch(bundlePathWithoutHost)\n+\n+      expect(status).toBe(200)\n+    }\n+  })\n+})"
        },
        {
            "sha": "412ef09e6d22226fd9afe423b3f77d34c1229552",
            "filename": "test/e2e/app-dir/asset-prefix-absolute/asset-prefix-absolute.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/541902e380dbe79cfa3fa16b0faf31e1df02dc3c/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fasset-prefix-absolute.test.ts?ref=541902e380dbe79cfa3fa16b0faf31e1df02dc3c",
            "patch": "@@ -3,6 +3,9 @@ import { nextTestSetup } from 'e2e-utils'\n describe('app-dir absolute assetPrefix', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n+    nextConfig: {\n+      assetPrefix: 'https://example.vercel.sh/custom-asset-prefix',\n+    },\n   })\n \n   it('bundles should return 200 on served assetPrefix', async () => {"
        },
        {
            "sha": "6425e40142f48acca28778bd246dbb9e9a99c288",
            "filename": "test/e2e/app-dir/asset-prefix-absolute/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e5c1dff8262b4d7dcef5bda0af9d9171196457bd/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e5c1dff8262b4d7dcef5bda0af9d9171196457bd/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fasset-prefix-absolute%2Fnext.config.js?ref=e5c1dff8262b4d7dcef5bda0af9d9171196457bd",
            "patch": "@@ -1,3 +0,0 @@\n-module.exports = {\n-  assetPrefix: 'https://example.vercel.sh/custom-asset-prefix',\n-}"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 36,
        "deletions": 4
    }
}