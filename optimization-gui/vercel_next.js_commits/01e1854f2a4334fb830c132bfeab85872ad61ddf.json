{
    "author": "huozhi",
    "message": "[segment explorer] remove dev panel ui flag (#81670)\n\nRemove panel ui flag\n\n---------\n\nCo-authored-by: RobPruzan <rapruzan@buffalo.edu>",
    "sha": "01e1854f2a4334fb830c132bfeab85872ad61ddf",
    "files": [
        {
            "sha": "9c4a768662d3d4e9b68d69cae4eba19832d76168",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -119,8 +119,6 @@ export function getDefineEnv({\n   const isDynamicIOEnabled = !!config.experimental.dynamicIO\n   const isUseCacheEnabled = !!config.experimental.useCache\n \n-  const isDevToolPanelUIEnabled = Boolean(config.experimental.devtoolNewPanelUI)\n-\n   const defineEnv: DefineEnv = {\n     // internal field to identify the plugin config\n     __NEXT_DEFINE_ENV: true,\n@@ -317,9 +315,7 @@ export function getDefineEnv({\n         }\n       : {}),\n     'process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER':\n-      // Enable segment explorer in devtools\n-      isDevToolPanelUIEnabled || !!config.experimental.devtoolSegmentExplorer,\n-    'process.env.__NEXT_DEVTOOL_NEW_PANEL_UI': isDevToolPanelUIEnabled,\n+      !!config.experimental.devtoolSegmentExplorer,\n \n     'process.env.__NEXT_BROWSER_DEBUG_INFO_IN_TERMINAL': JSON.stringify(\n       config.experimental.browserDebugInfoInTerminal || false"
        },
        {
            "sha": "710f9eedf3122a33c40b59b7552f5e27bb317a7d",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -24,7 +24,6 @@ export function DevToolsIndicatorNew() {\n   const { state, dispatch } = useDevOverlayContext()\n   const { panel, setPanel, setSelectedIndex } = usePanelRouterContext()\n   const updateAllPanelPositions = useUpdateAllPanelPositions()\n-\n   const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n \n   return (\n@@ -39,7 +38,6 @@ export function DevToolsIndicatorNew() {\n           boxShadow: 'none',\n           [vertical]: `${INDICATOR_PADDING}px`,\n           [horizontal]: `${INDICATOR_PADDING}px`,\n-          visibility: state.isErrorOverlayOpen ? 'hidden' : 'visible',\n         } as CSSProperties\n       }\n     >"
        },
        {
            "sha": "ea5c0906e1a553a7203253aa53aa5580f90df0a9",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/next-logo.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -7,7 +7,10 @@ import { Warning } from '../../icons/warning'\n import { css } from '../../utils/css'\n import { useDevOverlayContext } from '../../../dev-overlay.browser'\n import { useRenderErrorContext } from '../../dev-overlay'\n-import { ACTION_ERROR_OVERLAY_OPEN } from '../../shared'\n+import {\n+  ACTION_ERROR_OVERLAY_CLOSE,\n+  ACTION_ERROR_OVERLAY_OPEN,\n+} from '../../shared'\n import { usePanelRouterContext } from '../../menu/context'\n import { BASE_LOGO_SIZE } from '../../utils/indicator-metrics'\n \n@@ -418,7 +421,12 @@ export function NextLogoNew({\n                 data-issues-open\n                 aria-label=\"Open issues overlay\"\n                 onClick={() => {\n-                  // wait this is wrong\n+                  if (state.isErrorOverlayOpen) {\n+                    dispatch({\n+                      type: ACTION_ERROR_OVERLAY_CLOSE,\n+                    })\n+                    return\n+                  }\n                   dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n                   setPanel(null)\n                 }}"
        },
        {
            "sha": "04d3ba0939d7850b9339171e24da32cdea451db1",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -84,14 +84,6 @@ export const Default: Story = {\n \n // todo: fix story with \"Context arg provider\" wrapper\n export const WithPanel: Story = {\n-  beforeEach: () => {\n-    process.env.__NEXT_DEVTOOL_NEW_PANEL_UI = 'true'\n-\n-    // clean up callback function\n-    return () => {\n-      delete process.env.__NEXT_DEVTOOL_NEW_PANEL_UI\n-    }\n-  },\n   render: function DevOverlayStory() {\n     const [state, dispatch] = useStorybookOverlayReducer(initialState)\n     return ("
        },
        {
            "sha": "ec9bce0994a86c1d19dce38ae722d5288a7e3c84",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -41,9 +41,7 @@ export function DevOverlay({\n   return (\n     <ShadowPortal>\n       <CssReset />\n-      <Base\n-        scale={process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? state.scale : scale}\n-      />\n+      <Base scale={state.scale} />\n       <Colors />\n       <ComponentStyles />\n       <DarkTheme />\n@@ -52,8 +50,7 @@ export function DevOverlay({\n         {({ runtimeErrors, totalErrorCount }) => {\n           return (\n             <>\n-              {state.showIndicator &&\n-              process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? (\n+              {state.showIndicator ? (\n                 <>\n                   <RenderErrorContext\n                     value={{ runtimeErrors, totalErrorCount }}"
        },
        {
            "sha": "d3cf3766ef21c719226af31cf3cf03a6cf488091",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/dev-overlay-menu.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -160,7 +160,7 @@ export const DevtoolMenu = ({\n         borderRadius: 'var(--rounded-xl)',\n         position: 'fixed',\n         fontFamily: 'var(--font-stack-sans)',\n-        zIndex: 3,\n+        zIndex: 'var(--top-z-index)',\n         overflow: 'hidden',\n         opacity: 1,\n         minWidth: '248px',"
        },
        {
            "sha": "9f6201e455560a5a672c25f62bf9a2e3cfdf0504",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -21,6 +21,7 @@ import {\n   ACTION_DEV_INDICATOR_SET,\n   ACTION_DEVTOOLS_POSITION,\n   ACTION_DEVTOOLS_SCALE,\n+  ACTION_ERROR_OVERLAY_CLOSE,\n   ACTION_ERROR_OVERLAY_OPEN,\n } from '../shared'\n import GearIcon from '../icons/gear-icon'\n@@ -41,6 +42,13 @@ const MenuPanel = () => {\n           label: 'Issues',\n           value: <IssueCount>{totalErrorCount}</IssueCount>,\n           onClick: () => {\n+            if (state.isErrorOverlayOpen) {\n+              dispatch({\n+                type: ACTION_ERROR_OVERLAY_CLOSE,\n+              })\n+              setPanel(null)\n+              return\n+            }\n             setPanel(null)\n             setSelectedIndex(-1)\n             if (totalErrorCount > 0) {"
        },
        {
            "sha": "cfdab7e4b6701fd26c8ce6df3a157f838196b8db",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -501,7 +501,6 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n           .optional(),\n         globalNotFound: z.boolean().optional(),\n         devtoolSegmentExplorer: z.boolean().optional(),\n-        devtoolNewPanelUI: z.boolean().optional(),\n         browserDebugInfoInTerminal: z\n           .union([\n             z.boolean(),"
        },
        {
            "sha": "6bcd0f2a7cf1ca93a0dc7ff8ced6830c52ec06bd",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -741,11 +741,6 @@ export interface ExperimentalConfig {\n    */\n   devtoolSegmentExplorer?: boolean\n \n-  /**\n-   * Enable new panel UI for the Next.js DevTools.\n-   */\n-  devtoolNewPanelUI?: boolean\n-\n   /**\n    * Enable debug information to be forwarded from browser to dev server stdout/stderr\n    */\n@@ -1496,8 +1491,7 @@ export const defaultConfig = Object.freeze({\n     useCache: undefined,\n     slowModuleDetection: undefined,\n     globalNotFound: false,\n-    devtoolNewPanelUI: process.env.__NEXT_DEVTOOL_NEW_PANEL_UI === 'true',\n-    devtoolSegmentExplorer: process.env.__NEXT_DEVTOOL_NEW_PANEL_UI === 'true',\n+    devtoolSegmentExplorer: false,\n     browserDebugInfoInTerminal: false,\n     optimizeRouterScrolling: false,\n   },"
        },
        {
            "sha": "686e8017f21f7ec953b9a9e67f7f11daaad9e0bf",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -499,10 +499,6 @@ function assignDefaults(\n     }\n   }\n \n-  if (result.experimental.devtoolNewPanelUI) {\n-    result.experimental.devtoolSegmentExplorer = true\n-  }\n-\n   warnCustomizedOption(\n     result,\n     'experimental.esmExternals',"
        },
        {
            "sha": "586102a1310fb4c419241bc187502603670e2a7a",
            "filename": "test/e2e/app-dir/detachable-panels/next.config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/01e1854f2a4334fb830c132bfeab85872ad61ddf/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/01e1854f2a4334fb830c132bfeab85872ad61ddf/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js?ref=01e1854f2a4334fb830c132bfeab85872ad61ddf",
            "patch": "@@ -3,7 +3,7 @@\n  */\n const nextConfig = {\n   experimental: {\n-    devtoolNewPanelUI: true,\n+    devtoolSegmentExplorer: true,\n   },\n }\n "
        }
    ],
    "stats": {
        "total": 60,
        "additions": 24,
        "deletions": 36
    }
}