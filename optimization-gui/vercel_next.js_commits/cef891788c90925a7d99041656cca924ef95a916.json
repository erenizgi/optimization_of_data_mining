{
    "author": "lukesandberg",
    "message": "simplify the way we check for turbopack config to ensure we support an empty turbopack object (#84494)\n\nPreviously we 'flattened' all the keys in the config to find unsupported leaf properties, but this meant that an empty object woudln't produce any keys.\n\ninstead just directly check for the `webpack` and `turbopack` properties and only use the scanning to look for experimental turbopack options and unsupported experimental configuration.\n\nFixes an issue where you cannot bypass the warning simply by adding `turbopack: {}`",
    "sha": "cef891788c90925a7d99041656cca924ef95a916",
    "files": [
        {
            "sha": "9ddab02ed8331445ee777e11f9e1148de9f64b90",
            "filename": "packages/next/src/lib/turbopack-warning.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 20,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/cef891788c90925a7d99041656cca924ef95a916/packages%2Fnext%2Fsrc%2Flib%2Fturbopack-warning.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cef891788c90925a7d99041656cca924ef95a916/packages%2Fnext%2Fsrc%2Flib%2Fturbopack-warning.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fturbopack-warning.ts?ref=cef891788c90925a7d99041656cca924ef95a916",
            "patch": "@@ -42,9 +42,6 @@ const unsupportedTurbopackNextConfigOptions = [\n   'experimental.slowModuleDetection',\n ]\n \n-// The following will need to be supported by `next build --turbopack`\n-const unsupportedProductionSpecificTurbopackNextConfigOptions: string[] = []\n-\n /**  */\n export async function validateTurboNextConfig({\n   dir,\n@@ -81,23 +78,26 @@ export async function validateTurboNextConfig({\n         defaultConfig,\n       })\n     }\n+    hasWebpackConfig = Boolean(rawNextConfig.webpack)\n+    hasTurboConfig = Boolean(rawNextConfig.turbopack)\n \n     const flattenKeys = (obj: any, prefix: string = ''): string[] => {\n       let keys: string[] = []\n \n       for (const key in obj) {\n-        if (typeof obj?.[key] === 'undefined') {\n+        const value = obj?.[key]\n+        if (typeof value === 'undefined') {\n           continue\n         }\n \n         const pre = prefix.length ? `${prefix}.` : ''\n \n         if (\n-          typeof obj[key] === 'object' &&\n-          !Array.isArray(obj[key]) &&\n-          obj[key] !== null\n+          typeof value === 'object' &&\n+          !Array.isArray(value) &&\n+          value !== null\n         ) {\n-          keys = keys.concat(flattenKeys(obj[key], pre + key))\n+          keys = keys.concat(flattenKeys(value, pre + key))\n         } else {\n           keys.push(pre + key)\n         }\n@@ -118,23 +118,13 @@ export async function validateTurboNextConfig({\n \n     const customKeys = flattenKeys(rawNextConfig)\n \n-    const unsupportedKeys = isDev\n-      ? unsupportedTurbopackNextConfigOptions\n-      : [\n-          ...unsupportedTurbopackNextConfigOptions,\n-          ...unsupportedProductionSpecificTurbopackNextConfigOptions,\n-        ]\n-\n     for (const key of customKeys) {\n-      if (key.startsWith('webpack') && rawNextConfig.webpack) {\n-        hasWebpackConfig = true\n-      }\n-      if (key.startsWith('turbopack') || key.startsWith('experimental.turbo')) {\n+      if (key.startsWith('experimental.turbo')) {\n         hasTurboConfig = true\n       }\n \n       const isUnsupported =\n-        unsupportedKeys.some(\n+        unsupportedTurbopackNextConfigOptions.some(\n           (unsupportedKey) =>\n             // Either the key matches (or is a more specific subkey) of\n             // unsupportedKey, or the key is the path to a specific subkey."
        },
        {
            "sha": "da09bc739ce4efa54d80230b7d9380a0c291fc84",
            "filename": "test/e2e/config-turbopack/index.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/cef891788c90925a7d99041656cca924ef95a916/test%2Fe2e%2Fconfig-turbopack%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cef891788c90925a7d99041656cca924ef95a916/test%2Fe2e%2Fconfig-turbopack%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fconfig-turbopack%2Findex.test.ts?ref=cef891788c90925a7d99041656cca924ef95a916",
            "patch": "@@ -89,11 +89,7 @@ export default function Page() {\n             'next.config.js': `\n             module.exports = {\n               turbopack: {\n-                rules: {\n-                  '*.foo': {\n-                    loaders: ['foo-loader']\n-                  }\n-                }\n+               \n               },\n               webpack: (config) => {\n                 return config"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 11,
        "deletions": 25
    }
}