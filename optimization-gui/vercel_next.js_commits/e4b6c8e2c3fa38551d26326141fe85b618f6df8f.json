{
    "author": "fireairforce",
    "message": "fix(turbopack): external script should under async module (#81362)\n\nFollow up: https://github.com/vercel/next.js/pull/80768\n\nSorry i miss something, script external should under async module\nbecause it needs to execute loadurl function(which is async)",
    "sha": "e4b6c8e2c3fa38551d26326141fe85b618f6df8f",
    "files": [
        {
            "sha": "f68c26113113f0a9f41e5570a20e6f16f59a96c6",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/external_module.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/e4b6c8e2c3fa38551d26326141fe85b618f6df8f/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/e4b6c8e2c3fa38551d26326141fe85b618f6df8f/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs?ref=e4b6c8e2c3fa38551d26326141fe85b618f6df8f",
            "patch": "@@ -209,7 +209,8 @@ impl Module for CachedExternalModule {\n     #[turbo_tasks::function]\n     fn is_self_async(&self) -> Result<Vc<bool>> {\n         Ok(Vc::cell(\n-            self.external_type == CachedExternalType::EcmaScriptViaImport,\n+            self.external_type == CachedExternalType::EcmaScriptViaImport\n+                || self.external_type == CachedExternalType::Script,\n         ))\n     }\n }\n@@ -255,11 +256,14 @@ impl EcmascriptChunkPlaceable for CachedExternalModule {\n     #[turbo_tasks::function]\n     fn get_async_module(&self) -> Vc<OptionAsyncModule> {\n         Vc::cell(\n-            if self.external_type == CachedExternalType::EcmaScriptViaImport {\n+            if self.external_type == CachedExternalType::EcmaScriptViaImport\n+                || self.external_type == CachedExternalType::Script\n+            {\n                 Some(\n                     AsyncModule {\n                         has_top_level_await: true,\n-                        import_externals: true,\n+                        import_externals: self.external_type\n+                            == CachedExternalType::EcmaScriptViaImport,\n                     }\n                     .resolved_cell(),\n                 )"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 7,
        "deletions": 3
    }
}