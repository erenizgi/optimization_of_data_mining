{
    "author": "devjiwonchoi",
    "message": "docs: Replace Middleware docs to Proxy (#84709)\n\n> [!NOTE]\r\n> Best reviewed by each commit for better diff view.\r\n\r\nThis PR clones the Middleware docs for Proxy and removes the Middleware docs.\r\n\r\nDid not clone the list of docs:\r\n\r\n- `errors/middleware-upgrade.mdx` - It's a middleware upgrade guide from v12.2\r\n- `errors/beta-middleware.mdx` - It's an error when using middleware before v12.2\r\n- `errors/returning-response-body.mdx` - Legacy behavior from versions < v12.2",
    "sha": "71ce95dffac4014105f7951d25b885dc46ec3739",
    "files": [
        {
            "sha": "c6f114ac2a446c3729fac35234a44ca3c00f3e79",
            "filename": "docs/01-app/03-api-reference/03-file-conventions/middleware.mdx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fmiddleware.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fmiddleware.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fmiddleware.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -8,7 +8,7 @@ related:\n     - app/api-reference/functions/next-response\n ---\n \n-The `middleware.js|ts` file is used to write [Middleware](/docs/app/getting-started/route-handlers-and-middleware#middleware) and run code on the server before a request is completed. Then, based on the incoming request, you can modify the response by rewriting, redirecting, modifying the request or response headers, or responding directly.\n+The `middleware.js|ts` file is used to write [Middleware](/docs/app/getting-started/#middleware) and run code on the server before a request is completed. Then, based on the incoming request, you can modify the response by rewriting, redirecting, modifying the request or response headers, or responding directly.\n \n Middleware executes before routes are rendered. It's particularly useful for implementing custom server-side logic like authentication, logging, or handling redirects.\n \n@@ -353,7 +353,7 @@ export function middleware(request) {\n   })\n   cookie = response.cookies.get('vercel')\n   console.log(cookie) // => { name: 'vercel', value: 'fast', Path: '/' }\n-  // The outgoing response will have a `Set-Cookie:vercel=fast;path=/test` header.\n+  // The outgoing response will have a `Set-Cookie:vercel=fast;path=/` header.\n \n   return response\n }"
        },
        {
            "sha": "9bfb93443788d59aff542388ce6d42dc397e250a",
            "filename": "docs/01-app/03-api-reference/03-file-conventions/proxy.mdx",
            "status": "added",
            "additions": 698,
            "deletions": 0,
            "changes": 698,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Fproxy.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,698 @@\n+---\n+title: proxy.js\n+description: API reference for the proxy.js file.\n+related:\n+  title: Learn more about Proxy\n+  links:\n+    - app/api-reference/functions/next-request\n+    - app/api-reference/functions/next-response\n+---\n+\n+The `proxy.js|ts` file is used to write [Proxy](/docs/app/getting-started/proxy) and run code on the server before a request is completed. Then, based on the incoming request, you can modify the response by rewriting, redirecting, modifying the request or response headers, or responding directly.\n+\n+Proxy executes before routes are rendered. It's particularly useful for implementing custom server-side logic like authentication, logging, or handling redirects.\n+\n+> **Good to know**:\n+>\n+> Proxy is meant to be invoked separately of your render code and in optimized cases deployed to your CDN for fast redirect/rewrite handling, you should not attempt relying on shared modules or globals.\n+>\n+> To pass information from Proxy to your application, use [headers](#setting-headers), [cookies](#using-cookies), [rewrites](/docs/app/api-reference/functions/next-response#rewrite), [redirects](/docs/app/api-reference/functions/next-response#redirect), or the URL.\n+\n+Create a `proxy.ts` (or `.js`) file in the project root, or inside `src` if applicable, so that it is located at the same level as `pages` or `app`.\n+\n+If youâ€™ve customized [`pageExtensions`](/docs/app/api-reference/config/next-config-js/pageExtensions), for example to `.page.ts` or `.page.js`, name your file `proxy.page.ts` or `proxy.page.js` accordingly.\n+\n+```tsx filename=\"proxy.ts\" switcher\n+import { NextResponse, NextRequest } from 'next/server'\n+\n+// This function can be marked `async` if using `await` inside\n+export function proxy(request: NextRequest) {\n+  return NextResponse.redirect(new URL('/home', request.url))\n+}\n+\n+export const config = {\n+  matcher: '/about/:path*',\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+import { NextResponse } from 'next/server'\n+\n+// This function can be marked `async` if using `await` inside\n+export function proxy(request) {\n+  return NextResponse.redirect(new URL('/home', request.url))\n+}\n+\n+export const config = {\n+  matcher: '/about/:path*',\n+}\n+```\n+\n+## Exports\n+\n+### Proxy function\n+\n+The file must export a single function, either as a default export or named `proxy`. Note that multiple proxy from the same file are not supported.\n+\n+```js filename=\"proxy.js\"\n+// Example of default export\n+export default function proxy(request) {\n+  // Proxy logic\n+}\n+```\n+\n+### Config object (optional)\n+\n+Optionally, a config object can be exported alongside the Proxy function. This object includes the [matcher](#matcher) to specify paths where the Proxy applies.\n+\n+### Matcher\n+\n+The `matcher` option allows you to target specific paths for the Proxy to run on. You can specify these paths in several ways:\n+\n+- For a single path: Directly use a string to define the path, like `'/about'`.\n+- For multiple paths: Use an array to list multiple paths, such as `matcher: ['/about', '/contact']`, which applies the Proxy to both `/about` and `/contact`.\n+\n+```js filename=\"proxy.js\"\n+export const config = {\n+  matcher: ['/about/:path*', '/dashboard/:path*'],\n+}\n+```\n+\n+Additionally, the `matcher` option supports complex path specifications through regular expressions, such as `matcher: ['/((?!api|_next/static|_next/image|.*\\\\.png$).*)']`, enabling precise control over which paths to include or exclude.\n+\n+The `matcher` option accepts an array of objects with the following keys:\n+\n+- `source`: The path or pattern used to match the request paths. It can be a string for direct path matching or a pattern for more complex matching.\n+- `regexp` (optional): A regular expression string that fine-tunes the matching based on the source. It provides additional control over which paths are included or excluded.\n+- `locale` (optional): A boolean that, when set to `false`, ignores locale-based routing in path matching.\n+- `has` (optional): Specifies conditions based on the presence of specific request elements such as headers, query parameters, or cookies.\n+- `missing` (optional): Focuses on conditions where certain request elements are absent, like missing headers or cookies.\n+\n+```js filename=\"proxy.js\"\n+export const config = {\n+  matcher: [\n+    {\n+      source: '/api/*',\n+      regexp: '^/api/(.*)',\n+      locale: false,\n+      has: [\n+        { type: 'header', key: 'Authorization', value: 'Bearer Token' },\n+        { type: 'query', key: 'userId', value: '123' },\n+      ],\n+      missing: [{ type: 'cookie', key: 'session', value: 'active' }],\n+    },\n+  ],\n+}\n+```\n+\n+Configured matchers:\n+\n+1. MUST start with `/`\n+2. Can include named parameters: `/about/:path` matches `/about/a` and `/about/b` but not `/about/a/c`\n+3. Can have modifiers on named parameters (starting with `:`): `/about/:path*` matches `/about/a/b/c` because `*` is _zero or more_. `?` is _zero or one_ and `+` _one or more_\n+4. Can use regular expression enclosed in parenthesis: `/about/(.*)` is the same as `/about/:path*`\n+\n+Read more details on [path-to-regexp](https://github.com/pillarjs/path-to-regexp#path-to-regexp-1) documentation.\n+\n+> **Good to know**:\n+>\n+> - The `matcher` values need to be constants so they can be statically analyzed at build-time. Dynamic values such as variables will be ignored.\n+> - For backward compatibility, Next.js always considers `/public` as `/public/index`. Therefore, a matcher of `/public/:path` will match.\n+\n+## Params\n+\n+### `request`\n+\n+When defining Proxy, the default export function accepts a single parameter, `request`. This parameter is an instance of `NextRequest`, which represents the incoming HTTP request.\n+\n+```tsx filename=\"proxy.ts\" switcher\n+import type { NextRequest } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  // Proxy logic goes here\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+export function proxy(request) {\n+  // Proxy logic goes here\n+}\n+```\n+\n+> **Good to know**:\n+>\n+> - `NextRequest` is a type that represents incoming HTTP requests in Next.js Proxy, whereas [`NextResponse`](#nextresponse) is a class used to manipulate and send back HTTP responses.\n+\n+## NextResponse\n+\n+The `NextResponse` API allows you to:\n+\n+- `redirect` the incoming request to a different URL\n+- `rewrite` the response by displaying a given URL\n+- Set request headers for API Routes, `getServerSideProps`, and `rewrite` destinations\n+- Set response cookies\n+- Set response headers\n+\n+<AppOnly>\n+\n+To produce a response from Proxy, you can:\n+\n+1. `rewrite` to a route ([Page](/docs/app/api-reference/file-conventions/page) or [Route Handler](/docs/app/api-reference/file-conventions/route)) that produces a response\n+2. return a `NextResponse` directly. See [Producing a Response](#producing-a-response)\n+\n+> **Good to know**: For redirects, you can also use `Response.redirect` instead of `NextResponse.redirect`.\n+\n+</AppOnly>\n+\n+<PagesOnly>\n+\n+To produce a response from Proxy, you can:\n+\n+1. `rewrite` to a route ([Page](/docs/pages/building-your-application/routing/pages-and-layouts) or [Edge API Route](/docs/pages/building-your-application/routing/api-routes)) that produces a response\n+2. return a `NextResponse` directly. See [Producing a Response](#producing-a-response)\n+\n+</PagesOnly>\n+\n+## Execution order\n+\n+Proxy will be invoked for **every route in your project**. Given this, it's crucial to use [matchers](#matcher) to precisely target or exclude specific routes. The following is the execution order:\n+\n+1. `headers` from `next.config.js`\n+2. `redirects` from `next.config.js`\n+3. Proxy (`rewrites`, `redirects`, etc.)\n+4. `beforeFiles` (`rewrites`) from `next.config.js`\n+5. Filesystem routes (`public/`, `_next/static/`, `pages/`, `app/`, etc.)\n+6. `afterFiles` (`rewrites`) from `next.config.js`\n+7. Dynamic Routes (`/blog/[slug]`)\n+8. `fallback` (`rewrites`) from `next.config.js`\n+\n+## Runtime\n+\n+Proxy defaults to using the Edge runtime. As of v15.5, we have support for using the Node.js runtime. To enable, in your proxy file, set the runtime to `nodejs` in the `config` object:\n+\n+```js highlight={2} filename=\"proxy.js\" switcher\n+export const config = {\n+  runtime: 'nodejs',\n+}\n+```\n+\n+```ts highlight={2} filename=\"proxy.ts\" switcher\n+export const config = {\n+  runtime: 'nodejs',\n+}\n+```\n+\n+## Advanced Proxy flags\n+\n+In `v13.1` of Next.js two additional flags were introduced for proxy, `skipMiddlewareUrlNormalize` and `skipTrailingSlashRedirect` to handle advanced use cases.\n+\n+`skipTrailingSlashRedirect` disables Next.js redirects for adding or removing trailing slashes. This allows custom handling inside proxy to maintain the trailing slash for some paths but not others, which can make incremental migrations easier.\n+\n+```js filename=\"next.config.js\"\n+module.exports = {\n+  skipTrailingSlashRedirect: true,\n+}\n+```\n+\n+```js filename=\"proxy.js\"\n+const legacyPrefixes = ['/docs', '/blog']\n+\n+export default async function proxy(req) {\n+  const { pathname } = req.nextUrl\n+\n+  if (legacyPrefixes.some((prefix) => pathname.startsWith(prefix))) {\n+    return NextResponse.next()\n+  }\n+\n+  // apply trailing slash handling\n+  if (\n+    !pathname.endsWith('/') &&\n+    !pathname.match(/((?!\\.well-known(?:\\/.*)?)(?:[^/]+\\/)*[^/]+\\.\\w+)/)\n+  ) {\n+    return NextResponse.redirect(\n+      new URL(`${req.nextUrl.pathname}/`, req.nextUrl)\n+    )\n+  }\n+}\n+```\n+\n+`skipMiddlewareUrlNormalize` allows for disabling the URL normalization in Next.js to make handling direct visits and client-transitions the same. In some advanced cases, this option provides full control by using the original URL.\n+\n+```js filename=\"next.config.js\"\n+module.exports = {\n+  skipMiddlewareUrlNormalize: true,\n+}\n+```\n+\n+```js filename=\"proxy.js\"\n+export default async function proxy(req) {\n+  const { pathname } = req.nextUrl\n+\n+  // GET /_next/data/build-id/hello.json\n+\n+  console.log(pathname)\n+  // with the flag this now /_next/data/build-id/hello.json\n+  // without the flag this would be normalized to /hello\n+}\n+```\n+\n+## Examples\n+\n+### Conditional Statements\n+\n+```ts filename=\"proxy.ts\" switcher\n+import { NextResponse } from 'next/server'\n+import type { NextRequest } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  if (request.nextUrl.pathname.startsWith('/about')) {\n+    return NextResponse.rewrite(new URL('/about-2', request.url))\n+  }\n+\n+  if (request.nextUrl.pathname.startsWith('/dashboard')) {\n+    return NextResponse.rewrite(new URL('/dashboard/user', request.url))\n+  }\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request) {\n+  if (request.nextUrl.pathname.startsWith('/about')) {\n+    return NextResponse.rewrite(new URL('/about-2', request.url))\n+  }\n+\n+  if (request.nextUrl.pathname.startsWith('/dashboard')) {\n+    return NextResponse.rewrite(new URL('/dashboard/user', request.url))\n+  }\n+}\n+```\n+\n+### Using Cookies\n+\n+Cookies are regular headers. On a `Request`, they are stored in the `Cookie` header. On a `Response` they are in the `Set-Cookie` header. Next.js provides a convenient way to access and manipulate these cookies through the `cookies` extension on `NextRequest` and `NextResponse`.\n+\n+1. For incoming requests, `cookies` comes with the following methods: `get`, `getAll`, `set`, and `delete` cookies. You can check for the existence of a cookie with `has` or remove all cookies with `clear`.\n+2. For outgoing responses, `cookies` have the following methods `get`, `getAll`, `set`, and `delete`.\n+\n+```ts filename=\"proxy.ts\" switcher\n+import { NextResponse } from 'next/server'\n+import type { NextRequest } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  // Assume a \"Cookie:nextjs=fast\" header to be present on the incoming request\n+  // Getting cookies from the request using the `RequestCookies` API\n+  let cookie = request.cookies.get('nextjs')\n+  console.log(cookie) // => { name: 'nextjs', value: 'fast', Path: '/' }\n+  const allCookies = request.cookies.getAll()\n+  console.log(allCookies) // => [{ name: 'nextjs', value: 'fast' }]\n+\n+  request.cookies.has('nextjs') // => true\n+  request.cookies.delete('nextjs')\n+  request.cookies.has('nextjs') // => false\n+\n+  // Setting cookies on the response using the `ResponseCookies` API\n+  const response = NextResponse.next()\n+  response.cookies.set('vercel', 'fast')\n+  response.cookies.set({\n+    name: 'vercel',\n+    value: 'fast',\n+    path: '/',\n+  })\n+  cookie = response.cookies.get('vercel')\n+  console.log(cookie) // => { name: 'vercel', value: 'fast', Path: '/' }\n+  // The outgoing response will have a `Set-Cookie:vercel=fast;path=/` header.\n+\n+  return response\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request) {\n+  // Assume a \"Cookie:nextjs=fast\" header to be present on the incoming request\n+  // Getting cookies from the request using the `RequestCookies` API\n+  let cookie = request.cookies.get('nextjs')\n+  console.log(cookie) // => { name: 'nextjs', value: 'fast', Path: '/' }\n+  const allCookies = request.cookies.getAll()\n+  console.log(allCookies) // => [{ name: 'nextjs', value: 'fast' }]\n+\n+  request.cookies.has('nextjs') // => true\n+  request.cookies.delete('nextjs')\n+  request.cookies.has('nextjs') // => false\n+\n+  // Setting cookies on the response using the `ResponseCookies` API\n+  const response = NextResponse.next()\n+  response.cookies.set('vercel', 'fast')\n+  response.cookies.set({\n+    name: 'vercel',\n+    value: 'fast',\n+    path: '/',\n+  })\n+  cookie = response.cookies.get('vercel')\n+  console.log(cookie) // => { name: 'vercel', value: 'fast', Path: '/' }\n+  // The outgoing response will have a `Set-Cookie:vercel=fast;path=/` header.\n+\n+  return response\n+}\n+```\n+\n+### Setting Headers\n+\n+You can set request and response headers using the `NextResponse` API (setting _request_ headers is available since Next.js v13.0.0).\n+\n+```ts filename=\"proxy.ts\" switcher\n+import { NextResponse } from 'next/server'\n+import type { NextRequest } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  // Clone the request headers and set a new header `x-hello-from-proxy1`\n+  const requestHeaders = new Headers(request.headers)\n+  requestHeaders.set('x-hello-from-proxy1', 'hello')\n+\n+  // You can also set request headers in NextResponse.next\n+  const response = NextResponse.next({\n+    request: {\n+      // New request headers\n+      headers: requestHeaders,\n+    },\n+  })\n+\n+  // Set a new response header `x-hello-from-proxy2`\n+  response.headers.set('x-hello-from-proxy2', 'hello')\n+  return response\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request) {\n+  // Clone the request headers and set a new header `x-hello-from-proxy1`\n+  const requestHeaders = new Headers(request.headers)\n+  requestHeaders.set('x-hello-from-proxy1', 'hello')\n+\n+  // You can also set request headers in NextResponse.next\n+  const response = NextResponse.next({\n+    request: {\n+      // New request headers\n+      headers: requestHeaders,\n+    },\n+  })\n+\n+  // Set a new response header `x-hello-from-proxy2`\n+  response.headers.set('x-hello-from-proxy2', 'hello')\n+  return response\n+}\n+```\n+\n+Note that the snippet uses:\n+\n+- `NextResponse.next({ request: { headers: requestHeaders } })` to make `requestHeaders` available upstream\n+- **NOT** `NextResponse.next({ headers: requestHeaders })` which makes `requestHeaders` available to clients\n+\n+Learn more in [NextResponse headers in Proxy](/docs/app/api-reference/functions/next-response#next).\n+\n+> **Good to know**: Avoid setting large headers as it might cause [431 Request Header Fields Too Large](https://developer.mozilla.org/docs/Web/HTTP/Status/431) error depending on your backend web server configuration.\n+\n+### CORS\n+\n+You can set CORS headers in Proxy to allow cross-origin requests, including [simple](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests) and [preflighted](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#preflighted_requests) requests.\n+\n+```tsx filename=\"proxy.ts\" switcher\n+import { NextRequest, NextResponse } from 'next/server'\n+\n+const allowedOrigins = ['https://acme.com', 'https://my-app.org']\n+\n+const corsOptions = {\n+  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n+  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n+}\n+\n+export function proxy(request: NextRequest) {\n+  // Check the origin from the request\n+  const origin = request.headers.get('origin') ?? ''\n+  const isAllowedOrigin = allowedOrigins.includes(origin)\n+\n+  // Handle preflighted requests\n+  const isPreflight = request.method === 'OPTIONS'\n+\n+  if (isPreflight) {\n+    const preflightHeaders = {\n+      ...(isAllowedOrigin && { 'Access-Control-Allow-Origin': origin }),\n+      ...corsOptions,\n+    }\n+    return NextResponse.json({}, { headers: preflightHeaders })\n+  }\n+\n+  // Handle simple requests\n+  const response = NextResponse.next()\n+\n+  if (isAllowedOrigin) {\n+    response.headers.set('Access-Control-Allow-Origin', origin)\n+  }\n+\n+  Object.entries(corsOptions).forEach(([key, value]) => {\n+    response.headers.set(key, value)\n+  })\n+\n+  return response\n+}\n+\n+export const config = {\n+  matcher: '/api/:path*',\n+}\n+```\n+\n+```jsx filename=\"proxy.js\" switcher\n+import { NextResponse } from 'next/server'\n+\n+const allowedOrigins = ['https://acme.com', 'https://my-app.org']\n+\n+const corsOptions = {\n+  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n+  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n+}\n+\n+export function proxy(request) {\n+  // Check the origin from the request\n+  const origin = request.headers.get('origin') ?? ''\n+  const isAllowedOrigin = allowedOrigins.includes(origin)\n+\n+  // Handle preflighted requests\n+  const isPreflight = request.method === 'OPTIONS'\n+\n+  if (isPreflight) {\n+    const preflightHeaders = {\n+      ...(isAllowedOrigin && { 'Access-Control-Allow-Origin': origin }),\n+      ...corsOptions,\n+    }\n+    return NextResponse.json({}, { headers: preflightHeaders })\n+  }\n+\n+  // Handle simple requests\n+  const response = NextResponse.next()\n+\n+  if (isAllowedOrigin) {\n+    response.headers.set('Access-Control-Allow-Origin', origin)\n+  }\n+\n+  Object.entries(corsOptions).forEach(([key, value]) => {\n+    response.headers.set(key, value)\n+  })\n+\n+  return response\n+}\n+\n+export const config = {\n+  matcher: '/api/:path*',\n+}\n+```\n+\n+<AppOnly>\n+\n+> **Good to know:** You can configure CORS headers for individual routes in [Route Handlers](/docs/app/api-reference/file-conventions/route#cors).\n+\n+</AppOnly>\n+\n+### Producing a response\n+\n+You can respond from Proxy directly by returning a `Response` or `NextResponse` instance. (This is available since [Next.js v13.1.0](https://nextjs.org/blog/next-13-1#nextjs-advanced-proxy))\n+\n+```ts filename=\"proxy.ts\" switcher\n+import type { NextRequest } from 'next/server'\n+import { isAuthenticated } from '@lib/auth'\n+\n+// Limit the proxy to paths starting with `/api/`\n+export const config = {\n+  matcher: '/api/:function*',\n+}\n+\n+export function proxy(request: NextRequest) {\n+  // Call our authentication function to check the request\n+  if (!isAuthenticated(request)) {\n+    // Respond with JSON indicating an error message\n+    return Response.json(\n+      { success: false, message: 'authentication failed' },\n+      { status: 401 }\n+    )\n+  }\n+}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+import { isAuthenticated } from '@lib/auth'\n+\n+// Limit the proxy to paths starting with `/api/`\n+export const config = {\n+  matcher: '/api/:function*',\n+}\n+\n+export function proxy(request) {\n+  // Call our authentication function to check the request\n+  if (!isAuthenticated(request)) {\n+    // Respond with JSON indicating an error message\n+    return Response.json(\n+      { success: false, message: 'authentication failed' },\n+      { status: 401 }\n+    )\n+  }\n+}\n+```\n+\n+### Negative matching\n+\n+The `matcher` config allows full regex so matching like negative lookaheads or character matching is supported. An example of a negative lookahead to match all except specific paths can be seen here:\n+\n+```js filename=\"proxy.js\"\n+export const config = {\n+  matcher: [\n+    /*\n+     * Match all request paths except for the ones starting with:\n+     * - api (API routes)\n+     * - _next/static (static files)\n+     * - _next/image (image optimization files)\n+     * - favicon.ico, sitemap.xml, robots.txt (metadata files)\n+     */\n+    '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',\n+  ],\n+}\n+```\n+\n+You can also bypass Proxy for certain requests by using the `missing` or `has` arrays, or a combination of both:\n+\n+```js filename=\"proxy.js\"\n+export const config = {\n+  matcher: [\n+    /*\n+     * Match all request paths except for the ones starting with:\n+     * - api (API routes)\n+     * - _next/static (static files)\n+     * - _next/image (image optimization files)\n+     * - favicon.ico, sitemap.xml, robots.txt (metadata files)\n+     */\n+    {\n+      source:\n+        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',\n+      missing: [\n+        { type: 'header', key: 'next-router-prefetch' },\n+        { type: 'header', key: 'purpose', value: 'prefetch' },\n+      ],\n+    },\n+\n+    {\n+      source:\n+        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',\n+      has: [\n+        { type: 'header', key: 'next-router-prefetch' },\n+        { type: 'header', key: 'purpose', value: 'prefetch' },\n+      ],\n+    },\n+\n+    {\n+      source:\n+        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',\n+      has: [{ type: 'header', key: 'x-present' }],\n+      missing: [{ type: 'header', key: 'x-missing', value: 'prefetch' }],\n+    },\n+  ],\n+}\n+```\n+\n+### `waitUntil` and `NextFetchEvent`\n+\n+The `NextFetchEvent` object extends the native [`FetchEvent`](https://developer.mozilla.org/docs/Web/API/FetchEvent) object, and includes the [`waitUntil()`](https://developer.mozilla.org/docs/Web/API/ExtendableEvent/waitUntil) method.\n+\n+The `waitUntil()` method takes a promise as an argument, and extends the lifetime of the Proxy until the promise settles. This is useful for performing work in the background.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextResponse } from 'next/server'\n+import type { NextFetchEvent, NextRequest } from 'next/server'\n+\n+export function proxy(req: NextRequest, event: NextFetchEvent) {\n+  event.waitUntil(\n+    fetch('https://my-analytics-platform.com', {\n+      method: 'POST',\n+      body: JSON.stringify({ pathname: req.nextUrl.pathname }),\n+    })\n+  )\n+\n+  return NextResponse.next()\n+}\n+```\n+\n+### Unit testing (experimental)\n+\n+Starting in Next.js 15.1, the `next/experimental/testing/server` package contains utilities to help unit test proxy files. Unit testing proxy can help ensure that it's only run on desired paths and that custom routing logic works as intended before code reaches production.\n+\n+The `unstable_doesProxyMatch` function can be used to assert whether proxy will run for the provided URL, headers, and cookies.\n+\n+```js\n+import { unstable_doesProxyMatch } from 'next/experimental/testing/server'\n+\n+expect(\n+  unstable_doesProxyMatch({\n+    config,\n+    nextConfig,\n+    url: '/test',\n+  })\n+).toEqual(false)\n+```\n+\n+The entire proxy function can also be tested.\n+\n+```js\n+import { isRewrite, getRewrittenUrl } from 'next/experimental/testing/server'\n+\n+const request = new NextRequest('https://nextjs.org/docs')\n+const response = await proxy(request)\n+expect(isRewrite(response)).toEqual(true)\n+expect(getRewrittenUrl(response)).toEqual('https://other-domain.com/docs')\n+// getRedirectUrl could also be used if the response were a redirect\n+```\n+\n+## Platform support\n+\n+| Deployment Option                                                   | Supported         |\n+| ------------------------------------------------------------------- | ----------------- |\n+| [Node.js server](/docs/app/getting-started/deploying#nodejs-server) | Yes               |\n+| [Docker container](/docs/app/getting-started/deploying#docker)      | Yes               |\n+| [Static export](/docs/app/getting-started/deploying#static-export)  | No                |\n+| [Adapters](/docs/app/getting-started/deploying#adapters)            | Platform-specific |\n+\n+Learn how to [configure Proxy](/docs/app/guides/self-hosting#proxy) when self-hosting Next.js.\n+\n+## Version history\n+\n+| Version   | Changes                                                                                       |\n+| --------- | --------------------------------------------------------------------------------------------- |\n+| `v16.0.0` | Middleware is deprecated and renamed to Proxy                                                 |\n+| `v15.5.0` | Middleware can now use the Node.js runtime (stable)                                           |\n+| `v15.2.0` | Middleware can now use the Node.js runtime (experimental)                                     |\n+| `v13.1.0` | Advanced Middleware flags added                                                               |\n+| `v13.0.0` | Middleware can modify request headers, response headers, and send responses                   |\n+| `v12.2.0` | Middleware is stable, please see the [upgrade guide](/docs/messages/middleware-upgrade-guide) |\n+| `v12.0.9` | Enforce absolute URLs in Edge Runtime ([PR](https://github.com/vercel/next.js/pull/33410))    |\n+| `v12.0.0` | Middleware (Beta) added                                                                       |"
        },
        {
            "sha": "0884d693e510403aca4dbd9262ec41009cfa97ee",
            "filename": "docs/02-pages/04-api-reference/02-file-conventions/proxy.mdx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F02-pages%2F04-api-reference%2F02-file-conventions%2Fproxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/docs%2F02-pages%2F04-api-reference%2F02-file-conventions%2Fproxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F02-pages%2F04-api-reference%2F02-file-conventions%2Fproxy.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,7 @@\n+---\n+title: Proxy\n+description: Learn how to use Proxy to run code before a request is completed.\n+source: app/api-reference/file-conventions/proxy\n+---\n+\n+{/* DO NOT EDIT. The content of this doc is generated from the source above. To edit the content of this page, navigate to the source page in your editor. You can use the `<PagesOnly>Content</PagesOnly>` component to add content that is specific to the Pages Router. Any shared content should not be wrapped in a component. */}"
        },
        {
            "sha": "45ad279f5ea547ee879cc4ea890f8a7097bbb9ec",
            "filename": "errors/deleting-query-params-in-middlewares.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fdeleting-query-params-in-middlewares.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fdeleting-query-params-in-middlewares.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fdeleting-query-params-in-middlewares.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -14,7 +14,7 @@ import { NextResponse } from 'next/server'\n \n export default function middleware(request: NextRequest) {\n   const nextUrl = request.nextUrl\n-  nextUrl.searchParams.delete('key') // <-- this is now possible! ðŸŽ‰\n+  nextUrl.searchParams.delete('key') // <-- this is now possible!\n   return NextResponse.rewrite(nextUrl)\n }\n ```"
        },
        {
            "sha": "f6ba76833ea1a239ce1a2347e4307a238a48a7f1",
            "filename": "errors/deleting-query-params-in-proxy.mdx",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fdeleting-query-params-in-proxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fdeleting-query-params-in-proxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fdeleting-query-params-in-proxy.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,37 @@\n+---\n+title: Deleting Query Parameters In Proxies\n+---\n+\n+## Why This Error Occurred\n+\n+In previous versions of Next.js, we were merging query parameters with the incoming request for rewrites happening in proxies, to match the behavior of static rewrites declared in the config. This forced Next.js users to use empty query parameters values to delete keys.\n+\n+We are changing this behavior to allow extra flexibility and a more streamlined experience for users. So from now on, query parameters will not be merged and thus the warning.\n+\n+```ts filename=\"proxy.ts\"\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+\n+export default function proxy(request: NextRequest) {\n+  const nextUrl = request.nextUrl\n+  nextUrl.searchParams.delete('key') // <-- this is now possible!\n+  return NextResponse.rewrite(nextUrl)\n+}\n+```\n+\n+## Possible Ways to Fix It\n+\n+If you are relying on the old behavior, please add the query parameters manually to the rewritten URL. Using `request.nextUrl` would do that automatically for you.\n+\n+```ts filename=\"proxy.ts\"\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+\n+export default function proxy(request: NextRequest) {\n+  const nextUrl = request.nextUrl\n+  nextUrl.pathname = '/dest'\n+  return NextResponse.rewrite(nextUrl)\n+}\n+```\n+\n+This warning will be removed in the next version of Next.js."
        },
        {
            "sha": "13b79dca22b3912f505bef52da025bb98ddea633",
            "filename": "errors/middleware-parse-user-agent.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fmiddleware-parse-user-agent.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fmiddleware-parse-user-agent.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fmiddleware-parse-user-agent.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -13,7 +13,7 @@ export function middleware(request: NextRequest) {\n   const viewport = request.ua.device.type === 'mobile' ? 'mobile' : 'desktop'\n \n   request.nextUrl.searchParams.set('viewport', viewport)\n-  return NextResponse.rewrites(request.nextUrl)\n+  return NextResponse.rewrite(request.nextUrl)\n }\n ```\n "
        },
        {
            "sha": "f281156be399b763ef94d14d796f408de7f249c6",
            "filename": "errors/middleware-request-page.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fmiddleware-request-page.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fmiddleware-request-page.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fmiddleware-request-page.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -10,7 +10,7 @@ Your application is interacting with `request.page` which has been deprecated.\n import { NextRequest, NextResponse } from 'next/server'\n \n export function middleware(request: NextRequest) {\n-  const { params } = event.request.page\n+  const { params } = request.page\n   const { locale, slug } = params\n \n   if (locale && slug) {"
        },
        {
            "sha": "4747090bc9e9a06b57defe33950016e54d47256b",
            "filename": "errors/nested-proxy.mdx",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fnested-proxy.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fnested-proxy.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fnested-proxy.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,31 @@\n+---\n+title: Nested Proxy\n+---\n+\n+## Why This Error Occurred\n+\n+You are defining a Proxy file in a location different from `<root>/proxy`, which is not allowed.\n+\n+While in beta, a Proxy file under specific pages would _only_ be executed when pages below its declaration were matched, allowing nesting Proxy files. Based on customer feedback, we have replaced this API with a single root Proxy.\n+\n+## Possible Ways to Fix It\n+\n+Declare your Proxy in the root folder and use `NextRequest` parsed URL to define which path the Proxy should be executed for.\n+\n+For example, a Proxy at `pages/about/_proxy.ts` can move the logic to `<root>/proxy.ts` in the root of your repository. Then, a conditional statement can be used to only run the Proxy when it matches the `about/*` path:\n+\n+```ts filename=\"proxy.ts\"\n+import type { NextRequest } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  if (request.nextUrl.pathname.startsWith('/about')) {\n+    // This logic is only applied to /about\n+  }\n+\n+  if (request.nextUrl.pathname.startsWith('/dashboard')) {\n+    // This logic is only applied to /dashboard\n+  }\n+}\n+```\n+\n+If you have more than one Proxy, you should combine them into a single file and model their execution depending on the incoming request."
        },
        {
            "sha": "efc53ef2cee720d758ab5a72008d7b5770c117fe",
            "filename": "errors/proxy-dynamic-wasm-compilation.mdx",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-dynamic-wasm-compilation.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-dynamic-wasm-compilation.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-dynamic-wasm-compilation.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,29 @@\n+---\n+title: Dynamic WASM compilation is not available in Proxies\n+---\n+\n+## Why This Error Occurred\n+\n+Compiling WASM binaries dynamically is not allowed in Proxies. Specifically,\n+the following APIs are not supported:\n+\n+- `WebAssembly.compile`\n+- `WebAssembly.instantiate` with [a buffer parameter](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiate#primary_overload_%E2%80%94_taking_wasm_binary_code)\n+\n+## Possible Ways to Fix It\n+\n+Bundle your WASM binaries using `import`:\n+\n+```ts filename=\"proxy.ts\"\n+import { NextResponse } from 'next/server'\n+import squareWasm from './square.wasm?module'\n+\n+export default async function proxy() {\n+  const m = await WebAssembly.instantiate(squareWasm)\n+  const answer = m.exports.square(9)\n+  const response = NextResponse.next()\n+\n+  response.headers.set('x-square', answer.toString())\n+  return response\n+}\n+```"
        },
        {
            "sha": "2c0d26859abe84e36ae40d9dc73bed561e32cc7f",
            "filename": "errors/proxy-new-signature.mdx",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-new-signature.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-new-signature.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-new-signature.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,37 @@\n+---\n+title: Deprecated Proxy API Signature\n+---\n+\n+## Why This Error Occurred\n+\n+Your application is using a Proxy function that is using parameters from the deprecated API.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(event) {\n+  if (event.request.nextUrl.pathname === '/blocked') {\n+    event.respondWith(\n+      new NextResponse(null, {\n+        status: 403,\n+      })\n+    )\n+  }\n+}\n+```\n+\n+## Possible Ways to Fix It\n+\n+Update to use the new API for Proxy:\n+\n+```ts filename=\"proxy.ts\"\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request) {\n+  if (request.nextUrl.pathname === '/blocked') {\n+    return new NextResponse(null, {\n+      status: 403,\n+    })\n+  }\n+}\n+```"
        },
        {
            "sha": "9592eb54e80cb432f4edd91577f02c63ae09e03c",
            "filename": "errors/proxy-parse-user-agent.mdx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-parse-user-agent.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-parse-user-agent.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-parse-user-agent.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,34 @@\n+---\n+title: Removed parsed User Agent from Proxy API\n+---\n+\n+## Why This Error Occurred\n+\n+Your application is interacting with `req.ua` which has been deprecated.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const viewport = request.ua.device.type === 'mobile' ? 'mobile' : 'desktop'\n+\n+  request.nextUrl.searchParams.set('viewport', viewport)\n+  return NextResponse.rewrite(request.nextUrl)\n+}\n+```\n+\n+## Possible Ways to Fix It\n+\n+The internal logic has been moved into a separate `userAgent` function that you can import from `next/server` and wrap your request instead.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse, userAgent } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const { device } = userAgent(request)\n+  const viewport = device.type === 'mobile' ? 'mobile' : 'desktop'\n+\n+  request.nextUrl.searchParams.set('viewport', viewport)\n+  return NextResponse.rewrite(request.nextUrl)\n+}\n+```"
        },
        {
            "sha": "86bbe1de808399a74058bdca57bd335cc43537f8",
            "filename": "errors/proxy-relative-urls.mdx",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-relative-urls.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-relative-urls.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-relative-urls.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,40 @@\n+---\n+title: Proxy Relative URLs\n+---\n+\n+## Why This Error Occurred\n+\n+You are using a Proxy function that uses `Response.redirect(url)`, `NextResponse.redirect(url)` or `NextResponse.rewrite(url)` where `url` is a relative or an invalid URL. Prior to Next.js 12.1, we allowed passing relative URLs. However, constructing a request with `new Request(url)` or running `fetch(url)` when `url` is a relative URL **does not** work. For this reason and to bring consistency to Next.js Proxy, this behavior has been deprecated and now removed.\n+\n+## Possible Ways to Fix It\n+\n+To fix this error you must always pass absolute URL for redirecting and rewriting. There are several ways to get the absolute URL but the recommended way is to clone `NextURL` and mutate it:\n+\n+```ts filename=\"proxy.ts\"\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const url = request.nextUrl.clone()\n+  url.pathname = '/dest'\n+  return NextResponse.rewrite(url)\n+}\n+```\n+\n+Another way to fix this error could be to use the original URL as the base but this will not consider configuration like `basePath` or `locale`:\n+\n+```ts filename=\"proxy.ts\"\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  return NextResponse.rewrite(new URL('/dest', request.url))\n+}\n+```\n+\n+You can also pass directly a string containing a valid absolute URL.\n+\n+## Useful Links\n+\n+- [URL Documentation](https://developer.mozilla.org/docs/Web/API/URL)\n+- [Response Documentation](https://developer.mozilla.org/docs/Web/API/Response)"
        },
        {
            "sha": "9d3fcb16677d560dc61660c752e4a27cef8fb353",
            "filename": "errors/proxy-request-page.mdx",
            "status": "added",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-request-page.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-request-page.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-request-page.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,61 @@\n+---\n+title: Removed page from Proxy API\n+---\n+\n+## Why This Error Occurred\n+\n+Your application is interacting with `request.page` which has been deprecated.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const { params } = request.page\n+  const { locale, slug } = params\n+\n+  if (locale && slug) {\n+    const { search, protocol, host } = request.nextUrl\n+    const url = new URL(`${protocol}//${locale}.${host}/${slug}${search}`)\n+    return NextResponse.redirect(url)\n+  }\n+}\n+```\n+\n+## Possible Ways to Fix It\n+\n+You can use [URLPattern](https://developer.mozilla.org/docs/Web/API/URLPattern) instead to have the same behavior:\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse } from 'next/server'\n+\n+const PATTERNS = [\n+  [\n+    new URLPattern({ pathname: '/:locale/:slug' }),\n+    ({ pathname }) => pathname.groups,\n+  ],\n+]\n+\n+const params = (url) => {\n+  const input = url.split('?')[0]\n+  let result = {}\n+\n+  for (const [pattern, handler] of PATTERNS) {\n+    const patternResult = pattern.exec(input)\n+    if (patternResult !== null && 'pathname' in patternResult) {\n+      result = handler(patternResult)\n+      break\n+    }\n+  }\n+  return result\n+}\n+\n+export function proxy(request: NextRequest) {\n+  const { locale, slug } = params(request.url)\n+\n+  if (locale && slug) {\n+    const { search, protocol, host } = request.nextUrl\n+    const url = new URL(`${protocol}//${locale}.${host}/${slug}${search}`)\n+    return NextResponse.redirect(url)\n+  }\n+}\n+```"
        },
        {
            "sha": "0a4ce38c6559e313340c7d750090fc5f9874c711",
            "filename": "errors/proxy-user-agent.mdx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-user-agent.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/71ce95dffac4014105f7951d25b885dc46ec3739/errors%2Fproxy-user-agent.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/errors%2Fproxy-user-agent.mdx?ref=71ce95dffac4014105f7951d25b885dc46ec3739",
            "patch": "@@ -0,0 +1,34 @@\n+---\n+title: Removed req.ua from Proxy API\n+---\n+\n+## Why This Error Occurred\n+\n+Your proxy is interacting with `req.ua` and this feature needs to opt-in.\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const url = request.nextUrl\n+  const viewport = request.ua.device.type === 'mobile' ? 'mobile' : 'desktop'\n+  url.searchParams.set('viewport', viewport)\n+  return NextResponse.rewrite(url)\n+}\n+```\n+\n+## Possible Ways to Fix It\n+\n+To parse the user agent, import `userAgent` function from `next/server` and give it your request:\n+\n+```ts filename=\"proxy.ts\"\n+import { NextRequest, NextResponse, userAgent } from 'next/server'\n+\n+export function proxy(request: NextRequest) {\n+  const url = request.nextUrl\n+  const { device } = userAgent(request)\n+  const viewport = device.type === 'mobile' ? 'mobile' : 'desktop'\n+  url.searchParams.set('viewport', viewport)\n+  return NextResponse.rewrite(url)\n+}\n+```"
        }
    ],
    "stats": {
        "total": 1018,
        "additions": 1013,
        "deletions": 5
    }
}