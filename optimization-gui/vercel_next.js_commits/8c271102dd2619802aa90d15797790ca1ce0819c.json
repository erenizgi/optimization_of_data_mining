{
    "author": "feedthejim",
    "message": "Update Next.js auth docs examples (#86361)\n\n<!-- Thanks for opening a PR! Your contribution is much appreciated.\nTo make sure your PR is handled as smoothly as possible we request that\nyou follow the checklist sections below.\nChoose the right checklist for the change(s) that you're making:\n\n## For Contributors\n\n### Improving Documentation\n\n- Run `pnpm prettier-fix` to fix formatting issues before opening the\nPR.\n- Read the Docs Contribution Guide to ensure your contribution follows\nthe docs guidelines:\nhttps://nextjs.org/docs/community/contribution-guide\n\n### Fixing a bug\n\n- Related issues linked using `fixes #number`\n- Tests added. See:\nhttps://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n### Adding a feature\n\n- Implements an existing feature request or RFC. Make sure the feature\nrequest has been accepted for implementation before opening a PR. (A\ndiscussion must be opened, see\nhttps://github.com/vercel/next.js/discussions/new?category=ideas)\n- Related issues/discussions are linked using `fixes #number`\n- e2e tests added\n(https://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs)\n- Documentation added\n- Telemetry added. In case of a feature if it's used or not.\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n\n## For Maintainers\n\n- Minimal description (aim for explaining to someone not on the team to\nunderstand the PR)\n- When linking to a Slack thread, you might want to share details of the\nconclusion\n- Link both the Linear (Fixes NEXT-xxx) and the GitHub issues\n- Add review comments if necessary to explain to the reviewer the logic\nbehind a change\n\n### What?\nUpdated the `Layouts and auth checks` section in the authentication\ndocumentation (`docs/01-app/02-guides/authentication.mdx`).\n\n### Why?\nThe previous example demonstrating authentication checks within layouts\nwas confusing and contradicted the documentation's own advice against\nthis pattern. This update aims to provide clearer, recommended\napproaches for implementing authentication checks.\n\n### How?\n- Removed the misleading layout-based authentication example.\n- Introduced a new subsection with an example showing authentication\nchecks in a page component.\n- Added another new subsection with an example demonstrating\nauthentication checks in a leaf component.\n- Enhanced the \"Good to know\" section with a reminder about the\nnecessity of authorization checks for Server Actions.\n\nCloses NEXT-\nFixes #\n\n-->\n\n---\n[Slack\nThread](https://vercel.slack.com/archives/C03KAR5DCKC/p1763685748449029?thread_ts=1763685748.449029&cid=C03KAR5DCKC)\n\n<a\nhref=\"https://cursor.com/background-agent?bcId=bc-f490a8eb-8f55-4a85-a31a-357adb24c09a\"><picture><source\nmedia=\"(prefers-color-scheme: dark)\"\nsrcset=\"https://cursor.com/open-in-cursor-dark.svg\"><source\nmedia=\"(prefers-color-scheme: light)\"\nsrcset=\"https://cursor.com/open-in-cursor-light.svg\"><img alt=\"Open in\nCursor\"\nsrc=\"https://cursor.com/open-in-cursor.svg\"></picture></a>&nbsp;<a\nhref=\"https://cursor.com/agents?id=bc-f490a8eb-8f55-4a85-a31a-357adb24c09a\"><picture><source\nmedia=\"(prefers-color-scheme: dark)\"\nsrcset=\"https://cursor.com/open-in-web-dark.svg\"><source\nmedia=\"(prefers-color-scheme: light)\"\nsrcset=\"https://cursor.com/open-in-web-light.svg\"><img alt=\"Open in Web\"\nsrc=\"https://cursor.com/open-in-web.svg\"></picture></a>\n\nCo-authored-by: Cursor Agent <cursoragent@cursor.com>",
    "sha": "8c271102dd2619802aa90d15797790ca1ce0819c",
    "files": [
        {
            "sha": "4ec07b410572db0ad6f842cf44fc3404600dc519",
            "filename": "docs/01-app/02-guides/authentication.mdx",
            "status": "modified",
            "additions": 67,
            "deletions": 22,
            "changes": 89,
            "blob_url": "https://github.com/vercel/next.js/blob/8c271102dd2619802aa90d15797790ca1ce0819c/docs%2F01-app%2F02-guides%2Fauthentication.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/8c271102dd2619802aa90d15797790ca1ce0819c/docs%2F01-app%2F02-guides%2Fauthentication.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F02-guides%2Fauthentication.mdx?ref=8c271102dd2619802aa90d15797790ca1ce0819c",
            "patch": "@@ -1355,51 +1355,96 @@ For example, consider a shared layout that fetches the user data and displays th\n \n This guarantees that wherever `getUser()` is called within your application, the auth check is performed, and prevents developers forgetting to check the user is authorized to access the data.\n \n-```tsx filename=\"app/layout.tsx\" switcher\n-export default async function Layout({\n-  children,\n-}: {\n-  children: React.ReactNode;\n-}) {\n-  const user = await getUser();\n+#### Auth checks in page components\n+\n+For example, in a dashboard page, you can verify the user session and fetch the user data:\n+\n+```tsx filename=\"app/dashboard/page.tsx\" switcher\n+import { verifySession } from '@/app/lib/dal'\n+\n+export default async function DashboardPage() {\n+  const session = await verifySession()\n+\n+  // Fetch user-specific data from your database or data source\n+  const user = await getUserData(session.userId)\n \n   return (\n-    // ...\n+    <div>\n+      <h1>Welcome, {user.name}</h1>\n+      {/* Dashboard content */}\n+    </div>\n   )\n }\n ```\n \n-```jsx filename=\"app/layout.js\" switcher\n-export default async function Layout({ children }) {\n-  const user = await getUser();\n+```jsx filename=\"app/dashboard/page.jsx\" switcher\n+import { verifySession } from '@/app/lib/dal'\n+\n+export default async function DashboardPage() {\n+  const session = await verifySession()\n+\n+  // Fetch user-specific data from your database or data source\n+  const user = await getUserData(session.userId)\n \n   return (\n-    // ...\n+    <div>\n+      <h1>Welcome, {user.name}</h1>\n+      {/* Dashboard content */}\n+    </div>\n   )\n }\n ```\n \n-```ts filename=\"app/lib/dal.ts\" switcher\n-export const getUser = cache(async () => {\n+#### Auth checks in leaf components\n+\n+You can also perform auth checks in leaf components that conditionally render UI elements based on user permissions. For example, a component that displays admin-only actions:\n+\n+```tsx filename=\"app/ui/admin-actions.tsx\" switcher\n+import { verifySession } from '@/app/lib/dal'\n+\n+export default async function AdminActions() {\n   const session = await verifySession()\n-  if (!session) return null\n+  const userRole = session?.user?.role\n \n-  // Get user ID from session and fetch data\n-})\n+  if (userRole !== 'admin') {\n+    return null\n+  }\n+\n+  return (\n+    <div>\n+      <button>Delete User</button>\n+      <button>Edit Settings</button>\n+    </div>\n+  )\n+}\n ```\n \n-```js filename=\"app/lib/dal.js\" switcher\n-export const getUser = cache(async () => {\n+```jsx filename=\"app/ui/admin-actions.jsx\" switcher\n+import { verifySession } from '@/app/lib/dal'\n+\n+export default async function AdminActions() {\n   const session = await verifySession()\n-  if (!session) return null\n+  const userRole = session?.user?.role\n \n-  // Get user ID from session and fetch data\n-})\n+  if (userRole !== 'admin') {\n+    return null\n+  }\n+\n+  return (\n+    <div>\n+      <button>Delete User</button>\n+      <button>Edit Settings</button>\n+    </div>\n+  )\n+}\n ```\n \n+This pattern allows you to show or hide UI elements based on user permissions while ensuring the auth check happens at render time in each component.\n+\n > **Good to know:**\n >\n > - A common pattern in SPAs is to `return null` in a layout or a top-level component if a user is not authorized. This pattern is **not recommended** since Next.js applications have multiple entry points, which will not prevent nested route segments and Server Actions from being accessed.\n+> - Ensure that any Server Actions called from these components also perform their own authorization checks, as client-side UI restrictions alone are not sufficient for security.\n \n ### Server Actions\n "
        }
    ],
    "stats": {
        "total": 89,
        "additions": 67,
        "deletions": 22
    }
}