{
    "author": "eps1lon",
    "message": "[test] Add test for dev rendering indicator (#80205)\n\nAutomated test for https://github.com/vercel/next.js/pull/74833",
    "sha": "2bb89785c5dfdc87125d35a815c3a6441d235ae4",
    "files": [
        {
            "sha": "4ccf1d760d92a0eda6c29dae496746b2aa35fc32",
            "filename": "test/development/dev-indicator/app/app/rendering/a/page.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fa%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fa%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fa%2Fpage.js?ref=2bb89785c5dfdc87125d35a815c3a6441d235ae4",
            "patch": "@@ -0,0 +1,16 @@\n+import Link from 'next/link'\n+import { connection } from 'next/server'\n+import { setTimeout } from 'timers/promises'\n+\n+export default async function Page() {\n+  await connection()\n+  await setTimeout(100)\n+\n+  return (\n+    <>\n+      <Link href=\"/app/rendering/b\" id=\"to-b\">\n+        Go to b\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "87f67a4ac05918c33c9ce7f9813c02683c5e8692",
            "filename": "test/development/dev-indicator/app/app/rendering/b/page.js",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fb%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fb%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Frendering%2Fb%2Fpage.js?ref=2bb89785c5dfdc87125d35a815c3a6441d235ae4",
            "patch": "@@ -0,0 +1,15 @@\n+import Link from 'next/link'\n+import { connection } from 'next/server'\n+import { setTimeout } from 'timers/promises'\n+\n+export default async function Page() {\n+  await connection()\n+  await setTimeout(100)\n+  return (\n+    <>\n+      <Link href=\"/app/rendering/a\" id=\"to-a\">\n+        Go to a\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "4ee00a218505ac95ed8f4b2cb12779643277286d",
            "filename": "test/development/dev-indicator/app/layout.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js?ref=2bb89785c5dfdc87125d35a815c3a6441d235ae4",
            "patch": "@@ -0,0 +1,7 @@\n+export default function RootLayout({ children }) {\n+  return (\n+    <html lang=\"en\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "8014798b4d767d2756fcd59df7676064f9294c4d",
            "filename": "test/development/dev-indicator/dev-rendering-indicator.test.ts",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb89785c5dfdc87125d35a815c3a6441d235ae4/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts?ref=2bb89785c5dfdc87125d35a815c3a6441d235ae4",
            "patch": "@@ -0,0 +1,44 @@\n+/* eslint-env jest */\n+\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+\n+const installCheckVisible = (browser) => {\n+  return browser.eval(`(function() {\n+      window.checkInterval = setInterval(function() {\n+      const root = document.querySelector('nextjs-portal').shadowRoot;\n+      const indicator = root.querySelector('[data-next-mark]')\n+      window.showedBuilder = window.showedBuilder || (\n+        indicator.getAttribute('data-next-mark-loading') === 'true'\n+      )\n+      if (window.showedBuilder) clearInterval(window.checkInterval)\n+    }, 5)\n+  })()`)\n+}\n+\n+describe('Dev Rendering Indicator', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('Shows build indicator when page is built from modifying', async () => {\n+    // Ensure both pages are built first so that we don't confuse it with build indicator\n+    await Promise.all([\n+      next.fetch('/app/rendering/a'),\n+      next.fetch('/app/rendering/b'),\n+    ])\n+    const browser = await next.browser('/app/rendering/a')\n+    await installCheckVisible(browser)\n+    await browser.eval('window.showedBuilder = false')\n+\n+    await browser.elementByCss('[href=\"/app/rendering/b\"]').click()\n+    await retry(async () => {\n+      await browser.elementByCss('[href=\"/app/rendering/a\"]')\n+    })\n+\n+    const showedRenderingIndicator = await browser.eval('window.showedBuilder')\n+    expect({ showedRenderingIndicator }).toEqual({\n+      showedRenderingIndicator: true,\n+    })\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 82,
        "additions": 82,
        "deletions": 0
    }
}