{
    "author": "lukesandberg",
    "message": "[turbopack] Simplify the implementations of TaskOutput::try_from_raw_vc (#80689)\n\nBecause RawVc is just a type erased version of Vc<T> we can have a single implementation.",
    "sha": "dfea2b5efcb0946cb2faf5d51d953c444a54c656",
    "files": [
        {
            "sha": "9ff65c5002a8d4f1a0a6e4109e8ab36eba8445f9",
            "filename": "turbopack/crates/turbo-tasks-testing/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Flib.rs?ref=dfea2b5efcb0946cb2faf5d51d953c444a54c656",
            "patch": "@@ -144,10 +144,6 @@ impl TurboTasksCallApi for VcStorage {\n }\n \n impl TurboTasksApi for VcStorage {\n-    fn pin(&self) -> Arc<dyn TurboTasksApi> {\n-        self.this.upgrade().unwrap()\n-    }\n-\n     fn invalidate(&self, _task: TaskId) {\n         unreachable!()\n     }"
        },
        {
            "sha": "33879d5e22a104036ea5bb1d16bb239d1d791e84",
            "filename": "turbopack/crates/turbo-tasks/src/manager.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs?ref=dfea2b5efcb0946cb2faf5d51d953c444a54c656",
            "patch": "@@ -100,8 +100,6 @@ pub trait TurboTasksCallApi: Sync + Send {\n /// This trait is needed because thread locals cannot contain an unresolved [`Backend`] type\n /// parameter.\n pub trait TurboTasksApi: TurboTasksCallApi + Sync + Send {\n-    fn pin(&self) -> Arc<dyn TurboTasksApi>;\n-\n     fn invalidate(&self, task: TaskId);\n     fn invalidate_with_reason(&self, task: TaskId, reason: StaticOrArc<dyn InvalidationReason>);\n \n@@ -1222,10 +1220,6 @@ impl<B: Backend + 'static> TurboTasksCallApi for TurboTasks<B> {\n }\n \n impl<B: Backend + 'static> TurboTasksApi for TurboTasks<B> {\n-    fn pin(&self) -> Arc<dyn TurboTasksApi> {\n-        self.pin()\n-    }\n-\n     #[instrument(level = Level::INFO, skip_all, name = \"invalidate\")]\n     fn invalidate(&self, task: TaskId) {\n         self.backend.invalidate_task(task, self);"
        },
        {
            "sha": "1b338763319d9b752d6282cc499b7ce08dee9bea",
            "filename": "turbopack/crates/turbo-tasks/src/task/task_output.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 19,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_output.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dfea2b5efcb0946cb2faf5d51d953c444a54c656/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_output.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Ftask%2Ftask_output.rs?ref=dfea2b5efcb0946cb2faf5d51d953c444a54c656",
            "patch": "@@ -7,36 +7,30 @@ use crate::{RawVc, Vc};\n /// Trait to implement in order for a type to be accepted as a\n /// `turbo_tasks::function` return type.\n pub trait TaskOutput: Send {\n-    type Return;\n+    type Return: ?Sized;\n \n-    fn try_from_raw_vc(raw_vc: RawVc) -> Self::Return;\n+    fn try_from_raw_vc(raw_vc: RawVc) -> Vc<Self::Return> {\n+        Vc {\n+            node: raw_vc,\n+            _t: PhantomData,\n+        }\n+    }\n     fn try_into_raw_vc(self) -> Result<RawVc>;\n }\n \n impl<T> TaskOutput for Vc<T>\n where\n     T: Send + ?Sized,\n {\n-    type Return = Vc<T>;\n-\n-    fn try_from_raw_vc(raw_vc: RawVc) -> Self::Return {\n-        Vc {\n-            node: raw_vc,\n-            _t: PhantomData,\n-        }\n-    }\n+    type Return = T;\n \n     fn try_into_raw_vc(self) -> Result<RawVc> {\n         Ok(self.node)\n     }\n }\n \n impl TaskOutput for () {\n-    type Return = Vc<()>;\n-\n-    fn try_from_raw_vc(raw_vc: RawVc) -> Self::Return {\n-        raw_vc.into()\n-    }\n+    type Return = ();\n \n     fn try_into_raw_vc(self) -> Result<RawVc> {\n         let unit = Vc::<()>::default();\n@@ -50,10 +44,6 @@ where\n {\n     type Return = T::Return;\n \n-    fn try_from_raw_vc(raw_vc: RawVc) -> Self::Return {\n-        T::try_from_raw_vc(raw_vc)\n-    }\n-\n     fn try_into_raw_vc(self) -> Result<RawVc> {\n         self?.try_into_raw_vc()\n     }"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 9,
        "deletions": 29
    }
}