{
    "author": "eps1lon",
    "message": "[dev-overlay] Move building indicator into Dev Overlay state (#79985)\n\nUsed to be a singleton treated as a sync external store. The singleton would require extra attention once we move into a separate bundle. Instead, I moved it into actual React state to get rid of the sync external store.\r\nWe want to avoid sync external stores as much as possible to leverage React's concurrent features to the fullest.\r\n\r\nIf we need to slice the state up, we can investigate that separately.",
    "sha": "895908a35eb376cd5feb828ad34b8155a0caf0f1",
    "files": [
        {
            "sha": "27e7b6d7793cee7bab6fff70d3e4753bf9b261b0",
            "filename": "packages/next/src/client/app-next-dev.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -3,12 +3,10 @@\n import './app-webpack'\n \n import { appBootstrap } from './app-bootstrap'\n-import { initializeDevBuildIndicatorForAppRouter } from './dev/dev-build-indicator/initialize-for-app-router'\n \n const instrumentationHooks = require('../lib/require-instrumentation-client')\n \n appBootstrap(() => {\n   const { hydrate } = require('./app-index')\n   hydrate(instrumentationHooks)\n-  initializeDevBuildIndicatorForAppRouter()\n })"
        },
        {
            "sha": "f7bbe4a30abd47bf058a9fc082012c6ee797b74b",
            "filename": "packages/next/src/client/app-next-turbopack.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -10,10 +10,4 @@ const instrumentationHooks = require('../lib/require-instrumentation-client')\n appBootstrap(() => {\n   const { hydrate } = require('./app-index')\n   hydrate(instrumentationHooks)\n-\n-  if (process.env.NODE_ENV !== 'production') {\n-    const { initializeDevBuildIndicatorForAppRouter } =\n-      require('./dev/dev-build-indicator/initialize-for-app-router') as typeof import('./dev/dev-build-indicator/initialize-for-app-router')\n-    initializeDevBuildIndicatorForAppRouter()\n-  }\n })"
        },
        {
            "sha": "d45b1a2e3d6beb1f3df4a8394ac8fe784261eea6",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -7,8 +7,10 @@ import formatWebpackMessages from '../utils/format-webpack-messages'\n import { useRouter } from '../../navigation'\n import {\n   ACTION_BEFORE_REFRESH,\n+  ACTION_BUILDING_INDICATOR_HIDE,\n   ACTION_BUILD_ERROR,\n   ACTION_BUILD_OK,\n+  ACTION_BUILDING_INDICATOR_SHOW,\n   ACTION_DEBUG_INFO,\n   ACTION_DEV_INDICATOR,\n   ACTION_ERROR_OVERLAY_OPEN,\n@@ -40,7 +42,6 @@ import type {\n import { REACT_REFRESH_FULL_RELOAD_FROM_ERROR } from '../shared'\n import type { DebugInfo } from '../types'\n import { useUntrackedPathname } from '../../navigation-untracked'\n-import { handleDevBuildIndicatorHmrEvents } from '../../../dev/dev-build-indicator/internal/handle-dev-build-indicator-hmr-events'\n import type { GlobalErrorComponent } from '../../global-error'\n import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n import reportHmrLatency from '../utils/report-hmr-latency'\n@@ -61,6 +62,8 @@ export interface Dispatcher {\n   onUnhandledError(error: Error): void\n   onUnhandledRejection(error: Error): void\n   openErrorOverlay(): void\n+  buildingIndicatorHide(): void\n+  buildingIndicatorShow(): void\n }\n \n let mostRecentCompilationHash: any = null\n@@ -302,6 +305,8 @@ function processMessage(\n       break\n     }\n     case HMR_ACTIONS_SENT_TO_BROWSER.BUILDING: {\n+      dispatcher.buildingIndicatorShow()\n+\n       if (process.env.TURBOPACK) {\n         turbopackHmr!.onBuilding()\n       } else {\n@@ -313,6 +318,8 @@ function processMessage(\n     }\n     case HMR_ACTIONS_SENT_TO_BROWSER.BUILT:\n     case HMR_ACTIONS_SENT_TO_BROWSER.SYNC: {\n+      dispatcher.buildingIndicatorHide()\n+\n       if (obj.hash) {\n         handleAvailableHash(obj.hash)\n       }\n@@ -535,6 +542,12 @@ export default function HotReload({\n       openErrorOverlay() {\n         dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n       },\n+      buildingIndicatorHide() {\n+        dispatch({ type: ACTION_BUILDING_INDICATOR_HIDE })\n+      },\n+      buildingIndicatorShow() {\n+        dispatch({ type: ACTION_BUILDING_INDICATOR_SHOW })\n+      },\n     }\n   }, [dispatch])\n \n@@ -596,7 +609,6 @@ export default function HotReload({\n     const handler = (event: MessageEvent<any>) => {\n       try {\n         const obj = JSON.parse(event.data)\n-        handleDevBuildIndicatorHmrEvents(obj)\n         processMessage(\n           obj,\n           sendMessage,"
        },
        {
            "sha": "76fe2e974489fabe4355eb84229bae3cba238596",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/client.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -5,8 +5,10 @@ import {\n } from './hydration-error-state'\n import {\n   ACTION_BEFORE_REFRESH,\n+  ACTION_BUILDING_INDICATOR_HIDE,\n   ACTION_BUILD_ERROR,\n   ACTION_BUILD_OK,\n+  ACTION_BUILDING_INDICATOR_SHOW,\n   ACTION_DEV_INDICATOR,\n   ACTION_REFRESH,\n   ACTION_STATIC_INDICATOR,\n@@ -115,5 +117,13 @@ export function onDevIndicator(devIndicatorsState: DevIndicatorServerState) {\n   Bus.emit({ type: ACTION_DEV_INDICATOR, devIndicator: devIndicatorsState })\n }\n \n+export function buildingIndicatorShow() {\n+  Bus.emit({ type: ACTION_BUILDING_INDICATOR_SHOW })\n+}\n+\n+export function buildingIndicatorHide() {\n+  Bus.emit({ type: ACTION_BUILDING_INDICATOR_HIDE })\n+}\n+\n export { getErrorByType } from '../utils/get-error-by-type'\n export { getServerError } from '../utils/node-stack-frames'"
        },
        {
            "sha": "bdd4d257edc40bf0d42237de54291e034a041a0e",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hot-reloader-client.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhot-reloader-client.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhot-reloader-client.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhot-reloader-client.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -41,6 +41,8 @@ import {\n   onVersionInfo,\n   onStaticIndicator,\n   onDevIndicator,\n+  buildingIndicatorHide,\n+  buildingIndicatorShow,\n } from './client'\n import stripAnsi from 'next/dist/compiled/strip-ansi'\n import { addMessageListener, sendMessage } from './websocket'\n@@ -272,6 +274,8 @@ function processMessage(obj: HMR_ACTION_TYPES) {\n       break\n     }\n     case HMR_ACTIONS_SENT_TO_BROWSER.BUILDING: {\n+      buildingIndicatorShow()\n+\n       if (process.env.TURBOPACK) {\n         turbopackHmr!.onBuilding()\n       } else {\n@@ -282,6 +286,8 @@ function processMessage(obj: HMR_ACTION_TYPES) {\n     }\n     case HMR_ACTIONS_SENT_TO_BROWSER.BUILT:\n     case HMR_ACTIONS_SENT_TO_BROWSER.SYNC: {\n+      buildingIndicatorHide()\n+\n       if (obj.hash) handleAvailableHash(obj.hash)\n \n       const { errors, warnings } = obj"
        },
        {
            "sha": "486ea269b7db8b2b833fd68f184bc9dedb8f335a",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -22,6 +22,7 @@ export interface OverlayState {\n   refreshState: FastRefreshState\n   versionInfo: VersionInfo\n   notFound: boolean\n+  buildingIndicator: boolean\n   staticIndicator: boolean\n   showIndicator: boolean\n   disableDevIndicator: boolean\n@@ -44,6 +45,8 @@ export const ACTION_DEV_INDICATOR = 'dev-indicator'\n export const ACTION_ERROR_OVERLAY_OPEN = 'error-overlay-open'\n export const ACTION_ERROR_OVERLAY_CLOSE = 'error-overlay-close'\n export const ACTION_ERROR_OVERLAY_TOGGLE = 'error-overlay-toggle'\n+export const ACTION_BUILDING_INDICATOR_SHOW = 'building-indicator-show'\n+export const ACTION_BUILDING_INDICATOR_HIDE = 'building-indicator-hide'\n \n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n@@ -102,6 +105,13 @@ export interface ErrorOverlayToggleAction {\n   type: typeof ACTION_ERROR_OVERLAY_TOGGLE\n }\n \n+export interface BuildingIndicatorShowAction {\n+  type: typeof ACTION_BUILDING_INDICATOR_SHOW\n+}\n+export interface BuildingIndicatorHideAction {\n+  type: typeof ACTION_BUILDING_INDICATOR_HIDE\n+}\n+\n export type BusEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -116,6 +126,8 @@ export type BusEvent =\n   | ErrorOverlayOpenAction\n   | ErrorOverlayCloseAction\n   | ErrorOverlayToggleAction\n+  | BuildingIndicatorShowAction\n+  | BuildingIndicatorHideAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n@@ -149,6 +161,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   */\n   showIndicator: false,\n   disableDevIndicator: false,\n+  buildingIndicator: false,\n   refreshState: { type: 'idle' },\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n@@ -296,6 +309,12 @@ export function useErrorOverlayReducer(\n       case ACTION_ERROR_OVERLAY_TOGGLE: {\n         return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n       }\n+      case ACTION_BUILDING_INDICATOR_SHOW: {\n+        return { ...state, buildingIndicator: true }\n+      }\n+      case ACTION_BUILDING_INDICATOR_HIDE: {\n+        return { ...state, buildingIndicator: false }\n+      }\n       default: {\n         return state\n       }"
        },
        {
            "sha": "2db3adb04dfd623c21906f5704339a7a61041d4c",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -54,6 +54,7 @@ const state: OverlayState = {\n   showIndicator: true,\n   versionInfo: mockVersionInfo,\n   notFound: false,\n+  buildingIndicator: false,\n   staticIndicator: true,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   isErrorOverlayOpen: false,"
        },
        {
            "sha": "ab0a4d31868c7c3085cdac2aebec2cba7145943a",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -10,7 +10,6 @@ import {\n import { useState, useEffect, useRef, createContext, useContext } from 'react'\n import { Toast } from '../../toast'\n import { NextLogo } from './next-logo'\n-import { useIsDevBuilding } from '../../../../../../dev/dev-build-indicator/internal/initialize'\n import { useIsDevRendering } from '../../../../utils/dev-indicator/dev-render-indicator'\n import { useDelayedRender } from '../../../hooks/use-delayed-render'\n import { TurbopackInfo } from './dev-tools-info/turbopack-info'\n@@ -54,6 +53,7 @@ export function DevToolsIndicator({\n       routerType={state.routerType}\n       semver={state.versionInfo.installed}\n       issueCount={errorCount}\n+      isDevBuilding={state.buildingIndicator}\n       isStaticRoute={state.staticIndicator}\n       hide={() => {\n         setIsDevToolsIndicatorVisible(false)\n@@ -95,6 +95,7 @@ function DevToolsPopover({\n   routerType,\n   disabled,\n   issueCount,\n+  isDevBuilding,\n   isStaticRoute,\n   isTurbopack,\n   isBuildError,\n@@ -108,6 +109,7 @@ function DevToolsPopover({\n   issueCount: number\n   isStaticRoute: boolean\n   semver: string | undefined\n+  isDevBuilding: boolean\n   isTurbopack: boolean\n   isBuildError: boolean\n   hide: () => void\n@@ -294,7 +296,7 @@ function DevToolsPopover({\n           issueCount={issueCount}\n           onTriggerClick={onTriggerClick}\n           toggleErrorOverlay={toggleErrorOverlay}\n-          isDevBuilding={useIsDevBuilding()}\n+          isDevBuilding={isDevBuilding}\n           isDevRendering={useIsDevRendering()}\n           isBuildError={isBuildError}\n           scale={scale}"
        },
        {
            "sha": "d338cfa76539ca4f57c32656000030cf722703f4",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -73,6 +73,7 @@ const initialState: OverlayState = {\n   ],\n   refreshState: { type: 'idle' },\n   notFound: false,\n+  buildingIndicator: false,\n   staticIndicator: false,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   versionInfo: {"
        },
        {
            "sha": "a37800b77db1d1631ae9d46637391c5d9f977928",
            "filename": "packages/next/src/client/dev/dev-build-indicator/initialize-for-app-router.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-app-router.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-app-router.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-app-router.ts?ref=61bd07fa450412e8a7f8100b33d6cd53df65c4d5",
            "patch": "@@ -1,10 +0,0 @@\n-import { devBuildIndicator } from './internal/dev-build-indicator'\n-\n-/** Integrates the generic dev build indicator with the App Router. */\n-export const initializeDevBuildIndicatorForAppRouter = () => {\n-  if (!process.env.__NEXT_DEV_INDICATOR) {\n-    return\n-  }\n-\n-  devBuildIndicator.initialize()\n-}"
        },
        {
            "sha": "2f681308531eae90f230af915f3a4af9a9356c53",
            "filename": "packages/next/src/client/dev/dev-build-indicator/initialize-for-page-router.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-page-router.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-page-router.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finitialize-for-page-router.ts?ref=61bd07fa450412e8a7f8100b33d6cd53df65c4d5",
            "patch": "@@ -1,16 +0,0 @@\n-import { addMessageListener } from '../../components/react-dev-overlay/pages/websocket'\n-import { devBuildIndicator } from './internal/dev-build-indicator'\n-import { handleDevBuildIndicatorHmrEvents } from './internal/handle-dev-build-indicator-hmr-events'\n-\n-/** Integrates the generic dev build indicator with the Pages Router. */\n-export const initializeDevBuildIndicatorForPageRouter = () => {\n-  if (!process.env.__NEXT_DEV_INDICATOR) {\n-    return\n-  }\n-\n-  devBuildIndicator.initialize()\n-\n-  // Add message listener specifically for Pages Router to handle lifecycle events\n-  // related to dev builds (building, built, sync)\n-  addMessageListener(handleDevBuildIndicatorHmrEvents)\n-}"
        },
        {
            "sha": "2dd949fb48d5e6f32cb8f834984055ab51518ffc",
            "filename": "packages/next/src/client/dev/dev-build-indicator/internal/dev-build-indicator.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fdev-build-indicator.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fdev-build-indicator.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fdev-build-indicator.ts?ref=61bd07fa450412e8a7f8100b33d6cd53df65c4d5",
            "patch": "@@ -1,12 +0,0 @@\n-import { initialize } from './initialize'\n-\n-const NOOP = () => {}\n-\n-export const devBuildIndicator = {\n-  /** Shows build indicator when Next.js is compiling. Requires initialize() first. */\n-  show: NOOP,\n-  /** Hides build indicator when Next.js finishes compiling. Requires initialize() first. */\n-  hide: NOOP,\n-  /** Sets up the build indicator UI component. Call this before using show/hide. */\n-  initialize,\n-}"
        },
        {
            "sha": "d4309cee4206688ddccbb5139e693d12be7d4382",
            "filename": "packages/next/src/client/dev/dev-build-indicator/internal/handle-dev-build-indicator-hmr-events.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fhandle-dev-build-indicator-hmr-events.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fhandle-dev-build-indicator-hmr-events.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Fhandle-dev-build-indicator-hmr-events.ts?ref=61bd07fa450412e8a7f8100b33d6cd53df65c4d5",
            "patch": "@@ -1,28 +0,0 @@\n-import {\n-  HMR_ACTIONS_SENT_TO_BROWSER,\n-  type HMR_ACTION_TYPES,\n-} from '../../../../server/dev/hot-reloader-types'\n-import { devBuildIndicator } from './dev-build-indicator'\n-\n-/**\n- * Handles HMR events to control the dev build indicator visibility.\n- * Shows indicator when building and hides it when build completes or syncs.\n- */\n-export const handleDevBuildIndicatorHmrEvents = (obj: HMR_ACTION_TYPES) => {\n-  try {\n-    if (!('action' in obj)) {\n-      return\n-    }\n-\n-    // eslint-disable-next-line default-case\n-    switch (obj.action) {\n-      case HMR_ACTIONS_SENT_TO_BROWSER.BUILDING:\n-        devBuildIndicator.show()\n-        break\n-      case HMR_ACTIONS_SENT_TO_BROWSER.BUILT:\n-      case HMR_ACTIONS_SENT_TO_BROWSER.SYNC:\n-        devBuildIndicator.hide()\n-        break\n-    }\n-  } catch {}\n-}"
        },
        {
            "sha": "445d3f8fd0c7d7215ae76aa48f88b8865ceb3ab7",
            "filename": "packages/next/src/client/dev/dev-build-indicator/internal/initialize.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Finitialize.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/61bd07fa450412e8a7f8100b33d6cd53df65c4d5/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Finitialize.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fdev-build-indicator%2Finternal%2Finitialize.ts?ref=61bd07fa450412e8a7f8100b33d6cd53df65c4d5",
            "patch": "@@ -1,35 +0,0 @@\n-/*\n- * Singleton store to track whether the app is currently being built\n- * Used by the dev tools indicator of the new overlay to show build status\n- */\n-\n-import { devBuildIndicator } from './dev-build-indicator'\n-import { useSyncExternalStore } from 'react'\n-\n-let isVisible = false\n-let listeners: Array<() => void> = []\n-\n-const subscribe = (listener: () => void) => {\n-  listeners.push(listener)\n-  return () => {\n-    listeners = listeners.filter((l) => l !== listener)\n-  }\n-}\n-\n-const getSnapshot = () => isVisible\n-\n-export function useIsDevBuilding() {\n-  return useSyncExternalStore(subscribe, getSnapshot)\n-}\n-\n-export function initialize() {\n-  devBuildIndicator.show = () => {\n-    isVisible = true\n-    listeners.forEach((listener) => listener())\n-  }\n-\n-  devBuildIndicator.hide = () => {\n-    isVisible = false\n-    listeners.forEach((listener) => listener())\n-  }\n-}"
        },
        {
            "sha": "f9006ed9a6381d5a693913335127a4073fd8a2a5",
            "filename": "packages/next/src/client/page-bootstrap.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/895908a35eb376cd5feb828ad34b8155a0caf0f1/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts?ref=895908a35eb376cd5feb828ad34b8155a0caf0f1",
            "patch": "@@ -1,7 +1,6 @@\n import '../lib/require-instrumentation-client'\n import { hydrate, router } from './'\n import initOnDemandEntries from './dev/on-demand-entries-client'\n-import { devBuildIndicator } from './dev/dev-build-indicator/internal/dev-build-indicator'\n import { displayContent } from './dev/fouc'\n import {\n   connectHMR,\n@@ -15,16 +14,17 @@ import { HMR_ACTIONS_SENT_TO_BROWSER } from '../server/dev/hot-reloader-types'\n import { RuntimeErrorHandler } from './components/errors/runtime-error-handler'\n import { REACT_REFRESH_FULL_RELOAD_FROM_ERROR } from './components/react-dev-overlay/shared'\n import { performFullReload } from './components/react-dev-overlay/pages/hot-reloader-client'\n-import { initializeDevBuildIndicatorForPageRouter } from './dev/dev-build-indicator/initialize-for-page-router'\n+import {\n+  buildingIndicatorHide,\n+  buildingIndicatorShow,\n+} from './components/react-dev-overlay/pages/client'\n \n export function pageBootstrap(assetPrefix: string) {\n   connectHMR({ assetPrefix, path: '/_next/webpack-hmr' })\n \n   return hydrate({ beforeRender: displayContent }).then(() => {\n     initOnDemandEntries()\n \n-    initializeDevBuildIndicatorForPageRouter()\n-\n     let reloading = false\n \n     addMessageListener((payload) => {\n@@ -93,8 +93,8 @@ export function pageBootstrap(assetPrefix: string) {\n \n             if (!router.clc && pages.includes(router.pathname)) {\n               console.log('Refreshing page data due to server-side change')\n-              devBuildIndicator.show()\n-              const clearIndicator = () => devBuildIndicator.hide()\n+              buildingIndicatorShow()\n+              const clearIndicator = buildingIndicatorHide\n \n               router\n                 .replace("
        }
    ],
    "stats": {
        "total": 180,
        "additions": 61,
        "deletions": 119
    }
}