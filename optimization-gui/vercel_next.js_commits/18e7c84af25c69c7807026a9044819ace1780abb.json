{
    "author": "lukesandberg",
    "message": "Remove JS size reporting from next build (#83815)\n\n## What\n\nRemove the `First Used JS` and `Size` metrics from `next build` CLI output, as well as the manifest files that supported these metrics.\n\n## Why\n\nA recent investigation has revealed a number of bugs and longstanding known issues in the implementation.\n\n* The metrics produced by Webpack builds for App Router don't account for layouts and parallel routes correctly.\n   * Not only are they not accounted for in route sizes, they are treated as distinct routes for the 'uniqueness' computation which means dependencies of a widely shared layout wouldn't be treated as 'common chunks'\n* The `First Used JS by All` metric counts `.css` chunks as JS\n    * This happened to predominately affect turbopack reporting due the above issue in webpack (css deps of layouts don't get treated as common deps)\n* In App router, client components are not accurately modeled by either toolchain\n   * webpack doesn't account for client components at all.  Leading to consistent undercounts\n   * turbopack accumulates all referenced client components which is better but can be an overcount for conditionally rendered or mutually exclusive components.\n*  In Pages router, `next/dynamic` dependencies can confuse these metrics\n\nGenerally, if a server is using any non-trivial logic to decide what is rendered there is just no correct answer to the 'First Load JS size' question.   These metrics originally came out of a collaboration with Chrome DevRel back in 2019 (maybe? first reference i think is https://github.com/vercel/next.js/pull/7194).  Since then, the web has shifted to Core Web Vitals and indeed that is what we use to evaluate actual performance.\n\nWe've decided to remove the metric instead as it's misleading at this point.\n\nSee #83823 for docs updates",
    "sha": "18e7c84af25c69c7807026a9044819ace1780abb",
    "files": [
        {
            "sha": "e709e81e7ea46434be67eeb7058fa4a6ff785a82",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 28,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -23,8 +23,8 @@ use next_core::{\n     next_dynamic::NextDynamicTransition,\n     next_edge::route_regex::get_named_middleware_regex,\n     next_manifests::{\n-        AppBuildManifest, AppPathsManifest, BuildManifest, ClientReferenceManifest,\n-        EdgeFunctionDefinition, MiddlewareMatcher, MiddlewaresManifestV2, PagesManifest, Regions,\n+        AppPathsManifest, BuildManifest, ClientReferenceManifest, EdgeFunctionDefinition,\n+        MiddlewareMatcher, MiddlewaresManifestV2, PagesManifest, Regions,\n         client_reference_manifest::ClientReferenceManifestOptions,\n     },\n     next_server::{\n@@ -40,7 +40,7 @@ use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, ValueToString, Vc,\n-    fxindexmap, fxindexset, trace::TraceRawVcs,\n+    fxindexset, trace::TraceRawVcs,\n };\n use turbo_tasks_env::{CustomProcessEnv, ProcessEnv};\n use turbo_tasks_fs::{File, FileContent, FileSystemPath};\n@@ -1154,7 +1154,7 @@ impl AppEndpoint {\n         enum EmitManifests {\n             /// Don't emit any manifests (needed for the RSC endpoints)\n             None,\n-            /// Emit the manifest for basic Next.js functionality (e.g. app-build-manifest.json)\n+            /// Emit the manifest for basic Next.js functionality\n             Minimal,\n             /// All manifests: `Minimal` plus next-font, next-dynamic, ...\n             Full,\n@@ -1312,30 +1312,6 @@ impl AppEndpoint {\n \n         let manifest_path_prefix = &app_entry.original_name;\n \n-        if emit_manifests != EmitManifests::None {\n-            let app_build_manifest = AppBuildManifest {\n-                pages: fxindexmap!(\n-                    app_entry.original_name.clone() => ResolvedVc::cell(entry_client_chunks\n-                        .iter()\n-                        .chain(client_shared_chunks.iter())\n-                        .copied()\n-                        .collect())\n-                ),\n-            };\n-            let app_build_manifest_output = app_build_manifest\n-                .build_output(\n-                    node_root.join(&format!(\n-                        \"server/app{manifest_path_prefix}/app-build-manifest.json\",\n-                    ))?,\n-                    client_relative_path.clone(),\n-                )\n-                .await?\n-                .to_resolved()\n-                .await?;\n-\n-            server_assets.insert(app_build_manifest_output);\n-        }\n-\n         // polyfill-nomodule.js is a pre-compiled asset distributed as part of next,\n         // load it as a RawModule.\n         let next_package = get_next_package(project.project_path().owned().await?)"
        },
        {
            "sha": "6341127ae3a3037ababb82424928425281822fa2",
            "filename": "crates/next-build-test/nextConfig.json",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-build-test%2FnextConfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-build-test%2FnextConfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-build-test%2FnextConfig.json?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -84,7 +84,6 @@\n     \"scrollRestoration\": false,\n     \"externalDir\": false,\n     \"disableOptimizedLoading\": false,\n-    \"gzipSize\": true,\n     \"craCompat\": false,\n     \"esmExternals\": true,\n     \"fullySpecified\": false,"
        },
        {
            "sha": "9d6e6a65a2463bcbc4f78ae2d18a95a729f753cd",
            "filename": "crates/next-core/src/next_manifests/mod.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fmod.rs?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -439,79 +439,6 @@ pub struct FontManifestEntry {\n     pub content: RcStr,\n }\n \n-#[derive(Default, Debug)]\n-pub struct AppBuildManifest {\n-    pub pages: FxIndexMap<RcStr, ResolvedVc<OutputAssets>>,\n-}\n-\n-impl AppBuildManifest {\n-    pub async fn build_output(\n-        self,\n-        output_path: FileSystemPath,\n-        client_relative_path: FileSystemPath,\n-    ) -> Result<Vc<Box<dyn OutputAsset>>> {\n-        let client_relative_path_ref = client_relative_path.clone();\n-\n-        #[derive(Serialize)]\n-        #[serde(rename_all = \"camelCase\")]\n-        pub struct SerializedAppBuildManifest {\n-            pub pages: FxIndexMap<RcStr, Vec<RcStr>>,\n-        }\n-\n-        let pages: Vec<(RcStr, Vec<RcStr>)> = self\n-            .pages\n-            .iter()\n-            .map(|(k, chunks)| {\n-                let client_relative_path_ref = client_relative_path_ref.clone();\n-\n-                async move {\n-                    Ok((\n-                        k.clone(),\n-                        chunks\n-                            .await?\n-                            .iter()\n-                            .copied()\n-                            .map(|chunk| {\n-                                let client_relative_path_ref = client_relative_path_ref.clone();\n-\n-                                async move {\n-                                    let chunk_path = chunk.path().await?;\n-                                    Ok(client_relative_path_ref\n-                                        .get_path_to(&chunk_path)\n-                                        .context(\n-                                            \"client chunk entry path must be inside the client \\\n-                                             root\",\n-                                        )?\n-                                        .into())\n-                                }\n-                            })\n-                            .try_join()\n-                            .await?,\n-                    ))\n-                }\n-            })\n-            .try_join()\n-            .await?;\n-\n-        let manifest = SerializedAppBuildManifest {\n-            pages: FxIndexMap::from_iter(pages.into_iter()),\n-        };\n-\n-        let references = self.pages.values().try_join().await?;\n-\n-        let references = references\n-            .into_iter()\n-            .flat_map(|c| c.into_iter().copied())\n-            .collect();\n-\n-        Ok(Vc::upcast(VirtualOutputAsset::new_with_references(\n-            output_path,\n-            AssetContent::file(File::from(serde_json::to_string_pretty(&manifest)?).into()),\n-            Vc::cell(references),\n-        )))\n-    }\n-}\n-\n // TODO(alexkirsz) Unify with the one for dev.\n #[derive(Serialize, Debug)]\n #[serde(rename_all = \"camelCase\")]"
        },
        {
            "sha": "cbf157cdccd2e3d6ebd9220ea68091325304a149",
            "filename": "packages/next/src/build/handle-entrypoints.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Fhandle-entrypoints.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Fhandle-entrypoints.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fhandle-entrypoints.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -109,7 +109,6 @@ export async function handleRouteType({\n         manifestLoader.deleteMiddlewareManifest(key)\n       }\n \n-      manifestLoader.loadAppBuildManifest(page)\n       manifestLoader.loadBuildManifest(page, 'app')\n       manifestLoader.loadAppPathsManifest(page)\n       manifestLoader.loadActionManifest(page)"
        },
        {
            "sha": "68c7034f998fbe77682ac4890ba23a526f8b666b",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -1,4 +1,3 @@\n-import type { AppBuildManifest } from './webpack/plugins/app-build-manifest-plugin'\n import type { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\n import type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\n import type { MiddlewareManifest } from './webpack/plugins/middleware-plugin'\n@@ -68,7 +67,6 @@ import {\n   MIDDLEWARE_MANIFEST,\n   APP_PATHS_MANIFEST,\n   APP_PATH_ROUTES_MANIFEST,\n-  APP_BUILD_MANIFEST,\n   RSC_MODULE_TYPES,\n   NEXT_FONT_MANIFEST,\n   SUBRESOURCE_INTEGRITY_MANIFEST,\n@@ -132,8 +130,6 @@ import createSpinner from './spinner'\n import { trace, flushAllTraces, setGlobal, type Span } from '../trace'\n import {\n   detectConflictingPaths,\n-  computeFromManifest,\n-  getJsPageSizeInKb,\n   printCustomRoutes,\n   printTreeView,\n   copyTracedFiles,\n@@ -1840,7 +1836,6 @@ export default async function build(\n       const postCompileSpinner = createSpinner('Collecting page data')\n \n       const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n-      const appBuildManifestPath = path.join(distDir, APP_BUILD_MANIFEST)\n \n       let staticAppPagesCount = 0\n       let serverAppPagesCount = 0\n@@ -1861,9 +1856,6 @@ export default async function build(\n       const pageInfos: PageInfos = new Map<string, PageInfo>()\n       let pagesManifest = await readManifest<PagesManifest>(pagesManifestPath)\n       const buildManifest = await readManifest<BuildManifest>(buildManifestPath)\n-      const appBuildManifest = appDir\n-        ? await readManifest<AppBuildManifest>(appBuildManifestPath)\n-        : undefined\n \n       const appPathRoutes: Record<string, string> = {}\n \n@@ -1980,12 +1972,6 @@ export default async function build(\n         // eslint-disable-next-line @typescript-eslint/no-shadow\n         let hasSsrAmpPages = false\n \n-        const computedManifestData = await computeFromManifest(\n-          { build: buildManifest, app: appBuildManifest },\n-          distDir,\n-          config.experimental.gzipSize\n-        )\n-\n         const middlewareManifest: MiddlewareManifest = require(\n           path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n         )\n@@ -2043,15 +2029,6 @@ export default async function build(\n               })\n               return checkPageSpan.traceAsyncFn(async () => {\n                 const actualPage = normalizePagePath(page)\n-                const [size, totalSize] = await getJsPageSizeInKb(\n-                  pageType,\n-                  actualPage,\n-                  distDir,\n-                  buildManifest,\n-                  appBuildManifest,\n-                  config.experimental.gzipSize,\n-                  computedManifestData\n-                )\n \n                 let isRoutePPREnabled = false\n                 let isSSG = false\n@@ -2412,8 +2389,6 @@ export default async function build(\n \n                 pageInfos.set(page, {\n                   originalAppPath,\n-                  size,\n-                  totalSize,\n                   isStatic,\n                   isSSG,\n                   isRoutePPREnabled,\n@@ -2547,7 +2522,6 @@ export default async function build(\n                       : []),\n                     path.join(SERVER_DIRECTORY, APP_PATHS_MANIFEST),\n                     path.join(APP_PATH_ROUTES_MANIFEST),\n-                    APP_BUILD_MANIFEST,\n                     path.join(\n                       SERVER_DIRECTORY,\n                       SERVER_REFERENCE_MANIFEST + '.js'\n@@ -4162,15 +4136,11 @@ export default async function build(\n \n       await nextBuildSpan.traceChild('print-tree-view').traceAsyncFn(() =>\n         printTreeView(pageKeys, pageInfos, {\n-          distPath: distDir,\n-          buildId: buildId,\n           pagesDir,\n           useStaticPages404,\n           pageExtensions: config.pageExtensions,\n-          appBuildManifest,\n           buildManifest,\n           middlewareManifest,\n-          gzipSize: config.experimental.gzipSize,\n         })\n       )\n "
        },
        {
            "sha": "5a53f8cb914e7bb63e101bd5a14313bcbdd87e58",
            "filename": "packages/next/src/build/utils.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 478,
            "changes": 495,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -1,6 +1,5 @@\n import type { NextConfigComplete } from '../server/config-shared'\n import type { ExperimentalPPRConfig } from '../server/lib/experimental/ppr'\n-import type { AppBuildManifest } from './webpack/plugins/app-build-manifest-plugin'\n import type { AssetBinding } from './webpack/loaders/get-module-build-info'\n import type { PageConfig, ServerRuntime } from '../types'\n import type { BuildManifest } from '../server/get-page-files'\n@@ -25,16 +24,7 @@ import '../server/require-hook'\n import '../server/node-polyfill-crypto'\n import '../server/node-environment'\n \n-import {\n-  green,\n-  yellow,\n-  red,\n-  cyan,\n-  white,\n-  bold,\n-  underline,\n-} from '../lib/picocolors'\n-import getGzipSize from 'next/dist/compiled/gzip-size'\n+import { green, yellow, red, cyan, bold, underline } from '../lib/picocolors'\n import textTable from 'next/dist/compiled/text-table'\n import path from 'path'\n import { promises as fs } from 'fs'\n@@ -55,7 +45,6 @@ import {\n   UNDERSCORE_GLOBAL_ERROR_ROUTE_ENTRY,\n   UNDERSCORE_NOT_FOUND_ROUTE,\n } from '../shared/lib/constants'\n-import prettyBytes from '../lib/pretty-bytes'\n import { isDynamicRoute } from '../shared/lib/router/utils/is-dynamic'\n import { findPageFile } from '../server/lib/find-page-file'\n import { isEdgeRuntime } from '../lib/is-edge-runtime'\n@@ -65,12 +54,9 @@ import type { LoadComponentsReturnType } from '../server/load-components'\n import { trace } from '../trace'\n import { setHttpClientAndAgentOptions } from '../server/setup-http-agent-env'\n import { Sema } from 'next/dist/compiled/async-sema'\n-import { denormalizePagePath } from '../shared/lib/page-path/denormalize-page-path'\n import { normalizePagePath } from '../shared/lib/page-path/normalize-page-path'\n import { getRuntimeContext } from '../server/web/sandbox'\n import { isClientReference } from '../lib/client-and-server-references'\n-import { normalizeAppPath } from '../shared/lib/router/utils/app-paths'\n-import { denormalizeAppPagePath } from '../shared/lib/page-path/denormalize-app-path'\n import { RouteKind } from '../server/route-kind'\n import type { PageExtensions } from './page-extensions-type'\n import { checkIsRoutePPREnabled } from '../server/lib/experimental/ppr'\n@@ -94,21 +80,6 @@ export type ROUTER_TYPE = 'pages' | 'app'\n const print = console.log\n \n const RESERVED_PAGE = /^\\/(_app|_error|_document|api(\\/|$))/\n-const fileGzipStats: { [k: string]: Promise<number> | undefined } = {}\n-const fsStatGzip = (file: string) => {\n-  const cached = fileGzipStats[file]\n-  if (cached) return cached\n-  return (fileGzipStats[file] = getGzipSize.file(file))\n-}\n-\n-const fileSize = async (file: string) => (await fs.stat(file)).size\n-\n-const fileStats: { [k: string]: Promise<number> | undefined } = {}\n-const fsStat = (file: string) => {\n-  const cached = fileStats[file]\n-  if (cached) return cached\n-  return (fileStats[file] = fileSize(file))\n-}\n \n export function unique<T>(main: ReadonlyArray<T>, sub: ReadonlyArray<T>): T[] {\n   return [...new Set([...main, ...sub])]\n@@ -123,188 +94,6 @@ export function difference<T>(\n   return [...a].filter((x) => !b.has(x))\n }\n \n-/**\n- * Return an array of the items shared by both arrays.\n- */\n-function intersect<T>(main: ReadonlyArray<T>, sub: ReadonlyArray<T>): T[] {\n-  const a = new Set(main)\n-  const b = new Set(sub)\n-  return [...new Set([...a].filter((x) => b.has(x)))]\n-}\n-\n-function sum(a: ReadonlyArray<number>): number {\n-  return a.reduce((size, stat) => size + stat, 0)\n-}\n-\n-type ComputeFilesGroup = {\n-  files: ReadonlyArray<string>\n-  size: {\n-    total: number\n-  }\n-}\n-\n-type ComputeFilesManifest = {\n-  unique: ComputeFilesGroup\n-  common: ComputeFilesGroup\n-}\n-\n-type ComputeFilesManifestResult = {\n-  router: {\n-    pages: ComputeFilesManifest\n-    app?: ComputeFilesManifest\n-  }\n-  sizes: Map<string, number>\n-}\n-\n-let cachedBuildManifest: BuildManifest | undefined\n-let cachedAppBuildManifest: AppBuildManifest | undefined\n-\n-let lastCompute: ComputeFilesManifestResult | undefined\n-let lastComputePageInfo: boolean | undefined\n-\n-export async function computeFromManifest(\n-  manifests: {\n-    build: BuildManifest\n-    app?: AppBuildManifest\n-  },\n-  distPath: string,\n-  gzipSize: boolean = true,\n-  pageInfos?: Map<string, PageInfo>\n-): Promise<ComputeFilesManifestResult> {\n-  if (\n-    Object.is(cachedBuildManifest, manifests.build) &&\n-    lastComputePageInfo === !!pageInfos &&\n-    Object.is(cachedAppBuildManifest, manifests.app)\n-  ) {\n-    return lastCompute!\n-  }\n-\n-  // Determine the files that are in pages and app and count them, this will\n-  // tell us if they are unique or common.\n-\n-  const countBuildFiles = (\n-    map: Map<string, number>,\n-    key: string,\n-    manifest: Record<string, ReadonlyArray<string>>\n-  ) => {\n-    for (const file of manifest[key]) {\n-      if (key === '/_app') {\n-        map.set(file, Infinity)\n-      } else if (map.has(file)) {\n-        map.set(file, map.get(file)! + 1)\n-      } else {\n-        map.set(file, 1)\n-      }\n-    }\n-  }\n-\n-  const files: {\n-    pages: {\n-      each: Map<string, number>\n-      expected: number\n-    }\n-    app?: {\n-      each: Map<string, number>\n-      expected: number\n-    }\n-  } = {\n-    pages: { each: new Map(), expected: 0 },\n-  }\n-\n-  for (const key in manifests.build.pages) {\n-    if (pageInfos) {\n-      const pageInfo = pageInfos.get(key)\n-      // don't include AMP pages since they don't rely on shared bundles\n-      // AMP First pages are not under the pageInfos key\n-      if (pageInfo?.isHybridAmp) {\n-        continue\n-      }\n-    }\n-\n-    files.pages.expected++\n-    countBuildFiles(files.pages.each, key, manifests.build.pages)\n-  }\n-\n-  // Collect the build files form the app manifest.\n-  if (manifests.app?.pages) {\n-    files.app = { each: new Map<string, number>(), expected: 0 }\n-\n-    for (const key in manifests.app.pages) {\n-      files.app.expected++\n-      countBuildFiles(files.app.each, key, manifests.app.pages)\n-    }\n-  }\n-\n-  const getSize = gzipSize ? fsStatGzip : fsStat\n-  const stats = new Map<string, number>()\n-\n-  // For all of the files in the pages and app manifests, compute the file size\n-  // at once.\n-\n-  await Promise.all(\n-    [\n-      ...new Set<string>([\n-        ...files.pages.each.keys(),\n-        ...(files.app?.each.keys() ?? []),\n-      ]),\n-    ].map(async (f) => {\n-      try {\n-        // Add the file size to the stats.\n-        stats.set(f, await getSize(path.join(distPath, f)))\n-      } catch {}\n-    })\n-  )\n-\n-  const groupFiles = async (listing: {\n-    each: Map<string, number>\n-    expected: number\n-  }): Promise<ComputeFilesManifest> => {\n-    const entries = [...listing.each.entries()]\n-\n-    const shapeGroup = (group: [string, number][]): ComputeFilesGroup =>\n-      group.reduce(\n-        (acc, [f]) => {\n-          acc.files.push(f)\n-\n-          const size = stats.get(f)\n-          if (typeof size === 'number') {\n-            acc.size.total += size\n-          }\n-\n-          return acc\n-        },\n-        {\n-          files: [] as string[],\n-          size: {\n-            total: 0,\n-          },\n-        }\n-      )\n-\n-    return {\n-      unique: shapeGroup(entries.filter(([, len]) => len === 1)),\n-      common: shapeGroup(\n-        entries.filter(\n-          ([, len]) => len === listing.expected || len === Infinity\n-        )\n-      ),\n-    }\n-  }\n-\n-  lastCompute = {\n-    router: {\n-      pages: await groupFiles(files.pages),\n-      app: files.app ? await groupFiles(files.app) : undefined,\n-    },\n-    sizes: stats,\n-  }\n-\n-  cachedBuildManifest = manifests.build\n-  cachedAppBuildManifest = manifests.app\n-  lastComputePageInfo = !!pageInfos\n-  return lastCompute!\n-}\n-\n export function isMiddlewareFilename(file?: string | null) {\n   return file === MIDDLEWARE_FILENAME || file === `src/${MIDDLEWARE_FILENAME}`\n }\n@@ -349,8 +138,6 @@ const filterAndSortList = (\n export interface PageInfo {\n   originalAppPath: string | undefined\n   isHybridAmp?: boolean\n-  size: number\n-  totalSize: number\n   isStatic: boolean\n   isSSG: boolean\n   /**\n@@ -393,38 +180,19 @@ export async function printTreeView(\n   },\n   pageInfos: Map<string, PageInfo>,\n   {\n-    distPath,\n-    buildId,\n     pagesDir,\n     pageExtensions,\n     buildManifest,\n-    appBuildManifest,\n     middlewareManifest,\n     useStaticPages404,\n-    gzipSize = true,\n   }: {\n-    distPath: string\n-    buildId: string\n     pagesDir?: string\n     pageExtensions: PageExtensions\n     buildManifest: BuildManifest\n-    appBuildManifest?: AppBuildManifest\n     middlewareManifest: MiddlewareManifest\n     useStaticPages404: boolean\n-    gzipSize?: boolean\n   }\n ) {\n-  const getPrettySize = (\n-    _size: number,\n-    { strong }: { strong?: boolean } = {}\n-  ): string => {\n-    const size = process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT\n-      ? 'N/A kB'\n-      : prettyBytes(_size)\n-\n-    return strong ? white(bold(size)) : size\n-  }\n-\n   // Can be overridden for test purposes to omit the build duration output.\n   const MIN_DURATION = process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT\n     ? Infinity // Don't ever log build durations.\n@@ -440,15 +208,6 @@ export async function printTreeView(\n     return red(bold(duration))\n   }\n \n-  const getCleanName = (fileName: string) =>\n-    fileName\n-      // Trim off `static/`\n-      .replace(/^static\\//, '')\n-      // Re-add `static/` for root files\n-      .replace(/^<buildId>/, 'static')\n-      // Remove file hash\n-      .replace(/(?:^|[.-])([0-9a-z]{6})[0-9a-z]{14}(?=\\.)/, '.$1')\n-\n   // Check if we have a custom app.\n   const hasCustomApp = !!(\n     pagesDir && (await findPageFile(pagesDir, '/_app', pageExtensions, false))\n@@ -457,14 +216,7 @@ export async function printTreeView(\n   // Collect all the symbols we use so we can print the icons out.\n   const usedSymbols = new Set()\n \n-  const messages: [string, string, string, string, string][] = []\n-\n-  const stats = await computeFromManifest(\n-    { build: buildManifest, app: appBuildManifest },\n-    distPath,\n-    gzipSize,\n-    pageInfos\n-  )\n+  const messages: string[][] = []\n \n   const printFileTree = async ({\n     list,\n@@ -500,17 +252,11 @@ export async function printTreeView(\n     messages.push(\n       [\n         routerType === 'app' ? 'Route (app)' : 'Route (pages)',\n-        'Size',\n-        'First Load JS',\n         showRevalidate ? 'Revalidate' : '',\n         showExpire ? 'Expire' : '',\n-      ].map((entry) => underline(entry)) as [\n-        string,\n-        string,\n-        string,\n-        string,\n-        string,\n       ]\n+        .filter((entry) => entry !== '')\n+        .map((entry) => underline(entry))\n     )\n \n     filteredPages.forEach((item, i, arr) => {\n@@ -524,7 +270,9 @@ export async function printTreeView(\n             : '├'\n \n       const pageInfo = pageInfos.get(item)\n-      const ampFirst = buildManifest.ampFirstPages.includes(item)\n+      const ampLabel = buildManifest.ampFirstPages.includes(item)\n+        ? ` ${cyan('AMP')}`\n+        : ''\n       const totalDuration =\n         (pageInfo?.pageDuration || 0) +\n         (pageInfo?.ssgPageDurations?.reduce((a, b) => a + (b || 0), 0) || 0)\n@@ -561,25 +309,11 @@ export async function printTreeView(\n       usedSymbols.add(symbol)\n \n       messages.push([\n-        `${border} ${symbol} ${item}${\n+        `${border} ${symbol} ${item}${ampLabel}${\n           totalDuration > MIN_DURATION\n             ? ` (${getPrettyDuration(totalDuration)})`\n             : ''\n         }`,\n-        pageInfo\n-          ? ampFirst\n-            ? cyan('AMP')\n-            : pageInfo.size >= 0\n-              ? getPrettySize(pageInfo.size)\n-              : ''\n-          : '',\n-        pageInfo\n-          ? ampFirst\n-            ? cyan('AMP')\n-            : pageInfo.size >= 0\n-              ? getPrettySize(pageInfo.totalSize, { strong: true })\n-              : ''\n-          : '',\n         showRevalidate && pageInfo?.initialCacheControl\n           ? formatRevalidate(pageInfo.initialCacheControl)\n           : '',\n@@ -588,38 +322,12 @@ export async function printTreeView(\n           : '',\n       ])\n \n-      const uniqueCssFiles =\n-        buildManifest.pages[item]?.filter(\n-          (file) =>\n-            file.endsWith('.css') &&\n-            stats.router[routerType]?.unique.files.includes(file)\n-        ) || []\n-\n-      if (uniqueCssFiles.length > 0) {\n-        const contSymbol = i === arr.length - 1 ? ' ' : '├'\n-\n-        uniqueCssFiles.forEach((file, index, { length }) => {\n-          const innerSymbol = index === length - 1 ? '└' : '├'\n-          const size = stats.sizes.get(file)\n-          messages.push([\n-            `${contSymbol}   ${innerSymbol} ${getCleanName(file)}`,\n-            typeof size === 'number' ? getPrettySize(size) : '',\n-            '',\n-            '',\n-            '',\n-          ])\n-        })\n-      }\n-\n       if (pageInfo?.ssgPageRoutes?.length) {\n         const totalRoutes = pageInfo.ssgPageRoutes.length\n         const contSymbol = i === arr.length - 1 ? ' ' : '├'\n \n         let routes: { route: string; duration: number; avgDuration?: number }[]\n-        if (\n-          pageInfo.ssgPageDurations &&\n-          pageInfo.ssgPageDurations.some((d) => d > MIN_DURATION)\n-        ) {\n+        if (pageInfo.ssgPageDurations?.some((d) => d > MIN_DURATION)) {\n           const previewPages = totalRoutes === 8 ? 8 : Math.min(totalRoutes, 7)\n           const routesWithDuration = pageInfo.ssgPageRoutes\n             .map((route, idx) => ({\n@@ -676,7 +384,6 @@ export async function printTreeView(\n                   : ''\n               }`,\n               '',\n-              '',\n               showRevalidate && initialCacheControl\n                 ? formatRevalidate(initialCacheControl)\n                 : '',\n@@ -688,82 +395,16 @@ export async function printTreeView(\n         )\n       }\n     })\n-\n-    const sharedFilesSize = stats.router[routerType]?.common.size.total\n-\n-    const sharedFiles = process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT\n-      ? []\n-      : (stats.router[routerType]?.common.files ?? [])\n-\n-    messages.push([\n-      '+ First Load JS shared by all',\n-      typeof sharedFilesSize === 'number'\n-        ? getPrettySize(sharedFilesSize, { strong: true })\n-        : '',\n-      '',\n-      '',\n-      '',\n-    ])\n-    const sharedCssFiles: string[] = []\n-    const sharedJsChunks = [\n-      ...sharedFiles\n-        .filter((file) => {\n-          if (file.endsWith('.css')) {\n-            sharedCssFiles.push(file)\n-            return false\n-          }\n-          return true\n-        })\n-        .map((e) => e.replace(buildId, '<buildId>'))\n-        .sort(),\n-      ...sharedCssFiles.map((e) => e.replace(buildId, '<buildId>')).sort(),\n-    ]\n-\n-    // if the some chunk are less than 10kb or we don't know the size, we only show the total size of the rest\n-    const tenKbLimit = 10 * 1000\n-    let restChunkSize = 0\n-    let restChunkCount = 0\n-    sharedJsChunks.forEach((fileName, index, { length }) => {\n-      const innerSymbol = index + restChunkCount === length - 1 ? '└' : '├'\n-\n-      const originalName = fileName.replace('<buildId>', buildId)\n-      const cleanName = getCleanName(fileName)\n-      const size = stats.sizes.get(originalName)\n-\n-      if (!size || size < tenKbLimit) {\n-        restChunkCount++\n-        restChunkSize += size || 0\n-        return\n-      }\n-\n-      messages.push([\n-        `  ${innerSymbol} ${cleanName}`,\n-        getPrettySize(size),\n-        '',\n-        '',\n-        '',\n-      ])\n-    })\n-\n-    if (restChunkCount > 0) {\n-      messages.push([\n-        `  └ other shared chunks (total)`,\n-        getPrettySize(restChunkSize),\n-        '',\n-        '',\n-        '',\n-      ])\n-    }\n   }\n \n   // If enabled, then print the tree for the app directory.\n-  if (lists.app && stats.router.app) {\n+  if (lists.app) {\n     await printFileTree({\n       routerType: 'app',\n       list: lists.app,\n     })\n \n-    messages.push(['', '', '', '', ''])\n+    messages.push(['', '', '', ''])\n   }\n \n   pageInfos.set('/404', {\n@@ -787,31 +428,20 @@ export async function printTreeView(\n \n   const middlewareInfo = middlewareManifest.middleware?.['/']\n   if (middlewareInfo?.files.length > 0) {\n-    const middlewareSizes = await Promise.all(\n-      middlewareInfo.files\n-        .map((dep) => `${distPath}/${dep}`)\n-        .map(gzipSize ? fsStatGzip : fsStat)\n-    )\n-\n-    messages.push(['', '', '', '', ''])\n-    messages.push([\n-      'ƒ Middleware',\n-      getPrettySize(sum(middlewareSizes), { strong: true }),\n-      '',\n-      '',\n-      '',\n-    ])\n+    messages.push([])\n+    messages.push(['ƒ Middleware'])\n   }\n \n   print(\n     textTable(messages, {\n-      align: ['l', 'r', 'r', 'r', 'r'],\n+      align: ['l', 'r', 'r', 'r'],\n       stringLength: (str) => stripAnsi(str).length,\n     })\n   )\n \n-  const staticFunctionInfo =\n-    lists.app && stats.router.app ? 'generateStaticParams' : 'getStaticProps'\n+  const staticFunctionInfo = lists.app\n+    ? 'generateStaticParams'\n+    : 'getStaticProps'\n   print()\n   print(\n     textTable(\n@@ -917,97 +547,6 @@ export function printCustomRoutes({\n   }\n }\n \n-export async function getJsPageSizeInKb(\n-  routerType: ROUTER_TYPE,\n-  page: string,\n-  distPath: string,\n-  buildManifest: BuildManifest,\n-  appBuildManifest?: AppBuildManifest,\n-  gzipSize: boolean = true,\n-  cachedStats?: ComputeFilesManifestResult\n-): Promise<[number, number]> {\n-  const pageManifest = routerType === 'pages' ? buildManifest : appBuildManifest\n-  if (!pageManifest) {\n-    throw new Error('expected appBuildManifest with an \"app\" pageType')\n-  }\n-\n-  // Normalize appBuildManifest keys\n-  if (routerType === 'app') {\n-    pageManifest.pages = Object.entries(pageManifest.pages).reduce(\n-      (acc: Record<string, string[]>, [key, value]) => {\n-        const newKey = normalizeAppPath(key)\n-        acc[newKey] = value as string[]\n-        return acc\n-      },\n-      {}\n-    )\n-  }\n-\n-  // If stats was not provided, then compute it again.\n-  const stats =\n-    cachedStats ??\n-    (await computeFromManifest(\n-      { build: buildManifest, app: appBuildManifest },\n-      distPath,\n-      gzipSize\n-    ))\n-\n-  const pageData = stats.router[routerType]\n-  if (!pageData) {\n-    // This error shouldn't happen and represents an error in Next.js.\n-    throw new Error('expected \"app\" manifest data with an \"app\" pageType')\n-  }\n-\n-  const pagePath =\n-    routerType === 'pages'\n-      ? denormalizePagePath(page)\n-      : denormalizeAppPagePath(page)\n-\n-  const fnFilterJs = (entry: string) => entry.endsWith('.js')\n-\n-  const pageFiles = (pageManifest.pages[pagePath] ?? []).filter(fnFilterJs)\n-  const appFiles = (pageManifest.pages['/_app'] ?? []).filter(fnFilterJs)\n-\n-  const fnMapRealPath = (dep: string) => `${distPath}/${dep}`\n-\n-  const allFilesReal = unique(pageFiles, appFiles).map(fnMapRealPath)\n-  const selfFilesReal = difference(\n-    // Find the files shared by the pages files and the unique files...\n-    intersect(pageFiles, pageData.unique.files),\n-    // but without the common files.\n-    pageData.common.files\n-  ).map(fnMapRealPath)\n-\n-  const getSize = gzipSize ? fsStatGzip : fsStat\n-\n-  // Try to get the file size from the page data if available, otherwise do a\n-  // raw compute.\n-  const getCachedSize = async (file: string) => {\n-    const key = file.slice(distPath.length + 1)\n-    const size: number | undefined = stats.sizes.get(key)\n-\n-    // If the size wasn't in the stats bundle, then get it from the file\n-    // directly.\n-    if (typeof size !== 'number') {\n-      return getSize(file)\n-    }\n-\n-    return size\n-  }\n-\n-  try {\n-    // Doesn't use `Promise.all`, as we'd double compute duplicate files. This\n-    // function is memoized, so the second one will instantly resolve.\n-    const allFilesSize = sum(await Promise.all(allFilesReal.map(getCachedSize)))\n-    const selfFilesSize = sum(\n-      await Promise.all(selfFilesReal.map(getCachedSize))\n-    )\n-\n-    return [selfFilesSize, allFilesSize]\n-  } catch {}\n-  return [-1, -1]\n-}\n-\n type PageIsStaticResult = {\n   isRoutePPREnabled?: boolean\n   isStatic?: boolean"
        },
        {
            "sha": "26b0a5a15cd059353f43f2fa9a5847bb8150190f",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -63,7 +63,6 @@ import loadJsConfig, {\n   type ResolvedBaseUrl,\n } from './load-jsconfig'\n import { loadBindings } from './swc'\n-import { AppBuildManifestPlugin } from './webpack/plugins/app-build-manifest-plugin'\n import { SubresourceIntegrityPlugin } from './webpack/plugins/subresource-integrity-plugin'\n import { NextFontManifestPlugin } from './webpack/plugins/next-font-manifest-plugin'\n import { getSupportedBrowsers } from './utils'\n@@ -1970,7 +1969,7 @@ export default async function getBaseWebpackConfig(\n               '.shared-runtime'\n             )\n             const layer = resource.contextInfo.issuerLayer\n-            let runtime\n+            let runtime: string\n \n             switch (layer) {\n               case WEBPACK_LAYERS.serverSideRendering:\n@@ -2128,7 +2127,6 @@ export default async function getBaseWebpackConfig(\n             minimized: true,\n           },\n         }),\n-      hasAppDir && isClient && new AppBuildManifestPlugin(),\n       hasAppDir &&\n         (isClient\n           ? new ClientReferenceManifestPlugin({"
        },
        {
            "sha": "3048c1469d7bceb2f702e59e552e0c26bc30f63d",
            "filename": "packages/next/src/build/webpack/plugins/app-build-manifest-plugin.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fapp-build-manifest-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fapp-build-manifest-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fapp-build-manifest-plugin.ts?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,65 +0,0 @@\n-import { webpack, sources } from 'next/dist/compiled/webpack/webpack'\n-import {\n-  APP_BUILD_MANIFEST,\n-  CLIENT_STATIC_FILES_RUNTIME_MAIN_APP,\n-  SYSTEM_ENTRYPOINTS,\n-} from '../../../shared/lib/constants'\n-import { getEntrypointFiles } from './build-manifest-plugin'\n-import getAppRouteFromEntrypoint from '../../../server/get-app-route-from-entrypoint'\n-\n-export type AppBuildManifest = {\n-  pages: Record<string, string[]>\n-}\n-\n-const PLUGIN_NAME = 'AppBuildManifestPlugin'\n-\n-export class AppBuildManifestPlugin {\n-  public apply(compiler: any) {\n-    compiler.hooks.make.tap(PLUGIN_NAME, (compilation: any) => {\n-      compilation.hooks.processAssets.tap(\n-        {\n-          name: PLUGIN_NAME,\n-          stage: webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS,\n-        },\n-        () => this.createAsset(compilation)\n-      )\n-    })\n-  }\n-\n-  private createAsset(compilation: webpack.Compilation) {\n-    const manifest: AppBuildManifest = {\n-      pages: {},\n-    }\n-\n-    const mainFiles = new Set(\n-      getEntrypointFiles(\n-        compilation.entrypoints.get(CLIENT_STATIC_FILES_RUNTIME_MAIN_APP)\n-      )\n-    )\n-\n-    for (const entrypoint of compilation.entrypoints.values()) {\n-      if (!entrypoint.name) {\n-        continue\n-      }\n-\n-      if (SYSTEM_ENTRYPOINTS.has(entrypoint.name)) {\n-        continue\n-      }\n-\n-      const pagePath = getAppRouteFromEntrypoint(entrypoint.name)\n-      if (!pagePath) {\n-        continue\n-      }\n-\n-      const filesForPage = getEntrypointFiles(entrypoint)\n-      manifest.pages[pagePath] = [...new Set([...mainFiles, ...filesForPage])]\n-    }\n-\n-    const json = JSON.stringify(manifest, null, 2)\n-\n-    compilation.emitAsset(\n-      APP_BUILD_MANIFEST,\n-      new sources.RawSource(json) as unknown as webpack.sources.RawSource\n-    )\n-  }\n-}"
        },
        {
            "sha": "674179686114dea6f2960096de80084c10316a04",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -388,6 +388,8 @@ export interface ExperimentalConfig {\n     skipValidation?: boolean\n   }\n   disableOptimizedLoading?: boolean\n+\n+  /** @deprecated A no-op as of Next 16, size metrics were removed from the build output. */\n   gzipSize?: boolean\n   craCompat?: boolean\n   esmExternals?: boolean | 'loose'"
        },
        {
            "sha": "5cc1a0eadeaee9932cb7b3b2f4cbdd26346d9e5b",
            "filename": "packages/next/src/server/dev/turbopack-utils.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -387,7 +387,6 @@ export async function handleRouteType({\n         manifestLoader.deleteMiddlewareManifest(key)\n       }\n \n-      manifestLoader.loadAppBuildManifest(page)\n       manifestLoader.loadBuildManifest(page, 'app')\n       manifestLoader.loadAppPathsManifest(page)\n       manifestLoader.loadActionManifest(page)"
        },
        {
            "sha": "462b65265994eff0d6c1883c084a37a7b912606a",
            "filename": "packages/next/src/server/load-components.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fload-components.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -181,7 +181,7 @@ async function loadComponentsImpl<N = any>({\n     // attempting to load.\n     const manifestLoadAttempts = isDev ? 3 : 1\n \n-    let reactLoadableManifestPath\n+    let reactLoadableManifestPath: string\n     if (!process.env.TURBOPACK) {\n       reactLoadableManifestPath = join(\n         /* turbopackIgnore: true */ distDir,"
        },
        {
            "sha": "f1ccf3e134767954cc48683868a9df88eb7ae49e",
            "filename": "packages/next/src/shared/lib/constants.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fconstants.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fconstants.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fconstants.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -87,7 +87,6 @@ export const WEBPACK_STATS = 'webpack-stats.json'\n export const APP_PATHS_MANIFEST = 'app-paths-manifest.json'\n export const APP_PATH_ROUTES_MANIFEST = 'app-path-routes-manifest.json'\n export const BUILD_MANIFEST = 'build-manifest.json'\n-export const APP_BUILD_MANIFEST = 'app-build-manifest.json'\n export const FUNCTIONS_CONFIG_MANIFEST = 'functions-config-manifest.json'\n export const SUBRESOURCE_INTEGRITY_MANIFEST = 'subresource-integrity-manifest'\n export const NEXT_FONT_MANIFEST = 'next-font-manifest'"
        },
        {
            "sha": "34830246d576484e850cacf21b34541f6670200b",
            "filename": "packages/next/src/shared/lib/turbopack/manifest-loader.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Fmanifest-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Fmanifest-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Fmanifest-loader.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -10,13 +10,11 @@ import type {\n   StatsCompilation as WebpackStats,\n } from 'webpack'\n import type { BuildManifest } from '../../../server/get-page-files'\n-import type { AppBuildManifest } from '../../../build/webpack/plugins/app-build-manifest-plugin'\n import type { PagesManifest } from '../../../build/webpack/plugins/pages-manifest-plugin'\n import type { ActionManifest } from '../../../build/webpack/plugins/flight-client-entry-plugin'\n import type { NextFontManifest } from '../../../build/webpack/plugins/next-font-manifest-plugin'\n import type { REACT_LOADABLE_MANIFEST } from '../constants'\n import {\n-  APP_BUILD_MANIFEST,\n   APP_PATHS_MANIFEST,\n   BUILD_MANIFEST,\n   INTERCEPTION_ROUTE_REWRITE_MANIFEST,\n@@ -68,7 +66,6 @@ type TurbopackMiddlewareManifest = MiddlewareManifest & {\n type ManifestName =\n   | typeof MIDDLEWARE_MANIFEST\n   | typeof BUILD_MANIFEST\n-  | typeof APP_BUILD_MANIFEST\n   | typeof PAGES_MANIFEST\n   | typeof WEBPACK_STATS\n   | typeof APP_PATHS_MANIFEST\n@@ -134,7 +131,6 @@ function readPartialManifest<T>(\n \n export class TurbopackManifestLoader {\n   private actionManifests: Map<EntryKey, ActionManifest> = new Map()\n-  private appBuildManifests: Map<EntryKey, AppBuildManifest> = new Map()\n   private appPathsManifests: Map<EntryKey, PagesManifest> = new Map()\n   private buildManifests: Map<EntryKey, BuildManifest> = new Map()\n   private clientBuildManifests: Map<EntryKey, ClientBuildManifest> = new Map()\n@@ -164,7 +160,6 @@ export class TurbopackManifestLoader {\n \n   delete(key: EntryKey) {\n     this.actionManifests.delete(key)\n-    this.appBuildManifests.delete(key)\n     this.appPathsManifests.delete(key)\n     this.buildManifests.delete(key)\n     this.clientBuildManifests.delete(key)\n@@ -252,36 +247,6 @@ export class TurbopackManifestLoader {\n     )\n   }\n \n-  loadAppBuildManifest(pageName: string): void {\n-    this.appBuildManifests.set(\n-      getEntryKey('app', 'server', pageName),\n-      readPartialManifest(this.distDir, APP_BUILD_MANIFEST, pageName, 'app')\n-    )\n-  }\n-\n-  private mergeAppBuildManifests(manifests: Iterable<AppBuildManifest>) {\n-    const manifest: AppBuildManifest = {\n-      pages: {},\n-    }\n-    for (const m of manifests) {\n-      Object.assign(manifest.pages, m.pages)\n-    }\n-    manifest.pages = sortObjectByKey(manifest.pages)\n-    return manifest\n-  }\n-\n-  private writeAppBuildManifest(): void {\n-    const appBuildManifest = this.mergeAppBuildManifests(\n-      this.appBuildManifests.values()\n-    )\n-    const appBuildManifestPath = join(this.distDir, APP_BUILD_MANIFEST)\n-    deleteCache(appBuildManifestPath)\n-    writeFileAtomic(\n-      appBuildManifestPath,\n-      JSON.stringify(appBuildManifest, null, 2)\n-    )\n-  }\n-\n   loadAppPathsManifest(pageName: string): void {\n     this.appPathsManifests.set(\n       getEntryKey('app', 'server', pageName),\n@@ -765,7 +730,6 @@ export class TurbopackManifestLoader {\n     entrypoints: Entrypoints\n   }): void {\n     this.writeActionManifest()\n-    this.writeAppBuildManifest()\n     this.writeAppPathsManifest()\n     this.writeBuildManifest(entrypoints, devRewrites, productionRewrites)\n     this.writeFallbackBuildManifest()"
        },
        {
            "sha": "058c7ac3cc89d694a62c1dceec39b119063b5cb6",
            "filename": "test/e2e/app-dir/app-alias/app-alias.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 24,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fapp-alias%2Fapp-alias.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fapp-alias%2Fapp-alias.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-alias%2Fapp-alias.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -1,7 +1,7 @@\n import { nextTestSetup } from 'e2e-utils'\n \n describe('app-dir alias', () => {\n-  const { next, isNextStart, skipped } = nextTestSetup({\n+  const { next, skipped } = nextTestSetup({\n     files: __dirname,\n     skipDeployment: true,\n   })\n@@ -22,27 +22,4 @@ describe('app-dir alias', () => {\n       .getComputedCss('font-size')\n     expect(fontSize).toBe('50px')\n   })\n-\n-  if (isNextStart) {\n-    it('should not contain installed react/react-dom version in client chunks', async () => {\n-      const appBuildManifest = await next.readJSON(\n-        '.next/app-build-manifest.json'\n-      )\n-      Object.keys(appBuildManifest.pages).forEach((page) => {\n-        const containFrameworkChunk = appBuildManifest.pages[page].some(\n-          (chunk) => {\n-            return chunk.includes('framework')\n-          }\n-        )\n-        expect(containFrameworkChunk).toBe(false)\n-      })\n-    })\n-\n-    it('should generate app-build-manifest correctly', async () => {\n-      // Remove other page CSS files:\n-      const manifest = await next.readJSON('.next/app-build-manifest.json')\n-\n-      expect(manifest.pages).not.toBeEmptyObject()\n-    })\n-  }\n })"
        },
        {
            "sha": "73944cedf0702d05b1ba151e8cd3f54238e687e8",
            "filename": "test/e2e/app-dir/app/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -79,14 +79,6 @@ describe('app dir - basic', () => {\n   }\n \n   if (isNextStart && !process.env.NEXT_EXPERIMENTAL_COMPILE) {\n-    if (!process.env.NEXT_EXPERIMENTAL_COMPILE) {\n-      it('should have correct size in build output', async () => {\n-        expect(next.cliOutput).toMatch(\n-          /\\/dashboard\\/another.*? *?[^0]\\d{1,} [\\w]{1,}B/\n-        )\n-      })\n-    }\n-\n     it('should have correct preferredRegion values in manifest', async () => {\n       const middlewareManifest = JSON.parse(\n         await next.readFile('.next/server/middleware-manifest.json')"
        },
        {
            "sha": "8ba5e5e5115e2029a8db6fa163c2622197a96316",
            "filename": "test/e2e/app-dir/build-size/app/foo/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Ffoo%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Ffoo%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Ffoo%2Fpage.tsx?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,14 +0,0 @@\n-'use client'\n-import React from 'react'\n-import styles from '../../styles/index.module.css'\n-\n-export default function Page() {\n-  return (\n-    <>\n-      <p id=\"hello\" className={styles.content}>\n-        hello from /foo\n-      </p>\n-      <p id=\"react-version\">{React.version}</p>\n-    </>\n-  )\n-}"
        },
        {
            "sha": "a14e64fcd5e33e9399d0e823434b0ab3095d5b75",
            "filename": "test/e2e/app-dir/build-size/app/layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Flayout.tsx?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,16 +0,0 @@\n-export const metadata = {\n-  title: 'Next.js',\n-  description: 'Generated by Next.js',\n-}\n-\n-export default function RootLayout({\n-  children,\n-}: {\n-  children: React.ReactNode\n-}) {\n-  return (\n-    <html lang=\"en\">\n-      <body>{children}</body>\n-    </html>\n-  )\n-}"
        },
        {
            "sha": "500df780314fb0cf0453fef595714e90df9913fb",
            "filename": "test/e2e/app-dir/build-size/app/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fapp%2Fpage.tsx?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,13 +0,0 @@\n-import React from 'react'\n-import styles from '../styles/index.module.css'\n-\n-export default function Page() {\n-  return (\n-    <>\n-      <p id=\"hello\" className={styles.content}>\n-        hello from /\n-      </p>\n-      <p id=\"react-version\">{React.version}</p>\n-    </>\n-  )\n-}"
        },
        {
            "sha": "c69d2b63868a676bc745d63164228a60aba6b4c5",
            "filename": "test/e2e/app-dir/build-size/index.test.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Findex.test.ts?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,50 +0,0 @@\n-import { nextTestSetup } from 'e2e-utils'\n-\n-describe('app-dir build size', () => {\n-  const { next, isNextStart, skipped } = nextTestSetup({\n-    files: __dirname,\n-    skipDeployment: true,\n-  })\n-\n-  if (skipped) {\n-    return\n-  }\n-\n-  if (isNextStart) {\n-    it('should have correct size in build output', async () => {\n-      const regex = /(\\S+)\\s+([\\d.]+\\s\\w+)\\s+([\\d.]+\\s\\w+)/g\n-      const matches = [...next.cliOutput.matchAll(regex)]\n-\n-      const result = matches.reduce((acc, match) => {\n-        const [, path, size, firstLoadJS] = match\n-\n-        acc[path] = { size, firstLoadJS }\n-        return acc\n-      }, {})\n-\n-      // convert pretty-bytes format into bytes so we can compare units\n-      const sizeToBytes = (size: string) => {\n-        const units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n-        const [value, unit] = size.split(' ', 2)\n-        const exp = units.indexOf(unit)\n-        return parseFloat(value) * Math.pow(1024, exp)\n-      }\n-\n-      const index = result['/']\n-      const foo = result['/foo']\n-\n-      expect(sizeToBytes(index.firstLoadJS)).toBeGreaterThan(0)\n-      expect(sizeToBytes(foo.firstLoadJS)).toBeGreaterThan(0)\n-\n-      // index route is a page with no client JS, so it could serve zero additional JS (size = 0)\n-      // foo route is a page with client references, so it has to serve additional non-shared JS\n-      expect(sizeToBytes(foo.size)).toBeGreaterThan(0)\n-\n-      // foo has a client component, so it should be larger than index\n-      expect(sizeToBytes(foo.size)).toBeGreaterThan(sizeToBytes(index.size))\n-    })\n-  } else {\n-    it('should skip next dev for now', () => {})\n-    return\n-  }\n-})"
        },
        {
            "sha": "dccdb6cb678f8319774b81759ba2a3e9d75b2f29",
            "filename": "test/e2e/app-dir/build-size/styles/index.module.css",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fstyles%2Findex.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/0f27700f3df6604215993cdbbeb8681ec19d42e2/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fstyles%2Findex.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fbuild-size%2Fstyles%2Findex.module.css?ref=0f27700f3df6604215993cdbbeb8681ec19d42e2",
            "patch": "@@ -1,3 +0,0 @@\n-.content {\n-  color: blueviolet;\n-}"
        },
        {
            "sha": "dcf0b6b438ba71cef8d1a4996d6d152dec242b53",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-errors.module-scope.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.module-scope.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.module-scope.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.module-scope.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -23,10 +23,10 @@ describe('Lazy Module Init', () => {\n       throw new Error('expected build not to fail for fully static project')\n     }\n \n-    expect(next.cliOutput).toContain('○ /server ')\n-    expect(next.cliOutput).toContain('○ /client ')\n-    expect(next.cliOutput).toContain('◐ /client-page ')\n-    expect(next.cliOutput).toContain('◐ /[dyn] ')\n+    expect(next.cliOutput).toContain('○ /server')\n+    expect(next.cliOutput).toContain('○ /client')\n+    expect(next.cliOutput).toContain('◐ /client-page')\n+    expect(next.cliOutput).toContain('◐ /[dyn]')\n     let $\n \n     $ = await next.render$('/server')"
        },
        {
            "sha": "ed0f9199c7676beda090c8ca235791c5030b8ddc",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-errors.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -848,7 +848,7 @@ describe('Cache Components Errors', () => {\n             throw new Error('expected build not to fail', { cause: error })\n           }\n \n-          expect(next.cliOutput).toContain(`◐ ${pathname} `)\n+          expect(next.cliOutput).toContain(`◐ ${pathname}`)\n           await next.start({ skipBuild: true })\n           const $ = await next.render$(pathname)\n           expect($('[data-fallback]').length).toBe(2)\n@@ -1124,7 +1124,7 @@ describe('Cache Components Errors', () => {\n               throw new Error('expected build not to fail', { cause: error })\n             }\n \n-            expect(next.cliOutput).toContain(`◐ ${pathname} `)\n+            expect(next.cliOutput).toContain(`◐ ${pathname}`)\n             await next.start({ skipBuild: true })\n             const browser = await next.browser(`${pathname}?foo=test`)\n             expect(await browser.elementById('foo-param').text()).toBe(\n@@ -1176,7 +1176,7 @@ describe('Cache Components Errors', () => {\n               throw new Error('expected build not to fail', { cause: error })\n             }\n \n-            expect(next.cliOutput).toContain(`◐ ${pathname} `)\n+            expect(next.cliOutput).toContain(`◐ ${pathname}`)\n             await next.start({ skipBuild: true })\n             const browser = await next.browser(`${pathname}?foo=test`)\n             expect(await browser.elementById('foo-param').text()).toBe(\n@@ -1564,7 +1564,7 @@ describe('Cache Components Errors', () => {\n               throw new Error('expected build not to fail', { cause: error })\n             }\n \n-            expect(next.cliOutput).toContain(`◐ ${pathname} `)\n+            expect(next.cliOutput).toContain(`◐ ${pathname}`)\n             await next.start({ skipBuild: true })\n             const browser = await next.browser(`${pathname}`)\n             expect(await browser.elementById('draft-mode').text()).toBe(\n@@ -1936,7 +1936,7 @@ describe('Cache Components Errors', () => {\n               throw new Error('expected build not to fail', { cause: error })\n             }\n \n-            expect(next.cliOutput).toContain(`◐ ${pathname}/[slug] `)\n+            expect(next.cliOutput).toContain(`◐ ${pathname}/[slug]`)\n             await next.start({ skipBuild: true })\n             const browser = await next.browser(`${pathname}/test`)\n             expect(await browser.elementById('param').text()).toBe('undefined')\n@@ -1984,7 +1984,7 @@ describe('Cache Components Errors', () => {\n               throw new Error('expected build not to fail', { cause: error })\n             }\n \n-            expect(next.cliOutput).toContain(`◐ ${pathname}/[slug] `)\n+            expect(next.cliOutput).toContain(`◐ ${pathname}/[slug]`)\n             await next.start({ skipBuild: true })\n             const browser = await next.browser(`${pathname}/test`)\n             expect(await browser.elementById('param').text()).toBe('undefined')"
        },
        {
            "sha": "597020f4e433be61cd091c22f4c74a25a01b54bb",
            "filename": "test/integration/build-output/test/index.test.js",
            "status": "modified",
            "additions": 8,
            "deletions": 19,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Fbuild-output%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Fbuild-output%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fbuild-output%2Ftest%2Findex.test.js?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -45,10 +45,7 @@ describe('Build Output', () => {\n           }\n \n           it('should not include internal pages', async () => {\n-            expect(stdout).toMatch(/\\/ (.* )?\\d{1,} k?B/)\n-            expect(stdout).toMatch(/\\+ First Load JS shared by all [ 0-9.]* kB/)\n-            expect(stdout).toMatch(/ chunks\\/.*\\.js [ 0-9.]* kB/)\n-            expect(stdout).toMatch(/ chunks\\/.*\\.js [ 0-9. ]* kB/)\n+            expect(stdout).toMatch(/\\//)\n \n             expect(stdout).not.toContain(' /_document')\n             expect(stdout).not.toContain(' /_app')\n@@ -206,10 +203,8 @@ describe('Build Output', () => {\n             stdout: true,\n           })\n \n-          expect(stdout).toMatch(/\\/ (.* )?\\d{1,} k?B/)\n-          expect(stdout).toMatch(/\\/_app (.* )?\\d{1,} k?B/)\n-          expect(stdout).toMatch(/\\+ First Load JS shared by all \\s*[0-9.]+ kB/)\n-          expect(stdout).toMatch(/ chunks\\/.*\\.js \\s*[0-9.]+ kB/)\n+          expect(stdout).toMatch(/\\//)\n+          expect(stdout).toMatch(/\\/_app/)\n \n           expect(stdout).not.toContain(' /_document')\n           expect(stdout).not.toContain(' /_error')\n@@ -235,13 +230,9 @@ describe('Build Output', () => {\n               stdout: true,\n             })\n \n-            expect(stdout).toMatch(/\\/ (.* )?[0-9.]+ k?B \\s*[0-9.]+ kB/)\n+            expect(stdout).toMatch(/\\//)\n             expect(stdout).toMatch(/\\/amp (.* )?AMP/)\n-            expect(stdout).toMatch(/\\/hybrid (.* )?[0-9.]+ k?B/)\n-            expect(stdout).toMatch(\n-              /\\+ First Load JS shared by all \\s*[0-9.]+ kB/\n-            )\n-            expect(stdout).toMatch(/ chunks\\/.*\\.js \\s*[0-9.]+ kB/)\n+            expect(stdout).toMatch(/\\/hybrid (.* )?/)\n \n             expect(stdout).not.toContain(' /_document')\n             expect(stdout).not.toContain(' /_error')\n@@ -264,10 +255,8 @@ describe('Build Output', () => {\n             stdout: true,\n           })\n \n-          expect(stdout).toMatch(/\\/ (.* )?\\d{1,} k?B/)\n-          expect(stdout).toMatch(/ƒ \\/404 (.* )?\\d{1,} k?B/)\n-          expect(stdout).toMatch(/\\+ First Load JS shared by all [ 0-9.]* kB/)\n-          expect(stdout).toMatch(/ chunks\\/.*\\.js [ 0-9.]* kB/)\n+          expect(stdout).toMatch(/\\//)\n+          expect(stdout).toMatch(/ƒ \\/404/)\n \n           expect(stdout).not.toContain(' /_document')\n           expect(stdout).not.toContain(' /_app')\n@@ -303,7 +292,7 @@ describe('Build Output', () => {\n             stdout: true,\n           })\n \n-          expect(stdout.match(/○ \\/root-page /g).length).toBe(1)\n+          expect(stdout.match(/○ \\/root-page/g).length).toBe(1)\n         })\n       })\n     }"
        },
        {
            "sha": "78ae22d02790ef595b460cb7b10508dbf6b9f565",
            "filename": "test/integration/css-modules/test/index.test.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -43,7 +43,6 @@ describe('Basic CSS Module Support', () => {\n       it('should have compiled successfully', () => {\n         expect(code).toBe(0)\n         expect(stdout).toMatch(/Compiled successfully/)\n-        expect(stdout).toContain('.css')\n       })\n \n       it(`should've emitted a single CSS file`, async () => {"
        },
        {
            "sha": "635607d228f78480185b814040e965a3585017cf",
            "filename": "test/integration/fallback-modules/test/index.test.js",
            "status": "modified",
            "additions": 31,
            "deletions": 28,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Ffallback-modules%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fintegration%2Ffallback-modules%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ffallback-modules%2Ftest%2Findex.test.js?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -3,16 +3,15 @@\n import { remove } from 'fs-extra'\n import { nextBuild } from 'next-test-utils'\n import { join } from 'path'\n+import { readFileSync, statSync } from 'fs'\n \n const fixturesDir = join(__dirname, '..', 'fixtures')\n-const isRspack = process.env.NEXT_RSPACK !== undefined\n \n describe('Fallback Modules', () => {\n   ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n     'production mode',\n     () => {\n       describe('Crypto Application', () => {\n-        let stdout\n         const appDir = join(fixturesDir, 'with-crypto')\n \n         beforeAll(async () => {\n@@ -24,40 +23,44 @@ describe('Fallback Modules', () => {\n             return\n           }\n \n-          ;({ stdout } = await nextBuild(appDir, [], {\n+          await nextBuild(appDir, [], {\n             stdout: true,\n-          }))\n+          })\n \n-          console.log(stdout)\n+          // Read build manifest to get chunk files for the index page\n+          const buildManifestPath = join(appDir, '.next', 'build-manifest.json')\n+          const buildManifest = JSON.parse(\n+            readFileSync(buildManifestPath, 'utf8')\n+          )\n \n-          const parsePageSize = (page) =>\n-            stdout.match(\n-              new RegExp(` ${page} .*?((?:\\\\d|\\\\.){1,} (?:\\\\w{1,})) `)\n-            )[1]\n+          // Get chunks for the '/' page\n+          const indexPageChunks = buildManifest.pages['/'] || []\n \n-          const parsePageFirstLoad = (page) =>\n-            stdout.match(\n-              new RegExp(\n-                ` ${page} .*?(?:(?:\\\\d|\\\\.){1,}) .*? ((?:\\\\d|\\\\.){1,} (?:\\\\w{1,}))`\n-              )\n-            )[1]\n+          // Calculate total size of all chunks for the index page\n+          let totalSize = 0\n+          for (const chunkPath of indexPageChunks) {\n+            const fullChunkPath = join(appDir, '.next', chunkPath)\n+            try {\n+              const stats = statSync(fullChunkPath)\n+              totalSize += stats.size\n+            } catch (error) {\n+              console.warn(`Could not read chunk: ${chunkPath}`, error.message)\n+            }\n+          }\n \n-          const indexSize = parsePageSize('/')\n-          const indexFirstLoad = parsePageFirstLoad('/')\n+          // Convert to kB for easier comparison\n+          const totalSizeKB = totalSize / 1024\n \n-          // expect(parseFloat(indexSize)).toBeLessThanOrEqual(3.1)\n-          // expect(parseFloat(indexSize)).toBeGreaterThanOrEqual(2)\n+          console.log(`Index page total size: ${totalSizeKB.toFixed(2)} kB`)\n+          console.log(`Index page chunks: ${indexPageChunks.join(', ')}`)\n \n-          if (isRspack) {\n-            expect(indexSize.endsWith('B')).toBe(true)\n-            expect(indexSize.endsWith('MB')).toBe(false)\n-          } else {\n-            expect(indexSize.endsWith('kB')).toBe(true)\n-          }\n+          // Assert on reasonable size bounds\n+          // The total should be reasonable for a simple page without crypto\n+          expect(totalSizeKB).toBeGreaterThan(10) // At least 10kB (has some framework code)\n+          expect(totalSizeKB).toBeLessThan(400) // Less than 400kB (no large crypto libraries)\n \n-          // expect(parseFloat(indexFirstLoad)).toBeLessThanOrEqual(67.9)\n-          // expect(parseFloat(indexFirstLoad)).toBeGreaterThanOrEqual(60)\n-          expect(indexFirstLoad.endsWith('kB')).toBe(true)\n+          // Ensure we have the expected chunks\n+          expect(indexPageChunks.length).toBeGreaterThan(0)\n         })\n       })\n     }"
        },
        {
            "sha": "72e21cf8484470ea3e02689b141c7e5dc37e1485",
            "filename": "test/production/app-dir/actions-tree-shaking/client-actions-tree-shaking/client-actions-tree-shaking.test.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 7,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Factions-tree-shaking%2Fclient-actions-tree-shaking%2Fclient-actions-tree-shaking.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Factions-tree-shaking%2Fclient-actions-tree-shaking%2Fclient-actions-tree-shaking.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Factions-tree-shaking%2Fclient-actions-tree-shaking%2Fclient-actions-tree-shaking.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -2,6 +2,7 @@ import { promises as fs } from 'fs'\n import { join } from 'path'\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n+import { ClientReferenceManifest } from 'next/dist/build/webpack/plugins/flight-manifest-plugin'\n \n function getServerReferenceIdsFromBundle(source: string): string[] {\n   // Reference IDs are strings with [0-9a-f] that are at least 32 characters long.\n@@ -29,16 +30,54 @@ describe('app-dir - client-actions-tree-shaking', () => {\n     logs.length = 0\n   })\n \n+  /**\n+   * Parses the client reference manifest for a given route and returns the client chunks\n+   */\n+  function getClientChunks(appDir: string, route: string): Array<string> {\n+    const modulePath = require.resolve(\n+      join(appDir, `.next/server/app/${route}_client-reference-manifest.js`)\n+    )\n+    require(modulePath)\n+    const clientManfiest = globalThis.__RSC_MANIFEST[\n+      route\n+    ] as ClientReferenceManifest\n+    delete globalThis.__RSC_MANIFEST[route]\n+    delete require.cache[modulePath]\n+    const chunks = new Set<string>()\n+\n+    if (process.env.IS_TURBOPACK_TEST) {\n+      // These only exist for turbopack and are encoded as files\n+      // entryJSFiles is a map of moduel name to a set of chunks relative to `.next`\n+      for (const entries of Object.values(clientManfiest.entryJSFiles)) {\n+        for (const chunk of entries) {\n+          chunks.add(chunk)\n+        }\n+      }\n+      // client mmodules is a mapping from module name to a set of chunks releative to `/_next/`\n+      // So strip that prefix and add it to the chunks\n+      for (const clientModule of Object.values(clientManfiest.clientModules)) {\n+        for (const chunk of clientModule.chunks) {\n+          chunks.add(chunk.replace('/_next/', ''))\n+        }\n+      }\n+    } else {\n+      // webpack doens't use entryJSFiles, so we need to use clientModules but the format is different.\n+      // chunks is a sequence of 'chunk-id', chunk-path pairs, so we need to skip the chunk-id\n+      for (const clientModule of Object.values(clientManfiest.clientModules)) {\n+        for (let i = 1; i < clientModule.chunks.length; i += 2) {\n+          chunks.add(clientModule.chunks[i])\n+        }\n+      }\n+    }\n+    return Array.from(chunks)\n+  }\n+\n   it('should not bundle unused server reference id in client bundles', async () => {\n     const appDir = next.testDir\n \n-    const appBuildManifest = require(\n-      join(appDir, '.next/app-build-manifest.json')\n-    )\n-\n-    const bundle1Files = appBuildManifest.pages['/route-1/page']\n-    const bundle2Files = appBuildManifest.pages['/route-2/page']\n-    const bundle3Files = appBuildManifest.pages['/route-3/page']\n+    const bundle1Files = getClientChunks(appDir, '/route-1/page')\n+    const bundle2Files = getClientChunks(appDir, '/route-2/page')\n+    const bundle3Files = getClientChunks(appDir, '/route-3/page')\n \n     const bundle1Contents = await Promise.all(\n       bundle1Files.map((file: string) =>"
        },
        {
            "sha": "ed1fc5d889abc77a0b8f13033c50931105ccafb1",
            "filename": "test/production/app-dir/build-output-tree-view/build-output-tree-view.test.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 27,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Fbuild-output-tree-view%2Fbuild-output-tree-view.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Fbuild-output-tree-view%2Fbuild-output-tree-view.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-tree-view%2Fbuild-output-tree-view.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -15,27 +15,25 @@ describe('build-output-tree-view', () => {\n \n     it('should show info about prerendered and dynamic routes in a tree view', async () => {\n       expect(getTreeView(next.cliOutput)).toMatchInlineSnapshot(`\n-       \"Route (app)                      Size  First Load JS  Revalidate  Expire\n-       ┌ ○ /_not-found                N/A kB         N/A kB\n-       ├ ƒ /api                       N/A kB         N/A kB\n-       ├ ○ /api/force-static          N/A kB         N/A kB\n-       ├ ○ /app-static                N/A kB         N/A kB\n-       ├ ○ /cache-life-custom         N/A kB         N/A kB         ≈7m     ≈2h\n-       ├ ○ /cache-life-hours          N/A kB         N/A kB          1h      1d\n-       ├ ƒ /dynamic                   N/A kB         N/A kB\n-       ├ ◐ /ppr/[slug]                N/A kB         N/A kB          1w     30d\n-       ├   ├ /ppr/[slug]                                             1w     30d\n-       ├   ├ /ppr/days                                               1d      1w\n-       ├   └ /ppr/weeks                                              1w     30d\n-       └ ○ /revalidate                N/A kB         N/A kB         15m      1y\n-       + First Load JS shared by all  N/A kB\n+       \"Route (app)             Revalidate  Expire\n+       ┌ ○ /_not-found\n+       ├ ƒ /api\n+       ├ ○ /api/force-static\n+       ├ ○ /app-static\n+       ├ ○ /cache-life-custom         ≈7m     ≈2h\n+       ├ ○ /cache-life-hours           1h      1d\n+       ├ ƒ /dynamic\n+       ├ ◐ /ppr/[slug]                 1w     30d\n+       ├   ├ /ppr/[slug]                       1w  30d\n+       ├   ├ /ppr/days                         1d   1w\n+       ├   └ /ppr/weeks                        1w  30d\n+       └ ○ /revalidate                15m      1y\n \n-       Route (pages)                    Size  First Load JS  Revalidate  Expire\n-       ┌ ƒ /api/hello                 N/A kB         N/A kB\n-       ├ ● /gsp-revalidate            N/A kB         N/A kB          5m      1y\n-       ├ ƒ /gssp                      N/A kB         N/A kB\n-       └ ○ /static                    N/A kB         N/A kB\n-       + First Load JS shared by all  N/A kB\n+       Route (pages)           Revalidate  Expire\n+       ┌ ƒ /api/hello\n+       ├ ● /gsp-revalidate             5m      1y\n+       ├ ƒ /gssp\n+       └ ○ /static\n \n        ○  (Static)             prerendered as static content\n        ●  (SSG)                prerendered as static HTML (uses generateStaticParams)\n@@ -58,14 +56,12 @@ describe('build-output-tree-view', () => {\n \n     it('should show info about prerendered routes in a compact tree view', async () => {\n       expect(getTreeView(next.cliOutput)).toMatchInlineSnapshot(`\n-       \"Route (app)                      Size  First Load JS\n-       ┌ ○ /                          N/A kB         N/A kB\n-       └ ○ /_not-found                N/A kB         N/A kB\n-       + First Load JS shared by all  N/A kB\n+       \"Route (app)\n+       ┌ ○ /\n+       └ ○ /_not-found\n \n-       Route (pages)                    Size  First Load JS\n-       ─ ○ /static                    N/A kB         N/A kB\n-       + First Load JS shared by all  N/A kB\n+       Route (pages)\n+       ─ ○ /static\n \n        ○  (Static)  prerendered as static content\"\n       `)"
        },
        {
            "sha": "042e7399ca2980e30f97e5ae2d6ee29f9cfee7a5",
            "filename": "test/production/app-dir/build-output/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output%2Findex.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -31,11 +31,6 @@ describe('production - app dir - build output', () => {\n   })\n \n   it('should match the expected output format', async () => {\n-    expect(output).toContain('Size')\n-    expect(output).toContain('First Load JS')\n-    expect(output).toContain('+ First Load JS shared by all')\n-    expect(output).toContain('└ other shared chunks (total)')\n-\n     // output type\n     expect(output).toContain('○  (Static)  prerendered as static content')\n   })"
        },
        {
            "sha": "e8f5e37621fec4d58d269fb724396b74ab7362b1",
            "filename": "test/production/disable-fallback-polyfills/index.test.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 7,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fdisable-fallback-polyfills%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/18e7c84af25c69c7807026a9044819ace1780abb/test%2Fproduction%2Fdisable-fallback-polyfills%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fdisable-fallback-polyfills%2Findex.test.ts?ref=18e7c84af25c69c7807026a9044819ace1780abb",
            "patch": "@@ -1,16 +1,36 @@\n import { createNext } from 'e2e-utils'\n-import { NextInstance } from 'e2e-utils'\n+import type { NextInstance } from 'e2e-utils'\n+import { statSync } from 'fs'\n+import { join } from 'path'\n \n // TODO: Implement experimental.fallbackNodePolyfills\n ;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n   'Disable fallback polyfills',\n   () => {\n     let next: NextInstance\n \n-    function getFirstLoadSize(output: string) {\n-      const firstLoadRe =\n-        /○ \\/.*? (?<size>\\d.*?) [^\\d]{2} (?<firstLoad>\\d.*?) [^\\d]{2}/\n-      return Number(output.match(firstLoadRe).groups.firstLoad)\n+    async function getIndexPageSize() {\n+      // Read build manifest to get chunk files for the index page\n+      // this only works reliably for pages router and simple examples.\n+      const buildManifest = await next.readJSON('.next/build-manifest.json')\n+\n+      // Get chunks for the '/' page\n+      const indexPageChunks = buildManifest.pages['/'] || []\n+\n+      // Calculate total size of all chunks for the index page\n+      let totalSize = 0\n+      for (const chunkPath of indexPageChunks) {\n+        const fullChunkPath = join(next.testDir, '.next', chunkPath)\n+        try {\n+          const stats = statSync(fullChunkPath)\n+          totalSize += stats.size\n+        } catch (error) {\n+          console.warn(`Could not read chunk: ${chunkPath}`, error.message)\n+        }\n+      }\n+\n+      // Convert to kB for easier comparison\n+      return totalSize / 1024\n     }\n \n     beforeAll(async () => {\n@@ -37,7 +57,11 @@ import { NextInstance } from 'e2e-utils'\n     afterAll(() => next.destroy())\n \n     it('Fallback polyfills added by default', async () => {\n-      expect(getFirstLoadSize(next.cliOutput)).not.toBeLessThan(200)\n+      const indexPageSizeKB = await getIndexPageSize()\n+      console.log(\n+        `Index page size (with polyfills): ${indexPageSizeKB.toFixed(2)} kB`\n+      )\n+      expect(indexPageSizeKB).not.toBeLessThan(400)\n     })\n \n     it('Reduced bundle size when polyfills are disabled', async () => {\n@@ -52,7 +76,11 @@ import { NextInstance } from 'e2e-utils'\n       await next.start()\n       await next.stop()\n \n-      expect(getFirstLoadSize(next.cliOutput)).toBeLessThan(200)\n+      const indexPageSizeKB = await getIndexPageSize()\n+      console.log(\n+        `Index page size (without polyfills): ${indexPageSizeKB.toFixed(2)} kB`\n+      )\n+      expect(indexPageSizeKB).toBeLessThan(400)\n     })\n \n     it('Pass build without error if non-polyfilled module is unreachable', async () => {"
        }
    ],
    "stats": {
        "total": 1129,
        "additions": 179,
        "deletions": 950
    }
}