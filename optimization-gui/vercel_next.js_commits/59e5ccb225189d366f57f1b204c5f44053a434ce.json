{
    "author": "msabramo",
    "message": "[development-server] Display pid of already-running process that is using port (#80069)",
    "sha": "59e5ccb225189d366f57f1b204c5f44053a434ce",
    "files": [
        {
            "sha": "b66754c9d9ef94b518378edfc5c2d6ac0936eb28",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/59e5ccb225189d366f57f1b204c5f44053a434ce/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/59e5ccb225189d366f57f1b204c5f44053a434ce/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=59e5ccb225189d366f57f1b204c5f44053a434ce",
            "patch": "@@ -710,5 +710,6 @@\n   \"709\": \"`rspack.getModuleNamedExports` is not supported by the wasm bindings.\",\n   \"710\": \"Unable to remove an invalidated webpack cache. If this issue persists you can work around it by deleting %s\",\n   \"711\": \"Can't resolve %s\",\n-  \"712\": \"`rspack.warnForEdgeRuntime` is not supported by the wasm bindings.\"\n+  \"712\": \"`rspack.warnForEdgeRuntime` is not supported by the wasm bindings.\",\n+  \"713\": \"Unexpected error during process lookup\"\n }"
        },
        {
            "sha": "d2183f2a53e252c7ec3c70cb31be0c19eec4ebc2",
            "filename": "packages/next/src/server/lib/start-server.ts",
            "status": "modified",
            "additions": 78,
            "deletions": 3,
            "changes": 81,
            "blob_url": "https://github.com/vercel/next.js/blob/59e5ccb225189d366f57f1b204c5f44053a434ce/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/59e5ccb225189d366f57f1b204c5f44053a434ce/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts?ref=59e5ccb225189d366f57f1b204c5f44053a434ce",
            "patch": "@@ -16,6 +16,7 @@ import path from 'path'\n import http from 'http'\n import https from 'https'\n import os from 'os'\n+import { exec } from 'child_process'\n import Watchpack from 'next/dist/compiled/watchpack'\n import * as Log from '../../build/output/log'\n import setupDebug from 'next/dist/compiled/debug'\n@@ -38,6 +39,73 @@ import type { ConfiguredExperimentalFeature } from '../config'\n const debug = setupDebug('next:start-server')\n let startServerSpan: Span | undefined\n \n+/**\n+ * Get the process ID (PID) of the process using the specified port\n+ */\n+async function getProcessIdUsingPort(port: number): Promise<string | null> {\n+  const timeoutMs = 250\n+  const processLookupController = new AbortController()\n+\n+  const pidPromise = new Promise<string | null>((resolve) => {\n+    const handleError = (error: Error) => {\n+      debug('Failed to get process ID for port', port, error)\n+      resolve(null)\n+    }\n+\n+    try {\n+      // Use lsof on Unix-like systems (macOS, Linux)\n+      if (process.platform !== 'win32') {\n+        exec(\n+          `lsof -ti:${port}`,\n+          { signal: processLookupController.signal },\n+          (error, stdout) => {\n+            if (error) {\n+              handleError(error)\n+              return\n+            }\n+            const pid = stdout.trim()\n+            resolve(pid || null)\n+          }\n+        )\n+      } else {\n+        // Use netstat on Windows\n+        exec(\n+          `netstat -ano | findstr /C:\":${port} \" | findstr LISTENING`,\n+          { signal: processLookupController.signal },\n+          (error, stdout) => {\n+            if (error) {\n+              handleError(error)\n+              return\n+            }\n+            const lines = stdout.trim().split('\\n')\n+            if (lines.length > 0) {\n+              const parts = lines[0].trim().split(/\\s+/)\n+              const pid = parts[parts.length - 1]\n+              resolve(pid || null)\n+            } else {\n+              resolve(null)\n+            }\n+          }\n+        )\n+      }\n+    } catch (cause) {\n+      handleError(\n+        new Error('Unexpected error during process lookup', { cause })\n+      )\n+    }\n+  })\n+\n+  const timeoutId = setTimeout(() => {\n+    processLookupController.abort(\n+      `PID detection timed out after ${timeoutMs}ms for port ${port}.`\n+    )\n+  }, timeoutMs)\n+\n+  pidPromise.finally(() => clearTimeout(timeoutId))\n+\n+  return pidPromise\n+}\n+\n export interface StartServerOptions {\n   dir: string\n   port: number\n@@ -244,9 +312,16 @@ export async function startServer(\n       port = typeof addr === 'object' ? addr?.port || port : port\n \n       if (portRetryCount) {\n-        Log.warn(\n-          `Port ${originalPort} is in use, using available port ${port} instead.`\n-        )\n+        const pid = await getProcessIdUsingPort(originalPort)\n+        if (pid) {\n+          Log.warn(\n+            `Port ${originalPort} is in use by process ${pid}, using available port ${port} instead.`\n+          )\n+        } else {\n+          Log.warn(\n+            `Port ${originalPort} is in use by an unknown process, using available port ${port} instead.`\n+          )\n+        }\n       }\n \n       const networkHostname ="
        },
        {
            "sha": "b373b9a76bb374acd7363e614455d9f1e829e721",
            "filename": "test/integration/cli/test/index.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/59e5ccb225189d366f57f1b204c5f44053a434ce/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/59e5ccb225189d366f57f1b204c5f44053a434ce/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js?ref=59e5ccb225189d366f57f1b204c5f44053a434ce",
            "patch": "@@ -680,7 +680,7 @@ describe('CLI Usage', () => {\n       }\n \n       expect(output).toMatch(\n-        '⚠ Port 3000 is in use, using available port 3001 instead.'\n+        '⚠ Port 3000 is in use by an unknown process, using available port 3001 instead.'\n       )\n     })\n "
        }
    ],
    "stats": {
        "total": 86,
        "additions": 81,
        "deletions": 5
    }
}