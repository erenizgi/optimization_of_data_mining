{
    "author": "kachkaev",
    "message": "Allow headers, rewrites and redirects to be defined as sync functions (#83743)\n\n### What and why?\n\nTypings in `NextConfig` make us specify `headers`, `rewrites` and\n`redirects` as $${\\color{red}async}$$ functions. Doing so is needed even\nif the result is known straight away, without having to call async IO.\n\nThis tight requirement requirement creates a small but recurring\nfriction point in new Next.js projects. Even though passing a\n$${\\color{blue}sync}$$ function is technically valid, it is necessary to\nprefix it with `async` keyword to make `tsc` happy.\n\nI use\n[`@typescript-eslint/require-await`](https://typescript-eslint.io/rules/require-await/)\nwhich is included in\n[`@typescript-eslint/recommended-type-checked`](https://typescript-eslint.io/users/configs/#recommended-type-checked)\npreset. Because sync functions are not allowed in `headers`, `rewrites`\nand `redirects`, I have to add `async` and then `//\neslint-disable-next-line` above it:\n\n```ts\nconst nextConfig: NextConfig = {\n  // ... rest of the config ...\n  \n  // eslint-disable-next-line @typescript-eslint/require-await -- External API requires async\n  redirects: async () => {\n    return [\n      {\n        source: \"/example\",\n        destination: \"/\",\n        permanent: true,\n      },\n    ];\n  },\n};\n```\n\n### How?\n\nJust replacing `foo?: () Promise<Foo>` with `foo?: () Promise<Foo> |\nFoo` does the job. With Next 16.0.0 on the horizon, it looks like the\nright opportunity to tweak the typings. It's a non-breaking change for\neveryone except folks who have to silence\n`@typescript-eslint/require-await`.\n\n### Context\n\nSome config options already use `Promise<Foo> | Foo`:\n\n\nhttps://github.com/vercel/next.js/blob/7396d7eb5907a2e9078a01a38a350819a8309b83/packages/next/src/server/config-shared.ts#L881-L890\n\n\nhttps://github.com/vercel/next.js/blob/7396d7eb5907a2e9078a01a38a350819a8309b83/packages/next/src/server/config-shared.ts#L1014-L1017\n\nJudging from [`git blame` for\n`config-shared.ts`](https://github.com/vercel/next.js/blame/7396d7eb5907a2e9078a01a38a350819a8309b83/packages/next/src/server/config-shared.ts),\nthis inconsistency appears to be a historic artifact rather than\nsomething designed.\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "9c9456906b8bc0c48b47969ae81275736c196570",
    "files": [
        {
            "sha": "295034b8016f7772f4e4aeef3b91964064efea8e",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/9c9456906b8bc0c48b47969ae81275736c196570/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9c9456906b8bc0c48b47969ae81275736c196570/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=9c9456906b8bc0c48b47969ae81275736c196570",
            "patch": "@@ -920,28 +920,35 @@ export interface NextConfig extends Record<string, any> {\n    *\n    * @see [Headers configuration documentation](https://nextjs.org/docs/app/api-reference/config/next-config-js/headers)\n    */\n-  headers?: () => Promise<Header[]>\n+  headers?: () => Promise<Header[]> | Header[]\n \n   /**\n    * Rewrites allow you to map an incoming request path to a different destination path.\n    *\n    * @see [Rewrites configuration documentation](https://nextjs.org/docs/app/api-reference/config/next-config-js/rewrites)\n    */\n-  rewrites?: () => Promise<\n+  rewrites?: () =>\n+    | Promise<\n+        | Rewrite[]\n+        | {\n+            beforeFiles?: Rewrite[]\n+            afterFiles?: Rewrite[]\n+            fallback?: Rewrite[]\n+          }\n+      >\n     | Rewrite[]\n     | {\n         beforeFiles?: Rewrite[]\n         afterFiles?: Rewrite[]\n         fallback?: Rewrite[]\n       }\n-  >\n \n   /**\n    * Redirects allow you to redirect an incoming request path to a different destination path.\n    *\n    * @see [Redirects configuration documentation](https://nextjs.org/docs/app/api-reference/config/next-config-js/redirects)\n    */\n-  redirects?: () => Promise<Redirect[]>\n+  redirects?: () => Promise<Redirect[]> | Redirect[]\n \n   /**\n    * @see [Moment.js locales excluded by default](https://nextjs.org/docs/upgrading#momentjs-locales-excluded-by-default)"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
    }
}