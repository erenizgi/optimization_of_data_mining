{
    "author": "huozhi",
    "message": "[metadata] clarify the default list behavior (#76450)",
    "sha": "6a5d6764b9d615d62fd95207e3ecf34139e07b3e",
    "files": [
        {
            "sha": "f318c7a3d2b2af6cf24e69ed583d36c7638594e5",
            "filename": "docs/01-app/04-api-reference/04-functions/generate-metadata.mdx",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx?ref=6a5d6764b9d615d62fd95207e3ecf34139e07b3e",
            "patch": "@@ -1208,13 +1208,16 @@ Some bots, like `Googlebot`, can execute JavaScript and are able to inspect the\n Next.js automatically detects the user agent of incoming requests to determine whether to serve streaming metadata or fallback to blocking metadata.\n \n If you need to customize this list, you can define them manually using the `htmlLimitedBots` option in `next.config.js`. Next.js will ensure user agents matching this regex receive blocking metadata when requesting your web page.\n+Specifying a `htmlLimitedBots` config will override the Next.js' default list, allowing you full control over what user agents should opt into this behavior. This is advanced behavior, and the default should be sufficient for most cases.\n \n ```js filename=\"next.config.js\"\n module.exports = {\n   htmlLimitedBots: 'MySpecialBot|MyAnotherSpecialBot|SimpleCrawler',\n }\n ```\n \n+> **Note:** Next.js includes [a default list of HTML limited bots](https://github.com/vercel/next.js/blob/canary/packages/next/src/shared/lib/router/utils/html-bots.ts)\n+\n ## Version History\n \n | Version   | Changes                                                                                                                                                 |"
        },
        {
            "sha": "6223225aa20ed1ae4669d00493ecc37f44f4b4ac",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=6a5d6764b9d615d62fd95207e3ecf34139e07b3e",
            "patch": "@@ -1071,6 +1071,9 @@ export interface NextConfig extends Record<string, any> {\n   /**\n    * User Agent of bots that can handle streaming metadata.\n    * Besides the default behavior, Next.js act differently on serving metadata to bots based on their capability.\n+   *\n+   * @default\n+   * /Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview/i\n    */\n   htmlLimitedBots?: RegExp\n }"
        },
        {
            "sha": "ea7407ba23a7136f108d924a60c6c215a4fe474d",
            "filename": "packages/next/src/shared/lib/router/utils/html-bots.ts",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts?ref=6a5d6764b9d615d62fd95207e3ecf34139e07b3e",
            "patch": "@@ -0,0 +1,4 @@\n+// This regex contains the bots that we need to do a blocking render for and can't safely stream the response\n+// due to how they parse the DOM. For example, they might explicitly check for metadata in the `head` tag, so we can't stream metadata tags after the `head` was sent.\n+export const HTML_LIMITED_BOT_UA_RE =\n+  /Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview/i"
        },
        {
            "sha": "6e5bace56da60690492ac08a57aa26c45e3dfc15",
            "filename": "packages/next/src/shared/lib/router/utils/is-bot.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fis-bot.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6a5d6764b9d615d62fd95207e3ecf34139e07b3e/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fis-bot.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fis-bot.ts?ref=6a5d6764b9d615d62fd95207e3ecf34139e07b3e",
            "patch": "@@ -1,16 +1,12 @@\n+import { HTML_LIMITED_BOT_UA_RE } from './html-bots'\n+\n // Bot crawler that will spin up a headless browser and execute JS\n const HEADLESS_BROWSER_BOT_UA_RE =\n   /Googlebot|Google-PageRenderer|AdsBot-Google|googleweblight|Storebot-Google/i\n \n-// This regex contains the bots that we need to do a blocking render for and can't safely stream the response\n-// due to how they parse the DOM. For example, they might explicitly check for metadata in the `head` tag, so we can't stream metadata tags after the `head` was sent.\n-export const HTML_LIMITED_BOT_UA_RE_STRING =\n-  'Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview'\n+export const HTML_LIMITED_BOT_UA_RE_STRING = HTML_LIMITED_BOT_UA_RE.source\n \n-export const HTML_LIMITED_BOT_UA_RE = new RegExp(\n-  HTML_LIMITED_BOT_UA_RE_STRING,\n-  'i'\n-)\n+export { HTML_LIMITED_BOT_UA_RE }\n \n function isDomBotUA(userAgent: string) {\n   return HEADLESS_BROWSER_BOT_UA_RE.test(userAgent)"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 14,
        "deletions": 8
    }
}