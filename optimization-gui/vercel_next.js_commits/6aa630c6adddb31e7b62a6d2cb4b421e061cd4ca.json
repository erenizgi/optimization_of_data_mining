{
    "author": "huozhi",
    "message": "[test] separate hmr env test (#80802)",
    "sha": "6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca",
    "files": [
        {
            "sha": "1693f4f195db0956b3346f6fbfb2f660948b3412",
            "filename": "test/development/app-hmr/hmr-env.test.ts",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/vercel/next.js/blob/6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca/test%2Fdevelopment%2Fapp-hmr%2Fhmr-env.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca/test%2Fdevelopment%2Fapp-hmr%2Fhmr-env.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-hmr%2Fhmr-env.test.ts?ref=6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca",
            "patch": "@@ -0,0 +1,56 @@\n+import { FileRef, nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+import path from 'path'\n+\n+const envFile = '.env.development.local'\n+\n+describe(`app-dir hmr-env`, () => {\n+  const { next } = nextTestSetup({\n+    files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n+    patchFileDelay: 1000,\n+  })\n+\n+  it.each(['node', 'node-module-var', 'edge', 'edge-module-var'])(\n+    'should update server components pages when env files is changed (%s)',\n+    async (page) => {\n+      const browser = await next.browser(`/env/${page}`)\n+      expect(await browser.elementByCss('p').text()).toBe('mac')\n+\n+      await next.patchFile(envFile, 'MY_DEVICE=\"ipad\"', async () => {\n+        let logs\n+\n+        await retry(async () => {\n+          logs = await browser.log()\n+          expect(logs).toEqual(\n+            expect.arrayContaining([\n+              expect.objectContaining({\n+                message: expect.stringContaining('[Fast Refresh] done'),\n+                source: 'log',\n+              }),\n+            ])\n+          )\n+        })\n+\n+        await retry(async () => {\n+          expect(await browser.elementByCss('p').text()).toBe('ipad')\n+        })\n+\n+        expect(logs).toEqual(\n+          expect.arrayContaining([\n+            expect.objectContaining({\n+              message: expect.stringContaining('[Fast Refresh] done in'),\n+              source: 'log',\n+            }),\n+          ])\n+        )\n+      })\n+\n+      // ensure it's restored back to \"mac\" before the next test\n+      await retry(async () => {\n+        expect(await browser.elementByCss('p').text()).toBe('mac')\n+      })\n+\n+      expect(next.cliOutput).not.toContain('FATAL')\n+    }\n+  )\n+})"
        },
        {
            "sha": "a9a644bb008257c82ca14f5321372d0d619b13f6",
            "filename": "test/development/app-hmr/hmr.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts?ref=6aa630c6adddb31e7b62a6d2cb4b421e061cd4ca",
            "patch": "@@ -107,50 +107,6 @@ describe(`app-dir-hmr`, () => {\n       expect(next.cliOutput).not.toContain('FATAL')\n     })\n \n-    it.each(['node', 'node-module-var', 'edge', 'edge-module-var'])(\n-      'should update server components pages when env files is changed (%s)',\n-      async (page) => {\n-        const browser = await next.browser(`/env/${page}`)\n-        expect(await browser.elementByCss('p').text()).toBe('mac')\n-\n-        await next.patchFile(envFile, 'MY_DEVICE=\"ipad\"', async () => {\n-          let logs\n-\n-          await retry(async () => {\n-            logs = await browser.log()\n-            expect(logs).toEqual(\n-              expect.arrayContaining([\n-                expect.objectContaining({\n-                  message: expect.stringContaining('[Fast Refresh] done'),\n-                  source: 'log',\n-                }),\n-              ])\n-            )\n-          })\n-\n-          await retry(async () => {\n-            expect(await browser.elementByCss('p').text()).toBe('ipad')\n-          })\n-\n-          expect(logs).toEqual(\n-            expect.arrayContaining([\n-              expect.objectContaining({\n-                message: expect.stringContaining('[Fast Refresh] done in'),\n-                source: 'log',\n-              }),\n-            ])\n-          )\n-        })\n-\n-        // ensure it's restored back to \"mac\" before the next test\n-        await retry(async () => {\n-          expect(await browser.elementByCss('p').text()).toBe('mac')\n-        })\n-\n-        expect(next.cliOutput).not.toContain('FATAL')\n-      }\n-    )\n-\n     it('should have no unexpected action error for hmr', async () => {\n       expect(next.cliOutput).not.toContain('Unexpected action')\n     })"
        }
    ],
    "stats": {
        "total": 100,
        "additions": 56,
        "deletions": 44
    }
}