{
    "author": "sokra",
    "message": "Turbopack: Do multiple unit test runs (#78212)\n\n### What?\n\nThis allows to test caching more aggressively",
    "sha": "47b0387d2bcc1d6445d0a0586dd5da4d44fa8906",
    "files": [
        {
            "sha": "c64635d0dc8b560e0284477f08a3d0b98b71a2ab",
            "filename": "turbopack/crates/turbo-tasks-testing/src/run.rs",
            "status": "modified",
            "additions": 18,
            "deletions": 14,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/47b0387d2bcc1d6445d0a0586dd5da4d44fa8906/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Frun.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/47b0387d2bcc1d6445d0a0586dd5da4d44fa8906/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Frun.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Fsrc%2Frun.rs?ref=47b0387d2bcc1d6445d0a0586dd5da4d44fa8906",
            "patch": "@@ -109,22 +109,26 @@ where\n     let start = std::time::Instant::now();\n     let first = fut(tt.clone()).await?;\n     println!(\"Run #1 took {:?}\", start.elapsed());\n-    println!(\"Run #2 (with memory cache, same TurboTasks instance)\");\n-    let start = std::time::Instant::now();\n-    let second = fut(tt.clone()).await?;\n-    println!(\"Run #2 took {:?}\", start.elapsed());\n-    assert_eq!(first, second);\n-    let start = std::time::Instant::now();\n-    tt.stop_and_wait().await;\n-    println!(\"Stopping TurboTasks took {:?}\", start.elapsed());\n-    let tt = registration.create_turbo_tasks(&name, false);\n-    println!(\"Run #3 (with persistent cache if available, new TurboTasks instance)\");\n-    let start = std::time::Instant::now();\n-    let third = fut(tt.clone()).await?;\n-    println!(\"Run #3 took {:?}\", start.elapsed());\n+    for i in 2..10 {\n+        println!(\"Run #{i} (with memory cache, same TurboTasks instance)\");\n+        let start = std::time::Instant::now();\n+        let second = fut(tt.clone()).await?;\n+        println!(\"Run #{i} took {:?}\", start.elapsed());\n+        assert_eq!(first, second);\n+    }\n     let start = std::time::Instant::now();\n     tt.stop_and_wait().await;\n     println!(\"Stopping TurboTasks took {:?}\", start.elapsed());\n-    assert_eq!(first, third);\n+    for i in 10..20 {\n+        let tt = registration.create_turbo_tasks(&name, false);\n+        println!(\"Run #{i} (with persistent cache if available, new TurboTasks instance)\");\n+        let start = std::time::Instant::now();\n+        let third = fut(tt.clone()).await?;\n+        println!(\"Run #{i} took {:?}\", start.elapsed());\n+        let start = std::time::Instant::now();\n+        tt.stop_and_wait().await;\n+        println!(\"Stopping TurboTasks took {:?}\", start.elapsed());\n+        assert_eq!(first, third);\n+    }\n     Ok(())\n }"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 18,
        "deletions": 14
    }
}