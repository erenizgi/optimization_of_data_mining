{
    "author": "lukesandberg",
    "message": "[turbopack] Remove Value::new wrapper for ServerContextType parameters (#80133)\n\nRemove Value::new wrapper for ServerContextType parameters\n\n### Why?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
    "files": [
        {
            "sha": "66e3339031081d8d9464eea3247ac4acf1a6c16b",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -237,7 +237,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.rsc_ty().owned().await?),\n+            self.rsc_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -250,7 +250,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.rsc_ty().owned().await?),\n+            self.rsc_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -263,7 +263,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.route_ty().owned().await?),\n+            self.route_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -276,7 +276,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.route_ty().owned().await?),\n+            self.route_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -288,7 +288,7 @@ impl AppProject {\n     async fn rsc_resolve_options_context(self: Vc<Self>) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_server_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.rsc_ty().owned().await?),\n+            self.rsc_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -299,7 +299,7 @@ impl AppProject {\n     async fn edge_rsc_resolve_options_context(self: Vc<Self>) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_edge_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.rsc_ty().owned().await?),\n+            self.rsc_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -310,7 +310,7 @@ impl AppProject {\n     async fn route_resolve_options_context(self: Vc<Self>) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_server_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.route_ty().owned().await?),\n+            self.route_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -323,7 +323,7 @@ impl AppProject {\n     ) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_edge_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.route_ty().owned().await?),\n+            self.route_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -587,7 +587,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.ssr_ty().owned().await?),\n+            self.ssr_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -600,7 +600,7 @@ impl AppProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(self.ssr_ty().owned().await?),\n+            self.ssr_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -612,7 +612,7 @@ impl AppProject {\n     async fn ssr_resolve_options_context(self: Vc<Self>) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_server_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.ssr_ty().owned().await?),\n+            self.ssr_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -623,7 +623,7 @@ impl AppProject {\n     async fn edge_ssr_resolve_options_context(self: Vc<Self>) -> Result<Vc<ResolveOptionsContext>> {\n         Ok(get_edge_resolve_options_context(\n             self.project().project_path(),\n-            Value::new(self.ssr_ty().owned().await?),\n+            self.ssr_ty().owned().await?,\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -755,7 +755,7 @@ impl AppProject {\n     #[turbo_tasks::function]\n     async fn runtime_entries(self: Vc<Self>) -> Result<Vc<RuntimeEntries>> {\n         Ok(get_server_runtime_entries(\n-            Value::new(self.rsc_ty().owned().await?),\n+            self.rsc_ty().owned().await?,\n             self.project().next_mode(),\n         ))\n     }"
        },
        {
            "sha": "f525f766b8d5202cf38b026df33b63789067ffd3",
            "filename": "crates/next-api/src/instrumentation.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -7,7 +7,7 @@ use next_core::{\n };\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{Completion, ResolvedVc, Value, Vc};\n+use turbo_tasks::{Completion, ResolvedVc, Vc};\n use turbo_tasks_fs::{File, FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::AssetContent,\n@@ -105,12 +105,12 @@ impl InstrumentationEndpoint {\n         let module_graph = this.project.module_graph(*module);\n \n         let evaluatable_assets = get_server_runtime_entries(\n-            Value::new(ServerContextType::Instrumentation {\n+            ServerContextType::Instrumentation {\n                 app_dir: this.app_dir,\n                 ecmascript_client_reference_transition_name: this\n                     .ecmascript_client_reference_transition_name\n                     .clone(),\n-            }),\n+            },\n             this.project.next_mode(),\n         )\n         .resolve_entries(*this.asset_context)\n@@ -150,12 +150,12 @@ impl InstrumentationEndpoint {\n                     .node_root()\n                     .join(rcstr!(\"server/instrumentation.js\")),\n                 get_server_runtime_entries(\n-                    Value::new(ServerContextType::Instrumentation {\n+                    ServerContextType::Instrumentation {\n                         app_dir: this.app_dir,\n                         ecmascript_client_reference_transition_name: this\n                             .ecmascript_client_reference_transition_name\n                             .clone(),\n-                    }),\n+                    },\n                     this.project.next_mode(),\n                 )\n                 .resolve_entries(*this.asset_context)"
        },
        {
            "sha": "e9fc6efb5b80e704d09c52cdbdfda277dba159bc",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -11,7 +11,7 @@ use next_core::{\n };\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{Completion, ResolvedVc, Value, Vc};\n+use turbo_tasks::{Completion, ResolvedVc, Vc};\n use turbo_tasks_fs::{self, File, FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::AssetContent,\n@@ -107,12 +107,12 @@ impl MiddlewareEndpoint {\n         let module_graph = this.project.module_graph(*module);\n \n         let evaluatable_assets = get_server_runtime_entries(\n-            Value::new(ServerContextType::Middleware {\n+            ServerContextType::Middleware {\n                 app_dir: this.app_dir,\n                 ecmascript_client_reference_transition_name: this\n                     .ecmascript_client_reference_transition_name\n                     .clone(),\n-            }),\n+            },\n             this.project.next_mode(),\n         )\n         .resolve_entries(*this.asset_context)\n@@ -151,12 +151,12 @@ impl MiddlewareEndpoint {\n                     .node_root()\n                     .join(rcstr!(\"server/middleware.js\")),\n                 get_server_runtime_entries(\n-                    Value::new(ServerContextType::Middleware {\n+                    ServerContextType::Middleware {\n                         app_dir: this.app_dir,\n                         ecmascript_client_reference_transition_name: this\n                             .ecmascript_client_reference_transition_name\n                             .clone(),\n-                    }),\n+                    },\n                     this.project.next_mode(),\n                 )\n                 .resolve_entries(*this.asset_context)"
        },
        {
            "sha": "43cb13989a951f85887f9ce61481824cd448c7ed",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -443,9 +443,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::Pages {\n+            ServerContextType::Pages {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -458,9 +458,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::Pages {\n+            ServerContextType::Pages {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -473,9 +473,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::PagesApi {\n+            ServerContextType::PagesApi {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -488,9 +488,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::PagesApi {\n+            ServerContextType::PagesApi {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -503,9 +503,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::PagesData {\n+            ServerContextType::PagesData {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::NodeJs,\n@@ -520,9 +520,9 @@ impl PagesProject {\n         Ok(get_server_module_options_context(\n             self.project().project_path(),\n             self.project().execution_context(),\n-            Value::new(ServerContextType::PagesData {\n+            ServerContextType::PagesData {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             NextRuntime::Edge,\n@@ -537,9 +537,9 @@ impl PagesProject {\n             // NOTE(alexkirsz) This could be `PagesData` for the data endpoint, but it doesn't\n             // matter (for now at least) because `get_server_resolve_options_context` doesn't\n             // differentiate between the two.\n-            Value::new(ServerContextType::Pages {\n+            ServerContextType::Pages {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -553,9 +553,9 @@ impl PagesProject {\n             // NOTE(alexkirsz) This could be `PagesData` for the data endpoint, but it doesn't\n             // matter (for now at least) because `get_server_resolve_options_context` doesn't\n             // differentiate between the two.\n-            Value::new(ServerContextType::Pages {\n+            ServerContextType::Pages {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n@@ -579,19 +579,19 @@ impl PagesProject {\n     #[turbo_tasks::function]\n     async fn runtime_entries(self: Vc<Self>) -> Result<Vc<RuntimeEntries>> {\n         Ok(get_server_runtime_entries(\n-            Value::new(ServerContextType::Pages {\n+            ServerContextType::Pages {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n         ))\n     }\n \n     #[turbo_tasks::function]\n     async fn data_runtime_entries(self: Vc<Self>) -> Result<Vc<RuntimeEntries>> {\n         Ok(get_server_runtime_entries(\n-            Value::new(ServerContextType::PagesData {\n+            ServerContextType::PagesData {\n                 pages_dir: self.pages_dir().to_resolved().await?,\n-            }),\n+            },\n             self.project().next_mode(),\n         ))\n     }"
        },
        {
            "sha": "5630e075bb7c857b5ded432ea7e783f7d3f5f0d3",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -25,7 +25,7 @@ use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, Completions, FxIndexMap, IntoTraitRef, NonLocalValue, OperationValue, OperationVc,\n-    ReadRef, ResolvedVc, State, TaskInput, TransientInstance, TryFlatJoinIterExt, Value, Vc,\n+    ReadRef, ResolvedVc, State, TaskInput, TransientInstance, TryFlatJoinIterExt, Vc,\n     debug::ValueDebugFormat,\n     fxindexmap,\n     graph::{AdjacencyMap, GraphTraversal},\n@@ -1289,23 +1289,23 @@ impl Project {\n             get_server_module_options_context(\n                 self.project_path(),\n                 self.execution_context(),\n-                Value::new(ServerContextType::Middleware {\n+                ServerContextType::Middleware {\n                     app_dir,\n                     ecmascript_client_reference_transition_name:\n                         ecmascript_client_reference_transition_name.clone(),\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 NextRuntime::Edge,\n                 self.encryption_key(),\n             ),\n             get_edge_resolve_options_context(\n                 self.project_path(),\n-                Value::new(ServerContextType::Middleware {\n+                ServerContextType::Middleware {\n                     app_dir,\n                     ecmascript_client_reference_transition_name:\n                         ecmascript_client_reference_transition_name.clone(),\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n@@ -1344,22 +1344,22 @@ impl Project {\n             get_server_module_options_context(\n                 self.project_path(),\n                 self.execution_context(),\n-                Value::new(ServerContextType::Middleware {\n+                ServerContextType::Middleware {\n                     app_dir,\n                     ecmascript_client_reference_transition_name:\n                         ecmascript_client_reference_transition_name.clone(),\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 NextRuntime::NodeJs,\n                 self.encryption_key(),\n             ),\n             get_server_resolve_options_context(\n                 self.project_path(),\n-                Value::new(ServerContextType::Middleware {\n+                ServerContextType::Middleware {\n                     app_dir,\n                     ecmascript_client_reference_transition_name,\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n@@ -1456,22 +1456,22 @@ impl Project {\n             get_server_module_options_context(\n                 self.project_path(),\n                 self.execution_context(),\n-                Value::new(ServerContextType::Instrumentation {\n+                ServerContextType::Instrumentation {\n                     app_dir,\n                     ecmascript_client_reference_transition_name:\n                         ecmascript_client_reference_transition_name.clone(),\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 NextRuntime::NodeJs,\n                 self.encryption_key(),\n             ),\n             get_server_resolve_options_context(\n                 self.project_path(),\n-                Value::new(ServerContextType::Instrumentation {\n+                ServerContextType::Instrumentation {\n                     app_dir,\n                     ecmascript_client_reference_transition_name,\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n@@ -1511,22 +1511,22 @@ impl Project {\n             get_server_module_options_context(\n                 self.project_path(),\n                 self.execution_context(),\n-                Value::new(ServerContextType::Instrumentation {\n+                ServerContextType::Instrumentation {\n                     app_dir,\n                     ecmascript_client_reference_transition_name:\n                         ecmascript_client_reference_transition_name.clone(),\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 NextRuntime::Edge,\n                 self.encryption_key(),\n             ),\n             get_edge_resolve_options_context(\n                 self.project_path(),\n-                Value::new(ServerContextType::Instrumentation {\n+                ServerContextType::Instrumentation {\n                     app_dir,\n                     ecmascript_client_reference_transition_name,\n-                }),\n+                },\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),"
        },
        {
            "sha": "a1d5a8993ba24e5348e18a658f7b4b82e675d739",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -104,7 +104,7 @@ pub async fn get_edge_compile_time_info(\n #[turbo_tasks::function]\n pub async fn get_edge_resolve_options_context(\n     project_path: ResolvedVc<FileSystemPath>,\n-    ty: Value<ServerContextType>,\n+    ty: ServerContextType,\n     mode: Vc<NextMode>,\n     next_config: Vc<NextConfig>,\n     execution_context: Vc<ExecutionContext>,\n@@ -119,8 +119,6 @@ pub async fn get_edge_resolve_options_context(\n     .to_resolved()\n     .await?;\n \n-    let ty: ServerContextType = ty.into_value();\n-\n     let mut before_resolve_plugins = vec![ResolvedVc::upcast(\n         ModuleFeatureReportResolvePlugin::new(*project_path)\n             .to_resolved()"
        },
        {
            "sha": "a93724890e76941c7770e2832cd5462debdf52e8",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -287,7 +287,7 @@ pub async fn get_next_client_fallback_import_map(ty: ClientContextType) -> Resul\n #[turbo_tasks::function]\n pub async fn get_next_server_import_map(\n     project_path: ResolvedVc<FileSystemPath>,\n-    ty: Value<ServerContextType>,\n+    ty: ServerContextType,\n     next_config: Vc<NextConfig>,\n     next_mode: Vc<NextMode>,\n     execution_context: Vc<ExecutionContext>,\n@@ -312,8 +312,6 @@ pub async fn get_next_server_import_map(\n     )\n     .await?;\n \n-    let ty = ty.into_value();\n-\n     let external = ImportMapping::External(None, ExternalType::CommonJs, ExternalTraced::Traced)\n         .resolved_cell();\n \n@@ -384,7 +382,7 @@ pub async fn get_next_server_import_map(\n #[turbo_tasks::function]\n pub async fn get_next_edge_import_map(\n     project_path: ResolvedVc<FileSystemPath>,\n-    ty: Value<ServerContextType>,\n+    ty: ServerContextType,\n     next_config: Vc<NextConfig>,\n     next_mode: Vc<NextMode>,\n     execution_context: Vc<ExecutionContext>,\n@@ -453,7 +451,6 @@ pub async fn get_next_edge_import_map(\n     )\n     .await?;\n \n-    let ty = ty.into_value();\n     match &ty {\n         ServerContextType::Pages { .. }\n         | ServerContextType::PagesData { .. }"
        },
        {
            "sha": "b73d103bd30b5ac11f58f9e1706a18c0443a32cc",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -2,7 +2,7 @@ use std::iter::once;\n \n use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, TaskInput, Value, Vc};\n use turbo_tasks_env::{EnvMap, ProcessEnv};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n@@ -79,7 +79,7 @@ use crate::{\n };\n \n #[turbo_tasks::value(shared, serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n pub enum ServerContextType {\n     Pages {\n         pages_dir: ResolvedVc<FileSystemPath>,\n@@ -128,7 +128,7 @@ impl ServerContextType {\n #[turbo_tasks::function]\n pub async fn get_server_resolve_options_context(\n     project_path: ResolvedVc<FileSystemPath>,\n-    ty: Value<ServerContextType>,\n+    ty: ServerContextType,\n     mode: Vc<NextMode>,\n     next_config: Vc<NextConfig>,\n     execution_context: Vc<ExecutionContext>,\n@@ -193,8 +193,6 @@ pub async fn get_server_resolve_options_context(\n \n     external_packages.retain(|item| !transpiled_packages.contains(item));\n \n-    let ty = ty.into_value();\n-\n     let server_external_packages_plugin = ExternalCjsModulesResolvePlugin::new(\n         *project_path,\n         project_path.root(),\n@@ -234,7 +232,7 @@ pub async fn get_server_resolve_options_context(\n         .to_resolved()\n         .await?;\n     let next_node_shared_runtime_plugin =\n-        NextNodeSharedRuntimeResolvePlugin::new(*project_path, Value::new(ty.clone()))\n+        NextNodeSharedRuntimeResolvePlugin::new(*project_path, ty.clone())\n             .to_resolved()\n             .await?;\n \n@@ -411,7 +409,7 @@ pub async fn get_server_compile_time_info(\n pub async fn get_server_module_options_context(\n     project_path: ResolvedVc<FileSystemPath>,\n     execution_context: ResolvedVc<ExecutionContext>,\n-    ty: Value<ServerContextType>,\n+    ty: ServerContextType,\n     mode: Vc<NextMode>,\n     next_config: Vc<NextConfig>,\n     next_runtime: NextRuntime,\n@@ -420,7 +418,7 @@ pub async fn get_server_module_options_context(\n     let next_mode = mode.await?;\n     let mut next_server_rules = get_next_server_transforms_rules(\n         next_config,\n-        ty.clone().into_value(),\n+        ty.clone(),\n         mode,\n         false,\n         next_runtime,\n@@ -429,15 +427,15 @@ pub async fn get_server_module_options_context(\n     .await?;\n     let mut foreign_next_server_rules = get_next_server_transforms_rules(\n         next_config,\n-        ty.clone().into_value(),\n+        ty.clone(),\n         mode,\n         true,\n         next_runtime,\n         encryption_key,\n     )\n     .await?;\n     let mut internal_custom_rules = get_next_server_internal_transforms_rules(\n-        ty.clone().into_value(),\n+        ty.clone(),\n         next_config.mdx_rs().await?.is_some(),\n     )\n     .await?;\n@@ -570,7 +568,6 @@ pub async fn get_server_module_options_context(\n         ..Default::default()\n     };\n \n-    let ty = ty.into_value();\n     let module_options_context = match ty {\n         ServerContextType::Pages { .. }\n         | ServerContextType::PagesData { .. }\n@@ -976,7 +973,7 @@ pub async fn get_server_module_options_context(\n \n #[turbo_tasks::function]\n pub fn get_server_runtime_entries(\n-    _ty: Value<ServerContextType>,\n+    _ty: ServerContextType,\n     _mode: Vc<NextMode>,\n ) -> Vc<RuntimeEntries> {\n     let runtime_entries = vec![];"
        },
        {
            "sha": "85d732021991781d25beab2d596a2394d40ed7e8",
            "filename": "crates/next-core/src/next_shared/resolve.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs?ref=ae96d7bee6811a0bc1aa074f278a506fa6b1a4fd",
            "patch": "@@ -2,7 +2,7 @@ use anyhow::Result;\n use lazy_static::lazy_static;\n use rustc_hash::FxHashMap;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n use turbopack_core::{\n     diagnostics::DiagnosticExt,\n@@ -263,9 +263,8 @@ impl NextNodeSharedRuntimeResolvePlugin {\n     #[turbo_tasks::function]\n     pub fn new(\n         root: ResolvedVc<FileSystemPath>,\n-        server_context_type: Value<ServerContextType>,\n+        server_context_type: ServerContextType,\n     ) -> Vc<Self> {\n-        let server_context_type = server_context_type.into_value();\n         NextNodeSharedRuntimeResolvePlugin {\n             root,\n             server_context_type,"
        }
    ],
    "stats": {
        "total": 157,
        "additions": 74,
        "deletions": 83
    }
}