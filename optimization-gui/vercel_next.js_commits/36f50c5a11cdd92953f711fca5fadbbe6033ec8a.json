{
    "author": "unstubbable",
    "message": "Send dynamic validation errors to browser via WebSocket (#85818)\n\nBy sending the dynamic validation errors to the browser via WebSocket,\ninstead of rendering a validation outlet into the dynamic dev render\nstream, we can avoid artificially delaying the spawned validation to\nimplicitly wait for the different chunks (static, runtime, and dynamic),\nwithout blocking the dev render stream, and instead wait explicitly for\nall chunks to accumulate.\n\nPreviously, we were using React's console replaying to get full fidelity\nerror stacks in the browser (including inspectable virtual server\nmodules). Now, we're using the same underlying mechanism by sending a\nseparate RSC stream through the WebSocket that contains only the errors.\nIn the browser, the received errors are then logged with\n`console.error`, which also triggers that they're displayed in a\ncollapsed Redbox, as was the case before with the replaying.\n\n---------\n\nCo-authored-by: Janka Uryga <lolzatu2@gmail.com>",
    "sha": "36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
    "files": [
        {
            "sha": "3a9877b3e9bf59c95ef257b371d862a031736ed0",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -943,5 +943,8 @@\n   \"942\": \"Unexpected stream chunk while in Before stage\",\n   \"943\": \"getFlightStream should always receive a ReadableStream when using the edge runtime\",\n   \"944\": \"nodeStreamFromReadableStream cannot be used in the edge runtime\",\n-  \"945\": \"createNodeStreamFromChunks cannot be used in the edge runtime\"\n+  \"945\": \"createNodeStreamFromChunks cannot be used in the edge runtime\",\n+  \"946\": \"Failed to deserialize errors.\",\n+  \"947\": \"Expected `sendErrorsToBrowser` to be defined in renderOpts.\",\n+  \"948\": \"Failed to serialize errors.\"\n }"
        },
        {
            "sha": "b9b18d322a6ff0b6d9407469130f300ce8977efe",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -545,6 +545,7 @@ export async function handler(\n           setCacheStatus: routerServerContext?.setCacheStatus,\n           setIsrStatus: routerServerContext?.setIsrStatus,\n           setReactDebugChannel: routerServerContext?.setReactDebugChannel,\n+          sendErrorsToBrowser: routerServerContext?.sendErrorsToBrowser,\n \n           dir:\n             process.env.NEXT_RUNTIME === 'nodejs'"
        },
        {
            "sha": "32181d209733198fdb189c132cfb9a86f6bc74a8",
            "filename": "packages/next/src/client/dev/hot-reloader/app/hot-reloader-app.tsx",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -38,12 +38,19 @@ import {\n } from '../../../components/app-router-instance'\n import { InvariantError } from '../../../../shared/lib/invariant-error'\n import { getOrCreateDebugChannelReadableWriterPair } from '../../debug-channel'\n+// TODO: Explicitly import from client.browser (doesn't work with Webpack).\n+// eslint-disable-next-line import/no-extraneous-dependencies\n+import { createFromReadableStream as createFromReadableStreamBrowser } from 'react-server-dom-webpack/client'\n+import { findSourceMapURL } from '../../../app-find-source-map-url'\n \n export interface StaticIndicatorState {\n   pathname: string | null\n   appIsrManifest: Record<string, boolean> | null\n }\n \n+const createFromReadableStream =\n+  createFromReadableStreamBrowser as (typeof import('react-server-dom-webpack/client.browser'))['createFromReadableStream']\n+\n let mostRecentCompilationHash: any = null\n let __nextDevClientId = Math.round(Math.random() * 100 + Date.now())\n let reloading = false\n@@ -504,6 +511,29 @@ export function processMessage(\n       dispatcher.onCacheIndicator(message.state)\n       return\n     }\n+    case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER: {\n+      createFromReadableStream<Error[]>(\n+        new ReadableStream({\n+          start(controller) {\n+            controller.enqueue(message.serializedErrors)\n+            controller.close()\n+          },\n+        }),\n+        { findSourceMapURL }\n+      ).then(\n+        (errors) => {\n+          for (const error of errors) {\n+            console.error(error)\n+          }\n+        },\n+        (err) => {\n+          console.error(\n+            new Error('Failed to deserialize errors.', { cause: err })\n+          )\n+        }\n+      )\n+      return\n+    }\n     case HMR_MESSAGE_SENT_TO_BROWSER.MIDDLEWARE_CHANGES:\n     case HMR_MESSAGE_SENT_TO_BROWSER.CLIENT_CHANGES:\n     case HMR_MESSAGE_SENT_TO_BROWSER.SERVER_ONLY_CHANGES:"
        },
        {
            "sha": "94483442345fa144a9ade7eca9d6ba34cb7f4f4b",
            "filename": "packages/next/src/client/dev/hot-reloader/app/web-socket.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -223,6 +223,14 @@ function parseBinaryMessage(data: ArrayBuffer): HmrMessageSentToBrowser {\n   const messageType = view.getUint8(0)\n \n   switch (messageType) {\n+    case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER: {\n+      const serializedErrors = new Uint8Array(data, 1)\n+\n+      return {\n+        type: HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER,\n+        serializedErrors,\n+      }\n+    }\n     case HMR_MESSAGE_SENT_TO_BROWSER.REACT_DEBUG_CHUNK: {\n       assertByteLength(data, 2)\n       const requestIdLength = view.getUint8(1)"
        },
        {
            "sha": "2b8eb4247882852f6f72f02f887fa7caaa3716a6",
            "filename": "packages/next/src/client/dev/hot-reloader/pages/hot-reloader-pages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -394,6 +394,7 @@ function processMessage(message: HmrMessageSentToBrowser) {\n       break\n     case HMR_MESSAGE_SENT_TO_BROWSER.CACHE_INDICATOR:\n     case HMR_MESSAGE_SENT_TO_BROWSER.REACT_DEBUG_CHUNK:\n+    case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER:\n       // Only relevant for app router.\n       break\n     case HMR_MESSAGE_SENT_TO_BROWSER.MIDDLEWARE_CHANGES:"
        },
        {
            "sha": "b6b202ef2e0f9f320e74421a4a9d75d3d9b5da47",
            "filename": "packages/next/src/client/page-bootstrap.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -124,6 +124,7 @@ export function pageBootstrap(assetPrefix: string) {\n         case HMR_MESSAGE_SENT_TO_BROWSER.REQUEST_CURRENT_ERROR_STATE:\n         case HMR_MESSAGE_SENT_TO_BROWSER.REQUEST_PAGE_METADATA:\n         case HMR_MESSAGE_SENT_TO_BROWSER.CACHE_INDICATOR:\n+        case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER:\n           // Most of these action types are handled in\n           // src/client/dev/hot-reloader/pages/hot-reloader-pages.ts and\n           // src/client/dev/hot-reloader/app/hot-reloader-app.tsx"
        },
        {
            "sha": "1a78d9b9ad6c2f61e11d55f9d1d035638a97a65b",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 122,
            "deletions": 148,
            "changes": 270,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -57,7 +57,6 @@ import {\n   NEXT_URL,\n   RSC_HEADER,\n   NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n-  NEXT_HMR_REFRESH_HASH_COOKIE,\n   NEXT_REQUEST_ID_HEADER,\n   NEXT_HTML_REQUEST_ID_HEADER,\n } from '../../client/components/app-router-headers'\n@@ -178,6 +177,7 @@ import {\n } from './app-render-render-utils'\n import { waitAtLeastOneReactRenderTask } from '../../lib/scheduler'\n import {\n+  getHmrRefreshHash,\n   workUnitAsyncStorage,\n   type PrerenderStore,\n } from './work-unit-async-storage.external'\n@@ -782,10 +782,11 @@ async function generateDynamicFlightRenderResultWithStagesInDev(\n     onFlightDataRenderError\n   )\n \n-  // If we decide to validate this render we will assign this function when the\n-  // payload is constructed.\n-  let resolveValidation: null | ReturnType<typeof createValidationOutlet>[0] =\n-    null\n+  // We only validate RSC requests if it is for HMR refreshes since we know we\n+  // will render all the layouts necessary to perform the validation.\n+  const shouldValidate =\n+    !isBypassingCachesInDev(renderOpts, initialRequestStore) &&\n+    initialRequestStore.isHmrRefresh === true\n \n   const getPayload = async (requestStore: RequestStore) => {\n     const payload: RSCPayload &\n@@ -803,18 +804,9 @@ async function generateDynamicFlightRenderResultWithStagesInDev(\n       payload._bypassCachesInDev = createElement(WarnForBypassCachesInDev, {\n         route: workStore.route,\n       })\n-    } else if (requestStore.isHmrRefresh) {\n-      // We only validate RSC requests if it is for HMR refreshes since\n-      // we know we will render all the layouts necessary to perform the validation.\n-      // We also must add the canonical URL part of the payload\n-\n-      // Placing the validation outlet in the payload is safe\n-      // even if we end up discarding a render and restarting,\n-      // because we're not going to wait for the stream to complete,\n-      // so leaving the validation unresolved is fine.\n-      const [validationResolver, validationOutlet] = createValidationOutlet()\n-      resolveValidation = validationResolver\n-      payload._validation = validationOutlet\n+    } else if (shouldValidate) {\n+      // If this payload will be used for validation, it needs to contain the\n+      // canonical URL. Without it we'd get an error.\n       payload.c = prepareInitialCanonicalUrl(url)\n     }\n \n@@ -840,9 +832,7 @@ async function generateDynamicFlightRenderResultWithStagesInDev(\n \n     const {\n       stream: serverStream,\n-      staticChunks,\n-      runtimeChunks,\n-      dynamicChunks,\n+      accumulatedChunksPromise,\n       staticInterruptReason,\n       runtimeInterruptReason,\n       staticStageEndTime,\n@@ -857,7 +847,7 @@ async function generateDynamicFlightRenderResultWithStagesInDev(\n       onError\n     )\n \n-    if (resolveValidation) {\n+    if (shouldValidate) {\n       let validationDebugChannelClient: Readable | undefined = undefined\n       if (returnedDebugChannel) {\n         const [t1, t2] = returnedDebugChannel.clientSide.readable.tee()\n@@ -867,10 +857,7 @@ async function generateDynamicFlightRenderResultWithStagesInDev(\n       consoleAsyncStorage.run(\n         { dim: true },\n         spawnStaticShellValidationInDev,\n-        resolveValidation,\n-        staticChunks,\n-        runtimeChunks,\n-        dynamicChunks,\n+        accumulatedChunksPromise,\n         staticInterruptReason,\n         runtimeInterruptReason,\n         staticStageEndTime,\n@@ -2670,7 +2657,6 @@ async function renderToStream(\n       // We only have a Prerender environment for projects opted into cacheComponents\n       cacheComponents\n     ) {\n-      let validationOutlet: Promise<ReactNode> | undefined\n       let debugChannel: DebugChannelPair | undefined\n \n       const getPayload = async (\n@@ -2696,12 +2682,6 @@ async function renderToStream(\n           payload._bypassCachesInDev = createElement(WarnForBypassCachesInDev, {\n             route: workStore.route,\n           })\n-        } else if (validationOutlet) {\n-          // Placing the validation outlet in the payload is safe\n-          // even if we end up discarding a render and restarting,\n-          // because we're not going to wait for the stream to complete,\n-          // so leaving the validation unresolved is fine.\n-          payload._validation = validationOutlet\n         }\n \n         return payload\n@@ -2715,14 +2695,9 @@ async function renderToStream(\n         // \"disable cache\" in devtools or a hard refresh (cache-control: \"no-store\")\n         !isBypassingCachesInDev(renderOpts, requestStore)\n       ) {\n-        const [resolveValidation, _validationOutlet] = createValidationOutlet()\n-        validationOutlet = _validationOutlet\n-\n         const {\n           stream: serverStream,\n-          staticChunks,\n-          runtimeChunks,\n-          dynamicChunks,\n+          accumulatedChunksPromise,\n           staticInterruptReason,\n           runtimeInterruptReason,\n           staticStageEndTime,\n@@ -2747,10 +2722,7 @@ async function renderToStream(\n         consoleAsyncStorage.run(\n           { dim: true },\n           spawnStaticShellValidationInDev,\n-          resolveValidation,\n-          staticChunks,\n-          runtimeChunks,\n-          dynamicChunks,\n+          accumulatedChunksPromise,\n           staticInterruptReason,\n           runtimeInterruptReason,\n           staticStageEndTime,\n@@ -3242,15 +3214,11 @@ async function renderWithRestartOnCacheMissInDev(\n \n   let debugChannel = setReactDebugChannel && createDebugChannel()\n \n-  const staticChunks: Array<Uint8Array> = []\n-  const runtimeChunks: Array<Uint8Array> = []\n-  const dynamicChunks: Array<Uint8Array> = []\n-\n   // Note: The stage controller starts out in the `Before` stage,\n   // where sync IO does not cause aborts, so it's okay if it happens before render.\n   const initialRscPayload = await getPayload(requestStore)\n \n-  const maybeInitialServerStream = await workUnitAsyncStorage.run(\n+  const maybeInitialStreamResult = await workUnitAsyncStorage.run(\n     requestStore,\n     () =>\n       pipelineInSequentialTasks(\n@@ -3277,17 +3245,14 @@ async function renderWithRestartOnCacheMissInDev(\n           })\n \n           const [continuationStream, accumulatingStream] = stream.tee()\n-          accumulateStreamChunks(\n+          const accumulatedChunksPromise = accumulateStreamChunks(\n             accumulatingStream,\n-            staticChunks,\n-            runtimeChunks,\n-            dynamicChunks,\n             initialStageController,\n             initialDataController.signal\n           )\n-          return continuationStream\n+          return { stream: continuationStream, accumulatedChunksPromise }\n         },\n-        (stream) => {\n+        ({ stream, accumulatedChunksPromise }) => {\n           // Runtime stage\n \n           if (initialStageController.currentStage === RenderStage.Abandoned) {\n@@ -3308,12 +3273,12 @@ async function renderWithRestartOnCacheMissInDev(\n           }\n \n           initialStageController.advanceStage(RenderStage.Runtime)\n-          return stream\n+          return { stream, accumulatedChunksPromise }\n         },\n-        async (stream) => {\n+        (result) => {\n           // Dynamic stage\n           if (\n-            stream === null ||\n+            result === null ||\n             initialStageController.currentStage === RenderStage.Abandoned\n           ) {\n             // If we abandoned the render in the static or runtime stage, we won't proceed further.\n@@ -3333,18 +3298,17 @@ async function renderWithRestartOnCacheMissInDev(\n           // render we need the unblock runtime b/c it's essential\n           // filling caches.\n           initialStageController.advanceStage(RenderStage.Dynamic)\n-          return stream\n+          return result\n         }\n       )\n   )\n \n-  if (maybeInitialServerStream !== null) {\n-    // No cache misses. We can use the stream as is.\n+  if (maybeInitialStreamResult !== null) {\n+    // No cache misses. We can use the result as-is.\n     return {\n-      stream: maybeInitialServerStream,\n-      staticChunks,\n-      runtimeChunks,\n-      dynamicChunks,\n+      stream: maybeInitialStreamResult.stream,\n+      accumulatedChunksPromise:\n+        maybeInitialStreamResult.accumulatedChunksPromise,\n       staticInterruptReason: initialStageController.getStaticInterruptReason(),\n       runtimeInterruptReason:\n         initialStageController.getRuntimeInterruptReason(),\n@@ -3405,17 +3369,11 @@ async function renderWithRestartOnCacheMissInDev(\n   // We're not using it, so we need to create a new one.\n   debugChannel = setReactDebugChannel && createDebugChannel()\n \n-  // We had a cache miss and need to restart after filling caches. Let's clear out the\n-  // staticChunks and runtimeChunks we previously accumulated\n-  staticChunks.length = 0\n-  runtimeChunks.length = 0\n-  dynamicChunks.length = 0\n-\n   // Note: The stage controller starts out in the `Before` stage,\n   // where sync IO does not cause aborts, so it's okay if it happens before render.\n   const finalRscPayload = await getPayload(requestStore)\n \n-  const finalServerStream = await workUnitAsyncStorage.run(requestStore, () =>\n+  const finalStreamResult = await workUnitAsyncStorage.run(requestStore, () =>\n     pipelineInSequentialTasks(\n       () => {\n         // Static stage\n@@ -3433,25 +3391,22 @@ async function renderWithRestartOnCacheMissInDev(\n         )\n \n         const [continuationStream, accumulatingStream] = stream.tee()\n-        accumulateStreamChunks(\n+        const accumulatedChunksPromise = accumulateStreamChunks(\n           accumulatingStream,\n-          staticChunks,\n-          runtimeChunks,\n-          dynamicChunks,\n           finalStageController,\n           null\n         )\n-        return continuationStream\n+        return { stream: continuationStream, accumulatedChunksPromise }\n       },\n-      (stream) => {\n+      (result) => {\n         // Runtime stage\n         finalStageController.advanceStage(RenderStage.Runtime)\n-        return stream\n+        return result\n       },\n-      (stream) => {\n+      (result) => {\n         // Dynamic stage\n         finalStageController.advanceStage(RenderStage.Dynamic)\n-        return stream\n+        return result\n       }\n     )\n   )\n@@ -3461,10 +3416,8 @@ async function renderWithRestartOnCacheMissInDev(\n   }\n \n   return {\n-    stream: finalServerStream,\n-    staticChunks,\n-    runtimeChunks,\n-    dynamicChunks,\n+    stream: finalStreamResult.stream,\n+    accumulatedChunksPromise: finalStreamResult.accumulatedChunksPromise,\n     staticInterruptReason: finalStageController.getStaticInterruptReason(),\n     runtimeInterruptReason: finalStageController.getRuntimeInterruptReason(),\n     staticStageEndTime: finalStageController.getStaticStageEndTime(),\n@@ -3474,14 +3427,20 @@ async function renderWithRestartOnCacheMissInDev(\n   }\n }\n \n+interface AccumulatedStreamChunks {\n+  readonly staticChunks: Array<Uint8Array>\n+  readonly runtimeChunks: Array<Uint8Array>\n+  readonly dynamicChunks: Array<Uint8Array>\n+}\n+\n async function accumulateStreamChunks(\n   stream: ReadableStream<Uint8Array>,\n-  staticTarget: Array<Uint8Array>,\n-  runtimeTarget: Array<Uint8Array>,\n-  dynamicTarget: Array<Uint8Array>,\n   stageController: StagedRenderingController,\n   signal: AbortSignal | null\n-): Promise<void> {\n+): Promise<AccumulatedStreamChunks> {\n+  const staticChunks: Array<Uint8Array> = []\n+  const runtimeChunks: Array<Uint8Array> = []\n+  const dynamicChunks: Array<Uint8Array> = []\n   const reader = stream.getReader()\n \n   let cancelled = false\n@@ -3509,13 +3468,13 @@ async function accumulateStreamChunks(\n             'Unexpected stream chunk while in Before stage'\n           )\n         case RenderStage.Static:\n-          staticTarget.push(value)\n+          staticChunks.push(value)\n         // fall through\n         case RenderStage.Runtime:\n-          runtimeTarget.push(value)\n+          runtimeChunks.push(value)\n         // fall through\n         case RenderStage.Dynamic:\n-          dynamicTarget.push(value)\n+          dynamicChunks.push(value)\n           break\n         case RenderStage.Abandoned:\n           // If the render was abandoned, we won't use the chunks,\n@@ -3529,6 +3488,8 @@ async function accumulateStreamChunks(\n   } catch {\n     // When we release the lock we may reject the read\n   }\n+\n+  return { staticChunks, runtimeChunks, dynamicChunks }\n }\n \n function createAsyncApiPromisesInDev(\n@@ -3618,12 +3579,61 @@ function createDebugChannel(): DebugChannelPair | undefined {\n   }\n }\n \n-function createValidationOutlet() {\n-  let resolveValidation: (value: ReactNode) => void\n-  let outlet = new Promise<ReactNode>((resolve) => {\n-    resolveValidation = resolve\n-  })\n-  return [resolveValidation!, outlet] as const\n+/**\n+ * Logs the given messages, and sends the error instances to the browser as an\n+ * RSC stream, where they can be deserialized and logged (or otherwise presented\n+ * in the devtools), while leveraging React's capabilities to not only\n+ * source-map the stack frames (via findSourceMapURL), but also create virtual\n+ * server modules that allow users to inspect the server source code in the\n+ * browser.\n+ */\n+async function logMessagesAndSendErrorsToBrowser(\n+  messages: unknown[],\n+  ctx: AppRenderContext\n+): Promise<void> {\n+  const {\n+    clientReferenceManifest,\n+    componentMod: ComponentMod,\n+    htmlRequestId,\n+    renderOpts,\n+  } = ctx\n+\n+  const { sendErrorsToBrowser } = renderOpts\n+\n+  const errors: Error[] = []\n+  for (const message of messages) {\n+    // Log the error to the CLI. Prevent the logs from being dimmed, which we\n+    // apply for other logs during the spawned validation.\n+    consoleAsyncStorage.exit(() => {\n+      console.error(message)\n+    })\n+\n+    // Error instances are also sent to the browser. We're currently using a\n+    // non-Error message only in debug build mode as a message that is only\n+    // meant for the CLI. FIXME: This is a bit spooky action at a distance. We\n+    // should maybe have a more explicit way of determining which messages\n+    // should be sent to the browser. Regardless, only real errors with a proper\n+    // stack make sense to be \"replayed\" in the browser.\n+    if (message instanceof Error) {\n+      errors.push(message)\n+    }\n+  }\n+\n+  if (errors.length > 0) {\n+    if (!sendErrorsToBrowser) {\n+      throw new InvariantError(\n+        'Expected `sendErrorsToBrowser` to be defined in renderOpts.'\n+      )\n+    }\n+\n+    const errorsRscStream = ComponentMod.renderToReadableStream(\n+      errors,\n+      clientReferenceManifest.clientModules,\n+      { filterStackFrame }\n+    )\n+\n+    sendErrorsToBrowser(errorsRscStream, htmlRequestId)\n+  }\n }\n \n /**\n@@ -3633,10 +3643,7 @@ function createValidationOutlet() {\n  * in conjunction with any changes to that function.\n  */\n async function spawnStaticShellValidationInDev(\n-  resolveValidation: (validatingElement: ReactNode) => void,\n-  staticServerChunks: Array<Uint8Array>,\n-  runtimeServerChunks: Array<Uint8Array>,\n-  dynamicServerChunks: Array<Uint8Array>,\n+  accumulatedChunksPromise: Promise<AccumulatedStreamChunks>,\n   staticInterruptReason: Error | null,\n   runtimeInterruptReason: Error | null,\n   staticStageEndTime: number,\n@@ -3647,9 +3654,6 @@ async function spawnStaticShellValidationInDev(\n   fallbackRouteParams: OpaqueFallbackRouteParams | null,\n   debugChannelClient: Readable | undefined\n ): Promise<void> {\n-  // TODO replace this with a delay on the entire dev render once the result is propagated\n-  // via the websocket and not the main render itself\n-  await new Promise((r) => setTimeout(r, 2000))\n   const {\n     componentMod: ComponentMod,\n     getDynamicParamFromSegment,\n@@ -3664,48 +3668,32 @@ async function spawnStaticShellValidationInDev(\n     getDynamicParamFromSegment\n   )\n \n-  const hmrRefreshHash = requestStore.cookies.get(\n-    NEXT_HMR_REFRESH_HASH_COOKIE\n-  )?.value\n-\n-  const { createElement } = ComponentMod\n+  const hmrRefreshHash = getHmrRefreshHash(workStore, requestStore)\n \n   // We don't need to continue the prerender process if we already\n   // detected invalid dynamic usage in the initial prerender phase.\n   const { invalidDynamicUsageError } = workStore\n   if (invalidDynamicUsageError) {\n-    resolveValidation(\n-      createElement(ReportValidation, {\n-        messages: [invalidDynamicUsageError],\n-      })\n-    )\n-    return\n+    return logMessagesAndSendErrorsToBrowser([invalidDynamicUsageError], ctx)\n   }\n \n   if (staticInterruptReason) {\n-    resolveValidation(\n-      createElement(ReportValidation, {\n-        messages: [staticInterruptReason],\n-      })\n-    )\n-    return\n+    return logMessagesAndSendErrorsToBrowser([staticInterruptReason], ctx)\n   }\n \n   if (runtimeInterruptReason) {\n-    resolveValidation(\n-      createElement(ReportValidation, {\n-        messages: [runtimeInterruptReason],\n-      })\n-    )\n-    return\n+    return logMessagesAndSendErrorsToBrowser([runtimeInterruptReason], ctx)\n   }\n \n+  const { staticChunks, runtimeChunks, dynamicChunks } =\n+    await accumulatedChunksPromise\n+\n   // First we warmup SSR with the runtime chunks. This ensures that when we do\n   // the full prerender pass with dynamic tracking module loading won't\n   // interrupt the prerender and can properly observe the entire content\n   await warmupModuleCacheForRuntimeValidationInDev(\n-    runtimeServerChunks,\n-    dynamicServerChunks,\n+    runtimeChunks,\n+    dynamicChunks,\n     rootParams,\n     fallbackRouteParams,\n     allowEmptyStaticShell,\n@@ -3720,8 +3708,8 @@ async function spawnStaticShellValidationInDev(\n   }\n \n   const runtimeResult = await validateStagedShell(\n-    runtimeServerChunks,\n-    dynamicServerChunks,\n+    runtimeChunks,\n+    dynamicChunks,\n     debugChunks,\n     runtimeStageEndTime,\n     rootParams,\n@@ -3736,15 +3724,12 @@ async function spawnStaticShellValidationInDev(\n   if (runtimeResult.length > 0) {\n     // We have something to report from the runtime validation\n     // We can skip the static validation\n-    resolveValidation(\n-      createElement(ReportValidation, { messages: runtimeResult })\n-    )\n-    return\n+    return logMessagesAndSendErrorsToBrowser(runtimeResult, ctx)\n   }\n \n   const staticResult = await validateStagedShell(\n-    staticServerChunks,\n-    dynamicServerChunks,\n+    staticChunks,\n+    dynamicChunks,\n     debugChunks,\n     staticStageEndTime,\n     rootParams,\n@@ -3756,11 +3741,7 @@ async function spawnStaticShellValidationInDev(\n     trackDynamicHoleInStaticShell\n   )\n \n-  // We always resolve with whatever results we got. It might be empty in which\n-  // case there will be nothing to report once\n-  resolveValidation(createElement(ReportValidation, { messages: staticResult }))\n-\n-  return\n+  return logMessagesAndSendErrorsToBrowser(staticResult, ctx)\n }\n \n async function warmupModuleCacheForRuntimeValidationInDev(\n@@ -4055,13 +4036,6 @@ async function validateStagedShell(\n   }\n }\n \n-function ReportValidation({ messages }: { messages: Array<unknown> }): null {\n-  for (const message of messages) {\n-    console.error(message)\n-  }\n-  return null\n-}\n-\n type PrerenderToStreamResult = {\n   stream: ReadableStream<Uint8Array>\n   digestErrorsMap: Map<string, DigestedError>"
        },
        {
            "sha": "ed53fd2d6f8a9dbbd494fb5fd31416faa5b1b2fe",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -116,6 +116,10 @@ export interface RenderOptsPartial {\n     htmlRequestId: string,\n     requestId: string\n   ) => void\n+  sendErrorsToBrowser?: (\n+    errorsRscStream: ReadableStream<Uint8Array>,\n+    htmlRequestId: string\n+  ) => void\n   nextExport?: boolean\n   nextConfigOutput?: 'standalone' | 'export'\n   onInstrumentationRequestError?: ServerOnInstrumentationRequestError"
        },
        {
            "sha": "c0b9d4c8262ffa5b05a95212234139de47610ff2",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 7,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -126,6 +126,11 @@ import { recordMcpTelemetry } from '../mcp/mcp-telemetry-tracker'\n import { getFileLogger } from './browser-logs/file-logger'\n import type { ServerCacheStatus } from '../../next-devtools/dev-overlay/cache-indicator'\n import type { Lockfile } from '../../build/lockfile'\n+import {\n+  sendSerializedErrorsToClient,\n+  sendSerializedErrorsToClientForHtmlRequest,\n+  setErrorsRscStreamForHtmlRequest,\n+} from './serialized-errors'\n \n const wsServer = new ws.Server({ noServer: true })\n const isTestMode = !!(\n@@ -908,6 +913,16 @@ export async function createHotReloaderTurbopack(\n           } else {\n             onUpgrade(client, { isLegacyClient: true })\n           }\n+\n+          connectReactDebugChannelForHtmlRequest(\n+            htmlRequestId,\n+            sendToClient.bind(null, client)\n+          )\n+\n+          sendSerializedErrorsToClientForHtmlRequest(\n+            htmlRequestId,\n+            sendToClient.bind(null, client)\n+          )\n         } else {\n           clientsWithoutHtmlRequestId.add(client)\n           onUpgrade(client, { isLegacyClient: true })\n@@ -1099,13 +1114,6 @@ export async function createHotReloaderTurbopack(\n           }\n \n           sendToClient(client, syncMessage)\n-\n-          if (htmlRequestId) {\n-            connectReactDebugChannelForHtmlRequest(\n-              htmlRequestId,\n-              sendToClient.bind(null, client)\n-            )\n-          }\n         })()\n       })\n     },\n@@ -1186,6 +1194,22 @@ export async function createHotReloaderTurbopack(\n       }\n     },\n \n+    sendErrorsToBrowser(errorsRscStream, htmlRequestId) {\n+      const client = clientsByHtmlRequestId.get(htmlRequestId)\n+\n+      if (client) {\n+        // If the client is connected, we can send the errors immediately.\n+        sendSerializedErrorsToClient(\n+          errorsRscStream,\n+          sendToClient.bind(null, client)\n+        )\n+      } else {\n+        // Otherwise, store the errors stream so that we can send it when the\n+        // client connects.\n+        setErrorsRscStreamForHtmlRequest(htmlRequestId, errorsRscStream)\n+      }\n+    },\n+\n     setHmrServerError(_error) {\n       // Not implemented yet.\n     },"
        },
        {
            "sha": "20250260079e8def4975ba85d5b52c8c3883924e",
            "filename": "packages/next/src/server/dev/hot-reloader-types.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -40,6 +40,7 @@ export const enum HMR_MESSAGE_SENT_TO_BROWSER {\n \n   // Binary messages:\n   REACT_DEBUG_CHUNK = 0,\n+  ERRORS_TO_SHOW_IN_BROWSER = 1,\n }\n \n export const enum HMR_MESSAGE_SENT_TO_SERVER {\n@@ -157,6 +158,11 @@ export interface ReactDebugChunkMessage {\n   chunk: Uint8Array | null\n }\n \n+export interface ErrorsToShowInBrowserMessage {\n+  type: HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER\n+  serializedErrors: Uint8Array\n+}\n+\n export interface RequestCurrentErrorStateMessage {\n   type: HMR_MESSAGE_SENT_TO_BROWSER.REQUEST_CURRENT_ERROR_STATE\n   requestId: string\n@@ -189,6 +195,7 @@ export type HmrMessageSentToBrowser =\n   | ServerErrorMessage\n   | AppIsrManifestMessage\n   | DevToolsConfigMessage\n+  | ErrorsToShowInBrowserMessage\n   | ReactDebugChunkMessage\n   | RequestCurrentErrorStateMessage\n   | RequestPageMetadataMessage\n@@ -235,6 +242,10 @@ export interface NextJsHotReloaderInterface {\n     htmlRequestId: string,\n     requestId: string\n   ): void\n+  sendErrorsToBrowser(\n+    errorsRscStream: ReadableStream<Uint8Array>,\n+    htmlRequestId: string\n+  ): void\n   getCompilationErrors(page: string): Promise<any[]>\n   onHMR(\n     req: IncomingMessage,"
        },
        {
            "sha": "ae9fb6a7a292005cd4914dab385fbb2fcb5e0185",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -115,6 +115,11 @@ import { recordMcpTelemetry } from '../mcp/mcp-telemetry-tracker'\n import { getFileLogger } from './browser-logs/file-logger'\n import type { ServerCacheStatus } from '../../next-devtools/dev-overlay/cache-indicator'\n import type { Lockfile } from '../../build/lockfile'\n+import {\n+  sendSerializedErrorsToClient,\n+  sendSerializedErrorsToClientForHtmlRequest,\n+  setErrorsRscStreamForHtmlRequest,\n+} from './serialized-errors'\n \n const MILLISECONDS_IN_NANOSECOND = BigInt(1_000_000)\n \n@@ -646,6 +651,12 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n           htmlRequestId,\n           this.sendToClient.bind(this, client)\n         )\n+\n+        sendSerializedErrorsToClientForHtmlRequest(\n+          htmlRequestId,\n+          this.sendToClient.bind(this, client)\n+        )\n+\n         if (enableCacheComponents) {\n           const status = this.cacheStatusesByRequestId.get(htmlRequestId)\n           if (status) {\n@@ -1801,6 +1812,25 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n     }\n   }\n \n+  public sendErrorsToBrowser(\n+    errorsRscStream: ReadableStream<Uint8Array>,\n+    htmlRequestId: string\n+  ): void {\n+    const client = this.webpackHotMiddleware?.getClient(htmlRequestId)\n+\n+    if (client) {\n+      // If the client is connected, we can send the errors immediately.\n+      sendSerializedErrorsToClient(\n+        errorsRscStream,\n+        this.sendToClient.bind(this, client)\n+      )\n+    } else {\n+      // Otherwise, store the errors stream so that we can send it when the\n+      // client connects.\n+      setErrorsRscStreamForHtmlRequest(htmlRequestId, errorsRscStream)\n+    }\n+  }\n+\n   public async ensurePage({\n     page,\n     clientOnly,"
        },
        {
            "sha": "0bd9a1295ec1f6707f6e89cfb18e40f4b0b0728e",
            "filename": "packages/next/src/server/dev/messages.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmessages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmessages.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -13,6 +13,17 @@ export function createBinaryHmrMessageData(\n   message: BinaryHmrMessageSentToBrowser\n ): Uint8Array {\n   switch (message.type) {\n+    case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER: {\n+      const { serializedErrors } = message\n+      const totalLength = 1 + serializedErrors.length\n+      const data = new Uint8Array(totalLength)\n+      const view = new DataView(data.buffer)\n+\n+      view.setUint8(0, HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER)\n+      data.set(serializedErrors, 1)\n+\n+      return data\n+    }\n     case HMR_MESSAGE_SENT_TO_BROWSER.REACT_DEBUG_CHUNK: {\n       const { requestId, chunk } = message\n       const requestIdBytes = textEncoder.encode(requestId)\n@@ -41,7 +52,7 @@ export function createBinaryHmrMessageData(\n     }\n     default: {\n       throw new InvariantError(\n-        `Invalid binary HMR message of type ${message.type}`\n+        `Invalid binary HMR message of type ${(message as any).type}`\n       )\n     }\n   }"
        },
        {
            "sha": "9b80f6ed3a46325f3c746de2c927f1a39db4fbae",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -833,7 +833,7 @@ export default class DevServer extends Server {\n             // Ideally, we would want to compare the whole objects, but that is too expensive.\n             result.prerenderedRoutes?.length !== prerenderedRoutes?.length\n           ) {\n-            this.bundlerService.triggerHMR({\n+            this.bundlerService.sendHmrMessage({\n               type: HMR_MESSAGE_SENT_TO_BROWSER.SERVER_COMPONENT_CHANGES,\n               hash: `generateStaticParams-${Date.now()}`,\n             })"
        },
        {
            "sha": "41774a52ced6bc569b607616b89443a540bda76e",
            "filename": "packages/next/src/server/dev/serialized-errors.ts",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fserialized-errors.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fserialized-errors.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fserialized-errors.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -0,0 +1,55 @@\n+import { streamToUint8Array } from '../stream-utils/node-web-streams-helper'\n+import {\n+  HMR_MESSAGE_SENT_TO_BROWSER,\n+  type HmrMessageSentToBrowser,\n+} from './hot-reloader-types'\n+\n+const errorsRscStreamsByHtmlRequestId = new Map<\n+  string,\n+  ReadableStream<Uint8Array>\n+>()\n+\n+export function sendSerializedErrorsToClient(\n+  errorsRscStream: ReadableStream<Uint8Array>,\n+  sendToClient: (message: HmrMessageSentToBrowser) => void\n+) {\n+  streamToUint8Array(errorsRscStream).then(\n+    (serializedErrors) => {\n+      sendToClient({\n+        type: HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER,\n+        serializedErrors,\n+      })\n+    },\n+    (err) => {\n+      console.error(new Error('Failed to serialize errors.', { cause: err }))\n+    }\n+  )\n+}\n+\n+export function sendSerializedErrorsToClientForHtmlRequest(\n+  htmlRequestId: string,\n+  sendToClient: (message: HmrMessageSentToBrowser) => void\n+) {\n+  const errorsRscStream = errorsRscStreamsByHtmlRequestId.get(htmlRequestId)\n+\n+  if (!errorsRscStream) {\n+    return\n+  }\n+\n+  errorsRscStreamsByHtmlRequestId.delete(htmlRequestId)\n+\n+  sendSerializedErrorsToClient(errorsRscStream, sendToClient)\n+}\n+\n+export function setErrorsRscStreamForHtmlRequest(\n+  htmlRequestId: string,\n+  errorsRscStream: ReadableStream<Uint8Array>\n+) {\n+  // TODO: Clean up after a timeout, in case the client never connects, e.g.\n+  // when CURL'ing the page, or loading the page with JavaScript disabled etc.\n+  errorsRscStreamsByHtmlRequestId.set(htmlRequestId, errorsRscStream)\n+}\n+\n+export function deleteErrorsRscStreamForHtmlRequest(htmlRequestId: string) {\n+  errorsRscStreamsByHtmlRequestId.delete(htmlRequestId)\n+}"
        },
        {
            "sha": "59512b08bbcaab5024cacb1a2868f4c7529d0263",
            "filename": "packages/next/src/server/lib/dev-bundler-service.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 26,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -7,16 +7,19 @@ import { createRequestResponseMocks } from './mock-request'\n import {\n   HMR_MESSAGE_SENT_TO_BROWSER,\n   type HmrMessageSentToBrowser,\n+  type NextJsHotReloaderInterface,\n } from '../dev/hot-reloader-types'\n-import type { ReactDebugChannelForBrowser } from '../dev/debug-channel'\n-import type { ServerCacheStatus } from '../../next-devtools/dev-overlay/cache-indicator'\n \n /**\n  * The DevBundlerService provides an interface to perform tasks with the\n  * bundler while in development.\n  */\n export class DevBundlerService {\n   public appIsrManifestInner: InstanceType<typeof LRUCache<boolean>>\n+  public close: NextJsHotReloaderInterface['close']\n+  public setCacheStatus: NextJsHotReloaderInterface['setCacheStatus']\n+  public setReactDebugChannel: NextJsHotReloaderInterface['setReactDebugChannel']\n+  public sendErrorsToBrowser: NextJsHotReloaderInterface['sendErrorsToBrowser']\n \n   constructor(\n     private readonly bundler: DevBundler,\n@@ -29,6 +32,14 @@ export class DevBundlerService {\n         return 16\n       }\n     )\n+\n+    const { hotReloader } = bundler\n+\n+    this.close = hotReloader.close.bind(hotReloader)\n+    this.setCacheStatus = hotReloader.setCacheStatus.bind(hotReloader)\n+    this.setReactDebugChannel =\n+      hotReloader.setReactDebugChannel.bind(hotReloader)\n+    this.sendErrorsToBrowser = hotReloader.sendErrorsToBrowser.bind(hotReloader)\n   }\n \n   public ensurePage: typeof this.bundler.hotReloader.ensurePage = async (\n@@ -99,13 +110,6 @@ export class DevBundlerService {\n     return serializableManifest\n   }\n \n-  public setCacheStatus(\n-    status: ServerCacheStatus,\n-    htmlRequestId: string\n-  ): void {\n-    this.bundler.hotReloader.setCacheStatus(status, htmlRequestId)\n-  }\n-\n   public setIsrStatus(key: string, value: boolean | undefined) {\n     if (value === undefined) {\n       this.appIsrManifestInner.remove(key)\n@@ -125,23 +129,7 @@ export class DevBundlerService {\n     })\n   }\n \n-  public setReactDebugChannel(\n-    debugChannel: ReactDebugChannelForBrowser,\n-    htmlRequestId: string,\n-    requestId: string\n-  ): void {\n-    this.bundler.hotReloader.setReactDebugChannel(\n-      debugChannel,\n-      htmlRequestId,\n-      requestId\n-    )\n-  }\n-\n-  public close() {\n-    this.bundler.hotReloader.close()\n-  }\n-\n-  public triggerHMR(message: HmrMessageSentToBrowser) {\n+  public sendHmrMessage(message: HmrMessageSentToBrowser) {\n     this.bundler.hotReloader.send(message)\n   }\n }"
        },
        {
            "sha": "03d93f0ba5eb7d8d9964c73d59cab12fd7b8dafb",
            "filename": "packages/next/src/server/lib/router-server.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -730,6 +730,8 @@ export async function initialize(opts: {\n     setReactDebugChannel: config.experimental.reactDebugChannel\n       ? devBundlerService?.setReactDebugChannel.bind(devBundlerService)\n       : undefined,\n+    sendErrorsToBrowser:\n+      devBundlerService?.sendErrorsToBrowser.bind(devBundlerService),\n   }\n \n   const logError = async ("
        },
        {
            "sha": "10c646efd206ca6b156cd42dc6ecb20ca41542d2",
            "filename": "packages/next/src/server/lib/router-utils/router-server-context.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -45,6 +45,10 @@ export type RouterServerContext = Record<\n       requestId: string\n     ) => void\n     setCacheStatus?: (status: ServerCacheStatus, htmlRequestId: string) => void\n+    sendErrorsToBrowser?: (\n+      errorsRscStream: ReadableStream<Uint8Array>,\n+      htmlRequestId: string\n+    ) => void\n   }\n >\n "
        },
        {
            "sha": "86fde7b2045c9913aa2c11aaf3b9a74f1903d15d",
            "filename": "packages/next/src/server/stream-utils/node-web-streams-helper.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 4,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fstream-utils%2Fnode-web-streams-helper.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -96,11 +96,11 @@ export function streamFromBuffer(chunk: Buffer): ReadableStream<Uint8Array> {\n   })\n }\n \n-export async function streamToBuffer(\n+async function streamToChunks(\n   stream: ReadableStream<Uint8Array>\n-): Promise<Buffer> {\n+): Promise<Array<Uint8Array>> {\n   const reader = stream.getReader()\n-  const chunks: Uint8Array[] = []\n+  const chunks: Array<Uint8Array> = []\n \n   while (true) {\n     const { done, value } = await reader.read()\n@@ -111,7 +111,30 @@ export async function streamToBuffer(\n     chunks.push(value)\n   }\n \n-  return Buffer.concat(chunks)\n+  return chunks\n+}\n+\n+function concatUint8Arrays(chunks: Array<Uint8Array>): Uint8Array {\n+  const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0)\n+  const result = new Uint8Array(totalLength)\n+  let offset = 0\n+  for (const chunk of chunks) {\n+    result.set(chunk, offset)\n+    offset += chunk.length\n+  }\n+  return result\n+}\n+\n+export async function streamToUint8Array(\n+  stream: ReadableStream<Uint8Array>\n+): Promise<Uint8Array> {\n+  return concatUint8Arrays(await streamToChunks(stream))\n+}\n+\n+export async function streamToBuffer(\n+  stream: ReadableStream<Uint8Array>\n+): Promise<Buffer> {\n+  return Buffer.concat(await streamToChunks(stream))\n }\n \n export async function streamToString("
        },
        {
            "sha": "7d5228a116b5673e66a3adfc95cdaae243429680",
            "filename": "test/development/app-dir/cache-components-dev-errors/cache-components-dev-errors.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-errors%2Fcache-components-dev-errors.test.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -30,7 +30,6 @@ describe('Cache Components Dev Errors', () => {\n        \"stack\": [\n          \"Page app/error/page.tsx (2:23)\",\n          \"Page <anonymous>\",\n-         \"ReportValidation <anonymous>\",\n        ],\n      }\n     `)\n@@ -60,7 +59,6 @@ describe('Cache Components Dev Errors', () => {\n        \"stack\": [\n          \"Page app/error/page.tsx (2:23)\",\n          \"Page <anonymous>\",\n-         \"ReportValidation <anonymous>\",\n        ],\n      }\n     `)\n@@ -118,7 +116,6 @@ describe('Cache Components Dev Errors', () => {\n          |         ^\",\n        \"stack\": [\n          \"Page app/no-accessed-data/page.js (2:9)\",\n-         \"ReportValidation <anonymous>\",\n        ],\n      }\n     `)"
        },
        {
            "sha": "860eac9a57292c77a2e60d025978d36e6f18efdb",
            "filename": "test/development/app-dir/cache-components-dev-fallback-validation/cache-components-dev-fallback-validation.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-fallback-validation%2Fcache-components-dev-fallback-validation.test.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -74,7 +74,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -103,7 +102,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -135,7 +133,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -164,7 +161,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -196,7 +192,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -225,7 +220,6 @@ describe('Cache Components Fallback Validation', () => {\n            |                          ^\",\n          \"stack\": [\n            \"Page app/partial/[top]/unwrapped/[bottom]/page.tsx (6:26)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -261,7 +255,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -290,7 +283,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -322,7 +314,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -351,7 +342,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -383,7 +373,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -412,7 +401,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/wrapped/layout.tsx (10:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -444,7 +432,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -473,7 +460,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -505,7 +491,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -534,7 +519,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -566,7 +550,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)\n@@ -595,7 +578,6 @@ describe('Cache Components Fallback Validation', () => {\n             |   ^\",\n          \"stack\": [\n            \"Layout app/none/[top]/unwrapped/layout.tsx (8:3)\",\n-           \"ReportValidation <anonymous>\",\n          ],\n        }\n       `)"
        },
        {
            "sha": "c2bd55a8c5c854897bfadbbbc4d364dc08dcaa90",
            "filename": "test/development/app-dir/react-performance-track/react-performance-track.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -112,12 +112,7 @@ describe('react-performance-track', () => {\n \n     const track = await browser.eval('window.reactServerRequests.getSnapshot()')\n     // TODO: Should include \"draftMode [Prefetchable]\".\n-    expect(track).toEqual([\n-      {\n-        name: '\\u200b',\n-        properties: [],\n-      },\n-    ])\n+    expect(track).toEqual([])\n   })\n \n   it('should show headers', async () => {"
        },
        {
            "sha": "970c7d06c921258c6eadb207698364ce66f49e0b",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-errors.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -107,7 +107,6 @@ describe('Cache Components Errors', () => {\n                |         ^\",\n              \"stack\": [\n                \"Module.generateMetadata app/dynamic-metadata-static-route/page.tsx (2:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -174,7 +173,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"Dynamic app/dynamic-metadata-error-route/page.tsx (21:9)\",\n                \"Page app/dynamic-metadata-error-route/page.tsx (15:7)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -298,7 +296,6 @@ describe('Cache Components Errors', () => {\n                |         ^\",\n              \"stack\": [\n                \"Module.generateMetadata app/dynamic-metadata-static-with-suspense/page.tsx (2:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -389,7 +386,6 @@ describe('Cache Components Errors', () => {\n                |         ^\",\n              \"stack\": [\n                \"Module.generateViewport app/dynamic-viewport-static-route/page.tsx (2:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -455,7 +451,6 @@ describe('Cache Components Errors', () => {\n                |         ^\",\n              \"stack\": [\n                \"Module.generateViewport app/dynamic-viewport-dynamic-route/page.tsx (4:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -543,7 +538,6 @@ describe('Cache Components Errors', () => {\n                  \"fetchRandom app/dynamic-root/page.tsx (63:26)\",\n                  \"FetchingComponent app/dynamic-root/page.tsx (46:50)\",\n                  \"Page app/dynamic-root/page.tsx (23:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              },\n              {\n@@ -569,7 +563,6 @@ describe('Cache Components Errors', () => {\n                  \"fetchRandom app/dynamic-root/page.tsx (63:26)\",\n                  \"FetchingComponent app/dynamic-root/page.tsx (46:50)\",\n                  \"Page app/dynamic-root/page.tsx (28:7)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              },\n            ]\n@@ -779,7 +772,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"RandomReadingComponent app/sync-random-with-fallback/page.tsx (37:23)\",\n                  \"Page app/sync-random-with-fallback/page.tsx (18:11)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -890,7 +882,6 @@ describe('Cache Components Errors', () => {\n                  \"getRandomNumber app/sync-random-without-fallback/page.tsx (32:15)\",\n                  \"RandomReadingComponent app/sync-random-without-fallback/page.tsx (40:18)\",\n                  \"Page app/sync-random-without-fallback/page.tsx (18:11)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -1793,7 +1784,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIO app/sync-attribution/guarded-async-unguarded-clientsync/client.tsx (5:16)\",\n                  \"Page app/sync-attribution/guarded-async-unguarded-clientsync/page.tsx (22:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -1917,7 +1907,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"RequestData app/sync-attribution/unguarded-async-guarded-clientsync/page.tsx (34:18)\",\n                  \"Page app/sync-attribution/unguarded-async-guarded-clientsync/page.tsx (27:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -2058,7 +2047,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIO app/sync-attribution/unguarded-async-unguarded-clientsync/client.tsx (5:16)\",\n                  \"Page app/sync-attribution/unguarded-async-unguarded-clientsync/page.tsx (22:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -2686,7 +2674,6 @@ describe('Cache Components Errors', () => {\n                \"source\": null,\n                \"stack\": [\n                  \"Page [Prerender] <anonymous>\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -3093,7 +3080,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"Private app/use-cache-private-without-suspense/page.tsx (15:1)\",\n                  \"Page app/use-cache-private-without-suspense/page.tsx (10:7)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -3253,7 +3239,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"DateReadingComponent app/sync-io-current-time/date/page.tsx (19:16)\",\n                \"Page app/sync-io-current-time/date/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3356,7 +3341,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"DateReadingComponent app/sync-io-current-time/date-now/page.tsx (19:21)\",\n                \"Page app/sync-io-current-time/date-now/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3459,7 +3443,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"DateReadingComponent app/sync-io-current-time/new-date/page.tsx (19:16)\",\n                \"Page app/sync-io-current-time/new-date/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3562,7 +3545,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"SyncIOComponent app/sync-io-random/math-random/page.tsx (19:21)\",\n                \"Page app/sync-io-random/math-random/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3665,7 +3647,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"SyncIOComponent app/sync-io-web-crypto/get-random-value/page.tsx (20:10)\",\n                \"Page app/sync-io-web-crypto/get-random-value/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3771,7 +3752,6 @@ describe('Cache Components Errors', () => {\n              \"stack\": [\n                \"SyncIOComponent app/sync-io-web-crypto/random-uuid/page.tsx (19:23)\",\n                \"Page app/sync-io-web-crypto/random-uuid/page.tsx (11:9)\",\n-               \"ReportValidation <anonymous>\",\n              ],\n            }\n           `)\n@@ -3875,7 +3855,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-key-pair-sync/page.tsx (20:24)\",\n                  \"Page app/sync-io-node-crypto/generate-key-pair-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -3891,7 +3870,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-key-pair-sync/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/generate-key-pair-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -3999,7 +3977,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-key-sync/page.tsx (21:6)\",\n                  \"Page app/sync-io-node-crypto/generate-key-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4015,7 +3992,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-key-sync/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/generate-key-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4123,7 +4099,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-prime-sync/page.tsx (20:39)\",\n                  \"Page app/sync-io-node-crypto/generate-prime-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4139,7 +4114,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/generate-prime-sync/page.tsx (20:32)\",\n                  \"Page app/sync-io-node-crypto/generate-prime-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4247,7 +4221,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/get-random-values/page.tsx (21:10)\",\n                  \"Page app/sync-io-node-crypto/get-random-values/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4263,7 +4236,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/get-random-values/page.tsx (21:3)\",\n                  \"Page app/sync-io-node-crypto/get-random-values/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4371,7 +4343,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-bytes/page.tsx (20:24)\",\n                  \"Page app/sync-io-node-crypto/random-bytes/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4387,7 +4358,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-bytes/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/random-bytes/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4495,7 +4465,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-fill-sync/page.tsx (21:10)\",\n                  \"Page app/sync-io-node-crypto/random-fill-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4511,7 +4480,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-fill-sync/page.tsx (21:3)\",\n                  \"Page app/sync-io-node-crypto/random-fill-sync/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4619,7 +4587,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-int-between/page.tsx (20:24)\",\n                  \"Page app/sync-io-node-crypto/random-int-between/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4635,7 +4602,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-int-between/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/random-int-between/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4743,7 +4709,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-int-up-to/page.tsx (20:24)\",\n                  \"Page app/sync-io-node-crypto/random-int-up-to/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4759,7 +4724,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-int-up-to/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/random-int-up-to/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4867,7 +4831,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-uuid/page.tsx (20:24)\",\n                  \"Page app/sync-io-node-crypto/random-uuid/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)\n@@ -4883,7 +4846,6 @@ describe('Cache Components Errors', () => {\n                \"stack\": [\n                  \"SyncIOComponent app/sync-io-node-crypto/random-uuid/page.tsx (20:17)\",\n                  \"Page app/sync-io-node-crypto/random-uuid/page.tsx (12:9)\",\n-                 \"ReportValidation <anonymous>\",\n                ],\n              }\n             `)"
        }
    ],
    "stats": {
        "total": 612,
        "additions": 359,
        "deletions": 253
    }
}