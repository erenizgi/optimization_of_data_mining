{
    "author": "acdlite",
    "message": "Add deprecation warning for legacyBehavior prop (#77473)\n\nWe plan to remove this feature in v16. The deprecation warning includes\na link to the docs and an example of how to run a codemod.\n\n<img width=\"976\" alt=\"Screenshot 2025-03-24 at 12 51 05â€¯PM\"\nsrc=\"https://github.com/user-attachments/assets/e044e143-f88a-4f24-bb94-4dd8b46f6288\"\n/>",
    "sha": "5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
    "files": [
        {
            "sha": "1a8cd932c048b1de024da44e98e7161462618086",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -176,6 +176,7 @@ type InternalLinkProps = {\n    * Enable legacy link behavior, requiring an `<a>` tag to wrap the child content\n    * if the child is a string or number.\n    *\n+   * @deprecated This will be removed in v16\n    * @defaultValue `false`\n    * @see https://github.com/vercel/next.js/commit/489e65ed98544e69b0afd7e0cfc3f9f6c2b803b7\n    */\n@@ -670,9 +671,19 @@ export default function LinkComponent(\n     childProps.href = addBasePath(as)\n   }\n \n-  return legacyBehavior ? (\n-    React.cloneElement(child, childProps)\n-  ) : (\n+  if (legacyBehavior) {\n+    if (process.env.NODE_ENV === 'development') {\n+      console.error(\n+        '`legacyBehavior` is deprecated and will be removed in a future ' +\n+          'release. A codemod is available to upgrade your components:\\n\\n' +\n+          'npx @next/codemod@latest new-link .\\n\\n' +\n+          'Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components'\n+      )\n+    }\n+    return React.cloneElement(child, childProps)\n+  }\n+\n+  return (\n     <a {...restProps} {...childProps}>\n       {children}\n     </a>"
        },
        {
            "sha": "0ef8390cce5752a3ea48b70155123c257e171733",
            "filename": "packages/next/src/client/link.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -90,6 +90,7 @@ type InternalLinkProps = {\n   locale?: string | false\n   /**\n    * Enable legacy link behavior.\n+   * @deprecated This will be removed in v16\n    * @defaultValue `false`\n    * @see https://github.com/vercel/next.js/commit/489e65ed98544e69b0afd7e0cfc3f9f6c2b803b7\n    */\n@@ -665,9 +666,19 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n         addBasePath(addLocale(as, curLocale, router?.defaultLocale))\n     }\n \n-    return legacyBehavior ? (\n-      React.cloneElement(child, childProps)\n-    ) : (\n+    if (legacyBehavior) {\n+      if (process.env.NODE_ENV === 'development') {\n+        console.error(\n+          '`legacyBehavior` is deprecated and will be removed in a future ' +\n+            'release. A codemod is available to upgrade your components:\\n\\n' +\n+            'npx @next/codemod@latest new-link .\\n\\n' +\n+            'Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components'\n+        )\n+      }\n+      return React.cloneElement(child, childProps)\n+    }\n+\n+    return (\n       <a {...restProps} {...childProps}>\n         {children}\n       </a>"
        },
        {
            "sha": "e7077399c03ce1479a655dc647c0545b64531628",
            "filename": "test/e2e/app-dir/link-component-deprecations/app/layout.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Flayout.tsx?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "7aab2d0927c3887ccd7e6f36bdf39535ae1f4ca1",
            "filename": "test/e2e/app-dir/link-component-deprecations/app/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Fpage.tsx?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -0,0 +1,9 @@\n+import Link from 'next/link'\n+\n+export default function HomePage() {\n+  return (\n+    <Link legacyBehavior href=\"/target-page\">\n+      <a>Target page</a>\n+    </Link>\n+  )\n+}"
        },
        {
            "sha": "9b8e50c00c64d0b3616f93b5d96ea6ac4519130b",
            "filename": "test/e2e/app-dir/link-component-deprecations/app/target-page/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Ftarget-page%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Ftarget-page%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Fapp%2Ftarget-page%2Fpage.tsx?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -0,0 +1,5 @@\n+import Link from 'next/link'\n+\n+export default function TargetPage() {\n+  return <Link href=\"/\">Home</Link>\n+}"
        },
        {
            "sha": "bbd70586214c4a6da74604fbe4fc3d34705104db",
            "filename": "test/e2e/app-dir/link-component-deprecations/link-component-deprecations.test.ts",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Flink-component-deprecations.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Flink-component-deprecations.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Flink-component-deprecations%2Flink-component-deprecations.test.ts?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -0,0 +1,22 @@\n+import { nextTestSetup, isNextDev } from 'e2e-utils'\n+\n+describe('Link component deprecations', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('logs deprecation warning for legacyBehavior prop', async () => {\n+    const browser = await next.browser('/')\n+    const logs = await browser.log()\n+\n+    const didWarn = logs.some(\n+      (log) =>\n+        log.source === 'error' &&\n+        log.message.includes(\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        )\n+    )\n+\n+    expect(didWarn).toBe(isNextDev)\n+  })\n+})"
        },
        {
            "sha": "a649cc091f36f06e6cc8410249a0742848ce7e97",
            "filename": "test/integration/link-ref-app/test/index.test.js",
            "status": "modified",
            "additions": 20,
            "deletions": 4,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fintegration%2Flink-ref-app%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fintegration%2Flink-ref-app%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Flink-ref-app%2Ftest%2Findex.test.js?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -16,7 +16,7 @@ let app\n let appPort\n const appDir = join(__dirname, '..')\n \n-const noError = async (pathname) => {\n+const collectErrors = async (pathname) => {\n   const browser = await webdriver(appPort, '/')\n   await browser.eval(`(function() {\n     window.caughtErrors = []\n@@ -29,8 +29,14 @@ const noError = async (pathname) => {\n   })()`)\n   await waitFor(1000)\n   const errors = await browser.eval(`window.caughtErrors`)\n-  expect(errors).toEqual([])\n   await browser.close()\n+  return errors\n+}\n+\n+const noError = async (pathname) => {\n+  const errors = await collectErrors(pathname)\n+  expect(errors).toEqual([])\n+  return errors\n }\n \n const didPrefetch = async (pathname) => {\n@@ -80,11 +86,21 @@ describe('Invalid hrefs', () => {\n       runCommonTests()\n \n       it('should not show error for function component with forwardRef', async () => {\n-        await noError('/function')\n+        const errors = await collectErrors('/function')\n+        const legacyBehaviorDeprecation =\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        errors.forEach((error) => {\n+          expect(error).toContain(legacyBehaviorDeprecation)\n+        })\n       })\n \n       it('should not show error for class component as child of next/link', async () => {\n-        await noError('/class')\n+        const errors = await collectErrors('/class')\n+        const legacyBehaviorDeprecation =\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        errors.forEach((error) => {\n+          expect(error).toContain(legacyBehaviorDeprecation)\n+        })\n       })\n \n       it('should handle child ref with React.createRef', async () => {"
        },
        {
            "sha": "47f268106391bd0600b524f8976c7736a4c47572",
            "filename": "test/integration/link-ref-pages/test/index.test.js",
            "status": "modified",
            "additions": 20,
            "deletions": 4,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fintegration%2Flink-ref-pages%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4/test%2Fintegration%2Flink-ref-pages%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Flink-ref-pages%2Ftest%2Findex.test.js?ref=5a4f1140f06714e35b6fd0ac384d15f5cf9d16e4",
            "patch": "@@ -16,7 +16,7 @@ let app\n let appPort\n const appDir = join(__dirname, '..')\n \n-const noError = async (pathname) => {\n+const collectErrors = async (pathname) => {\n   const browser = await webdriver(appPort, '/')\n   await browser.eval(`(function() {\n     window.caughtErrors = []\n@@ -29,8 +29,14 @@ const noError = async (pathname) => {\n   })()`)\n   await waitFor(1000)\n   const errors = await browser.eval(`window.caughtErrors`)\n-  expect(errors).toEqual([])\n   await browser.close()\n+  return errors\n+}\n+\n+const noError = async (pathname) => {\n+  const errors = await collectErrors(pathname)\n+  expect(errors).toEqual([])\n+  return errors\n }\n \n const didPrefetch = async (pathname) => {\n@@ -74,11 +80,21 @@ describe('Invalid hrefs', () => {\n       runCommonTests()\n \n       it('should not show error for function component with forwardRef', async () => {\n-        await noError('/function')\n+        const errors = await collectErrors('/function')\n+        const legacyBehaviorDeprecation =\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        errors.forEach((error) => {\n+          expect(error).toContain(legacyBehaviorDeprecation)\n+        })\n       })\n \n       it('should not show error for class component as child of next/link', async () => {\n-        await noError('/class')\n+        const errors = await collectErrors('/class')\n+        const legacyBehaviorDeprecation =\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        errors.forEach((error) => {\n+          expect(error).toContain(legacyBehaviorDeprecation)\n+        })\n       })\n \n       it('should handle child ref with React.createRef', async () => {"
        }
    ],
    "stats": {
        "total": 125,
        "additions": 111,
        "deletions": 14
    }
}