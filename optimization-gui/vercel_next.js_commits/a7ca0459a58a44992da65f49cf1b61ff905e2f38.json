{
    "author": "acdlite",
    "message": "Fix: Missing null check in LRU cleanup (#87124)\n\nUnfortunately this field is not strongly typed because it's a cyclic\ntype and I wasn't able to soundly model it with TypeScript. Skill issue\nI'm sure.\n\nDon't have an exact repro yet but the previous code was obviously wrong.\n\nThe way this should have been structured regardless is to delete the\nwrapper MapEntry object instead of the value it contains. The\nnon-nullness of the wrapper object _is_ properly typed, and avoids an\nunnecessary indirection.\n\nAs a follow up, I'll look into how to model this type properly.",
    "sha": "a7ca0459a58a44992da65f49cf1b61ff905e2f38",
    "files": [
        {
            "sha": "f65c555778f8608fb6ed4aaa94a8ad15c5d03ffe",
            "filename": "packages/next/src/client/components/segment-cache/cache-map.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a7ca0459a58a44992da65f49cf1b61ff905e2f38/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7ca0459a58a44992da65f49cf1b61ff905e2f38/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts?ref=a7ca0459a58a44992da65f49cf1b61ff905e2f38",
            "patch": "@@ -396,7 +396,7 @@ function dropRef<V extends MapValue>(value: V): void {\n   value.ref = null\n }\n \n-function deleteMapEntry<V extends MapValue>(entry: MapEntry<V>): void {\n+export function deleteMapEntry<V extends MapValue>(entry: MapEntry<V>): void {\n   // Delete the entry from the cache.\n   const emptyEntry: EmptyMapEntry<V> = entry as any\n   emptyEntry.value = null"
        },
        {
            "sha": "1f4729a83560be0dad9353ac75e78555f76a95c3",
            "filename": "packages/next/src/client/components/segment-cache/lru.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a7ca0459a58a44992da65f49cf1b61ff905e2f38/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7ca0459a58a44992da65f49cf1b61ff905e2f38/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts?ref=a7ca0459a58a44992da65f49cf1b61ff905e2f38",
            "patch": "@@ -1,5 +1,5 @@\n import type { MapEntry } from './cache-map'\n-import { deleteFromCacheMap } from './cache-map'\n+import { deleteMapEntry } from './cache-map'\n \n // We use an LRU for memory management. We must update this whenever we add or\n // remove a new cache entry, or when an entry changes size.\n@@ -119,7 +119,7 @@ function cleanup() {\n     if (tail !== null) {\n       // Delete the entry from the map. In turn, this will remove it from\n       // the LRU.\n-      deleteFromCacheMap(tail.value)\n+      deleteMapEntry(tail)\n     }\n   }\n }"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 3,
        "deletions": 3
    }
}