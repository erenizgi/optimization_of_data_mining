{
    "author": "lukesandberg",
    "message": "Revert \"Revert \"[turbopack] Compute Import Traces for Issues\"\" (#80220)\n\nReverts vercel/next.js#80215 which was a revert of vercel/next.js#79351\n\nCloses PACK-4105",
    "sha": "19e8e3c3c2c8b59c810296037df2c818f80049d5",
    "files": [
        {
            "sha": "3a96a1952df54d6328986e4c29622c3b209060d4",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -9970,6 +9970,7 @@ dependencies = [\n  \"owo-colors 3.5.0\",\n  \"rustc-hash 2.1.1\",\n  \"serde\",\n+ \"turbo-rcstr\",\n  \"turbo-tasks\",\n  \"turbo-tasks-build\",\n  \"turbo-tasks-fs\","
        },
        {
            "sha": "dd8601121d60ac198889b536f2edf37a10bcf10c",
            "filename": "crates/napi/src/next_api/project.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -48,7 +48,7 @@ use turbopack_core::{\n     source_map::{OptionStringifiedSourceMap, SourceMap, Token},\n     version::{PartialUpdate, TotalUpdate, Update, VersionState},\n };\n-use turbopack_ecmascript_hmr_protocol::{ClientUpdateInstruction, ResourceIdentifier};\n+use turbopack_ecmascript_hmr_protocol::{ClientUpdateInstruction, Issue, ResourceIdentifier};\n use turbopack_trace_utils::{\n     exit::{ExitHandler, ExitReceiver},\n     filter_layer::FilterLayer,\n@@ -1079,7 +1079,7 @@ pub fn project_hmr_events(\n                 .collect();\n             let update_issues = issues\n                 .iter()\n-                .map(|issue| (&**issue).into())\n+                .map(|issue| Issue::from(&**issue))\n                 .collect::<Vec<_>>();\n \n             let identifier = ResourceIdentifier {"
        },
        {
            "sha": "4dd256c6d3e9038d468d4580c9b32d6264ac0455",
            "filename": "crates/napi/src/next_api/utils.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnapi%2Fsrc%2Fnext_api%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnapi%2Fsrc%2Fnext_api%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Futils.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -299,6 +299,7 @@ pub struct NapiIssue {\n     pub detail: Option<serde_json::Value>,\n     pub source: Option<NapiIssueSource>,\n     pub documentation_link: String,\n+    pub import_traces: serde_json::Value,\n }\n \n impl From<&PlainIssue> for NapiIssue {\n@@ -318,6 +319,7 @@ impl From<&PlainIssue> for NapiIssue {\n             severity: issue.severity.as_str().to_string(),\n             source: issue.source.as_ref().map(|source| source.into()),\n             title: serde_json::to_value(StyledStringSerialize::from(&issue.title)).unwrap(),\n+            import_traces: serde_json::to_value(&issue.import_traces).unwrap(),\n         }\n     }\n }"
        },
        {
            "sha": "b7522643e9daf88222765cba2d51f6496f3558d2",
            "filename": "crates/next-core/src/hmr_entry.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -3,7 +3,7 @@ use std::io::Write;\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{glob::Glob, rope::RopeBuilder};\n+use turbo_tasks_fs::{FileSystem, VirtualFileSystem, glob::Glob, rope::RopeBuilder};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n@@ -25,6 +25,17 @@ use turbopack_ecmascript::{\n     utils::StringifyJs,\n };\n \n+/// Each entry point in the HMR system has an ident with a different nested asset.\n+/// This produces the 'base' ident for the HMR entry point, which is then modified\n+#[turbo_tasks::function]\n+fn hmr_entry_point_base_ident() -> Vc<AssetIdent> {\n+    AssetIdent::from_path(\n+        VirtualFileSystem::new_with_name(rcstr!(\"hmr-entry\"))\n+            .root()\n+            .join(rcstr!(\"hmr-entry.js\")),\n+    )\n+}\n+\n #[turbo_tasks::value(shared)]\n pub struct HmrEntryModule {\n     pub ident: ResolvedVc<AssetIdent>,\n@@ -46,7 +57,7 @@ impl HmrEntryModule {\n impl Module for HmrEntryModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.ident.with_modifier(rcstr!(\"hmr-entry\"))\n+        hmr_entry_point_base_ident().with_asset(rcstr!(\"ENTRY\"), *self.ident)\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "38e789a68aaa40c46fd7657800e996ca5fbe67c1",
            "filename": "packages/next/src/build/swc/generated-native.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -356,6 +356,7 @@ export interface NapiIssue {\n   detail?: any\n   source?: NapiIssueSource\n   documentationLink: string\n+  importTraces: any\n }\n export interface NapiIssueSource {\n   source: NapiSource"
        },
        {
            "sha": "4fe137ec6f7efc58bfe0f86ae49c44ca694ae976",
            "filename": "packages/next/src/build/swc/types.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -95,6 +95,13 @@ export interface Issue {\n     }\n   }\n   documentationLink: string\n+  importTraces?: PlainTraceItem[][]\n+}\n+export interface PlainTraceItem {\n+  fsName: string\n+  path: string\n+  rootPath: string\n+  layer?: string\n }\n \n export interface Diagnostics {"
        },
        {
            "sha": "1a165b0979a6df805f4be1791bc5fdb5779450dc",
            "filename": "packages/next/src/shared/lib/turbopack/utils.ts",
            "status": "modified",
            "additions": 72,
            "deletions": 7,
            "changes": 79,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fturbopack%2Futils.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,5 +1,6 @@\n import type {\n   Issue,\n+  PlainTraceItem,\n   StyledString,\n   TurbopackResult,\n } from '../../../build/swc/types'\n@@ -129,9 +130,9 @@ export function processIssues(\n }\n \n export function formatIssue(issue: Issue) {\n-  const { filePath, title, description, source } = issue\n+  const { filePath, title, description, source, importTraces } = issue\n   let { documentationLink } = issue\n-  let formattedTitle = renderStyledStringToErrorAnsi(title).replace(\n+  const formattedTitle = renderStyledStringToErrorAnsi(title).replace(\n     /\\n/g,\n     '\\n    '\n   )\n@@ -144,14 +145,14 @@ export function formatIssue(issue: Issue) {\n     documentationLink = 'https://nextjs.org/docs/messages/module-not-found'\n   }\n \n-  let formattedFilePath = filePath\n+  const formattedFilePath = filePath\n     .replace('[project]/', './')\n     .replaceAll('/./', '/')\n     .replace('\\\\\\\\?\\\\', '')\n \n   let message = ''\n \n-  if (source && source.range) {\n+  if (source?.range) {\n     const { start } = source.range\n     message = `${formattedFilePath}:${start.line + 1}:${\n       start.column + 1\n@@ -209,15 +210,79 @@ export function formatIssue(issue: Issue) {\n   //   message += renderStyledStringToErrorAnsi(detail) + '\\n\\n'\n   // }\n \n-  // TODO: Include a trace from the issue.\n-\n+  if (importTraces?.length) {\n+    // This is the same logic as in turbopack/crates/turbopack-cli-utils/src/issue.rs\n+    if (importTraces.length > 1) {\n+      // We end up with multiple traces when the file with the error is reachable from multiple\n+      // different entry points (e.g. ssr, client)\n+      message += 'Example import traces:\\n'\n+      const tracesAndLayers: Array<[string | undefined, PlainTraceItem[]]> =\n+        importTraces.map((trace) => [getLayer(trace), trace])\n+      const everyTraceHasADistinctLayer =\n+        new Set(\n+          tracesAndLayers\n+            .map(([layer, _trace]) => layer)\n+            .filter((layer) => layer != null)\n+        ).size === tracesAndLayers.length\n+      for (let i = 0; i < tracesAndLayers.length; i++) {\n+        const [layer, trace] = tracesAndLayers[i]\n+        if (everyTraceHasADistinctLayer) {\n+          message += `  ${layer}:\\n`\n+        } else {\n+          message += `  #${i + 1}`\n+          if (layer) {\n+            message += ` [${layer}]`\n+          }\n+          message += ':\\n'\n+        }\n+        message += formatIssueTrace(trace, '    ', layer === undefined)\n+      }\n+    } else {\n+      const trace = importTraces[0]\n+      // We only display the layer if there is more than one for the trace\n+      message += `Example import trace:\\n${formatIssueTrace(trace, '  ', getLayer(trace) === undefined)}`\n+    }\n+  }\n   if (documentationLink) {\n     message += documentationLink + '\\n\\n'\n   }\n-\n   return message\n }\n \n+/** Returns the layer shared by all the items, or undefined if there isn't a unique one. */\n+function getLayer(items: PlainTraceItem[]): string | undefined {\n+  let array = Array.from(new Set(items.map((i) => i.layer)))\n+  if (array.length === 1) {\n+    return array[0]\n+  }\n+  return undefined\n+}\n+\n+function formatIssueTrace(\n+  items: PlainTraceItem[],\n+  indent: string,\n+  printLayers: boolean\n+): string {\n+  return (\n+    items\n+      .map((item) => {\n+        let r = indent\n+        if (item.fsName !== 'project') {\n+          r += `[${item.fsName}]/`\n+        } else {\n+          // This is consistent with webpack's output\n+          r += './'\n+        }\n+        r += item.path\n+        if (printLayers && item.layer) {\n+          r += ` [${item.layer}]`\n+        }\n+        return r\n+      })\n+      .join('\\n') + '\\n\\n'\n+  )\n+}\n+\n export function isRelevantWarning(issue: Issue): boolean {\n   return issue.severity === 'warning' && !isNodeModulesIssue(issue)\n }"
        },
        {
            "sha": "5e8ed66adad61dc2000d253f94f571e14c7285a3",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -464,7 +464,18 @@ describe('ReactRefreshLogBox app', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.module.css\n        Parsing css source code failed\n-       Selector is not pure (pure selectors must contain at least one local class or id), (lightningcss, Selector(button, specificity = 0x1))\",\n+       Selector is not pure (pure selectors must contain at least one local class or id), (lightningcss, Selector(button, specificity = 0x1))\n+       Example import traces:\n+         #1:\n+           ./index.module.css [app-client]\n+           ./index.js [app-client]\n+           ./app/page.js [app-client]\n+           ./app/page.js [app-rsc]\n+         #2:\n+           ./index.module.css [app-ssr]\n+           ./index.js [app-ssr]\n+           ./app/page.js [app-ssr]\n+           ./app/page.js [app-rsc]\",\n          \"stack\": [],\n        }\n       `)"
        },
        {
            "sha": "1c91ab960f765768dd1cb711722ba80220930195",
            "filename": "test/development/acceptance-app/rsc-build-errors.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -184,7 +184,11 @@ describe('Error overlay - RSC build errors', () => {\n          4 |   return 'client-only-lib'\n \n        You're importing a component that imports client-only. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.\n-       Learn more: https://nextjs.org/docs/app/building-your-application/rendering\"\n+       Learn more: https://nextjs.org/docs/app/building-your-application/rendering\n+\n+       Example import trace:\n+         ./app/server-with-errors/client-only-in-server/client-only-lib.js\n+         ./app/server-with-errors/client-only-in-server/page.js\"\n       `)\n     } else {\n       expect(await session.getRedboxSource()).toInclude("
        },
        {
            "sha": "1eba60eda1e56898c4b75ec5f0167be1e4018419",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -602,7 +602,16 @@ describe('ReactRefreshLogBox', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.module.css\n        Parsing css source code failed\n-       Selector is not pure (pure selectors must contain at least one local class or id), (lightningcss, Selector(button, specificity = 0x1))\",\n+       Selector is not pure (pure selectors must contain at least one local class or id), (lightningcss, Selector(button, specificity = 0x1))\n+       Example import traces:\n+         client:\n+           ./index.module.css\n+           ./index.js\n+           ./pages/index.js\n+         ssr:\n+           ./index.module.css\n+           ./index.js\n+           ./pages/index.js\",\n          \"stack\": [],\n        }\n       `)"
        },
        {
            "sha": "a213bc21c0f6495ae8bbbb71df80fb02a2f7325e",
            "filename": "test/development/acceptance/server-component-compiler-errors-in-pages.test.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 3,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -62,7 +62,16 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n          3 | export default function Page() {\n          4 |   return <p>hello world</p>\n \n-       You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+\n+       Example import traces:\n+         client:\n+           ./components/Comp.js\n+           ./pages/index.js\n+\n+         ssr:\n+           ./components/Comp.js\n+           ./pages/index.js\"\n       `)\n     } else if (isRspack) {\n       expect(\n@@ -138,7 +147,16 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n          3 | export default function Page() {\n          4 |   return 'hello world'\n \n-       You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+\n+       Example import traces:\n+         client:\n+           ./components/Comp.js\n+           ./pages/index.js\n+\n+         ssr:\n+           ./components/Comp.js\n+           ./pages/index.js\"\n       `)\n     } else if (isRspack) {\n       expect(\n@@ -216,7 +234,16 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n          3 | export default function Page() {\n          4 |   return 'hello world'\n \n-       You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+\n+       Example import traces:\n+         client:\n+           ./components/Comp.js\n+           ./pages/index.js\n+\n+         ssr:\n+           ./components/Comp.js\n+           ./pages/index.js\"\n       `)\n     } else if (isRspack) {\n       expect("
        },
        {
            "sha": "6095b537ed1161ace539d714c3f9f010994dfe57",
            "filename": "test/development/app-dir/server-component-next-dynamic-ssr-false/server-component-next-dynamic-ssr-false.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -23,18 +23,18 @@ describe('app-dir - server-component-next-dynamic-ssr-false', () => {\n         `\"Ecmascript file had an error\"`\n       )\n       expect(redbox.source).toMatchInlineSnapshot(`\n-         \"./app/page.js (3:23)\n-         Ecmascript file had an error\n-           1 | import dynamic from 'next/dynamic'\n-           2 |\n-         > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n-             |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-           4 |\n-           5 | export default function Page() {\n-           6 |   return <DynamicClient />\n+       \"./app/page.js (3:23)\n+       Ecmascript file had an error\n+         1 | import dynamic from 'next/dynamic'\n+         2 |\n+       > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n+           |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         4 |\n+         5 | export default function Page() {\n+         6 |   return <DynamicClient />\n \n-         \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a Client Component.\"\n-        `)\n+       \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a Client Component.\"\n+      `)\n     } else {\n       expect(redbox.description).toMatchInlineSnapshot(\n         `\"  x \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a Client Component.\"`"
        },
        {
            "sha": "0733830a3e7619441ed9104fa37a2f77d82be4dd",
            "filename": "test/development/basic/hmr/run-error-recovery-hmr-test.util.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 20,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fbasic%2Fhmr%2Frun-error-recovery-hmr-test.util.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fbasic%2Fhmr%2Frun-error-recovery-hmr-test.util.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fhmr%2Frun-error-recovery-hmr-test.util.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -165,16 +165,16 @@ export function runErrorRecoveryHmrTest(nextConfig: {\n \n     if (process.env.IS_TURBOPACK_TEST) {\n       expect(source).toMatchInlineSnapshot(`\n-         \"./pages/hmr/about2.js (7:1)\n-         Parsing ecmascript source code failed\n-           5 |     div\n-           6 |   )\n-         > 7 | }\n-             | ^\n-           8 |\n-\n-         Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n-        `)\n+       \"./pages/hmr/about2.js (7:1)\n+       Parsing ecmascript source code failed\n+         5 |     div\n+         6 |   )\n+       > 7 | }\n+           | ^\n+         8 |\n+\n+       Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+      `)\n     } else if (process.env.NEXT_RSPACK) {\n       expect(trimEndMultiline(source)).toMatchInlineSnapshot(`\n          \"./pages/hmr/about2.js\n@@ -602,17 +602,26 @@ export function runErrorRecoveryHmrTest(nextConfig: {\n       if (process.env.IS_TURBOPACK_TEST) {\n         expect(next.normalizeTestDirContent(redboxSource))\n           .toMatchInlineSnapshot(`\n-           \"./components/parse-error.js (3:1)\n-           Parsing ecmascript source code failed\n-             1 | This\n-             2 | is\n-           > 3 | }}}\n-               | ^\n-             4 | invalid\n-             5 | js\n+         \"./components/parse-error.js (3:1)\n+         Parsing ecmascript source code failed\n+           1 | This\n+           2 | is\n+         > 3 | }}}\n+             | ^\n+           4 | invalid\n+           5 | js\n \n-           Expression expected\"\n-          `)\n+         Expression expected\n+\n+         Example import traces:\n+           client:\n+             ./components/parse-error.js\n+             ./pages/hmr/about9.js\n+\n+           ssr:\n+             ./components/parse-error.js\n+             ./pages/hmr/about9.js\"\n+        `)\n       } else if (process.env.NEXT_RSPACK) {\n         expect(trimEndMultiline(next.normalizeTestDirContent(redboxSource)))\n           .toMatchInlineSnapshot(`"
        },
        {
            "sha": "23119d1a0b011a53345612a71ac8e8058709fa4e",
            "filename": "test/development/internal-traces/internal-traces.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Finternal-traces%2Finternal-traces.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Finternal-traces%2Finternal-traces.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Finternal-traces%2Finternal-traces.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,5 +1,5 @@\n import { FileRef, nextTestSetup } from 'e2e-utils'\n-import path from 'path'\n+import path from 'node:path'\n \n describe('internal traces', () => {\n   const { next } = nextTestSetup({\n@@ -8,7 +8,7 @@ describe('internal traces', () => {\n \n   it('should not write long internal traces to stdio', async () => {\n     await next.render$('/traces')\n-    expect(next.cliOutput.length).toBeLessThan(128 * 1024 /* 128kb of ascii */)\n+    expect(next.cliOutput.length).toBeLessThan(256 * 1024 /* 256KiB of ascii */)\n     expect(next.cliOutput).not.toContain(\n       'https://nextjs.org/docs/messages/large-page-data'\n     )"
        },
        {
            "sha": "72b40473e63e2b4cc30ceebe3ad53c8381282594",
            "filename": "test/development/sass-error/index.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fsass-error%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fdevelopment%2Fsass-error%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fsass-error%2Findex.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -36,7 +36,12 @@ describe('app dir - css', () => {\n              47 | }\n              48 |\n \n-           Pseudo-elements like '::before' or '::after' can't be followed by selectors like 'Ident(\"path\")' at [project]/app/global.scss.css:0:884\"\n+           Pseudo-elements like '::before' or '::after' can't be followed by selectors like 'Ident(\"path\")' at [project]/app/global.scss.css:0:884\n+\n+           Example import trace:\n+             ./app/global.scss.css [app-client]\n+             ./app/layout.js [app-client]\n+             ./app/layout.js [app-rsc]\"\n           `)\n         })\n       }"
        },
        {
            "sha": "d7b328d43bc8a8c4c45e198e7658adb6c1e145fa",
            "filename": "test/e2e/app-dir/use-cache-unknown-cache-kind/use-cache-unknown-cache-kind.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -140,16 +140,16 @@ describe('use-cache-unknown-cache-kind', () => {\n \n       if (isTurbopack) {\n         expect(errorSource).toMatchInlineSnapshot(`\n-           \"./app/page.tsx (1:1)\n-           Ecmascript file had an error\n-           > 1 | 'use cache: custom'\n-               | ^^^^^^^^^^^^^^^^^^^\n-             2 |\n-             3 | export default async function Page() {\n-             4 |   return <p>hello world</p>\n-\n-           Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"\n-          `)\n+         \"./app/page.tsx (1:1)\n+         Ecmascript file had an error\n+         > 1 | 'use cache: custom'\n+             | ^^^^^^^^^^^^^^^^^^^\n+           2 |\n+           3 | export default async function Page() {\n+           4 |   return <p>hello world</p>\n+\n+         Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"\n+        `)\n       } else if (isRspack) {\n         expect(errorSource).toMatchInlineSnapshot(`\n          \"./app/page.tsx"
        },
        {
            "sha": "f9a6980755f52da2b6fce1830bf6df0910a77eb9",
            "filename": "test/integration/next-image-new/invalid-image-import/test/index.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fintegration%2Fnext-image-new%2Finvalid-image-import%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/test%2Fintegration%2Fnext-image-new%2Finvalid-image-import%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Finvalid-image-import%2Ftest%2Findex.test.ts?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -34,12 +34,21 @@ function runTests({ isDev }) {\n       const source = await getRedboxSource(browser)\n       if (process.env.IS_TURBOPACK_TEST) {\n         expect(source).toMatchInlineSnapshot(`\n-          \"./test/integration/next-image-new/invalid-image-import/public/invalid.svg\n-          Processing image failed\n-          Failed to parse svg source code for image dimensions\n+         \"./test/integration/next-image-new/invalid-image-import/public/invalid.svg\n+         Processing image failed\n+         Failed to parse svg source code for image dimensions\n \n-          Caused by:\n-          - Source code does not contain a <svg> root element\"\n+         Caused by:\n+         - Source code does not contain a <svg> root element\n+\n+         Example import traces:\n+           #1:\n+             ./test/integration/next-image-new/invalid-image-import/public/invalid.svg\n+             ./test/integration/next-image-new/invalid-image-import/pages/index.js [client]\n+\n+           #2:\n+             ./test/integration/next-image-new/invalid-image-import/public/invalid.svg\n+             ./test/integration/next-image-new/invalid-image-import/pages/index.js [ssr]\"\n         `)\n       } else {\n         expect(source).toMatchInlineSnapshot(`"
        },
        {
            "sha": "c72ccf420504803dade25f93a1fe25157990d371",
            "filename": "turbopack/crates/turbo-rcstr/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -337,7 +337,7 @@ pub const fn inline_atom(s: &str) -> Option<RcStr> {\n /// allocates the RcStr inline when possible otherwise uses a `LazyLock` to manage the allocation.\n #[macro_export]\n macro_rules! rcstr {\n-    ($s:tt) => {{\n+    ($s:expr) => {{\n         const INLINE: core::option::Option<$crate::RcStr> = $crate::inline_atom($s);\n         // this condition should be able to be compile time evaluated and inlined.\n         if INLINE.is_some() {\n@@ -445,6 +445,7 @@ mod tests {\n         assert_eq!(rcstr!(\"abcdefgh\"), RcStr::from(\"abcdefgh\"));\n         assert_eq!(rcstr!(\"abcdefghi\"), RcStr::from(\"abcdefghi\"));\n     }\n+\n     #[test]\n     fn test_inline_atom() {\n         // This is a silly test, just asserts that we can evaluate this in a constant context."
        },
        {
            "sha": "e7e96dfb17cbd9bc8be5435ff41fea56685d74cd",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1016,7 +1016,7 @@ pub fn get_relative_path_to(path: &str, other_path: &str) -> String {\n }\n \n #[turbo_tasks::value]\n-#[derive(Debug, Clone)]\n+#[derive(Debug, Clone, Hash)]\n pub struct FileSystemPath {\n     pub fs: ResolvedVc<Box<dyn FileSystem>>,\n     pub path: RcStr,"
        },
        {
            "sha": "8c619f50e38952b271b834af395d9e05b5374867",
            "filename": "turbopack/crates/turbo-tasks/src/manager.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1724,8 +1724,8 @@ pub fn mark_session_dependent() {\n     });\n }\n \n-/// Marks the current task as finished. This excludes it from waiting for\n-/// strongly consistency.\n+/// Marks the current task as a root in the aggregation graph.  This means it starts with the\n+/// correct aggregation number instead of needing to recompute it after the fact.\n pub fn mark_root() {\n     with_turbo_tasks(|tt| {\n         tt.set_own_task_aggregation_number(current_task(\"turbo_tasks::mark_root()\"), u32::MAX)"
        },
        {
            "sha": "9d0ecc15bf92a16ab90d84cbf4bdc499e8010ba6",
            "filename": "turbopack/crates/turbopack-cli-utils/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-cli-utils%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-cli-utils%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli-utils%2FCargo.toml?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -21,6 +21,7 @@ crossterm = \"0.26.0\"\n owo-colors = { workspace = true }\n rustc-hash = { workspace = true }\n serde = { workspace = true, features = [\"derive\"] }\n+turbo-rcstr = { workspace = true }\n turbo-tasks = { workspace = true }\n turbo-tasks-fs = { workspace = true }\n turbopack-core = { workspace = true }"
        },
        {
            "sha": "c063278284e92eda06edd2caf66d7951d80cf358",
            "filename": "turbopack/crates/turbopack-cli-utils/src/issue.rs",
            "status": "modified",
            "additions": 102,
            "deletions": 14,
            "changes": 116,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fissue.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -12,11 +12,12 @@ use anyhow::{Result, anyhow};\n use crossterm::style::{StyledContent, Stylize};\n use owo_colors::{OwoColorize as _, Style};\n use rustc_hash::{FxHashMap, FxHashSet};\n-use turbo_tasks::{RawVc, ReadRef, TransientInstance, TransientValue, TryJoinIterExt, Vc};\n+use turbo_rcstr::RcStr;\n+use turbo_tasks::{RawVc, ReadRef, TransientInstance, TransientValue, Vc};\n use turbo_tasks_fs::{FileLinesContent, source_context::get_source_context};\n use turbopack_core::issue::{\n-    CapturedIssues, Issue, IssueReporter, IssueSeverity, PlainIssue, PlainIssueProcessingPathItem,\n-    PlainIssueSource, StyledString,\n+    CapturedIssues, IssueReporter, IssueSeverity, PlainIssue, PlainIssueProcessingPathItem,\n+    PlainIssueSource, PlainTraceItem, StyledString,\n };\n \n use crate::source_context::format_source_context_lines;\n@@ -141,7 +142,7 @@ pub fn format_issue(\n         .replace(\"[project]\", &current_dir.to_string_lossy())\n         .replace(\"/./\", \"/\")\n         .replace(\"\\\\\\\\?\\\\\", \"\");\n-    let stgae = plain_issue.stage.to_string();\n+    let stage = plain_issue.stage.to_string();\n \n     let mut styled_issue = style_issue_source(plain_issue, &context_path);\n     let description = &plain_issue.description;\n@@ -170,12 +171,100 @@ pub fn format_issue(\n             writeln!(styled_issue, \"{path}\").unwrap();\n         }\n     }\n+    let traces = &*plain_issue.import_traces;\n+    if !traces.is_empty() {\n+        /// Returns the layer used by all items in the trace if it is unique.\n+        /// Returns None, if there are multiple different layers (or no layers)\n+        fn get_layer(items: &[PlainTraceItem]) -> Option<RcStr> {\n+            let layer = items.first().and_then(|t| t.layer.clone());\n+            for item in items.iter().skip(1) {\n+                if item.layer != layer {\n+                    return None;\n+                }\n+            }\n+            layer\n+        }\n+        fn format_trace_items(\n+            out: &mut String,\n+            indent: &'static str,\n+            print_layers: bool,\n+            items: &[PlainTraceItem],\n+        ) {\n+            for item in items {\n+                out.push_str(indent);\n+                // We want to format the filepath but with a few caveats\n+                // - if it is part of the `[project]` filesystem, omit the fs name\n+                // - format the label at the end\n+                // - if it is the last item add the special marker `[entrypoint]` to help clarify\n+                //   that this is an application entry point\n+                // TODO(lukesandberg): some formatting could be useful. We could use colors,\n+                // bold/faint, links?\n+                if item.fs_name != \"project\" {\n+                    out.push('[');\n+                    out.push_str(&item.fs_name);\n+                    out.push_str(\"]/\");\n+                } else {\n+                    // This is consistent with webpack's output\n+                    out.push_str(\"./\");\n+                }\n+                out.push_str(&item.path);\n+                if let Some(ref label) = item.layer\n+                    && print_layers\n+                {\n+                    out.push_str(\" [\");\n+                    out.push_str(label);\n+                    out.push(']');\n+                }\n+                out.push('\\n');\n+            }\n+        }\n+        if traces.len() == 1 {\n+            let trace = &traces[0];\n+            // We don't put the layer in the header for the single case. Either they are all the\n+            // same in which case it should be clear from the filename or they are different and we\n+            // need to print them on the items anyway.\n+            writeln!(styled_issue, \"Example import trace:\").unwrap();\n+            format_trace_items(&mut styled_issue, \"  \", get_layer(trace).is_none(), trace);\n+        } else {\n+            // When there are multiple traces we:\n+            // * display the layer in the header if the trace has a consistent layer\n+            // * label the traces with their index, unless the layer is sufficiently unique.\n+            styled_issue.push_str(\"Example import traces:\\n\");\n+            let traces_and_layers: Vec<_> = traces.iter().map(|t| (get_layer(t), t)).collect();\n+            let every_trace_has_a_distinct_layer = traces_and_layers\n+                .iter()\n+                .filter_map(|t| t.0.clone())\n+                .collect::<FxHashSet<_>>()\n+                .len()\n+                == traces_and_layers.len();\n+            if every_trace_has_a_distinct_layer {\n+                for (layer, trace) in traces_and_layers {\n+                    writeln!(styled_issue, \"  {}:\", layer.unwrap()).unwrap();\n+                    format_trace_items(&mut styled_issue, \"    \", false, trace);\n+                }\n+            } else {\n+                for (index, (layer, trace)) in traces_and_layers.iter().enumerate() {\n+                    let print_layers = match layer {\n+                        Some(layer) => {\n+                            writeln!(styled_issue, \"  #{} [{layer}]:\", index + 1).unwrap();\n+                            false\n+                        }\n+                        None => {\n+                            writeln!(styled_issue, \"  #{}:\", index + 1).unwrap();\n+                            true\n+                        }\n+                    };\n+                    format_trace_items(&mut styled_issue, \"    \", print_layers, trace);\n+                }\n+            }\n+        }\n+    }\n \n     write!(\n         issue_text,\n         \"{} - [{}] {}\",\n         severity.style(severity_to_style(severity)),\n-        stgae,\n+        stage,\n         plain_issue.file_path\n     )\n     .unwrap();\n@@ -354,15 +443,14 @@ impl IssueReporter for ConsoleUi {\n         } = self.options;\n         let mut grouped_issues: GroupedIssues = FxHashMap::default();\n \n-        let issues = issues\n-            .iter_with_shortest_path()\n-            .map(|(issue, path)| async move {\n-                let plain_issue = issue.into_plain(path);\n-                let id = plain_issue.internal_hash(false).await?;\n-                Ok((plain_issue.await?, *id))\n+        let plain_issues = issues.get_plain_issues().await?;\n+        let issues = plain_issues\n+            .iter()\n+            .map(|plain_issue| {\n+                let id = plain_issue.internal_hash_ref(false);\n+                (plain_issue, id)\n             })\n-            .try_join()\n-            .await?;\n+            .collect::<Vec<_>>();\n \n         let issue_ids = issues.iter().map(|(_, id)| *id).collect::<FxHashSet<_>>();\n         let mut new_ids = self\n@@ -390,7 +478,7 @@ impl IssueReporter for ConsoleUi {\n             let category_map = severity_map.entry(stage.clone()).or_default();\n             let issues = category_map.entry(context_path.to_string()).or_default();\n \n-            let mut styled_issue = style_issue_source(&plain_issue, &context_path);\n+            let mut styled_issue = style_issue_source(plain_issue, &context_path);\n             let description = &plain_issue.description;\n             if let Some(description) = description {\n                 writeln!("
        },
        {
            "sha": "205552b0759e61d77e2c0f8f361f3c3813f708e1",
            "filename": "turbopack/crates/turbopack-core/src/ident.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -35,6 +35,7 @@ pub struct AssetIdent {\n \n impl AssetIdent {\n     pub fn add_modifier(&mut self, modifier: RcStr) {\n+        debug_assert!(!modifier.is_empty(), \"modifiers cannot be empty.\");\n         self.modifiers.push(modifier);\n     }\n \n@@ -183,6 +184,7 @@ impl AssetIdent {\n     #[turbo_tasks::function]\n     pub fn with_layer(&self, layer: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n+        debug_assert!(!layer.is_empty(), \"cannot set empty layers names\");\n         this.layer = Some(layer);\n         Self::new(Value::new(this))\n     }\n@@ -194,6 +196,13 @@ impl AssetIdent {\n         Self::new(Value::new(this))\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn with_asset(&self, key: RcStr, asset: ResolvedVc<AssetIdent>) -> Vc<Self> {\n+        let mut this = self.clone();\n+        this.add_asset(key, asset);\n+        Self::new(Value::new(this))\n+    }\n+\n     #[turbo_tasks::function]\n     pub async fn rename_as(&self, pattern: RcStr) -> Result<Vc<Self>> {\n         let mut this = self.clone();"
        },
        {
            "sha": "cb70718f29ad6312aea92ef623c86940ca822dd8",
            "filename": "turbopack/crates/turbopack-core/src/issue/mod.rs",
            "status": "modified",
            "additions": 216,
            "deletions": 69,
            "changes": 285,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -16,14 +16,15 @@ use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n     CollectiblesSource, NonLocalValue, OperationVc, RawVc, ReadRef, ResolvedVc, TaskInput,\n-    TransientInstance, TransientValue, TryJoinIterExt, Upcast, ValueToString, Vc, emit,\n-    trace::TraceRawVcs,\n+    TransientInstance, TransientValue, TryJoinIterExt, Upcast, ValueDefault, ValueToString, Vc,\n+    emit, trace::TraceRawVcs,\n };\n-use turbo_tasks_fs::{FileContent, FileLine, FileLinesContent, FileSystemPath};\n+use turbo_tasks_fs::{FileContent, FileLine, FileLinesContent, FileSystem, FileSystemPath};\n use turbo_tasks_hash::{DeterministicHash, Xxh3Hash64Hasher};\n \n use crate::{\n     asset::{Asset, AssetContent},\n+    ident::AssetIdent,\n     source::Source,\n     source_map::{GenerateSourceMap, SourceMap, TokenWithSource},\n     source_pos::SourcePos,\n@@ -147,38 +148,44 @@ pub trait Issue {\n     fn source(self: Vc<Self>) -> Vc<OptionIssueSource> {\n         Vc::cell(None)\n     }\n+}\n \n-    async fn into_plain(\n-        self: Vc<Self>,\n-        processing_path: Vc<OptionIssueProcessingPathItems>,\n-    ) -> Result<Vc<PlainIssue>> {\n-        let description = match *self.description().await? {\n-            Some(description) => Some((*description.await?).clone()),\n-            None => None,\n-        };\n-        let detail = match *self.detail().await? {\n-            Some(detail) => Some((*detail.await?).clone()),\n-            None => None,\n-        };\n+// A collectible trait that allows traces to be computed for a given module.\n+#[turbo_tasks::value_trait]\n+pub trait ImportTracer {\n+    fn get_traces(self: Vc<Self>, path: ResolvedVc<FileSystemPath>) -> Vc<ImportTraces>;\n+}\n \n-        Ok(PlainIssue {\n-            severity: *self.severity().await?,\n-            file_path: self.file_path().to_string().owned().await?,\n-            stage: self.stage().owned().await?,\n-            title: self.title().owned().await?,\n-            description,\n-            detail,\n-            documentation_link: self.documentation_link().owned().await?,\n-            source: {\n-                if let Some(s) = &*self.source().await? {\n-                    Some(s.into_plain().await?)\n-                } else {\n-                    None\n-                }\n-            },\n-            processing_path: processing_path.into_plain().await?,\n-        }\n-        .cell())\n+#[turbo_tasks::value(shared)]\n+#[derive(Debug)]\n+pub struct DelegatingImportTracer {\n+    delegates: AutoSet<ResolvedVc<Box<dyn ImportTracer>>>,\n+}\n+\n+impl DelegatingImportTracer {\n+    async fn get_traces(&self, path: Vc<FileSystemPath>) -> Result<Vec<ImportTrace>> {\n+        Ok(self\n+            .delegates\n+            .iter()\n+            .map(|d| d.get_traces(path))\n+            .try_join()\n+            .await?\n+            .iter()\n+            .flat_map(|v| v.0.iter().cloned())\n+            .collect())\n+    }\n+}\n+\n+pub type ImportTrace = Vec<ReadRef<AssetIdent>>;\n+\n+#[turbo_tasks::value(shared)]\n+pub struct ImportTraces(pub Vec<ImportTrace>);\n+\n+#[turbo_tasks::value_impl]\n+impl ValueDefault for ImportTraces {\n+    #[turbo_tasks::function]\n+    fn value_default() -> Vc<Self> {\n+        Self::cell(ImportTraces(vec![]))\n     }\n }\n \n@@ -357,6 +364,7 @@ pub struct CapturedIssues {\n     issues: AutoSet<ResolvedVc<Box<dyn Issue>>>,\n     #[cfg(feature = \"issue_path\")]\n     processing_path: ResolvedVc<ItemIssueProcessingPath>,\n+    tracer: ResolvedVc<DelegatingImportTracer>,\n }\n \n #[turbo_tasks::value_impl]\n@@ -384,38 +392,17 @@ impl CapturedIssues {\n         self.issues.iter().copied()\n     }\n \n-    /// Returns an iterator over the issues with the shortest path from the root\n-    /// issue to each issue.\n-    pub fn iter_with_shortest_path(\n-        &self,\n-    ) -> impl Iterator<\n-        Item = (\n-            ResolvedVc<Box<dyn Issue>>,\n-            Vc<OptionIssueProcessingPathItems>,\n-        ),\n-    > + '_ {\n-        self.issues.iter().map(|issue| {\n-            #[cfg(feature = \"issue_path\")]\n-            let path = self.processing_path.shortest_path(**issue);\n-            #[cfg(not(feature = \"issue_path\"))]\n-            let path = OptionIssueProcessingPathItems::none();\n-            (*issue, path)\n-        })\n-    }\n-\n+    // Returns all the issues as formatted `PlainIssues`.\n     pub async fn get_plain_issues(&self) -> Result<Vec<ReadRef<PlainIssue>>> {\n         let mut list = self\n             .issues\n             .iter()\n-            .map(|&issue| async move {\n+            .map(|issue| async move {\n                 #[cfg(feature = \"issue_path\")]\n-                return issue\n-                    .into_plain(self.processing_path.shortest_path(*issue))\n-                    .await;\n+                let processing_path = self.processing_path.shortest_path(**issue);\n                 #[cfg(not(feature = \"issue_path\"))]\n-                return issue\n-                    .into_plain(OptionIssueProcessingPathItems::none())\n-                    .await;\n+                let processing_path = OptionIssueProcessingPathItems::none();\n+                PlainIssue::from_issue(**issue, Some(*self.tracer), processing_path).await\n             })\n             .try_join()\n             .await?;\n@@ -622,6 +609,129 @@ pub struct OptionIssueSource(Option<IssueSource>);\n #[turbo_tasks::value(transparent)]\n pub struct OptionStyledString(Option<ResolvedVc<StyledString>>);\n \n+// A structured reference to a file with module level details for displaying in an import trace\n+#[derive(\n+    Serialize,\n+    PartialEq,\n+    Eq,\n+    PartialOrd,\n+    Ord,\n+    Clone,\n+    Debug,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    DeterministicHash,\n+)]\n+#[serde(rename_all = \"camelCase\")]\n+pub struct PlainTraceItem {\n+    // The name of the filesystem\n+    pub fs_name: RcStr,\n+    // The root path of the filesystem, for constructing links\n+    pub root_path: RcStr,\n+    // The path of the file, relative to the filesystem root\n+    pub path: RcStr,\n+    // An optional label attached to the module that clarifies where in the module graph it is.\n+    pub layer: Option<RcStr>,\n+}\n+\n+impl PlainTraceItem {\n+    async fn from_asset_ident(asset: ReadRef<AssetIdent>) -> Result<Self> {\n+        // TODO(lukesandberg): How should we display paths? it would be good to display all paths\n+        // relative to the cwd or the project root.\n+        let fs_path = asset.path.await?;\n+        let fs_name = fs_path.fs.to_string().owned().await?;\n+        let root_path = fs_path.fs.root().await?.path.clone();\n+        let path = fs_path.path.clone();\n+        let layer = asset.layer.clone();\n+        Ok(Self {\n+            fs_name,\n+            root_path,\n+            path,\n+            layer,\n+        })\n+    }\n+}\n+\n+pub type PlainTrace = Vec<PlainTraceItem>;\n+\n+// Flatten and simplify this set of import traces into a simpler format for formatting.\n+async fn into_plain_trace(traces: Vec<Vec<ReadRef<AssetIdent>>>) -> Result<Vec<PlainTrace>> {\n+    let mut plain_traces = traces\n+        .into_iter()\n+        .map(|trace| async move {\n+            let mut plain_trace = trace\n+                .into_iter()\n+                .filter(|asset| {\n+                    // If there are nested assets, this is a synthetic module which is likely to be\n+                    // confusing/distracting.  Just skip it.\n+                    asset.assets.is_empty()\n+                })\n+                .map(PlainTraceItem::from_asset_ident)\n+                .try_join()\n+                .await?;\n+\n+            // After simplifying the trace, we may end up with apparent duplicates.\n+            // Consider this example:\n+            // Example import trace:\n+            // ./[project]/app/global.scss.css [app-client] (css) [app-client]\n+            // ./[project]/app/layout.js [app-client] (ecmascript) [app-client]\n+            // ./[project]/app/layout.js [app-rsc] (client reference proxy) [app-rsc]\n+            // ./[project]/app/layout.js [app-rsc] (ecmascript) [app-rsc]\n+            // ./[project]/app/layout.js [app-rsc] (ecmascript, Next.js Server Component) [app-rsc]\n+            //\n+            // In that case, there are an number of 'shim modules' that are inserted by next with\n+            // different `modifiers` that are used to model the server->client hand off.  The\n+            // simplification performed by `PlainTraceItem::from_asset_ident` drops these\n+            // 'modifiers' and so we would end up with 'app/layout.js' appearing to be duplicated\n+            // several times.  These modules are implementation details of the application so we\n+            // just deduplicate them here.\n+\n+            plain_trace.dedup();\n+\n+            Ok(plain_trace)\n+        })\n+        .try_join()\n+        .await?;\n+\n+    // Trim any empty traces and traces that only contain 1 item.  Showing a trace that points to\n+    // the file with the issue is not useful.\n+    plain_traces.retain(|t| t.len() > 1);\n+    // Sort so the shortest traces come first, and break ties by the trace itself to ensure\n+    // stability\n+    plain_traces.sort_by(|a, b| {\n+        // Sort by length first, so that shorter traces come first.\n+        a.len().cmp(&b.len()).then_with(|| a.cmp(b))\n+    });\n+\n+    // Now see if there are any overlaps\n+    // If two of the traces overlap that means one is a suffix of another one.  Because we are\n+    // computing shortest paths in the same graph and the shortest path algorithm we use is\n+    // deterministic.\n+    // Technically this is a quadratic algorithm since we need to compare each trace with all\n+    // subsequent traces, however there are rarely more than 3 traces and certainly never more\n+    // than 10.\n+    if plain_traces.len() > 1 {\n+        let mut i = 0;\n+        while i < plain_traces.len() - 1 {\n+            let mut j = plain_traces.len() - 1;\n+            while j > i {\n+                if plain_traces[j].ends_with(&plain_traces[i]) {\n+                    // Remove the longer trace.\n+                    // This typically happens due to things like server->client transitions where\n+                    // the same file appears multiple times under different modules identifiers.\n+                    // On the one hand the shorter trace is simpler, on the other hand the longer\n+                    // trace might be more 'interesting' and even relevant.\n+                    plain_traces.remove(j);\n+                }\n+                j -= 1;\n+            }\n+            i += 1;\n+        }\n+    }\n+\n+    Ok(plain_traces)\n+}\n+\n #[turbo_tasks::value(shared, serialization = \"none\")]\n #[derive(Clone, Debug, PartialOrd, Ord, DeterministicHash, Serialize)]\n pub enum IssueStage {\n@@ -679,6 +789,7 @@ pub struct PlainIssue {\n \n     pub source: Option<PlainIssueSource>,\n     pub processing_path: ReadRef<PlainIssueProcessingPath>,\n+    pub import_traces: Vec<PlainTrace>,\n }\n \n fn hash_plain_issue(issue: &PlainIssue, hasher: &mut Xxh3Hash64Hasher, full: bool) {\n@@ -701,6 +812,7 @@ fn hash_plain_issue(issue: &PlainIssue, hasher: &mut Xxh3Hash64Hasher, full: boo\n \n     if full {\n         hasher.write_ref(&issue.processing_path);\n+        hasher.write_ref(&issue.import_traces);\n     }\n }\n \n@@ -722,17 +834,46 @@ impl PlainIssue {\n \n #[turbo_tasks::value_impl]\n impl PlainIssue {\n-    /// We need deduplicate issues that can come from unique paths, but\n-    /// represent the same underlying problem. Eg, a parse error for a file\n-    /// that is compiled in both client and server contexts.\n-    ///\n-    /// Passing [full] will also hash any sub-issues and processing paths. While\n-    /// useful for generating exact matching hashes, it's possible for the\n-    /// same issue to pass from multiple processing paths, making for overly\n-    /// verbose logging.\n+    /// Translate an [Issue] into a [PlainIssue]. A more regular structure suitable for printing and\n+    /// serialization.\n     #[turbo_tasks::function]\n-    pub fn internal_hash(&self, full: bool) -> Vc<u64> {\n-        Vc::cell(self.internal_hash_ref(full))\n+    pub async fn from_issue(\n+        issue: ResolvedVc<Box<dyn Issue>>,\n+        import_tracer: Option<ResolvedVc<DelegatingImportTracer>>,\n+        processing_path: Vc<OptionIssueProcessingPathItems>,\n+    ) -> Result<Vc<Self>> {\n+        let description: Option<StyledString> = match *issue.description().await? {\n+            Some(description) => Some((*description.await?).clone()),\n+            None => None,\n+        };\n+        let detail = match *issue.detail().await? {\n+            Some(detail) => Some((*detail.await?).clone()),\n+            None => None,\n+        };\n+\n+        Ok(Self::cell(Self {\n+            severity: *issue.severity().await?,\n+            file_path: issue.file_path().to_string().owned().await?,\n+            stage: issue.stage().owned().await?,\n+            title: issue.title().owned().await?,\n+            description,\n+            detail,\n+            documentation_link: issue.documentation_link().owned().await?,\n+            source: {\n+                if let Some(s) = &*issue.source().await? {\n+                    Some(s.into_plain().await?)\n+                } else {\n+                    None\n+                }\n+            },\n+            processing_path: processing_path.into_plain().await?,\n+            import_traces: match import_tracer {\n+                Some(tracer) => {\n+                    into_plain_trace(tracer.await?.get_traces(issue.file_path()).await?).await?\n+                }\n+                None => vec![],\n+            },\n+        }))\n     }\n }\n \n@@ -942,6 +1083,9 @@ where\n                 None,\n                 self.peek_collectibles(),\n             )),\n+            tracer: DelegatingImportTracer::resolved_cell(DelegatingImportTracer {\n+                delegates: self.peek_collectibles(),\n+            }),\n         })\n     }\n \n@@ -953,6 +1097,9 @@ where\n                 None,\n                 self.take_collectibles(),\n             )),\n+            tracer: DelegatingImportTracer::resolved_cell(DelegatingImportTracer {\n+                delegates: self.take_collectibles(),\n+            }),\n         })\n     }\n }"
        },
        {
            "sha": "195b5f9cf9ac8e95f32b88dd932d4ea902136372",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 237,
            "deletions": 11,
            "changes": 248,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,12 +1,17 @@\n use std::{\n-    collections::{BinaryHeap, HashSet, VecDeque},\n+    collections::{BinaryHeap, HashSet, VecDeque, hash_map::Entry},\n     future::Future,\n };\n \n use anyhow::{Context, Result, bail};\n+use auto_hash_map::AutoSet;\n use petgraph::{\n+    Directed,\n     graph::{DiGraph, EdgeIndex, NodeIndex},\n-    visit::{Dfs, EdgeRef, IntoNodeReferences, NodeIndexable, VisitMap, Visitable},\n+    visit::{\n+        Dfs, EdgeRef, IntoNeighbors, IntoNodeReferences, NodeIndexable, Reversed, VisitMap,\n+        Visitable,\n+    },\n };\n use rustc_hash::{FxHashMap, FxHashSet};\n use serde::{Deserialize, Serialize};\n@@ -18,10 +23,11 @@ use turbo_tasks::{\n     graph::{AdjacencyMap, GraphTraversal, Visit, VisitControlFlow},\n     trace::TraceRawVcs,\n };\n+use turbo_tasks_fs::FileSystemPath;\n \n use crate::{\n     chunk::{AsyncModuleInfo, ChunkingContext, ChunkingType},\n-    issue::Issue,\n+    issue::{ImportTrace, ImportTracer, ImportTraces, Issue},\n     module::Module,\n     module_graph::{\n         async_module_info::{AsyncModulesInfo, compute_async_module_info},\n@@ -222,12 +228,13 @@ impl SingleModuleGraph {\n         let node_count = visited_nodes.0.len();\n         drop(visited_nodes);\n \n-        let mut graph = DiGraph::with_capacity(\n-            node_count,\n-            // From real world measurements each module has about 3-4 children\n-            // If it has more this would cause an additional allocation, but that's fine\n-            node_count * 4,\n-        );\n+        let mut graph: petgraph::Graph<SingleModuleGraphNode, ChunkingType, Directed> =\n+            DiGraph::with_capacity(\n+                node_count,\n+                // From real world measurements each module has about 3-4 children\n+                // If it has more this would cause an additional allocation, but that's fine\n+                node_count * 4,\n+            );\n \n         let mut number_of_modules = 0;\n         let mut modules: FxHashMap<ResolvedVc<Box<dyn Module>>, NodeIndex> =\n@@ -328,13 +335,18 @@ impl SingleModuleGraph {\n             }\n         }\n \n-        Ok(SingleModuleGraph {\n+        let graph = SingleModuleGraph {\n             graph: TracedDiGraph::new(graph),\n             number_of_modules,\n             modules,\n             entries: entries.clone(),\n         }\n-        .cell())\n+        .cell();\n+\n+        turbo_tasks::emit(ResolvedVc::upcast::<Box<dyn ImportTracer>>(\n+            ModuleGraphImportTracer::new(graph).to_resolved().await?,\n+        ));\n+        Ok(graph)\n     }\n \n     fn get_module(&self, module: ResolvedVc<Box<dyn Module>>) -> Result<NodeIndex> {\n@@ -690,6 +702,219 @@ impl SingleModuleGraph {\n             }\n         }\n     }\n+\n+    /// For each issue computes a (possibly empty) list of traces from the file that produced the\n+    /// issue to roots in this module graph.\n+    /// There are potentially multiple traces because a given file may get assigned to multiple\n+    /// modules depend on how it is used in the application.  Consider a simple utility that is used\n+    /// by SSR pages, client side code, and the edge runtime.  This may lead to there being 3\n+    /// traces.\n+    /// The returned map is guaranteed to have an entry for every issue.\n+    pub async fn compute_import_traces_for_issues(\n+        &self,\n+        issues: &AutoSet<ResolvedVc<Box<dyn Issue>>>,\n+    ) -> Result<FxHashMap<ResolvedVc<Box<dyn Issue>>, Vec<ImportTrace>>> {\n+        let issue_paths = issues\n+            .iter()\n+            .map(|issue| async move { Ok((*issue.file_path().await?).clone()) })\n+            .try_join()\n+            .await?;\n+        let mut file_path_to_traces: FxHashMap<FileSystemPath, Vec<ImportTrace>> =\n+            FxHashMap::with_capacity_and_hasher(issue_paths.len(), Default::default());\n+        // initialize an empty vec for each path we care about\n+        for issue in &issue_paths {\n+            file_path_to_traces.entry(issue.clone()).or_default();\n+        }\n+\n+        {\n+            let modules = self\n+                .modules\n+                .iter()\n+                .map(|(module, &index)| async move {\n+                    Ok(((*module.ident().path().await?).clone(), index))\n+                })\n+                .try_join()\n+                .await?;\n+            // Reverse the graph so we can find paths to roots\n+            let reversed_graph = Reversed(&self.graph.0);\n+            for (path, module_idx) in modules {\n+                if let Entry::Occupied(mut entry) = file_path_to_traces.entry(path) {\n+                    // compute the path from this index to a root of the graph.\n+                    let Some((_, path)) = petgraph::algo::astar(\n+                        &reversed_graph,\n+                        module_idx,\n+                        |n| reversed_graph.neighbors(n).next().is_none(),\n+                        // Edge weights\n+                        |e| match e.weight() {\n+                            // Prefer following normal imports/requires when we can\n+                            ChunkingType::Parallel { .. } => 0,\n+                            _ => 1,\n+                        },\n+                        // `astar` can be accelerated with a distance estimation heuristic, as long\n+                        // as our estimate is never > the actual distance.\n+                        // However we don't have a mechanism, so just\n+                        // estimate 0 which essentially makes this behave like\n+                        // dijktra's shortest path algorithm.  `petgraph` has an implementation of\n+                        // dijkstra's but it doesn't report  paths, just distances.\n+                        // NOTE: dijkstra's with integer weights can be accelerated with incredibly\n+                        // efficient priority queue structures (basically with only 0 and 1 as\n+                        // weights you can use a `VecDeque`!).  However,\n+                        // this is unlikely to be a performance concern.\n+                        // Furthermore, if computing paths _does_ become a performance concern, the\n+                        // solution would be a hand written implementation of dijkstras so we can\n+                        // hoist redundant work out of this loop.\n+                        |_| 0,\n+                    ) else {\n+                        unreachable!(\"there must be a path to a root\");\n+                    };\n+                    // Represent the path as a sequence of AssetIdents\n+                    // TODO: consider hinting at various transitions (e.g. was this an\n+                    // import/require/dynamic-import?)\n+                    let path = path\n+                        .into_iter()\n+                        .map(async |n| {\n+                            Ok(self\n+                                .graph\n+                                .node_weight(n)\n+                                .unwrap()\n+                                .module()\n+                                .ident()\n+                                .await?\n+                                .clone())\n+                        })\n+                        .try_join()\n+                        .await?;\n+                    entry.get_mut().push(path);\n+                }\n+            }\n+        }\n+        let mut issue_to_traces: FxHashMap<ResolvedVc<Box<dyn Issue>>, Vec<ImportTrace>> =\n+            FxHashMap::with_capacity_and_hasher(issues.len(), Default::default());\n+        // Map filepaths back to issues\n+        // We can do this by zipping the issue_paths with the issues since they are in the same\n+        // order.\n+        for (path, issue) in issue_paths.iter().zip(issues) {\n+            if let Some(traces) = file_path_to_traces.get(path) {\n+                issue_to_traces.insert(*issue, traces.clone());\n+            }\n+        }\n+        Ok(issue_to_traces)\n+    }\n+}\n+\n+#[turbo_tasks::value]\n+struct ModuleGraphImportTracer {\n+    graph: ResolvedVc<SingleModuleGraph>,\n+}\n+\n+#[turbo_tasks::value(shared)]\n+struct PathToModulesMap {\n+    map: FxHashMap<FileSystemPath, Vec<ResolvedVc<Box<dyn Module>>>>,\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl ModuleGraphImportTracer {\n+    #[turbo_tasks::function]\n+    fn new(graph: ResolvedVc<SingleModuleGraph>) -> Vc<Self> {\n+        Self::cell(Self { graph })\n+    }\n+\n+    // Compute this mapping on demand since it might not always be needed.\n+    #[turbo_tasks::function]\n+    async fn path_to_modules(&self) -> Result<Vc<PathToModulesMap>> {\n+        let path_and_modules = self\n+            .graph\n+            .await?\n+            .modules\n+            .iter()\n+            .map(|(&module, _)| async move { Ok((module.ident().path().owned().await?, module)) })\n+            .try_join()\n+            .await?;\n+        let mut map: FxHashMap<FileSystemPath, Vec<ResolvedVc<Box<dyn Module>>>> =\n+            FxHashMap::default();\n+        for (path, module) in path_and_modules {\n+            map.entry(path).or_default().push(module)\n+        }\n+        Ok(PathToModulesMap::cell(PathToModulesMap { map }))\n+    }\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl ImportTracer for ModuleGraphImportTracer {\n+    #[turbo_tasks::function]\n+    async fn get_traces(\n+        self: Vc<Self>,\n+        path: ResolvedVc<FileSystemPath>,\n+    ) -> Result<Vc<ImportTraces>> {\n+        let path_to_modules = self.path_to_modules().await?;\n+        let Some(modules) = path_to_modules.map.get(&*path.await?) else {\n+            return Ok(Vc::default()); // This isn't unusual, the file just might not be in this\n+            // graph.\n+        };\n+        debug_assert!(!modules.is_empty(), \"modules should not be an empty vec\");\n+        let graph = &*self.await?.graph.await?;\n+\n+        let reversed_graph = Reversed(&graph.graph.0);\n+        return Ok(ImportTraces::cell(ImportTraces(\n+            modules\n+                .iter()\n+                .map(|m| async move {\n+                    let Some(&module_idx) = graph.modules.get(m) else {\n+                        // The only way this could really happen is if `path_to_modules` is computed\n+                        // from a different graph than graph`.  Just error out.\n+                        bail!(\"inconsistent read?\")\n+                    };\n+                    // compute the path from this index to a root of the graph.\n+                    let Some((_, path)) = petgraph::algo::astar(\n+                        &reversed_graph,\n+                        module_idx,\n+                        |n| reversed_graph.neighbors(n).next().is_none(),\n+                        // Edge weights\n+                        |e| match e.weight() {\n+                            // Prefer following normal imports/requires when we can\n+                            ChunkingType::Parallel { .. } => 0,\n+                            _ => 1,\n+                        },\n+                        // `astar` can be accelerated with a distance estimation heuristic, as long\n+                        // as our estimate is never > the actual distance.\n+                        // However we don't have a mechanism, so just\n+                        // estimate 0 which essentially makes this behave like\n+                        // dijktra's shortest path algorithm.  `petgraph` has an implementation of\n+                        // dijkstra's but it doesn't report  paths, just distances.\n+                        // NOTE: dijkstra's with integer weights can be accelerated with incredibly\n+                        // efficient priority queue structures (basically with only 0 and 1 as\n+                        // weights you can use a `VecDeque`!).  However,\n+                        // this is unlikely to be a performance concern.\n+                        // Furthermore, if computing paths _does_ become a performance concern, the\n+                        // solution would be a hand written implementation of dijkstras so we can\n+                        // hoist redundant work out of this loop.\n+                        |_| 0,\n+                    ) else {\n+                        unreachable!(\"there must be a path to a root\");\n+                    };\n+\n+                    // Represent the path as a sequence of AssetIdents\n+                    // TODO: consider hinting at various transitions (e.g. was this an\n+                    // import/require/dynamic-import?)\n+                    let path = path\n+                        .into_iter()\n+                        .map(async |n| {\n+                            graph\n+                                .graph\n+                                .node_weight(n)\n+                                .unwrap() // This is safe since `astar`` only returns indices from the graph\n+                                .module()\n+                                .ident()\n+                                .await\n+                        })\n+                        .try_join()\n+                        .await?;\n+                    Ok(path)\n+                })\n+                .try_join()\n+                .await?,\n+        )));\n+    }\n }\n \n #[turbo_tasks::value(shared)]\n@@ -1299,6 +1524,7 @@ pub struct SingleModuleGraphModuleNode {\n #[derive(Clone, Debug, Serialize, Deserialize, TraceRawVcs, NonLocalValue)]\n pub enum SingleModuleGraphNode {\n     Module(SingleModuleGraphModuleNode),\n+    // Models a module that is referenced but has already been visited by an earlier graph.\n     VisitedModule {\n         idx: GraphNodeIndex,\n         module: ResolvedVc<Box<dyn Module>>,"
        },
        {
            "sha": "249d0efce979502c715e74a0c0e3f2ef8fdafd59",
            "filename": "turbopack/crates/turbopack-core/src/resolve/pattern.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -811,7 +811,6 @@ impl Pattern {\n                 .then_some(0)\n         }\n     }\n-\n     fn match_internal<'a>(\n         &self,\n         mut value: &'a str,"
        },
        {
            "sha": "c1ba9621fb4c2ec5eade39c668b12f35dbeae932",
            "filename": "turbopack/crates/turbopack-dev-server/src/update/server.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fserver.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fserver.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fserver.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -185,7 +185,7 @@ where\n             UpdateStreamItem::Found { update, issues } => {\n                 let issues = issues\n                     .iter()\n-                    .map(|p| (&**p).into())\n+                    .map(|p| Issue::from(&**p))\n                     .collect::<Vec<Issue<'_>>>();\n                 match &**update {\n                     Update::Partial(partial) => {"
        },
        {
            "sha": "fc72c58d5bb4a2e4563b4872f5508dff999049c8",
            "filename": "turbopack/crates/turbopack-dev-server/src/update/stream.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fupdate%2Fstream.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -125,13 +125,20 @@ async fn get_update_stream_item_operation(\n         Ok(content) => content,\n         Err(e) => {\n             plain_issues.push(\n-                FatalStreamIssue {\n-                    resource,\n-                    description: StyledString::Text(format!(\"{}\", PrettyPrintError(&e)).into())\n-                        .resolved_cell(),\n-                }\n-                .cell()\n-                .into_plain(OptionIssueProcessingPathItems::none())\n+                PlainIssue::from_issue(\n+                    Vc::upcast(\n+                        FatalStreamIssue {\n+                            resource,\n+                            description: StyledString::Text(\n+                                format!(\"{}\", PrettyPrintError(&e)).into(),\n+                            )\n+                            .resolved_cell(),\n+                        }\n+                        .cell(),\n+                    ),\n+                    None,\n+                    OptionIssueProcessingPathItems::none(),\n+                )\n                 .await?,\n             );\n "
        },
        {
            "sha": "710b1756dc487be3555dd89ad26712b28c82e652",
            "filename": "turbopack/crates/turbopack-test-utils/src/snapshot.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-test-utils%2Fsrc%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-test-utils%2Fsrc%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-test-utils%2Fsrc%2Fsnapshot.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -19,7 +19,7 @@ use turbopack_core::{\n \n // Updates the existing snapshot outputs with the actual outputs of this run.\n // e.g. `UPDATE=1 cargo test -p turbopack-tests -- test_my_pattern`\n-static UPDATE: Lazy<bool> = Lazy::new(|| env::var(\"UPDATE\").unwrap_or_default() == \"1\");\n+pub static UPDATE: Lazy<bool> = Lazy::new(|| env::var(\"UPDATE\").unwrap_or_default() == \"1\");\n \n static ANSI_REGEX: Lazy<Regex> = Lazy::new(|| Regex::new(r\"\\x1b\\[\\d+m\").unwrap());\n "
        },
        {
            "sha": "12f898b39944a4d6ee884f4f5cac273b5583ce63",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -13,8 +13,8 @@ use serde::{Deserialize, Serialize};\n use tracing_subscriber::{Registry, layer::SubscriberExt, util::SubscriberInitExt};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    Completion, NonLocalValue, OperationVc, ResolvedVc, TryJoinIterExt, TurboTasks, Value, Vc,\n-    apply_effects, debug::ValueDebugFormat, fxindexmap, trace::TraceRawVcs,\n+    Completion, NonLocalValue, OperationVc, ResolvedVc, TurboTasks, Value, Vc, apply_effects,\n+    debug::ValueDebugFormat, fxindexmap, trace::TraceRawVcs,\n };\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n use turbo_tasks_bytes::stream::SingleValue;\n@@ -37,7 +37,7 @@ use turbopack_core::{\n     context::AssetContext,\n     environment::{Environment, ExecutionEnvironment, NodeJsEnvironment},\n     file_source::FileSource,\n-    issue::{Issue, IssueDescriptionExt},\n+    issue::IssueDescriptionExt,\n     reference_type::{InnerAssets, ReferenceType},\n     resolve::{\n         ExternalTraced, ExternalType,\n@@ -49,7 +49,7 @@ use turbopack_ecmascript_runtime::RuntimeType;\n use turbopack_node::{debug::should_debug, evaluate::evaluate};\n use turbopack_nodejs::NodeJsChunkingContext;\n use turbopack_resolve::resolve_options_context::ResolveOptionsContext;\n-use turbopack_test_utils::jest::JestRunResult;\n+use turbopack_test_utils::{jest::JestRunResult, snapshot::UPDATE};\n use turbopack_trace_utils::{\n     filter_layer::FilterLayer, raw_trace::RawTraceLayer, trace_writer::TraceWriter,\n     tracing_presets::TRACING_TURBO_TASKS_TARGETS,\n@@ -193,7 +193,7 @@ async fn run(resource: PathBuf, snapshot_mode: IssueSnapshotMode) -> Result<JsRe\n     let tt = TurboTasks::new(TurboTasksBackend::new(\n         BackendOptions {\n             storage_mode: None,\n-            dependency_tracking: false,\n+            dependency_tracking: *UPDATE,\n             ..Default::default()\n         },\n         noop_backing_storage(),\n@@ -505,11 +505,7 @@ async fn snapshot_issues(\n \n     let captured_issues = run_result_op.peek_issues_with_path().await?;\n \n-    let plain_issues = captured_issues\n-        .iter_with_shortest_path()\n-        .map(|(issue_vc, path)| async move { issue_vc.into_plain(path).await })\n-        .try_join()\n-        .await?;\n+    let plain_issues = captured_issues.get_plain_issues().await?;\n \n     turbopack_test_utils::snapshot::snapshot_issues(\n         plain_issues,"
        },
        {
            "sha": "a1d73a82eaef520604cc0604cc60489bf1dcd082",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/issues/unexpected export __star__-118256.txt",
            "status": "renamed",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fasync-modules%2Fexport-all%2Fissues%2Funexpected%20export%20__star__-118256.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fasync-modules%2Fexport-all%2Fissues%2Funexpected%20export%20__star__-118256.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fasync-modules%2Fexport-all%2Fissues%2Funexpected%20export%20__star__-118256.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,8 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/input/exports.js  unexpected export *\n   export * used with module [project]/turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/input/exports.js [test] (ecmascript) which is a CommonJS module with exports only available at runtime\n-  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n\\ No newline at end of file\n+  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/input/exports.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/input/tla.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/async-modules/export-all/issues/unexpected export __star__-a886ef.txt"
        },
        {
            "sha": "fa0ce19a47fd5862b8c287d17ed5089d77853c7b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/comptime/issues/__l___Module not found____c__ Can't resolve __c_'.-8f442a.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'.-8f442a.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'.-8f442a.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'.-8f442a.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/comptime/issues/__l___Module not found____c__ Can't resolve __c_'.-564d0b.txt"
        },
        {
            "sha": "c0337b013f07d4ad5cb2b9b92434e5fd902ed797",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/error/issues/Reading source code for parsing failed-aa8c94.txt",
            "status": "renamed",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Ferror%2Fissues%2FReading%20source%20code%20for%20parsing%20failed-aa8c94.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Ferror%2Fissues%2FReading%20source%20code%20for%20parsing%20failed-aa8c94.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Ferror%2Fissues%2FReading%20source%20code%20for%20parsing%20failed-aa8c94.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -2,4 +2,8 @@ error - [load] [project]/turbopack/crates/turbopack-tests/tests/execution/turbop\n   An unexpected error happened while trying to read the source code to parse: failed to convert rope into string\n   \n   Caused by:\n-  - invalid utf-8 sequence of 1 bytes from index 1\n\\ No newline at end of file\n+  - invalid utf-8 sequence of 1 bytes from index 1\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/error/input/broken.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/error/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/error/issues/Reading source code for parsing failed-28fbb4.txt"
        },
        {
            "sha": "6f8cde54f1af3bba14831318c0b6527f49b756ad",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/issues/Specified module format (CommonJs) is not matching-2aff7d.txt",
            "status": "renamed",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(CommonJs)%20is%20not%20matching-2aff7d.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(CommonJs)%20is%20not%20matching-2aff7d.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(CommonJs)%20is%20not%20matching-2aff7d.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,4 +1,9 @@\n error - [analysis] [project]/turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/invalid-exports.cjs  Specified module format (CommonJs) is not matching the module format of the source code (EcmaScript Modules)\n   The CommonJs module format was specified in the package.json that is affecting this source file or by using an special extension, but Ecmascript import/export syntax is used in the source code.\n   The module was automatically converted to an EcmaScript module, but that is in conflict with the specified module format. Either change the \"type\" field in the package.json or replace EcmaScript import/export syntax with CommonJs syntas in the source file.\n-  In some cases EcmaScript import/export syntax is added by an transform and isn't actually part of the source code. In these cases revisit transformation options to inject the correct syntax.\n\\ No newline at end of file\n+  In some cases EcmaScript import/export syntax is added by an transform and isn't actually part of the source code. In these cases revisit transformation options to inject the correct syntax.\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/invalid-exports.cjs\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/index.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/issues/Specified module format (CommonJs) is not matching-686896.txt"
        },
        {
            "sha": "30f60268901f6bf53a65a35d1441c09b2c533e55",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/issues/Specified module format (EcmaScript Modules) is no-839e1c.txt",
            "status": "renamed",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-839e1c.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-839e1c.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fnode-default-import%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-839e1c.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,8 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/invalid-exports.js  Specified module format (EcmaScript Modules) is not matching the module format of the source code (CommonJs)\n   The EcmaScript module format was specified in the package.json that is affecting this source file or by using an special extension, but it looks like that CommonJs syntax is used in the source code.\n-  Exports made by CommonJs syntax will lead to a runtime error, since the module is in EcmaScript mode. Either change the \"type\" field in the package.json or replace CommonJs syntax with EcmaScript import/export syntax in the source file.\n\\ No newline at end of file\n+  Exports made by CommonJs syntax will lead to a runtime error, since the module is in EcmaScript mode. Either change the \"type\" field in the package.json or replace CommonJs syntax with EcmaScript import/export syntax in the source file.\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/invalid-exports.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/node_modules/esm-package/index.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/node-default-import/issues/Specified module format (EcmaScript Modules) is no-107741.txt"
        },
        {
            "sha": "11416e463d565731401f784743e4b4501c32f2cf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/exports/invalid-export/issues/__l_Export __c_Abc__ doesn't exist in target modul-2cf4be.txt",
            "status": "renamed",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Finvalid-export%2Fissues%2F__l_Export%20__c_Abc__%20doesn't%20exist%20in%20target%20modul-2cf4be.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Finvalid-export%2Fissues%2F__l_Export%20__c_Abc__%20doesn't%20exist%20in%20target%20modul-2cf4be.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Finvalid-export%2Fissues%2F__l_Export%20__c_Abc__%20doesn't%20exist%20in%20target%20modul-2cf4be.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -17,4 +17,7 @@ error - [bindings] [project]/turbopack/crates/turbopack-tests/tests/execution/tu\n   \n   | These are the exports of the module:\n   | Abd, Eef, a, b, c\n-  |\n\\ No newline at end of file\n+  | \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/exports/invalid-export/input/invalid-export/index.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/turbopack/exports/invalid-export/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/exports/invalid-export/issues/__l_Export __c_Abc__ doesn't exist in target modul-bbfd16.txt"
        },
        {
            "sha": "f21840e0bc48ad3dee785a55a897a91f236119cf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/dynamic-unrelated/issues/Unknown module type-d12243.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-d12243.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-d12243.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-d12243.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/dynamic-unrelated/issues/Unknown module type-678865.txt"
        },
        {
            "sha": "7a520ae04415e1a0309873fdcc7b5970ed7e0e4f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/dynamic-unrelated/issues/Unknown module type-ec9fd4.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-ec9fd4.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-ec9fd4.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fdynamic-unrelated%2Fissues%2FUnknown%20module%20type-ec9fd4.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/dynamic-unrelated/issues/Unknown module type-de73f4.txt"
        },
        {
            "sha": "a99aecc327402fd3a460501eeef0de3929d1c241",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/issues/unexpected export __star__-6bd305.txt",
            "status": "renamed",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fscope-hoisting%2Freexport-star-external-cjs%2Fissues%2Funexpected%20export%20__star__-6bd305.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fscope-hoisting%2Freexport-star-external-cjs%2Fissues%2Funexpected%20export%20__star__-6bd305.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fscope-hoisting%2Freexport-star-external-cjs%2Fissues%2Funexpected%20export%20__star__-6bd305.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,8 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/input/a.js  unexpected export *\n   export * used with module [project]/turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/input/a.js [test] (ecmascript) which is a CommonJS module with exports only available at runtime\n-  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n\\ No newline at end of file\n+  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/input/a.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/input/c.js\n+    ./turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/scope-hoisting/reexport-star-external-cjs/issues/unexpected export __star__-35171b.txt"
        },
        {
            "sha": "d1942adf8903d959f7a41b863ba0d5ca8c192fa7",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -43,7 +43,7 @@ use turbopack_core::{\n     environment::{BrowserEnvironment, Environment, ExecutionEnvironment, NodeJsEnvironment},\n     file_source::FileSource,\n     free_var_references,\n-    issue::{Issue, IssueDescriptionExt},\n+    issue::IssueDescriptionExt,\n     module::Module,\n     module_graph::{\n         ModuleGraph,\n@@ -61,7 +61,7 @@ use turbopack_ecmascript_runtime::RuntimeType;\n use turbopack_env::ProcessEnvAsset;\n use turbopack_nodejs::NodeJsChunkingContext;\n use turbopack_resolve::resolve_options_context::ResolveOptionsContext;\n-use turbopack_test_utils::snapshot::{diff, expected, matches_expected, snapshot_issues};\n+use turbopack_test_utils::snapshot::{UPDATE, diff, expected, matches_expected, snapshot_issues};\n \n use crate::util::REPO_ROOT;\n \n@@ -159,6 +159,9 @@ async fn run(resource: PathBuf) -> Result<()> {\n     let tt = TurboTasks::new(TurboTasksBackend::new(\n         BackendOptions {\n             storage_mode: None,\n+            // Enable dependency tracking when we are running under UPDATE=1 to ensure file writes\n+            // don't crash the test.\n+            dependency_tracking: *UPDATE,\n             ..Default::default()\n         },\n         noop_backing_storage(),\n@@ -182,11 +185,7 @@ async fn run_inner_operation(resource: RcStr) -> Result<()> {\n     let out_vc = out_op.resolve_strongly_consistent().await?;\n     let captured_issues = out_op.peek_issues_with_path().await?;\n \n-    let plain_issues = captured_issues\n-        .iter_with_shortest_path()\n-        .map(|(issue_vc, path)| async move { issue_vc.into_plain(path).await })\n-        .try_join()\n-        .await?;\n+    let plain_issues = captured_issues.get_plain_issues().await?;\n \n     snapshot_issues(plain_issues, out_vc.join(rcstr!(\"issues\")), &REPO_ROOT)\n         .await"
        },
        {
            "sha": "8bd7034acf3f7ab32ba5eef5f7f99fe055e8361c",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/comptime/typeof/issues/Specified module format (EcmaScript Modules) is no-35f78b.txt",
            "status": "renamed",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fcomptime%2Ftypeof%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-35f78b.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fcomptime%2Ftypeof%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-35f78b.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fcomptime%2Ftypeof%2Fissues%2FSpecified%20module%20format%20(EcmaScript%20Modules)%20is%20no-35f78b.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,7 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/snapshot/comptime/typeof/input/esm-specified.mjs  Specified module format (EcmaScript Modules) is not matching the module format of the source code (CommonJs)\n   The EcmaScript module format was specified in the package.json that is affecting this source file or by using an special extension, but it looks like that CommonJs syntax is used in the source code.\n-  Exports made by CommonJs syntax will lead to a runtime error, since the module is in EcmaScript mode. Either change the \"type\" field in the package.json or replace CommonJs syntax with EcmaScript import/export syntax in the source file.\n\\ No newline at end of file\n+  Exports made by CommonJs syntax will lead to a runtime error, since the module is in EcmaScript mode. Either change the \"type\" field in the package.json or replace CommonJs syntax with EcmaScript import/export syntax in the source file.\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/comptime/typeof/input/esm-specified.mjs\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/comptime/typeof/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/comptime/typeof/issues/Specified module format (EcmaScript Modules) is no-848fdd.txt"
        },
        {
            "sha": "692e4b4c458ef8af2cd4f5ba71e5a2db1acafd73",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1001__ import(FreeVar(Math)[__quo__ra-139331.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1001__%20import(FreeVar(Math)%5B__quo__ra-139331.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1001__%20import(FreeVar(Math)%5B__quo__ra-139331.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1001__%20import(FreeVar(Math)%5B__quo__ra-139331.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1001__ import(FreeVar(Math)[__quo__ra-6498b4.txt"
        },
        {
            "sha": "acabfbb215d53f3e0e67818a9e71f406178b77e4",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1002__ require(FreeVar(Math)[__quo__r-7cec26.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1002__%20require(FreeVar(Math)%5B__quo__r-7cec26.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1002__%20require(FreeVar(Math)%5B__quo__r-7cec26.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1002__%20require(FreeVar(Math)%5B__quo__r-7cec26.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1002__ require(FreeVar(Math)[__quo__r-0da151.txt"
        },
        {
            "sha": "46b6bef91a78dba1366a111b0f5fda7b097887e3",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1004__ fs.readFileSync(FreeVar(Math)[-0e7ad9.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-0e7ad9.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-0e7ad9.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-0e7ad9.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1004__ fs.readFileSync(FreeVar(Math)[-2af706.txt"
        },
        {
            "sha": "4ee3e77aa5ab886f4c7695cae478744cd3dbfb18",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1004__ fs.readFileSync(FreeVar(Math)[-e62575.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-e62575.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-e62575.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1004__%20fs.readFileSync(FreeVar(Math)%5B-e62575.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1004__ fs.readFileSync(FreeVar(Math)[-bdaa76.txt"
        },
        {
            "sha": "af6959f93728231675d80752d7f4616718ba388b",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(FreeVa-c7ff8c.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(FreeVa-c7ff8c.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(FreeVa-c7ff8c.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(FreeVa-c7ff8c.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(FreeVa-fdf6b7.txt"
        },
        {
            "sha": "f2b8f9d31ada29e125c56a4f64da9d98b6157276",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(__-1bf930.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__-1bf930.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__-1bf930.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__-1bf930.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(__-c216f4.txt"
        },
        {
            "sha": "1d398d5414b631de086ae14e9ace43c5fc20eb22",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(__quo_-ed2370.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__quo_-ed2370.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__quo_-ed2370.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1005__%20child_process.spawnSync(__quo_-ed2370.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1005__ child_process.spawnSync(__quo_-9cbd49.txt"
        },
        {
            "sha": "2bb2a1483e51428dcf28cc7602c766cc82d77cfd",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1201__ new URL(FreeVar(Math)[__quo__r-cd3de5.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1201__%20new%20URL(FreeVar(Math)%5B__quo__r-cd3de5.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1201__%20new%20URL(FreeVar(Math)%5B__quo__r-cd3de5.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdynamic-request%2Fvery-dynamic%2Fissues%2F__l___lint%20TP1201__%20new%20URL(FreeVar(Math)%5B__quo__r-cd3de5.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/dynamic-request/very-dynamic/issues/__l___lint TP1201__ new URL(FreeVar(Math)[__quo__r-5918dc.txt"
        },
        {
            "sha": "751cfb1fb19251834082daa7f4eee58f8c054a35",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/issues/unexpected export __star__-2d66af.txt",
            "status": "renamed",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-2%2Fissues%2Funexpected%20export%20__star__-2d66af.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-2%2Fissues%2Funexpected%20export%20__star__-2d66af.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-2%2Fissues%2Funexpected%20export%20__star__-2d66af.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,9 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/commonjs.js  unexpected export *\n   export * used with module [project]/turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/commonjs.js [test] (ecmascript) which is a CommonJS module with exports only available at runtime\n-  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n\\ No newline at end of file\n+  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/commonjs.js\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/c.js\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/b.js\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-2/issues/unexpected export __star__-c345e1.txt"
        },
        {
            "sha": "d258d9bc1bc1e6a4e5485934156adbe1d34a9955",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/issues/unexpected export __star__-feb633.txt",
            "status": "renamed",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-script%2Fissues%2Funexpected%20export%20__star__-feb633.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-script%2Fissues%2Funexpected%20export%20__star__-feb633.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fexport-alls%2Fcjs-script%2Fissues%2Funexpected%20export%20__star__-feb633.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -1,3 +1,8 @@\n warning - [analysis] [project]/turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/input/exported.cjs  unexpected export *\n   export * used with module [project]/turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/input/exported.cjs [test] (ecmascript) which is a CommonJS module with exports only available at runtime\n-  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n\\ No newline at end of file\n+  List all export names manually (`export { a, b, c } from \"...\") or rewrite the module to ESM, to avoid the additional runtime code.`\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/input/exported.cjs\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/input/mod.js\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/input/index.js\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/export-alls/cjs-script/issues/unexpected export __star__-3333be.txt"
        },
        {
            "sha": "0b2f1fb02144d357e1a709ede8cd97035d4199db",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/duplicate-binding/issues/Ecmascript file had an error-3ef93d.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fduplicate-binding%2Fissues%2FEcmascript%20file%20had%20an%20error-3ef93d.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fduplicate-binding%2Fissues%2FEcmascript%20file%20had%20an%20error-3ef93d.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fduplicate-binding%2Fissues%2FEcmascript%20file%20had%20an%20error-3ef93d.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/duplicate-binding/issues/Ecmascript file had an error-9b727f.txt"
        },
        {
            "sha": "b71979df9bf55ff0eed6256d6161c95ce74f6655",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/json/issues/Code generation for chunk item errored-fc1795.txt",
            "status": "renamed",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-fc1795.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-fc1795.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fjson%2Fissues%2FCode%20generation%20for%20chunk%20item%20errored-fc1795.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "patch": "@@ -16,4 +16,8 @@ error - [code gen] [project]/turbopack/crates/turbopack-tests/tests/snapshot/imp\n          3 +     \"this-is\": \"invalid\" // lint-staged will remove trailing commas, so here's a comment\n            |                          ^\n          4 |   }\n-         5 | }\n\\ No newline at end of file\n+         5 | }\n+  \n+  Example import trace:\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/invalid.json\n+    ./turbopack/crates/turbopack-tests/tests/snapshot/imports/json/input/index.js [test]\n\\ No newline at end of file",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/json/issues/Code generation for chunk item errored-d57ffb.txt"
        },
        {
            "sha": "7322fca5b97ed4a23b5eced5b73aa4a5454849f6",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/resolve_error_cjs/issues/__l___Module not found____c__ Can't resolve __c_'d-afd823.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_cjs%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-afd823.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_cjs%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-afd823.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_cjs%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-afd823.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/resolve_error_cjs/issues/__l___Module not found____c__ Can't resolve __c_'d-122a13.txt"
        },
        {
            "sha": "52431f06c409740cdd6c276be2bfee50690ec0f4",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/resolve_error_esm/issues/__l___Module not found____c__ Can't resolve __c_'d-801ecb.txt",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_esm%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-801ecb.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/19e8e3c3c2c8b59c810296037df2c818f80049d5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_esm%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-801ecb.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fimports%2Fresolve_error_esm%2Fissues%2F__l___Module%20not%20found____c__%20Can't%20resolve%20__c_'d-801ecb.txt?ref=19e8e3c3c2c8b59c810296037df2c818f80049d5",
            "previous_filename": "turbopack/crates/turbopack-tests/tests/snapshot/imports/resolve_error_esm/issues/__l___Module not found____c__ Can't resolve __c_'d-4fcf36.txt"
        }
    ],
    "stats": {
        "total": 1082,
        "additions": 881,
        "deletions": 201
    }
}