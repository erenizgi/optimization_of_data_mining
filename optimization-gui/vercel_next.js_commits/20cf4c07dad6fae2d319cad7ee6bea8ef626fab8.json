{
    "author": "ztanner",
    "message": "add new devtools indicator loading state (#85083)\n\nThis removes the Next logo animation/dimming and replaces it with more\nexplicit states. We also use this UI to show when caches are being\nwarmed (when using Cache Components). When caches are being bypassed in\nDevTools, we also will show this in the indicator with warning text,\nindicating that we cannot accurately reflect what can be statically\nprerendered.\n\n\n\nhttps://github.com/user-attachments/assets/665d4f8b-8c01-4def-a60e-bc4ecdd1f879",
    "sha": "20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
    "files": [
        {
            "sha": "ebdd0a9671ce541b65c0ee47158234fdae22c295",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -31,10 +31,6 @@ export function DevToolsIndicator() {\n     <Toast\n       id=\"devtools-indicator\"\n       data-nextjs-toast\n-      // TODO: Remove once we have actual UI for this.\n-      data-nextjs-cache-indicator={\n-        state.cacheIndicator === 'disabled' ? undefined : state.cacheIndicator\n-      }\n       style={\n         {\n           '--animate-out-duration-ms': `${MENU_DURATION_MS}ms`,"
        },
        {
            "sha": "789ec44f3a289651e7986ebdc2f1f5a2f38c3c0b",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/next-logo.stories.tsx",
            "status": "modified",
            "additions": 37,
            "deletions": 21,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -10,104 +10,120 @@ const meta: Meta<typeof NextLogo> = {\n   },\n   args: {\n     'aria-label': 'Open Next.js DevTools',\n+    onTriggerClick: () => console.log('Logo clicked'),\n   },\n-  decorators: [withShadowPortal],\n+  decorators: [\n+    (Story) => (\n+      <div style={{ padding: '2rem' }}>\n+        <Story />\n+      </div>\n+    ),\n+    withShadowPortal,\n+  ],\n }\n \n export default meta\n type Story = StoryObj<typeof NextLogo>\n \n-export const NoIssues: Story = {\n+export const Idle: Story = {\n   decorators: [\n     withDevOverlayContexts({\n       totalErrorCount: 0,\n       state: {\n         buildingIndicator: false,\n         renderingIndicator: false,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],\n }\n \n-export const SingleIssue: Story = {\n+export const Compiling: Story = {\n   decorators: [\n     withDevOverlayContexts({\n-      totalErrorCount: 1,\n+      totalErrorCount: 0,\n       state: {\n-        buildingIndicator: false,\n+        buildingIndicator: true,\n         renderingIndicator: false,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],\n }\n \n-export const MultipleIssues: Story = {\n+export const Rendering: Story = {\n   decorators: [\n     withDevOverlayContexts({\n-      totalErrorCount: 5,\n+      totalErrorCount: 0,\n       state: {\n         buildingIndicator: false,\n-        renderingIndicator: false,\n+        renderingIndicator: true,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],\n }\n \n-export const ManyIssues: Story = {\n+export const Prerendering: Story = {\n   decorators: [\n     withDevOverlayContexts({\n-      totalErrorCount: 99,\n+      totalErrorCount: 0,\n       state: {\n         buildingIndicator: false,\n         renderingIndicator: false,\n+        cacheIndicator: 'filling',\n       },\n     }),\n   ],\n }\n \n-export const Building: Story = {\n+export const CacheDisabled: Story = {\n   decorators: [\n     withDevOverlayContexts({\n       totalErrorCount: 0,\n       state: {\n-        buildingIndicator: true,\n-        renderingIndicator: false,\n+        buildingIndicator: false,\n+        renderingIndicator: true,\n+        cacheIndicator: 'bypass',\n       },\n     }),\n   ],\n }\n \n-export const BuildingWithError: Story = {\n+export const WithSingleError: Story = {\n   decorators: [\n     withDevOverlayContexts({\n       totalErrorCount: 1,\n       state: {\n-        buildingIndicator: true,\n+        buildingIndicator: false,\n         renderingIndicator: false,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],\n }\n \n-export const Rendering: Story = {\n+export const WithMultipleErrors: Story = {\n   decorators: [\n     withDevOverlayContexts({\n-      totalErrorCount: 0,\n+      totalErrorCount: 5,\n       state: {\n         buildingIndicator: false,\n-        renderingIndicator: true,\n+        renderingIndicator: false,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],\n }\n \n-export const RenderingWithError: Story = {\n+export const CompilingWithError: Story = {\n   decorators: [\n     withDevOverlayContexts({\n       totalErrorCount: 1,\n       state: {\n-        buildingIndicator: false,\n-        renderingIndicator: true,\n+        buildingIndicator: true,\n+        renderingIndicator: false,\n+        cacheIndicator: 'ready',\n       },\n     }),\n   ],"
        },
        {
            "sha": "fb453ab6af706136685f1b12def2cfa6af5e3f98",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/next-logo.tsx",
            "status": "modified",
            "additions": 123,
            "deletions": 135,
            "changes": 258,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -1,18 +1,19 @@\n import { useRef, useState } from 'react'\n import { useUpdateAnimation } from './hooks/use-update-animation'\n import { useMeasureWidth } from './hooks/use-measure-width'\n-import { useMinimumLoadingTimeMultiple } from './hooks/use-minimum-loading-time-multiple'\n import { Cross } from '../../icons/cross'\n import { Warning } from '../../icons/warning'\n import { css } from '../../utils/css'\n import { useDevOverlayContext } from '../../../dev-overlay.browser'\n import { useRenderErrorContext } from '../../dev-overlay'\n+import { useDelayedRender } from '../../hooks/use-delayed-render'\n import {\n   ACTION_ERROR_OVERLAY_CLOSE,\n   ACTION_ERROR_OVERLAY_OPEN,\n } from '../../shared'\n import { usePanelRouterContext } from '../../menu/context'\n import { BASE_LOGO_SIZE } from '../../utils/indicator-metrics'\n+import { StatusIndicator, Status, getCurrentStatus } from './status-indicator'\n \n const SHORT_DURATION_MS = 150\n \n@@ -40,13 +41,38 @@ export function NextLogo({\n     SHORT_DURATION_MS\n   )\n \n+  // Cache indicator state management\n+  const isCacheFilling = state.cacheIndicator === 'filling'\n+  const isCacheBypassing = state.cacheIndicator === 'bypass'\n+\n+  // Determine if we should show any status\n+  const shouldShowStatus =\n+    state.buildingIndicator ||\n+    state.renderingIndicator ||\n+    isCacheFilling ||\n+    (isCacheBypassing && state.renderingIndicator)\n+\n+  // Delay showing for 400ms to catch fast operations,\n+  // and keep visible for minimum time (longer for warnings)\n+  const { rendered: showStatusIndicator } = useDelayedRender(shouldShowStatus, {\n+    enterDelay: isCacheBypassing && state.renderingIndicator ? 0 : 400, // Bypass warning shows immediately, others delayed\n+    exitDelay: 500,\n+  })\n+\n   const ref = useRef<HTMLDivElement | null>(null)\n   const measuredWidth = useMeasureWidth(ref)\n \n-  const isLoading = useMinimumLoadingTimeMultiple(\n-    state.buildingIndicator || state.renderingIndicator\n+  // Get the current status from the state\n+  const currentStatus = getCurrentStatus(\n+    state.buildingIndicator,\n+    state.renderingIndicator,\n+    state.cacheIndicator\n   )\n-  const isExpanded = isErrorExpanded || state.disableDevIndicator\n+\n+  const displayStatus = showStatusIndicator ? currentStatus : Status.None\n+\n+  const isExpanded =\n+    isErrorExpanded || showStatusIndicator || state.disableDevIndicator\n   const width = measuredWidth === 0 ? 'auto' : measuredWidth\n \n   return (\n@@ -149,6 +175,15 @@ export function NextLogo({\n               }\n             }\n \n+            &[data-status='cache-bypassing'] {\n+              background: rgba(251, 211, 141, 0.95); /* Warm amber background */\n+              --color-inner-border: rgba(245, 158, 11, 0.8);\n+\n+              [data-indicator-status] {\n+                color: rgba(92, 45, 10, 1); /* Dark brown text */\n+              }\n+            }\n+\n             &[data-error-expanded='false'][data-error='true'] ~ [data-dot] {\n               scale: 1;\n             }\n@@ -300,15 +335,6 @@ export function NextLogo({\n             }\n           }\n \n-          .path0 {\n-            animation: draw0 1.5s ease-in-out infinite;\n-          }\n-\n-          .path1 {\n-            animation: draw1 1.5s ease-out infinite;\n-            animation-delay: 0.3s;\n-          }\n-\n           .paused {\n             stroke-dashoffset: 0;\n           }\n@@ -339,44 +365,6 @@ export function NextLogo({\n             }\n           }\n \n-          @keyframes draw0 {\n-            0%,\n-            25% {\n-              stroke-dashoffset: -29.6;\n-            }\n-            25%,\n-            50% {\n-              stroke-dashoffset: 0;\n-            }\n-            50%,\n-            75% {\n-              stroke-dashoffset: 0;\n-            }\n-            75%,\n-            100% {\n-              stroke-dashoffset: 29.6;\n-            }\n-          }\n-\n-          @keyframes draw1 {\n-            0%,\n-            20% {\n-              stroke-dashoffset: -11.6;\n-            }\n-            20%,\n-            50% {\n-              stroke-dashoffset: 0;\n-            }\n-            50%,\n-            75% {\n-              stroke-dashoffset: 0;\n-            }\n-            75%,\n-            100% {\n-              stroke-dashoffset: 11.6;\n-            }\n-          }\n-\n           @media (prefers-reduced-motion) {\n             [data-issues-count-exit],\n             [data-issues-count-enter],\n@@ -390,6 +378,7 @@ export function NextLogo({\n         data-next-badge\n         data-error={hasError}\n         data-error-expanded={isExpanded}\n+        data-status={hasError ? Status.None : currentStatus}\n         data-animate={newErrorDetected}\n         style={{ width }}\n       >\n@@ -400,84 +389,96 @@ export function NextLogo({\n               id=\"next-logo\"\n               ref={triggerRef}\n               data-next-mark\n-              data-next-mark-loading={isLoading}\n               onClick={onTriggerClick}\n               disabled={state.disableDevIndicator}\n               aria-haspopup=\"menu\"\n               aria-expanded={isMenuOpen}\n               aria-controls=\"nextjs-dev-tools-menu\"\n               aria-label={`${isMenuOpen ? 'Close' : 'Open'} Next.js Dev Tools`}\n               data-nextjs-dev-tools-button\n+              style={{\n+                display: showStatusIndicator && !hasError ? 'none' : 'flex',\n+              }}\n               {...buttonProps}\n             >\n-              <NextMark\n-                isLoading={isLoading}\n-                isDevBuilding={state.buildingIndicator}\n-              />\n+              <NextMark />\n             </button>\n           )}\n           {isExpanded && (\n-            <div data-issues>\n-              <button\n-                data-issues-open\n-                aria-label=\"Open issues overlay\"\n-                onClick={() => {\n-                  if (state.isErrorOverlayOpen) {\n-                    dispatch({\n-                      type: ACTION_ERROR_OVERLAY_CLOSE,\n-                    })\n-                    return\n-                  }\n-                  dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n-                  setPanel(null)\n-                }}\n-              >\n-                {state.disableDevIndicator && (\n-                  <div data-disabled-icon>\n-                    <Warning />\n-                  </div>\n-                )}\n-                <AnimateCount\n-                  // Used the key to force a re-render when the count changes.\n-                  key={totalErrorCount}\n-                  animate={newErrorDetected}\n-                  data-issues-count-animation\n-                >\n-                  {totalErrorCount}\n-                </AnimateCount>{' '}\n-                <div>\n-                  Issue\n-                  {totalErrorCount > 1 && (\n-                    <span\n-                      aria-hidden\n-                      data-issues-count-plural\n-                      // This only needs to animate once the count changes from 1 -> 2,\n-                      // otherwise it should stay static between re-renders.\n-                      data-animate={newErrorDetected && totalErrorCount === 2}\n+            <>\n+              {/* Error badge has priority over cache indicator */}\n+              {(isErrorExpanded || state.disableDevIndicator) && (\n+                <div data-issues>\n+                  <button\n+                    data-issues-open\n+                    aria-label=\"Open issues overlay\"\n+                    onClick={() => {\n+                      if (state.isErrorOverlayOpen) {\n+                        dispatch({\n+                          type: ACTION_ERROR_OVERLAY_CLOSE,\n+                        })\n+                        return\n+                      }\n+                      dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+                      setPanel(null)\n+                    }}\n+                  >\n+                    {state.disableDevIndicator && (\n+                      <div data-disabled-icon>\n+                        <Warning />\n+                      </div>\n+                    )}\n+                    <AnimateCount\n+                      // Used the key to force a re-render when the count changes.\n+                      key={totalErrorCount}\n+                      animate={newErrorDetected}\n+                      data-issues-count-animation\n+                    >\n+                      {totalErrorCount}\n+                    </AnimateCount>{' '}\n+                    <div>\n+                      Issue\n+                      {totalErrorCount > 1 && (\n+                        <span\n+                          aria-hidden\n+                          data-issues-count-plural\n+                          // This only needs to animate once the count changes from 1 -> 2,\n+                          // otherwise it should stay static between re-renders.\n+                          data-animate={\n+                            newErrorDetected && totalErrorCount === 2\n+                          }\n+                        >\n+                          s\n+                        </span>\n+                      )}\n+                    </div>\n+                  </button>\n+                  {!state.buildError && (\n+                    <button\n+                      data-issues-collapse\n+                      aria-label=\"Collapse issues badge\"\n+                      onClick={() => {\n+                        if (state.disableDevIndicator) {\n+                          setDismissed(true)\n+                        } else {\n+                          setIsErrorExpanded(false)\n+                        }\n+                        // Move focus to the trigger to prevent having it stuck on this element\n+                        triggerRef.current?.focus()\n+                      }}\n                     >\n-                      s\n-                    </span>\n+                      <Cross data-cross />\n+                    </button>\n                   )}\n                 </div>\n-              </button>\n-              {!state.buildError && (\n-                <button\n-                  data-issues-collapse\n-                  aria-label=\"Collapse issues badge\"\n-                  onClick={() => {\n-                    if (state.disableDevIndicator) {\n-                      setDismissed(true)\n-                    } else {\n-                      setIsErrorExpanded(false)\n-                    }\n-                    // Move focus to the trigger to prevent having it stuck on this element\n-                    triggerRef.current?.focus()\n-                  }}\n-                >\n-                  <Cross data-cross />\n-                </button>\n               )}\n-            </div>\n+              {/* Status indicator shown when no errors */}\n+              {showStatusIndicator &&\n+                !hasError &&\n+                !state.disableDevIndicator && (\n+                  <StatusIndicator status={displayStatus} />\n+                )}\n+            </>\n           )}\n         </div>\n       </div>\n@@ -506,25 +507,12 @@ function AnimateCount({\n   )\n }\n \n-function NextMark({\n-  isLoading,\n-  isDevBuilding,\n-}: {\n-  isLoading?: boolean\n-  isDevBuilding?: boolean\n-}) {\n-  const strokeColor = isDevBuilding ? 'rgba(255,255,255,0.7)' : 'white'\n+function NextMark() {\n   return (\n-    <svg\n-      width=\"40\"\n-      height=\"40\"\n-      viewBox=\"0 0 40 40\"\n-      fill=\"none\"\n-      data-next-mark-loading={isLoading}\n-    >\n+    <svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" fill=\"none\">\n       <g transform=\"translate(8.5, 13)\">\n         <path\n-          className={isLoading ? 'path0' : 'paused'}\n+          className=\"paused\"\n           d=\"M13.3 15.2 L2.34 1 V12.6\"\n           fill=\"none\"\n           stroke=\"url(#next_logo_paint0_linear_1357_10853)\"\n@@ -534,7 +522,7 @@ function NextMark({\n           strokeDashoffset=\"29.6\"\n         />\n         <path\n-          className={isLoading ? 'path1' : 'paused'}\n+          className=\"paused\"\n           d=\"M11.825 1.5 V13.1\"\n           strokeWidth=\"1.86\"\n           stroke=\"url(#next_logo_paint1_linear_1357_10853)\"\n@@ -551,9 +539,9 @@ function NextMark({\n           y2=\"17.9671\"\n           gradientUnits=\"userSpaceOnUse\"\n         >\n-          <stop stopColor={strokeColor} />\n-          <stop offset=\"0.604072\" stopColor={strokeColor} stopOpacity=\"0\" />\n-          <stop offset=\"1\" stopColor={strokeColor} stopOpacity=\"0\" />\n+          <stop stopColor=\"white\" />\n+          <stop offset=\"0.604072\" stopColor=\"white\" stopOpacity=\"0\" />\n+          <stop offset=\"1\" stopColor=\"white\" stopOpacity=\"0\" />\n         </linearGradient>\n         <linearGradient\n           id=\"next_logo_paint1_linear_1357_10853\"\n@@ -563,8 +551,8 @@ function NextMark({\n           y2=\"9.62542\"\n           gradientUnits=\"userSpaceOnUse\"\n         >\n-          <stop stopColor={strokeColor} />\n-          <stop offset=\"1\" stopColor={strokeColor} stopOpacity=\"0\" />\n+          <stop stopColor=\"white\" />\n+          <stop offset=\"1\" stopColor=\"white\" stopOpacity=\"0\" />\n         </linearGradient>\n         <mask id=\"next_logo_mask0\">\n           <rect width=\"100%\" height=\"100%\" fill=\"white\" />"
        },
        {
            "sha": "3e40604608d65689de519300b906cda892bb0151",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/status-indicator.tsx",
            "status": "added",
            "additions": 190,
            "deletions": 0,
            "changes": 190,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fstatus-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fstatus-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fstatus-indicator.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -0,0 +1,190 @@\n+import type { CacheIndicatorState } from '../../cache-indicator'\n+import { css } from '../../utils/css'\n+\n+export enum Status {\n+  None = 'none',\n+  Rendering = 'rendering',\n+  Compiling = 'compiling',\n+  Prerendering = 'prerendering',\n+  CacheBypassing = 'cache-bypassing',\n+}\n+\n+export function getCurrentStatus(\n+  buildingIndicator: boolean,\n+  renderingIndicator: boolean,\n+  cacheIndicator: CacheIndicatorState\n+): Status {\n+  const isCacheFilling = cacheIndicator === 'filling'\n+  const isCacheBypassing = cacheIndicator === 'bypass'\n+\n+  // Priority order: cache bypassing > prerendering > compiling > rendering\n+  if (isCacheBypassing && renderingIndicator) {\n+    return Status.CacheBypassing\n+  }\n+  if (isCacheFilling) {\n+    return Status.Prerendering\n+  }\n+  if (buildingIndicator) {\n+    return Status.Compiling\n+  }\n+  if (renderingIndicator) {\n+    return Status.Rendering\n+  }\n+  return Status.None\n+}\n+\n+interface StatusIndicatorProps {\n+  status: Status\n+}\n+\n+export function StatusIndicator({ status }: StatusIndicatorProps) {\n+  const statusText: Record<Status, string> = {\n+    [Status.None]: '',\n+    [Status.CacheBypassing]: 'Cache disabled',\n+    [Status.Prerendering]: 'Prerendering',\n+    [Status.Compiling]: 'Compiling',\n+    [Status.Rendering]: 'Rendering',\n+  }\n+\n+  // Status dot colors\n+  const statusDotColor: Record<Status, string> = {\n+    [Status.None]: '',\n+    [Status.CacheBypassing]: '', // No dot for bypass, uses full pill color\n+    [Status.Prerendering]: '#f5a623',\n+    [Status.Compiling]: '#f5a623',\n+    [Status.Rendering]: '#50e3c2',\n+  }\n+\n+  if (status === Status.None) {\n+    return null\n+  }\n+\n+  return (\n+    <>\n+      <style>\n+        {css`\n+          [data-indicator-status] {\n+            --padding-left: 8px;\n+            display: flex;\n+            gap: 6px;\n+            align-items: center;\n+            padding-left: 12px;\n+            padding-right: 8px;\n+            height: var(--size-32);\n+            margin-right: 2px;\n+            border-radius: var(--rounded-full);\n+            transition: background var(--duration-short) ease;\n+            color: white;\n+            font-size: var(--size-13);\n+            font-weight: 500;\n+            white-space: nowrap;\n+          }\n+\n+          [data-status-dot] {\n+            width: 8px;\n+            height: 8px;\n+            border-radius: 50%;\n+            flex-shrink: 0;\n+          }\n+\n+          [data-status-text-animation] {\n+            display: inline-flex;\n+            align-items: center;\n+            position: relative;\n+            overflow: hidden;\n+            height: 100%;\n+\n+            > * {\n+              white-space: nowrap;\n+              line-height: 1;\n+            }\n+\n+            [data-status-text-enter] {\n+              animation: slotMachineEnter 150ms cubic-bezier(0, 0, 0.2, 1)\n+                forwards;\n+            }\n+          }\n+\n+          [data-status-ellipsis] {\n+            display: inline-flex;\n+            margin-left: 2px;\n+          }\n+\n+          [data-status-ellipsis] span {\n+            animation: ellipsisFade 1.2s infinite;\n+            margin: 0 1px;\n+          }\n+\n+          [data-status-ellipsis] span:nth-child(2) {\n+            animation-delay: 0.2s;\n+          }\n+\n+          [data-status-ellipsis] span:nth-child(3) {\n+            animation-delay: 0.4s;\n+          }\n+\n+          @keyframes ellipsisFade {\n+            0%,\n+            60%,\n+            100% {\n+              opacity: 0.2;\n+            }\n+            30% {\n+              opacity: 1;\n+            }\n+          }\n+\n+          @keyframes slotMachineEnter {\n+            0% {\n+              transform: translateY(0.8em);\n+              opacity: 0;\n+            }\n+            50% {\n+              opacity: 0.8;\n+            }\n+            100% {\n+              transform: translateY(0);\n+              opacity: 1;\n+            }\n+          }\n+        `}\n+      </style>\n+      <div data-indicator-status>\n+        {statusDotColor[status] && (\n+          <div\n+            data-status-dot\n+            style={{\n+              backgroundColor: statusDotColor[status],\n+            }}\n+          />\n+        )}\n+        <AnimateStatusText\n+          key={status} // Key here triggers re-mount and animation\n+          statusKey={status}\n+        >\n+          {statusText[status]}\n+        </AnimateStatusText>\n+      </div>\n+    </>\n+  )\n+}\n+\n+function AnimateStatusText({\n+  children: text,\n+}: {\n+  children: string\n+  statusKey?: string // Keep for type compatibility but unused\n+}) {\n+  return (\n+    <div data-status-text-animation>\n+      <div data-status-text-enter>\n+        {text}\n+        <span data-status-ellipsis>\n+          <span>.</span>\n+          <span>.</span>\n+          <span>.</span>\n+        </span>\n+      </div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "1e16289378e92aa3c724255ff898ecd5aeb6a2ee",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -213,6 +213,7 @@ import { ImageConfigContext } from '../../shared/lib/image-config-context.shared\n import { imageConfigDefault } from '../../shared/lib/image-config'\n import { RenderStage, StagedRenderingController } from './staged-rendering'\n import { anySegmentHasRuntimePrefetchEnabled } from './staged-validation'\n+import { warnOnce } from '../../shared/lib/utils/warn-once'\n \n export type GetDynamicParamFromSegment = (\n   // [slug] / [[slug]] / [...slug]\n@@ -5268,7 +5269,7 @@ function isBypassingCachesInDev(\n }\n \n function WarnForBypassCachesInDev({ route }: { route: string }) {\n-  console.warn(\n+  warnOnce(\n     `Route ${route} is rendering with server caches disabled. For this navigation, Component Metadata in React DevTools will not accurately reflect what is statically prerenderable and runtime prefetchable. See more info here: https://nextjs.org/docs/messages/cache-bypass-in-dev`\n   )\n   return null"
        },
        {
            "sha": "b96ef8281c8e9bf2a5ac71c43fbac76a5cd1a51d",
            "filename": "test/development/acceptance-app/editor-links.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -72,9 +72,15 @@ describe('Error overlay - editor links', () => {\n         return Boolean(\n           [].slice\n             .call(document.querySelectorAll('nextjs-portal'))\n-            .find((p) =>\n-              p.shadowRoot.querySelector('[data-next-mark-loading=\"false\"]')\n-            )\n+            .find((p) => {\n+              const badge = p.shadowRoot.querySelector('[data-next-badge]')\n+              // Check if badge exists and is not showing any loading status\n+              return (\n+                badge &&\n+                (badge.getAttribute('data-status') === 'none' ||\n+                  !badge.getAttribute('data-status'))\n+              )\n+            })\n         )\n       })\n       expect(loaded).toBe(true)"
        },
        {
            "sha": "09367d77b06ee48c87f6f30825475eea8b44aaf5",
            "filename": "test/development/app-dir/cache-indicator/app/navigation/loading.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Floading.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Loading() {\n+  return <div>Loading...</div>\n+}"
        },
        {
            "sha": "008c1329b6b0171cb3581457e5041d480ab93ddb",
            "filename": "test/development/app-dir/cache-indicator/app/navigation/page.tsx",
            "status": "modified",
            "additions": 36,
            "deletions": 6,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fnavigation%2Fpage.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -1,11 +1,41 @@\n-import { setTimeout } from 'timers/promises'\n+import { cacheTag } from 'next/cache'\n+import { Suspense } from 'react'\n \n-async function triggerSlowCacheFilling() {\n+export default function Page() {\n+  return (\n+    <div id=\"navigation-page\">\n+      Hello navigation page!\n+      <Suspense fallback={<div>Loading</div>}>\n+        <Component />\n+      </Suspense>\n+      <SlowThing />\n+    </div>\n+  )\n+}\n+\n+async function Component() {\n+  const posts = await getBlogPosts()\n+  return (\n+    <div>\n+      {posts.map((post) => (\n+        <div key={post.id}>{post.content}</div>\n+      ))}\n+    </div>\n+  )\n+}\n+\n+async function getBlogPosts() {\n   'use cache'\n-  await setTimeout(1000)\n+  cacheTag('blog-posts')\n+  // sleep for 2s\n+  await new Promise((resolve) => setTimeout(resolve, 2000))\n+\n+  return [{ id: 'foo', content: 'bar' }]\n }\n \n-export default async function NavigationPage() {\n-  await triggerSlowCacheFilling()\n-  return <p>Hello, navigation!</p>\n+async function SlowThing() {\n+  // sleep for 2s\n+  await new Promise((resolve) => setTimeout(resolve, 2000))\n+\n+  return <div>Slow Thing</div>\n }"
        },
        {
            "sha": "5700c22a3a91eeec4f962898b4b54ad1cde98991",
            "filename": "test/development/app-dir/cache-indicator/app/page.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fapp%2Fpage.tsx?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -1,11 +1,3 @@\n-import { setTimeout } from 'timers/promises'\n-\n-async function triggerSlowCacheFilling() {\n-  'use cache'\n-  await setTimeout(1000)\n-}\n-\n export default async function Page() {\n-  await triggerSlowCacheFilling()\n   return <p>Hello, initial load!</p>\n }"
        },
        {
            "sha": "411b5e569cea01a0b6569b9b1e3573465a5a0840",
            "filename": "test/development/app-dir/cache-indicator/cache-indicator.test.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 6,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fcache-indicator.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fcache-indicator.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-indicator%2Fcache-indicator.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -1,4 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n \n const enableCacheComponents = process.env.__NEXT_CACHE_COMPONENTS === 'true'\n \n@@ -7,13 +8,36 @@ describe('cache-indicator', () => {\n     files: __dirname,\n   })\n \n-  it('is filled on initial load', async () => {\n+  it('is none on initial load', async () => {\n     const browser = await next.browser('/')\n \n-    const toast = await browser.elementByCss('[data-nextjs-toast]')\n-\n-    expect(await toast.getAttribute('data-nextjs-cache-indicator')).toEqual(\n-      enableCacheComponents ? 'filled' : null\n-    )\n+    const badge = await browser.elementByCss('[data-next-badge]')\n+    const cacheStatus = await badge.getAttribute('data-status')\n+    expect(cacheStatus).toBe('none')\n   })\n+\n+  if (enableCacheComponents) {\n+    it('renders the cache warming indicator when navigating to a page that needs to warm the cache', async () => {\n+      const browser = await next.browser('/')\n+\n+      // navigate to the navigation page\n+      const link = await browser.waitForElementByCss('a[href=\"/navigation\"]')\n+      await link.click()\n+\n+      await retry(async () => {\n+        const badge = await browser.elementByCss('[data-next-badge]')\n+        const cacheStatus = await badge.getAttribute('data-status')\n+        expect(cacheStatus).toBe('prerendering')\n+      })\n+\n+      await retry(async () => {\n+        const text = await browser.elementByCss('#navigation-page').text()\n+        expect(text).toContain('Hello navigation page!')\n+      })\n+\n+      const badge = await browser.elementByCss('[data-next-badge]')\n+      const status = await badge.getAttribute('data-status')\n+      expect(status).toBe('none')\n+    })\n+  }\n })"
        },
        {
            "sha": "424a8ac38d17f74efd7de5cc68564b60ad832214",
            "filename": "test/development/basic/gssp-ssr-change-reloading/test/index.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -10,9 +10,13 @@ const installCheckVisible = (browser) => {\n   return browser.eval(`(function() {\n       window.checkInterval = setInterval(function() {\n       const root = document.querySelector('nextjs-portal').shadowRoot;\n-      const indicator = root.querySelector('[data-next-mark]')\n+      const statusElement = root.querySelector('[data-indicator-status]')\n+      const badge = root.querySelector('[data-next-badge]')\n+      const status = badge ? badge.getAttribute('data-status') : null\n+\n+      // Check if we're showing any status\n       window.showedBuilder = window.showedBuilder || (\n-        indicator.getAttribute('data-next-mark-loading') === 'true'\n+        statusElement !== null || (status && status !== 'none')\n       )\n       if (window.showedBuilder) clearInterval(window.checkInterval)\n     }, 50)"
        },
        {
            "sha": "1282f555946efe58521da88c6a7b10fb090a887e",
            "filename": "test/development/dev-indicator/dev-rendering-indicator.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fdev-rendering-indicator.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -7,9 +7,13 @@ const installCheckVisible = (browser) => {\n   return browser.eval(`(function() {\n       window.checkInterval = setInterval(function() {\n       const root = document.querySelector('nextjs-portal').shadowRoot;\n-      const indicator = root.querySelector('[data-next-mark]')\n+      const statusElement = root.querySelector('[data-indicator-status]')\n+      const badge = root.querySelector('[data-next-badge]')\n+      const status = badge ? badge.getAttribute('data-status') : null\n+\n+      // Check if we're showing any status (rendering, compiling, etc.)\n       window.showedBuilder = window.showedBuilder || (\n-        indicator.getAttribute('data-next-mark-loading') === 'true'\n+        statusElement !== null || (status && status !== 'none')\n       )\n       if (window.showedBuilder) clearInterval(window.checkInterval)\n     }, 5)"
        },
        {
            "sha": "55b44813d35b9e105b9e60161e25c149cf302be7",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-dev-cache-bypass.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-dev-cache-bypass.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-dev-cache-bypass.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-dev-cache-bypass.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -28,13 +28,13 @@ describe('Cache Components Errors', () => {\n       it('warns if you render with cache-control: no-cache in dev on client navigation', async () => {\n         const from = next.cliOutput.length\n \n-        await next.fetch('/', {\n+        await next.fetch('/other', {\n           headers: { 'cache-control': 'no-cache', RSC: '1' },\n         })\n \n         expect(stripGetLines(next.cliOutput.slice(from)))\n           .toMatchInlineSnapshot(`\n-         \"Route / is rendering with server caches disabled. For this navigation, Component Metadata in React DevTools will not accurately reflect what is statically prerenderable and runtime prefetchable. See more info here: https://nextjs.org/docs/messages/cache-bypass-in-dev\n+         \"Route /other is rendering with server caches disabled. For this navigation, Component Metadata in React DevTools will not accurately reflect what is statically prerenderable and runtime prefetchable. See more info here: https://nextjs.org/docs/messages/cache-bypass-in-dev\n          \"\n         `)\n       })"
        },
        {
            "sha": "f93fe2643fcea6a6fe57598f52e85fb211c48e60",
            "filename": "test/e2e/build-indicator/test/index.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fe2e%2Fbuild-indicator%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/20cf4c07dad6fae2d319cad7ee6bea8ef626fab8/test%2Fe2e%2Fbuild-indicator%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fbuild-indicator%2Ftest%2Findex.test.ts?ref=20cf4c07dad6fae2d319cad7ee6bea8ef626fab8",
            "patch": "@@ -7,10 +7,13 @@ const installCheckVisible = (browser) => {\n   return browser.eval(`(function() {\n       window.checkInterval = setInterval(function() {\n       const root = document.querySelector('nextjs-portal').shadowRoot;\n-      const indicator = root.querySelector('[data-next-mark]')\n-      if(!indicator) return\n+      const statusElement = root.querySelector('[data-indicator-status]')\n+      const badge = root.querySelector('[data-next-badge]')\n+      const status = badge ? badge.getAttribute('data-status') : null\n+\n+      // Check if we're showing any build/compile status\n       window.showedBuilder = window.showedBuilder || (\n-        indicator.getAttribute('data-next-mark-loading') === 'true'\n+        statusElement !== null || (status && status !== 'none')\n       )\n       if (window.showedBuilder) clearInterval(window.checkInterval)\n     }, 5)"
        }
    ],
    "stats": {
        "total": 643,
        "additions": 450,
        "deletions": 193
    }
}