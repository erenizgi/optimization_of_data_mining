{
    "author": "bgw",
    "message": "chore: Remove useless symlink resolution logic in `recursive-delete.js` (#84582)\n\nIf `isSymlink` is `true`, then none of the branches that check for `isDirectory` can be taken, so following symlinks to set `isDirectory` to `true` is useless.\n\nThis more closely mirrors most recursive directory deletion algorithms out there, which skip symlink resolution entirely.\n\n## History\n\nThis logic was added in: https://github.com/vercel/next.js/pull/27779\nAnd the symlink logic was nerfed in: https://github.com/vercel/next.js/pull/82191",
    "sha": "e2eee896592679fd4947735a0ae2ac4649bb89bf",
    "files": [
        {
            "sha": "114c1cb5314c8dd6413eac7dd03a54d9ab002e22",
            "filename": "packages/next/src/lib/recursive-delete.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 22,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/e2eee896592679fd4947735a0ae2ac4649bb89bf/packages%2Fnext%2Fsrc%2Flib%2Frecursive-delete.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e2eee896592679fd4947735a0ae2ac4649bb89bf/packages%2Fnext%2Fsrc%2Flib%2Frecursive-delete.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Frecursive-delete.ts?ref=e2eee896592679fd4947735a0ae2ac4649bb89bf",
            "patch": "@@ -1,6 +1,6 @@\n import type { Dirent } from 'node:fs'\n import * as fs from 'node:fs'\n-import { join, isAbsolute, dirname } from 'node:path'\n+import { join } from 'node:path'\n import isError from './is-error'\n import { wait } from './wait'\n \n@@ -90,33 +90,17 @@ export async function recursiveDeleteSyncWithAsyncRetries(\n   await Promise.all(\n     result.map(async (part: Dirent) => {\n       const absolutePath = join(dir, part.name)\n-\n-      // readdir does not follow symbolic links\n-      // if part is a symbolic link, follow it using stat\n-      let isDirectory = part.isDirectory()\n-      const isSymlink = part.isSymbolicLink()\n-\n-      if (isSymlink) {\n-        const linkPath = fs.readlinkSync(absolutePath)\n-\n-        try {\n-          const stats = fs.statSync(\n-            isAbsolute(linkPath)\n-              ? linkPath\n-              : join(dirname(absolutePath), linkPath)\n-          )\n-          isDirectory = stats.isDirectory()\n-        } catch {}\n-      }\n-\n       const pp = join(previousPath, part.name)\n       const isNotExcluded = !exclude || !exclude.test(pp)\n \n       if (isNotExcluded) {\n-        if (!isSymlink && isDirectory) {\n+        // Note: readdir does not follow symbolic links, that's good: we want to\n+        // delete the links and not the destination.\n+        let isDirectory = part.isDirectory()\n+        if (isDirectory) {\n           await recursiveDeleteSyncWithAsyncRetries(absolutePath, exclude, pp)\n         }\n-        return unlinkPath(absolutePath, !isSymlink && isDirectory)\n+        return unlinkPath(absolutePath, isDirectory)\n       }\n     })\n   )"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 6,
        "deletions": 22
    }
}