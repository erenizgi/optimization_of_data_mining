{
    "author": "lubieowoce",
    "message": "Guard against Object/Array shadowing in 'use cache' transform (#88229)\n\nThe transform output for 'use cache' uses `Object.defineProperty` and\n`Array.prototype.slice`. In theory, it's possible for a module to shadow\nthose names and break it:\n```ts\n// i want to suffer!\nconst Array = {}\nconst Object = {}\n\nasync function cached() {\n  \"use cache\"\n  ...\n}\n```\n\nWe should defensively make sure that our transform's output refers to\nthe actual Object/Array builtins, not whatever's in scope for that name.\nWe can do this by using an unresolved syntax context for the\nidentifiers. This is what we do for `require()` elsewhere:\nhttps://github.com/vercel/next.js/blob/6805af48baf1128e6b2a9e8f1752ee5982f02c60/crates/next-custom-transforms/src/transforms/track_dynamic_imports.rs#L119-L122\nUsing `quote_ident!(unresolved_ctxt, \"Array\")` will cause SWC to rename\nany local redefinitions of `Array` to something that doesn't clash\n(which can be seen in the added snapshots).",
    "sha": "c0d6a5d81e169b25defcd45c776714165b240bb7",
    "files": [
        {
            "sha": "585d817b4785a566ec12907dad76986c4ec509a5",
            "filename": "crates/next-core/src/next_shared/transforms/server_actions.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fserver_actions.rs?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -71,6 +71,7 @@ impl CustomTransformer for NextServerActions {\n                 cache_kinds: self.cache_kinds.owned().await?,\n             },\n             ctx.comments.clone(),\n+            ctx.unresolved_mark,\n             ctx.source_map.clone(),\n             Default::default(),\n             ServerActionsMode::Turbopack,"
        },
        {
            "sha": "b38627d742ab03e87aec4f8e6b99176f84b0f853",
            "filename": "crates/next-custom-transforms/src/chain_transforms.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Fsrc%2Fchain_transforms.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Fsrc%2Fchain_transforms.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Fchain_transforms.rs?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -322,6 +322,7 @@ where\n                     None,\n                     config.clone(),\n                     comments.clone(),\n+                    unresolved_mark,\n                     cm.clone(),\n                     use_cache_telemetry_tracker,\n                     ServerActionsMode::Webpack,"
        },
        {
            "sha": "e9ff6ebcf1c201ff996782c91d193d091216a5ce",
            "filename": "crates/next-custom-transforms/src/transforms/server_actions.rs",
            "status": "modified",
            "additions": 35,
            "deletions": 6,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Fserver_actions.rs?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -138,12 +138,14 @@ enum ServerActionsErrorKind {\n     },\n }\n \n+#[allow(clippy::too_many_arguments)]\n #[tracing::instrument(level = tracing::Level::TRACE, skip_all)]\n pub fn server_actions<C: Comments>(\n     file_name: &FileName,\n     file_query: Option<RcStr>,\n     config: Config,\n     comments: C,\n+    unresolved_mark: Mark,\n     cm: Arc<SourceMap>,\n     use_cache_telemetry_tracker: Rc<RefCell<FxHashMap<String, usize>>>,\n     mode: ServerActionsMode,\n@@ -184,6 +186,7 @@ pub fn server_actions<C: Comments>(\n         server_reference_exports: Default::default(),\n \n         private_ctxt: SyntaxContext::empty().apply_mark(Mark::new()),\n+        unresolved_ctxt: SyntaxContext::empty().apply_mark(unresolved_mark),\n \n         arrow_or_fn_expr_ident: None,\n         export_name_by_local_id: Default::default(),\n@@ -258,6 +261,7 @@ struct ServerActions<C: Comments> {\n     server_reference_exports: Vec<ServerReferenceExport>,\n \n     private_ctxt: SyntaxContext,\n+    unresolved_ctxt: SyntaxContext,\n \n     arrow_or_fn_expr_ident: Option<Ident>,\n     export_name_by_local_id: FxIndexMap<Id, ModuleExportName>,\n@@ -848,13 +852,15 @@ impl<C: Comments> ServerActions<C> {\n             inner_fn_body,\n             arrow.span,\n             &mut self.hoisted_extra_items,\n+            self.unresolved_ctxt,\n         );\n \n         if let Some(Ident { sym, .. }) = &self.arrow_or_fn_expr_ident {\n             self.hoisted_extra_items\n                 .push(ModuleItem::Stmt(assign_name_to_ident(\n                     &cache_ident,\n                     sym.as_str(),\n+                    self.unresolved_ctxt,\n                 )));\n         }\n \n@@ -940,19 +946,22 @@ impl<C: Comments> ServerActions<C> {\n             function_body,\n             function_span,\n             &mut self.hoisted_extra_items,\n+            self.unresolved_ctxt,\n         );\n \n         if let Some(Ident { ref sym, .. }) = fn_name {\n             self.hoisted_extra_items\n                 .push(ModuleItem::Stmt(assign_name_to_ident(\n                     &cache_ident,\n                     sym.as_str(),\n+                    self.unresolved_ctxt,\n                 )));\n         } else if self.is_default_export() {\n             self.hoisted_extra_items\n                 .push(ModuleItem::Stmt(assign_name_to_ident(\n                     &cache_ident,\n                     \"default\",\n+                    self.unresolved_ctxt,\n                 )));\n         }\n \n@@ -1049,6 +1058,7 @@ impl<C: Comments> ServerActions<C> {\n                     .push(ModuleItem::Stmt(assign_name_to_ident(\n                         &action_ident,\n                         \"default\",\n+                        self.unresolved_ctxt,\n                     )));\n \n                 self.rewrite_default_fn_expr_to_proxy_expr =\n@@ -2421,6 +2431,7 @@ impl<C: Comments> VisitMut for ServerActions<C> {\n                                         Expr::Ident(ident.clone()),\n                                         ident.span,\n                                         None,\n+                                        self.unresolved_ctxt,\n                                     )),\n                                 })),\n                             }),\n@@ -2438,7 +2449,11 @@ impl<C: Comments> VisitMut for ServerActions<C> {\n                         // Only assign a name if the original ident is not a generated one.\n                         if !ident.sym.starts_with(\"$$RSC_SERVER_\") {\n                             // Object.defineProperty($$RSC_SERVER_CACHE_exportName, \"name\", {...});\n-                            stmts.push(assign_name_to_ident(&wrapper_ident, &ident.sym));\n+                            stmts.push(assign_name_to_ident(\n+                                &wrapper_ident,\n+                                &ident.sym,\n+                                self.unresolved_ctxt,\n+                            ));\n                         }\n \n                         stmts\n@@ -2957,6 +2972,7 @@ fn may_need_cache_runtime_wrapper(expr: &Expr) -> bool {\n \n /// Creates a cache wrapper expression:\n /// $$reactCache__(function name() { return $$cache__(...) })\n+#[allow(clippy::too_many_arguments)]\n fn create_cache_wrapper(\n     cache_kind: &str,\n     reference_id: Atom,\n@@ -2965,6 +2981,7 @@ fn create_cache_wrapper(\n     target_expr: Expr,\n     original_span: Span,\n     params: Option<&[Param]>,\n+    unresolved_ctxt: SyntaxContext,\n ) -> Expr {\n     let cache_call = CallExpr {\n         span: original_span,\n@@ -2993,7 +3010,8 @@ fn create_cache_wrapper(\n                     } else {\n                         // Slice to declared params length to ignore unused arguments.\n                         Box::new(quote!(\n-                            \"Array.prototype.slice.call(arguments, 0, $end)\" as Expr,\n+                            \"$array.prototype.slice.call(arguments, 0, $end)\" as Expr,\n+                            array = quote_ident!(unresolved_ctxt, \"Array\"),\n                             end: Expr = params.len().into(),\n                         ))\n                         .as_arg()\n@@ -3002,7 +3020,11 @@ fn create_cache_wrapper(\n                 // The params are statically unknown, or rest params are used.\n                 _ => {\n                     // Pass all arguments as an array.\n-                    Box::new(quote!(\"Array.prototype.slice.call(arguments)\" as Expr,)).as_arg()\n+                    Box::new(quote!(\n+                        \"$array.prototype.slice.call(arguments)\" as Expr,\n+                        array = quote_ident!(unresolved_ctxt, \"Array\"),\n+                    ))\n+                    .as_arg()\n                 }\n             },\n         ],\n@@ -3043,6 +3065,7 @@ fn create_and_hoist_cache_function(\n     body: Option<BlockStmt>,\n     original_span: Span,\n     hoisted_extra_items: &mut Vec<ModuleItem>,\n+    unresolved_ctxt: SyntaxContext,\n ) -> Ident {\n     let cache_ident = private_ident!(Span::dummy_with_cmt(), cache_name.clone());\n     let inner_fn_name: Atom = format!(\"{}_INNER\", cache_name).into();\n@@ -3056,6 +3079,7 @@ fn create_and_hoist_cache_function(\n         Expr::Ident(inner_fn_ident.clone()),\n         original_span,\n         Some(&params),\n+        unresolved_ctxt,\n     ));\n \n     let inner_fn_expr = FnExpr {\n@@ -3087,7 +3111,11 @@ fn create_and_hoist_cache_function(\n     // For anonymous functions, set the name property to an empty string to\n     // avoid leaking the internal variable name in stack traces.\n     if fn_ident.is_none() {\n-        hoisted_extra_items.push(ModuleItem::Stmt(assign_name_to_ident(&inner_fn_ident, \"\")));\n+        hoisted_extra_items.push(ModuleItem::Stmt(assign_name_to_ident(\n+            &inner_fn_ident,\n+            \"\",\n+            unresolved_ctxt,\n+        )));\n     }\n \n     hoisted_extra_items.push(ModuleItem::ModuleDecl(ModuleDecl::ExportDecl(ExportDecl {\n@@ -3117,7 +3145,7 @@ fn create_and_hoist_cache_function(\n     cache_ident\n }\n \n-fn assign_name_to_ident(ident: &Ident, name: &str) -> Stmt {\n+fn assign_name_to_ident(ident: &Ident, name: &str, unresolved_ctxt: SyntaxContext) -> Stmt {\n     // Assign a name with `Object.defineProperty($$ACTION_0, 'name', {value: 'default'})`\n     quote!(\n         // WORKAROUND for https://github.com/microsoft/TypeScript/issues/61165\n@@ -3127,8 +3155,9 @@ fn assign_name_to_ident(ident: &Ident, name: &str) -> Stmt {\n         //\n         // but due to the above typescript bug, `Object.defineProperty` calls are typechecked incorrectly\n         // in js files, and it can cause false positives when typechecking our fixture files.\n-        \"Object[\\\"defineProperty\\\"]($action, \\\"name\\\", { value: $name });\"\n+        \"$object[\\\"defineProperty\\\"]($action, \\\"name\\\", { value: $name });\"\n             as Stmt,\n+        object = quote_ident!(unresolved_ctxt, \"Object\"),\n         action: Ident = ident.clone(),\n         name: Expr = name.into(),\n     )"
        },
        {
            "sha": "f30a3749ed6fde9912825417e4b1ccb2db8fd1a9",
            "filename": "crates/next-custom-transforms/tests/errors.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ferrors.rs?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -162,10 +162,11 @@ fn react_server_actions_errors(input: PathBuf) {\n     test_fixture(\n         syntax(),\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n                 // The transforms are intentionally declared in the same order as in\n                 // crates/next-custom-transforms/src/chain_transforms.rs\n-                resolver(Mark::new(), Mark::new(), false),\n+                resolver(unresolved_mark, Mark::new(), false),\n                 server_components(\n                     FileName::Real(PathBuf::from(\"/app/item.js\")).into(),\n                     Config::WithOptions(Options {\n@@ -188,6 +189,7 @@ fn react_server_actions_errors(input: PathBuf) {\n                         cache_kinds: FxHashSet::default(),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     ServerActionsMode::Webpack,\n@@ -229,10 +231,11 @@ fn use_cache_not_allowed(input: PathBuf) {\n     test_fixture(\n         syntax(),\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n                 // The transforms are intentionally declared in the same order as in\n                 // crates/next-custom-transforms/src/chain_transforms.rs\n-                resolver(Mark::new(), Mark::new(), false),\n+                resolver(unresolved_mark, Mark::new(), false),\n                 server_components(\n                     FileName::Real(PathBuf::from(\"/app/item.js\")).into(),\n                     Config::WithOptions(Options {\n@@ -255,6 +258,7 @@ fn use_cache_not_allowed(input: PathBuf) {\n                         cache_kinds: FxHashSet::from_iter([rcstr!(\"x\")]),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     ServerActionsMode::Webpack,"
        },
        {
            "sha": "4e5da43038e6104d2c9b10e3396a419154cedbf9",
            "filename": "crates/next-custom-transforms/tests/fixture.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture.rs?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -477,6 +477,7 @@ fn react_server_components_fixture(input: PathBuf) {\n     test_fixture(\n         syntax(),\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n                 // The transforms are intentionally declared in the same order as in\n                 // crates/next-custom-transforms/src/chain_transforms.rs\n@@ -502,6 +503,7 @@ fn react_server_components_fixture(input: PathBuf) {\n                         cache_kinds: FxHashSet::default(),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     ServerActionsMode::Webpack,\n@@ -561,8 +563,9 @@ fn server_actions_fixture(input: PathBuf) {\n     test_fixture(\n         input_syntax,\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n-                resolver(Mark::new(), Mark::new(), false),\n+                resolver(unresolved_mark, Mark::new(), false),\n                 server_actions(\n                     &FileName::Real(\"/app/item.js\".into()),\n                     None,\n@@ -574,6 +577,7 @@ fn server_actions_fixture(input: PathBuf) {\n                         cache_kinds: FxHashSet::from_iter([\"x\".into()]),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     mode,\n@@ -595,8 +599,9 @@ fn next_font_with_directive_fixture(input: PathBuf) {\n     test_fixture(\n         syntax(),\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n-                resolver(Mark::new(), Mark::new(), false),\n+                resolver(unresolved_mark, Mark::new(), false),\n                 next_font_loaders(FontLoaderConfig {\n                     relative_file_path_from_root: \"app/test.tsx\".into(),\n                     font_loaders: vec![\"@next/font/google\".into()],\n@@ -612,6 +617,7 @@ fn next_font_with_directive_fixture(input: PathBuf) {\n                         cache_kinds: FxHashSet::default(),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     ServerActionsMode::Webpack,\n@@ -912,8 +918,9 @@ fn test_source_maps(input: PathBuf) {\n     test_fixture(\n         syntax(),\n         &|tr| {\n+            let unresolved_mark = Mark::new();\n             (\n-                resolver(Mark::new(), Mark::new(), false),\n+                resolver(unresolved_mark, Mark::new(), false),\n                 server_actions(\n                     &FileName::Real(\"/app/item.js\".into()),\n                     None,\n@@ -925,6 +932,7 @@ fn test_source_maps(input: PathBuf) {\n                         cache_kinds: FxHashSet::from_iter([]),\n                     },\n                     tr.comments.as_ref().clone(),\n+                    unresolved_mark,\n                     tr.cm.clone(),\n                     Default::default(),\n                     mode,"
        },
        {
            "sha": "8d81984f415b16677b3b97b653c4600e155dcb3c",
            "filename": "crates/next-custom-transforms/tests/fixture/server-actions/server-graph/70/input.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Finput.js?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -0,0 +1,7 @@\n+// shadow the builtin Array global (used in the transform output)\n+const Array = {}\n+\n+export async function action(x) {\n+  'use cache'\n+  return x\n+}"
        },
        {
            "sha": "3259c45b3c6d6fc454e4c3e21b88eada8336532c",
            "filename": "crates/next-custom-transforms/tests/fixture/server-actions/server-graph/70/output.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Foutput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Foutput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F70%2Foutput.js?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -0,0 +1,16 @@\n+import { registerServerReference } from \"private-next-rsc-server-reference\";\n+import { cache as $$cache__ } from \"private-next-rsc-cache-wrapper\";\n+import { cache as $$reactCache__ } from \"react\";\n+// shadow the builtin Array global (used in the transform output)\n+/* __next_internal_action_entry_do_not_use__ {\"c03128060c414d59f8552e4788b846c0d2b7f74743\":\"$$RSC_SERVER_CACHE_0\"} */ const Array1 = {};\n+const $$RSC_SERVER_CACHE_0_INNER = async function action(x) {\n+    return x;\n+};\n+export var $$RSC_SERVER_CACHE_0 = $$reactCache__(function action() {\n+    return $$cache__(\"default\", \"c03128060c414d59f8552e4788b846c0d2b7f74743\", 0, $$RSC_SERVER_CACHE_0_INNER, Array.prototype.slice.call(arguments, 0, 1));\n+});\n+registerServerReference($$RSC_SERVER_CACHE_0, \"c03128060c414d59f8552e4788b846c0d2b7f74743\", null);\n+Object[\"defineProperty\"]($$RSC_SERVER_CACHE_0, \"name\", {\n+    value: \"action\"\n+});\n+export var action = $$RSC_SERVER_CACHE_0;"
        },
        {
            "sha": "cfe42d9d9bbad50775b7d6e7ba636079afe7b668",
            "filename": "crates/next-custom-transforms/tests/fixture/server-actions/server-graph/71/input.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Finput.js?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -0,0 +1,7 @@\n+// shadow the builtin Object global (used in transform output)\n+const Object = {}\n+\n+export async function foo() {\n+  'use cache'\n+  return 1\n+}"
        },
        {
            "sha": "dc92360c361ee269c200e53ee743dacea40056b2",
            "filename": "crates/next-custom-transforms/tests/fixture/server-actions/server-graph/71/output.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Foutput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c0d6a5d81e169b25defcd45c776714165b240bb7/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Foutput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Ftests%2Ffixture%2Fserver-actions%2Fserver-graph%2F71%2Foutput.js?ref=c0d6a5d81e169b25defcd45c776714165b240bb7",
            "patch": "@@ -0,0 +1,16 @@\n+import { registerServerReference } from \"private-next-rsc-server-reference\";\n+import { cache as $$cache__ } from \"private-next-rsc-cache-wrapper\";\n+import { cache as $$reactCache__ } from \"react\";\n+// shadow the builtin Object global (used in transform output)\n+/* __next_internal_action_entry_do_not_use__ {\"803128060c414d59f8552e4788b846c0d2b7f74743\":\"$$RSC_SERVER_CACHE_0\"} */ const Object1 = {};\n+const $$RSC_SERVER_CACHE_0_INNER = async function foo() {\n+    return 1;\n+};\n+export var $$RSC_SERVER_CACHE_0 = $$reactCache__(function foo() {\n+    return $$cache__(\"default\", \"803128060c414d59f8552e4788b846c0d2b7f74743\", 0, $$RSC_SERVER_CACHE_0_INNER, []);\n+});\n+registerServerReference($$RSC_SERVER_CACHE_0, \"803128060c414d59f8552e4788b846c0d2b7f74743\", null);\n+Object[\"defineProperty\"]($$RSC_SERVER_CACHE_0, \"name\", {\n+    value: \"foo\"\n+});\n+export var foo = $$RSC_SERVER_CACHE_0;"
        }
    ],
    "stats": {
        "total": 111,
        "additions": 100,
        "deletions": 11
    }
}