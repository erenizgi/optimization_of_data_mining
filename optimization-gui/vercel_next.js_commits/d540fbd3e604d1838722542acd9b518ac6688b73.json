{
    "author": "devjiwonchoi",
    "message": "Deprecate Middleware API and add Proxy API (#84764)\n\nFollowing up on https://github.com/vercel/next.js/pull/84119, this PR\ndeprecated the user-facing middleware API and added a replacement Proxy\nAPI.\n\n---------\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "d540fbd3e604d1838722542acd9b518ac6688b73",
    "files": [
        {
            "sha": "8c558a34800192ff84473f1cd4db9ce189f83041",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1156,8 +1156,8 @@ impl Project {\n         let config = self.next_config();\n \n         emit_event(\n-            \"skipMiddlewareUrlNormalize\",\n-            *config.skip_middleware_url_normalize().await?,\n+            \"skipProxyUrlNormalize\",\n+            *config.skip_proxy_url_normalize().await?,\n         );\n \n         emit_event("
        },
        {
            "sha": "54ae7fac00260b9b4eaf93072514a8f97bfc3c04",
            "filename": "crates/next-build-test/nextConfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-build-test%2FnextConfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-build-test%2FnextConfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-build-test%2FnextConfig.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -69,7 +69,7 @@\n     \"clientRouterFilter\": true,\n     \"clientRouterFilterRedirects\": false,\n     \"fetchCacheKeyPrefix\": \"\",\n-    \"middlewarePrefetch\": \"flexible\",\n+    \"proxyPrefetch\": \"flexible\",\n     \"optimisticClientCache\": true,\n     \"manualClientBasePath\": false,\n     \"cpus\": 2,"
        },
        {
            "sha": "8fe3c4a08ed32704145fc235d4c07935f4cef7d3",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -102,7 +102,7 @@ pub struct NextConfig {\n     trailing_slash: Option<bool>,\n     asset_prefix: Option<RcStr>,\n     base_path: Option<RcStr>,\n-    skip_middleware_url_normalize: Option<bool>,\n+    skip_proxy_url_normalize: Option<bool>,\n     skip_trailing_slash_redirect: Option<bool>,\n     i18n: Option<I18NConfig>,\n     cross_origin: Option<CrossOriginConfig>,\n@@ -1660,8 +1660,8 @@ impl NextConfig {\n     }\n \n     #[turbo_tasks::function]\n-    pub fn skip_middleware_url_normalize(&self) -> Vc<bool> {\n-        Vc::cell(self.skip_middleware_url_normalize.unwrap_or(false))\n+    pub fn skip_proxy_url_normalize(&self) -> Vc<bool> {\n+        Vc::cell(self.skip_proxy_url_normalize.unwrap_or(false))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "319d6c9ca2c635215c719c770eb448c71f787c73",
            "filename": "crates/next-core/src/segment_config.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fsegment_config.rs?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -572,7 +572,7 @@ async fn parse_config_value(\n ) -> Result<()> {\n     let get_value = || {\n         let init = init.as_deref();\n-        // Unwrap `export const config = { .. } satisfies MiddlewareConfig`, usually this is already\n+        // Unwrap `export const config = { .. } satisfies ProxyConfig`, usually this is already\n         // transpiled away, but we are looking at the original source here.\n         let init = if let Some(Expr::TsSatisfies(TsSatisfiesExpr { expr, .. })) = init {\n             Some(&**expr)"
        },
        {
            "sha": "1647c8bf72e9ec81ba92e73c7ed9c5ad054704e8",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -874,5 +874,9 @@\n   \"873\": \"Invalid profile provided \\\"%s\\\" must be configured under cacheLife in next.config or be \\\"max\\\"\",\n   \"874\": \"Expected not to install Node.js global behaviors in the edge runtime.\",\n   \"875\": \"`pipelineInSequentialTasks` should not be called in edge runtime.\",\n-  \"876\": \"dynamicInDevStagedRendering should only be used in development mode and when Cache Components is enabled.\"\n+  \"876\": \"dynamicInDevStagedRendering should only be used in development mode and when Cache Components is enabled.\",\n+  \"877\": \"Config options `experimental.externalProxyRewritesResolve` and `experimental.externalMiddlewareRewritesResolve` cannot be set at the same time. Please use `experimental.externalProxyRewritesResolve` instead.\",\n+  \"878\": \"Config options `skipProxyUrlNormalize` and `skipMiddlewareUrlNormalize` cannot be set at the same time. Please use `skipProxyUrlNormalize` instead.\",\n+  \"879\": \"Config options `experimental.proxyClientMaxBodySize` and `experimental.middlewareClientMaxBodySize` cannot be set at the same time. Please use `experimental.proxyClientMaxBodySize` instead.\",\n+  \"880\": \"Config options `experimental.proxyPrefetch` and `experimental.middlewarePrefetch` cannot be set at the same time. Please use `experimental.proxyPrefetch` instead.\"\n }"
        },
        {
            "sha": "e3e3a38e57965e0cbcf9844c76d0a77888a6cac3",
            "filename": "packages/next/server.d.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fserver.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fserver.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fserver.d.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -7,7 +7,12 @@ declare global {\n export { NextFetchEvent } from 'next/dist/server/web/spec-extension/fetch-event'\n export { NextRequest } from 'next/dist/server/web/spec-extension/request'\n export { NextResponse } from 'next/dist/server/web/spec-extension/response'\n-export { NextMiddleware, MiddlewareConfig } from 'next/dist/server/web/types'\n+export {\n+  NextMiddleware,\n+  MiddlewareConfig,\n+  NextProxy,\n+  ProxyConfig,\n+} from 'next/dist/server/web/types'\n export { userAgentFromString } from 'next/dist/server/web/spec-extension/user-agent'\n export { userAgent } from 'next/dist/server/web/spec-extension/user-agent'\n export { URLPattern } from 'next/dist/compiled/@edge-runtime/primitives/url'"
        },
        {
            "sha": "70fb40ba5d5d1094cbce5be7fe59a11aa0895ca7",
            "filename": "packages/next/src/build/analysis/get-page-static-info.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fanalysis%2Fget-page-static-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fanalysis%2Fget-page-static-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fanalysis%2Fget-page-static-info.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -47,7 +47,7 @@ export type MiddlewareMatcher = {\n   originalSource: string\n }\n \n-export type MiddlewareConfig = {\n+export type ProxyConfig = {\n   /**\n    * The matcher for the middleware. Read more: [Next.js Docs: Middleware `matcher`](https://nextjs.org/docs/app/api-reference/file-conventions/middleware#matcher),\n    * [Next.js Docs: Middleware matching paths](https://nextjs.org/docs/app/building-your-application/routing/middleware#matching-paths)\n@@ -74,7 +74,7 @@ export interface AppPageStaticInfo {\n   generateStaticParams?: boolean\n   generateSitemaps?: boolean\n   generateImageMetadata?: boolean\n-  middleware?: MiddlewareConfig\n+  middleware?: ProxyConfig\n   config: Omit<AppSegmentConfig, 'runtime' | 'maxDuration'> | undefined\n   runtime: AppSegmentConfig['runtime'] | undefined\n   preferredRegion: AppSegmentConfig['preferredRegion'] | undefined\n@@ -90,7 +90,7 @@ export interface PagesPageStaticInfo {\n   generateStaticParams?: boolean\n   generateSitemaps?: boolean\n   generateImageMetadata?: boolean\n-  middleware?: MiddlewareConfig\n+  middleware?: ProxyConfig\n   config:\n     | (Omit<PagesSegmentConfig, 'runtime' | 'config' | 'maxDuration'> & {\n         config?: Omit<PagesSegmentConfigConfig, 'runtime' | 'maxDuration'>\n@@ -372,7 +372,7 @@ function parseMiddlewareConfig(\n   page: string,\n   rawConfig: unknown,\n   nextConfig: NextConfig\n-): MiddlewareConfig {\n+): ProxyConfig {\n   // If there's no config to parse, then return nothing.\n   if (typeof rawConfig !== 'object' || !rawConfig) return {}\n \n@@ -386,7 +386,7 @@ function parseMiddlewareConfig(\n     process.exit(1)\n   }\n \n-  const config: MiddlewareConfig = {}\n+  const config: ProxyConfig = {}\n \n   if (input.data.matcher) {\n     config.matchers = getMiddlewareMatchers(input.data.matcher, nextConfig)"
        },
        {
            "sha": "ae01a19e11d40b5bac6b1e6c58d8605441c1e0cf",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -214,7 +214,7 @@ export function getDefineEnv({\n     'process.env.__NEXT_OPTIMISTIC_CLIENT_CACHE':\n       config.experimental.optimisticClientCache ?? true,\n     'process.env.__NEXT_MIDDLEWARE_PREFETCH':\n-      config.experimental.middlewarePrefetch ?? 'flexible',\n+      config.experimental.proxyPrefetch ?? 'flexible',\n     'process.env.__NEXT_CROSS_ORIGIN': config.crossOrigin,\n     'process.browser': isClient,\n     'process.env.__NEXT_TEST_MODE': process.env.__NEXT_TEST_MODE ?? false,\n@@ -263,9 +263,9 @@ export function getDefineEnv({\n     'process.env.__NEXT_I18N_DOMAINS': config.i18n?.domains ?? false,\n     'process.env.__NEXT_I18N_CONFIG': config.i18n || '',\n     'process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE':\n-      config.skipMiddlewareUrlNormalize,\n+      config.skipProxyUrlNormalize,\n     'process.env.__NEXT_EXTERNAL_MIDDLEWARE_REWRITE_RESOLVE':\n-      config.experimental.externalMiddlewareRewritesResolve ?? false,\n+      config.experimental.externalProxyRewritesResolve ?? false,\n     'process.env.__NEXT_MANUAL_TRAILING_SLASH':\n       config.skipTrailingSlashRedirect,\n     'process.env.__NEXT_HAS_WEB_VITALS_ATTRIBUTION':"
        },
        {
            "sha": "cd421c66543f750f1b9485a42b8dec3440637351",
            "filename": "packages/next/src/build/entries.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -5,7 +5,7 @@ import type { EdgeAppRouteLoaderQuery } from './webpack/loaders/next-edge-app-ro\n import type { NextConfigComplete } from '../server/config-shared'\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n import type {\n-  MiddlewareConfig,\n+  ProxyConfig,\n   MiddlewareMatcher,\n   PageStaticInfo,\n } from './analysis/get-page-static-info'\n@@ -595,12 +595,12 @@ export function getEdgeServerEntry(opts: {\n   isServerComponent: boolean\n   page: string\n   pages: MappedPages\n-  middleware?: Partial<MiddlewareConfig>\n+  middleware?: Partial<ProxyConfig>\n   pagesType: PAGE_TYPES\n   appDirLoader?: string\n   hasInstrumentationHook?: boolean\n   preferredRegion: string | string[] | undefined\n-  middlewareConfig?: MiddlewareConfig\n+  middlewareConfig?: ProxyConfig\n }) {\n   if (\n     opts.pagesType === 'app' &&"
        },
        {
            "sha": "0d6863c90b98ae46a5a96b602c0c259c50f486d3",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -485,7 +485,7 @@ export type RoutesManifest = {\n     pathHeader: typeof NEXT_REWRITTEN_PATH_HEADER\n     queryHeader: typeof NEXT_REWRITTEN_QUERY_HEADER\n   }\n-  skipMiddlewareUrlNormalize?: boolean\n+  skipProxyUrlNormalize?: boolean\n   caseSensitive?: boolean\n   /**\n    * Configuration related to Partial Prerendering.\n@@ -1605,7 +1605,7 @@ export default async function build(\n               pathHeader: NEXT_REWRITTEN_PATH_HEADER,\n               queryHeader: NEXT_REWRITTEN_QUERY_HEADER,\n             },\n-            skipMiddlewareUrlNormalize: config.skipMiddlewareUrlNormalize,\n+            skipProxyUrlNormalize: config.skipProxyUrlNormalize,\n             ppr: isAppPPREnabled\n               ? {\n                   chain: {"
        },
        {
            "sha": "0fb9c15e92116f5069eb77c48c89b002ce78a578",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -952,7 +952,7 @@ export default async function getBaseWebpackConfig(\n           ['swcImportSource', !!jsConfig?.compilerOptions?.jsxImportSource],\n           ['swcEmotion', !!config.compiler?.emotion],\n           ['transpilePackages', !!config.transpilePackages],\n-          ['skipMiddlewareUrlNormalize', !!config.skipMiddlewareUrlNormalize],\n+          ['skipProxyUrlNormalize', !!config.skipProxyUrlNormalize],\n           ['skipTrailingSlashRedirect', !!config.skipTrailingSlashRedirect],\n           ['modularizeImports', !!config.modularizeImports],\n           // If esmExternals is not same as default value, it represents customized usage"
        },
        {
            "sha": "6158bf85a237fffa4410c678c2b8686ddd317e63",
            "filename": "packages/next/src/build/webpack/loaders/get-module-build-info.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fget-module-build-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fget-module-build-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fget-module-build-info.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,5 +1,5 @@\n import type {\n-  MiddlewareConfig,\n+  ProxyConfig,\n   MiddlewareMatcher,\n   RSCModuleType,\n } from '../../analysis/get-page-static-info'\n@@ -39,7 +39,7 @@ export interface RouteMeta {\n   page: string\n   absolutePagePath: string\n   preferredRegion: string | string[] | undefined\n-  middlewareConfig: MiddlewareConfig\n+  middlewareConfig: ProxyConfig\n   // references to other modules that this route needs\n   // e.g. related routes, not-found routes, etc\n   relatedModules?: string[]"
        },
        {
            "sha": "e944df9c36e28c5d6d8a85a60413a2370fd88123",
            "filename": "packages/next/src/build/webpack/loaders/next-app-loader/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -24,7 +24,7 @@ import { promises as fs } from 'fs'\n import { isAppRouteRoute } from '../../../../lib/is-app-route-route'\n import type { NextConfig } from '../../../../server/config-shared'\n import { AppPathnameNormalizer } from '../../../../server/normalizers/built/app/app-pathname-normalizer'\n-import type { MiddlewareConfig } from '../../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../../analysis/get-page-static-info'\n import { isAppBuiltinPage } from '../../../utils'\n import { loadEntrypoint } from '../../../load-entrypoint'\n import {\n@@ -644,7 +644,7 @@ const nextAppLoader: AppLoader = async function nextAppLoader() {\n   const buildInfo = getModuleBuildInfo((this as any)._module)\n   const collectedDeclarations: [string, string][] = []\n   const page = name.replace(/^app/, '')\n-  const middlewareConfig: MiddlewareConfig = JSON.parse(\n+  const middlewareConfig: ProxyConfig = JSON.parse(\n     Buffer.from(middlewareConfigBase64, 'base64').toString()\n   )\n   buildInfo.route = {"
        },
        {
            "sha": "aac70f5c8519b4ee60a44041fab32ea47ea31e91",
            "filename": "packages/next/src/build/webpack/loaders/next-edge-app-route-loader/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-app-route-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-app-route-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-app-route-loader%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -2,7 +2,7 @@ import { getModuleBuildInfo } from '../get-module-build-info'\n import { stringifyRequest } from '../../stringify-request'\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n import { WEBPACK_RESOURCE_QUERIES } from '../../../../lib/constants'\n-import type { MiddlewareConfig } from '../../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../../analysis/get-page-static-info'\n import { loadEntrypoint } from '../../../load-entrypoint'\n import { isMetadataRoute } from '../../../../lib/metadata/is-metadata-route'\n \n@@ -29,7 +29,7 @@ const EdgeAppRouteLoader: webpack.LoaderDefinitionFunction<EdgeAppRouteLoaderQue\n     } = this.getOptions()\n \n     const appDirLoader = Buffer.from(appDirLoaderBase64, 'base64').toString()\n-    const middlewareConfig: MiddlewareConfig = JSON.parse(\n+    const middlewareConfig: ProxyConfig = JSON.parse(\n       Buffer.from(middlewareConfigBase64, 'base64').toString()\n     )\n "
        },
        {
            "sha": "155a1c73e37e996026337718a1194311e5d395c1",
            "filename": "packages/next/src/build/webpack/loaders/next-edge-function-loader.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-function-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-function-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-function-loader.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,7 +1,7 @@\n import type webpack from 'webpack'\n import { getModuleBuildInfo } from './get-module-build-info'\n import { stringifyRequest } from '../stringify-request'\n-import type { MiddlewareConfig } from '../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../analysis/get-page-static-info'\n \n export type EdgeFunctionLoaderOptions = {\n   absolutePagePath: string\n@@ -22,7 +22,7 @@ const nextEdgeFunctionLoader: webpack.LoaderDefinitionFunction<EdgeFunctionLoade\n     }: EdgeFunctionLoaderOptions = this.getOptions()\n     const stringifiedPagePath = stringifyRequest(this, absolutePagePath)\n     const buildInfo = getModuleBuildInfo(this._module as any)\n-    const middlewareConfig: MiddlewareConfig = JSON.parse(\n+    const middlewareConfig: ProxyConfig = JSON.parse(\n       Buffer.from(middlewareConfigBase64, 'base64').toString()\n     )\n     buildInfo.route = {"
        },
        {
            "sha": "91f55ea9026e285f45a05be105cc24b59170aeff",
            "filename": "packages/next/src/build/webpack/loaders/next-edge-ssr-loader/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-edge-ssr-loader%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,7 +1,7 @@\n import type webpack from 'webpack'\n import type { SizeLimit } from '../../../../types'\n import type { PagesRouteModuleOptions } from '../../../../server/route-modules/pages/module'\n-import type { MiddlewareConfig } from '../../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../../analysis/get-page-static-info'\n \n import { getModuleBuildInfo } from '../get-module-build-info'\n import { WEBPACK_RESOURCE_QUERIES } from '../../../../lib/constants'\n@@ -90,7 +90,7 @@ const edgeSSRLoader: webpack.LoaderDefinitionFunction<EdgeSSRLoaderQuery> =\n       )\n     }\n \n-    const middlewareConfig: MiddlewareConfig = JSON.parse(\n+    const middlewareConfig: ProxyConfig = JSON.parse(\n       Buffer.from(middlewareConfigBase64, 'base64').toString()\n     )\n "
        },
        {
            "sha": "34b3f4b98b3a76868def3c23c3cfe7e03760204b",
            "filename": "packages/next/src/build/webpack/loaders/next-middleware-loader.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-middleware-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-middleware-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-middleware-loader.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,5 +1,5 @@\n import type {\n-  MiddlewareConfig,\n+  ProxyConfig,\n   MiddlewareMatcher,\n } from '../../analysis/get-page-static-info'\n import { getModuleBuildInfo } from './get-module-build-info'\n@@ -45,7 +45,7 @@ export default async function middlewareLoader(this: any) {\n     absolutePagePath\n   )\n \n-  const middlewareConfig: MiddlewareConfig = JSON.parse(\n+  const middlewareConfig: ProxyConfig = JSON.parse(\n     Buffer.from(middlewareConfigBase64, 'base64').toString()\n   )\n   const buildInfo = getModuleBuildInfo(this._module)"
        },
        {
            "sha": "d3bc1f95248fb2c1cad5cf33359d12fd8e20680a",
            "filename": "packages/next/src/build/webpack/loaders/next-route-loader/index.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-route-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-route-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-route-loader%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,5 +1,5 @@\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n-import type { MiddlewareConfig } from '../../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../../analysis/get-page-static-info'\n \n import { stringify } from 'querystring'\n import {\n@@ -18,7 +18,7 @@ type RouteLoaderOptionsPagesAPIInput = {\n   page: string\n   preferredRegion: string | string[] | undefined\n   absolutePagePath: string\n-  middlewareConfig: MiddlewareConfig\n+  middlewareConfig: ProxyConfig\n }\n \n type RouteLoaderOptionsPagesInput = {\n@@ -27,7 +27,7 @@ type RouteLoaderOptionsPagesInput = {\n   pages: MappedPages\n   preferredRegion: string | string[] | undefined\n   absolutePagePath: string\n-  middlewareConfig: MiddlewareConfig\n+  middlewareConfig: ProxyConfig\n }\n \n type RouteLoaderOptionsInput =\n@@ -148,9 +148,7 @@ const loadPages = async (\n   }: RouteLoaderPagesOptions,\n   buildInfo: ModuleBuildInfo\n ) => {\n-  const middlewareConfig: MiddlewareConfig = decodeFromBase64(\n-    middlewareConfigBase64\n-  )\n+  const middlewareConfig: ProxyConfig = decodeFromBase64(middlewareConfigBase64)\n \n   // Attach build info to the module.\n   buildInfo.route = {\n@@ -187,9 +185,7 @@ const loadPagesAPI = async (\n   }: RouteLoaderPagesAPIOptions,\n   buildInfo: ModuleBuildInfo\n ) => {\n-  const middlewareConfig: MiddlewareConfig = decodeFromBase64(\n-    middlewareConfigBase64\n-  )\n+  const middlewareConfig: ProxyConfig = decodeFromBase64(middlewareConfigBase64)\n \n   // Attach build info to the module.\n   buildInfo.route = {"
        },
        {
            "sha": "e47faa9eaa6a2bf4d665eb5909081b2759e7c316",
            "filename": "packages/next/src/build/webpack/plugins/middleware-plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -23,7 +23,7 @@ import {\n   INTERCEPTION_ROUTE_REWRITE_MANIFEST,\n   DYNAMIC_CSS_MANIFEST,\n } from '../../../shared/lib/constants'\n-import type { MiddlewareConfig } from '../../analysis/get-page-static-info'\n+import type { ProxyConfig } from '../../analysis/get-page-static-info'\n import type { Telemetry } from '../../../telemetry/storage'\n import { traceGlobals } from '../../../trace/shared'\n import { EVENT_BUILD_FEATURE_USAGE } from '../../../telemetry/events'\n@@ -294,7 +294,7 @@ function isBunModule(moduleName: string) {\n \n function isDynamicCodeEvaluationAllowed(\n   fileName: string,\n-  middlewareConfig?: MiddlewareConfig,\n+  middlewareConfig?: ProxyConfig,\n   rootDir?: string\n ) {\n   // Some packages are known to use `eval` but are safe to use in the Edge"
        },
        {
            "sha": "f423f65213915fca4dededabf04962350a7e5049",
            "filename": "packages/next/src/build/webpack/plugins/next-types-plugin/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fnext-types-plugin%2Findex.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -415,7 +415,7 @@ function createServerDefinitions() {\n     export { NextFetchEvent } from 'next/dist/server/web/spec-extension/fetch-event'\n     export { NextRequest } from 'next/dist/server/web/spec-extension/request'\n     export { NextResponse } from 'next/dist/server/web/spec-extension/response'\n-    export { NextMiddleware, MiddlewareConfig } from 'next/dist/server/web/types'\n+    export { NextMiddleware, MiddlewareConfig, NextProxy, ProxyConfig } from 'next/dist/server/web/types'\n     export { userAgentFromString } from 'next/dist/server/web/spec-extension/user-agent'\n     export { userAgent } from 'next/dist/server/web/spec-extension/user-agent'\n     export { URLPattern } from 'next/dist/compiled/@edge-runtime/primitives/url'"
        },
        {
            "sha": "95584eb29e0aa19e6e1ce1c77e69970fe6441de3",
            "filename": "packages/next/src/build/webpack/plugins/telemetry-plugin/telemetry-plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -43,7 +43,7 @@ export type Feature =\n   | `swc/target/${SWC_TARGET_TRIPLE}`\n   | 'turbotrace'\n   | 'transpilePackages'\n-  | 'skipMiddlewareUrlNormalize'\n+  | 'skipProxyUrlNormalize'\n   | 'skipTrailingSlashRedirect'\n   | 'modularizeImports'\n   | 'esmExternals'\n@@ -101,7 +101,7 @@ const BUILD_FEATURES: Array<Feature> = [\n   'swc/target/aarch64-pc-windows-msvc',\n   'turbotrace',\n   'transpilePackages',\n-  'skipMiddlewareUrlNormalize',\n+  'skipProxyUrlNormalize',\n   'skipTrailingSlashRedirect',\n   'modularizeImports',\n   'esmExternals',"
        },
        {
            "sha": "e952b8250e795627689be14541e024184e7d066b",
            "filename": "packages/next/src/server/body-streams.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fbody-streams.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fbody-streams.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbody-streams.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -94,6 +94,7 @@ export function getCloneableBody<T extends IncomingMessage>(\n           limitExceeded = true\n           const urlInfo = readable.url ? ` for ${readable.url}` : ''\n           console.warn(\n+            // TODO(jiwon): Update this document link\n             `Request body exceeded ${bytes.format(bodySizeLimit)}${urlInfo}. Only the first ${bytes.format(bodySizeLimit)} will be available unless configured. See https://nextjs.org/docs/app/api-reference/config/next-config-js/middlewareClientMaxBodySize for more details.`\n           )\n           p1.push(null)"
        },
        {
            "sha": "ac2658fc8479bdefcfabdfe5cbc7df0a204ba626",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -215,6 +215,7 @@ export const experimentalSchema = {\n   extensionAlias: z.record(z.string(), z.any()).optional(),\n   externalDir: z.boolean().optional(),\n   externalMiddlewareRewritesResolve: z.boolean().optional(),\n+  externalProxyRewritesResolve: z.boolean().optional(),\n   fallbackNodePolyfills: z.literal(false).optional(),\n   fetchCacheKeyPrefix: z.string().optional(),\n   forceSwcTransforms: z.boolean().optional(),\n@@ -230,7 +231,9 @@ export const experimentalSchema = {\n   linkNoTouchStart: z.boolean().optional(),\n   manualClientBasePath: z.boolean().optional(),\n   middlewarePrefetch: z.enum(['strict', 'flexible']).optional(),\n+  proxyPrefetch: z.enum(['strict', 'flexible']).optional(),\n   middlewareClientMaxBodySize: zSizeLimit.optional(),\n+  proxyClientMaxBodySize: zSizeLimit.optional(),\n   multiZoneDraftMode: z.boolean().optional(),\n   cssChunking: z.union([z.boolean(), z.literal('strict')]).optional(),\n   nextScriptWorkers: z.boolean().optional(),\n@@ -673,6 +676,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n       .optional(),\n     serverExternalPackages: z.array(z.string()).optional(),\n     skipMiddlewareUrlNormalize: z.boolean().optional(),\n+    skipProxyUrlNormalize: z.boolean().optional(),\n     skipTrailingSlashRedirect: z.boolean().optional(),\n     staticPageGenerationTimeout: z.number().optional(),\n     expireTime: z.number().optional(),"
        },
        {
            "sha": "c6c88a0a2047d9e646c39f638c8d29086be227f7",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -326,7 +326,11 @@ export interface ExperimentalConfig {\n   // e.g. 0.01 for 10% potential false matches lower\n   // percent increases size of the filter\n   clientRouterFilterAllowedRate?: number\n+  /**\n+   * @deprecated Use `externalProxyRewritesResolve` instead.\n+   */\n   externalMiddlewareRewritesResolve?: boolean\n+  externalProxyRewritesResolve?: boolean\n   extensionAlias?: Record<string, any>\n   allowedRevalidateHeaderKeys?: string[]\n   fetchCacheKeyPrefix?: string\n@@ -340,7 +344,11 @@ export interface ExperimentalConfig {\n    * @deprecated use config.expireTime instead\n    */\n   expireTime?: number\n+  /**\n+   * @deprecated Use `proxyPrefetch` instead.\n+   */\n   middlewarePrefetch?: 'strict' | 'flexible'\n+  proxyPrefetch?: 'strict' | 'flexible'\n   manualClientBasePath?: boolean\n   /**\n    * CSS Chunking strategy. Defaults to `true` (\"loose\" mode), which guesses dependencies\n@@ -793,9 +801,17 @@ export interface ExperimentalConfig {\n   /**\n    * Body size limit for request bodies with middleware configured.\n    * Defaults to 10MB. Can be specified as a number (bytes) or string (e.g. '5mb').\n+   *\n+   * @deprecated Use `proxyClientMaxBodySize` instead.\n    */\n   middlewareClientMaxBodySize?: SizeLimit\n \n+  /**\n+   * Body size limit for request bodies with proxy configured.\n+   * Defaults to 10MB. Can be specified as a number (bytes) or string (e.g. '5mb').\n+   */\n+  proxyClientMaxBodySize?: SizeLimit\n+\n   /**\n    * Enable the Model Context Protocol (MCP) server for AI-assisted development.\n    * When enabled, Next.js will expose an MCP server at `/_next/mcp` that provides\n@@ -1234,8 +1250,13 @@ export interface NextConfig {\n    */\n   turbopack?: TurbopackOptions\n \n+  /**\n+   * @deprecated Use `skipProxyUrlNormalize` instead.\n+   */\n   skipMiddlewareUrlNormalize?: boolean\n \n+  skipProxyUrlNormalize?: boolean\n+\n   skipTrailingSlashRedirect?: boolean\n \n   modularizeImports?: Record<\n@@ -1441,7 +1462,7 @@ export const defaultConfig = Object.freeze({\n     clientRouterFilter: true,\n     clientRouterFilterRedirects: false,\n     fetchCacheKeyPrefix: '',\n-    middlewarePrefetch: 'flexible',\n+    proxyPrefetch: 'flexible',\n     optimisticClientCache: true,\n     manualClientBasePath: false,\n     cpus: Math.max(\n@@ -1506,7 +1527,7 @@ export const defaultConfig = Object.freeze({\n     browserDebugInfoInTerminal: false,\n     lockDistDir: true,\n     isolatedDevBuild: true,\n-    middlewareClientMaxBodySize: 10_485_760, // 10MB\n+    proxyClientMaxBodySize: 10_485_760, // 10MB\n     hideLogsAfterAbort: false,\n   },\n   htmlLimitedBots: undefined,"
        },
        {
            "sha": "1679d7146ab6f6052fbc8d03f3b7a8c022e78330",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 96,
            "deletions": 9,
            "changes": 105,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -139,6 +139,31 @@ function checkDeprecations(\n     )\n   }\n \n+  warnOptionHasBeenDeprecated(\n+    userConfig,\n+    'experimental.middlewarePrefetch',\n+    `\\`experimental.middlewarePrefetch\\` is deprecated. Please use \\`experimental.proxyPrefetch\\` instead in ${configFileName}.`,\n+    silent\n+  )\n+  warnOptionHasBeenDeprecated(\n+    userConfig,\n+    'experimental.middlewareClientMaxBodySize',\n+    `\\`experimental.middlewareClientMaxBodySize\\` is deprecated. Please use \\`experimental.proxyClientMaxBodySize\\` instead in ${configFileName}.`,\n+    silent\n+  )\n+  warnOptionHasBeenDeprecated(\n+    userConfig,\n+    'experimental.externalMiddlewareRewritesResolve',\n+    `\\`experimental.externalMiddlewareRewritesResolve\\` is deprecated. Please use \\`experimental.externalProxyRewritesResolve\\` instead in ${configFileName}.`,\n+    silent\n+  )\n+  warnOptionHasBeenDeprecated(\n+    userConfig,\n+    'skipMiddlewareUrlNormalize',\n+    `\\`skipMiddlewareUrlNormalize\\` is deprecated. Please use \\`skipProxyUrlNormalize\\` instead in ${configFileName}.`,\n+    silent\n+  )\n+\n   warnOptionHasBeenDeprecated(\n     userConfig,\n     'experimental.instrumentationHook',\n@@ -728,18 +753,80 @@ function assignDefaultsAndValidate(\n     }\n   }\n \n-  // Normalize & validate experimental.middlewareClientMaxBodySize\n-  if (typeof result.experimental?.middlewareClientMaxBodySize !== 'undefined') {\n-    const middlewareClientMaxBodySize =\n-      result.experimental.middlewareClientMaxBodySize\n+  // Throw if both Middleware and Proxy config are set.\n+  if (\n+    userConfig.experimental?.proxyClientMaxBodySize !== undefined &&\n+    userConfig.experimental?.middlewareClientMaxBodySize !== undefined\n+  ) {\n+    throw new Error(\n+      'Config options `experimental.proxyClientMaxBodySize` and `experimental.middlewareClientMaxBodySize` cannot be set at the same time. Please use `experimental.proxyClientMaxBodySize` instead.'\n+    )\n+  }\n+  if (\n+    userConfig.experimental?.proxyPrefetch !== undefined &&\n+    userConfig.experimental?.middlewarePrefetch !== undefined\n+  ) {\n+    throw new Error(\n+      'Config options `experimental.proxyPrefetch` and `experimental.middlewarePrefetch` cannot be set at the same time. Please use `experimental.proxyPrefetch` instead.'\n+    )\n+  }\n+  if (\n+    userConfig.experimental?.externalProxyRewritesResolve !== undefined &&\n+    userConfig.experimental?.externalMiddlewareRewritesResolve !== undefined\n+  ) {\n+    throw new Error(\n+      'Config options `experimental.externalProxyRewritesResolve` and `experimental.externalMiddlewareRewritesResolve` cannot be set at the same time. Please use `experimental.externalProxyRewritesResolve` instead.'\n+    )\n+  }\n+  if (\n+    userConfig.skipProxyUrlNormalize !== undefined &&\n+    userConfig.skipMiddlewareUrlNormalize !== undefined\n+  ) {\n+    throw new Error(\n+      'Config options `skipProxyUrlNormalize` and `skipMiddlewareUrlNormalize` cannot be set at the same time. Please use `skipProxyUrlNormalize` instead.'\n+    )\n+  }\n+\n+  // Map Proxy config to Middleware config as it is currently an alias.\n+  if (\n+    userConfig.experimental?.proxyClientMaxBodySize === undefined &&\n+    userConfig.experimental?.middlewareClientMaxBodySize !== undefined\n+  ) {\n+    result.experimental.proxyClientMaxBodySize =\n+      userConfig.experimental.middlewareClientMaxBodySize\n+  }\n+  if (\n+    userConfig.experimental?.proxyPrefetch === undefined &&\n+    userConfig.experimental?.middlewarePrefetch !== undefined\n+  ) {\n+    result.experimental.proxyPrefetch =\n+      userConfig.experimental.middlewarePrefetch\n+  }\n+  if (\n+    userConfig.experimental?.externalProxyRewritesResolve === undefined &&\n+    userConfig.experimental?.externalMiddlewareRewritesResolve !== undefined\n+  ) {\n+    result.experimental.externalProxyRewritesResolve =\n+      userConfig.experimental.externalMiddlewareRewritesResolve\n+  }\n+  if (\n+    userConfig.skipProxyUrlNormalize === undefined &&\n+    userConfig.skipMiddlewareUrlNormalize !== undefined\n+  ) {\n+    result.skipProxyUrlNormalize = userConfig.skipMiddlewareUrlNormalize\n+  }\n+\n+  // Normalize & validate experimental.proxyClientMaxBodySize\n+  if (typeof result.experimental?.proxyClientMaxBodySize !== 'undefined') {\n+    const proxyClientMaxBodySize = result.experimental.proxyClientMaxBodySize\n     let normalizedValue: number\n \n-    if (typeof middlewareClientMaxBodySize === 'string') {\n+    if (typeof proxyClientMaxBodySize === 'string') {\n       const bytes =\n         require('next/dist/compiled/bytes') as typeof import('next/dist/compiled/bytes')\n-      normalizedValue = bytes.parse(middlewareClientMaxBodySize)\n-    } else if (typeof middlewareClientMaxBodySize === 'number') {\n-      normalizedValue = middlewareClientMaxBodySize\n+      normalizedValue = bytes.parse(proxyClientMaxBodySize)\n+    } else if (typeof proxyClientMaxBodySize === 'number') {\n+      normalizedValue = proxyClientMaxBodySize\n     } else {\n       throw new Error(\n         'Client Max Body Size must be a valid number (bytes) or filesize format string (e.g., \"5mb\")'\n@@ -751,7 +838,7 @@ function assignDefaultsAndValidate(\n     }\n \n     // Store the normalized value as a number\n-    result.experimental.middlewareClientMaxBodySize = normalizedValue\n+    result.experimental.proxyClientMaxBodySize = normalizedValue\n   }\n \n   warnOptionHasBeenMovedOutOfExperimental("
        },
        {
            "sha": "202ba620a91bdcd3247e83dc11118d3f1764beb9",
            "filename": "packages/next/src/server/lib/router-utils/resolve-routes.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -171,7 +171,7 @@ export function getResolveRoutes(\n     addRequestMeta(req, 'initProtocol', protocol)\n \n     if (!isUpgradeReq) {\n-      const bodySizeLimit = config.experimental.middlewareClientMaxBodySize as\n+      const bodySizeLimit = config.experimental.proxyClientMaxBodySize as\n         | number\n         | undefined\n       addRequestMeta(req, 'clonableBody', getCloneableBody(req, bodySizeLimit))\n@@ -180,7 +180,7 @@ export function getResolveRoutes(\n     const maybeAddTrailingSlash = (pathname: string) => {\n       if (\n         config.trailingSlash &&\n-        !config.skipMiddlewareUrlNormalize &&\n+        !config.skipProxyUrlNormalize &&\n         !pathname.endsWith('/')\n       ) {\n         return `${pathname}/`"
        },
        {
            "sha": "dea724268b3f47bf00401be7d9e10d5eedf7d43e",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -113,7 +113,7 @@ export interface DevRoutesManifest {\n   redirects: RoutesManifest['redirects']\n   headers: RoutesManifest['headers']\n   i18n: RoutesManifest['i18n']\n-  skipMiddlewareUrlNormalize: RoutesManifest['skipMiddlewareUrlNormalize']\n+  skipProxyUrlNormalize: RoutesManifest['skipProxyUrlNormalize']\n }\n \n export type ServerFields = {\n@@ -254,7 +254,7 @@ async function startWatcher(\n     redirects: opts.fsChecker.redirects,\n     headers: opts.fsChecker.headers,\n     i18n: nextConfig.i18n || undefined,\n-    skipMiddlewareUrlNormalize: nextConfig.skipMiddlewareUrlNormalize,\n+    skipProxyUrlNormalize: nextConfig.skipProxyUrlNormalize,\n   }\n   await fs.promises.writeFile(\n     routesManifestPath,"
        },
        {
            "sha": "8cfaa4aa3b0dfc6d81ec9e546cfbe19b7514e2c6",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1652,7 +1652,7 @@ export default class NextNodeServer extends BaseServer<\n \n     let url: string\n \n-    if (this.nextConfig.skipMiddlewareUrlNormalize) {\n+    if (this.nextConfig.skipProxyUrlNormalize) {\n       url = getRequestMeta(params.request, 'initURL')!\n     } else {\n       // For middleware to \"fetch\" we must always provide an absolute URL\n@@ -1957,7 +1957,7 @@ export default class NextNodeServer extends BaseServer<\n \n     if (!isUpgradeReq) {\n       const bodySizeLimit = this.nextConfig.experimental\n-        ?.middlewareClientMaxBodySize as number | undefined\n+        ?.proxyClientMaxBodySize as number | undefined\n       addRequestMeta(\n         req,\n         'clonableBody',"
        },
        {
            "sha": "b9684d0f13650f67027008602128a3bb0b578eac",
            "filename": "packages/next/src/server/route-modules/route-module.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Froute-module.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -219,7 +219,7 @@ export abstract class RouteModule<\n           headers: [],\n           i18n:\n             (process.env.__NEXT_I18N_CONFIG as any as I18NConfig) || undefined,\n-          skipMiddlewareUrlNormalize: Boolean(\n+          skipProxyUrlNormalize: Boolean(\n             process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE\n           ),\n         },"
        },
        {
            "sha": "666946c537773a79839aedc16d95151aa4e28e70",
            "filename": "packages/next/src/server/web/types.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Ftypes.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -6,8 +6,13 @@ import type { CloneableBody } from '../body-streams'\n import type { OutgoingHttpHeaders } from 'http'\n import type { FetchMetrics } from '../base-http'\n \n+/**\n+ * @deprecated Use `ProxyConfig` instead. Middleware has been renamed to Proxy.\n+ */\n export type { MiddlewareConfigInput as MiddlewareConfig } from '../../build/segment-config/middleware/middleware-config'\n \n+export type { MiddlewareConfigInput as ProxyConfig } from '../../build/segment-config/middleware/middleware-config'\n+\n export interface RequestData {\n   headers: OutgoingHttpHeaders\n   method: string\n@@ -54,9 +59,20 @@ export type NextMiddlewareResult =\n  * by rewriting, redirecting, modifying the request or response headers,\n  * or responding directly.\n  *\n+ * @deprecated Use `NextProxy` instead. Middleware has been renamed to Proxy.\n  * Read more: [Next.js Docs: Middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware)\n  */\n export type NextMiddleware = (\n   request: NextRequest,\n   event: NextFetchEvent\n ) => NextMiddlewareResult | Promise<NextMiddlewareResult>\n+\n+/**\n+ * Proxy allows you to run code before a request is completed.\n+ * Then, based on the incoming request, you can modify the response\n+ * by rewriting, redirecting, modifying the request or response headers,\n+ * or responding directly.\n+ *\n+ * Read more: [Next.js Docs: Proxy](https://nextjs.org/docs/app/building-your-application/routing/middleware)\n+ */\n+export type NextProxy = NextMiddleware"
        },
        {
            "sha": "9f641562d672a0a9e13d1196143b6eb01861d66f",
            "filename": "packages/next/src/telemetry/events/build.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -188,7 +188,7 @@ export type EventBuildFeatureUsage = {\n     | 'turbotrace'\n     | 'vercelImageGeneration'\n     | 'transpilePackages'\n-    | 'skipMiddlewareUrlNormalize'\n+    | 'skipProxyUrlNormalize'\n     | 'skipTrailingSlashRedirect'\n     | 'modularizeImports'\n     | 'esmExternals'"
        },
        {
            "sha": "05988b1f69ffdda4f1e4d90066d861c6b6138c99",
            "filename": "test/development/basic/__snapshots__/next-rs-api.test.ts.snap",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fdevelopment%2Fbasic%2F__snapshots__%2Fnext-rs-api.test.ts.snap",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fdevelopment%2Fbasic%2F__snapshots__%2Fnext-rs-api.test.ts.snap",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2F__snapshots__%2Fnext-rs-api.test.ts.snap?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -83,7 +83,7 @@ exports[`next.rs api should detect the correct routes: diagnostics 1`] = `\n     \"category\": \"NextFeatureTelemetry_category_tbd\",\n     \"name\": \"EVENT_BUILD_FEATURE_USAGE\",\n     \"payload\": {\n-      \"skipMiddlewareUrlNormalize\": \"false\",\n+      \"skipProxyUrlNormalize\": \"false\",\n     },\n   },\n   {"
        },
        {
            "sha": "3d414e63237f558deb094e42edfb6c5222530f00",
            "filename": "test/e2e/app-dir/actions/middleware-node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fapp-dir%2Factions%2Fmiddleware-node.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fapp-dir%2Factions%2Fmiddleware-node.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fmiddleware-node.js?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -11,7 +11,7 @@ export async function middleware(req) {\n }\n \n /**\n- * @type {import('next/server').MiddlewareConfig}\n+ * @type {import('next/server').ProxyConfig}\n  */\n export const config = {\n   runtime: 'nodejs',"
        },
        {
            "sha": "b678b413fc5403c4a01c237dad48d888d0b116f3",
            "filename": "test/e2e/app-dir/cache-components-dynamic-imports/bundled/middleware.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fbundled%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fbundled%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fbundled%2Fmiddleware.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,4 +1,4 @@\n-import type { MiddlewareConfig } from 'next/server'\n+import type { ProxyConfig } from 'next/server'\n \n export default async function middleware() {\n   // This import should not be instrumented.\n@@ -7,6 +7,6 @@ export default async function middleware() {\n   await import('./messages')\n }\n \n-export const config: MiddlewareConfig = {\n+export const config: ProxyConfig = {\n   matcher: ['/not-instrumented/middleware'],\n }"
        },
        {
            "sha": "9ccb875aa8cdbac87dae9ac7d3fb9d64b83f642c",
            "filename": "test/e2e/client-max-body-size/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fclient-max-body-size%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fclient-max-body-size%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fclient-max-body-size%2Findex.test.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -83,7 +83,7 @@ describe('client-max-body-size', () => {\n       skipDeployment: true,\n       nextConfig: {\n         experimental: {\n-          middlewareClientMaxBodySize: '5mb',\n+          proxyClientMaxBodySize: '5mb',\n         },\n       },\n     })\n@@ -142,7 +142,7 @@ describe('client-max-body-size', () => {\n       skipDeployment: true,\n       nextConfig: {\n         experimental: {\n-          middlewareClientMaxBodySize: 2 * 1024 * 1024, // 2MB in bytes\n+          proxyClientMaxBodySize: 2 * 1024 * 1024, // 2MB in bytes\n         },\n       },\n     })\n@@ -201,7 +201,7 @@ describe('client-max-body-size', () => {\n       skipDeployment: true,\n       nextConfig: {\n         experimental: {\n-          middlewareClientMaxBodySize: '50mb',\n+          proxyClientMaxBodySize: '50mb',\n         },\n       },\n     })"
        },
        {
            "sha": "01faea01c330c87126593f1bf10b972b6a412326",
            "filename": "test/e2e/deprecation-warnings/deprecation-warnings.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fdeprecation-warnings%2Fdeprecation-warnings.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fdeprecation-warnings%2Fdeprecation-warnings.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdeprecation-warnings%2Fdeprecation-warnings.test.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -32,6 +32,23 @@ describe('deprecation-warnings', () => {\n       // Should warn about experimental.instrumentationHook\n       expect(logs).toContain('experimental.instrumentationHook')\n       expect(logs).toContain('no longer needed')\n+\n+      // Should warn about middleware config options\n+      expect(logs).toContain('experimental.middlewarePrefetch')\n+      expect(logs).toContain('Please use `experimental.proxyPrefetch` instead')\n+\n+      expect(logs).toContain('experimental.middlewareClientMaxBodySize')\n+      expect(logs).toContain(\n+        'Please use `experimental.proxyClientMaxBodySize` instead'\n+      )\n+\n+      expect(logs).toContain('experimental.externalMiddlewareRewritesResolve')\n+      expect(logs).toContain(\n+        'Please use `experimental.externalProxyRewritesResolve` instead'\n+      )\n+\n+      expect(logs).toContain('skipMiddlewareUrlNormalize')\n+      expect(logs).toContain('Please use `skipProxyUrlNormalize` instead')\n     })\n   })\n })"
        },
        {
            "sha": "299617a1a6f12573dfd0ad943fc1fd4743e71edb",
            "filename": "test/e2e/deprecation-warnings/fixtures/with-deprecated-config/next.config.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fdeprecation-warnings%2Ffixtures%2Fwith-deprecated-config%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fdeprecation-warnings%2Ffixtures%2Fwith-deprecated-config%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fdeprecation-warnings%2Ffixtures%2Fwith-deprecated-config%2Fnext.config.js?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,7 +1,11 @@\n /** @type {import('next').NextConfig} */\n module.exports = {\n   // Explicitly configure deprecated options\n+  skipMiddlewareUrlNormalize: true,\n   experimental: {\n+    middlewarePrefetch: 'strict',\n     instrumentationHook: true,\n+    middlewareClientMaxBodySize: '5mb',\n+    externalMiddlewareRewritesResolve: true,\n   },\n }"
        },
        {
            "sha": "cf3e6decf7c83b485359b7b542fed0c775a7f66b",
            "filename": "test/e2e/skip-trailing-slash-redirect/app/next.config.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,9 +1,9 @@\n /** @type {import('next').NextConfig} */\n const nextConfig = {\n-  skipMiddlewareUrlNormalize: true,\n+  skipProxyUrlNormalize: true,\n   skipTrailingSlashRedirect: true,\n   experimental: {\n-    externalMiddlewareRewritesResolve: true,\n+    externalProxyRewritesResolve: true,\n   },\n   i18n: {\n     locales: ['en', 'ja-jp'],"
        },
        {
            "sha": "8534b10d983ce5604ed521197134e3cbd55f7e87",
            "filename": "test/e2e/skip-trailing-slash-redirect/index.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fskip-trailing-slash-redirect%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fe2e%2Fskip-trailing-slash-redirect%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fskip-trailing-slash-redirect%2Findex.test.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -228,7 +228,7 @@ describe('skip-trailing-slash-redirect', () => {\n     }\n   })\n \n-  it('should provide original _next/data URL with skipMiddlewareUrlNormalize', async () => {\n+  it('should provide original _next/data URL with skipProxyUrlNormalize', async () => {\n     const res = await fetchViaHTTP(\n       next.url,\n       `/_next/data/${next.buildId}/valid.json`,"
        },
        {
            "sha": "7d52fff7f7d78cf399f98d2d003aae6af18060d9",
            "filename": "test/integration/telemetry/next.config.middleware-options",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fintegration%2Ftelemetry%2Fnext.config.middleware-options",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fintegration%2Ftelemetry%2Fnext.config.middleware-options",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ftelemetry%2Fnext.config.middleware-options?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,4 +1,4 @@\n module.exports = {\n-  skipMiddlewareUrlNormalize: true,\n+  skipProxyUrlNormalize: true,\n   skipTrailingSlashRedirect: true,\n }\n\\ No newline at end of file"
        },
        {
            "sha": "7ee2f55aed88b37be0db7a4d0ba75fa09d3a9afd",
            "filename": "test/integration/telemetry/test/config.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fintegration%2Ftelemetry%2Ftest%2Fconfig.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fintegration%2Ftelemetry%2Ftest%2Fconfig.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ftelemetry%2Ftest%2Fconfig.test.js?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -513,7 +513,7 @@ describe('config telemetry', () => {\n           )\n           // eslint-disable-next-line jest/no-standalone-expect\n           expect(featureUsageEvents).toContainEqual({\n-            featureName: 'skipMiddlewareUrlNormalize',\n+            featureName: 'skipProxyUrlNormalize',\n             invocationCount: 1,\n           })\n           // eslint-disable-next-line jest/no-standalone-expect"
        },
        {
            "sha": "9b7adb9ddea935a7be96824878d1e23fd3f731ee",
            "filename": "test/production/middleware-typescript/app/middleware.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fmiddleware-typescript%2Fapp%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fmiddleware-typescript%2Fapp%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fmiddleware-typescript%2Fapp%2Fmiddleware.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -1,11 +1,6 @@\n-import {\n-  NextMiddleware,\n-  NextResponse,\n-  URLPattern,\n-  MiddlewareConfig,\n-} from 'next/server'\n+import { NextProxy, NextResponse, URLPattern, ProxyConfig } from 'next/server'\n \n-export const middleware: NextMiddleware = function (request) {\n+export const middleware: NextProxy = function (request) {\n   const pattern = new URLPattern({\n     pathname: '/:path',\n   })\n@@ -27,4 +22,4 @@ export const middleware: NextMiddleware = function (request) {\n export const config = {\n   matcher: ['/:path*'],\n   regions: [],\n-} satisfies MiddlewareConfig\n+} satisfies ProxyConfig"
        },
        {
            "sha": "f548199a3b10a8ff92723fe7d787ce142f367606",
            "filename": "test/production/proxy-typescript/app/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fnext.config.js?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -0,0 +1,6 @@\n+module.exports = {\n+  i18n: {\n+    locales: ['en', 'fr', 'nl'],\n+    defaultLocale: 'en',\n+  },\n+}"
        },
        {
            "sha": "d683fec42acc0ac71cb0ee9a75be6786ef60ddf3",
            "filename": "test/production/proxy-typescript/app/pages/index.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fpages%2Findex.tsx?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Index() {\n+  return <p className=\"title\">Static route</p>\n+}"
        },
        {
            "sha": "85db0de0aa0d53bd707bf2e555d50a1c7a4da018",
            "filename": "test/production/proxy-typescript/app/proxy.ts",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fproxy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fproxy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fproxy-typescript%2Fapp%2Fproxy.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -0,0 +1,25 @@\n+import { NextProxy, NextResponse, URLPattern, ProxyConfig } from 'next/server'\n+\n+export const proxy: NextProxy = function (request) {\n+  const pattern = new URLPattern({\n+    pathname: '/:path',\n+  })\n+  console.log(pattern.test(request.nextUrl.pathname))\n+\n+  if (request.nextUrl.pathname === '/static') {\n+    return new NextResponse(null, {\n+      headers: {\n+        data: 'hello from proxy',\n+        'req-url-basepath': request.nextUrl.basePath,\n+        'req-url-pathname': request.nextUrl.pathname,\n+        'req-url-query': request.nextUrl.searchParams.get('foo') || '',\n+        'req-url-locale': request.nextUrl.locale,\n+      },\n+    })\n+  }\n+}\n+\n+export const config = {\n+  matcher: ['/:path*'],\n+  regions: [],\n+} satisfies ProxyConfig"
        },
        {
            "sha": "1adc1d776805d172eee6f3ea7edb9c40544b52e2",
            "filename": "test/production/proxy-typescript/test/index.test.ts",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fproduction%2Fproxy-typescript%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fproxy-typescript%2Ftest%2Findex.test.ts?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -0,0 +1,14 @@\n+/* eslint-env jest */\n+import { join } from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('proxy-typescript', () => {\n+  const { next } = nextTestSetup({\n+    files: join(__dirname, '../app'),\n+  })\n+\n+  it('should have built and started', async () => {\n+    const response = await next.fetch('/static')\n+    expect(response.headers.get('data')).toEqual('hello from proxy')\n+  })\n+})"
        },
        {
            "sha": "ca153f921b5c5c8ef24b45673865aaa8c9479319",
            "filename": "test/rspack-build-tests-manifest.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Frspack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Frspack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Frspack-build-tests-manifest.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -9941,7 +9941,7 @@\n       \"skip-trailing-slash-redirect should not apply trailing slash on load on client\",\n       \"skip-trailing-slash-redirect should not have trailing slash redirects in manifest\",\n       \"skip-trailing-slash-redirect should parse locale info for data request correctly\",\n-      \"skip-trailing-slash-redirect should provide original _next/data URL with skipMiddlewareUrlNormalize\"\n+      \"skip-trailing-slash-redirect should provide original _next/data URL with skipProxyUrlNormalize\"\n     ],\n     \"failed\": [],\n     \"pending\": [],"
        },
        {
            "sha": "388e533d09d61d3ffd726af1be353a84c658c05e",
            "filename": "test/rspack-dev-tests-manifest.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Frspack-dev-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Frspack-dev-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Frspack-dev-tests-manifest.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -11853,7 +11853,7 @@\n       \"skip-trailing-slash-redirect should merge cookies from middleware and edge API routes correctly\",\n       \"skip-trailing-slash-redirect should not apply trailing slash on load on client\",\n       \"skip-trailing-slash-redirect should parse locale info for data request correctly\",\n-      \"skip-trailing-slash-redirect should provide original _next/data URL with skipMiddlewareUrlNormalize\"\n+      \"skip-trailing-slash-redirect should provide original _next/data URL with skipProxyUrlNormalize\"\n     ],\n     \"failed\": [],\n     \"pending\": [],"
        },
        {
            "sha": "bdb4d67e8bb438c7b294fd4acc5d83d8294bd02f",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -8545,7 +8545,7 @@\n       \"skip-trailing-slash-redirect should not apply trailing slash on load on client\",\n       \"skip-trailing-slash-redirect should not have trailing slash redirects in manifest\",\n       \"skip-trailing-slash-redirect should parse locale info for data request correctly\",\n-      \"skip-trailing-slash-redirect should provide original _next/data URL with skipMiddlewareUrlNormalize\"\n+      \"skip-trailing-slash-redirect should provide original _next/data URL with skipProxyUrlNormalize\"\n     ],\n     \"failed\": [],\n     \"pending\": [],"
        },
        {
            "sha": "5cb178d54978fba8d825230cfe666ef0a305f482",
            "filename": "test/turbopack-dev-tests-manifest.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fturbopack-dev-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/d540fbd3e604d1838722542acd9b518ac6688b73/test%2Fturbopack-dev-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-dev-tests-manifest.json?ref=d540fbd3e604d1838722542acd9b518ac6688b73",
            "patch": "@@ -12075,7 +12075,7 @@\n       \"skip-trailing-slash-redirect should merge cookies from middleware and edge API routes correctly\",\n       \"skip-trailing-slash-redirect should not apply trailing slash on load on client\",\n       \"skip-trailing-slash-redirect should parse locale info for data request correctly\",\n-      \"skip-trailing-slash-redirect should provide original _next/data URL with skipMiddlewareUrlNormalize\"\n+      \"skip-trailing-slash-redirect should provide original _next/data URL with skipProxyUrlNormalize\"\n     ],\n     \"failed\": [],\n     \"pending\": [],"
        }
    ],
    "stats": {
        "total": 382,
        "additions": 290,
        "deletions": 92
    }
}