{
    "author": "eps1lon",
    "message": "Use resource to detect feature usage in telemetry (#75917)\n\nThis is required for when we start using layers in Pages Router.",
    "sha": "319a338a50bdd3244a5edba54f481d89ee73d8e6",
    "files": [
        {
            "sha": "c6b5fe24b697e31d4bdf02fa72483e75f63640be",
            "filename": "packages/next/src/build/webpack/plugins/telemetry-plugin/telemetry-plugin.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 13,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/319a338a50bdd3244a5edba54f481d89ee73d8e6/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/319a338a50bdd3244a5edba54f481d89ee73d8e6/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Ftelemetry-plugin%2Ftelemetry-plugin.ts?ref=319a338a50bdd3244a5edba54f481d89ee73d8e6",
            "patch": "@@ -54,14 +54,6 @@ interface FeatureUsage {\n   invocationCount: number\n }\n \n-/**\n- * A vertex in the module graph.\n- */\n-interface Module {\n-  type: string\n-  identifier(): string\n-}\n-\n /**\n  * An edge in the module graph.\n  */\n@@ -127,16 +119,17 @@ const useCacheTracker = createUseCacheTracker()\n /**\n  * Determine if there is a feature of interest in the specified 'module'.\n  */\n-function findFeatureInModule(module: Module): Feature | undefined {\n+function findFeatureInModule(module: webpack.Module): Feature | undefined {\n   if (module.type !== 'javascript/auto') {\n     return\n   }\n-  const normalizedIdentifier = module.identifier().replace(/\\\\/g, '/')\n+\n   for (const [feature, path] of FEATURE_MODULE_MAP) {\n-    if (normalizedIdentifier.endsWith(path)) {\n+    if ((module as webpack.NormalModule).resource.endsWith(path)) {\n       return feature\n     }\n   }\n+  const normalizedIdentifier = module.identifier().replace(/\\\\/g, '/')\n   for (const [feature, regexp] of FEATURE_MODULE_REGEXP_MAP) {\n     if (regexp.test(normalizedIdentifier)) {\n       return feature\n@@ -151,7 +144,7 @@ function findFeatureInModule(module: Module): Feature | undefined {\n  */\n function findUniqueOriginModulesInConnections(\n   connections: Connection[],\n-  originModule: Module\n+  originModule: webpack.Module\n ): Set<unknown> {\n   const originModules = new Set()\n   for (const connection of connections) {\n@@ -206,7 +199,7 @@ export class TelemetryPlugin implements webpack.WebpackPluginInstance {\n       async (compilation: webpack.Compilation, callback: () => void) => {\n         compilation.hooks.finishModules.tapAsync(\n           TelemetryPlugin.name,\n-          async (modules: Iterable<Module>, modulesFinish: () => void) => {\n+          async (modules, modulesFinish) => {\n             for (const module of modules) {\n               const feature = findFeatureInModule(module)\n               if (!feature) {"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 6,
        "deletions": 13
    }
}