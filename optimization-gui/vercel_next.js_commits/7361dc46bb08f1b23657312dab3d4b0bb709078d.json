{
    "author": "wbinnssmith",
    "message": "Flight loader: use `normalModule.type` to determine module type (#76338)\n\nThis uses `normalModule.type` to determine the source module’s type\nrather than accessing a value on `normalModule.parser`, which doesn’t\nexist with rspack.",
    "sha": "7361dc46bb08f1b23657312dab3d4b0bb709078d",
    "files": [
        {
            "sha": "26420e3ee3712660744d506606eee8d20f0b61e4",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7361dc46bb08f1b23657312dab3d4b0bb709078d/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/7361dc46bb08f1b23657312dab3d4b0bb709078d/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=7361dc46bb08f1b23657312dab3d4b0bb709078d",
            "patch": "@@ -648,5 +648,6 @@\n   \"647\": \"@rspack/core is not available. Please make sure `@next/plugin-rspack` is correctly installed.\",\n   \"648\": \"@rspack/plugin-react-refresh is not available. Please make sure `@next/plugin-rspack` is correctly installed.\",\n   \"649\": \"Cache handlers not initialized\",\n-  \"650\": \"experimental.nodeMiddleware\"\n+  \"650\": \"experimental.nodeMiddleware\",\n+  \"651\": \"Unexpected module type %s\"\n }"
        },
        {
            "sha": "f6a86b45102b52f09900dcae9f57b2ab6127a7ce",
            "filename": "packages/next/src/build/webpack/loaders/next-flight-loader/index.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/7361dc46bb08f1b23657312dab3d4b0bb709078d/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7361dc46bb08f1b23657312dab3d4b0bb709078d/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts?ref=7361dc46bb08f1b23657312dab3d4b0bb709078d",
            "patch": "@@ -1,4 +1,4 @@\n-import type { webpack } from 'next/dist/compiled/webpack/webpack'\n+import type { NormalModule, webpack } from 'next/dist/compiled/webpack/webpack'\n import { RSC_MOD_REF_PROXY_ALIAS } from '../../../../lib/constants'\n import {\n   BARREL_OPTIMIZATION_PREFIX,\n@@ -97,7 +97,7 @@ export default function transformSource(\n   if (buildInfo.rsc?.type === RSC_MODULE_TYPES.client) {\n     const assumedSourceType = getAssumedSourceType(\n       module,\n-      (module.parser as javascript.JavascriptParser).sourceType\n+      sourceTypeFromModule(module)\n     )\n \n     const clientRefs = buildInfo.rsc.clientRefs!\n@@ -171,3 +171,17 @@ module.exports = createProxy(${stringifiedResourceKey})\n   )\n   this.callback(null, replacedSource, sourceMap)\n }\n+\n+function sourceTypeFromModule(module: NormalModule): SourceType {\n+  const moduleType = module.type\n+  switch (moduleType) {\n+    case 'javascript/auto':\n+      return 'auto'\n+    case 'javascript/dynamic':\n+      return 'script'\n+    case 'javascript/esm':\n+      return 'module'\n+    default:\n+      throw new Error('Unexpected module type ' + moduleType)\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}