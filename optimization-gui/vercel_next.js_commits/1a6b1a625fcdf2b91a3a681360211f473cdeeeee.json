{
    "author": "sokra",
    "message": "Turbopack: do not run a compaction when opening the db (#82635)\n\n### What?\n\nDo not run a compaction when opening the DB. We are already busy when starting up, so no need to add more work to that.",
    "sha": "1a6b1a625fcdf2b91a3a681360211f473cdeeeee",
    "files": [
        {
            "sha": "d9581447472eeea3596b60f7f5021fec0a06c276",
            "filename": "turbopack/crates/turbo-tasks-backend/src/database/turbo/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 14,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/1a6b1a625fcdf2b91a3a681360211f473cdeeeee/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1a6b1a625fcdf2b91a3a681360211f473cdeeeee/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fdatabase%2Fturbo%2Fmod.rs?ref=1a6b1a625fcdf2b91a3a681360211f473cdeeeee",
            "patch": "@@ -40,24 +40,12 @@ pub struct TurboKeyValueDatabase {\n impl TurboKeyValueDatabase {\n     pub fn new(versioned_path: PathBuf, is_ci: bool, is_short_session: bool) -> Result<Self> {\n         let db = Arc::new(TurboPersistence::open(versioned_path)?);\n-        let mut this = Self {\n+        Ok(Self {\n             db: db.clone(),\n             compact_join_handle: Mutex::new(None),\n             is_ci,\n             is_short_session,\n-        };\n-        // start compaction in background if the database is not empty\n-        if !db.is_empty() {\n-            let handle = spawn(async move {\n-                db.compact(&CompactConfig {\n-                    max_merge_segment_count: available_parallelism()\n-                        .map_or(4, |c| max(4, c.get() / 4)),\n-                    ..COMPACT_CONFIG\n-                })\n-            });\n-            this.compact_join_handle.get_mut().replace(handle);\n-        }\n-        Ok(this)\n+        })\n     }\n }\n "
        }
    ],
    "stats": {
        "total": 16,
        "additions": 2,
        "deletions": 14
    }
}