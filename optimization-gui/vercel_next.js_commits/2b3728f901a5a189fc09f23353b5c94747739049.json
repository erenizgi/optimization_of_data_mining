{
    "author": "styfle",
    "message": "feat(next/image): warn when `images.qualities` is undefined (#81690)\n\nAdd a warning to Next.js 15.5 to prepare for Next.js 16 when\n`images.qualities` is undefined and the user attempted to use set\n`quality` prop to something other than 75.",
    "sha": "2b3728f901a5a189fc09f23353b5c94747739049",
    "files": [
        {
            "sha": "0a0f236bc782db0b214aa8ef6a7a7b6df7441518",
            "filename": "packages/next/src/client/legacy/image.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flegacy%2Fimage.tsx?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -859,6 +859,13 @@ export default function Image({\n         )\n       }\n \n+      if (qualityInt && qualityInt !== 75 && !config.qualities) {\n+        warnOnce(\n+          `Image with src \"${src}\" is using quality \"${qualityInt}\" which is not configured in images.qualities. This config will be required starting in Next.js 16.` +\n+            `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-qualities`\n+        )\n+      }\n+\n       if (!unoptimized && loader !== defaultImageLoader) {\n         const urlStr = loader({\n           config,"
        },
        {
            "sha": "0a8803e266566557afd414805831a59ea9c98cc4",
            "filename": "packages/next/src/shared/lib/get-img-props.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fget-img-props.ts?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -532,6 +532,12 @@ export function getImgProps(\n         )\n       }\n     }\n+    if (qualityInt && qualityInt !== 75 && !config.qualities) {\n+      warnOnce(\n+        `Image with src \"${src}\" is using quality \"${qualityInt}\" which is not configured in images.qualities. This config will be required starting in Next.js 16.` +\n+          `\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-qualities`\n+      )\n+    }\n     if (placeholder === 'blur' && !blurDataURL) {\n       const VALID_BLUR_EXT = ['jpeg', 'png', 'webp', 'avif'] // should match next-image-loader\n "
        },
        {
            "sha": "615a75b72980e891c8b3a4531c3415345c5331d9",
            "filename": "test/integration/next-image-legacy/default/pages/quality-50.js",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Fpages%2Fquality-50.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Fpages%2Fquality-50.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Fpages%2Fquality-50.js?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -0,0 +1,17 @@\n+import React from 'react'\n+import Image from 'next/image'\n+\n+const Page = () => {\n+  return (\n+    <Image\n+      id=\"quality-50\"\n+      alt=\"quality-50\"\n+      src=\"/test.jpg\"\n+      width=\"400\"\n+      height=\"400\"\n+      quality=\"50\"\n+    />\n+  )\n+}\n+\n+export default Page"
        },
        {
            "sha": "fdbeea6e79ae39df29b78aa46a8c2bb166d428ed",
            "filename": "test/integration/next-image-legacy/default/test/index.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-legacy%2Fdefault%2Ftest%2Findex.test.ts?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -915,6 +915,18 @@ function runTests(mode) {\n       )\n     })\n \n+    it('should warn when quality is 50', async () => {\n+      const browser = await webdriver(appPort, '/quality-50')\n+\n+      const warnings = (await browser.log())\n+        .map((log) => log.message)\n+        .join('\\n')\n+      await assertNoRedbox(browser)\n+      expect(warnings).toMatch(\n+        /Image with src (.*)jpg(.*) is using quality \"50\" which is not configured in images.qualities. This config will be required starting in Next.js 16./gm\n+      )\n+    })\n+\n     it('should not warn when Image is child of p', async () => {\n       const browser = await webdriver(appPort, '/inside-paragraph')\n "
        },
        {
            "sha": "615a75b72980e891c8b3a4531c3415345c5331d9",
            "filename": "test/integration/next-image-new/app-dir/app/quality-50/page.js",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Fapp%2Fquality-50%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Fapp%2Fquality-50%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Fapp%2Fquality-50%2Fpage.js?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -0,0 +1,17 @@\n+import React from 'react'\n+import Image from 'next/image'\n+\n+const Page = () => {\n+  return (\n+    <Image\n+      id=\"quality-50\"\n+      alt=\"quality-50\"\n+      src=\"/test.jpg\"\n+      width=\"400\"\n+      height=\"400\"\n+      quality=\"50\"\n+    />\n+  )\n+}\n+\n+export default Page"
        },
        {
            "sha": "36ecd0a0333fd88cc94e4a89cb0b94b156649f07",
            "filename": "test/integration/next-image-new/app-dir/test/index.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fapp-dir%2Ftest%2Findex.test.ts?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -1052,6 +1052,18 @@ function runTests(mode: 'dev' | 'server') {\n       )\n     })\n \n+    it('should warn when quality is 50', async () => {\n+      const browser = await webdriver(appPort, '/quality-50')\n+\n+      const warnings = (await browser.log())\n+        .map((log) => log.message)\n+        .join('\\n')\n+      await assertNoRedbox(browser)\n+      expect(warnings).toMatch(\n+        /Image with src (.*)jpg(.*) is using quality \"50\" which is not configured in images.qualities. This config will be required starting in Next.js 16./gm\n+      )\n+    })\n+\n     it('should not warn when Image is child of p', async () => {\n       const browser = await webdriver(appPort, '/inside-paragraph')\n "
        },
        {
            "sha": "615a75b72980e891c8b3a4531c3415345c5331d9",
            "filename": "test/integration/next-image-new/default/pages/quality-50.js",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fquality-50.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fquality-50.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fquality-50.js?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -0,0 +1,17 @@\n+import React from 'react'\n+import Image from 'next/image'\n+\n+const Page = () => {\n+  return (\n+    <Image\n+      id=\"quality-50\"\n+      alt=\"quality-50\"\n+      src=\"/test.jpg\"\n+      width=\"400\"\n+      height=\"400\"\n+      quality=\"50\"\n+    />\n+  )\n+}\n+\n+export default Page"
        },
        {
            "sha": "d7f55ee1660e96dbd60afb5cf2e89ca109bc9fdd",
            "filename": "test/integration/next-image-new/default/test/index.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fdefault%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Fintegration%2Fnext-image-new%2Fdefault%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fdefault%2Ftest%2Findex.test.ts?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -1054,6 +1054,18 @@ function runTests(mode) {\n       )\n     })\n \n+    it('should warn when quality is 50', async () => {\n+      const browser = await webdriver(appPort, '/quality-50')\n+\n+      const warnings = (await browser.log())\n+        .map((log) => log.message)\n+        .join('\\n')\n+      await assertNoRedbox(browser)\n+      expect(warnings).toMatch(\n+        /Image with src (.*)jpg(.*) is using quality \"50\" which is not configured in images.qualities. This config will be required starting in Next.js 16./gm\n+      )\n+    })\n+\n     it('should not warn when Image is child of p', async () => {\n       const browser = await webdriver(appPort, '/inside-paragraph')\n "
        },
        {
            "sha": "66d4d0b49b18f9637e6c6b2e12a7db4306136f37",
            "filename": "test/unit/next-image-get-img-props.test.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 1,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/2b3728f901a5a189fc09f23353b5c94747739049/test%2Funit%2Fnext-image-get-img-props.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2b3728f901a5a189fc09f23353b5c94747739049/test%2Funit%2Fnext-image-get-img-props.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Funit%2Fnext-image-get-img-props.test.ts?ref=2b3728f901a5a189fc09f23353b5c94747739049",
            "patch": "@@ -120,7 +120,9 @@ describe('getImageProps()', () => {\n       height: 200,\n       quality: 50,\n     })\n-    expect(warningMessages).toStrictEqual([])\n+    expect(warningMessages).toStrictEqual([\n+      'Image with src \"/test.png\" is using quality \"50\" which is not configured in images.qualities. This config will be required starting in Next.js 16.\\nRead more: https://nextjs.org/docs/messages/next-image-unconfigured-qualities',\n+    ])\n     expect(Object.entries(props)).toStrictEqual([\n       ['alt', 'a nice desc'],\n       ['id', 'my-image'],\n@@ -136,6 +138,31 @@ describe('getImageProps()', () => {\n       ['src', '/_next/image?url=%2Ftest.png&w=256&q=50'],\n     ])\n   })\n+  it('should handle quality as a string and not warn', async () => {\n+    const { props } = getImageProps({\n+      alt: 'a nice desc',\n+      id: 'my-image',\n+      src: '/test.png',\n+      width: 100,\n+      height: 200,\n+      quality: '75',\n+    })\n+    expect(warningMessages).toStrictEqual([])\n+    expect(Object.entries(props)).toStrictEqual([\n+      ['alt', 'a nice desc'],\n+      ['id', 'my-image'],\n+      ['loading', 'lazy'],\n+      ['width', 100],\n+      ['height', 200],\n+      ['decoding', 'async'],\n+      ['style', { color: 'transparent' }],\n+      [\n+        'srcSet',\n+        '/_next/image?url=%2Ftest.png&w=128&q=75 1x, /_next/image?url=%2Ftest.png&w=256&q=75 2x',\n+      ],\n+      ['src', '/_next/image?url=%2Ftest.png&w=256&q=75'],\n+    ])\n+  })\n   it('should handle loading eager', async () => {\n     const { props } = getImageProps({\n       alt: 'a nice desc',"
        }
    ],
    "stats": {
        "total": 129,
        "additions": 128,
        "deletions": 1
    }
}