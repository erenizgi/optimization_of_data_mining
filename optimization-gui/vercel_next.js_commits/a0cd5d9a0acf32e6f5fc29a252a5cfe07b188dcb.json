{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in app/ ReactRefreshLogBoxMisc (#76563)",
    "sha": "a0cd5d9a0acf32e6f5fc29a252a5cfe07b188dcb",
    "files": [
        {
            "sha": "dcae3d320623f19f174074a076fb0cb974b437fd",
            "filename": "test/development/acceptance-app/ReactRefreshLogBoxMisc.test.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 199,
            "changes": 242,
            "blob_url": "https://github.com/vercel/next.js/blob/a0cd5d9a0acf32e6f5fc29a252a5cfe07b188dcb/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBoxMisc.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a0cd5d9a0acf32e6f5fc29a252a5cfe07b188dcb/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBoxMisc.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBoxMisc.test.ts?ref=a0cd5d9a0acf32e6f5fc29a252a5cfe07b188dcb",
            "patch": "@@ -3,210 +3,15 @@ import { FileRef, nextTestSetup } from 'e2e-utils'\n import path from 'path'\n import { outdent } from 'outdent'\n \n-// TODO: re-enable these tests after figuring out what is causing\n-// them to be so unreliable in CI\n-describe.skip('ReactRefreshLogBox app', () => {\n-  const { next } = nextTestSetup({\n+describe('ReactRefreshLogBox app', () => {\n+  const { isTurbopack, next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n     skipStart: true,\n   })\n \n-  test('<Link> with multiple children', async () => {\n-    await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Index() {\n-          return (\n-            <Link href=\"/\">\n-              <p>One</p>\n-              <p>Two</p>\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-\n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n-      `\"Error: Multiple children were passed to <Link> with \\`href\\` of \\`/\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children\"`\n-    )\n-    expect(\n-      await session.evaluate(\n-        () =>\n-          (\n-            document\n-              .querySelector('body > nextjs-portal')\n-              .shadowRoot.querySelector(\n-                '#nextjs__container_errors_desc a:nth-of-type(1)'\n-              ) as any\n-          ).href\n-      )\n-    ).toMatch('https://nextjs.org/docs/messages/link-multiple-children')\n-  })\n-\n-  test('<Link> component props errors', async () => {\n-    await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return <Link />\n-        }\n-      `\n-    )\n-\n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n-      `\"Error: Failed prop type: The prop \\`href\\` expects a \\`string\\` or \\`object\\` in \\`<Link>\\`, but got \\`undefined\\` instead.\"`\n-    )\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return <Link href=\"/\">Abc</Link>\n-        }\n-      `\n-    )\n-    await session.assertNoRedbox()\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return (\n-            <Link\n-              href=\"/\"\n-              as=\"/\"\n-              replace={false}\n-              scroll={false}\n-              shallow={false}\n-              passHref={false}\n-              prefetch={false}\n-            >\n-              Abc\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-    await session.assertNoRedbox()\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return (\n-            <Link\n-              href=\"/\"\n-              as=\"/\"\n-              replace={true}\n-              scroll={true}\n-              shallow={true}\n-              passHref={true}\n-              prefetch={true}\n-            >\n-              Abc\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-    await session.assertNoRedbox()\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return (\n-            <Link\n-              href=\"/\"\n-              as=\"/\"\n-              replace={undefined}\n-              scroll={undefined}\n-              shallow={undefined}\n-              passHref={undefined}\n-              prefetch={undefined}\n-            >\n-              Abc\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-    await session.assertNoRedbox()\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return (\n-            <Link\n-              href=\"/\"\n-              as=\"/\"\n-              replace={undefined}\n-              scroll={'oops'}\n-              shallow={undefined}\n-              passHref={undefined}\n-              prefetch={undefined}\n-            >\n-              Abc\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxDescription()).toMatchSnapshot()\n-\n-    await session.patch(\n-      'index.js',\n-      outdent`\n-        import Link from 'next/link'\n-\n-        export default function Hello() {\n-          return (\n-            <Link\n-              href={false}\n-              as=\"/\"\n-              replace={undefined}\n-              scroll={'oops'}\n-              shallow={undefined}\n-              passHref={undefined}\n-              prefetch={undefined}\n-            >\n-              Abc\n-            </Link>\n-          )\n-        }\n-      `\n-    )\n-    await session.assertHasRedbox()\n-    expect(await session.getRedboxDescription()).toMatchSnapshot()\n-  })\n-\n   test('server-side only compilation errors', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'app/page.js',\n@@ -226,6 +31,45 @@ describe.skip('ReactRefreshLogBox app', () => {\n       `\n     )\n \n-    await session.assertHasRedbox()\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Ecmascript file had an error\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./app/page.js (3:23)\n+       Ecmascript file had an error\n+       > 3 | export async function getStaticProps() {\n+           |                       ^^^^^^^^^^^^^^\",\n+         \"stack\": [],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error:   x \"getStaticProps\" is not supported in app/. Read more: https://nextjs.org/docs/app/building-your-application/data-fetching\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./app/page.js\n+       Error:   x \"getStaticProps\" is not supported in app/. Read more: https://nextjs.org/docs/app/building-your-application/data-fetching\n+         |\n+         |\n+          ,-[3:1]\n+        1 | 'use client'\n+        2 | import myLibrary from 'my-non-existent-library'\n+        3 | export async function getStaticProps() {\n+          :                       ^^^^^^^^^^^^^^\n+        4 |   return {\n+        5 |     props: {\n+        6 |       result: myLibrary()\n+          \\`----\n+       Import trace for requested module:\n+       ./app/page.js\",\n+         \"stack\": [],\n+       }\n+      `)\n+    }\n   })\n })"
        }
    ],
    "stats": {
        "total": 242,
        "additions": 43,
        "deletions": 199
    }
}