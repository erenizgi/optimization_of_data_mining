{
    "author": "lukesandberg",
    "message": "Add a webpack flag to create next app.  Ensure that if you set it or decline turbopack we set the --webpack flag on the generated project (#84476)\n\nAdd a --webpack flag to create-next-app to allow selecting the webpack bundler.\n\nAdd the --webpack flag to the `next` command lines if it is set or if the turbopack prompt is declined.\n\nThis is necessary now that we have flipped the default.",
    "sha": "751b11dcab8f104511bba634f89579548501d28d",
    "files": [
        {
            "sha": "165717ff574110ec2bb85a320dc296f5b90519fc",
            "filename": "packages/create-next-app/create-app.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Fcreate-app.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Fcreate-app.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Fcreate-app.ts?ref=751b11dcab8f104511bba634f89579548501d28d",
            "patch": "@@ -19,7 +19,7 @@ import { getOnline } from './helpers/is-online'\n import { isWriteable } from './helpers/is-writeable'\n import { runTypegen } from './helpers/typegen'\n \n-import type { TemplateMode, TemplateType } from './templates'\n+import type { Bundler, TemplateMode, TemplateType } from './templates'\n import { getTemplateFile, installTemplate } from './templates'\n \n export class DownloadError extends Error {}\n@@ -39,8 +39,7 @@ export async function createApp({\n   skipInstall,\n   empty,\n   api,\n-  turbopack,\n-  rspack,\n+  bundler,\n   disableGit,\n   reactCompiler,\n }: {\n@@ -58,8 +57,7 @@ export async function createApp({\n   skipInstall: boolean\n   empty: boolean\n   api?: boolean\n-  turbopack: boolean\n-  rspack: boolean\n+  bundler: Bundler\n   disableGit?: boolean\n   reactCompiler: boolean\n }): Promise<void> {\n@@ -252,8 +250,7 @@ export async function createApp({\n       srcDir,\n       importAlias,\n       skipInstall,\n-      turbopack,\n-      rspack,\n+      bundler,\n       reactCompiler,\n     })\n   }"
        },
        {
            "sha": "d8b2229ff1bea7e6623f959d0a99db546a8ba849",
            "filename": "packages/create-next-app/index.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 8,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Findex.ts?ref=751b11dcab8f104511bba634f89579548501d28d",
            "patch": "@@ -15,6 +15,7 @@ import { getPkgManager } from './helpers/get-pkg-manager'\n import { isFolderEmpty } from './helpers/is-folder-empty'\n import { validateNpmName } from './helpers/validate-pkg'\n import packageJson from './package.json'\n+import { Bundler } from './templates'\n \n let projectPath: string = ''\n \n@@ -54,8 +55,9 @@ const program = new Command(packageJson.name)\n   .option('--biome', 'Initialize with Biome config.')\n   .option('--app', 'Initialize as an App Router project.')\n   .option('--src-dir', \"Initialize inside a 'src/' directory.\")\n-  .option('--turbopack', 'Enable Turbopack by default for development.')\n-  .option('--rspack', 'Using Rspack as the bundler')\n+  .option('--turbopack', 'Enable Turbopack as the bundler.')\n+  .option('--webpack', 'Enable Webpack as the bundler.')\n+  .option('--rspack', 'Enable Rspack as the bundler')\n   .option(\n     '--import-alias <prefix/*>',\n     'Specify import alias to use (default \"@/*\").'\n@@ -276,7 +278,7 @@ async function run(): Promise<void> {\n          * Depending on the prompt response, set the appropriate program flags.\n          */\n         opts.typescript = Boolean(typescript)\n-        opts.javascript = !Boolean(typescript)\n+        opts.javascript = !typescript\n         preferences.typescript = Boolean(typescript)\n       }\n     }\n@@ -429,7 +431,12 @@ async function run(): Promise<void> {\n       }\n     }\n \n-    if (!opts.turbopack && !args.includes('--no-turbopack')) {\n+    if (\n+      !opts.turbopack &&\n+      !args.includes('--no-turbopack') &&\n+      !opts.webpack &&\n+      !opts.rspack\n+    ) {\n       if (skipPrompt) {\n         opts.turbopack = getPrefOrDefault('turbopack')\n       } else {\n@@ -446,6 +453,8 @@ async function run(): Promise<void> {\n         opts.turbopack = Boolean(turbopack)\n         preferences.turbopack = Boolean(turbopack)\n       }\n+      // If Turbopack is not selected, default to Webpack\n+      opts.webpack = !opts.turbopack\n     }\n \n     const importAliasPattern = /^[^*\"]+\\/\\*\\s*$/\n@@ -493,6 +502,14 @@ async function run(): Promise<void> {\n     }\n   }\n \n+  const bundler: Bundler = opts.turbopack\n+    ? Bundler.Turbopack\n+    : opts.webpack\n+      ? Bundler.Webpack\n+      : opts.rspack\n+        ? Bundler.Rspack\n+        : Bundler.Turbopack\n+\n   try {\n     await createApp({\n       appPath,\n@@ -509,8 +526,7 @@ async function run(): Promise<void> {\n       skipInstall: opts.skipInstall,\n       empty: opts.empty,\n       api: opts.api,\n-      turbopack: opts.turbopack,\n-      rspack: opts.rspack,\n+      bundler,\n       disableGit: opts.disableGit,\n       reactCompiler: opts.reactCompiler,\n     })\n@@ -544,8 +560,7 @@ async function run(): Promise<void> {\n       importAlias: opts.importAlias,\n       skipInstall: opts.skipInstall,\n       empty: opts.empty,\n-      turbopack: opts.turbopack,\n-      rspack: opts.rspack,\n+      bundler,\n       disableGit: opts.disableGit,\n       reactCompiler: opts.reactCompiler,\n     })"
        },
        {
            "sha": "556b72fd9768211387b7cd042979061e806dd9f7",
            "filename": "packages/create-next-app/templates/index.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts?ref=751b11dcab8f104511bba634f89579548501d28d",
            "patch": "@@ -10,7 +10,7 @@ import { cyan, bold } from \"picocolors\";\n import { Sema } from \"async-sema\";\n import pkg from \"../package.json\";\n \n-import { GetTemplateFileArgs, InstallTemplateArgs } from \"./types\";\n+import { Bundler, GetTemplateFileArgs, InstallTemplateArgs } from \"./types\";\n \n // Do not rename or format. sync-react script relies on this line.\n // prettier-ignore\n@@ -45,8 +45,7 @@ export const installTemplate = async ({\n   srcDir,\n   importAlias,\n   skipInstall,\n-  turbopack,\n-  rspack,\n+  bundler,\n   reactCompiler,\n }: InstallTemplateArgs) => {\n   console.log(bold(`Using ${packageManager}.`));\n@@ -82,7 +81,7 @@ export const installTemplate = async ({\n     },\n   });\n \n-  if (rspack) {\n+  if (bundler === Bundler.Rspack) {\n     const nextConfigFile = path.join(\n       root,\n       mode === \"js\" ? \"next.config.mjs\" : \"next.config.ts\",\n@@ -207,15 +206,16 @@ export const installTemplate = async ({\n \n   /** Copy the version from package.json or override for tests. */\n   const version = process.env.NEXT_PRIVATE_TEST_VERSION ?? pkg.version;\n+  const bundlerFlags = `${bundler === Bundler.Turbopack ? \" --turbopack\" : \"\"}${bundler === Bundler.Webpack ? \" --webpack\" : \"\"}`;\n \n   /** Create a package.json for the new project and write it to disk. */\n   const packageJson: any = {\n     name: appName,\n     version: \"0.1.0\",\n     private: true,\n     scripts: {\n-      dev: `next dev${turbopack ? \" --turbopack\" : \"\"}`,\n-      build: `next build${turbopack ? \" --turbopack\" : \"\"}`,\n+      dev: `next dev${bundlerFlags}`,\n+      build: `next build${bundlerFlags}`,\n       start: \"next start\",\n       ...(eslint && { lint: \"eslint\" }),\n       ...(biome && { lint: \"biome check\", format: \"biome format --write\" }),\n@@ -231,7 +231,7 @@ export const installTemplate = async ({\n     devDependencies: {},\n   };\n \n-  if (rspack) {\n+  if (bundler === Bundler.Rspack) {\n     const NEXT_PRIVATE_TEST_VERSION = process.env.NEXT_PRIVATE_TEST_VERSION;\n     if (\n       NEXT_PRIVATE_TEST_VERSION &&"
        },
        {
            "sha": "11f8eb7ce7685cd7d3eed483a02c9ac7424ef269",
            "filename": "packages/create-next-app/templates/types.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Ftemplates%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/751b11dcab8f104511bba634f89579548501d28d/packages%2Fcreate-next-app%2Ftemplates%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Ftypes.ts?ref=751b11dcab8f104511bba634f89579548501d28d",
            "patch": "@@ -31,7 +31,12 @@ export interface InstallTemplateArgs {\n   srcDir: boolean;\n   importAlias: string;\n   skipInstall: boolean;\n-  turbopack: boolean;\n-  rspack: boolean;\n+  bundler: Bundler;\n   reactCompiler: boolean;\n }\n+\n+export enum Bundler {\n+  Turbopack = \"turbopack\",\n+  Webpack = \"webpack\",\n+  Rspack = \"rspack\",\n+}"
        }
    ],
    "stats": {
        "total": 65,
        "additions": 41,
        "deletions": 24
    }
}