{
    "author": "eps1lon",
    "message": "[dev-overlay] Render /app Dev Overlay with a separate React instance (#79699)",
    "sha": "85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
    "files": [
        {
            "sha": "8f9646ddbfe21b507d4734833262a5661cfbcc04",
            "filename": ".eslintrc.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/.eslintrc.json",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/.eslintrc.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.eslintrc.json?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -168,6 +168,7 @@\n       \"files\": [\"packages/**\"],\n       \"excludedFiles\": [\n         \"packages/next/taskfile*.js\",\n+        \"packages/next/next-devtools.webpack-config.js\",\n         \"packages/next/next-runtime.webpack-config.js\"\n       ],\n       \"rules\": {"
        },
        {
            "sha": "6619203c94ce9024036b7f20787d30d1d567541d",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -693,5 +693,7 @@\n   \"692\": \"Expected clientReferenceManifest to be defined.\",\n   \"693\": \"%s must not be used within a client component. Next.js should be preventing %s from being included in client components statically, but did not in this case.\",\n   \"694\": \"createPrerenderPathname was called inside a client component scope.\",\n-  \"695\": \"Expected workUnitAsyncStorage to have a store.\"\n+  \"695\": \"Expected workUnitAsyncStorage to have a store.\",\n+  \"696\": \"Next DevTools: Can't dispatch %s in this environment. This is a bug in Next.js\",\n+  \"697\": \"Next DevTools: Can't render in this environment. This is a bug in Next.js\"\n }"
        },
        {
            "sha": "e027e1cfe3dc041208e69fa81f791b9f6b8e1077",
            "filename": "packages/next/next-devtools.webpack-config.js",
            "status": "added",
            "additions": 122,
            "deletions": 0,
            "changes": 122,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fnext-devtools.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fnext-devtools.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-devtools.webpack-config.js?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -0,0 +1,122 @@\n+const path = require('path')\n+const webpack = require('@rspack/core')\n+const MODERN_BROWSERSLIST_TARGET = require('./src/shared/lib/modern-browserslist-target')\n+const DevToolsIgnoreListPlugin = require('./webpack-plugins/devtools-ignore-list-plugin')\n+\n+function shouldIgnorePath(modulePath) {\n+  // For consumers, everything will be considered 3rd party dependency if they use\n+  // the bundles we produce here.\n+  // In other words, this is all library code and should therefore be ignored.\n+  return true\n+}\n+\n+/**\n+ * @param {Object} options\n+ * @param {boolean} options.dev\n+ * @param {Partial<webpack.Configuration>} options.rest\n+ * @returns {webpack.Configuration}\n+ */\n+module.exports = ({ dev, ...rest }) => {\n+  const experimental = false\n+  const turbo = false\n+\n+  const bundledReactChannel = experimental ? '-experimental' : ''\n+\n+  const target = `browserslist:${MODERN_BROWSERSLIST_TARGET.join(', ')}`\n+\n+  return {\n+    entry: path.join(\n+      __dirname,\n+      'src/client/components/react-dev-overlay/app/entrypoint.js'\n+    ),\n+    target,\n+    mode: dev ? 'development' : 'production',\n+    output: {\n+      path: path.join(__dirname, 'dist/compiled/next-devtools'),\n+      filename: `index.js`,\n+      iife: false,\n+      library: {\n+        type: 'commonjs-static',\n+      },\n+    },\n+    devtool: 'source-map',\n+    optimization: {\n+      moduleIds: 'named',\n+      minimize: true,\n+      concatenateModules: true,\n+      minimizer: [\n+        new webpack.SwcJsMinimizerRspackPlugin({\n+          minimizerOptions: {\n+            mangle: dev || process.env.NEXT_SERVER_NO_MANGLE ? false : true,\n+          },\n+        }),\n+      ],\n+    },\n+    plugins: [\n+      // TODO: React Compiler\n+      new DevToolsIgnoreListPlugin({ shouldIgnorePath }),\n+      new webpack.DefinePlugin({\n+        // TODO: Hardcode it and ensure module resolution resolves to .node entrypoint in Node.js\n+        // 'typeof window': JSON.stringify('object'),\n+        'process.env.NEXT_MINIMAL': JSON.stringify('true'),\n+        'this.serverOptions.experimentalTestProxy': JSON.stringify(false),\n+        'this.minimalMode': JSON.stringify(true),\n+        'this.renderOpts.dev': JSON.stringify(dev),\n+        'renderOpts.dev': JSON.stringify(dev),\n+        'process.env.NODE_ENV': JSON.stringify(\n+          dev ? 'development' : 'production'\n+        ),\n+        'process.env.__NEXT_EXPERIMENTAL_REACT': JSON.stringify(\n+          experimental ? true : false\n+        ),\n+        'process.env.NEXT_RUNTIME': JSON.stringify('nodejs'),\n+        'process.turbopack': JSON.stringify(turbo),\n+        'process.env.TURBOPACK': JSON.stringify(turbo),\n+      }),\n+    ].filter(Boolean),\n+    stats: {\n+      optimizationBailout: true,\n+    },\n+    resolve: {\n+      alias: {\n+        // TODO: Get dedicated React version for NDT to uncouple development.\n+        react: `next/dist/compiled/react${bundledReactChannel}`,\n+        'react-dom$': `next/dist/compiled/react-dom${bundledReactChannel}`,\n+        'react-dom/client$': `next/dist/compiled/react-dom${bundledReactChannel}/client`,\n+        'react-is$': `next/dist/compiled/react-is${bundledReactChannel}`,\n+        scheduler$: `next/dist/compiled/scheduler${bundledReactChannel}`,\n+      },\n+      extensions: ['.ts', '.tsx', '.js', '.json'],\n+    },\n+    module: {\n+      rules: [\n+        { test: /\\.m?js$/, loader: `source-map-loader`, enforce: `pre` },\n+        {\n+          test: /\\.(ts|tsx)$/,\n+          exclude: [/node_modules/],\n+          loader: 'builtin:swc-loader',\n+          options: {\n+            jsc: {\n+              parser: {\n+                syntax: 'typescript',\n+                tsx: true,\n+              },\n+              transform: {\n+                react: {\n+                  development: dev,\n+                  runtime: 'automatic',\n+                  // TODO: Fast Refresh\n+                  // refresh: dev,\n+                },\n+              },\n+            },\n+          },\n+          type: 'javascript/auto',\n+        },\n+      ],\n+    },\n+    externals: [],\n+    experiments: {},\n+    ...rest,\n+  }\n+}"
        },
        {
            "sha": "c0f4a0fa229abcd28c5edcf3dc49c17d83cb35f3",
            "filename": "packages/next/next-runtime.webpack-config.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-runtime.webpack-config.js?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -92,6 +92,8 @@ const sharedExternals = [\n \n const externalsMap = {\n   './web/sandbox': 'next/dist/server/web/sandbox',\n+  'next/dist/compiled/next-devtools':\n+    'commonjs next/dist/client/components/react-dev-overlay/app/app-dev-overlay.shim.js',\n }\n \n const externalsRegexMap = {"
        },
        {
            "sha": "5867f598ca986626bafd4f2e333aa66243958c0c",
            "filename": "packages/next/src/client/app-next-dev.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-dev.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -2,12 +2,22 @@\n \n import './app-webpack'\n \n+import { renderAppDevOverlay } from 'next/dist/compiled/next-devtools'\n import { appBootstrap } from './app-bootstrap'\n+import {\n+  getComponentStack,\n+  getOwnerStack,\n+} from './components/errors/stitched-error'\n+import { isRecoverableError } from './react-client-callbacks/on-recoverable-error'\n \n // eslint-disable-next-line @next/internal/typechecked-require\n const instrumentationHooks = require('../lib/require-instrumentation-client')\n \n appBootstrap(() => {\n   const { hydrate } = require('./app-index') as typeof import('./app-index')\n-  hydrate(instrumentationHooks)\n+  try {\n+    hydrate(instrumentationHooks)\n+  } finally {\n+    renderAppDevOverlay(getComponentStack, getOwnerStack, isRecoverableError)\n+  }\n })"
        },
        {
            "sha": "1999c190f9ce02ec0c8b27e331eef5683b24763e",
            "filename": "packages/next/src/client/app-next-turbopack.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-next-turbopack.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -1,6 +1,9 @@\n-// TODO-APP: hydration warning\n-\n import { appBootstrap } from './app-bootstrap'\n+import {\n+  getComponentStack,\n+  getOwnerStack,\n+} from './components/errors/stitched-error'\n+import { isRecoverableError } from './react-client-callbacks/on-recoverable-error'\n \n window.next.version += '-turbo'\n ;(self as any).__webpack_hash__ = ''\n@@ -10,5 +13,13 @@ const instrumentationHooks = require('../lib/require-instrumentation-client')\n \n appBootstrap(() => {\n   const { hydrate } = require('./app-index') as typeof import('./app-index')\n-  hydrate(instrumentationHooks)\n+  try {\n+    hydrate(instrumentationHooks)\n+  } finally {\n+    if (process.env.NODE_ENV !== 'production') {\n+      const { renderAppDevOverlay } =\n+        require('next/dist/compiled/next-devtools') as typeof import('next/dist/compiled/next-devtools')\n+      renderAppDevOverlay(getComponentStack, getOwnerStack, isRecoverableError)\n+    }\n+  }\n })"
        },
        {
            "sha": "362e62ed50c3636cfe95de806722572bda83aa87",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay-error-boundary.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -1,4 +1,5 @@\n import { PureComponent } from 'react'\n+import { dispatcher } from 'next/dist/compiled/next-devtools'\n import { RuntimeErrorHandler } from '../../errors/runtime-error-handler'\n import { ErrorBoundary } from '../../error-boundary'\n import DefaultGlobalError, {\n@@ -8,7 +9,6 @@ import DefaultGlobalError, {\n type AppDevOverlayErrorBoundaryProps = {\n   children: React.ReactNode\n   globalError: [GlobalErrorComponent, React.ReactNode]\n-  onError: () => void\n }\n \n type AppDevOverlayErrorBoundaryState = {\n@@ -53,7 +53,7 @@ export class AppDevOverlayErrorBoundary extends PureComponent<\n   }\n \n   componentDidCatch() {\n-    this.props.onError()\n+    dispatcher.openErrorOverlay()\n   }\n \n   render() {"
        },
        {
            "sha": "4bcab0aff335aed4b63280d72547210ccf6cdf21",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.browser.tsx",
            "status": "added",
            "additions": 238,
            "deletions": 0,
            "changes": 238,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.browser.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -0,0 +1,238 @@\n+import {\n+  ACTION_BEFORE_REFRESH,\n+  ACTION_BUILD_ERROR,\n+  ACTION_BUILD_OK,\n+  ACTION_DEBUG_INFO,\n+  ACTION_DEV_INDICATOR,\n+  ACTION_REFRESH,\n+  ACTION_ERROR_OVERLAY_CLOSE,\n+  ACTION_ERROR_OVERLAY_OPEN,\n+  ACTION_ERROR_OVERLAY_TOGGLE,\n+  ACTION_STATIC_INDICATOR,\n+  ACTION_UNHANDLED_ERROR,\n+  ACTION_UNHANDLED_REJECTION,\n+  ACTION_VERSION_INFO,\n+  useErrorOverlayReducer,\n+  ACTION_BUILDING_INDICATOR_HIDE,\n+  ACTION_BUILDING_INDICATOR_SHOW,\n+  ACTION_RENDERING_INDICATOR_HIDE,\n+  ACTION_RENDERING_INDICATOR_SHOW,\n+} from '../shared'\n+\n+import { startTransition, useInsertionEffect } from 'react'\n+import { createRoot } from 'react-dom/client'\n+import { FontStyles } from '../font/font-styles'\n+import type { DebugInfo } from '../types'\n+import { DevOverlay } from '../ui/dev-overlay'\n+import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n+import type { VersionInfo } from '../../../../server/dev/parse-version-info'\n+\n+export interface Dispatcher {\n+  onBuildOk(): void\n+  onBuildError(message: string): void\n+  onVersionInfo(versionInfo: VersionInfo): void\n+  onDebugInfo(debugInfo: DebugInfo): void\n+  onBeforeRefresh(): void\n+  onRefresh(): void\n+  onStaticIndicator(status: boolean): void\n+  onDevIndicator(devIndicator: DevIndicatorServerState): void\n+  onUnhandledError(reason: Error): void\n+  onUnhandledRejection(reason: Error): void\n+  openErrorOverlay(): void\n+  closeErrorOverlay(): void\n+  toggleErrorOverlay(): void\n+  buildingIndicatorHide(): void\n+  buildingIndicatorShow(): void\n+  renderingIndicatorHide(): void\n+  renderingIndicatorShow(): void\n+}\n+\n+type Dispatch = ReturnType<typeof useErrorOverlayReducer>[1]\n+let maybeDispatch: Dispatch | null = null\n+const queue: Array<(dispatch: Dispatch) => void> = []\n+\n+// Events might be dispatched before we get a `dispatch` from React (e.g. console.error during module eval).\n+// We need to queue them until we have a `dispatch` function available.\n+function createQueuable<Args extends any[]>(\n+  queueableFunction: (dispatch: Dispatch, ...args: Args) => void\n+) {\n+  return (...args: Args) => {\n+    if (maybeDispatch) {\n+      queueableFunction(maybeDispatch, ...args)\n+    } else {\n+      queue.push((dispatch: Dispatch) => {\n+        queueableFunction(dispatch, ...args)\n+      })\n+    }\n+  }\n+}\n+\n+// TODO: Extract into separate functions that are imported\n+export const dispatcher: Dispatcher = {\n+  onBuildOk: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_BUILD_OK })\n+  }),\n+  onBuildError: createQueuable((dispatch: Dispatch, message: string) => {\n+    dispatch({ type: ACTION_BUILD_ERROR, message })\n+  }),\n+  onBeforeRefresh: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_BEFORE_REFRESH })\n+  }),\n+  onRefresh: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_REFRESH })\n+  }),\n+  onVersionInfo: createQueuable(\n+    (dispatch: Dispatch, versionInfo: VersionInfo) => {\n+      dispatch({ type: ACTION_VERSION_INFO, versionInfo })\n+    }\n+  ),\n+  onStaticIndicator: createQueuable((dispatch: Dispatch, status: boolean) => {\n+    dispatch({ type: ACTION_STATIC_INDICATOR, staticIndicator: status })\n+  }),\n+  onDebugInfo: createQueuable((dispatch: Dispatch, debugInfo: DebugInfo) => {\n+    dispatch({ type: ACTION_DEBUG_INFO, debugInfo })\n+  }),\n+  onDevIndicator: createQueuable(\n+    (dispatch: Dispatch, devIndicator: DevIndicatorServerState) => {\n+      dispatch({ type: ACTION_DEV_INDICATOR, devIndicator })\n+    }\n+  ),\n+  onUnhandledError: createQueuable((dispatch: Dispatch, error: Error) => {\n+    dispatch({\n+      type: ACTION_UNHANDLED_ERROR,\n+      reason: error,\n+    })\n+  }),\n+  onUnhandledRejection: createQueuable((dispatch: Dispatch, error: Error) => {\n+    dispatch({\n+      type: ACTION_UNHANDLED_REJECTION,\n+      reason: error,\n+    })\n+  }),\n+  openErrorOverlay: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+  }),\n+  closeErrorOverlay: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n+  }),\n+  toggleErrorOverlay: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_ERROR_OVERLAY_TOGGLE })\n+  }),\n+  buildingIndicatorHide: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_BUILDING_INDICATOR_HIDE })\n+  }),\n+  buildingIndicatorShow: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_BUILDING_INDICATOR_SHOW })\n+  }),\n+  renderingIndicatorHide: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_RENDERING_INDICATOR_HIDE })\n+  }),\n+  renderingIndicatorShow: createQueuable((dispatch: Dispatch) => {\n+    dispatch({ type: ACTION_RENDERING_INDICATOR_SHOW })\n+  }),\n+}\n+\n+function replayQueuedEvents(dispatch: NonNullable<typeof maybeDispatch>) {\n+  try {\n+    for (const queuedFunction of queue) {\n+      queuedFunction(dispatch)\n+    }\n+  } finally {\n+    // TODO: What to do with failed events?\n+    queue.length = 0\n+  }\n+}\n+\n+function getSquashedHydrationErrorDetails() {\n+  // We don't squash hydration errors in the App Router.\n+  return null\n+}\n+\n+function AppDevOverlay({\n+  getComponentStack,\n+  getOwnerStack,\n+  isRecoverableError,\n+}: {\n+  getComponentStack: (error: Error) => string | undefined\n+  getOwnerStack: (error: Error) => string | null | undefined\n+  isRecoverableError: (error: Error) => boolean\n+}) {\n+  const [state, dispatch] = useErrorOverlayReducer(\n+    'app',\n+    getComponentStack,\n+    getOwnerStack,\n+    isRecoverableError\n+  )\n+\n+  useInsertionEffect(() => {\n+    maybeDispatch = dispatch\n+\n+    // Can't schedule updates from useInsertionEffect, so we need to defer.\n+    // Could move this into a passive Effect but we don't want replaying when\n+    // we reconnect.\n+    const replayTimeout = setTimeout(() => {\n+      replayQueuedEvents(dispatch)\n+    })\n+\n+    return () => {\n+      maybeDispatch = null\n+      clearTimeout(replayTimeout)\n+    }\n+  }, [])\n+\n+  return (\n+    <>\n+      {/* Fonts can only be loaded outside the Shadow DOM. */}\n+      <FontStyles />\n+      <DevOverlay\n+        state={state}\n+        dispatch={dispatch}\n+        getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+      />\n+    </>\n+  )\n+}\n+\n+let isMounted = false\n+export function renderAppDevOverlay(\n+  getComponentStack: (error: Error) => string | undefined,\n+  getOwnerStack: (error: Error) => string | null | undefined,\n+  isRecoverableError: (error: Error) => boolean\n+): void {\n+  if (!isMounted) {\n+    // React 19 will not throw away `<script>` elements in a container it owns.\n+    // This ensures the actual user-space React does not unmount the Dev Overlay.\n+    const script = document.createElement('script')\n+    script.style.display = 'block'\n+    // Although the style applied to the shadow host is isolated,\n+    // the element that attached the shadow host (i.e. \"script\")\n+    // is still affected by the parent's style (e.g. \"body\"). This may\n+    // occur style conflicts like \"display: flex\", with other children\n+    // elements therefore give the shadow host an absolute position.\n+    script.style.position = 'absolute'\n+    script.setAttribute('data-nextjs-dev-overlay', 'true')\n+\n+    const container = document.createElement('nextjs-portal')\n+\n+    script.appendChild(container)\n+    document.body.appendChild(script)\n+\n+    const root = createRoot(container, {\n+      identifierPrefix: 'ndt-',\n+    })\n+\n+    startTransition(() => {\n+      // TODO: Dedicated error boundary or root error callbacks?\n+      // At least it won't unmount any user code if it errors.\n+      root.render(\n+        <AppDevOverlay\n+          getComponentStack={getComponentStack}\n+          getOwnerStack={getOwnerStack}\n+          isRecoverableError={isRecoverableError}\n+        />\n+      )\n+    })\n+\n+    isMounted = true\n+  }\n+}"
        },
        {
            "sha": "ec08166e75be837dac3f202ea395a0d09f1b9fb5",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.shim.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.shim.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.shim.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.shim.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -0,0 +1,19 @@\n+export function renderAppDevOverlay() {\n+  throw new Error(\n+    \"Next DevTools: Can't render in this environment. This is a bug in Next.js\"\n+  )\n+}\n+\n+// TODO: Extract into separate functions that are imported\n+export const dispatcher = new Proxy(\n+  {},\n+  {\n+    get: (_, prop) => {\n+      return () => {\n+        throw new Error(\n+          `Next DevTools: Can't dispatch ${String(prop)} in this environment. This is a bug in Next.js`\n+        )\n+      }\n+    },\n+  }\n+)"
        },
        {
            "sha": "cd283fc724d96d829dad40fd2303e3f4a53a8211",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/9155c8ac3cf6160e6140033d0cefa07fbc23abdc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9155c8ac3cf6160e6140033d0cefa07fbc23abdc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=9155c8ac3cf6160e6140033d0cefa07fbc23abdc",
            "patch": "@@ -1,52 +0,0 @@\n-import {\n-  ACTION_ERROR_OVERLAY_OPEN,\n-  type OverlayDispatch,\n-  type OverlayState,\n-} from '../shared'\n-import type { GlobalErrorComponent } from '../../global-error'\n-\n-import { useCallback } from 'react'\n-import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'\n-import { FontStyles } from '../font/font-styles'\n-import { DevOverlay } from '../ui/dev-overlay'\n-\n-function getSquashedHydrationErrorDetails() {\n-  // We don't squash hydration errors in the App Router.\n-  return null\n-}\n-\n-export function AppDevOverlay({\n-  state,\n-  dispatch,\n-  globalError,\n-  children,\n-}: {\n-  state: OverlayState\n-  dispatch: OverlayDispatch\n-  globalError: [GlobalErrorComponent, React.ReactNode]\n-  children: React.ReactNode\n-}) {\n-  const openOverlay = useCallback(() => {\n-    dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n-  }, [dispatch])\n-\n-  return (\n-    <>\n-      <AppDevOverlayErrorBoundary\n-        globalError={globalError}\n-        onError={openOverlay}\n-      >\n-        {children}\n-      </AppDevOverlayErrorBoundary>\n-      <>\n-        {/* Fonts can only be loaded outside the Shadow DOM. */}\n-        <FontStyles />\n-        <DevOverlay\n-          state={state}\n-          dispatch={dispatch}\n-          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n-        />\n-      </>\n-    </>\n-  )\n-}"
        },
        {
            "sha": "678edbfa897aeb5eb10ab7ab1d45c94c22a23b4c",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/client-entry.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fclient-entry.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -4,8 +4,6 @@ import { HMR_ACTIONS_SENT_TO_BROWSER } from '../../../../server/dev/hot-reloader\n import GlobalError from '../../global-error'\n import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'\n \n-const noop = () => {}\n-\n // if an error is thrown while rendering an RSC stream, this will catch it in dev\n // and show the error overlay\n export function createRootLevelDevOverlayElement(reactEl: React.ReactElement) {\n@@ -31,10 +29,7 @@ export function createRootLevelDevOverlayElement(reactEl: React.ReactElement) {\n   socket.addEventListener('message', handler)\n \n   return (\n-    <AppDevOverlayErrorBoundary\n-      globalError={[GlobalError, null]}\n-      onError={noop}\n-    >\n+    <AppDevOverlayErrorBoundary globalError={[GlobalError, null]}>\n       {reactEl}\n     </AppDevOverlayErrorBoundary>\n   )"
        },
        {
            "sha": "4fb734ff93bee0be28f34d88aa3dd19c29366adb",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/entrypoint.d.ts",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.d.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -0,0 +1 @@\n+export * from './app-dev-overlay.browser'"
        },
        {
            "sha": "4fb734ff93bee0be28f34d88aa3dd19c29366adb",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/entrypoint.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fentrypoint.js?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -0,0 +1 @@\n+export * from './app-dev-overlay.browser'"
        },
        {
            "sha": "81f16db5560306afe198a0fcf4f0cdb4c30bdc0a",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 113,
            "changes": 123,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -1,30 +1,14 @@\n /// <reference types=\"webpack/module.d.ts\" />\n \n import type { ReactNode } from 'react'\n-import { useEffect, startTransition, useMemo, useRef } from 'react'\n+import { useEffect, startTransition, useRef } from 'react'\n import stripAnsi from 'next/dist/compiled/strip-ansi'\n import formatWebpackMessages from '../utils/format-webpack-messages'\n import { useRouter } from '../../navigation'\n-import {\n-  ACTION_BEFORE_REFRESH,\n-  ACTION_BUILDING_INDICATOR_HIDE,\n-  ACTION_BUILD_ERROR,\n-  ACTION_BUILD_OK,\n-  ACTION_BUILDING_INDICATOR_SHOW,\n-  ACTION_DEBUG_INFO,\n-  ACTION_DEV_INDICATOR,\n-  ACTION_ERROR_OVERLAY_OPEN,\n-  ACTION_REFRESH,\n-  ACTION_STATIC_INDICATOR,\n-  ACTION_UNHANDLED_ERROR,\n-  ACTION_UNHANDLED_REJECTION,\n-  ACTION_VERSION_INFO,\n-  REACT_REFRESH_FULL_RELOAD,\n-  reportInvalidHmrMessage,\n-  useErrorOverlayReducer,\n-} from '../shared'\n-import { AppDevOverlay } from './app-dev-overlay'\n+import { REACT_REFRESH_FULL_RELOAD, reportInvalidHmrMessage } from '../shared'\n+import { dispatcher } from 'next/dist/compiled/next-devtools'\n import { ReplaySsrOnlyErrors } from './replay-ssr-only-errors'\n+import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'\n import { useErrorHandler } from '../../errors/use-error-handler'\n import { RuntimeErrorHandler } from '../../errors/runtime-error-handler'\n import {\n@@ -33,38 +17,17 @@ import {\n   useWebsocket,\n   useWebsocketPing,\n } from '../utils/use-websocket'\n-import type { VersionInfo } from '../../../../server/dev/parse-version-info'\n import { HMR_ACTIONS_SENT_TO_BROWSER } from '../../../../server/dev/hot-reloader-types'\n import type {\n   HMR_ACTION_TYPES,\n   TurbopackMsgToBrowser,\n } from '../../../../server/dev/hot-reloader-types'\n import { REACT_REFRESH_FULL_RELOAD_FROM_ERROR } from '../shared'\n-import type { DebugInfo } from '../types'\n import { useUntrackedPathname } from '../../navigation-untracked'\n import type { GlobalErrorComponent } from '../../global-error'\n-import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n import reportHmrLatency from '../utils/report-hmr-latency'\n import { TurbopackHmr } from '../utils/turbopack-hot-reloader-common'\n import { NEXT_HMR_REFRESH_HASH_COOKIE } from '../../app-router-headers'\n-import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n-import { isRecoverableError } from '../../../react-client-callbacks/on-recoverable-error'\n-\n-export interface Dispatcher {\n-  onBuildOk(): void\n-  onBuildError(message: string): void\n-  onVersionInfo(versionInfo: VersionInfo): void\n-  onDebugInfo(debugInfo: DebugInfo): void\n-  onBeforeRefresh(): void\n-  onRefresh(): void\n-  onStaticIndicator(status: boolean): void\n-  onDevIndicator(devIndicator: DevIndicatorServerState): void\n-  onUnhandledError(error: Error): void\n-  onUnhandledRejection(error: Error): void\n-  openErrorOverlay(): void\n-  buildingIndicatorHide(): void\n-  buildingIndicatorShow(): void\n-}\n \n let mostRecentCompilationHash: any = null\n let __nextDevClientId = Math.round(Math.random() * 100 + Date.now())\n@@ -150,10 +113,7 @@ function performFullReload(err: any, sendMessage: any) {\n }\n \n // Attempt to update code on the fly, fall back to a hard reload.\n-function tryApplyUpdatesWebpack(\n-  sendMessage: (message: string) => void,\n-  dispatcher: Dispatcher\n-) {\n+function tryApplyUpdatesWebpack(sendMessage: (message: string) => void) {\n   if (!isUpdateAvailable() || !canApplyUpdates()) {\n     resolvePendingHotUpdateWebpack()\n     dispatcher.onBuildOk()\n@@ -179,7 +139,7 @@ function tryApplyUpdatesWebpack(\n \n     if (isUpdateAvailable()) {\n       // While we were updating, there was a new update! Do it again.\n-      tryApplyUpdatesWebpack(sendMessage, dispatcher)\n+      tryApplyUpdatesWebpack(sendMessage)\n       return\n     }\n \n@@ -233,7 +193,6 @@ function processMessage(\n   sendMessage: (message: string) => void,\n   processTurbopackMessage: (msg: TurbopackMsgToBrowser) => void,\n   router: ReturnType<typeof useRouter>,\n-  dispatcher: Dispatcher,\n   appIsrManifestRef: ReturnType<typeof useRef>,\n   pathnameRef: ReturnType<typeof useRef>\n ) {\n@@ -281,7 +240,7 @@ function processMessage(\n       }\n       dispatcher.onBuildOk()\n     } else {\n-      tryApplyUpdatesWebpack(sendMessage, dispatcher)\n+      tryApplyUpdatesWebpack(sendMessage)\n     }\n   }\n \n@@ -491,66 +450,6 @@ export default function HotReload({\n   children: ReactNode\n   globalError: [GlobalErrorComponent, React.ReactNode]\n }) {\n-  const [state, dispatch] = useErrorOverlayReducer(\n-    'app',\n-    getComponentStack,\n-    getOwnerStack,\n-    isRecoverableError\n-  )\n-\n-  const dispatcher = useMemo<Dispatcher>(() => {\n-    return {\n-      onBuildOk() {\n-        dispatch({ type: ACTION_BUILD_OK })\n-      },\n-      onBuildError(message) {\n-        dispatch({ type: ACTION_BUILD_ERROR, message })\n-      },\n-      onBeforeRefresh() {\n-        dispatch({ type: ACTION_BEFORE_REFRESH })\n-      },\n-      onRefresh() {\n-        dispatch({ type: ACTION_REFRESH })\n-      },\n-      onVersionInfo(versionInfo) {\n-        dispatch({ type: ACTION_VERSION_INFO, versionInfo })\n-      },\n-      onStaticIndicator(status: boolean) {\n-        dispatch({ type: ACTION_STATIC_INDICATOR, staticIndicator: status })\n-      },\n-      onDebugInfo(debugInfo) {\n-        dispatch({ type: ACTION_DEBUG_INFO, debugInfo })\n-      },\n-      onDevIndicator(devIndicator) {\n-        dispatch({\n-          type: ACTION_DEV_INDICATOR,\n-          devIndicator,\n-        })\n-      },\n-      onUnhandledError(error) {\n-        dispatch({\n-          type: ACTION_UNHANDLED_ERROR,\n-          reason: error,\n-        })\n-      },\n-      onUnhandledRejection(error) {\n-        dispatch({\n-          type: ACTION_UNHANDLED_REJECTION,\n-          reason: error,\n-        })\n-      },\n-      openErrorOverlay() {\n-        dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n-      },\n-      buildingIndicatorHide() {\n-        dispatch({ type: ACTION_BUILDING_INDICATOR_HIDE })\n-      },\n-      buildingIndicatorShow() {\n-        dispatch({ type: ACTION_BUILDING_INDICATOR_SHOW })\n-      },\n-    }\n-  }, [dispatch])\n-\n   useErrorHandler(dispatcher.onUnhandledError, dispatcher.onUnhandledRejection)\n \n   const webSocketRef = useWebsocket(assetPrefix)\n@@ -599,7 +498,7 @@ export default function HotReload({\n           dispatcher.onStaticIndicator(false)\n         }\n       }\n-    }, [pathname, dispatcher])\n+    }, [pathname])\n   }\n \n   useEffect(() => {\n@@ -614,7 +513,6 @@ export default function HotReload({\n           sendMessage,\n           processTurbopackMessage,\n           router,\n-          dispatcher,\n           appIsrManifestRef,\n           pathnameRef\n         )\n@@ -629,15 +527,14 @@ export default function HotReload({\n     sendMessage,\n     router,\n     webSocketRef,\n-    dispatcher,\n     processTurbopackMessage,\n     appIsrManifestRef,\n   ])\n \n   return (\n-    <AppDevOverlay state={state} dispatch={dispatch} globalError={globalError}>\n+    <AppDevOverlayErrorBoundary globalError={globalError}>\n       <ReplaySsrOnlyErrors onBlockingError={dispatcher.openErrorOverlay} />\n       {children}\n-    </AppDevOverlay>\n+    </AppDevOverlayErrorBoundary>\n   )\n }"
        },
        {
            "sha": "20e68fc55a1b90acb020fa3136e08a8fa75e1564",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/pages-dev-overlay.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -1,3 +1,4 @@\n+import { useInsertionEffect } from 'react'\n import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary'\n import { usePagesDevOverlay } from './hooks'\n import { FontStyles } from '../font/font-styles'\n@@ -15,6 +16,12 @@ interface PagesDevOverlayProps {\n export function PagesDevOverlay({ children }: PagesDevOverlayProps) {\n   const { state, dispatch } = usePagesDevOverlay()\n \n+  // TODO: Remove once Root initializer creates this element\n+  useInsertionEffect(() => {\n+    const container = document.createElement('nextjs-portal')\n+    document.body.appendChild(container)\n+  }, [])\n+\n   return (\n     <>\n       <PagesDevOverlayErrorBoundary>{children}</PagesDevOverlayErrorBoundary>"
        },
        {
            "sha": "11ee5a60164ce5a5613a703a3ee103c264af3836",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -23,6 +23,7 @@ export interface OverlayState {\n   versionInfo: VersionInfo\n   notFound: boolean\n   buildingIndicator: boolean\n+  renderingIndicator: boolean\n   staticIndicator: boolean\n   showIndicator: boolean\n   disableDevIndicator: boolean\n@@ -47,6 +48,8 @@ export const ACTION_ERROR_OVERLAY_CLOSE = 'error-overlay-close'\n export const ACTION_ERROR_OVERLAY_TOGGLE = 'error-overlay-toggle'\n export const ACTION_BUILDING_INDICATOR_SHOW = 'building-indicator-show'\n export const ACTION_BUILDING_INDICATOR_HIDE = 'building-indicator-hide'\n+export const ACTION_RENDERING_INDICATOR_SHOW = 'rendering-indicator-show'\n+export const ACTION_RENDERING_INDICATOR_HIDE = 'rendering-indicator-hide'\n \n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n@@ -112,6 +115,13 @@ export interface BuildingIndicatorHideAction {\n   type: typeof ACTION_BUILDING_INDICATOR_HIDE\n }\n \n+export interface RenderingIndicatorShowAction {\n+  type: typeof ACTION_RENDERING_INDICATOR_SHOW\n+}\n+export interface RenderingIndicatorHideAction {\n+  type: typeof ACTION_RENDERING_INDICATOR_HIDE\n+}\n+\n export type BusEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -128,6 +138,8 @@ export type BusEvent =\n   | ErrorOverlayToggleAction\n   | BuildingIndicatorShowAction\n   | BuildingIndicatorHideAction\n+  | RenderingIndicatorShowAction\n+  | RenderingIndicatorHideAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n@@ -153,6 +165,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   buildError: null,\n   errors: [],\n   notFound: false,\n+  renderingIndicator: false,\n   staticIndicator: false,\n   /* \n     This is set to `true` when we can reliably know\n@@ -315,6 +328,12 @@ export function useErrorOverlayReducer(\n       case ACTION_BUILDING_INDICATOR_HIDE: {\n         return { ...state, buildingIndicator: false }\n       }\n+      case ACTION_RENDERING_INDICATOR_SHOW: {\n+        return { ...state, renderingIndicator: true }\n+      }\n+      case ACTION_RENDERING_INDICATOR_HIDE: {\n+        return { ...state, renderingIndicator: false }\n+      }\n       default: {\n         return state\n       }"
        },
        {
            "sha": "50ed035aba30c5a5ddda1345bc78d68b9f1eb9c2",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -55,6 +55,7 @@ const state: OverlayState = {\n   versionInfo: mockVersionInfo,\n   notFound: false,\n   buildingIndicator: false,\n+  renderingIndicator: false,\n   staticIndicator: true,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   isErrorOverlayOpen: false,"
        },
        {
            "sha": "01b2ee4a91e58bb6876712ef9bf491a623fc3ef9",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -10,7 +10,6 @@ import {\n import { useState, useEffect, useRef, createContext, useContext } from 'react'\n import { Toast } from '../../toast'\n import { NextLogo } from './next-logo'\n-import { useIsDevRendering } from '../../../../utils/dev-indicator/dev-render-indicator'\n import { useDelayedRender } from '../../../hooks/use-delayed-render'\n import { TurbopackInfo } from './dev-tools-info/turbopack-info'\n import { RouteInfo } from './dev-tools-info/route-info'\n@@ -54,6 +53,7 @@ export function DevToolsIndicator({\n       semver={state.versionInfo.installed}\n       issueCount={errorCount}\n       isDevBuilding={state.buildingIndicator}\n+      isDevRendering={state.renderingIndicator}\n       isStaticRoute={state.staticIndicator}\n       hide={() => {\n         setIsDevToolsIndicatorVisible(false)\n@@ -96,6 +96,7 @@ function DevToolsPopover({\n   disabled,\n   issueCount,\n   isDevBuilding,\n+  isDevRendering,\n   isStaticRoute,\n   isTurbopack,\n   isBuildError,\n@@ -110,6 +111,7 @@ function DevToolsPopover({\n   isStaticRoute: boolean\n   semver: string | undefined\n   isDevBuilding: boolean\n+  isDevRendering: boolean\n   isTurbopack: boolean\n   isBuildError: boolean\n   hide: () => void\n@@ -297,7 +299,7 @@ function DevToolsPopover({\n           onTriggerClick={onTriggerClick}\n           toggleErrorOverlay={toggleErrorOverlay}\n           isDevBuilding={isDevBuilding}\n-          isDevRendering={useIsDevRendering()}\n+          isDevRendering={isDevRendering}\n           isBuildError={isBuildError}\n           scale={scale}\n         />"
        },
        {
            "sha": "f8c2432b793731fd43da51c4ae64b00782e087a3",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/shadow-portal.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fshadow-portal.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fshadow-portal.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fshadow-portal.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -13,7 +13,7 @@ export function ShadowPortal({ children }: { children: React.ReactNode }) {\n   // we can assure the root render is not a Transition.\n   React.useEffect(() => {\n     const ownerDocument = document\n-    portalNode.current = ownerDocument.createElement('nextjs-portal')\n+    portalNode.current = ownerDocument.querySelector('nextjs-portal')!\n     // load default color preference from localstorage\n     if (typeof localStorage !== 'undefined') {\n       const theme = localStorage.getItem(STORAGE_KEY_THEME)\n@@ -26,14 +26,15 @@ export function ShadowPortal({ children }: { children: React.ReactNode }) {\n       }\n     }\n \n-    shadowNode.current = portalNode.current.attachShadow({ mode: 'open' })\n-    ownerDocument.body.appendChild(portalNode.current)\n-    forceUpdate({})\n-    return () => {\n-      if (portalNode.current && portalNode.current.ownerDocument) {\n-        portalNode.current.ownerDocument.body.removeChild(portalNode.current)\n-      }\n+    // We can only attach but never detach a shadow root.\n+    // So if this is a remount, we don't need to attach a shadow root. Only\n+    // on the very first, DOM-wide mount.\n+    // This is mostly guarding against faulty _app implementations that\n+    // createa React Root in getInitialProps but don't clean it up like test/integration/app-tree/pages/_app.tsx\n+    if (portalNode.current.shadowRoot === null) {\n+      shadowNode.current = portalNode.current.attachShadow({ mode: 'open' })\n     }\n+    forceUpdate({})\n   }, [])\n \n   return shadowNode.current"
        },
        {
            "sha": "13f8b2167b1029869a6178d329634f941a14fa6c",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -74,6 +74,7 @@ const initialState: OverlayState = {\n   refreshState: { type: 'idle' },\n   notFound: false,\n   buildingIndicator: false,\n+  renderingIndicator: false,\n   staticIndicator: false,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   versionInfo: {"
        },
        {
            "sha": "61e2a4c2151fd46ef860ac9d3c1a8d0b38dfe486",
            "filename": "packages/next/src/client/components/react-dev-overlay/utils/dev-indicator/dev-render-indicator.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 37,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/9155c8ac3cf6160e6140033d0cefa07fbc23abdc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fdev-render-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/9155c8ac3cf6160e6140033d0cefa07fbc23abdc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fdev-render-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fdev-render-indicator.tsx?ref=9155c8ac3cf6160e6140033d0cefa07fbc23abdc",
            "patch": "@@ -1,37 +0,0 @@\n-/*\n- * Singleton store to track whether the app is currently being rendered\n- * Used by the dev tools indicator to show render status\n- */\n-\n-import { useSyncExternalStore } from 'react'\n-\n-let isVisible = false\n-let listeners: Array<() => void> = []\n-\n-const subscribe = (listener: () => void) => {\n-  listeners.push(listener)\n-  return () => {\n-    listeners = listeners.filter((l) => l !== listener)\n-  }\n-}\n-\n-const getSnapshot = () => isVisible\n-\n-const show = () => {\n-  isVisible = true\n-  listeners.forEach((listener) => listener())\n-}\n-\n-const hide = () => {\n-  isVisible = false\n-  listeners.forEach((listener) => listener())\n-}\n-\n-export function useIsDevRendering() {\n-  return useSyncExternalStore(subscribe, getSnapshot)\n-}\n-\n-export const devRenderIndicator = {\n-  show,\n-  hide,\n-}"
        },
        {
            "sha": "9e6e29edec163c6938643f9bd6eadfdc7d91960e",
            "filename": "packages/next/src/client/components/react-dev-overlay/utils/dev-indicator/use-app-dev-rendering-indicator.tsx",
            "status": "renamed",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fuse-app-dev-rendering-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fuse-app-dev-rendering-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fdev-indicator%2Fuse-app-dev-rendering-indicator.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -1,14 +1,14 @@\n import { useEffect, useTransition } from 'react'\n-import { devRenderIndicator } from './dev-render-indicator'\n+import { dispatcher } from 'next/dist/compiled/next-devtools'\n \n-export const useSyncDevRenderIndicator = () => {\n+export const useAppDevRenderingIndicator = () => {\n   const [isPending, startTransition] = useTransition()\n \n   useEffect(() => {\n     if (isPending) {\n-      devRenderIndicator.show()\n+      dispatcher.renderingIndicatorShow()\n     } else {\n-      devRenderIndicator.hide()\n+      dispatcher.renderingIndicatorHide()\n     }\n   }, [isPending])\n ",
            "previous_filename": "packages/next/src/client/components/react-dev-overlay/utils/dev-indicator/use-sync-dev-render-indicator.tsx"
        },
        {
            "sha": "fbb2d2469ba6dd3380542feb73a78811ef0f7d49",
            "filename": "packages/next/src/client/components/use-action-queue.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fuse-action-queue.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fuse-action-queue.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fuse-action-queue.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -35,14 +35,13 @@ export function useActionQueue(\n   // this is conceptually how we're modeling the app router state, despite the\n   // weird implementation details.\n   if (process.env.NODE_ENV !== 'production') {\n-    const useSyncDevRenderIndicator = (\n-      require('./react-dev-overlay/utils/dev-indicator/use-sync-dev-render-indicator') as typeof import('./react-dev-overlay/utils/dev-indicator/use-sync-dev-render-indicator')\n-    ).useSyncDevRenderIndicator\n+    const { useAppDevRenderingIndicator } =\n+      require('./react-dev-overlay/utils/dev-indicator/use-app-dev-rendering-indicator') as typeof import('./react-dev-overlay/utils/dev-indicator/use-app-dev-rendering-indicator')\n     // eslint-disable-next-line react-hooks/rules-of-hooks\n-    const syncDevRenderIndicator = useSyncDevRenderIndicator()\n+    const appDevRenderingIndicator = useAppDevRenderingIndicator()\n \n     dispatch = (action: ReducerActions) => {\n-      syncDevRenderIndicator(() => {\n+      appDevRenderingIndicator(() => {\n         actionQueue.dispatch(action, setState)\n       })\n     }"
        },
        {
            "sha": "e78d5ecaf0150ad82050c8aae04986ecdc62b845",
            "filename": "packages/next/src/client/index.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Findex.tsx?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -179,9 +179,7 @@ class Container extends React.Component<{\n     if (process.env.NODE_ENV === 'production') {\n       return this.props.children\n     } else {\n-      const {\n-        PagesDevOverlay,\n-      }: typeof import('./components/react-dev-overlay/pages/pages-dev-overlay') =\n+      const { PagesDevOverlay } =\n         require('./components/react-dev-overlay/pages/pages-dev-overlay') as typeof import('./components/react-dev-overlay/pages/pages-dev-overlay')\n       return <PagesDevOverlay>{this.props.children}</PagesDevOverlay>\n     }"
        },
        {
            "sha": "931a3b86f7c2014f0a7c20f113be59d90f130c06",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -3132,6 +3132,17 @@ export async function next_bundle_server(task, opts) {\n   })\n }\n \n+export async function next_bundle_devtools(task, opts) {\n+  await task.source('dist').webpack({\n+    watch: opts.dev,\n+    config: require('./next-devtools.webpack-config')({\n+      // TODO: Use prod variant\n+      dev: true,\n+    }),\n+    name: 'next-bundle-devtools-dev',\n+  })\n+}\n+\n export async function next_bundle(task, opts) {\n   await task.parallel(\n     [\n@@ -3152,6 +3163,8 @@ export async function next_bundle(task, opts) {\n       'next_bundle_pages_dev_turbo',\n       // builds the minimal server\n       'next_bundle_server',\n+      // devtools\n+      'next_bundle_devtools',\n     ],\n     opts\n   )"
        },
        {
            "sha": "f67de0d0e51151b961d5af6329fa532ec64dd5f1",
            "filename": "packages/next/tsconfig.json",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftsconfig.json?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -24,6 +24,11 @@\n       \"next/dist/compiled/@vercel/og/satori\": [\n         \"./src/compiled/@vercel/og/satori\"\n       ],\n+      // TODO: Enable types by telling Turbopack to ignore this alias.\n+      // tsconfig#paths are for type locations not source locations.\n+      // \"next/dist/compiled/next-devtools\": [\n+      //   \"./src/client/components/react-dev-overlay/app/entrypoint.d.ts\"\n+      // ],\n       \"next/dist/shared/lib/image-loader\": [\"./src/shared/lib/image-loader.ts\"]\n     }\n   },"
        },
        {
            "sha": "7263e99e08d3d29e1f40e90f44372d95def61fc3",
            "filename": "packages/next/types/$$compiled.internal.d.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -364,6 +364,9 @@ declare module 'next/dist/compiled/jest-worker' {\n   export * from 'jest-worker'\n }\n \n+// TODO: Use tsconfig#paths instead\n+declare module 'next/dist/compiled/next-devtools'\n+\n declare module 'next/dist/compiled/react-is' {\n   export * from 'react-is'\n }"
        },
        {
            "sha": "850068b97636e282a01174a64385ec9e71026039",
            "filename": "packages/next/types/compiled.d.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftypes%2Fcompiled.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/packages%2Fnext%2Ftypes%2Fcompiled.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftypes%2Fcompiled.d.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -2,6 +2,9 @@\n // it is not meant to be used with local type checking and is ignored in our\n // local tsconfig.json\n \n+// TODO: Use tsconfig#paths instead\n+declare module 'next/dist/compiled/next-devtools'\n+\n declare module 'next/dist/compiled/webpack/webpack' {\n   export function init(): void\n   export let BasicEvaluatedExpression: any"
        },
        {
            "sha": "cb7d8b6e53715132bda7bd1ab405a4922e32b27d",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -553,7 +553,7 @@ describe('ReactRefreshLogBox app', () => {\n       await session.evaluate(\n         () =>\n           document\n-            .querySelector('body > nextjs-portal')\n+            .querySelector('body nextjs-portal')\n             .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n             .length\n       )\n@@ -563,7 +563,7 @@ describe('ReactRefreshLogBox app', () => {\n         () =>\n           (\n             document\n-              .querySelector('body > nextjs-portal')\n+              .querySelector('body nextjs-portal')\n               .shadowRoot.querySelector(\n                 '#nextjs__container_errors_desc a:nth-of-type(1)'\n               ) as any\n@@ -635,7 +635,7 @@ describe('ReactRefreshLogBox app', () => {\n       await session.evaluate(\n         () =>\n           document\n-            .querySelector('body > nextjs-portal')\n+            .querySelector('body nextjs-portal')\n             .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n             .length\n       )\n@@ -645,7 +645,7 @@ describe('ReactRefreshLogBox app', () => {\n         () =>\n           (\n             document\n-              .querySelector('body > nextjs-portal')\n+              .querySelector('body nextjs-portal')\n               .shadowRoot.querySelector(\n                 '#nextjs__container_errors_desc a:nth-of-type(1)'\n               ) as any\n@@ -717,7 +717,7 @@ describe('ReactRefreshLogBox app', () => {\n       await session.evaluate(\n         () =>\n           document\n-            .querySelector('body > nextjs-portal')\n+            .querySelector('body nextjs-portal')\n             .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n             .length\n       )\n@@ -727,7 +727,7 @@ describe('ReactRefreshLogBox app', () => {\n         () =>\n           (\n             document\n-              .querySelector('body > nextjs-portal')\n+              .querySelector('body nextjs-portal')\n               .shadowRoot.querySelector(\n                 '#nextjs__container_errors_desc a:nth-of-type(1)'\n               ) as any\n@@ -800,7 +800,7 @@ describe('ReactRefreshLogBox app', () => {\n       await session.evaluate(\n         () =>\n           document\n-            .querySelector('body > nextjs-portal')\n+            .querySelector('body nextjs-portal')\n             .shadowRoot.querySelectorAll('#nextjs__container_errors_desc a')\n             .length\n       )\n@@ -810,7 +810,7 @@ describe('ReactRefreshLogBox app', () => {\n         () =>\n           (\n             document\n-              .querySelector('body > nextjs-portal')\n+              .querySelector('body nextjs-portal')\n               .shadowRoot.querySelector(\n                 '#nextjs__container_errors_desc a:nth-of-type(1)'\n               ) as any\n@@ -822,7 +822,7 @@ describe('ReactRefreshLogBox app', () => {\n         () =>\n           (\n             document\n-              .querySelector('body > nextjs-portal')\n+              .querySelector('body nextjs-portal')\n               .shadowRoot.querySelector(\n                 '#nextjs__container_errors_desc a:nth-of-type(2)'\n               ) as any"
        },
        {
            "sha": "95330dc5b706c7841de37788902e501f2ecc5dd5",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 40,
            "changes": 77,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -209,25 +209,23 @@ describe('Error overlay for hydration errors in App router', () => {\n        {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n-             <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n-                 <ReplaySsrOnlyErrors>\n-                 <DevRootHTTPAccessFallbackBoundary>\n-                   <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n-                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <Head>\n-                           <script>\n-                           <script>\n-                           <script>\n-                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                             <Root params={Promise}>\n-                               <html\n-       -                         className=\"server-html\"\n-                               >\n-                           ...\n-               ...\",\n+             <AppDevOverlayErrorBoundary globalError={[...]}>\n+               <ReplaySsrOnlyErrors>\n+               <DevRootHTTPAccessFallbackBoundary>\n+                 <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n+                   <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n+                     <RedirectBoundary>\n+                       <RedirectErrorBoundary router={{...}}>\n+                         <Head>\n+                         <script>\n+                         <script>\n+                         <script>\n+                         <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                           <Root params={Promise}>\n+                             <html\n+       -                       className=\"server-html\"\n+                             >\n+                         ...\",\n          \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Console Error\",\n@@ -245,22 +243,20 @@ describe('Error overlay for hydration errors in App router', () => {\n        {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n-             <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n-                 <ReplaySsrOnlyErrors>\n-                 <DevRootHTTPAccessFallbackBoundary>\n-                   <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n-                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <Head>\n-                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                             <Root params={Promise}>\n-                               <html\n-       -                         className=\"server-html\"\n-                               >\n-                           ...\n-               ...\",\n+             <AppDevOverlayErrorBoundary globalError={[...]}>\n+               <ReplaySsrOnlyErrors>\n+               <DevRootHTTPAccessFallbackBoundary>\n+                 <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n+                   <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n+                     <RedirectBoundary>\n+                       <RedirectErrorBoundary router={{...}}>\n+                         <Head>\n+                         <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                           <Root params={Promise}>\n+                             <html\n+       -                       className=\"server-html\"\n+                             >\n+                         ...\",\n          \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Console Error\",\n@@ -1044,9 +1040,11 @@ describe('Error overlay for hydration errors in App router', () => {\n        },\n        {\n          \"componentStack\": \"...\n-         <HotReload assetPrefix=\"\" globalError={[...]}>\n-           <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n-             <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n+         <Router actionQueue={{state:{...}, ...}} assetPrefix=\"\" globalError={[...]} gracefullyDegrade={false}>\n+           <HistoryUpdater>\n+           <RuntimeStyles>\n+           <HotReload assetPrefix=\"\" globalError={[...]}>\n+             <AppDevOverlayErrorBoundary globalError={[...]}>\n                <ReplaySsrOnlyErrors>\n                <DevRootHTTPAccessFallbackBoundary>\n                  <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n@@ -1059,8 +1057,7 @@ describe('Error overlay for hydration errors in App router', () => {\n                              <body>\n                              <Script src=\"https://ex...\" strategy=\"beforeInte...\">\n      >                         <script nonce={undefined} dangerouslySetInnerHTML={{__html:\"(self.__ne...\"}}>\n-                         ...\n-             ...\",\n+                         ...\",\n          \"description\": \"In HTML, <script> cannot be a child of <html>.\n      This will cause a hydration error.\",\n          \"environmentLabel\": null,"
        },
        {
            "sha": "4f8864aeda17d95b6e6dbb13f2e254b453adb630",
            "filename": "tsec-exemptions.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/tsec-exemptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0/tsec-exemptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/tsec-exemptions.json?ref=85c718fd65ef6f3947257e3095f4fb0fbe4ed1a0",
            "patch": "@@ -15,6 +15,9 @@\n     \"packages/next/src/client/app-bootstrap.ts\",\n     \"packages/next/src/client/components/errors/graceful-degrade-boundary.tsx\"\n   ],\n+  \"ban-script-appendchild-calls\": [\n+    \"packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.browser.tsx\"\n+  ],\n   \"ban-script-content-assignments\": [\"packages/next/src/client/script.tsx\"],\n   \"ban-script-src-assignments\": [\n     \"packages/next/src/client/script.tsx\","
        }
    ],
    "stats": {
        "total": 834,
        "additions": 548,
        "deletions": 286
    }
}