{
    "author": "ztanner",
    "message": "move segment cache entries to top level segment-cache dir (#85542)\n\nThis removes the indirection that was set up to codesplit on the client.\nBut now that there's only a single client cache entrypoint, we can\ndelete the indirection and move everything to a top-level export.",
    "sha": "567dc18b2388922c1e14f531159aa1bcc6cfce0a",
    "files": [
        {
            "sha": "2b2e3de20d11a535070c24a41b45a5de1a6ebbe6",
            "filename": "packages/next/src/client/app-dir/form.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Fform.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Fform.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Fform.tsx?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -19,7 +19,7 @@ import {\n   mountFormInstance,\n   unmountPrefetchableInstance,\n } from '../components/links'\n-import { FetchStrategy } from '../components/segment-cache'\n+import { FetchStrategy } from '../components/segment-cache/types'\n \n export type { FormProps }\n "
        },
        {
            "sha": "70ada0169015339e53ade6c539b505b18b0befc1",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -21,7 +21,7 @@ import { isLocalURL } from '../../shared/lib/router/utils/is-local-url'\n import {\n   FetchStrategy,\n   type PrefetchTaskFetchStrategy,\n-} from '../components/segment-cache'\n+} from '../components/segment-cache/types'\n import { errorOnce } from '../../shared/lib/utils/error-once'\n \n type Url = string | UrlObject"
        },
        {
            "sha": "598e9018e9806c7242bf29a9816836b79f62502e",
            "filename": "packages/next/src/client/components/app-router-instance.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -16,9 +16,9 @@ import { startTransition } from 'react'\n import { isThenable } from '../../shared/lib/is-thenable'\n import {\n   FetchStrategy,\n-  prefetch as prefetchWithSegmentCache,\n   type PrefetchTaskFetchStrategy,\n-} from './segment-cache'\n+} from './segment-cache/types'\n+import { prefetch as prefetchWithSegmentCache } from './segment-cache/prefetch'\n import { dispatchAppRouterAction } from './use-action-queue'\n import { addBasePath } from '../add-base-path'\n import { isExternalURL } from './app-router-utils'"
        },
        {
            "sha": "68d155c362456191cd71d6cf626e38fef03fc31b",
            "filename": "packages/next/src/client/components/links.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -2,17 +2,17 @@ import type { FlightRouterState } from '../../shared/lib/app-router-types'\n import type { AppRouterInstance } from '../../shared/lib/app-router-context.shared-runtime'\n import {\n   FetchStrategy,\n-  isPrefetchTaskDirty,\n   type PrefetchTaskFetchStrategy,\n-} from './segment-cache'\n-import { createCacheKey } from './segment-cache'\n+  PrefetchPriority,\n+} from './segment-cache/types'\n+import { createCacheKey } from './segment-cache/cache-key'\n import {\n   type PrefetchTask,\n-  PrefetchPriority,\n   schedulePrefetchTask as scheduleSegmentPrefetchTask,\n   cancelPrefetchTask,\n   reschedulePrefetchTask,\n-} from './segment-cache'\n+  isPrefetchTaskDirty,\n+} from './segment-cache/scheduler'\n import { startTransition } from 'react'\n \n type LinkElement = HTMLAnchorElement | SVGAElement"
        },
        {
            "sha": "8274c04d706da28294da739eb9f51c0efe6edc6d",
            "filename": "packages/next/src/client/components/router-reducer/fetch-server-response.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffetch-server-response.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -40,7 +40,7 @@ import {\n   getRenderedSearch,\n   urlToUrlWithoutFlightMarker,\n } from '../../route-params'\n-import type { NormalizedSearch } from '../segment-cache'\n+import type { NormalizedSearch } from '../segment-cache/cache-key'\n \n const createFromReadableStream =\n   createFromReadableStreamBrowser as (typeof import('react-server-dom-webpack/client.browser'))['createFromReadableStream']"
        },
        {
            "sha": "c4ba063bd1bc401f2fd8886ae70ab6942f57ceff",
            "filename": "packages/next/src/client/components/router-reducer/reducers/navigate-reducer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -13,10 +13,10 @@ import { handleMutable } from '../handle-mutable'\n \n import {\n   navigate as navigateUsingSegmentCache,\n-  NavigationResultTag,\n   type NavigationResult,\n-  getStaleTimeMs,\n-} from '../../segment-cache'\n+} from '../../segment-cache/navigation'\n+import { NavigationResultTag } from '../../segment-cache/types'\n+import { getStaleTimeMs } from '../../segment-cache/cache'\n \n // These values are set by `define-env-plugin` (based on `nextConfig.experimental.staleTimes`)\n // and default to 5 minutes (static) / 0 seconds (dynamic)"
        },
        {
            "sha": "0d9fb7581fac76192407e1bd69c933fbb64997c9",
            "filename": "packages/next/src/client/components/router-reducer/reducers/refresh-reducer.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -19,7 +19,7 @@ import { createEmptyCacheNode } from '../../app-router'\n import { handleSegmentMismatch } from '../handle-segment-mismatch'\n import { hasInterceptionRouteInCurrentTree } from './has-interception-route-in-current-tree'\n import { refreshInactiveParallelSegments } from '../refetch-inactive-parallel-segments'\n-import { revalidateEntireCache } from '../../segment-cache'\n+import { revalidateEntireCache } from '../../segment-cache/cache'\n \n export function refreshReducer(\n   state: ReadonlyReducerState,"
        },
        {
            "sha": "c2bf9892daa8086245257668106294a66a729c59",
            "filename": "packages/next/src/client/components/router-reducer/reducers/server-action-reducer.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -55,7 +55,7 @@ import {\n   extractInfoFromServerReferenceId,\n   omitUnusedArgs,\n } from '../../../../shared/lib/server-reference-info'\n-import { revalidateEntireCache } from '../../segment-cache'\n+import { revalidateEntireCache } from '../../segment-cache/cache'\n \n const createFromFetch =\n   createFromFetchBrowser as (typeof import('react-server-dom-webpack/client.browser'))['createFromFetch']"
        },
        {
            "sha": "0047b69f5123bbe009cdcb4a3eb143dfb2a944cd",
            "filename": "packages/next/src/client/components/segment-cache.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 151,
            "changes": 151,
            "blob_url": "https://github.com/vercel/next.js/blob/b57c8a16a38a6cc535fe348672ea790643413c1a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b57c8a16a38a6cc535fe348672ea790643413c1a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts?ref=b57c8a16a38a6cc535fe348672ea790643413c1a",
            "patch": "@@ -1,151 +0,0 @@\n-/**\n- * Entry point to the Segment Cache implementation.\n- *\n- * All code related to the Segment Cache lives `segment-cache-impl` directory.\n- * Callers access it through this indirection.\n- *\n- * This is to ensure the code is dead code eliminated from the bundle if the\n- * flag is disabled.\n- *\n- * TODO: This is super tedious. Since experimental flags are an essential part\n- * of our workflow, we should establish a better pattern for dead code\n- * elimination. Ideally it would be done at the bundler level, like how React's\n- * build process works. In the React repo, you don't even need to add any extra\n- * configuration per experiment â€” if the code is not reachable, it gets stripped\n- * from the build automatically by Rollup. Or, shorter term, we could stub out\n- * experimental modules at build time by updating the build config, i.e. a more\n- * automated version of what I'm doing manually in this file.\n- */\n-\n-export type { NavigationResult } from './segment-cache-impl/navigation'\n-export type { PrefetchTask } from './segment-cache-impl/scheduler'\n-export type {\n-  NormalizedPathname,\n-  NormalizedSearch,\n-} from './segment-cache-impl/cache-key'\n-\n-export const prefetch: typeof import('./segment-cache-impl/prefetch').prefetch =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/prefetch') as typeof import('./segment-cache-impl/prefetch')\n-    ).prefetch(...args)\n-  }\n-\n-export const navigate: typeof import('./segment-cache-impl/navigation').navigate =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/navigation') as typeof import('./segment-cache-impl/navigation')\n-    ).navigate(...args)\n-  }\n-\n-export const revalidateEntireCache: typeof import('./segment-cache-impl/cache').revalidateEntireCache =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/cache') as typeof import('./segment-cache-impl/cache')\n-    ).revalidateEntireCache(...args)\n-  }\n-\n-export const getCurrentCacheVersion: typeof import('./segment-cache-impl/cache').getCurrentCacheVersion =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/cache') as typeof import('./segment-cache-impl/cache')\n-    ).getCurrentCacheVersion(...args)\n-  }\n-\n-export const schedulePrefetchTask: typeof import('./segment-cache-impl/scheduler').schedulePrefetchTask =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/scheduler') as typeof import('./segment-cache-impl/scheduler')\n-    ).schedulePrefetchTask(...args)\n-  }\n-\n-export const cancelPrefetchTask: typeof import('./segment-cache-impl/scheduler').cancelPrefetchTask =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/scheduler') as typeof import('./segment-cache-impl/scheduler')\n-    ).cancelPrefetchTask(...args)\n-  }\n-\n-export const reschedulePrefetchTask: typeof import('./segment-cache-impl/scheduler').reschedulePrefetchTask =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/scheduler') as typeof import('./segment-cache-impl/scheduler')\n-    ).reschedulePrefetchTask(...args)\n-  }\n-\n-export const isPrefetchTaskDirty: typeof import('./segment-cache-impl/scheduler').isPrefetchTaskDirty =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/scheduler') as typeof import('./segment-cache-impl/scheduler')\n-    ).isPrefetchTaskDirty(...args)\n-  }\n-\n-export const createCacheKey: typeof import('./segment-cache-impl/cache-key').createCacheKey =\n-  function (...args) {\n-    return (\n-      require('./segment-cache-impl/cache-key') as typeof import('./segment-cache-impl/cache-key')\n-    ).createCacheKey(...args)\n-  }\n-\n-/**\n- * Below are public constants. They're small enough that we don't need to\n- * DCE them.\n- */\n-\n-export const enum NavigationResultTag {\n-  MPA,\n-  Success,\n-  NoOp,\n-  Async,\n-}\n-\n-/**\n- * The priority of the prefetch task. Higher numbers are higher priority.\n- */\n-export const enum PrefetchPriority {\n-  /**\n-   * Assigned to the most recently hovered/touched link. Special network\n-   * bandwidth is reserved for this task only. There's only ever one Intent-\n-   * priority task at a time; when a new Intent task is scheduled, the previous\n-   * one is bumped down to Default.\n-   */\n-  Intent = 2,\n-  /**\n-   * The default priority for prefetch tasks.\n-   */\n-  Default = 1,\n-  /**\n-   * Assigned to tasks when they spawn non-blocking background work, like\n-   * revalidating a partially cached entry to see if more data is available.\n-   */\n-  Background = 0,\n-}\n-\n-export const enum FetchStrategy {\n-  // Deliberately ordered so we can easily compare two segments\n-  // and determine if one segment is \"more specific\" than another\n-  // (i.e. if it's likely that it contains more data)\n-  LoadingBoundary = 0,\n-  PPR = 1,\n-  PPRRuntime = 2,\n-  Full = 3,\n-}\n-\n-/**\n- * A subset of fetch strategies used for prefetch tasks.\n- * A prefetch task can't know if it should use `PPR` or `LoadingBoundary`\n- * until we complete the initial tree prefetch request, so we use `PPR` to signal both cases\n- * and adjust it based on the route when actually fetching.\n- * */\n-export type PrefetchTaskFetchStrategy =\n-  | FetchStrategy.PPR\n-  | FetchStrategy.PPRRuntime\n-  | FetchStrategy.Full\n-\n-/**\n- * Ensures a minimum stale time of 30s to avoid issues where the server sends a too\n- * short-lived stale time, which would prevent anything from being prefetched.\n- */\n-export function getStaleTimeMs(staleTimeSeconds: number): number {\n-  return Math.max(staleTimeSeconds, 30) * 1000\n-}"
        },
        {
            "sha": "a8f1d53b5be4602fb109cf613961264139246e2f",
            "filename": "packages/next/src/client/components/segment-cache/cache-key.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-key.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-key.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-key.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/cache-key.ts"
        },
        {
            "sha": "159f3272a9444b6c13855193e7468bd06f1ee0d3",
            "filename": "packages/next/src/client/components/segment-cache/cache-map.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache-map.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/cache-map.ts"
        },
        {
            "sha": "7fde00c9a983e355adfb3253739fd0e1f75f60e6",
            "filename": "packages/next/src/client/components/segment-cache/cache.ts",
            "status": "renamed",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fcache.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -93,9 +93,17 @@ import {\n   DOC_PREFETCH_RANGE_HEADER_VALUE,\n   doesExportedHtmlMatchBuildId,\n } from '../../../shared/lib/segment-cache/output-export-prefetch-encoding'\n-import { FetchStrategy, getStaleTimeMs } from '../segment-cache'\n+import { FetchStrategy } from './types'\n import { createPromiseWithResolvers } from '../../../shared/lib/promise-with-resolvers'\n \n+/**\n+ * Ensures a minimum stale time of 30s to avoid issues where the server sends a too\n+ * short-lived stale time, which would prevent anything from being prefetched.\n+ */\n+export function getStaleTimeMs(staleTimeSeconds: number): number {\n+  return Math.max(staleTimeSeconds, 30) * 1000\n+}\n+\n // A note on async/await when working in the prefetch cache:\n //\n // Most async operations in the prefetch cache should *not* use async/await,",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/cache.ts"
        },
        {
            "sha": "d7d6d03479d98f56563e03f48d493309f191d690",
            "filename": "packages/next/src/client/components/segment-cache/lru.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Flru.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/lru.ts"
        },
        {
            "sha": "4d4d4c6fe5e9ad104875f6a429238775490b399d",
            "filename": "packages/next/src/client/components/segment-cache/navigation.ts",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fnavigation.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fnavigation.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fnavigation.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -28,7 +28,7 @@ import {\n } from './cache'\n import { createCacheKey } from './cache-key'\n import { addSearchParamsIfPageSegment } from '../../../shared/lib/segment'\n-import { NavigationResultTag } from '../segment-cache'\n+import { NavigationResultTag } from './types'\n \n type MPANavigationResult = {\n   tag: NavigationResultTag.MPA",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/navigation.ts"
        },
        {
            "sha": "298e7c1b70eab961fa724de4338466303ab4dab0",
            "filename": "packages/next/src/client/components/segment-cache/prefetch.ts",
            "status": "renamed",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fprefetch.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fprefetch.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fprefetch.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -2,10 +2,7 @@ import type { FlightRouterState } from '../../../shared/lib/app-router-types'\n import { createPrefetchURL } from '../app-router-utils'\n import { createCacheKey } from './cache-key'\n import { schedulePrefetchTask } from './scheduler'\n-import {\n-  PrefetchPriority,\n-  type PrefetchTaskFetchStrategy,\n-} from '../segment-cache'\n+import { PrefetchPriority, type PrefetchTaskFetchStrategy } from './types'\n \n /**\n  * Entrypoint for prefetching a URL into the Segment Cache.",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/prefetch.ts"
        },
        {
            "sha": "9885216b64f1b89b780de3ae8e11828672693138",
            "filename": "packages/next/src/client/components/segment-cache/scheduler.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fscheduler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fscheduler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Fscheduler.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -33,9 +33,9 @@ import { createCacheKey } from './cache-key'\n import {\n   FetchStrategy,\n   type PrefetchTaskFetchStrategy,\n-  getCurrentCacheVersion,\n   PrefetchPriority,\n-} from '../segment-cache'\n+} from './types'\n+import { getCurrentCacheVersion } from './cache'\n import {\n   addSearchParamsIfPageSegment,\n   PAGE_SEGMENT_KEY,",
            "previous_filename": "packages/next/src/client/components/segment-cache-impl/scheduler.ts"
        },
        {
            "sha": "09d00bf3d17ae5bcaf0c2c78d3ec8d4d0a65bd0b",
            "filename": "packages/next/src/client/components/segment-cache/types.ts",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache%2Ftypes.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -0,0 +1,53 @@\n+/**\n+ * Shared types and constants for the Segment Cache.\n+ */\n+\n+export const enum NavigationResultTag {\n+  MPA,\n+  Success,\n+  NoOp,\n+  Async,\n+}\n+\n+/**\n+ * The priority of the prefetch task. Higher numbers are higher priority.\n+ */\n+export const enum PrefetchPriority {\n+  /**\n+   * Assigned to the most recently hovered/touched link. Special network\n+   * bandwidth is reserved for this task only. There's only ever one Intent-\n+   * priority task at a time; when a new Intent task is scheduled, the previous\n+   * one is bumped down to Default.\n+   */\n+  Intent = 2,\n+  /**\n+   * The default priority for prefetch tasks.\n+   */\n+  Default = 1,\n+  /**\n+   * Assigned to tasks when they spawn non-blocking background work, like\n+   * revalidating a partially cached entry to see if more data is available.\n+   */\n+  Background = 0,\n+}\n+\n+export const enum FetchStrategy {\n+  // Deliberately ordered so we can easily compare two segments\n+  // and determine if one segment is \"more specific\" than another\n+  // (i.e. if it's likely that it contains more data)\n+  LoadingBoundary = 0,\n+  PPR = 1,\n+  PPRRuntime = 2,\n+  Full = 3,\n+}\n+\n+/**\n+ * A subset of fetch strategies used for prefetch tasks.\n+ * A prefetch task can't know if it should use `PPR` or `LoadingBoundary`\n+ * until we complete the initial tree prefetch request, so we use `PPR` to signal both cases\n+ * and adjust it based on the route when actually fetching.\n+ * */\n+export type PrefetchTaskFetchStrategy =\n+  | FetchStrategy.PPR\n+  | FetchStrategy.PPRRuntime\n+  | FetchStrategy.Full"
        },
        {
            "sha": "6dea5c8b0ed500501fc0017b6bf8cd7ba11aea4e",
            "filename": "packages/next/src/client/flight-data-helpers.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fflight-data-helpers.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Fflight-data-helpers.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fflight-data-helpers.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -9,7 +9,7 @@ import type {\n   InitialRSCPayload,\n } from '../shared/lib/app-router-types'\n import { PAGE_SEGMENT_KEY } from '../shared/lib/segment'\n-import type { NormalizedSearch } from './components/segment-cache'\n+import type { NormalizedSearch } from './components/segment-cache/cache-key'\n import {\n   getCacheKeyForDynamicParam,\n   parseDynamicParamFromURLPart,"
        },
        {
            "sha": "33a927010ac1204b68e69ee89c6c02c1617f6ba3",
            "filename": "packages/next/src/client/route-params.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Froute-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fclient%2Froute-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Froute-params.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -13,7 +13,7 @@ import {\n import type {\n   NormalizedPathname,\n   NormalizedSearch,\n-} from './components/segment-cache'\n+} from './components/segment-cache/cache-key'\n import type { RSCResponse } from './components/router-reducer/fetch-server-response'\n import type { ParsedUrlQuery } from 'querystring'\n "
        },
        {
            "sha": "21dcbeca6ed12fa44e0488962829553bc5f24a7d",
            "filename": "packages/next/src/shared/lib/segment-cache/segment-value-encoding.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fsegment-cache%2Fsegment-value-encoding.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/567dc18b2388922c1e14f531159aa1bcc6cfce0a/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fsegment-cache%2Fsegment-value-encoding.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fsegment-cache%2Fsegment-value-encoding.ts?ref=567dc18b2388922c1e14f531159aa1bcc6cfce0a",
            "patch": "@@ -1,6 +1,6 @@\n import { PAGE_SEGMENT_KEY } from '../segment'\n import type { Segment as FlightRouterStateSegment } from '../app-router-types'\n-import type { NormalizedPathname } from '../../../client/components/segment-cache'\n+import type { NormalizedPathname } from '../../../client/components/segment-cache/cache-key'\n \n // TypeScript trick to simulate opaque types, like in Flow.\n type Opaque<K, T> = T & { __brand: K }"
        }
    ],
    "stats": {
        "total": 261,
        "additions": 84,
        "deletions": 177
    }
}