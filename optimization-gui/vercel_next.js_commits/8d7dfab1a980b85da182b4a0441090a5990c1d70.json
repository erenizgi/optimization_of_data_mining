{
    "author": "lukesandberg",
    "message": "[turbopack[ Use the configured hasher to implementh Hash for AutoMap and AutoSet (#84542)\n\nShould be a small perf win.\n\nAlso, use `wrapping_add` instead of xor as our commutative operator.",
    "sha": "8d7dfab1a980b85da182b4a0441090a5990c1d70",
    "files": [
        {
            "sha": "2054dd33c9eb76542f817bc5734b56c82435a147",
            "filename": "turbopack/crates/turbo-tasks-auto-hash-map/src/map.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/8d7dfab1a980b85da182b4a0441090a5990c1d70/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fmap.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/8d7dfab1a980b85da182b4a0441090a5990c1d70/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fmap.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fmap.rs?ref=8d7dfab1a980b85da182b4a0441090a5990c1d70",
            "patch": "@@ -840,7 +840,9 @@ where\n {\n }\n \n-impl<K: Eq + Hash, V: Eq + Hash, MH: BuildHasher, const I: usize> Hash for AutoMap<K, V, MH, I> {\n+impl<K: Eq + Hash, V: Eq + Hash, MH: BuildHasher + Default, const I: usize> Hash\n+    for AutoMap<K, V, MH, I>\n+{\n     fn hash<H: std::hash::Hasher>(&self, state: &mut H) {\n         // Hash the length first to distinguish maps of different sizes\n         self.len().hash(state);\n@@ -849,17 +851,18 @@ impl<K: Eq + Hash, V: Eq + Hash, MH: BuildHasher, const I: usize> Hash for AutoM\n         // regardless of iteration order\n         let mut combined_hash = 0u64;\n \n+        let hash_builder = MH::default();\n         for (k, v) in self.iter() {\n-            use std::{collections::hash_map::DefaultHasher, hash::Hasher};\n+            use std::hash::Hasher;\n \n             // Hash each key-value pair independently\n-            let mut entry_hasher = DefaultHasher::new();\n+            let mut entry_hasher = hash_builder.build_hasher();\n             k.hash(&mut entry_hasher);\n             v.hash(&mut entry_hasher);\n             let entry_hash = entry_hasher.finish();\n \n-            // Combine using XOR to make it order-independent\n-            combined_hash ^= entry_hash;\n+            // Combine using addition to make it order-independent (wrapping_add is commutative)\n+            combined_hash = combined_hash.wrapping_add(entry_hash);\n         }\n \n         // Hash the combined result"
        },
        {
            "sha": "e879cdd400006451e7361869d0c32920911e6970",
            "filename": "turbopack/crates/turbo-tasks-auto-hash-map/src/set.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/8d7dfab1a980b85da182b4a0441090a5990c1d70/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/8d7dfab1a980b85da182b4a0441090a5990c1d70/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Fset.rs?ref=8d7dfab1a980b85da182b4a0441090a5990c1d70",
            "patch": "@@ -219,7 +219,7 @@ impl<K: Eq + Hash, H: BuildHasher, const I: usize> PartialEq for AutoSet<K, H, I\n \n impl<K: Eq + Hash, H: BuildHasher, const I: usize> Eq for AutoSet<K, H, I> {}\n \n-impl<K: Eq + Hash, SH: BuildHasher, const I: usize> Hash for AutoSet<K, SH, I> {\n+impl<K: Eq + Hash, SH: BuildHasher + Default, const I: usize> Hash for AutoSet<K, SH, I> {\n     fn hash<H: std::hash::Hasher>(&self, state: &mut H) {\n         self.map.hash(state);\n     }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 9,
        "deletions": 6
    }
}