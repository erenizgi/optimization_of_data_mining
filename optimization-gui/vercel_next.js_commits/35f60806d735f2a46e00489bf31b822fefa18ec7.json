{
    "author": "samselikoff",
    "message": "Re-enable legacyBehavior and passHref on Link (#84500)\n\nIn https://github.com/vercel/next.js/pull/83003, `legacyBehavior` and\n`passHref` were removed from `<Link>`. However, this turned out to be a\nbit premature—despite most usage being covered by the newer `<Link>`\nAPIs, there's some use cases we don't yet have good alternatives for.\n\nWe expect to solve this with an API that uses Fragment Refs once they're\navailable in React. For now, we're re-enabling these flags.\n\n---------\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "35f60806d735f2a46e00489bf31b822fefa18ec7",
    "files": [
        {
            "sha": "6524309942051757b0f3f46ab39662f9fa3ebfe8",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -983,6 +983,7 @@ async fn apply_vendored_react_aliases_server(\n         // This is used in the server runtime to import React Server Components.\n         alias.extend(fxindexmap! {\n             rcstr!(\"next/navigation\") => rcstr!(\"next/dist/api/navigation.react-server\"),\n+            rcstr!(\"next/link\") => rcstr!(\"next/dist/client/app-dir/link.react-server\"),\n         });\n     }\n \n@@ -1012,6 +1013,7 @@ async fn rsc_aliases(\n         // This is used in the server runtime to import React Server Components.\n         alias.extend(fxindexmap! {\n             rcstr!(\"next/navigation\") => rcstr!(\"next/dist/api/navigation.react-server\"),\n+            rcstr!(\"next/link\") => rcstr!(\"next/dist/client/app-dir/link.react-server\"),\n         });\n     }\n "
        },
        {
            "sha": "4bd7931befb7e55877dc36c4bdc18578f9665a32",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -860,5 +860,6 @@\n   \"859\": \"An IO error occurred while attempting to create and acquire the lockfile\",\n   \"860\": \"Client Max Body Size must be a valid number (bytes) or filesize format string (e.g., \\\"5mb\\\")\",\n   \"861\": \"Client Max Body Size must be larger than 0 bytes\",\n-  \"862\": \"Request body exceeded %s\"\n+  \"862\": \"Request body exceeded %s\",\n+  \"863\": \"\\\\`<Link legacyBehavior>\\\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\\\`<a>\\\\` tag.\"\n }"
        },
        {
            "sha": "acb8fc59c5741719eed6bffa69aff96995e22fe7",
            "filename": "packages/next/src/build/create-compiler-aliases.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fcreate-compiler-aliases.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -238,6 +238,7 @@ export function createAppRouterApiAliases(isServerOnlyLayer: boolean) {\n \n   if (isServerOnlyLayer) {\n     mapping['navigation'] = 'next/dist/api/navigation.react-server'\n+    mapping['link'] = 'next/dist/client/app-dir/link.react-server'\n   }\n \n   const aliasMap: Record<string, string> = {}"
        },
        {
            "sha": "a09afc043679bc4c7ec224c907a1fe5b5b10a2c7",
            "filename": "packages/next/src/client/app-dir/link.react-server.tsx",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.react-server.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.react-server.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.react-server.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,31 @@\n+import type { ComponentProps } from 'react'\n+import ClientLinkComponent, { type LinkProps, useLinkStatus } from './link'\n+\n+export default function LinkComponent(\n+  props: ComponentProps<typeof ClientLinkComponent>\n+) {\n+  const isLegacyBehavior = props.legacyBehavior\n+  const childIsHostComponent =\n+    typeof props.children === 'string' ||\n+    typeof props.children === 'number' ||\n+    typeof (props.children as any)?.type === 'string'\n+  const childIsClientComponent =\n+    (props.children as any)?.type?.$$typeof ===\n+    Symbol.for('react.client.reference')\n+\n+  if (isLegacyBehavior && !childIsHostComponent && !childIsClientComponent) {\n+    if ((props.children as any)?.type?.$$typeof === Symbol.for('react.lazy')) {\n+      console.error(\n+        `Using a Lazy Component as a direct child of \\`<Link legacyBehavior>\\` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's \\`<a>\\` tag.`\n+      )\n+    } else {\n+      console.error(\n+        `Using a Server Component as a direct child of \\`<Link legacyBehavior>\\` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's \\`<a>\\` tag.`\n+      )\n+    }\n+  }\n+\n+  return <ClientLinkComponent {...props} />\n+}\n+\n+export { type LinkProps, useLinkStatus }"
        },
        {
            "sha": "3e20ddc55f564e5ac0f62a98969fe02b4f80c7a7",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 180,
            "deletions": 28,
            "changes": 208,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -22,6 +22,7 @@ import {\n   FetchStrategy,\n   type PrefetchTaskFetchStrategy,\n } from '../components/segment-cache'\n+import { errorOnce } from '../../shared/lib/utils/error-once'\n \n type Url = string | UrlObject\n type RequiredKeys<T> = {\n@@ -110,6 +111,21 @@ type InternalLinkProps = {\n    */\n   shallow?: boolean\n \n+  /**\n+   * Forces `Link` to pass its `href` to the child component. Useful if the child is a custom\n+   * component that wraps an `<a>` tag, or if you're using certain styling libraries.\n+   *\n+   * @defaultValue `false`\n+   *\n+   * @example\n+   * ```tsx\n+   * <Link href=\"/dashboard\" passHref legacyBehavior>\n+   *   <MyStyledAnchor>Dashboard</MyStyledAnchor>\n+   * </Link>\n+   * ```\n+   */\n+  passHref?: boolean\n+\n   /**\n    * Prefetch the page in the background.\n    * Any `<Link />` that is in the viewport (initially or through scroll) will be prefetched.\n@@ -167,6 +183,15 @@ type InternalLinkProps = {\n    */\n   locale?: string | false\n \n+  /**\n+   * Enable legacy link behavior.\n+   *\n+   * @deprecated This will be removed in a future version\n+   * @defaultValue `false`\n+   * @see https://github.com/vercel/next.js/commit/489e65ed98544e69b0afd7e0cfc3f9f6c2b803b7\n+   */\n+  legacyBehavior?: boolean\n+\n   /**\n    * Optional event handler for when the mouse pointer is moved onto the `<Link>`.\n    */\n@@ -198,8 +223,8 @@ export type LinkProps<RouteInferType = any> = InternalLinkProps\n type LinkPropsRequired = RequiredKeys<LinkProps>\n type LinkPropsOptional = OptionalKeys<Omit<InternalLinkProps, 'locale'>>\n \n-function isModifiedEvent(event: React.MouseEvent<HTMLAnchorElement>): boolean {\n-  const eventTarget = event.currentTarget\n+function isModifiedEvent(event: React.MouseEvent): boolean {\n+  const eventTarget = event.currentTarget as HTMLAnchorElement | SVGAElement\n   const target = eventTarget.getAttribute('target')\n   return (\n     (target && target !== '_self') ||\n@@ -212,7 +237,7 @@ function isModifiedEvent(event: React.MouseEvent<HTMLAnchorElement>): boolean {\n }\n \n function linkClicked(\n-  e: React.MouseEvent<HTMLAnchorElement>,\n+  e: React.MouseEvent,\n   href: string,\n   as: string,\n   linkInstanceRef: React.RefObject<LinkInstance | null>,\n@@ -221,7 +246,14 @@ function linkClicked(\n   onNavigate?: OnNavigateEventHandler\n ): void {\n   if (typeof window !== 'undefined') {\n-    if (isModifiedEvent(e) || e.currentTarget.hasAttribute('download')) {\n+    const { nodeName } = e.currentTarget\n+\n+    // anchors inside an svg have a lowercase nodeName\n+    const isAnchorNodeName = nodeName.toUpperCase() === 'A'\n+    if (\n+      (isAnchorNodeName && isModifiedEvent(e)) ||\n+      e.currentTarget.hasAttribute('download')\n+    ) {\n       // ignore click for browser’s default behavior\n       return\n     }\n@@ -294,25 +326,38 @@ export default function LinkComponent(\n ) {\n   const [linkStatus, setOptimisticLinkStatus] = useOptimistic(IDLE_LINK_STATUS)\n \n+  let children: React.ReactNode\n+\n   const linkInstanceRef = useRef<LinkInstance | null>(null)\n \n   const {\n     href: hrefProp,\n     as: asProp,\n-    children,\n+    children: childrenProp,\n     prefetch: prefetchProp = null,\n+    passHref,\n     replace,\n     shallow,\n     scroll,\n     onClick,\n     onMouseEnter: onMouseEnterProp,\n     onTouchStart: onTouchStartProp,\n+    legacyBehavior = false,\n     onNavigate,\n     ref: forwardedRef,\n     unstable_dynamicOnHover,\n     ...restProps\n   } = props\n \n+  children = childrenProp\n+\n+  if (\n+    legacyBehavior &&\n+    (typeof children === 'string' || typeof children === 'number')\n+  ) {\n+    children = <a>{children}</a>\n+  }\n+\n   const router = React.useContext(AppRouterContext)\n \n   const prefetchEnabled = prefetchProp !== false\n@@ -369,11 +414,13 @@ export default function LinkComponent(\n       replace: true,\n       scroll: true,\n       shallow: true,\n+      passHref: true,\n       prefetch: true,\n       unstable_dynamicOnHover: true,\n       onClick: true,\n       onMouseEnter: true,\n       onTouchStart: true,\n+      legacyBehavior: true,\n       onNavigate: true,\n     } as const\n     const optionalProps: LinkPropsOptional[] = Object.keys(\n@@ -407,6 +454,8 @@ export default function LinkComponent(\n         key === 'replace' ||\n         key === 'scroll' ||\n         key === 'shallow' ||\n+        key === 'passHref' ||\n+        key === 'legacyBehavior' ||\n         key === 'unstable_dynamicOnHover'\n       ) {\n         if (props[key] != null && valType !== 'boolean') {\n@@ -476,20 +525,64 @@ export default function LinkComponent(\n     }\n   }, [hrefProp, asProp])\n \n-  if (process.env.NODE_ENV === 'development') {\n-    if ((children as any)?.type === 'a') {\n+  // This will return the first child, if multiple are provided it will throw an error\n+  let child: any\n+  if (legacyBehavior) {\n+    if ((children as any)?.$$typeof === Symbol.for('react.lazy')) {\n       throw new Error(\n-        'Invalid <Link> with <a> child. Please remove <a>.\\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor'\n+        `\\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.`\n       )\n     }\n+\n+    if (process.env.NODE_ENV === 'development') {\n+      if (onClick) {\n+        console.warn(\n+          `\"onClick\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onClick be set on the child of next/link`\n+        )\n+      }\n+      if (onMouseEnterProp) {\n+        console.warn(\n+          `\"onMouseEnter\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onMouseEnter be set on the child of next/link`\n+        )\n+      }\n+      try {\n+        child = React.Children.only(children)\n+      } catch (err) {\n+        if (!children) {\n+          throw new Error(\n+            `No children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but one child is required https://nextjs.org/docs/messages/link-no-children`\n+          )\n+        }\n+        throw new Error(\n+          `Multiple children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children` +\n+            (typeof window !== 'undefined'\n+              ? \" \\nOpen your browser's console to view the Component stack trace.\"\n+              : '')\n+        )\n+      }\n+    } else {\n+      child = React.Children.only(children)\n+    }\n+  } else {\n+    if (process.env.NODE_ENV === 'development') {\n+      if ((children as any)?.type === 'a') {\n+        throw new Error(\n+          'Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>.\\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor'\n+        )\n+      }\n+    }\n   }\n \n+  const childRef: any = legacyBehavior\n+    ? child && typeof child === 'object' && child.ref\n+    : forwardedRef\n+\n   // Use a callback ref to attach an IntersectionObserver to the anchor tag on\n   // mount. In the future we will also use this to keep track of all the\n   // currently mounted <Link> instances, e.g. so we can re-prefetch them after\n   // a revalidation or refresh.\n   const observeLinkVisibilityOnMount = React.useCallback(\n-    (element: HTMLAnchorElement) => {\n+    (element: HTMLAnchorElement | SVGAElement) => {\n       if (router !== null) {\n         linkInstanceRef.current = mountLinkInstance(\n           element,\n@@ -512,76 +605,135 @@ export default function LinkComponent(\n     [prefetchEnabled, href, router, fetchStrategy, setOptimisticLinkStatus]\n   )\n \n-  const mergedRef = useMergedRef(observeLinkVisibilityOnMount, forwardedRef)\n+  const mergedRef = useMergedRef(observeLinkVisibilityOnMount, childRef)\n \n-  const anchorProps: React.DetailedHTMLProps<\n-    React.AnchorHTMLAttributes<HTMLAnchorElement>,\n-    HTMLAnchorElement\n-  > = {\n+  const childProps: {\n+    onTouchStart?: React.TouchEventHandler<HTMLAnchorElement>\n+    onMouseEnter: React.MouseEventHandler<HTMLAnchorElement>\n+    onClick: React.MouseEventHandler<HTMLAnchorElement>\n+    href?: string\n+    ref?: any\n+  } = {\n     ref: mergedRef,\n     onClick(e) {\n-      if (typeof onClick === 'function') {\n+      if (process.env.NODE_ENV !== 'production') {\n+        if (!e) {\n+          throw new Error(\n+            `Component rendered inside next/link has to pass click event to \"onClick\" prop.`\n+          )\n+        }\n+      }\n+\n+      if (!legacyBehavior && typeof onClick === 'function') {\n         onClick(e)\n       }\n \n+      if (\n+        legacyBehavior &&\n+        child.props &&\n+        typeof child.props.onClick === 'function'\n+      ) {\n+        child.props.onClick(e)\n+      }\n+\n       if (!router) {\n         return\n       }\n-\n       if (e.defaultPrevented) {\n         return\n       }\n-\n       linkClicked(e, href, as, linkInstanceRef, replace, scroll, onNavigate)\n     },\n     onMouseEnter(e) {\n-      if (typeof onMouseEnterProp === 'function') {\n+      if (!legacyBehavior && typeof onMouseEnterProp === 'function') {\n         onMouseEnterProp(e)\n       }\n \n+      if (\n+        legacyBehavior &&\n+        child.props &&\n+        typeof child.props.onMouseEnter === 'function'\n+      ) {\n+        child.props.onMouseEnter(e)\n+      }\n+\n       if (!router) {\n         return\n       }\n-\n       if (!prefetchEnabled || process.env.NODE_ENV === 'development') {\n         return\n       }\n \n       const upgradeToDynamicPrefetch = unstable_dynamicOnHover === true\n-      onNavigationIntent(e.currentTarget, upgradeToDynamicPrefetch)\n+      onNavigationIntent(\n+        e.currentTarget as HTMLAnchorElement | SVGAElement,\n+        upgradeToDynamicPrefetch\n+      )\n     },\n     onTouchStart: process.env.__NEXT_LINK_NO_TOUCH_START\n       ? undefined\n       : function onTouchStart(e) {\n-          if (typeof onTouchStartProp === 'function') {\n+          if (!legacyBehavior && typeof onTouchStartProp === 'function') {\n             onTouchStartProp(e)\n           }\n \n+          if (\n+            legacyBehavior &&\n+            child.props &&\n+            typeof child.props.onTouchStart === 'function'\n+          ) {\n+            child.props.onTouchStart(e)\n+          }\n+\n           if (!router) {\n             return\n           }\n-\n           if (!prefetchEnabled) {\n             return\n           }\n \n           const upgradeToDynamicPrefetch = unstable_dynamicOnHover === true\n-          onNavigationIntent(e.currentTarget, upgradeToDynamicPrefetch)\n+          onNavigationIntent(\n+            e.currentTarget as HTMLAnchorElement | SVGAElement,\n+            upgradeToDynamicPrefetch\n+          )\n         },\n   }\n \n   // If the url is absolute, we can bypass the logic to prepend the basePath.\n   if (isAbsoluteUrl(as)) {\n-    anchorProps.href = as\n+    childProps.href = as\n+  } else if (\n+    !legacyBehavior ||\n+    passHref ||\n+    (child.type === 'a' && !('href' in child.props))\n+  ) {\n+    childProps.href = addBasePath(as)\n+  }\n+\n+  let link: React.ReactNode\n+\n+  if (legacyBehavior) {\n+    if (process.env.NODE_ENV === 'development') {\n+      errorOnce(\n+        '`legacyBehavior` is deprecated and will be removed in a future ' +\n+          'release. A codemod is available to upgrade your components:\\n\\n' +\n+          'npx @next/codemod@latest new-link .\\n\\n' +\n+          'Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components'\n+      )\n+    }\n+    link = React.cloneElement(child, childProps)\n   } else {\n-    anchorProps.href = addBasePath(as)\n+    link = (\n+      <a {...restProps} {...childProps}>\n+        {children}\n+      </a>\n+    )\n   }\n \n   return (\n     <LinkStatusContext.Provider value={linkStatus}>\n-      <a {...restProps} {...anchorProps}>\n-        {children}\n-      </a>\n+      {link}\n     </LinkStatusContext.Provider>\n   )\n }"
        },
        {
            "sha": "fd2606d24c191c0cfefb82e2d79a7f41646d9efa",
            "filename": "packages/next/src/client/components/links.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -17,7 +17,9 @@ import { startTransition } from 'react'\n import { PrefetchKind } from './router-reducer/router-reducer-types'\n import { InvariantError } from '../../shared/lib/invariant-error'\n \n-type Element = HTMLAnchorElement | HTMLFormElement\n+type LinkElement = HTMLAnchorElement | SVGAElement\n+\n+type Element = LinkElement | HTMLFormElement\n \n // Properties that are shared between Link and Form instances. We use the same\n // shape for both to prevent a polymorphic de-opt in the VM.\n@@ -145,7 +147,7 @@ function coercePrefetchableUrl(href: string): URL | null {\n }\n \n export function mountLinkInstance(\n-  element: HTMLAnchorElement,\n+  element: LinkElement,\n   href: string,\n   router: AppRouterInstance,\n   fetchStrategy: PrefetchTaskFetchStrategy,\n@@ -255,7 +257,7 @@ export function onLinkVisibilityChanged(element: Element, isVisible: boolean) {\n }\n \n export function onNavigationIntent(\n-  element: HTMLAnchorElement,\n+  element: HTMLAnchorElement | SVGAElement,\n   unstable_upgradeToDynamicPrefetch: boolean\n ) {\n   const instance = prefetchable.get(element)"
        },
        {
            "sha": "8b938db06167c3c1edf2ddbbcd048c9286962ddf",
            "filename": "packages/next/src/client/link.tsx",
            "status": "modified",
            "additions": 157,
            "deletions": 26,
            "changes": 183,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -18,6 +18,7 @@ import { useIntersection } from './use-intersection'\n import { getDomainLocale } from './get-domain-locale'\n import { addBasePath } from './add-base-path'\n import { useMergedRef } from './use-merged-ref'\n+import { errorOnce } from '../shared/lib/utils/error-once'\n \n type Url = string | UrlObject\n type RequiredKeys<T> = {\n@@ -60,6 +61,12 @@ type InternalLinkProps = {\n    * @defaultValue `false`\n    */\n   shallow?: boolean\n+  /**\n+   * Forces `Link` to send the `href` property to its child.\n+   *\n+   * @defaultValue `false`\n+   */\n+  passHref?: boolean\n   /**\n    * Prefetch the page in the background.\n    * Any `<Link />` that is in the viewport (initially or through scroll) will be prefetched.\n@@ -82,6 +89,14 @@ type InternalLinkProps = {\n    * Note: This is only available in the Pages Router.\n    */\n   locale?: string | false\n+  /**\n+   * Enable legacy link behavior.\n+   *\n+   * @deprecated This will be removed in a future version\n+   * @defaultValue `false`\n+   * @see https://github.com/vercel/next.js/commit/489e65ed98544e69b0afd7e0cfc3f9f6c2b803b7\n+   */\n+  legacyBehavior?: boolean\n   /**\n    * Optional event handler for when the mouse pointer is moved onto Link\n    */\n@@ -173,7 +188,7 @@ function prefetch(\n }\n \n function isModifiedEvent(event: React.MouseEvent): boolean {\n-  const eventTarget = event.currentTarget as HTMLAnchorElement\n+  const eventTarget = event.currentTarget as HTMLAnchorElement | SVGAElement\n   const target = eventTarget.getAttribute('target')\n   return (\n     (target && target !== '_self') ||\n@@ -196,7 +211,15 @@ function linkClicked(\n   locale?: string | false,\n   onNavigate?: OnNavigateEventHandler\n ): void {\n-  if (isModifiedEvent(e) || e.currentTarget.hasAttribute('download')) {\n+  const { nodeName } = e.currentTarget\n+\n+  // anchors inside an svg have a lowercase nodeName\n+  const isAnchorNodeName = nodeName.toUpperCase() === 'A'\n+\n+  if (\n+    (isAnchorNodeName && isModifiedEvent(e)) ||\n+    e.currentTarget.hasAttribute('download')\n+  ) {\n     // ignore click for browser’s default behavior\n     return\n   }\n@@ -271,11 +294,14 @@ function formatStringOrUrl(urlObjOrString: UrlObject | string): string {\n  */\n const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n   function LinkComponent(props, forwardedRef) {\n+    let children: React.ReactNode\n+\n     const {\n       href: hrefProp,\n       as: asProp,\n-      children,\n+      children: childrenProp,\n       prefetch: prefetchProp = null,\n+      passHref,\n       replace,\n       shallow,\n       scroll,\n@@ -284,9 +310,19 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n       onNavigate,\n       onMouseEnter: onMouseEnterProp,\n       onTouchStart: onTouchStartProp,\n+      legacyBehavior = false,\n       ...restProps\n     } = props\n \n+    children = childrenProp\n+\n+    if (\n+      legacyBehavior &&\n+      (typeof children === 'string' || typeof children === 'number')\n+    ) {\n+      children = <a>{children}</a>\n+    }\n+\n     const router = React.useContext(RouterContext)\n \n     const prefetchEnabled = prefetchProp !== false\n@@ -338,11 +374,13 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n         replace: true,\n         scroll: true,\n         shallow: true,\n+        passHref: true,\n         prefetch: true,\n         locale: true,\n         onClick: true,\n         onMouseEnter: true,\n         onTouchStart: true,\n+        legacyBehavior: true,\n         onNavigate: true,\n       } as const\n       const optionalProps: LinkPropsOptional[] = Object.keys(\n@@ -380,7 +418,13 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n               actual: valType,\n             })\n           }\n-        } else if (key === 'replace' || key === 'scroll' || key === 'shallow') {\n+        } else if (\n+          key === 'replace' ||\n+          key === 'scroll' ||\n+          key === 'shallow' ||\n+          key === 'passHref' ||\n+          key === 'legacyBehavior'\n+        ) {\n           if (props[key] != null && valType !== 'boolean') {\n             throw createPropError({\n               key,\n@@ -428,21 +472,57 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n     const previousHref = React.useRef<string>(href)\n     const previousAs = React.useRef<string>(as)\n \n-    if (process.env.NODE_ENV === 'development') {\n-      if ((children as any)?.type === 'a') {\n-        throw new Error(\n-          'Invalid <Link> with <a> child. Please remove <a>.\\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor'\n-        )\n+    // This will return the first child, if multiple are provided it will throw an error\n+    let child: any\n+    if (legacyBehavior) {\n+      if (process.env.NODE_ENV === 'development') {\n+        if (onClick) {\n+          console.warn(\n+            `\"onClick\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onClick be set on the child of next/link`\n+          )\n+        }\n+        if (onMouseEnterProp) {\n+          console.warn(\n+            `\"onMouseEnter\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onMouseEnter be set on the child of next/link`\n+          )\n+        }\n+        try {\n+          child = React.Children.only(children)\n+        } catch (err) {\n+          if (!children) {\n+            throw new Error(\n+              `No children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but one child is required https://nextjs.org/docs/messages/link-no-children`\n+            )\n+          }\n+          throw new Error(\n+            `Multiple children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children` +\n+              (typeof window !== 'undefined'\n+                ? \" \\nOpen your browser's console to view the Component stack trace.\"\n+                : '')\n+          )\n+        }\n+      } else {\n+        child = React.Children.only(children)\n+      }\n+    } else {\n+      if (process.env.NODE_ENV === 'development') {\n+        if ((children as any)?.type === 'a') {\n+          throw new Error(\n+            'Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>.\\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor'\n+          )\n+        }\n       }\n     }\n \n-    const [setIntersectionRef, isVisible, resetVisible] =\n-      useIntersection<HTMLAnchorElement>({\n-        rootMargin: '200px',\n-      })\n+    const childRef: any = legacyBehavior\n+      ? child && typeof child === 'object' && child.ref\n+      : forwardedRef\n \n+    const [setIntersectionRef, isVisible, resetVisible] = useIntersection({\n+      rootMargin: '200px',\n+    })\n     const setIntersectionWithResetRef = React.useCallback(\n-      (el: HTMLAnchorElement | null) => {\n+      (el: Element | null) => {\n         // Before the link getting observed, check if visible state need to be reset\n         if (previousAs.current !== as || previousHref.current !== href) {\n           resetVisible()\n@@ -455,7 +535,7 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n       [as, href, resetVisible, setIntersectionRef]\n     )\n \n-    const setRef = useMergedRef(setIntersectionWithResetRef, forwardedRef)\n+    const setRef = useMergedRef(setIntersectionWithResetRef, childRef)\n \n     // Prefetch the URL if we haven't already and it's visible.\n     React.useEffect(() => {\n@@ -477,16 +557,35 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n       prefetch(router, href, as, { locale })\n     }, [as, href, isVisible, locale, prefetchEnabled, router?.locale, router])\n \n-    const anchorProps: React.DetailedHTMLProps<\n-      React.AnchorHTMLAttributes<HTMLAnchorElement>,\n-      HTMLAnchorElement\n-    > = {\n+    const childProps: {\n+      onTouchStart?: React.TouchEventHandler<HTMLAnchorElement>\n+      onMouseEnter: React.MouseEventHandler<HTMLAnchorElement>\n+      onClick: React.MouseEventHandler<HTMLAnchorElement>\n+      href?: string\n+      ref?: any\n+    } = {\n       ref: setRef,\n       onClick(e) {\n-        if (typeof onClick === 'function') {\n+        if (process.env.NODE_ENV !== 'production') {\n+          if (!e) {\n+            throw new Error(\n+              `Component rendered inside next/link has to pass click event to \"onClick\" prop.`\n+            )\n+          }\n+        }\n+\n+        if (!legacyBehavior && typeof onClick === 'function') {\n           onClick(e)\n         }\n \n+        if (\n+          legacyBehavior &&\n+          child.props &&\n+          typeof child.props.onClick === 'function'\n+        ) {\n+          child.props.onClick(e)\n+        }\n+\n         if (!router) {\n           return\n         }\n@@ -508,10 +607,18 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n         )\n       },\n       onMouseEnter(e) {\n-        if (typeof onMouseEnterProp === 'function') {\n+        if (!legacyBehavior && typeof onMouseEnterProp === 'function') {\n           onMouseEnterProp(e)\n         }\n \n+        if (\n+          legacyBehavior &&\n+          child.props &&\n+          typeof child.props.onMouseEnter === 'function'\n+        ) {\n+          child.props.onMouseEnter(e)\n+        }\n+\n         if (!router) {\n           return\n         }\n@@ -526,10 +633,18 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n       onTouchStart: process.env.__NEXT_LINK_NO_TOUCH_START\n         ? undefined\n         : function onTouchStart(e) {\n-            if (typeof onTouchStartProp === 'function') {\n+            if (!legacyBehavior && typeof onTouchStartProp === 'function') {\n               onTouchStartProp(e)\n             }\n \n+            if (\n+              legacyBehavior &&\n+              child.props &&\n+              typeof child.props.onTouchStart === 'function'\n+            ) {\n+              child.props.onTouchStart(e)\n+            }\n+\n             if (!router) {\n               return\n             }\n@@ -545,8 +660,12 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n \n     // If the url is absolute, we can bypass the logic to prepend the domain and locale.\n     if (isAbsoluteUrl(as)) {\n-      anchorProps.href = as\n-    } else {\n+      childProps.href = as\n+    } else if (\n+      !legacyBehavior ||\n+      passHref ||\n+      (child.type === 'a' && !('href' in child.props))\n+    ) {\n       const curLocale = typeof locale !== 'undefined' ? locale : router?.locale\n \n       // we only render domain locales if we are currently on a domain locale\n@@ -555,13 +674,25 @@ const Link = React.forwardRef<HTMLAnchorElement, LinkPropsReal>(\n         router?.isLocaleDomain &&\n         getDomainLocale(as, curLocale, router?.locales, router?.domainLocales)\n \n-      anchorProps.href =\n+      childProps.href =\n         localeDomain ||\n         addBasePath(addLocale(as, curLocale, router?.defaultLocale))\n     }\n \n+    if (legacyBehavior) {\n+      if (process.env.NODE_ENV === 'development') {\n+        errorOnce(\n+          '`legacyBehavior` is deprecated and will be removed in a future ' +\n+            'release. A codemod is available to upgrade your components:\\n\\n' +\n+            'npx @next/codemod@latest new-link .\\n\\n' +\n+            'Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components'\n+        )\n+      }\n+      return React.cloneElement(child, childProps)\n+    }\n+\n     return (\n-      <a {...restProps} {...anchorProps}>\n+      <a {...restProps} {...childProps}>\n         {children}\n       </a>\n     )"
        },
        {
            "sha": "fce0f56bbfcd805beed4f7314957fda258fec06a",
            "filename": "test/e2e/legacy-link-behavior-pages/index.test.js",
            "status": "added",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Findex.test.js?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,83 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Link with legacyBehavior', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  describe('if the child is an <a> tag', () => {\n+    it('forwards the href attribute', async () => {\n+      const $ = await next.render$('/')\n+      const $a = $('a')\n+\n+      expect($a.text()).toBe('About')\n+      expect($a.attr('href')).toBe('/about')\n+    })\n+\n+    it('navigates correctly', async () => {\n+      const browser = await next.browser('/')\n+      await browser.elementByCss('a').click()\n+      const title = await browser.elementByCss('#about-page').text()\n+\n+      expect(title).toBe('About Page')\n+    })\n+  })\n+\n+  it('works if the child is a number', async () => {\n+    const browser = await next.browser('/child-is-a-number')\n+    await browser.elementByCss('a').click()\n+    const title = await browser.elementByCss('h1').text()\n+\n+    expect(title).toBe('About Page')\n+  })\n+\n+  it('works if the child is a string', async () => {\n+    const browser = await next.browser('/child-is-a-string')\n+    await browser.elementByCss('a').click()\n+    const title = await browser.elementByCss('h1').text()\n+\n+    expect(title).toBe('About Page')\n+  })\n+\n+  it('errors when calling onClick without the event', async () => {\n+    const browser = await next.browser('/invalid-onclick')\n+    expect(await browser.elementByCss('#errors').text()).toBe('0')\n+    await browser.elementByCss('#custom-button').click()\n+    expect(await browser.elementByCss('#errors').text()).toBe('1')\n+  })\n+\n+  it('should show a deprecation warning', async () => {\n+    const browser = await next.browser('/')\n+    const logs = await browser.log()\n+\n+    const errors = logs.filter(\n+      (log) =>\n+        log.source === 'error' &&\n+        log.message.includes(\n+          '`legacyBehavior` is deprecated and will be removed in a future release.'\n+        )\n+    )\n+\n+    console.log(errors)\n+\n+    expect(errors.length).toBe(isNextDev ? 1 : 0)\n+  })\n+\n+  describe('passHref', () => {\n+    it('forwards the href attribute', async () => {\n+      const $ = await next.render$('/passHref')\n+      const $a = $('a')\n+\n+      expect($a.text()).toBe('About')\n+      expect($a.attr('href')).toBe('/about')\n+    })\n+\n+    it('navigates correctly', async () => {\n+      const browser = await next.browser('/passHref')\n+      await browser.elementByCss('a').click()\n+      const title = await browser.elementByCss('h1').text()\n+\n+      expect(title).toBe('About Page')\n+    })\n+  })\n+})"
        },
        {
            "sha": "188c1375b5f823114b5d767fc3e6b24b87b6dd83",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/about/index.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fabout%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fabout%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fabout%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1 id=\"about-page\">About Page</h1>\n+      <Link href=\"/\" legacyBehavior>\n+        <a>Home</a>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "4c43e9e411aee7c453f63788a1aafa630efa1ef0",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/child-is-a-number/index.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-number%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-number%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-number%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,11 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        {1000}\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "973f190c2cddb3920a1be6cef23574a3977a917b",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/child-is-a-string/index.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-string%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-string%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Fchild-is-a-string%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,11 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        About\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "c84b10fff5f90a4c23884346109efcf047e54695",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/index.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1>Home Page</h1>\n+      <Link href=\"/about\" legacyBehavior>\n+        About\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "7fe054fcd033ecac79c876175c9bd90d691beec5",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/invalid-onclick/index.tsx",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Finvalid-onclick%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Finvalid-onclick%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2Finvalid-onclick%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,35 @@\n+import Link from 'next/link'\n+import { useState } from 'react'\n+\n+export default function Page(props: any) {\n+  const [errorCount, setErrorCount] = useState(0)\n+\n+  function Button(props) {\n+    return (\n+      <a\n+        id=\"custom-button\"\n+        href={props.href}\n+        onClick={(e) => {\n+          e.preventDefault()\n+          try {\n+            props.onClick()\n+          } catch (err) {\n+            setErrorCount(errorCount + 1)\n+            console.error(err)\n+          }\n+        }}\n+      >\n+        {props.href}\n+      </a>\n+    )\n+  }\n+\n+  return (\n+    <>\n+      <p id=\"errors\">{errorCount}</p>\n+      <Link href=\"/nav\" passHref legacyBehavior>\n+        <Button />\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "9a9f4427ed8f16c0396148f33ad8b3976cde85db",
            "filename": "test/e2e/legacy-link-behavior-pages/pages/passHref/index.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2FpassHref%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2FpassHref%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior-pages%2Fpages%2FpassHref%2Findex.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,15 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <CustomComponent>About</CustomComponent>\n+      </Link>\n+    </>\n+  )\n+}\n+\n+function CustomComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "188c1375b5f823114b5d767fc3e6b24b87b6dd83",
            "filename": "test/e2e/legacy-link-behavior/app/about/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fabout%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fabout%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fabout%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1 id=\"about-page\">About Page</h1>\n+      <Link href=\"/\" legacyBehavior>\n+        <a>Home</a>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "4c43e9e411aee7c453f63788a1aafa630efa1ef0",
            "filename": "test/e2e/legacy-link-behavior/app/child-is-a-number/page.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-number%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-number%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-number%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,11 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        {1000}\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "973f190c2cddb3920a1be6cef23574a3977a917b",
            "filename": "test/e2e/legacy-link-behavior/app/child-is-a-string/page.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-string%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-string%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fchild-is-a-string%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,11 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        About\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "09054fd94308777b1d9fe7a405552f9461ac1f13",
            "filename": "test/e2e/legacy-link-behavior/app/invalid-onclick/page.tsx",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Finvalid-onclick%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Finvalid-onclick%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Finvalid-onclick%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,37 @@\n+'use client'\n+\n+import Link from 'next/link'\n+import { useState } from 'react'\n+\n+export default function Page(props: any) {\n+  const [errorCount, setErrorCount] = useState(0)\n+\n+  function Button(props) {\n+    return (\n+      <a\n+        id=\"custom-button\"\n+        href={props.href}\n+        onClick={(e) => {\n+          e.preventDefault()\n+          try {\n+            props.onClick()\n+          } catch (err) {\n+            setErrorCount(errorCount + 1)\n+            console.error(err)\n+          }\n+        }}\n+      >\n+        {props.href}\n+      </a>\n+    )\n+  }\n+\n+  return (\n+    <>\n+      <p id=\"errors\">{errorCount}</p>\n+      <Link href=\"/nav\" passHref legacyBehavior>\n+        <Button />\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "140dfc24822dc08a3bafc8891aa48b3b7ce9e1a2",
            "filename": "test/e2e/legacy-link-behavior/app/layout.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Flayout.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,24 @@\n+import { connection } from 'next/server'\n+import { ReactNode, Suspense } from 'react'\n+\n+export default async function Root({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <Suspense>\n+        <Connection>\n+          <body>{children}</body>\n+        </Connection>\n+      </Suspense>\n+    </html>\n+  )\n+}\n+\n+async function Connection({ children }: { children: ReactNode }) {\n+  await connection()\n+\n+  return children\n+}"
        },
        {
            "sha": "aab60b83857832bc3f240a831b41834ba1cb61cd",
            "filename": "test/e2e/legacy-link-behavior/app/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1>Home Page</h1>\n+      <Link href=\"/about\" legacyBehavior>\n+        <a>About</a>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "d7da21567136185ea1d2aa821822457f0328393a",
            "filename": "test/e2e/legacy-link-behavior/app/passHref/_client.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function CustomComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "050b8d66970f88ec532549d8ec039e7b0bd36115",
            "filename": "test/e2e/legacy-link-behavior/app/passHref/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2FpassHref%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+import CustomComponent from './_client'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <CustomComponent>About</CustomComponent>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "4b8f01e99314eaaf4cd1818670d8cb97afd7a6ec",
            "filename": "test/e2e/legacy-link-behavior/app/validations/client/child-component/page.tsx",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fchild-component%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fchild-component%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fchild-component%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,17 @@\n+'use client'\n+\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <ChildComponent>About</ChildComponent>\n+      </Link>\n+    </>\n+  )\n+}\n+\n+function ChildComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "aec0aa1f4913880e6c1f852b80bfaf6839932d70",
            "filename": "test/e2e/legacy-link-behavior/app/validations/client/lazy-jsx/page.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Flazy-jsx%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Flazy-jsx%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Flazy-jsx%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,18 @@\n+'use client'\n+\n+import Link from 'next/link'\n+import { lazy } from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        {/* @ts-ignore */}\n+        {lazyJSX}\n+      </Link>\n+    </>\n+  )\n+}\n+\n+// @ts-ignore\n+const lazyJSX = lazy(() => Promise.resolve({ default: <a>About</a> }))"
        },
        {
            "sha": "dd21ddcb1a18144e7948c4c41f2f290d0846204e",
            "filename": "test/e2e/legacy-link-behavior/app/validations/client/missing-child/page.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmissing-child%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmissing-child%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmissing-child%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,7 @@\n+'use client'\n+\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return <Link href=\"/about\" legacyBehavior></Link>\n+}"
        },
        {
            "sha": "161a2be5be787bd65bb342f03f3117c8945d0c93",
            "filename": "test/e2e/legacy-link-behavior/app/validations/client/multiple-children/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmultiple-children%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmultiple-children%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Fclient%2Fmultiple-children%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+'use client'\n+\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <Link href=\"/about\" legacyBehavior>\n+      <span>a</span>\n+      <span>b</span>\n+    </Link>\n+  )\n+}"
        },
        {
            "sha": "b91a29b6899113b8c11263f79ae1839c4e96749f",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/asynchronous/page.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fasynchronous%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fasynchronous%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fasynchronous%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,16 @@\n+import { ReactNode } from 'react'\n+import { ClientLink } from '../client-link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <ClientLink href=\"/about\">\n+        <RSC>About</RSC>\n+      </ClientLink>\n+    </>\n+  )\n+}\n+\n+async function RSC({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "cfd1d4a71ad746025a0aded82df875d0c82ed7b1",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/client-link.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-link.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-link.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-link.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,8 @@\n+'use client'\n+\n+import Link from 'next/link'\n+import { ComponentProps } from 'react'\n+\n+export function ClientLink(props: ComponentProps<typeof Link>) {\n+  return <Link legacyBehavior passHref {...props} />\n+}"
        },
        {
            "sha": "84139fdac02a6025addcfd70fcf71f36bd46d2ff",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/client-with-rsc-child/_client.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,7 @@\n+'use client'\n+\n+import { ReactNode } from 'react'\n+\n+export default function ClientA({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "6808d9bd6397ba77a038f63d3c6f684658a65811",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/client-with-rsc-child/page.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient-with-rsc-child%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,18 @@\n+import { ClientLink } from '../client-link'\n+import ClientA from './_client'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <ClientLink href=\"/about\">\n+        <ClientA>\n+          <RSC />\n+        </ClientA>\n+      </ClientLink>\n+    </>\n+  )\n+}\n+\n+async function RSC() {\n+  return <span>About</span>\n+}"
        },
        {
            "sha": "84139fdac02a6025addcfd70fcf71f36bd46d2ff",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/client/_client.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,7 @@\n+'use client'\n+\n+import { ReactNode } from 'react'\n+\n+export default function ClientA({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "5919a9ee76d2983f4fe983efb6438a9a6bb90e83",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/client/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fclient%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import { ClientLink } from '../client-link'\n+import ClientA from './_client'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <ClientLink href=\"/about\">\n+        <ClientA>About</ClientA>\n+      </ClientLink>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "11d311ccdfc98787d4425a0d1e3eb65db18d56d2",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-client/synchronous/page.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fsynchronous%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fsynchronous%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-client%2Fsynchronous%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,16 @@\n+import { ReactNode } from 'react'\n+import { ClientLink } from '../client-link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <ClientLink href=\"/about\">\n+        <RSC>About</RSC>\n+      </ClientLink>\n+    </>\n+  )\n+}\n+\n+function RSC({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "24c314a0cea4efc270f351cbca9a96b7d6b93ac1",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/asynchronous/page.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fasynchronous%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fasynchronous%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fasynchronous%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,16 @@\n+import Link from 'next/link'\n+import { ReactNode } from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        <RSC>About</RSC>\n+      </Link>\n+    </>\n+  )\n+}\n+\n+async function RSC({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "ccabf05cfdc31831071cdcfe7a8f570cb57fa50b",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/client-with-rsc-child/_client.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export function ClientComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "e4bace616df972c3181c14fd4b71d39b2e26c2e6",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/client-with-rsc-child/page.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient-with-rsc-child%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,18 @@\n+import Link from 'next/link'\n+import { ClientComponent } from './_client'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <ClientComponent>\n+          <RSC />\n+        </ClientComponent>\n+      </Link>\n+    </>\n+  )\n+}\n+\n+function RSC() {\n+  return <span>About</span>\n+}"
        },
        {
            "sha": "ccabf05cfdc31831071cdcfe7a8f570cb57fa50b",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/client/_client.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export function ClientComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "2426e8458c213cdc47a6cfd1b08e82ee038d8a5b",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/client/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fclient%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+import { ClientComponent } from './_client'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <ClientComponent>About</ClientComponent>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "337008e8ebec36551a7d9f881b5458803b66e789",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/lazy/_client.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2F_client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2F_client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2F_client.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export default function ClientComponent(props: any) {\n+  return <a {...props} />\n+}"
        },
        {
            "sha": "0856dcb46874ecac148f19ec712a0dc5b365821f",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/lazy/page.tsx",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Flazy%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,14 @@\n+import Link from 'next/link'\n+import { lazy } from 'react'\n+\n+const LazyComponent = lazy(() => import('./_client'))\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior passHref>\n+        <LazyComponent>About</LazyComponent>\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "597221e5cde2cd4614739b7fcd61087971ddfed4",
            "filename": "test/e2e/legacy-link-behavior/app/validations/rsc-that-renders-link/synchronous/page.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fsynchronous%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fsynchronous%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fapp%2Fvalidations%2Frsc-that-renders-link%2Fsynchronous%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,16 @@\n+import Link from 'next/link'\n+import { ReactNode } from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"/about\" legacyBehavior>\n+        <RSC>About</RSC>\n+      </Link>\n+    </>\n+  )\n+}\n+\n+function RSC({ children }: { children: ReactNode }) {\n+  return <a>{children}</a>\n+}"
        },
        {
            "sha": "51ef011f0a92df4dff8a86f5c0f651a9dd58a4ca",
            "filename": "test/e2e/legacy-link-behavior/index.test.ts",
            "status": "added",
            "additions": 100,
            "deletions": 0,
            "changes": 100,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Findex.test.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,100 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+\n+describe('Link with legacyBehavior', () => {\n+  if (process.env.__NEXT_EXPERIMENTAL_DEBUG_CHANNEL) {\n+    it('should skip debug mode test', () => {})\n+    return\n+  }\n+\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return it('should skip', () => {})\n+  }\n+\n+  describe('if the child is an <a> tag', () => {\n+    it('forwards the href attribute', async () => {\n+      const $ = await next.render$('/')\n+      const $a = $('a')\n+\n+      expect($a.text()).toBe('About')\n+      expect($a.attr('href')).toBe('/about')\n+    })\n+\n+    it('navigates correctly', async () => {\n+      const browser = await next.browser('/')\n+      await browser.elementByCss('a').click()\n+      const title = await browser.elementByCss('#about-page').text()\n+\n+      expect(title).toBe('About Page')\n+    })\n+  })\n+\n+  it('works if the child is a number', async () => {\n+    const browser = await next.browser('/child-is-a-number')\n+    await browser.elementByCss('a').click()\n+    const title = await browser.elementByCss('h1').text()\n+\n+    expect(title).toBe('About Page')\n+  })\n+\n+  it('works if the child is a string', async () => {\n+    const browser = await next.browser('/child-is-a-string')\n+    await browser.elementByCss('a').click()\n+    const title = await browser.elementByCss('h1').text()\n+\n+    expect(title).toBe('About Page')\n+  })\n+\n+  it('errors when calling onClick without the event', async () => {\n+    const browser = await next.browser('/invalid-onclick')\n+    expect(await browser.elementByCss('#errors').text()).toBe('0')\n+    await browser.elementByCss('#custom-button').click()\n+    expect(await browser.elementByCss('#errors').text()).toBe('1')\n+  })\n+\n+  it('should show a deprecation warning', async () => {\n+    const browser = await next.browser('/')\n+\n+    await retry(async () => {\n+      const logs = await browser.log()\n+      const errors = logs.filter((log) => log.source === 'error')\n+\n+      if (isNextDev) {\n+        expect(errors).toEqual([\n+          {\n+            message:\n+              '`legacyBehavior` is deprecated and will be removed in a future release. A codemod is available to upgrade your components:\\n\\n' +\n+              'npx @next/codemod@latest new-link .\\n\\n' +\n+              'Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components',\n+            source: 'error',\n+          },\n+        ])\n+      } else {\n+        expect(errors).toEqual([])\n+      }\n+    })\n+  })\n+\n+  describe('passHref', () => {\n+    it('forwards the href attribute', async () => {\n+      const $ = await next.render$('/passHref')\n+      const $a = $('a')\n+\n+      expect($a.text()).toBe('About')\n+      expect($a.attr('href')).toBe('/about')\n+    })\n+\n+    it('navigates correctly', async () => {\n+      const browser = await next.browser('/passHref')\n+      await browser.elementByCss('a').click()\n+      const title = await browser.elementByCss('h1').text()\n+\n+      expect(title).toBe('About Page')\n+    })\n+  })\n+})"
        },
        {
            "sha": "30a826fdacc568ffb8cd6641fe15330a3c9d618d",
            "filename": "test/e2e/legacy-link-behavior/next.config.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fnext.config.js?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    cacheComponents: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "9a5c964f5b8df951459dc41148e9788ff63e87aa",
            "filename": "test/e2e/legacy-link-behavior/validations.console.test.ts",
            "status": "added",
            "additions": 386,
            "deletions": 0,
            "changes": 386,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fvalidations.console.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Flegacy-link-behavior%2Fvalidations.console.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Flegacy-link-behavior%2Fvalidations.console.test.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,386 @@\n+import { isNextDev, nextTestSetup } from 'e2e-utils'\n+import { assertNoRedbox } from 'next-test-utils'\n+\n+describe('Validations for <Link legacyBehavior>', () => {\n+  const { next, isNextDeploy } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+  if (isNextDeploy) {\n+    return it('should skip deploy', () => {})\n+  }\n+  let previousOutputIndex\n+\n+  beforeEach(() => {\n+    previousOutputIndex = next.cliOutput.length\n+  })\n+\n+  function newConsoleOutput() {\n+    return next.cliOutput.slice(previousOutputIndex)\n+  }\n+\n+  describe('When rendering from a Server Component', () => {\n+    describe('Rendering <Link> directly', () => {\n+      it('warns if the child is a synchronous server component', async () => {\n+        const browser = await next.browser(\n+          '/validations/rsc-that-renders-link/synchronous'\n+        )\n+\n+        if (isNextDev) {\n+          await expect(browser).toDisplayCollapsedRedbox(`\n+           [\n+             {\n+               \"description\": \"Using a Server Component as a direct child of \\`<Link legacyBehavior>\\` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's \\`<a>\\` tag.\",\n+               \"environmentLabel\": \"Prerender\",\n+               \"label\": \"Console Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/synchronous/page.tsx (7:7) @ Page\n+           >  7 |       <Link href=\"/about\" legacyBehavior>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/synchronous/page.tsx (7:7)\",\n+               ],\n+             },\n+             {\n+               \"description\": \"\\`legacyBehavior\\` is deprecated and will be removed in a future release. A codemod is available to upgrade your components:\n+\n+           npx @next/codemod@latest new-link .\n+\n+           Learn more: https://nextjs.org/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components\",\n+               \"environmentLabel\": null,\n+               \"label\": \"Console Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/synchronous/page.tsx (7:7) @ Page\n+           >  7 |       <Link href=\"/about\" legacyBehavior>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/synchronous/page.tsx (7:7)\",\n+               ],\n+             },\n+           ]\n+          `)\n+        } else {\n+          expect(newConsoleOutput()).toMatchInlineSnapshot(`\n+           \"Using a Server Component as a direct child of \\`<Link legacyBehavior>\\` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's \\`<a>\\` tag.\n+           \"\n+          `)\n+        }\n+      })\n+\n+      it('warns and throws an error if the child is an asynchronous server component', async () => {\n+        const browser = await next.browser(\n+          '/validations/rsc-that-renders-link/asynchronous'\n+        )\n+\n+        if (isNextDev) {\n+          await expect(browser).toDisplayRedbox(`\n+           [\n+             {\n+               \"description\": \"Using a Server Component as a direct child of \\`<Link legacyBehavior>\\` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's \\`<a>\\` tag.\",\n+               \"environmentLabel\": \"Prerender\",\n+               \"label\": \"Console Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/asynchronous/page.tsx (7:7) @ Page\n+           >  7 |       <Link href=\"/about\" legacyBehavior>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/asynchronous/page.tsx (7:7)\",\n+               ],\n+             },\n+             {\n+               \"description\": \"\\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\",\n+               \"environmentLabel\": null,\n+               \"label\": \"Runtime Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/asynchronous/page.tsx (7:7) @ Page\n+           >  7 |       <Link href=\"/about\" legacyBehavior>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/asynchronous/page.tsx (7:7)\",\n+               ],\n+             },\n+           ]\n+          `)\n+        } else {\n+          const output = getContentBetween({\n+            input: newConsoleOutput(),\n+            endContent: '   at',\n+          })\n+\n+          expect(output).toMatchInlineSnapshot(`\n+           \"Using a Server Component as a direct child of \\`<Link legacyBehavior>\\` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's \\`<a>\\` tag.\n+            ⨯ Error: \\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\"\n+          `)\n+        }\n+      })\n+\n+      if (!process.env.__NEXT_EXPERIMENTAL_DEBUG_CHANNEL) {\n+        it('does not warn or throw if you pass a client component', async () => {\n+          const browser = await next.browser(\n+            '/validations/rsc-that-renders-link/client'\n+          )\n+\n+          if (isNextDev) {\n+            await assertNoRedbox(browser)\n+          } else {\n+            expect(newConsoleOutput()).toEqual('')\n+          }\n+        })\n+\n+        it('does not warn or throw if you pass a server component into a client component', async () => {\n+          const browser = await next.browser(\n+            '/validations/rsc-that-renders-link/client-with-rsc-child'\n+          )\n+\n+          if (isNextDev) {\n+            await assertNoRedbox(browser)\n+          } else {\n+            expect(newConsoleOutput()).toEqual('')\n+          }\n+        })\n+      }\n+\n+      it('warns if the child is a lazy component', async () => {\n+        const browser = await next.browser(\n+          '/validations/rsc-that-renders-link/lazy'\n+        )\n+\n+        if (isNextDev) {\n+          await expect(browser).toDisplayRedbox(`\n+           [\n+             {\n+               \"description\": \"Using a Lazy Component as a direct child of \\`<Link legacyBehavior>\\` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's \\`<a>\\` tag.\",\n+               \"environmentLabel\": \"Prerender\",\n+               \"label\": \"Console Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/lazy/page.tsx (9:7) @ Page\n+           >  9 |       <Link href=\"/about\" legacyBehavior passHref>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/lazy/page.tsx (9:7)\",\n+               ],\n+             },\n+             {\n+               \"description\": \"\\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\",\n+               \"environmentLabel\": null,\n+               \"label\": \"Runtime Error\",\n+               \"source\": \"app/validations/rsc-that-renders-link/lazy/page.tsx (9:7) @ Page\n+           >  9 |       <Link href=\"/about\" legacyBehavior passHref>\n+                |       ^\",\n+               \"stack\": [\n+                 \"Page app/validations/rsc-that-renders-link/lazy/page.tsx (9:7)\",\n+               ],\n+             },\n+           ]\n+          `)\n+        } else {\n+          const output = getContentBetween({\n+            input: newConsoleOutput(),\n+            endContent: '   at',\n+          })\n+          expect(output).toMatchInlineSnapshot(`\n+           \"Using a Lazy Component as a direct child of \\`<Link legacyBehavior>\\` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's \\`<a>\\` tag.\n+            ⨯ Error: \\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\"\n+          `)\n+        }\n+      })\n+    })\n+\n+    describe('Rendering a Client Component that renders <Link>', () => {\n+      it('does not warn if the child is a synchronous server component', async () => {\n+        const browser = await next.browser(\n+          '/validations/rsc-that-renders-client/synchronous'\n+        )\n+\n+        if (isNextDev) {\n+          await assertNoRedbox(browser)\n+        } else {\n+          expect(newConsoleOutput()).toEqual('')\n+        }\n+      })\n+\n+      it('throws an error if the child is an asynchronous server component', async () => {\n+        const browser = await next.browser(\n+          '/validations/rsc-that-renders-client/asynchronous'\n+        )\n+\n+        if (isNextDev) {\n+          await expect(browser).toDisplayRedbox(`\n+            {\n+              \"description\": \"\\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\",\n+              \"environmentLabel\": null,\n+              \"label\": \"Runtime Error\",\n+              \"source\": \"app/validations/rsc-that-renders-client/client-link.tsx (7:10) @ ClientLink\n+            > 7 |   return <Link legacyBehavior passHref {...props} />\n+                |          ^\",\n+              \"stack\": [\n+                \"ClientLink app/validations/rsc-that-renders-client/client-link.tsx (7:10)\",\n+                \"Page app/validations/rsc-that-renders-client/asynchronous/page.tsx (7:7)\",\n+              ],\n+            }\n+          `)\n+        } else {\n+          const output = getContentBetween({\n+            input: newConsoleOutput(),\n+            endContent: '   at',\n+          })\n+\n+          expect(output).toMatchInlineSnapshot(\n+            `\" ⨯ Error: \\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\"`\n+          )\n+        }\n+      })\n+\n+      if (!process.env.__NEXT_EXPERIMENTAL_DEBUG_CHANNEL) {\n+        it('does not warn or throw if you pass a client component', async () => {\n+          const browser = await next.browser(\n+            '/validations/rsc-that-renders-client/client'\n+          )\n+\n+          if (isNextDev) {\n+            await assertNoRedbox(browser)\n+          } else {\n+            expect(newConsoleOutput()).toEqual('')\n+          }\n+        })\n+\n+        it('does not warn or throw if you pass a server component into a client component', async () => {\n+          const browser = await next.browser(\n+            '/validations/rsc-that-renders-client/client-with-rsc-child'\n+          )\n+\n+          if (isNextDev) {\n+            await assertNoRedbox(browser)\n+          } else {\n+            expect(newConsoleOutput()).toEqual('')\n+          }\n+        })\n+      }\n+    })\n+  })\n+\n+  describe('When rendering from a Client Component', () => {\n+    it('errors if there are no children', async () => {\n+      const browser = await next.browser('/validations/client/missing-child')\n+\n+      if (isNextDev) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"No children were passed to <Link> with \\`href\\` of \\`/about\\` but one child is required https://nextjs.org/docs/messages/link-no-children\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"app/validations/client/missing-child/page.tsx (6:10) @ Page\n+         > 6 |   return <Link href=\"/about\" legacyBehavior></Link>\n+             |          ^\",\n+           \"stack\": [\n+             \"Page app/validations/client/missing-child/page.tsx (6:10)\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        const output = getContentBetween({\n+          input: newConsoleOutput(),\n+          endContent: '   at',\n+        })\n+\n+        expect(output).toMatchInlineSnapshot(\n+          `\" ⨯ Error: React.Children.only expected to receive a single React element child.\"`\n+        )\n+      }\n+    })\n+\n+    it('errors if there are multiple children', async () => {\n+      const browser = await next.browser(\n+        '/validations/client/multiple-children'\n+      )\n+\n+      if (isNextDev) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"Multiple children were passed to <Link> with \\`href\\` of \\`/about\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children \n+         Open your browser's console to view the Component stack trace.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"app/validations/client/multiple-children/page.tsx (7:5) @ Page\n+         >  7 |     <Link href=\"/about\" legacyBehavior>\n+              |     ^\",\n+           \"stack\": [\n+             \"Page app/validations/client/multiple-children/page.tsx (7:5)\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        const output = getContentBetween({\n+          input: newConsoleOutput(),\n+          endContent: '   at',\n+        })\n+\n+        expect(output).toMatchInlineSnapshot(\n+          `\" ⨯ Error: React.Children.only expected to receive a single React element child.\"`\n+        )\n+      }\n+    })\n+\n+    it('does not warn or throw if you pass a child component', async () => {\n+      const browser = await next.browser('/validations/client/child-component')\n+\n+      if (isNextDev) {\n+        await assertNoRedbox(browser)\n+      } else {\n+        expect(newConsoleOutput()).toEqual('')\n+      }\n+    })\n+\n+    it('warns and throws an error if the child is lazy JSX', async () => {\n+      const browser = await next.browser('/validations/client/lazy-jsx')\n+\n+      if (isNextDev) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"\\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"app/validations/client/lazy-jsx/page.tsx (9:7) @ Page\n+         >  9 |       <Link href=\"/about\" legacyBehavior passHref>\n+              |       ^\",\n+           \"stack\": [\n+             \"Page app/validations/client/lazy-jsx/page.tsx (9:7)\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        const output = getContentBetween({\n+          input: newConsoleOutput(),\n+          endContent: '   at',\n+        })\n+\n+        expect(output).toMatchInlineSnapshot(\n+          `\" ⨯ Error: \\`<Link legacyBehavior>\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\`<a>\\` tag.\"`\n+        )\n+      }\n+    })\n+  })\n+})\n+\n+function getContentBetween({\n+  input,\n+  startContent,\n+  endContent,\n+}: {\n+  input: string\n+  startContent?: string\n+  endContent?: string\n+}): string {\n+  const lines = input.split('\\n')\n+\n+  const startIdx = startContent\n+    ? lines.findIndex((line) => line.includes(startContent))\n+    : -1\n+\n+  const endIdx = endContent\n+    ? lines.findIndex((line) => line.includes(endContent))\n+    : -1\n+\n+  if (startContent && startIdx < 0) return ''\n+  if (endContent && endIdx >= 0 && endIdx <= startIdx) return ''\n+\n+  const sliceStart = startIdx >= 0 ? startIdx + 1 : 0\n+  const sliceEnd = endIdx > sliceStart ? endIdx : undefined\n+\n+  return lines.slice(sliceStart, sliceEnd).join('\\n')\n+}"
        },
        {
            "sha": "40d23d4afda6e57b548f6902a8fb6ca8ab3452ac",
            "filename": "test/e2e/new-link-behavior/child-a-tag-error.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Fnew-link-behavior%2Fchild-a-tag-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Fnew-link-behavior%2Fchild-a-tag-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnew-link-behavior%2Fchild-a-tag-error.test.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -27,11 +27,11 @@ describe('New Link Behavior with <a> child', () => {\n \n     if (isNextDev) {\n       expect(next.cliOutput).toContain(\n-        'Error: Invalid <Link> with <a> child. Please remove <a>'\n+        'Error: Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>'\n       )\n       await expect(browser).toDisplayRedbox(`\n        {\n-         \"description\": \"Invalid <Link> with <a> child. Please remove <a>.\n+         \"description\": \"Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>.\n        Learn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\","
        },
        {
            "sha": "258fae5807b7a0abd0034661c3fb2cd5b27ab772",
            "filename": "test/e2e/rsc-layers-transform/middleware.js",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Frsc-layers-transform%2Fmiddleware.js",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Frsc-layers-transform%2Fmiddleware.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Frsc-layers-transform%2Fmiddleware.js?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -3,15 +3,9 @@ import { textValue, TestLink } from './lib/shared-module'\n \n export function middleware(request) {\n   if (request.nextUrl.pathname === '/middleware') {\n-    let testLink\n-    try {\n-      testLink = TestLink.$$typeof.toString()\n-    } catch (e) {\n-      testLink = e.message\n-    }\n     return Response.json({\n-      clientReference: testLink,\n       textValue,\n+      linkType: typeof TestLink,\n     })\n   }\n "
        },
        {
            "sha": "0ace072274baf4c734bc47865bddde17b7f520ad",
            "filename": "test/e2e/rsc-layers-transform/rsc-layers-transform.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Frsc-layers-transform%2Frsc-layers-transform.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fe2e%2Frsc-layers-transform%2Frsc-layers-transform.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Frsc-layers-transform%2Frsc-layers-transform.test.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -10,7 +10,7 @@ describe('rsc layers transform', () => {\n \n     expect(json).toEqual({\n       textValue: 'text-value',\n-      clientReference: 'Symbol(react.client.reference)',\n+      linkType: 'function',\n     })\n   })\n "
        },
        {
            "sha": "5874c94ecfcf90f1e3edd62786966918c18c87b2",
            "filename": "test/production/next-link-legacybehavior-ref-merging/app/layout.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flayout.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,13 @@\n+import * as React from 'react'\n+\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html lang=\"en\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "e2d7e5f95e8a03d9c2cbb32c39da391f9b74e32b",
            "filename": "test/production/next-link-legacybehavior-ref-merging/app/link-target/page.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flink-target%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flink-target%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Flink-target%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,10 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1>Navigation worked!</h1>\n+      <Link href=\"/\">Go back</Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "e722bfa183143e9e675272df403870f9ba3cb49d",
            "filename": "test/production/next-link-legacybehavior-ref-merging/app/next.config.mjs",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fnext.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fnext.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fnext.config.mjs?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,2 @@\n+/** @type {import('next').NextConfig} */\n+export default {}"
        },
        {
            "sha": "ed424991ba1562856e10a0b7588d70be8dde0892",
            "filename": "test/production/next-link-legacybehavior-ref-merging/app/page.tsx",
            "status": "added",
            "additions": 86,
            "deletions": 0,
            "changes": 86,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Fapp%2Fpage.tsx?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,86 @@\n+'use client'\n+import Link from 'next/link'\n+import {\n+  useCallback,\n+  useState,\n+  type ComponentPropsWithRef,\n+  type ReactNode,\n+  type Ref,\n+  type RefCallback,\n+} from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <h1>Home</h1>\n+      <ToggleVisibility>\n+        <Link href=\"/link-target\" legacyBehavior>\n+          <AnchorThatDoesRefMerging id=\"test-link\">\n+            Go to /link-target\n+          </AnchorThatDoesRefMerging>\n+        </Link>\n+      </ToggleVisibility>\n+    </>\n+  )\n+}\n+\n+function ToggleVisibility({ children }: { children: ReactNode }) {\n+  const [isVisible, setIsVisible] = useState(true)\n+  return (\n+    <>\n+      <div>\n+        <button type=\"button\" onClick={() => setIsVisible((prev) => !prev)}>\n+          {isVisible ? 'Hide content' : 'Show content'}\n+        </button>\n+      </div>\n+      {isVisible ? children : null}\n+    </>\n+  )\n+}\n+\n+function AnchorThatDoesRefMerging({\n+  ref,\n+  children,\n+  ...anchorProps\n+}: ComponentPropsWithRef<'a'>) {\n+  const customRef: RefCallback<HTMLAnchorElement> = useCallback((el) => {\n+    if (el) {\n+      console.log('hello friends i am here')\n+    } else {\n+      console.log('goodbye friends i am gone')\n+    }\n+  }, [])\n+\n+  const finalRef = useBuggyRefMerge(customRef, ref ?? null)\n+  return (\n+    <a ref={finalRef} {...anchorProps}>\n+      {children}\n+    </a>\n+  )\n+}\n+\n+/** A ref-merging function that doesn't account for cleanup refs (added in React 19)\n+ * https://react.dev/blog/2024/12/05/react-19#cleanup-functions-for-refs\n+ */\n+function useBuggyRefMerge<TElement>(\n+  refA: Ref<TElement>,\n+  refB: Ref<TElement>\n+): RefCallback<TElement> {\n+  return useCallback(\n+    (current: TElement | null) => {\n+      for (const ref of [refA, refB]) {\n+        if (!ref) {\n+          continue\n+        }\n+        if (typeof ref === 'object') {\n+          ref.current = current\n+        } else {\n+          // BUG!!!\n+          // This would work in 18, but in 19 it can return a cleanup which will get swallowed here\n+          ref(current)\n+        }\n+      }\n+    },\n+    [refA, refB]\n+  )\n+}"
        },
        {
            "sha": "f9f3645dcbf335278bfa92b7df89a68cf58d3831",
            "filename": "test/production/next-link-legacybehavior-ref-merging/index.test.ts",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/35f60806d735f2a46e00489bf31b822fefa18ec7/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fnext-link-legacybehavior-ref-merging%2Findex.test.ts?ref=35f60806d735f2a46e00489bf31b822fefa18ec7",
            "patch": "@@ -0,0 +1,26 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+// NOTE: this test is checking for a bug in prefetching code,\n+// so we only enable it in production\n+\n+describe('Link with legacyBehavior - handles buggy userspace ref merging', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('does not crash when Link unmounts', async () => {\n+    const browser = await next.browser('/')\n+    expect(await browser.elementByCss('h1').text()).toEqual('Home')\n+    expect(await browser.hasElementByCssSelector('#test-link')).toBe(true)\n+\n+    // hide the link, unmounting it\n+    await browser.elementByCss('button').click()\n+    expect(await browser.hasElementByCssSelector('#test-link')).toBe(false)\n+\n+    // shouldn't cause a crash\n+    expect(await browser.elementByCss('h1').text()).toEqual('Home')\n+    expect(await browser.elementByCss('body').text()).not.toContain(\n+      'Application error: a client-side exception has occurred'\n+    )\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 1615,
        "additions": 1547,
        "deletions": 68
    }
}