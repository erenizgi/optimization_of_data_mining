{
    "author": "ijjk",
    "message": "Re-land updated bundler for pre-bundling (#79164)\n\nRe-lands https://github.com/vercel/next.js/pull/75294 which uses rspack\nfor our prebundling of runtimes which can be slow when developing\nlocally.",
    "sha": "62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
    "files": [
        {
            "sha": "46230f84d31dd8da2f46545bb20a29707130816a",
            "filename": "packages/next/next-runtime.webpack-config.js",
            "status": "modified",
            "additions": 2,
            "deletions": 19,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-runtime.webpack-config.js?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -1,6 +1,5 @@\n-const webpack = require('webpack')\n+const webpack = require('@rspack/core')\n const path = require('path')\n-const TerserPlugin = require('terser-webpack-plugin')\n const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer')\n const EvalSourceMapDevToolPlugin = require('./webpack-plugins/eval-source-map-dev-tool-plugin')\n const DevToolsIgnoreListPlugin = require('./webpack-plugins/devtools-ignore-list-plugin')\n@@ -193,23 +192,7 @@ module.exports = ({ dev, turbo, bundleType, experimental, ...rest }) => {\n       moduleIds: 'named',\n       minimize: true,\n       concatenateModules: true,\n-      minimizer: [\n-        new TerserPlugin({\n-          minify: TerserPlugin.swcMinify,\n-          terserOptions: {\n-            compress: {\n-              dead_code: true,\n-              // Zero means no limit.\n-              passes: 0,\n-            },\n-            format: {\n-              preamble: '',\n-            },\n-            mangle:\n-              dev && !process.env.NEXT_SERVER_EVAL_SOURCE_MAPS ? false : true,\n-          },\n-        }),\n-      ],\n+      minimizer: [new webpack.SwcJsMinimizerRspackPlugin()],\n     },\n     plugins: [\n       process.env.NEXT_SERVER_EVAL_SOURCE_MAPS"
        },
        {
            "sha": "7a1bfc7e88a7c909a4ba39361d7b9fb0e7c49b6e",
            "filename": "packages/next/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fpackage.json?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -169,6 +169,7 @@\n     \"@next/swc\": \"15.4.0-canary.33\",\n     \"@opentelemetry/api\": \"1.6.0\",\n     \"@playwright/test\": \"1.41.2\",\n+    \"@rspack/core\": \"1.3.9\",\n     \"@storybook/addon-a11y\": \"8.6.0\",\n     \"@storybook/addon-essentials\": \"8.6.0\",\n     \"@storybook/addon-interactions\": \"8.6.0\","
        },
        {
            "sha": "a08b517de8194ed55941ecc60ba46be296a07f48",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 18,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -1529,26 +1529,31 @@ export default class NextNodeServer extends BaseServer<\n   }\n \n   private async loadNodeMiddleware() {\n-    if (!this.nextConfig.experimental.nodeMiddleware) {\n-      return\n-    }\n+    if (!process.env.NEXT_MINIMAL) {\n+      if (!this.nextConfig.experimental.nodeMiddleware) {\n+        return\n+      }\n \n-    try {\n-      const functionsConfig = this.renderOpts.dev\n-        ? {}\n-        : require(join(this.distDir, 'server', FUNCTIONS_CONFIG_MANIFEST))\n+      try {\n+        const functionsConfig = this.renderOpts.dev\n+          ? {}\n+          : require(join(this.distDir, 'server', FUNCTIONS_CONFIG_MANIFEST))\n \n-      if (this.renderOpts.dev || functionsConfig?.functions?.['/_middleware']) {\n-        // if used with top level await, this will be a promise\n-        return require(join(this.distDir, 'server', 'middleware.js'))\n-      }\n-    } catch (err) {\n-      if (\n-        isError(err) &&\n-        err.code !== 'ENOENT' &&\n-        err.code !== 'MODULE_NOT_FOUND'\n-      ) {\n-        throw err\n+        if (\n+          this.renderOpts.dev ||\n+          functionsConfig?.functions?.['/_middleware']\n+        ) {\n+          // if used with top level await, this will be a promise\n+          return require(join(this.distDir, 'server', 'middleware.js'))\n+        }\n+      } catch (err) {\n+        if (\n+          isError(err) &&\n+          err.code !== 'ENOENT' &&\n+          err.code !== 'MODULE_NOT_FOUND'\n+        ) {\n+          throw err\n+        }\n       }\n     }\n   }"
        },
        {
            "sha": "313696c24ce6fbf86ecaece8b8dad6350815032d",
            "filename": "packages/next/taskfile-webpack.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Ftaskfile-webpack.js",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Ftaskfile-webpack.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile-webpack.js?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -1,4 +1,4 @@\n-const webpack = require('webpack')\n+const webpack = require('@rspack/core')\n \n module.exports = function (task) {\n   // eslint-disable-next-line require-yield"
        },
        {
            "sha": "aba714aba518244dde7ae92018095ec8f7f68018",
            "filename": "packages/next/webpack-plugins/devtools-ignore-list-plugin.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fwebpack-plugins%2Fdevtools-ignore-list-plugin.js",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/packages%2Fnext%2Fwebpack-plugins%2Fdevtools-ignore-list-plugin.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fwebpack-plugins%2Fdevtools-ignore-list-plugin.js?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -1,7 +1,7 @@\n // Source: https://github.com/mondaychen/devtools-ignore-webpack-plugin/blob/e35ce41d9606a92a455ef247f509a1c2ccab5778/src/index.ts\n \n // eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const webpack = require('webpack')\n+const webpack = require('@rspack/core')\n \n // Following the naming conventions from\n // https://tc39.es/source-map/#source-map-format"
        },
        {
            "sha": "bb1c19f20701d960cae7843d31f8ca63c059ddf3",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/pnpm-lock.yaml",
            "raw_url": "https://github.com/vercel/next.js/raw/62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/pnpm-lock.yaml?ref=62a3f91c1afd6f370f4c1e9c117bd5725c0ee10d",
            "patch": "@@ -1027,6 +1027,9 @@ importers:\n       '@playwright/test':\n         specifier: 1.41.2\n         version: 1.41.2\n+      '@rspack/core':\n+        specifier: 1.3.9\n+        version: 1.3.9(@swc/helpers@0.5.15)\n       '@storybook/addon-a11y':\n         specifier: 8.6.0\n         version: 8.6.0(storybook@8.6.0(prettier@3.3.3))"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 31,
        "deletions": 39
    }
}