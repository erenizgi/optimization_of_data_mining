{
    "author": "ztanner",
    "message": "[cache components] add cache components indicator to dev start (#85069)\n\nMissed the plumbing for this in `dev`.",
    "sha": "09772c3aa89d06f7d8c170e1614283f32b8bbbdf",
    "files": [
        {
            "sha": "58c1b85f76237d49c307f450d79e37263d83ac52",
            "filename": "packages/next/src/server/lib/start-server.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts?ref=09772c3aa89d06f7d8c170e1614283f32b8bbbdf",
            "patch": "@@ -367,17 +367,20 @@ export async function startServer(\n       // Only load env and config in dev to for logging purposes\n       let envInfo: string[] | undefined\n       let experimentalFeatures: ConfiguredExperimentalFeature[] | undefined\n+      let cacheComponents: boolean | undefined\n       try {\n         if (isDev) {\n           const startServerInfo = await getStartServerInfo({ dir, dev: isDev })\n           envInfo = startServerInfo.envInfo\n+          cacheComponents = startServerInfo.cacheComponents\n           experimentalFeatures = startServerInfo.experimentalFeatures\n         }\n         logStartInfo({\n           networkUrl,\n           appUrl,\n           envInfo,\n           experimentalFeatures,\n+          cacheComponents,\n           logBundler: isDev,\n         })\n "
        },
        {
            "sha": "08eaa94fdc8896acfd343a0dbb61c713eec93a55",
            "filename": "test/development/app-dir/dev-output/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Flayout.tsx?ref=09772c3aa89d06f7d8c170e1614283f32b8bbbdf",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "9439a2b8835fd67e24f3203cd30215906b45a97d",
            "filename": "test/development/app-dir/dev-output/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fapp%2Fpage.tsx?ref=09772c3aa89d06f7d8c170e1614283f32b8bbbdf",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>Hello, World!</p>\n+}"
        },
        {
            "sha": "36455918cfe25bf4245a225779aa6f0310d1c119",
            "filename": "test/development/app-dir/dev-output/dev-output.test.ts",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fdev-output.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/09772c3aa89d06f7d8c170e1614283f32b8bbbdf/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fdev-output.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdev-output%2Fdev-output.test.ts?ref=09772c3aa89d06f7d8c170e1614283f32b8bbbdf",
            "patch": "@@ -0,0 +1,50 @@\n+import { nextTestSetup } from 'e2e-utils'\n+const { version: nextVersion } = require('next/package.json')\n+\n+const cacheComponentsEnabled = process.env.__NEXT_CACHE_COMPONENTS === 'true'\n+\n+describe('dev-output', () => {\n+  const { next, isTurbopack } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('shows Cache Components indicator when enabled', async () => {\n+    const preamble = getPreambleOutput(next.cliOutput)\n+\n+    if (cacheComponentsEnabled) {\n+      if (isTurbopack) {\n+        expect(preamble).toContain('Next.js')\n+        expect(preamble).toContain('Turbopack')\n+        expect(preamble).toContain('Cache Components')\n+      } else {\n+        expect(preamble).toContain('Next.js')\n+        expect(preamble).toContain('webpack')\n+        expect(preamble).toContain('Cache Components')\n+      }\n+    } else {\n+      // When cache components env is not set, should not show the indicator\n+      expect(preamble).toContain('Next.js')\n+      if (isTurbopack) {\n+        expect(preamble).toContain('Turbopack')\n+      } else {\n+        expect(preamble).toContain('webpack')\n+      }\n+      expect(preamble).not.toContain('Cache Components')\n+    }\n+  })\n+})\n+\n+function getPreambleOutput(cliOutput: string): string {\n+  const lines: string[] = []\n+\n+  for (const line of cliOutput.split('\\n')) {\n+    // Capture lines up to and including the \"Local:\" line\n+    lines.push(line.replace(nextVersion, 'x.y.z'))\n+\n+    if (line.includes('Local:')) {\n+      break\n+    }\n+  }\n+\n+  return lines.join('\\n').trim()\n+}"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 67,
        "deletions": 0
    }
}