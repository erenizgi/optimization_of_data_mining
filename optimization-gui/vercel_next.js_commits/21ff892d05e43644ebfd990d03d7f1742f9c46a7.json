{
    "author": "mischnic",
    "message": "Turbopack: also inline env vars with undefined value (#80990)\n\nPreviously, only env vars with set values were inline.\nBut some of them, e.g. `process.env.__NEXT_MANUAL_TRAILING_SLASH` and `process.env.__NEXT_CROSS_ORIGIN` are always set, but might be `undefined` in the env mapping.\nDon't drop these but replace them with undefined, as Webpack does.",
    "sha": "21ff892d05e43644ebfd990d03d7f1742f9c46a7",
    "files": [
        {
            "sha": "29a2903e080bf76f13b67ee51ee8d64b2f259033",
            "filename": "crates/napi/src/next_api/project.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -81,6 +81,13 @@ pub struct NapiEnvVar {\n     pub value: RcStr,\n }\n \n+#[napi(object)]\n+#[derive(Clone, Debug)]\n+pub struct NapiOptionEnvVar {\n+    pub name: RcStr,\n+    pub value: Option<RcStr>,\n+}\n+\n #[napi(object)]\n pub struct NapiDraftModeOptions {\n     pub preview_mode_id: RcStr,\n@@ -215,9 +222,9 @@ pub struct NapiPartialProjectOptions {\n #[napi(object)]\n #[derive(Clone, Debug)]\n pub struct NapiDefineEnv {\n-    pub client: Vec<NapiEnvVar>,\n-    pub edge: Vec<NapiEnvVar>,\n-    pub nodejs: Vec<NapiEnvVar>,\n+    pub client: Vec<NapiOptionEnvVar>,\n+    pub edge: Vec<NapiOptionEnvVar>,\n+    pub nodejs: Vec<NapiOptionEnvVar>,\n }\n \n #[napi(object)]"
        },
        {
            "sha": "f537c5e845b34c4b124287bee0914f8f7f03a613",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -18,7 +18,7 @@ use next_core::{\n         get_server_module_options_context, get_server_resolve_options_context,\n     },\n     next_telemetry::NextFeatureTelemetry,\n-    util::{NextRuntime, parse_config_from_source},\n+    util::{NextRuntime, OptionEnvMap, parse_config_from_source},\n };\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n@@ -248,9 +248,9 @@ pub struct PartialProjectOptions {\n )]\n #[serde(rename_all = \"camelCase\")]\n pub struct DefineEnv {\n-    pub client: Vec<(RcStr, RcStr)>,\n-    pub edge: Vec<(RcStr, RcStr)>,\n-    pub nodejs: Vec<(RcStr, RcStr)>,\n+    pub client: Vec<(RcStr, Option<RcStr>)>,\n+    pub edge: Vec<(RcStr, Option<RcStr>)>,\n+    pub nodejs: Vec<(RcStr, Option<RcStr>)>,\n }\n \n #[derive(Serialize, Deserialize, TraceRawVcs, PartialEq, Eq, ValueDebugFormat, NonLocalValue)]\n@@ -583,25 +583,25 @@ pub struct Project {\n \n #[turbo_tasks::value]\n pub struct ProjectDefineEnv {\n-    client: ResolvedVc<EnvMap>,\n-    edge: ResolvedVc<EnvMap>,\n-    nodejs: ResolvedVc<EnvMap>,\n+    client: ResolvedVc<OptionEnvMap>,\n+    edge: ResolvedVc<OptionEnvMap>,\n+    nodejs: ResolvedVc<OptionEnvMap>,\n }\n \n #[turbo_tasks::value_impl]\n impl ProjectDefineEnv {\n     #[turbo_tasks::function]\n-    pub fn client(&self) -> Vc<EnvMap> {\n+    pub fn client(&self) -> Vc<OptionEnvMap> {\n         *self.client\n     }\n \n     #[turbo_tasks::function]\n-    pub fn edge(&self) -> Vc<EnvMap> {\n+    pub fn edge(&self) -> Vc<OptionEnvMap> {\n         *self.edge\n     }\n \n     #[turbo_tasks::function]\n-    pub fn nodejs(&self) -> Vc<EnvMap> {\n+    pub fn nodejs(&self) -> Vc<OptionEnvMap> {\n         *self.nodejs\n     }\n }"
        },
        {
            "sha": "bce4943f68c298bac0fe62954c4290ff5baff34b",
            "filename": "crates/next-build/src/build_options.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-build%2Fsrc%2Fbuild_options.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-build%2Fsrc%2Fbuild_options.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-build%2Fsrc%2Fbuild_options.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -47,7 +47,7 @@ pub struct BuildContext {\n \n #[derive(Debug, Clone)]\n pub struct DefineEnv {\n-    pub client: Vec<(RcStr, RcStr)>,\n-    pub edge: Vec<(RcStr, RcStr)>,\n-    pub nodejs: Vec<(RcStr, RcStr)>,\n+    pub client: Vec<(RcStr, Option<RcStr>)>,\n+    pub edge: Vec<(RcStr, Option<RcStr>)>,\n+    pub nodejs: Vec<(RcStr, Option<RcStr>)>,\n }"
        },
        {
            "sha": "8a0a0ecfceb3ec85581311db858b76516166641f",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 33,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -2,8 +2,7 @@ use std::iter::once;\n \n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, TaskInput, Vc};\n-use turbo_tasks_env::EnvMap;\n+use turbo_tasks::{ResolvedVc, TaskInput, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n     css::chunk::CssChunkType,\n@@ -22,10 +21,7 @@ use turbopack_core::{\n         ChunkingConfig, ChunkingContext, MangleType, MinifyType, SourceMapsType,\n         module_id_strategies::ModuleIdStrategy,\n     },\n-    compile_time_info::{\n-        CompileTimeDefineValue, CompileTimeDefines, CompileTimeInfo, DefineableNameSegment,\n-        FreeVarReference, FreeVarReferences,\n-    },\n+    compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReference, FreeVarReferences},\n     environment::{BrowserEnvironment, Environment, ExecutionEnvironment},\n     free_var_references,\n     resolve::{parse::Request, pattern::Pattern},\n@@ -66,39 +62,16 @@ use crate::{\n         get_decorators_transform_options, get_jsx_transform_options,\n         get_typescript_transform_options,\n     },\n-    util::{foreign_code_context_condition, internal_assets_conditions},\n+    util::{OptionEnvMap, defines, foreign_code_context_condition, internal_assets_conditions},\n };\n \n-fn defines(define_env: &FxIndexMap<RcStr, RcStr>) -> CompileTimeDefines {\n-    let mut defines = FxIndexMap::default();\n-\n-    for (k, v) in define_env {\n-        defines\n-            .entry(\n-                k.split('.')\n-                    .map(|s| DefineableNameSegment::Name(s.into()))\n-                    .collect::<Vec<_>>(),\n-            )\n-            .or_insert_with(|| {\n-                let val = serde_json::from_str(v);\n-                match val {\n-                    Ok(serde_json::Value::Bool(v)) => CompileTimeDefineValue::Bool(v),\n-                    Ok(serde_json::Value::String(v)) => CompileTimeDefineValue::String(v.into()),\n-                    _ => CompileTimeDefineValue::JSON(v.clone()),\n-                }\n-            });\n-    }\n-\n-    CompileTimeDefines(defines)\n-}\n-\n #[turbo_tasks::function]\n-async fn next_client_defines(define_env: Vc<EnvMap>) -> Result<Vc<CompileTimeDefines>> {\n+async fn next_client_defines(define_env: Vc<OptionEnvMap>) -> Result<Vc<CompileTimeDefines>> {\n     Ok(defines(&*define_env.await?).cell())\n }\n \n #[turbo_tasks::function]\n-async fn next_client_free_vars(define_env: Vc<EnvMap>) -> Result<Vc<FreeVarReferences>> {\n+async fn next_client_free_vars(define_env: Vc<OptionEnvMap>) -> Result<Vc<FreeVarReferences>> {\n     Ok(free_var_references!(\n         ..defines(&*define_env.await?).into_iter(),\n         Buffer = FreeVarReference::EcmaScriptModule {\n@@ -118,7 +91,7 @@ async fn next_client_free_vars(define_env: Vc<EnvMap>) -> Result<Vc<FreeVarRefer\n #[turbo_tasks::function]\n pub async fn get_client_compile_time_info(\n     browserslist_query: RcStr,\n-    define_env: Vc<EnvMap>,\n+    define_env: Vc<OptionEnvMap>,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder(\n         Environment::new(ExecutionEnvironment::Browser("
        },
        {
            "sha": "c450d7bb60470466f24569692267e83cfc3916fa",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 33,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -1,7 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Vc};\n-use turbo_tasks_env::EnvMap;\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{css::chunk::CssChunkType, resolve_options_context::ResolveOptionsContext};\n use turbopack_browser::BrowserChunkingContext;\n@@ -10,10 +9,7 @@ use turbopack_core::{\n         ChunkingConfig, ChunkingContext, MangleType, MinifyType, SourceMapsType,\n         module_id_strategies::ModuleIdStrategy,\n     },\n-    compile_time_info::{\n-        CompileTimeDefineValue, CompileTimeDefines, CompileTimeInfo, DefineableNameSegment,\n-        FreeVarReference, FreeVarReferences,\n-    },\n+    compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReference, FreeVarReferences},\n     environment::{EdgeWorkerEnvironment, Environment, ExecutionEnvironment, NodeJsVersion},\n     free_var_references,\n };\n@@ -30,34 +26,11 @@ use crate::{\n         ModuleFeatureReportResolvePlugin, NextSharedRuntimeResolvePlugin,\n         get_invalid_client_only_resolve_plugin, get_invalid_styled_jsx_resolve_plugin,\n     },\n-    util::{NextRuntime, foreign_code_context_condition},\n+    util::{NextRuntime, OptionEnvMap, defines, foreign_code_context_condition},\n };\n \n-fn defines(define_env: &FxIndexMap<RcStr, RcStr>) -> CompileTimeDefines {\n-    let mut defines = FxIndexMap::default();\n-\n-    for (k, v) in define_env {\n-        defines\n-            .entry(\n-                k.split('.')\n-                    .map(|s| DefineableNameSegment::Name(s.into()))\n-                    .collect::<Vec<_>>(),\n-            )\n-            .or_insert_with(|| {\n-                let val = serde_json::from_str(v);\n-                match val {\n-                    Ok(serde_json::Value::Bool(v)) => CompileTimeDefineValue::Bool(v),\n-                    Ok(serde_json::Value::String(v)) => CompileTimeDefineValue::String(v.into()),\n-                    _ => CompileTimeDefineValue::JSON(v.clone()),\n-                }\n-            });\n-    }\n-\n-    CompileTimeDefines(defines)\n-}\n-\n #[turbo_tasks::function]\n-async fn next_edge_defines(define_env: Vc<EnvMap>) -> Result<Vc<CompileTimeDefines>> {\n+async fn next_edge_defines(define_env: Vc<OptionEnvMap>) -> Result<Vc<CompileTimeDefines>> {\n     Ok(defines(&*define_env.await?).cell())\n }\n \n@@ -66,7 +39,7 @@ async fn next_edge_defines(define_env: Vc<EnvMap>) -> Result<Vc<CompileTimeDefin\n #[turbo_tasks::function]\n async fn next_edge_free_vars(\n     project_path: FileSystemPath,\n-    define_env: Vc<EnvMap>,\n+    define_env: Vc<OptionEnvMap>,\n ) -> Result<Vc<FreeVarReferences>> {\n     Ok(free_var_references!(\n         ..defines(&*define_env.await?).into_iter(),\n@@ -82,7 +55,7 @@ async fn next_edge_free_vars(\n #[turbo_tasks::function]\n pub async fn get_edge_compile_time_info(\n     project_path: FileSystemPath,\n-    define_env: Vc<EnvMap>,\n+    define_env: Vc<OptionEnvMap>,\n     node_version: ResolvedVc<NodeJsVersion>,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder("
        },
        {
            "sha": "9dd816d6e35c6a5f8284cb25054cdf99fab5e821",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 34,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -2,8 +2,7 @@ use std::iter::once;\n \n use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, TaskInput, Vc};\n-use turbo_tasks_env::EnvMap;\n+use turbo_tasks::{ResolvedVc, TaskInput, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n     css::chunk::CssChunkType,\n@@ -19,10 +18,7 @@ use turbopack_core::{\n         ChunkingConfig, MangleType, MinifyType, SourceMapsType,\n         module_id_strategies::ModuleIdStrategy,\n     },\n-    compile_time_info::{\n-        CompileTimeDefineValue, CompileTimeDefines, CompileTimeInfo, DefineableNameSegment,\n-        FreeVarReferences,\n-    },\n+    compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReferences},\n     environment::{\n         Environment, ExecutionEnvironment, NodeJsEnvironment, NodeJsVersion, RuntimeVersions,\n     },\n@@ -73,8 +69,8 @@ use crate::{\n         get_typescript_transform_options,\n     },\n     util::{\n-        NextRuntime, foreign_code_context_condition, get_transpiled_packages,\n-        internal_assets_conditions, load_next_js_templateon,\n+        NextRuntime, OptionEnvMap, defines, foreign_code_context_condition,\n+        get_transpiled_packages, internal_assets_conditions, load_next_js_templateon,\n     },\n };\n \n@@ -346,43 +342,20 @@ pub async fn get_server_resolve_options_context(\n     .cell())\n }\n \n-fn defines(define_env: &FxIndexMap<RcStr, RcStr>) -> CompileTimeDefines {\n-    let mut defines = FxIndexMap::default();\n-\n-    for (k, v) in define_env {\n-        defines\n-            .entry(\n-                k.split('.')\n-                    .map(|s| DefineableNameSegment::Name(s.into()))\n-                    .collect::<Vec<_>>(),\n-            )\n-            .or_insert_with(|| {\n-                let val = serde_json::from_str(v);\n-                match val {\n-                    Ok(serde_json::Value::Bool(v)) => CompileTimeDefineValue::Bool(v),\n-                    Ok(serde_json::Value::String(v)) => CompileTimeDefineValue::String(v.into()),\n-                    _ => CompileTimeDefineValue::JSON(v.clone()),\n-                }\n-            });\n-    }\n-\n-    CompileTimeDefines(defines)\n-}\n-\n #[turbo_tasks::function]\n-async fn next_server_defines(define_env: Vc<EnvMap>) -> Result<Vc<CompileTimeDefines>> {\n+async fn next_server_defines(define_env: Vc<OptionEnvMap>) -> Result<Vc<CompileTimeDefines>> {\n     Ok(defines(&*define_env.await?).cell())\n }\n \n #[turbo_tasks::function]\n-async fn next_server_free_vars(define_env: Vc<EnvMap>) -> Result<Vc<FreeVarReferences>> {\n+async fn next_server_free_vars(define_env: Vc<OptionEnvMap>) -> Result<Vc<FreeVarReferences>> {\n     Ok(free_var_references!(..defines(&*define_env.await?).into_iter()).cell())\n }\n \n #[turbo_tasks::function]\n pub async fn get_server_compile_time_info(\n     cwd: RcStr,\n-    define_env: Vc<EnvMap>,\n+    define_env: Vc<OptionEnvMap>,\n     node_version: ResolvedVc<NodeJsVersion>,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder("
        },
        {
            "sha": "71a69b6a776510f03cd3509d74336c2952468610",
            "filename": "crates/next-core/src/util.rs",
            "status": "modified",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/crates%2Fnext-core%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Futil.rs?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -17,6 +17,7 @@ use turbo_tasks_fs::{\n };\n use turbopack_core::{\n     asset::AssetContent,\n+    compile_time_info::{CompileTimeDefineValue, CompileTimeDefines, DefineableNameSegment},\n     condition::ContextCondition,\n     ident::AssetIdent,\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n@@ -40,6 +41,40 @@ use crate::{\n \n const NEXT_TEMPLATE_PATH: &str = \"dist/esm/build/templates\";\n \n+/// As opposed to [`EnvMap`], this map allows for `None` values, which means that the variables\n+/// should be replace with undefined.\n+#[turbo_tasks::value(transparent)]\n+pub struct OptionEnvMap(#[turbo_tasks(trace_ignore)] FxIndexMap<RcStr, Option<RcStr>>);\n+\n+pub fn defines(define_env: &FxIndexMap<RcStr, Option<RcStr>>) -> CompileTimeDefines {\n+    let mut defines = FxIndexMap::default();\n+\n+    for (k, v) in define_env {\n+        defines\n+            .entry(\n+                k.split('.')\n+                    .map(|s| DefineableNameSegment::Name(s.into()))\n+                    .collect::<Vec<_>>(),\n+            )\n+            .or_insert_with(|| {\n+                if let Some(v) = v {\n+                    let val = serde_json::from_str(v);\n+                    match val {\n+                        Ok(serde_json::Value::Bool(v)) => CompileTimeDefineValue::Bool(v),\n+                        Ok(serde_json::Value::String(v)) => {\n+                            CompileTimeDefineValue::String(v.into())\n+                        }\n+                        _ => CompileTimeDefineValue::JSON(v.clone()),\n+                    }\n+                } else {\n+                    CompileTimeDefineValue::Undefined\n+                }\n+            });\n+    }\n+\n+    CompileTimeDefines(defines)\n+}\n+\n #[derive(\n     Debug, Clone, Copy, PartialEq, Eq, Hash, TaskInput, Serialize, Deserialize, TraceRawVcs,\n )]"
        },
        {
            "sha": "90d7ed0275dc9eab14c2fcd3a3b82c7808ce97f7",
            "filename": "packages/next/src/build/swc/generated-native.d.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-native.d.ts?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -80,6 +80,10 @@ export interface NapiEnvVar {\n   name: RcStr\n   value: RcStr\n }\n+export interface NapiOptionEnvVar {\n+  name: RcStr\n+  value?: RcStr\n+}\n export interface NapiDraftModeOptions {\n   previewModeId: RcStr\n   previewModeEncryptionKey: RcStr\n@@ -184,9 +188,9 @@ export interface NapiPartialProjectOptions {\n   noMangling?: boolean\n }\n export interface NapiDefineEnv {\n-  client: Array<NapiEnvVar>\n-  edge: Array<NapiEnvVar>\n-  nodejs: Array<NapiEnvVar>\n+  client: Array<NapiOptionEnvVar>\n+  edge: Array<NapiOptionEnvVar>\n+  nodejs: Array<NapiOptionEnvVar>\n }\n export interface NapiTurboEngineOptions {\n   /** Use the new backend with persistent caching enabled. */"
        },
        {
            "sha": "90886d2f290bd757e78a6057dc8ca3dfcd26f935",
            "filename": "packages/next/src/build/swc/index.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -399,6 +399,7 @@ function logLoadFailure(attempts: any, triedWasm = false) {\n }\n \n type RustifiedEnv = { name: string; value: string }[]\n+type RustifiedOptionEnv = { name: string; value: string | undefined }[]\n \n export function createDefineEnv({\n   isTurbopack,\n@@ -421,7 +422,7 @@ export function createDefineEnv({\n   }\n \n   for (const variant of Object.keys(defineEnv) as (keyof typeof defineEnv)[]) {\n-    defineEnv[variant] = rustifyEnv(\n+    defineEnv[variant] = rustifyOptionEnv(\n       getDefineEnv({\n         isTurbopack,\n         clientRouterFilters,\n@@ -451,6 +452,15 @@ function rustifyEnv(env: Record<string, string>): RustifiedEnv {\n     }))\n }\n \n+function rustifyOptionEnv(\n+  env: Record<string, string | undefined>\n+): RustifiedOptionEnv {\n+  return Object.entries(env).map(([name, value]) => ({\n+    name,\n+    value,\n+  }))\n+}\n+\n // TODO(sokra) Support wasm option.\n function bindingToApi(\n   binding: RawBindings,"
        },
        {
            "sha": "5c3f074d1204d7afa100df529c65824ae9723eea",
            "filename": "packages/next/src/build/swc/types.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/21ff892d05e43644ebfd990d03d7f1742f9c46a7/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Ftypes.ts?ref=21ff892d05e43644ebfd990d03d7f1742f9c46a7",
            "patch": "@@ -431,12 +431,13 @@ export interface ProjectOptions {\n }\n \n export interface DefineEnv {\n-  client: RustifiedEnv\n-  edge: RustifiedEnv\n-  nodejs: RustifiedEnv\n+  client: RustifiedOptionalEnv\n+  edge: RustifiedOptionalEnv\n+  nodejs: RustifiedOptionalEnv\n }\n \n export type RustifiedEnv = { name: string; value: string }[]\n+export type RustifiedOptionalEnv = { name: string; value: string | undefined }[]\n \n export interface GlobalEntrypoints {\n   app: Endpoint | undefined"
        }
    ],
    "stats": {
        "total": 222,
        "additions": 99,
        "deletions": 123
    }
}