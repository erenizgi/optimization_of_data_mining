{
    "author": "eps1lon",
    "message": "[dev-overlay] Always show relative paths (#76742)",
    "sha": "059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
    "files": [
        {
            "sha": "086c8f1ed212d3991994b0ce6f2b0a417455a118",
            "filename": "packages/next/src/client/components/react-dev-overlay/server/middleware-turbopack.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 13,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -34,7 +34,7 @@ function shouldIgnorePath(modulePath: string): boolean {\n type IgnorableStackFrame = StackFrame & { ignored: boolean }\n \n const currentSourcesByFile: Map<string, Promise<string | null>> = new Map()\n-export async function batchedTraceSource(\n+async function batchedTraceSource(\n   project: Project,\n   frame: TurbopackStackFrame\n ): Promise<{ frame: IgnorableStackFrame; source: string | null } | undefined> {\n@@ -316,9 +316,7 @@ async function nativeTraceSource(\n             ?.replace('__WEBPACK_DEFAULT_EXPORT__', 'default')\n             ?.replace('__webpack_exports__.', '') || '<unknown>',\n         column: (originalPosition.column ?? 0) + 1,\n-        file: originalPosition.source?.startsWith('file://')\n-          ? relativeToCwd(originalPosition.source)\n-          : originalPosition.source,\n+        file: originalPosition.source,\n         lineNumber: originalPosition.line ?? 0,\n         // TODO: c&p from async createOriginalStackFrame but why not frame.arguments?\n         arguments: [],\n@@ -335,14 +333,9 @@ async function nativeTraceSource(\n   return undefined\n }\n \n-function relativeToCwd(file: string): string {\n-  const relPath = path.relative(process.cwd(), url.fileURLToPath(file))\n-  // TODO(sokra) include a ./ here to make it a relative path\n-  return relPath\n-}\n-\n async function createOriginalStackFrame(\n   project: Project,\n+  projectPath: string,\n   frame: TurbopackStackFrame\n ): Promise<OriginalStackFrameResponse | null> {\n   const traced =\n@@ -354,13 +347,31 @@ async function createOriginalStackFrame(\n     return null\n   }\n \n+  let normalizedStackFrameLocation = traced.frame.file\n+  if (\n+    normalizedStackFrameLocation !== null &&\n+    normalizedStackFrameLocation.startsWith('file://')\n+  ) {\n+    normalizedStackFrameLocation = path.relative(\n+      projectPath,\n+      url.fileURLToPath(normalizedStackFrameLocation)\n+    )\n+  }\n+\n   return {\n-    originalStackFrame: traced.frame,\n+    originalStackFrame: {\n+      arguments: traced.frame.arguments,\n+      column: traced.frame.column,\n+      file: normalizedStackFrameLocation,\n+      ignored: traced.frame.ignored,\n+      lineNumber: traced.frame.lineNumber,\n+      methodName: traced.frame.methodName,\n+    },\n     originalCodeFrame: getOriginalCodeFrame(traced.frame, traced.source),\n   }\n }\n \n-export function getOverlayMiddleware(project: Project) {\n+export function getOverlayMiddleware(project: Project, projectPath: string) {\n   return async function (\n     req: IncomingMessage,\n     res: ServerResponse,\n@@ -387,7 +398,11 @@ export function getOverlayMiddleware(project: Project) {\n       const result: OriginalStackFramesResponse = await Promise.all(\n         stackFrames.map(async (frame) => {\n           try {\n-            const stackFrame = await createOriginalStackFrame(project, frame)\n+            const stackFrame = await createOriginalStackFrame(\n+              project,\n+              projectPath,\n+              frame\n+            )\n             if (stackFrame === null) {\n               return {\n                 status: 'rejected',"
        },
        {
            "sha": "db1b7851c49a4c33b4dcfa870d543000edab1fb4",
            "filename": "packages/next/src/client/components/react-dev-overlay/server/middleware-webpack.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -471,9 +471,19 @@ async function getOriginalStackFrame({\n     },\n   })\n \n+  let defaultNormalizedStackFrameLocation = frame.file\n+  if (\n+    defaultNormalizedStackFrameLocation !== null &&\n+    defaultNormalizedStackFrameLocation.startsWith('file://')\n+  ) {\n+    defaultNormalizedStackFrameLocation = path.relative(\n+      rootDirectory,\n+      fileURLToPath(defaultNormalizedStackFrameLocation)\n+    )\n+  }\n   // This stack frame is used for the one that couldn't locate the source or source mapped frame\n   const defaultStackFrame: IgnorableStackFrame = {\n-    file: frame.file,\n+    file: defaultNormalizedStackFrameLocation,\n     lineNumber: frame.lineNumber,\n     column: frame.column ?? 1,\n     methodName: frame.methodName,"
        },
        {
            "sha": "c45e9a957a9c7b66ae4ab20969719cd1560f04be",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -161,7 +161,7 @@ export async function createHotReloaderTurbopack(\n ): Promise<NextJsHotReloaderInterface> {\n   const dev = true\n   const buildId = 'development'\n-  const { nextConfig, dir } = opts\n+  const { nextConfig, dir: projectPath } = opts\n \n   const { loadBindings } =\n     require('../../build/swc') as typeof import('../../build/swc')\n@@ -172,7 +172,7 @@ export async function createHotReloaderTurbopack(\n   // works correctly. Normally `run-test` hides output so only will be visible when `--debug` flag is used.\n   if (process.env.TURBOPACK && isTestMode) {\n     require('console').log('Creating turbopack project', {\n-      dir,\n+      dir: projectPath,\n       testMode: isTestMode,\n     })\n   }\n@@ -207,14 +207,14 @@ export async function createHotReloaderTurbopack(\n \n   const project = await bindings.turbo.createProject(\n     {\n-      projectPath: dir,\n+      projectPath: projectPath,\n       rootPath:\n         opts.nextConfig.experimental.turbo?.root ||\n         opts.nextConfig.outputFileTracingRoot ||\n-        dir,\n+        projectPath,\n       distDir,\n       nextConfig: opts.nextConfig,\n-      jsConfig: await getTurbopackJsConfig(dir, nextConfig),\n+      jsConfig: await getTurbopackJsConfig(projectPath, nextConfig),\n       watch: {\n         enable: dev,\n         pollIntervalMs: nextConfig.watchOptions?.pollIntervalMs,\n@@ -244,7 +244,7 @@ export async function createHotReloaderTurbopack(\n     }\n   )\n   setBundlerFindSourceMapImplementation(\n-    getSourceMapFromTurbopack.bind(null, project, dir)\n+    getSourceMapFromTurbopack.bind(null, project, projectPath)\n   )\n   opts.onDevServerCleanup?.(async () => {\n     setBundlerFindSourceMapImplementation(() => undefined)\n@@ -634,7 +634,7 @@ export async function createHotReloaderTurbopack(\n   )\n \n   const middlewares = [\n-    getOverlayMiddleware(project),\n+    getOverlayMiddleware(project, projectPath),\n     getSourceMapMiddleware(project),\n     getNextErrorFeedbackMiddleware(opts.telemetry),\n     getDevOverlayFontMiddleware(),\n@@ -957,7 +957,7 @@ export async function createHotReloaderTurbopack(\n           > =\n             definition ??\n             (await findPagePathData(\n-              dir,\n+              projectPath,\n               inputPage,\n               nextConfig.pageExtensions,\n               opts.pagesDir,"
        },
        {
            "sha": "e9b7142669d8e2d5378bee4f937906e8bcab68e8",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -115,15 +115,15 @@ describe('ReactRefreshLogBox app', () => {\n            |       ^\",\n          \"stack\": [\n            \"eval index.js (3:7)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n            \"eval ./app/page.js\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n          ],\n        }\n       `)\n@@ -1468,10 +1468,10 @@ describe('ReactRefreshLogBox app', () => {\n            \"stack\": [\n              \"eval index.js (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/server/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -1639,15 +1639,15 @@ export default function Home() {\n            |       ^\",\n          \"stack\": [\n            \"eval app/utils.ts (1:7)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n            \"eval ./app/page.js\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n+           \"<FIXME-next-dist-dir>\",\n          ],\n        }\n       `)"
        },
        {
            "sha": "9e9b11edb7420d475e141f964f07988aa836bbd5",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 37,
            "changes": 75,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -131,9 +131,9 @@ describe('ReactRefreshLogBox', () => {\n              |       ^\",\n            \"stack\": [\n              \"[project]/index.js [ssr] (ecmascript) index.js (3:7)\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -149,18 +149,18 @@ describe('ReactRefreshLogBox', () => {\n              |       ^\",\n            \"stack\": [\n              \"eval index.js (3:7)\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n              \"eval ./pages/index.js\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -178,9 +178,9 @@ describe('ReactRefreshLogBox', () => {\n              |       ^\",\n            \"stack\": [\n              \"[project]/index.js [ssr] (ecmascript) index.js (3:7)\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -196,18 +196,18 @@ describe('ReactRefreshLogBox', () => {\n              |       ^\",\n            \"stack\": [\n              \"eval index.js (3:7)\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n              \"eval ./pages/index.js\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n+             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -284,8 +284,8 @@ describe('ReactRefreshLogBox', () => {\n          \"stack\": [\n            \"FunctionDefault FunctionDefault.js (1:51)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -302,8 +302,8 @@ describe('ReactRefreshLogBox', () => {\n          \"stack\": [\n            \"FunctionDefault FunctionDefault.js (1:51)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -413,7 +413,6 @@ describe('ReactRefreshLogBox', () => {\n     }\n   })\n \n-  // Module trace is only available with webpack 5\n   test('conversion to class component (1)', async () => {\n     await using sandbox = await createSandbox(next)\n     const { browser, session } = sandbox\n@@ -459,6 +458,8 @@ describe('ReactRefreshLogBox', () => {\n       `\n     )\n \n+    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n+    // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     if (isReact18) {\n       await expect(browser).toDisplayRedbox(`\n        {\n@@ -472,8 +473,8 @@ describe('ReactRefreshLogBox', () => {\n          \"stack\": [\n            \"ClickCount.render Child.js (4:11)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -490,8 +491,8 @@ describe('ReactRefreshLogBox', () => {\n          \"stack\": [\n            \"ClickCount.render Child.js (4:11)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)"
        },
        {
            "sha": "5fa42335eb0332b7ee7e6dde4719822a8072dd9a",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 26,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -249,6 +249,8 @@ describe('pages/ error recovery', () => {\n       `\n     )\n \n+    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n+    // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n     if (isReact18) {\n       await expect(browser).toDisplayRedbox(`\n@@ -263,8 +265,8 @@ describe('pages/ error recovery', () => {\n          \"stack\": [\n            \"Child child.js (3:9)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -281,8 +283,8 @@ describe('pages/ error recovery', () => {\n          \"stack\": [\n            \"Child child.js (3:9)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -527,6 +529,8 @@ describe('pages/ error recovery', () => {\n       await expect(session.getRedboxSource()).resolves.toInclude('render() {')\n     })\n \n+    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n+    // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n     if (isReact18) {\n       await expect(browser).toDisplayRedbox(`\n@@ -541,8 +545,8 @@ describe('pages/ error recovery', () => {\n          \"stack\": [\n            \"ClassDefault.render index.js (5:11)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -564,22 +568,22 @@ describe('pages/ error recovery', () => {\n         `)\n       } else {\n         await expect(browser).toDisplayRedbox(`\n-                {\n-                  \"count\": 1,\n-                  \"description\": \"Error: nooo\",\n-                  \"environmentLabel\": null,\n-                  \"label\": \"Unhandled Runtime Error\",\n-                  \"source\": \"index.js (5:11) @ ClassDefault.render\n-                > 5 |     throw new Error('nooo');\n-                    |           ^\",\n-                  \"stack\": [\n-                    \"ClassDefault.render index.js (5:11)\",\n-                    \"Set.forEach <anonymous> (0:0)\",\n-                    \"<FIXME-file-protocol>\",\n-                    \"<FIXME-file-protocol>\",\n-                  ],\n-                }\n-              `)\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: nooo\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Unhandled Runtime Error\",\n+           \"source\": \"index.js (5:11) @ ClassDefault.render\n+         > 5 |     throw new Error('nooo');\n+             |           ^\",\n+           \"stack\": [\n+             \"ClassDefault.render index.js (5:11)\",\n+             \"Set.forEach <anonymous> (0:0)\",\n+             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           ],\n+         }\n+        `)\n       }\n     }\n   })\n@@ -627,6 +631,8 @@ describe('pages/ error recovery', () => {\n       `\n     )\n \n+    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n+    // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // We get an error because Foo didn't import React. Fair.\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n     if (isReact18) {\n@@ -642,8 +648,8 @@ describe('pages/ error recovery', () => {\n          \"stack\": [\n            \"Foo Foo.js (3:3)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)\n@@ -660,8 +666,8 @@ describe('pages/ error recovery', () => {\n          \"stack\": [\n            \"Foo Foo.js (3:3)\",\n            \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n+           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n          ],\n        }\n       `)"
        },
        {
            "sha": "981301d28a7f190606422334ef5f3e00bb09d433",
            "filename": "test/development/pages-dir/client-navigation/index.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -1482,10 +1482,10 @@ describe('Client Navigation', () => {\n                |         ^\",\n              \"stack\": [\n                \"eval pages/error-in-the-browser-global-scope.js (2:9)\",\n-               \"<FIXME-file-protocol>\",\n-               \"<FIXME-file-protocol>\",\n-               \"<FIXME-file-protocol>\",\n-               \"<FIXME-file-protocol>\",\n+               \"<FIXME-next-dist-dir>\",\n+               \"<FIXME-next-dist-dir>\",\n+               \"<FIXME-next-dist-dir>\",\n+               \"<FIXME-next-dist-dir>\",\n              ],\n            }\n           `)"
        },
        {
            "sha": "8b93b42d174fd46c288ead01a9f71edf6aa8cb2c",
            "filename": "test/e2e/app-dir/non-root-project-monorepo/non-root-project-monorepo.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/059c255c37f7ddd5b56af4a21150fc06ef2b63cd/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts?ref=059c255c37f7ddd5b56af4a21150fc06ef2b63cd",
            "patch": "@@ -171,10 +171,10 @@ describe('non-root-project-monorepo', () => {\n           expect(normalizeStackTrace(await getRedboxCallStack(browser)))\n             .toMatchInlineSnapshot(`\n            \"eval app/separate-file.ts (1:7)\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n            innerArrowFunction app/source-maps-ssr/page.tsx (16:3)\n            innerFunction app/source-maps-ssr/page.tsx (12:3)\n            Page app/source-maps-ssr/page.tsx (6:5)\"\n@@ -216,10 +216,10 @@ describe('non-root-project-monorepo', () => {\n           expect(normalizeStackTrace(await getRedboxCallStack(browser)))\n             .toMatchInlineSnapshot(`\n            \"eval app/separate-file.ts (1:7)\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n-           <FIXME-file-protocol>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n+           <FIXME-next-dist-dir>\n            innerArrowFunction app/source-maps-client/page.tsx (17:3)\n            innerFunction app/source-maps-client/page.tsx (13:3)\n            effectCallback app/source-maps-client/page.tsx (7:5)\""
        }
    ],
    "stats": {
        "total": 262,
        "additions": 147,
        "deletions": 115
    }
}