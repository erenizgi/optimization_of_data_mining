{
    "author": "devjiwonchoi",
    "message": "[dev-overlay] feat: dev indicator menu route info popover (#76153)\n\n### What?\r\n\r\nThis PR added a menu item's specific info popover for Route.\r\n\r\nhttps://github.com/user-attachments/assets/63a3df65-f367-471a-a33a-30a7c6377485\r\n\r\n| Static | Dynamic |\r\n|--------|--------|\r\n| ![CleanShot 2025-02-18 at 21 48 38@2x](https://github.com/user-attachments/assets/70e0d7c1-9390-43f2-9fd2-92f1477c8028) | ![CleanShot 2025-02-18 at 21 48 10@2x](https://github.com/user-attachments/assets/353404d4-2c9a-46f3-9beb-c8eb26bd0f79) | \r\n\r\nCloses NDX-815\r\nCloses NDX-849",
    "sha": "0c946eb20dea56211bf15940bf406fe82d31c613",
    "files": [
        {
            "sha": "2cb1ed2d1084b81759692bdec6780ee02d8048ae",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 15,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=0c946eb20dea56211bf15940bf406fe82d31c613",
            "patch": "@@ -59,43 +59,41 @@ const state: OverlayState = {\n   rootLayoutMissingTags: [],\n   versionInfo: mockVersionInfo,\n   notFound: false,\n-  staticIndicator: false,\n+  staticIndicator: true,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n }\n \n-export const NoErrors: Story = {\n+export const StaticRoute: Story = {\n   args: {\n     errorCount: 0,\n     state,\n     setIsErrorOverlayOpen: () => {},\n   },\n }\n \n-export const SingleError: Story = {\n+export const DynamicRoute: Story = {\n   args: {\n-    errorCount: 1,\n-    state,\n+    errorCount: 0,\n+    state: {\n+      ...state,\n+      staticIndicator: false,\n+    },\n     setIsErrorOverlayOpen: () => {},\n   },\n }\n \n-export const MultipleErrors: Story = {\n+export const SingleError: Story = {\n   args: {\n-    errorCount: 3,\n+    errorCount: 1,\n     state,\n     setIsErrorOverlayOpen: () => {},\n   },\n }\n \n-export const WithStaticIndicator: Story = {\n+export const MultipleErrors: Story = {\n   args: {\n     errorCount: 3,\n-    state: {\n-      ...state,\n-      staticIndicator: true,\n-    },\n-    setIsErrorOverlayOpen: () => {\n-      console.log('setIsErrorOverlayOpen called')\n-    },\n+    state,\n+    setIsErrorOverlayOpen: () => {},\n   },\n }"
        },
        {
            "sha": "cce9013de1176c775e3cbac41533e77d46682a22",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 39,
            "deletions": 2,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=0c946eb20dea56211bf15940bf406fe82d31c613",
            "patch": "@@ -9,6 +9,7 @@ import { useIsDevRendering } from './internal/dev-render-indicator'\n import { useDelayedRender } from '../../../hooks/use-delayed-render'\n import { noop as css } from '../../../helpers/noop-template'\n import { TurbopackInfo } from './dev-tools-info/turbopack-info'\n+import { RouteInfo } from './dev-tools-info/route-info'\n \n // TODO: add E2E tests to cover different scenarios\n \n@@ -86,8 +87,11 @@ function DevToolsPopover({\n   const triggerRef = useRef<HTMLButtonElement | null>(null)\n   const turbopackRef = useRef<HTMLElement>(null)\n   const triggerTurbopackRef = useRef<HTMLButtonElement | null>(null)\n+  const routeInfoRef = useRef<HTMLElement>(null)\n+  const triggerRouteInfoRef = useRef<HTMLButtonElement | null>(null)\n   const [isMenuOpen, setIsMenuOpen] = useState(false)\n   const [isTurbopackInfoOpen, setIsTurbopackInfoOpen] = useState(false)\n+  const [isRouteInfoOpen, setIsRouteInfoOpen] = useState(false)\n   const [selectedIndex, setSelectedIndex] = useState(-1)\n \n   // This hook lets us do an exit animation before unmounting the component\n@@ -105,6 +109,11 @@ function DevToolsPopover({\n       enterDelay: 0,\n       exitDelay: ANIMATE_OUT_DURATION_MS,\n     })\n+  const { mounted: routeInfoMounted, rendered: routeInfoRendered } =\n+    useDelayedRender(isRouteInfoOpen, {\n+      enterDelay: 0,\n+      exitDelay: ANIMATE_OUT_DURATION_MS,\n+    })\n \n   // Features to make the menu accessible\n   useFocusTrap(menuRef, triggerRef, isMenuOpen)\n@@ -116,6 +125,13 @@ function DevToolsPopover({\n     isTurbopackInfoOpen,\n     closeTurbopackInfo\n   )\n+  useFocusTrap(routeInfoRef, triggerRouteInfoRef, isRouteInfoOpen)\n+  useClickOutside(\n+    routeInfoRef,\n+    triggerRouteInfoRef,\n+    isRouteInfoOpen,\n+    closeRouteInfo\n+  )\n \n   function select(index: number | 'first' | 'last') {\n     if (index === 'first') {\n@@ -214,6 +230,10 @@ function DevToolsPopover({\n     setIsTurbopackInfoOpen(false)\n   }\n \n+  function closeRouteInfo() {\n+    setIsRouteInfoOpen(false)\n+  }\n+\n   const [vertical, horizontal] = position.split('-', 2)\n \n   return (\n@@ -245,6 +265,21 @@ function DevToolsPopover({\n         isDevRendering={useIsDevRendering()}\n       />\n \n+      {routeInfoMounted && (\n+        <RouteInfo\n+          ref={routeInfoRef}\n+          routeType={isStaticRoute ? 'Static' : 'Dynamic'}\n+          isOpen={isRouteInfoOpen}\n+          setIsOpen={setIsRouteInfoOpen}\n+          setPreviousOpen={setIsMenuOpen}\n+          style={{\n+            [vertical]: 'calc(100% + var(--size-gap))',\n+            [horizontal]: 0,\n+          }}\n+          data-rendered={routeInfoRendered}\n+        />\n+      )}\n+\n       {turbopackInfoMounted && (\n         <TurbopackInfo\n           ref={turbopackRef}\n@@ -298,14 +333,16 @@ function DevToolsPopover({\n               )}\n               <MenuItem\n                 label=\"Route\"\n+                index={1}\n                 value={isStaticRoute ? 'Static' : 'Dynamic'}\n+                onClick={() => setIsRouteInfoOpen(true)}\n                 data-nextjs-route-type={isStaticRoute ? 'static' : 'dynamic'}\n               />\n               {isTurbopack ? (\n                 <MenuItem label=\"Turbopack\" value=\"Enabled\" />\n               ) : (\n                 <MenuItem\n-                  index={1}\n+                  index={2}\n                   label=\"Try Turbopack\"\n                   value={<ChevronRight />}\n                   onClick={() => setIsTurbopackInfoOpen(true)}\n@@ -319,7 +356,7 @@ function DevToolsPopover({\n                 label=\"Hide Dev Tools\"\n                 value={<Cross color=\"var(--color-gray-900)\" />}\n                 onClick={hide}\n-                index={isTurbopack ? 1 : 2}\n+                index={isTurbopack ? 2 : 3}\n               />\n             </div>\n           </Context.Provider>"
        },
        {
            "sha": "fd300ce2139644cc797a902af77fb1985ffa7f03",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-info/dev-tools-info.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx?ref=0c946eb20dea56211bf15940bf406fe82d31c613",
            "patch": "@@ -60,7 +60,7 @@ export const DEV_TOOLS_INFO_STYLES = css`\n     overflow: hidden;\n     opacity: 0;\n     outline: 0;\n-    min-width: 248px;\n+    min-width: 350px;\n     transition: opacity var(--animate-out-duration-ms)\n       var(--animate-out-timing-function);\n "
        },
        {
            "sha": "9fa3ffc018162cdbb981735c04a172f04611d8bb",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-info/route-info.tsx",
            "status": "added",
            "additions": 111,
            "deletions": 0,
            "changes": 111,
            "blob_url": "https://github.com/vercel/next.js/blob/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx?ref=0c946eb20dea56211bf15940bf406fe82d31c613",
            "patch": "@@ -0,0 +1,111 @@\n+import { DevToolsInfo } from './dev-tools-info'\n+import { noop as css } from '../../../../helpers/noop-template'\n+\n+function StaticRouteContent() {\n+  return (\n+    <article className=\"dev-tools-info-article\">\n+      <p className=\"dev-tools-info-paragraph\">\n+        The path{' '}\n+        <code className=\"dev-tools-info-code\">{window.location.pathname}</code>{' '}\n+        is marked as \"static\" since it will be prerendered during the build\n+        time.\n+      </p>\n+      <p className=\"dev-tools-info-paragraph\">\n+        With Static Rendering, routes are rendered at build time, or in the\n+        background after{' '}\n+        <a\n+          className=\"dev-tools-info-link\"\n+          href=\"https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          data revalidation\n+        </a>\n+        .\n+      </p>\n+      <p className=\"dev-tools-info-paragraph\">\n+        Static rendering is useful when a route has data that is not\n+        personalized to the user and can be known at build time, such as a\n+        static blog post or a product page.\n+      </p>\n+    </article>\n+  )\n+}\n+\n+function DynamicRouteContent() {\n+  return (\n+    <article className=\"dev-tools-info-article\">\n+      <p className=\"dev-tools-info-paragraph\">\n+        The path{' '}\n+        <code className=\"dev-tools-info-code\">{window.location.pathname}</code>{' '}\n+        is marked as \"dynamic\" since it will be rendered for each user at{' '}\n+        <strong>request time</strong>.\n+      </p>\n+      <p className=\"dev-tools-info-paragraph\">\n+        Dynamic rendering is useful when a route has data that is personalized\n+        to the user or has information that can only be known at request time,\n+        such as cookies or the URL's search params.\n+      </p>\n+      <p className=\"dev-tools-info-paragraph\">\n+        During rendering, if a{' '}\n+        <a\n+          className=\"dev-tools-info-link\"\n+          href=\"https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-apis\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          Dynamic API\n+        </a>{' '}\n+        or a{' '}\n+        <a\n+          className=\"dev-tools-info-link\"\n+          href=\"https://nextjs.org/docs/app/api-reference/functions/fetch\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          fetch\n+        </a>{' '}\n+        option of{' '}\n+        <code className=\"dev-tools-info-code\">{`{ cache: 'no-store' }`}</code>{' '}\n+        is discovered, Next.js will switch to dynamically rendering the whole\n+        route.\n+      </p>\n+    </article>\n+  )\n+}\n+\n+export function RouteInfo({\n+  routeType,\n+  isOpen,\n+  setIsOpen,\n+  setPreviousOpen,\n+  ...props\n+}: {\n+  routeType: 'Static' | 'Dynamic'\n+  isOpen: boolean\n+  setIsOpen: (isOpen: boolean) => void\n+  setPreviousOpen: (isOpen: boolean) => void\n+  style?: React.CSSProperties\n+  ref?: React.RefObject<HTMLElement | null>\n+}) {\n+  const isStaticRoute = routeType === 'Static'\n+  const learnMoreLink = isStaticRoute\n+    ? 'https://nextjs.org/docs/app/building-your-application/rendering/server-components#static-rendering-default'\n+    : 'https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering'\n+  return (\n+    <DevToolsInfo\n+      {...props}\n+      title={`${routeType} Route`}\n+      learnMoreLink={learnMoreLink}\n+      setIsOpen={setIsOpen}\n+      setPreviousOpen={setPreviousOpen}\n+    >\n+      {isStaticRoute ? <StaticRouteContent /> : <DynamicRouteContent />}\n+    </DevToolsInfo>\n+  )\n+}\n+\n+export const DEV_TOOLS_INFO_ROUTE_INFO_STYLES = css`\n+  .dev-tools-info-link {\n+  }\n+`"
        },
        {
            "sha": "7c351a7119e3528a99345f116111869efec27b70",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/styles/component-styles.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0c946eb20dea56211bf15940bf406fe82d31c613/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx?ref=0c946eb20dea56211bf15940bf406fe82d31c613",
            "patch": "@@ -19,6 +19,7 @@ import { EDITOR_LINK_STYLES } from '../components/terminal/editor-link'\n import { ENVIRONMENT_NAME_LABEL_STYLES } from '../components/errors/environment-name-label/environment-name-label'\n import { DEV_TOOLS_INFO_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/dev-tools-info'\n import { DEV_TOOLS_INFO_TURBOPACK_INFO_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/turbopack-info'\n+import { DEV_TOOLS_INFO_ROUTE_INFO_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/route-info'\n \n export function ComponentStyles() {\n   return (\n@@ -44,6 +45,7 @@ export function ComponentStyles() {\n         ${DEV_TOOLS_INDICATOR_STYLES}\n         ${DEV_TOOLS_INFO_STYLES}\n         ${DEV_TOOLS_INFO_TURBOPACK_INFO_STYLES}\n+        ${DEV_TOOLS_INFO_ROUTE_INFO_STYLES}\n       `}\n     </style>\n   )"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 166,
        "deletions": 18
    }
}