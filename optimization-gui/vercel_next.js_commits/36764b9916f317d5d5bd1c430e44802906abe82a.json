{
    "author": "mischnic",
    "message": "Turbopack: fix source map panic (#81212)\n\nFix a panic, related to scope hoisting.\n```\nAn error occurred while generating the chunk item X\nCaused by:\n- Cannot decode dummy BytePos\n```\n\n```\nthread 'tokio-runtime-worker' panicked at turbopack/crates/turbopack-ecmascript/src/lib.rs:2431:13:\nCannot decode dummy BytePos\nstack backtrace:\n   0: __rustc::rust_begin_unwind\n             at /rustc/59aa1e873028948faaf8b97e5e02d4db340ad7b1/library/std/src/panicking.rs:697:5\n   1: core::panicking::panic_fmt\n             at /rustc/59aa1e873028948faaf8b97e5e02d4db340ad7b1/library/core/src/panicking.rs:75:14\n   2: <turbopack_ecmascript::CodeGenResultComments>::decode_bytepos\n             at next.js/turbopack/crates/turbopack-ecmascript/src/lib.rs:2431:13\n   3: <turbopack_ecmascript::CodeGenResultCommentsConsumable as swc_common::comments::Comments>::has_leading\n             at next.js/turbopack/crates/turbopack-ecmascript/src/lib.rs:2499:21\n   4: <swc_ecma_codegen::Emitter<swc_ecma_codegen::text_writer::basic_impl::JsWriter<&mut alloc::vec::Vec<u8>>, turbopack_ecmascript::CodeGenResultSourceMap>>::has_leading_comment\n             at .cargo/registry/src/index.crates.io-1949cf8c6b5b557f/swc_ecma_codegen-15.0.1/src/lib.rs:839:24\n   5: <swc_ecma_codegen::Emitter<swc_ecma_codegen::text_writer::basic_impl::JsWriter<&mut alloc::vec::Vec<u8>>, turbopack_ecmascript::CodeGenResultSourceMap>>::has_leading_comment\n             at .cargo/registry/src/index.crates.io-1949cf8c6b5b557f/swc_ecma_codegen-15.0.1/src/lib.rs:830:29\n```",
    "sha": "36764b9916f317d5d5bd1c430e44802906abe82a",
    "files": [
        {
            "sha": "cf418a9660dec11e35017def68dd67ef6f0598e9",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 25,
            "deletions": 7,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/36764b9916f317d5d5bd1c430e44802906abe82a/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/36764b9916f317d5d5bd1c430e44802906abe82a/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=36764b9916f317d5d5bd1c430e44802906abe82a",
            "patch": "@@ -2498,14 +2498,17 @@ fn encode_module_into_comment_span(\n \n impl Comments for CodeGenResultCommentsConsumable<'_> {\n     fn add_leading(&self, _pos: BytePos, _cmt: Comment) {\n-        unimplemented!()\n+        unimplemented!(\"add_leading\")\n     }\n \n     fn add_leading_comments(&self, _pos: BytePos, _comments: Vec<Comment>) {\n-        unimplemented!()\n+        unimplemented!(\"add_leading_comments\")\n     }\n \n     fn has_leading(&self, pos: BytePos) -> bool {\n+        if pos.is_dummy() {\n+            return false;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2524,10 +2527,13 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn move_leading(&self, _from: BytePos, _to: BytePos) {\n-        unimplemented!()\n+        unimplemented!(\"move_leading\")\n     }\n \n     fn take_leading(&self, pos: BytePos) -> Option<Vec<Comment>> {\n+        if pos.is_dummy() {\n+            return None;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2551,6 +2557,9 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn get_leading(&self, pos: BytePos) -> Option<Vec<Comment>> {\n+        if pos.is_dummy() {\n+            return None;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2574,14 +2583,17 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn add_trailing(&self, _pos: BytePos, _cmt: Comment) {\n-        unimplemented!()\n+        unimplemented!(\"add_trailing\")\n     }\n \n     fn add_trailing_comments(&self, _pos: BytePos, _comments: Vec<Comment>) {\n-        unimplemented!()\n+        unimplemented!(\"add_trailing_comments\")\n     }\n \n     fn has_trailing(&self, pos: BytePos) -> bool {\n+        if pos.is_dummy() {\n+            return false;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2600,10 +2612,13 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn move_trailing(&self, _from: BytePos, _to: BytePos) {\n-        unimplemented!()\n+        unimplemented!(\"move_trailing\")\n     }\n \n     fn take_trailing(&self, pos: BytePos) -> Option<Vec<Comment>> {\n+        if pos.is_dummy() {\n+            return None;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2630,6 +2645,9 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn get_trailing(&self, pos: BytePos) -> Option<Vec<Comment>> {\n+        if pos.is_dummy() {\n+            return None;\n+        }\n         match self {\n             Self::Single {\n                 comments,\n@@ -2653,7 +2671,7 @@ impl Comments for CodeGenResultCommentsConsumable<'_> {\n     }\n \n     fn add_pure_comment(&self, _pos: BytePos) {\n-        unimplemented!()\n+        unimplemented!(\"add_pure_comment\")\n     }\n }\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 25,
        "deletions": 7
    }
}