{
    "author": "mischnic",
    "message": "Turbopack: remove OptionStringifiedSourceMap (#86547)\n\n- `OptionStringifiedSourceMap` was always a strange type\n- We can now use the `FileContent` to not clone the Rope in the `SourceMapAsset::content`, which would end up duplicating sourcemaps in the cache.",
    "sha": "112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
    "files": [
        {
            "sha": "a7d40e8d7eb5057fae84e256a98b36754dc0af53",
            "filename": "crates/napi/src/next_api/project.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -51,7 +51,7 @@ use turbopack_core::{\n     error::PrettyPrintError,\n     issue::PlainIssue,\n     output::{OutputAsset, OutputAssets},\n-    source_map::{OptionStringifiedSourceMap, SourceMap, Token},\n+    source_map::{SourceMap, Token},\n     version::{PartialUpdate, TotalUpdate, Update, VersionState},\n };\n use turbopack_ecmascript_hmr_protocol::{ClientUpdateInstruction, Issue, ResourceIdentifier};\n@@ -1550,7 +1550,7 @@ pub struct OptionStackFrame(Option<StackFrame>);\n pub async fn get_source_map_rope(\n     container: Vc<ProjectContainer>,\n     source_url: RcStr,\n-) -> Result<Vc<OptionStringifiedSourceMap>> {\n+) -> Result<Vc<FileContent>> {\n     let (file_path_sys, module) = match Url::parse(&source_url) {\n         Ok(url) => match url.scheme() {\n             \"file\" => {\n@@ -1579,7 +1579,7 @@ pub async fn get_source_map_rope(\n             Some(relative_path) => sys_to_unix(relative_path),\n             None => {\n                 // File doesn't exist within the dist dir\n-                return Ok(OptionStringifiedSourceMap::none());\n+                return Ok(FileContent::NotFound.cell());\n             }\n         };\n \n@@ -1597,13 +1597,13 @@ pub async fn get_source_map_rope(\n \n     let mut map = container.get_source_map(server_path, module.clone());\n \n-    if map.await?.is_none() {\n+    if !map.await?.is_content() {\n         // If the chunk doesn't exist as a server chunk, try a client chunk.\n         // TODO: Properly tag all server chunks and use the `isServer` query param.\n         // Currently, this is inaccurate as it does not cover RSC server\n         // chunks.\n         map = container.get_source_map(client_path, module);\n-        if map.await?.is_none() {\n+        if !map.await?.is_content() {\n             bail!(\"chunk/module '{}' is missing a sourcemap\", source_url);\n         }\n     }\n@@ -1615,7 +1615,7 @@ pub async fn get_source_map_rope(\n pub fn get_source_map_rope_operation(\n     container: ResolvedVc<ProjectContainer>,\n     file_path: RcStr,\n-) -> Vc<OptionStringifiedSourceMap> {\n+) -> Vc<FileContent> {\n     get_source_map_rope(*container, file_path)\n }\n \n@@ -1782,13 +1782,13 @@ pub async fn project_get_source_map(\n     let ctx = &project.turbopack_ctx;\n     ctx.turbo_tasks()\n         .run(async move {\n-            let Some(map) = &*get_source_map_rope_operation(container, file_path)\n+            let source_map = get_source_map_rope_operation(container, file_path)\n                 .read_strongly_consistent()\n-                .await?\n-            else {\n+                .await?;\n+            let Some(map) = source_map.as_content() else {\n                 return Ok(None);\n             };\n-            Ok(Some(map.to_str()?.to_string()))\n+            Ok(Some(map.content().to_str()?.to_string()))\n         })\n         // HACK: Don't use `TurbopackInternalError`, this function is race-condition prone (the\n         // source files may have changed or been deleted), so these probably aren't internal errors?"
        },
        {
            "sha": "55f6a89113c28fbf590cad8c9850ce3a60fb9b79",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -33,7 +33,9 @@ use turbo_tasks::{\n     debug::ValueDebugFormat, fxindexmap, mark_root, trace::TraceRawVcs,\n };\n use turbo_tasks_env::{EnvMap, ProcessEnv};\n-use turbo_tasks_fs::{DiskFileSystem, FileSystem, FileSystemPath, VirtualFileSystem, invalidation};\n+use turbo_tasks_fs::{\n+    DiskFileSystem, FileContent, FileSystem, FileSystemPath, VirtualFileSystem, invalidation,\n+};\n use turbo_unix_path::{join_path, unix_to_sys};\n use turbopack::{\n     ModuleAssetContext, evaluate_context::node_build_environment,\n@@ -70,7 +72,6 @@ use turbopack_core::{\n     },\n     reference::all_assets_from_entries,\n     resolve::{FindContextFileResult, find_context_file},\n-    source_map::OptionStringifiedSourceMap,\n     version::{\n         NotFoundVersion, OptionVersionedContent, Update, Version, VersionState, VersionedContent,\n     },\n@@ -552,17 +553,17 @@ impl ProjectContainer {\n     }\n \n     /// Gets a source map for a particular `file_path`. If `dev` mode is disabled, this will always\n-    /// return [`OptionStringifiedSourceMap::none`].\n+    /// return [`FileContent::NotFound`].\n     #[turbo_tasks::function]\n     pub fn get_source_map(\n         &self,\n         file_path: FileSystemPath,\n         section: Option<RcStr>,\n-    ) -> Vc<OptionStringifiedSourceMap> {\n+    ) -> Vc<FileContent> {\n         if let Some(map) = self.versioned_content_map {\n             map.get_source_map(file_path, section)\n         } else {\n-            OptionStringifiedSourceMap::none()\n+            FileContent::NotFound.cell()\n         }\n     }\n }"
        },
        {
            "sha": "abba15b04cb97668a3443d6d1cc4926896a7c1dd",
            "filename": "crates/next-api/src/versioned_content_map.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-api%2Fsrc%2Fversioned_content_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-api%2Fsrc%2Fversioned_content_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fversioned_content_map.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -7,11 +7,11 @@ use turbo_tasks::{\n     FxIndexSet, NonLocalValue, OperationValue, OperationVc, ResolvedVc, State, TryFlatJoinIterExt,\n     TryJoinIterExt, ValueDefault, Vc, debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n-use turbo_tasks_fs::FileSystemPath;\n+use turbo_tasks_fs::{FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::Asset,\n     output::{ExpandedOutputAssets, OptionOutputAsset, OutputAsset},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap},\n+    source_map::GenerateSourceMap,\n     version::OptionVersionedContent,\n };\n \n@@ -180,9 +180,9 @@ impl VersionedContentMap {\n         self: Vc<Self>,\n         path: FileSystemPath,\n         section: Option<RcStr>,\n-    ) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    ) -> Result<Vc<FileContent>> {\n         let Some(asset) = &*self.get_asset(path.clone()).await? else {\n-            return Ok(Vc::cell(None));\n+            return Ok(FileContent::NotFound.cell());\n         };\n \n         if let Some(generate_source_map) ="
        },
        {
            "sha": "58d76d8d04498f0d28ed041fac51b0ce0108b9da",
            "filename": "crates/next-core/src/raw_ecmascript_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-core%2Fsrc%2Fraw_ecmascript_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/crates%2Fnext-core%2Fsrc%2Fraw_ecmascript_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fraw_ecmascript_module.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -272,7 +272,8 @@ impl EcmascriptChunkItem for RawEcmascriptChunkItem {\n             )\n             .await?\n             {\n-                source_map.generate_source_map().owned().await?\n+                let source_map = source_map.generate_source_map().await?;\n+                source_map.as_content().map(|f| f.content().clone())\n             } else {\n                 None\n             };"
        },
        {
            "sha": "325241b33dc649ae37072f1cf20aa220c86cb341",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1766,6 +1766,7 @@ impl From<File> for FileContent {\n     }\n }\n \n+// TODO remove this, it hides cell creation\n impl From<File> for Vc<FileContent> {\n     fn from(file: File) -> Self {\n         FileContent::Content(file).cell()"
        },
        {
            "sha": "7b4eefb6fd67e5aed4d63b3d00ffe30e8814339a",
            "filename": "turbopack/crates/turbopack-analyze/src/split_chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -47,10 +47,11 @@ pub async fn split_output_asset_into_parts(\n     else {\n         return self_mapped(asset, content).await;\n     };\n-    let Some(source_map) = &*generate_source_map.generate_source_map().await? else {\n+    let source_map = generate_source_map.generate_source_map().await?;\n+    let Some(source_map) = source_map.as_content() else {\n         return self_mapped(asset, content).await;\n     };\n-    let Some(source_map) = SourceMap::new_from_rope(source_map)? else {\n+    let Some(source_map) = SourceMap::new_from_rope(source_map.content())? else {\n         return unaccounted(asset, content).await;\n     };\n "
        },
        {
            "sha": "0f60ce5de029ca03e16b9b15070aaf10d5ab2ef6",
            "filename": "turbopack/crates/turbopack-analyze/tests/split_chunk.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -6,14 +6,16 @@ use anyhow::Result;\n use serde_json::json;\n use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::{File, FileSystem, FileSystemPath, VirtualFileSystem, rope::Rope};\n+use turbo_tasks_fs::{\n+    File, FileContent, FileSystem, FileSystemPath, VirtualFileSystem, rope::Rope,\n+};\n use turbo_tasks_testing::{Registration, register, run_once};\n use turbopack_analyze::split_chunk::{ChunkPart, ChunkPartRange, split_output_asset_into_parts};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     code_builder::{Code, CodeBuilder},\n     output::{OutputAsset, OutputAssetsReference},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap},\n+    source_map::GenerateSourceMap,\n };\n \n static REGISTRATION: Registration = register!(turbo_tasks_fetch::register);\n@@ -130,7 +132,7 @@ impl Asset for TestAsset {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for TestAsset {\n     #[turbo_tasks::function]\n-    pub fn generate_source_map(&self) -> Vc<OptionStringifiedSourceMap> {\n+    pub fn generate_source_map(&self) -> Vc<FileContent> {\n         self.code.generate_source_map()\n     }\n }"
        },
        {
            "sha": "3716c491d721b401157794de2911441370685f25",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/chunk.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1,14 +1,14 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::FileSystemPath;\n+use turbo_tasks_fs::{FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{Chunk, ChunkingContext, OutputChunk, OutputChunkRuntimeInfo},\n     ident::AssetIdent,\n     introspect::{Introspectable, IntrospectableChildren},\n     output::{OutputAsset, OutputAssetsReference, OutputAssetsWithReferenced},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n     version::VersionedContent,\n };\n use turbopack_ecmascript::chunk::EcmascriptChunk;\n@@ -157,12 +157,12 @@ impl Asset for EcmascriptBrowserChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBrowserChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.own_content().generate_source_map()\n     }\n \n     #[turbo_tasks::function]\n-    fn by_section(self: Vc<Self>, section: RcStr) -> Vc<OptionStringifiedSourceMap> {\n+    fn by_section(self: Vc<Self>, section: RcStr) -> Vc<FileContent> {\n         self.own_content().by_section(section)\n     }\n }"
        },
        {
            "sha": "8c8cf065ceb3f8a60f69d5f715df5986ef616e29",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/content.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fcontent.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fcontent.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fcontent.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -4,13 +4,13 @@ use anyhow::{Result, bail};\n use either::Either;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::File;\n+use turbo_tasks_fs::{File, FileContent};\n use turbopack_core::{\n     asset::AssetContent,\n     chunk::{ChunkingContext, MinifyType, ModuleId},\n     code_builder::{Code, CodeBuilder},\n     output::OutputAsset,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n     version::{MergeableVersionedContent, Version, VersionedContent, VersionedContentMerger},\n };\n use turbopack_ecmascript::{chunk::EcmascriptChunkContent, minify::minify, utils::StringifyJs};\n@@ -166,12 +166,12 @@ impl MergeableVersionedContent for EcmascriptBrowserChunkContent {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBrowserChunkContent {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n \n     #[turbo_tasks::function]\n-    async fn by_section(self: Vc<Self>, section: RcStr) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    async fn by_section(self: Vc<Self>, section: RcStr) -> Result<Vc<FileContent>> {\n         // Weirdly, the ContentSource will have already URL decoded the ModuleId, and we\n         // can't reparse that via serde.\n         if let Ok(id) = ModuleId::parse(&section) {\n@@ -184,6 +184,6 @@ impl GenerateSourceMap for EcmascriptBrowserChunkContent {\n             }\n         }\n \n-        Ok(Vc::cell(None))\n+        Ok(FileContent::NotFound.cell())\n     }\n }"
        },
        {
            "sha": "76119f4be7c99bcace4b7e46d098599970c942d1",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/evaluate/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -6,7 +6,7 @@ use indoc::writedoc;\n use serde::Serialize;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ReadRef, ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n-use turbo_tasks_fs::{File, FileSystemPath};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n@@ -18,7 +18,7 @@ use turbopack_core::{\n     module::Module,\n     module_graph::ModuleGraph,\n     output::{OutputAsset, OutputAssets, OutputAssetsReference, OutputAssetsWithReferenced},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n };\n use turbopack_ecmascript::{\n     chunk::{EcmascriptChunkData, EcmascriptChunkPlaceable},\n@@ -299,7 +299,7 @@ impl Asset for EcmascriptBrowserEvaluateChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBrowserEvaluateChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }"
        },
        {
            "sha": "c4c74c6df68ae77b0ee498e167ff38f9b06b6f83",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/merged/update.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -84,23 +84,21 @@ struct EcmascriptModuleEntry {\n impl EcmascriptModuleEntry {\n     async fn from_code(id: &ModuleId, code: Vc<Code>, chunk_path: &str) -> Result<Self> {\n         let map = &*code.generate_source_map().await?;\n-        Ok(Self::new(id, code.await?, map.clone(), chunk_path))\n-    }\n+        let map = map.as_content().map(|f| f.content().clone());\n \n-    fn new(id: &ModuleId, code: ReadRef<Code>, map: Option<Rope>, chunk_path: &str) -> Self {\n         /// serde_qs can't serialize a lone enum when it's [serde::untagged].\n         #[derive(Serialize)]\n         struct Id<'a> {\n             id: &'a ModuleId,\n         }\n         let id = serde_qs::to_string(&Id { id }).unwrap();\n \n-        EcmascriptModuleEntry {\n+        Ok(EcmascriptModuleEntry {\n             // Cloning a rope is cheap.\n-            code: code.source_code().clone(),\n+            code: code.await?.source_code().clone(),\n             url: format!(\"{}?{}\", chunk_path, &id),\n             map,\n-        }\n+        })\n     }\n }\n "
        },
        {
            "sha": "b3fbfa86c145bebef54a0b3ce7d30d9f5e542c8a",
            "filename": "turbopack/crates/turbopack-core/src/code_builder.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcode_builder.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcode_builder.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcode_builder.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -8,13 +8,16 @@ use anyhow::Result;\n use tracing::instrument;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::rope::{Rope, RopeBuilder};\n+use turbo_tasks_fs::{\n+    File, FileContent,\n+    rope::{Rope, RopeBuilder},\n+};\n use turbo_tasks_hash::hash_xxh3_hash64;\n \n use crate::{\n     debug_id::generate_debug_id,\n     output::OutputAsset,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMap, SourceMapAsset},\n     source_pos::SourcePos,\n };\n \n@@ -255,13 +258,9 @@ impl GenerateSourceMap for Code {\n     /// far the simplest way to concatenate the source maps of the multiple\n     /// chunk items into a single map file.\n     #[turbo_tasks::function]\n-    pub async fn generate_source_map(\n-        self: ResolvedVc<Self>,\n-    ) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    pub async fn generate_source_map(self: ResolvedVc<Self>) -> Result<Vc<FileContent>> {\n         let debug_id = self.debug_id().owned().await?;\n-        Ok(Vc::cell(Some(\n-            self.await?.generate_source_map_ref(debug_id),\n-        )))\n+        Ok(File::from(self.await?.generate_source_map_ref(debug_id)).into())\n     }\n }\n "
        },
        {
            "sha": "d4d05931db814779a3325084a84987ba84162435",
            "filename": "turbopack/crates/turbopack-core/src/reference/source_map.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fsource_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fsource_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fsource_map.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1,16 +1,14 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{FileSystemEntryType, FileSystemPath};\n+use turbo_tasks_fs::{File, FileContent, FileSystemEntryType, FileSystemPath};\n \n use super::ModuleReference;\n use crate::{\n     file_source::FileSource,\n     raw_module::RawModule,\n     resolve::ModuleResolveResult,\n-    source_map::{\n-        GenerateSourceMap, OptionStringifiedSourceMap, utils::resolve_source_map_sources,\n-    },\n+    source_map::{GenerateSourceMap, utils::resolve_source_map_sources},\n };\n \n #[turbo_tasks::value]\n@@ -57,15 +55,18 @@ impl ModuleReference for SourceMapReference {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for SourceMapReference {\n     #[turbo_tasks::function]\n-    async fn generate_source_map(&self) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    async fn generate_source_map(&self) -> Result<Vc<FileContent>> {\n         let Some(file) = self.get_file().await else {\n-            return Ok(Vc::cell(None));\n+            return Ok(FileContent::NotFound.cell());\n         };\n \n         let content = file.read().await?;\n         let content = content.as_content().map(|file| file.content());\n-        let source_map = resolve_source_map_sources(content, &self.from).await?;\n-        Ok(Vc::cell(source_map))\n+        if let Some(source_map) = resolve_source_map_sources(content, &self.from).await? {\n+            Ok(File::from(source_map).into())\n+        } else {\n+            Ok(FileContent::NotFound.cell())\n+        }\n     }\n }\n "
        },
        {
            "sha": "0c74a630c7680590e912ed5d742d67118d0f7eab",
            "filename": "turbopack/crates/turbopack-core/src/source_map/mod.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 21,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fmod.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -29,28 +29,17 @@ pub use source_map_asset::SourceMapAsset;\n /// Represents an empty value in a u32 variable in the sourcemap crate.\n static SOURCEMAP_CRATE_NONE_U32: u32 = !0;\n \n-#[turbo_tasks::value(transparent)]\n-pub struct OptionStringifiedSourceMap(Option<Rope>);\n-\n-#[turbo_tasks::value_impl]\n-impl OptionStringifiedSourceMap {\n-    #[turbo_tasks::function]\n-    pub fn none() -> Vc<Self> {\n-        Vc::cell(None)\n-    }\n-}\n-\n /// Allows callers to generate source maps.\n #[turbo_tasks::value_trait]\n pub trait GenerateSourceMap {\n     /// Generates a usable source map, capable of both tracing and stringifying.\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap>;\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent>;\n \n     /// Returns an individual section of the larger source map, if found.\n     #[turbo_tasks::function]\n-    fn by_section(self: Vc<Self>, _section: RcStr) -> Vc<OptionStringifiedSourceMap> {\n-        Vc::cell(None)\n+    fn by_section(self: Vc<Self>, _section: RcStr) -> Vc<FileContent> {\n+        FileContent::NotFound.cell()\n     }\n }\n \n@@ -260,13 +249,12 @@ impl SourceMap {\n     /// This function should be used sparingly to reduce memory usage, only in cold code paths\n     /// (issue resolving, etc).\n     #[turbo_tasks::function]\n-    pub async fn new_from_rope_cached(\n-        content: Vc<OptionStringifiedSourceMap>,\n-    ) -> Result<Vc<OptionSourceMap>> {\n-        let Some(content) = &*content.await? else {\n+    pub async fn new_from_rope_cached(content: Vc<FileContent>) -> Result<Vc<OptionSourceMap>> {\n+        let content = content.await?;\n+        let Some(content) = content.as_content() else {\n             return Ok(OptionSourceMap::none());\n         };\n-        Ok(Vc::cell(SourceMap::new_from_rope(content)?))\n+        Ok(Vc::cell(SourceMap::new_from_rope(content.content())?))\n     }\n }\n \n@@ -637,8 +625,8 @@ impl SourceMap {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for SourceMap {\n     #[turbo_tasks::function]\n-    fn generate_source_map(&self) -> Result<Vc<OptionStringifiedSourceMap>> {\n-        Ok(Vc::cell(Some(self.to_rope()?)))\n+    fn generate_source_map(&self) -> Result<Vc<FileContent>> {\n+        Ok(File::from(self.to_rope()?).into())\n     }\n }\n "
        },
        {
            "sha": "f56f35dd161c5cc3eb7852e9b1b8a52b349df2cd",
            "filename": "turbopack/crates/turbopack-core/src/source_map/source_map_asset.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fsource_map_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fsource_map_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Fsource_map_asset.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -98,8 +98,9 @@ impl OutputAsset for SourceMapAsset {\n impl Asset for SourceMapAsset {\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<AssetContent>> {\n-        if let Some(sm) = &*self.generate_source_map.generate_source_map().await? {\n-            Ok(AssetContent::file(File::from(sm.clone()).into()))\n+        let content = self.generate_source_map.generate_source_map();\n+        if content.await?.is_content() {\n+            Ok(AssetContent::file(content))\n         } else {\n             Ok(AssetContent::file(\n                 File::from(SourceMap::empty_rope()).into(),"
        },
        {
            "sha": "caad1b5c2e361d36e58225d4cd08ac6c89845f82",
            "filename": "turbopack/crates/turbopack-css/src/asset.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use turbo_rcstr::rcstr;\n use turbo_tasks::{IntoTraitRef, ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n-use turbo_tasks_fs::FileSystemPath;\n+use turbo_tasks_fs::{FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{ChunkItem, ChunkType, ChunkableModule, ChunkingContext, MinifyType},\n@@ -110,7 +110,7 @@ impl ProcessCss for CssModuleAsset {\n         let origin_source_map =\n             match ResolvedVc::try_sidecast::<Box<dyn GenerateSourceMap>>(this.source) {\n                 Some(gsm) => gsm.generate_source_map(),\n-                None => Vc::cell(None),\n+                None => FileContent::NotFound.cell(),\n             };\n         Ok(finalize_css(\n             process_result,\n@@ -346,7 +346,7 @@ impl CssChunkItem for CssModuleChunkItem {\n                 inner_code: output_code.to_owned().into(),\n                 imports,\n                 import_context: self.module.await?.import_context,\n-                source_map: source_map.owned().await?,\n+                source_map: *source_map,\n             }\n             .cell())\n         } else {\n@@ -358,7 +358,7 @@ impl CssChunkItem for CssModuleChunkItem {\n                 .into(),\n                 imports: vec![],\n                 import_context: None,\n-                source_map: None,\n+                source_map: FileContent::NotFound.resolved_cell(),\n             }\n             .cell())\n         }"
        },
        {
            "sha": "cc2a9858698897e3077297f1255950c3d2b8a73e",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -7,7 +7,7 @@ use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, TryJoinIterExt, ValueDefault, ValueToString, Vc};\n use turbo_tasks_fs::{\n-    File, FileSystem, FileSystemPath,\n+    File, FileContent, FileSystem, FileSystemPath,\n     rope::{Rope, RopeBuilder},\n };\n use turbopack_core::{\n@@ -30,7 +30,7 @@ use turbopack_core::{\n     reference_type::ImportContext,\n     server_fs::ServerFileSystem,\n     source_map::{\n-        GenerateSourceMap, OptionStringifiedSourceMap,\n+        GenerateSourceMap,\n         utils::{absolute_fileify_source_map, relative_fileify_source_map},\n     },\n };\n@@ -97,17 +97,19 @@ impl CssChunk {\n             let close = write_import_context(&mut body, content.import_context).await?;\n \n             let chunking_context = self.chunking_context();\n+            let source_map = content.source_map.await?;\n+            let source_map = source_map.as_content().map(|f| f.content());\n             let source_map = match *chunking_context.source_map_source_type().await? {\n                 SourceMapSourceType::AbsoluteFileUri => {\n                     absolute_fileify_source_map(\n-                        content.source_map.as_ref(),\n+                        source_map,\n                         chunking_context.root_path().owned().await?,\n                     )\n                     .await?\n                 }\n                 SourceMapSourceType::RelativeUri => {\n                     relative_fileify_source_map(\n-                        content.source_map.as_ref(),\n+                        source_map,\n                         chunking_context.root_path().owned().await?,\n                         chunking_context\n                             .relative_path_from_chunk_root_to_project_root()\n@@ -116,7 +118,7 @@ impl CssChunk {\n                     )\n                     .await?\n                 }\n-                SourceMapSourceType::TurbopackUri => content.source_map.clone(),\n+                SourceMapSourceType::TurbopackUri => source_map.cloned(),\n             };\n \n             body.push_source(&content.inner_code, source_map);\n@@ -430,7 +432,7 @@ impl Asset for CssChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for CssChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }\n@@ -456,7 +458,7 @@ pub struct CssChunkItemContent {\n     pub import_context: Option<ResolvedVc<ImportContext>>,\n     pub imports: Vec<CssImport>,\n     pub inner_code: Rope,\n-    pub source_map: Option<Rope>,\n+    pub source_map: ResolvedVc<FileContent>,\n }\n \n #[turbo_tasks::value_trait]"
        },
        {
            "sha": "ef3ad2ccf92b888271400f26824c01917d8ae9d0",
            "filename": "turbopack/crates/turbopack-css/src/chunk/single_item_chunk/chunk.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -3,15 +3,15 @@ use std::fmt::Write;\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{File, FileSystemPath, rope::RopeBuilder};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{Chunk, ChunkItem, ChunkingContext, MinifyType},\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n     introspect::Introspectable,\n     output::{OutputAsset, OutputAssetsReference, OutputAssetsWithReferenced},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap},\n+    source_map::GenerateSourceMap,\n };\n \n use super::source_map::SingleItemCssChunkSourceMapAsset;\n@@ -66,7 +66,14 @@ impl SingleItemCssChunk {\n         let content = this.item.content().await?;\n         let close = write_import_context(&mut code, content.import_context).await?;\n \n-        code.push_source(&content.inner_code, content.source_map.clone());\n+        code.push_source(\n+            &content.inner_code,\n+            content\n+                .source_map\n+                .await?\n+                .as_content()\n+                .map(|f| f.content().clone()),\n+        );\n         write!(code, \"{close}\")?;\n \n         let c = code.build().cell();\n@@ -160,7 +167,7 @@ impl Asset for SingleItemCssChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for SingleItemCssChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }"
        },
        {
            "sha": "8619eee542b4b4461a6f0a2745994d48b1dde5a3",
            "filename": "turbopack/crates/turbopack-css/src/chunk/single_item_chunk/source_map.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fsource_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fsource_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fsource_map.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -53,8 +53,9 @@ impl OutputAsset for SingleItemCssChunkSourceMapAsset {\n impl Asset for SingleItemCssChunkSourceMapAsset {\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<AssetContent>> {\n-        if let Some(sm) = &*self.chunk.generate_source_map().await? {\n-            Ok(AssetContent::file(File::from(sm.clone()).into()))\n+        let content = self.chunk.generate_source_map();\n+        if content.await?.is_content() {\n+            Ok(AssetContent::file(content))\n         } else {\n             Ok(AssetContent::file(\n                 File::from(SourceMap::empty_rope()).into(),"
        },
        {
            "sha": "12dbbbcaec898f2f0cdeb88f63130566b792399c",
            "filename": "turbopack/crates/turbopack-css/src/chunk/source_map.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsource_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsource_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsource_map.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -49,8 +49,9 @@ impl OutputAsset for CssChunkSourceMapAsset {\n impl Asset for CssChunkSourceMapAsset {\n     #[turbo_tasks::function]\n     async fn content(&self) -> Result<Vc<AssetContent>> {\n-        if let Some(sm) = &*self.chunk.generate_source_map().await? {\n-            Ok(AssetContent::file(File::from(sm.clone()).into()))\n+        let content = self.chunk.generate_source_map();\n+        if content.await?.is_content() {\n+            Ok(AssetContent::file(content))\n         } else {\n             Ok(AssetContent::file(\n                 File::from(SourceMap::empty_rope()).into(),"
        },
        {
            "sha": "a37728e98429a57f13bcede14adf976ee7ef53fb",
            "filename": "turbopack/crates/turbopack-css/src/process.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -16,7 +16,7 @@ use swc_core::base::sourcemap::SourceMapBuilder;\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexMap, ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{FileContent, FileSystemPath, rope::Rope};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath, rope::Rope};\n use turbopack_core::{\n     SOURCE_URL_PROTOCOL,\n     asset::{Asset, AssetContent},\n@@ -30,7 +30,7 @@ use turbopack_core::{\n     reference_type::ImportContext,\n     resolve::origin::ResolveOrigin,\n     source::Source,\n-    source_map::{OptionStringifiedSourceMap, utils::add_default_ignore_list},\n+    source_map::utils::add_default_ignore_list,\n     source_pos::SourcePos,\n };\n \n@@ -179,7 +179,7 @@ pub enum FinalCssResult {\n         #[turbo_tasks(trace_ignore)]\n         output_code: String,\n \n-        source_map: ResolvedVc<OptionStringifiedSourceMap>,\n+        source_map: ResolvedVc<FileContent>,\n     },\n     Unparsable,\n     NotFound,\n@@ -246,7 +246,7 @@ pub async fn finalize_css(\n     result: Vc<CssWithPlaceholderResult>,\n     chunking_context: Vc<Box<dyn ChunkingContext>>,\n     minify_type: MinifyType,\n-    origin_source_map: Vc<OptionStringifiedSourceMap>,\n+    origin_source_map: Vc<FileContent>,\n     environment: Option<ResolvedVc<Environment>>,\n ) -> Result<Vc<FinalCssResult>> {\n     let result = result.await?;\n@@ -286,8 +286,11 @@ pub async fn finalize_css(\n                 _ => bail!(\"this case should be filtered out while parsing\"),\n             };\n \n-            let origin_source_map = if let Some(rope) = &*origin_source_map.await? {\n-                Some(parcel_sourcemap::SourceMap::from_json(\"\", &rope.to_str()?)?)\n+            let origin_source_map = if let Some(rope) = origin_source_map.await?.as_content() {\n+                Some(parcel_sourcemap::SourceMap::from_json(\n+                    \"\",\n+                    &rope.content().to_str()?,\n+                )?)\n             } else {\n                 None\n             };\n@@ -305,7 +308,11 @@ pub async fn finalize_css(\n \n             Ok(FinalCssResult::Ok {\n                 output_code: result.code,\n-                source_map: ResolvedVc::cell(srcmap),\n+                source_map: if let Some(srcmap) = srcmap {\n+                    FileContent::Content(File::from(srcmap)).resolved_cell()\n+                } else {\n+                    FileContent::NotFound.resolved_cell()\n+                },\n             }\n             .cell())\n         }"
        },
        {
            "sha": "79771a9ada3f66cd7ffcb5aa7a4b178fd489f577",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -86,7 +86,7 @@ pub use transform::{\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     FxDashMap, FxIndexMap, IntoTraitRef, NonLocalValue, ReadRef, ResolvedVc, TaskInput,\n-    TryFlatJoinIterExt, TryJoinIterExt, Upcast, ValueToString, Vc, trace::TraceRawVcs,\n+    TryJoinIterExt, Upcast, ValueToString, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{FileJsonContent, FileSystemPath, glob::Glob, rope::Rope};\n use turbopack_core::{\n@@ -2135,14 +2135,21 @@ async fn emit_content(\n     }\n \n     let source_map = if generate_source_map {\n+        let original_source_maps = original_source_map\n+            .iter()\n+            .map(|map| map.generate_source_map())\n+            .try_join()\n+            .await?;\n+        let original_source_maps = original_source_maps\n+            .iter()\n+            .filter_map(|map| map.as_content())\n+            .map(|map| map.content())\n+            .collect::<Vec<_>>();\n+\n         Some(generate_js_source_map(\n             &*source_map,\n             mappings,\n-            original_source_map\n-                .iter()\n-                .map(|map| map.generate_source_map())\n-                .try_flat_join()\n-                .await?,\n+            original_source_maps,\n             matches!(\n                 original_source_map,\n                 CodeGenResultOriginalSourceMap::Single(_)"
        },
        {
            "sha": "8d0c9b0237c744736b1cdfabcf11dcaf7011a9f8",
            "filename": "turbopack/crates/turbopack-ecmascript/src/single_file_ecmascript_output.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsingle_file_ecmascript_output.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsingle_file_ecmascript_output.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsingle_file_ecmascript_output.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -4,12 +4,12 @@ use anyhow::Result;\n use swc_core::common::{BytePos, FileName, LineCol, SourceMap};\n use tokio::io::AsyncReadExt;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::{FileContent, FileSystemPath, rope::Rope};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath, rope::Rope};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     output::{OutputAsset, OutputAssetsReference},\n     source::Source,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap},\n+    source_map::GenerateSourceMap,\n };\n \n use crate::parse::generate_js_source_map;\n@@ -62,9 +62,9 @@ impl SingleFileEcmascriptOutput {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for SingleFileEcmascriptOutput {\n     #[turbo_tasks::function]\n-    pub async fn generate_source_map(&self) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    pub async fn generate_source_map(&self) -> Result<Vc<FileContent>> {\n         let FileContent::Content(file) = &*self.source.content().file_content().await? else {\n-            return Ok(Vc::cell(None));\n+            return Ok(FileContent::NotFound.cell());\n         };\n \n         let file_source = {\n@@ -94,6 +94,6 @@ impl GenerateSourceMap for SingleFileEcmascriptOutput {\n         );\n \n         let map = generate_js_source_map(&*sm, mappings, None::<&Rope>, true, true)?;\n-        Ok(Vc::cell(Some(map)))\n+        Ok(File::from(map).into())\n     }\n }"
        },
        {
            "sha": "a2e2b2722f83b58d8582380ee3a8192aed4b9f71",
            "filename": "turbopack/crates/turbopack-ecmascript/src/source_map.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsource_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsource_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fsource_map.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -5,13 +5,11 @@ use either::Either;\n use regex::Regex;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::{FileSystemPath, rope::Rope};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath, rope::Rope};\n use turbopack_core::{\n     reference::{ModuleReference, SourceMapReference},\n     source::Source,\n-    source_map::{\n-        GenerateSourceMap, OptionStringifiedSourceMap, utils::resolve_source_map_sources,\n-    },\n+    source_map::{GenerateSourceMap, utils::resolve_source_map_sources},\n };\n \n use crate::swc_comments::ImmutableComments;\n@@ -28,10 +26,15 @@ pub struct InlineSourceMap {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for InlineSourceMap {\n     #[turbo_tasks::function]\n-    pub async fn generate_source_map(&self) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    pub async fn generate_source_map(&self) -> Result<Vc<FileContent>> {\n         let source_map = maybe_decode_data_url(&self.source_map);\n-        let source_map = resolve_source_map_sources(source_map.as_ref(), &self.origin_path).await?;\n-        Ok(Vc::cell(source_map))\n+        if let Some(source_map) =\n+            resolve_source_map_sources(source_map.as_ref(), &self.origin_path).await?\n+        {\n+            Ok(File::from(source_map).into())\n+        } else {\n+            Ok(FileContent::NotFound.cell())\n+        }\n     }\n }\n "
        },
        {
            "sha": "3ca7ef03ff26caec4fcafc0d43c6be2a6f290c7d",
            "filename": "turbopack/crates/turbopack-node/src/transforms/postcss.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -19,7 +19,7 @@ use turbopack_core::{\n     reference_type::{EntryReferenceSubType, InnerAssets, ReferenceType},\n     resolve::{FindContextFileResult, find_context_file_or_package_key, options::ImportMapping},\n     source::Source,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap},\n+    source_map::GenerateSourceMap,\n     source_transform::SourceTransform,\n     virtual_source::VirtualSource,\n };\n@@ -424,11 +424,11 @@ async fn find_config_in_location(\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for PostCssTransformedAsset {\n     #[turbo_tasks::function]\n-    async fn generate_source_map(&self) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    async fn generate_source_map(&self) -> Result<Vc<FileContent>> {\n         let source = Vc::try_resolve_sidecast::<Box<dyn GenerateSourceMap>>(*self.source).await?;\n         match source {\n             Some(source) => Ok(source.generate_source_map()),\n-            None => Ok(Vc::cell(None)),\n+            None => Ok(FileContent::NotFound.cell()),\n         }\n     }\n }"
        },
        {
            "sha": "b4b2e72522ae98f01470f7af1ff3f0bae0328ceb",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -38,9 +38,7 @@ use turbopack_core::{\n         resolve,\n     },\n     source::Source,\n-    source_map::{\n-        GenerateSourceMap, OptionStringifiedSourceMap, utils::resolve_source_map_sources,\n-    },\n+    source_map::{GenerateSourceMap, utils::resolve_source_map_sources},\n     source_transform::SourceTransform,\n     virtual_source::VirtualSource,\n };\n@@ -176,15 +174,15 @@ impl Asset for WebpackLoadersProcessedAsset {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for WebpackLoadersProcessedAsset {\n     #[turbo_tasks::function]\n-    async fn generate_source_map(self: Vc<Self>) -> Result<Vc<OptionStringifiedSourceMap>> {\n+    async fn generate_source_map(self: Vc<Self>) -> Result<Vc<FileContent>> {\n         Ok(*self.process().await?.source_map)\n     }\n }\n \n #[turbo_tasks::value]\n struct ProcessWebpackLoadersResult {\n     content: ResolvedVc<AssetContent>,\n-    source_map: ResolvedVc<OptionStringifiedSourceMap>,\n+    source_map: ResolvedVc<FileContent>,\n     assets: Vec<ResolvedVc<VirtualSource>>,\n }\n \n@@ -222,7 +220,7 @@ impl WebpackLoadersProcessedAsset {\n             return Ok(ProcessWebpackLoadersResult {\n                 content: AssetContent::File(FileContent::NotFound.resolved_cell()).resolved_cell(),\n                 assets: Vec::new(),\n-                source_map: ResolvedVc::cell(None),\n+                source_map: FileContent::NotFound.resolved_cell(),\n             }\n             .cell());\n         };\n@@ -284,7 +282,7 @@ impl WebpackLoadersProcessedAsset {\n             return Ok(ProcessWebpackLoadersResult {\n                 content: AssetContent::File(FileContent::NotFound.resolved_cell()).resolved_cell(),\n                 assets: Vec::new(),\n-                source_map: ResolvedVc::cell(None),\n+                source_map: FileContent::NotFound.resolved_cell(),\n             }\n             .cell());\n         };\n@@ -312,7 +310,11 @@ impl WebpackLoadersProcessedAsset {\n         Ok(ProcessWebpackLoadersResult {\n             content,\n             assets,\n-            source_map: ResolvedVc::cell(source_map),\n+            source_map: if let Some(source_map) = source_map {\n+                FileContent::Content(File::from(source_map)).resolved_cell()\n+            } else {\n+                FileContent::NotFound.resolved_cell()\n+            },\n         }\n         .cell())\n     }"
        },
        {
            "sha": "0ef741a4f15d760e129fe5ce69f001124f27aa6b",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1,13 +1,13 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::FileSystemPath;\n+use turbo_tasks_fs::{FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{Chunk, ChunkingContext},\n     introspect::{Introspectable, IntrospectableChildren},\n     output::{OutputAsset, OutputAssetsReference, OutputAssetsWithReferenced},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n     version::VersionedContent,\n };\n use turbopack_ecmascript::chunk::EcmascriptChunk;\n@@ -131,7 +131,7 @@ impl Asset for EcmascriptBuildNodeChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBuildNodeChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.own_content().generate_source_map()\n     }\n }"
        },
        {
            "sha": "d8c18a50bd9998d59511139782c533dfeb421fc1",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/content.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -1,12 +1,12 @@\n use anyhow::Result;\n use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::File;\n+use turbo_tasks_fs::{File, FileContent};\n use turbopack_core::{\n     asset::AssetContent,\n     chunk::{ChunkingContext, MinifyType},\n     code_builder::{Code, CodeBuilder},\n     output::OutputAsset,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n     version::{Version, VersionedContent},\n };\n use turbopack_ecmascript::{chunk::EcmascriptChunkContent, minify::minify, utils::StringifyJs};\n@@ -91,7 +91,7 @@ impl EcmascriptBuildNodeChunkContent {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBuildNodeChunkContent {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }"
        },
        {
            "sha": "bb5ae9a33d0cf14036ccff2324767fa12d263127",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/entry/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::{Result, bail};\n use indoc::writedoc;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{File, FileSystemPath};\n+use turbo_tasks_fs::{File, FileContent, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{ChunkingContext, EvaluatableAssets, ModuleChunkItemIdExt},\n@@ -14,7 +14,7 @@ use turbopack_core::{\n         OutputAsset, OutputAssets, OutputAssetsReference, OutputAssetsReferences,\n         OutputAssetsWithReferenced,\n     },\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n };\n use turbopack_ecmascript::{chunk::EcmascriptChunkPlaceable, utils::StringifyJs};\n \n@@ -221,7 +221,7 @@ impl Asset for EcmascriptBuildNodeEntryChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBuildNodeEntryChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }"
        },
        {
            "sha": "5d1e5d875dca650d41f1dd873d0167e2e3d2bed2",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/entry/runtime.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs?ref=112e70ed8cc4d83c35b0e36cf518e1e54f6dfcc9",
            "patch": "@@ -4,14 +4,14 @@ use anyhow::{Result, bail};\n use indoc::writedoc;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{File, FileSystem, FileSystemPath};\n+use turbo_tasks_fs::{File, FileContent, FileSystem, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::ChunkingContext,\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n     output::{OutputAsset, OutputAssetsReference, OutputAssetsWithReferenced},\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, SourceMapAsset},\n+    source_map::{GenerateSourceMap, SourceMapAsset},\n };\n use turbopack_ecmascript::utils::StringifyJs;\n use turbopack_ecmascript_runtime::RuntimeType;\n@@ -171,7 +171,7 @@ impl Asset for EcmascriptBuildNodeRuntimeChunk {\n #[turbo_tasks::value_impl]\n impl GenerateSourceMap for EcmascriptBuildNodeRuntimeChunk {\n     #[turbo_tasks::function]\n-    fn generate_source_map(self: Vc<Self>) -> Vc<OptionStringifiedSourceMap> {\n+    fn generate_source_map(self: Vc<Self>) -> Vc<FileContent> {\n         self.code().generate_source_map()\n     }\n }"
        }
    ],
    "stats": {
        "total": 321,
        "additions": 172,
        "deletions": 149
    }
}