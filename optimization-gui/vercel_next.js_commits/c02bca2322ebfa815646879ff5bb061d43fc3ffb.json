{
    "author": "eps1lon",
    "message": "Current behavior for `reportError` (#76115)",
    "sha": "c02bca2322ebfa815646879ff5bb061d43fc3ffb",
    "files": [
        {
            "sha": "e4e04ecf9038266b9d3e57e3b26e84688af9f3ca",
            "filename": "test/development/pages-dir/client-navigation/index.test.ts",
            "status": "modified",
            "additions": 73,
            "deletions": 10,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts?ref=c02bca2322ebfa815646879ff5bb061d43fc3ffb",
            "patch": "@@ -9,7 +9,7 @@ import {\n   waitFor,\n   check,\n } from 'next-test-utils'\n-import webdriver from 'next-webdriver'\n+import webdriver, { BrowserInterface } from 'next-webdriver'\n import path from 'path'\n import { nextTestSetup } from 'e2e-utils'\n \n@@ -56,12 +56,25 @@ describe('Client Navigation', () => {\n       await browser.close()\n     })\n \n-    it('should have proper error when no children are provided', async () => {\n-      const browser = await webdriver(next.appPort, '/link-no-child')\n+    it('should have a redbox when no children are provided', async () => {\n+      const pageErrors: unknown[] = []\n+      const browser = await webdriver(next.appPort, '/link-no-child', {\n+        beforePageLoad: (page) => {\n+          page.on('pageerror', (error: unknown) => {\n+            pageErrors.push(error)\n+          })\n+        },\n+      })\n       await assertHasRedbox(browser)\n       expect(await getRedboxHeader(browser)).toContain(\n         'No children were passed to <Link> with `href` of `/about` but one child is required'\n       )\n+      expect(pageErrors).toEqual([\n+        expect.objectContaining({\n+          message:\n+            'No children were passed to <Link> with `href` of `/about` but one child is required https://nextjs.org/docs/messages/link-no-children',\n+        }),\n+      ])\n     })\n \n     it('should not throw error when one number type child is provided', async () => {\n@@ -277,15 +290,28 @@ describe('Client Navigation', () => {\n   })\n \n   describe('with empty getInitialProps()', () => {\n-    it('should render an error', async () => {\n-      let browser\n+    it('should render a redbox', async () => {\n+      let browser: BrowserInterface\n       try {\n-        browser = await webdriver(next.appPort, '/nav')\n+        const pageErrors: unknown[] = []\n+        browser = await webdriver(next.appPort, '/nav', {\n+          beforePageLoad: (page) => {\n+            page.on('pageerror', (error: unknown) => {\n+              pageErrors.push(error)\n+            })\n+          },\n+        })\n         await browser.elementByCss('#empty-props').click()\n         await assertHasRedbox(browser)\n         expect(await getRedboxHeader(browser)).toMatch(\n           /should resolve to an object\\. But found \"null\" instead\\./\n         )\n+        expect(pageErrors).toEqual([\n+          expect.objectContaining({\n+            message:\n+              '\"EmptyInitialPropsPage.getInitialProps()\" should resolve to an object. But found \"null\" instead.',\n+          }),\n+        ])\n       } finally {\n         if (browser) {\n           await browser.close()\n@@ -1377,13 +1403,39 @@ describe('Client Navigation', () => {\n \n   describe('runtime errors', () => {\n     it('should show redbox when a client side error is thrown inside a component', async () => {\n-      let browser\n+      const isReact18 = process.env.NEXT_TEST_REACT_VERSION?.startsWith('18')\n+      let browser: BrowserInterface\n       try {\n-        browser = await webdriver(next.appPort, '/error-inside-browser-page')\n+        const pageErrors: unknown[] = []\n+        browser = await webdriver(next.appPort, '/error-inside-browser-page', {\n+          beforePageLoad: (page) => {\n+            page.on('pageerror', (error: unknown) => {\n+              pageErrors.push(error)\n+            })\n+          },\n+        })\n         await assertHasRedbox(browser)\n         const text = await getRedboxSource(browser)\n         expect(text).toMatch(/An Expected error occurred/)\n         expect(text).toMatch(/pages[\\\\/]error-inside-browser-page\\.js \\(5:13\\)/)\n+\n+        expect(pageErrors).toEqual(\n+          isReact18\n+            ? [\n+                expect.objectContaining({\n+                  message: 'An Expected error occurred',\n+                }),\n+                expect.objectContaining({\n+                  message: 'An Expected error occurred',\n+                }),\n+                expect.objectContaining({\n+                  message:\n+                    'There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.',\n+                }),\n+              ]\n+            : // TODO(veil): Should contain thrown error\n+              []\n+        )\n       } finally {\n         if (browser) {\n           await browser.close()\n@@ -1392,16 +1444,27 @@ describe('Client Navigation', () => {\n     })\n \n     it('should show redbox when a client side error is thrown outside a component', async () => {\n-      let browser\n+      let browser: BrowserInterface\n       try {\n+        const pageErrors: unknown[] = []\n         browser = await webdriver(\n           next.appPort,\n-          '/error-in-the-browser-global-scope'\n+          '/error-in-the-browser-global-scope',\n+          {\n+            beforePageLoad: (page) => {\n+              page.on('pageerror', (error: unknown) => {\n+                pageErrors.push(error)\n+              })\n+            },\n+          }\n         )\n         await assertHasRedbox(browser)\n         const text = await getRedboxSource(browser)\n         expect(text).toMatch(/An Expected error occurred/)\n         expect(text).toMatch(/error-in-the-browser-global-scope\\.js \\(2:9\\)/)\n+        expect(pageErrors).toEqual([\n+          expect.objectContaining({ message: 'An Expected error occurred' }),\n+        ])\n       } finally {\n         if (browser) {\n           await browser.close()"
        },
        {
            "sha": "f2b712cb909224328752769eb72b52d10f3f3d46",
            "filename": "test/e2e/app-dir/errors/index.test.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 4,
            "changes": 48,
            "blob_url": "https://github.com/vercel/next.js/blob/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fe2e%2Fapp-dir%2Ferrors%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fe2e%2Fapp-dir%2Ferrors%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ferrors%2Findex.test.ts?ref=c02bca2322ebfa815646879ff5bb061d43fc3ffb",
            "patch": "@@ -14,7 +14,14 @@ describe('app-dir - errors', () => {\n \n   describe('error component', () => {\n     it('should trigger error component when an error happens during rendering', async () => {\n-      const browser = await next.browser('/client-component')\n+      const pageErrors: unknown[] = []\n+      const browser = await next.browser('/client-component', {\n+        beforePageLoad: (page) => {\n+          page.on('pageerror', (error: unknown) => {\n+            pageErrors.push(error)\n+          })\n+        },\n+      })\n       await browser.elementByCss('#error-trigger-button').click()\n \n       if (isNextDev) {\n@@ -27,10 +34,20 @@ describe('app-dir - errors', () => {\n           await browser.waitForElementByCss('#error-boundary-message').text()\n         ).toBe('An error occurred: this is a test')\n       }\n+\n+      // Handled by custom error boundary.\n+      expect(pageErrors).toEqual([])\n     })\n \n     it('should trigger error component when an error happens during server components rendering', async () => {\n-      const browser = await next.browser('/server-component')\n+      const pageErrors: unknown[] = []\n+      const browser = await next.browser('/server-component', {\n+        beforePageLoad: (page) => {\n+          page.on('pageerror', (error: unknown) => {\n+            pageErrors.push(error)\n+          })\n+        },\n+      })\n \n       expect(\n         await browser.waitForElementByCss('#error-boundary-message').text()\n@@ -49,6 +66,9 @@ describe('app-dir - errors', () => {\n         // await assertHasRedbox(browser)\n         // expect(await getRedboxHeader(browser)).toMatch(/this is a test/)\n       }\n+\n+      // Handled by custom error boundary.\n+      expect(pageErrors).toEqual([])\n     })\n \n     it('should preserve custom digests', async () => {\n@@ -143,7 +163,14 @@ describe('app-dir - errors', () => {\n     })\n \n     it('should use default error boundary for prod and overlay for dev when no error component specified', async () => {\n-      const browser = await next.browser('/global-error-boundary/client')\n+      const pageErrors: unknown[] = []\n+      const browser = await next.browser('/global-error-boundary/client', {\n+        beforePageLoad: (page) => {\n+          page.on('pageerror', (error: unknown) => {\n+            pageErrors.push(error)\n+          })\n+        },\n+      })\n       await browser.elementByCss('#error-trigger-button').click()\n \n       if (isNextDev) {\n@@ -156,10 +183,20 @@ describe('app-dir - errors', () => {\n           'Application error: a client-side exception has occurred while loading localhost (see the browser console for more information).'\n         )\n       }\n+\n+      // FIXME(veil): Should contain thrown error.\n+      expect(pageErrors).toEqual([])\n     })\n \n     it('should display error digest for error in server component with default error boundary', async () => {\n-      const browser = await next.browser('/global-error-boundary/server')\n+      const pageErrors: unknown[] = []\n+      const browser = await next.browser('/global-error-boundary/server', {\n+        beforePageLoad: (page) => {\n+          page.on('pageerror', (error: unknown) => {\n+            pageErrors.push(error)\n+          })\n+        },\n+      })\n \n       if (isNextDev) {\n         await assertHasRedbox(browser)\n@@ -174,6 +211,9 @@ describe('app-dir - errors', () => {\n           await browser.waitForElementByCss('body').elementByCss('p').text()\n         ).toMatch(/Digest: \\w+/)\n       }\n+\n+      // FIXME(veil): Should contain thrown error.\n+      expect(pageErrors).toEqual([])\n     })\n \n     // production tests"
        },
        {
            "sha": "1804824aa4026987593fc2baece842ef6d34dcfb",
            "filename": "test/turbopack-dev-tests-manifest.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fturbopack-dev-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c02bca2322ebfa815646879ff5bb061d43fc3ffb/test%2Fturbopack-dev-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-dev-tests-manifest.json?ref=c02bca2322ebfa815646879ff5bb061d43fc3ffb",
            "patch": "@@ -3231,7 +3231,7 @@\n       \"Client Navigation with 404 pages should should not contain a page script in a 404 page\",\n       \"Client Navigation with <Link/> should call mouse handlers with an absolute url\",\n       \"Client Navigation with <Link/> should error when calling onClick without event\",\n-      \"Client Navigation with <Link/> should have proper error when no children are provided\",\n+      \"Client Navigation with <Link/> should have a redbox when no children are provided\",\n       \"Client Navigation with <Link/> should navigate an absolute local url\",\n       \"Client Navigation with <Link/> should navigate an absolute local url with as\",\n       \"Client Navigation with <Link/> should navigate an absolute url\",\n@@ -3261,7 +3261,7 @@\n       \"Client Navigation with different types of urls should work with / page\",\n       \"Client Navigation with different types of urls should work with dir/ page\",\n       \"Client Navigation with different types of urls should work with normal page\",\n-      \"Client Navigation with empty getInitialProps() should render an error\",\n+      \"Client Navigation with empty getInitialProps() should render a redbox\",\n       \"Client Navigation with getInitialProp redirect should redirect the page via client side\",\n       \"Client Navigation with getInitialProp redirect should redirect the page when loading\",\n       \"Client Navigation with hash changes check hydration mis-match should not have hydration mis-match for hash link\","
        }
    ],
    "stats": {
        "total": 135,
        "additions": 119,
        "deletions": 16
    }
}