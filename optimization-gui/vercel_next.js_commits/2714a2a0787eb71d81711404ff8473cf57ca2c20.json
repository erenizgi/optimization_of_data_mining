{
    "author": "huozhi",
    "message": "[segment explorer] show current route (#81003)",
    "sha": "2714a2a0787eb71d81711404ff8473cf57ca2c20",
    "files": [
        {
            "sha": "a5a44d855586c59966f0085af13032ae19f223ec",
            "filename": "packages/next/src/next-devtools/dev-overlay.browser.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -17,6 +17,7 @@ import {\n   ACTION_BUILDING_INDICATOR_SHOW,\n   ACTION_RENDERING_INDICATOR_HIDE,\n   ACTION_RENDERING_INDICATOR_SHOW,\n+  ACTION_DEVTOOL_UPDATE_ROUTE_STATE,\n } from './dev-overlay/shared'\n \n import { startTransition, useInsertionEffect } from 'react'\n@@ -53,6 +54,7 @@ export interface Dispatcher {\n   renderingIndicatorShow(): void\n   segmentExplorerNodeAdd(nodeState: SegmentNodeState): void\n   segmentExplorerNodeRemove(nodeState: SegmentNodeState): void\n+  segmentExplorerUpdateRouteState(page: string): void\n }\n \n type Dispatch = ReturnType<typeof useErrorOverlayReducer>[1]\n@@ -148,6 +150,11 @@ export const dispatcher: Dispatcher = {\n       removeSegmentNode(nodeState)\n     }\n   ),\n+  segmentExplorerUpdateRouteState: createQueuable(\n+    (dispatch: Dispatch, page: string) => {\n+      dispatch({ type: ACTION_DEVTOOL_UPDATE_ROUTE_STATE, page })\n+    }\n+  ),\n }\n \n function replayQueuedEvents(dispatch: NonNullable<typeof maybeDispatch>) {"
        },
        {
            "sha": "ade104a5bc61244938d455d3191540025e9cd16f",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/devtools-panel-tab.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -19,6 +19,7 @@ export function DevToolsPanelTab({\n   runtimeErrors,\n   getSquashedHydrationErrorDetails,\n   buildError,\n+  page,\n }: {\n   activeTab: DevToolsPanelTabType\n   devToolsPosition: Corners\n@@ -30,6 +31,7 @@ export function DevToolsPanelTab({\n   runtimeErrors: ReadyRuntimeError[]\n   getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n   buildError: OverlayState['buildError']\n+  page: string\n }) {\n   switch (activeTab) {\n     case 'settings':\n@@ -42,7 +44,7 @@ export function DevToolsPanelTab({\n         />\n       )\n     case 'route':\n-      return <SegmentsExplorerTab routerType={routerType} />\n+      return <SegmentsExplorerTab routerType={routerType} page={page} />\n     case 'issues':\n       return (\n         <IssuesTab"
        },
        {
            "sha": "7a1106b71321c23508a8091eb07a291ef945282f",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/segments-explorer-tab.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -2,27 +2,24 @@ import { PageSegmentTree } from '../../overview/segment-explorer'\n \n function SegmentsExplorer({\n   routerType,\n+  page,\n }: React.HTMLProps<HTMLDivElement> & {\n   routerType: 'app' | 'pages'\n+  page: string\n }) {\n   const isAppRouter = routerType === 'app'\n-  return <PageSegmentTree isAppRouter={isAppRouter} />\n+  return <PageSegmentTree isAppRouter={isAppRouter} page={page} />\n }\n \n export function SegmentsExplorerTab({\n   routerType,\n+  page,\n }: {\n   routerType: 'app' | 'pages'\n+  page: string\n }) {\n-  return (\n-    <div data-nextjs-devtools-panel-segments-explorer>\n-      <SegmentsExplorer routerType={routerType} />\n-    </div>\n-  )\n+  return <SegmentsExplorer routerType={routerType} page={page} />\n }\n \n export const SEGMENTS_EXPLORER_TAB_STYLES = `\n-  [data-nextjs-devtools-panel-segments-explorer] {\n-    padding: 0 8px;\n-  }\n `"
        },
        {
            "sha": "5cc6113691a358deb921240bd7ab06c698442c50",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -212,6 +212,7 @@ export function DevToolsPanel({\n               </DialogHeader>\n               <DialogBody data-nextjs-devtools-panel-dialog-body>\n                 <DevToolsPanelTab\n+                  page={state.page}\n                   activeTab={activeTab}\n                   devToolsPosition={state.devToolsPosition}\n                   scale={state.scale}"
        },
        {
            "sha": "aa13082bd975e1d8447be70431a07b98016dde0a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -63,6 +63,7 @@ const state: OverlayState = {\n   isDevToolsPanelOpen: false,\n   devToolsPosition: 'bottom-left',\n   scale: 1,\n+  page: '',\n }\n \n export const StaticRoute: Story = {"
        },
        {
            "sha": "f88d23f8ed7aec8b028dc05152f22bfc30e716d9",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -344,6 +344,8 @@ function DevToolsPopover({\n           triggerRef={triggerRef}\n           style={popover}\n           routerType={routerType}\n+          // dummy page for legacy segment explorer, will be removed in the future\n+          page={''}\n         />\n       ) : null}\n "
        },
        {
            "sha": "526bb89ff93dd47cc70680a30c33f518ca2c8210",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/segments-explorer.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fsegments-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fsegments-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fsegments-explorer.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -3,16 +3,18 @@ import { DevToolsInfo, type DevToolsInfoPropsCore } from './dev-tools-info'\n \n export function SegmentsExplorer({\n   routerType,\n+  page,\n   ...props\n }: DevToolsInfoPropsCore &\n   React.HTMLProps<HTMLDivElement> & {\n     routerType: 'app' | 'pages'\n+    page: string\n   }) {\n   const isAppRouter = routerType === 'app'\n   return (\n     <DevToolsInfo title=\"Route Info\" {...props}>\n       <div data-nextjs-segments-explorer>\n-        <PageSegmentTree isAppRouter={isAppRouter} />\n+        <PageSegmentTree isAppRouter={isAppRouter} page={page} />\n       </div>\n     </DevToolsInfo>\n   )"
        },
        {
            "sha": "04d1e7c2f96ae83cb6794094b8376132713c5731",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 59,
            "deletions": 10,
            "changes": 69,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -15,18 +15,37 @@ const isFileNode = (node: SegmentTrieNode) => {\n   return !!node.value?.type && !!node.value?.pagePath\n }\n \n-export function PageSegmentTree({ isAppRouter }: { isAppRouter: boolean }) {\n+function PageRouteBar({ page }: { page: string }) {\n+  const pagePath = `/app${page}`\n+  return (\n+    <div className=\"segment-explorer-page-route-bar\">\n+      <BackArrowIcon />\n+      <span className=\"segment-explorer-page-route-bar-path\">{pagePath}</span>\n+    </div>\n+  )\n+}\n+\n+export function PageSegmentTree({\n+  isAppRouter,\n+  page,\n+}: {\n+  isAppRouter: boolean\n+  page: string\n+}) {\n   const tree = useSegmentTree()\n   return (\n-    <div\n-      className=\"segment-explorer-content\"\n-      data-nextjs-devtool-segment-explorer\n-    >\n-      {isAppRouter ? (\n-        <PageSegmentTreeLayerPresentation node={tree} level={0} segment=\"\" />\n-      ) : (\n-        <p>Route Info currently is only available for the App Router.</p>\n-      )}\n+    <div data-nextjs-devtools-panel-segments-explorer>\n+      {isAppRouter && <PageRouteBar page={page} />}\n+      <div\n+        className=\"segment-explorer-content\"\n+        data-nextjs-devtool-segment-explorer\n+      >\n+        {isAppRouter ? (\n+          <PageSegmentTreeLayerPresentation node={tree} level={0} segment=\"\" />\n+        ) : (\n+          <p>Route Info currently is only available for the App Router.</p>\n+        )}\n+      </div>\n     </div>\n   )\n }\n@@ -209,6 +228,22 @@ function PageSegmentTreeLayerPresentation({\n export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n   .segment-explorer-content {\n     font-size: var(--size-14);\n+    padding: 0 8px;\n+  }\n+\n+  .segment-explorer-page-route-bar {\n+    display: flex;\n+    align-items: center;\n+    padding: 14px 16px;\n+    background-color: var(--color-background-200);\n+    gap: 12px;\n+  }\n+\n+  .segment-explorer-page-route-bar-path {\n+    font-size: var(--size-14);\n+    font-weight: 500;\n+    color: var(--color-gray-1000);\n+    font-family: var(--font-mono);\n   }\n \n   .segment-explorer-item {\n@@ -354,6 +389,20 @@ function InfoIcon(props: React.SVGProps<SVGSVGElement>) {\n   )\n }\n \n+function BackArrowIcon() {\n+  return (\n+    <svg\n+      width=\"20\"\n+      height=\"20\"\n+      viewBox=\"0 0 20 20\"\n+      fill=\"var(--color-gray-600)\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+    >\n+      <path d=\"M4.5 11.25C4.5 11.3881 4.61193 11.5 4.75 11.5H14.4395L11.9395 9L13 7.93945L16.7803 11.7197L16.832 11.7764C17.0723 12.0709 17.0549 12.5057 16.7803 12.7803L13 16.5605L11.9395 15.5L14.4395 13H4.75C3.7835 13 3 12.2165 3 11.25V4.25H4.5V11.25Z\" />\n+    </svg>\n+  )\n+}\n+\n function TooltipSpan({\n   children,\n   title,"
        },
        {
            "sha": "84dcc3b268820992f248a9a991aa2cef0f585c77",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -46,6 +46,7 @@ export interface OverlayState {\n   isDevToolsPanelOpen: boolean\n   devToolsPosition: Corners\n   scale: number\n+  page: string\n }\n export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n \n@@ -80,6 +81,9 @@ export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n export const STORAGE_KEY_SCALE = '__nextjs-dev-tools-scale'\n \n+export const ACTION_DEVTOOL_UPDATE_ROUTE_STATE =\n+  'segment-explorer-update-route-state'\n+\n interface StaticIndicatorAction {\n   type: typeof ACTION_STATIC_INDICATOR\n   staticIndicator: boolean\n@@ -167,6 +171,11 @@ export interface DevToolsScaleAction {\n   scale: number\n }\n \n+export interface DevToolUpdateRouteStateAction {\n+  type: typeof ACTION_DEVTOOL_UPDATE_ROUTE_STATE\n+  page: string\n+}\n+\n export type DispatcherEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -190,7 +199,7 @@ export type DispatcherEvent =\n   | DevToolsPanelToggleAction\n   | DevToolsIndicatorPositionAction\n   | DevToolsScaleAction\n-\n+  | DevToolUpdateRouteStateAction\n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n   // 2nd group: SpiderMonkey, JavaScriptCore\n@@ -231,6 +240,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   isDevToolsPanelOpen: false,\n   devToolsPosition: 'bottom-left',\n   scale: NEXT_DEV_TOOLS_SCALE.Medium,\n+  page: '',\n }\n \n function getInitialState(\n@@ -408,6 +418,9 @@ export function useErrorOverlayReducer(\n         case ACTION_DEVTOOLS_SCALE: {\n           return { ...state, scale: action.scale }\n         }\n+        case ACTION_DEVTOOL_UPDATE_ROUTE_STATE: {\n+          return { ...state, page: action.page }\n+        }\n         default: {\n           return state\n         }"
        },
        {
            "sha": "4dd821d2cfde2f77cd4e540e5b1b19eb36922c38",
            "filename": "packages/next/src/next-devtools/userspace/app/segment-explorer-node.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -60,6 +60,16 @@ function LoadingSegmentNode(): React.ReactNode {\n   return null\n }\n \n+export function SegmentViewStateNode({ page }: { page: string }) {\n+  useLayoutEffect(() => {\n+    dispatcher.segmentExplorerUpdateRouteState(page)\n+    return () => {\n+      dispatcher.segmentExplorerUpdateRouteState('')\n+    }\n+  }, [page])\n+  return null\n+}\n+\n export function SegmentViewNode({\n   type,\n   pagePath,"
        },
        {
            "sha": "94f465269c49c4f7e835694a48c505d0f6ff7db1",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -101,6 +101,7 @@ async function createComponentTreeInternal({\n     workStore,\n     componentMod: {\n       SegmentViewNode,\n+      SegmentViewStateNode,\n       HTTPAccessFallbackBoundary,\n       LayoutRouter,\n       RenderFromTemplateContext,\n@@ -765,6 +766,7 @@ async function createComponentTreeInternal({\n         pageElement\n       )\n \n+    const pagePrefix = ctx.renderOpts.page.replace(/\\/page$/, '')\n     return [\n       actualSegment,\n       <React.Fragment key={cacheNodeKey}>\n@@ -774,6 +776,7 @@ async function createComponentTreeInternal({\n           <MetadataOutlet ready={getViewportReady} />\n           {metadataOutlet}\n         </OutletBoundary>\n+        <SegmentViewStateNode page={pagePrefix} />\n       </React.Fragment>,\n       parallelRouteCacheNodeSeedData,\n       loadingData,"
        },
        {
            "sha": "ec5825ef2c303bed9b66a5b3f5b09d172a39cd7b",
            "filename": "packages/next/src/server/app-render/entry-base.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -51,23 +51,23 @@ import { patchFetch as _patchFetch } from '../lib/patch-fetch'\n \n let SegmentViewNode: typeof import('../../next-devtools/userspace/app/segment-explorer-node').SegmentViewNode =\n   () => null\n+let SegmentViewStateNode: typeof import('../../next-devtools/userspace/app/segment-explorer-node').SegmentViewStateNode =\n+  () => null\n if (process.env.NODE_ENV === 'development') {\n-  SegmentViewNode = (\n+  const mod =\n     require('../../next-devtools/userspace/app/segment-explorer-node') as typeof import('../../next-devtools/userspace/app/segment-explorer-node')\n-  ).SegmentViewNode\n+  SegmentViewNode = mod.SegmentViewNode\n+  SegmentViewStateNode = mod.SegmentViewStateNode\n }\n \n // patchFetch makes use of APIs such as `React.unstable_postpone` which are only available\n // in the experimental channel of React, so export it from here so that it comes from the bundled runtime\n-function patchFetch() {\n+export function patchFetch() {\n   return _patchFetch({\n     workAsyncStorage,\n     workUnitAsyncStorage,\n   })\n }\n \n-export {\n-  patchFetch,\n-  // Development only\n-  SegmentViewNode,\n-}\n+// Development only\n+export { SegmentViewNode, SegmentViewStateNode }"
        },
        {
            "sha": "a33b9850ef84a20cb0acc2e1e0a8928e4c03104c",
            "filename": "test/e2e/opentelemetry/instrumentation/opentelemetry.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2714a2a0787eb71d81711404ff8473cf57ca2c20/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fopentelemetry.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2714a2a0787eb71d81711404ff8473cf57ca2c20/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fopentelemetry.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fopentelemetry%2Finstrumentation%2Fopentelemetry.test.ts?ref=2714a2a0787eb71d81711404ff8473cf57ca2c20",
            "patch": "@@ -13,7 +13,7 @@ const EXTERNAL = {\n const COLLECTOR_PORT = 9001\n \n describe('opentelemetry', () => {\n-  const { next, skipped } = nextTestSetup({\n+  const { next, skipped, isNextDev } = nextTestSetup({\n     files: __dirname,\n     skipDeployment: true,\n     dependencies: require('./package.json').dependencies,\n@@ -170,7 +170,7 @@ describe('opentelemetry', () => {\n                       },\n                       {\n                         attributes: {\n-                          'next.clientComponentLoadCount': 7,\n+                          'next.clientComponentLoadCount': isNextDev ? 8 : 7,\n                           'next.span_type':\n                             'NextNodeServer.clientComponentLoading',\n                         },"
        }
    ],
    "stats": {
        "total": 151,
        "additions": 119,
        "deletions": 32
    }
}