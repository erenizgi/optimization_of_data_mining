{
    "author": "timneutkens",
    "message": "Routing: Clean up some code (#81932)\n\n## What?\n\nSmall cleanups, variable names / unused code. No functional changes.",
    "sha": "7708abdb930fe38982ecaadfb710cd1e8b645fe1",
    "files": [
        {
            "sha": "46ece89e97d66ddfc1bc1fd49ad0b084f31ffd82",
            "filename": "packages/next/src/server/lib/router-utils/filesystem.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts?ref=7708abdb930fe38982ecaadfb710cd1e8b645fe1",
            "patch": "@@ -659,16 +659,19 @@ export async function setupFsCheck(opts: {\n               }\n             } else if (type === 'pageFile' || type === 'appFile') {\n               const isAppFile = type === 'appFile'\n-              if (\n-                ensureFn &&\n-                (await ensureFn({\n-                  type,\n-                  itemPath: isAppFile\n-                    ? normalizeMetadataRoute(curItemPath)\n-                    : curItemPath,\n-                })?.catch(() => 'ENSURE_FAILED')) === 'ENSURE_FAILED'\n-              ) {\n-                continue\n+\n+              // Attempt to ensure the page/app file is compiled and ready\n+              if (ensureFn) {\n+                const ensureItemPath = isAppFile\n+                  ? normalizeMetadataRoute(curItemPath)\n+                  : curItemPath\n+\n+                try {\n+                  await ensureFn({ type, itemPath: ensureItemPath })\n+                } catch (error) {\n+                  // If ensure failed, skip this item and continue to the next one\n+                  continue\n+                }\n               }\n             } else {\n               continue"
        },
        {
            "sha": "c9c9ed1064bb37f0ad0d968f965008057f251a4b",
            "filename": "packages/next/src/server/lib/router-utils/resolve-routes.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts?ref=7708abdb930fe38982ecaadfb710cd1e8b645fe1",
            "patch": "@@ -324,7 +324,7 @@ export function getResolveRoutes(\n     }\n \n     async function handleRoute(\n-      route: (typeof routes)[0]\n+      route: Route\n     ): Promise<UnwrapPromise<ReturnType<typeof resolveRoutes>> | void> {\n       let curPathname = parsedUrl.pathname || '/'\n "
        },
        {
            "sha": "920d049b06657404c4c2b1077b42ba043b2d964b",
            "filename": "packages/next/src/server/route-matcher-managers/dev-route-matcher-manager.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-managers%2Fdev-route-matcher-manager.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-managers%2Fdev-route-matcher-manager.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-managers%2Fdev-route-matcher-manager.ts?ref=7708abdb930fe38982ecaadfb710cd1e8b645fe1",
            "patch": "@@ -71,19 +71,19 @@ export class DevRouteMatcherManager extends DefaultRouteMatcherManager {\n \n     // Iterate over the development matches to see if one of them match the\n     // request path.\n-    for await (const development of super.matchAll(pathname, options)) {\n+    for await (const developmentMatch of super.matchAll(pathname, options)) {\n       // We're here, which means that we haven't seen this match yet, so we\n       // should try to ensure it and recompile the production matcher.\n-      await this.ensurer.ensure(development, pathname)\n+      await this.ensurer.ensure(developmentMatch, pathname)\n       await this.production.reload()\n \n       // Iterate over the production matches again, this time we should be able\n       // to match it against the production matcher unless there's an error.\n-      for await (const production of this.production.matchAll(\n+      for await (const productionMatch of this.production.matchAll(\n         pathname,\n         options\n       )) {\n-        yield production\n+        yield productionMatch\n       }\n     }\n "
        },
        {
            "sha": "7154918bff5007ec836f663e6ef42ab347269149",
            "filename": "packages/next/src/server/route-matcher-providers/dev/helpers/file-reader/default-file-reader.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-providers%2Fdev%2Fhelpers%2Ffile-reader%2Fdefault-file-reader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7708abdb930fe38982ecaadfb710cd1e8b645fe1/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-providers%2Fdev%2Fhelpers%2Ffile-reader%2Fdefault-file-reader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-matcher-providers%2Fdev%2Fhelpers%2Ffile-reader%2Fdefault-file-reader.ts?ref=7708abdb930fe38982ecaadfb710cd1e8b645fe1",
            "patch": "@@ -4,7 +4,7 @@ import { recursiveReadDir } from '../../../../../lib/recursive-readdir'\n \n export type DefaultFileReaderOptions = Pick<\n   RecursiveReadDirOptions,\n-  'pathnameFilter' | 'ignoreFilter' | 'ignorePartFilter'\n+  'pathnameFilter' | 'ignorePartFilter'\n >\n \n /**\n@@ -39,7 +39,6 @@ export class DefaultFileReader implements FileReader {\n   public async read(dir: string): Promise<ReadonlyArray<string>> {\n     return recursiveReadDir(dir, {\n       pathnameFilter: this.options.pathnameFilter,\n-      ignoreFilter: this.options.ignoreFilter,\n       ignorePartFilter: this.options.ignorePartFilter,\n \n       // We don't need to sort the results because we're not depending on the"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 19,
        "deletions": 17
    }
}