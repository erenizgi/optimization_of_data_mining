{
    "author": "eps1lon",
    "message": "Revert \"[Link] Add prefetch=\"auto\" option\" (#78820)",
    "sha": "259fd5f503815b702adebe85cc07d2f1321f904a",
    "files": [
        {
            "sha": "648e8a2a5286c03d35b7df8a75cdba3bd8079a56",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=259fd5f503815b702adebe85cc07d2f1321f904a",
            "patch": "@@ -133,7 +133,7 @@ type InternalLinkProps = {\n    * Prefetching is only enabled in production.\n    *\n    * - In the **App Router**:\n-   *   - `\"auto\"`, `null`, `undefined` (default): Prefetch behavior depends on static vs dynamic routes:\n+   *   - `null` (default): Prefetch behavior depends on static vs dynamic routes:\n    *     - Static routes: fully prefetched\n    *     - Dynamic routes: partial prefetch to the nearest segment with a `loading.js`\n    *   - `true`: Always prefetch the full route and data.\n@@ -151,7 +151,7 @@ type InternalLinkProps = {\n    * </Link>\n    * ```\n    */\n-  prefetch?: boolean | 'auto' | null\n+  prefetch?: boolean | null\n \n   /**\n    * (unstable) Switch to a dynamic prefetch on hover. Effectively the same as\n@@ -366,9 +366,7 @@ export default function LinkComponent(\n    * - 'unstable_dynamicOnHover': this starts in \"auto\" mode, but switches to \"full\" when the link is hovered\n    */\n   const appPrefetchKind =\n-    prefetchProp === null || prefetchProp === 'auto'\n-      ? PrefetchKind.AUTO\n-      : PrefetchKind.FULL\n+    prefetchProp === null ? PrefetchKind.AUTO : PrefetchKind.FULL\n \n   if (process.env.NODE_ENV !== 'production') {\n     function createPropError(args: {"
        },
        {
            "sha": "793d8c2d7a6028cb537958299d390e5c60cc8c35",
            "filename": "packages/next/src/client/form-shared.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Fform-shared.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Fform-shared.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fform-shared.tsx?ref=259fd5f503815b702adebe85cc07d2f1321f904a",
            "patch": "@@ -19,7 +19,7 @@ type InternalFormProps = {\n    * Prefetch can be disabled by passing `prefetch={false}`. Prefetching is only enabled in production.\n    *\n    * Options:\n-   * - \"auto\", null, undefined (default): For statically generated pages, this will prefetch the full React Server Component data. For dynamic pages, this will prefetch up to the nearest route segment with a [`loading.js`](https://nextjs.org/docs/app/api-reference/file-conventions/loading) file. If there is no loading file, it will not fetch the full tree to avoid fetching too much data.\n+   * - `null` (default): For statically generated pages, this will prefetch the full React Server Component data. For dynamic pages, this will prefetch up to the nearest route segment with a [`loading.js`](https://nextjs.org/docs/app/api-reference/file-conventions/loading) file. If there is no loading file, it will not fetch the full tree to avoid fetching too much data.\n    * - `false`: This will not prefetch any data.\n    *\n    * In pages dir, prefetching is not supported, and passing this prop will emit a warning."
        },
        {
            "sha": "5c66ec6d2e75931c4841f32c56f6f3625b010300",
            "filename": "packages/next/src/client/link.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/259fd5f503815b702adebe85cc07d2f1321f904a/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flink.tsx?ref=259fd5f503815b702adebe85cc07d2f1321f904a",
            "patch": "@@ -73,7 +73,7 @@ type InternalLinkProps = {\n    * Prefetch can be disabled by passing `prefetch={false}`. Prefetching is only enabled in production.\n    *\n    * In App Router:\n-   * - \"auto\", null, undefined (default): For statically generated pages, this will prefetch the full React Server Component data. For dynamic pages, this will prefetch up to the nearest route segment with a [`loading.js`](https://nextjs.org/docs/app/api-reference/file-conventions/loading) file. If there is no loading file, it will not fetch the full tree to avoid fetching too much data.\n+   * - `null` (default): For statically generated pages, this will prefetch the full React Server Component data. For dynamic pages, this will prefetch up to the nearest route segment with a [`loading.js`](https://nextjs.org/docs/app/api-reference/file-conventions/loading) file. If there is no loading file, it will not fetch the full tree to avoid fetching too much data.\n    * - `true`: This will prefetch the full React Server Component data for all route segments, regardless of whether they contain a segment with `loading.js`.\n    * - `false`: This will not prefetch any data, even on hover.\n    *\n@@ -82,7 +82,7 @@ type InternalLinkProps = {\n    * - `false`: Prefetching will not happen when entering the viewport, but will still happen on hover.\n    * @defaultValue `true` (pages router) or `null` (app router)\n    */\n-  prefetch?: boolean | 'auto' | null\n+  prefetch?: boolean | null\n   /**\n    * The active locale is automatically prepended. `locale` allows for providing a different locale.\n    * When `false` `href` has to include the locale as the default behavior is disabled."
        },
        {
            "sha": "d28ada742ee643dd43164ed28fe85983a6a1a255",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/app/dynamic/loading.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Floading.tsx?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,3 +0,0 @@\n-export default function Loading() {\n-  return <div id=\"loading-boundary\">Loading...</div>\n-}"
        },
        {
            "sha": "7fe377c43113d1a6e16b9045fa8c5daf56a823cd",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/app/dynamic/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fdynamic%2Fpage.tsx?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,6 +0,0 @@\n-import { connection } from 'next/server'\n-\n-export default async function Page() {\n-  await connection()\n-  return <div id=\"dynamic-content\">Dynamic content</div>\n-}"
        },
        {
            "sha": "dbce4ea8e3aeb6cb61b81712b62288d5abaf776b",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/app/layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Flayout.tsx?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,11 +0,0 @@\n-export default function RootLayout({\n-  children,\n-}: {\n-  children: React.ReactNode\n-}) {\n-  return (\n-    <html lang=\"en\">\n-      <body>{children}</body>\n-    </html>\n-  )\n-}"
        },
        {
            "sha": "c8dfd431a605adcad193f96ec650a63f992b0df2",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/app/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fapp%2Fpage.tsx?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,20 +0,0 @@\n-import { LinkAccordion } from '../components/link-accordion'\n-\n-export default function Page() {\n-  return (\n-    <>\n-      <p>\n-        This page is used to test that prefetch=\"auto\" uses the default\n-        prefetching strategy (the same as if no prefetch prop is given).\n-      </p>\n-\n-      <LinkAccordion\n-        // @ts-expect-error: \"auto\" not yet part of public types\n-        prefetch=\"auto\"\n-        href=\"/dynamic\"\n-      >\n-        Dynamic page with loading boundary\n-      </LinkAccordion>\n-    </>\n-  )\n-}"
        },
        {
            "sha": "4b253eab3adf36164d260dbafc6e89286719e164",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/components/link-accordion.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fcomponents%2Flink-accordion.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fcomponents%2Flink-accordion.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fcomponents%2Flink-accordion.tsx?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,23 +0,0 @@\n-'use client'\n-\n-import Link from 'next/link'\n-import { useState } from 'react'\n-\n-export function LinkAccordion({ href, children }) {\n-  const [isVisible, setIsVisible] = useState(false)\n-  return (\n-    <>\n-      <input\n-        type=\"checkbox\"\n-        checked={isVisible}\n-        onChange={() => setIsVisible(!isVisible)}\n-        data-link-accordion={href}\n-      />\n-      {isVisible ? (\n-        <Link href={href}>{children}</Link>\n-      ) : (\n-        `${children} (link is hidden)`\n-      )}\n-    </>\n-  )\n-}"
        },
        {
            "sha": "16e8384b655b41d459538177fb044f20d21e4696",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fnext.config.js?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,11 +0,0 @@\n-/**\n- * @type {import('next').NextConfig}\n- */\n-const nextConfig = {\n-  experimental: {\n-    ppr: true,\n-    dynamicIO: true,\n-  },\n-}\n-\n-module.exports = nextConfig"
        },
        {
            "sha": "12b0c02cef438733742e3fb28a2b58dc103bac14",
            "filename": "test/e2e/app-dir/segment-cache/prefetch-auto/prefetch-auto.test.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fprefetch-auto.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fprefetch-auto.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fprefetch-auto%2Fprefetch-auto.test.ts?ref=00e2e0ab133b8c9244c2280ed4c9314bb51e8fc8",
            "patch": "@@ -1,59 +0,0 @@\n-import { nextTestSetup } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n-import { createRouterAct } from '../router-act'\n-\n-describe('<Link prefetch=\"auto\">', () => {\n-  const { next, isNextDev, skipped } = nextTestSetup({\n-    files: __dirname,\n-    skipDeployment: true,\n-  })\n-  if (isNextDev || skipped) {\n-    it('disabled in development / deployment', () => {})\n-    return\n-  }\n-\n-  // NOTE: Since \"auto\" is just an alias for the default, I'm not bothering to\n-  // write tests for every default prefetching behavior; that's covered by a\n-  // bunch of other test suites. This is just a quick test to confirm that the\n-  // alias exists.\n-\n-  it('<Link prefetch=\"auto\"> works the same as if prefetch were undefined or null', async () => {\n-    // Test that the link only prefetches the static part of the target page\n-    let page: Playwright.Page\n-    const browser = await next.browser('/', {\n-      beforePageLoad(p: Playwright.Page) {\n-        page = p\n-      },\n-    })\n-    const act = createRouterAct(page)\n-\n-    // Reveal the link to trigger a prefetch\n-    await act(async () => {\n-      const linkToggle = await browser.elementByCss(\n-        'input[data-link-accordion=\"/dynamic\"]'\n-      )\n-      await linkToggle.click()\n-    }, [\n-      // Should prefetch the loading boundary\n-      {\n-        includes: 'Loading...',\n-      },\n-      // Should not prefetch the dynamic content\n-      {\n-        includes: 'Dynamic content',\n-        block: 'reject',\n-      },\n-    ])\n-\n-    // Navigate to the page\n-    await act(\n-      async () => {\n-        await browser.elementByCss('a[href=\"/dynamic\"]').click()\n-      },\n-      {\n-        // Now the dynamic content should be fetched\n-        includes: 'Dynamic content',\n-      }\n-    )\n-  })\n-})"
        }
    ],
    "stats": {
        "total": 147,
        "additions": 6,
        "deletions": 141
    }
}