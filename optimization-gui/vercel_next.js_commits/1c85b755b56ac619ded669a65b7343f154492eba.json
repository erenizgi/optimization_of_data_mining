{
    "author": "ztanner",
    "message": "[DevOverlay]: enable by default (#75882)\n\n- `newDevOverlay: true` by default (enables experimental React builds on\r\ncanary until owner stacks progress further)\r\n- `run-tests` now sets the env var for tests that were relying on it for\r\nforking behavior\r\n- PPR runners now run with the flag disabled to help catch regressions\r\nin the old overlay until we remove it\r\n- Fixed a number of tests that had outdated snapshots or missed forking\r\nbehavior because they weren't running in CI\r\n- Disabled a test that was failing in Turbopack + Experimental React\r\nthat is unrelated to the overlay (see:\r\nhttps://github.com/vercel/next.js/pull/75989)\r\n\r\n---------\r\n\r\nCo-authored-by: devjiwonchoi <devjiwonchoi@gmail.com>",
    "sha": "1c85b755b56ac619ded669a65b7343f154492eba",
    "files": [
        {
            "sha": "c27a07867b7831eff1b33a1adfb3a60dd825169b",
            "filename": ".eslintrc.json",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/.eslintrc.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/.eslintrc.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.eslintrc.json?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -45,7 +45,11 @@\n         \"jest/no-conditional-expect\": \"off\",\n         \"jest/valid-title\": \"off\",\n         \"jest/no-interpolation-in-snapshots\": \"off\",\n-        \"jest/no-export\": \"off\"\n+        \"jest/no-export\": \"off\",\n+        \"jest/no-standalone-expect\": [\n+          \"error\",\n+          { \"additionalTestBlockFunctions\": [\"retry\"] }\n+        ]\n       }\n     },\n     { \"files\": [\"**/__tests__/**\"], \"env\": { \"jest\": true } },"
        },
        {
            "sha": "3d1eacaeaf131465fead306c5a8e4778dfba13ed",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -581,7 +581,7 @@ jobs:\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n       nodeVersion: 18.18.2\n-      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=true NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" node run-tests.js --timings -c ${TEST_CONCURRENCY} --type integration\n+      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=false NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" node run-tests.js --timings -c ${TEST_CONCURRENCY} --type integration\n       stepName: 'test-ppr-integration'\n     secrets: inherit\n \n@@ -596,7 +596,7 @@ jobs:\n         group: [1/6, 2/6, 3/6, 4/6, 5/6, 6/6]\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n-      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=true NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" NEXT_TEST_MODE=dev node run-tests.js --timings -g ${{ matrix.group }} -c ${TEST_CONCURRENCY} --type development\n+      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=false NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" NEXT_TEST_MODE=dev node run-tests.js --timings -g ${{ matrix.group }} -c ${TEST_CONCURRENCY} --type development\n       stepName: 'test-ppr-dev-${{ matrix.group }}'\n     secrets: inherit\n \n@@ -611,7 +611,7 @@ jobs:\n         group: [1/7, 2/7, 3/7, 4/7, 5/7, 6/7, 7/7]\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n-      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=true NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" NEXT_TEST_MODE=start node run-tests.js --timings -g ${{ matrix.group }} -c ${TEST_CONCURRENCY} --type production\n+      afterBuild: __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY=false NEXT_EXTERNAL_TESTS_FILTERS=\"test/ppr-tests-manifest.json\" NEXT_TEST_MODE=start node run-tests.js --timings -g ${{ matrix.group }} -c ${TEST_CONCURRENCY} --type production\n       stepName: 'test-ppr-prod-${{ matrix.group }}'\n     secrets: inherit\n "
        },
        {
            "sha": "6c4c2603571a095c0bbdc7068c8b58d712422379",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -262,6 +262,7 @@ function DevToolsPopover({\n \n             <div className=\"footer\">\n               <MenuItem\n+                data-hide-dev-tools\n                 label=\"Hide Dev Tools\"\n                 value={<HideShortcut />}\n                 onClick={hide}"
        },
        {
            "sha": "39d0f0266bf862c526949c42f105e3917853be6c",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/internal/next-logo.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -415,6 +415,7 @@ export const NextLogo = forwardRef(function NextLogo(\n           <button\n             ref={mergeRefs(triggerRef, propRef)}\n             data-next-mark\n+            data-next-mark-loading={isLoading}\n             onClick={onTriggerClick}\n             {...props}\n           >"
        },
        {
            "sha": "69f2777e4acf16ecefc6daf7c6ee723950b6e88b",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/terminal/editor-link.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 14,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Feditor-link.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Feditor-link.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Feditor-link.tsx?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -9,7 +9,7 @@ type EditorLinkProps = {\n     column: number\n   }\n }\n-export function EditorLink({ file, isSourceFile, location }: EditorLinkProps) {\n+export function EditorLink({ file, location }: EditorLinkProps) {\n   const open = useOpenInEditor({\n     file,\n     lineNumber: location?.line ?? 1,\n@@ -19,12 +19,7 @@ export function EditorLink({ file, isSourceFile, location }: EditorLinkProps) {\n   return (\n     <div\n       data-with-open-in-editor-link\n-      data-with-open-in-editor-link-source-file={\n-        isSourceFile ? true : undefined\n-      }\n-      data-with-open-in-editor-link-import-trace={\n-        isSourceFile ? undefined : true\n-      }\n+      data-with-open-in-editor-link-import-trace\n       tabIndex={10}\n       role={'link'}\n       onClick={open}\n@@ -64,11 +59,4 @@ export const EDITOR_LINK_STYLES = css`\n   [data-with-open-in-editor-link-import-trace] {\n     margin-left: var(--size-gap-double);\n   }\n-  [data-with-open-in-editor-link-source-file] {\n-    border-bottom: 1px solid var(--color-ansi-bright-black);\n-    display: flex;\n-    align-items: center;\n-    justify-content: space-between;\n-    line-break: anywhere;\n-  }\n `"
        },
        {
            "sha": "16e72078f50c63fe52a3acce7d572f74f7d8408d",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/terminal/terminal.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Fterminal.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Fterminal.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Fterminal%2Fterminal.tsx?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -77,8 +77,8 @@ export const Terminal: React.FC<TerminalProps> = function Terminal({\n \n   const open = useOpenInEditor({\n     file: file?.fileName,\n-    lineNumber: file?.location?.line,\n-    column: file?.location?.column,\n+    lineNumber: file?.location?.line ?? 1,\n+    column: file?.location?.column ?? 0,\n   })\n \n   const stackFrame = {\n@@ -96,6 +96,7 @@ export const Terminal: React.FC<TerminalProps> = function Terminal({\n       <button\n         aria-label=\"Open in editor\"\n         className=\"code-frame-header\"\n+        data-with-open-in-editor-link-source-file\n         onClick={open}\n       >\n         <div className=\"code-frame-link\">"
        },
        {
            "sha": "e581fa62d0e50ca8bf918ba71200c3d0cf9c7ee4",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -1253,7 +1253,7 @@ export const defaultConfig: NextConfig = {\n     staticGenerationMinPagesPerWorker: 25,\n     dynamicIO: false,\n     inlineCss: false,\n-    newDevOverlay: false,\n+    newDevOverlay: true,\n     streamingMetadata: false,\n     htmlLimitedBots: undefined,\n     useCache: undefined,"
        },
        {
            "sha": "23c4deb1a2b2b89addde6e2a352ccef2f4848870",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -923,8 +923,8 @@ function assignDefaults(\n   // TODO(jiwon): remove once we've made new UI default\n   // Enable reactOwnerStack when newDevOverlay is enabled to have\n   // better call stack output in the new UI.\n-  if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n-    result.experimental.newDevOverlay = true\n+  if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'false') {\n+    result.experimental.newDevOverlay = false\n   }\n   if (result.experimental.newDevOverlay) {\n     result.experimental.reactOwnerStack = true"
        },
        {
            "sha": "6db9e7b568157c365d1d62ae68b4f6c151439bb7",
            "filename": "run-tests.js",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/run-tests.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/run-tests.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/run-tests.js?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -50,6 +50,12 @@ const ENDGROUP = process.env.CI ? '##[endgroup]' : ''\n \n const externalTestsFilter = getTestFilter()\n \n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+if (!process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY) {\n+  console.log('Setting __NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY to true')\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY = 'true'\n+}\n+\n const timings = []\n const DEFAULT_NUM_RETRIES = 2\n const DEFAULT_CONCURRENCY = 2"
        },
        {
            "sha": "35ef7e9664af18e4db6af847a1ef8c7f985ca262",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox-builtins.test.ts",
            "status": "modified",
            "additions": 76,
            "deletions": 76,
            "changes": 152,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox-builtins.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox-builtins.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox-builtins.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -50,27 +50,27 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     await session.assertHasRedbox()\n     if (process.env.TURBOPACK) {\n       expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"./node_modules/my-package/index.js:1:13\n-        Module not found: Can't resolve 'dns'\n-        > 1 | const dns = require('dns')\n-            |             ^^^^^^^^^^^^^^\n-          2 | module.exports = dns\n+       \"./node_modules/my-package/index.js (1:13)\n+       Module not found: Can't resolve 'dns'\n+       > 1 | const dns = require('dns')\n+           |             ^^^^^^^^^^^^^^\n+         2 | module.exports = dns\n \n-        https://nextjs.org/docs/messages/module-not-found\"\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"./node_modules/my-package/index.js:1:1\n-        Module not found: Can't resolve 'dns'\n-        > 1 | const dns = require('dns')\n-            | ^\n-          2 | module.exports = dns\n+       \"./node_modules/my-package/index.js (1:1)\n+       Module not found: Can't resolve 'dns'\n+       > 1 | const dns = require('dns')\n+           | ^\n+         2 | module.exports = dns\n \n-        https://nextjs.org/docs/messages/module-not-found\n+       https://nextjs.org/docs/messages/module-not-found\n \n-        Import trace for requested module:\n-        ./index.js\n-        ./app/page.js\"\n+       Import trace for requested module:\n+       ./index.js\n+       ./app/page.js\"\n       `)\n     }\n   })\n@@ -98,30 +98,30 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^^^^^^^^^^^^^^^^^^^^\n-          2 | export default function Oops() {\n-          3 |   return (\n-          4 |     <div>\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^^^^^^^^^^^^^^^^^^^^\n+         2 | export default function Oops() {\n+         3 |   return (\n+         4 |     <div>\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^\n-          2 | export default function Oops() {\n-          3 |   return (\n-          4 |     <div>\n-\n-        https://nextjs.org/docs/messages/module-not-found\n-\n-        Import trace for requested module:\n-        ./app/page.js\"\n+       \"./index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^\n+         2 | export default function Oops() {\n+         3 |   return (\n+         4 |     <div>\n+\n+       https://nextjs.org/docs/messages/module-not-found\n+\n+       Import trace for requested module:\n+       ./app/page.js\"\n       `)\n     }\n   })\n@@ -150,29 +150,29 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./app/page.js:2:1\n-        Module not found: Can't resolve 'b'\n-          1 | 'use client'\n-        > 2 | import Comp from 'b'\n-            | ^^^^^^^^^^^^^^^^^^^^\n-          3 | export default function Oops() {\n-          4 |   return (\n-          5 |     <div>\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./app/page.js (2:1)\n+       Module not found: Can't resolve 'b'\n+         1 | 'use client'\n+       > 2 | import Comp from 'b'\n+           | ^^^^^^^^^^^^^^^^^^^^\n+         3 | export default function Oops() {\n+         4 |   return (\n+         5 |     <div>\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./app/page.js:2:1\n-        Module not found: Can't resolve 'b'\n-          1 | 'use client'\n-        > 2 | import Comp from 'b'\n-            | ^\n-          3 | export default function Oops() {\n-          4 |   return (\n-          5 |     <div>\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./app/page.js (2:1)\n+       Module not found: Can't resolve 'b'\n+         1 | 'use client'\n+       > 2 | import Comp from 'b'\n+           | ^\n+         3 | export default function Oops() {\n+         4 |   return (\n+         5 |     <div>\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     }\n   })\n@@ -199,29 +199,29 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./app/page.js:2:1\n-        Module not found: Can't resolve './non-existent.css'\n-          1 | 'use client'\n-        > 2 | import './non-existent.css'\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-          3 | export default function Page(props) {\n-          4 |   return <p>index page</p>\n-          5 | }\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./app/page.js (2:1)\n+       Module not found: Can't resolve './non-existent.css'\n+         1 | 'use client'\n+       > 2 | import './non-existent.css'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         3 | export default function Page(props) {\n+         4 |   return <p>index page</p>\n+         5 | }\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./app/page.js:2:1\n-        Module not found: Can't resolve './non-existent.css'\n-          1 | 'use client'\n-        > 2 | import './non-existent.css'\n-            | ^\n-          3 | export default function Page(props) {\n-          4 |   return <p>index page</p>\n-          5 | }\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./app/page.js (2:1)\n+       Module not found: Can't resolve './non-existent.css'\n+         1 | 'use client'\n+       > 2 | import './non-existent.css'\n+           | ^\n+         3 | export default function Page(props) {\n+         4 |   return <p>index page</p>\n+         5 | }\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     }\n     await session.patch("
        },
        {
            "sha": "cf21678d625b18f03445caa4277fca731f3f3d80",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 18,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -2,11 +2,11 @@\n import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import {\n-  check,\n   describeVariants as describe,\n   getStackFramesContent,\n   retry,\n   getRedboxCallStack,\n+  getToastErrorCount,\n } from 'next-test-utils'\n import path from 'path'\n import { outdent } from 'outdent'\n@@ -220,7 +220,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     const source = next.normalizeTestDirContent(await session.getRedboxSource())\n     if (isTurbopack) {\n       expect(source).toEqual(outdent`\n-        ./index.js:7:1\n+        ./index.js (7:1)\n         Parsing ecmascript source code failed\n           5 |     div\n           6 |   )\n@@ -351,7 +351,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     await session.assertHasRedbox()\n     const source = await session.getRedboxSource()\n     expect(source).toMatch(\n-      isTurbopack ? './index.module.css:1:9' : './index.module.css:1:1'\n+      isTurbopack ? './index.module.css (1:9)' : './index.module.css (1:1)'\n     )\n     if (!isTurbopack) {\n       expect(source).toMatch('Syntax error: ')\n@@ -436,7 +436,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     )\n \n     await session.evaluate(() => document.querySelector('button').click())\n-    await session.openRedbox()\n+    await session.assertHasRedbox()\n \n     const header2 = await session.getRedboxDescription()\n     expect(header2).toMatchSnapshot()\n@@ -481,7 +481,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     )\n \n     await session.evaluate(() => document.querySelector('button').click())\n-    await session.openRedbox()\n+    await session.assertHasRedbox()\n \n     const header3 = await session.getRedboxDescription()\n     expect(header3).toMatchSnapshot()\n@@ -526,7 +526,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     )\n \n     await session.evaluate(() => document.querySelector('button').click())\n-    await session.openRedbox()\n+    await session.assertHasRedbox()\n \n     const header4 = await session.getRedboxDescription()\n     expect(header4).toEqual(\n@@ -735,23 +735,15 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     await session.patch('index.js', file)\n \n     // Unhandled error and rejection in setTimeout\n-    expect(\n-      await browser.waitForElementByCss('.nextjs-toast-errors').text()\n-    ).toBe('2 issues')\n+    expect(await getToastErrorCount(browser)).toBe(2)\n \n     // Unhandled error in event handler\n     await browser.elementById('unhandled-error').click()\n-    await check(\n-      () => browser.elementByCss('.nextjs-toast-errors').text(),\n-      /3 issues/\n-    )\n+    expect(await getToastErrorCount(browser)).toBe(3)\n \n     // Unhandled rejection in event handler\n     await browser.elementById('unhandled-rejection').click()\n-    await check(\n-      () => browser.elementByCss('.nextjs-toast-errors').text(),\n-      /4 issues/\n-    )\n+    expect(await getToastErrorCount(browser)).toBe(4)\n     await session.assertNoRedbox()\n \n     // Add Component error\n@@ -1059,7 +1051,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox app %s', () => {\n     await session.assertHasRedbox()\n     if (isTurbopack) {\n       expect(await session.getRedboxSource()).toEqual(outdent`\n-          ./app/styles2.css:1:2\n+          ./app/styles2.css (1:2)\n           Module not found: Can't resolve './boom.css'\n           > 1 | @import \"./boom.css\"\n               |  ^"
        },
        {
            "sha": "2a7cee07f8de4cf8e503fd5ef84c5034f6b6d78a",
            "filename": "test/development/acceptance-app/ReactRefreshRegression.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshRegression.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2FReactRefreshRegression.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshRegression.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -280,7 +280,8 @@ describe('ReactRefreshRegression app', () => {\n     await session.assertHasRedbox()\n \n     const source = await session.getRedboxSource()\n-    expect(source.split(/\\r?\\n/g).slice(2).join('\\n')).toMatchInlineSnapshot(`\n+    expect(source.split(/\\r?\\n/g).slice(2).join('\\n').replace(/^\\n+/, ''))\n+      .toMatchInlineSnapshot(`\n       \"> 1 | export default function () { throw new Error('boom'); }\n           |                                    ^\"\n     `)\n@@ -298,7 +299,8 @@ describe('ReactRefreshRegression app', () => {\n     await session.assertHasRedbox()\n \n     const source = await session.getRedboxSource()\n-    expect(source.split(/\\r?\\n/g).slice(2).join('\\n')).toMatchInlineSnapshot(`\n+    expect(source.split(/\\r?\\n/g).slice(2).join('\\n').replace(/^\\n+/, ''))\n+      .toMatchInlineSnapshot(`\n       \"> 1 | export default function Page() { throw new Error('boom'); }\n           |                                        ^\"\n     `)\n@@ -319,7 +321,8 @@ describe('ReactRefreshRegression app', () => {\n     await session.assertHasRedbox()\n \n     const source = await session.getRedboxSource()\n-    expect(source.split(/\\r?\\n/g).slice(2).join('\\n')).toMatchInlineSnapshot(`\n+    expect(source.split(/\\r?\\n/g).slice(2).join('\\n').replace(/^\\n+/, ''))\n+      .toMatchInlineSnapshot(`\n         \"  1 | 'use client'\n         > 2 | export default function Page() { throw new Error('boom'); }\n             |                                        ^\""
        },
        {
            "sha": "47f748fa1624d7a6fca4b17618e421f0b46b1bf8",
            "filename": "test/development/acceptance-app/__snapshots__/ReactRefreshLogBox.test.ts.snap",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -1,7 +1,7 @@\n // Jest Snapshot v1, https://goo.gl/fbAQLP\n \n exports[`ReactRefreshLogBox app default Import trace when module not found in layout 1`] = `\n-\"./app/module.js:1:1\n+\"./app/module.js (1:1)\n Module not found: Can't resolve 'non-existing-module'\n > 1 | import \"non-existing-module\"\n     | ^\n@@ -43,7 +43,7 @@ exports[`ReactRefreshLogBox app default conversion to class component (1) 1`] =\n `;\n \n exports[`ReactRefreshLogBox app default css syntax errors 1`] = `\n-\"./index.module.css:1:1\n+\"./index.module.css (1:1)\n Syntax error: Selector \"button\" is not pure (pure selectors must contain at least one local class or id)\n \n > 1 | button {}\n@@ -110,7 +110,7 @@ exports[`ReactRefreshLogBox app default should strip whitespace correctly with n\n `;\n \n exports[`ReactRefreshLogBox app turbo Import trace when module not found in layout 1`] = `\n-\"./app/module.js:1:1\n+\"./app/module.js (1:1)\n Module not found: Can't resolve 'non-existing-module'\n > 1 | import \"non-existing-module\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -119,7 +119,8 @@ https://nextjs.org/docs/messages/module-not-found\"\n `;\n \n exports[`ReactRefreshLogBox app turbo Should not show __webpack_exports__ when exporting anonymous arrow function 1`] = `\n-\"index.js (3:11) @ {default export}\n+\"index.js (3:11) @\n+{default export}\n \n   1 | export default () => {\n   2 |   if (typeof window !== 'undefined') {"
        },
        {
            "sha": "a44bd861bdea81228d1261303775a2875b4b84a8",
            "filename": "test/development/acceptance-app/error-message-url.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Ferror-message-url.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Ferror-message-url.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ferror-message-url.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -22,7 +22,9 @@ describe('Error overlay - error message urls', () => {\n \n     await session.assertHasRedbox()\n \n-    const link = await browser.elementByCss('[data-nextjs-terminal] a')\n+    const link = await browser.elementByCss(\n+      '[data-nextjs-terminal] a, [data-nextjs-codeframe] a'\n+    )\n     const text = await link.text()\n     const href = await link.getAttribute('href')\n     expect(text).toEqual("
        },
        {
            "sha": "e33577f7d872b5a5ad4b325b5df467e640b3a15a",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 31,
            "changes": 69,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -7,7 +7,9 @@ import { getRedboxTotalErrorCount, retry } from 'next-test-utils'\n \n // https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\n \n-const enableOwnerStacks = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+const enableOwnerStacks =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true' ||\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n \n describe('Error overlay for hydration errors in App router', () => {\n   const { next, isTurbopack } = nextTestSetup({\n@@ -220,41 +222,43 @@ describe('Error overlay for hydration errors in App router', () => {\n        \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <ReactDevOverlay state={{nextId:1, ...}} dispatcher={{...}} globalError={[...]}>\n-               <DevRootHTTPAccessFallbackBoundary>\n-                 <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n-                   <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n-                     <RedirectBoundary>\n-                       <RedirectErrorBoundary router={{...}}>\n-                         <Head>\n-                         <script>\n-                         <script>\n-                         <script>\n-                         <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                           <Root params={Promise}>\n-                             <html\n-       -                       className=\"server-html\"\n-                             >\n-                         ...\n-               ...\"\n+               <DevOverlayErrorBoundary devOverlay={<ShadowPortal>} globalError={[...]} ...>\n+                 <DevRootHTTPAccessFallbackBoundary>\n+                   <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n+                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n+                       <RedirectBoundary>\n+                         <RedirectErrorBoundary router={{...}}>\n+                           <Head>\n+                           <script>\n+                           <script>\n+                           <script>\n+                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                             <Root params={Promise}>\n+                               <html\n+       -                         className=\"server-html\"\n+                               >\n+                           ...\n+                 ...\"\n       `)\n     } else {\n       expect(pseudoHtml).toMatchInlineSnapshot(`\n        \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <ReactDevOverlay state={{nextId:1, ...}} dispatcher={{...}} globalError={[...]}>\n-               <DevRootHTTPAccessFallbackBoundary>\n-                 <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n-                   <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n-                     <RedirectBoundary>\n-                       <RedirectErrorBoundary router={{...}}>\n-                         <Head>\n-                         <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                           <Root params={Promise}>\n-                             <html\n-       -                       className=\"server-html\"\n-                             >\n-                         ...\n-               ...\"\n+               <DevOverlayErrorBoundary devOverlay={<ShadowPortal>} globalError={[...]} ...>\n+                 <DevRootHTTPAccessFallbackBoundary>\n+                   <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n+                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={<NotAllowedRootHTTPFallbackError>} ...>\n+                       <RedirectBoundary>\n+                         <RedirectErrorBoundary router={{...}}>\n+                           <Head>\n+                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                             <Root params={Promise}>\n+                               <html\n+       -                         className=\"server-html\"\n+                               >\n+                           ...\n+                 ...\"\n       `)\n     }\n \n@@ -796,7 +800,10 @@ describe('Error overlay for hydration errors in App router', () => {\n     await session.openRedbox()\n \n     await retry(async () => {\n-      expect(await getRedboxTotalErrorCount(browser)).toBe(2)\n+      expect(await getRedboxTotalErrorCount(browser)).toBe(\n+        // With owner stacks, we also get an error for the parent context\n+        enableOwnerStacks ? 3 : 2\n+      )\n     })\n \n     const description = await session.getRedboxDescription()"
        },
        {
            "sha": "9d104bf77f76ce95d690f6192caea214808065df",
            "filename": "test/development/acceptance-app/rsc-build-errors.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -175,7 +175,7 @@ describe('Error overlay - RSC build errors', () => {\n       // TODO: fix the issue ordering.\n       // turbopack emits the resolve issue first instead of the transform issue.\n       expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-       \"./app/server-with-errors/client-only-in-server/client-only-lib.js:1:1\n+       \"./app/server-with-errors/client-only-in-server/client-only-lib.js (1:1)\n        Ecmascript file had an error\n        > 1 | import 'client-only'\n            | ^^^^^^^^^^^^^^^^^^^^\n@@ -348,13 +348,13 @@ describe('Error overlay - RSC build errors', () => {\n     if (process.env.TURBOPACK) {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n         .toMatchInlineSnapshot(`\n-        \"./app/server-with-errors/error-file/error.js:1:1\n-        Ecmascript file had an error\n-        > 1 | export default function Error() {}\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+       \"./app/server-with-errors/error-file/error.js (1:1)\n+       Ecmascript file had an error\n+       > 1 | export default function Error() {}\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-        app/server-with-errors/error-file/error.js must be a Client Component. Add the \"use client\" directive the top of the file to resolve this issue.\n-        Learn more: https://nextjs.org/docs/app/api-reference/directives/use-client\"\n+       app/server-with-errors/error-file/error.js must be a Client Component. Add the \"use client\" directive the top of the file to resolve this issue.\n+       Learn more: https://nextjs.org/docs/app/api-reference/directives/use-client\"\n       `)\n     } else {\n       await expect(session.getRedboxSource()).resolves.toMatch("
        },
        {
            "sha": "c8125c2af8b9fff2e398c0e1e8e4aab64a79605b",
            "filename": "test/development/acceptance-app/rsc-runtime-errors.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Frsc-runtime-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Frsc-runtime-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Frsc-runtime-errors.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -8,6 +8,9 @@ import {\n   getVersionCheckerText,\n } from 'next-test-utils'\n \n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n describe('Error overlay - RSC runtime errors', () => {\n   const { next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'rsc-runtime-errors')),\n@@ -108,7 +111,11 @@ describe('Error overlay - RSC runtime errors', () => {\n \n     await assertHasRedbox(browser)\n     const versionText = await getVersionCheckerText(browser)\n-    expect(versionText).toMatch(/Next.js \\([\\w.-]+\\)/)\n+    if (isNewDevOverlay) {\n+      expect(versionText).toMatch(/Next.js [\\w.-]+/)\n+    } else {\n+      expect(versionText).toMatch(/Next.js \\([\\w.-]+\\)/)\n+    }\n   })\n \n   it('should not show the bundle layer info in the file trace', async () => {"
        },
        {
            "sha": "79e01b228c729214b31889c5adac436ee0ca9128",
            "filename": "test/development/acceptance-app/version-staleness.test.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 19,
            "changes": 62,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -11,6 +11,9 @@ function getStaleness(browser: BrowserInterface) {\n     .text()\n }\n \n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n describe('Error Overlay version staleness', () => {\n   const { next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n@@ -47,14 +50,29 @@ describe('Error Overlay version staleness', () => {\n \n     await session.openRedbox()\n \n-    if (process.env.TURBOPACK) {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (1.0.0) is outdated (learn more) (Turbopack)\"`\n-      )\n+    if (isNewDevOverlay) {\n+      if (process.env.TURBOPACK) {\n+        expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+         \"Next.js 1.0.0 (outdated)\n+         (learn more)\n+         Turbopack\"\n+        `)\n+      } else {\n+        expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+         \"Next.js 1.0.0 (outdated)\n+         (learn more)\"\n+        `)\n+      }\n     } else {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (1.0.0) is outdated (learn more)\"`\n-      )\n+      if (process.env.TURBOPACK) {\n+        expect(await getStaleness(browser)).toMatchInlineSnapshot(\n+          `\"Next.js (1.0.0) is outdated (learn more) (Turbopack)\"`\n+        )\n+      } else {\n+        expect(await getStaleness(browser)).toMatchInlineSnapshot(\n+          `\"Next.js (1.0.0) is outdated (learn more)\"`\n+        )\n+      }\n     }\n   })\n \n@@ -83,13 +101,16 @@ describe('Error Overlay version staleness', () => {\n     )\n \n     if (process.env.TURBOPACK) {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (2.0.0) is outdated (learn more) (Turbopack)\"`\n-      )\n+      expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+       \"Next.js 2.0.0 (outdated)\n+       (learn more)\n+       Turbopack\"\n+      `)\n     } else {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (2.0.0) is outdated (learn more)\"`\n-      )\n+      expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+       \"Next.js 2.0.0 (outdated)\n+       (learn more)\"\n+      `)\n     }\n   })\n \n@@ -115,13 +136,16 @@ describe('Error Overlay version staleness', () => {\n     )\n \n     if (process.env.TURBOPACK) {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (3.0.0) is outdated (learn more) (Turbopack)\"`\n-      )\n+      expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+       \"Next.js 3.0.0 (outdated)\n+       (learn more)\n+       Turbopack\"\n+      `)\n     } else {\n-      expect(await getStaleness(browser)).toMatchInlineSnapshot(\n-        `\"Next.js (3.0.0) is outdated (learn more)\"`\n-      )\n+      expect(await getStaleness(browser)).toMatchInlineSnapshot(`\n+       \"Next.js 3.0.0 (outdated)\n+       (learn more)\"\n+      `)\n     }\n   })\n })"
        },
        {
            "sha": "2bec2fbfd931a4e7850f7da079fef0bf8292ea97",
            "filename": "test/development/acceptance/ReactRefreshLogBox-app-doc.test.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-app-doc.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-app-doc.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-app-doc.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -97,15 +97,15 @@ describe.each(['default', 'turbo'])(\n       const source = next.normalizeTestDirContent(content)\n       if (process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n-          \"./pages/_app.js:2:11\n-          Parsing ecmascript source code failed\n-            1 | function MyApp({ Component, pageProps }) {\n-          > 2 |   return <<Component {...pageProps} />;\n-              |           ^\n-            3 | }\n-            4 | export default MyApp\n-\n-          Expression expected\"\n+         \"./pages/_app.js (2:11)\n+         Parsing ecmascript source code failed\n+           1 | function MyApp({ Component, pageProps }) {\n+         > 2 |   return <<Component {...pageProps} />;\n+             |           ^\n+           3 | }\n+           4 | export default MyApp\n+\n+         Expression expected\"\n         `)\n       } else {\n         expect(source).toMatchInlineSnapshot(`\n@@ -184,17 +184,17 @@ describe.each(['default', 'turbo'])(\n       )\n       if (process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n-          \"./pages/_document.js:3:36\n-          Parsing ecmascript source code failed\n-            1 | import Document, { Html, Head, Main, NextScript } from 'next/document'\n-            2 |\n-          > 3 | class MyDocument extends Document {{\n-              |                                    ^\n-            4 |   static async getInitialProps(ctx) {\n-            5 |     const initialProps = await Document.getInitialProps(ctx)\n-            6 |     return { ...initialProps }\n-\n-          Unexpected token \\`{\\`. Expected identifier, string literal, numeric literal or [ for the computed key\"\n+         \"./pages/_document.js (3:36)\n+         Parsing ecmascript source code failed\n+           1 | import Document, { Html, Head, Main, NextScript } from 'next/document'\n+           2 |\n+         > 3 | class MyDocument extends Document {{\n+             |                                    ^\n+           4 |   static async getInitialProps(ctx) {\n+           5 |     const initialProps = await Document.getInitialProps(ctx)\n+           6 |     return { ...initialProps }\n+\n+         Unexpected token \\`{\\`. Expected identifier, string literal, numeric literal or [ for the computed key\"\n         `)\n       } else {\n         expect(source).toMatchInlineSnapshot(`"
        },
        {
            "sha": "8134e33c19a2fb077ecd4ef9e2c73fad2cdd2742",
            "filename": "test/development/acceptance/ReactRefreshLogBox-builtins.test.ts",
            "status": "modified",
            "additions": 72,
            "deletions": 72,
            "changes": 144,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -47,27 +47,27 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     await session.assertHasRedbox()\n     if (process.env.TURBOPACK) {\n       expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"./node_modules/my-package/index.js:1:13\n-        Module not found: Can't resolve 'dns'\n-        > 1 | const dns = require('dns')\n-            |             ^^^^^^^^^^^^^^\n-          2 | module.exports = dns\n+       \"./node_modules/my-package/index.js (1:13)\n+       Module not found: Can't resolve 'dns'\n+       > 1 | const dns = require('dns')\n+           |             ^^^^^^^^^^^^^^\n+         2 | module.exports = dns\n \n-        https://nextjs.org/docs/messages/module-not-found\"\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-        \"./node_modules/my-package/index.js:1:1\n-        Module not found: Can't resolve 'dns'\n-        > 1 | const dns = require('dns')\n-            | ^\n-          2 | module.exports = dns\n+       \"./node_modules/my-package/index.js (1:1)\n+       Module not found: Can't resolve 'dns'\n+       > 1 | const dns = require('dns')\n+           | ^\n+         2 | module.exports = dns\n \n-        https://nextjs.org/docs/messages/module-not-found\n+       https://nextjs.org/docs/messages/module-not-found\n \n-        Import trace for requested module:\n-        ./index.js\n-        ./pages/index.js\"\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\"\n       `)\n     }\n   })\n@@ -96,30 +96,30 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^^^^^^^^^^^^^^^^^^^^\n-          2 |\n-          3 | export default function Oops() {\n-          4 |   return (\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function Oops() {\n+         4 |   return (\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^\n-          2 |\n-          3 | export default function Oops() {\n-          4 |   return (\n-\n-        https://nextjs.org/docs/messages/module-not-found\n-\n-        Import trace for requested module:\n-        ./pages/index.js\"\n+       \"./index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^\n+         2 |\n+         3 | export default function Oops() {\n+         4 |   return (\n+\n+       https://nextjs.org/docs/messages/module-not-found\n+\n+       Import trace for requested module:\n+       ./pages/index.js\"\n       `)\n     }\n   })\n@@ -148,27 +148,27 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./pages/index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^^^^^^^^^^^^^^^^^^^^\n-          2 |\n-          3 | export default function Oops() {\n-          4 |   return (\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./pages/index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function Oops() {\n+         4 |   return (\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./pages/index.js:1:1\n-        Module not found: Can't resolve 'b'\n-        > 1 | import Comp from 'b'\n-            | ^\n-          2 |\n-          3 | export default function Oops() {\n-          4 |   return (\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./pages/index.js (1:1)\n+       Module not found: Can't resolve 'b'\n+       > 1 | import Comp from 'b'\n+           | ^\n+         2 |\n+         3 | export default function Oops() {\n+         4 |   return (\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     }\n   })\n@@ -203,27 +203,27 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     const source = await session.getRedboxSource()\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./pages/_app.js:1:1\n-        Module not found: Can't resolve './non-existent.css'\n-        > 1 | import './non-existent.css'\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-          2 |\n-          3 | export default function App({ Component, pageProps }) {\n-          4 |   return <Component {...pageProps} />\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./pages/_app.js (1:1)\n+       Module not found: Can't resolve './non-existent.css'\n+       > 1 | import './non-existent.css'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function App({ Component, pageProps }) {\n+         4 |   return <Component {...pageProps} />\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./pages/_app.js:1:1\n-        Module not found: Can't resolve './non-existent.css'\n-        > 1 | import './non-existent.css'\n-            | ^\n-          2 |\n-          3 | export default function App({ Component, pageProps }) {\n-          4 |   return <Component {...pageProps} />\n-\n-        https://nextjs.org/docs/messages/module-not-found\"\n+       \"./pages/_app.js (1:1)\n+       Module not found: Can't resolve './non-existent.css'\n+       > 1 | import './non-existent.css'\n+           | ^\n+         2 |\n+         3 | export default function App({ Component, pageProps }) {\n+         4 |   return <Component {...pageProps} />\n+\n+       https://nextjs.org/docs/messages/module-not-found\"\n       `)\n     }\n "
        },
        {
            "sha": "00851f6f021f85e572c70de0b959bc9507f4f3eb",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -213,14 +213,14 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     const source = next.normalizeTestDirContent(await session.getRedboxSource())\n     if (process.env.TURBOPACK) {\n       expect(source).toMatchInlineSnapshot(`\n-        \"./index.js:7:1\n-        Parsing ecmascript source code failed\n-          5 |     div\n-          6 |   )\n-        > 7 | }\n-            | ^\n-\n-        Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+       \"./index.js (7:1)\n+       Parsing ecmascript source code failed\n+         5 |     div\n+         6 |   )\n+       > 7 | }\n+           | ^\n+\n+       Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n       `)\n     } else {\n       expect(source).toMatchInlineSnapshot(`\n@@ -345,8 +345,8 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     const source = await session.getRedboxSource()\n     expect(source).toMatch(\n       process.env.TURBOPACK\n-        ? './index.module.css:1:9'\n-        : './index.module.css:1:1'\n+        ? './index.module.css (1:9)'\n+        : './index.module.css (1:1)'\n     )\n     if (!process.env.TURBOPACK) {\n       expect(source).toMatch('Syntax error: ')"
        },
        {
            "sha": "a2bcca89152df5a4d180b2f0231ed0b67284fc07",
            "filename": "test/development/acceptance/ReactRefreshRegression.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -284,9 +284,10 @@ describe('ReactRefreshRegression', () => {\n     await session.assertHasRedbox()\n \n     const source = await session.getRedboxSource()\n-    expect(source.split(/\\r?\\n/g).slice(2).join('\\n')).toMatchInlineSnapshot(`\n-      \"> 1 | export default function () { throw new Error('boom'); }\n-          |                                    ^\"\n+    expect(source.split(/\\r?\\n/g).slice(2).join('\\n').replace(/^\\n+/, ''))\n+      .toMatchInlineSnapshot(`\n+     \"> 1 | export default function () { throw new Error('boom'); }\n+         |                                    ^\"\n     `)\n   })\n "
        },
        {
            "sha": "efb7f8a2d99a2f5ba6cbb63208545c23f37d18b1",
            "filename": "test/development/acceptance/__snapshots__/ReactRefreshLogBox.test.ts.snap",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2F__snapshots__%2FReactRefreshLogBox.test.ts.snap?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -19,7 +19,7 @@ exports[`ReactRefreshLogBox default conversion to class component (1) 1`] = `\n `;\n \n exports[`ReactRefreshLogBox default css syntax errors 1`] = `\n-\"./index.module.css:1:1\n+\"./index.module.css (1:1)\n Syntax error: Selector \"button\" is not pure (pure selectors must contain at least one local class or id)\n \n > 1 | button {}"
        },
        {
            "sha": "54c9808b625db197670fd39e2022f1ba98fd8189",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -437,14 +437,14 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     if (isTurbopack) {\n       // TODO: Remove this branching once import traces are implemented in Turbopack\n       expect(redboxSource).toMatchInlineSnapshot(`\n-        \"./index.js:7:41\n-        Parsing ecmascript source code failed\n-          5 |   throw Error('no ' + i)\n-          6 | }, 1000)\n-        > 7 | export default function FunctionNamed() {\n-            |                                         ^\n-\n-        Expected '}', got '<eof>'\"\n+       \"./index.js (7:41)\n+       Parsing ecmascript source code failed\n+         5 |   throw Error('no ' + i)\n+         6 | }, 1000)\n+       > 7 | export default function FunctionNamed() {\n+           |                                         ^\n+\n+       Expected '}', got '<eof>'\"\n       `)\n     } else {\n       expect(redboxSource).toMatchInlineSnapshot(`\n@@ -474,14 +474,14 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n     if (isTurbopack) {\n       // TODO: Remove this branching once import traces are implemented in Turbopack\n       expect(redboxSource).toMatchInlineSnapshot(`\n-        \"./index.js:7:41\n-        Parsing ecmascript source code failed\n-          5 |   throw Error('no ' + i)\n-          6 | }, 1000)\n-        > 7 | export default function FunctionNamed() {\n-            |                                         ^\n-\n-        Expected '}', got '<eof>'\"\n+       \"./index.js (7:41)\n+       Parsing ecmascript source code failed\n+         5 |   throw Error('no ' + i)\n+         6 | }, 1000)\n+       > 7 | export default function FunctionNamed() {\n+           |                                         ^\n+\n+       Expected '}', got '<eof>'\"\n       `)\n     } else {\n       expect(redboxSource).toMatchInlineSnapshot(`"
        },
        {
            "sha": "da7266d5fb7a38e62f1a0d508d7ea31cb80dfe70",
            "filename": "test/development/acceptance/hydration-error.test.ts",
            "status": "modified",
            "additions": 47,
            "deletions": 28,
            "changes": 75,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -1,11 +1,13 @@\n-/* eslint-env jest */\n import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import path from 'path'\n import { outdent } from 'outdent'\n import { getRedboxTotalErrorCount, retry } from 'next-test-utils'\n \n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n // https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\n \n describe('Error overlay for hydration errors in Pages router', () => {\n@@ -123,15 +125,16 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n                            <main className=\"child\">\n        +                     client\n        -                     server\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n     await session.patch(\n@@ -192,13 +195,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        +                   <main className=\"only\">\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n \n@@ -256,7 +260,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n@@ -265,7 +269,8 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        +                   second\n        -                   <footer className=\"3\">\n                            ...\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n \n@@ -316,13 +321,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        -                   <main className=\"only\">\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n \n@@ -382,13 +388,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Mismatch>\n                          <div className=\"parent\">\n        -                   only\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n   })\n@@ -449,13 +456,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        +                 <table>\n        -                 test\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n   })\n@@ -480,7 +488,11 @@ describe('Error overlay for hydration errors in Pages router', () => {\n       ])\n     )\n     const { session, browser } = sandbox\n-    await expect(session.hasErrorToast()).resolves.toBe(false)\n+\n+    // in the new overlay, `assertHasRedbox` is redundant with `hasErrorToast`\n+    if (!isNewDevOverlay) {\n+      await expect(session.hasErrorToast()).resolves.toBe(false)\n+    }\n \n     await session.assertHasRedbox()\n \n@@ -509,13 +521,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n              <AppContainer>\n                <Container fn={function fn}>\n                  <ReactDevOverlay>\n-                   <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                   <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                      <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                        <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                          <Page>\n          +                 <table>\n          -                 {\" 123\"}\n-                       ...\"\n+                       ...\n+                   ...\"\n         `)\n       } else {\n         expect(pseudoHtml).toMatchInlineSnapshot(`\n@@ -524,13 +537,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n              <AppContainer>\n                <Container fn={function fn}>\n                  <ReactDevOverlay>\n-                   <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                   <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                      <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                        <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                          <Page>\n          +                 <table>\n          -                 {\" 123\"}\n-                       ...\"\n+                       ...\n+                   ...\"\n         `)\n       }\n       expect(await getRedboxTotalErrorCount(browser)).toBe(1)\n@@ -575,7 +589,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n       expect(pseudoHtml).toMatchInlineSnapshot(`\n        \"...\n            <ReactDevOverlay>\n-             <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+             <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                  <App pageProps={{}} Component={function Mismatch} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                    <Mismatch>\n@@ -585,7 +599,8 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        +                 <main className=\"second\">\n        -                 <footer className=\"3\">\n                          ...\n-                 ...\"\n+                 ...\n+             ...\"\n       `)\n     }\n \n@@ -685,13 +700,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        >                 <p>\n        >                   <p>\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n   })\n@@ -751,15 +767,16 @@ describe('Error overlay for hydration errors in Pages router', () => {\n        \"...\n            <Container fn={function fn}>\n              <ReactDevOverlay>\n-               <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+               <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                  <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                    <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                      <Page>\n                        <div>\n                          <div>\n        >                   <p>\n        >                     <div>\n-                   ...\"\n+                   ...\n+               ...\"\n       `)\n     }\n   })\n@@ -811,13 +828,14 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n        >                 <div>\n        >                   <tr>\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n   })\n@@ -875,7 +893,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            <AppContainer>\n              <Container fn={function fn}>\n                <ReactDevOverlay>\n-                 <ErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n+                 <DevOverlayErrorBoundary onError={function usePagesReactDevOverlay.useCallback[onComponentError]}>\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n@@ -885,7 +903,8 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                                <span>\n                                  <span>\n        >                           <p>\n-                     ...\"\n+                     ...\n+                 ...\"\n       `)\n     }\n   })"
        },
        {
            "sha": "f3b2a6d318c2c7bcff60b7a47e70131b79d036ac",
            "filename": "test/development/acceptance/server-component-compiler-errors-in-pages.test.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 27,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -52,15 +52,15 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n     if (process.env.TURBOPACK) {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n         .toMatchInlineSnapshot(`\n-        \"./components/Comp.js:1:1\n-        Ecmascript file had an error\n-        > 1 | import { cookies } from 'next/headers'\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-          2 |\n-          3 | export default function Page() {\n-          4 |   return <p>hello world</p>\n-\n-        You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       \"./components/Comp.js (1:1)\n+       Ecmascript file had an error\n+       > 1 | import { cookies } from 'next/headers'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function Page() {\n+         4 |   return <p>hello world</p>\n+\n+       You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n     } else {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n@@ -108,15 +108,15 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n     if (process.env.TURBOPACK) {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n         .toMatchInlineSnapshot(`\n-        \"./components/Comp.js:1:1\n-        Ecmascript file had an error\n-        > 1 | import 'server-only'\n-            | ^^^^^^^^^^^^^^^^^^^^\n-          2 |\n-          3 | export default function Page() {\n-          4 |   return 'hello world'\n-\n-        You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       \"./components/Comp.js (1:1)\n+       Ecmascript file had an error\n+       > 1 | import 'server-only'\n+           | ^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function Page() {\n+         4 |   return 'hello world'\n+\n+       You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n     } else {\n       expect(\n@@ -166,15 +166,15 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n     if (process.env.TURBOPACK) {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n         .toMatchInlineSnapshot(`\n-        \"./components/Comp.js:1:10\n-        Ecmascript file had an error\n-        > 1 | import { after } from 'next/server'\n-            |          ^^^^^\n-          2 |\n-          3 | export default function Page() {\n-          4 |   return 'hello world'\n-\n-        You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n+       \"./components/Comp.js (1:10)\n+       Ecmascript file had an error\n+       > 1 | import { after } from 'next/server'\n+           |          ^^^^^\n+         2 |\n+         3 | export default function Page() {\n+         4 |   return 'hello world'\n+\n+       You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n     } else {\n       expect("
        },
        {
            "sha": "b3dab05e1538ba96ac044984924c1a068fe909e3",
            "filename": "test/development/app-dir/capture-console-error/capture-console-error.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error%2Fcapture-console-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error%2Fcapture-console-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error%2Fcapture-console-error.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -34,8 +34,8 @@ describe('app-dir - capture-console-error', () => {\n     files: __dirname,\n   })\n \n-  if (process.env.__NEXT_EXPERIMENTAL_PPR === 'true') {\n-    it('skip test for experimental PPR', () => {\n+  if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n+    it('skip test for new overlay', () => {\n       // Cover these tests in the owner stack tests suite\n     })\n     return"
        },
        {
            "sha": "768a400a81460d384d088cacd27f1a03e7f4f887",
            "filename": "test/development/app-dir/error-overlay/error-ignored-frames/error-ignored-frames.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -11,9 +11,8 @@ describe('error-ignored-frames', () => {\n   })\n \n   if (\n-    // TODO: remove this when reactOwnerStack is enabled by default\n-    // Since PPR mode is just going to add owner stack, skip this test for now\n-    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+    // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+    process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true' ||\n     // Skip react 18 test as the call stacks are different\n     process.env.NEXT_TEST_REACT_VERSION === '18.3.1'\n   ) {"
        },
        {
            "sha": "41ab3f1b91c8d97d9dbb28d576422e54324a9aa5",
            "filename": "test/development/app-dir/missing-required-html-tags-new-overlay/missing-html-tags-new-overlay.test.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 25,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fmissing-required-html-tags-new-overlay%2Fmissing-html-tags-new-overlay.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fmissing-required-html-tags-new-overlay%2Fmissing-html-tags-new-overlay.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fmissing-required-html-tags-new-overlay%2Fmissing-html-tags-new-overlay.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -9,39 +9,43 @@ import {\n } from 'next-test-utils'\n import { outdent } from 'outdent'\n \n-// TODO: merge with test/development/app-dir/missing-required-html-tags/index.test.ts\n+// TODO(new-dev-overlay): merge with test/development/app-dir/missing-required-html-tags/index.test.ts\n //  once new overlay is stable\n-describe('app-dir - missing required html tags', () => {\n-  const { next } = nextTestSetup({\n-    files: __dirname,\n-  })\n+const isDisabled = process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'false'\n+;(isDisabled ? describe.skip : describe)(\n+  'app-dir - missing required html tags',\n+  () => {\n+    const { next } = nextTestSetup({\n+      files: __dirname,\n+    })\n \n-  it('should display correct error count in dev indicator', async () => {\n-    const browser = await next.browser('/')\n+    it('should display correct error count in dev indicator', async () => {\n+      const browser = await next.browser('/')\n \n-    retry(async () => {\n-      expect(await hasErrorToast(browser)).toBe(true)\n-    })\n-    // Dev indicator should show 1 error\n-    expect(await getToastErrorCount(browser)).toBe(1)\n+      retry(async () => {\n+        expect(await hasErrorToast(browser)).toBe(true)\n+      })\n+      // Dev indicator should show 1 error\n+      expect(await getToastErrorCount(browser)).toBe(1)\n \n-    await assertHasRedbox(browser)\n+      await assertHasRedbox(browser)\n \n-    await retry(async () => {\n-      expect(await getRedboxDescription(browser)).toEqual(outdent`\n+      await retry(async () => {\n+        expect(await getRedboxDescription(browser)).toEqual(outdent`\n         The following tags are missing in the Root Layout: <html>.\n         Read more at https://nextjs.org/docs/messages/missing-root-layout-tags\n       `)\n-    })\n+      })\n \n-    await next.patchFile('app/layout.js', (code) =>\n-      code.replace(\n-        'return <body>{children}</body>',\n-        'return <html><body>{children}</body></html>'\n+      await next.patchFile('app/layout.js', (code) =>\n+        code.replace(\n+          'return <body>{children}</body>',\n+          'return <html><body>{children}</body></html>'\n+        )\n       )\n-    )\n \n-    await assertNoRedbox(browser)\n-    expect(await browser.elementByCss('p').text()).toBe('hello world')\n-  })\n-})\n+      await assertNoRedbox(browser)\n+      expect(await browser.elementByCss('p').text()).toBe('hello world')\n+    })\n+  }\n+)"
        },
        {
            "sha": "b5e6dba19748723fc8575716b764b28dd3de0553",
            "filename": "test/development/app-dir/owner-stack-invalid-element-type/invalid-element-type.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Finvalid-element-type.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Finvalid-element-type.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Finvalid-element-type.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -7,8 +7,10 @@ import {\n   getStackFramesContent,\n } from 'next-test-utils'\n \n-// TODO: When owner stack is enabled by default, remove the condition and only keep one test\n-const isOwnerStackEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+// TODO(new-dev-overlay): When owner stack is enabled by default, remove the condition and only keep one test\n+const isOwnerStackEnabled =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true' ||\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n \n ;(isOwnerStackEnabled ? describe.skip : describe)(\n   'app-dir - invalid-element-type',"
        },
        {
            "sha": "a417f0bdd6c111412b0839be7a05fd9f1ea35bf3",
            "filename": "test/development/app-dir/owner-stack-invalid-element-type/owner-stack-invalid-element-type.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -5,10 +5,10 @@ import {\n   getStackFramesContent,\n } from 'next-test-utils'\n \n-// TODO: When owner stack is enabled by default, remove the condition and only keep one test\n+// TODO(new-dev-overlay): When owner stack is enabled by default, remove the condition and only keep one test\n const isOwnerStackEnabled =\n   process.env.TEST_OWNER_STACK !== 'false' ||\n-  process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n ;(isOwnerStackEnabled ? describe : describe.skip)(\n   'app-dir - owner-stack-invalid-element-type',"
        },
        {
            "sha": "87b8c69962fb73351ad772c88bf79cef4b4de4fe",
            "filename": "test/development/app-dir/owner-stack-react-missing-key-prop/owner-stack-react-missing-key-prop.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -5,10 +5,12 @@ import {\n   getStackFramesContent,\n } from 'next-test-utils'\n \n-// TODO: When owner stack is enabled by default, remove the condition and only keep one test\n-const isOwnerStackEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+// TODO(new-dev-overlay): When owner stack is enabled by default, remove the condition and only keep one test\n+const isExperimentalReact =\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n-;(isOwnerStackEnabled ? describe : describe.skip)(\n+;(isExperimentalReact ? describe : describe.skip)(\n   'app-dir - owner-stack-react-missing-key-prop',\n   () => {\n     const { next } = nextTestSetup({\n@@ -24,21 +26,21 @@ const isOwnerStackEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n \n       if (process.env.TURBOPACK) {\n         expect(stackFramesContent).toMatchInlineSnapshot(`\n-          \"at span (<anonymous> (0:0))\n-          at <anonymous> (app/rsc/page.tsx (7:10))\n-          at Page (app/rsc/page.tsx (6:13))\"\n-          `)\n+         \"at span ()\n+         at <anonymous> (app/rsc/page.tsx (7:10))\n+         at Page (app/rsc/page.tsx (6:13))\"\n+        `)\n         expect(source).toMatchInlineSnapshot(`\n-            \"app/rsc/page.tsx (7:10) @ <anonymous>\n-            \n+         \"app/rsc/page.tsx (7:10) @ <anonymous>\n+\n             5 |     <div>\n             6 |       {list.map((item, index) => (\n          >  7 |         <span>{item}</span>\n               |          ^\n             8 |       ))}\n             9 |     </div>\n            10 |   )\"\n-              `)\n+        `)\n       } else {\n         expect(stackFramesContent).toMatchInlineSnapshot(`\n          \"at span ()\n@@ -67,9 +69,9 @@ const isOwnerStackEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n       const source = await getRedboxSource(browser)\n       if (process.env.TURBOPACK) {\n         expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at p (<anonymous> (0:0))\n+         \"at p ()\n          at <unknown> (app/ssr/page.tsx (9:9))\n-         at Array.map (<anonymous> (0:0))\n+         at Array.map ()\n          at Page (app/ssr/page.tsx (8:13))\"\n         `)\n         expect(source).toMatchInlineSnapshot(`"
        },
        {
            "sha": "9e382dc755f29c48c1f841569121196f9d6e20e9",
            "filename": "test/development/app-dir/owner-stack-react-missing-key-prop/react-missing-key-prop.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Freact-missing-key-prop.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Freact-missing-key-prop.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Freact-missing-key-prop.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -5,8 +5,10 @@ import {\n   hasRedboxCallStack,\n } from 'next-test-utils'\n \n-// TODO: When owner stack is enabled by default, remove the condition and only keep one test\n-const isOwnerStackEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+// TODO(new-dev-overlay): When owner stack is enabled by default, remove the condition and only keep one test\n+const isExperimentalReact =\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n async function getStackFramesContent(browser) {\n   await hasRedboxCallStack(browser)\n@@ -37,7 +39,7 @@ async function getStackFramesContent(browser) {\n }\n \n // Without owner stack, the source is not available\n-;(isOwnerStackEnabled ? describe.skip : describe)(\n+;(isExperimentalReact ? describe.skip : describe)(\n   'app-dir - react-missing-key-prop',\n   () => {\n     const { next } = nextTestSetup({"
        },
        {
            "sha": "e1abcaac33789041f0712f18f1f5391e6fe24c69",
            "filename": "test/development/app-dir/owner-stack/owner-stack.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -71,7 +71,7 @@ describe('app-dir - owner-stack', () => {\n       return log.message.includes('Error: browser error')\n     }).message\n \n-    // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+    // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n     if (isNewDevOverlay) {\n       if (process.env.TURBOPACK) {\n         expect(normalizeStackTrace(errorLog)).toMatchInlineSnapshot(`\n@@ -115,22 +115,22 @@ describe('app-dir - owner-stack', () => {\n     } else {\n       if (process.env.TURBOPACK) {\n         expect(normalizeStackTrace(errorLog)).toMatchInlineSnapshot(`\n-          \"%o\n-          %s Error: browser error\n-          at useThrowError \n-          at useErrorHook \n-          at Page \n-          at react-stack-bottom-frame \n-          at renderWithHooks \n-          at updateFunctionComponent \n-          at beginWork \n-          at runWithFiberInDEV \n-          at performUnitOfWork \n-          at workLoopSync \n-          at renderRootSync \n-          at performWorkOnRoot \n-          at performWorkOnRootViaSchedulerTask \n-          at MessagePort.performWorkUntilDeadline  The above error occurred in the <Page> component. It was handled by the <ReactDevOverlay> error boundary.\"\n+         \"%o\n+         %s Error: browser error\n+         at useThrowError \n+         at useErrorHook \n+         at Page \n+         at react-stack-bottom-frame \n+         at renderWithHooks \n+         at updateFunctionComponent \n+         at beginWork \n+         at runWithFiberInDEV \n+         at performUnitOfWork \n+         at workLoopSync \n+         at renderRootSync \n+         at performWorkOnRoot \n+         at performWorkOnRootViaSchedulerTask \n+         at MessagePort.performWorkUntilDeadline  The above error occurred in the <Page> component. It was handled by the <DevOverlayErrorBoundary> error boundary.\"\n         `)\n       } else {\n         expect(normalizeStackTrace(errorLog)).toMatchInlineSnapshot(`\n@@ -260,7 +260,7 @@ describe('app-dir - owner-stack', () => {\n        at performWorkOnRoot \n        at performWorkOnRootViaSchedulerTask \n        at MessagePort.performWorkUntilDeadline  The above error occurred in the <Page> component. It was handled by the <ReactDevOverlay> error boundary.\"\n-    `)\n+      `)\n     }\n   })\n "
        },
        {
            "sha": "fbd86cdf706bd006497739c116ec9a6168acb525",
            "filename": "test/development/app-dir/server-component-next-dynamic-ssr-false/server-component-next-dynamic-ssr-false.test.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 25,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserver-component-next-dynamic-ssr-false%2Fserver-component-next-dynamic-ssr-false.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -5,7 +5,7 @@ import {\n   getRedboxSource,\n } from 'next-test-utils'\n \n-// Enabling PPR testing also enables the new dev overlay.\n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n const isNewDevOverlay =\n   process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n@@ -24,23 +24,22 @@ describe('app-dir - server-component-next-dynamic-ssr-false', () => {\n \n     expect(redbox.description).toBe('Failed to compile')\n \n-    // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+    // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n     if (isNewDevOverlay) {\n       if (process.env.TURBOPACK) {\n         expect(redbox.source).toMatchInlineSnapshot(`\n-                \"./app/page.js (3:23)\n+         \"./app/page.js (3:23)\n+         Ecmascript file had an error\n+           1 | import dynamic from 'next/dynamic'\n+           2 |\n+         > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n+             |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+           4 |\n+           5 | export default function Page() {\n+           6 |   return <DynamicClient />\n \n-                Ecmascript file had an error\n-                  1 | import dynamic from 'next/dynamic'\n-                  2 |\n-                > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n-                    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-                  4 |\n-                  5 | export default function Page() {\n-                  6 |   return <DynamicClient />\n-\n-                \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a client component.\"\n-              `)\n+         \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a client component.\"\n+        `)\n       } else {\n         expect(redbox.source).toMatchInlineSnapshot(`\n          \"./app/page.js\n@@ -59,18 +58,18 @@ describe('app-dir - server-component-next-dynamic-ssr-false', () => {\n     } else {\n       if (process.env.TURBOPACK) {\n         expect(redbox.source).toMatchInlineSnapshot(`\n-                 \"./app/page.js:3:23\n-                 Ecmascript file had an error\n-                   1 | import dynamic from 'next/dynamic'\n-                   2 |\n-                 > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n-                     |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-                   4 |\n-                   5 | export default function Page() {\n-                   6 |   return <DynamicClient />\n+         \"./app/page.js (3:23)\n+         Ecmascript file had an error\n+           1 | import dynamic from 'next/dynamic'\n+           2 |\n+         > 3 | const DynamicClient = dynamic(() => import('./client'), { ssr: false })\n+             |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+           4 |\n+           5 | export default function Page() {\n+           6 |   return <DynamicClient />\n \n-                 \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a client component.\"\n-              `)\n+         \\`ssr: false\\` is not allowed with \\`next/dynamic\\` in Server Components. Please move it into a client component.\"\n+        `)\n       } else {\n         expect(redbox.source).toMatchInlineSnapshot(`\n                  \"./app/page.js"
        },
        {
            "sha": "b76851ee1492b257fc5042f94efe9df87b1d4e27",
            "filename": "test/development/app-dir/ssr-in-rsc/ssr-in-rsc.test.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 43,
            "changes": 89,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -7,8 +7,11 @@ import {\n   getRedboxSource,\n } from 'next-test-utils'\n \n-const isReactExperimental = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n-const isNewDevOverlay = isReactExperimental\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+const isReactExperimental =\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true' || isNewDevOverlay\n+\n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n \n describe('react-dom/server in React Server environment', () => {\n@@ -282,21 +285,21 @@ describe('react-dom/server in React Server environment', () => {\n     }\n     if (isTurbopack) {\n       expect(redbox).toMatchInlineSnapshot(`\n-        {\n-          \"description\": \"Failed to compile\",\n-          \"source\": \"./app/exports/app-code/react-dom-server-edge-implicit/page.js:3:1\n-        Ecmascript file had an error\n-          1 | import * as ReactDOMServerEdge from 'react-dom/server'\n-          2 | // Fine to drop once React is on ESM\n-        > 3 | import ReactDOMServerEdgeDefault from 'react-dom/server'\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-          4 |\n-          5 | export const runtime = 'edge'\n-          6 |\n-\n-        You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n-        Learn more: https://nextjs.org/docs/app/building-your-application/rendering\",\n-        }\n+       {\n+         \"description\": \"Failed to compile\",\n+         \"source\": \"./app/exports/app-code/react-dom-server-edge-implicit/page.js (3:1)\n+       Ecmascript file had an error\n+         1 | import * as ReactDOMServerEdge from 'react-dom/server'\n+         2 | // Fine to drop once React is on ESM\n+       > 3 | import ReactDOMServerEdgeDefault from 'react-dom/server'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         4 |\n+         5 | export const runtime = 'edge'\n+         6 |\n+\n+       You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+       Learn more: https://nextjs.org/docs/app/building-your-application/rendering\",\n+       }\n       `)\n     } else {\n       expect(redbox).toMatchInlineSnapshot(`\n@@ -377,24 +380,24 @@ describe('react-dom/server in React Server environment', () => {\n     }\n     if (isTurbopack) {\n       expect(redbox).toMatchInlineSnapshot(`\n-        {\n-          \"description\": \"Failed to compile\",\n-          \"source\": \"./app/exports/app-code/react-dom-server-node-implicit/page.js:3:1\n-        Ecmascript file had an error\n-          1 | import * as ReactDOMServerNode from 'react-dom/server'\n-          2 | // Fine to drop once React is on ESM\n-        > 3 | import ReactDOMServerNodeDefault from 'react-dom/server'\n-            | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-          4 |\n-          5 | export const runtime = 'nodejs'\n-          6 |\n-\n-        You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n-        Learn more: https://nextjs.org/docs/app/building-your-application/rendering\",\n-        }\n+       {\n+         \"description\": \"Failed to compile\",\n+         \"source\": \"./app/exports/app-code/react-dom-server-node-implicit/page.js (3:1)\n+       Ecmascript file had an error\n+         1 | import * as ReactDOMServerNode from 'react-dom/server'\n+         2 | // Fine to drop once React is on ESM\n+       > 3 | import ReactDOMServerNodeDefault from 'react-dom/server'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         4 |\n+         5 | export const runtime = 'nodejs'\n+         6 |\n+\n+       You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+       Learn more: https://nextjs.org/docs/app/building-your-application/rendering\",\n+       }\n       `)\n     } else {\n-      // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+      // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n       if (isNewDevOverlay) {\n         expect(redbox).toMatchInlineSnapshot(`\n          {\n@@ -831,16 +834,16 @@ describe('react-dom/server in React Server environment', () => {\n         `)\n       } else {\n         expect(redbox).toMatchInlineSnapshot(`\n-          {\n-            \"description\": \"Error: react-dom/server is not supported in React Server Components.\",\n-            \"source\": \"internal-pkg/server.node.js (1:1) @ [project]/internal-pkg/server.node.js [app-rsc] (ecmascript)\n-\n-          > 1 | import * as ReactDOMServerEdge from 'react-dom/server.node'\n-              | ^\n-            2 | // Fine to drop once React is on ESM\n-            3 | import ReactDOMServerEdgeDefault from 'react-dom/server.node'\n-            4 |\",\n-          }\n+         {\n+           \"description\": \"Error: react-dom/server is not supported in React Server Components.\",\n+           \"source\": \"internal-pkg/server.node.js (1:1) @ [project]/internal-pkg/server.node.js [app-rsc] (ecmascript)\n+\n+         > 1 | import * as ReactDOMServerEdge from 'react-dom/server.node'\n+             | ^\n+           2 | // Fine to drop once React is on ESM\n+           3 | import ReactDOMServerEdgeDefault from 'react-dom/server.node'\n+           4 |\",\n+         }\n         `)\n       }\n     } else {"
        },
        {
            "sha": "bc2b04ec6c1fc09c9c855fdc452aaf82b6449f72",
            "filename": "test/development/basic/gssp-ssr-change-reloading/test/index.test.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -11,9 +11,25 @@ import {\n } from 'next-test-utils'\n import { NextInstance } from 'e2e-utils'\n \n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n const installCheckVisible = (browser) => {\n-  return browser.eval(`(function() {\n-    window.checkInterval = setInterval(function() {\n+  if (isNewDevOverlay) {\n+    return browser.eval(`(function() {\n+      window.checkInterval = setInterval(function() {\n+      const root = document.querySelector('nextjs-portal').shadowRoot;\n+      const indicator = root.querySelector('[data-next-mark]')\n+      window.showedBuilder = window.showedBuilder || (\n+        indicator.getAttribute('data-next-mark-loading') === 'true'\n+      )\n+      if (window.showedBuilder) clearInterval(window.checkInterval)\n+    }, 50)\n+  })()`)\n+  } else {\n+    return browser.eval(`(function() {\n+      window.checkInterval = setInterval(function() {\n       let watcherDiv = document.querySelector('#__next-build-indicator')\n       watcherDiv = watcherDiv.shadowRoot || watcherDiv\n       window.showedBuilder = window.showedBuilder || (\n@@ -22,6 +38,7 @@ const installCheckVisible = (browser) => {\n       if (window.showedBuilder) clearInterval(window.checkInterval)\n     }, 50)\n   })()`)\n+  }\n }\n \n describe('GS(S)P Server-Side Change Reloading', () => {"
        },
        {
            "sha": "0a3e5cf36dce018e51f2337e1e813dd210841449",
            "filename": "test/development/basic/hmr/error-recovery.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 21,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fhmr%2Ferror-recovery.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -195,16 +195,16 @@ describe.each([\n         `)\n       } else if (basePath === '' && process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n-            \"./pages/hmr/about2.js:7:1\n-            Parsing ecmascript source code failed\n-              5 |     div\n-              6 |   )\n-            > 7 | }\n-                | ^\n-              8 |\n+         \"./pages/hmr/about2.js (7:1)\n+         Parsing ecmascript source code failed\n+           5 |     div\n+           6 |   )\n+         > 7 | }\n+             | ^\n+           8 |\n \n-            Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n-          `)\n+         Unexpected token. Did you mean \\`{'}'}\\` or \\`&rbrace;\\`?\"\n+        `)\n       } else if (basePath === '/docs' && !process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n           \"./pages/hmr/about2.js\n@@ -231,7 +231,7 @@ describe.each([\n         `)\n       } else if (basePath === '/docs' && process.env.TURBOPACK) {\n         expect(source).toMatchInlineSnapshot(`\n-            \"./pages/hmr/about2.js:7:1\n+            \"./pages/hmr/about2.js (7:1)\n             Parsing ecmascript source code failed\n               5 |     div\n               6 |   )\n@@ -594,17 +594,17 @@ describe.each([\n         if (process.env.TURBOPACK) {\n           expect(next.normalizeTestDirContent(redboxSource))\n             .toMatchInlineSnapshot(`\n-              \"./components/parse-error.js:3:1\n-              Parsing ecmascript source code failed\n-                1 | This\n-                2 | is\n-              > 3 | }}}\n-                  | ^\n-                4 | invalid\n-                5 | js\n-\n-              Expression expected\"\n-            `)\n+           \"./components/parse-error.js (3:1)\n+           Parsing ecmascript source code failed\n+             1 | This\n+             2 | is\n+           > 3 | }}}\n+               | ^\n+             4 | invalid\n+             5 | js\n+\n+           Expression expected\"\n+          `)\n         } else {\n           redboxSource = redboxSource.substring(\n             0,"
        },
        {
            "sha": "c45e9d8746efd475fa1771cc7170301d8d74a6bd",
            "filename": "test/development/client-dev-overlay/index.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -29,12 +29,16 @@ describe('client-dev-overlay', () => {\n   const selectors = {\n     fullScreenDialog: '[data-nextjs-dialog]',\n     toast: '[data-nextjs-toast]',\n-    minimizeButton: '[data-nextjs-errors-dialog-left-right-close-button]',\n-    hideButton: '[data-nextjs-toast-errors-hide-button]',\n+    popover: '[data-nextjs-dev-tools-button]',\n+    minimizeButton: 'body',\n+    hideButton: '[data-hide-dev-tools]',\n   }\n   function getToast() {\n     return browser.elementByCss(selectors.toast)\n   }\n+  function getPopover() {\n+    return browser.elementByCss(selectors.popover)\n+  }\n   function getMinimizeButton() {\n     return browser.elementByCss(selectors.minimizeButton)\n   }\n@@ -64,10 +68,11 @@ describe('client-dev-overlay', () => {\n \n   it('should be able to hide the minimized overlay', async () => {\n     await getMinimizeButton().click()\n+    await getPopover().click()\n     await getHideButton().click()\n \n     await check(async () => {\n-      const exists = await elementExistsInNextJSPortalShadowDOM('div')\n+      const exists = await elementExistsInNextJSPortalShadowDOM(selectors.toast)\n       return exists ? 'found' : 'success'\n     }, 'success')\n   })"
        },
        {
            "sha": "cf972756958f926fac16d0f811f13e309f07c94c",
            "filename": "test/development/pages-dir/client-navigation/fixture/pages/nav/shallow-routing.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ffixture%2Fpages%2Fnav%2Fshallow-routing.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ffixture%2Fpages%2Fnav%2Fshallow-routing.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ffixture%2Fpages%2Fnav%2Fshallow-routing.js?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -41,7 +41,7 @@ export default withRouter(\n \n     render() {\n       return (\n-        <div className=\"shallow-routing\">\n+        <div className=\"shallow-routing\" style={{ paddingBottom: 60 }}>\n           <Link href=\"/nav\" id=\"home-link\" style={linkStyle}>\n             Home\n           </Link>"
        },
        {
            "sha": "1bb88777c74c928702202425e6ccc7acc570bad6",
            "filename": "test/development/sass-error/index.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fsass-error%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fdevelopment%2Fsass-error%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fsass-error%2Findex.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -26,17 +26,17 @@ describe('app dir - css', () => {\n \n           // css-loader does not report an error for this case\n           expect(source).toMatchInlineSnapshot(`\n-            \"./app/global.scss.css:45:1\n-            Parsing css source code failed\n-              43 | }\n-              44 |\n-            > 45 | input.defaultCheckbox::before path {\n-                 | ^\n-              46 |   fill: currentColor;\n-              47 | }\n-              48 |\n+           \"./app/global.scss.css (45:1)\n+           Parsing css source code failed\n+             43 | }\n+             44 |\n+           > 45 | input.defaultCheckbox::before path {\n+                | ^\n+             46 |   fill: currentColor;\n+             47 | }\n+             48 |\n \n-            Pseudo-elements like '::before' or '::after' can't be followed by selectors like 'Ident(\"path\")' at [project]/app/global.scss.css:0:884\"\n+           Pseudo-elements like '::before' or '::after' can't be followed by selectors like 'Ident(\"path\")' at [project]/app/global.scss.css:0:884\"\n           `)\n         })\n       }"
        },
        {
            "sha": "2ce57c6a68b567d86013a9ffdaa887c60e9630f0",
            "filename": "test/e2e/app-dir/dynamic-io/dynamic-io.server-action.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.server-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.server-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.server-action.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -25,8 +25,12 @@ describe('dynamic-io', () => {\n       expect(await browser.elementByCss('p').text()).toBe('result')\n     })\n \n-    if (process.env.__NEXT_EXPERIMENTAL_PPR && isNextDev) {\n-      // TODO(react-time-info): Remove this branch for PPR in dev mode when the\n+    if (\n+      (process.env.__NEXT_EXPERIMENTAL_PPR ||\n+        process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY) &&\n+      isNextDev\n+    ) {\n+      // TODO(react-time-info): Remove this branch for experimental React in dev mode when the\n       // issue is resolved where the inclusion of server timings in the RSC\n       // payload makes the serialized bound args not suitable to be used as a\n       // cache key."
        },
        {
            "sha": "b1a97d5d8570d79ba967260247309a09736cf771",
            "filename": "test/e2e/app-dir/dynamic-io/dynamic-io.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -19,14 +19,15 @@ describe('dynamic-io', () => {\n \n   if (isNextDev && !WITH_PPR) {\n     async function hasStaticIndicator(browser: BrowserInterface) {\n-      const staticIndicatorPresent = await browser.eval(() =>\n-        Boolean(\n+      await browser.elementByCss('[data-nextjs-dev-tools-button]').click()\n+\n+      return await browser.eval(\n+        () =>\n           document\n             .querySelector('nextjs-portal')\n-            .shadowRoot.querySelector('.nextjs-static-indicator-toast-wrapper')\n-        )\n+            .shadowRoot.querySelector('[data-nextjs-route-type]')\n+            .getAttribute('data-nextjs-route-type') === 'static'\n       )\n-      return staticIndicatorPresent\n     }\n \n     it('should not have static indicator on dynamic method route', async () => {"
        },
        {
            "sha": "10ef8ad0b345b6eefdef614a0de96e8dd9f0a3d3",
            "filename": "test/e2e/app-dir/error-on-next-codemod-comment/error-on-next-codemod-comment.test.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 26,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Ferror-on-next-codemod-comment%2Ferror-on-next-codemod-comment.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Ferror-on-next-codemod-comment%2Ferror-on-next-codemod-comment.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ferror-on-next-codemod-comment%2Ferror-on-next-codemod-comment.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -26,23 +26,22 @@ describe('app-dir - error-on-next-codemod-comment', () => {\n \n       await assertHasRedbox(browser)\n \n-      // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+      // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n       if (isNewDevOverlay) {\n         if (process.env.TURBOPACK) {\n           expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n-                     \"./app/page.tsx (2:2)\n-\n-                     Ecmascript file had an error\n-                       1 | export default function Page() {\n-                     > 2 |   // @next-codemod-error remove jsx of next line\n-                         |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-                       3 |   return <p>hello world</p>\n-                       4 | }\n-                       5 |\n-\n-                     You have an unresolved @next/codemod comment \"remove jsx of next line\" that needs review.\n-                     After review, either remove the comment if you made the necessary changes or replace \"@next-codemod-error\" with \"@next-codemod-ignore\" to bypass the build error if no action at this line can be taken.\"\n-                  `)\n+           \"./app/page.tsx (2:2)\n+           Ecmascript file had an error\n+             1 | export default function Page() {\n+           > 2 |   // @next-codemod-error remove jsx of next line\n+               |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+             3 |   return <p>hello world</p>\n+             4 | }\n+             5 |\n+\n+           You have an unresolved @next/codemod comment \"remove jsx of next line\" that needs review.\n+           After review, either remove the comment if you made the necessary changes or replace \"@next-codemod-error\" with \"@next-codemod-ignore\" to bypass the build error if no action at this line can be taken.\"\n+          `)\n         } else {\n           expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n            \"./app/page.tsx\n@@ -62,18 +61,18 @@ describe('app-dir - error-on-next-codemod-comment', () => {\n       } else {\n         if (process.env.TURBOPACK) {\n           expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n-                     \"./app/page.tsx:2:2\n-                     Ecmascript file had an error\n-                       1 | export default function Page() {\n-                     > 2 |   // @next-codemod-error remove jsx of next line\n-                         |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-                       3 |   return <p>hello world</p>\n-                       4 | }\n-                       5 |\n-\n-                     You have an unresolved @next/codemod comment \"remove jsx of next line\" that needs review.\n-                     After review, either remove the comment if you made the necessary changes or replace \"@next-codemod-error\" with \"@next-codemod-ignore\" to bypass the build error if no action at this line can be taken.\"\n-                  `)\n+           \"./app/page.tsx (2:2)\n+           Ecmascript file had an error\n+             1 | export default function Page() {\n+           > 2 |   // @next-codemod-error remove jsx of next line\n+               |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+             3 |   return <p>hello world</p>\n+             4 | }\n+             5 |\n+\n+           You have an unresolved @next/codemod comment \"remove jsx of next line\" that needs review.\n+           After review, either remove the comment if you made the necessary changes or replace \"@next-codemod-error\" with \"@next-codemod-ignore\" to bypass the build error if no action at this line can be taken.\"\n+          `)\n         } else {\n           expect(await getRedboxSource(browser)).toMatchInlineSnapshot(`\n                      \"./app/page.tsx"
        },
        {
            "sha": "cce0e5a110d0af85a0fa04236d39034593931baa",
            "filename": "test/e2e/app-dir/next-after-app/index.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 12,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fnext-after-app%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fnext-after-app%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-after-app%2Findex.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -1,4 +1,3 @@\n-/* eslint-env jest */\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n import { createProxyServer } from 'next/experimental/testmode/proxy'\n@@ -8,8 +7,12 @@ import * as Log from './utils/log'\n \n const runtimes = ['nodejs', 'edge']\n \n+const isReactExperimental =\n+  process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n describe.each(runtimes)('after() in %s runtime', (runtimeValue) => {\n-  const { next, isNextDeploy, skipped } = nextTestSetup({\n+  const { next, isNextDeploy, skipped, isTurbopack } = nextTestSetup({\n     files: __dirname,\n     // `patchFile` and reading runtime logs are not supported in a deployed environment\n     skipDeployment: true,\n@@ -98,18 +101,24 @@ describe.each(runtimes)('after() in %s runtime', (runtimeValue) => {\n   })\n \n   describe('interrupted RSC renders', () => {\n-    it('runs callbacks if redirect() was called', async () => {\n-      await next.browser(pathPrefix + '/interrupted/calls-redirect')\n+    // This is currently broken with experimental React & Turbopack\n+    // https://github.com/vercel/next.js/pull/75989\n \n-      await retry(() => {\n-        expect(getLogs()).toContainEqual({\n-          source: '[page] /interrupted/calls-redirect',\n-        })\n-        expect(getLogs()).toContainEqual({\n-          source: '[page] /interrupted/redirect-target',\n+    ;(isTurbopack && isReactExperimental ? it.skip : it)(\n+      'runs callbacks if redirect() was called',\n+      async () => {\n+        await next.browser(pathPrefix + '/interrupted/calls-redirect')\n+\n+        await retry(() => {\n+          expect(getLogs()).toContainEqual({\n+            source: '[page] /interrupted/calls-redirect',\n+          })\n+          expect(getLogs()).toContainEqual({\n+            source: '[page] /interrupted/redirect-target',\n+          })\n         })\n-      })\n-    })\n+      }\n+    )\n \n     it('runs callbacks if notFound() was called', async () => {\n       await next.browser(pathPrefix + '/interrupted/calls-not-found')"
        },
        {
            "sha": "ddbf254d3952c68c567390c0a72c30ff535d2fce",
            "filename": "test/e2e/app-dir/rsc-basic/rsc-basic.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -425,8 +425,10 @@ describe('app dir - rsc basics', () => {\n   })\n \n   // TODO: (PPR) remove once PPR is stable\n+  // TODO(new-dev-overlay): remove once new dev overlay is stable\n   const bundledReactVersionPattern =\n-    process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+    process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n       ? '-experimental-'\n       : '-canary-'\n "
        },
        {
            "sha": "71fdaaa600dd290941a2ef7590471b81c9a037d5",
            "filename": "test/e2e/app-dir/use-cache-hanging-inputs/use-cache-hanging-inputs.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -10,6 +10,13 @@ import {\n } from 'next-test-utils'\n import stripAnsi from 'strip-ansi'\n \n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n+const needsExperimentalReact =\n+  process.env.__NEXT_EXPERIMENTAL_PPR || isNewDevOverlay\n+\n const expectedErrorMessage =\n   'Error: Filling a cache during prerender timed out, likely because request-specific arguments such as params, searchParams, cookies() or dynamic data were used inside \"use cache\".'\n \n@@ -192,8 +199,8 @@ describe('use-cache-hanging-inputs', () => {\n \n         const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n \n-        if (process.env.__NEXT_EXPERIMENTAL_PPR) {\n-          // TODO(react-time-info): Remove this branch for PPR when the issue is\n+        if (needsExperimentalReact) {\n+          // TODO(react-time-info): Remove this branch for experimental React when the issue is\n           // resolved where the inclusion of server timings in the RSC payload\n           // makes the serialized bound args not suitable to be used as a cache\n           // key."
        },
        {
            "sha": "40f4a5ef321abc949b3464cf2fd55f4340c700f3",
            "filename": "test/e2e/app-dir/use-cache-segment-configs/use-cache-segment-configs.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -31,7 +31,7 @@ describe('use-cache-segment-configs', () => {\n         expect(description).toBe('Failed to compile')\n \n         expect(source).toMatchInlineSnapshot(`\n-         \"./app/runtime/page.tsx:1:14\n+         \"./app/runtime/page.tsx (1:14)\n          Ecmascript file had an error\n          > 1 | export const runtime = 'edge'\n              |              ^^^^^^^"
        },
        {
            "sha": "533ef7dc9b567d5c2ccbbc2840d0ac14a5102365",
            "filename": "test/e2e/app-dir/use-cache-unknown-cache-kind/use-cache-unknown-cache-kind.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 11,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -90,12 +90,11 @@ describe('use-cache-unknown-cache-kind', () => {\n \n       expect(errorDescription).toBe('Failed to compile')\n \n-      // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+      // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n       if (isNewDevOverlay) {\n         if (isTurbopack) {\n           expect(errorSource).toMatchInlineSnapshot(`\n            \"./app/page.tsx (1:1)\n-\n            Ecmascript file had an error\n            > 1 | 'use cache: custom'\n                | ^^^^^^^^^^^^^^^^^^^\n@@ -122,15 +121,15 @@ describe('use-cache-unknown-cache-kind', () => {\n       } else {\n         if (isTurbopack) {\n           expect(errorSource).toMatchInlineSnapshot(`\n-            \"./app/page.tsx:1:1\n-            Ecmascript file had an error\n-            > 1 | 'use cache: custom'\n-                | ^^^^^^^^^^^^^^^^^^^\n-              2 |\n-              3 | export default async function Page() {\n-              4 |   return <p>hello world</p>\n-\n-            Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"\n+           \"./app/page.tsx (1:1)\n+           Ecmascript file had an error\n+           > 1 | 'use cache: custom'\n+               | ^^^^^^^^^^^^^^^^^^^\n+             2 |\n+             3 | export default async function Page() {\n+             4 |   return <p>hello world</p>\n+\n+           Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"\n           `)\n         } else {\n           expect(errorSource).toMatchInlineSnapshot(`"
        },
        {
            "sha": "a99c1c65f1e68a567ae8279a395ff0e0c40a984e",
            "filename": "test/e2e/app-dir/use-cache-without-experimental-flag/use-cache-without-experimental-flag.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-without-experimental-flag%2Fuse-cache-without-experimental-flag.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fe2e%2Fapp-dir%2Fuse-cache-without-experimental-flag%2Fuse-cache-without-experimental-flag.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-without-experimental-flag%2Fuse-cache-without-experimental-flag.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -89,12 +89,11 @@ describe('use-cache-without-experimental-flag', () => {\n \n       expect(errorDescription).toBe('Failed to compile')\n \n-      // TODO(jiwon): Remove this once we have a new dev overlay at stable.\n+      // TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n       if (isNewDevOverlay) {\n         if (isTurbopack) {\n           expect(errorSource).toMatchInlineSnapshot(`\n            \"./app/page.tsx (1:1)\n-\n            Ecmascript file had an error\n            > 1 | 'use cache'\n                | ^^^^^^^^^^^\n@@ -125,7 +124,7 @@ describe('use-cache-without-experimental-flag', () => {\n       } else {\n         if (isTurbopack) {\n           expect(errorSource).toMatchInlineSnapshot(`\n-           \"./app/page.tsx:1:1\n+           \"./app/page.tsx (1:1)\n            Ecmascript file had an error\n            > 1 | 'use cache'\n                | ^^^^^^^^^^^"
        },
        {
            "sha": "b61d76fb4ee42eaab80978cf1216477e805f71f7",
            "filename": "test/integration/build-indicator/test/index.test.js",
            "status": "modified",
            "additions": 33,
            "deletions": 11,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fintegration%2Fbuild-indicator%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fintegration%2Fbuild-indicator%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fbuild-indicator%2Ftest%2Findex.test.js?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -11,9 +11,25 @@ const nextConfig = join(appDir, 'next.config.js')\n let appPort\n let app\n \n+// TODO(new-dev-overlay): Remove this once old dev overlay fork is removed\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n const installCheckVisible = (browser) => {\n-  return browser.eval(`(function() {\n-    window.checkInterval = setInterval(function() {\n+  if (isNewDevOverlay) {\n+    return browser.eval(`(function() {\n+      window.checkInterval = setInterval(function() {\n+      const root = document.querySelector('nextjs-portal').shadowRoot;\n+      const indicator = root.querySelector('[data-next-mark]')\n+      window.showedBuilder = window.showedBuilder || (\n+        indicator.getAttribute('data-next-mark-loading') === 'true'\n+      )\n+      if (window.showedBuilder) clearInterval(window.checkInterval)\n+    }, 5)\n+  })()`)\n+  } else {\n+    return browser.eval(`(function() {\n+      window.checkInterval = setInterval(function() {\n       let watcherDiv = document.querySelector('#__next-build-indicator')\n       watcherDiv = watcherDiv.shadowRoot || watcherDiv\n       window.showedBuilder = window.showedBuilder || (\n@@ -22,6 +38,7 @@ const installCheckVisible = (browser) => {\n       if (window.showedBuilder) clearInterval(window.checkInterval)\n     }, 5)\n   })()`)\n+  }\n }\n \n describe('Build Activity Indicator', () => {\n@@ -67,15 +84,20 @@ describe('Build Activity Indicator', () => {\n     })\n     afterAll(() => killApp(app))\n \n-    it('Adds the build indicator container', async () => {\n-      const browser = await webdriver(\n-        appPort,\n-        pagesOrApp === 'pages' ? '/' : '/app'\n-      )\n-      const html = await browser.eval('document.body.innerHTML')\n-      expect(html).toMatch(/__next-build-indicator/)\n-      await browser.close()\n-    })\n+    // The indicator has no special container in the new dev overlay -\n+    // it's rendered as part of the indicator logo\n+    if (!isNewDevOverlay) {\n+      it('Adds the build indicator container', async () => {\n+        const browser = await webdriver(\n+          appPort,\n+          pagesOrApp === 'pages' ? '/' : '/app'\n+        )\n+        const html = await browser.eval('document.body.innerHTML')\n+        expect(html).toMatch(/__next-build-indicator/)\n+        await browser.close()\n+      })\n+    }\n+\n     ;(process.env.TURBOPACK ? describe.skip : describe)('webpack only', () => {\n       it('Shows the build indicator when a page is built during navigation', async () => {\n         const browser = await webdriver("
        },
        {
            "sha": "94aa7ce4588d6734a4b6f6949d2de01cb9d9e6fa",
            "filename": "test/production/custom-server/custom-server.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fproduction%2Fcustom-server%2Fcustom-server.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1c85b755b56ac619ded669a65b7343f154492eba/test%2Fproduction%2Fcustom-server%2Fcustom-server.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fcustom-server%2Fcustom-server.test.ts?ref=1c85b755b56ac619ded669a65b7343f154492eba",
            "patch": "@@ -1,6 +1,9 @@\n import { nextTestSetup } from 'e2e-utils'\n \n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+// TODO(new-dev-overlay): Remove this once new dev overlay is stable\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n describe('custom server', () => {\n   const { next } = nextTestSetup({\n@@ -23,10 +26,12 @@ describe('custom server', () => {\n   })\n \n   describe('with app dir', () => {\n-    it('should render app with react canary', async () => {\n-      const $ = await next.render$(`/1`)\n-      expect($('body').text()).toMatch(/app: .+-canary/)\n-    })\n+    if (!isNewDevOverlay) {\n+      it('should render app with react canary', async () => {\n+        const $ = await next.render$(`/1`)\n+        expect($('body').text()).toMatch(/app: .+-canary/)\n+      })\n+    }\n \n     it('should render pages with installed react', async () => {\n       const $ = await next.render$(`/2`)"
        }
    ],
    "stats": {
        "total": 1357,
        "additions": 747,
        "deletions": 610
    }
}