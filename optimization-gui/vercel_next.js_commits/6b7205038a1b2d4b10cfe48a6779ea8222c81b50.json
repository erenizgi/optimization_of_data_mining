{
    "author": "devjiwonchoi",
    "message": "[Breaking] Skip Next.js internal routes `/_next` in middleware (#84239)\n\n### Why?\n\nWhen the user hasn't set a matcher in the middleware, it always hits the\ninternal route `/_next/`. This is redundant, though quite common, as it\nserves all the static assets. Therefore, skip the internal route by\ndefault when no matcher is set.\n\n---------\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>\nCo-authored-by: vercel[bot] <35613825+vercel[bot]@users.noreply.github.com>",
    "sha": "6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
    "files": [
        {
            "sha": "ace2d5c0b9adc6147509595dde51b6e3531f76e8",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 5,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -42,6 +42,31 @@ use crate::{\n     route::{Endpoint, EndpointOutput, EndpointOutputPaths},\n };\n \n+/// Rust implementation of the TypeScript getDefaultMiddlewareMatcher function\n+/// Generates default middleware matcher patterns that respect skipMiddlewareNextInternalRoutes\n+fn get_default_middleware_matcher(\n+    skip_middleware_next_internal_routes: Option<bool>,\n+) -> MiddlewareMatcher {\n+    let skip_internal = skip_middleware_next_internal_routes.unwrap_or(true);\n+\n+    if skip_internal {\n+        // Skip \"/_next/\" internal routes, except for \"/_next/data/\" which is needed for\n+        // client-side navigation. Do not consider basePath as the user cannot create a\n+        // route starts with underscore.\n+        MiddlewareMatcher {\n+            regexp: Some(rcstr!(\"^(?!.*\\\\/\\\\_next\\\\/(?!data\\\\/)).*\")),\n+            original_source: rcstr!(\"/((?!_next/(?!data/))[^]*)*\"),\n+            ..Default::default()\n+        }\n+    } else {\n+        MiddlewareMatcher {\n+            regexp: Some(rcstr!(\"^/.*$\")),\n+            original_source: rcstr!(\"/:path*\"),\n+            ..Default::default()\n+        }\n+    }\n+}\n+\n #[turbo_tasks::value]\n pub struct MiddlewareEndpoint {\n     project: ResolvedVc<Project>,\n@@ -165,6 +190,8 @@ impl MiddlewareEndpoint {\n             .map(|i18n| i18n.locales.len() > 1)\n             .unwrap_or(false);\n         let base_path = next_config.base_path().await?;\n+        let skip_middleware_next_internal_routes =\n+            next_config.skip_middleware_next_internal_routes().await?;\n \n         let matchers = if let Some(matchers) = config.middleware_matcher.as_ref() {\n             matchers\n@@ -216,11 +243,9 @@ impl MiddlewareEndpoint {\n                 })\n                 .collect()\n         } else {\n-            vec![MiddlewareMatcher {\n-                regexp: Some(rcstr!(\"^/.*$\")),\n-                original_source: rcstr!(\"/:path*\"),\n-                ..Default::default()\n-            }]\n+            vec![get_default_middleware_matcher(\n+                *skip_middleware_next_internal_routes,\n+            )]\n         };\n \n         if matches!(runtime, NextRuntime::NodeJs) {"
        },
        {
            "sha": "4d0b20600c8c6ff5bccb40df11c1aae09e4fd6d0",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -103,6 +103,7 @@ pub struct NextConfig {\n     asset_prefix: Option<RcStr>,\n     base_path: Option<RcStr>,\n     skip_middleware_url_normalize: Option<bool>,\n+    skip_middleware_next_internal_routes: Option<bool>,\n     skip_trailing_slash_redirect: Option<bool>,\n     i18n: Option<I18NConfig>,\n     cross_origin: Option<CrossOriginConfig>,\n@@ -1343,6 +1344,11 @@ impl NextConfig {\n         Vc::cell(self.base_path.clone())\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn skip_middleware_next_internal_routes(&self) -> Vc<Option<bool>> {\n+        Vc::cell(self.skip_middleware_next_internal_routes)\n+    }\n+\n     #[turbo_tasks::function]\n     pub fn cache_handler(&self, project_path: FileSystemPath) -> Result<Vc<OptionFileSystemPath>> {\n         if let Some(handler) = &self.cache_handler {"
        },
        {
            "sha": "2927325f0d88c8d005c9e2c8b6cf7f312d217d05",
            "filename": "packages/next/src/build/entries.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -45,6 +45,7 @@ import {\n   isInstrumentationHookFilename,\n } from './utils'\n import { getPageStaticInfo } from './analysis/get-page-static-info'\n+import { getDefaultMiddlewareMatcher } from '../shared/lib/router/utils/get-default-middleware-matcher'\n import { normalizePathSep } from '../shared/lib/page-path/normalize-path-sep'\n import { normalizePagePath } from '../shared/lib/page-path/normalize-page-path'\n import type { ServerRuntime } from '../types'\n@@ -898,7 +899,7 @@ export async function createEntrypoints(\n \n       if (isMiddlewareFile(page)) {\n         middlewareMatchers = staticInfo.middleware?.matchers ?? [\n-          { regexp: '.*', originalSource: '/:path*' },\n+          getDefaultMiddlewareMatcher(params.config),\n         ]\n       }\n "
        },
        {
            "sha": "fbf0fa8eca615577333740851cab1f4565f11a84",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -150,6 +150,7 @@ import { isEdgeRuntime } from '../lib/is-edge-runtime'\n import { recursiveCopy } from '../lib/recursive-copy'\n import { lockfilePatchPromise, teardownTraceSubscriber } from './swc'\n import { getNamedRouteRegex } from '../shared/lib/router/utils/route-regex'\n+import { getDefaultMiddlewareMatcher } from '../shared/lib/router/utils/get-default-middleware-matcher'\n import { getFilesInDir } from '../lib/get-files-in-dir'\n import { eventSwcPlugins } from '../telemetry/events/swc-plugins'\n import { normalizeAppPath } from '../shared/lib/router/utils/app-paths'\n@@ -2583,10 +2584,7 @@ export default async function build(\n           functionsConfigManifest.functions['/_middleware'] = {\n             runtime: staticInfo.runtime,\n             matchers: staticInfo.middleware?.matchers ?? [\n-              {\n-                regexp: '^.*$',\n-                originalSource: '/:path*',\n-              },\n+              getDefaultMiddlewareMatcher(config),\n             ],\n           }\n "
        },
        {
            "sha": "09e65bdc933bd8195ac8d247bfef8d915bbac7aa",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -2081,6 +2081,7 @@ export default async function getBaseWebpackConfig(\n           dev,\n           sriEnabled: !dev && !!config.experimental.sri?.algorithm,\n           rewrites,\n+          nextConfig: config,\n           edgeEnvironments: {\n             __NEXT_BUILD_ID: buildId,\n             NEXT_SERVER_ACTIONS_ENCRYPTION_KEY: encryptionKey,"
        },
        {
            "sha": "1d78740f0e0b9cea19259533e575f790e3f296a4",
            "filename": "packages/next/src/build/webpack/plugins/middleware-plugin.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 17,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fmiddleware-plugin.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -5,6 +5,7 @@ import type {\n import type { EdgeSSRMeta } from '../loaders/get-module-build-info'\n import type { MiddlewareMatcher } from '../../analysis/get-page-static-info'\n import { getNamedMiddlewareRegex } from '../../../shared/lib/router/utils/route-regex'\n+import { getDefaultMiddlewareMatcher } from '../../../shared/lib/router/utils/get-default-middleware-matcher'\n import { getModuleBuildInfo } from '../loaders/get-module-build-info'\n import { getSortedRoutes } from '../../../shared/lib/router/utils'\n import { webpack, sources } from 'next/dist/compiled/webpack/webpack'\n@@ -36,6 +37,7 @@ import type { CustomRoutes } from '../../../lib/load-custom-routes'\n import { isInterceptionRouteRewrite } from '../../../lib/generate-interception-routes-rewrites'\n import { getDynamicCodeEvaluationError } from './wellknown-errors-plugin/parse-dynamic-code-evaluation-error'\n import { getModuleReferencesInOrder } from '../utils'\n+import type { NextConfigComplete } from '../../../server/config-shared'\n \n const KNOWN_SAFE_DYNAMIC_PACKAGES =\n   require('../../../lib/known-edge-safe-packages.json') as string[]\n@@ -195,21 +197,29 @@ function getCreateAssets(params: {\n         continue\n       }\n \n-      const matcherSource = metadata.edgeSSR?.isAppDir\n-        ? normalizeAppPath(page)\n-        : page\n-\n-      const catchAll = !metadata.edgeSSR && !metadata.edgeApiFunction\n-\n-      const { namedRegex } = getNamedMiddlewareRegex(matcherSource, {\n-        catchAll,\n-      })\n-      const matchers = metadata?.edgeMiddleware?.matchers ?? [\n-        {\n-          regexp: namedRegex,\n-          originalSource: page === '/' && catchAll ? '/:path*' : matcherSource,\n-        },\n-      ]\n+      let matchers: MiddlewareMatcher[]\n+      if (metadata?.edgeMiddleware?.matchers) {\n+        matchers = metadata.edgeMiddleware.matchers\n+      } else {\n+        // For middleware at root with no explicit matchers, use getDefaultMiddlewareMatcher\n+        // which respects skipMiddlewareNextInternalRoutes config\n+        const catchAll = !metadata.edgeSSR && !metadata.edgeApiFunction\n+        if (page === '/' && catchAll) {\n+          matchers = [getDefaultMiddlewareMatcher(opts.nextConfig)]\n+        } else {\n+          const matcherSource = metadata.edgeSSR?.isAppDir\n+            ? normalizeAppPath(page)\n+            : page\n+          matchers = [\n+            {\n+              regexp: getNamedMiddlewareRegex(matcherSource, {\n+                catchAll,\n+              }).namedRegex,\n+              originalSource: matcherSource,\n+            },\n+          ]\n+        }\n+      }\n \n       const isEdgeFunction = !!(metadata.edgeApiFunction || metadata.edgeSSR)\n       const edgeFunctionDefinition: EdgeFunctionDefinition = {\n@@ -818,19 +828,28 @@ interface Options {\n   sriEnabled: boolean\n   rewrites: CustomRoutes['rewrites']\n   edgeEnvironments: EdgeRuntimeEnvironments\n+  nextConfig: NextConfigComplete\n }\n \n export default class MiddlewarePlugin {\n   private readonly dev: Options['dev']\n   private readonly sriEnabled: Options['sriEnabled']\n   private readonly rewrites: Options['rewrites']\n   private readonly edgeEnvironments: EdgeRuntimeEnvironments\n-\n-  constructor({ dev, sriEnabled, rewrites, edgeEnvironments }: Options) {\n+  private readonly nextConfig: Options['nextConfig']\n+\n+  constructor({\n+    dev,\n+    sriEnabled,\n+    rewrites,\n+    edgeEnvironments,\n+    nextConfig,\n+  }: Options) {\n     this.dev = dev\n     this.sriEnabled = sriEnabled\n     this.rewrites = rewrites\n     this.edgeEnvironments = edgeEnvironments\n+    this.nextConfig = nextConfig\n   }\n \n   public apply(compiler: webpack.Compiler) {\n@@ -886,6 +905,7 @@ export default class MiddlewarePlugin {\n             rewrites: this.rewrites,\n             edgeEnvironments: this.edgeEnvironments,\n             dev: this.dev,\n+            nextConfig: this.nextConfig,\n           },\n         })\n       )"
        },
        {
            "sha": "72ba4a73a6d4700450f24ae8fdb033bc5e56de55",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -675,6 +675,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n       .optional(),\n     serverExternalPackages: z.array(z.string()).optional(),\n     skipMiddlewareUrlNormalize: z.boolean().optional(),\n+    skipMiddlewareNextInternalRoutes: z.boolean().optional(),\n     skipTrailingSlashRedirect: z.boolean().optional(),\n     staticPageGenerationTimeout: z.number().optional(),\n     expireTime: z.number().optional(),"
        },
        {
            "sha": "f86582b762f60948cbffaa95a22a92eac4eef3bf",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -1235,6 +1235,12 @@ export interface NextConfig {\n \n   skipMiddlewareUrlNormalize?: boolean\n \n+  /**\n+   * Skip Next.js internals route `/_next` from middleware.\n+   * @default true\n+   */\n+  skipMiddlewareNextInternalRoutes?: boolean\n+\n   skipTrailingSlashRedirect?: boolean\n \n   modularizeImports?: Record<\n@@ -1511,6 +1517,7 @@ export const defaultConfig = Object.freeze({\n   },\n   htmlLimitedBots: undefined,\n   bundlePagesRouterDependencies: false,\n+  skipMiddlewareNextInternalRoutes: true,\n } satisfies NextConfig)\n \n export async function normalizeConfig(phase: string, config: any) {"
        },
        {
            "sha": "be19679c7878f7b514d22b6312c24ea10be0053a",
            "filename": "packages/next/src/server/lib/router-utils/filesystem.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -31,6 +31,7 @@ import { pathHasPrefix } from '../../../shared/lib/router/utils/path-has-prefix'\n import { normalizeLocalePath } from '../../../shared/lib/i18n/normalize-locale-path'\n import { removePathPrefix } from '../../../shared/lib/router/utils/remove-path-prefix'\n import { getMiddlewareRouteMatcher } from '../../../shared/lib/router/utils/middleware-route-matcher'\n+import { getDefaultMiddlewareMatcher } from '../../../shared/lib/router/utils/get-default-middleware-matcher'\n import {\n   APP_PATH_ROUTES_MANIFEST,\n   BUILD_ID_FILE,\n@@ -314,7 +315,7 @@ export async function setupFsCheck(opts: {\n     } else if (functionsConfigManifest?.functions['/_middleware']) {\n       middlewareMatcher = getMiddlewareRouteMatcher(\n         functionsConfigManifest.functions['/_middleware'].matchers ?? [\n-          { regexp: '.*', originalSource: '/:path*' },\n+          getDefaultMiddlewareMatcher(opts.config),\n         ]\n       )\n     }"
        },
        {
            "sha": "2d3959b669d7f14d34344708032e97c0d0f65c98",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -48,6 +48,7 @@ import {\n } from '../../../shared/lib/constants'\n \n import { getMiddlewareRouteMatcher } from '../../../shared/lib/router/utils/middleware-route-matcher'\n+import { getDefaultMiddlewareMatcher } from '../../../shared/lib/router/utils/get-default-middleware-matcher'\n \n import {\n   isMiddlewareFile,\n@@ -472,7 +473,7 @@ async function startWatcher(\n             serverFields.actualMiddlewareFile\n           )\n           middlewareMatchers = staticInfo.middleware?.matchers || [\n-            { regexp: '^/.*$', originalSource: '/:path*' },\n+            getDefaultMiddlewareMatcher(opts.nextConfig),\n           ]\n           continue\n         }"
        },
        {
            "sha": "cdc8731129d2c27827503a0185a8faa6e86c451f",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -71,6 +71,7 @@ import type { LoadComponentsReturnType } from './load-components'\n import isError, { getProperError } from '../lib/is-error'\n import { splitCookiesString, toNodeOutgoingHttpHeaders } from './web/utils'\n import { getMiddlewareRouteMatcher } from '../shared/lib/router/utils/middleware-route-matcher'\n+import { getDefaultMiddlewareMatcher } from '../shared/lib/router/utils/get-default-middleware-matcher'\n import { loadEnvConfig } from '@next/env'\n import { urlQueryToSearchParams } from '../shared/lib/router/utils/querystring'\n import { removeTrailingSlash } from '../shared/lib/router/utils/remove-trailing-slash'\n@@ -1455,13 +1456,13 @@ export default class NextNodeServer extends BaseServer<\n       const middlewareModule = await this.loadNodeMiddleware()\n \n       if (middlewareModule) {\n+        const matchers = middlewareModule.config?.matchers || [\n+          getDefaultMiddlewareMatcher(this.nextConfig),\n+        ]\n         return {\n-          match: getMiddlewareRouteMatcher(\n-            middlewareModule.config?.matchers || [\n-              { regexp: '.*', originalSource: '/:path*' },\n-            ]\n-          ),\n+          match: getMiddlewareRouteMatcher(matchers),\n           page: '/',\n+          matchers,\n         }\n       }\n \n@@ -1471,6 +1472,7 @@ export default class NextNodeServer extends BaseServer<\n     return {\n       match: getMiddlewareMatcher(middleware),\n       page: '/',\n+      matchers: middleware.matchers,\n     }\n   }\n "
        },
        {
            "sha": "3d5c8830b0e27fdce009912e4f22d2bbe56a5fd3",
            "filename": "packages/next/src/shared/lib/router/utils/get-default-middleware-matcher.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-default-middleware-matcher.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-default-middleware-matcher.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-default-middleware-matcher.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,21 @@\n+import type { NextConfig } from '../../../../types'\n+import type { MiddlewareMatcher } from '../../../../build/analysis/get-page-static-info'\n+\n+export function getDefaultMiddlewareMatcher({\n+  skipMiddlewareNextInternalRoutes,\n+}: NextConfig): MiddlewareMatcher {\n+  if (skipMiddlewareNextInternalRoutes !== false) {\n+    // Skip \"/_next/\" internal routes, except for \"/_next/data/\" which is needed for\n+    // client-side navigation. Do not consider basePath as the user cannot create a\n+    // route starts with underscore.\n+    return {\n+      regexp: '^(?!.*\\\\/\\\\_next\\\\/(?!data\\\\/)).*',\n+      originalSource: '/((?!_next/(?!data/))[^]*)*',\n+    }\n+  }\n+\n+  return {\n+    regexp: '^/.*$',\n+    originalSource: '/:path*',\n+  }\n+}"
        },
        {
            "sha": "3285390b43ca2c60513cd1758d7f9d11a8a7c86d",
            "filename": "test/e2e/middleware-general/test/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-general%2Ftest%2Findex.test.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -39,6 +39,8 @@ describe('Middleware Runtime', () => {\n           ),\n         },\n         nextConfig: {\n+          // This test needs to intercept internal routes /_next/ (skipped by default)\n+          skipMiddlewareNextInternalRoutes: false,\n           experimental: {\n             webpackBuildWorker: true,\n           },\n@@ -127,7 +129,7 @@ describe('Middleware Runtime', () => {\n             runtime: 'nodejs',\n             matchers: [\n               {\n-                regexp: '^.*$',\n+                regexp: '^/.*$',\n                 originalSource: '/:path*',\n               },\n             ],"
        },
        {
            "sha": "08eaa94fdc8896acfd343a0dbb61c713eec93a55",
            "filename": "test/e2e/middleware-skip-next-internal-routes-base-path/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Flayout.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-skip-next-internal-routes-base-path/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fapp%2Fpage.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "2fb46031a98bf14198de332f8bf87f882d201454",
            "filename": "test/e2e/middleware-skip-next-internal-routes-base-path/middleware-skip-next-internal-routes-base-path.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware-skip-next-internal-routes-base-path.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware-skip-next-internal-routes-base-path.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware-skip-next-internal-routes-base-path.test.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,18 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('middleware skip Next.js internal routes with base path', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should execute middleware on regular routes', async () => {\n+    const res = await next.fetch('/base')\n+    expect(res.status).toBe(200)\n+    expect(res.headers.get('x-middleware-executed')).toBe('true')\n+  })\n+\n+  it('should NOT execute middleware on _next routes', async () => {\n+    const res = await next.fetch('/base/_next/static/chunks/webpack.js')\n+    expect(res.headers.get('x-middleware-executed')).toBeFalsy()\n+  })\n+})"
        },
        {
            "sha": "97426e940d1f77d64de5b3654947f5d7fefa3211",
            "filename": "test/e2e/middleware-skip-next-internal-routes-base-path/middleware.ts",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fmiddleware.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,7 @@\n+import { NextResponse } from 'next/server'\n+\n+export function middleware() {\n+  const response = NextResponse.next()\n+  response.headers.set('x-middleware-executed', 'true')\n+  return response\n+}"
        },
        {
            "sha": "fa1d25f445b248111404a531bfd2ac966d9bfa18",
            "filename": "test/e2e/middleware-skip-next-internal-routes-base-path/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-base-path%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,6 @@\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  basePath: '/base',\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "08eaa94fdc8896acfd343a0dbb61c713eec93a55",
            "filename": "test/e2e/middleware-skip-next-internal-routes-opt-out/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Flayout.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-skip-next-internal-routes-opt-out/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fapp%2Fpage.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "9e4f81c5117423da5ab6f618932f9403dec38210",
            "filename": "test/e2e/middleware-skip-next-internal-routes-opt-out/middleware-skip-next-internal-routes-opt-out.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware-skip-next-internal-routes-opt-out.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware-skip-next-internal-routes-opt-out.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware-skip-next-internal-routes-opt-out.test.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,18 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('middleware skip Next.js internal routes (opt-out)', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should execute middleware on regular routes', async () => {\n+    const res = await next.fetch('/')\n+    expect(res.status).toBe(200)\n+    expect(res.headers.get('x-middleware-executed')).toBe('true')\n+  })\n+\n+  it('should ALSO execute middleware on _next routes when opted out', async () => {\n+    const res = await next.fetch('/_next/static/chunks/webpack.js')\n+    expect(res.headers.get('x-middleware-executed')).toBe('true')\n+  })\n+})"
        },
        {
            "sha": "97426e940d1f77d64de5b3654947f5d7fefa3211",
            "filename": "test/e2e/middleware-skip-next-internal-routes-opt-out/middleware.ts",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fmiddleware.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,7 @@\n+import { NextResponse } from 'next/server'\n+\n+export function middleware() {\n+  const response = NextResponse.next()\n+  response.headers.set('x-middleware-executed', 'true')\n+  return response\n+}"
        },
        {
            "sha": "a590bd7b5ce14b9ab46034ceccfe4dc496cae383",
            "filename": "test/e2e/middleware-skip-next-internal-routes-opt-out/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes-opt-out%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,6 @@\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  skipMiddlewareNextInternalRoutes: false,\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "08eaa94fdc8896acfd343a0dbb61c713eec93a55",
            "filename": "test/e2e/middleware-skip-next-internal-routes/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Flayout.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-skip-next-internal-routes/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fapp%2Fpage.tsx?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "9fa90820d5759c3012f0cc86fbf2793fcb336f06",
            "filename": "test/e2e/middleware-skip-next-internal-routes/middleware-skip-next-internal-routes.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware-skip-next-internal-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware-skip-next-internal-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware-skip-next-internal-routes.test.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,18 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('middleware skip Next.js internal routes', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should execute middleware on regular routes', async () => {\n+    const res = await next.fetch('/')\n+    expect(res.status).toBe(200)\n+    expect(res.headers.get('x-middleware-executed')).toBe('true')\n+  })\n+\n+  it('should NOT execute middleware on _next routes', async () => {\n+    const res = await next.fetch('/_next/static/chunks/webpack.js')\n+    expect(res.headers.get('x-middleware-executed')).toBeFalsy()\n+  })\n+})"
        },
        {
            "sha": "97426e940d1f77d64de5b3654947f5d7fefa3211",
            "filename": "test/e2e/middleware-skip-next-internal-routes/middleware.ts",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fmiddleware.ts?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,7 @@\n+import { NextResponse } from 'next/server'\n+\n+export function middleware() {\n+  const response = NextResponse.next()\n+  response.headers.set('x-middleware-executed', 'true')\n+  return response\n+}"
        },
        {
            "sha": "767719fc4fba59345ae29e29159c9aff270f5819",
            "filename": "test/e2e/middleware-skip-next-internal-routes/next.config.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-skip-next-internal-routes%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,4 @@\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "7bbcc25aa2ac67db1e8c74ca617ce3e561616c15",
            "filename": "test/e2e/middleware-trailing-slash/app/next.config.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-trailing-slash%2Fapp%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fmiddleware-trailing-slash%2Fapp%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-trailing-slash%2Fapp%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -1,4 +1,6 @@\n module.exports = {\n+  // This test needs to intercept internal routes /_next/ (skipped by default)\n+  skipMiddlewareNextInternalRoutes: false,\n   trailingSlash: true,\n   redirects() {\n     return ["
        },
        {
            "sha": "ec8f1f73a1db3f7d0483f18feecbec8d347827d3",
            "filename": "test/e2e/skip-trailing-slash-redirect/app/next.config.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fskip-trailing-slash-redirect%2Fapp%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -1,5 +1,7 @@\n /** @type {import('next').NextConfig} */\n const nextConfig = {\n+  // This test needs to intercept internal routes /_next/ (skipped by default)\n+  skipMiddlewareNextInternalRoutes: false,\n   skipMiddlewareUrlNormalize: true,\n   skipTrailingSlashRedirect: true,\n   experimental: {"
        },
        {
            "sha": "613d90fa882e77fa8086ece6d4bd85c0aef1af77",
            "filename": "test/integration/next-image-new/middleware/next.config.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fintegration%2Fnext-image-new%2Fmiddleware%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6b7205038a1b2d4b10cfe48a6779ea8222c81b50/test%2Fintegration%2Fnext-image-new%2Fmiddleware%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fmiddleware%2Fnext.config.js?ref=6b7205038a1b2d4b10cfe48a6779ea8222c81b50",
            "patch": "@@ -0,0 +1,4 @@\n+module.exports = {\n+  // This test needs to intercept internal routes /_next/ (skipped by default)\n+  skipMiddlewareNextInternalRoutes: false,\n+}"
        }
    ],
    "stats": {
        "total": 297,
        "additions": 262,
        "deletions": 35
    }
}