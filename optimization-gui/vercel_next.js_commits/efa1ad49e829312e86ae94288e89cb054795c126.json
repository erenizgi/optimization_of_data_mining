{
    "author": "ztanner",
    "message": "auto-enable clientParamParsing and clientSegmentCache w/ cacheComponents (#84250)\n\nWhen you try `experimental.cacheComponents`, we should auto-enable the\nsupporting flags (`clientSegmentCache`, `clientParamParsing`), just like\nwe were doing with PPR to avoid the need to think about all the\ndifferent flags needed to get the best cache components testing\nexperience. Like before, these flags can be explicitly disabled for any\nreason.",
    "sha": "efa1ad49e829312e86ae94288e89cb054795c126",
    "files": [
        {
            "sha": "7776b4259e9198cd6c8a98350a64ecbc8cf4033a",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 21,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/efa1ad49e829312e86ae94288e89cb054795c126/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/efa1ad49e829312e86ae94288e89cb054795c126/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=efa1ad49e829312e86ae94288e89cb054795c126",
            "patch": "@@ -1690,59 +1690,68 @@ function enforceExperimentalFeatures(\n     }\n   }\n \n-  // TODO: Remove this once we've made Client Segment Cache the default.\n+  // TODO: Remove this once we've made Cache Components the default.\n   if (\n-    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&\n+    process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true' &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.clientSegmentCache === undefined ||\n-      (isDefaultConfig && !config.experimental.clientSegmentCache))\n+    (config.experimental.cacheComponents === undefined ||\n+      (isDefaultConfig && !config.experimental.cacheComponents))\n   ) {\n-    config.experimental.clientSegmentCache = true\n+    config.experimental.cacheComponents = true\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'clientSegmentCache',\n+        'cacheComponents',\n         true,\n-        'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n+        'enabled by `__NEXT_EXPERIMENTAL_CACHE_COMPONENTS`'\n       )\n     }\n   }\n \n-  // TODO: Remove this once we've made Client Param Parsing the default.\n+  const enabledByPprEnv = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n+  const enabledByCacheComponents = config.experimental.cacheComponents === true\n+\n+  // TODO: Remove this once we've made Client Segment Cache the default.\n   if (\n-    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&\n+    (enabledByPprEnv || enabledByCacheComponents) &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.clientParamParsing === undefined ||\n-      (isDefaultConfig && !config.experimental.clientParamParsing))\n+    (config.experimental.clientSegmentCache === undefined ||\n+      (isDefaultConfig && !config.experimental.clientSegmentCache))\n   ) {\n-    config.experimental.clientParamParsing = true\n+    config.experimental.clientSegmentCache = true\n+    const reason = enabledByCacheComponents\n+      ? 'enabled by `experimental.cacheComponents`'\n+      : 'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'clientParamParsing',\n+        'clientSegmentCache',\n         true,\n-        'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n+        reason\n       )\n     }\n   }\n \n-  // TODO: Remove this once we've made Cache Components the default.\n+  // TODO: Remove this once we've made Client Param Parsing the default.\n   if (\n-    process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true' &&\n+    (enabledByPprEnv || enabledByCacheComponents) &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.cacheComponents === undefined ||\n-      (isDefaultConfig && !config.experimental.cacheComponents))\n+    (config.experimental.clientParamParsing === undefined ||\n+      (isDefaultConfig && !config.experimental.clientParamParsing))\n   ) {\n-    config.experimental.cacheComponents = true\n+    config.experimental.clientParamParsing = true\n+    const reason = enabledByCacheComponents\n+      ? 'enabled by `experimental.cacheComponents`'\n+      : 'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'cacheComponents',\n+        'clientParamParsing',\n         true,\n-        'enabled by `__NEXT_EXPERIMENTAL_CACHE_COMPONENTS`'\n+        reason\n       )\n     }\n   }"
        },
        {
            "sha": "bde403f1c58248deb80c9a38a1d007fa74304a88",
            "filename": "test/e2e/app-dir/segment-cache/basic/segment-cache-basic.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/efa1ad49e829312e86ae94288e89cb054795c126/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/efa1ad49e829312e86ae94288e89cb054795c126/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts?ref=efa1ad49e829312e86ae94288e89cb054795c126",
            "patch": "@@ -93,7 +93,11 @@ describe('segment cache (basic tests)', () => {\n     )\n   })\n \n-  it('navigate to page with lazily-generated (not at build time) static param', async () => {\n+  // TODO(client-param-parsing): With `clientParamParsing` enabled, this test is outdated, because\n+  // we no longer put the param values in the prefetched RSC response. You'd have to opt into runtime\n+  // prefetching for this test to pass until we ship the optimization that would mark this as fully static\n+  // if you don't reference any dynamic params in the server components.\n+  it.skip('navigate to page with lazily-generated (not at build time) static param', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/lazily-generated-params', {\n       beforePageLoad(page) {"
        },
        {
            "sha": "5cfc1cddf9f12e4ee874fb0bf51b88d7ab6fd691",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 20,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/efa1ad49e829312e86ae94288e89cb054795c126/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/efa1ad49e829312e86ae94288e89cb054795c126/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=efa1ad49e829312e86ae94288e89cb054795c126",
            "patch": "@@ -26,8 +26,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -37,8 +37,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -61,8 +61,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n@@ -74,6 +74,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -83,6 +85,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Rspack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -92,6 +96,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -149,8 +155,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -164,8 +170,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -196,8 +202,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -213,6 +219,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -226,6 +234,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Rspack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -239,6 +249,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -297,8 +309,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -308,8 +320,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -370,8 +382,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -385,8 +397,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)"
        }
    ],
    "stats": {
        "total": 109,
        "additions": 67,
        "deletions": 42
    }
}