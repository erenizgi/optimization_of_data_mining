{
    "author": "mischnic",
    "message": "Turbopack: make another callback return a result (#80608)\n\nWe already do this in a bunch of these callbacks, because sometimes you have some `Option<>` in there that you know is always set. Except for eventual consistency, unfortunately. That's the main usecase for a result here.",
    "sha": "19762ee2f5ee355c40f14a767c43311688bf98b7",
    "files": [
        {
            "sha": "2faefbfa921820f7a317610a510bb32cec3d61d7",
            "filename": "crates/next-api/src/module_graph.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/19762ee2f5ee355c40f14a767c43311688bf98b7/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19762ee2f5ee355c40f14a767c43311688bf98b7/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs?ref=19762ee2f5ee355c40f14a767c43311688bf98b7",
            "patch": "@@ -348,7 +348,7 @@ impl ClientReferencesGraph {\n                 },\n                 |parent_info, node, state_map| {\n                     let Some((parent_node, _)) = parent_info else {\n-                        return;\n+                        return Ok(());\n                     };\n                     let parent_module = parent_node.module;\n \n@@ -378,6 +378,7 @@ impl ClientReferencesGraph {\n                         }\n                         _ => {}\n                     };\n+                    Ok(())\n                 },\n             )?;\n "
        },
        {
            "sha": "ad79a0722b48d2c7472bab8ee4e1639f9bb87ee3",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/async_module_info.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs?ref=19762ee2f5ee355c40f14a767c43311688bf98b7",
            "patch": "@@ -80,14 +80,15 @@ async fn compute_async_module_info_single(\n         |parent_info, module, _| {\n             let Some((parent_module, ref_data)) = parent_info else {\n                 // An entry module\n-                return;\n+                return Ok(());\n             };\n             let module = module.module();\n             let parent_module = parent_module.module;\n \n             if ref_data.chunking_type.is_inherit_async() && async_modules.contains(&module) {\n                 async_modules.insert(parent_module);\n             }\n+            Ok(())\n         },\n     )?;\n "
        },
        {
            "sha": "3654e1849411a6ad19c669d90ddd83c8eabac6be",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=19762ee2f5ee355c40f14a767c43311688bf98b7",
            "patch": "@@ -567,7 +567,7 @@ impl SingleModuleGraph {\n             Option<(&'a SingleModuleGraphModuleNode, &'a RefData)>,\n             &'a SingleModuleGraphNode,\n             &mut S,\n-        ),\n+        ) -> Result<()>,\n     ) -> Result<()> {\n         let graph = &self.graph;\n         let entries = entries.into_iter().map(|e| self.get_module(e).unwrap());\n@@ -596,7 +596,7 @@ impl SingleModuleGraph {\n             });\n             match pass {\n                 TopologicalPass::Visit => {\n-                    visit_postorder(parent_arg, graph.node_weight(current).unwrap(), state);\n+                    visit_postorder(parent_arg, graph.node_weight(current).unwrap(), state)?;\n                 }\n                 TopologicalPass::ExpandAndVisit => match graph.node_weight(current).unwrap() {\n                     current_node @ SingleModuleGraphNode::Module(_) => {\n@@ -619,7 +619,7 @@ impl SingleModuleGraph {\n                     }\n                     current_node @ SingleModuleGraphNode::VisitedModule { .. } => {\n                         visit_preorder(parent_arg, current_node, state)?;\n-                        visit_postorder(parent_arg, current_node, state);\n+                        visit_postorder(parent_arg, current_node, state)?;\n                     }\n                 },\n             }\n@@ -1307,7 +1307,7 @@ impl ModuleGraph {\n             Option<(&'_ SingleModuleGraphModuleNode, &'_ RefData)>,\n             &'_ SingleModuleGraphModuleNode,\n             &mut S,\n-        ),\n+        ) -> Result<()>,\n     ) -> Result<()> {\n         let graphs = self.get_graphs().await?;\n \n@@ -1345,7 +1345,7 @@ impl ModuleGraph {\n             let current_node = get_node!(graphs, current)?;\n             match pass {\n                 TopologicalPass::Visit => {\n-                    visit_postorder(parent_arg, current_node, state);\n+                    visit_postorder(parent_arg, current_node, state)?;\n                 }\n                 TopologicalPass::ExpandAndVisit => {\n                     let action = visit_preorder(parent_arg, current_node, state)?;"
        },
        {
            "sha": "2dfc987650c25f18ddd0f9e2906ddbd7418f6bf4",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/module_batches.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/19762ee2f5ee355c40f14a767c43311688bf98b7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs?ref=19762ee2f5ee355c40f14a767c43311688bf98b7",
            "patch": "@@ -330,6 +330,7 @@ impl PreBatches {\n                 |_, node, state| {\n                     let item = PreBatchItem::ParallelModule(node.module);\n                     state.items.push(item);\n+                    Ok(())\n                 },\n             )\n             .await?;"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}