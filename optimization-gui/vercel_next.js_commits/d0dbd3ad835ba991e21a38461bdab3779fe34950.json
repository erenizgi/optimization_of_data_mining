{
    "author": "acdlite",
    "message": "[Experiment] <Link unstable_dynamicOnHover> (#77866)\n\nThis adds an unstable option to the Link component's called\n`unstable_dynamicOnHover`. When set to true, the Link will initiate a\ndynamic prefetch as soon as the link is hovered.\n\nThis is roughly equivalent to updating the prefetch prop to `true`\ninside a mouse event handler.\n\nBecause this results in dynamic prefetching, semantically it has the\nsame implication as `prefetch={true}` â€” by the time the navigation\noccurs, the target page's data may be slightly stale.",
    "sha": "d0dbd3ad835ba991e21a38461bdab3779fe34950",
    "files": [
        {
            "sha": "182adaed3761f4ee1c467f91d62977a4e2389999",
            "filename": "packages/next/src/build/webpack/plugins/define-env-plugin.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -187,6 +187,9 @@ export function getDefineEnv({\n     'process.env.__NEXT_CLIENT_SEGMENT_CACHE': Boolean(\n       config.experimental.clientSegmentCache\n     ),\n+    'process.env.__NEXT_DYNAMIC_ON_HOVER': Boolean(\n+      config.experimental.dynamicOnHover\n+    ),\n     'process.env.__NEXT_OPTIMISTIC_CLIENT_CACHE':\n       config.experimental.optimisticClientCache ?? true,\n     'process.env.__NEXT_MIDDLEWARE_PREFETCH':"
        },
        {
            "sha": "648e8a2a5286c03d35b7df8a75cdba3bd8079a56",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 21,
            "deletions": 3,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -153,6 +153,12 @@ type InternalLinkProps = {\n    */\n   prefetch?: boolean | null\n \n+  /**\n+   * (unstable) Switch to a dynamic prefetch on hover. Effectively the same as\n+   * updating the prefetch prop to `true` in a mouse event.\n+   */\n+  unstable_dynamicOnHover?: boolean\n+\n   /**\n    * The active locale is automatically prepended in the Pages Router. `locale` allows for providing\n    * a different locale, or can be set to `false` to opt out of automatic locale behavior.\n@@ -336,6 +342,7 @@ export default function LinkComponent(\n     legacyBehavior = false,\n     onNavigate,\n     ref: forwardedRef,\n+    unstable_dynamicOnHover,\n     ...restProps\n   } = props\n \n@@ -356,6 +363,7 @@ export default function LinkComponent(\n    * - null: this is the default \"auto\" mode, where we will prefetch partially if the link is in the viewport\n    * - true: we will prefetch if the link is visible and prefetch the full page, not just partially\n    * - false: we will not prefetch if in the viewport at all\n+   * - 'unstable_dynamicOnHover': this starts in \"auto\" mode, but switches to \"full\" when the link is hovered\n    */\n   const appPrefetchKind =\n     prefetchProp === null ? PrefetchKind.AUTO : PrefetchKind.FULL\n@@ -408,6 +416,7 @@ export default function LinkComponent(\n       shallow: true,\n       passHref: true,\n       prefetch: true,\n+      unstable_dynamicOnHover: true,\n       onClick: true,\n       onMouseEnter: true,\n       onTouchStart: true,\n@@ -447,7 +456,8 @@ export default function LinkComponent(\n         key === 'shallow' ||\n         key === 'passHref' ||\n         key === 'prefetch' ||\n-        key === 'legacyBehavior'\n+        key === 'legacyBehavior' ||\n+        key === 'unstable_dynamicOnHover'\n       ) {\n         if (props[key] != null && valType !== 'boolean') {\n           throw createPropError({\n@@ -639,7 +649,11 @@ export default function LinkComponent(\n         return\n       }\n \n-      onNavigationIntent(e.currentTarget as HTMLAnchorElement | SVGAElement)\n+      const upgradeToDynamicPrefetch = unstable_dynamicOnHover === true\n+      onNavigationIntent(\n+        e.currentTarget as HTMLAnchorElement | SVGAElement,\n+        upgradeToDynamicPrefetch\n+      )\n     },\n     onTouchStart: process.env.__NEXT_LINK_NO_TOUCH_START\n       ? undefined\n@@ -664,7 +678,11 @@ export default function LinkComponent(\n             return\n           }\n \n-          onNavigationIntent(e.currentTarget as HTMLAnchorElement | SVGAElement)\n+          const upgradeToDynamicPrefetch = unstable_dynamicOnHover === true\n+          onNavigationIntent(\n+            e.currentTarget as HTMLAnchorElement | SVGAElement,\n+            upgradeToDynamicPrefetch\n+          )\n         },\n   }\n "
        },
        {
            "sha": "fa7a883cffc9ec17cb838f65a2eabab8e2badb00",
            "filename": "packages/next/src/client/components/links.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 13,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flinks.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -10,7 +10,7 @@ import {\n   PrefetchPriority,\n   schedulePrefetchTask as scheduleSegmentPrefetchTask,\n   cancelPrefetchTask,\n-  bumpPrefetchTask,\n+  reschedulePrefetchTask,\n } from './segment-cache'\n import { startTransition } from 'react'\n \n@@ -257,14 +257,24 @@ export function onLinkVisibilityChanged(element: Element, isVisible: boolean) {\n   rescheduleLinkPrefetch(instance)\n }\n \n-export function onNavigationIntent(element: HTMLAnchorElement | SVGAElement) {\n+export function onNavigationIntent(\n+  element: HTMLAnchorElement | SVGAElement,\n+  unstable_upgradeToDynamicPrefetch: boolean\n+) {\n   const instance = prefetchable.get(element)\n   if (instance === undefined) {\n     return\n   }\n   // Prefetch the link on hover/touchstart.\n   if (instance !== undefined) {\n     instance.wasHoveredOrTouched = true\n+    if (\n+      process.env.__NEXT_DYNAMIC_ON_HOVER &&\n+      unstable_upgradeToDynamicPrefetch\n+    ) {\n+      // Switch to a full, dynamic prefetch\n+      instance.kind = PrefetchKind.FULL\n+    }\n     rescheduleLinkPrefetch(instance)\n   }\n }\n@@ -279,7 +289,7 @@ function rescheduleLinkPrefetch(instance: PrefetchableInstance) {\n       cancelPrefetchTask(existingPrefetchTask)\n     }\n     // We don't need to reset the prefetchTask to null upon cancellation; an\n-    // old task object can be rescheduled with bumpPrefetchTask. This is a\n+    // old task object can be rescheduled with reschedulePrefetchTask. This is a\n     // micro-optimization but also makes the code simpler (don't need to\n     // worry about whether an old task object is stale).\n     return\n@@ -301,25 +311,33 @@ function rescheduleLinkPrefetch(instance: PrefetchableInstance) {\n   const priority = instance.wasHoveredOrTouched\n     ? PrefetchPriority.Intent\n     : PrefetchPriority.Default\n-  if (existingPrefetchTask === null) {\n-    // Initiate a prefetch task.\n-    const appRouterState = getCurrentAppRouterState()\n-    if (appRouterState !== null) {\n+  const appRouterState = getCurrentAppRouterState()\n+  if (appRouterState !== null) {\n+    const treeAtTimeOfPrefetch = appRouterState.tree\n+    if (existingPrefetchTask === null) {\n+      // Initiate a prefetch task.\n       const nextUrl = appRouterState.nextUrl\n-      const treeAtTimeOfPrefetch = appRouterState.tree\n       const cacheKey = createCacheKey(instance.prefetchHref, nextUrl)\n       instance.prefetchTask = scheduleSegmentPrefetchTask(\n         cacheKey,\n         treeAtTimeOfPrefetch,\n         instance.kind === PrefetchKind.FULL,\n         priority\n       )\n-      instance.cacheVersion = getCurrentCacheVersion()\n+    } else {\n+      // We already have an old task object that we can reschedule. This is\n+      // effectively the same as canceling the old task and creating a new one.\n+      reschedulePrefetchTask(\n+        existingPrefetchTask,\n+        treeAtTimeOfPrefetch,\n+        instance.kind === PrefetchKind.FULL,\n+        priority\n+      )\n     }\n-  } else {\n-    // We already have an old task object that we can reschedule. This is\n-    // effectively the same as canceling the old task and creating a new one.\n-    bumpPrefetchTask(existingPrefetchTask, priority)\n+\n+    // Keep track of the cache version at the time the prefetch was requested.\n+    // This is used to check if the prefetch is stale.\n+    instance.cacheVersion = getCurrentCacheVersion()\n   }\n }\n "
        },
        {
            "sha": "2ddacff30f3d32720be3f6b33cc087375618e985",
            "filename": "packages/next/src/client/components/segment-cache-impl/scheduler.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fscheduler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fscheduler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fscheduler.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -220,8 +220,10 @@ export function cancelPrefetchTask(task: PrefetchTask): void {\n   heapDelete(taskHeap, task)\n }\n \n-export function bumpPrefetchTask(\n+export function reschedulePrefetchTask(\n   task: PrefetchTask,\n+  treeAtTimeOfPrefetch: FlightRouterState,\n+  includeDynamicData: boolean,\n   priority: PrefetchPriority\n ): void {\n   // Bump the prefetch task to the top of the queue, as if it were a fresh\n@@ -233,12 +235,16 @@ export function bumpPrefetchTask(\n \n   // Un-cancel the task, in case it was previously canceled.\n   task.isCanceled = false\n+  task.phase = PrefetchPhase.RouteTree\n \n   // Assign a new sort ID to move it ahead of all other tasks at the same\n   // priority level. (Higher sort IDs are processed first.)\n   task.sortId = sortIdCounter++\n   task.priority = priority\n \n+  task.treeAtTimeOfPrefetch = treeAtTimeOfPrefetch\n+  task.includeDynamicData = includeDynamicData\n+\n   if (task._heapIndex !== -1) {\n     // The task is already in the queue.\n     heapResift(taskHeap, task)"
        },
        {
            "sha": "743a05119291815f1e0408a20946f571d24fed75",
            "filename": "packages/next/src/client/components/segment-cache.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -76,10 +76,10 @@ export const cancelPrefetchTask: typeof import('./segment-cache-impl/scheduler')\n       }\n     : notEnabled\n \n-export const bumpPrefetchTask: typeof import('./segment-cache-impl/scheduler').bumpPrefetchTask =\n+export const reschedulePrefetchTask: typeof import('./segment-cache-impl/scheduler').reschedulePrefetchTask =\n   process.env.__NEXT_CLIENT_SEGMENT_CACHE\n     ? function (...args) {\n-        return require('./segment-cache-impl/scheduler').bumpPrefetchTask(\n+        return require('./segment-cache-impl/scheduler').reschedulePrefetchTask(\n           ...args\n         )\n       }"
        },
        {
            "sha": "eba1c817b3676718e123136acddd686c63b78fea",
            "filename": "packages/next/src/export/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -395,6 +395,7 @@ async function exportAppImpl(\n         nextConfig.experimental.clientSegmentCache === 'client-only'\n           ? 'client-only'\n           : Boolean(nextConfig.experimental.clientSegmentCache),\n+      dynamicOnHover: nextConfig.experimental.dynamicOnHover ?? false,\n       inlineCss: nextConfig.experimental.inlineCss ?? false,\n       authInterrupts: !!nextConfig.experimental.authInterrupts,\n     },"
        },
        {
            "sha": "cf7a0b99ba04f8f31ce072af2362a11da0c6ac66",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -214,6 +214,7 @@ export interface RenderOptsPartial {\n     clientTraceMetadata: string[] | undefined\n     dynamicIO: boolean\n     clientSegmentCache: boolean | 'client-only'\n+    dynamicOnHover: boolean\n     inlineCss: boolean\n     authInterrupts: boolean\n   }"
        },
        {
            "sha": "dbb2d786146c2880fad485934a69e9add4c66322",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -607,6 +607,7 @@ export default abstract class Server<\n           this.nextConfig.experimental.clientSegmentCache === 'client-only'\n             ? 'client-only'\n             : Boolean(this.nextConfig.experimental.clientSegmentCache),\n+        dynamicOnHover: this.nextConfig.experimental.dynamicOnHover ?? false,\n         inlineCss: this.nextConfig.experimental.inlineCss ?? false,\n         authInterrupts: !!this.nextConfig.experimental.authInterrupts,\n       },"
        },
        {
            "sha": "3424941a98364dcd160c297e6ca0b1396efe67bc",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -302,6 +302,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n         clientSegmentCache: z\n           .union([z.boolean(), z.literal('client-only')])\n           .optional(),\n+        dynamicOnHover: z.boolean().optional(),\n         disableOptimizedLoading: z.boolean().optional(),\n         disablePostcssPresetEnv: z.boolean().optional(),\n         dynamicIO: z.boolean().optional(),"
        },
        {
            "sha": "f6a0f10c43c9bda39ca031e3755c03d233fd07b3",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -270,6 +270,7 @@ export interface ExperimentalConfig {\n   linkNoTouchStart?: boolean\n   caseSensitiveRoutes?: boolean\n   clientSegmentCache?: boolean | 'client-only'\n+  dynamicOnHover?: boolean\n   appDocumentPreloading?: boolean\n   preloadEntriesOnStart?: boolean\n   /** @default true */\n@@ -1198,6 +1199,7 @@ export const defaultConfig: NextConfig = {\n     linkNoTouchStart: false,\n     caseSensitiveRoutes: false,\n     clientSegmentCache: false,\n+    dynamicOnHover: false,\n     appDocumentPreloading: undefined,\n     preloadEntriesOnStart: true,\n     clientRouterFilter: true,"
        },
        {
            "sha": "7013a3283696dcaffc10ed4e6a10c474d797f19f",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/app/dynamic/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Flayout.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }: { children: React.ReactNode }) {\n+  return (\n+    <div>\n+      Static content in layout of dynamic page\n+      <div>{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "f3c724e84f65f38270a46cc742500004134c0533",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/app/dynamic/page.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fdynamic%2Fpage.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,15 @@\n+import { Suspense } from 'react'\n+import { connection } from 'next/server'\n+\n+async function DynamicContent() {\n+  await connection()\n+  return <div id=\"dynamic-content\">Dynamic content</div>\n+}\n+\n+export default function Page() {\n+  return (\n+    <Suspense fallback={<div>Loading dynamic data...</div>}>\n+      <DynamicContent />\n+    </Suspense>\n+  )\n+}"
        },
        {
            "sha": "dbce4ea8e3aeb6cb61b81712b62288d5abaf776b",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Flayout.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html lang=\"en\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "e20ed20f5030042d77d7368ac1a40b57cb147792",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/app/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fapp%2Fpage.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,9 @@\n+import { LinkAccordion } from '../components/link-accordion'\n+\n+export default function Page() {\n+  return (\n+    <LinkAccordion unstable_dynamicOnHover href=\"/dynamic\">\n+      Dynamic page\n+    </LinkAccordion>\n+  )\n+}"
        },
        {
            "sha": "7b9fc4520533d54cd4fc3bd1076e78d9d11d826d",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/components/link-accordion.tsx",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fcomponents%2Flink-accordion.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fcomponents%2Flink-accordion.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fcomponents%2Flink-accordion.tsx?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,40 @@\n+'use client'\n+\n+import Link from 'next/link'\n+import { useState } from 'react'\n+\n+export function LinkAccordion({\n+  href,\n+  children,\n+  prefetch,\n+  unstable_dynamicOnHover,\n+}: {\n+  href: string\n+  children: React.ReactNode\n+  prefetch?: boolean\n+  unstable_dynamicOnHover?: boolean\n+}) {\n+  const [isVisible, setIsVisible] = useState(false)\n+  return (\n+    <>\n+      <input\n+        type=\"checkbox\"\n+        checked={isVisible}\n+        onChange={() => setIsVisible(!isVisible)}\n+        data-link-accordion={href}\n+      />\n+      {isVisible ? (\n+        <Link\n+          href={href}\n+          prefetch={prefetch}\n+          // @ts-expect-error - unstable_dynamicOnHover is not part of the public types\n+          unstable_dynamicOnHover={unstable_dynamicOnHover}\n+        >\n+          {children}\n+        </Link>\n+      ) : (\n+        <>{children} (link is hidden)</>\n+      )}\n+    </>\n+  )\n+}"
        },
        {
            "sha": "07e329e3225e1a213a4cb74b90dd3579110f9a2d",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/dynamic-on-hover.test.ts",
            "status": "added",
            "additions": 65,
            "deletions": 0,
            "changes": 65,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fdynamic-on-hover.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fdynamic-on-hover.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fdynamic-on-hover.test.ts?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,65 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import type * as Playwright from 'playwright'\n+import { createRouterAct } from '../router-act'\n+\n+describe('dynamic on hover', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+  if (isNextDev || skipped) {\n+    test('prefetching is disabled', () => {})\n+    return\n+  }\n+\n+  it('prefetches the dynamic data for a Link on hover', async () => {\n+    let act: ReturnType<typeof createRouterAct>\n+    const browser = await next.browser('/', {\n+      beforePageLoad(p: Playwright.Page) {\n+        act = createRouterAct(p)\n+      },\n+    })\n+\n+    // This Link's unstable_dynamicOnHover prop is set to true\n+    const linkVisibilityToggle = await browser.elementByCss(\n+      'input[data-link-accordion=\"/dynamic\"]'\n+    )\n+\n+    // Reveal the link to start prefetching. Since the link has not been hovered\n+    // yet, the prefetch only includes static data.\n+    await act(async () => {\n+      await linkVisibilityToggle.click()\n+      await browser.elementByCss('a[href=\"/dynamic\"]')\n+    }, [\n+      {\n+        includes: 'Static content in layout of dynamic page',\n+      },\n+      {\n+        includes: 'Loading dynamic data...',\n+      },\n+    ])\n+\n+    // Hover over the link to prefetch the dynamic data\n+    const link = await browser.elementByCss('a[href=\"/dynamic\"]')\n+    await act(async () => {\n+      await link.hover()\n+    }, [\n+      // The dynamic data was prefetched\n+      {\n+        includes: 'Dynamic content',\n+      },\n+      // The static content in the layout was not fetched again, because it\n+      // was already cached.\n+      {\n+        includes: 'Static content in layout of dynamic page',\n+        block: 'reject',\n+      },\n+    ])\n+\n+    // When navigating to the page, no additional requests are issued, because\n+    // the entire page was prefetched.\n+    await act(async () => {\n+      await link.click()\n+    }, 'no-requests')\n+  })\n+})"
        },
        {
            "sha": "7383394c57fd444e8061088a730792e2f13c4357",
            "filename": "test/e2e/app-dir/segment-cache/dynamic-on-hover/next.config.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d0dbd3ad835ba991e21a38461bdab3779fe34950/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fdynamic-on-hover%2Fnext.config.js?ref=d0dbd3ad835ba991e21a38461bdab3779fe34950",
            "patch": "@@ -0,0 +1,13 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    ppr: true,\n+    dynamicIO: true,\n+    clientSegmentCache: true,\n+    dynamicOnHover: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 250,
        "additions": 231,
        "deletions": 19
    }
}