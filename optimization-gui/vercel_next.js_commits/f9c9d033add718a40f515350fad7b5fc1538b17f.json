{
    "author": "devjiwonchoi",
    "message": "[devtools] replace the old error overlay with the issues tab view (#80814)",
    "sha": "f9c9d033add718a40f515350fad7b5fc1538b17f",
    "files": [
        {
            "sha": "0cf967371d8250e0f7d4aefb5b525814a9fb9f14",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=f9c9d033add718a40f515350fad7b5fc1538b17f",
            "patch": "@@ -10,11 +10,10 @@ import {\n } from '../errors/dev-tools-indicator/utils'\n import {\n   ACTION_DEVTOOLS_PANEL_TOGGLE,\n-  ACTION_ERROR_OVERLAY_TOGGLE,\n-  ACTION_ERROR_OVERLAY_CLOSE,\n   STORAGE_KEY_POSITION,\n-  ACTION_DEVTOOLS_PANEL_CLOSE,\n   ACTION_DEVTOOLS_POSITION,\n+  ACTION_DEVTOOLS_PANEL_OPEN,\n+  ACTION_ERROR_OVERLAY_OPEN,\n } from '../../shared'\n import { Draggable } from '../errors/dev-tools-indicator/draggable'\n \n@@ -35,13 +34,13 @@ export function DevToolsIndicator({\n \n   const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n \n-  const toggleErrorOverlay = () => {\n-    dispatch({ type: ACTION_DEVTOOLS_PANEL_CLOSE })\n-    dispatch({ type: ACTION_ERROR_OVERLAY_TOGGLE })\n+  const enableErrorOverlayMode = () => {\n+    dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+    // Open the DevTools panel to view as error overlay mode.\n+    dispatch({ type: ACTION_DEVTOOLS_PANEL_OPEN })\n   }\n \n   const toggleDevToolsPanel = () => {\n-    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n     dispatch({ type: ACTION_DEVTOOLS_PANEL_TOGGLE })\n   }\n \n@@ -56,7 +55,10 @@ export function DevToolsIndicator({\n           zIndex: 2147483647,\n           [vertical]: `${INDICATOR_PADDING}px`,\n           [horizontal]: `${INDICATOR_PADDING}px`,\n-          visibility: state.isDevToolsPanelOpen ? 'hidden' : 'visible',\n+          visibility:\n+            state.isDevToolsPanelOpen || state.isErrorOverlayOpen\n+              ? 'hidden'\n+              : 'visible',\n         } as CSSProperties\n       }\n     >\n@@ -82,7 +84,7 @@ export function DevToolsIndicator({\n           disabled={state.disableDevIndicator}\n           issueCount={errorCount}\n           onTriggerClick={toggleDevToolsPanel}\n-          toggleErrorOverlay={toggleErrorOverlay}\n+          toggleErrorOverlay={enableErrorOverlayMode}\n           isDevBuilding={state.buildingIndicator}\n           isDevRendering={state.renderingIndicator}\n           isBuildError={isBuildError}"
        },
        {
            "sha": "4f5990daab9572c9312d3e9c23bc6c612dd7e131",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx?ref=f9c9d033add718a40f515350fad7b5fc1538b17f",
            "patch": "@@ -14,6 +14,7 @@ import {\n   ACTION_DEVTOOLS_SCALE,\n   STORAGE_KEY_SCALE,\n   STORAGE_KEY_POSITION,\n+  ACTION_ERROR_OVERLAY_CLOSE,\n } from '../../shared'\n import { css } from '../../utils/css'\n import { OverlayBackdrop } from '../overlay'\n@@ -40,10 +41,20 @@ export function DevToolsPanel({\n }) {\n   const [activeTab, setActiveTab] = useState<DevToolsPanelTabType>('issues')\n   const [isFullscreen, setIsFullscreen] = useState(false)\n+  const [prevIsErrorOverlayOpen, setPrevIsErrorOverlayOpen] = useState(false)\n+\n+  if (state.isErrorOverlayOpen !== prevIsErrorOverlayOpen) {\n+    if (state.isErrorOverlayOpen) {\n+      setIsFullscreen(true)\n+    }\n+    setPrevIsErrorOverlayOpen(state.isErrorOverlayOpen)\n+  }\n+\n   const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n \n   const onCloseDevToolsPanel = () => {\n     dispatch({ type: ACTION_DEVTOOLS_PANEL_CLOSE })\n+    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n   }\n \n   const handlePositionChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n@@ -64,6 +75,7 @@ export function DevToolsPanel({\n \n   const handleFullscreenToggle = () => {\n     setIsFullscreen((prev) => !prev)\n+    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n   }\n \n   return ("
        },
        {
            "sha": "8c05f69fad11802b4a032350fc44c3cf933958fb",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 47,
            "deletions": 21,
            "changes": 68,
            "blob_url": "https://github.com/vercel/next.js/blob/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=f9c9d033add718a40f515350fad7b5fc1538b17f",
            "patch": "@@ -1,4 +1,11 @@\n-import type { OverlayDispatch, OverlayState } from './shared'\n+import {\n+  ACTION_DEVTOOLS_PANEL_OPEN,\n+  ACTION_ERROR_OVERLAY_OPEN,\n+  type OverlayDispatch,\n+  type OverlayState,\n+} from './shared'\n+\n+import { useState } from 'react'\n \n import { ShadowPortal } from './components/shadow-portal'\n import { Base } from './styles/base'\n@@ -24,6 +31,23 @@ export function DevOverlay({\n   getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n }) {\n   const [scale, setScale] = useDevToolsScale()\n+  const [isPrevBuildError, setIsPrevBuildError] = useState(false)\n+\n+  const isBuildError = state.buildError !== null\n+\n+  if (\n+    process.env.__NEXT_DEVTOOL_NEW_PANEL_UI &&\n+    isBuildError !== isPrevBuildError\n+  ) {\n+    // If the build error is set, enable the devtools panel as the error overlay mode,\n+    // and the rest actions (close, minimize, fullscreen) can be handled by the user.\n+    if (isBuildError) {\n+      dispatch({ type: ACTION_DEVTOOLS_PANEL_OPEN })\n+      dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+    }\n+    setIsPrevBuildError(isBuildError)\n+  }\n+\n   return (\n     <ShadowPortal>\n       <CssReset />\n@@ -36,7 +60,6 @@ export function DevOverlay({\n \n       <RenderError state={state} isAppDir={true}>\n         {({ runtimeErrors, totalErrorCount }) => {\n-          const isBuildError = state.buildError !== null\n           return (\n             <>\n               {state.showIndicator &&\n@@ -49,7 +72,8 @@ export function DevOverlay({\n                       isBuildError={isBuildError}\n                     />\n \n-                    {state.isDevToolsPanelOpen && (\n+                    {(state.isDevToolsPanelOpen ||\n+                      state.isErrorOverlayOpen) && (\n                       <DevToolsPanel\n                         state={state}\n                         dispatch={dispatch}\n@@ -62,25 +86,27 @@ export function DevOverlay({\n                     )}\n                   </>\n                 ) : (\n-                  <DevToolsIndicator\n-                    scale={scale}\n-                    setScale={setScale}\n-                    state={state}\n-                    dispatch={dispatch}\n-                    errorCount={totalErrorCount}\n-                    isBuildError={isBuildError}\n-                  />\n-                ))}\n+                  <>\n+                    <DevToolsIndicator\n+                      scale={scale}\n+                      setScale={setScale}\n+                      state={state}\n+                      dispatch={dispatch}\n+                      errorCount={totalErrorCount}\n+                      isBuildError={isBuildError}\n+                    />\n \n-              <ErrorOverlay\n-                state={state}\n-                dispatch={dispatch}\n-                getSquashedHydrationErrorDetails={\n-                  getSquashedHydrationErrorDetails\n-                }\n-                runtimeErrors={runtimeErrors}\n-                errorCount={totalErrorCount}\n-              />\n+                    <ErrorOverlay\n+                      state={state}\n+                      dispatch={dispatch}\n+                      getSquashedHydrationErrorDetails={\n+                        getSquashedHydrationErrorDetails\n+                      }\n+                      runtimeErrors={runtimeErrors}\n+                      errorCount={totalErrorCount}\n+                    />\n+                  </>\n+                ))}\n             </>\n           )\n         }}"
        },
        {
            "sha": "1440ab082ff8f57ab232ce449e1c1ecc3f61fa84",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=f9c9d033add718a40f515350fad7b5fc1538b17f",
            "patch": "@@ -38,6 +38,10 @@ export interface OverlayState {\n   disableDevIndicator: boolean\n   debugInfo: DebugInfo\n   routerType: 'pages' | 'app'\n+  /** This flag is used to handle the Error Overlay state in the \"old\" overlay.\n+   *  In the DevTools panel, this value will used for the \"Error Overlay Mode\"\n+   *  which is viewing the \"Issues Tab\" as a fullscreen.\n+   */\n   isErrorOverlayOpen: boolean\n   isDevToolsPanelOpen: boolean\n   devToolsPosition: Corners"
        },
        {
            "sha": "be8fa3eb44b485e2060ef9f549f80e919ab1bc02",
            "filename": "packages/next/src/next-devtools/dev-overlay/storybook/use-overlay-reducer.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f9c9d033add718a40f515350fad7b5fc1538b17f/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts?ref=f9c9d033add718a40f515350fad7b5fc1538b17f",
            "patch": "@@ -10,6 +10,7 @@ import {\n   ACTION_ERROR_OVERLAY_TOGGLE,\n   ACTION_DEVTOOLS_SCALE,\n   INITIAL_OVERLAY_STATE,\n+  ACTION_DEVTOOLS_PANEL_OPEN,\n } from '../shared'\n \n export const storybookDefaultOverlayState: OverlayState = {\n@@ -42,6 +43,9 @@ export function useStorybookOverlayReducer(initialState?: OverlayState) {\n         case ACTION_DEVTOOLS_PANEL_CLOSE: {\n           return { ...state, isDevToolsPanelOpen: false }\n         }\n+        case ACTION_DEVTOOLS_PANEL_OPEN: {\n+          return { ...state, isDevToolsPanelOpen: true }\n+        }\n         case ACTION_DEVTOOLS_POSITION: {\n           return { ...state, devToolsPosition: action.devToolsPosition }\n         }"
        }
    ],
    "stats": {
        "total": 108,
        "additions": 78,
        "deletions": 30
    }
}