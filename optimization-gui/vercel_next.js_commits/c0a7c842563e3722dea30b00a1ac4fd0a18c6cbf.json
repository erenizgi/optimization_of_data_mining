{
    "author": "ijjk",
    "message": "Add documentation for experimental adapters handling (#83737)\n\nThis adds initial documentation for the new adapter interface initially\noutlined in this RFC https://github.com/vercel/next.js/discussions/77740\n\n---------\n\nCo-authored-by: vercel[bot] <35613825+vercel[bot]@users.noreply.github.com>\nCo-authored-by: Zack Tanner <1939140+ztanner@users.noreply.github.com>",
    "sha": "c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf",
    "files": [
        {
            "sha": "75220ee1a6b64d3cacba979dbed6a85ca471e206",
            "filename": "docs/01-app/03-api-reference/05-config/01-next-config-js/adapterPath.mdx",
            "status": "added",
            "additions": 280,
            "deletions": 0,
            "changes": 280,
            "blob_url": "https://github.com/vercel/next.js/blob/c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FadapterPath.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FadapterPath.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FadapterPath.mdx?ref=c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf",
            "patch": "@@ -0,0 +1,280 @@\n+---\n+title: experimental.adapterPath\n+description: Configure a custom adapter for Next.js to hook into the build process with modifyConfig and onBuildComplete callbacks.\n+---\n+\n+Next.js provides an experimental API that allows you to create custom adapters to hook into the build process. This is useful for deployment platforms or custom build integrations that need to modify the Next.js configuration or process the build output.\n+\n+## Configuration\n+\n+To use an adapter, specify the path to your adapter module in `experimental.adapterPath`:\n+\n+```js filename=\"next.config.js\"\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  experimental: {\n+    adapterPath: require.resolve('./my-adapter.js'),\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+## Creating an Adapter\n+\n+An adapter is a module that exports an object implementing the `NextAdapter` interface:\n+\n+```typescript\n+export interface NextAdapter {\n+  name: string\n+  modifyConfig?: (\n+    config: NextConfigComplete,\n+    ctx: {\n+      phase: PHASE_TYPE\n+    }\n+  ) => Promise<NextConfigComplete> | NextConfigComplete\n+  onBuildComplete?: (ctx: {\n+    routes: {\n+      headers: Array<ManifestHeaderRoute>\n+      redirects: Array<ManifestRedirectRoute>\n+      rewrites: {\n+        beforeFiles: Array<ManifestRewriteRoute>\n+        afterFiles: Array<ManifestRewriteRoute>\n+        fallback: Array<ManifestRewriteRoute>\n+      }\n+      dynamicRoutes: ReadonlyArray<ManifestRoute>\n+    }\n+    outputs: AdapterOutputs\n+    projectDir: string\n+    repoRoot: string\n+    distDir: string\n+    config: NextConfigComplete\n+    nextVersion: string\n+  }) => Promise<void> | void\n+}\n+```\n+\n+### Basic Adapter Structure\n+\n+Here's a minimal adapter example:\n+\n+```js filename=\"my-adapter.js\"\n+/** @type {import('next').NextAdapter} */\n+const adapter = {\n+  name: 'my-custom-adapter',\n+\n+  async modifyConfig(config, { phase }) {\n+    // Modify the Next.js config based on the build phase\n+    if (phase === 'phase-production-build') {\n+      return {\n+        ...config,\n+        // Add your modifications\n+      }\n+    }\n+    return config\n+  },\n+\n+  async onBuildComplete({\n+    routes,\n+    outputs,\n+    projectDir,\n+    repoRoot,\n+    distDir,\n+    config,\n+    nextVersion,\n+  }) {\n+    // Process the build output\n+    console.log('Build completed with', outputs.pages.length, 'pages')\n+\n+    // Access different output types\n+    for (const page of outputs.pages) {\n+      console.log('Page:', page.pathname, 'at', page.filePath)\n+    }\n+\n+    for (const apiRoute of outputs.pagesApi) {\n+      console.log('API Route:', apiRoute.pathname, 'at', apiRoute.filePath)\n+    }\n+\n+    for (const appPage of outputs.appPages) {\n+      console.log('App Page:', appPage.pathname, 'at', appPage.filePath)\n+    }\n+\n+    for (const prerender of outputs.prerenders) {\n+      console.log('Prerendered:', prerender.pathname)\n+    }\n+  },\n+}\n+\n+module.exports = adapter\n+```\n+\n+## API Reference\n+\n+### `modifyConfig(config, context)`\n+\n+Called for any CLI command that loads the next.config to allow modification of the configuration.\n+\n+**Parameters:**\n+\n+- `config`: The complete Next.js configuration object\n+- `context.phase`: The current build phase (see [phases](/docs/app/api-reference/config/next-config-js#phase))\n+\n+**Returns:** The modified configuration object (can be async)\n+\n+### `onBuildComplete(context)`\n+\n+Called after the build process completes with detailed information about routes and outputs.\n+\n+**Parameters:**\n+\n+- `routes`: Object containing route manifests for headers, redirects, rewrites, and dynamic routes\n+- `outputs`: Detailed information about all build outputs organized by type\n+- `projectDir`: Absolute path to the Next.js project directory\n+- `repoRoot`: Absolute path to the detected repository root\n+- `distDir`: Absolute path to the build output directory\n+- `config`: The final Next.js configuration (with `modifyConfig` applied)\n+- `nextVersion`: Version of Next.js being used\n+\n+## Output Types\n+\n+The `outputs` object contains arrays of different output types:\n+\n+### Pages (`outputs.pages`)\n+\n+React pages from the `pages/` directory:\n+\n+```typescript\n+{\n+  type: 'PAGES'\n+  id: string           // Route identifier\n+  filePath: string     // Path to the built file\n+  pathname: string     // URL pathname\n+  runtime: 'nodejs' | 'edge'\n+  assets: Record<string, string>  // Traced dependencies\n+  config: {\n+    maxDuration?: number\n+    preferredRegion?: string | string[]\n+  }\n+}\n+```\n+\n+### API Routes (`outputs.pagesApi`)\n+\n+API routes from `pages/api/`:\n+\n+```typescript\n+{\n+  type: 'PAGES_API'\n+  id: string\n+  filePath: string\n+  pathname: string\n+  runtime: 'nodejs' | 'edge'\n+  assets: Record<string, string>\n+  config: {\n+    maxDuration?: number\n+    preferredRegion?: string | string[]\n+  }\n+}\n+```\n+\n+### App Pages (`outputs.appPages`)\n+\n+React pages from the `app/` directory with `page.{js,ts,jsx,tsx}`:\n+\n+```typescript\n+{\n+  type: 'APP_PAGE'\n+  id: string\n+  filePath: string\n+  pathname: string\n+  runtime: 'nodejs' | 'edge'\n+  assets: Record<string, string>\n+  config: {\n+    maxDuration?: number\n+    preferredRegion?: string | string[]\n+  }\n+}\n+```\n+\n+### App Routes (`outputs.appRoutes`)\n+\n+API and metadata routes from `app/` with `route.{js,ts,jsx,tsx}`:\n+\n+```typescript\n+{\n+  type: 'APP_ROUTE'\n+  // ... same structure as APP_PAGE\n+}\n+```\n+\n+### Prerenders (`outputs.prerenders`)\n+\n+ISR-enabled routes and static prerenders:\n+\n+```typescript\n+{\n+  type: 'PRERENDER'\n+  id: string\n+  pathname: string\n+  parentOutputId: string  // ID of the source page/route\n+  groupId: number        // Revalidation group identifier\n+  fallback?: {\n+    filePath: string\n+    initialStatus?: number\n+    initialHeaders?: Record<string, string | string[]>\n+    initialExpiration?: number\n+    initialRevalidate?: number\n+    postponedState?: string  // PPR postponed state\n+  }\n+  config: {\n+    allowQuery?: string[]     // Allowed query parameters\n+    allowHeader?: string[]    // Allowed headers for ISR\n+    bypassFor?: RouteHas[]    // Cache bypass conditions\n+    renderingMode?: RenderingMode\n+    bypassToken?: string\n+  }\n+}\n+```\n+\n+### Static Files (`outputs.staticFiles`)\n+\n+Static assets and auto-statically optimized pages:\n+\n+```typescript\n+{\n+  type: 'STATIC_FILE'\n+  id: string\n+  filePath: string\n+  pathname: string\n+}\n+```\n+\n+### Middleware (`outputs.middleware`)\n+\n+Middleware function (if present):\n+\n+```typescript\n+{\n+  type: 'MIDDLEWARE'\n+  id: string\n+  filePath: string\n+  pathname: string\n+  runtime: 'nodejs' | 'edge'\n+  assets: Record<string, string>\n+  config: {\n+    maxDuration?: number\n+    preferredRegion?: string | string[]\n+    matchers?: MiddlewareMatcher[]\n+  }\n+}\n+```\n+\n+## Use Cases\n+\n+Common use cases for adapters include:\n+\n+- **Deployment Platform Integration**: Automatically configure build outputs for specific hosting platforms\n+- **Asset Processing**: Transform or optimize build outputs\n+- **Monitoring Integration**: Collect build metrics and route information\n+- **Custom Bundling**: Package outputs in platform-specific formats\n+- **Build Validation**: Ensure outputs meet specific requirements"
        },
        {
            "sha": "f55e08a755a158c9c9e4a2bac6d8096b17498002",
            "filename": "docs/02-pages/04-api-reference/04-config/01-next-config-js/adapterPath.mdx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf/docs%2F02-pages%2F04-api-reference%2F04-config%2F01-next-config-js%2FadapterPath.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf/docs%2F02-pages%2F04-api-reference%2F04-config%2F01-next-config-js%2FadapterPath.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F02-pages%2F04-api-reference%2F04-config%2F01-next-config-js%2FadapterPath.mdx?ref=c0a7c842563e3722dea30b00a1ac4fd0a18c6cbf",
            "patch": "@@ -0,0 +1,7 @@\n+---\n+title: experimental.adapterPath\n+description: Configure a custom adapter for Next.js to hook into the build process with modifyConfig and buildComplete callbacks.\n+source: app/api-reference/config/next-config-js/adapterPath\n+---\n+\n+{/* DO NOT EDIT. The content of this doc is generated from the source above. To edit the content of this page, navigate to the source page in your editor. You can use the `<PagesOnly>Content</PagesOnly>` component to add content that is specific to the Pages Router. Any shared content should not be wrapped in a component. */}"
        }
    ],
    "stats": {
        "total": 287,
        "additions": 287,
        "deletions": 0
    }
}