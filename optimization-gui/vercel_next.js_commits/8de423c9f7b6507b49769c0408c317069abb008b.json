{
    "author": "remcohaszing",
    "message": "Fix types of @next/mdx (#82238)\n\n### What?\n\nThis fixes a couple of things:\n- Although itâ€™s rare for MDX plugins to accept more than 1 option, they\nmay accept any number of arguments.\n- In addition to `remarkPlugins` and `rehypePlugins`, now `recmaPlugins`\nis also patched to accept strings\n- TypeScript property Descriptions are preserved for patched values.\n\n### Why?\n\nBecause it is broken.\n\n### How?\n\nFixes #77297",
    "sha": "8de423c9f7b6507b49769c0408c317069abb008b",
    "files": [
        {
            "sha": "7a3f45c3f01699578a367149326728191a441738",
            "filename": "packages/next-mdx/index.d.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 15,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/8de423c9f7b6507b49769c0408c317069abb008b/packages%2Fnext-mdx%2Findex.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8de423c9f7b6507b49769c0408c317069abb008b/packages%2Fnext-mdx%2Findex.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-mdx%2Findex.d.ts?ref=8de423c9f7b6507b49769c0408c317069abb008b",
            "patch": "@@ -4,6 +4,8 @@ import type { RuleSetConditionAbsolute } from 'webpack'\n \n type WithMDX = (config: NextConfig) => NextConfig\n \n+type PluggableListName = 'remarkPlugins' | 'rehypePlugins' | 'recmaPlugins'\n+\n declare namespace nextMDX {\n   interface NextMDXOptions {\n     /**\n@@ -21,21 +23,16 @@ declare namespace nextMDX {\n      *\n      * @see https://mdxjs.com/packages/mdx/#api\n      */\n-    options?: Options & {\n-      remarkPlugins?:\n-        | (\n-            | string\n-            | [name: string, options: any]\n-            | NonNullable<Options['remarkPlugins']>[number]\n-          )[]\n-        | Options['remarkPlugins']\n-      rehypePlugins?:\n-        | (\n-            | string\n-            | [name: string, options: any]\n-            | NonNullable<Options['rehypePlugins']>[number]\n-          )[]\n-        | Options['rehypePlugins']\n+    options?: {\n+      [Key in keyof Options]: Key extends PluggableListName\n+        ?\n+            | (\n+                | string\n+                | [name: string, ...options: any[]]\n+                | NonNullable<Options[Key]>[number]\n+              )[]\n+            | Options[Key]\n+        : Options[Key]\n     }\n   }\n }"
        },
        {
            "sha": "f3b88a8418c62210cac642c0296bdbb29dea755a",
            "filename": "test/e2e/app-dir/mdx/app/recma-plugin/page.mdx",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fapp%2Frecma-plugin%2Fpage.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fapp%2Frecma-plugin%2Fpage.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx%2Fapp%2Frecma-plugin%2Fpage.mdx?ref=8de423c9f7b6507b49769c0408c317069abb008b",
            "patch": "@@ -0,0 +1,4 @@\n+# Recma plugin\n+\n+{/* eslint-disable-next-line no-undef, no-unused-expressions */}\n+{typeof filepath === 'undefined' ? null : filepath}"
        },
        {
            "sha": "19ab369aea2db3a89443dec13d194e1095e9bf2c",
            "filename": "test/e2e/app-dir/mdx/mdx.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fmdx.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fmdx.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx%2Fmdx.test.ts?ref=8de423c9f7b6507b49769c0408c317069abb008b",
            "patch": "@@ -8,6 +8,7 @@ for (const type of ['with-mdx-rs', 'without-mdx-rs']) {\n         '@next/mdx': 'canary',\n         '@mdx-js/loader': '^2.2.1',\n         '@mdx-js/react': '^2.2.1',\n+        'recma-export-filepath': '1.2.0',\n         'rehype-katex': '7.0.1',\n         'rehype-slug': '6.0.0',\n         'remark-gfm': '4.0.1',\n@@ -65,6 +66,13 @@ for (const type of ['with-mdx-rs', 'without-mdx-rs']) {\n       })\n \n       if (type === 'without-mdx-rs') {\n+        it('should run recma plugins', async () => {\n+          const $ = await next.render$('/recma-plugin')\n+          const html = $('html').html()\n+          expect(html.includes('recma-plugin/page.mdx')).toBe(true)\n+          expect($('#recma-plugin').text()).toBe('Recma plugin')\n+        })\n+\n         it('should run rehype plugins', async () => {\n           const $ = await next.render$('/rehype-plugin')\n           const html = $('html').html()"
        },
        {
            "sha": "b4a25271f17460776fb0eee762d8efa8e58819fa",
            "filename": "test/e2e/app-dir/mdx/next.config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8de423c9f7b6507b49769c0408c317069abb008b/test%2Fe2e%2Fapp-dir%2Fmdx%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx%2Fnext.config.ts?ref=8de423c9f7b6507b49769c0408c317069abb008b",
            "patch": "@@ -7,6 +7,7 @@ const withMDX = nextMDX({\n       'rehype-slug',\n       ['rehype-katex', { strict: true, throwOnError: true }],\n     ],\n+    recmaPlugins: ['recma-export-filepath'],\n   },\n })\n "
        }
    ],
    "stats": {
        "total": 40,
        "additions": 25,
        "deletions": 15
    }
}