{
    "author": "bgw",
    "message": "refactor(turbo-tasks): Use ResolvedVc for CollectiblesSource (#78392)\n\nThe `turbo_tasks::emit` function (https://turbopack-rust-docs.vercel.sh/rustdoc/turbo_tasks/fn.emit.html) already requires a `ResolvedVc`, so all of these values should be a `ResolvedVc`. That makes things easier for code consuming collectibles.\n\nCollectibles need some documentation, but they're how we emit diagnostics or collect file writes that are accumulated at the top-level. They're effectively tracked side-effects for a function.\n\nCollectibles are deduplicated. We need somewhat sane equality definitions, so we use `ResolvedVc` for that (we want to eventually remove the `Eq` definition on `Vc`, it doesn't behave as one might expect).",
    "sha": "9c32bc1598528cf023d04e7251a8551dff425986",
    "files": [
        {
            "sha": "5ceb47f391ab6ee7ddcfc9e30d5bcc388d32d14d",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/collectibles.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fcollectibles.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fcollectibles.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fcollectibles.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -9,7 +9,7 @@ use auto_hash_map::AutoSet;\n use rustc_hash::FxHashSet;\n use tokio::time::sleep;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{emit, CollectiblesSource, ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n+use turbo_tasks::{emit, CollectiblesSource, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_testing::{register, run, Registration};\n \n static REGISTRATION: Registration = register!();\n@@ -206,14 +206,7 @@ async fn my_transitive_emitting_function_collectibles(\n ) -> Result<Vc<Collectibles>> {\n     let result_op = my_transitive_emitting_function(key, key2);\n     Ok(Vc::cell(\n-        result_op\n-            .peek_collectibles::<Box<dyn ValueToString>>()\n-            .into_iter()\n-            .map(|v| v.to_resolved())\n-            .try_join()\n-            .await?\n-            .into_iter()\n-            .collect(),\n+        result_op.peek_collectibles::<Box<dyn ValueToString>>(),\n     ))\n }\n "
        },
        {
            "sha": "6fcb0f8846c8017efe9fb995811d7a2023fabc03",
            "filename": "turbopack/crates/turbo-tasks/src/collectibles.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcollectibles.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcollectibles.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fcollectibles.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -1,8 +1,9 @@\n use auto_hash_map::AutoSet;\n \n-use crate::{Vc, VcValueTrait};\n+use crate::{ResolvedVc, VcValueTrait};\n \n+/// Implemented on `OperationVc` and `RawVc`.\n pub trait CollectiblesSource {\n-    fn take_collectibles<T: VcValueTrait>(self) -> AutoSet<Vc<T>>;\n-    fn peek_collectibles<T: VcValueTrait>(self) -> AutoSet<Vc<T>>;\n+    fn take_collectibles<T: VcValueTrait>(self) -> AutoSet<ResolvedVc<T>>;\n+    fn peek_collectibles<T: VcValueTrait>(self) -> AutoSet<ResolvedVc<T>>;\n }"
        },
        {
            "sha": "73366238bfd199298fcc6a77e9bcbfab435494c9",
            "filename": "turbopack/crates/turbo-tasks/src/effect.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Feffect.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Feffect.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Feffect.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -14,7 +14,7 @@ use crate::{\n     manager::turbo_tasks_future_scope,\n     trace::TraceRawVcs,\n     util::SharedError,\n-    CollectiblesSource, NonLocalValue, ReadRef, ResolvedVc, TryJoinIterExt, Vc,\n+    CollectiblesSource, NonLocalValue, ReadRef, ResolvedVc, TryJoinIterExt,\n };\n \n /// A trait to emit a task effect as collectible. This trait only has one\n@@ -162,7 +162,7 @@ pub fn effect(future: impl Future<Output = Result<()>> + Send + Sync + 'static)\n /// apply_effects(operation).await?;\n /// ```\n pub async fn apply_effects(source: impl CollectiblesSource) -> Result<()> {\n-    let effects: AutoSet<Vc<Box<dyn Effect>>> = source.take_collectibles();\n+    let effects: AutoSet<ResolvedVc<Box<dyn Effect>>> = source.take_collectibles();\n     if effects.is_empty() {\n         return Ok(());\n     }\n@@ -171,8 +171,7 @@ pub async fn apply_effects(source: impl CollectiblesSource) -> Result<()> {\n         effects\n             .into_iter()\n             .map(async |effect| {\n-                let Some(effect) = Vc::try_resolve_downcast_type::<EffectInstance>(effect).await?\n-                else {\n+                let Some(effect) = ResolvedVc::try_downcast_type::<EffectInstance>(effect) else {\n                     panic!(\"Effect must only be implemented by EffectInstance\");\n                 };\n                 effect.await?.apply().await\n@@ -205,11 +204,11 @@ pub async fn apply_effects(source: impl CollectiblesSource) -> Result<()> {\n /// result_with_effects.effects.apply().await?;\n /// ```\n pub async fn get_effects(source: impl CollectiblesSource) -> Result<Effects> {\n-    let effects: AutoSet<Vc<Box<dyn Effect>>> = source.take_collectibles();\n+    let effects: AutoSet<ResolvedVc<Box<dyn Effect>>> = source.take_collectibles();\n     let effects = effects\n         .into_iter()\n         .map(|effect| async move {\n-            if let Some(effect) = Vc::try_resolve_downcast_type::<EffectInstance>(effect).await? {\n+            if let Some(effect) = ResolvedVc::try_downcast_type::<EffectInstance>(effect) {\n                 Ok(effect.await?)\n             } else {\n                 panic!(\"Effect must only be implemented by EffectInstance\");"
        },
        {
            "sha": "a6649ac1d85211f140eaf3a3b6a0cd1760aae090",
            "filename": "turbopack/crates/turbo-tasks/src/raw_vc.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -11,8 +11,8 @@ use crate::{\n     id::LocalTaskId,\n     manager::{read_local_output, read_task_cell, read_task_output, with_turbo_tasks},\n     registry::{self, get_value_type},\n-    turbo_tasks, CollectiblesSource, ReadCellOptions, ReadConsistency, TaskId, TraitTypeId,\n-    ValueType, ValueTypeId, Vc, VcValueTrait,\n+    turbo_tasks, CollectiblesSource, ReadCellOptions, ReadConsistency, ResolvedVc, TaskId,\n+    TraitTypeId, ValueType, ValueTypeId, VcValueTrait,\n };\n \n #[derive(Error, Debug)]\n@@ -44,10 +44,10 @@ impl Display for CellId {\n     }\n }\n \n-/// A type-erased representation of [`Vc`].\n+/// A type-erased representation of [`Vc`][crate::Vc].\n ///\n /// Type erasure reduces the [monomorphization] (and therefore binary size and compilation time)\n-/// required to support `Vc`.\n+/// required to support [`Vc`][crate::Vc].\n ///\n /// This type is heavily used within the [`Backend`][crate::backend::Backend] trait, but should\n /// otherwise be treated as an internal implementation detail of `turbo-tasks`.\n@@ -244,23 +244,26 @@ impl RawVc {\n     }\n }\n \n+/// This implementation of `CollectiblesSource` assumes that `self` is a `RawVc::TaskOutput`.\n impl CollectiblesSource for RawVc {\n-    fn peek_collectibles<T: VcValueTrait + ?Sized>(self) -> AutoSet<Vc<T>> {\n+    fn peek_collectibles<T: VcValueTrait + ?Sized>(self) -> AutoSet<ResolvedVc<T>> {\n+        debug_assert!(matches!(self, RawVc::TaskOutput(..)));\n         let tt = turbo_tasks();\n         tt.notify_scheduled_tasks();\n         let map = tt.read_task_collectibles(self.get_task_id(), T::get_trait_type_id());\n         map.into_iter()\n-            .filter_map(|(raw, count)| (count > 0).then_some(raw.into()))\n+            .filter_map(|(raw, count)| (count > 0).then_some(raw.try_into().unwrap()))\n             .collect()\n     }\n \n-    fn take_collectibles<T: VcValueTrait + ?Sized>(self) -> AutoSet<Vc<T>> {\n+    fn take_collectibles<T: VcValueTrait + ?Sized>(self) -> AutoSet<ResolvedVc<T>> {\n+        debug_assert!(matches!(self, RawVc::TaskOutput(..)));\n         let tt = turbo_tasks();\n         tt.notify_scheduled_tasks();\n         let map = tt.read_task_collectibles(self.get_task_id(), T::get_trait_type_id());\n         tt.unemit_collectibles(T::get_trait_type_id(), &map);\n         map.into_iter()\n-            .filter_map(|(raw, count)| (count > 0).then_some(raw.into()))\n+            .filter_map(|(raw, count)| (count > 0).then_some(raw.try_into().unwrap()))\n             .collect()\n     }\n }"
        },
        {
            "sha": "54a657a16fb8e9652f2cc4f571d3fd8cb8eb4fcd",
            "filename": "turbopack/crates/turbo-tasks/src/vc/operation.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 8,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -187,14 +187,19 @@ where\n     }\n }\n \n-impl<T> From<RawVc> for OperationVc<T>\n+impl<T> TryFrom<RawVc> for OperationVc<T>\n where\n     T: ?Sized,\n {\n-    fn from(raw: RawVc) -> Self {\n-        Self {\n-            node: Vc::from(raw),\n+    type Error = anyhow::Error;\n+\n+    fn try_from(raw: RawVc) -> Result<Self> {\n+        if !matches!(raw, RawVc::TaskOutput(..)) {\n+            anyhow::bail!(\"Given RawVc {raw:?} is not a TaskOutput\");\n         }\n+        Ok(Self {\n+            node: Vc::from(raw),\n+        })\n     }\n }\n \n@@ -231,17 +236,17 @@ impl<T> CollectiblesSource for OperationVc<T>\n where\n     T: ?Sized,\n {\n-    fn take_collectibles<Vt: VcValueTrait>(self) -> AutoSet<Vc<Vt>> {\n+    fn take_collectibles<Vt: VcValueTrait>(self) -> AutoSet<ResolvedVc<Vt>> {\n         self.node.node.take_collectibles()\n     }\n \n-    fn peek_collectibles<Vt: VcValueTrait>(self) -> AutoSet<Vc<Vt>> {\n+    fn peek_collectibles<Vt: VcValueTrait>(self) -> AutoSet<ResolvedVc<Vt>> {\n         self.node.node.peek_collectibles()\n     }\n }\n \n-/// Indicates that a type does not contain any instances of [`Vc`] or\n-/// [`ResolvedVc`][crate::ResolvedVc]. It may contain [`OperationVc`].\n+/// Indicates that a type does not contain any instances of [`Vc`] or [`ResolvedVc`]. It may contain\n+/// [`OperationVc`].\n ///\n /// # Safety\n ///"
        },
        {
            "sha": "a7546f77bc6c3e3d4a789c6aba6e6be0bcc2d22d",
            "filename": "turbopack/crates/turbo-tasks/src/vc/resolved.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -15,7 +15,7 @@ use crate::{\n     debug::{ValueDebug, ValueDebugFormat, ValueDebugFormatString},\n     trace::{TraceRawVcs, TraceRawVcsContext},\n     vc::Vc,\n-    Upcast, VcRead, VcTransparentRead, VcValueTrait, VcValueType,\n+    RawVc, Upcast, VcRead, VcTransparentRead, VcValueTrait, VcValueType,\n };\n \n /// A \"subtype\" (via [`Deref`]) of [`Vc`] that represents a specific [`Vc::cell`]/`.cell()` or\n@@ -318,3 +318,19 @@ where\n         self.node.value_debug_format(depth)\n     }\n }\n+\n+impl<T> TryFrom<RawVc> for ResolvedVc<T>\n+where\n+    T: ?Sized,\n+{\n+    type Error = anyhow::Error;\n+\n+    fn try_from(raw: RawVc) -> Result<Self> {\n+        if !matches!(raw, RawVc::TaskCell(..)) {\n+            anyhow::bail!(\"Given RawVc {raw:?} is not a TaskCell\");\n+        }\n+        Ok(Self {\n+            node: Vc::from(raw),\n+        })\n+    }\n+}"
        },
        {
            "sha": "7eba3bc9e52275935a7f5f3a33789b9bd92d8045",
            "filename": "turbopack/crates/turbopack-core/src/diagnostics/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 10,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -2,8 +2,9 @@ use std::cmp::Ordering;\n \n use anyhow::Result;\n use async_trait::async_trait;\n+use auto_hash_map::AutoSet;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{emit, CollectiblesSource, FxIndexMap, ResolvedVc, TryJoinIterExt, Upcast, Vc};\n+use turbo_tasks::{emit, CollectiblesSource, FxIndexMap, ResolvedVc, Upcast, Vc};\n \n #[turbo_tasks::value(serialization = \"none\")]\n #[derive(Clone, Debug)]\n@@ -101,14 +102,7 @@ where\n {\n     async fn peek_diagnostics(self) -> Result<CapturedDiagnostics> {\n         Ok(CapturedDiagnostics {\n-            diagnostics: self\n-                .peek_collectibles()\n-                .into_iter()\n-                .map(|v: Vc<Box<dyn Diagnostic>>| v.to_resolved())\n-                .try_join()\n-                .await?\n-                .into_iter()\n-                .collect(),\n+            diagnostics: self.peek_collectibles(),\n         })\n     }\n }\n@@ -118,5 +112,5 @@ where\n #[derive(Debug)]\n #[turbo_tasks::value]\n pub struct CapturedDiagnostics {\n-    pub diagnostics: auto_hash_map::AutoSet<ResolvedVc<Box<dyn Diagnostic>>>,\n+    pub diagnostics: AutoSet<ResolvedVc<Box<dyn Diagnostic>>>,\n }"
        },
        {
            "sha": "5385d7d9be5dcf22bf923f72574c74b3635ac38c",
            "filename": "turbopack/crates/turbopack-core/src/issue/mod.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 44,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -904,13 +904,7 @@ where\n                                 description: ResolvedVc::cell(RcStr::from(description.into())),\n                             },\n                         )),\n-                        children\n-                            .into_iter()\n-                            .map(|v: Vc<Box<dyn IssueProcessingPath>>| v.to_resolved())\n-                            .try_join()\n-                            .await?\n-                            .into_iter()\n-                            .collect(),\n+                        children,\n                     )),\n                 ));\n             }\n@@ -943,13 +937,7 @@ where\n                                 description: ResolvedVc::cell(RcStr::from(description.into())),\n                             },\n                         )),\n-                        children\n-                            .into_iter()\n-                            .map(|v: Vc<Box<dyn IssueProcessingPath>>| v.to_resolved())\n-                            .try_join()\n-                            .await?\n-                            .into_iter()\n-                            .collect(),\n+                        children,\n                     )),\n                 ));\n             }\n@@ -967,48 +955,22 @@ where\n \n     async fn peek_issues_with_path(self) -> Result<CapturedIssues> {\n         Ok(CapturedIssues {\n-            issues: self\n-                .peek_collectibles()\n-                .into_iter()\n-                .map(|v: Vc<Box<dyn Issue>>| v.to_resolved())\n-                .try_join()\n-                .await?\n-                .into_iter()\n-                .collect(),\n+            issues: self.peek_collectibles(),\n             #[cfg(feature = \"issue_path\")]\n             processing_path: ItemIssueProcessingPath::resolved_cell(ItemIssueProcessingPath(\n                 None,\n-                self.peek_collectibles()\n-                    .into_iter()\n-                    .map(|v: Vc<Box<dyn IssueProcessingPath>>| v.to_resolved())\n-                    .try_join()\n-                    .await?\n-                    .into_iter()\n-                    .collect(),\n+                self.peek_collectibles(),\n             )),\n         })\n     }\n \n     async fn take_issues_with_path(self) -> Result<CapturedIssues> {\n         Ok(CapturedIssues {\n-            issues: self\n-                .take_collectibles()\n-                .into_iter()\n-                .map(|v: Vc<Box<dyn Issue>>| v.to_resolved())\n-                .try_join()\n-                .await?\n-                .into_iter()\n-                .collect(),\n+            issues: self.take_collectibles(),\n             #[cfg(feature = \"issue_path\")]\n             processing_path: ItemIssueProcessingPath::resolved_cell(ItemIssueProcessingPath(\n                 None,\n-                self.take_collectibles()\n-                    .into_iter()\n-                    .map(|v: Vc<Box<dyn IssueProcessingPath>>| v.to_resolved())\n-                    .try_join()\n-                    .await?\n-                    .into_iter()\n-                    .collect(),\n+                self.take_collectibles(),\n             )),\n         })\n     }"
        },
        {
            "sha": "6760c8ed6d25875f25c8d33d545a28415e96e386",
            "filename": "turbopack/crates/turbopack-dev-server/src/http.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c32bc1598528cf023d04e7251a8551dff425986/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs?ref=9c32bc1598528cf023d04e7251a8551dff425986",
            "patch": "@@ -9,8 +9,8 @@ use hyper::{\n use mime::Mime;\n use tokio_util::io::{ReaderStream, StreamReader};\n use turbo_tasks::{\n-    apply_effects, util::SharedError, CollectiblesSource, OperationVc, ReadRef, TransientInstance,\n-    Vc,\n+    apply_effects, util::SharedError, CollectiblesSource, OperationVc, ReadRef, ResolvedVc,\n+    TransientInstance, Vc,\n };\n use turbo_tasks_bytes::Bytes;\n use turbo_tasks_fs::FileContent;\n@@ -77,14 +77,15 @@ pub async fn process_request_with_content_source(\n     issue_reporter: Vc<Box<dyn IssueReporter>>,\n ) -> Result<(\n     Response<hyper::Body>,\n-    AutoSet<Vc<Box<dyn ContentSourceSideEffect>>>,\n+    AutoSet<ResolvedVc<Box<dyn ContentSourceSideEffect>>>,\n )> {\n     let original_path = request.uri().path().to_string();\n     let request = http_request_to_source_request(request).await?;\n     let result_op = get_from_source_operation(source, TransientInstance::new(request));\n     let resolved_result = result_op.resolve_strongly_consistent().await?;\n     apply_effects(result_op).await?;\n-    let side_effects: AutoSet<Vc<Box<dyn ContentSourceSideEffect>>> = result_op.peek_collectibles();\n+    let side_effects: AutoSet<ResolvedVc<Box<dyn ContentSourceSideEffect>>> =\n+        result_op.peek_collectibles();\n     handle_issues(\n         result_op,\n         issue_reporter,"
        }
    ],
    "stats": {
        "total": 160,
        "additions": 67,
        "deletions": 93
    }
}