{
    "author": "sokra",
    "message": "Turbopack: add track_caller to improve panics (#85565)\n\n### What?\n\nHelps finding Item does not exist or access type errors",
    "sha": "b8a14cd8f9b1abd8e4f7abb35c0e7d9e1b6d3af5",
    "files": [
        {
            "sha": "985b01d360fdfc96f61cef7519bd8e6a01681ae6",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/mod.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/b8a14cd8f9b1abd8e4f7abb35c0e7d9e1b6d3af5/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b8a14cd8f9b1abd8e4f7abb35c0e7d9e1b6d3af5/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs?ref=b8a14cd8f9b1abd8e4f7abb35c0e7d9e1b6d3af5",
            "patch": "@@ -382,6 +382,7 @@ impl<B: BackingStorage> TaskGuardImpl<'_, B> {\n     /// Verify that the task guard restored the correct category\n     /// before accessing the data.\n     #[inline]\n+    #[track_caller]\n     fn check_access(&self, category: TaskDataCategory) {\n         {\n             match category {\n@@ -434,6 +435,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task_id\n     }\n \n+    #[track_caller]\n     fn add(&mut self, item: CachedDataItem) -> bool {\n         let category = item.category();\n         self.check_access(category);\n@@ -446,12 +448,14 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.add(item)\n     }\n \n+    #[track_caller]\n     fn add_new(&mut self, item: CachedDataItem) {\n         self.check_access(item.category());\n         let added = self.add(item);\n         assert!(added, \"Item already exists\");\n     }\n \n+    #[track_caller]\n     fn insert(&mut self, item: CachedDataItem) -> Option<CachedDataItemValue> {\n         let category = item.category();\n         self.check_access(category);\n@@ -461,6 +465,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.insert(item)\n     }\n \n+    #[track_caller]\n     fn update(\n         &mut self,\n         key: CachedDataItemKey,\n@@ -474,6 +479,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.update(key, update);\n     }\n \n+    #[track_caller]\n     fn remove(&mut self, key: &CachedDataItemKey) -> Option<CachedDataItemValue> {\n         let category = key.category();\n         self.check_access(category);\n@@ -488,6 +494,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.get(key)\n     }\n \n+    #[track_caller]\n     fn get_mut(&mut self, key: &CachedDataItemKey) -> Option<CachedDataItemValueRefMut<'_>> {\n         let category = key.category();\n         self.check_access(category);\n@@ -497,6 +504,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.get_mut(key)\n     }\n \n+    #[track_caller]\n     fn get_mut_or_insert_with(\n         &mut self,\n         key: CachedDataItemKey,\n@@ -510,11 +518,13 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.get_mut_or_insert_with(key, insert)\n     }\n \n+    #[track_caller]\n     fn has_key(&self, key: &CachedDataItemKey) -> bool {\n         self.check_access(key.category());\n         self.task.contains_key(key)\n     }\n \n+    #[track_caller]\n     fn count(&self, ty: CachedDataItemType) -> usize {\n         self.check_access(ty.category());\n         self.task.count(ty)\n@@ -532,6 +542,7 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task.shrink_to_fit(ty)\n     }\n \n+    #[track_caller]\n     fn extract_if<'l, F>(\n         &'l mut self,\n         ty: CachedDataItemType,"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}