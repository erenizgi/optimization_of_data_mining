{
    "author": "wbinnssmith",
    "message": "Turbopack: Include Next.js version in panic handler report (#78263)",
    "sha": "bd3911083f30932fcfcf3d9b066344d45e99a29e",
    "files": [
        {
            "sha": "1d2fdce543549e20a293b11fa16ea94488a9944c",
            "filename": "crates/napi/build.rs",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/bd3911083f30932fcfcf3d9b066344d45e99a29e/crates%2Fnapi%2Fbuild.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bd3911083f30932fcfcf3d9b066344d45e99a29e/crates%2Fnapi%2Fbuild.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fbuild.rs?ref=bd3911083f30932fcfcf3d9b066344d45e99a29e",
            "patch": "@@ -1,11 +1,32 @@\n-use std::{env, process::Command, str};\n+use std::{env, fs, path::Path, process::Command, str};\n+\n+use serde_json::Value;\n \n extern crate napi_build;\n \n fn main() -> anyhow::Result<()> {\n     println!(\"cargo:rerun-if-env-changed=CI\");\n     let is_ci = env::var(\"CI\").is_ok_and(|value| !value.is_empty());\n \n+    let nextjs_version = {\n+        let package_json_path = Path::new(env!(\"CARGO_MANIFEST_DIR\"))\n+            .join(\"../..\")\n+            .join(\"packages/next/package.json\");\n+\n+        println!(\"cargo:rerun-if-changed={}\", package_json_path.display());\n+\n+        let package_json_content = fs::read_to_string(&package_json_path)?;\n+        let package_json: Value = serde_json::from_str(&package_json_content)?;\n+\n+        package_json[\"version\"]\n+            .as_str()\n+            .expect(\"Expected a Next.js `version` string in its package.json\")\n+            .to_string()\n+    };\n+\n+    // Make the Next.js version available as a build-time environment variable\n+    println!(\"cargo:rustc-env=NEXTJS_VERSION={}\", nextjs_version);\n+\n     // Generates, stores build-time information as static values.\n     // There are some places relying on correct values for this (i.e telemetry),\n     // So failing build if this fails."
        },
        {
            "sha": "28b22a9e5bd6a00ae6534aa624e53b56fbaa061f",
            "filename": "crates/napi/src/util.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bd3911083f30932fcfcf3d9b066344d45e99a29e/crates%2Fnapi%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bd3911083f30932fcfcf3d9b066344d45e99a29e/crates%2Fnapi%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Futil.rs?ref=bd3911083f30932fcfcf3d9b066344d45e99a29e",
            "patch": "@@ -131,7 +131,11 @@ pub fn log_internal_error_and_inform(internal_error: &anyhow::Error) {\n         \"Turbopack Error: {}\",\n         internal_error_str.lines().next().unwrap_or(\"Unknown\")\n     );\n-    let version_str = format!(\"Turbopack version: `{}`\", env!(\"VERGEN_GIT_DESCRIBE\"));\n+    let version_str = format!(\n+        \"Turbopack version: `{}`\\nNext.js version: `{}`\",\n+        env!(\"VERGEN_GIT_DESCRIBE\"),\n+        env!(\"NEXTJS_VERSION\")\n+    );\n     let new_discussion_url = if supports_hyperlinks::supports_hyperlinks() {\n         \"clicking here.\".hyperlink(\n             format!("
        }
    ],
    "stats": {
        "total": 29,
        "additions": 27,
        "deletions": 2
    }
}