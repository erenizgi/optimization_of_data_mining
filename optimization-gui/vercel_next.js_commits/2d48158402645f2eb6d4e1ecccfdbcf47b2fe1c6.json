{
    "author": "timneutkens",
    "message": "Turbopack build: Fix NODE_ENV test (#79377)\n\n## What?\n\nThis test was checking for an arbitrary value, it wasn't clear to me why\nthis particular value given it's not in the source code.\n\nI've changed it to an application-level check instead of checking the\nNext.js internals.",
    "sha": "2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6",
    "files": [
        {
            "sha": "b31d343d50c2e242e4a0fc0964f97f26c78995bb",
            "filename": "test/integration/non-standard-node-env-warning/pages/index.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fintegration%2Fnon-standard-node-env-warning%2Fpages%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fintegration%2Fnon-standard-node-env-warning%2Fpages%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnon-standard-node-env-warning%2Fpages%2Findex.js?ref=2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6",
            "patch": "@@ -1 +1,7 @@\n-export default () => 'hi'\n+export default function Page() {\n+  if (process.env.NODE_ENV === 'production') {\n+    return <h1>Hello Production</h1>\n+  } else {\n+    return <h1>Hello Other</h1>\n+  }\n+}"
        },
        {
            "sha": "f39da2498ac9cf31d37223fb7a095b50a7fbc06f",
            "filename": "test/integration/non-standard-node-env-warning/test/index.test.js",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fintegration%2Fnon-standard-node-env-warning%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fintegration%2Fnon-standard-node-env-warning%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnon-standard-node-env-warning%2Ftest%2Findex.test.js?ref=2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6",
            "patch": "@@ -94,15 +94,24 @@ describe('Non-Standard NODE_ENV', () => {\n         })\n         expect(staticFiles.length).toBeGreaterThan(0)\n \n+        let foundProductionValue = false\n+        let foundOtherValue = false\n         for (const file of staticFiles) {\n           const content = await fs.readFile(\n             join(appDir, '.next/static', file),\n             'utf8'\n           )\n-          if (content.match(/cannot find module(?! for page)/i)) {\n-            throw new Error(`${file} contains module not found error`)\n+\n+          if (content.includes('Hello Production')) {\n+            foundProductionValue = true\n+          }\n+          if (content.includes('Hello Other')) {\n+            foundOtherValue = true\n           }\n         }\n+\n+        expect(foundProductionValue).toBeTrue()\n+        expect(foundOtherValue).toBeFalse()\n       })\n \n       it('should show the warning with NODE_ENV set to development with next build', async () => {"
        },
        {
            "sha": "f422c31c03ca4dce126475af9795a6beb2bfec84",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=2d48158402645f2eb6d4e1ecccfdbcf47b2fe1c6",
            "patch": "@@ -16649,11 +16649,10 @@\n       \"Non-Standard NODE_ENV should not show the warning with no NODE_ENV set\",\n       \"Non-Standard NODE_ENV should show the warning with NODE_ENV set to invalid value\",\n       \"Non-Standard NODE_ENV should show the warning with NODE_ENV set to invalid value (custom server)\",\n-      \"Non-Standard NODE_ENV should show the warning with NODE_ENV set to production with next dev\"\n-    ],\n-    \"failed\": [\n+      \"Non-Standard NODE_ENV should show the warning with NODE_ENV set to production with next dev\",\n       \"Non-Standard NODE_ENV production mode should still DCE NODE_ENV specific code\"\n     ],\n+    \"failed\": [],\n     \"pending\": [],\n     \"flakey\": [],\n     \"runtimeError\": false"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 20,
        "deletions": 6
    }
}