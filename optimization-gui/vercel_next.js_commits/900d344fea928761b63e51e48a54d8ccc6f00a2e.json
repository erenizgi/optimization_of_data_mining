{
    "author": "huozhi",
    "message": "[metadata] not add suffix to sitemap.xml in group routes (#83486)",
    "sha": "900d344fea928761b63e51e48a54d8ccc6f00a2e",
    "files": [
        {
            "sha": "6274a7d9d5aa49f95023325ebf6820c520076bf5",
            "filename": "crates/next-core/src/next_app/metadata/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/900d344fea928761b63e51e48a54d8ccc6f00a2e/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/900d344fea928761b63e51e48a54d8ccc6f00a2e/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fmod.rs?ref=900d344fea928761b63e51e48a54d8ccc6f00a2e",
            "patch": "@@ -302,7 +302,7 @@ fn format_radix(mut x: u32, radix: u32) -> String {\n /// /(post)/sitemap -> /sitemap\n fn get_metadata_route_suffix(page: &str) -> Option<String> {\n     // skip sitemap\n-    if page.ends_with(\"/sitemap\") {\n+    if page.ends_with(\"/sitemap\") || page.ends_with(\"/sitemap.xml\") {\n         return None;\n     }\n "
        },
        {
            "sha": "7dda73c6d313e42f8e6670734ea699d9d6b9f636",
            "filename": "packages/next/src/lib/metadata/get-metadata-route.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/900d344fea928761b63e51e48a54d8ccc6f00a2e/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fget-metadata-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/900d344fea928761b63e51e48a54d8ccc6f00a2e/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fget-metadata-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fget-metadata-route.ts?ref=900d344fea928761b63e51e48a54d8ccc6f00a2e",
            "patch": "@@ -31,7 +31,7 @@ function getMetadataRouteSuffix(page: string) {\n   // e.g. /parent/opengraph-image -> /parent\n   const parentPathname = path.dirname(page)\n   // Only apply suffix to metadata routes except for sitemaps\n-  if (page.endsWith('/sitemap')) {\n+  if (page.endsWith('/sitemap') || page.endsWith('/sitemap.xml')) {\n     return ''\n   }\n "
        },
        {
            "sha": "9d2b2deade0c47e7796073578650da42b0abb3e2",
            "filename": "test/e2e/app-dir/sitemap-group/app/(group)/bar/sitemap.xml",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/900d344fea928761b63e51e48a54d8ccc6f00a2e/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fapp%2F(group)%2Fbar%2Fsitemap.xml",
            "raw_url": "https://github.com/vercel/next.js/raw/900d344fea928761b63e51e48a54d8ccc6f00a2e/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fapp%2F(group)%2Fbar%2Fsitemap.xml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fapp%2F(group)%2Fbar%2Fsitemap.xml?ref=900d344fea928761b63e51e48a54d8ccc6f00a2e",
            "patch": "@@ -0,0 +1,7 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+  <url>\n+    <loc>https://vercel.com/</loc>\n+    <lastmod>2023-03-06T18:04:14.008Z</lastmod>\n+  </url>\n+</urlset>"
        },
        {
            "sha": "e08c7c9dc22b18597fbef6aa29a1095ae48f916e",
            "filename": "test/e2e/app-dir/sitemap-group/sitemap-group.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/900d344fea928761b63e51e48a54d8ccc6f00a2e/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fsitemap-group.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/900d344fea928761b63e51e48a54d8ccc6f00a2e/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fsitemap-group.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsitemap-group%2Fsitemap-group.test.ts?ref=900d344fea928761b63e51e48a54d8ccc6f00a2e",
            "patch": "@@ -22,4 +22,21 @@ describe('sitemap-group', () => {\n       \"\n     `)\n   })\n+\n+  it('should not add suffix to static sitemap.xml under group routes', async () => {\n+    const res = await next.fetch('/bar/sitemap.xml')\n+    expect(res.status).toBe(200)\n+    expect(res.headers.get('content-type')).toBe('application/xml')\n+    const text = await res.text()\n+    expect(text).toMatchInlineSnapshot(`\n+      \"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+      <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+        <url>\n+          <loc>https://vercel.com/</loc>\n+          <lastmod>2023-03-06T18:04:14.008Z</lastmod>\n+        </url>\n+      </urlset>\n+      \"\n+    `)\n+  })\n })"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 26,
        "deletions": 2
    }
}