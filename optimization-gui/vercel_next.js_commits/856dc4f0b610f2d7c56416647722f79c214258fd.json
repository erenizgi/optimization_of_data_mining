{
    "author": "ijjk",
    "message": "Update parallel routes in build-complete (#85546)\n\nThis fixes parallel routes being considered separate outputs with the\nsame pathname in the adapters build-complete hook and instead merges\nthem into the same output combining the necessary outputs.",
    "sha": "856dc4f0b610f2d7c56416647722f79c214258fd",
    "files": [
        {
            "sha": "e3d77bf2cfd47b913648c8f49ff3ac3aecb40ecd",
            "filename": "packages/next/src/build/adapter/build-complete.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -966,6 +966,18 @@ export async function handleBuildComplete({\n               return {} as Record<string, string>\n             }\n           )\n+\n+          // If this is a parallel route we just need to merge\n+          // the assets as they share the same pathname\n+          const existingOutput = appOutputMap[normalizedPage]\n+          if (existingOutput) {\n+            Object.assign(existingOutput.assets, assets)\n+            existingOutput.assets[path.relative(tracingRoot, pageFile)] =\n+              pageFile\n+\n+            continue\n+          }\n+\n           const functionConfig =\n             functionsConfigManifest.functions[normalizedPage] || {}\n "
        },
        {
            "sha": "efe0d87374080062ab470a41c697075e909138e5",
            "filename": "test/production/adapter-config/adapter-config-export.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fadapter-config-export.test.ts?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -23,6 +23,9 @@ describe('adapter-config export', () => {\n       'pages/api/node-pages.ts',\n       'pages/edge-pages/index.tsx',\n       'pages/node-pages/index.tsx',\n+      'app/node-app/[slug]/page.tsx',\n+      'app/node-app/@dialog/default.tsx',\n+      'app/node-app/@dialog/[slug]/page.tsx',\n     ]\n \n     for (const file of nonExportFiles) {"
        },
        {
            "sha": "ef1b249cc1847b8048f1180448cf9115fa49e0d7",
            "filename": "test/production/adapter-config/app/node-app/@dialog/[slug]/page.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2F%5Bslug%5D%2Fpage.tsx?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Page() {\n+  return (\n+    <>\n+      <p>@dialog parallel route for /node-app/[slug]</p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "31f55b1a9cf6cbce535ec394718be43043730db3",
            "filename": "test/production/adapter-config/app/node-app/@dialog/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%40dialog%2Fdefault.tsx?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default dialog'\n+}"
        },
        {
            "sha": "79b2a33b9cedc2b2fd445867a1e40b76574757fd",
            "filename": "test/production/adapter-config/app/node-app/[slug]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2F%5Bslug%5D%2Fpage.tsx?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <>/node-app/[slug]</>\n+}"
        },
        {
            "sha": "3a879d55332f39a4e846342299efa26d37b404c6",
            "filename": "test/production/adapter-config/app/node-app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fapp%2Fnode-app%2Flayout.tsx?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ dialog, children }: any) {\n+  return (\n+    <>\n+      {dialog}\n+      {children}\n+    </>\n+  )\n+}"
        },
        {
            "sha": "212cc5af9fa0c4beb33610dcbfa6e678ca8468e4",
            "filename": "test/production/adapter-config/my-adapter.mjs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fmy-adapter.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/856dc4f0b610f2d7c56416647722f79c214258fd/test%2Fproduction%2Fadapter-config%2Fmy-adapter.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fmy-adapter.mjs?ref=856dc4f0b610f2d7c56416647722f79c214258fd",
            "patch": "@@ -5,6 +5,7 @@ import fs from 'fs'\n const myAdapter = {\n   name: 'my-custom-adapter',\n   modifyConfig: (config, { phase }) => {\n+    if (process.env.NODE_ENV !== 'production') return config\n     if (typeof phase !== 'string') {\n       throw new Error(`invalid phase value provided to modifyConfig ${phase}`)\n     }"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 37,
        "deletions": 0
    }
}