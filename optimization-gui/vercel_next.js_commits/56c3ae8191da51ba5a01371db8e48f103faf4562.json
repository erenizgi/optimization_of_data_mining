{
    "author": "devjiwonchoi",
    "message": "[release] notify release status via slack (#79409)\n\nThis PR adds a step to send Slack notifications of the status of the\nrelease.\n\n---------\n\nCo-authored-by: Sebastian \"Sebbie\" Silbermann <sebastian.silbermann@vercel.com>",
    "sha": "56c3ae8191da51ba5a01371db8e48f103faf4562",
    "files": [
        {
            "sha": "25fe71d53975374715c44164358a67ea521ae541",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/56c3ae8191da51ba5a01371db8e48f103faf4562/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/56c3ae8191da51ba5a01371db8e48f103faf4562/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=56c3ae8191da51ba5a01371db8e48f103faf4562",
            "patch": "@@ -618,7 +618,15 @@ jobs:\n         if: steps.changesets.outputs.pullRequestNumber\n         run: 'gh pr edit ${{ steps.changesets.outputs.pullRequestNumber }} --add-label \"created-by: CI\"'\n         env:\n-          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }\n+\n+      - name: Send a Slack notification of the publish status\n+        run: pnpm tsx scripts/release/slack.ts\n+        env:\n+          SLACK_TOKEN: ${{ secrets.SLACK_TOKEN }}\n+          RELEASE_STATUS: ${{ steps.changesets.outputs.published }}\n+          WORKFLOW_LINK: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\n+          WORKFLOW_ACTOR: ${{ github.actor }}\n \n       - name: Upload npm log artifact\n         if: steps.changesets.outputs.published == 'true'"
        },
        {
            "sha": "c4fe2f0a2224065f2a5030d4096d5e6bc634d8a5",
            "filename": "package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/56c3ae8191da51ba5a01371db8e48f103faf4562/package.json",
            "raw_url": "https://github.com/vercel/next.js/raw/56c3ae8191da51ba5a01371db8e48f103faf4562/package.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/package.json?ref=56c3ae8191da51ba5a01371db8e48f103faf4562",
            "patch": "@@ -118,6 +118,7 @@\n     \"@picocss/pico\": \"1.5.10\",\n     \"@rspack/core\": \"1.3.9\",\n     \"@rspack/plugin-react-refresh\": \"1.2.0\",\n+    \"@slack/web-api\": \"7.9.1\",\n     \"@swc/cli\": \"0.1.55\",\n     \"@swc/core\": \"1.11.24\",\n     \"@swc/helpers\": \"0.5.15\","
        },
        {
            "sha": "6a981bb3900f065d66057ad95fbe85bac8f9a5ef",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/56c3ae8191da51ba5a01371db8e48f103faf4562/pnpm-lock.yaml",
            "raw_url": "https://github.com/vercel/next.js/raw/56c3ae8191da51ba5a01371db8e48f103faf4562/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/pnpm-lock.yaml?ref=56c3ae8191da51ba5a01371db8e48f103faf4562",
            "patch": "@@ -136,6 +136,9 @@ importers:\n       '@rspack/plugin-react-refresh':\n         specifier: 1.2.0\n         version: 1.2.0(react-refresh@0.12.0)(webpack-hot-middleware@2.26.1)\n+      '@slack/web-api':\n+        specifier: 7.9.1\n+        version: 7.9.1\n       '@swc/cli':\n         specifier: 0.1.55\n         version: 0.1.55(@swc/core@1.11.24(@swc/helpers@0.5.15))(chokidar@3.6.0)\n@@ -4930,6 +4933,18 @@ packages:\n     resolution: {integrity: sha512-OPwQlEdg40HAj5KNF8WW6q2KG4Z+cBCZb3m4ninfTZKaBmbIJodviQsDBoYMPHkOyJJMHnOJo5j2+LKDOhOACg==}\n     deprecated: Use version 10.1.0. Version 10.2.0 has potential breaking issues\n \n+  '@slack/logger@4.0.0':\n+    resolution: {integrity: sha512-Wz7QYfPAlG/DR+DfABddUZeNgoeY7d1J39OCR2jR+v7VBsB8ezulDK5szTnDDPDwLH5IWhLvXIHlCFZV7MSKgA==}\n+    engines: {node: '>= 18', npm: '>= 8.6.0'}\n+\n+  '@slack/types@2.14.0':\n+    resolution: {integrity: sha512-n0EGm7ENQRxlXbgKSrQZL69grzg1gHLAVd+GlRVQJ1NSORo0FrApR7wql/gaKdu2n4TO83Sq/AmeUOqD60aXUA==}\n+    engines: {node: '>= 12.13.0', npm: '>= 6.12.0'}\n+\n+  '@slack/web-api@7.9.1':\n+    resolution: {integrity: sha512-qMcb1oWw3Y/KlUIVJhkI8+NcQXq1lNymwf+ewk93ggZsGd6iuz9ObQsOEbvlqlx1J+wd8DmIm3DORGKs0fcKdg==}\n+    engines: {node: '>= 18', npm: '>= 8.6.0'}\n+\n   '@storybook/addon-a11y@8.6.0':\n     resolution: {integrity: sha512-iIHO3GWt/PkO8BbYgzI/LYEK5JYvG31bCRka0XBk71PfZ5nrMGapVrUNH3PchO8G48HEb4ZpFiEOlV3WjCFYuw==}\n     peerDependencies:\n@@ -6530,6 +6545,9 @@ packages:\n   axios@1.7.9:\n     resolution: {integrity: sha512-LhLcE7Hbiryz8oMDdDptSrWowmB4Bl6RCt6sIJKpRB4XtVf0iEgewX3au/pJqm+Py1kCASkb/FFKjxQaLtxJvw==}\n \n+  axios@1.9.0:\n+    resolution: {integrity: sha512-re4CqKTJaURpzbLHtIi6XpDv20/CnpXOtjRY5/CU32L8gU8ek9UIivcfvSWvmKEngmVbrUtPpdDwWDWL7DNHvg==}\n+\n   axobject-query@4.1.0:\n     resolution: {integrity: sha512-qIj0G9wZbMGNLjLmg1PT6v2mE9AH2zlnADJD/2tC6E00hgmhUOfEB6greHPAfLRSufHqROIUTkw6E+M3lH0PTQ==}\n     engines: {node: '>= 0.4'}\n@@ -10244,6 +10262,9 @@ packages:\n     engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}\n     hasBin: true\n \n+  is-electron@2.2.2:\n+    resolution: {integrity: sha512-FO/Rhvz5tuw4MCWkpMzHFKWD2LsfHzIb7i6MdPYZ/KW7AlxawyLkqdy+jPZP1WubqEADE3O4FUENlJHDfQASRg==}\n+\n   is-empty@1.2.0:\n     resolution: {integrity: sha512-F2FnH/otLNJv0J6wc73A5Xo7oHLNnqplYqZhUu01tD54DIPvxIRSTSLkrUB/M0nHO4vo1O9PDfN4KoTxCzLh/w==}\n \n@@ -12570,6 +12591,10 @@ packages:\n     resolution: {integrity: sha512-2USApvnsutq8uoxZBGbbWM0JIYLiEMJ9RlaN7fAzVNb9OZN0SHjjTTfIcb667XynS5Y1VhwDJVDa72TnPzAYWw==}\n     engines: {node: '>=8'}\n \n+  p-retry@4.6.2:\n+    resolution: {integrity: sha512-312Id396EbJdvRONlngUx0NydfrIQ5lsYu0znKVUzVvArzEIt08V1qhtyESbGVd1FGX7UKtiFp5uwKZdM8wIuQ==}\n+    engines: {node: '>=8'}\n+\n   p-retry@6.2.1:\n     resolution: {integrity: sha512-hEt02O4hUct5wtwg4H4KcWgDdm+l1bOaEy/hWzd8xtXB9BqxTWBBhb+2ImAtH4Cv4rPjV76xN3Zumqk3k3AhhQ==}\n     engines: {node: '>=16.17'}\n@@ -13815,6 +13840,7 @@ packages:\n     engines: {node: '>=0.6.0', teleport: '>=0.2.0'}\n     deprecated: |-\n       You or someone you depend on is using Q, the JavaScript Promise library that gave JavaScript developers strong feelings about promises. They can almost certainly migrate to the native JavaScript promise now. Thank you literally everyone for joining me in this bet against the odds. Be excellent to each other.\n+\n       (For a CapTP with native promises, see @endo/eventual-send and @endo/captp)\n \n   qs@6.11.0:\n@@ -20549,6 +20575,29 @@ snapshots:\n     dependencies:\n       '@sinonjs/commons': 3.0.0\n \n+  '@slack/logger@4.0.0':\n+    dependencies:\n+      '@types/node': 20.17.6\n+\n+  '@slack/types@2.14.0': {}\n+\n+  '@slack/web-api@7.9.1':\n+    dependencies:\n+      '@slack/logger': 4.0.0\n+      '@slack/types': 2.14.0\n+      '@types/node': 20.17.6\n+      '@types/retry': 0.12.0\n+      axios: 1.9.0\n+      eventemitter3: 5.0.1\n+      form-data: 4.0.0\n+      is-electron: 2.2.2\n+      is-stream: 2.0.0\n+      p-queue: 6.6.2\n+      p-retry: 4.6.2\n+      retry: 0.13.1\n+    transitivePeerDependencies:\n+      - debug\n+\n   '@storybook/addon-a11y@8.6.0(storybook@8.6.0(prettier@3.3.3))':\n     dependencies:\n       '@storybook/addon-highlight': 8.6.0(storybook@8.6.0(prettier@3.3.3))\n@@ -22498,6 +22547,14 @@ snapshots:\n     transitivePeerDependencies:\n       - debug\n \n+  axios@1.9.0:\n+    dependencies:\n+      follow-redirects: 1.15.9(debug@4.1.1)\n+      form-data: 4.0.0\n+      proxy-from-env: 1.1.0\n+    transitivePeerDependencies:\n+      - debug\n+\n   axobject-query@4.1.0: {}\n \n   babel-jest@29.7.0(@babel/core@7.26.10):\n@@ -27318,6 +27375,8 @@ snapshots:\n \n   is-docker@3.0.0: {}\n \n+  is-electron@2.2.2: {}\n+\n   is-empty@1.2.0: {}\n \n   is-extendable@0.1.1: {}\n@@ -30550,6 +30609,11 @@ snapshots:\n \n   p-reduce@2.1.0: {}\n \n+  p-retry@4.6.2:\n+    dependencies:\n+      '@types/retry': 0.12.0\n+      retry: 0.13.1\n+\n   p-retry@6.2.1:\n     dependencies:\n       '@types/retry': 0.12.0"
        },
        {
            "sha": "81a9105b7c9ea15bc5cc446a77da3a23fa15c581",
            "filename": "scripts/release/slack.ts",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/56c3ae8191da51ba5a01371db8e48f103faf4562/scripts%2Frelease%2Fslack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/56c3ae8191da51ba5a01371db8e48f103faf4562/scripts%2Frelease%2Fslack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Frelease%2Fslack.ts?ref=56c3ae8191da51ba5a01371db8e48f103faf4562",
            "patch": "@@ -0,0 +1,40 @@\n+import { WebClient } from '@slack/web-api'\n+\n+async function slack() {\n+  if (!process.env.SLACK_TOKEN) {\n+    throw new Error('SLACK_TOKEN not set')\n+  }\n+\n+  const workflowLink = process.env.WORKFLOW_LINK\n+  if (!workflowLink) {\n+    throw new Error('WORKFLOW_LINK not set')\n+  }\n+\n+  const channel = process.env.SLACK_CHANNEL_ID ?? 'C0668R2391V' // #next-releases\n+  // TODO: Configure SLACK_ envs for dry run testing to not ping the oncall.\n+  // TODO: It'll become `@oncall-nextjs`\n+  const ping = process.env.SLACK_PING ?? '@nextjs-oncall'\n+\n+  const message =\n+    process.env.SLACK_MESSAGE ?? process.env.RELEASE_STATUS === 'true'\n+      ? `Successfully published a new release!\\n<https://github.com/vercel/next.js/releases|Releases Link>`\n+      : `Failed to publish a new release triggered by \"${process.env.WORKFLOW_ACTOR}\". ${ping}\\n<${workflowLink}|Workflow Link>`\n+\n+  const slackClient = new WebClient(process.env.SLACK_TOKEN)\n+  const res = await slackClient.chat.postMessage({\n+    channel,\n+    text: message,\n+    username: 'Next.js Bot',\n+    icon_emoji: ':nextjs:',\n+  })\n+\n+  if (!res.ok) {\n+    throw new Error(\n+      `Failed to send message \"${message}\" to Slack channel #next-releases: ${res.error}`\n+    )\n+  }\n+\n+  console.log('Successfully sent message to Slack!')\n+}\n+\n+slack()"
        }
    ],
    "stats": {
        "total": 115,
        "additions": 114,
        "deletions": 1
    }
}