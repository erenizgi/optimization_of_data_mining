{
    "author": "timneutkens",
    "message": "Tests: Don't use next/dist for test/e2e/streaming-ssr (#83262)\n\n## What?\n\nThis test incorrectly using internals instead of the public api.\nSwitched it to using the custom server api.",
    "sha": "dd31b3d6a27a60917ff9c2cb7877ba53e6ea77cf",
    "files": [
        {
            "sha": "e3ffd29c077fce8b337f5cc7ebd5c44be397e9b8",
            "filename": "test/e2e/streaming-ssr/custom-server/server.js",
            "status": "modified",
            "additions": 23,
            "deletions": 35,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/dd31b3d6a27a60917ff9c2cb7877ba53e6ea77cf/test%2Fe2e%2Fstreaming-ssr%2Fcustom-server%2Fserver.js",
            "raw_url": "https://github.com/vercel/next.js/raw/dd31b3d6a27a60917ff9c2cb7877ba53e6ea77cf/test%2Fe2e%2Fstreaming-ssr%2Fcustom-server%2Fserver.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr%2Fcustom-server%2Fserver.js?ref=dd31b3d6a27a60917ff9c2cb7877ba53e6ea77cf",
            "patch": "@@ -1,43 +1,31 @@\n-const NextServer = require('next/dist/server/next-server').default\n-const defaultNextConfig =\n-  require('next/dist/server/config-shared').defaultConfig\n+const next = require('next')\n const http = require('http')\n \n-process.on('SIGTERM', () => process.exit(0))\n-process.on('SIGINT', () => process.exit(0))\n+const port = parseInt(process.env.PORT, 10) || 3000\n+const dev = process.env.NODE_ENV !== 'production'\n \n-let handler\n+const app = next({ dev })\n \n-const server = http.createServer(async (req, res) => {\n-  try {\n-    await handler(req, res)\n-  } catch (err) {\n-    console.error(err)\n-    res.statusCode = 500\n-    res.end('Internal Server Error')\n-  }\n-})\n-const currentPort = parseInt(process.env.PORT, 10) || 3000\n+process.on('SIGTERM', () => process.exit(0))\n+process.on('SIGINT', () => process.exit(0))\n \n-server.listen(currentPort, (err) => {\n-  if (err) {\n-    console.error('Failed to start server', err)\n-    process.exit(1)\n-  }\n-  const nextServer = new NextServer({\n-    hostname: 'localhost',\n-    port: currentPort,\n-    customServer: true,\n-    dev: false,\n-    conf: {\n-      ...defaultNextConfig,\n-      distDir: '.next',\n-      experimental: {\n-        ...defaultNextConfig.experimental,\n-      },\n-    },\n+app.prepare().then(() => {\n+  const handler = app.getRequestHandler()\n+  const server = http.createServer(async (req, res) => {\n+    try {\n+      await handler(req, res)\n+    } catch (err) {\n+      console.error(err)\n+      res.statusCode = 500\n+      res.end('Internal Server Error')\n+    }\n   })\n-  handler = nextServer.getRequestHandler()\n \n-  console.log('Listening on port', currentPort)\n+  server.listen(port, (err) => {\n+    if (err) {\n+      console.error('Failed to start server', err)\n+      process.exit(1)\n+    }\n+    console.log('Listening on port', port)\n+  })\n })"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 23,
        "deletions": 35
    }
}