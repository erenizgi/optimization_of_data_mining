{
    "author": "sokra",
    "message": "Turbopack: take task cache log before starting snapshot (#84755)\n\n### What?\n\nWe need to snapshot the task data before taking all task cache changes.\n\nOtherwise there is a race condition where the task data contains a task id that is not in the task cache.",
    "sha": "5274809658e85d29b63c7abb013cbe8a128cf1f5",
    "files": [
        {
            "sha": "7cdd3c5aad5b2df2a679450549b7a3cf5ab2c089",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5274809658e85d29b63c7abb013cbe8a128cf1f5/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5274809658e85d29b63c7abb013cbe8a128cf1f5/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=5274809658e85d29b63c7abb013cbe8a128cf1f5",
            "patch": "@@ -964,12 +964,12 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             .map(|op| op.arc().clone())\n             .collect::<Vec<_>>();\n         drop(snapshot_request);\n+        self.storage.start_snapshot();\n         let mut persisted_task_cache_log = self\n             .persisted_task_cache_log\n             .as_ref()\n             .map(|l| l.take(|i| i))\n             .unwrap_or_default();\n-        self.storage.start_snapshot();\n         let mut snapshot_request = self.snapshot_request.lock();\n         snapshot_request.snapshot_requested = false;\n         self.in_progress_operations"
        }
    ],
    "stats": {
        "total": 2,
        "additions": 1,
        "deletions": 1
    }
}