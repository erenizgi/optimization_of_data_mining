{
    "author": "loislo",
    "message": "[XLA:GPU] pure mechanical rename from NanCount to FloatCheck and from nan_count to float_check\n\nThe goal of the cl is to prepare the code base for more float checks.\nIt will be Inf check, min and max checks, etc.\n\nPiperOrigin-RevId: 828979801",
    "sha": "d4369fdd0a6ef4801187907ef6e83731df4661be",
    "files": [
        {
            "sha": "19b875d67f2f4bafc651254275f51b39e98f2749",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -3001,7 +3001,7 @@ cc_library(\n         \":buffer_debug_log_entry_metadata_store\",\n         \":buffer_debug_log_structs\",\n         \":buffers_checksum_thunk\",\n-        \":buffers_nan_count_thunk\",\n+        \":buffers_float_check_thunk\",\n         \":custom_call_thunk\",\n         \":sequential_thunk\",\n         \":thunk\",\n@@ -3039,7 +3039,7 @@ xla_cc_test(\n     srcs = [\"thunk_buffer_debug_pass_test.cc\"],\n     deps = [\n         \":buffers_checksum_thunk\",\n-        \":buffers_nan_count_thunk\",\n+        \":buffers_float_check_thunk\",\n         \":conditional_thunk\",\n         \":custom_call_thunk\",\n         \":sequential_thunk\",\n@@ -3165,9 +3165,9 @@ xla_test(\n )\n \n cc_library(\n-    name = \"buffers_nan_count_thunk\",\n-    srcs = [\"buffers_nan_count_thunk.cc\"],\n-    hdrs = [\"buffers_nan_count_thunk.h\"],\n+    name = \"buffers_float_check_thunk\",\n+    srcs = [\"buffers_float_check_thunk.cc\"],\n+    hdrs = [\"buffers_float_check_thunk.h\"],\n     deps = [\n         \":buffer_debug_log_entry_metadata_store\",\n         \":buffer_debug_log_structs\",\n@@ -3180,8 +3180,8 @@ cc_library(\n         \"//xla/stream_executor:stream_executor_h\",\n         \"//xla/stream_executor/cuda:cuda_compute_capability\",\n         \"//xla/stream_executor/cuda:cuda_platform_id\",\n+        \"//xla/stream_executor/gpu:buffer_debug_float_check_kernel\",\n         \"//xla/stream_executor/gpu:buffer_debug_log\",\n-        \"//xla/stream_executor/gpu:buffer_debug_nan_count_kernel\",\n         \"//xla/stream_executor/gpu:gpu_kernel_registry\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n@@ -3190,13 +3190,13 @@ cc_library(\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n     ] + if_cuda_is_configured([\n-        \"//xla/stream_executor/cuda:buffer_debug_nan_count_kernel_cuda\",\n+        \"//xla/stream_executor/cuda:buffer_debug_float_check_kernel_cuda\",\n     ]),\n )\n \n xla_test(\n-    name = \"buffers_nan_count_thunk_test\",\n-    srcs = [\"buffers_nan_count_thunk_test.cc\"],\n+    name = \"buffers_float_check_thunk_test\",\n+    srcs = [\"buffers_float_check_thunk_test.cc\"],\n     backends = [\"gpu\"],\n     tags = [\n         \"cuda-only\",\n@@ -3205,7 +3205,7 @@ xla_test(\n     deps = [\n         \":buffer_debug_log_entry_metadata_store\",\n         \":buffer_debug_log_structs\",\n-        \":buffers_nan_count_thunk\",\n+        \":buffers_float_check_thunk\",\n         \":thunk\",\n         \":thunk_id\",\n         \"//xla:types\","
        },
        {
            "sha": "4649a76c766cfe6ff4b6b2ec3d64adc6fc5276e6",
            "filename": "third_party/xla/xla/backends/gpu/runtime/buffer_debug_log.proto",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log.proto?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -45,7 +45,7 @@ message BufferDebugLogEntryProto {\n   enum CheckType {\n     CHECK_TYPE_UNSPECIFIED = 0;\n     CHECK_TYPE_CHECKSUM = 1;\n-    CHECK_TYPE_NAN_COUNT = 2;\n+    CHECK_TYPE_FLOAT_CHECKS = 2;\n   }\n \n   CheckType check_type = 6;"
        },
        {
            "sha": "d2d19f9a501c5d6bcce1b22969a9744939e90b87",
            "filename": "third_party/xla/xla/backends/gpu/runtime/buffer_debug_log_entry_metadata_store_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log_entry_metadata_store_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log_entry_metadata_store_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffer_debug_log_entry_metadata_store_test.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -73,7 +73,7 @@ TEST(BufferDebugLogEntryMetadataStoreTest, EntriesToProto) {\n       /*buffer_idx=*/8,\n       /*execution_id=*/9,\n       /*is_input=*/false,\n-      BufferDebugLogEntryProto::CHECK_TYPE_NAN_COUNT,\n+      BufferDebugLogEntryProto::CHECK_TYPE_FLOAT_CHECKS,\n   });\n   std::vector<BufferDebugLogEntry> entries = {\n       {\n@@ -103,7 +103,7 @@ TEST(BufferDebugLogEntryMetadataStoreTest, EntriesToProto) {\n                   execution_id: 9\n                   is_input_buffer: false\n                   checksum: 56785678,\n-                  check_type: CHECK_TYPE_NAN_COUNT\n+                  check_type: CHECK_TYPE_FLOAT_CHECKS\n                 }\n               )pb\"));\n }"
        },
        {
            "sha": "aa390841c01707e33fe76885bb8ced0c310cbf90",
            "filename": "third_party/xla/xla/backends/gpu/runtime/buffers_float_check_thunk.cc",
            "status": "renamed",
            "additions": 18,
            "deletions": 16,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/backends/gpu/runtime/buffers_nan_count_thunk.h\"\n+#include \"xla/backends/gpu/runtime/buffers_float_check_thunk.h\"\n \n #include <cstdint>\n #include <string>\n@@ -27,8 +27,8 @@ limitations under the License.\n #include \"xla/stream_executor/cuda/cuda_compute_capability.h\"\n #include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/device_memory.h\"\n+#include \"xla/stream_executor/gpu/buffer_debug_float_check_kernel.h\"\n #include \"xla/stream_executor/gpu/buffer_debug_log.h\"\n-#include \"xla/stream_executor/gpu/buffer_debug_nan_count_kernel.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/launch_dim.h\"\n #include \"xla/stream_executor/stream_executor.h\"\n@@ -40,46 +40,48 @@ namespace xla::gpu {\n \n namespace se = stream_executor;\n \n-absl::Status BuffersDebugNanCountThunk::Initialize(\n+absl::Status BuffersDebugFloatCheckThunk::Initialize(\n     const InitializeParams& params) {\n   if (params.executor->GetPlatform()->id() != se::cuda::kCudaPlatformId) {\n-    VLOG(1)\n-        << \"Buffer nan-counting not supported on non-CUDA platforms, skipping\";\n+    VLOG(1) << \"Buffer float checking not supported on non-CUDA platforms, \"\n+               \"skipping\";\n     return absl::OkStatus();\n   }\n   if (!params.executor->GetDeviceDescription()\n            .cuda_compute_capability()\n            .IsAtLeastPascal()) {\n     VLOG(1)\n-        << \"Buffer nan-counting not supported on CUDA architectures older than \"\n+        << \"Buffer float checking not supported on CUDA architectures older \"\n+           \"than \"\n            \"Pascal due to missing atomic fetch_add with system scope, skipping\";\n     return absl::OkStatus();\n   }\n \n   se::gpu::GpuKernelRegistry registry =\n       se::gpu::GpuKernelRegistry::GetGlobalRegistry();\n   TF_ASSIGN_OR_RETURN(\n-      kernel_f32_, registry.LoadKernel<se::gpu::BufferDebugNanCountF32Kernel>(\n+      kernel_f32_, registry.LoadKernel<se::gpu::BufferDebugFloatCheckF32Kernel>(\n                        params.executor));\n   TF_ASSIGN_OR_RETURN(\n-      kernel_bf16_, registry.LoadKernel<se::gpu::BufferDebugNanCountBf16Kernel>(\n-                        params.executor));\n+      kernel_bf16_,\n+      registry.LoadKernel<se::gpu::BufferDebugFloatCheckBf16Kernel>(\n+          params.executor));\n \n-  VLOG(1) << \"NanCount kernel loaded\";\n+  VLOG(1) << \"FloatCheck kernel loaded\";\n   return absl::OkStatus();\n }\n \n-absl::Status BuffersDebugNanCountThunk::ExecuteOnStream(\n+absl::Status BuffersDebugFloatCheckThunk::ExecuteOnStream(\n     const ExecuteParams& params) {\n   se::StreamExecutor* executor = params.stream->parent();\n   if (!kernel_f32_.has_value()) {\n     // Initialize didn't load the kernel. This can happen when we're running on\n     // an unsupported platform.\n-    VLOG(1) << \"NanCount kernel not loaded, skipping\";\n+    VLOG(1) << \"FloatCheck kernel not loaded, skipping\";\n     return absl::OkStatus();\n   }\n \n-  VLOG(1) << \"BuffersDebugNanCountThunk::ExecuteOnStream\";\n+  VLOG(1) << \"BuffersDebugFloatCheckThunk::ExecuteOnStream\";\n \n   const se::ThreadDim thread_dim(\n       executor->GetDeviceDescription().threads_per_block_limit(), 1, 1);\n@@ -96,7 +98,7 @@ absl::Status BuffersDebugNanCountThunk::ExecuteOnStream(\n         buffer_idx,\n         execution_id,\n         /*is_input=*/runs_before_checked_thunk_,\n-        BufferDebugLogEntryProto::CHECK_TYPE_NAN_COUNT,\n+        BufferDebugLogEntryProto::CHECK_TYPE_FLOAT_CHECKS,\n     };\n     const BufferDebugLogEntryId entry_id = metadata_store_->AssignId(metadata);\n \n@@ -120,15 +122,15 @@ absl::Status BuffersDebugNanCountThunk::ExecuteOnStream(\n           bf16_buffer, bf16_buffer.size(), buffer_debug_log.GetDeviceHeader(),\n           buffer_debug_log.GetDeviceEntries()));\n     } else {\n-      VLOG(1) << \"Unsupported primitive type for NaN counting: \"\n+      VLOG(1) << \"Unsupported primitive type for float checking: \"\n               << PrimitiveType_Name(buffer_type);\n     }\n   }\n \n   return absl::OkStatus();\n }\n \n-std::string BuffersDebugNanCountThunk::ToString(int indent) const {\n+std::string BuffersDebugFloatCheckThunk::ToString(int indent) const {\n   std::string result;\n   absl::StrAppend(&result, \", buffers = \", checked_thunk_buffers_.size());\n   for (const auto& [buffer_idx, buffer] : checked_thunk_buffers_) {",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/buffers_nan_count_thunk.cc"
        },
        {
            "sha": "c87d8f379abb4db9812c99f8b46e602c8f6b4fcd",
            "filename": "third_party/xla/xla/backends/gpu/runtime/buffers_float_check_thunk.h",
            "status": "renamed",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk.h?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -13,8 +13,8 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#ifndef XLA_BACKENDS_GPU_RUNTIME_BUFFERS_NAN_COUNT_THUNK_H_\n-#define XLA_BACKENDS_GPU_RUNTIME_BUFFERS_NAN_COUNT_THUNK_H_\n+#ifndef XLA_BACKENDS_GPU_RUNTIME_BUFFERS_FLOAT_CHECK_THUNK_H_\n+#define XLA_BACKENDS_GPU_RUNTIME_BUFFERS_FLOAT_CHECK_THUNK_H_\n \n #include <atomic>\n #include <cstddef>\n@@ -29,20 +29,20 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/backends/gpu/runtime/thunk_id.h\"\n #include \"xla/service/buffer_assignment.h\"\n-#include \"xla/stream_executor/gpu/buffer_debug_nan_count_kernel.h\"\n+#include \"xla/stream_executor/gpu/buffer_debug_float_check_kernel.h\"\n \n namespace xla::gpu {\n \n-class BuffersDebugNanCountThunk : public Thunk {\n+class BuffersDebugFloatCheckThunk : public Thunk {\n  public:\n-  explicit BuffersDebugNanCountThunk(\n+  explicit BuffersDebugFloatCheckThunk(\n       ThunkInfo info, BufferAllocation::Slice log_slice,\n       ThunkId checked_thunk_id,\n       absl::flat_hash_map<size_t, BufferAllocation::Slice>\n           checked_thunk_buffers,\n       bool runs_before_checked_thunk,\n       std::shared_ptr<BufferDebugLogEntryMetadataStore> metadata_store)\n-      : Thunk(Thunk::Kind::kBuffersDebugNanCount, std::move(info)),\n+      : Thunk(Thunk::Kind::kBuffersDebugFloatCheck, std::move(info)),\n         log_slice_(log_slice),\n         checked_thunk_id_(checked_thunk_id),\n         checked_thunk_buffers_(std::move(checked_thunk_buffers)),\n@@ -55,7 +55,7 @@ class BuffersDebugNanCountThunk : public Thunk {\n   std::string ToString(int indent) const override;\n \n   BufferUses buffer_uses() const override {\n-    // Intentionally left empty to not nan-count the nan-counting thunk.\n+    // Intentionally left empty to not float-check the float-checking thunk.\n     return {};\n   }\n \n@@ -66,9 +66,11 @@ class BuffersDebugNanCountThunk : public Thunk {\n \n  private:\n   // Loaded in Initialize.\n-  std::optional<stream_executor::gpu::BufferDebugNanCountF32Kernel::KernelType>\n+  std::optional<\n+      stream_executor::gpu::BufferDebugFloatCheckF32Kernel::KernelType>\n       kernel_f32_;\n-  std::optional<stream_executor::gpu::BufferDebugNanCountBf16Kernel::KernelType>\n+  std::optional<\n+      stream_executor::gpu::BufferDebugFloatCheckBf16Kernel::KernelType>\n       kernel_bf16_;\n   BufferAllocation::Slice log_slice_;\n   ThunkId checked_thunk_id_;\n@@ -80,4 +82,4 @@ class BuffersDebugNanCountThunk : public Thunk {\n \n }  // namespace xla::gpu\n \n-#endif  // XLA_BACKENDS_GPU_RUNTIME_BUFFERS_NAN_COUNT_THUNK_H_\n+#endif  // XLA_BACKENDS_GPU_RUNTIME_BUFFERS_FLOAT_CHECK_THUNK_H_",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/buffers_nan_count_thunk.h"
        },
        {
            "sha": "37ba12c7f3c61b36e239f5a1f0728654350d6d81",
            "filename": "third_party/xla/xla/backends/gpu/runtime/buffers_float_check_thunk_test.cc",
            "status": "renamed",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fbuffers_float_check_thunk_test.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/backends/gpu/runtime/buffers_nan_count_thunk.h\"\n+#include \"xla/backends/gpu/runtime/buffers_float_check_thunk.h\"\n \n #include <cstddef>\n #include <cstdint>\n@@ -71,7 +71,7 @@ MATCHER_P2(IsEntryWithMetadata, store, metadata, \"\") {\n       *actual_metadata, result_listener);\n }\n \n-class BuffersDebugNanCountThunkTest : public ::testing::Test {\n+class BuffersDebugFloatCheckThunkTest : public ::testing::Test {\n  protected:\n   void SetUp() override {\n     TF_ASSERT_OK_AND_ASSIGN(platform_,\n@@ -85,7 +85,7 @@ class BuffersDebugNanCountThunkTest : public ::testing::Test {\n              .cuda_compute_capability()\n              .IsAtLeastPascal()) {\n       GTEST_SKIP()\n-          << \"buffer nan-counting is not supported on CUDA architectures \"\n+          << \"buffer float checking is not supported on CUDA architectures \"\n              \"older than Pascal due to missing atomic fetch_add with \"\n              \"system scope\";\n     }\n@@ -97,7 +97,7 @@ class BuffersDebugNanCountThunkTest : public ::testing::Test {\n   std::unique_ptr<se::StreamExecutorMemoryAllocator> allocator_;\n };\n \n-TEST_F(BuffersDebugNanCountThunkTest, CalculatesNanCounts) {\n+TEST_F(BuffersDebugFloatCheckThunkTest, CalculatesNanCounts) {\n   static constexpr size_t kLogSize = BufferDebugLog::RequiredSizeForEntries(10);\n   static constexpr size_t kInputElems = 1024;\n   static constexpr size_t kInputSizeInBytes = kInputElems * sizeof(float);\n@@ -154,7 +154,7 @@ TEST_F(BuffersDebugNanCountThunkTest, CalculatesNanCounts) {\n       /*collective_params=*/nullptr, /*collective_cliques=*/nullptr);\n   auto metadata_store = std::make_shared<BufferDebugLogEntryMetadataStore>();\n \n-  BuffersDebugNanCountThunk thunk(\n+  BuffersDebugFloatCheckThunk thunk(\n       Thunk::ThunkInfo(), log_slice,\n       /*checked_thunk_id=*/ThunkId(123),\n       {{/*buffer_idx=*/0, inputs[0]}, {/*buffer_idx=*/1, inputs[1]}},\n@@ -165,8 +165,8 @@ TEST_F(BuffersDebugNanCountThunkTest, CalculatesNanCounts) {\n   TF_ASSERT_OK_AND_ASSIGN(std::vector<BufferDebugLogEntry> entries,\n                           device_log.ReadFromDevice(*stream_));\n \n-  // BuffersDebugNanCountThunk launches a kernel for each input buffer, they may\n-  // complete in any order.\n+  // BuffersDebugFloatCheckThunk launches a kernel for each input buffer, they\n+  // may complete in any order.\n   EXPECT_THAT(entries,\n               UnorderedElementsAre(\n                   IsEntryWithMetadata(\n@@ -176,7 +176,7 @@ TEST_F(BuffersDebugNanCountThunkTest, CalculatesNanCounts) {\n                           /*buffer_idx=*/0,\n                           /*execution_id=*/0,\n                           /*is_input=*/true,\n-                          BufferDebugLogEntryProto::CHECK_TYPE_NAN_COUNT,\n+                          BufferDebugLogEntryProto::CHECK_TYPE_FLOAT_CHECKS,\n                       }),\n                   IsEntryWithMetadata(\n                       metadata_store,\n@@ -185,7 +185,7 @@ TEST_F(BuffersDebugNanCountThunkTest, CalculatesNanCounts) {\n                           /*buffer_idx=*/1,\n                           /*execution_id=*/0,\n                           /*is_input=*/true,\n-                          BufferDebugLogEntryProto::CHECK_TYPE_NAN_COUNT,\n+                          BufferDebugLogEntryProto::CHECK_TYPE_FLOAT_CHECKS,\n                       })));\n }\n ",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/buffers_nan_count_thunk_test.cc"
        },
        {
            "sha": "063c812f6221b137ed64e6739cc6d5f4a8355ef2",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -258,7 +258,7 @@ Thunk::ExecuteParams::ExecuteParams(\n     CASE(kAllToAllDone);\n     CASE(kAllToAllStart);\n     CASE(kBuffersDebugChecksum);\n-    CASE(kBuffersDebugNanCount);\n+    CASE(kBuffersDebugFloatCheck);\n     CASE(kCholesky);\n     CASE(kCollectiveBroadcast);\n     CASE(kCollectiveBroadcastDone);"
        },
        {
            "sha": "7bf59064e17f205f67c2eb1cc2d3c9405da8001f",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -138,7 +138,7 @@ class Thunk {\n     kAllToAllDone,\n     kAllToAllStart,\n     kBuffersDebugChecksum,\n-    kBuffersDebugNanCount,\n+    kBuffersDebugFloatCheck,\n     kCholesky,\n     kCollectiveBroadcast,\n     kCollectiveBroadcastDone,"
        },
        {
            "sha": "7a25b63764bb6d229a1ed2411b6d0a99850163c2",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 20,
            "changes": 42,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -36,7 +36,7 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/buffer_debug_log_entry_metadata_store.h\"\n #include \"xla/backends/gpu/runtime/buffer_debug_log_structs.h\"\n #include \"xla/backends/gpu/runtime/buffers_checksum_thunk.h\"\n-#include \"xla/backends/gpu/runtime/buffers_nan_count_thunk.h\"\n+#include \"xla/backends/gpu/runtime/buffers_float_check_thunk.h\"\n #include \"xla/backends/gpu/runtime/custom_call_thunk.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n@@ -134,7 +134,7 @@ std::unique_ptr<Thunk> WrapWithChecksumThunk(\n   return wrapped_thunk;\n }\n \n-std::unique_ptr<Thunk> WrapWithNanCounterThunk(\n+std::unique_ptr<Thunk> WrapWithFloatCheckThunk(\n     std::unique_ptr<Thunk> thunk, BufferAllocation::Slice log_slice,\n     const Thunk& predecessor_thunk, Thunk& successor_thunk,\n     std::shared_ptr<BufferDebugLogEntryMetadataStore> metadata_store) {\n@@ -168,7 +168,7 @@ std::unique_ptr<Thunk> WrapWithNanCounterThunk(\n     if (!use.HasDefinedContentsOnOutput()) {\n       VLOG(1) << \"Buffer \" << buffer_idx << \" in thunk \"\n               << thunk->thunk_info().thunk_id\n-              << \" has no defined contents on output, skipping\";\n+              << \" has no defined contents, skipping\";\n       continue;\n     }\n     buffers_to_check.emplace(buffer_idx, use.slice());\n@@ -183,18 +183,18 @@ std::unique_ptr<Thunk> WrapWithNanCounterThunk(\n   }\n \n   VLOG(1) << \"Wrapping thunk \" << thunk->thunk_info().thunk_id\n-          << \" with nan counter thunk due to presence of buffers: \"\n+          << \" with float check thunk due to presence of buffers: \"\n           << buffers_to_check.size();\n   std::vector<std::unique_ptr<Thunk>> thunk_and_checks;\n   Thunk* thunk_ptr = thunk.get();\n   thunk_and_checks.push_back(std::move(thunk));\n-  auto buffer_debug_nan_counter_thunk =\n-      std::make_unique<BuffersDebugNanCountThunk>(\n+  auto buffer_debug_float_check_thunk =\n+      std::make_unique<BuffersDebugFloatCheckThunk>(\n           Thunk::ThunkInfo(), log_slice, thunk_ptr->thunk_info().thunk_id,\n           std::move(buffers_to_check),\n           /*runs_before_checked_thunk=*/false, std::move(metadata_store));\n-  buffer_debug_nan_counter_thunk->add_control_predecessor(thunk_ptr);\n-  thunk_and_checks.push_back(std::move(buffer_debug_nan_counter_thunk));\n+  buffer_debug_float_check_thunk->add_control_predecessor(thunk_ptr);\n+  thunk_and_checks.push_back(std::move(buffer_debug_float_check_thunk));\n   auto wrapped_thunk = std::make_unique<SequentialThunk>(\n       Thunk::ThunkInfo(), std::move(thunk_and_checks));\n   wrapped_thunk->add_control_predecessor(&predecessor_thunk);\n@@ -229,22 +229,24 @@ absl::Status DumpBufferDebugLog(\n   VLOG(1) << \"read \" << buffer_debug_log_proto.entries_size() << \" entries\";\n   DumpPerExecutionProtobufToFile(*hlo_module, buffer_debug_log_proto,\n                                  debug_options, \"buffer_debug_log\", nullptr);\n-  int non_zero_nan_count_modules_count = 0;\n+  int non_zero_float_check_modules_count = 0;\n   for (const auto& entry : buffer_debug_log_proto.entries()) {\n-    if (entry.check_type() == BufferDebugLogEntryProto::CHECK_TYPE_NAN_COUNT &&\n+    if (entry.check_type() ==\n+            BufferDebugLogEntryProto::CHECK_TYPE_FLOAT_CHECKS &&\n         entry.checksum() > 0) {\n-      LOG(ERROR) << \"Found entry with non zero nan count \" << entry.checksum()\n-                 << \" for thunk \" << entry.thunk_id() << \" and execution \"\n-                 << entry.execution_id() << \" for module: \\n\"\n+      LOG(ERROR) << \"Found entry with non zero float check count \"\n+                 << entry.checksum() << \" for thunk \" << entry.thunk_id()\n+                 << \" and execution \" << entry.execution_id()\n+                 << \" for module: \\n\"\n                  << hlo_module->ToString();\n-      non_zero_nan_count_modules_count++;\n+      non_zero_float_check_modules_count++;\n     }\n   }\n-  if (non_zero_nan_count_modules_count > 0 &&\n+  if (non_zero_float_check_modules_count > 0 &&\n       hlo_module->config().debug_options().xla_gpu_detect_nan() ==\n           DebugOptions::NAN_CHECK_DETECTION_MODE_FAIL) {\n-    LOG(FATAL) << \"Found \" << non_zero_nan_count_modules_count\n-               << \" modules with non zero nan count\";\n+    LOG(FATAL) << \"Found \" << non_zero_float_check_modules_count\n+               << \" modules with non zero float check count\";\n   }\n   return absl::OkStatus();\n }\n@@ -417,9 +419,9 @@ absl::StatusOr<bool> ThunkBufferDebugPass::Run(\n             std::move(thunk), log_slice,\n             /*predecessor_thunk=*/*buffer_debug_init_thunk,\n             /*successor_thunk=*/*buffer_debug_dump_thunk, metadata_store);\n-      case Mode::kNanCounter:\n-        VLOG(1) << \"Wrapping with nan counter thunk\";\n-        return WrapWithNanCounterThunk(\n+      case Mode::kFloatChecker:\n+        VLOG(1) << \"Wrapping with float check thunk\";\n+        return WrapWithFloatCheckThunk(\n             std::move(thunk), log_slice,\n             /*predecessor_thunk=*/*buffer_debug_init_thunk,\n             /*successor_thunk=*/*buffer_debug_dump_thunk, metadata_store);"
        },
        {
            "sha": "20a07373bcc70fab75a276c80d8b3441d5f39554",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -32,7 +32,7 @@ class ThunkBufferDebugPass : public ThunkPassInterface {\n  public:\n   enum class Mode {\n     kChecksum,\n-    kNanCounter,\n+    kFloatChecker,\n   };\n \n   explicit ThunkBufferDebugPass(Mode mode) : mode_(mode) {}"
        },
        {
            "sha": "35bf8a0a02ca01386d845d1771eefa8df0b35e4b",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass_test.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -27,7 +27,7 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"xla/backends/gpu/runtime/buffers_checksum_thunk.h\"\n-#include \"xla/backends/gpu/runtime/buffers_nan_count_thunk.h\"\n+#include \"xla/backends/gpu/runtime/buffers_float_check_thunk.h\"\n #include \"xla/backends/gpu/runtime/conditional_thunk.h\"\n #include \"xla/backends/gpu/runtime/custom_call_thunk.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n@@ -437,7 +437,7 @@ TEST_F(ThunkBufferDebugPassTest, RecursivelyInsertsBuffersDebugChecksumThunks) {\n   }\n }\n \n-TEST_F(ThunkBufferDebugPassTest, InsertsBuffersDebugNanCounterThunks) {\n+TEST_F(ThunkBufferDebugPassTest, InsertsBuffersDebugFloatCheckThunks) {\n   static constexpr ThunkId kTestThunkId = ThunkId(123);\n   DebugOptions debug_options;\n   debug_options.set_xla_gpu_detect_nan(\n@@ -480,7 +480,7 @@ TEST_F(ThunkBufferDebugPassTest, InsertsBuffersDebugNanCounterThunks) {\n   auto root_thunk =\n       std::make_unique<SequentialThunk>(Thunk::ThunkInfo(), std::move(thunks));\n \n-  ThunkBufferDebugPass pass(ThunkBufferDebugPass::Mode::kNanCounter);\n+  ThunkBufferDebugPass pass(ThunkBufferDebugPass::Mode::kFloatChecker);\n   TF_ASSERT_OK_AND_ASSIGN(bool changed,\n                           pass.Run(root_thunk.get(), debug_options, &hlo_module,\n                                    device_info, allocator));\n@@ -490,7 +490,7 @@ TEST_F(ThunkBufferDebugPassTest, InsertsBuffersDebugNanCounterThunks) {\n   // 1. CustomCallThunk (buffer debug log init)\n   // 2. SequentialThunk\n   //    1. FakeThunk\n-  //    2. BuffersDebugNanCountThunk (nan counter output buffers)\n+  //    2. BuffersDebugFloatCheckThunk (float check output buffers)\n   // 3. CustomCallThunk (buffer debug log dump)\n   const std::vector<std::unique_ptr<Thunk>>& new_thunks = root_thunk->thunks();\n   EXPECT_THAT(new_thunks, SizeIs(3));\n@@ -512,10 +512,10 @@ TEST_F(ThunkBufferDebugPassTest, InsertsBuffersDebugNanCounterThunks) {\n       static_cast<const SequentialThunk&>(*new_thunks[1]).thunks();\n   EXPECT_THAT(sub_thunks, SizeIs(2));\n   EXPECT_THAT(sub_thunks[0], Pointer(fake_thunk_ptr));\n-  EXPECT_EQ(sub_thunks[1]->kind(), Thunk::Kind::kBuffersDebugNanCount);\n+  EXPECT_EQ(sub_thunks[1]->kind(), Thunk::Kind::kBuffersDebugFloatCheck);\n \n-  const BuffersDebugNanCountThunk& buffer_debug_after_fake_thunk =\n-      static_cast<const BuffersDebugNanCountThunk&>(*sub_thunks[1]);\n+  const BuffersDebugFloatCheckThunk& buffer_debug_after_fake_thunk =\n+      static_cast<const BuffersDebugFloatCheckThunk&>(*sub_thunks[1]);\n   EXPECT_THAT(buffer_debug_after_fake_thunk.buffer_slices(),\n               UnorderedElementsAre(Pair(1, slice_o), Pair(2, slice_io)));\n }"
        },
        {
            "sha": "24c6b091dd2710305f7bcc640e95581802139ddd",
            "filename": "third_party/xla/xla/service/gpu/gpu_executable.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -185,7 +185,7 @@ static absl::Status RunThunkPasses(const DebugOptions& debug_options,\n   if (debug_options.xla_gpu_detect_nan() !=\n       DebugOptions::NAN_CHECK_DETECTION_MODE_NONE) {\n     pipeline.AddPass(std::make_unique<ThunkBufferDebugPass>(\n-        ThunkBufferDebugPass::Mode::kNanCounter));\n+        ThunkBufferDebugPass::Mode::kFloatChecker));\n   }\n   if (debug_options.xla_gpu_experimental_enable_command_buffer_on_thunks()) {\n     pipeline.AddPass(std::make_unique<CommandBufferConversionPass>("
        },
        {
            "sha": "88dce7bf46303b0d6ceb09187b8b47918d42a110",
            "filename": "third_party/xla/xla/stream_executor/cuda/BUILD",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -476,8 +476,8 @@ xla_test(\n )\n \n cuda_library(\n-    name = \"buffer_debug_nan_count_kernel_cuda\",\n-    srcs = [\"buffer_debug_nan_count_kernel_cuda.cu.cc\"],\n+    name = \"buffer_debug_float_check_kernel_cuda\",\n+    srcs = [\"buffer_debug_float_check_kernel_cuda.cu.cc\"],\n     # copybara:uncomment compatible_with = [\"//buildenv/target:non_prod\"],\n     tags = [\n         \"cuda-only\",\n@@ -487,7 +487,7 @@ cuda_library(\n         \":cuda_platform\",\n         \"//xla/backends/gpu/runtime:buffer_debug_log_structs\",\n         \"//xla/stream_executor:kernel_spec\",\n-        \"//xla/stream_executor/gpu:buffer_debug_nan_count_kernel\",\n+        \"//xla/stream_executor/gpu:buffer_debug_float_check_kernel\",\n         \"//xla/stream_executor/gpu:gpu_kernel_registry\",\n         \"//xla/tsl/platform:logging\",\n         \"@com_google_absl//absl/base\",\n@@ -497,12 +497,12 @@ cuda_library(\n )\n \n xla_test(\n-    name = \"buffer_debug_nan_count_kernel_cuda_test\",\n-    srcs = [\"buffer_debug_nan_count_kernel_cuda_test.cc\"],\n+    name = \"buffer_debug_float_check_kernel_cuda_test\",\n+    srcs = [\"buffer_debug_float_check_kernel_cuda_test.cc\"],\n     backends = [\"gpu\"],\n     tags = [\"cuda-only\"],\n     deps = [\n-        \":buffer_debug_nan_count_kernel_cuda\",\n+        \":buffer_debug_float_check_kernel_cuda\",\n         \"//xla:types\",\n         \"//xla/backends/gpu/runtime:buffer_debug_log_structs\",\n         \"//xla/backends/gpu/runtime:thunk_id\",\n@@ -514,8 +514,8 @@ xla_test(\n         \"//xla/stream_executor:stream_executor_h\",\n         \"//xla/stream_executor:stream_executor_memory_allocator\",\n         \"//xla/stream_executor:typed_kernel_factory\",\n+        \"//xla/stream_executor/gpu:buffer_debug_float_check_kernel\",\n         \"//xla/stream_executor/gpu:buffer_debug_log\",\n-        \"//xla/stream_executor/gpu:buffer_debug_nan_count_kernel\",\n         \"//xla/stream_executor/gpu:gpu_kernel_registry\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:errors\",\n@@ -1305,6 +1305,7 @@ cc_library(\n     deps = [\n         \":all_reduce_kernel_cuda\",\n         \":buffer_comparator_kernel_cuda\",\n+        \":buffer_debug_float_check_kernel_cuda\",\n         \":buffer_debug_xor_checksum_kernel_cuda\",\n         \":cublas_plugin\",\n         \":cuda_platform\","
        },
        {
            "sha": "f9fb7c3ea81e6763738c8e31b671ee855722aefe",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_float_check_kernel_cuda.cu.cc",
            "status": "renamed",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -21,7 +21,7 @@ limitations under the License.\n #include \"third_party/gpus/cuda/include/cuda/atomic\"\n #include \"xla/backends/gpu/runtime/buffer_debug_log_structs.h\"\n #include \"xla/stream_executor/cuda/cuda_platform.h\"\n-#include \"xla/stream_executor/gpu/buffer_debug_nan_count_kernel.h\"\n+#include \"xla/stream_executor/gpu/buffer_debug_float_check_kernel.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/kernel_spec.h\"\n #include \"xla/tsl/platform/logging.h\"\n@@ -123,10 +123,10 @@ __device__ void ReduceSum(const T* input, uint64_t input_size,\n // - Only a single thread block is supported.\n // - Block dimensions must be a power of 2.\n template <typename T>\n-__global__ void AppendNanCount(xla::gpu::BufferDebugLogEntryId entry_id,\n-                               const T* input, uint64_t input_size_in_bytes,\n-                               xla::gpu::BufferDebugLogHeader* log_header,\n-                               xla::gpu::BufferDebugLogEntry* log_entries) {\n+__global__ void AppendFloatCheck(xla::gpu::BufferDebugLogEntryId entry_id,\n+                                 const T* input, uint64_t input_size_in_bytes,\n+                                 xla::gpu::BufferDebugLogHeader* log_header,\n+                                 xla::gpu::BufferDebugLogEntry* log_entries) {\n   const uint32_t block_size = blockDim.x * blockDim.y * blockDim.z;\n   const uint64_t input_size = input_size_in_bytes / sizeof(T);\n   uint32_t nan_count = 0;\n@@ -195,24 +195,24 @@ __global__ void AppendNanCount(xla::gpu::BufferDebugLogEntryId entry_id,\n   }\n }\n \n-se::KernelLoaderSpec GetNanCountF32KernelSpec(int arity) {\n+se::KernelLoaderSpec GetFloatCheckF32KernelSpec(int arity) {\n   return se::KernelLoaderSpec::CreateInProcessSymbolSpec(\n-      absl::bit_cast<void*>(&AppendNanCount<float>),\n-      \"BufferDebugNanCountF32Kernel\", arity);\n+      absl::bit_cast<void*>(&AppendFloatCheck<float>),\n+      \"BufferDebugFloatCheckF32Kernel\", arity);\n }\n \n-se::KernelLoaderSpec GetNanCountBf16KernelSpec(int arity) {\n+se::KernelLoaderSpec GetFloatCheckBf16KernelSpec(int arity) {\n   return se::KernelLoaderSpec::CreateInProcessSymbolSpec(\n-      absl::bit_cast<void*>(&AppendNanCount<__nv_bfloat16>),\n-      \"BufferDebugNanCountBf16Kernel\", arity);\n+      absl::bit_cast<void*>(&AppendFloatCheck<__nv_bfloat16>),\n+      \"BufferDebugFloatCheckBf16Kernel\", arity);\n }\n \n }  // namespace\n \n GPU_KERNEL_REGISTRY_REGISTER_KERNEL_STATICALLY(\n-    BufferDebugNanCountF32Kernel, se::gpu::BufferDebugNanCountF32Kernel,\n-    se::cuda::kCudaPlatformId, GetNanCountF32KernelSpec);\n+    BufferDebugFloatCheckF32Kernel, se::gpu::BufferDebugFloatCheckF32Kernel,\n+    se::cuda::kCudaPlatformId, GetFloatCheckF32KernelSpec);\n \n GPU_KERNEL_REGISTRY_REGISTER_KERNEL_STATICALLY(\n-    BufferDebugNanCountBf16Kernel, se::gpu::BufferDebugNanCountBf16Kernel,\n-    se::cuda::kCudaPlatformId, GetNanCountBf16KernelSpec);\n+    BufferDebugFloatCheckBf16Kernel, se::gpu::BufferDebugFloatCheckBf16Kernel,\n+    se::cuda::kCudaPlatformId, GetFloatCheckBf16KernelSpec);",
            "previous_filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_nan_count_kernel_cuda.cu.cc"
        },
        {
            "sha": "33b7743feb974ce0f88fddbadbe7e7b14fbd5696",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_float_check_kernel_cuda_test.cc",
            "status": "renamed",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda_test.cc?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -29,8 +29,8 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/buffer_debug_log_structs.h\"\n #include \"xla/backends/gpu/runtime/thunk_id.h\"\n #include \"xla/stream_executor/device_memory.h\"\n+#include \"xla/stream_executor/gpu/buffer_debug_float_check_kernel.h\"\n #include \"xla/stream_executor/gpu/buffer_debug_log.h\"\n-#include \"xla/stream_executor/gpu/buffer_debug_nan_count_kernel.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/launch_dim.h\"\n #include \"xla/stream_executor/platform.h\"\n@@ -52,7 +52,7 @@ namespace {\n using xla::gpu::BufferDebugLogEntryId;\n using xla::gpu::ThunkId;\n \n-class NanCountKernelTest : public ::testing::Test {\n+class FloatCheckKernelTest : public ::testing::Test {\n  protected:\n   void SetUp() override {\n     TF_ASSERT_OK_AND_ASSIGN(platform_,\n@@ -82,7 +82,7 @@ class NanCountKernelTest : public ::testing::Test {\n   }\n \n   template <typename Kernel, typename T>\n-  absl::Status AppendNanCountOnDevice(\n+  absl::Status AppendFloatCheckOnDevice(\n       BufferDebugLogEntryId entry_id, const std::vector<T>& input,\n       se::gpu::BufferDebugLog& buffer_debug_log,\n       stream_executor::ThreadDim dim = stream_executor::ThreadDim(1, 1, 1)) {\n@@ -118,23 +118,23 @@ class NanCountKernelTest : public ::testing::Test {\n   std::unique_ptr<se::StreamExecutorMemoryAllocator> allocator_;\n };\n \n-TEST_F(NanCountKernelTest, CountsNansForF32) {\n+TEST_F(FloatCheckKernelTest, ChecksFloatsForF32) {\n   se::DeviceMemory<uint8_t> mem = executor_->AllocateArray<uint8_t>(1024);\n   std::vector<float> input = {1.0f, std::numeric_limits<float>::quiet_NaN(),\n                               2.0f, std::numeric_limits<float>::quiet_NaN()};\n   TF_ASSERT_OK_AND_ASSIGN(\n       se::gpu::BufferDebugLog device_log,\n       se::gpu::BufferDebugLog::CreateOnDevice(*stream_, mem));\n \n-  TF_EXPECT_OK(AppendNanCountOnDevice<gpu::BufferDebugNanCountF32Kernel>(\n+  TF_EXPECT_OK(AppendFloatCheckOnDevice<gpu::BufferDebugFloatCheckF32Kernel>(\n       BufferDebugLogEntryId{123}, input, device_log));\n \n   TF_ASSERT_OK_AND_ASSIGN(auto host_log, device_log.ReadFromDevice(*stream_));\n   ASSERT_GE(host_log.size(), 1);\n   EXPECT_EQ(host_log[0].value, 2);\n }\n \n-TEST_F(NanCountKernelTest, CountsNansForBf16) {\n+TEST_F(FloatCheckKernelTest, ChecksFloatsForBf16) {\n   se::DeviceMemory<uint8_t> mem = executor_->AllocateArray<uint8_t>(1024);\n   std::vector<xla::bfloat16> input = {\n       xla::bfloat16(1.0f),\n@@ -145,15 +145,15 @@ TEST_F(NanCountKernelTest, CountsNansForBf16) {\n       se::gpu::BufferDebugLog device_log,\n       se::gpu::BufferDebugLog::CreateOnDevice(*stream_, mem));\n \n-  TF_EXPECT_OK(AppendNanCountOnDevice<gpu::BufferDebugNanCountBf16Kernel>(\n+  TF_EXPECT_OK(AppendFloatCheckOnDevice<gpu::BufferDebugFloatCheckBf16Kernel>(\n       BufferDebugLogEntryId{0}, input, device_log));\n \n   TF_ASSERT_OK_AND_ASSIGN(auto host_log, device_log.ReadFromDevice(*stream_));\n   ASSERT_GE(host_log.size(), 1);\n   EXPECT_EQ(host_log[0].value, 2);\n }\n \n-TEST_F(NanCountKernelTest, CountsNansInParallel) {\n+TEST_F(FloatCheckKernelTest, ChecksFloatsInParallel) {\n   se::DeviceMemory<uint8_t> mem = executor_->AllocateArray<uint8_t>(1024);\n   std::vector<float> input(1024, 1.0f);\n   input[100] = std::numeric_limits<float>::quiet_NaN();\n@@ -164,9 +164,9 @@ TEST_F(NanCountKernelTest, CountsNansInParallel) {\n       se::gpu::BufferDebugLog device_log,\n       se::gpu::BufferDebugLog::CreateOnDevice(*stream_, mem));\n \n-  TF_EXPECT_OK(AppendNanCountOnDevice<gpu::BufferDebugNanCountF32Kernel>(\n+  TF_EXPECT_OK(AppendFloatCheckOnDevice<gpu::BufferDebugFloatCheckF32Kernel>(\n       BufferDebugLogEntryId{0}, input, device_log, se::ThreadDim(2, 4, 8)));\n-  TF_EXPECT_OK(AppendNanCountOnDevice<gpu::BufferDebugNanCountF32Kernel>(\n+  TF_EXPECT_OK(AppendFloatCheckOnDevice<gpu::BufferDebugFloatCheckF32Kernel>(\n       BufferDebugLogEntryId{0}, input, device_log, se::ThreadDim(2, 4, 8)));\n \n   TF_ASSERT_OK_AND_ASSIGN(auto host_log, device_log.ReadFromDevice(*stream_));",
            "previous_filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_nan_count_kernel_cuda_test.cc"
        },
        {
            "sha": "fdb1ea9f5fce898846c62718e81fb291f396af47",
            "filename": "third_party/xla/xla/stream_executor/gpu/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2FBUILD?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -995,8 +995,8 @@ cc_library(\n )\n \n cc_library(\n-    name = \"buffer_debug_nan_count_kernel\",\n-    hdrs = [\"buffer_debug_nan_count_kernel.h\"],\n+    name = \"buffer_debug_float_check_kernel\",\n+    hdrs = [\"buffer_debug_float_check_kernel.h\"],\n     deps = [\n         \"//xla:types\",\n         \"//xla/backends/gpu/runtime:buffer_debug_log_structs\","
        },
        {
            "sha": "3523eea627b84ffdf4b9671bc5c4af4d41f58df4",
            "filename": "third_party/xla/xla/stream_executor/gpu/buffer_debug_float_check_kernel.h",
            "status": "renamed",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fbuffer_debug_float_check_kernel.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4369fdd0a6ef4801187907ef6e83731df4661be/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fbuffer_debug_float_check_kernel.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fbuffer_debug_float_check_kernel.h?ref=d4369fdd0a6ef4801187907ef6e83731df4661be",
            "patch": "@@ -13,8 +13,8 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#ifndef XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_NAN_COUNT_KERNEL_H_\n-#define XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_NAN_COUNT_KERNEL_H_\n+#ifndef XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_FLOAT_CHECK_KERNEL_H_\n+#define XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_FLOAT_CHECK_KERNEL_H_\n \n #include <cstdint>\n \n@@ -29,14 +29,14 @@ namespace stream_executor::gpu {\n // appends it to the buffer debug log.\n //\n // This kernel MUST execute on a single thread block.\n-struct BufferDebugNanCountF32Kernel {\n+struct BufferDebugFloatCheckF32Kernel {\n   using KernelType =\n       TypedKernel<xla::gpu::BufferDebugLogEntryId, DeviceMemory<float>,\n                   uint64_t, DeviceMemory<xla::gpu::BufferDebugLogHeader>,\n                   DeviceMemory<xla::gpu::BufferDebugLogEntry>>;\n };\n \n-struct BufferDebugNanCountBf16Kernel {\n+struct BufferDebugFloatCheckBf16Kernel {\n   using KernelType = TypedKernel<xla::gpu::BufferDebugLogEntryId,\n                                  DeviceMemory<Eigen::bfloat16>, uint64_t,\n                                  DeviceMemory<xla::gpu::BufferDebugLogHeader>,\n@@ -45,4 +45,4 @@ struct BufferDebugNanCountBf16Kernel {\n \n }  // namespace stream_executor::gpu\n \n-#endif  // XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_NAN_COUNT_KERNEL_H_\n+#endif  // XLA_STREAM_EXECUTOR_GPU_BUFFER_DEBUG_FLOAT_CHECK_KERNEL_H_",
            "previous_filename": "third_party/xla/xla/stream_executor/gpu/buffer_debug_nan_count_kernel.h"
        }
    ],
    "stats": {
        "total": 243,
        "additions": 125,
        "deletions": 118
    }
}