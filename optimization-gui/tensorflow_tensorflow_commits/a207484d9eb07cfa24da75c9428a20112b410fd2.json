{
    "author": "fengwuyao",
    "message": "Update to use half data type in split.\n\nPiperOrigin-RevId: 845906959",
    "sha": "a207484d9eb07cfa24da75c9428a20112b410fd2",
    "files": [
        {
            "sha": "ba3ce1c9e0b9e81d15faa1ae1dc2745ed8b6fe60",
            "filename": "tensorflow/lite/testing/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftesting%2FBUILD?ref=a207484d9eb07cfa24da75c9428a20112b410fd2",
            "patch": "@@ -275,6 +275,7 @@ cc_library(\n     hdrs = [\"split.h\"],\n     deps = [\n         \"//tensorflow/lite:string\",\n+        \"//tensorflow/lite/types:half\",\n         \"@eigen_archive//:eigen3\",\n     ],\n )\n@@ -286,7 +287,9 @@ cc_test(\n     deps = [\n         \":split\",\n         \"//tensorflow/lite:string\",\n+        \"//tensorflow/lite/types:half\",\n         \"@com_google_googletest//:gtest_main\",\n+        \"@eigen_archive//:eigen3\",\n     ],\n )\n \n@@ -333,6 +336,7 @@ cc_library(\n         \"//tensorflow/lite/tools:logging\",\n         \"//tensorflow/lite/tools/delegates:delegate_provider_hdr\",\n         \"//tensorflow/lite/tools/evaluation:utils\",\n+        \"//tensorflow/lite/types:half\",\n         \"@com_google_absl//absl/strings\",\n         \"@eigen_archive//:eigen3\",\n     ] + select({"
        },
        {
            "sha": "5431bccf1a72f662acd387e8e686b5146bdc9dca",
            "filename": "tensorflow/lite/testing/split.h",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Fsplit.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Fsplit.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftesting%2Fsplit.h?ref=a207484d9eb07cfa24da75c9428a20112b410fd2",
            "patch": "@@ -25,6 +25,7 @@ limitations under the License.\n \n #include \"Eigen/Core\"  // from @eigen_archive\n #include \"tensorflow/lite/string_type.h\"\n+#include \"tensorflow/lite/types/half.h\"\n \n namespace tflite {\n namespace testing {\n@@ -199,12 +200,10 @@ inline std::vector<std::complex<double>> Split(const string& s,\n }\n \n template <>\n-inline std::vector<Eigen::half> Split(const string& s,\n-                                      const string& delimiter) {\n-  std::vector<Eigen::half> fields;\n+inline std::vector<half> Split(const string& s, const string& delimiter) {\n+  std::vector<half> fields;\n   for (const auto& p : SplitToPos(s, delimiter)) {\n-    fields.push_back(Eigen::half_impl::float_to_half_rtne(\n-        strtof(s.data() + p.first, nullptr)));\n+    fields.push_back(static_cast<half>(strtof(s.data() + p.first, nullptr)));\n   }\n   return fields;\n }"
        },
        {
            "sha": "90b8276b3ed65424022f0e42b7009362cd538786",
            "filename": "tensorflow/lite/testing/split_test.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Fsplit_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Fsplit_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftesting%2Fsplit_test.cc?ref=a207484d9eb07cfa24da75c9428a20112b410fd2",
            "patch": "@@ -16,7 +16,9 @@ limitations under the License.\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"Eigen/Core\"  // from @eigen_archive\n #include \"tensorflow/lite/string_type.h\"\n+#include \"tensorflow/lite/types/half.h\"\n \n namespace tflite {\n namespace testing {\n@@ -45,6 +47,17 @@ TEST(SplitTest, SplitFloat) {\n   EXPECT_THAT(Split<float>(\"1.0 B 1e-5\", \" \"), ElementsAre(1.0, 0.0, 1e-5));\n }\n \n+TEST(SplitTest, SplitHalf) {\n+  EXPECT_THAT(Split<half>(\"1.0 2.5 1e-2\", \" \"),\n+              ElementsAre(half(1.0f), half(2.5f), half(0.01f)));\n+}\n+\n+TEST(SplitTest, SplitBfloat16) {\n+  EXPECT_THAT(Split<Eigen::bfloat16>(\"1.0 2.5 1e-2\", \" \"),\n+              ElementsAre(Eigen::bfloat16(1.0f), Eigen::bfloat16(2.5f),\n+                          Eigen::bfloat16(0.01f)));\n+}\n+\n TEST(SplitTest, SplitInt) {\n   EXPECT_THAT(Split<int>(\"1,-1,258\", \",\"), ElementsAre(1, -1, 258));\n }"
        },
        {
            "sha": "5b15e6a6ed0ee52b6a63b82758d4e6ac1088c66a",
            "filename": "tensorflow/lite/testing/tflite_driver.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Ftflite_driver.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a207484d9eb07cfa24da75c9428a20112b410fd2/tensorflow%2Flite%2Ftesting%2Ftflite_driver.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftesting%2Ftflite_driver.cc?ref=a207484d9eb07cfa24da75c9428a20112b410fd2",
            "patch": "@@ -36,6 +36,7 @@ limitations under the License.\n #include \"tensorflow/lite/testing/result_expectations.h\"\n #include \"tensorflow/lite/tools/delegates/delegate_provider.h\"\n #include \"tensorflow/lite/tools/logging.h\"\n+#include \"tensorflow/lite/types/half.h\"\n #if !defined(__APPLE__)\n #include \"tensorflow/lite/delegates/flex/delegate.h\"\n #endif\n@@ -405,11 +406,11 @@ void TfLiteDriver::SetInput(const std::string& name,\n       break;\n     }\n     case kTfLiteFloat16: {\n-      const auto& values = testing::Split<Eigen::half>(csv_values, \",\");\n+      const auto& values = testing::Split<half>(csv_values, \",\");\n       for (auto k : values) {\n         TFLITE_LOG(INFO) << \"input\" << k;\n       }\n-      if (!CheckSizes<Eigen::half>(tensor->bytes, values.size())) return;\n+      if (!CheckSizes<half>(tensor->bytes, values.size())) return;\n       SetTensorData(values, tensor->data.raw);\n       break;\n     }\n@@ -500,7 +501,7 @@ void TfLiteDriver::SetExpectation(const std::string& name,\n       expected_output_[id]->SetData<std::complex<double>>(csv_values);\n       break;\n     case kTfLiteFloat16:\n-      expected_output_[id]->SetData<Eigen::half>(csv_values);\n+      expected_output_[id]->SetData<half>(csv_values);\n       break;\n     case kTfLiteBFloat16:\n       expected_output_[id]->SetData<Eigen::bfloat16>(csv_values);"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 25,
        "deletions": 8
    }
}