{
    "author": "hawkinsp",
    "message": "Remove uses of HloModuleGroup.\n\nPiperOrigin-RevId: 814396797",
    "sha": "e219ddea1842f426c7c07dcb25b0f8e7920a4303",
    "files": [
        {
            "sha": "02321de153252d1e8c093693569d1b436bf73ed5",
            "filename": "third_party/xla/xla/hlo/testlib/hlo_hardware_independent_test_base.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.cc?ref=e219ddea1842f426c7c07dcb25b0f8e7920a4303",
            "patch": "@@ -271,40 +271,6 @@ void HloHardwareIndependentTestBase::RunAndFilecheckHloRewrite(\n                             hlo_with_checks, after_pass_checks, config);\n }\n \n-void HloHardwareIndependentTestBase::RunAndFilecheckHloModuleGroupRewrite(\n-    absl::Span<const absl::string_view> hlo_module_strs,\n-    HloPassInterface&& hlo_pass,\n-    std::optional<absl::Span<const absl::string_view>> expected) const {\n-  std::vector<std::unique_ptr<HloModule>> modules;\n-  for (absl::string_view hlo : hlo_module_strs) {\n-    TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<VerifiedHloModule> module,\n-                            ParseAndReturnVerifiedModule(hlo));\n-    modules.push_back(std::move(module));\n-  }\n-  HloModuleGroup module_group(\"test_input_module_group\", std::move(modules));\n-\n-  TF_ASSERT_OK_AND_ASSIGN(bool changed,\n-                          RunHloPass(std::move(hlo_pass), &module_group));\n-  EXPECT_EQ(changed, expected.has_value()) << module_group.ToString();\n-\n-  if (!changed) {\n-    return;\n-  }\n-\n-  EXPECT_THAT(module_group.modules(),\n-              ::testing::SizeIs(expected.value().size()));\n-  int index = 0;\n-  for (auto expected_str : expected.value()) {\n-    TF_ASSERT_OK_AND_ASSIGN(\n-        bool filecheck_matches,\n-        RunFileCheck(module_group.module(index).ToString(\n-                         HloPrintOptions().set_print_large_constants(true)),\n-                     expected_str));\n-    EXPECT_TRUE(filecheck_matches) << module_group.module(index).ToString();\n-    index++;\n-  }\n-}\n-\n absl::StatusOr<std::unique_ptr<HloModule>>\n HloHardwareIndependentTestBase::RunAndCheckHloRewrite(\n     absl::string_view hlo_template, HloPassInterface* hlo_pass,"
        },
        {
            "sha": "a749e285e7e94b0706bd2cd3952dd094ca1a8efe",
            "filename": "third_party/xla/xla/hlo/testlib/hlo_hardware_independent_test_base.h",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftestlib%2Fhlo_hardware_independent_test_base.h?ref=e219ddea1842f426c7c07dcb25b0f8e7920a4303",
            "patch": "@@ -176,13 +176,6 @@ class HloHardwareIndependentTestBase : public ::testing::Test {\n       std::function<void(HloModule*)> after_pass_checks = nullptr,\n       const HloModuleConfig* config = nullptr) const;\n \n-  // Runs pass `hlo_pass` on a group of input HLO modules `hlo_module_strs`,\n-  // and FileChecks the result against `expected`.\n-  void RunAndFilecheckHloModuleGroupRewrite(\n-      absl::Span<const absl::string_view> hlo_module_strs,\n-      HloPassInterface&& hlo_pass,\n-      std::optional<absl::Span<const absl::string_view>> expected) const;\n-\n   using FixedMapping =\n       std::initializer_list<std::pair<absl::string_view, absl::string_view>>;\n "
        },
        {
            "sha": "e6ce223bbe357c547c5ed4b8219dadae020dc397",
            "filename": "third_party/xla/xla/python/hlo_pass.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 34,
            "changes": 37,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fpython%2Fhlo_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Fpython%2Fhlo_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fhlo_pass.cc?ref=e219ddea1842f426c7c07dcb25b0f8e7920a4303",
            "patch": "@@ -36,44 +36,13 @@ namespace xla {\n namespace {\n \n NB_MODULE(_hlo_pass, m) {\n-  nb::class_<HloModuleGroup> hlo_module_group_class(m, \"HloModuleGroup\");\n-  hlo_module_group_class\n-      .def(\"__init__\",\n-           [](HloModuleGroup* self, const std::string& name,\n-              const std::vector<std::shared_ptr<HloModule>>& hlo_modules) {\n-             std::vector<std::unique_ptr<HloModule>> modules;\n-             modules.reserve(hlo_modules.size());\n-             for (const auto& m : hlo_modules) {\n-               modules.push_back(m->Clone(/*suffix=*/\"\"));\n-             }\n-             new (self) HloModuleGroup(name, std::move(modules));\n-           })\n-      .def_prop_ro(\"name\", &HloModuleGroup::name)\n-      .def(\"to_string\", &HloModuleGroup::ToString)\n-      .def(\"to_modules\",\n-           [](HloModuleGroup& m) -> std::vector<std::shared_ptr<HloModule>> {\n-             std::vector<std::unique_ptr<HloModule>> modules =\n-                 m.ConsumeModules();\n-             std::vector<std::shared_ptr<HloModule>> shared_modules;\n-             shared_modules.reserve(modules.size());\n-             for (auto& module : modules) {\n-               shared_modules.push_back(std::move(module));\n-             }\n-             return shared_modules;\n-           });\n-\n   // Hlo Module Passes\n   nb::class_<HloPassInterface> hlo_pass_interface(m, \"HloPassInterface\");\n   hlo_pass_interface.def_prop_ro(\"name\", &HloPassInterface::name)\n       .def(\"is_pass_pipeline\", &HloPassInterface::IsPassPipeline)\n-      .def(\"run\",\n-           [](HloPassInterface& pass, HloModule* module) -> bool {\n-             return xla::ValueOrThrow(pass.Run(module));\n-           })\n-      .def(\"run_on_module_group\",\n-           [](HloPassInterface& pass, HloModuleGroup* module_group) -> bool {\n-             return xla::ValueOrThrow(pass.RunOnModuleGroup(module_group));\n-           });\n+      .def(\"run\", [](HloPassInterface& pass, HloModule* module) -> bool {\n+        return xla::ValueOrThrow(pass.Run(module));\n+      });\n \n   nb::class_<HloDCE, HloPassInterface>(m, \"HloDCE\").def(nb::init<>());\n   nb::class_<CallInliner, HloPassInterface>(m, \"CallInliner\").def(nb::init<>());"
        },
        {
            "sha": "d6a71b2f93a82a1c8d03363af9560a033d6f34ba",
            "filename": "third_party/xla/xla/tests/llvm_compiler_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Ftests%2Fllvm_compiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e219ddea1842f426c7c07dcb25b0f8e7920a4303/third_party%2Fxla%2Fxla%2Ftests%2Fllvm_compiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fllvm_compiler_test.cc?ref=e219ddea1842f426c7c07dcb25b0f8e7920a4303",
            "patch": "@@ -85,23 +85,5 @@ TEST_F(LLVMCompilerTest, HooksTest) {\n   EXPECT_EQ(1, post_opt_hook_call_count);\n }\n \n-TEST_F(LLVMCompilerTest, DISABLED_MultiModuleCompilation) {\n-  auto hlo_module = ParseAndReturnVerifiedModule(kHloText).value();\n-  auto hlo_module2 = ParseAndReturnVerifiedModule(kHloText).value();\n-  std::vector<std::unique_ptr<HloModule>> modules;\n-  modules.push_back(std::move(hlo_module));\n-  modules.push_back(std::move(hlo_module2));\n-  auto module_group =\n-      std::make_unique<HloModuleGroup>(\"test_module_group\", std::move(modules));\n-\n-  std::vector<std::vector<se::StreamExecutor*>> executors;\n-  executors.push_back({backend().default_stream_executor()});\n-  executors.push_back({backend().default_stream_executor()});\n-\n-  EXPECT_IS_OK(backend().compiler()->Compile(std::move(module_group),\n-                                             std::move(executors),\n-                                             backend().memory_allocator()));\n-}\n-\n }  // namespace\n }  // namespace xla"
        }
    ],
    "stats": {
        "total": 96,
        "additions": 3,
        "deletions": 93
    }
}