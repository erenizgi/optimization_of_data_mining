{
    "author": "ZixuanJiang",
    "message": "Add `PrintArray` and `ArrayToString` methods to `IotaTileAssignment` and `TileAssignment`.\n\nThese new methods allow printing or converting to a string only the array representation of the tile assignment, without including the tile dimensions. The existing `Print` and `ToString` methods are updated to use these new array-specific printing functions.\n\nPiperOrigin-RevId: 824816702",
    "sha": "85d834e07b39d119da0f407338d65d29f82b4c22",
    "files": [
        {
            "sha": "8de2bd1fda8bebaee22aa8985f4a67409c88e118",
            "filename": "third_party/xla/xla/hlo/ir/tile_assignment.cc",
            "status": "modified",
            "additions": 40,
            "deletions": 7,
            "changes": 47,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.cc?ref=85d834e07b39d119da0f407338d65d29f82b4c22",
            "patch": "@@ -126,10 +126,14 @@ TransposeKind GetTransposeKind(absl::Span<const int64_t> dims,\n   for (int i = 0; i < perm.size(); ++i) {\n     const auto& d = perm[i];\n     if (dims[d] == 1) {\n-      if (d != i && dims[i] != 1) kind = TransposeKind::kReshape;\n+      if (d != i && dims[i] != 1) {\n+        kind = TransposeKind::kReshape;\n+      }\n       continue;\n     }\n-    if (d <= prev_non_one_dim) return TransposeKind::kTranspose;\n+    if (d <= prev_non_one_dim) {\n+      return TransposeKind::kTranspose;\n+    }\n     prev_non_one_dim = d;\n   }\n   return kind;\n@@ -268,7 +272,9 @@ std::optional<IotaTileAssignment> IotaTileAssignment::Transpose(\n   DCHECK_EQ(ndims_, perm.size());\n   auto dims = this->dims();\n   const TransposeKind kind = GetTransposeKind(dims, perm);\n-  if (kind == TransposeKind::kNoop) return *this;\n+  if (kind == TransposeKind::kNoop) {\n+    return *this;\n+  }\n   absl::InlinedVector<int64_t, 6> new_dims(ndims_);\n   for (int64_t i = 0; i < ndims_; ++i) {\n     new_dims[i] = dims[perm[i]];\n@@ -304,7 +310,9 @@ std::optional<IotaTileAssignment> IotaTileAssignment::Transpose(\n     absl::InlinedVector<int, 6> new_perm;\n     new_perm.reserve(non_one_dims.size());\n     for (int i = 0; i < ndims_; ++i) {\n-      if (dims[perm[i]] == 1) continue;\n+      if (dims[perm[i]] == 1) {\n+        continue;\n+      }\n       new_perm.push_back(transpose_perm[one_to_non_one[perm[i]]]);\n     }\n     CHECK_EQ(reshape_ndims_, new_perm.size());\n@@ -430,10 +438,8 @@ std::optional<IotaTileAssignment> IotaTileAssignment::Transpose(\n                                     flattened_transpose_perm);\n }\n \n-void IotaTileAssignment::Print(Printer* printer) const {\n+void IotaTileAssignment::PrintArray(Printer* printer) const {\n   printer->Append(\"[\");\n-  AppendJoin(printer, dims(), \",\");\n-  printer->Append(\"]<=[\");\n   AppendJoin(printer, reshape_dims(), \",\");\n   printer->Append(\"]\");\n   if (reshape_ndims_ > 1) {\n@@ -443,6 +449,19 @@ void IotaTileAssignment::Print(Printer* printer) const {\n   }\n }\n \n+void IotaTileAssignment::Print(Printer* printer) const {\n+  printer->Append(\"[\");\n+  AppendJoin(printer, dims(), \",\");\n+  printer->Append(\"]<=\");\n+  PrintArray(printer);\n+}\n+\n+std::string IotaTileAssignment::ArrayToString() const {\n+  StringPrinter printer;\n+  PrintArray(&printer);\n+  return std::move(printer).ToString();\n+}\n+\n std::string IotaTileAssignment::ToString() const {\n   StringPrinter printer;\n   Print(&printer);\n@@ -608,6 +627,14 @@ absl::Status TileAssignment::EachStatus(\n   return TileAssignment(std::move(cloned_array));\n }\n \n+void TileAssignment::PrintArray(Printer* printer) const {\n+  if (iota_) {\n+    iota_->PrintArray(printer);\n+  } else {\n+    AppendJoin(printer, array(), \",\");\n+  }\n+}\n+\n void TileAssignment::Print(Printer* printer) const {\n   if (iota_) {\n     printer->Append(\"devices=\");\n@@ -620,6 +647,12 @@ void TileAssignment::Print(Printer* printer) const {\n   }\n }\n \n+std::string TileAssignment::ArrayToString() const {\n+  StringPrinter printer;\n+  PrintArray(&printer);\n+  return std::move(printer).ToString();\n+}\n+\n std::string TileAssignment::ToString() const {\n   StringPrinter printer;\n   Print(&printer);"
        },
        {
            "sha": "efaa959692ca4486643124b65304f642792d4c0d",
            "filename": "third_party/xla/xla/hlo/ir/tile_assignment.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment.h?ref=85d834e07b39d119da0f407338d65d29f82b4c22",
            "patch": "@@ -110,8 +110,10 @@ class IotaTileAssignment {\n   std::optional<IotaTileAssignment> Transpose(absl::Span<const int> perm) const;\n \n   void Print(Printer* printer) const;\n+  void PrintArray(Printer* printer) const;\n \n   std::string ToString() const;\n+  std::string ArrayToString() const;\n \n   // Materializes array representation of IotaTileAssignment.\n   Array<int64_t> ToArray() const;\n@@ -249,8 +251,10 @@ class TileAssignment {\n   [[nodiscard]] TileAssignment Transpose(absl::Span<const int> perm) const;\n \n   void Print(Printer* printer) const;\n+  void PrintArray(Printer* printer) const;\n \n   std::string ToString() const;\n+  std::string ArrayToString() const;\n \n   bool UsesDevice(int64_t device) const;\n "
        },
        {
            "sha": "fae834f0ca668932f1001709ab3d80582c0372de",
            "filename": "third_party/xla/xla/hlo/ir/tile_assignment_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/85d834e07b39d119da0f407338d65d29f82b4c22/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Ftile_assignment_test.cc?ref=85d834e07b39d119da0f407338d65d29f82b4c22",
            "patch": "@@ -17,7 +17,6 @@ limitations under the License.\n \n #include <cstdint>\n #include <memory>\n-#include <string>\n #include <utility>\n #include <vector>\n \n@@ -146,22 +145,24 @@ TEST(IotaTileAssignmentTest, ValueAt) {\n \n TEST(IotaTileAssignmentTest, ToString) {\n   IotaTileAssignment iota = IotaTileAssignment::Create({2, 3});\n+  EXPECT_EQ(iota.ArrayToString(), \"[6]\");\n   EXPECT_EQ(iota.ToString(), \"[2,3]<=[6]\");\n \n   IotaTileAssignment iota2 = IotaTileAssignment::Create({2, 6}, {3, 4}, {0, 1});\n+  EXPECT_EQ(iota2.ArrayToString(), \"[12]\");\n   EXPECT_EQ(iota2.ToString(), \"[2,6]<=[12]\");\n \n   IotaTileAssignment iota3 =\n       IotaTileAssignment::Create({3, 4, 5}, {3, 4, 5}, {2, 0, 1});\n+  EXPECT_EQ(iota3.ArrayToString(), \"[12,5]T(1,0)\");\n   EXPECT_EQ(iota3.ToString(), \"[3,4,5]<=[12,5]T(1,0)\");\n }\n \n TEST(TileAssignmentTest, FromIota) {\n   IotaTileAssignment iota = IotaTileAssignment::Create({2, 3});\n   TileAssignment tile_assignment(iota);\n-  std::string prefix(\"devices=\");\n \n-  EXPECT_EQ(tile_assignment.ToString().compare(0, prefix.size(), prefix), 0);\n+  EXPECT_EQ(tile_assignment.ToString(), \"devices=[2,3]<=[6]\");\n   EXPECT_EQ(tile_assignment.dimensions(),\n             absl::MakeConstSpan(std::vector<int64_t>{2, 3}));\n   EXPECT_EQ(tile_assignment.num_elements(), 6);\n@@ -171,9 +172,9 @@ TEST(TileAssignmentTest, FromIota) {\n TEST(TileAssignmentTest, FromArray) {\n   Array2D<int64_t> array({{0, 1}, {2, 3}});\n   TileAssignment tile_assignment(std::make_shared<Array<int64_t>>(array));\n-  std::string prefix(\"devices=\");\n \n-  EXPECT_EQ(tile_assignment.ToString().compare(0, prefix.size(), prefix), 0);\n+  EXPECT_EQ(tile_assignment.ToString(), \"devices=[2,2]0,1,2,3\");\n+  EXPECT_EQ(tile_assignment.ArrayToString(), \"0,1,2,3\");\n   EXPECT_EQ(tile_assignment.dimensions(),\n             absl::MakeConstSpan(std::vector<int64_t>{2, 2}));\n   EXPECT_EQ(tile_assignment.num_elements(), 4);"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 50,
        "deletions": 12
    }
}