{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@cb2f0d0a5f14\n\nUpdates LLVM usage to match\n[cb2f0d0a5f14](https://github.com/llvm/llvm-project/commit/cb2f0d0a5f14)\n\nPiperOrigin-RevId: 802610159",
    "sha": "cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
    "files": [
        {
            "sha": "4cbe21b73f62c3d4b38ef7b4e26bfa472ac04504",
            "filename": "tensorflow/compiler/mlir/tools/kernel_gen/transforms/tf_framework_legalize_to_llvm.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
            "patch": "@@ -516,12 +516,10 @@ class NullMemRefOpConverter : public ConvertOpToLLVMPattern<NullMemRefOp> {\n     // Due to the current way of handling unranked memref results escaping, we\n     // have to actually construct a ranked underlying descriptor instead of just\n     // setting its pointer to NULL.\n-    SmallVector<Value, 4> sizes;\n-    UnrankedMemRefDescriptor::computeSizes(rewriter, loc, *getTypeConverter(),\n-                                           desc, addressSpace, sizes);\n+    Value alloca_size = UnrankedMemRefDescriptor::computeSize(\n+        rewriter, loc, *getTypeConverter(), desc, addressSpace);\n     Value underlying_desc_ptr = rewriter.create<LLVM::AllocaOp>(\n-        loc, getVoidPtrType(), IntegerType::get(getContext(), 8),\n-        sizes.front());\n+        loc, getVoidPtrType(), IntegerType::get(getContext(), 8), alloca_size);\n \n     // Populate underlying ranked descriptor.\n     Value null = rewriter.create<LLVM::ZeroOp>(loc, llvm_ptr_type);"
        },
        {
            "sha": "b480cc763017ae784e055b46f006abe297a72d76",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 1836,
            "deletions": 237,
            "changes": 2073,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf"
        },
        {
            "sha": "ed69d9f32b5f3f624ab21abedca9857b2326e5ab",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"fc44a4fcd3c54be927c15ddd9211aca1501633e7\"\n-    LLVM_SHA256 = \"d228aebe5583c69c4e48fd7a8e149e3d22ee6dafaeae94009467143d32d9bfc4\"\n+    LLVM_COMMIT = \"cb2f0d0a5f14c183e7182aba0f0e54a518de9e3f\"\n+    LLVM_SHA256 = \"e8ece380fdb57dc6f8e42df9db872a1ade5056c5379075e3e2f99c89200aea69\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "3c303417871c057f8c1d11df600e06c5f4f7ec24",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 2069,
            "deletions": 4641,
            "changes": 6710,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf"
        },
        {
            "sha": "baa2d9385b400be423253e456304db9e189593e6",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"e99cfa73916a8758e35015d61767ba7e986fc79d\"\n-    SHARDY_SHA256 = \"973ba2b5c77337157e37ff331a111873ac6eddf9831555b3c18391e910673a6d\"\n+    SHARDY_COMMIT = \"77d9192e7cf10ad63821f9a5200d1d7fa34f2328\"\n+    SHARDY_SHA256 = \"af8b36bfe0a3b3e7427a86da005e4f2b0f3a0a464359dc0163d114d0f6156c53\"\n \n     tf_http_archive(\n         name = \"shardy\","
        },
        {
            "sha": "f94d85a1689c3200de9888f5afe987cc5e0df1f9",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl801607173.patch",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
            "patch": "@@ -0,0 +1,41 @@\n+\n+--- a/third_party/amd/lib/TritonAMDGPUToLLVM/AtomicRMWOpsEmitter.cpp\t2025-07-31 00:13:23.000000000 -0700\n++++ b/third_party/amd/lib/TritonAMDGPUToLLVM/AtomicRMWOpsEmitter.cpp\t2025-08-31 17:53:42.000000000 -0700\n+@@ -405,12 +405,31 @@\n+   Value mask = targetInfo.ballot(rewriter, loc, i64_ty, done);\n+   Value start = loopBody->getArgument(0);\n+   Value cnt = b.trunc(i32_ty, generatePopcount64(rewriter, mask));\n+-  Value mbcntLoRes = rewriter\n+-                         .create<ROCDL::MbcntLoOp>(\n+-                             loc, i32_ty, b.trunc(i32_ty, mask), b.i32_val(0))\n+-                         ->getResult(0);\n+-  Value idx = rewriter.create<ROCDL::MbcntHiOp>(\n+-      loc, i32_ty, b.trunc(i32_ty, b.lshr(mask, b.i64_val(32))), mbcntLoRes);\n++\n++  NamedAttribute noundef = rewriter.getNamedAttr(\n++      LLVM::LLVMDialect::getNoUndefAttrName(), rewriter.getUnitAttr());\n++  NamedAttribute lowRange = rewriter.getNamedAttr(\n++      LLVM::LLVMDialect::getRangeAttrName(),\n++      LLVM::ConstantRangeAttr::get(rewriter.getContext(), APInt::getZero(32),\n++                                   APInt(32, 32)));\n++  NamedAttribute highRange = rewriter.getNamedAttr(\n++      LLVM::LLVMDialect::getRangeAttrName(),\n++      LLVM::ConstantRangeAttr::get(rewriter.getContext(), APInt::getZero(32),\n++                                   APInt(32, 64)));\n++\n++  Value mbcntLoRes =\n++      ROCDL::MbcntLoOp::create(\n++          rewriter, loc, i32_ty, b.trunc(i32_ty, mask), b.i32_val(0),\n++          /*arg_attrs=*/{},\n++          /*res_attrs=*/\n++          rewriter.getArrayAttr(\n++              rewriter.getDictionaryAttr({noundef, lowRange})))\n++          ->getResult(0);\n++  Value idx = ROCDL::MbcntHiOp::create(\n++      rewriter, loc, i32_ty, b.trunc(i32_ty, b.lshr(mask, b.i64_val(32))),\n++      mbcntLoRes,\n++      /*arg_attrs=*/{},\n++      rewriter.getArrayAttr(rewriter.getDictionaryAttr({noundef, highRange})));\n+   Value base = b.add(start, cnt);\n+   Value leader = b.icmp_eq(idx, b.i32_val(0));\n+   cnt = b.sub(cnt, idx);"
        },
        {
            "sha": "fecb1f1dfac00a0f277c363e7a1e9615b4cf0809",
            "filename": "third_party/xla/third_party/triton/llvm_integration/series.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl?ref=cef8ac90fb0eda7a4f34c3ac98137029e53ecdcf",
            "patch": "@@ -8,5 +8,6 @@ LLVM nor MLIR integrator, please do not add any patches to this list.\n \"\"\"\n \n llvm_patch_list = [\n+    \"//third_party/triton:llvm_integration/cl801607173.patch\",\n     # Add new patches just above this line\n ]"
        }
    ],
    "stats": {
        "total": 8841,
        "additions": 3954,
        "deletions": 4887
    }
}