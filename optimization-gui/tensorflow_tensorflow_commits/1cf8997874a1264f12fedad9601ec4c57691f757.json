{
    "author": "tensorflower-gardener",
    "message": "Added unit test for the type change of OpSourceInfo::source_file from string_view to std::string which was done to avoid dangling references potentially avoiding use-after-free crashes.\n\nPiperOrigin-RevId: 842498608",
    "sha": "1cf8997874a1264f12fedad9601ec4c57691f757",
    "files": [
        {
            "sha": "e4c3349f5bc75cf68e9495578da97bc780fd6d88",
            "filename": "third_party/xla/xla/tsl/profiler/convert/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1cf8997874a1264f12fedad9601ec4c57691f757/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1cf8997874a1264f12fedad9601ec4c57691f757/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2FBUILD?ref=1cf8997874a1264f12fedad9601ec4c57691f757",
            "patch": "@@ -58,6 +58,7 @@ tsl_cc_test(\n     deps = [\n         \":xla_op_utils\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )"
        },
        {
            "sha": "c3415879c313c4b8cc9597e4b0a1ea162f5d5f7a",
            "filename": "third_party/xla/xla/tsl/profiler/convert/xla_op_utils_test.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1cf8997874a1264f12fedad9601ec4c57691f757/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2Fxla_op_utils_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1cf8997874a1264f12fedad9601ec4c57691f757/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2Fxla_op_utils_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fconvert%2Fxla_op_utils_test.cc?ref=1cf8997874a1264f12fedad9601ec4c57691f757",
            "patch": "@@ -15,13 +15,19 @@ limitations under the License.\n \n #include \"xla/tsl/profiler/convert/xla_op_utils.h\"\n \n+#include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/tsl/platform/test.h\"\n \n namespace tsl {\n namespace profiler {\n namespace {\n \n+using ::testing::AllOf;\n+using ::testing::Field;\n+using ::testing::Property;\n+\n TEST(XlaOpUtilsTest, HloModuleNameWithProgramId) {\n   EXPECT_EQ(\"module(123)\", HloModuleNameWithProgramId(\"module\", 123));\n }\n@@ -74,6 +80,22 @@ TEST(XlaOpUtilsTest, IsXlaArgsOrRetvals) {\n   EXPECT_FALSE(IsXlaArgsOrRetvals(\"op_name\"));\n }\n \n+// Tests that OpSourceInfo members are std::string and capable of owning\n+// the string data. If the members were absl::string_view, this test would\n+// fail due to dangling references.\n+TEST(XlaOpUtilsTest, OpSourceInfo) {\n+  OpSourceInfo op_source_info = {\n+      .source_file = absl::StrCat(\"file\", \".cc\"),\n+      .source_line = 10,\n+      .stack_frame = absl::StrCat(\"frame1\", \"\\n\", \"frame2\"),\n+  };\n+  EXPECT_THAT(op_source_info,\n+              AllOf(Field(&OpSourceInfo::source_file, \"file.cc\"),\n+                    Field(&OpSourceInfo::stack_frame, \"frame1\\nframe2\"),\n+                    Property(&OpSourceInfo::GetSourceTopLine, \"file.cc:10\"),\n+                    Property(&OpSourceInfo::GetSourceStack, \"frame1\\nframe2\")));\n+}\n+\n }  // namespace\n }  // namespace profiler\n }  // namespace tsl"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 23,
        "deletions": 0
    }
}