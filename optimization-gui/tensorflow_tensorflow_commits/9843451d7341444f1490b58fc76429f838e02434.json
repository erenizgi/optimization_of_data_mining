{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Add a button to toggle the visibility of unchanged HLO instructions.\n\nPiperOrigin-RevId: 797524492",
    "sha": "9843451d7341444f1490b58fc76429f838e02434",
    "files": [
        {
            "sha": "0182f9374dc04bccc687e1c1fa1628015747f35e",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/render/hlo_gumgraph_html_renderer.cc",
            "status": "modified",
            "additions": 52,
            "deletions": 8,
            "changes": 60,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9843451d7341444f1490b58fc76429f838e02434/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9843451d7341444f1490b58fc76429f838e02434/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc?ref=9843451d7341444f1490b58fc76429f838e02434",
            "patch": "@@ -212,12 +212,14 @@ std::string PrintCss() {\n       color: #999999;\n     }\n \n+    span.hlo-instruction {\n+      display: inline-block;\n+    }\n     span.hlo-instruction:hover {\n-      border: 1px solid #4285F4;\n+      border: 2px solid #4285F4;\n     }\n-\n     span.bordered {\n-      border: 1px solid #4285F4;\n+      border: 2px solid #4285F4;\n     }\n \n     span.red-highlight {\n@@ -230,6 +232,23 @@ std::string PrintCss() {\n       background-color: #feefc3;\n     }\n \n+    .hlo-instruction.hidden {\n+      display: none;\n+    }\n+    button {\n+      background-color: #3f51b5;\n+      color: white;\n+      font-weight: bold;\n+      padding: 0.2rem 0.5rem;\n+      margin-left: 1rem;\n+      border-radius: 0.5rem;\n+      transition: all 0.2s ease-in-out;\n+      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);\n+    }\n+    button:hover {\n+      transform: translateY(-1px) scale(1.02);\n+    }\n+\n     </style>\n   )html\";\n }\n@@ -293,6 +312,24 @@ std::string PrintJavascriptForHoverEvent() {\n   )html\";\n }\n \n+std::string PrintJavascriptForToggleButton() {\n+  return R\"html(\n+  <script>\n+  const toggleButton = document.getElementById('toggleButton');\n+    const hloInstructions = document.querySelectorAll('.hlo-instruction:not(.highlighted)');\n+    let isHidden = false;\n+\n+    toggleButton.addEventListener('click', () => {\n+      isHidden = !isHidden;\n+      hloInstructions.forEach(instruction => {\n+        instruction.classList.toggle('hidden', isHidden);\n+      });\n+      toggleButton.textContent = isHidden ? 'Show Unchanged Instructions' : 'Hide Unchanged Instructions';\n+    });\n+  </script>\n+  )html\";\n+}\n+\n // Escapes the string for html attribute.\n std::string EscapeStringForHtmlAttribute(absl::string_view str) {\n   std::string escaped_str;\n@@ -376,6 +413,12 @@ std::string PrintAttributesList(absl::Span<const std::string> items) {\n                   {\"attributes-list\"});\n }\n \n+// Prints a button\n+std::string PrintButton(absl::string_view id, absl::string_view text) {\n+  return absl::StrFormat(\n+      R\"html(<button id=\"%s\" class=\"button\">%s</button>)html\", id, text);\n+}\n+\n // The position of the tooltip.\n enum class TooltipPosition : std::uint8_t { kLeft, kRight };\n \n@@ -487,12 +530,11 @@ std::string PrintHloComputationToHtml(\n         comp->MakeInstructionPostOrder();\n     for (const HloInstruction* instruction : instruction_order) {\n       DCHECK_EQ(comp, instruction->parent());\n-      printer.Append(\"  \");  // Instruction indentation (2 spaces)\n \n       auto it = span_attributes.find(instruction);\n       std::string highlight_class =\n           it != span_attributes.end() && !it->second.highlight.empty()\n-              ? std::string(it->second.highlight)\n+              ? std::string(it->second.highlight) + \" highlighted\"\n               : \"\";\n       std::string diffid =\n           it != span_attributes.end() && !it->second.diffid.empty()\n@@ -502,13 +544,13 @@ std::string PrintHloComputationToHtml(\n               : \"\";\n       printer.Append(absl::StrCat(\"<span class=\\\"hlo-instruction \",\n                                   highlight_class, \"\\\"\", diffid, \" >\"));\n-\n+      printer.Append(\"  \");  // Instruction indentation (2 spaces)\n       if (instruction == comp->root_instruction()) {\n         printer.Append(\"ROOT \");\n       }\n       instruction->PrintWithCanonicalNameMap(\n           &printer, instruction_print_options, &name_map);\n-      printer.Append(\"</span>\\n\");\n+      printer.Append(\"</span>\");\n     }\n   }\n \n@@ -1072,7 +1114,8 @@ void RenderHtml(const DiffResult& diff_result, const DiffSummary& diff_summary,\n \n   // Print repetitive computation groups\n   out << PrintSectionWithHeader(\n-      \"Diffs grouped by computation (Ordered by # of different instructions)\",\n+      \"Diffs grouped by computation (Ordered by # of different instructions) \" +\n+          PrintButton(\"toggleButton\", \"Hide Unchanged Instructions\"),\n       PrintRepetitiveDiffPatterns(diff_summary.computation_diff_patterns,\n                                   span_attributes, url_generator));\n \n@@ -1103,6 +1146,7 @@ void RenderHtml(const DiffResult& diff_result, const DiffSummary& diff_summary,\n                   filtered_diff_result.changed_instructions, url_generator))));\n \n   out << PrintJavascriptForHoverEvent();\n+  out << PrintJavascriptForToggleButton();\n }\n \n }  // namespace hlo_diff"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 52,
        "deletions": 8
    }
}