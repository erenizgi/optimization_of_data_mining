{
    "author": "tensorflower-gardener",
    "message": "Fix `XNN_GRAPH_FUSION_MODE_BYPASS_COST_MODEL`\n\nIt was not passed through in this use of `IsDotSupportedByXnn`\n\nPiperOrigin-RevId: 815952807",
    "sha": "c9e9668b715d48f4bd9376e4199486f55e4cc0c7",
    "files": [
        {
            "sha": "c1e70b4d384dbfafea277f65b7ebc8d0f836603c",
            "filename": "third_party/xla/xla/service/cpu/cpu_compiler.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c9e9668b715d48f4bd9376e4199486f55e4cc0c7/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c9e9668b715d48f4bd9376e4199486f55e4cc0c7/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc?ref=c9e9668b715d48f4bd9376e4199486f55e4cc0c7",
            "patch": "@@ -634,10 +634,14 @@ absl::Status CpuCompiler::RunHloPassesThroughLayoutAssn(\n     if (!call_library_for_dot(*instr)) {\n       return true;\n     }\n+    bool use_cost_model = module->config()\n+                              .debug_options()\n+                              .xla_cpu_experimental_xnn_graph_fusion_mode() !=\n+                          DebugOptions::XNN_GRAPH_FUSION_MODE_BYPASS_COST_MODEL;\n     return !IsDotSupportedByXnn(instr->dot_dimension_numbers(),\n                                 instr->operand(0)->shape(),\n                                 instr->operand(1)->shape(), instr->shape(),\n-                                target_machine_features)\n+                                target_machine_features, use_cost_model)\n                 .value_or(false);\n   };\n "
        }
    ],
    "stats": {
        "total": 6,
        "additions": 5,
        "deletions": 1
    }
}