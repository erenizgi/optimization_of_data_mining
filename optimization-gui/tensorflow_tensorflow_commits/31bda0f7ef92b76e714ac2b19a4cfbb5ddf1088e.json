{
    "author": "dimitar-asenov",
    "message": "[XLA] Print usage flags with `std::cerr` to avoid truncation by `LOG`\n\nThe `LOG` macro truncates strings longer than a predefined limit and the flags usage hits this limit.\n\nFixes #31486\n\nPiperOrigin-RevId: 810813250",
    "sha": "31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
    "files": [
        {
            "sha": "fd13e3bb2289e66486c5910b9eef1a1a9cfd1573",
            "filename": "third_party/xla/xla/hlo/tools/hlo_opt/opt_main.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_opt%2Fopt_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_opt%2Fopt_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_opt%2Fopt_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -308,7 +308,9 @@ int main(int argc, char** argv) {\n \n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n "
        },
        {
            "sha": "51d3a5dfb540531954d4ff10153f7ed2af16db67",
            "filename": "third_party/xla/xla/tools/collective_perf_table_gen_main.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcollective_perf_table_gen_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcollective_perf_table_gen_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fcollective_perf_table_gen_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -18,6 +18,7 @@ limitations under the License.\n \n #include <cstddef>\n #include <cstdint>\n+#include <iostream>\n #include <memory>\n #include <string>\n #include <utility>\n@@ -220,7 +221,9 @@ int main(int argc, char* argv[]) {\n   std::string kUsageString =\n       absl::StrCat(kUsageText, \"\\n\\n\", tsl::Flags::Usage(argv[0], flag_list));\n   if (!tsl::Flags::Parse(&argc, argv, flag_list)) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n "
        },
        {
            "sha": "331e3f78654a0bbef752aa563b9e4f34a7005959",
            "filename": "third_party/xla/xla/tools/compute_cost.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_cost.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_cost.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_cost.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -96,7 +96,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   std::unique_ptr<xla::HloCostAnalysis> analysis;"
        },
        {
            "sha": "6dcd44ae9bb14105ca3a078f4f0dc73b3098c5ae",
            "filename": "third_party/xla/xla/tools/compute_xspace_stats_main.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_xspace_stats_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_xspace_stats_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fcompute_xspace_stats_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -15,6 +15,7 @@ limitations under the License.\n \n // A tool for computing GPU statistics from an XSpace protobuf.\n \n+#include <iostream>\n #include <string>\n #include <vector>\n \n@@ -52,7 +53,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   xla::AppendDebugOptionsFlags(&flag_list);"
        },
        {
            "sha": "a8f8e98206983e3386e9cb40ccf3c4125209949d",
            "filename": "third_party/xla/xla/tools/extract_collective_operations.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fextract_collective_operations.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fextract_collective_operations.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fextract_collective_operations.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -14,6 +14,7 @@ limitations under the License.\n ==============================================================================*/\n \n #include <functional>\n+#include <iostream>\n #include <memory>\n #include <string>\n #include <vector>\n@@ -140,7 +141,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   absl::flat_hash_set<xla::HloOpcode> operation_types;"
        },
        {
            "sha": "1ee96f95c3ebdeb8468a733b8686bd04beedaf73",
            "filename": "third_party/xla/xla/tools/extract_dots_for_benchmark.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fextract_dots_for_benchmark.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fextract_dots_for_benchmark.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fextract_dots_for_benchmark.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -124,7 +124,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   std::unique_ptr<xla::HloCostAnalysis> analysis;"
        },
        {
            "sha": "66a79721234820287f6dccb4872925de95e1f06f",
            "filename": "third_party/xla/xla/tools/hlo_bisect/hlo_bisect.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_bisect%2Fhlo_bisect.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_bisect%2Fhlo_bisect.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_bisect%2Fhlo_bisect.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -13,6 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include <iostream>\n #include <memory>\n #include <string>\n #include <tuple>\n@@ -101,7 +102,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n   if (opts.input.empty()) {\n     QCHECK(argc == 2) << \"Must specify a single input file\";"
        },
        {
            "sha": "efd528cd724c0cf14a30e5afcf3f05352c23d6ee",
            "filename": "third_party/xla/xla/tools/matmul_perf_table_gen_main.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fmatmul_perf_table_gen_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fmatmul_perf_table_gen_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fmatmul_perf_table_gen_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -14,6 +14,7 @@ limitations under the License.\n ==============================================================================*/\n \n #include <cstddef>\n+#include <iostream>\n #include <string>\n #include <utility>\n #include <vector>\n@@ -320,7 +321,9 @@ int main(int argc, char* argv[]) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   MatmulPerfTableGen::Config cfg = CreateConfig("
        },
        {
            "sha": "c123491f08274f2842717d60355176cdfb3c60cd",
            "filename": "third_party/xla/xla/tools/multihost_hlo_runner/hlo_runner_main.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2Fhlo_runner_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2Fhlo_runner_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2Fhlo_runner_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -457,7 +457,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n   absl::Status s = xla::RunMultihostHloRunner(argc, argv, opts);\n   if (!s.ok()) {"
        },
        {
            "sha": "0bd53e73588ee7d124ec24f8901e3a348a6d571c",
            "filename": "third_party/xla/xla/tools/print_indexing.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fprint_indexing.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Fprint_indexing.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fprint_indexing.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -120,7 +120,9 @@ int main(int argc, char** argv) {\n       absl::StrCat(kUsage, \"\\n\\n\", tsl::Flags::Usage(argv[0], flag_list));\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (argc < 2) {"
        },
        {
            "sha": "8aecc024882c5f8950634f7dc249a51669ea6399",
            "filename": "third_party/xla/xla/tools/run_hlo_module_main.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_main.cc?ref=31bda0f7ef92b76e714ac2b19a4cfbb5ddf1088e",
            "patch": "@@ -209,7 +209,9 @@ int main(int argc, char** argv) {\n   bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(kUsageString.c_str(), &argc, &argv);\n   if (!parse_ok) {\n-    LOG(QFATAL) << kUsageString;\n+    // Print the usage using cerr to avoid truncation by LOG.\n+    std::cerr << kUsageString;\n+    return 1;\n   }\n \n   QCHECK(!(opts.force_fake_data && !opts.input_literals_file.empty()))"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 38,
        "deletions": 11
    }
}