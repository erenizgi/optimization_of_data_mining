{
    "author": "emilyfertig",
    "message": "[JAX] Raise an error instead of crash when `FullyReplicatedShard` is called on an array with no local shards.\n\nPiperOrigin-RevId: 800668200",
    "sha": "bce19767af64c0cd786d8a8ef4d96adb12fdc770",
    "files": [
        {
            "sha": "4c1ba06207344dc3fa4b54a24d121c282ad6b604",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/pjrt_array.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bce19767af64c0cd786d8a8ef4d96adb12fdc770/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_array.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bce19767af64c0cd786d8a8ef4d96adb12fdc770/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_array.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_array.cc?ref=bce19767af64c0cd786d8a8ef4d96adb12fdc770",
            "patch": "@@ -191,6 +191,10 @@ absl::StatusOr<tsl::RCReference<PjRtArray>> PjRtArray::Create(\n \n absl::StatusOr<ArrayRef> PjRtArray::FullyReplicatedShard(\n     ArrayCopySemantics semantics) {\n+  if (sharding_->devices()->AddressableDeviceList()->empty()) {\n+    return FailedPrecondition(\n+        \"FullyReplicatedShard: Array has no addressable shards.\");\n+  }\n   return PjRtArray::Create(client(), GetPjRtBuffer(semantics, 0));\n }\n "
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}