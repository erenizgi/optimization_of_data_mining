{
    "author": "ezhulenev",
    "message": "[xla:ffi] Remove unused context decoding for C API internals\n\nPiperOrigin-RevId: 824792000",
    "sha": "c09d68c58813ce9567fa351787bdeeb23a6d0290",
    "files": [
        {
            "sha": "c73b7912f816145f172b16d3b95f588385f87237",
            "filename": "third_party/xla/xla/ffi/api/ffi.h",
            "status": "modified",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h?ref=c09d68c58813ce9567fa351787bdeeb23a6d0290",
            "patch": "@@ -1499,35 +1499,6 @@ inline ThreadPool::ThreadPool(const XLA_FFI_Api* api,\n                               DiagnosticEngine& diagnostic)\n     : api_(api), ctx_(ctx), diagnostic_(diagnostic) {}\n \n-//===----------------------------------------------------------------------===//\n-// Context decoding for FFI internals\n-//===----------------------------------------------------------------------===//\n-\n-struct FfiApi {};\n-struct FfiExecutionContext {};\n-\n-template <>\n-struct CtxDecoding<FfiApi> {\n-  using Type = const XLA_FFI_Api*;\n-\n-  XLA_FFI_ATTRIBUTE_ALWAYS_INLINE static std::optional<Type> Decode(\n-      const XLA_FFI_Api* api, XLA_FFI_ExecutionContext* ctx,\n-      DiagnosticEngine& diagnostic) {\n-    return api;\n-  }\n-};\n-\n-template <>\n-struct CtxDecoding<FfiExecutionContext> {\n-  using Type = XLA_FFI_ExecutionContext*;\n-\n-  XLA_FFI_ATTRIBUTE_ALWAYS_INLINE static std::optional<Type> Decode(\n-      const XLA_FFI_Api* api, XLA_FFI_ExecutionContext* ctx,\n-      DiagnosticEngine& diagnostic) {\n-    return ctx;\n-  }\n-};\n-\n //===----------------------------------------------------------------------===//\n // Type Registration\n //===----------------------------------------------------------------------===//"
        },
        {
            "sha": "59e89f810ffc50d96f0dd87dba2f22809d20f942",
            "filename": "third_party/xla/xla/ffi/api/ffi_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc?ref=c09d68c58813ce9567fa351787bdeeb23a6d0290",
            "patch": "@@ -1427,13 +1427,6 @@ TEST(FfiTest, ScratchAllocatorUnimplemented) {\n   TF_ASSERT_OK(status);\n }\n \n-TEST(FfiTest, BindFfiInternals) {\n-  (void)Ffi::Bind().Ctx<FfiApi>().Ctx<FfiExecutionContext>().To(\n-      +[](const XLA_FFI_Api* api, XLA_FFI_ExecutionContext* ctx) {\n-        return Error::Success();\n-      });\n-}\n-\n TEST(FfiTest, ThreadPool) {\n   tsl::thread::ThreadPool pool(tsl::Env::Default(), \"ffi-test\", 2);\n   Eigen::ThreadPoolDevice device(pool.AsEigenThreadPool(), pool.NumThreads());"
        },
        {
            "sha": "af5970e78b9b557aeb2042de0289329a78c0ce5b",
            "filename": "third_party/xla/xla/ffi/ffi.h",
            "status": "modified",
            "additions": 6,
            "deletions": 30,
            "changes": 36,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h?ref=c09d68c58813ce9567fa351787bdeeb23a6d0290",
            "patch": "@@ -63,14 +63,12 @@ limitations under the License.\n namespace xla::ffi {\n \n // Type tags to bind parameters passed via execution context to FFI handler.\n-struct Stream {};               // binds `se::Stream*`\n-struct DeviceOrdinal {};        // binds `int32_t` with device ordinal\n-struct Allocator {};            // binds `se::DeviceMemoryAllocator*`\n-struct ScratchAllocator {};     // binds `se::OwningScratchAllocator`\n-struct CalledComputation {};    // binds `HloComputation*`\n-struct IntraOpThreadPool {};    // binds `const Eigen::ThreadPoolDevice*`\n-struct FfiApi {};               // binds `const XLA_FFI_Api*`\n-struct FfiExecutionContext {};  // binds `XLA_FFI_ExecutionContext*`\n+struct Stream {};             // binds `se::Stream*`\n+struct DeviceOrdinal {};      // binds `int32_t` with device ordinal\n+struct Allocator {};          // binds `se::DeviceMemoryAllocator*`\n+struct ScratchAllocator {};   // binds `se::OwningScratchAllocator`\n+struct CalledComputation {};  // binds `HloComputation*`\n+struct IntraOpThreadPool {};  // binds `const Eigen::ThreadPoolDevice*`\n \n template <typename T>\n struct PlatformStream {};  // binds a platform stream, e.g. `cudaStream_t`\n@@ -622,28 +620,6 @@ struct CtxDecoding<IntraOpThreadPool> {\n   }\n };\n \n-template <>\n-struct CtxDecoding<FfiApi> {\n-  using Type = const XLA_FFI_Api*;\n-\n-  static std::optional<Type> Decode(const XLA_FFI_Api* api,\n-                                    XLA_FFI_ExecutionContext* ctx,\n-                                    DiagnosticEngine&) {\n-    return api;\n-  }\n-};\n-\n-template <>\n-struct CtxDecoding<FfiExecutionContext> {\n-  using Type = XLA_FFI_ExecutionContext*;\n-\n-  static std::optional<Type> Decode(const XLA_FFI_Api* api,\n-                                    XLA_FFI_ExecutionContext* ctx,\n-                                    DiagnosticEngine&) {\n-    return ctx;\n-  }\n-};\n-\n template <typename T>\n struct CtxDecoding<PlatformStream<T>> {\n   using Type = T;"
        },
        {
            "sha": "975a05bf00ca0672785b4a714ec1f63b8a09129d",
            "filename": "third_party/xla/xla/ffi/ffi_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c09d68c58813ce9567fa351787bdeeb23a6d0290/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc?ref=c09d68c58813ce9567fa351787bdeeb23a6d0290",
            "patch": "@@ -1142,13 +1142,6 @@ TEST(FfiTest, PlatformStream) {\n   (void)Ffi::BindTo(+[](TestStream stream) { return absl::OkStatus(); });\n }\n \n-TEST(FfiTest, BindFfiInternals) {\n-  (void)Ffi::Bind().Ctx<FfiApi>().Ctx<FfiExecutionContext>().To(\n-      +[](const XLA_FFI_Api* api, XLA_FFI_ExecutionContext* ctx) {\n-        return absl::OkStatus();\n-      });\n-}\n-\n //===----------------------------------------------------------------------===//\n // Performance benchmarks are below.\n //===----------------------------------------------------------------------===//"
        }
    ],
    "stats": {
        "total": 79,
        "additions": 6,
        "deletions": 73
    }
}