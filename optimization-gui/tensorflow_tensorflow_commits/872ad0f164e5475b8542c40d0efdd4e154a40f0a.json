{
    "author": "tensorflower-gardener",
    "message": "[XLA:GPU] Do not depend on NVSHMEM if -fno-builtin is used.\n\nPiperOrigin-RevId: 804373665",
    "sha": "872ad0f164e5475b8542c40d0efdd4e154a40f0a",
    "files": [
        {
            "sha": "7dc52d2447d9285289cb6f737e00cdaea2c78352",
            "filename": "third_party/xla/xla/backends/gpu/collectives/BUILD",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/872ad0f164e5475b8542c40d0efdd4e154a40f0a/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/872ad0f164e5475b8542c40d0efdd4e154a40f0a/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD?ref=872ad0f164e5475b8542c40d0efdd4e154a40f0a",
            "patch": "@@ -26,6 +26,27 @@ bool_flag(\n     build_setting_default = True,\n )\n \n+# NVSHMEM requires builtin functions since it uses printf's for debugging.\n+config_setting(\n+    name = \"no_builtin_used\",\n+    values = {\n+        \"copt\": \"-fno-builtin\",\n+    },\n+)\n+\n+cc_library(\n+    name = \"nvshmem_collectives_if_builtin_used\",\n+    tags = [\n+        \"cuda-only\",\n+        \"gpu\",\n+    ],\n+    deps =\n+        select({\n+            \":no_builtin_used\": [],\n+            \"//conditions:default\": [\":nvshmem_collectives\"],\n+        }),\n+)\n+\n config_setting(\n     name = \"nvshmem_supported\",\n     constraint_values = [\n@@ -45,7 +66,7 @@ cc_library(\n     ],\n     deps =\n         select({\n-            \":nvshmem_supported\": [\":nvshmem_collectives\"],\n+            \":nvshmem_supported\": [\":nvshmem_collectives_if_builtin_used\"],\n             \"//conditions:default\": [],\n         }),\n )"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 22,
        "deletions": 1
    }
}