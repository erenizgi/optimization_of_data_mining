{
    "author": "beckerhe",
    "message": "Exclude feature extensions from compute capability string in TF's GPU device details.\n\nAdd `WithoutAnyFeatureExtension` to `CudaComputeCapability` to provide a representation without feature extension flags. Use this method when reporting the compute capability in `gpu_device.cc` to ensure the string only reflects the major and minor versions.\n\nPiperOrigin-RevId: 801701965",
    "sha": "4a83a184f5a2cad935353143c8a858e3a78f53bb",
    "files": [
        {
            "sha": "23c8d54200c458264c98834f24c45f789f56b7fd",
            "filename": "tensorflow/core/common_runtime/gpu/gpu_device.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4a83a184f5a2cad935353143c8a858e3a78f53bb/tensorflow%2Fcore%2Fcommon_runtime%2Fgpu%2Fgpu_device.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4a83a184f5a2cad935353143c8a858e3a78f53bb/tensorflow%2Fcore%2Fcommon_runtime%2Fgpu%2Fgpu_device.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Fgpu%2Fgpu_device.cc?ref=4a83a184f5a2cad935353143c8a858e3a78f53bb",
            "patch": "@@ -1385,7 +1385,10 @@ Status BaseGPUDeviceFactory::GetDeviceDetails(\n   auto desc = std::move(desc_status).value();\n   (*details)[\"device_name\"] = desc->name();\n #if GOOGLE_CUDA\n-  (*details)[\"compute_capability\"] = desc->cuda_compute_capability().ToString();\n+  // Some users of this API expect the compute capability to be in the format\n+  // X.Y. Therefore we don't expose the feature extension here.\n+  (*details)[\"compute_capability\"] =\n+      desc->cuda_compute_capability().WithoutAnyFeatureExtension().ToString();\n #endif  // GOOGLE_CUDA\n   return OkStatus();\n }"
        },
        {
            "sha": "0a6c6019ec1300702bd0b58525b8c3047cd21812",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_compute_capability.h",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4a83a184f5a2cad935353143c8a858e3a78f53bb/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4a83a184f5a2cad935353143c8a858e3a78f53bb/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability.h?ref=4a83a184f5a2cad935353143c8a858e3a78f53bb",
            "patch": "@@ -204,6 +204,12 @@ struct CudaComputeCapability {\n     return other.SupportsAllFeaturesOf(*this);\n   }\n \n+  // Returns a copy of this compute capability without any feature extension\n+  // set.\n+  CudaComputeCapability WithoutAnyFeatureExtension() const {\n+    return CudaComputeCapability{major, minor, FeatureExtension::kNone};\n+  }\n+\n   // Returns a string representation of the compute capability. The format is\n   // not guaranteed to follow any standard and should only be used for logging.\n   std::string ToString() const;"
        },
        {
            "sha": "282f0132ae8fce9c134989abe7e80f6850c4900c",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_compute_capability_test.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4a83a184f5a2cad935353143c8a858e3a78f53bb/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4a83a184f5a2cad935353143c8a858e3a78f53bb/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_compute_capability_test.cc?ref=4a83a184f5a2cad935353143c8a858e3a78f53bb",
            "patch": "@@ -278,5 +278,23 @@ TEST(CudaComputeCapabilityTest, GetPtxAsTargetName) {\n       \"sm_100f\");\n }\n \n+TEST(CudaComputeCapabilityTest, WithoutAnyFeatureExtension) {\n+  EXPECT_EQ(CudaComputeCapability(\n+                100, 52, CudaComputeCapability::FeatureExtension::kNone)\n+                .WithoutAnyFeatureExtension(),\n+            CudaComputeCapability(100, 52));\n+  EXPECT_EQ(CudaComputeCapability(\n+                100, 52,\n+                CudaComputeCapability::FeatureExtension::kAcceleratedFeatures)\n+                .WithoutAnyFeatureExtension(),\n+            CudaComputeCapability(100, 52));\n+  EXPECT_EQ(\n+      CudaComputeCapability(\n+          100, 52,\n+          CudaComputeCapability::FeatureExtension::kForwardCompatibleFeatures)\n+          .WithoutAnyFeatureExtension(),\n+      CudaComputeCapability(100, 52));\n+}\n+\n }  // namespace\n }  // namespace stream_executor"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 28,
        "deletions": 1
    }
}