{
    "author": "unknown",
    "message": "[XLA:GPU] Avoid use-after-free in StreamExecutorGpuClientTest::CopyRawToHostOutOfRange\n\nPiperOrigin-RevId: 819763300",
    "sha": "1aa192d839d9b5c54c7cdf35b881882318b73c51",
    "files": [
        {
            "sha": "a7f46984bdb653425d093056d6537219e3b1adbb",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1aa192d839d9b5c54c7cdf35b881882318b73c51/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1aa192d839d9b5c54c7cdf35b881882318b73c51/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc?ref=1aa192d839d9b5c54c7cdf35b881882318b73c51",
            "patch": "@@ -1061,6 +1061,12 @@ TEST(StreamExecutorGpuClientTest, CopyRawToHostOutOfRange) {\n               absl_testing::StatusIs(absl::StatusCode::kInvalidArgument,\n                                      HasSubstr(\"invalid offset 1\")));\n   tsl::port::AlignedSizedFree(dst, tsl::Allocator::kAllocatorAlignment, size);\n+\n+  // The future returned by buffer->CopyRawToHost() may be resolve to an error\n+  // before the prior buffer->BufferFromHostLiteral() is done. Make sure\n+  // `literal` is alive long enough to avoid use-after-free. See the comment in\n+  // PjRtStreamExecutorBuffer::CopyRawToHost() for details.\n+  TF_EXPECT_OK(buffer->GetReadyFuture().Await());\n }\n \n TEST(StreamExecutorGpuClientTest, CopyRawToHostFuture) {"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 6,
        "deletions": 0
    }
}