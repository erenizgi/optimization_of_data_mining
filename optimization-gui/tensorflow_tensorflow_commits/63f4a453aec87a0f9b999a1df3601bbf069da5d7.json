{
    "author": "d4n1elchen",
    "message": "[XLA:HLO Diff] Add instruction subgraph summary.\n\nThis allows to keep only the nodes with changed subgraph.\n\nPiperOrigin-RevId: 803535903",
    "sha": "63f4a453aec87a0f9b999a1df3601bbf069da5d7",
    "files": [
        {
            "sha": "6ed686506f3d477f3348aa3c19e3e4135b025a6a",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/BUILD",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -72,11 +72,17 @@ cc_library(\n         \":hlo_diff_result\",\n         \":hlo_gumgraph_mappings\",\n         \"//xla/hlo/ir:hlo\",\n+        \"//xla/hlo/tools/hlo_diff/graph:hlo_gumgraph\",\n+        \"//xla/hlo/tools/hlo_diff/graph:hlo_gumgraph_node\",\n+        \"//xla/hlo/tools/hlo_diff/graph/utils:hlo_gumgraph_dfs\",\n         \"//xla/hlo/tools/hlo_diff/utils:bidirectional_map\",\n         \"//xla/hlo/tools/hlo_diff/utils:connected_components\",\n+        \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/functional:bind_front\",\n         \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@local_tsl//tsl/platform:fingerprint\","
        },
        {
            "sha": "dadae7bf163b807e6dd0347bb0d91f223c0077c3",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_eval_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_eval_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_eval_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_eval_test.cc?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -91,7 +91,7 @@ TEST_F(HloDiffTest, SplitAllegianceWorks) {\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*graph_l, *graph_r, mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, *diff_result);\n+      ConstructDiffSummary(*graph_l, *graph_r, *diff_result);\n   std::unique_ptr<const DiffEval> diff_eval = ComputeDiffEval(\n       *graph_l, *graph_r, mappings, *diff_result, *diff_summary);\n "
        },
        {
            "sha": "fcf663205c945380d1399678c92d7a08a1d10c2f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_summary.cc",
            "status": "modified",
            "additions": 65,
            "deletions": 3,
            "changes": 68,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -19,6 +19,7 @@\n \n #include <algorithm>\n #include <cstdint>\n+#include <functional>\n #include <memory>\n #include <optional>\n #include <ostream>\n@@ -28,16 +29,22 @@\n \n #include \"absl/container/flat_hash_map.h\"\n #include \"absl/container/flat_hash_set.h\"\n+#include \"absl/functional/bind_front.h\"\n #include \"absl/log/log.h\"\n+#include \"absl/status/statusor.h\"\n #include \"absl/strings/str_format.h\"\n #include \"absl/strings/str_join.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n+#include \"xla/hlo/tools/hlo_diff/graph/hlo_gumgraph.h\"\n+#include \"xla/hlo/tools/hlo_diff/graph/hlo_gumgraph_node.h\"\n+#include \"xla/hlo/tools/hlo_diff/graph/utils/hlo_gumgraph_dfs.h\"\n #include \"xla/hlo/tools/hlo_diff/hlo_diff_result.h\"\n #include \"xla/hlo/tools/hlo_diff/hlo_gumgraph_mappings.h\"\n #include \"xla/hlo/tools/hlo_diff/utils/bidirectional_map.h\"\n #include \"xla/hlo/tools/hlo_diff/utils/connected_components.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"tsl/platform/fingerprint.h\"\n \n namespace xla {\n@@ -295,6 +302,47 @@ ComputationSummaryMap GetComputationSummary(const HloModule& left_module,\n   return summary;\n }\n \n+// Returns the instruction summary.\n+InstructionSummaryMap GetInstructionSummary(const HloGumgraph& left_graph,\n+                                            const HloGumgraph& right_graph,\n+                                            const DiffResult& diff_result) {\n+  InstructionSummaryMap summaries;\n+  auto instruction_summary = [&](const DiffSide side,\n+                                 const HloInstructionNode& node) {\n+    if (node.is_root) {\n+      return true;\n+    }\n+    InstructionSummary summary;\n+    summary.side = side;\n+    summary.subgraph_unchanged = true;\n+    absl::flat_hash_map<const HloInstruction*, DiffType> diff_codes =\n+        side == DiffSide::kLeft ? diff_result.left_diff_codes\n+                                : diff_result.right_diff_codes;\n+    if (auto it = diff_codes.find(node.instruction);\n+        it == diff_codes.end() || it->second != DiffType::kUnchanged) {\n+      summary.subgraph_unchanged = false;\n+      summaries.insert({node.instruction, std::move(summary)});\n+      return true;\n+    }\n+    for (const HloInstructionNode* child : node.children) {\n+      if (auto it = summaries.find(child->instruction);\n+          it != summaries.end() && !it->second.subgraph_unchanged) {\n+        summary.subgraph_unchanged = false;\n+        break;\n+      }\n+    }\n+    summaries.insert({node.instruction, std::move(summary)});\n+    return true;\n+  };\n+  HloGumgraphDfs(left_graph.GetRoot(),\n+                 absl::bind_front(instruction_summary, DiffSide::kLeft),\n+                 DfsTraversalOrder::kPostOrder, left_graph.GetNodeCount());\n+  HloGumgraphDfs(right_graph.GetRoot(),\n+                 absl::bind_front(instruction_summary, DiffSide::kRight),\n+                 DfsTraversalOrder::kPostOrder, right_graph.GetNodeCount());\n+  return summaries;\n+}\n+\n // Logs the computation group.\n void LogComputationGroup(const ComputationGroup& computation_group) {\n   std::vector<std::string> computations_str(\n@@ -331,21 +379,35 @@ void LogComputationDiffPattern(const ComputationDiffPattern& diff_pattern) {\n }  // namespace\n \n std::unique_ptr<const DiffSummary> ConstructDiffSummary(\n-    const HloModule& left_module, const HloModule& right_module,\n+    const HloGumgraph& left_graph, const HloGumgraph& right_graph,\n     const DiffResult& diff_result) {\n   auto summary = std::make_unique<DiffSummary>();\n \n   // Summarize the computations.\n-  summary->computation_summary =\n-      GetComputationSummary(left_module, right_module, diff_result);\n+  summary->computation_summary = GetComputationSummary(\n+      left_graph.GetHloModule(), right_graph.GetHloModule(), diff_result);\n \n   // Group the computations by their diff fingerprint.\n   summary->computation_diff_patterns =\n       FindComputationDiffPatterns(summary->computation_summary, diff_result);\n \n+  // Summarize the instructions.\n+  summary->instruction_summary =\n+      GetInstructionSummary(left_graph, right_graph, diff_result);\n+\n   return summary;\n }\n \n+absl::StatusOr<std::unique_ptr<const DiffSummary>> ConstructDiffSummary(\n+    const HloModule& left_module, const HloModule& right_module,\n+    const DiffResult& diff_result) {\n+  TF_ASSIGN_OR_RETURN(std::unique_ptr<const HloGumgraph> graph_l,\n+                      HloGumgraph::Create(&left_module));\n+  TF_ASSIGN_OR_RETURN(std::unique_ptr<const HloGumgraph> graph_r,\n+                      HloGumgraph::Create(&right_module));\n+  return ConstructDiffSummary(*graph_l, *graph_r, diff_result);\n+}\n+\n void LogDiffSummary(const DiffSummary& diff_summary) {\n   // Log the connected components repeated more than 3 times.\n   LOG(INFO) << \"Diff Summary: \";"
        },
        {
            "sha": "f3a207cc8acb7cf4682df695a7acc1b43f8298b2",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_summary.h",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.h?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -23,7 +23,10 @@\n #include <vector>\n \n #include \"absl/container/flat_hash_map.h\"\n+#include \"absl/status/statusor.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n+#include \"xla/hlo/ir/hlo_instruction.h\"\n+#include \"xla/hlo/tools/hlo_diff/graph/hlo_gumgraph.h\"\n #include \"xla/hlo/tools/hlo_diff/hlo_diff_result.h\"\n \n namespace xla {\n@@ -77,8 +80,16 @@ struct ComputationDiffPattern {\n // Teach the gunit to print the diff pattern.\n void PrintTo(const ComputationDiffPattern& diff_pattern, std::ostream* os);\n \n+// Summary of an instruction.\n+struct InstructionSummary {\n+  DiffSide side;\n+  bool subgraph_unchanged = true;\n+};\n+\n using ComputationSummaryMap =\n     absl::flat_hash_map<const HloComputation*, const ComputationSummary>;\n+using InstructionSummaryMap =\n+    absl::flat_hash_map<const HloInstruction*, const InstructionSummary>;\n \n //  Summary of the diff result of the left and right HLO modules.\n struct DiffSummary {\n@@ -87,13 +98,22 @@ struct DiffSummary {\n \n   // Summary of each computation.\n   ComputationSummaryMap computation_summary;\n+\n+  // Summary of each instruction.\n+  InstructionSummaryMap instruction_summary;\n };\n \n // Constructs the diff summary from the diff result.\n // `left_module` and `right_module` are the original HLO modules.\n // `diff_result` contains the edit script(insert/delete/change/move) created\n // from the node mappings.\n std::unique_ptr<const DiffSummary> ConstructDiffSummary(\n+    const HloGumgraph& left_graph, const HloGumgraph& right_graph,\n+    const DiffResult& diff_result);\n+\n+// Constructs the diff summary from the diff result when the HloGumgraph is not\n+// available.\n+absl::StatusOr<std::unique_ptr<const DiffSummary>> ConstructDiffSummary(\n     const HloModule& left_module, const HloModule& right_module,\n     const DiffResult& diff_result);\n "
        },
        {
            "sha": "858809757bcb651147a64df994d895d6767ea6e2",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_summary_test.cc",
            "status": "modified",
            "additions": 79,
            "deletions": 8,
            "changes": 87,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary_test.cc?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -104,7 +104,7 @@ TEST_F(HloDiffTest, FindMainMatchedComputationWorks) {\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*graph_l, *graph_r, mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, *diff_result);\n+      ConstructDiffSummary(*graph_l, *graph_r, *diff_result);\n   absl::flat_hash_map<const HloComputation*, ComputationSummary>\n       left_computation_summary;\n   for (const auto& [computation, _] : graph_l->AllComputationProps()) {\n@@ -182,6 +182,75 @@ TEST_F(HloDiffTest, FindMainMatchedComputationWorks) {\n                          /*all_unchanged=*/true))));\n }\n \n+TEST_F(HloDiffTest, InstructionDiffWorks) {\n+  const char* hlo_string_l = R\"(\n+  HloModule module, is_scheduled=true\n+  \n+  ENTRY entry {\n+    parameter.0 = f32[] parameter(0)\n+    parameter.1 = f32[] parameter(1)\n+    parameter.2 = f32[] parameter(2)\n+    ROOT tuple.0 = (f32[], f32[], f32[]) tuple(parameter.0, parameter.1, parameter.2)\n+  }\n+  )\";\n+  const char* hlo_string_r = R\"(\n+  HloModule module, is_scheduled=true\n+  \n+  ENTRY entry {\n+    parameter.0 = f32[] parameter(0)\n+    parameter.1 = f32[] parameter(1)\n+    parameter.2 = f32[] parameter(2)\n+    ROOT tuple.0 = (f32[], f32[], f32[]) tuple(parameter.0, parameter.1, parameter.2)\n+  }\n+  )\";\n+  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<xla::VerifiedHloModule> module_l,\n+                          ParseAndReturnVerifiedModule(hlo_string_l));\n+  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<const HloGumgraph> graph_l,\n+                          HloGumgraph::Create(module_l.get()));\n+  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<xla::VerifiedHloModule> module_r,\n+                          ParseAndReturnVerifiedModule(hlo_string_r));\n+  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<const HloGumgraph> graph_r,\n+                          HloGumgraph::Create(module_r.get()));\n+\n+  DiffResult diff_result;\n+  diff_result.AddUnchangedInstruction(\n+      module_l->entry_computation()->root_instruction(),\n+      module_r->entry_computation()->root_instruction());\n+  diff_result.AddUnchangedInstruction(\n+      module_l->entry_computation()->parameter_instruction(2),\n+      module_r->entry_computation()->parameter_instruction(2));\n+  diff_result.AddChangedInstruction(\n+      module_l->entry_computation()->parameter_instruction(0),\n+      module_r->entry_computation()->parameter_instruction(1));\n+  diff_result.AddUnmatchedInstruction(\n+      module_l->entry_computation()->parameter_instruction(1), nullptr);\n+  diff_result.AddUnmatchedInstruction(\n+      nullptr, module_r->entry_computation()->parameter_instruction(0));\n+\n+  std::unique_ptr<const DiffSummary> diff_summary =\n+      ConstructDiffSummary(*graph_l, *graph_r, diff_result);\n+\n+  EXPECT_THAT(\n+      diff_summary->instruction_summary,\n+      UnorderedElementsAre(\n+          Pair(module_l->entry_computation()->parameter_instruction(0),\n+               FieldsAre(DiffSide::kLeft, /*subgraph_unchanged=*/false)),\n+          Pair(module_l->entry_computation()->parameter_instruction(1),\n+               FieldsAre(DiffSide::kLeft, /*subgraph_unchanged=*/false)),\n+          Pair(module_l->entry_computation()->parameter_instruction(2),\n+               FieldsAre(DiffSide::kLeft, /*subgraph_unchanged=*/true)),\n+          Pair(module_l->entry_computation()->root_instruction(),\n+               FieldsAre(DiffSide::kLeft, /*subgraph_unchanged=*/false)),\n+          Pair(module_r->entry_computation()->parameter_instruction(0),\n+               FieldsAre(DiffSide::kRight, /*subgraph_unchanged=*/false)),\n+          Pair(module_r->entry_computation()->parameter_instruction(1),\n+               FieldsAre(DiffSide::kRight, /*subgraph_unchanged=*/false)),\n+          Pair(module_r->entry_computation()->root_instruction(),\n+               FieldsAre(DiffSide::kRight, /*subgraph_unchanged=*/false)),\n+          Pair(module_r->entry_computation()->parameter_instruction(2),\n+               FieldsAre(DiffSide::kRight, /*subgraph_unchanged=*/true))));\n+}\n+\n TEST_F(HloDiffTest, ComputationDiffFingerprintWorks) {\n   // Create left module with entry computation containing the following\n   // structure:\n@@ -226,7 +295,7 @@ TEST_F(HloDiffTest, ComputationDiffFingerprintWorks) {\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*graph_l, *graph_r, mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, *diff_result);\n+      ConstructDiffSummary(*graph_l, *graph_r, *diff_result);\n   absl::flat_hash_map<const HloComputation*, ComputationSummary>\n       left_computation_summary;\n   for (const auto& [computation, _] : graph_l->AllComputationProps()) {\n@@ -339,7 +408,7 @@ TEST_F(HloDiffTest, FindConnectedComponentsWorks) {\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*graph_l, *graph_r, *mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, *diff_result);\n+      ConstructDiffSummary(*graph_l, *graph_r, *diff_result);\n   EXPECT_THAT(\n       diff_summary->computation_diff_patterns,\n       UnorderedElementsAre(\n@@ -418,7 +487,7 @@ subtract.0 = f32[] subtract(constant.0, constant.1)\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*graph_l, *graph_r, *mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, *diff_result);\n+      ConstructDiffSummary(*graph_l, *graph_r, *diff_result);\n   EXPECT_THAT(diff_summary->computation_diff_patterns,\n               UnorderedElementsAre(\n                   FieldsAre(\n@@ -536,10 +605,12 @@ TEST_F(HloDiffTest, DiffSummaryFromDiffResultProtoWorks) {\n   DiffResultProto proto = diff_result.ToProto();\n   DiffResult diff_result_from_proto =\n       DiffResult::FromProto(proto, *module_l, *module_r);\n-  std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, diff_result_from_proto);\n-  std::unique_ptr<const DiffSummary> expected_diff_summary =\n-      ConstructDiffSummary(*module_l, *module_r, diff_result);\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      std::unique_ptr<const DiffSummary> diff_summary,\n+      ConstructDiffSummary(*module_l, *module_r, diff_result_from_proto));\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      std::unique_ptr<const DiffSummary> expected_diff_summary,\n+      ConstructDiffSummary(*module_l, *module_r, diff_result));\n   EXPECT_THAT(diff_summary->computation_summary,\n               UnorderedPointwise(EqualsComputationSummaryMapElement(),\n                                  expected_diff_summary->computation_summary));"
        },
        {
            "sha": "576f905ac767f30c3ec39175569ea51ceea78b3f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_gumgraph_diff.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/63f4a453aec87a0f9b999a1df3601bbf069da5d7/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc?ref=63f4a453aec87a0f9b999a1df3601bbf069da5d7",
            "patch": "@@ -121,7 +121,7 @@ absl::StatusOr<HloGumgraphDiffResults> ComputeDiff(const HloModule& left,\n   std::unique_ptr<const DiffResult> diff_result =\n       ConstructDiffResult(*left_graph, *right_graph, *mappings);\n   std::unique_ptr<const DiffSummary> diff_summary =\n-      ConstructDiffSummary(left, right, *diff_result);\n+      ConstructDiffSummary(*left_graph, *right_graph, *diff_result);\n   std::unique_ptr<const DiffEval> diff_eval = nullptr;\n   if (options.run_eval) {\n     diff_eval = ComputeDiffEval(*left_graph, *right_graph, *mappings,"
        }
    ],
    "stats": {
        "total": 185,
        "additions": 172,
        "deletions": 13
    }
}