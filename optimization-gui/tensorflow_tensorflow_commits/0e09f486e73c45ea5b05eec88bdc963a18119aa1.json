{
    "author": "ezhulenev",
    "message": "[xla:pjrt:ffi] Remove deprecated TypeID registration function\n\nPiperOrigin-RevId: 821740142",
    "sha": "0e09f486e73c45ea5b05eec88bdc963a18119aa1",
    "files": [
        {
            "sha": "dd63d7d47d31de5270f06d4aa0713830051473b8",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_ffi_extension.h",
            "status": "modified",
            "additions": 1,
            "deletions": 13,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0e09f486e73c45ea5b05eec88bdc963a18119aa1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_extension.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0e09f486e73c45ea5b05eec88bdc963a18119aa1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_extension.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_extension.h?ref=0e09f486e73c45ea5b05eec88bdc963a18119aa1",
            "patch": "@@ -49,23 +49,11 @@ struct PJRT_FFI_Type_Register_Args {\n };\n PJRT_DEFINE_STRUCT_TRAITS(PJRT_FFI_Type_Register_Args, type_info);\n \n-struct PJRT_FFI_TypeID_Register_Args {\n-  size_t struct_size;\n-  PJRT_Extension_Base* extension_start;\n-\n-  const char* type_name;\n-  size_t type_name_size;\n-  int64_t type_id;  // in-out\n-};\n-PJRT_DEFINE_STRUCT_TRAITS(PJRT_FFI_TypeID_Register_Args, type_id);\n-\n // Registers external type in a static type registry. If `type_id` is set to `0`\n // XLA will assign a unique type id to it and return via out argument, otherwise\n // it will verify that user-provided type id matches previously registered type\n // id for the given type name.\n typedef PJRT_Error* PJRT_FFI_Type_Register(PJRT_FFI_Type_Register_Args* args);\n-typedef PJRT_Error* PJRT_FFI_TypeID_Register(\n-    PJRT_FFI_TypeID_Register_Args* args);\n \n // User-data that will be forwarded to the FFI handlers. Deleter is optional,\n // and can be nullptr. Deleter will be called when the context is destroyed.\n@@ -109,7 +97,7 @@ typedef PJRT_Error* PJRT_FFI_Register_Handler(\n \n typedef struct PJRT_FFI_Extension {\n   PJRT_Extension_Base base;\n-  PJRT_FFI_TypeID_Register* type_id_register;\n+  PJRT_FFI_Type_Register* type_id_register;\n   PJRT_FFI_UserData_Add* user_data_add;\n   PJRT_FFI_Register_Handler* register_handler;\n   PJRT_FFI_Type_Register* type_register;"
        },
        {
            "sha": "569aa0306766d7a74f09add5515643f867b15841",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_ffi_internal.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 27,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0e09f486e73c45ea5b05eec88bdc963a18119aa1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_internal.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0e09f486e73c45ea5b05eec88bdc963a18119aa1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_internal.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_ffi_internal.cc?ref=0e09f486e73c45ea5b05eec88bdc963a18119aa1",
            "patch": "@@ -29,32 +29,6 @@ limitations under the License.\n \n namespace pjrt {\n \n-static PJRT_Error* PJRT_FFI_TypeID_Register(\n-    PJRT_FFI_TypeID_Register_Args* args) {\n-  PJRT_RETURN_IF_ERROR(ActualStructSizeIsGreaterOrEqual(\n-      \"PJRT_FFI_TypeID_Register_Args\",\n-      PJRT_FFI_TypeID_Register_Args_STRUCT_SIZE, args->struct_size));\n-\n-  absl::string_view type_name(args->type_name, args->type_name_size);\n-  xla::ffi::TypeRegistry::TypeId type_id(args->type_id);\n-\n-  if (type_id == xla::ffi::TypeRegistry::kUnknownTypeId) {\n-    // If type_id is unknown, we are registering a new type and XLA will assign\n-    // a unique type id to it.\n-    PJRT_ASSIGN_OR_RETURN(\n-        auto assigned_type_id,\n-        xla::ffi::TypeRegistry::AssignExternalTypeId(type_name, {}));\n-    args->type_id = assigned_type_id.value();\n-\n-  } else {\n-    // If type_id is set, we are relying on the caller-provided unique type id.\n-    PJRT_RETURN_IF_ERROR(\n-        xla::ffi::TypeRegistry::RegisterExternalTypeId(type_name, type_id, {}));\n-  }\n-\n-  return nullptr;\n-}\n-\n static PJRT_Error* PJRT_FFI_Type_Register(PJRT_FFI_Type_Register_Args* args) {\n   PJRT_RETURN_IF_ERROR(ActualStructSizeIsGreaterOrEqual(\n       \"PJRT_FFI_Type_Register_Args\", PJRT_FFI_Type_Register_Args_STRUCT_SIZE,\n@@ -128,7 +102,7 @@ PJRT_FFI_Extension CreateFfiExtension(PJRT_Extension_Base* next) {\n           /*type=*/PJRT_Extension_Type::PJRT_Extension_Type_FFI,\n           /*next=*/next,\n       },\n-      /*type_id_register=*/PJRT_FFI_TypeID_Register,\n+      /*type_id_register=*/PJRT_FFI_Type_Register,\n       /*user_data_add=*/PJRT_FFI_UserData_Add,\n       /*register_handler=*/PJRT_FFI_Register_Handler,\n       /*type_register=*/PJRT_FFI_Type_Register,"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 2,
        "deletions": 40
    }
}