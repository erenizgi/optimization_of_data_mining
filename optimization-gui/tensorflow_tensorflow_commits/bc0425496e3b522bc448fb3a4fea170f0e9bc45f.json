{
    "author": "ezhulenev",
    "message": "[xla] Migrate to PjRtFuture<>::MakePromise() API\n\nPiperOrigin-RevId: 806012842",
    "sha": "bc0425496e3b522bc448fb3a4fea170f0e9bc45f",
    "files": [
        {
            "sha": "654e89932b8f1e4d4a5f432fc5773e6cfca5003c",
            "filename": "third_party/xla/xla/pjrt/cpu/cpu_client.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bc0425496e3b522bc448fb3a4fea170f0e9bc45f/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bc0425496e3b522bc448fb3a4fea170f0e9bc45f/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc?ref=bc0425496e3b522bc448fb3a4fea170f0e9bc45f",
            "patch": "@@ -1836,19 +1836,20 @@ absl::StatusOr<PjRtLoadedExecutable::Result> PjRtCpuExecutable::ExecuteHelper(\n     res.push_back(std::move(output_buffer));\n   }\n \n-  std::optional<PjRtFuture<>> future;\n   if (fill_future) {\n-    PjRtFuture<>::Promise promise = PjRtFuture<>::CreatePromise();\n-    execute_event.AndThen([promise, event = execute_event.CopyRef()]() mutable {\n+    auto [promise, future] = PjRtFuture<>::MakePromise();\n+    execute_event.AndThen([promise = std::move(promise),\n+                           event = execute_event.CopyRef()]() mutable {\n       if (auto* error = event.GetErrorIfPresent()) {\n         promise.Set(Internal(\"Compute error: %s\", error->message()));\n       } else {\n         promise.Set();\n       }\n     });\n-    future = PjRtFuture<>(std::move(promise));\n+    return Result({std::move(future), /*buffers=*/std::move(res)});\n   }\n-  return Result({/*future=*/std::move(future), /*buffers=*/std::move(res)});\n+\n+  return Result({/*future=*/std::nullopt, std::move(res)});\n }\n \n static void MaybeDumpHloSnapshot("
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}