{
    "author": "metaflow",
    "message": "fix order initialization fiasco asan issue in triton-tensor-layout CLI\n\nfound by a recent LLVM asan run\n\nPiperOrigin-RevId: 804866399",
    "sha": "5257d202d5a1389447c18cd7826b25dd682f4850",
    "files": [
        {
            "sha": "cf8ce47c585acabcb3225db32856f271df15a9e8",
            "filename": "third_party/xla/third_party/triton/temporary/series.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5257d202d5a1389447c18cd7826b25dd682f4850/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5257d202d5a1389447c18cd7826b25dd682f4850/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl?ref=5257d202d5a1389447c18cd7826b25dd682f4850",
            "patch": "@@ -14,6 +14,7 @@ those to this list.\n \"\"\"\n \n temporary_patch_list = [\n-    # Add new patches just above this line\n     \"//third_party/triton:temporary/verify_nvmma_encoding.patch\",\n+    \"//third_party/triton:temporary/triton-tensor-layout-init-fiasco.patch\",\n+    # Add new patches just above this line\n ]"
        },
        {
            "sha": "3bc314aebd4b53f5d97a8e5e4a460a25cde9d048",
            "filename": "third_party/xla/third_party/triton/temporary/triton-tensor-layout-init-fiasco.patch",
            "status": "added",
            "additions": 67,
            "deletions": 0,
            "changes": 67,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5257d202d5a1389447c18cd7826b25dd682f4850/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Ftriton-tensor-layout-init-fiasco.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5257d202d5a1389447c18cd7826b25dd682f4850/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Ftriton-tensor-layout-init-fiasco.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Ftriton-tensor-layout-init-fiasco.patch?ref=5257d202d5a1389447c18cd7826b25dd682f4850",
            "patch": "@@ -0,0 +1,67 @@\n+Upsteam Pull Request: https://github.com/triton-lang/triton/pull/8117.\n+\n+diff --git a/bin/triton-tensor-layout.cpp b/bin/triton-tensor-layout.cpp\n+--- a/bin/triton-tensor-layout.cpp\n++++ b/bin/triton-tensor-layout.cpp\n+@@ -41,29 +41,32 @@ using namespace mlir;\n+ // CLI options\n+ //===--------------------------------------------------------------------===//\n+ \n+-cl::OptionCategory PrinterCategory(\"Available Print Options\",\n+-                                   \"Options for the tensor layout printing.\");\n++static cl::OptionCategory &getPrinterCategory() {\n++  static cl::OptionCategory PrinterCategory(\n++      \"Available Print Options\", \"Options for the tensor layout printing.\");\n++  return PrinterCategory;\n++}\n+ \n+ static cl::opt<std::string> InputFile(\n+     \"i\", cl::desc(\"File that contains the tensor data layout attributes\"),\n+-    cl::init(\"\"), cl::value_desc(\"filename\"), cl::cat(PrinterCategory));\n++    cl::init(\"\"), cl::value_desc(\"filename\"), cl::cat(getPrinterCategory()));\n+ \n+ static cl::opt<std::string>\n+     OutputFile(\"o\", cl::desc(\"Output file to write the layout into\"),\n+                cl::init(\"\"), cl::value_desc(\"filename\"),\n+-               cl::cat(PrinterCategory));\n++               cl::cat(getPrinterCategory()));\n+ \n+ static cl::opt<std::string>\n+     DataLayoutStr(\"l\", cl::desc(\"Tensor data layout attribute in string\"),\n+                   cl::value_desc(\"layout-string\"), cl::init(\"\"),\n+-                  cl::cat(PrinterCategory));\n++                  cl::cat(getPrinterCategory()));\n+ \n+ static cl::list<std::string>\n+     AliasName(\"alias-names\",\n+               cl::desc(\"A list of alias names (separated by comma) of the \"\n+                        \"layout attributes in the input file\"),\n+               cl::value_desc(\"name1,name2,name3,...\"), cl::CommaSeparated,\n+-              cl::ZeroOrMore, cl::cat(PrinterCategory));\n++              cl::ZeroOrMore, cl::cat(getPrinterCategory()));\n+ \n+ static cl::opt<bool> UseHWPointOfView(\n+     \"use-hw-view\",\n+@@ -71,11 +74,11 @@ static cl::opt<bool> UseHWPointOfView(\n+         \"Print the layout in hardware point of view. This means the output is \"\n+         \"from the warp's perspective. Otherwise, the output is from the \"\n+         \"tensor's perspective (e.g., each element maps to xxx thread).\"),\n+-    cl::init(false), cl::cat(PrinterCategory));\n++    cl::init(false), cl::cat(getPrinterCategory()));\n+ \n+ static cl::opt<std::string> TensorStr(\n+     \"t\", cl::desc(\"Tensor shape and element type (e.g., tensor<2x2xf32>)\"),\n+-    cl::init(\"\"), cl::value_desc(\"tensor-type\"), cl::cat(PrinterCategory));\n++    cl::init(\"\"), cl::value_desc(\"tensor-type\"), cl::cat(getPrinterCategory()));\n+ \n+ //===--------------------------------------------------------------------===//\n+ // Helper functions\n+@@ -182,7 +185,7 @@ static LogicalResult printLayoutFromStri\n+ //===--------------------------------------------------------------------===//\n+ \n+ int main(int argc, char **argv) {\n+-  cl::HideUnrelatedOptions(PrinterCategory);\n++  cl::HideUnrelatedOptions(getPrinterCategory());\n+   cl::ParseCommandLineOptions(argc, argv, \"tensor layout printer\\n\");\n+ \n+   DialectRegistry registry;\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 69,
        "deletions": 1
    }
}