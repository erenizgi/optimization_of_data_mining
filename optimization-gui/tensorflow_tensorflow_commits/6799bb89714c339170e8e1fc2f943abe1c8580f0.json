{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::ResourceExhausted in xla\n\nThis change replaces usages of tsl::errors::ResourceExhausted with absl::ResourceExhaustedError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nChanges:\n- Replaced errors::ResourceExhausted with absl::ResourceExhaustedError.\n- Used absl::StrCat to construct error messages where necessary.\n- Fixed missing dependencies in BUILD files using build_cleaner.\n- Reordered includes in windows_file_system.cc.\nPiperOrigin-RevId: 837490121",
    "sha": "6799bb89714c339170e8e1fc2f943abe1c8580f0",
    "files": [
        {
            "sha": "25043773c3214be6b71d8edd0a2e9354e358df1c",
            "filename": "third_party/xla/xla/backends/profiler/gpu/device_tracer_cuda.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fdevice_tracer_cuda.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fdevice_tracer_cuda.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fdevice_tracer_cuda.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -78,7 +78,7 @@ class GpuTracer : public tsl::profiler::ProfilerInterface {\n \n absl::Status GpuTracer::DoStart() {\n   if (!cupti_tracer_->IsAvailable()) {\n-    return tsl::errors::Unavailable(\"Another profile session running.\");\n+    return absl::UnavailableError(\"Another profile session running.\");\n   }\n \n   options_.cbids_selected = CuptiTracer::CreateDefaultCallbackIds();"
        },
        {
            "sha": "8df9cecb8e05206d595fdb8067f26724bfda8bcb",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/BUILD",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -36,11 +36,17 @@ cc_library(\n     deps = [\n         \"//xla/tsl/lib/io:inputstream_interface\",\n         \"//xla/tsl/platform:env\",\n+        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:macros\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@local_tsl//tsl/platform:platform_port\",\n+        \"@local_tsl//tsl/platform:tstring\",\n     ],\n     alwayslink = True,\n )\n@@ -67,8 +73,13 @@ cc_library(\n     deps = [\n         \"//xla/tsl/lib/io:inputstream_interface\",\n         \"//xla/tsl/platform:errors\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/memory\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:cord\",\n         \"@local_tsl//tsl/platform:platform_port\",\n+        \"@local_tsl//tsl/platform:tstring\",\n     ],\n     alwayslink = True,\n )\n@@ -94,8 +105,16 @@ tsl_cc_test(\n         \"//xla/tsl/lib/io:inputbuffer\",\n         \"//xla/tsl/lib/io:random_inputstream\",\n         \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:env_impl\",\n+        \"//xla/tsl/platform:errors\",\n+        \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@com_google_googletest//:gtest_main\",\n+        \"@local_tsl//tsl/platform:platform_port\",\n+        \"@local_tsl//tsl/platform:tstring\",\n     ],\n )"
        },
        {
            "sha": "16000a6bafbb8138f0e7160a036a4082ee939399",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_inputbuffer.cc",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -16,8 +16,19 @@ limitations under the License.\n #include \"xla/tsl/lib/io/snappy/snappy_inputbuffer.h\"\n \n #include <algorithm>\n+#include <cstddef>\n+#include <cstdint>\n+#include <cstring>\n \n+#include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/file_system.h\"\n+#include \"tsl/platform/snappy.h\"\n+#include \"tsl/platform/tstring.h\"\n \n namespace tsl {\n namespace io {\n@@ -94,10 +105,10 @@ absl::Status SnappyInputBuffer::Inflate() {\n     TF_RETURN_IF_ERROR(ReadFromFile());\n     if (avail_in_ < compressed_block_length) {\n       if (compressed_block_length > input_buffer_capacity_) {\n-        return errors::ResourceExhausted(\n-            \"Input buffer(size: \", input_buffer_capacity_,\n-            \" bytes) too small. Should be larger \", \"than \",\n-            compressed_block_length, \" bytes.\");\n+        return absl::ResourceExhaustedError(\n+            absl::StrCat(\"Input buffer(size: \", input_buffer_capacity_,\n+                         \" bytes) too small. Should be larger than \",\n+                         compressed_block_length, \" bytes.\"));\n       } else {\n         return errors::DataLoss(\n             absl::StrCat(\"Failed to read \", compressed_block_length,"
        },
        {
            "sha": "ce485086ee4ba23460cd936e0e17bf0ea3789c79",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_inputstream.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -16,10 +16,18 @@ limitations under the License.\n #include \"xla/tsl/lib/io/snappy/snappy_inputstream.h\"\n \n #include <algorithm>\n-\n-#include \"absl/memory/memory.h\"\n+#include <cstddef>\n+#include <cstdint>\n+#include <cstring>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/cord.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"xla/tsl/lib/io/inputstream_interface.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"tsl/platform/snappy.h\"\n+#include \"tsl/platform/tstring.h\"\n \n namespace tsl {\n namespace io {\n@@ -115,11 +123,10 @@ absl::Status SnappyInputStream::Inflate() {\n \n   DCHECK_EQ(avail_out_, 0);\n   if (output_buffer_bytes_ < uncompressed_length) {\n-    return errors::ResourceExhausted(\n-        \"Output buffer(size: \", output_buffer_bytes_,\n-        \" bytes\"\n-        \") too small. Should be larger than \",\n-        uncompressed_length, \" bytes.\");\n+    return absl::ResourceExhaustedError(\n+        absl::StrCat(\"Output buffer(size: \", output_buffer_bytes_,\n+                     \" bytes) too small. Should be larger than \",\n+                     uncompressed_length, \" bytes.\"));\n   }\n \n   next_out_ = output_buffer_.get();"
        },
        {
            "sha": "9ed24c20d531101a401661874ede16ab5914d605",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_test.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -13,16 +13,29 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include \"tsl/platform/snappy.h\"\n+\n+#include <cstddef>\n+#include <cstdio>\n+#include <cstring>\n #include <memory>\n+#include <string>\n \n-#include \"xla/tsl/lib/core/status_test_util.h\"\n-#include \"xla/tsl/lib/io/inputbuffer.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n #include \"xla/tsl/lib/io/random_inputstream.h\"\n #include \"xla/tsl/lib/io/snappy/snappy_inputbuffer.h\"\n #include \"xla/tsl/lib/io/snappy/snappy_inputstream.h\"\n #include \"xla/tsl/lib/io/snappy/snappy_outputbuffer.h\"\n #include \"xla/tsl/platform/env.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/file_system.h\"\n+#include \"xla/tsl/platform/status.h\"\n #include \"xla/tsl/platform/test.h\"\n+#include \"tsl/platform/tstring.h\"\n \n namespace tsl {\n \n@@ -341,9 +354,9 @@ TEST(SnappyBuffers, SmallUncompressInputStream) {\n     return;\n   }\n   CHECK_EQ(TestMultipleWritesInputStream(10000, 10000, 10000, 10, 2, true),\n-           errors::ResourceExhausted(\n+           absl::ResourceExhaustedError(absl::StrCat(\n                \"Output buffer(size: 10 bytes) too small. \",\n-               \"Should be larger than \", GetRecord().size(), \" bytes.\"));\n+               \"Should be larger than \", GetRecord().size(), \" bytes.\")));\n }\n \n TEST(SnappyBuffers, CorruptBlock) {"
        },
        {
            "sha": "936246474fe998d6a6ffa64b17a242d747244fc2",
            "filename": "third_party/xla/xla/tsl/lib/monitoring/cell_reader-inl.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader-inl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader-inl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader-inl.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -31,7 +31,6 @@ limitations under the License.\n #include \"xla/tsl/lib/monitoring/test_utils.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\"\n-#include \"xla/tsl/platform/types.h\"\n \n namespace tsl {\n namespace monitoring {\n@@ -101,9 +100,9 @@ absl::StatusOr<Point> GetLatestPoint(const CollectedMetrics& metrics,\n   TF_ASSIGN_OR_RETURN(std::vector<Point> points,\n                       GetPoints(metrics, metric_name, labels));\n   if (points.empty()) {\n-    return errors::Unavailable(\"No data collected for metric \", metric_name,\n-                               \" with labels [\", absl::StrJoin(labels, \", \"),\n-                               \"].\");\n+    return absl::UnavailableError(\n+        absl::StrCat(\"No data collected for metric \", metric_name,\n+                     \" with labels [\", absl::StrJoin(labels, \", \"), \"].\"));\n   }\n \n   bool same_start_time ="
        },
        {
            "sha": "2e8a6b6fde7ec242ebb526c3a49cb15ce8fe9b7f",
            "filename": "third_party/xla/xla/tsl/platform/cloud/BUILD",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -140,7 +140,6 @@ cc_library(\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n         \"@local_tsl//tsl/platform:retrying_file_system\",\n         \"@local_tsl//tsl/platform:retrying_utils\",\n         \"@local_tsl//tsl/platform:str_util\",\n@@ -416,17 +415,29 @@ tsl_cc_test(\n     size = \"medium\",\n     srcs = [\"gcs_file_system_test.cc\"],\n     deps = [\n+        \":compute_engine_zone_provider\",\n+        \":file_block_cache\",\n         \":gcs_file_system\",\n+        \":gcs_throttle\",\n+        \":google_auth_provider\",\n+        \":http_request\",\n         \":http_request_fake\",\n         \"//xla/tsl/lib/core:status_test_util\",\n-        \"//xla/tsl/platform:env_impl\",\n+        \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n+        \"//xla/tsl/platform:file_statistics\",\n+        \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:test\",\n+        \"//xla/tsl/platform:types\",\n         \"//xla/tsl/profiler/backends/cpu:traceme_recorder_impl\",\n         \"//xla/tsl/profiler/utils:time_utils_impl\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@com_google_googletest//:gtest_main\",\n-        \"@local_tsl//tsl/platform:str_util\",\n+        \"@local_tsl//tsl/platform:retrying_utils\",\n         \"@local_tsl//tsl/platform:strcat\",\n     ],\n )\n@@ -538,11 +549,14 @@ tsl_cc_test(\n     srcs = [\"compute_engine_metadata_client_test.cc\"],\n     deps = [\n         \":compute_engine_metadata_client\",\n+        \":http_request\",\n         \":http_request_fake\",\n+        \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:env_impl\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n+        \"@local_tsl//tsl/platform:retrying_utils\",\n     ],\n )\n "
        },
        {
            "sha": "c627bc21d9387fb5e7f35aa4d6eb69d01c2ee3f6",
            "filename": "third_party/xla/xla/tsl/platform/cloud/compute_engine_metadata_client_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcompute_engine_metadata_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcompute_engine_metadata_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcompute_engine_metadata_client_test.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -15,9 +15,17 @@ limitations under the License.\n \n #include \"xla/tsl/platform/cloud/compute_engine_metadata_client.h\"\n \n+#include <memory>\n+#include <string>\n+#include <vector>\n+\n+#include \"absl/status/status.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/cloud/http_request.h\"\n #include \"xla/tsl/platform/cloud/http_request_fake.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/test.h\"\n+#include \"tsl/platform/retrying_utils.h\"\n \n namespace tsl {\n \n@@ -81,7 +89,7 @@ TEST_F(ComputeEngineMetadataClientTest, RetryOnFailure) {\n            \"Uri: http://metadata.google.internal/computeMetadata/v1/instance\"\n            \"/service-accounts/default/token\\n\"\n            \"Header Metadata-Flavor: Google\\n\",\n-           \"\", errors::Unavailable(\"503\"), 503),\n+           \"\", absl::UnavailableError(\"503\"), 503),\n        new FakeHttpRequest(\n            \"Uri: http://metadata.google.internal/computeMetadata/v1/instance\"\n            \"/service-accounts/default/token\\n\""
        },
        {
            "sha": "89db9893c53a32f443de22b5541e0b3af9b4fbf2",
            "filename": "third_party/xla/xla/tsl/platform/cloud/curl_http_request.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcurl_http_request.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcurl_http_request.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fcurl_http_request.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -547,7 +547,7 @@ absl::Status CurlHttpRequest::Send() {\n     case 502:  // Bad Gateway\n     case 503:  // Service Unavailable\n     default:   // All other HTTP response codes also should be retried.\n-      result = errors::Unavailable(get_error_message());\n+      result = absl::UnavailableError(get_error_message());\n       break;\n   }\n   if (!result.ok()) {\n@@ -676,7 +676,7 @@ absl::Status CurlHttpRequest::CURLcodeToStatus(CURLcode code,\n   }\n   // Return Unavailable to retry by default. There may be other permanent\n   // failures that should be distinguished.\n-  return errors::Unavailable(\n+  return absl::UnavailableError(\n       absl::StrCat(error_message, *error_buffer ? error_buffer : \"(none)\"));\n }\n "
        },
        {
            "sha": "37a81244fe5f409ba370f9c25113049b374ec4ea",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -72,7 +72,6 @@ limitations under the License.\n #ifdef _WIN32\n #include <io.h>  // for _mktemp\n #endif\n-#include \"absl/base/macros.h\"\n #include \"json/json.h\"\n #include \"xla/tsl/platform/cloud/curl_http_request.h\"\n #include \"xla/tsl/platform/cloud/file_block_cache.h\"\n@@ -83,7 +82,6 @@ limitations under the License.\n #include \"xla/tsl/platform/errors.h\"\n #include \"tsl/platform/numbers.h\"\n #include \"tsl/platform/path.h\"\n-#include \"tsl/platform/protobuf.h\"\n #include \"tsl/platform/retrying_utils.h\"\n #include \"tsl/platform/str_util.h\"\n #include \"tsl/platform/stringprintf.h\"\n@@ -687,9 +685,9 @@ class GcsWritableFile : public WritableFile {\n     if (absl::IsNotFound(upload_status)) {\n       // GCS docs recommend retrying the whole upload. We're relying on the\n       // RetryingFileSystem to retry the Sync() call.\n-      return errors::Unavailable(\n-          strings::StrCat(\"Upload to gs://\", bucket_, \"/\", object_,\n-                          \" failed, caused by: \", upload_status.message()));\n+      return absl::UnavailableError(\n+          absl::StrCat(\"Upload to gs://\", bucket_, \"/\", object_,\n+                       \" failed, caused by: \", upload_status.message()));\n     }\n     if (upload_status.ok()) {\n       if (should_compose) {"
        },
        {
            "sha": "b138ec580c825b744f4ac478e52986758c18cdb1",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system_test.cc",
            "status": "modified",
            "additions": 40,
            "deletions": 19,
            "changes": 59,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -15,14 +15,35 @@ limitations under the License.\n \n #include \"xla/tsl/platform/cloud/gcs_file_system.h\"\n \n-#include <fstream>\n-\n+#include <cstddef>\n+#include <cstdint>\n+#include <memory>\n+#include <string>\n+#include <unordered_set>\n+#include <utility>\n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/match.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/cloud/auth_provider.h\"\n+#include \"xla/tsl/platform/cloud/file_block_cache.h\"\n+#include \"xla/tsl/platform/cloud/gcs_throttle.h\"\n+#include \"xla/tsl/platform/cloud/http_request.h\"\n #include \"xla/tsl/platform/cloud/http_request_fake.h\"\n+#include \"xla/tsl/platform/cloud/zone_provider.h\"\n+#include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/file_statistics.h\"\n+#include \"xla/tsl/platform/file_system.h\"\n+#include \"xla/tsl/platform/status.h\"\n #include \"xla/tsl/platform/test.h\"\n-#include \"tsl/platform/str_util.h\"\n+#include \"xla/tsl/platform/types.h\"\n+#include \"tsl/platform/retrying_utils.h\"\n #include \"tsl/platform/strcat.h\"\n \n // Undef DeleteFile macro defined in wndows.h.\n@@ -1015,39 +1036,39 @@ TEST(GcsFileSystemTest, NewWritableFile_ResumeUploadSucceeds) {\n                            \"Header Content-Range: bytes 0-16/17\\n\"\n                            \"Timeouts: 5 1 30\\n\"\n                            \"Put body: content1,content2\\n\",\n-                           \"\", errors::Unavailable(\"503\"), 503),\n+                           \"\", absl::UnavailableError(\"503\"), 503),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n                            \"Timeouts: 5 1 10\\n\"\n                            \"Header Content-Range: bytes */17\\n\"\n                            \"Put: yes\\n\",\n-                           \"\", errors::Unavailable(\"308\"), nullptr,\n+                           \"\", absl::UnavailableError(\"308\"), nullptr,\n                            {{\"Range\", \"0-10\"}}, 308),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n                            \"Header Content-Range: bytes 11-16/17\\n\"\n                            \"Timeouts: 5 1 30\\n\"\n                            \"Put body: ntent2\\n\",\n-                           \"\", errors::Unavailable(\"503\"), 503),\n+                           \"\", absl::UnavailableError(\"503\"), 503),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n                            \"Timeouts: 5 1 10\\n\"\n                            \"Header Content-Range: bytes */17\\n\"\n                            \"Put: yes\\n\",\n-                           \"\", errors::Unavailable(\"308\"), nullptr,\n+                           \"\", absl::UnavailableError(\"308\"), nullptr,\n                            {{\"Range\", \"bytes=0-12\"}}, 308),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n                            \"Header Content-Range: bytes 13-16/17\\n\"\n                            \"Timeouts: 5 1 30\\n\"\n                            \"Put body: ent2\\n\",\n-                           \"\", errors::Unavailable(\"308\"), 308),\n+                           \"\", absl::UnavailableError(\"308\"), 308),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n                            \"Timeouts: 5 1 10\\n\"\n                            \"Header Content-Range: bytes */17\\n\"\n                            \"Put: yes\\n\",\n-                           \"\", errors::Unavailable(\"308\"), nullptr,\n+                           \"\", absl::UnavailableError(\"308\"), nullptr,\n                            {{\"Range\", \"bytes=0-14\"}}, 308),\n        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n                            \"Auth Token: fake_token\\n\"\n@@ -1180,23 +1201,23 @@ TEST(GcsFileSystemTest, NewWritableFile_ResumeUploadAllAttemptsFail) {\n                            \"Header Content-Range: bytes 0-16/17\\n\"\n                            \"Timeouts: 5 1 30\\n\"\n                            \"Put body: content1,content2\\n\",\n-                           \"\", errors::Unavailable(\"503\"), 503)});\n+                           \"\", absl::UnavailableError(\"503\"), 503)});\n   for (int i = 0; i < 10; i++) {\n-    requests.emplace_back(\n-        new FakeHttpRequest(\"Uri: https://custom/upload/location\\n\"\n-                            \"Auth Token: fake_token\\n\"\n-                            \"Timeouts: 5 1 10\\n\"\n-                            \"Header Content-Range: bytes */17\\n\"\n-                            \"Put: yes\\n\",\n-                            \"\", errors::Unavailable(\"important HTTP error 308\"),\n-                            nullptr, {{\"Range\", \"0-10\"}}, 308));\n+    requests.emplace_back(new FakeHttpRequest(\n+        \"Uri: https://custom/upload/location\\n\"\n+        \"Auth Token: fake_token\\n\"\n+        \"Timeouts: 5 1 10\\n\"\n+        \"Header Content-Range: bytes */17\\n\"\n+        \"Put: yes\\n\",\n+        \"\", absl::UnavailableError(\"important HTTP error 308\"), nullptr,\n+        {{\"Range\", \"0-10\"}}, 308));\n     requests.emplace_back(new FakeHttpRequest(\n         \"Uri: https://custom/upload/location\\n\"\n         \"Auth Token: fake_token\\n\"\n         \"Header Content-Range: bytes 11-16/17\\n\"\n         \"Timeouts: 5 1 30\\n\"\n         \"Put body: ntent2\\n\",\n-        \"\", errors::Unavailable(\"important HTTP error 503\"), 503));\n+        \"\", absl::UnavailableError(\"important HTTP error 503\"), 503));\n   }\n   // These calls will be made in the Close() attempt from the destructor.\n   // Letting the destructor succeed."
        },
        {
            "sha": "17f5489b19b506a9fc8e2b155b17733cd3cbd3d6",
            "filename": "third_party/xla/xla/tsl/platform/cloud/google_auth_provider_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgoogle_auth_provider_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgoogle_auth_provider_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgoogle_auth_provider_test.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -32,7 +32,6 @@ limitations under the License.\n #include \"xla/tsl/platform/cloud/http_request_fake.h\"\n #include \"xla/tsl/platform/cloud/oauth_client.h\"\n #include \"xla/tsl/platform/env.h\"\n-#include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"tsl/platform/path.h\"\n #include \"tsl/platform/retrying_utils.h\"\n@@ -180,7 +179,7 @@ TEST_F(GoogleAuthProviderTest, RunningOnGCE) {\n            \"Uri: http://metadata.google.internal/computeMetadata/v1/instance\"\n            \"/service-accounts/default/token\\n\"\n            \"Header Metadata-Flavor: Google\\n\",\n-           \"\", errors::Unavailable(\"503\"), 503),\n+           \"\", absl::UnavailableError(\"503\"), 503),\n        new FakeHttpRequest(\n            \"Uri: http://metadata.google.internal/computeMetadata/v1/instance\"\n            \"/service-accounts/default/token\\n\""
        },
        {
            "sha": "14f2e4d2f0b041ab46e2867065bfb48636f41c72",
            "filename": "third_party/xla/xla/tsl/platform/default/posix_file_system.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -121,8 +121,8 @@ class PosixRandomAccessFile : public RandomAccessFile {\n \n     char* scratch = new char[n];\n     if (scratch == nullptr) {\n-      return errors::ResourceExhausted(\"Unable to allocate \", n,\n-                                       \" bytes for file reading.\");\n+      return absl::ResourceExhaustedError(\n+          absl::StrCat(\"Unable to allocate \", n, \" bytes for file reading.\"));\n     }\n \n     absl::string_view tmp;"
        },
        {
            "sha": "1268767a5cb96b314189ab8f62fdad0668655f79",
            "filename": "third_party/xla/xla/tsl/platform/windows/windows_file_system.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -171,8 +171,8 @@ class WindowsRandomAccessFile : public RandomAccessFile {\n \n     char* scratch = new char[n];\n     if (scratch == nullptr) {\n-      return errors::ResourceExhausted(\"Unable to allocate \", n,\n-                                       \" bytes for file reading.\");\n+      return absl::ResourceExhaustedError(\n+          absl::StrCat(\"Unable to allocate \", n, \" bytes for file reading.\"));\n     }\n \n     absl::string_view tmp;"
        },
        {
            "sha": "84f7c5d7e2a7bc405e95d13dbd16b3196c0230d2",
            "filename": "third_party/xla/xla/tsl/profiler/rpc/client/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -37,11 +37,13 @@ cc_library(\n         \":save_profile\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status\",\n-        \"//xla/tsl/platform:types\",\n         \"//xla/tsl/profiler/convert:trace_events_to_json\",\n         \"//xla/tsl/profiler/convert:xplane_to_trace_events\",\n         \"//xla/tsl/profiler/utils:session_manager\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/time\",\n         \"@local_tsl//tsl/platform:platform_port\","
        },
        {
            "sha": "ce377e686d8020b385e599dec48cda914816904d",
            "filename": "third_party/xla/xla/tsl/profiler/rpc/client/capture_profile.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6799bb89714c339170e8e1fc2f943abe1c8580f0/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc?ref=6799bb89714c339170e8e1fc2f943abe1c8580f0",
            "patch": "@@ -14,21 +14,24 @@ limitations under the License.\n ==============================================================================*/\n #include \"xla/tsl/profiler/rpc/client/capture_profile.h\"\n \n+#include <cstdint>\n #include <iostream>\n-#include <limits>\n #include <memory>\n+#include <string>\n #include <variant>\n #include <vector>\n \n #include \"absl/container/flat_hash_map.h\"\n-#include \"absl/strings/str_cat.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/strings/str_split.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/status.h\"\n-#include \"xla/tsl/platform/types.h\"\n #include \"xla/tsl/profiler/convert/trace_events_to_json.h\"\n #include \"xla/tsl/profiler/convert/xplane_to_trace_events.h\"\n #include \"xla/tsl/profiler/rpc/client/profiler_client.h\"\n@@ -115,7 +118,7 @@ NewProfileSessionRequest PopulateNewProfileSessionRequest(\n }\n \n inline bool ShouldRetryTracing(absl::Status status) {\n-  return status.code() == error::Code::UNAVAILABLE ||\n+  return status.code() == absl::StatusCode::kUnavailable ||\n          status.code() == error::Code::ALREADY_EXISTS ||\n          // When auto-reconnecting to a remote TensorFlow worker after it\n          // restarts, gRPC can return an UNKNOWN error code with a \"Stream\n@@ -185,7 +188,7 @@ absl::Status NewSession(absl::string_view repository_root,\n   std::cout << \"Profile session succeed for host(s):\"\n             << absl::StrJoin(opts.service_addresses(), \",\") << std::endl;\n   if (response.empty_trace()) {\n-    return errors::Unavailable(\"No trace event is collected\");\n+    return absl::UnavailableError(\"No trace event is collected\");\n   }\n   return absl::OkStatus();\n }"
        }
    ],
    "stats": {
        "total": 222,
        "additions": 158,
        "deletions": 64
    }
}