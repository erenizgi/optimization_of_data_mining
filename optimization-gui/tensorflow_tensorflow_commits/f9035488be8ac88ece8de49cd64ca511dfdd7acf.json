{
    "author": "smit-hinsu",
    "message": "Migrate `std::unordered_map` to `absl::flat_hash_map` in `candidate_sampler_ops.cc`.\n\nThis change replaces `std::unordered_map` with the more performant `absl::flat_hash_map` for the `sampled_candidate_to_pos` map.\n\nPiperOrigin-RevId: 823364733",
    "sha": "f9035488be8ac88ece8de49cd64ca511dfdd7acf",
    "files": [
        {
            "sha": "882b2253df0bfc07aa211ab82504ff5410a6a254",
            "filename": "tensorflow/core/kernels/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f9035488be8ac88ece8de49cd64ca511dfdd7acf/tensorflow%2Fcore%2Fkernels%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f9035488be8ac88ece8de49cd64ca511dfdd7acf/tensorflow%2Fcore%2Fkernels%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2FBUILD?ref=f9035488be8ac88ece8de49cd64ca511dfdd7acf",
            "patch": "@@ -2440,6 +2440,7 @@ tf_kernel_library(\n         \":range_sampler\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:lib\",\n+        \"@com_google_absl//absl/container:flat_hash_map\",\n     ],\n )\n "
        },
        {
            "sha": "eab8997f6cd781d28a0e1953c830599ff1f3c6a4",
            "filename": "tensorflow/core/kernels/candidate_sampler_ops.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f9035488be8ac88ece8de49cd64ca511dfdd7acf/tensorflow%2Fcore%2Fkernels%2Fcandidate_sampler_ops.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f9035488be8ac88ece8de49cd64ca511dfdd7acf/tensorflow%2Fcore%2Fkernels%2Fcandidate_sampler_ops.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fcandidate_sampler_ops.cc?ref=f9035488be8ac88ece8de49cd64ca511dfdd7acf",
            "patch": "@@ -18,9 +18,9 @@ limitations under the License.\n #define EIGEN_USE_THREADS\n \n #include <cfloat>\n-#include <unordered_map>\n #include <vector>\n \n+#include \"absl/container/flat_hash_map.h\"\n #include \"tensorflow/core/framework/op_kernel.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/kernels/range_sampler.h\"\n@@ -219,8 +219,10 @@ class ComputeAccidentalHitsOp : public OpKernel {\n                     \"sampled_candidates must be a vector, which is typically \"\n                     \"an output from CandidateSampler\"));\n \n-    std::unordered_map<int64_t, int> sampled_candidate_to_pos;\n-    for (int64_t i = 0; i < in_sampled_candidates.dim_size(0); ++i) {\n+    const int64_t num_sampled = in_sampled_candidates.dim_size(0);\n+    absl::flat_hash_map<int64_t, int> sampled_candidate_to_pos;\n+    sampled_candidate_to_pos.reserve(num_sampled);\n+    for (int64_t i = 0; i < num_sampled; ++i) {\n       sampled_candidate_to_pos[in_sampled_candidates.vec<int64_t>()(i)] = i;\n     }\n "
        }
    ],
    "stats": {
        "total": 9,
        "additions": 6,
        "deletions": 3
    }
}