{
    "author": "mkuperst",
    "message": "[XLA] Clean up AnnotateHostComputeOffloadTest.\n\nAnnotateHostComputeOffload is no longer a module-group pass, so the test doesn't need to use module groups.\n\nPiperOrigin-RevId: 817177966",
    "sha": "904efade84c3928b433a6272ff3609e2ffd8191e",
    "files": [
        {
            "sha": "6823d35c9b807841a5d588ebc951a13f3f89ca2d",
            "filename": "third_party/xla/xla/core/host_offloading/annotate_host_compute_offload_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 15,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/904efade84c3928b433a6272ff3609e2ffd8191e/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fannotate_host_compute_offload_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/904efade84c3928b433a6272ff3609e2ffd8191e/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fannotate_host_compute_offload_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fannotate_host_compute_offload_test.cc?ref=904efade84c3928b433a6272ff3609e2ffd8191e",
            "patch": "@@ -23,7 +23,7 @@ limitations under the License.\n #include \"absl/log/log.h\"\n #include \"absl/status/statusor.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n-#include \"xla/hlo/ir/hlo_module_group.h\"\n+#include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/pass/hlo_pass_pipeline.h\"\n #include \"xla/hlo/testlib/hlo_hardware_independent_test_base.h\"\n@@ -36,10 +36,10 @@ namespace {\n \n class AnnotateHostComputeOffloadTest : public HloHardwareIndependentTestBase {\n  protected:\n-  static absl::StatusOr<bool> RunPasses(HloModuleGroup& module_group) {\n+  static absl::StatusOr<bool> RunPasses(HloModule* module) {\n     HloPassPipeline pipeline(\"AnnotateHostComputeOffloadTest\");\n     pipeline.AddPass<AnnotateHostComputeOffload>();\n-    return pipeline.RunOnModuleGroup(&module_group);\n+    return pipeline.Run(module);\n   }\n \n   static void ExpectAllHostInstructions(HloComputation& computation) {\n@@ -63,8 +63,7 @@ TEST_F(AnnotateHostComputeOffloadTest, TestUnmodifiedModule) {\n   })\";\n   TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<VerifiedHloModule> verified_module,\n                           ParseAndReturnVerifiedModule(hlo_string));\n-  HloModuleGroup module_group(std::move(verified_module));\n-  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(module_group));\n+  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(verified_module.get()));\n   EXPECT_FALSE(modified);\n }\n \n@@ -87,13 +86,11 @@ TEST_F(AnnotateHostComputeOffloadTest, AnnotatesHostComputeOffloadForHostCall) {\n   })\";\n   TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<VerifiedHloModule> verified_module,\n                           ParseAndReturnVerifiedModule(hlo_string));\n-  HloModuleGroup module_group(std::move(verified_module));\n-  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(module_group));\n+  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(verified_module.get()));\n   EXPECT_TRUE(modified);\n \n   HloComputation* host_compute_offload =\n-      module_group.modules().front()->GetComputationWithName(\n-          \"host_compute_offload\");\n+      verified_module->GetComputationWithName(\"host_compute_offload\");\n   ASSERT_NE(host_compute_offload, nullptr);\n   ExpectAllHostInstructions(*host_compute_offload);\n }\n@@ -124,19 +121,16 @@ TEST_F(AnnotateHostComputeOffloadTest,\n   })\";\n   TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<VerifiedHloModule> verified_module,\n                           ParseAndReturnVerifiedModule(hlo_string));\n-  HloModuleGroup module_group(std::move(verified_module));\n-  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(module_group));\n+  TF_ASSERT_OK_AND_ASSIGN(bool modified, RunPasses(verified_module.get()));\n   EXPECT_TRUE(modified);\n \n   HloComputation* host_compute_offload =\n-      module_group.modules().front()->GetComputationWithName(\n-          \"host_compute_offload\");\n+      verified_module->GetComputationWithName(\"host_compute_offload\");\n   ASSERT_NE(host_compute_offload, nullptr);\n   ExpectAllHostInstructions(*host_compute_offload);\n \n   HloComputation* nested_host_compute_offload =\n-      module_group.modules().front()->GetComputationWithName(\n-          \"nested_host_compute_offload\");\n+      verified_module->GetComputationWithName(\"nested_host_compute_offload\");\n   ASSERT_NE(nested_host_compute_offload, nullptr);\n   ExpectAllHostInstructions(*nested_host_compute_offload);\n }"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 9,
        "deletions": 15
    }
}