{
    "author": "ethanluoyc",
    "message": "#tf-data reenable captured_function on macos.\n\nPiperOrigin-RevId: 831463431",
    "sha": "9c1a0c8db44069d3cbb745752f6b003ecc31bdaf",
    "files": [
        {
            "sha": "558b59368e615b10e62c1a880e2788157820ea4a",
            "filename": "tensorflow/BUILD",
            "status": "modified",
            "additions": 25,
            "deletions": 31,
            "changes": 56,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c1a0c8db44069d3cbb745752f6b003ecc31bdaf/tensorflow%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c1a0c8db44069d3cbb745752f6b003ecc31bdaf/tensorflow%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2FBUILD?ref=9c1a0c8db44069d3cbb745752f6b003ecc31bdaf",
            "patch": "@@ -1181,37 +1181,31 @@ tf_cc_shared_library(\n     linkstatic = 1,\n     per_os_targets = True,\n     roots = [\n-                \"//tensorflow/c/experimental/filesystem:filesystem_interface\",\n-                \"//tensorflow/c/experimental/stream_executor:stream_executor\",\n-                \"//tensorflow/c:env\",\n-                \"//tensorflow/c:kernels\",\n-                \"//tensorflow/c:kernels_experimental\",\n-                \"//tensorflow/c:ops\",\n-                \"//tensorflow/cc/saved_model:fingerprinting_impl\",\n-                \"//tensorflow/cc/saved_model:loader_lite_impl\",\n-                \"//tensorflow/cc/saved_model:metrics_impl\",\n-                \"//tensorflow/compiler/tf2tensorrt:op_converter_registry_impl\",\n-                \"//tensorflow/core/common_runtime:core_cpu_impl\",\n-                \"//tensorflow/core/common_runtime/gpu:gpu_runtime_impl\",\n-                \"//tensorflow/core/common_runtime/pluggable_device:pluggable_device_runtime_impl\",\n-                \"//tensorflow/core:framework_internal_impl\",\n-                \"//tensorflow/core/framework:tensor\",\n-                \"//tensorflow/core/grappler/optimizers:custom_graph_optimizer_registry_impl\",\n-                \"//tensorflow/core:lib_internal_impl\",\n-                \"//tensorflow/core/profiler:profiler_impl\",\n-                \"//tensorflow/core/util:determinism\",  # Must be linked and exported to libtensorflow_framework.so.\n-                \"//tensorflow/lite/kernels/shim:tf_kernel_shim\",\n-                \"@local_xla//xla/stream_executor:stream_executor_impl\",\n-                \"@local_xla//xla/tsl/framework:bfc_allocator\",\n-                \"@local_xla//xla/tsl/framework:metrics\",\n-            ] + tf_additional_binary_deps() +\n-            # TODO(b/259305727): Remove this select and include captured_function in macos builds.\n-            select({\n-                \"//tensorflow:macos\": [],\n-                \"//conditions:default\": [\n-                    \"//tensorflow/core/data:captured_function\",\n-                ],\n-            }),\n+        \"//tensorflow/c/experimental/filesystem:filesystem_interface\",\n+        \"//tensorflow/c/experimental/stream_executor:stream_executor\",\n+        \"//tensorflow/c:env\",\n+        \"//tensorflow/c:kernels\",\n+        \"//tensorflow/c:kernels_experimental\",\n+        \"//tensorflow/c:ops\",\n+        \"//tensorflow/cc/saved_model:fingerprinting_impl\",\n+        \"//tensorflow/cc/saved_model:loader_lite_impl\",\n+        \"//tensorflow/cc/saved_model:metrics_impl\",\n+        \"//tensorflow/compiler/tf2tensorrt:op_converter_registry_impl\",\n+        \"//tensorflow/core/common_runtime:core_cpu_impl\",\n+        \"//tensorflow/core/common_runtime/gpu:gpu_runtime_impl\",\n+        \"//tensorflow/core/common_runtime/pluggable_device:pluggable_device_runtime_impl\",\n+        \"//tensorflow/core:framework_internal_impl\",\n+        \"//tensorflow/core/framework:tensor\",\n+        \"//tensorflow/core/grappler/optimizers:custom_graph_optimizer_registry_impl\",\n+        \"//tensorflow/core:lib_internal_impl\",\n+        \"//tensorflow/core/profiler:profiler_impl\",\n+        \"//tensorflow/core/util:determinism\",  # Must be linked and exported to libtensorflow_framework.so.\n+        \"//tensorflow/lite/kernels/shim:tf_kernel_shim\",\n+        \"@local_xla//xla/stream_executor:stream_executor_impl\",\n+        \"@local_xla//xla/tsl/framework:bfc_allocator\",\n+        \"@local_xla//xla/tsl/framework:metrics\",\n+        \"//tensorflow/core/data:captured_function\",\n+    ] + tf_additional_binary_deps(),\n     soversion = VERSION,\n     static_deps = PACKAGE_STATIC_DEPS,\n     visibility = [\"//visibility:public\"],"
        },
        {
            "sha": "b8f0434adae02d52b18d09a851dfd92854a10ff9",
            "filename": "tensorflow/core/data/dataset_utils_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c1a0c8db44069d3cbb745752f6b003ecc31bdaf/tensorflow%2Fcore%2Fdata%2Fdataset_utils_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c1a0c8db44069d3cbb745752f6b003ecc31bdaf/tensorflow%2Fcore%2Fdata%2Fdataset_utils_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fdata%2Fdataset_utils_test.cc?ref=9c1a0c8db44069d3cbb745752f6b003ecc31bdaf",
            "patch": "@@ -718,8 +718,6 @@ INSTANTIATE_TEST_SUITE_P(Test, GetOptimizationsTest,\n                                            GetOptimizationTestCase4()));\n \n TEST(DeterministicOpsTest, GetOptimizations) {\n-  // TODO(b/259305727): Re-enable for MacOS when the bug is fixed.\n-#if !defined(__APPLE__)\n   tsl::test::DeterministicOpsScope det_scope;\n   Options options;\n   // options.deterministic should be ignored when deterministic ops are enabled.\n@@ -729,7 +727,6 @@ TEST(DeterministicOpsTest, GetOptimizations) {\n   EXPECT_THAT(std::vector<string>(actual_enabled.begin(), actual_enabled.end()),\n               ::testing::UnorderedElementsAreArray({\"make_deterministic\"}));\n   EXPECT_EQ(actual_disabled.size(), 0);\n-#endif\n }\n \n REGISTER_DATASET_EXPERIMENT(\"test_only_experiment\","
        }
    ],
    "stats": {
        "total": 59,
        "additions": 25,
        "deletions": 34
    }
}