{
    "author": "ybaturina",
    "message": "Add the separate env var to select a custom user mode driver version to match it with KMD version installed on the execution machine.\n\nThe version of the User Mode Driver is controlled by the environment variable `HERMETIC_CUDA_UMD_VERSION`. If it is not set, the version of the User Mode Driver will be the same as specified in `HERMETIC_CUDA_VERSION`.\n\n1) The flag `--@cuda_driver//:enable_forward_compatibility` is renamed to `--@cuda_driver//:include_cuda_umd_libs`. The default value is flipped from false to true.\n\n2) Selection of the hermetic user mode driver should depend on the kernel mode driver installed on the execution machine. User mode driver shouldn't be older than kernel mode driver. Hence, there must be an option to choose hermetic user mode driver version separately from the CUDA runtime version.\n\nPiperOrigin-RevId: 829187396",
    "sha": "4e6788540e20297c1f3c7f7af666a090282d0fa3",
    "files": [
        {
            "sha": "ed5f85aa5249d0bdcbbca161164ed9986fb487c0",
            "filename": ".bazelrc",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/.bazelrc?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -302,9 +302,11 @@ common:cuda --@local_config_cuda//:enable_cuda\n common:cuda --config=cuda_version\n # This flag is needed to include CUDA libraries.\n common:cuda --@local_config_cuda//cuda:include_cuda_libs=true\n+common:cuda --@cuda_driver//:include_cuda_umd_libs=true\n \n # This configuration is used for building the wheels.\n common:cuda_wheel --@local_config_cuda//cuda:include_cuda_libs=false\n+common:cuda_wheel --@cuda_driver//:include_cuda_umd_libs=false\n \n # CUDA: This config refers to building CUDA op kernels with clang.\n common:cuda_clang --config=cuda\n@@ -665,9 +667,6 @@ common:rbe_linux_cuda --config=cuda_clang_official\n common:rbe_linux_cuda --config=rbe_linux_cpu\n # For Remote build execution -- GPU configuration\n common:rbe_linux_cuda --repo_env=REMOTE_GPU_TESTING=1\n-# Enable forward compatibility for CUDA builds because RBE docker image doesn't\n-# have latest CUDA drivers installed.\n-common:rbe_linux_cuda --@cuda_driver//:enable_forward_compatibility=true\n \n common:rbe_linux_cuda_nvcc --config=rbe_linux_cuda\n common:rbe_linux_cuda_nvcc --config=cuda_nvcc"
        },
        {
            "sha": "7f9de39c1e1644d395045d2d1ffd709129b7bafe",
            "filename": "tensorflow/tools/toolchains/remote_config/configs.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/tensorflow%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/tensorflow%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -50,7 +50,7 @@ def initialize_rbe_configs():\n     # The `ml-build`'s base image is a standard `ubuntu22.04` image.\n     # Note that in order to use this image with RBE GPU builds, you need to have hermetic CUDA\n     # toolchain integrated into your project, and pass\n-    # `--@cuda_driver//:enable_forward_compatibility=true` to Bazel command.\n+    # `--@cuda_driver//:include_cuda_umd_libs=true` to Bazel command.\n     ml_build_rbe_config(\"docker://us-docker.pkg.dev/ml-oss-artifacts-published/ml-public-container/ml-build@sha256:ea67e8453d8b09c2ba48853da5e79efef4b65804b4a48dfae4b4da89ffd38405\")\n \n     # TF-Version-Specific SIG Build RBE Configs. The crosstool generated from these"
        },
        {
            "sha": "08d5df4d525cb18c8a4450aad32f2cf76cf8eb56",
            "filename": "tensorflow/workspace0.bzl",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/tensorflow%2Fworkspace0.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/tensorflow%2Fworkspace0.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fworkspace0.bzl?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -108,10 +108,10 @@ def workspace():\n     # Details: https://github.com/google-ml-infra/rules_ml_toolchain\n     http_archive(\n         name = \"rules_ml_toolchain\",\n-        sha256 = \"4133c6c2045de5d7a133f6fc008ee6bd613af778f12143d09003e908dd541d8c\",\n-        strip_prefix = \"rules_ml_toolchain-d8d8f49297a1e74fcceffc9ef6c7f8da9b0a0c53\",\n+        sha256 = \"38f1954af9336c3d020a3b807a3585fdaefa8e9bee725664663279cc4309b8c6\",\n+        strip_prefix = \"rules_ml_toolchain-71d74ee1f7ad0e74c50b3c546d21872d42676e37\",\n         urls = [\n-            \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/d8d8f49297a1e74fcceffc9ef6c7f8da9b0a0c53.tar.gz\",\n+            \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/71d74ee1f7ad0e74c50b3c546d21872d42676e37.tar.gz\",\n         ],\n     )\n "
        },
        {
            "sha": "ebbde2176c1c4bda190864dfb5b792f35bfd0a0a",
            "filename": "third_party/xla/MODULE.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2FMODULE.bazel?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -40,9 +40,9 @@ bazel_dep(name = \"rules_ml_toolchain\")\n # echo \"sha256-${HASH}\"\n archive_override(\n     module_name = \"rules_ml_toolchain\",\n-    integrity = \"sha256-F3KQFnXb//T8maw8d9VG+ikxe09vCF59T/D6m9fHuzY=\",\n-    strip_prefix = \"rules_ml_toolchain-2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f\",\n-    urls = [\"https://github.com/google-ml-infra/rules_ml_toolchain/archive/2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f.tar.gz\"],\n+    integrity = \"sha256-OPGVSvkzbD0CCjuAejWF/a76jpvuclZkZjJ5zEMJuMY=\",\n+    strip_prefix = \"rules_ml_toolchain-71d74ee1f7ad0e74c50b3c546d21872d42676e37\",\n+    urls = [\"https://github.com/google-ml-infra/rules_ml_toolchain/archive/71d74ee1f7ad0e74c50b3c546d21872d42676e37.tar.gz\"],\n )\n \n # TODO: Upstream the patch?\n@@ -210,4 +210,4 @@ pjrt_nightly_timestamp = use_extension(\"//build_tools/pjrt_wheels:nightly.bzl\",\n use_repo(pjrt_nightly_timestamp, \"nightly_timestamp\")\n \n pjrt_rc_number = use_extension(\"//build_tools/pjrt_wheels:release_candidate.bzl\", \"rc_number_repo_bzlmod\")\n-use_repo(pjrt_rc_number, \"rc_number\")\n\\ No newline at end of file\n+use_repo(pjrt_rc_number, \"rc_number\")"
        },
        {
            "sha": "47d37a73f979734f75f8a59a51e04e4b943c54af",
            "filename": "third_party/xla/WORKSPACE",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2FWORKSPACE",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2FWORKSPACE",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2FWORKSPACE?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -9,10 +9,10 @@ load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\")\n # Details: https://github.com/google-ml-infra/rules_ml_toolchain\n http_archive(\n     name = \"rules_ml_toolchain\",\n-    sha256 = \"1772901675dbfff4fc99ac3c77d546fa29317b4f6f085e7d4ff0fa9bd7c7bb36\",\n-    strip_prefix = \"rules_ml_toolchain-2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f\",\n+    sha256 = \"38f1954af9336c3d020a3b807a3585fdaefa8e9bee725664663279cc4309b8c6\",\n+    strip_prefix = \"rules_ml_toolchain-71d74ee1f7ad0e74c50b3c546d21872d42676e37\",\n     urls = [\n-        \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f.tar.gz\",\n+        \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/71d74ee1f7ad0e74c50b3c546d21872d42676e37.tar.gz\",\n     ],\n )\n "
        },
        {
            "sha": "02b26557a82a3b194ccc2f71676eca8bf82854ba",
            "filename": "third_party/xla/tensorflow.bazelrc",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Ftensorflow.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Ftensorflow.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Ftensorflow.bazelrc?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -200,9 +200,11 @@ common:cuda --@rules_ml_toolchain//common:enable_cuda\n common:cuda --config=cuda_version\n # This flag is needed to include CUDA libraries.\n common:cuda --@local_config_cuda//cuda:include_cuda_libs=true\n+common:cuda --@cuda_driver//:include_cuda_umd_libs=true\n \n # This configuration is used for building the wheels.\n common:cuda_wheel --@local_config_cuda//cuda:include_cuda_libs=false\n+common:cuda_wheel --@cuda_driver//:include_cuda_umd_libs=false\n \n # CUDA: This config refers to building CUDA op kernels with clang.\n common:cuda_clang --config=cuda\n@@ -541,9 +543,6 @@ common:rbe_linux_cuda --config=rbe_linux_cpu\n common:rbe_linux_cuda --repo_env=TF_SYSROOT=\n # For Remote build execution -- GPU configuration\n common:rbe_linux_cuda --repo_env=REMOTE_GPU_TESTING=1\n-# Enable forward compatibility for CUDA builds because RBE docker image doesn't\n-# have latest CUDA drivers installed.\n-common:rbe_linux_cuda --@cuda_driver//:enable_forward_compatibility=true\n \n common:rbe_linux_cuda_nvcc --config=rbe_linux_cuda\n common:rbe_linux_cuda_nvcc --config=cuda_nvcc"
        },
        {
            "sha": "807f13fb546fae4019117e9f098679ee80b6843a",
            "filename": "third_party/xla/tools/toolchains/remote_config/configs.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Ftools%2Ftoolchains%2Fremote_config%2Fconfigs.bzl?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -50,7 +50,7 @@ def initialize_rbe_configs():\n     # The `ml-build`'s base image is a standard `ubuntu22.04` image.\n     # Note that in order to use this image with RBE GPU builds, you need to have hermetic CUDA\n     # toolchain integrated into your project, and pass\n-    # `--@cuda_driver//:enable_forward_compatibility=true` to Bazel command.\n+    # `--@cuda_driver//:include_cuda_umd_libs=true` to Bazel command.\n     ml_build_rbe_config(\"docker://us-docker.pkg.dev/ml-oss-artifacts-published/ml-public-container/ml-build@sha256:ea67e8453d8b09c2ba48853da5e79efef4b65804b4a48dfae4b4da89ffd38405\")\n \n     # TF-Version-Specific SIG Build RBE Configs. The crosstool generated from these"
        },
        {
            "sha": "ad201aa51d5180a4a3646bc4b8321bbfe44786bb",
            "filename": "third_party/xla/workspace0.bzl",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Fworkspace0.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e6788540e20297c1f3c7f7af666a090282d0fa3/third_party%2Fxla%2Fworkspace0.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fworkspace0.bzl?ref=4e6788540e20297c1f3c7f7af666a090282d0fa3",
            "patch": "@@ -140,10 +140,10 @@ def workspace():\n     if \"rules_ml_toolchain\" not in native.existing_rules():\n         http_archive(\n             name = \"rules_ml_toolchain\",\n-            sha256 = \"1772901675dbfff4fc99ac3c77d546fa29317b4f6f085e7d4ff0fa9bd7c7bb36\",\n-            strip_prefix = \"rules_ml_toolchain-2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f\",\n+            sha256 = \"38f1954af9336c3d020a3b807a3585fdaefa8e9bee725664663279cc4309b8c6\",\n+            strip_prefix = \"rules_ml_toolchain-71d74ee1f7ad0e74c50b3c546d21872d42676e37\",\n             urls = [\n-                \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/2e7bf7b46e917a3b564671b4e9e2b6ab10305e2f.tar.gz\",\n+                \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/71d74ee1f7ad0e74c50b3c546d21872d42676e37.tar.gz\",\n             ],\n         )\n "
        }
    ],
    "stats": {
        "total": 40,
        "additions": 19,
        "deletions": 21
    }
}