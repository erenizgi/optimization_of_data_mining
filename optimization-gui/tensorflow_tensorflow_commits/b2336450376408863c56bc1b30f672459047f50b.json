{
    "author": "nvgrw",
    "message": "`cpu_ffi_test` performs execution so it should use `xla_test`.\n\nPiperOrigin-RevId: 807752035",
    "sha": "b2336450376408863c56bc1b30f672459047f50b",
    "files": [
        {
            "sha": "93b1102f812ad7043594b999810e975e9a72de91",
            "filename": "third_party/xla/xla/service/cpu/tests/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b2336450376408863c56bc1b30f672459047f50b/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b2336450376408863c56bc1b30f672459047f50b/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD?ref=b2336450376408863c56bc1b30f672459047f50b",
            "patch": "@@ -3,6 +3,7 @@\n \n load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n+load(\"//xla/tests:build_defs.bzl\", \"xla_test\")\n load(\"//xla/tsl:tsl.bzl\", \"tsl_copts\")\n load(\"//xla/tsl:tsl.default.bzl\", \"filegroup\")\n load(\"//xla/tsl/mkl:build_defs.bzl\", \"if_graph_api\")\n@@ -139,9 +140,11 @@ xla_cc_test(\n     ],\n )\n \n-xla_cc_test(\n+xla_test(\n     name = \"cpu_ffi_test\",\n     srcs = [\"cpu_ffi_test.cc\"],\n+    backends = [\"cpu\"],\n+    tags = [\"test_migrated_to_hlo_runner_pjrt\"],\n     deps = [\n         \"//xla:debug_options_flags\",\n         \"//xla:shape_util\",\n@@ -150,7 +153,6 @@ xla_cc_test(\n         \"//xla/hlo/builder:xla_builder\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/tests:hlo_pjrt_test_base\",\n-        \"//xla/tests:pjrt_cpu_client_registry\",\n         \"//xla/tests:xla_internal_test_main\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:test\","
        },
        {
            "sha": "e9d6043068b76f285c18019df988909fff263b71",
            "filename": "third_party/xla/xla/service/cpu/tests/cpu_ffi_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b2336450376408863c56bc1b30f672459047f50b/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_ffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b2336450376408863c56bc1b30f672459047f50b/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_ffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_ffi_test.cc?ref=b2336450376408863c56bc1b30f672459047f50b",
            "patch": "@@ -13,6 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include <memory>\n #include <utility>\n \n #include \"absl/status/status.h\"\n@@ -31,8 +32,8 @@ limitations under the License.\n namespace xla {\n namespace {\n \n-static absl::Status HostIOCallback(ffi::Token, ffi::Result<ffi::Token>,\n-                                   ffi::Result<ffi::AnyBuffer>) {\n+absl::Status HostIOCallback(ffi::Token, ffi::Result<ffi::Token>,\n+                            ffi::Result<ffi::AnyBuffer>) {\n   return absl::OkStatus();\n }\n \n@@ -52,8 +53,8 @@ class CpuFFITest : public HloPjRtTestBase {\n };\n \n TEST_F(CpuFFITest, EmulateImpureCallbackWithTokens) {\n-  auto module = CreateNewVerifiedModule();\n-  auto builder = HloComputation::Builder(TestName());\n+  std::unique_ptr<HloModule> module = CreateNewVerifiedModule();\n+  HloComputation::Builder builder(TestName());\n \n   HloInstruction* p0 = builder.AddInstruction(HloInstruction::CreateToken());\n   auto instr = Cast<HloCustomCallInstruction>(\n@@ -66,7 +67,7 @@ TEST_F(CpuFFITest, EmulateImpureCallbackWithTokens) {\n   instr->set_custom_call_has_side_effect(true);\n   module->AddEntryComputation(builder.Build());\n \n-  TF_EXPECT_OK(Execute(std::move(module), {}).status());\n+  TF_EXPECT_OK(Execute(std::move(module), {}));\n }\n \n }  // namespace"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}