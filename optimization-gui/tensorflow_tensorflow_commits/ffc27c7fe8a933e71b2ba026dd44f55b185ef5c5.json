{
    "author": "qukhan",
    "message": "Loosen the restrictions in `MMapWeightCacheProvider::OffsetToAddr`.\n\nIf an address is requested for an offset that was introduced in a previous\nbuild step, we return the address instead of crashing.\n\nPiperOrigin-RevId: 827935161",
    "sha": "ffc27c7fe8a933e71b2ba026dd44f55b185ef5c5",
    "files": [
        {
            "sha": "2fdbbc8d0afbff05e2cbf594252d262317a967a9",
            "filename": "tensorflow/lite/delegates/xnnpack/weight_cache.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ffc27c7fe8a933e71b2ba026dd44f55b185ef5c5/tensorflow%2Flite%2Fdelegates%2Fxnnpack%2Fweight_cache.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ffc27c7fe8a933e71b2ba026dd44f55b185ef5c5/tensorflow%2Flite%2Fdelegates%2Fxnnpack%2Fweight_cache.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fdelegates%2Fxnnpack%2Fweight_cache.cc?ref=ffc27c7fe8a933e71b2ba026dd44f55b185ef5c5",
            "patch": "@@ -600,10 +600,11 @@ size_t MMapWeightCacheProvider::LookUpOrInsert(\n void* MMapWeightCacheProvider::OffsetToAddr(const size_t offset) {\n   // While the cache is being built, the buffer could grow and need to be\n   // reallocated so we cannot ensure pointer stability.\n-  XNNPACK_ABORT_CHECK(\n-      !IsBuilding(),\n-      \"Cannot get the address of a buffer in a cache during a building step.\");\n-  return offset_to_addr_[offset];\n+  auto it = offset_to_addr_.find(offset);\n+  XNNPACK_ABORT_CHECK(it != offset_to_addr_.end(),\n+                      \"Cannot get the address of a buffer in a cache before \"\n+                      \"the build step that introduces it has finished.\");\n+  return it->second;\n }\n \n void MMapWeightCacheProvider::Release() {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 5,
        "deletions": 4
    }
}