{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Add a text diff utility based on Longest Common Subsequence.\n\nPiperOrigin-RevId: 801037098",
    "sha": "7624e57d463620f0dd41a2d87fba55e85f558105",
    "files": [
        {
            "sha": "2e75251d46e99f31fe8855d65d3a2bb6bf86ad29",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/utils/BUILD",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2FBUILD?ref=7624e57d463620f0dd41a2d87fba55e85f558105",
            "patch": "@@ -71,3 +71,23 @@ cc_library(\n     hdrs = [\"bidirectional_map.h\"],\n     deps = [\"@com_google_absl//absl/container:flat_hash_map\"],\n )\n+\n+cc_library(\n+    name = \"text_diff\",\n+    srcs = [\"text_diff.cc\"],\n+    hdrs = [\"text_diff.h\"],\n+    deps = [\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+    ],\n+)\n+\n+xla_cc_test(\n+    name = \"text_diff_test\",\n+    srcs = [\"text_diff_test.cc\"],\n+    deps = [\n+        \":text_diff\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)"
        },
        {
            "sha": "ca791106ea82512113e96554024da16045f7dc4d",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/utils/text_diff.cc",
            "status": "added",
            "additions": 86,
            "deletions": 0,
            "changes": 86,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.cc?ref=7624e57d463620f0dd41a2d87fba55e85f558105",
            "patch": "@@ -0,0 +1,86 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/hlo/tools/hlo_diff/utils/text_diff.h\"\n+\n+#include <algorithm>\n+#include <string>\n+#include <vector>\n+\n+#include \"absl/strings/string_view.h\"\n+namespace xla::hlo_diff {\n+\n+std::vector<TextDiffChunk> ComputeTextDiff(absl::string_view left,\n+                                           absl::string_view right) {\n+  int m = left.size();\n+  int n = right.size();\n+\n+  // dp[i][j] stores the length of the LCS of left[0...i-1] and right[0...j-1]\n+  std::vector<std::vector<int>> dp(m + 1, std::vector<int>(n + 1, 0));\n+\n+  for (int i = 1; i <= m; ++i) {\n+    for (int j = 1; j <= n; ++j) {\n+      if (left[i - 1] == right[j - 1]) {\n+        dp[i][j] = dp[i - 1][j - 1] + 1;\n+      } else {\n+        dp[i][j] = std::max(dp[i - 1][j], dp[i][j - 1]);\n+      }\n+    }\n+  }\n+\n+  std::vector<TextDiffChunk> diff_chunks;\n+  int i = m, j = n;\n+  while (i > 0 || j > 0) {\n+    if (i > 0 && j > 0 && left[i - 1] == right[j - 1]) {\n+      // Unchanged character\n+      if (!diff_chunks.empty() &&\n+          diff_chunks.back().type == TextDiffType::kUnchanged) {\n+        diff_chunks.back().text.insert(0, 1, left[i - 1]);\n+      } else {\n+        diff_chunks.push_back(\n+            {TextDiffType::kUnchanged, std::string(1, left[i - 1])});\n+      }\n+      i--;\n+      j--;\n+    } else if (i > 0 && (j == 0 || dp[i - 1][j] > dp[i][j - 1])) {\n+      // Character removed from left. This path is chosen if skipping left[i-1]\n+      // results in a strictly longer LCS than skipping right[j-1].\n+      if (!diff_chunks.empty() &&\n+          diff_chunks.back().type == TextDiffType::kRemoved) {\n+        diff_chunks.back().text.insert(0, 1, left[i - 1]);\n+      } else {\n+        diff_chunks.push_back(\n+            {TextDiffType::kRemoved, std::string(1, left[i - 1])});\n+      }\n+      i--;\n+    } else {  // j > 0, implies dp[i][j - 1] >= dp[i - 1][j] or i == 0.\n+      // Character added to right. This includes the tie-breaking case\n+      // dp[i][j - 1] == dp[i - 1][j], ensuring Added comes after Removed\n+      // in the final reversed list.\n+      if (!diff_chunks.empty() &&\n+          diff_chunks.back().type == TextDiffType::kAdded) {\n+        diff_chunks.back().text.insert(0, 1, right[j - 1]);\n+      } else {\n+        diff_chunks.push_back(\n+            {TextDiffType::kAdded, std::string(1, right[j - 1])});\n+      }\n+      j--;\n+    }\n+  }\n+  std::reverse(diff_chunks.begin(), diff_chunks.end());\n+  return diff_chunks;\n+}\n+\n+}  // namespace xla::hlo_diff"
        },
        {
            "sha": "7ae7261158a771cc1cd189250135e1ff0f574c7f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/utils/text_diff.h",
            "status": "added",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff.h?ref=7624e57d463620f0dd41a2d87fba55e85f558105",
            "patch": "@@ -0,0 +1,48 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_HLO_TOOLS_HLO_DIFF_UTILS_TEXT_DIFF_H_\n+#define XLA_HLO_TOOLS_HLO_DIFF_UTILS_TEXT_DIFF_H_\n+#include <string>\n+#include <vector>\n+\n+#include \"absl/strings/string_view.h\"\n+\n+namespace xla::hlo_diff {\n+\n+// Represents the type of a text difference chunk.\n+enum class TextDiffType {\n+  kUnchanged,\n+  kAdded,\n+  kRemoved,\n+};\n+\n+// A single chunk of text difference.\n+struct TextDiffChunk {\n+  TextDiffType type;\n+  std::string text;\n+  // Equality operator for testing.\n+  bool operator==(const TextDiffChunk& other) const {\n+    return type == other.type && text == other.text;\n+  }\n+};\n+\n+// Computes the line-based text differences between two strings.\n+// Returns a vector of TextDiffChunks representing the differences.\n+std::vector<TextDiffChunk> ComputeTextDiff(absl::string_view left,\n+                                           absl::string_view right);\n+\n+}  // namespace xla::hlo_diff\n+#endif  // XLA_HLO_TOOLS_HLO_DIFF_UTILS_TEXT_DIFF_H_"
        },
        {
            "sha": "e4ccd6d846adbdc276aa1bdaae5fff115cf723dd",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/utils/text_diff_test.cc",
            "status": "added",
            "additions": 124,
            "deletions": 0,
            "changes": 124,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7624e57d463620f0dd41a2d87fba55e85f558105/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Futils%2Ftext_diff_test.cc?ref=7624e57d463620f0dd41a2d87fba55e85f558105",
            "patch": "@@ -0,0 +1,124 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+#include \"xla/hlo/tools/hlo_diff/utils/text_diff.h\"\n+\n+#include <string>\n+#include <vector>\n+\n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n+#include \"absl/strings/string_view.h\"\n+\n+namespace xla::hlo_diff {\n+namespace {\n+\n+using ::testing::ElementsAre;\n+using ::testing::FieldsAre;\n+using ::testing::IsEmpty;\n+\n+// Helper to make TextDiffChunk creation more concise in tests.\n+TextDiffChunk Unchanged(absl::string_view text) {\n+  return {TextDiffType::kUnchanged, std::string(text)};\n+}\n+TextDiffChunk Added(absl::string_view text) {\n+  return {TextDiffType::kAdded, std::string(text)};\n+}\n+TextDiffChunk Removed(absl::string_view text) {\n+  return {TextDiffType::kRemoved, std::string(text)};\n+}\n+\n+class TextDiffTest : public ::testing::Test {};\n+\n+TEST_F(TextDiffTest, IdenticalStrings) {\n+  absl::string_view left = \"abcde\";\n+  absl::string_view right = \"abcde\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(FieldsAre(TextDiffType::kUnchanged, \"abcde\")));\n+}\n+\n+TEST_F(TextDiffTest, EmptyStrings) {\n+  absl::string_view left = \"\";\n+  absl::string_view right = \"\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, IsEmpty());\n+}\n+\n+TEST_F(TextDiffTest, LeftEmpty) {\n+  absl::string_view left = \"\";\n+  absl::string_view right = \"abc\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(FieldsAre(TextDiffType::kAdded, \"abc\")));\n+}\n+\n+TEST_F(TextDiffTest, RightEmpty) {\n+  absl::string_view left = \"abc\";\n+  absl::string_view right = \"\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(FieldsAre(TextDiffType::kRemoved, \"abc\")));\n+}\n+\n+TEST_F(TextDiffTest, CompletelyDifferent) {\n+  absl::string_view left = \"abc\";\n+  absl::string_view right = \"def\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(FieldsAre(TextDiffType::kRemoved, \"abc\"),\n+                                FieldsAre(TextDiffType::kAdded, \"def\")));\n+}\n+\n+TEST_F(TextDiffTest, Additions) {\n+  absl::string_view left = \"ace\";\n+  absl::string_view right = \"abcde\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(Unchanged(\"a\"), Added(\"b\"), Unchanged(\"c\"),\n+                                Added(\"d\"), Unchanged(\"e\")));\n+}\n+\n+TEST_F(TextDiffTest, Removals) {\n+  absl::string_view left = \"abcde\";\n+  absl::string_view right = \"ace\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(Unchanged(\"a\"), Removed(\"b\"), Unchanged(\"c\"),\n+                                Removed(\"d\"), Unchanged(\"e\")));\n+}\n+\n+TEST_F(TextDiffTest, Changes) {\n+  absl::string_view left = \"axc\";\n+  absl::string_view right = \"ayc\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(Unchanged(\"a\"), Removed(\"x\"), Added(\"y\"),\n+                                Unchanged(\"c\")));\n+}\n+\n+TEST_F(TextDiffTest, MixedChanges) {\n+  absl::string_view left = \"a-cdefg\";\n+  absl::string_view right = \"ab-dxfg\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  EXPECT_THAT(diff, ElementsAre(Unchanged(\"a\"), Added(\"b\"), Unchanged(\"-\"),\n+                                Removed(\"c\"), Unchanged(\"d\"), Removed(\"e\"),\n+                                Added(\"x\"), Unchanged(\"fg\")));\n+}\n+\n+TEST_F(TextDiffTest, LongerCommonSubsequence) {\n+  absl::string_view left = \"AGGTAB\";\n+  absl::string_view right = \"GXTXAYB\";\n+  std::vector<TextDiffChunk> diff = ComputeTextDiff(left, right);\n+  // LCS is GTAB\n+  EXPECT_THAT(diff, ElementsAre(Removed(\"AG\"), Unchanged(\"G\"), Added(\"X\"),\n+                                Unchanged(\"T\"), Added(\"X\"), Unchanged(\"A\"),\n+                                Added(\"Y\"), Unchanged(\"B\")));\n+}\n+\n+}  // namespace\n+}  // namespace xla::hlo_diff"
        }
    ],
    "stats": {
        "total": 278,
        "additions": 278,
        "deletions": 0
    }
}