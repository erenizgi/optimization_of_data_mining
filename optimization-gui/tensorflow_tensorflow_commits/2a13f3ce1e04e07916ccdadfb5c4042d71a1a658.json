{
    "author": "unknown",
    "message": "[XLA] Avoid duplicated include paths in XLA build\n\nThe change that introduces googletest wrapper does not work reliably:\ndepending on the order of deps in BUILD file, googletest include paths\nmay end up before the wrapper ones. When this happens, the\nASSERT_OK/EXPECT_OK macros are not available.\n\nThis showed up in a bzlmod build once I started migrating the TF_\nmacros.\n\nI tried multiple ways to fix it, described in\nREADME.add-status-macros.md for anyone trying to make this nice in the\nfuture. In the end, adding the macros directly to googletest in a patch\nseems like the least intrusive option.\n\nPiperOrigin-RevId: 842513243",
    "sha": "2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
    "files": [
        {
            "sha": "b51181b412ef6cececca9b3d270d4755961ef138",
            "filename": "third_party/xla/MODULE.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2FMODULE.bazel?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -10,8 +10,7 @@ bazel_dep(name = \"bazel_skylib\", version = \"1.8.1\")\n bazel_dep(name = \"boringssl\", version = \"0.20250818.0\")\n bazel_dep(name = \"curl\", version = \"8.11.0\")\n bazel_dep(name = \"google_benchmark\", version = \"1.8.5\", repo_name = \"com_google_benchmark\")\n-bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest_upstream\")\n-bazel_dep(name = \"xla_googletest_wrapper\", version = \"1.0\", repo_name = \"com_google_googletest\")\n+bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest\")\n bazel_dep(name = \"grpc\", version = \"1.74.1\", repo_name = \"com_github_grpc_grpc\")\n bazel_dep(name = \"gutil\", version = \"20250502.0\", repo_name = \"com_google_gutil\")\n bazel_dep(name = \"jsoncpp\", version = \"1.9.6\", repo_name = \"jsoncpp_git\")\n@@ -73,11 +72,10 @@ archive_override(\n     module_name = \"googletest\",\n     strip_prefix = \"googletest-28e9d1f26771c6517c3b4be10254887673c94018\",\n     urls = [\"https://github.com/google/googletest/archive/28e9d1f26771c6517c3b4be10254887673c94018.zip\"],\n-)\n-\n-local_path_override(\n-    module_name = \"xla_googletest_wrapper\",\n-    path = \"third_party/xla_googletest_wrapper\",\n+    patch_strip = 1,\n+    patches = [\n+        \"//third_party/googletest:0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch\",\n+    ],\n )\n \n ##############################################################"
        },
        {
            "sha": "a9bf5dcaee9f9fbd3da9e269a94ccbc37a0e1424",
            "filename": "third_party/xla/opensource_only.files",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fopensource_only.files",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fopensource_only.files",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fopensource_only.files?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -157,5 +157,4 @@ xla/third_party/tensorrt/tensorrt/tensorrt_config.py.tpl:\n xla/third_party/tensorrt/tensorrt_configure.bzl:\n xla/third_party/tensorrt/workspace.bzl:\n xla/third_party/xla_googletest_wrapper/include/gmock/gmock.h:\n-xla/third_party/xla_googletest_wrapper/include/gtest/gtest.h:\n xla/third_party/zlib.BUILD:"
        },
        {
            "sha": "5b16fd63bb94a2af814d941a34aed7a988468956",
            "filename": "third_party/xla/third_party/googletest/0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch",
            "status": "added",
            "additions": 164,
            "deletions": 0,
            "changes": 164,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -0,0 +1,164 @@\n+From 925be4390f717899f3e825abe6e9a0548f0630e4 Mon Sep 17 00:00:00 2001\n+From: Marcin Radomski <dextero@google.com>\n+Date: Thu, 4 Dec 2025 15:37:45 +0000\n+Subject: [PATCH 1/2] Add ASSERT_OK/EXPECT_OK/ASSERT_OK_AND_ASSIGN macros\n+\n+Create this patch with git diff -U2 / git format-patch -U2 to avoid\n+mismatches with googletest.patch.\n+---\n+ BUILD.bazel                                   |   5 +-\n+ googlemock/include/gmock/gmock.h              |   1 +\n+ .../include/gmock/internal/xla-gmock-macros.h | 118 ++++++++++++++++++\n+ 3 files changed, 123 insertions(+), 1 deletion(-)\n+ create mode 100644 googlemock/include/gmock/internal/xla-gmock-macros.h\n+\n+diff --git a/BUILD.bazel b/BUILD.bazel\n+index 008af6a1..32d2a22c 100644\n+--- a/BUILD.bazel\n++++ b/BUILD.bazel\n+@@ -163,5 +163,8 @@ cc_library(\n+         ],\n+         \"//conditions:default\": [],\n+-    }),\n++    }) + [\n++        \"@abseil-cpp//absl/status\",\n++        \"@abseil-cpp//absl/status:statusor\",\n++    ],\n+ )\n+ \n+diff --git a/googlemock/include/gmock/gmock.h b/googlemock/include/gmock/gmock.h\n+index c78fb8ee..69b33572 100644\n+--- a/googlemock/include/gmock/gmock.h\n++++ b/googlemock/include/gmock/gmock.h\n+@@ -95,3 +95,4 @@ GTEST_API_ void InitGoogleMock();\n+ }  // namespace testing\n+ \n++#include \"gmock/internal/xla-gmock-macros.h\"\n+ #endif  // GOOGLEMOCK_INCLUDE_GMOCK_GMOCK_H_\n+diff --git a/googlemock/include/gmock/internal/xla-gmock-macros.h b/googlemock/include/gmock/internal/xla-gmock-macros.h\n+new file mode 100644\n+index 00000000..fd48a21a\n+--- /dev/null\n++++ b/googlemock/include/gmock/internal/xla-gmock-macros.h\n+@@ -0,0 +1,118 @@\n++/* Copyright 2025 The Abseil Authors & TensorFlow Authors. All Rights Reserved.\n++\n++Licensed under the Apache License, Version 2.0 (the \"License\");\n++you may not use this file except in compliance with the License.\n++You may obtain a copy of the License at\n++\n++    http://www.apache.org/licenses/LICENSE-2.0\n++\n++Unless required by applicable law or agreed to in writing, software\n++distributed under the License is distributed on an \"AS IS\" BASIS,\n++WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n++See the License for the specific language governing permissions and\n++limitations under the License.\n++==============================================================================*/\n++\n++#ifndef GOOGLEMOCK_INCLUDE_GMOCK_INTERNAL_XLA_GMOCK_MACROS_H_\n++#define GOOGLEMOCK_INCLUDE_GMOCK_INTERNAL_XLA_GMOCK_MACROS_H_\n++\n++// gmock/gmock.h wrapper that also provides assert macros.\n++//\n++// These already exist in internal version of gmock, but upstream version\n++// doesn't have them. We use this wrapper to make dependency translation when\n++// exporting to OSS easier.\n++//\n++// - We want to use standard internal header and ASSERT_OK, EXPECT_OK macros\n++//   when developing internally.\n++// - We want the same macros to work externally, rather than having to add or\n++//   strip TF_ prefix.\n++// - We want the OSS export to still work after the export and header\n++//   translation.\n++// - We want to minimize the amount of patching third party projects to reduce\n++//   maintenance overhead.\n++// - To ensure the OSS patches cleanly apply onto internal repo, we need the\n++//   header translation to be reversible, which requires 1:1 header mapping.\n++//\n++// To achieve this, we add those macros to gmock for all XLA code, which\n++// should (TM) make ASSERT_OK/EXPECT_OK \"just work\" in all XLA tests.\n++//\n++// absl/status/status_matchers.h depends on gmock.h, so we can't simply add it\n++// here. This causes a circular dependency between this and absl - which bazel\n++// doesn't allow.\n++\n++#include \"absl/status/status.h\"\n++#include \"absl/status/statusor.h\"\n++\n++// Macros for testing the results of functions that return absl::Status or\n++// absl::StatusOr<T> (for any type T).\n++#define EXPECT_OK(expression) \\\n++  EXPECT_THAT(expression, ::xla_testing::internal::IsOk())\n++#define ASSERT_OK(expression) \\\n++  ASSERT_THAT(expression, ::xla_testing::internal::IsOk())\n++\n++#define ASSERT_OK_AND_ASSIGN(lhs, rexpr)                            \\\n++  TF_ASSERT_OK_AND_ASSIGN_IMPL(                                     \\\n++      XLA_STATUS_MACROS_CONCAT_NAME(_status_or_value, __COUNTER__), \\\n++      lhs, rexpr);\n++\n++#define ASSERT_OK_AND_ASSIGN_IMPL(statusor, lhs, rexpr) \\\n++  auto statusor = (rexpr);                              \\\n++  ASSERT_OK(statusor.status());                         \\\n++  lhs = std::move(statusor).value()\n++\n++#define XLA_STATUS_MACROS_CONCAT_NAME(x, y) XLA_STATUS_MACROS_CONCAT_IMPL(x, y)\n++#define XLA_STATUS_MACROS_CONCAT_IMPL(x, y) x##y\n++\n++namespace xla_testing {\n++namespace internal {\n++\n++// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n++inline const absl::Status& GetStatus(const absl::Status& status) {\n++  return status;\n++}\n++\n++// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n++template <typename T>\n++inline const absl::Status& GetStatus(const absl::StatusOr<T>& status) {\n++  return status.status();\n++}\n++\n++// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n++//\n++// Monomorphic implementation of matcher IsOk() for a given type T.\n++// T can be Status, StatusOr<>, or a reference to either of them.\n++template <typename T>\n++class MonoIsOkMatcherImpl : public ::testing::MatcherInterface<T> {\n++ public:\n++  void DescribeTo(std::ostream* os) const override { *os << \"is OK\"; }\n++  void DescribeNegationTo(std::ostream* os) const override {\n++    *os << \"is not OK\";\n++  }\n++  bool MatchAndExplain(T actual_value,\n++                       ::testing::MatchResultListener*) const override {\n++    return GetStatus(actual_value).ok();\n++  }\n++};\n++\n++// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n++//\n++// Implements IsOk() as a polymorphic matcher.\n++class IsOkMatcher {\n++ public:\n++  template <typename T>\n++  /*implicit*/ operator ::testing::Matcher<T>() const {  // NOLINT\n++    return ::testing::Matcher<T>(new MonoIsOkMatcherImpl<const T&>());\n++  }\n++};\n++\n++// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n++//\n++// Returns a gMock matcher that matches a Status or StatusOr<> which is OK.\n++inline ::xla_testing::internal::IsOkMatcher IsOk() {\n++  return ::xla_testing::internal::IsOkMatcher();\n++}\n++\n++}  // namespace internal\n++}  // namespace xla_testing\n++\n++#endif  // GOOGLEMOCK_INCLUDE_GMOCK_INTERNAL_XLA_GMOCK_MACROS_H_\n+-- \n+2.52.0.223.gf5cc29aaa4-goog\n+"
        },
        {
            "sha": "93fa7f98c1b15625bc061caeb4531eb7d3769f71",
            "filename": "third_party/xla/third_party/googletest/0002-Rename-dependencies-for-workspace.bzl-build.patch",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0002-Rename-dependencies-for-workspace.bzl-build.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0002-Rename-dependencies-for-workspace.bzl-build.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgoogletest%2F0002-Rename-dependencies-for-workspace.bzl-build.patch?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -0,0 +1,30 @@\n+From 21affdb9aaa50767264c13d607d47cb2104c4e4a Mon Sep 17 00:00:00 2001\n+From: Marcin Radomski <dextero@google.com>\n+Date: Tue, 9 Dec 2025 18:23:26 +0000\n+Subject: [PATCH 2/2] Rename dependencies for workspace.bzl build\n+\n+Must be separate from googletest.patch, because:\n+- Tensorflow applies googletest.patch only\n+- XLA bzlmod build applies patch that adds assert macros only, and\n+  needs different repository name in deps\n+- XLA workspace.bzl build applies everything\n+---\n+ BUILD.bazel | 4 ++--\n+ 1 file changed, 2 insertions(+), 2 deletions(-)\n+\n+diff --git a/BUILD.bazel b/BUILD.bazel\n+index 32d2a22c..a122fa28 100644\n+--- a/BUILD.bazel\n++++ b/BUILD.bazel\n+@@ -164,6 +164,6 @@ cc_library(\n+         \"//conditions:default\": [],\n+     }) + [\n+-        \"@abseil-cpp//absl/status\",\n+-        \"@abseil-cpp//absl/status:statusor\",\n++        \"@com_google_absl//absl/status\",\n++        \"@com_google_absl//absl/status:statusor\",\n+     ],\n+ )\n+-- \n+2.52.0.223.gf5cc29aaa4-goog\n+"
        },
        {
            "sha": "8a169b6f6031d5e494216ff7412d531c762c218d",
            "filename": "third_party/xla/third_party/googletest/README.add-status-macros.md",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2FREADME.add-status-macros.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fgoogletest%2FREADME.add-status-macros.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgoogletest%2FREADME.add-status-macros.md?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -0,0 +1,41 @@\n+add-status-macros.patch adds `ASSERT_OK`, `EXPECT_OK`, `ASSERT_OK_AND_ASSIGN`\n+to gmock.h so that the header's provided functionality matches internal gmock.\n+\n+What other things have we tried?\n+\n+1. Introducing a custom header to be used in OSS instead of `gmock/gmock.h`.\n+\n+   The export-to-OSS process imposes a few restrictions. Notably, header\n+   rewrite has to be reversible, so we need a 1:1 mapping between headers used\n+   internally and in OSS.\n+\n+   If we introduced a custom header to be used in OSS instead of gmock, it\n+   would have to take the place of current rewrite of internal gmock to\n+   `gmock/gmock.h`. This means, any use of `gmock/gmock.h` in OSS XLA code can\n+   no longer map to internal gmock. We'd have to ban the header.\n+\n+   Therefore, updating OSS `gmock/gmock.h` seems necessary.\n+\n+2. Patching in the extra macros to `gmock/gmock.h` by including\n+   `absl/status/status_macros.h`.\n+\n+   This introduces a circular dependency between absl and gmock which makes\n+   bazel strongly opposed to the idea.\n+\n+3. Introducing a googletest bazel module wrapper.\n+\n+   This would be a module would proxy all `gmock/gmock.h` within XLA without\n+   additional patching of googletest. However, having multiple sources of the\n+   same gmock/gmock.h header path only works *sometimes*. The order of include\n+   paths emitted by bazel depends on the target definition and ordering of\n+   dependencies, so it ends up working in some case and not in others.\n+\n+4. Expanding 3. by renaming googletest's `gmock.h` to `gmock.upstream.h` to\n+   avoid header name conflicts.\n+\n+   `gmock/gmock.h` is also included by googletest itself, so redirecting it to\n+   `gmock/gmock.upstream.h` is needed. That boils down to even more brittle\n+   patching.\n+\n+Overall, the add-status-macros.patch change is the least invasive one that\n+works."
        },
        {
            "sha": "09ae2f3c729c6eb6969484353fd307ca4fcb6198",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1,38 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-cc_library(\n-    name = \"gtest\",\n-    # Upstream gtest is *not* marked testonly for some reason, but\n-    # gutil:status_matchers is, and non-testonly targets can't depend on\n-    # testonly ones.\n-    #\n-    # XLA doesn't use gtest in non-testonly targets though so making this\n-    # testonly should (TM) be fine.\n-    testonly = True,\n-    hdrs = [\n-        \"include/gmock/gmock.h\",\n-        \"include/gtest/gtest.h\",\n-    ],\n-    includes = [\n-        \"include\",\n-    ],\n-    deps = [\n-        \"@com_google_absl//absl/status\",\n-        \"@com_google_absl//absl/status:statusor\",\n-        \"@com_google_googletest_upstream//:gtest\",\n-    ],\n-)\n-\n-cc_library(\n-    name = \"gtest_main\",\n-    testonly = True,\n-    deps = [\n-        \":gtest\",\n-        \"@com_google_googletest_upstream//:gtest_main\",\n-    ],\n-)\n-\n-alias(\n-    name = \"gtest_for_library\",\n-    actual = \":gtest\",\n-)"
        },
        {
            "sha": "24583fb0d3406aaddc7b16d68c381c82414f5405",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/MODULE.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1,4 +0,0 @@\n-module(name = \"xla_googletest_wrapper\", version = \"1.0\")\n-\n-bazel_dep(name = \"abseil-cpp\", version = \"20250814.0\", repo_name = \"com_google_absl\")\n-bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest_upstream\")"
        },
        {
            "sha": "f2065e18995bd403b06e4efa3526f8201590f73c",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1,5 +0,0 @@\n-A gtest wrapper that adds ASSERT_OK, EXPECT_OK, ASSERT_OK_AND_ASSIGN to gmock.h\n-so that the header's provided functionality matches internal gmock.\n-\n-The repo contains a minimal set of reexports necessary to build XLA with this as\n-a drop-in replacement for googletest.\n\\ No newline at end of file"
        },
        {
            "sha": "1bab3de8da46377d55733de45ea18055628d2089",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/REPO.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1 +0,0 @@\n-# Mark the repo as a bazel repo."
        },
        {
            "sha": "0f980ef53dd946f9423484e02c3d7b720073d8c2",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/googletest_deps.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1,8 +0,0 @@\n-\"\"\"Reexports googletest_deps from upstream googletest.\"\"\"\n-\n-# protobuf loads for @com_google_googletest//:googletest_deps.bzl so we need to\n-# provide one in the wrapper.\n-load(\"@com_google_googletest_upstream//:googletest_deps.bzl\", upstream_deps = \"googletest_deps\")\n-\n-def googletest_deps():\n-    upstream_deps()"
        },
        {
            "sha": "e5a79543245c08425c2cd359504d257e5d5d51cf",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/include/gmock/gmock.h",
            "status": "modified",
            "additions": 134,
            "deletions": 129,
            "changes": 263,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -1,129 +1,134 @@\n-/* Copyright 2025 The Abseil Authors & TensorFlow Authors. All Rights Reserved.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n-#define GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n-\n-// gmock/gmock.h wrapper that also provides assert macros.\n-//\n-// These already exist in internal version of gmock, but upstream version\n-// doesn't have them. We use this wrapper to make dependency translation when\n-// exporting to OSS easier.\n-//\n-// - We want to use standard internal header and ASSERT_OK, EXPECT_OK macros\n-//   when developing internally.\n-// - We want the same macros to work externally, rather than having to add or\n-//   strip TF_ prefix.\n-// - We want the OSS export to still work after the export and header\n-//   translation.\n-// - We want to minimize the amount of patching third party projects to reduce\n-//   maintenance overhead.\n-// - To ensure the OSS patches cleanly apply onto internal repo, we need the\n-//   header translation to be reversible, which requires 1:1 header mapping.\n-//\n-// To achieve this, we swap out gmock.h for this wrapper in all XLA code, which\n-// should (TM) make ASSERT_OK/EXPECT_OK \"just work\" in all XLA tests.\n-//\n-// The only way to make this work without patching googletest and/or absl is to\n-// make XLA *always* use this wrapper, and *never* directly depend on upstream\n-// googletest.\n-//\n-// absl/status/status_matchers.h depends on gmock.h, so we can't simply add it\n-// here. This causes either:\n-//\n-// - A circular dependency between this and absl - which bazel doesn't allow,\n-// - absl dependency on the upstream gmock - which depending on the dependency\n-//   graph structure may introduce upstream gmock include path *before* one\n-//   defined in here, so we end up with *sometimes* including the wrong one and\n-//   the entire idea of drop-in replacing gmock.h goes out of the window.\n-\n-#include_next \"gmock/gmock.h\"\n-\n-#include \"absl/status/status.h\"\n-#include \"absl/status/statusor.h\"\n-\n-// Macros for testing the results of functions that return absl::Status or\n-// absl::StatusOr<T> (for any type T).\n-#define EXPECT_OK(expression) \\\n-  EXPECT_THAT(expression, ::xla_testing::internal::IsOk())\n-#define ASSERT_OK(expression) \\\n-  ASSERT_THAT(expression, ::xla_testing::internal::IsOk())\n-\n-#define ASSERT_OK_AND_ASSIGN(lhs, rexpr)                            \\\n-  ASSERT_OK_AND_ASSIGN_IMPL(                                        \\\n-      XLA_STATUS_MACROS_CONCAT_NAME(_status_or_value, __COUNTER__), \\\n-      lhs, rexpr);\n-\n-#define ASSERT_OK_AND_ASSIGN_IMPL(statusor, lhs, rexpr) \\\n-  auto statusor = (rexpr);                              \\\n-  ASSERT_OK(statusor.status());                         \\\n-  lhs = std::move(statusor).value()\n-\n-#define XLA_STATUS_MACROS_CONCAT_NAME(x, y) XLA_STATUS_MACROS_CONCAT_IMPL(x, y)\n-#define XLA_STATUS_MACROS_CONCAT_IMPL(x, y) x##y\n-\n-namespace xla_testing {\n-namespace internal {\n-\n-// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n-inline const absl::Status& GetStatus(const absl::Status& status) {\n-  return status;\n-}\n-\n-// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n-template <typename T>\n-inline const absl::Status& GetStatus(const absl::StatusOr<T>& status) {\n-  return status.status();\n-}\n-\n-// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n-//\n-// Monomorphic implementation of matcher IsOk() for a given type T.\n-// T can be Status, StatusOr<>, or a reference to either of them.\n-template <typename T>\n-class MonoIsOkMatcherImpl : public ::testing::MatcherInterface<T> {\n- public:\n-  void DescribeTo(std::ostream* os) const override { *os << \"is OK\"; }\n-  void DescribeNegationTo(std::ostream* os) const override {\n-    *os << \"is not OK\";\n-  }\n-  bool MatchAndExplain(T actual_value,\n-                       ::testing::MatchResultListener*) const override {\n-    return GetStatus(actual_value).ok();\n-  }\n-};\n-\n-// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n-//\n-// Implements IsOk() as a polymorphic matcher.\n-class IsOkMatcher {\n- public:\n-  template <typename T>\n-  /*implicit*/ operator ::testing::Matcher<T>() const {  // NOLINT\n-    return ::testing::Matcher<T>(new MonoIsOkMatcherImpl<const T&>());\n-  }\n-};\n-\n-// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n-//\n-// Returns a gMock matcher that matches a Status or StatusOr<> which is OK.\n-inline ::xla_testing::internal::IsOkMatcher IsOk() {\n-  return ::xla_testing::internal::IsOkMatcher();\n-}\n-\n-}  // namespace internal\n-}  // namespace xla_testing\n-\n-#endif  // GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n+<<<<<<< Conflict 1 of 1\n+%%%%%%% Changes from base to side #1\n+ /* Copyright 2025 The Abseil Authors & TensorFlow Authors. All Rights Reserved.\n+ \n+ Licensed under the Apache License, Version 2.0 (the \"License\");\n+ you may not use this file except in compliance with the License.\n+ You may obtain a copy of the License at\n+ \n+     http://www.apache.org/licenses/LICENSE-2.0\n+ \n+ Unless required by applicable law or agreed to in writing, software\n+ distributed under the License is distributed on an \"AS IS\" BASIS,\n+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ See the License for the specific language governing permissions and\n+ limitations under the License.\n+ ==============================================================================*/\n+ \n+ #ifndef GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n+ #define GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n+ \n+ // gmock/gmock.h wrapper that also provides assert macros.\n+ //\n+ // These already exist in internal version of gmock, but upstream version\n+ // doesn't have them. We use this wrapper to make dependency translation when\n+ // exporting to OSS easier.\n+ //\n+ // - We want to use standard internal header and ASSERT_OK, EXPECT_OK macros\n+ //   when developing internally.\n+ // - We want the same macros to work externally, rather than having to add or\n+ //   strip TF_ prefix.\n+ // - We want the OSS export to still work after the export and header\n+ //   translation.\n+ // - We want to minimize the amount of patching third party projects to reduce\n+ //   maintenance overhead.\n+ // - To ensure the OSS patches cleanly apply onto internal repo, we need the\n+ //   header translation to be reversible, which requires 1:1 header mapping.\n+ //\n+ // To achieve this, we swap out gmock.h for this wrapper in all XLA code, which\n+ // should (TM) make ASSERT_OK/EXPECT_OK \"just work\" in all XLA tests.\n+ //\n+ // The only way to make this work without patching googletest and/or absl is to\n+ // make XLA *always* use this wrapper, and *never* directly depend on upstream\n+ // googletest.\n+ //\n+ // absl/status/status_matchers.h depends on gmock.h, so we can't simply add it\n+ // here. This causes either:\n+ //\n+ // - A circular dependency between this and absl - which bazel doesn't allow,\n+ // - absl dependency on the upstream gmock - which depending on the dependency\n+ //   graph structure may introduce upstream gmock include path *before* one\n+ //   defined in here, so we end up with *sometimes* including the wrong one and\n+ //   the entire idea of drop-in replacing gmock.h goes out of the window.\n+ \n+ #include_next \"gmock/gmock.h\"\n+ \n+ #include \"absl/status/status.h\"\n+ #include \"absl/status/statusor.h\"\n+ \n+ // Macros for testing the results of functions that return absl::Status or\n+ // absl::StatusOr<T> (for any type T).\n+ #define EXPECT_OK(expression) \\\n+   EXPECT_THAT(expression, ::xla_testing::internal::IsOk())\n+ #define ASSERT_OK(expression) \\\n+   ASSERT_THAT(expression, ::xla_testing::internal::IsOk())\n+ \n+ #define ASSERT_OK_AND_ASSIGN(lhs, rexpr)                            \\\n+-  TF_ASSERT_OK_AND_ASSIGN_IMPL(                                     \\\n++  ASSERT_OK_AND_ASSIGN_IMPL(                                        \\\n+       XLA_STATUS_MACROS_CONCAT_NAME(_status_or_value, __COUNTER__), \\\n+       lhs, rexpr);\n+ \n+ #define ASSERT_OK_AND_ASSIGN_IMPL(statusor, lhs, rexpr) \\\n+   auto statusor = (rexpr);                              \\\n+   ASSERT_OK(statusor.status());                         \\\n+   lhs = std::move(statusor).value()\n+ \n+ #define XLA_STATUS_MACROS_CONCAT_NAME(x, y) XLA_STATUS_MACROS_CONCAT_IMPL(x, y)\n+ #define XLA_STATUS_MACROS_CONCAT_IMPL(x, y) x##y\n+ \n+ namespace xla_testing {\n+ namespace internal {\n+ \n+ // DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+ inline const absl::Status& GetStatus(const absl::Status& status) {\n+   return status;\n+ }\n+ \n+ // DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+ template <typename T>\n+ inline const absl::Status& GetStatus(const absl::StatusOr<T>& status) {\n+   return status.status();\n+ }\n+ \n+ // DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+ //\n+ // Monomorphic implementation of matcher IsOk() for a given type T.\n+ // T can be Status, StatusOr<>, or a reference to either of them.\n+ template <typename T>\n+ class MonoIsOkMatcherImpl : public ::testing::MatcherInterface<T> {\n+  public:\n+   void DescribeTo(std::ostream* os) const override { *os << \"is OK\"; }\n+   void DescribeNegationTo(std::ostream* os) const override {\n+     *os << \"is not OK\";\n+   }\n+   bool MatchAndExplain(T actual_value,\n+                        ::testing::MatchResultListener*) const override {\n+     return GetStatus(actual_value).ok();\n+   }\n+ };\n+ \n+ // DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+ //\n+ // Implements IsOk() as a polymorphic matcher.\n+ class IsOkMatcher {\n+  public:\n+   template <typename T>\n+   /*implicit*/ operator ::testing::Matcher<T>() const {  // NOLINT\n+     return ::testing::Matcher<T>(new MonoIsOkMatcherImpl<const T&>());\n+   }\n+ };\n+ \n+ // DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+ //\n+ // Returns a gMock matcher that matches a Status or StatusOr<> which is OK.\n+ inline ::xla_testing::internal::IsOkMatcher IsOk() {\n+   return ::xla_testing::internal::IsOkMatcher();\n+ }\n+ \n+ }  // namespace internal\n+ }  // namespace xla_testing\n+ \n+ #endif  // GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n++++++++ Contents of side #2\n+>>>>>>> Conflict 1 of 1 ends"
        },
        {
            "sha": "c903698baf0922053c67fec84c8c566b7e8624b1",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/include/gtest/gtest.h",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/457322c8bf181c4d42df3ca08f07061f4cc916cc/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h?ref=457322c8bf181c4d42df3ca08f07061f4cc916cc",
            "patch": "@@ -1,21 +0,0 @@\n-/* Copyright 2025 The TensorFlow Authors. All Rights Reserved.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_\n-#define GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_\n-\n-#include_next \"gtest/gtest.h\"\n-\n-#endif  // GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_"
        },
        {
            "sha": "d81988a636a1f218d0bb670aa34346b3abb203c7",
            "filename": "third_party/xla/workspace2.bzl",
            "status": "modified",
            "additions": 9,
            "deletions": 20,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fworkspace2.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2a13f3ce1e04e07916ccdadfb5c4042d71a1a658/third_party%2Fxla%2Fworkspace2.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fworkspace2.bzl?ref=2a13f3ce1e04e07916ccdadfb5c4042d71a1a658",
            "patch": "@@ -7,7 +7,7 @@ load(\"@bazel_tools//tools/build_defs/repo:utils.bzl\", \"maybe\")\n load(\"@io_bazel_rules_closure//closure:defs.bzl\", \"filegroup_external\")\n load(\"@rules_ml_toolchain//gpu/sycl:sycl_configure.bzl\", \"sycl_configure\")\n load(\"@rules_ml_toolchain//gpu/sycl:sycl_init_repository.bzl\", \"sycl_init_repository\")\n-load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\", \"tf_vendored\")\n+load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n load(\"//third_party/absl:workspace.bzl\", absl = \"repo\")\n load(\"//third_party/benchmark:workspace.bzl\", benchmark = \"repo\")\n load(\"//third_party/clang_toolchain:cc_configure_clang.bzl\", \"cc_download_clang_toolchain\")\n@@ -305,25 +305,8 @@ def _tf_repositories():\n         },\n     )\n \n-    # We use a vendored wrapper over googletest to provide\n-    # ASSERT_OK/EXPECT_OK/ASSERT_OK_AND_ASSIGN macros through gmock/gmock.h.\n-    #\n-    # Internal gmock includes those macros, but the external one doesn't. This\n-    # caused issues where internal builds succeed, but the copybara export to\n-    # github doesn't compile because those macros are not defined. The\n-    # workaround was to use custom TF_-prefixed variants of those macros.\n-    #\n-    # This wrapper lets us have the same code work in both by just swapping the\n-    # internal header with gmock/gmock.h. This applies to XLA only, not to TF,\n-    # so the TF_ macros that are still in use there must stay, and can't just\n-    # expand to non-TF_ variants as.\n-    tf_vendored(\n-        name = \"com_google_googletest\",\n-        path = \"third_party/xla_googletest_wrapper\",\n-    )\n-\n     tf_http_archive(\n-        name = \"com_google_googletest_upstream\",\n+        name = \"com_google_googletest\",\n         # Use the commit on 2025/6/09:\n         # https://github.com/google/googletest/commit/28e9d1f26771c6517c3b4be10254887673c94018\n         sha256 = \"f253ca1a07262f8efde8328e4b2c68979e40ddfcfc001f70d1d5f612c7de2974\",\n@@ -332,6 +315,8 @@ def _tf_repositories():\n         #   - avoid dependencies on @fuchsia_sdk,\n         #   - refer to re2 as @com_googlesource_code_re2,\n         #   - refer to abseil as @com_google_absl.\n+        #   - add status assert macros for consistency with internal gmock (see\n+        #     README.add-status-macros.md).\n         #\n         # To update the patch, run:\n         # $ cd ~\n@@ -344,7 +329,11 @@ def _tf_repositories():\n         # $ git diff > <client-root>/third_party/tensorflow/third_party/googletest/googletest.patch\n         #\n         # The patch path is relative to third_party/xla.\n-        patch_file = [\"//third_party/googletest:googletest.patch\"],\n+        patch_file = [\n+            \"//third_party/googletest:googletest.patch\",\n+            \"//third_party/googletest:0001-Add-ASSERT_OK-EXPECT_OK-ASSERT_OK_AND_ASSIGN-macros.patch\",\n+            \"//third_party/googletest:0002-Rename-dependencies-for-workspace.bzl-build.patch\",\n+        ],\n         urls = tf_mirror_urls(\"https://github.com/google/googletest/archive/28e9d1f26771c6517c3b4be10254887673c940189.zip\"),\n     )\n "
        }
    ],
    "stats": {
        "total": 617,
        "additions": 383,
        "deletions": 234
    }
}