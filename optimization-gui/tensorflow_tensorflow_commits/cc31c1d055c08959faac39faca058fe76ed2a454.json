{
    "author": "beckerhe",
    "message": "Make tf_profiler_pybind_cc_library_wrapper generate layering check compliant targets\n\n`tf_profiler_pybind_cc_library_wrapper` creates a cc_header_only_target which is a target that exports all transitively exported headers - unless py_wrap is enabled. Then cc_header_only_target just creates a cc_library target which breaks the layering check.\n\nTherefore this change makes tf_profiler_pybind_cc_library_wrapper create an alias target instead of a cc_header_only_library if py_wrap is enabled.\n\nPiperOrigin-RevId: 837811846",
    "sha": "cc31c1d055c08959faac39faca058fe76ed2a454",
    "files": [
        {
            "sha": "e598b29378be0bcc10803bf3734289f2600a988e",
            "filename": "third_party/xla/xla/tsl/profiler/builds/oss/build_config.bzl",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cc31c1d055c08959faac39faca058fe76ed2a454/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fbuilds%2Foss%2Fbuild_config.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cc31c1d055c08959faac39faca058fe76ed2a454/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fbuilds%2Foss%2Fbuild_config.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Fbuilds%2Foss%2Fbuild_config.bzl?ref=cc31c1d055c08959faac39faca058fe76ed2a454",
            "patch": "@@ -3,6 +3,10 @@\n TF profiler build macros for use in OSS.\n \"\"\"\n \n+load(\n+    \"@local_xla//third_party/py/rules_pywrap:pywrap.default.bzl\",\n+    \"use_pywrap_rules\",\n+)\n load(\"//xla/tsl:package_groups.bzl\", \"DEFAULT_LOAD_VISIBILITY\")\n load(\"//xla/tsl:tsl.bzl\", \"cc_header_only_library\")\n \n@@ -19,4 +23,7 @@ def tf_profiler_pybind_cc_library_wrapper(name, actual, **kwargs):\n     symbols in these deps symbols should be linked to, and exported by, the core\n     pywrap_tensorflow_internal.so\n     \"\"\"\n-    cc_header_only_library(name = name, deps = [actual], **kwargs)\n+    if use_pywrap_rules():\n+        native.alias(name = name, actual = actual, **kwargs)\n+    else:\n+        cc_header_only_library(name = name, deps = [actual], **kwargs)"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}