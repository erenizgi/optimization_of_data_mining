{
    "author": "tensorflower-gardener",
    "message": "Automated Code Change\n\nPiperOrigin-RevId: 845634459",
    "sha": "8e0f4b64e6075ffd271a84423cbd539d0b82f6a3",
    "files": [
        {
            "sha": "f839c61ed1a304880641cb95e3feecc7103fd50b",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_gpu_test.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e0f4b64e6075ffd271a84423cbd539d0b82f6a3/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e0f4b64e6075ffd271a84423cbd539d0b82f6a3/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc?ref=8e0f4b64e6075ffd271a84423cbd539d0b82f6a3",
            "patch": "@@ -212,17 +212,18 @@ TEST_F(PjrtCApiGpuBufferTest, CopyRawToHost) {\n   args.struct_size = PJRT_Buffer_CopyRawToHost_Args_STRUCT_SIZE;\n   args.extension_start = nullptr;\n   args.buffer = buffer.get();\n-  args.dst =\n-      tsl::port::AlignedMalloc(size, tsl::Allocator::kAllocatorAlignment);\n+  args.dst = tsl::port::AlignedMalloc(\n+      size, static_cast<std::align_val_t>(tsl::Allocator::kAllocatorAlignment));\n   args.offset = 0;\n   args.transfer_size = size;\n   PJRT_Error* error = api_->PJRT_Buffer_CopyRawToHost(&args);\n   ASSERT_THAT(error, IsNull());\n   xla::Future<> copy_to_host_event = ConvertCEventToCppFuture(args.event, api_);\n   TF_EXPECT_OK(copy_to_host_event.Await());\n   EXPECT_EQ(*(static_cast<float*>(args.dst)), 41);\n-  tsl::port::AlignedSizedFree(args.dst, tsl::Allocator::kAllocatorAlignment,\n-                              size);\n+  tsl::port::AlignedSizedFree(\n+      args.dst, size,\n+      static_cast<std::align_val_t>(tsl::Allocator::kAllocatorAlignment));\n }\n \n TEST_F(PjrtCApiGpuBufferTest, CopyRawToHostWithInvalidOffset) {\n@@ -231,8 +232,8 @@ TEST_F(PjrtCApiGpuBufferTest, CopyRawToHostWithInvalidOffset) {\n   args.struct_size = PJRT_Buffer_CopyRawToHost_Args_STRUCT_SIZE;\n   args.extension_start = nullptr;\n   args.buffer = buffer_.get();\n-  args.dst =\n-      tsl::port::AlignedMalloc(size, tsl::Allocator::kAllocatorAlignment);\n+  args.dst = tsl::port::AlignedMalloc(\n+      size, static_cast<std::align_val_t>(tsl::Allocator::kAllocatorAlignment));\n   args.offset = size + 1;  // offset is invalid\n   args.transfer_size = size;\n   PJRT_Error* error = api_->PJRT_Buffer_CopyRawToHost(&args);\n@@ -376,10 +377,12 @@ TEST_F(PjrtCApiGpuTest, CreateAndDestroyExecuteContext) {\n TEST_F(PjrtCApiGpuTest, DmaMapAndUnmap) {\n   size_t dma_size = 1024 * 1024;\n   size_t alignment = 1024 * 1024;\n-  void* host_dma_ptr = tsl::port::AlignedMalloc(dma_size, alignment);\n+  void* host_dma_ptr = tsl::port::AlignedMalloc(\n+      dma_size, static_cast<std::align_val_t>(alignment));\n   auto host_dma_ptr_deleter =\n       absl::Cleanup([host_dma_ptr, dma_size, alignment] {\n-        tsl::port::AlignedSizedFree(host_dma_ptr, alignment, dma_size);\n+        tsl::port::AlignedSizedFree(host_dma_ptr, dma_size,\n+                                    static_cast<std::align_val_t>(alignment));\n       });\n \n   PJRT_Client_DmaMap_Args dma_args;\n@@ -468,7 +471,7 @@ TEST_F(PjrtCApiGpuTransferManagerTest, SetBufferError) {\n           &set_buffer_error_args);\n   ASSERT_EQ(set_buffer_error_error, nullptr);\n \n-  EXPECT_THAT(buffer_out->buffer->ToLiteralSync(),\n+  EXPECT_THAT(buffer_out->buffer->ToLiteral().Await(),\n               absl_testing::StatusIs(absl::StatusCode::kInternal,\n                                      HasSubstr(error_message)));\n \n@@ -538,7 +541,7 @@ TEST_F(PjrtCApiGpuTransferManagerTest, TransferRawDataToBufferIsSuccessful) {\n       transfer_args.done_with_h2d_transfer, MakeEventDeleter(api_));\n \n   TF_ASSERT_OK_AND_ASSIGN(std::shared_ptr<xla::Literal> literal,\n-                          buffer_out->buffer->ToLiteralSync());\n+                          buffer_out->buffer->ToLiteral().Await());\n   EXPECT_EQ(literal->element_count(), 8);\n   EXPECT_THAT(literal->data<uint32_t>(), ElementsAreArray(data));\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 13,
        "deletions": 10
    }
}