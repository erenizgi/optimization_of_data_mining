{
    "author": "shawnwang18",
    "message": "PR #34734: [XLA:GPU] make DYNAMIC_SLICE_COPY_FUSION command default lowered to cuda-graph\n\nImported from GitHub PR https://github.com/openxla/xla/pull/34734\n\nüìù Summary of Changes\n\n* Added `DebugOptions::DYNAMIC_SLICE_COPY_FUSION` to the list of enabled GPU command buffers in the default debug options.\n\nüöÄ Kind of Contribution\n‚ö°Ô∏è Performance Improvement\n\nüß™ Unit Tests:\nchange the default setting, unittest has already been added.\n\nCopybara import of the project:\n\n--\nbdca8aae0307ff41188b6481b878e42b9ec90612 by Shawn Wang <shawnw@nvidia.com>:\n\nmake DYNAMIC_SLICE_COPY_FUSION command default lowered to cuda-graph\n\nMerging this change closes #34734\n\nPiperOrigin-RevId: 845659522",
    "sha": "d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753",
    "files": [
        {
            "sha": "a8cbbe96789a02e2c7b03147bba3372f86bf2a54",
            "filename": "third_party/xla/xla/debug_options_flags.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753/third_party%2Fxla%2Fxla%2Fdebug_options_flags.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753/third_party%2Fxla%2Fxla%2Fdebug_options_flags.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fdebug_options_flags.cc?ref=d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753",
            "patch": "@@ -244,6 +244,8 @@ DebugOptions DefaultDebugOptionsIgnoringFlags() {\n   opts.add_xla_gpu_enable_command_buffer(DebugOptions::CUSTOM_CALL);\n   opts.add_xla_gpu_enable_command_buffer(DebugOptions::CUDNN);\n   opts.add_xla_gpu_enable_command_buffer(DebugOptions::DYNAMIC_SLICE_FUSION);\n+  opts.add_xla_gpu_enable_command_buffer(\n+      DebugOptions::DYNAMIC_SLICE_COPY_FUSION);\n   opts.set_xla_gpu_graph_min_graph_size(5);\n   opts.set_xla_gpu_command_buffer_scheduling_mode(DebugOptions::LHS);\n   opts.set_xla_gpu_command_buffer_unroll_loops(false);"
        },
        {
            "sha": "7bb39cc0915e9cf9fa2e9b9f9576e2632eff455e",
            "filename": "third_party/xla/xla/debug_options_parsers_test.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753/third_party%2Fxla%2Fxla%2Fdebug_options_parsers_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753/third_party%2Fxla%2Fxla%2Fdebug_options_parsers_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fdebug_options_parsers_test.cc?ref=d0cf19c0fa1f9044d0bd5b5fccdf875c38a21753",
            "patch": "@@ -393,12 +393,13 @@ TEST(ParseRepeatedEnumFlagsTest, CommandBufferCmdType) {\n \n   // Check that the default setting has 6 types.\n   const auto& enabled_types = debug_options.xla_gpu_enable_command_buffer();\n-  ASSERT_EQ(enabled_types.size(), 6);\n+  ASSERT_EQ(enabled_types.size(), 7);\n   ASSERT_THAT(\n       enabled_types,\n       ElementsAre(DebugOptions::FUSION, DebugOptions::CUBLAS,\n                   DebugOptions::CUBLASLT, DebugOptions::CUSTOM_CALL,\n-                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION));\n+                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION,\n+                  DebugOptions::DYNAMIC_SLICE_COPY_FUSION));\n \n   // Initialize the flag objects.\n   std::vector<tsl::Flag> flag_objects;\n@@ -407,29 +408,32 @@ TEST(ParseRepeatedEnumFlagsTest, CommandBufferCmdType) {\n   // Removing options from the existing setting.\n   SetXlaFlagsEnvVar(\"--xla_gpu_enable_command_buffer=-fusion,-cublas\");\n   ParseFlagsFromEnvAndDieIfUnknown(\"XLA_FLAGS\", flag_objects);\n-  EXPECT_EQ(enabled_types.size(), 4);\n+  EXPECT_EQ(enabled_types.size(), 5);\n   EXPECT_THAT(\n       enabled_types,\n       ElementsAre(DebugOptions::CUBLASLT, DebugOptions::CUSTOM_CALL,\n-                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION));\n+                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION,\n+                  DebugOptions::DYNAMIC_SLICE_COPY_FUSION));\n \n   // Removing an option that isn't there and adding a duplicate.\n   SetXlaFlagsEnvVar(\"--xla_gpu_enable_command_buffer=+cublaslt,-fusion\");\n   ParseFlagsFromEnvAndDieIfUnknown(\"XLA_FLAGS\", flag_objects);\n-  EXPECT_EQ(enabled_types.size(), 4);\n+  EXPECT_EQ(enabled_types.size(), 5);\n   EXPECT_THAT(\n       enabled_types,\n       ElementsAre(DebugOptions::CUBLASLT, DebugOptions::CUSTOM_CALL,\n-                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION));\n+                  DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION,\n+                  DebugOptions::DYNAMIC_SLICE_COPY_FUSION));\n \n   // Adding an option.\n   SetXlaFlagsEnvVar(\"--xla_gpu_enable_command_buffer=+cublas\");\n   ParseFlagsFromEnvAndDieIfUnknown(\"XLA_FLAGS\", flag_objects);\n-  EXPECT_EQ(enabled_types.size(), 5);\n+  EXPECT_EQ(enabled_types.size(), 6);\n   EXPECT_THAT(\n       enabled_types,\n       ElementsAre(DebugOptions::CUBLASLT, DebugOptions::CUSTOM_CALL,\n                   DebugOptions::CUDNN, DebugOptions::DYNAMIC_SLICE_FUSION,\n+                  DebugOptions::DYNAMIC_SLICE_COPY_FUSION,\n                   DebugOptions::CUBLAS));\n \n   // Overwriting the default setting."
        }
    ],
    "stats": {
        "total": 20,
        "additions": 13,
        "deletions": 7
    }
}