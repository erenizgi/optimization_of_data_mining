{
    "author": "tensorflower-gardener",
    "message": "Use the new `tsl::proto_testing::EquivToProto` in \"ifrt_backend_test.cc\".\n\nPiperOrigin-RevId: 797515730",
    "sha": "9eaa9488a9341159db58980637ad6d799d5db9ab",
    "files": [
        {
            "sha": "b8f7e43951b08d2139b4552a98ab5ab6660367dc",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9eaa9488a9341159db58980637ad6d799d5db9ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9eaa9488a9341159db58980637ad6d799d5db9ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2FBUILD?ref=9eaa9488a9341159db58980637ad6d799d5db9ab",
            "patch": "@@ -208,12 +208,12 @@ ifrt_proxy_cc_test(\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n-        \"//xla/tsl/platform:status_matchers\",\n         \"//xla/tsl/platform:status_to_from_proto\",\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/protobuf:error_codes_proto_impl_cc\",\n         \"//xla/tsl/protobuf:status_proto_cc\",\n+        \"//xla/tsl/util/proto:proto_matchers\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/log\","
        },
        {
            "sha": "15a5509d5a9e362a4d436d9fc44d93980caab6f6",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend_test.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 19,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9eaa9488a9341159db58980637ad6d799d5db9ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9eaa9488a9341159db58980637ad6d799d5db9ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc?ref=9eaa9488a9341159db58980637ad6d799d5db9ab",
            "patch": "@@ -79,12 +79,12 @@\n #include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n-#include \"xla/tsl/platform/status_matchers.h\"\n #include \"xla/tsl/platform/status_to_from_proto.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/tsl/protobuf/error_codes.pb.h\"\n #include \"xla/tsl/protobuf/status.pb.h\"\n+#include \"xla/tsl/util/proto/proto_matchers.h\"\n #include \"xla/xla_data.pb.h\"\n #include \"tsl/platform/protobuf.h\"  // IWYU pragma: keep\n \n@@ -109,14 +109,9 @@ using ::testing::ReturnRef;\n using ::testing::SizeIs;\n using ::testing::StrEq;\n using ::tsl::protobuf::TextFormat;\n-using ::tsl::testing::IsOk;\n-using ::tsl::testing::IsOkAndHolds;\n-using ::tsl::testing::StatusIs;\n \n-#if defined(PLATFORM_GOOGLE)\n-using ::testing::EquivToProto;\n-using ::testing::proto::Partially;\n-#endif\n+using ::tsl::proto_testing::EquivToProto;\n+using ::tsl::proto_testing::Partially;\n \n constexpr uint64_t kSessionId = 12345;\n \n@@ -1146,8 +1141,6 @@ TEST_P(IfrtBackendHandlerTest, DestructArrayTest) {\n               absl_testing::StatusIs(absl::StatusCode::kNotFound));\n }\n \n-// TODO(b/315809436): Test needs rewrite because protobuf matchers are not OSS\n-#if defined(PLATFORM_GOOGLE)\n TEST_P(IfrtBackendHandlerTest, CompileSuccess) {\n   std::vector<MockDevice> devices(4);\n   for (int i = 0; i < 4; ++i) {\n@@ -1171,8 +1164,8 @@ TEST_P(IfrtBackendHandlerTest, CompileSuccess) {\n   EXPECT_CALL(*executable, GetReadyFuture())\n       .WillOnce(Return(Future<>(absl::OkStatus())));\n \n-  ASSERT_OK_AND_ASSIGN(CompileResponse response,\n-                       CompileTestLoadedExecutable(std::move(executable)));\n+  TF_ASSERT_OK_AND_ASSIGN(CompileResponse response,\n+                          CompileTestLoadedExecutable(std::move(executable)));\n   EXPECT_THAT(response, Partially(EquivToProto(R\"pb(\n                 name: \"executable_name\"\n                 num_devices: 4\n@@ -1182,7 +1175,6 @@ TEST_P(IfrtBackendHandlerTest, CompileSuccess) {\n               )pb\")));\n   TF_EXPECT_OK(CheckFuture(response.ready_future_handle()));\n }\n-#endif\n \n TEST_P(IfrtBackendHandlerTest, CompileFailure) {\n   ASSERT_THAT(\n@@ -1191,8 +1183,6 @@ TEST_P(IfrtBackendHandlerTest, CompileFailure) {\n                              StrEq(\"injected error\")));\n }\n \n-// TODO(b/315809436): Test needs rewrite because protobuf matchers are not OSS\n-#if defined(PLATFORM_GOOGLE)\n TEST_P(IfrtBackendHandlerTest, LoadedExecutableMetadata) {\n   MockLoadedExecutable* executable;\n   uint64_t handle;\n@@ -1300,10 +1290,7 @@ TEST_P(IfrtBackendHandlerTest, LoadedExecutableMetadata) {\n     EXPECT_TRUE(metadata_response.has_output_layouts_error());\n   }\n }\n-#endif\n \n-// TODO(b/315809436): Test needs rewrite because protobuf matchers are not OSS\n-#if defined(PLATFORM_GOOGLE)\n TEST_P(IfrtBackendHandlerTest, LoadedExecutableExecute) {\n   TF_ASSERT_OK_AND_ASSIGN(xla::ifrt::Device* const device,\n                           mock_client_->LookupDevice(DeviceId(0)));\n@@ -1400,7 +1387,6 @@ TEST_P(IfrtBackendHandlerTest, LoadedExecutableExecute) {\n       absl_testing::StatusIs(absl::StatusCode::kNotFound,\n                              HasSubstr(\"Unknown future handle\")));\n }\n-#endif\n \n TEST_P(IfrtBackendHandlerTest, LoadedExecutableExecuteErrorWithClientHandles) {\n   TF_ASSERT_OK_AND_ASSIGN(xla::ifrt::Device* const device,"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 6,
        "deletions": 20
    }
}