{
    "author": "hyeontaek",
    "message": "[NanoRt] NanoRt IFRT now returns a `nullptr` if it knows that the Array layout represents a default layout. The user code previously has been migrated to handle this new behavior gracefully, obtaining a concrete default layout as before.\n\nFuture note: At some point, `NanoArray` would need to distinguish between a default layout vs. a concrete layout that is equal to the default layout. If the latter is used, `NanoArray::pjrt_layout()` is expected to return the concrete layout. This is not required by IFRT API semantics yet, but it will be enforced later in the future.\n\nPiperOrigin-RevId: 821808592",
    "sha": "b915d3103a38d2f74b0a3aad172d7bfb9ae68e89",
    "files": [
        {
            "sha": "dd611d37afc9a3e604eecb292c45873a799be7be",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b915d3103a38d2f74b0a3aad172d7bfb9ae68e89/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b915d3103a38d2f74b0a3aad172d7bfb9ae68e89/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc?ref=b915d3103a38d2f74b0a3aad172d7bfb9ae68e89",
            "patch": "@@ -412,9 +412,7 @@ class NanoArray final : public NanoValue<NanoArray, ifrt::Array> {\n \n   absl::StatusOr<std::shared_ptr<const PjRtLayout>> pjrt_layout()\n       const override {\n-    TF_RETURN_IF_ERROR(ValidateNotDeleted());\n-    return std::make_shared<PjRtLayout>(\n-        LayoutUtil::MakeDescendingLayout(shape().dims().size()));\n+    return nullptr;\n   }\n \n   absl::StatusOr<std::vector<ifrt::ArrayRef>> DisassembleIntoSingleDeviceArrays(\n@@ -646,7 +644,7 @@ class ShardedNanoArray final : public NanoValue<ShardedNanoArray, ifrt::Array> {\n \n   absl::StatusOr<std::shared_ptr<const PjRtLayout>> pjrt_layout()\n       const override {\n-    return std::make_shared<PjRtLayout>(Layout(shape().dims()));\n+    return nullptr;\n   }\n \n   absl::StatusOr<std::vector<ifrt::ArrayRef>> DisassembleIntoSingleDeviceArrays("
        },
        {
            "sha": "26d716fe296e79b9773ec4a7787ef0beb391b2fd",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b915d3103a38d2f74b0a3aad172d7bfb9ae68e89/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b915d3103a38d2f74b0a3aad172d7bfb9ae68e89/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc?ref=b915d3103a38d2f74b0a3aad172d7bfb9ae68e89",
            "patch": "@@ -319,6 +319,8 @@ int main(int argc, char** argv) {\n       \"ArrayImplTest.MakeArrayFromHostBufferAndCopyToHostBufferWithString:\"\n       \"ArrayImplTest.\"\n       \"MakeArraysFromHostBufferShardsAndCopyToHostBufferWithString:\"\n+      // Custom layouts are not supported in NanoIfrtClient.\n+      \"ArrayImplTest.MakeArraysFromHostBufferShardsWithLayout:\"\n       // `MakeErrorArrays` is not supported in NanoIfrtClient.\n       \"ArrayImplTest.MakeErrorArrays:\"\n       \"ArrayImplTest.CopyPoisonedArray:\""
        }
    ],
    "stats": {
        "total": 8,
        "additions": 4,
        "deletions": 4
    }
}