{
    "author": "hhb",
    "message": "Introduce methods to query host, chip, and device IDs from PjRtTopologyDescription.\n\nPiperOrigin-RevId: 831130604",
    "sha": "c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d",
    "files": [
        {
            "sha": "c49842fecf51aa656b8b17c59e568de8da9c507f",
            "filename": "third_party/xla/xla/pjrt/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD?ref=c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d",
            "patch": "@@ -526,6 +526,7 @@ cc_library(\n     deps = [\n         \"//xla/pjrt/proto:pjrt_value_type_proto_cc\",\n         \"//xla/tsl/lib/gtl:int_type\",\n+        \"@com_google_absl//absl/container:inlined_vector\",\n     ],\n )\n "
        },
        {
            "sha": "e217faf87e726811a9cd0b6066a93f079e632f7e",
            "filename": "third_party/xla/xla/pjrt/pjrt_common.h",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_common.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_common.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_common.h?ref=c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d",
            "patch": "@@ -21,6 +21,7 @@ limitations under the License.\n #include <variant>\n #include <vector>\n \n+#include \"absl/container/inlined_vector.h\"\n #include \"xla/pjrt/proto/pjrt_value_type.pb.h\"\n #include \"xla/tsl/lib/gtl/int_type.h\"\n \n@@ -36,8 +37,23 @@ xla::PjRtValueTypeProto PjRtValueTypeToProto(const PjRtValueType& value);\n \n PjRtValueType PjRtValueTypeFromProto(const xla::PjRtValueTypeProto& value);\n \n+template <typename Id>\n+using PjRtIdContainer = absl::InlinedVector<Id, 4>;\n+\n+template <typename Id>\n+PjRtIdContainer<Id> MakeContinuousIds(int start, int size) {\n+  PjRtIdContainer<Id> container;\n+  container.reserve(size);\n+  for (int i = 0; i < size; ++i) {\n+    container.push_back(Id(start + i));\n+  }\n+  return container;\n+}\n+\n // The strong-typed integer classes to better disambiguate different IDs for\n // PJRT devices.\n+TSL_LIB_GTL_DEFINE_INT_TYPE(PjRtProcessId, int32_t);\n+TSL_LIB_GTL_DEFINE_INT_TYPE(PjRtGlobalChipId, int32_t);\n TSL_LIB_GTL_DEFINE_INT_TYPE(PjRtGlobalDeviceId, int32_t);\n TSL_LIB_GTL_DEFINE_INT_TYPE(PjRtLocalDeviceId, int32_t);\n TSL_LIB_GTL_DEFINE_INT_TYPE(PjRtLocalHardwareId, int32_t);"
        },
        {
            "sha": "6f5a61f7a6b20d6596bd6ebb17ca1a1d5464683e",
            "filename": "third_party/xla/xla/pjrt/pjrt_compiler.h",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_compiler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_compiler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_compiler.h?ref=c3ecebb0acfbb5997ad291aa91e4bb91dd06cf6d",
            "patch": "@@ -178,6 +178,47 @@ class PjRtTopologyDescription {\n         \"CoreCountOfDefaultTypePerChip is unsupported.\");\n   }\n \n+  // Returns the ids for all processes.\n+  virtual absl::StatusOr<PjRtIdContainer<PjRtProcessId>> ProcessIds() const {\n+    return absl::UnimplementedError(\"ProcessIds is unsupported.\");\n+  }\n+\n+  // Returns the ids for all the logical devices on a specific process.\n+  virtual absl::StatusOr<PjRtIdContainer<PjRtGlobalDeviceId>>\n+  LogicalDeviceOfDefaultTypeIdsOnProcess(PjRtProcessId process_id) const {\n+    return absl::UnimplementedError(\n+        \"LogicalDeviceOfDefaultTypeIdsOnProcess is unsupported.\");\n+  }\n+\n+  // Returns the process ID and the index of the chip within that process for a\n+  // given chip.\n+  virtual absl::StatusOr<std::pair<PjRtProcessId, int>>\n+  ProcessIdAndIndexOnProcessForChip(PjRtGlobalChipId chip_id) const {\n+    return absl::UnimplementedError(\n+        \"ProcessIdAndIndexOnProcessForChip is unsupported.\");\n+  }\n+\n+  // Returns the process ID and the index on process for a logical device.\n+  virtual absl::StatusOr<std::pair<PjRtProcessId, int>>\n+  ProcessIdAndIndexOnProcessForLogicalDeviceOfDefaultType(\n+      xla::PjRtGlobalDeviceId device_id) const {\n+    return absl::UnimplementedError(\n+        \"ProcessIdAndIndexOnProcessForLogicalDeviceOfDefaultType is \"\n+        \"unsupported.\");\n+  }\n+\n+  // Returns the coordinates of a process given its ID.\n+  virtual absl::StatusOr<PjRtDeviceDimensions> ProcessCoordFromId(\n+      PjRtProcessId process_id) const {\n+    return absl::UnimplementedError(\"ProcessCoordForId is unsupported.\");\n+  }\n+\n+  // Returns the chip ID for a given chip coordinate.\n+  virtual absl::StatusOr<PjRtGlobalChipId> ChipIdFromCoord(\n+      const PjRtDeviceDimensions& chip) const {\n+    return absl::UnimplementedError(\"IdForChip is unsupported.\");\n+  }\n+\n   // Returns a unique integer ID for the logical device of the default type on\n   // the chip at the given coordinates and with the given core index.\n   virtual absl::StatusOr<xla::PjRtGlobalDeviceId>"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 58,
        "deletions": 0
    }
}