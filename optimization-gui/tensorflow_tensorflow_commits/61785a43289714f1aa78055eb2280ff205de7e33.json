{
    "author": "ezhulenev",
    "message": "[xla:ffi] Add a test for automatic FFI handler signature inference from C++ function\n\nPiperOrigin-RevId: 819988900",
    "sha": "61785a43289714f1aa78055eb2280ff205de7e33",
    "files": [
        {
            "sha": "14e17ac32467359ba61a726a08690f7f1c419886",
            "filename": "third_party/xla/xla/ffi/api/ffi_test.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/61785a43289714f1aa78055eb2280ff205de7e33/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/61785a43289714f1aa78055eb2280ff205de7e33/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc?ref=61785a43289714f1aa78055eb2280ff205de7e33",
            "patch": "@@ -1463,6 +1463,28 @@ TEST(FfiTest, MetadataTraits) {\n   EXPECT_EQ(metadata.state_type_id.type_id, XLA_FFI_UNKNOWN_TYPE_ID.type_id);\n }\n \n+// Test that we can automatically generate FFI handler type signature from a C++\n+// function declaration.\n+static Error BufferR2F32Function(BufferR2<F32> buffer) {\n+  EXPECT_EQ(buffer.dimensions().size(), 2);\n+  return Error::Success();\n+}\n+\n+XLA_FFI_DEFINE_HANDLER_SYMBOL(BufferR2F32Handler, BufferR2F32Function);\n+\n+TEST(FfiTest, DefineAutoSymbol) {\n+  std::vector<float> storage(4, 0.0f);\n+  se::DeviceMemoryBase memory(storage.data(), 4 * sizeof(float));\n+\n+  CallFrameBuilder builder(/*num_args=*/1, /*num_rets=*/0);\n+  builder.AddBufferArg(memory, PrimitiveType::F32, /*dims=*/{2, 2});\n+  auto call_frame = builder.Build();\n+\n+  auto status = Call(BufferR2F32Handler, call_frame);\n+\n+  TF_ASSERT_OK(status);\n+}\n+\n //===----------------------------------------------------------------------===//\n // Performance benchmarks are below.\n //===----------------------------------------------------------------------===//"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 22,
        "deletions": 0
    }
}