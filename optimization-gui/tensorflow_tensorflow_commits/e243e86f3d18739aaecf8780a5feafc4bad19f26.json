{
    "author": "tensorflower-gardener",
    "message": "Add a helper function to set compilation error payload.\n\nPiperOrigin-RevId: 815957754",
    "sha": "e243e86f3d18739aaecf8780a5feafc4bad19f26",
    "files": [
        {
            "sha": "229e0eb72f54086a4f94866ce9c37ba30a7c21f4",
            "filename": "third_party/xla/xla/pjrt/BUILD",
            "status": "modified",
            "additions": 25,
            "deletions": 2,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD?ref=e243e86f3d18739aaecf8780a5feafc4bad19f26",
            "patch": "@@ -508,6 +508,8 @@ cc_library(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:computation_placer\",\n         \"//xla/service:hlo_proto_cc\",\n+        \"//xla/tsl/platform:errors\",\n+        \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/log\",\n@@ -516,13 +518,12 @@ cc_library(\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n+        \"@llvm-project//llvm:Support\",\n         \"@llvm-project//mlir:FuncDialect\",\n         \"@llvm-project//mlir:IR\",\n         \"@llvm-project//mlir:Support\",\n-        \"@local_tsl//tsl/platform:errors\",\n         \"@local_tsl//tsl/platform:logging\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-        \"@local_tsl//tsl/platform:statusor\",\n     ],\n )\n \n@@ -1262,6 +1263,17 @@ cc_library(\n     ],\n )\n \n+cc_library(\n+    name = \"errors\",\n+    srcs = [\"errors.cc\"],\n+    hdrs = [\"errors.h\"],\n+    deps = [\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings:cord\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+    ],\n+)\n+\n xla_cc_test(\n     name = \"pjrt_phase_compiler_test\",\n     srcs = [\"pjrt_phase_compiler_test.cc\"],\n@@ -1342,3 +1354,14 @@ cc_library(\n         \"@com_google_absl//absl/types:span\",\n     ],\n )\n+\n+xla_cc_test(\n+    name = \"errors_test\",\n+    srcs = [\"errors_test.cc\"],\n+    deps = [\n+        \":errors\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:status_matchers\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)"
        },
        {
            "sha": "f2a19ff564e10f51c3b95f9c6dbfe839257b8097",
            "filename": "third_party/xla/xla/pjrt/errors.cc",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.cc?ref=e243e86f3d18739aaecf8780a5feafc4bad19f26",
            "patch": "@@ -0,0 +1,27 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/pjrt/errors.h\"\n+\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/cord.h\"\n+#include \"absl/strings/string_view.h\"\n+\n+namespace xla {\n+absl::Status SetCompilationErrorWithPayload(absl::Status status) {\n+  status.SetPayload(kCompilationErrorPayload, absl::Cord(\"\"));\n+  return status;\n+}\n+}  // namespace xla"
        },
        {
            "sha": "52e8db32124ce68955747c626452809dcceb6273",
            "filename": "third_party/xla/xla/pjrt/errors.h",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors.h?ref=e243e86f3d18739aaecf8780a5feafc4bad19f26",
            "patch": "@@ -0,0 +1,33 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_PJRT_ERRORS_H_\n+#define XLA_PJRT_ERRORS_H_\n+\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/string_view.h\"\n+\n+namespace xla {\n+// The payload attached to the absl::Status returned by the compilation\n+// service when the compilation fails due to compilation errors.\n+inline constexpr absl::string_view kCompilationErrorPayload =\n+    \"compilation_error\";\n+\n+// Sets the payload of the compilation error status to the compilation error\n+// payload. Useful to denote compilation errors separately from other errors.\n+absl::Status SetCompilationErrorWithPayload(absl::Status status);\n+}  // namespace xla\n+\n+#endif  // XLA_PJRT_ERRORS_H_"
        },
        {
            "sha": "bdcc74c08ad42bcc7e562b0cba55b4bd2cec4513",
            "filename": "third_party/xla/xla/pjrt/errors_test.cc",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Ferrors_test.cc?ref=e243e86f3d18739aaecf8780a5feafc4bad19f26",
            "patch": "@@ -0,0 +1,37 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/pjrt/errors.h\"\n+\n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n+#include \"absl/status/status.h\"\n+#include \"absl/status/status_matchers.h\"\n+\n+namespace xla {\n+\n+using ::absl_testing::StatusIs;\n+using ::testing::HasSubstr;\n+\n+TEST(ErrorsTest, SetCompilationErrorWithPayload) {\n+  absl::Status status = absl::InvalidArgumentError(\"test error\");\n+  absl::Status status_with_payload = SetCompilationErrorWithPayload(status);\n+  EXPECT_THAT(status_with_payload, StatusIs(absl::StatusCode::kInvalidArgument,\n+                                            HasSubstr(\"test error\")));\n+  EXPECT_TRUE(\n+      status_with_payload.GetPayload(kCompilationErrorPayload).has_value());\n+}\n+\n+}  // namespace xla"
        },
        {
            "sha": "df854ac0d9dbd7a4a478eacadcacbaa4823fd00c",
            "filename": "third_party/xla/xla/pjrt/utils.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Futils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e243e86f3d18739aaecf8780a5feafc4bad19f26/third_party%2Fxla%2Fxla%2Fpjrt%2Futils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Futils.cc?ref=e243e86f3d18739aaecf8780a5feafc4bad19f26",
            "patch": "@@ -38,9 +38,13 @@ limitations under the License.\n #include \"absl/strings/str_split.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n+#include \"llvm/Support/Casting.h\"\n #include \"mlir/Dialect/Func/IR/FuncOps.h\"\n #include \"mlir/IR/Attributes.h\"\n #include \"mlir/IR/BuiltinAttributes.h\"\n+#include \"mlir/IR/BuiltinOps.h\"\n+#include \"mlir/IR/BuiltinTypes.h\"\n+#include \"mlir/IR/Types.h\"\n #include \"mlir/Support/LLVM.h\"\n #include \"xla/client/executable_build_options.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n@@ -57,12 +61,12 @@ limitations under the License.\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/status_macros.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/util.h\"\n #include \"xla/xla_data.pb.h\"\n #include \"tsl/platform/cpu_info.h\"\n-#include \"tsl/platform/errors.h\"\n #include \"tsl/platform/logging.h\"  // IWYU pragma: keep\n-#include \"tsl/platform/statusor.h\"\n \n namespace xla {\n "
        }
    ],
    "stats": {
        "total": 132,
        "additions": 128,
        "deletions": 4
    }
}