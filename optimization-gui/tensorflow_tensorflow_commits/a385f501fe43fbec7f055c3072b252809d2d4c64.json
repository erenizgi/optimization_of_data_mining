{
    "author": "ezhulenev",
    "message": "[xla:cpu] Add an option to pass external allocator for CPU memory to XLA:CPU PjRtClient\n\nPiperOrigin-RevId: 802302831",
    "sha": "a385f501fe43fbec7f055c3072b252809d2d4c64",
    "files": [
        {
            "sha": "5e66e7f5a8ff66e4282b0e26dbbee059152f441c",
            "filename": "third_party/xla/xla/pjrt/plugin/xla_cpu/BUILD",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2FBUILD?ref=a385f501fe43fbec7f055c3072b252809d2d4c64",
            "patch": "@@ -34,13 +34,21 @@ xla_cc_test(\n     ],\n )\n \n+cc_library(\n+    name = \"cpu_memory\",\n+    srcs = [],\n+    hdrs = [\"cpu_memory.h\"],\n+)\n+\n cc_library(\n     name = \"cpu_client_options\",\n     srcs = [],\n     hdrs = [\"cpu_client_options.h\"],\n     deps = [\n+        \":cpu_memory\",\n         \"//xla/backends/cpu/collectives:cpu_collectives\",\n         \"//xla/service:hlo_module_config\",\n+        \"@com_google_absl//absl/status:statusor\",\n     ],\n )\n "
        },
        {
            "sha": "d9e71ff37fca3951bc857fa736c8ddea275a9642",
            "filename": "third_party/xla/xla/pjrt/plugin/xla_cpu/cpu_client_options.h",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_client_options.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_client_options.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_client_options.h?ref=a385f501fe43fbec7f055c3072b252809d2d4c64",
            "patch": "@@ -16,11 +16,14 @@ limitations under the License.\n #ifndef XLA_PJRT_PLUGIN_XLA_CPU_CPU_CLIENT_OPTIONS_H_\n #define XLA_PJRT_PLUGIN_XLA_CPU_CPU_CLIENT_OPTIONS_H_\n \n+#include <cstddef>\n #include <functional>\n #include <memory>\n #include <optional>\n \n+#include \"absl/status/statusor.h\"\n #include \"xla/backends/cpu/collectives/cpu_collectives.h\"\n+#include \"xla/pjrt/plugin/xla_cpu/cpu_memory.h\"\n #include \"xla/service/hlo_module_config.h\"\n \n namespace xla {\n@@ -50,6 +53,13 @@ struct CpuClientOptions {\n   // If defined this function will be called on the HloModuleConfig before\n   // compilation, and allows users to set custom flags.\n   std::function<void(HloModuleConfig&)> customize_hlo_module_config;\n+\n+  // If defined this function will be called by PjRtClient to allocate memory\n+  // for constructed PjRtBuffers and a temporary allocation passed to XLA:CPU\n+  // executable.\n+  std::function<absl::StatusOr<std::unique_ptr<CpuMemory>>(size_t size_bytes,\n+                                                           size_t alignment)>\n+      allocator;\n };\n \n }  // namespace xla"
        },
        {
            "sha": "325c22f156d6b93b93cc99c7ccbbbadc43c1813b",
            "filename": "third_party/xla/xla/pjrt/plugin/xla_cpu/cpu_memory.h",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_memory.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a385f501fe43fbec7f055c3072b252809d2d4c64/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_memory.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fplugin%2Fxla_cpu%2Fcpu_memory.h?ref=a385f501fe43fbec7f055c3072b252809d2d4c64",
            "patch": "@@ -0,0 +1,35 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_PJRT_PLUGIN_XLA_CPU_CPU_MEMORY_H_\n+#define XLA_PJRT_PLUGIN_XLA_CPU_CPU_MEMORY_H_\n+\n+#include <cstddef>\n+\n+namespace xla {\n+\n+// A region of cpu memory that can be used by XLA:CPU PjRt client as a storage\n+// for PjRt buffers and also as a temporary allocation for XLA:CPU program.\n+class CpuMemory {\n+ public:\n+  virtual ~CpuMemory() = default;\n+\n+  virtual void* base() const = 0;\n+  virtual size_t size_bytes() const = 0;\n+};\n+\n+}  // namespace xla\n+\n+#endif  // XLA_PJRT_PLUGIN_XLA_CPU_CPU_MEMORY_H_"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 53,
        "deletions": 0
    }
}