{
    "author": "IllogicalMoose",
    "message": "Enable multi-GPU tests on B200.\n\nPiperOrigin-RevId: 819551562",
    "sha": "ae547f429c41f7408a2d783c81d4bf8dec364b56",
    "files": [
        {
            "sha": "003ee68f663183c0c3af44b8d6da6de944b3028b",
            "filename": "third_party/xla/build_tools/lint/tags.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fbuild_tools%2Flint%2Ftags.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fbuild_tools%2Flint%2Ftags.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Flint%2Ftags.py?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -95,9 +95,6 @@\n         \" additional targets.\"\n     ),\n     \"multi_gpu\": \"Used by `xla_test` to signal that multiple GPUs are needed.\",\n-    \"multi_gpu_h100\": (\n-        \"Used by `xla_test` to signal that multiple H100s are needed.\"\n-    ),\n }\n \n "
        },
        {
            "sha": "cdc03ae24fadabe30f694f2be557dd1b3a6691b8",
            "filename": "third_party/xla/xla/backends/gpu/codegen/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -192,6 +192,10 @@ xla_test(\n             \"multi_gpu\",\n             \"no_oss\",\n         ],\n+        \"b200\": [\n+            \"broken\",\n+            \"no_oss\",\n+        ],\n     },\n     backends = [\"gpu\"],\n     deps = ["
        },
        {
            "sha": "56a777f032bb0d81bcbad3db742ad57381a111d5",
            "filename": "third_party/xla/xla/backends/gpu/collectives/BUILD",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -516,12 +516,18 @@ xla_test(\n xla_test(\n     name = \"nvshmem_collectives_test\",\n     srcs = [\"nvshmem_collectives_test.cc\"],\n-    backend_tags = {\"gpu\": [\n-        \"multi_gpu_h100\",\n-        \"no_oss\",\n-        \"noasan\",\n-        \"nomsan\",\n-    ]},\n+    backend_tags = {\n+        \"gpu\": [\n+            \"multi_gpu\",\n+            \"no_oss\",\n+            \"noasan\",\n+            \"nomsan\",\n+        ],\n+        \"nvgpu_any\": [\n+            \"broken\",\n+            \"no_oss\",\n+        ],\n+    },\n     backends = [\"gpu\"],\n     env = {\n         \"XLA_FLAGS\": \"--xla_gpu_experimental_enable_nvshmem=true\","
        },
        {
            "sha": "62ac1109f0c996513517ac4ce83c0a720d49d566",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -2256,7 +2256,6 @@ xla_test(\n     srcs = [\"all_reduce_test.cc\"],\n     backend_tags = {\n         \"gpu\": [\n-            \"multi_gpu_h100\",\n             \"multi_gpu\",\n             \"xla_amdgpu_any\",\n             \"no_oss\","
        },
        {
            "sha": "0cc26fdf6bccdda699e31db4128f580b1b543388",
            "filename": "third_party/xla/xla/pjrt/gpu/BUILD",
            "status": "modified",
            "additions": 32,
            "deletions": 36,
            "changes": 68,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -185,12 +185,18 @@ cc_library(\n xla_test(\n     name = \"se_gpu_pjrt_client_test\",\n     srcs = [\"se_gpu_pjrt_client_test.cc\"],\n-    backend_tags = {\"gpu\": [\n-        \"multi_gpu_h100\",\n-        \"no_oss\",\n-        \"noasan\",\n-        \"nomsan\",\n-    ]},\n+    backend_tags = {\n+        \"gpu\": [\n+            \"multi_gpu\",\n+            \"no_oss\",\n+            \"noasan\",\n+            \"nomsan\",\n+        ],\n+        \"nvgpu_any\": [\n+            \"broken\",\n+            \"no_oss\",\n+        ],\n+    },\n     backends = [\"gpu\"],\n     deps = [\n         \":gpu_topology\",\n@@ -290,52 +296,43 @@ xla_test(\n xla_test(\n     name = \"nvshmem_gpu_collectives_test\",\n     srcs = [\"nvshmem_gpu_collectives_test.cc\"],\n-    backend_tags = {\"gpu\": [\n-        \"multi_gpu_h100\",\n-        \"no_oss\",\n-        \"noasan\",\n-        \"nomsan\",\n-    ]},\n+    backend_tags = {\n+        \"gpu\": [\n+            \"multi_gpu\",\n+            \"no_oss\",\n+            \"noasan\",\n+            \"nomsan\",\n+        ],\n+        \"nvgpu_any\": [\n+            \"broken\",\n+            \"no_oss\",\n+        ],\n+    },\n     backends = [\"gpu\"],\n     env = {\n         \"XLA_FLAGS\": \"--xla_gpu_experimental_enable_nvshmem=true\",\n     },\n     deps = [\n-        \":gpu_topology\",\n         \":se_gpu_pjrt_client\",\n         \"//xla:debug_options_flags\",\n         \"//xla:literal\",\n-        \"//xla:literal_util\",\n-        \"//xla:shape_util\",\n         \"//xla:status_macros\",\n         \"//xla:types\",\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/ffi\",\n-        \"//xla/ffi:ffi_api\",\n         \"//xla/hlo/builder:xla_computation\",\n         \"//xla/hlo/parser:hlo_parser\",\n         \"//xla/hlo/testlib:test\",\n-        \"//xla/pjrt:host_memory_spaces\",\n-        \"//xla/pjrt:mlir_to_hlo\",\n         \"//xla/pjrt:pjrt_client\",\n         \"//xla/pjrt:pjrt_compiler\",\n         \"//xla/pjrt:pjrt_executable\",\n         \"//xla/pjrt:pjrt_stream_executor_client\",\n         \"//xla/pjrt/distributed\",\n         \"//xla/pjrt/distributed:client\",\n-        \"//xla/pjrt/distributed:in_memory_key_value_store\",\n         \"//xla/pjrt/distributed:service\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_client_options\",\n-        \"//xla/service:platform_util\",\n-        \"//xla/stream_executor:device_memory\",\n-        \"//xla/stream_executor:stream\",\n-        \"//xla/tests:literal_test_util\",\n-        \"//xla/tsl/lib/core:status_test_util\",\n-        \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status\",\n-        \"//xla/tsl/platform:status_matchers\",\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:subprocess\",\n         \"//xla/tsl/util:command_line_flags\",\n@@ -345,24 +342,23 @@ xla_test(\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:str_format\",\n-        \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@com_google_googletest//:gtest\",\n-        \"@llvm-project//mlir:IR\",\n     ],\n )\n \n # TODO(b/409713313): Move this test to collectives directory.\n xla_test(\n     name = \"se_gpu_pjrt_client_nvshmem_test\",\n     srcs = [\"se_gpu_pjrt_client_nvshmem_test.cc\"],\n-    backend_tags = {\"gpu\": [\n-        \"multi_gpu_h100\",\n-        \"no_oss\",\n-        \"noasan\",\n-        \"nomsan\",\n-    ]},\n+    backend_tags = {\n+        \"gpu\": [\n+            \"multi_gpu\",\n+            \"no_oss\",\n+            \"noasan\",\n+            \"nomsan\",\n+        ],\n+    },\n     backends = [\"gpu\"],\n     env = {\n         \"XLA_FLAGS\": \"--xla_gpu_experimental_enable_nvshmem=true\","
        },
        {
            "sha": "23b9a162729c821940e40853c3efcb7c5a362c83",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -2771,7 +2771,7 @@ xla_test(\n     srcs = [\"collective_ops_e2e_test.cc\"],\n     backend_tags = {\n         \"gpu\": [\n-            \"multi_gpu_h100\",\n+            \"multi_gpu\",\n             \"no_oss\",\n         ],\n     },"
        },
        {
            "sha": "f25678cd8f7d6074b9de21d19a0c3f307a7ff743",
            "filename": "third_party/xla/xla/tools/multihost_hlo_runner/BUILD",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ae547f429c41f7408a2d783c81d4bf8dec364b56/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fmultihost_hlo_runner%2FBUILD?ref=ae547f429c41f7408a2d783c81d4bf8dec364b56",
            "patch": "@@ -232,10 +232,14 @@ xla_test(\n     srcs = [\"functional_hlo_runner_test.cc\"],\n     backend_tags = {\n         \"gpu\": [\n-            \"multi_gpu_h100\",\n+            \"multi_gpu\",\n             \"no_oss\",\n             \"nomsan\",\n         ],\n+        \"nvgpu_any\": [\n+            \"broken\",\n+            \"no_oss\",\n+        ],\n     },\n     backends = [\n         \"cpu\",\n@@ -247,6 +251,7 @@ xla_test(\n         \":create_client\",\n         \":functional_hlo_runner\",\n         \":hlo_input_output_format\",\n+        \":profiler_interface\",\n         \"//xla:debug_options_flags\",\n         \"//xla:status_macros\",\n         \"//xla:xla_data_proto_cc\",\n@@ -259,7 +264,6 @@ xla_test(\n         \"//xla/service:computation_layout\",\n         \"//xla/service:hlo_proto_cc\",\n         \"//xla/tests:xla_test_backend_predicates\",\n-        \"//xla/tools/multihost_hlo_runner:profiler_interface\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\","
        }
    ],
    "stats": {
        "total": 104,
        "additions": 55,
        "deletions": 49
    }
}