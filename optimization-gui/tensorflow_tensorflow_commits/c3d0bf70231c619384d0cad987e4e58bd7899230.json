{
    "author": "pschuh",
    "message": "Add additional way to poision a connection (to allow testing different\npoisoning strategies).\n\nPiperOrigin-RevId: 826193232",
    "sha": "c3d0bf70231c619384d0cad987e4e58bd7899230",
    "files": [
        {
            "sha": "35f23410e96582b5a3d087d32ab31dfa4b49b370",
            "filename": "third_party/xla/xla/python/transfer/socket-server.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.cc?ref=c3d0bf70231c619384d0cad987e4e58bd7899230",
            "patch": "@@ -420,12 +420,16 @@ class SocketServer::SocketNetworkState : public SocketFdPacketState {\n     }\n   }\n \n-  void InjectFailure() {\n-    uint32_t header = 12341024;\n-    std::string opacket = std::string(absl::string_view(\n-        reinterpret_cast<const char*>(&header), sizeof(header)));\n-    opacket += \"Injected Failure.\";\n-    SendRawFrame(std::move(opacket));\n+  void InjectFailure(Connection::FailureKind kind) {\n+    if (kind == Connection::kProtocolFailure) {\n+      uint32_t header = 12341024;\n+      std::string opacket = std::string(absl::string_view(\n+          reinterpret_cast<const char*>(&header), sizeof(header)));\n+      opacket += \"Injected Failure.\";\n+      SendRawFrame(std::move(opacket));\n+    } else {\n+      Poison(absl::InternalError(\"RECOVERABLE InjectFailure\"));\n+    }\n   }\n \n   static void Accept(std::shared_ptr<PullTable> table,\n@@ -495,7 +499,9 @@ void SocketServer::Connection::Pull(\n   local_->Pull(uuid, buffer_ids, std::move(dests));\n }\n \n-void SocketServer::Connection::InjectFailure() { local_->InjectFailure(); }\n+void SocketServer::Connection::InjectFailure(FailureKind kind) {\n+  local_->InjectFailure(kind);\n+}\n \n absl::Status SocketServer::Start(\n     const SocketAddress& addr,"
        },
        {
            "sha": "c694eb7d561edd02b2ccffff95200db63d25d490",
            "filename": "third_party/xla/xla/python/transfer/socket-server.h",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Ftransfer%2Fsocket-server.h?ref=c3d0bf70231c619384d0cad987e4e58bd7899230",
            "patch": "@@ -64,7 +64,12 @@ class SocketServer {\n     void Pull(uint64_t uuid, absl::Span<const int> buffer_ids,\n               std::vector<tsl::RCReference<ChunkDestination>> dests);\n \n-    void InjectFailure();\n+    enum FailureKind {\n+      kPoison,\n+      kProtocolFailure,\n+    };\n+\n+    void InjectFailure(FailureKind kind = kProtocolFailure);\n \n    private:\n     SocketNetworkState* local_;"
        },
        {
            "sha": "3036281db96b47f1f062fc01952d16aa41687df8",
            "filename": "third_party/xla/xla/python/version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c3d0bf70231c619384d0cad987e4e58bd7899230/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h?ref=c3d0bf70231c619384d0cad987e4e58bd7899230",
            "patch": "@@ -19,6 +19,6 @@ limitations under the License.\n // An increasing version number to protect jax code against breaking changes.\n // In JAX, reference this via jax._src.lib.ifrt_version.\n #define JAX_IFRT_VERSION_NUMBER \\\n-  34  // Explicit `has_custom_layout` argument in PjRt-IFRT Array creation.\n+  35  // Explicit `has_custom_layout` argument in PjRt-IFRT Array creation.\n \n #endif  // XLA_PYTHON_VERSION_H_"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 20,
        "deletions": 9
    }
}