{
    "author": "jakeharmon8",
    "message": "Include PJRT C API headers in PJRT wheels.\n\nAdd genrules to copy the `pjrt_c_api_hdrs` into the `xla_plugins` directories for both CUDA and CPU builds, and include these headers in the respective wheels.\n\nPiperOrigin-RevId: 833641021",
    "sha": "94fa9aa615c08c7117e4d1f361cd18bfa02c12d4",
    "files": [
        {
            "sha": "9ac9c1114f15899ac8eaaa1429933e3a46f29074",
            "filename": "third_party/xla/build_tools/pjrt_wheels/BUILD.bazel",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/94fa9aa615c08c7117e4d1f361cd18bfa02c12d4/third_party%2Fxla%2Fbuild_tools%2Fpjrt_wheels%2FBUILD.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/94fa9aa615c08c7117e4d1f361cd18bfa02c12d4/third_party%2Fxla%2Fbuild_tools%2Fpjrt_wheels%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fpjrt_wheels%2FBUILD.bazel?ref=94fa9aa615c08c7117e4d1f361cd18bfa02c12d4",
            "patch": "@@ -35,6 +35,21 @@ genrule(\n     cmd = \"cp $< $@\",\n )\n \n+# The wheels have the same C API header, but we need to give each their own copy\n+genrule(\n+    name = \"pjrt_c_api_hdr_cuda\",\n+    srcs = [\"//xla/pjrt/c:pjrt_c_api.h\"],\n+    outs = [\"xla_plugins/xla_\" + cuda_label + \"_pjrt/include/pjrt_c_api.h\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n+genrule(\n+    name = \"pjrt_c_api_hdr_cpu\",\n+    srcs = [\"//xla/pjrt/c:pjrt_c_api.h\"],\n+    outs = [\"xla_plugins/xla_cpu_pjrt/include/pjrt_c_api.h\"],\n+    cmd = \"cp $< $@\",\n+)\n+\n # GPU-specific files\n cc_binary(\n     name = \"xla_plugins/xla_\" + cuda_label + \"_pjrt/xla_gpu_pjrt.so\",\n@@ -65,8 +80,9 @@ py_wheel(\n     summary = \"XLA PJRT Plugin\",\n     version = wheel_version,\n     deps = [\n-        \":xla_plugins/xla_\" + cuda_label + \"_pjrt/xla_gpu_pjrt.so\",\n         \":init_file_\" + cuda_label,\n+        \":pjrt_c_api_hdr_cuda\",\n+        \":xla_plugins/xla_\" + cuda_label + \"_pjrt/xla_gpu_pjrt.so\",\n     ],\n )\n \n@@ -106,6 +122,7 @@ py_wheel(\n     version = wheel_version,\n     deps = [\n         \":init_file_cpu\",\n+        \":pjrt_c_api_hdr_cpu\",\n         \":xla_plugins/xla_cpu_pjrt/xla_cpu_pjrt.so\",\n     ],\n )"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
    }
}