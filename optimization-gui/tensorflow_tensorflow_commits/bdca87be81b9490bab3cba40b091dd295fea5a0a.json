{
    "author": "ZixuanJiang",
    "message": "Clear frontend attributes for get-tuple-elements of GlobalToLocal and LocalToGlobal custom-calls.\n\ncl/826134489 only clears the frontend attributes for mhlo.custom-call. This cl adds support for stablehlo.custom-call.\n\nPiperOrigin-RevId: 831055853",
    "sha": "bdca87be81b9490bab3cba40b091dd295fea5a0a",
    "files": [
        {
            "sha": "ab3246513d97ff8f455c5107b974b9754221e5c5",
            "filename": "third_party/xla/xla/hlo/translate/mhlo_to_hlo/mlir_hlo_to_hlo.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdca87be81b9490bab3cba40b091dd295fea5a0a/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdca87be81b9490bab3cba40b091dd295fea5a0a/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc?ref=bdca87be81b9490bab3cba40b091dd295fea5a0a",
            "patch": "@@ -2719,6 +2719,15 @@ LogicalResult ExportXlaOp(CustomCallOp op, OpLoweringContext ctx) {\n \n   if (op->getNumResults() == 1 && !return_tuple) {\n     value_map[op.getResult(0)] = custom_call;\n+  } else if (op.getCallTargetName() ==\n+                 xla::sdy::kGlobalToLocalShapeCallTargetName ||\n+             op.getCallTargetName() ==\n+                 xla::sdy::kLocalToGlobalShapeCallTargetName) {\n+    // ShardyXLA has the hlo -> stablehlo -> hlo round trip. These\n+    // get-tuple-elements do not need to hold the frontend attributes.\n+    xla::XlaScopedFrontendAttributesAssignment frontend_attributes_scope(\n+        ctx.builder, xla::FrontendAttributes());\n+    BuildGetTupleElementsForTupleResults(op, custom_call, ctx);\n   } else {\n     BuildGetTupleElementsForTupleResults(op, custom_call, ctx);\n   }\n@@ -4432,8 +4441,8 @@ LogicalResult ExportXlaOp(CustomCallOp op, OpLoweringContext ctx) {\n                  xla::sdy::kGlobalToLocalShapeCallTargetName ||\n              op.getCallTargetName() ==\n                  xla::sdy::kLocalToGlobalShapeCallTargetName) {\n-    // We will convert HLO to StableHLO in the ShardyXLA pipeline. These\n-    // get-tuple-elements does not need to hold the frontend attributes.\n+    // ShardyXLA has the hlo -> stablehlo -> hlo round trip. These\n+    // get-tuple-elements do not need to hold the frontend attributes.\n     xla::XlaScopedFrontendAttributesAssignment frontend_attributes_scope(\n         ctx.builder, xla::FrontendAttributes());\n     BuildGetTupleElementsForTupleResults(op, custom_call, ctx);"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 11,
        "deletions": 2
    }
}