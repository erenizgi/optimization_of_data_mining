{
    "author": "vwbaker",
    "message": "Do not send scatter-fusions through fusion-emitter autotuner\n\nScatter can't be emitted by triton so there is no reason to autotune it. In addition, scatter can't be guaranteed to produce the same results & the autotuner has a buffer comparator with the native emitter which can fail.\n\nPiperOrigin-RevId: 810887425",
    "sha": "7c9437706e4edf25963c3f268739d47ba06a405a",
    "files": [
        {
            "sha": "5d92ac4586bc01b9d637e2bcebe3769f46264bf7",
            "filename": "third_party/xla/xla/service/gpu/nvptx_compiler.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c9437706e4edf25963c3f268739d47ba06a405a/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c9437706e4edf25963c3f268739d47ba06a405a/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc?ref=7c9437706e4edf25963c3f268739d47ba06a405a",
            "patch": "@@ -399,6 +399,12 @@ bool ShouldAutotuneBetweenFusionEmitters(const HloInstruction& instruction) {\n   if (fusion->fusion_kind() == HloInstruction::FusionKind::kCustom) {\n     return false;\n   }\n+  // Scatter can't go through the block-level emitter and runs into comparator\n+  // issues in the autotuner as different runs can produce different results.\n+  if (absl::c_any_of(fusion->fused_instructions_computation()->instructions(),\n+                     HloPredicateIsOp<HloOpcode::kScatter>)) {\n+    return false;\n+  }\n   return absl::c_any_of(\n       fusion->fused_instructions_computation()->instructions(),\n       HloPredicateIsOp<HloOpcode::kReduce, HloOpcode::kTranspose>);"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 6,
        "deletions": 0
    }
}