{
    "author": "hawkinsp",
    "message": "Delete HloModuleGroupPass, which is dead.\n\nPiperOrigin-RevId: 816505665",
    "sha": "ab2b488a27678002a01c61d983dcd1f9dcbb958f",
    "files": [
        {
            "sha": "842438304c067dc45bb253559d24fe9e9f1b0e38",
            "filename": "third_party/xla/docs/hlo_passes.md",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fdocs%2Fhlo_passes.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fdocs%2Fhlo_passes.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fdocs%2Fhlo_passes.md?ref=ab2b488a27678002a01c61d983dcd1f9dcbb958f",
            "patch": "@@ -30,9 +30,7 @@ For example:\n The base class for HLO passes can be found in\n [`xla/hlo/pass/hlo_pass_interface.h`](https://github.com/openxla/xla/blob/main/xla/hlo/pass/hlo_pass_interface.h).\n HLO pass should not extend this class directly but instead should extend\n-[`HloModulePass`](https://github.com/openxla/xla/blob/main/xla/hlo/pass/hlo_pass_interface.h#L142)\n-or\n-[`HloModuleGroupPass`](https://github.com/openxla/xla/blob/main/xla/hlo/pass/hlo_pass_interface.h#L172).\n+[`HloModulePass`](https://github.com/openxla/xla/blob/main/xla/hlo/pass/hlo_pass_interface.h#L142).\n \n See also\n [XLA HLO Pass Framework](https://github.com/openxla/xla/tree/main/xla/hlo/pass#readme).\n@@ -198,8 +196,7 @@ Partitions HLOs into tasks to run on separate threads.\n ## Analysis passes\n \n Analysis passes are not considered \"HLO passes\" since they do not transform HLO\n-and may not extend `HloModulePass` or `HloModuleGroupPass`. Shared analyses are\n-found in\n+and may not extend `HloModulePass`. Shared analyses are found in\n [`xla/hlo/analysis`](https://github.com/openxla/xla/tree/main/xla/hlo/analysis).\n \n ### Analysis Pass Examples"
        },
        {
            "sha": "ff52a2dcb752978b8bdb657de94da224742b4e8b",
            "filename": "third_party/xla/xla/hlo/pass/README.md",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2FREADME.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2FREADME.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2FREADME.md?ref=ab2b488a27678002a01c61d983dcd1f9dcbb958f",
            "patch": "@@ -12,8 +12,6 @@ Defines the foundational classes for HLO passes:\n \n * `HloPassInterface`: Abstract base class for all HLO passes.\n * `HloModulePass`: Subclass for passes that operate on individual HloModules.\n-* `HloModuleGroupPass`: Subclass for passes that operate on HloModuleGroups\n-(collections of modules).\n \n Provides core methods like `Run`, `RunOnModuleGroup`, and\n `RunOnChangedComputations` that passes must implement to perform their\n@@ -50,8 +48,7 @@ auto status = pipeline.Run(&module);\n \n ## Important Considerations\n \n-When creating custom HLO passes, inherit from either `HloModulePass` or\n-`HloModuleGroupPass` depending on the scope of your transformation.  Implement\n+When creating custom HLO passes, inherit from `HloModulePass`. Implement\n the required virtual methods (e.g., `Run`) to define the pass's behavior.\n Utilize `HloPassFix` when your pass's transformations may trigger further\n optimizations upon repeated application. Construct `HloPassPipelines` to"
        },
        {
            "sha": "ece349de29ff97638dccd499df205b0ff714bc71",
            "filename": "third_party/xla/xla/hlo/pass/hlo_pass_interface.h",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_interface.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_interface.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_interface.h?ref=ab2b488a27678002a01c61d983dcd1f9dcbb958f",
            "patch": "@@ -38,7 +38,7 @@ namespace xla {\n \n // Base class for HLO passes. These are used with the HloPassPipeline to\n // organize a sequence of passes. An HLO pass should not extend this class\n-// directly; it should extend HloModulePass or HloModuleGroupPass.\n+// directly; it should extend HloModulePass.\n class HloPassInterface {\n  public:\n   // Struct that holds states of pass runs across multiple iterations.\n@@ -167,17 +167,6 @@ class HloModulePass : public HloPassInterface {\n   }\n };\n \n-// Base class for passes which are module-group scoped. These passes cannot run\n-// on an HLO module.\n-class HloModuleGroupPass : public HloPassInterface {\n- public:\n-  absl::StatusOr<bool> Run(HloModule* module,\n-                           const absl::flat_hash_set<absl::string_view>&\n-                               execution_threads) override {\n-    return Internal(\"Module group pass cannot be run on a module\");\n-  }\n-};\n-\n }  // namespace xla\n \n #endif  // XLA_HLO_PASS_HLO_PASS_INTERFACE_H_"
        },
        {
            "sha": "b2f5d05dcf108b385b439dbb78f6b928319bfdfa",
            "filename": "third_party/xla/xla/hlo/pass/hlo_pass_pipeline_test.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 41,
            "changes": 54,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_pipeline_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ab2b488a27678002a01c61d983dcd1f9dcbb958f/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_pipeline_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fpass%2Fhlo_pass_pipeline_test.cc?ref=ab2b488a27678002a01c61d983dcd1f9dcbb958f",
            "patch": "@@ -100,24 +100,20 @@ class ReverseStringModulePass : public HloModulePass {\n   }\n };\n \n-// A module group pass which renames instructions named 'baz' to 'qux'.\n-class BazToQuxModuleGroupPass : public HloModuleGroupPass {\n+// A module pass which renames instructions named 'baz' to 'qux'.\n+class BazToQuxModulePass : public HloModulePass {\n   absl::string_view name() const override { return \"baz2qux\"; }\n \n-  using HloPassInterface::RunOnModuleGroup;\n-  absl::StatusOr<bool> RunOnModuleGroup(\n-      HloModuleGroup* module_group,\n-      const absl::flat_hash_set<absl::string_view>& execution_threads)\n-      override {\n+  absl::StatusOr<bool> Run(HloModule* module,\n+                           const absl::flat_hash_set<absl::string_view>&\n+                               execution_threads) override {\n     bool changed = false;\n-    for (HloModule* module : module_group->modules()) {\n-      for (HloComputation* computation :\n-           module->computations(execution_threads)) {\n-        for (HloInstruction* instruction : computation->instructions()) {\n-          if (instruction->name() == \"baz\") {\n-            instruction->SetAndSanitizeName(\"qux\");\n-            changed = true;\n-          }\n+    for (HloComputation* computation :\n+         module->computations(execution_threads)) {\n+      for (HloInstruction* instruction : computation->instructions()) {\n+        if (instruction->name() == \"baz\") {\n+          instruction->SetAndSanitizeName(\"qux\");\n+          changed = true;\n         }\n       }\n     }\n@@ -260,7 +256,6 @@ ENTRY %Entry (p0: f32[10], p1: f32[10]) -> f32[10] {\n }\n \n TEST_F(HloPassPipelineTest, MixedPipeline) {\n-  // Test a pipeline with both a module pass and a module group pass.\n   const std::string module_0_str = R\"(\n HloModule MixedPipeline.1\n \n@@ -274,7 +269,7 @@ ENTRY main {\n                           ParseModuleGroup(module_0_str));\n \n   HloPassPipeline pipeline(TestName());\n-  pipeline.AddPass<BazToQuxModuleGroupPass>();\n+  pipeline.AddPass<BazToQuxModulePass>();\n   pipeline.AddPass<FooToBarModulePass>();\n \n   HloInstruction* root0 =\n@@ -338,35 +333,12 @@ ENTRY main {\n   }\n }\n \n-TEST_F(HloPassPipelineTest, ModuleGroupPassOnModule) {\n-  // Running a module group pass on a module should produce an error.\n-  const std::string module_str = R\"(\n-HloModule ModuleGroupPassOnModule\n-\n-ENTRY main {\n-  a = f32[] parameter(0)\n-  b = f32[] parameter(1)\n-  ROOT foo = f32[] multiply(a, b)\n-}\n-)\";\n-  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<VerifiedHloModule> module,\n-                          ParseAndReturnVerifiedModule(module_str));\n-  HloPassPipeline pipeline(TestName());\n-  pipeline.AddPass<BazToQuxModuleGroupPass>();\n-\n-  absl::Status status = pipeline.Run(module.get()).status();\n-  ASSERT_IS_NOT_OK(status);\n-  EXPECT_THAT(\n-      status.message(),\n-      ::testing::HasSubstr(\"Module group pass cannot be run on a module\"));\n-}\n-\n // Test that metadata is set when a module group goes through a pass pipeline.\n TEST_F(HloPassPipelineTest, SetHloModuleMetadata) {\n   HloModuleGroup module_group(CreateNewVerifiedModule());\n \n   HloPassPipeline pipeline(TestName());\n-  pipeline.AddPass<BazToQuxModuleGroupPass>();\n+  pipeline.AddPass<BazToQuxModulePass>();\n   pipeline.AddPass<FooToBarModulePass>();\n   TF_ASSERT_OK(pipeline.RunOnModuleGroup(&module_group).status());\n   ASSERT_THAT(module_group.modules(), SizeIs(1));"
        }
    ],
    "stats": {
        "total": 79,
        "additions": 17,
        "deletions": 62
    }
}