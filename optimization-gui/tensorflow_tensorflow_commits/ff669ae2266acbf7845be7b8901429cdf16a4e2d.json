{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@0c2701fe7fa0\n\nUpdates LLVM usage to match\n[0c2701fe7fa0](https://github.com/llvm/llvm-project/commit/0c2701fe7fa0)\n\nPiperOrigin-RevId: 837288411",
    "sha": "ff669ae2266acbf7845be7b8901429cdf16a4e2d",
    "files": [
        {
            "sha": "509398da979e83350e3eb05534a4a72c6e1f3b19",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=ff669ae2266acbf7845be7b8901429cdf16a4e2d",
            "patch": "@@ -1,29 +1 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n-diff -ruN --strip-trailing-cr a/clang/lib/Analysis/ThreadSafety.cpp b/clang/lib/Analysis/ThreadSafety.cpp\n---- a/clang/lib/Analysis/ThreadSafety.cpp\n-+++ b/clang/lib/Analysis/ThreadSafety.cpp\n-@@ -2820,7 +2820,7 @@\n-         case CFGElement::AutomaticObjectDtor: {\n-           CFGAutomaticObjDtor AD = BI.castAs<CFGAutomaticObjDtor>();\n-           const auto *DD = AD.getDestructorDecl(AC.getASTContext());\n--          if (!DD->hasAttrs())\n-+          if (!DD || !DD->hasAttrs())\n-             break;\n- \n-           LocksetBuilder.handleCall(\n-diff -ruN --strip-trailing-cr a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n---- a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n-+++ b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n-@@ -0,0 +1,12 @@\n-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n-+// expected-no-diagnostics\n-+\n-+struct foo {\n-+  ~foo();\n-+};\n-+struct bar : foo {};\n-+struct baz : bar {};\n-+baz foobar(baz a) { return a; }"
        },
        {
            "sha": "daf3e7454b4ca3c6566d0a9fbbca31c83f93bc7c",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=ff669ae2266acbf7845be7b8901429cdf16a4e2d",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"4f39a4ff0ada92870ca1c2dccad382ea04947da8\"\n-    LLVM_SHA256 = \"264c7cc3e166b840911494a2e94cff2ae8730b56239bd91dc8f65c8dc9468262\"\n+    LLVM_COMMIT = \"0c2701fe7fa002e1befc5f86c268a7964f96d286\"\n+    LLVM_SHA256 = \"50b0cb64adf161b4441ee32453f2eb9a015263e4eb3c036548f0207cbe3d0707\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "0cfa64a8afac5b8d719f049443cea5d0856591df",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 57,
            "deletions": 49,
            "changes": 106,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=ff669ae2266acbf7845be7b8901429cdf16a4e2d",
            "patch": "@@ -1,64 +1,72 @@\n diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch\n-index e25178e..37a7256 100644\n+index 37a7256..509398d 100644\n --- a/third_party/llvm/generated.patch\n +++ b/third_party/llvm/generated.patch\n-@@ -1,17 +1,29 @@\n+@@ -1,29 +1 @@\n  Auto generated patch. Do not edit or delete it, even if empty.\n--diff -ruN --strip-trailing-cr a/mlir/lib/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.cpp b/mlir/lib/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.cpp\n----- a/mlir/lib/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.cpp\n--+++ b/mlir/lib/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.cpp\n--@@ -4095,6 +4095,12 @@\n--   llvm::SmallVector<size_t> occludedChildren;\n--   llvm::sort(\n--       indices.begin(), indices.end(), [&](const size_t a, const size_t b) {\n--+        // Bail early if we are asked to look at the same index. If we do not\n--+        // bail early, we can end up mistakenly adding indices to\n--+        // occludedChildren. This can occur with some types of libc++ hardening.\n--+        if (a == b)\n--+          return false;\n+-diff -ruN --strip-trailing-cr a/clang/lib/Analysis/ThreadSafety.cpp b/clang/lib/Analysis/ThreadSafety.cpp\n+---- a/clang/lib/Analysis/ThreadSafety.cpp\n+-+++ b/clang/lib/Analysis/ThreadSafety.cpp\n+-@@ -2820,7 +2820,7 @@\n+-         case CFGElement::AutomaticObjectDtor: {\n+-           CFGAutomaticObjDtor AD = BI.castAs<CFGAutomaticObjDtor>();\n+-           const auto *DD = AD.getDestructorDecl(AC.getASTContext());\n+--          if (!DD->hasAttrs())\n+-+          if (!DD || !DD->hasAttrs())\n+-             break;\n+- \n+-           LocksetBuilder.handleCall(\n+-diff -ruN --strip-trailing-cr a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n+---- a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n+-+++ b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n+-@@ -0,0 +1,12 @@\n+-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n+-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n+-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n+-+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n+-+// expected-no-diagnostics\n -+\n--         auto memberIndicesA = cast<ArrayAttr>(indexAttr[a]);\n--         auto memberIndicesB = cast<ArrayAttr>(indexAttr[b]);\n-+diff -ruN --strip-trailing-cr a/clang/lib/Analysis/ThreadSafety.cpp b/clang/lib/Analysis/ThreadSafety.cpp\n-+--- a/clang/lib/Analysis/ThreadSafety.cpp\n-++++ b/clang/lib/Analysis/ThreadSafety.cpp\n-+@@ -2820,7 +2820,7 @@\n-+         case CFGElement::AutomaticObjectDtor: {\n-+           CFGAutomaticObjDtor AD = BI.castAs<CFGAutomaticObjDtor>();\n-+           const auto *DD = AD.getDestructorDecl(AC.getASTContext());\n-+-          if (!DD->hasAttrs())\n-++          if (!DD || !DD->hasAttrs())\n-+             break;\n-  \n-+           LocksetBuilder.handleCall(\n-+diff -ruN --strip-trailing-cr a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n-+--- a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n-++++ b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n-+@@ -0,0 +1,12 @@\n-++// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n-++// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n-++// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n-++// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n-++// expected-no-diagnostics\n-++\n-++struct foo {\n-++  ~foo();\n-++};\n-++struct bar : foo {};\n-++struct baz : bar {};\n-++baz foobar(baz a) { return a; }\n+-+struct foo {\n+-+  ~foo();\n+-+};\n+-+struct bar : foo {};\n+-+struct baz : bar {};\n+-+baz foobar(baz a) { return a; }\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index 215fe72..3b35979 100644\n+index 3b35979..daf3e74 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"26362c68579dd4375198aae4651b4d5f8a36c715\"\n--    LLVM_SHA256 = \"1b81809d98940d0a6d4f19ef9e0bf72cd5847b9bbed47bc3517fcf8a40d38fd9\"\n-+    LLVM_COMMIT = \"4f39a4ff0ada92870ca1c2dccad382ea04947da8\"\n-+    LLVM_SHA256 = \"264c7cc3e166b840911494a2e94cff2ae8730b56239bd91dc8f65c8dc9468262\"\n+-    LLVM_COMMIT = \"4f39a4ff0ada92870ca1c2dccad382ea04947da8\"\n+-    LLVM_SHA256 = \"264c7cc3e166b840911494a2e94cff2ae8730b56239bd91dc8f65c8dc9468262\"\n++    LLVM_COMMIT = \"0c2701fe7fa002e1befc5f86c268a7964f96d286\"\n++    LLVM_SHA256 = \"50b0cb64adf161b4441ee32453f2eb9a015263e4eb3c036548f0207cbe3d0707\"\n  \n      tf_http_archive(\n          name = name,\n+diff --git a/third_party/llvm/zstd.patch b/third_party/llvm/zstd.patch\n+index 2d6f45a..39e69eb 100644\n+--- a/third_party/llvm/zstd.patch\n++++ b/third_party/llvm/zstd.patch\n+@@ -9,7 +9,7 @@ index 37e79db376b4..058788948f94 100644\n+ -        # We unconditionally depend on the custom LLVM zlib wrapper. This will\n+ -        # be an empty library unless zlib is enabled, in which case it will\n+ -        # both provide the necessary dependencies and configuration defines.\n+--        \"//third-party:zlib\",\n++-        \"@llvm_zlib//:zlib\",\n+ -        # We unconditionally depend on the custom LLVM zstd wrapper. This will\n+ -        # be an empty library unless zstd is enabled, in which case it will\n+ -        # both provide the necessary dependencies and configuration defines.\n+@@ -24,8 +24,8 @@ diff -u a/utils/bazel/llvm-project-overlay/lld/BUILD.bazel  b/utils/bazel/llvm-p\n+          \"//llvm:TargetParser\",\n+          \"//llvm:TransformUtils\",\n+          \"//llvm:config\",\n+--        \"//third-party:zlib\",\n+ -        \"//third-party:zstd\",\n++-        \"@llvm_zlib//:zlib\",\n+      ],\n+  )\n+ "
        },
        {
            "sha": "01111898b25922a965cafcb3de4d303caeb41d50",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff669ae2266acbf7845be7b8901429cdf16a4e2d/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=ff669ae2266acbf7845be7b8901429cdf16a4e2d",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"1f65a631b69e6053f18bdb2d01b5cde0cb2e5f89\"\n-    SHARDY_SHA256 = \"19c5a4902d6c0317dd0362e45ef95ffd877ed0c4d98a7ed7a86fac517d594725\"\n+    SHARDY_COMMIT = \"97ce26f0493d3aa720d1d6c18bde48d38c2e3866\"\n+    SHARDY_SHA256 = \"22e964d3a228f0613c3663eb743d0b726ce271247652e5710b7d63bd6703e2a4\"\n \n     tf_http_archive(\n         name = \"shardy\","
        }
    ],
    "stats": {
        "total": 142,
        "additions": 61,
        "deletions": 81
    }
}