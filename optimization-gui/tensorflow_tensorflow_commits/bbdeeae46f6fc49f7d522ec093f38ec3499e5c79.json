{
    "author": "allanrenucci",
    "message": "[NFC] Use `absl::string_view` instead of  `const char*`.\n\nWe just need to handle the case where an `absl::string_view` can be created from a possibly-null pointer.\n\nPiperOrigin-RevId: 799965329",
    "sha": "bbdeeae46f6fc49f7d522ec093f38ec3499e5c79",
    "files": [
        {
            "sha": "22c7ae98f65efa416b5e49348465c227c4c686a8",
            "filename": "third_party/xla/xla/tsl/platform/logging_initializer.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bbdeeae46f6fc49f7d522ec093f38ec3499e5c79/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Flogging_initializer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bbdeeae46f6fc49f7d522ec093f38ec3499e5c79/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Flogging_initializer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Flogging_initializer.cc?ref=bbdeeae46f6fc49f7d522ec093f38ec3499e5c79",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include <cstdint>\n #include <cstdlib>\n-#include <cstring>\n #include <optional>\n #include <vector>\n \n@@ -28,8 +27,8 @@ limitations under the License.\n namespace tsl {\n namespace {\n \n-std::optional<int64_t> LogLevelStrToInt(const char* str) {\n-  if (str == nullptr || strlen(str) == 0) {\n+std::optional<int64_t> LogLevelStrToInt(absl::string_view str) {\n+  if (str.empty()) {\n     return std::nullopt;\n   }\n   if (int level; absl::SimpleAtoi(str, &level)) {\n@@ -38,8 +37,8 @@ std::optional<int64_t> LogLevelStrToInt(const char* str) {\n   return std::nullopt;\n }\n \n-void UpdateVlogLevels(const char* spec) {\n-  if (spec == nullptr || strlen(spec) == 0) {\n+void UpdateVlogLevels(absl::string_view spec) {\n+  if (spec.empty()) {\n     return;\n   }\n   for (absl::string_view entry : absl::StrSplit(spec, ',')) {\n@@ -54,6 +53,10 @@ void UpdateVlogLevels(const char* spec) {\n   }\n }\n \n+absl::string_view GetEnv(absl::string_view name) {\n+  return absl::NullSafeStringView(std::getenv(name.data()));\n+}\n+\n // Initializes logging and configures it based on environment variables.\n // This class is intended to be used as a global instance, ensuring that\n // logging is initialized before any other code that might use it.\n@@ -62,14 +65,13 @@ class LoggingInitializer {\n   LoggingInitializer() {\n     // We log everything to stderr for backwards compatibility with TSL logging.\n     absl::SetStderrThreshold(absl::LogSeverityAtLeast::kInfo);\n-    if (auto severity = LogLevelStrToInt(std::getenv(\"TF_CPP_MIN_LOG_LEVEL\"))) {\n+    if (auto severity = LogLevelStrToInt(GetEnv(\"TF_CPP_MIN_LOG_LEVEL\"))) {\n       absl::SetMinLogLevel(static_cast<absl::LogSeverityAtLeast>(*severity));\n     }\n-    if (auto threshold =\n-            LogLevelStrToInt(std::getenv(\"TF_CPP_MAX_VLOG_LEVEL\"))) {\n+    if (auto threshold = LogLevelStrToInt(GetEnv(\"TF_CPP_MAX_VLOG_LEVEL\"))) {\n       absl::SetGlobalVLogLevel(*threshold);\n     }\n-    UpdateVlogLevels(std::getenv(\"TF_CPP_VMODULE\"));\n+    UpdateVlogLevels(GetEnv(\"TF_CPP_VMODULE\"));\n   }\n };\n "
        }
    ],
    "stats": {
        "total": 20,
        "additions": 11,
        "deletions": 9
    }
}