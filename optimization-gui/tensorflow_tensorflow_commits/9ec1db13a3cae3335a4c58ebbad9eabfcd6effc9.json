{
    "author": "Becker-ZH",
    "message": "Expose PM Sampling to 3P and Add Integration Test\n\nPiperOrigin-RevId: 802739489",
    "sha": "9ec1db13a3cae3335a4c58ebbad9eabfcd6effc9",
    "files": [
        {
            "sha": "7de2faf6969069a4f3b2d8e9d7da6015a363d758",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_tracer_options_utils.cc",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9ec1db13a3cae3335a4c58ebbad9eabfcd6effc9/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer_options_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9ec1db13a3cae3335a4c58ebbad9eabfcd6effc9/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer_options_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer_options_utils.cc?ref=9ec1db13a3cae3335a4c58ebbad9eabfcd6effc9",
            "patch": "@@ -18,11 +18,14 @@ limitations under the License.\n #include <cstdint>\n #include <functional>\n #include <string>\n+#include <vector>\n \n #include \"absl/container/flat_hash_set.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/ascii.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n+#include \"absl/strings/str_split.h\"\n #include \"absl/strings/string_view.h\"\n #include \"third_party/gpus/cuda/extras/CUPTI/include/cupti_activity.h\"\n #include \"xla/backends/profiler/gpu/cupti_collector.h\"\n@@ -79,6 +82,24 @@ absl::Status UpdateCuptiTracerOptionsFromProfilerOptions(\n                        }\n                      }));\n \n+  TF_RETURN_IF_ERROR(SetValue<std::string>(\n+      profile_options, \"gpu_pm_sample_counters\", input_keys,\n+      [&](const std::string& value) {\n+        std::vector<std::string> metrics;\n+        for (absl::string_view metric :\n+             absl::StrSplit(value, ',', absl::SkipEmpty())) {\n+          metrics.push_back(std::string(absl::StripAsciiWhitespace(metric)));\n+        }\n+        tracer_options.pm_sampler_options.metrics = metrics;\n+        tracer_options.pm_sampler_options.enable = !metrics.empty();\n+      }));\n+\n+  TF_RETURN_IF_ERROR(SetValue<int64_t>(\n+      profile_options, \"gpu_pm_sample_interval_us\", input_keys,\n+      [&](int64_t value) {\n+        tracer_options.pm_sampler_options.sample_interval_ns = value * 1000;\n+      }));\n+\n   if (!input_keys.empty()) {\n     return absl::InvalidArgumentError(absl::StrCat(\n         \"Parsing advanced_configuration failed for CUPTI tracer. The following \""
        }
    ],
    "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
    }
}