{
    "author": "akuegel",
    "message": "[XLA:GPU] Increase test coverage for xla_gpu_deterministic_ops.\n\nWhen using the flag --xla_gpu_deterministic_ops, in addition to disabling\nautotuning it does expand scatter ops. So we should be running the scatter\ntests also with this option to have test coverage for this path.\n\nPiperOrigin-RevId: 805828423",
    "sha": "eba243b07dcdd69f1ef642038bbfcb437b8d1d3f",
    "files": [
        {
            "sha": "54aba5b6101ad4dadc4d88419e6be5cac8edd56b",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/eba243b07dcdd69f1ef642038bbfcb437b8d1d3f/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/eba243b07dcdd69f1ef642038bbfcb437b8d1d3f/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=eba243b07dcdd69f1ef642038bbfcb437b8d1d3f",
            "patch": "@@ -1231,6 +1231,38 @@ xla_test(\n     ],\n )\n \n+xla_test(\n+    name = \"scatter_deterministic_expander_test\",\n+    srcs = [\"scatter_test.cc\"],\n+    args = [\n+        \"--xla_gpu_deterministic_ops\",\n+        \"--xla_gpu_enable_scatter_determinism_expander\",\n+    ],\n+    backends = [\"gpu\"],\n+    tags = [\n+        \"test_migrated_to_hlo_runner_pjrt\",\n+    ],\n+    deps = [\n+        \":hlo_pjrt_interpreter_reference_mixin\",\n+        \":hlo_pjrt_test_base\",\n+        \":literal_test_util\",\n+        \":xla_internal_test_main\",\n+        \"//xla:array2d\",\n+        \"//xla:error_spec\",\n+        \"//xla:literal\",\n+        \"//xla:literal_util\",\n+        \"//xla:shape_util\",\n+        \"//xla:types\",\n+        \"//xla/hlo/ir:hlo\",\n+        \"//xla/hlo/testlib:test\",\n+        \"//xla/service:hlo_module_config\",\n+        \"//xla/tests:xla_test_backend_predicates\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/types:span\",\n+    ],\n+)\n+\n # Repeat dot_operation_runtime_test with single-threaded eigen.\n xla_test(\n     name = \"dot_operation_single_threaded_runtime_test\","
        },
        {
            "sha": "dd5c7861f8d8ffecec2e5bf8a8e11c21c16bda1d",
            "filename": "third_party/xla/xla/tests/scatter_test.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/eba243b07dcdd69f1ef642038bbfcb437b8d1d3f/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/eba243b07dcdd69f1ef642038bbfcb437b8d1d3f/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc?ref=eba243b07dcdd69f1ef642038bbfcb437b8d1d3f",
            "patch": "@@ -116,6 +116,13 @@ ENTRY main {\n       LiteralUtil::CreateR2<int32_t>({{10, 20, 30}, {70, 80, 90}});\n   TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<HloModule> module,\n                           ParseAndReturnVerifiedModule(hlo_text));\n+  if (module->config()\n+          .debug_options()\n+          .xla_gpu_enable_scatter_determinism_expander() &&\n+      module->config().debug_options().xla_gpu_deterministic_ops()) {\n+    // TODO(b/443204632): Re-enable this test.\n+    GTEST_SKIP() << \"Currently fails\";\n+  }\n   TF_ASSERT_OK_AND_ASSIGN(\n       Literal result,\n       Execute(std::move(module), {&operand, &scatter_indices, &updates}));"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}