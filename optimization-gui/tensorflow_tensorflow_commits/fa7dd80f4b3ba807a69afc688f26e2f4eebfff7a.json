{
    "author": "unknown",
    "message": "[XLA] Run latency hiding scheduler on computations with no async computations but with force delay\n\nPiperOrigin-RevId: 831133591",
    "sha": "fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a",
    "files": [
        {
            "sha": "4841d9b90f3c97ffc76ab3d89288899f277ed27f",
            "filename": "third_party/xla/xla/service/latency_hiding_scheduler.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc?ref=fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a",
            "patch": "@@ -3639,7 +3639,8 @@ absl::StatusOr<bool> LatencyHidingScheduler::RunImpl(\n       if (scheduling_context_->GetAsyncTracker()->IsSupportedAsyncStart(\n               *instr) ||\n           scheduling_context_->GetAsyncTracker()->IsSupportedAsyncDone(\n-              *instr)) {\n+              *instr) ||\n+          IsCustomCallWithForceDelayAttribute(instr)) {\n         computations_to_schedule_.push_back(computation);\n         break;\n       }"
        },
        {
            "sha": "b788717b5359849cb71b0e7ba241d6119fcadaae",
            "filename": "third_party/xla/xla/service/latency_hiding_scheduler_test.cc",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler_test.cc?ref=fa7dd80f4b3ba807a69afc688f26e2f4eebfff7a",
            "patch": "@@ -793,6 +793,25 @@ ENTRY entry {\n             GetIndex(new_instruction_sequence, cp_start->name()));\n }\n \n+TEST_F(LatencyHidingSchedulerTest, ForceDelayCustomCall) {\n+  absl::string_view hlo_string = R\"(\n+HloModule module, is_scheduled=true\n+\n+ENTRY %module {\n+  %p0 = f32[100] parameter(0)\n+  %custom-call = f32[100] custom-call(%p0), custom_call_target=\"foo\", frontend_attributes={scheduler_hint=\"force_delay\"}\n+  ROOT %copy = f32[100] copy(%custom-call)\n+}\n+)\";\n+\n+  TF_ASSERT_OK_AND_ASSIGN(auto hlo_module, ParseHloText(hlo_string));\n+  // We expect RunScheduler to return true because of the force_delay attribute,\n+  // even though there are no async collectives.\n+  auto result = RunScheduler(hlo_module.get());\n+  TF_ASSERT_OK(result);\n+  EXPECT_TRUE(result.value());\n+}\n+\n TEST_F(LatencyHidingSchedulerTest, WhileLoopAliasingBug2) {\n   // Like WhileLoopAliasingBug above, but this time the input buffer of the\n   // first collective permute aliases with the output buffer of the second"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 21,
        "deletions": 1
    }
}