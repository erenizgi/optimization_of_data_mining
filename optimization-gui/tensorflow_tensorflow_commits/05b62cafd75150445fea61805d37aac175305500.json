{
    "author": "hugomano",
    "message": "PR #33671: fix(Triton/ROCm): Add missing createTritonGPUAllocateWarpGroups pass to pipeline\n\nImported from GitHub PR https://github.com/openxla/xla/pull/33671\n\nThis PR fixes the Triton compilation pipeline for ROCm by adding the `createTritonGPUAllocateWarpGroups` pass, which was missing.\n\nThis pass is necessary for the `ExtractThreadDims` function to work correctly during code generation. It adds the `ttg.total-num-warps` attribute to the MLIR module, which is later consumed in `emitter_helpers.cc`. Without this pass, the compilation fails when trying to extract thread dimensions.\n\nc/ @khasanovaa @chsigg  @AleksaArsic\n\nCopybara import of the project:\n\n--\n3f9c437a9decf9f9be9c87d52486da67440b403c by Hugo Mano <hugo@zml.ai>:\n\nfix(Triton/ROCm): Add missing createTritonGPUAllocateWarpGroups pass to pipeline\n\n--\n4ec8907749e2c0de17ab5a694f2731f58435681f by Hugo Mano <hugo@zml.ai>:\n\nformat\n\nMerging this change closes #33671\n\nPiperOrigin-RevId: 829473885",
    "sha": "05b62cafd75150445fea61805d37aac175305500",
    "files": [
        {
            "sha": "6bb7a13004ec46a5b0082a493f77c465835c34f8",
            "filename": "third_party/xla/xla/backends/gpu/codegen/triton/compilation_pipeline_rocm.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/05b62cafd75150445fea61805d37aac175305500/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Fcompilation_pipeline_rocm.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/05b62cafd75150445fea61805d37aac175305500/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Fcompilation_pipeline_rocm.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Fcompilation_pipeline_rocm.cc?ref=05b62cafd75150445fea61805d37aac175305500",
            "patch": "@@ -123,6 +123,10 @@ static void MakeLLIR(mlir::OpPassManager* pm,\n                      const stream_executor::RocmComputeCapability& rocm_cc,\n                      int num_stages) {\n   const int custom_lds_size = 0;\n+  // The `createTritonGPUAllocateWarpGroups` pass is not implemented in the\n+  // upstream Triton, but is necessary for `ExtractThreadDims` in emitter\n+  // helpers. It adds the `ttg.total-num-warps` attribute.\n+  pm->addPass(mt::gpu::createTritonGPUAllocateWarpGroups());\n   pm->addPass(mlir::triton::AMD::createOptimizeLDSUsagePass(\n       rocm_cc.gfx_version(), custom_lds_size));\n   pm->addPass(mlir::createSCFToControlFlowPass());"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}