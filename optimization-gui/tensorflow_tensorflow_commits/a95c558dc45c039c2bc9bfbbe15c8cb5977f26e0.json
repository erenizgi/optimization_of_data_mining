{
    "author": "tensorflower-gardener",
    "message": "Save compile options with the compiled IFRT IR program to be used later for serialization\n\nPiperOrigin-RevId: 826301016",
    "sha": "a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0",
    "files": [
        {
            "sha": "49ea8fe1b2986f1a723944474c5abf42172dba72",
            "filename": "third_party/xla/xla/python/ifrt/ir/compiled_ifrt_ir_program.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc?ref=a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0",
            "patch": "@@ -305,11 +305,16 @@ absl::Status PopulateLayouts(mlir::ModuleOp mlir_module,\n \n absl::StatusOr<CompiledIfrtIrProgram> CompiledIfrtIrProgram::Create(\n     std::unique_ptr<xla::ifrt::IfrtIRProgram> ifrt_ir_program,\n-    std::unique_ptr<xla::ifrt::IfrtIRCompileOptions> compile_options,\n+    std::unique_ptr<xla::ifrt::IfrtIRCompileOptions> ifrt_ir_compile_options,\n     xla::ifrt::Client* client,\n     std::shared_ptr<xla::ifrt::AtomProgramCompiler> atom_program_compiler) {\n   TraceMe traceme([]() { return \"ProgramCompiler::CompileForInterpreter\"; });\n \n+  // Sharing the compile options with the passes and when pipeline is done add\n+  // it to the CompiledIfrtIrProgram.\n+  std::shared_ptr<xla::ifrt::IfrtIRCompileOptions> compile_options =\n+      std::move(ifrt_ir_compile_options);\n+\n   std::vector<xla::ifrt::Device*> devices;\n   devices.reserve(compile_options->device_assignments.size());\n   for (const auto& device_id : compile_options->device_assignments) {\n@@ -394,8 +399,7 @@ absl::StatusOr<CompiledIfrtIrProgram> CompiledIfrtIrProgram::Create(\n     }\n     TF_RETURN_IF_ERROR(xla::ifrt::createOutlinedAtomProgramsToCompiledPipeline(\n         pm, std::move(atom_program_compiler), compile_pipeline_options,\n-        std::move(compile_options), atom_executable_map,\n-        std::move(bound_executable_map)));\n+        compile_options, atom_executable_map, std::move(bound_executable_map)));\n \n     {\n       TraceMe traceme(\n@@ -444,6 +448,7 @@ absl::StatusOr<CompiledIfrtIrProgram> CompiledIfrtIrProgram::Create(\n       /*donatable_input_indices=*/std::move(donatable_input_indices),\n       /*program=*/std::move(ifrt_ir_program),\n       /*device_assignments=*/std::move(device_assignments),\n+      /*compile_options=*/compile_options,\n   };\n }\n "
        },
        {
            "sha": "509750627489e1175a8bbbb0e693177310893cd9",
            "filename": "third_party/xla/xla/python/ifrt/ir/compiled_ifrt_ir_program.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.h?ref=a95c558dc45c039c2bc9bfbbe15c8cb5977f26e0",
            "patch": "@@ -60,6 +60,9 @@ struct CompiledIfrtIrProgram {\n   // ids obtained from IFRT client.\n   std::vector<xla::ifrt::DeviceId> device_assignments;\n \n+  // The compile options used to compile the program.\n+  std::shared_ptr<xla::ifrt::IfrtIRCompileOptions> compile_options;\n+\n   // Compiles an IFRT IR program.\n   static absl::StatusOr<CompiledIfrtIrProgram> Create(\n       std::unique_ptr<xla::ifrt::IfrtIRProgram> ifrt_ir_program,"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 11,
        "deletions": 3
    }
}