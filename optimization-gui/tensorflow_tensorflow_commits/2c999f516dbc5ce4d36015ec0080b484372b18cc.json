{
    "author": "alekstheod",
    "message": "PR #33956: [ROCm] Add missing run_under to tsan/asan configs, add missing tsan ignorelist\n\nImported from GitHub PR https://github.com/openxla/xla/pull/33956\n\nüìù Summary of Changes\nProperly support asan/tsan builds with rbe by providing the lists through the run_under script\n\nüéØ Justification\nasan and tsan configs were missing the run_under wrapper so ignorelists were not\nbrought to the rbe executor. This PR fixes it.\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nNot relevant\n\nüß™ Unit Tests:\nNot relevant\n\nüß™ Execution Tests:\nNot relevant\n\nCopybara import of the project:\n\n--\n0561975ce0e0e7d6f5f30d0ef846374ec8fa4202 by Alexandros Theodoridis <atheodor@amd.com>:\n\nAdd missing run_under to tsan/asan configs, add missing tsan ignorelist\n\n--\n7a5b88d852be5415165f7b8e9e9d99cb555fcfff by Alexandros Theodoridis <atheodor@amd.com>:\n\nAdd tsan options supression\n\nMerging this change closes #33956\n\nPiperOrigin-RevId: 833262367",
    "sha": "2c999f516dbc5ce4d36015ec0080b484372b18cc",
    "files": [
        {
            "sha": "eeaccd6f9f873c50b756ce653de7a55a44ded205",
            "filename": "third_party/xla/build_tools/rocm/rocm_xla.bazelrc",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2c999f516dbc5ce4d36015ec0080b484372b18cc/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2c999f516dbc5ce4d36015ec0080b484372b18cc/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc?ref=2c999f516dbc5ce4d36015ec0080b484372b18cc",
            "patch": "@@ -26,10 +26,13 @@ build:tsan --copt -fno-omit-frame-pointer\n build:tsan --linkopt -fsanitize=thread\n build:tsan --linkopt -g\n build:tsan --//build_tools/rocm:sanitizer=tsan\n+build:tsan --test_env=TSAN_OPTIONS=suppressions=build_tools/rocm/tsan_ignore_list.txt::history_size=7:ignore_noninstrumented_modules=1\n+build:tsan --run_under=//build_tools/rocm:sanitizer_wrapper\n \n build:asan --test_env=ASAN_OPTIONS=suppressions=build_tools/rocm/asan_ignore_list.txt:use_sigaltstack=0\n build:asan --test_env=LSAN_OPTIONS=suppressions=build_tools/rocm/lsan_ignore_list.txt:use_sigaltstack=0\n build:asan --//build_tools/rocm:sanitizer=asan\n+build:asan --run_under=//build_tools/rocm:sanitizer_wrapper\n \n test:xla_sgpu -- \\\n //xla/... \\"
        },
        {
            "sha": "9f88753e2fcc5a2395e2eaa565d5e689f458aedc",
            "filename": "third_party/xla/build_tools/rocm/tsan_ignore_list.txt",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2c999f516dbc5ce4d36015ec0080b484372b18cc/third_party%2Fxla%2Fbuild_tools%2Frocm%2Ftsan_ignore_list.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2c999f516dbc5ce4d36015ec0080b484372b18cc/third_party%2Fxla%2Fbuild_tools%2Frocm%2Ftsan_ignore_list.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Frocm%2Ftsan_ignore_list.txt?ref=2c999f516dbc5ce4d36015ec0080b484372b18cc",
            "patch": "@@ -0,0 +1,35 @@\n+race:libhsa-runtime64.so\n+race:libamdhip64.so\n+race:hipStreamSynchronize\n+race:libhipblaslt.so\n+race:libamd_comgr.so\n+race:librccl.so\n+\n+# Abseil reference counting (DropRef / RefCount init)\n+race:tsl::ReferenceCounted\n+race:absl::lts_*::Mutex\n+race:absl::lts_*::CondVar\n+\n+# XLA GPU RawSEDeviceMemory RCReference reuse\n+race:xla::RawSEDeviceMemory\n+race:xla::gpu::AllocateDestinationBuffer\n+race:xla::LocalDeviceState::ThenRelease\n+\n+# To be fixed\n+race:xla::GpuAsyncHostToDeviceTransferManager::TransferRawDataToSubBuffer\n+race:xla::LiteralBase::Piece::DeallocateBuffers\n+race:xla::PjRtStreamExecutorLoadedExecutable::ExecuteHelper\n+race:xla::PjRtStreamExecutorClient::BufferFromHostBufferInternal\n+race:xla::PjRtStreamExecutorClient::AllocateAndRecordEvent\n+race:xla::HloRunnerPjRt::TransferLiteralsFromDevice\n+race:xla::MutableLiteralBase::~MutableLiteralBase\n+race:xla::MutableLiteralBase::PopulateR1<int>\n+race:xla::gpu::GpuCompiler::CompileSingleModule\n+race:xla::LiteralBase::Piece::Storage::Storage\n+race:xla::LocalClient::TransferFromOutfeedLocal\n+race:llvm::cl::opt_storage<bool, false, false>::setValue<int>\n+\n+race:xla::gpu::(anonymous namespace)::RecoverExp2Pattern::initStaticsIfNeeded*\n+race:lld::lldMain\n+race:llvm::*\n+race:xla::gpu::GpuExecutable::ExecuteAsyncOnStream"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 38,
        "deletions": 0
    }
}