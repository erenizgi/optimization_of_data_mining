{
    "author": "tensorflower-gardener",
    "message": "Migrate away from llvm::ArrayRef(std::nullopt_t)\n\nllvm::ArrayRef(std::nullopt_t) has been deprecated upstream.  This CL migrates away from it.\nPiperOrigin-RevId: 801863497",
    "sha": "10d9440888f6a50931bc50830c6584804439ee88",
    "files": [
        {
            "sha": "23b6565c1c77688b8aef0538048db0d81fea6e3a",
            "filename": "tensorflow/compiler/mlir/tensorflow/c/c_api_unified_experimental_mlir.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftensorflow%2Fc%2Fc_api_unified_experimental_mlir.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftensorflow%2Fc%2Fc_api_unified_experimental_mlir.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftensorflow%2Fc%2Fc_api_unified_experimental_mlir.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -269,9 +269,8 @@ class MlirFunctionContext : public TracingContext {\n     RegisterDialects(*context_);\n     // TODO(aminim) figure out the location story here\n     module_ = ModuleOp::create(builder_.getUnknownLoc());\n-    func_ = func::FuncOp::create(\n-        builder_.getUnknownLoc(), name,\n-        builder_.getFunctionType(std::nullopt, std::nullopt));\n+    func_ = func::FuncOp::create(builder_.getUnknownLoc(), name,\n+                                 builder_.getFunctionType({}, {}));\n     module_->push_back(func_);\n     builder_ = OpBuilder::atBlockBegin(func_.addEntryBlock());\n   }"
        },
        {
            "sha": "89d946516f6b9b40a97d58fc97a42f77cfe202de",
            "filename": "tensorflow/compiler/mlir/tools/kernel_gen/transforms/func_to_jit_invocations.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ffunc_to_jit_invocations.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ffunc_to_jit_invocations.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ffunc_to_jit_invocations.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -67,7 +67,7 @@ LogicalResult RewriteToFullJit(func::FuncOp op) {\n   // Create the JIT compile op.\n   auto jit_compile_op = rewriter.create<tf_framework::JITCompileOp>(\n       loc, rewriter.getType<tf_framework::JITCallableType>(),\n-      /*ctx=*/std::nullopt);\n+      /*ctx=*/mlir::Value());\n \n   // Move the original functions operations into the body.\n   {"
        },
        {
            "sha": "ceda47565bf999031f3415f6ed6687033b0a4d7e",
            "filename": "tensorflow/compiler/mlir/tools/kernel_gen/transforms/rewrite_tf_framework_assert.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Frewrite_tf_framework_assert.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Frewrite_tf_framework_assert.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Frewrite_tf_framework_assert.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -60,8 +60,8 @@ class TFAssertOpConverter : public OpConversionPattern<TFAssertOp> {\n \n     rewriter.restoreInsertionPoint(ip);\n     rewriter.replaceOpWithNewOp<cf::CondBranchOp>(\n-        op, adaptor.getArg(), split_block, std::nullopt, error_reporting_block,\n-        std::nullopt);\n+        op, adaptor.getArg(), split_block, mlir::ValueRange(),\n+        error_reporting_block, mlir::ValueRange());\n     return success();\n   }\n };"
        },
        {
            "sha": "236ca5d7c5e1b483622c68d2d6b900c11cb5eee1",
            "filename": "tensorflow/compiler/mlir/tools/kernel_gen/transforms/tf_framework_legalize_to_llvm.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Ftf_framework_legalize_to_llvm.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -237,7 +237,7 @@ class TFDeallocOpConverter : public ConvertToLLVMCallOpPattern<TFDeallocOp> {\n     FlatSymbolRefAttr tf_func_ref =\n         GetOrInsertLLVMFunction(GetFuncName(), GetFuncType(), op, &rewriter);\n     rewriter.replaceOpWithNewOp<LLVM::CallOp>(\n-        op, std::nullopt, tf_func_ref,\n+        op, mlir::TypeRange(), tf_func_ref,\n         llvm::ArrayRef({adaptor.getCtx(), allocated_bytes_ptr}));\n     return success();\n   }\n@@ -353,7 +353,7 @@ class JITExecuteOpConverter : public ConvertToLLVMCallOpPattern<JITExecuteOp> {\n     FlatSymbolRefAttr tf_func_ref =\n         GetOrInsertLLVMFunction(GetFuncName(), GetFuncType(), op, &rewriter);\n     rewriter.create<LLVM::CallOp>(\n-        loc, std::nullopt, tf_func_ref,\n+        loc, mlir::TypeRange(), tf_func_ref,\n         ValueRange{adaptor.getCtx(), adaptor.getCallable(), result_ptr,\n                    num_args, args_ptr});\n \n@@ -406,7 +406,7 @@ class ReportErrorOpConverter\n         loc, typeConverter->convertType(rewriter.getI32Type()),\n         adaptor.getErrorCodeAttr());\n     rewriter.replaceOpWithNewOp<LLVM::CallOp>(\n-        op, std::nullopt, tf_func_ref,\n+        op, mlir::TypeRange(), tf_func_ref,\n         llvm::ArrayRef({adaptor.getCtx(), error_code, message_constant}));\n     return success();\n   }"
        },
        {
            "sha": "8abb9d99672fabcb02466a1922f92d4e1b2c0f96",
            "filename": "third_party/xla/xla/backends/gpu/codegen/triton/fusion_emitter.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -1739,7 +1739,7 @@ mlir::FunctionOpInterface CreateFuncOp(EmitterLocOpBuilder b,\n                                         b.getFunctionType(fn_arg_types, {}));\n   }\n   auto func = b.create<ttir::FuncOp>(\n-      fn_name, b.getFunctionType(fn_arg_types, std::nullopt));\n+      fn_name, b.getFunctionType(fn_arg_types, mlir::TypeRange()));\n   auto divisibility_attr = b.getI32IntegerAttr(16);\n   for (int i = 0; i < func.getNumArguments(); ++i) {\n     func.setArgAttr(i, \"tt.divisibility\", divisibility_attr);"
        },
        {
            "sha": "ba72dda3746b978c61732831eb181014f590641e",
            "filename": "third_party/xla/xla/mlir_hlo/transforms/bufferize.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/10d9440888f6a50931bc50830c6584804439ee88/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftransforms%2Fbufferize.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/10d9440888f6a50931bc50830c6584804439ee88/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftransforms%2Fbufferize.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftransforms%2Fbufferize.cc?ref=10d9440888f6a50931bc50830c6584804439ee88",
            "patch": "@@ -127,11 +127,11 @@ struct BufferizeAndConvertMinimumBroadcastShapesOp\n       // We assume the buffer will be small, so we allocate it on the stack.\n       // TODO(b/181654096): Replace AllocaOp with AllocOp.\n       auto result = lb.create<memref::AllocaOp>(resultType, ranks[i]);\n-      lb.create<scf::ForOp>(zero, ranks[i], one, std::nullopt,\n-                            [&one, &result](OpBuilder &b, Location l, Value idx,\n+      lb.create<scf::ForOp>(zero, ranks[i], one, mlir::ValueRange(),\n+                            [&one, &result](OpBuilder& b, Location l, Value idx,\n                                             ValueRange /*vr*/) {\n                               b.create<memref::StoreOp>(l, one, result, idx);\n-                              b.create<scf::YieldOp>(l, std::nullopt);\n+                              b.create<scf::YieldOp>(l, mlir::ValueRange());\n                             });\n       resultShapes.push_back(result);\n     }\n@@ -300,7 +300,8 @@ struct BufferizeAndConvertMinimumBroadcastShapesOp\n                                    b.create<memref::StoreOp>(l, outputSize,\n                                                              resultShapes[i],\n                                                              outputDimension);\n-                                   b.create<scf::YieldOp>(l, std::nullopt);\n+                                   b.create<scf::YieldOp>(l,\n+                                                          mlir::ValueRange());\n                                  });\n                            }\n                            b.create<scf::YieldOp>(l, newDimensionOffset);\n@@ -380,12 +381,12 @@ struct BufferizeAndConvertMinimumBroadcastShapesOp\n     Value zero = lb.create<arith::ConstantIndexOp>(0);\n     Value one = lb.create<arith::ConstantIndexOp>(1);\n     lb.create<scf::ForOp>(\n-        zero, newRank, one, std::nullopt,\n-        [&](OpBuilder &b, Location l, Value idx, ValueRange /*vr*/) {\n+        zero, newRank, one, mlir::ValueRange(),\n+        [&](OpBuilder& b, Location l, Value idx, ValueRange /*vr*/) {\n           Value idxWithOffset = b.create<arith::AddIOp>(l, idx, leadingOnes);\n           auto size = b.create<memref::LoadOp>(l, extentMemref, idxWithOffset);\n           b.create<memref::StoreOp>(l, size, result, idx);\n-          b.create<scf::YieldOp>(l, std::nullopt);\n+          b.create<scf::YieldOp>(l, mlir::ValueRange());\n         });\n     return result;\n   }"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 17,
        "deletions": 17
    }
}