{
    "author": "yuriivcs",
    "message": "Add Hermetic C++ Toolchains for Linux aarch64 builds.\n\nHermetic toolchains provide builds that are isolated from the host system, cutting down on unexpected dependencies and side effects.\n\nBy default, TF now builds for Linux aarch64 architectures using hermetic C++ toolchains. For non-hermetic builds, add the flag --config=clang_local. Cross-compilation on Linux x86_64 to Linux aarch64 still runs non-hermetically and will be updated after the next rules_ml_toolchain release.\n\nOpenMP changes are connected to Hermetic C++ because it uses the -nodefaultlibs flag, simply passing -fopenmp is insufficient. OpenMP's dependencies must be explicitly linked to ensure correct inclusion, as automatic linking is disabled.\n\nPiperOrigin-RevId: 843858303",
    "sha": "d4210972a899074f9bebd73f85803f40afdf0e8b",
    "files": [
        {
            "sha": "768289676da89a45aedd50d5700919138da1b6b8",
            "filename": ".bazelrc",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4210972a899074f9bebd73f85803f40afdf0e8b/.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4210972a899074f9bebd73f85803f40afdf0e8b/.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/.bazelrc?ref=d4210972a899074f9bebd73f85803f40afdf0e8b",
            "patch": "@@ -285,6 +285,7 @@ common:mkl_threadpool -c opt\n # Config setting to build oneDNN with Compute Library for the Arm Architecture (ACL).\n # with Eigen threadpool support\n common:mkl_aarch64_threadpool --define=build_with_mkl_aarch64=true\n+common:mkl_aarch64_threadpool --@compute_library//:openmp=false\n common:mkl_aarch64_threadpool -c opt\n \n # This is an alias for the mkl_aarch64_threadpool build.\n@@ -297,7 +298,6 @@ common:cuda_version --repo_env=HERMETIC_NVSHMEM_VERSION=\"3.2.5\"\n \n # CUDA: This config refers to building CUDA op kernels with nvcc.\n common:cuda --repo_env TF_NEED_CUDA=1\n-common:cuda --crosstool_top=@local_config_cuda//crosstool:toolchain\n common:cuda --@local_config_cuda//:enable_cuda\n common:cuda --config=cuda_version\n # This flag is needed to include CUDA libraries.\n@@ -332,8 +332,6 @@ common:cuda_clang --linkopt=\"-lm\"\n # Set up compilation CUDA version and paths and use the CUDA Clang toolchain.\n common:cuda_clang_official --config=cuda_clang\n common:cuda_clang_official --config=cuda_version\n-common:cuda_clang_official --action_env=CLANG_CUDA_COMPILER_PATH=\"/usr/lib/llvm-18/bin/clang\"\n-common:cuda_clang_official --crosstool_top=\"@local_config_cuda//crosstool:toolchain\"\n \n # Build with nvcc for CUDA and clang for host\n common:cuda_nvcc --config=cuda\n@@ -763,14 +761,18 @@ common:release_gpu_linux_clang_local --config=release_cpu_linux_clang_local\n \n common:release_arm64_linux --config=release_linux_base\n common:release_arm64_linux --config=linux_arm64\n-common:release_arm64_linux --config=clang_local\n-common:release_arm64_linux --repo_env=CC=\"/usr/lib/llvm-18/bin/clang\"\n-common:release_arm64_linux --repo_env=BAZEL_COMPILER=\"/usr/lib/llvm-18/bin/clang\"\n-common:release_arm64_linux --crosstool_top=\"@ml2014_clang_aarch64_config_aarch64//crosstool:toolchain\"\n common:release_arm64_linux --config=mkl_aarch64_threadpool\n common:release_arm64_linux --copt=-flax-vector-conversions\n test:release_arm64_linux --flaky_test_attempts=3\n \n+# Deprecated release CPU config with non-hermetic toolchains.\n+common:release_arm64_linux_clang_local --config=release_arm64_linux\n+common:release_arm64_linux_clang_local --config=clang_local\n+common:release_arm64_linux_clang_local --repo_env=CC=\"/usr/lib/llvm-18/bin/clang\"\n+common:release_arm64_linux_clang_local --repo_env=BAZEL_COMPILER=\"/usr/lib/llvm-18/bin/clang\"\n+common:release_arm64_linux_clang_local --crosstool_top=\"@ml2014_clang_aarch64_config_aarch64//crosstool:toolchain\"\n+test:release_arm64_linux_clang_local --flaky_test_attempts=3\n+\n common:release_cpu_macos --config=avx_linux\n \n # Base build configs for macOS"
        },
        {
            "sha": "a334cf6080074aca4683e83388e4a9cf59658423",
            "filename": "WORKSPACE",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4210972a899074f9bebd73f85803f40afdf0e8b/WORKSPACE",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4210972a899074f9bebd73f85803f40afdf0e8b/WORKSPACE",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/WORKSPACE?ref=d4210972a899074f9bebd73f85803f40afdf0e8b",
            "patch": "@@ -21,10 +21,10 @@ tf_http_archive(\n # Details: https://github.com/google-ml-infra/rules_ml_toolchain\n tf_http_archive(\n     name = \"rules_ml_toolchain\",\n-    sha256 = \"7f00b3e94bbca1a4737ded6b9ed5358f6d1c86430c2ec97c90081343c0482f18\",\n-    strip_prefix = \"rules_ml_toolchain-29d54c875da37e74b8548924ed30e78cb28126b9\",\n+    sha256 = \"1a911c79fc734c39538781a7a4672b06aab8354c1ddb985c98e3df78f430bcde\",\n+    strip_prefix = \"rules_ml_toolchain-f13852164b6fe240f8a989a744221a51e0d485cd\",\n     urls = tf_mirror_urls(\n-        \"https://github.com/yuriivcs/rules_ml_toolchain/archive/29d54c875da37e74b8548924ed30e78cb28126b9.tar.gz\",\n+        \"https://github.com/google-ml-infra/rules_ml_toolchain/archive/f13852164b6fe240f8a989a744221a51e0d485cd.tar.gz\",\n     ),\n )\n "
        },
        {
            "sha": "9c312f132a4a2f4199db4f628ca0a170fa545eee",
            "filename": "ci/official/envs/linux_arm64",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4210972a899074f9bebd73f85803f40afdf0e8b/ci%2Fofficial%2Fenvs%2Flinux_arm64",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4210972a899074f9bebd73f85803f40afdf0e8b/ci%2Fofficial%2Fenvs%2Flinux_arm64",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fenvs%2Flinux_arm64?ref=d4210972a899074f9bebd73f85803f40afdf0e8b",
            "patch": "@@ -26,7 +26,7 @@ TFCI_INDEX_HTML_ENABLE=1\n TFCI_LIB_SUFFIX=\"-cpu-linux-arm64\"\n TFCI_OUTPUT_DIR=build_output\n TFCI_WHL_AUDIT_ENABLE=1\n-TFCI_WHL_AUDIT_PLAT=manylinux2014_aarch64\n+TFCI_WHL_AUDIT_PLAT=manylinux_2_27_aarch64\n TFCI_WHL_BAZEL_TEST_ENABLE=1\n TFCI_WHL_SIZE_LIMIT=275M\n TFCI_WHL_SIZE_LIMIT_ENABLE=1"
        },
        {
            "sha": "8a38b8146a1fd0f4b6b07e453d44ca5154698a46",
            "filename": "tensorflow/tools/pip_package/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d4210972a899074f9bebd73f85803f40afdf0e8b/tensorflow%2Ftools%2Fpip_package%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d4210972a899074f9bebd73f85803f40afdf0e8b/tensorflow%2Ftools%2Fpip_package%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Ftools%2Fpip_package%2FBUILD?ref=d4210972a899074f9bebd73f85803f40afdf0e8b",
            "patch": "@@ -441,7 +441,7 @@ py_test(\n \n verify_manylinux_compliance_test(\n     name = \"manylinux_compliance_test\",\n-    aarch64_compliance_tag = \"manylinux_2_17_aarch64\",\n+    aarch64_compliance_tag = \"manylinux_2_27_aarch64\",\n     ppc64le_compliance_tag = \"manylinux_2_17_ppc64le\",\n     test_tags = [\n         \"manual\","
        }
    ],
    "stats": {
        "total": 26,
        "additions": 14,
        "deletions": 12
    }
}