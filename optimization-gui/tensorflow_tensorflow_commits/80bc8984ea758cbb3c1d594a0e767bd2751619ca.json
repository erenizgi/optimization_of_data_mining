{
    "author": "boomanaiden154",
    "message": "Use triple overload of lookupTarget\n\nThe overload accepting a llvm::StringRef will be removed when LLVM 22 branches.\n\nPiperOrigin-RevId: 818460238",
    "sha": "80bc8984ea758cbb3c1d594a0e767bd2751619ca",
    "files": [
        {
            "sha": "b56ca80e26e8752ff682d7b39326c86d1c77caf5",
            "filename": "tensorflow/compiler/aot/embedded_constant_buffers.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/tensorflow%2Fcompiler%2Faot%2Fembedded_constant_buffers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/tensorflow%2Fcompiler%2Faot%2Fembedded_constant_buffers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Faot%2Fembedded_constant_buffers.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -118,8 +118,8 @@ static absl::StatusOr<std::string> CodegenModule(\n static absl::StatusOr<std::unique_ptr<llvm::TargetMachine>>\n GetTargetMachineFromTriple(absl::string_view target_triple) {\n   std::string error;\n-  std::string normalized_triple =\n-      llvm::Triple::normalize(AsStringRef(absl::string_view(target_triple)));\n+  llvm::Triple normalized_triple(\n+      llvm::Triple::normalize(AsStringRef(absl::string_view(target_triple))));\n   const llvm::Target* target =\n       llvm::TargetRegistry::lookupTarget(normalized_triple, error);\n   if (target == nullptr) {\n@@ -128,7 +128,7 @@ GetTargetMachineFromTriple(absl::string_view target_triple) {\n   }\n \n   return absl::WrapUnique(target->createTargetMachine(\n-      llvm::Triple(normalized_triple), /*CPU=*/\"\",\n+      normalized_triple, /*CPU=*/\"\",\n       /*Features=*/\"\", llvm::TargetOptions(), std::nullopt));\n }\n "
        },
        {
            "sha": "b6a6e4cfc2c8d948f644f2c808333e5d7528e775",
            "filename": "tensorflow/compiler/aot/embedded_protocol_buffers.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/tensorflow%2Fcompiler%2Faot%2Fembedded_protocol_buffers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/tensorflow%2Fcompiler%2Faot%2Fembedded_protocol_buffers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Faot%2Fembedded_protocol_buffers.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -97,8 +97,8 @@ static absl::StatusOr<string> CodegenModule(\n static absl::StatusOr<std::unique_ptr<llvm::TargetMachine>>\n GetTargetMachineFromTriple(absl::string_view target_triple) {\n   std::string error;\n-  std::string normalized_triple =\n-      llvm::Triple::normalize(AsStringRef(absl::string_view(target_triple)));\n+  llvm::Triple normalized_triple(\n+      llvm::Triple::normalize(AsStringRef(absl::string_view(target_triple))));\n   const llvm::Target* target =\n       llvm::TargetRegistry::lookupTarget(normalized_triple, error);\n   if (target == nullptr) {\n@@ -107,7 +107,7 @@ GetTargetMachineFromTriple(absl::string_view target_triple) {\n   }\n \n   return absl::WrapUnique(target->createTargetMachine(\n-      llvm::Triple(normalized_triple), /*CPU=*/\"\",\n+      normalized_triple, /*CPU=*/\"\",\n       /*Features=*/\"\", llvm::TargetOptions(), std::nullopt));\n }\n "
        },
        {
            "sha": "1e3d407fa4699ec042a1ff1de159c5b07e9eb62e",
            "filename": "third_party/xla/xla/backends/cpu/codegen/ir_compiler_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fir_compiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fir_compiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fir_compiler_test.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -182,15 +182,16 @@ TEST(IrCompilerTest, TestAdditionalFeatures) {\n     absl::string_view features = has_avx512 ? \"+avx512f\" : \"-avx512f\";\n     absl::string_view triple = \"x86_64-unknown-linux-gnu\";\n     std::string error;\n+    llvm::Triple target_triple((llvm::StringRef(triple)));\n     const llvm::Target* target =\n-        llvm::TargetRegistry::lookupTarget(triple, error);\n+        llvm::TargetRegistry::lookupTarget(target_triple, error);\n     if (target == nullptr) {\n       return absl::InternalError(\"Failed to lookup target: \" + error);\n     }\n \n     llvm::TargetOptions target_options;\n     return absl::WrapUnique(target->createTargetMachine(\n-        llvm::Triple(llvm::Twine(triple)), cpu_name, features, target_options,\n+        target_triple, cpu_name, features, target_options,\n         /*RM=*/std::nullopt));\n   };\n "
        },
        {
            "sha": "e646f7735a9b6f5687077aed3ee48dff48bf8500",
            "filename": "third_party/xla/xla/backends/cpu/codegen/target_machine_test_base.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Ftarget_machine_test_base.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Ftarget_machine_test_base.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Ftarget_machine_test_base.h?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -48,15 +48,15 @@ class TargetMachineTestBase : public HloHardwareIndependentTestBase {\n   std::unique_ptr<llvm::TargetMachine> CreateTargetMachine(\n       absl::string_view triple_string, absl::string_view cpu_name,\n       absl::string_view features) {\n+    llvm::Twine triple_twine(triple_string);\n+    llvm::Triple triple(triple_twine);\n     std::string error;\n     const llvm::Target* target =\n-        llvm::TargetRegistry::lookupTarget(triple_string, error);\n+        llvm::TargetRegistry::lookupTarget(triple, error);\n     if (target == nullptr) {\n       LOG(ERROR) << \"Failed to lookup target: \" << error;\n     }\n \n-    llvm::Twine triple_twine(triple_string);\n-    llvm::Triple triple(triple_twine);\n     llvm::TargetOptions target_options;\n     return absl::WrapUnique(target->createTargetMachine(\n         triple, cpu_name, features, target_options, /*RM=*/std::nullopt));"
        },
        {
            "sha": "a1054d2e8b2d667b1445ae45563b185c990e236e",
            "filename": "third_party/xla/xla/codegen/intrinsic/simple_jit_runner.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fsimple_jit_runner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fsimple_jit_runner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fsimple_jit_runner.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -238,12 +238,12 @@ llvm::Expected<void*> JitRunner::CreateVectorWrapperWithLoop(\n \n std::unique_ptr<llvm::TargetMachine> CreateHostTargetMachine() {\n   initializeNativeTargets();\n-  const std::string triple = llvm::sys::getDefaultTargetTriple();\n+  const llvm::Triple triple(llvm::sys::getDefaultTargetTriple());\n   llvm::StringRef cpu = llvm::sys::getHostCPUName();\n   llvm::StringMap<bool> features = llvm::sys::getHostCPUFeatures();\n   std::string errors = \"\";\n   const llvm::Target* target =\n-      llvm::TargetRegistry::lookupTarget(llvm::StringRef(triple), errors);\n+      llvm::TargetRegistry::lookupTarget(triple, errors);\n   LOG_IF(FATAL, !target) << \"Failed to lookup target: \" << errors;\n   std::string feature_str;\n   for (const auto& [feature, value] : features) {\n@@ -253,8 +253,8 @@ std::unique_ptr<llvm::TargetMachine> CreateHostTargetMachine() {\n   }\n   llvm::TargetOptions target_options;\n   std::unique_ptr<llvm::TargetMachine> target_machine(\n-      target->createTargetMachine(llvm::Triple(triple), cpu, feature_str,\n-                                  target_options, std::nullopt, std::nullopt));\n+      target->createTargetMachine(triple, cpu, feature_str, target_options,\n+                                  std::nullopt, std::nullopt));\n   LOG_IF(FATAL, !target_machine) << \"Failed to create target machine\";\n   return target_machine;\n }"
        },
        {
            "sha": "bbebba2c8bb55402b63c1201e9eda712505472d7",
            "filename": "third_party/xla/xla/service/cpu/cpu_compiler.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -2048,7 +2048,7 @@ CpuCompiler::CompileAheadOfTime(std::unique_ptr<HloModule> hlo_module,\n   llvm::Triple triple(llvm::Triple::normalize(options.triple()));\n   std::string error;\n   const llvm::Target* target =\n-      llvm::TargetRegistry::lookupTarget(triple.getTriple(), error);\n+      llvm::TargetRegistry::lookupTarget(triple, error);\n   if (target == nullptr) {\n     return Internal(\"TargetRegistry::lookupTarget failed: %s\", error);\n   }"
        },
        {
            "sha": "23a21b04905d921852a54bba0a088897004f67ef",
            "filename": "third_party/xla/xla/service/cpu/vectorized_reduce_with_no_vector_registers_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fvectorized_reduce_with_no_vector_registers_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/80bc8984ea758cbb3c1d594a0e767bd2751619ca/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fvectorized_reduce_with_no_vector_registers_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fvectorized_reduce_with_no_vector_registers_test.cc?ref=80bc8984ea758cbb3c1d594a0e767bd2751619ca",
            "patch": "@@ -50,9 +50,10 @@ absl::StatusOr<unsigned int> GetTargetVectorRegisterByteSize(\n   // Unfortunately we need a lot of boilerplate to get to an\n   // llvm::TargetMachine.\n \n+  llvm::Triple target_triple(triple);\n   std::string error;\n   const llvm::Target* target =\n-      llvm::TargetRegistry::lookupTarget(triple, error);\n+      llvm::TargetRegistry::lookupTarget(target_triple, error);\n   if (target == nullptr) {\n     return Internal(\"TargetRegistry::lookupTarget failed: %s\", error);\n   }\n@@ -65,7 +66,7 @@ absl::StatusOr<unsigned int> GetTargetVectorRegisterByteSize(\n \n   std::unique_ptr<llvm::TargetMachine> target_machine =\n       absl::WrapUnique(target->createTargetMachine(\n-          /*TT=*/llvm::Triple(triple), /*CPU=*/\"\", /*Features=*/\"\",\n+          /*TT=*/target_triple, /*CPU=*/\"\", /*Features=*/\"\",\n           llvm::TargetOptions{},\n           /*RM=*/std::nullopt));\n   cpu::TargetMachineFeatures target_machine_features(target_machine.get());"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 20,
        "deletions": 18
    }
}