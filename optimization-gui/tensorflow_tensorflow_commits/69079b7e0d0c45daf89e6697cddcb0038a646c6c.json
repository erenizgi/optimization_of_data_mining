{
    "author": "mrry",
    "message": "Add flag `enable_fatal_error_on_collective_abort`.\n\nPiperOrigin-RevId: 822315284",
    "sha": "69079b7e0d0c45daf89e6697cddcb0038a646c6c",
    "files": [
        {
            "sha": "d3a09e7bbace691709b28cb36e6115140be06240",
            "filename": "tensorflow/core/common_runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fcommon_runtime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fcommon_runtime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2FBUILD?ref=69079b7e0d0c45daf89e6697cddcb0038a646c6c",
            "patch": "@@ -375,6 +375,7 @@ cc_library(\n         \"//tensorflow/core:lib\",\n         \"//tensorflow/core:lib_internal\",\n         \"//tensorflow/core:protos_all_cc\",\n+        \"//tensorflow/core/config:flag_defs\",\n         \"//tensorflow/core/profiler/lib:connected_traceme\",\n         \"//tensorflow/core/profiler/lib:scoped_memory_debug_annotation\",\n         \"//tensorflow/core/profiler/lib:traceme\","
        },
        {
            "sha": "04cbf66e8095f8324e31b304a4680ee0c328ba12",
            "filename": "tensorflow/core/common_runtime/base_collective_executor.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fcommon_runtime%2Fbase_collective_executor.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fcommon_runtime%2Fbase_collective_executor.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Fbase_collective_executor.cc?ref=69079b7e0d0c45daf89e6697cddcb0038a646c6c",
            "patch": "@@ -22,6 +22,7 @@ limitations under the License.\n #include \"tensorflow/core/common_runtime/device_mgr.h\"\n #include \"tensorflow/core/common_runtime/dma_helper.h\"\n #include \"tensorflow/core/common_runtime/process_util.h\"\n+#include \"tensorflow/core/config/flag_defs.h\"\n #include \"tensorflow/core/framework/allocator.h\"\n #include \"tensorflow/core/framework/cancellation.h\"\n #include \"tensorflow/core/framework/op_kernel.h\"\n@@ -229,6 +230,9 @@ CollectiveAdapter* MakeCollectiveAdapter(Tensor* output, int num_chunks,\n BaseCollectiveExecutor::~BaseCollectiveExecutor() {}\n \n void BaseCollectiveExecutor::StartAbort(const absl::Status& s) {\n+  if (flags::Global().enable_fatal_error_on_collective_abort.value()) {\n+    LOG(FATAL) << \"BaseCollectiveExecutor::StartAbort: \" << s;\n+  }\n   absl::Status status;\n   {\n     mutex_lock l(status_mu_);"
        },
        {
            "sha": "f257876ad907adbef3e3b86d2e1e747920e53798",
            "filename": "tensorflow/core/config/flag_defs.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fconfig%2Fflag_defs.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fconfig%2Fflag_defs.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fconfig%2Fflag_defs.h?ref=69079b7e0d0c45daf89e6697cddcb0038a646c6c",
            "patch": "@@ -69,6 +69,9 @@ class Flags {\n                   \"graphs.\")\n   TF_DECLARE_FLAG(enable_graph_debug_info_caching_for_stack_frames, true,\n                   \"If true, graph debug info will cache the stack frames.\")\n+  TF_DECLARE_FLAG(\n+      enable_fatal_error_on_collective_abort, false,\n+      \"If true, a fatal error will be raised when a collective is aborted.\")\n   // LINT.ThenChange(//tensorflow/core/config/flags_api_wrapper.cc)\n };\n "
        },
        {
            "sha": "13b3fcb0d135bf0819edf5921b177203f8c445f3",
            "filename": "tensorflow/core/config/flags_api_wrapper.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fconfig%2Fflags_api_wrapper.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fcore%2Fconfig%2Fflags_api_wrapper.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fconfig%2Fflags_api_wrapper.cc?ref=69079b7e0d0c45daf89e6697cddcb0038a646c6c",
            "patch": "@@ -56,5 +56,6 @@ PYBIND11_MODULE(flags_pybind, m) {\n   TF_PY_DECLARE_FLAG(enable_function_pruning_before_inlining)\n   TF_PY_DECLARE_FLAG(enable_skip_encapsulation_for_non_tpu_graphs)\n   TF_PY_DECLARE_FLAG(enable_graph_debug_info_caching_for_stack_frames)\n+  TF_PY_DECLARE_FLAG(enable_fatal_error_on_collective_abort)\n   // LINT.ThenChange(//tensorflow/core/config/flag_defs.h)\n };"
        },
        {
            "sha": "837ba6ec259354ffec95e57ea1621abbc62f5c91",
            "filename": "tensorflow/python/flags_pybind.pyi",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fpython%2Fflags_pybind.pyi",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/69079b7e0d0c45daf89e6697cddcb0038a646c6c/tensorflow%2Fpython%2Fflags_pybind.pyi",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fflags_pybind.pyi?ref=69079b7e0d0c45daf89e6697cddcb0038a646c6c",
            "patch": "@@ -21,6 +21,7 @@ class Flag:\n class Flags:\n     enable_aggressive_constant_replication: Flag\n     enable_colocation_key_propagation_in_while_op_lowering: Flag\n+    enable_fatal_error_on_collective_abort: Flag\n     enable_function_pruning_before_inlining: Flag\n     enable_graph_debug_info_caching_for_stack_frames: Flag\n     enable_nested_function_shape_inference: Flag"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 10,
        "deletions": 0
    }
}