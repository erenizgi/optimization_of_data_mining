{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Add option to skip precomputing instruction dependencies in hlo diff.\n\nPiperOrigin-RevId: 839922313",
    "sha": "a962a5ce8bb55e39889067c454d095ad57715dbd",
    "files": [
        {
            "sha": "6b5167230860e06b49292d214afd3c83e196205f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2FBUILD?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -136,8 +136,6 @@ cc_library(\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n-        \"@com_google_absl//absl/strings:string_view\",\n-        \"@com_google_absl//absl/types:span\",\n     ],\n )\n "
        },
        {
            "sha": "f09f69fe9124c75905d47fb361fa6c65d72509d1",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/graph/hlo_gumgraph.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -363,7 +363,8 @@ void HloGumgraph::PrecomputeInstructionDependencies() {\n \n absl::StatusOr<std::unique_ptr<const HloGumgraph>> HloGumgraph::Create(\n     const HloModule* absl_nonnull hlo_module,\n-    const HloGumgraphFingerprintOptions& fingerprint_options) {\n+    const HloGumgraphFingerprintOptions& fingerprint_options,\n+    bool precompute_instruction_dependencies) {\n   CHECK(hlo_module != nullptr) << \"Expected a non-null hlo module\";\n   CHECK(hlo_module->entry_computation() != nullptr)\n       << \"Expected a non-null entry computation\";\n@@ -383,7 +384,9 @@ absl::StatusOr<std::unique_ptr<const HloGumgraph>> HloGumgraph::Create(\n   }\n   graph->PrecomputeSizeAndHeight();\n   TF_RETURN_IF_ERROR(graph->PrecomputeComputationFingerprint());\n-  graph->PrecomputeInstructionDependencies();\n+  if (precompute_instruction_dependencies) {\n+    graph->PrecomputeInstructionDependencies();\n+  }\n \n   return graph;\n };"
        },
        {
            "sha": "8134b24539dbae9b298eb8604edf2fe14cbe0a2a",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/graph/hlo_gumgraph.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.h?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -54,7 +54,8 @@ class HloGumgraph {\n   // various graph properties such as height, siblings per node etc.\n   static absl::StatusOr<std::unique_ptr<const HloGumgraph>> Create(\n       const HloModule* absl_nonnull hlo_module,\n-      const HloGumgraphFingerprintOptions& fingerprint_options = {});\n+      const HloGumgraphFingerprintOptions& fingerprint_options = {},\n+      bool precompute_instruction_dependencies = true);\n \n   // HloGumgraph is neither copyable nor movable as it can be really large.\n   HloGumgraph(const HloGumgraph&) = delete;"
        },
        {
            "sha": "d7aec6c9ef29c4b0384ae7463ba55fb0e0b79bc0",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_main.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_main.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_main.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_main.cc?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -250,6 +250,9 @@ int main(int argc, char** argv) {\n           \"ignore_shape\", &opts.diff_options.fingerprint_options.ignore_shape,\n           \"If true, ignore array/tensor shapes when matching instructions \"\n           \"and reporting diffs.\"),\n+      tsl::Flag(\"precompute_instruction_dependencies\",\n+                &opts.diff_options.precompute_instruction_dependencies,\n+                \"If true, precompute instruction dependencies.\"),\n       tsl::Flag(\"text_output\", &opts.render_options.text_output,\n                 \"file to save diff blocks as text\"),\n       tsl::Flag(\"html_output\", &opts.render_options.html_output,\n@@ -258,8 +261,8 @@ int main(int argc, char** argv) {\n   };\n \n   std::string usage = tsl::Flags::Usage(argv[0], flag_list);\n-  bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   tsl::port::InitMain(xla::hlo_diff::kUsage, &argc, &argv);\n+  bool parse_ok = tsl::Flags::Parse(&argc, argv, flag_list);\n   LOG_IF(QFATAL, argc != 1 || !parse_ok || need_help) << usage;\n   xla::hlo_diff::RealMain(opts);\n   return 0;"
        },
        {
            "sha": "cc1793f79bd1cac73abfe1ffac9ff5520d098d2c",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_gumgraph_diff.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.cc?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -99,15 +99,19 @@ absl::StatusOr<HloGumgraphDiffResults> ComputeDiff(const HloModule& left,\n                                                    const HloModule& right,\n                                                    const DiffOptions& options) {\n   LOG(INFO) << \"Initializing left module graph\";\n-  TF_ASSIGN_OR_RETURN(std::unique_ptr<const HloGumgraph> left_graph,\n-                      HloGumgraph::Create(&left, options.fingerprint_options));\n+  TF_ASSIGN_OR_RETURN(\n+      std::unique_ptr<const HloGumgraph> left_graph,\n+      HloGumgraph::Create(&left, options.fingerprint_options,\n+                          options.precompute_instruction_dependencies));\n   LOG(INFO) << \"Initialized left module graph of size: \"\n             << left_graph->GetNodeCount()\n             << \" and height: \" << left_graph->GetRoot().props.height;\n \n   LOG(INFO) << \"Initializing right module graph\";\n-  TF_ASSIGN_OR_RETURN(std::unique_ptr<const HloGumgraph> right_graph,\n-                      HloGumgraph::Create(&right, options.fingerprint_options));\n+  TF_ASSIGN_OR_RETURN(\n+      std::unique_ptr<const HloGumgraph> right_graph,\n+      HloGumgraph::Create(&right, options.fingerprint_options,\n+                          options.precompute_instruction_dependencies));\n   LOG(INFO) << \"Initialized right module graph of size: \"\n             << right_graph->GetNodeCount()\n             << \" and height: \" << right_graph->GetRoot().props.height;"
        },
        {
            "sha": "c21fefb9e7ef89eb3d3c2452e365172d1191a23b",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_gumgraph_diff.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a962a5ce8bb55e39889067c454d095ad57715dbd/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_gumgraph_diff.h?ref=a962a5ce8bb55e39889067c454d095ad57715dbd",
            "patch": "@@ -39,6 +39,7 @@ struct DiffOptions {\n   MatchOptions match_options;\n   bool run_eval = false;\n   std::vector<std::pair<std::string, std::string>> manual_mappings;\n+  bool precompute_instruction_dependencies = true;\n };\n \n struct HloGumgraphDiffResults {"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 20,
        "deletions": 10
    }
}