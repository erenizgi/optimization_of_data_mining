{
    "author": "ezhulenev",
    "message": "[xla:pjrt] Migtate PjRt CPU client to xla::Future and xla::Promise\n\nPiperOrigin-RevId: 811536660",
    "sha": "c12a0d2be571b7159213f89868e2777f6831f159",
    "files": [
        {
            "sha": "52ded8680418fc87b8ad9e67f05a837c92d7c99c",
            "filename": "third_party/xla/xla/pjrt/cpu/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -53,6 +53,7 @@ cc_library(\n     deps = [\n         \":cpu_event\",\n         \"//xla:cpu_function_runtime\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla:shape_tree\",\n         \"//xla:shape_util\",\n@@ -64,7 +65,6 @@ cc_library(\n         \"//xla/pjrt:common_pjrt_client\",\n         \"//xla/pjrt:device_event\",\n         \"//xla/pjrt:pjrt_client\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt:raw_buffer\",\n         \"//xla/pjrt:transpose\",\n         \"//xla/pjrt:utils\",\n@@ -105,6 +105,7 @@ cc_library(\n     deps = [\n         \":cpu_async_execution_tracker\",\n         \":execution_stream_event_map\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla/pjrt:host_memory_spaces\",\n         \"//xla/pjrt:pjrt_client\",\n@@ -145,6 +146,7 @@ cc_library(\n         \"//xla:array\",\n         \"//xla:debug_options_flags\",\n         \"//xla:executable_run_options\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n@@ -175,7 +177,6 @@ cc_library(\n         \"//xla/pjrt:pjrt_common\",\n         \"//xla/pjrt:pjrt_compiler\",\n         \"//xla/pjrt:pjrt_executable\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt:raw_buffer\",\n         \"//xla/pjrt:semaphore\",\n         \"//xla/pjrt:thread_pool_async_work_runner\","
        },
        {
            "sha": "fbe93bd5d1dbc201cd8bb63ed3e9837ac77ce15e",
            "filename": "third_party/xla/xla/pjrt/cpu/abstract_cpu_buffer.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.cc?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -44,7 +44,6 @@ limitations under the License.\n #include \"xla/pjrt/cpu/raw_buffer.h\"\n #include \"xla/pjrt/cpu/tracked_cpu_device_buffer.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/pjrt/utils.h\"\n #include \"xla/primitive_util.h\""
        },
        {
            "sha": "bd1f5fb57980757c5ffa53c71ebf0152c5d47ede",
            "filename": "third_party/xla/xla/pjrt/cpu/abstract_cpu_buffer.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fabstract_cpu_buffer.h?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -41,7 +41,6 @@ limitations under the License.\n #include \"xla/pjrt/cpu/cpu_event.h\"\n #include \"xla/pjrt/cpu/tracked_cpu_device_buffer.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/shape.h\"\n #include \"xla/tsl/concurrency/async_value.h\"\n@@ -94,7 +93,7 @@ class AbstractCpuBuffer {\n       absl::InlinedVector<tsl::RCReference<tsl::AsyncValue>, 4>* avs,\n       absl::InlinedVector<tsl::AsyncValueRef<CpuEvent>, 4>* definition_events);\n \n-  // A helper function to determine if a BufferFromHostBuffer call is elligable\n+  // A helper function to determine if a BufferFromHostBuffer call is eligible\n   // for zero copy construction.\n   static bool BufferFromHostBufferSupportsZeroCopy(\n       const void* data, PrimitiveType type, absl::Span<int64_t const> dims,"
        },
        {
            "sha": "104c0687c444d3c9163fa43a2149e7fcea6fb96a",
            "filename": "third_party/xla/xla/pjrt/cpu/cpu_client.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -56,6 +56,7 @@ limitations under the License.\n #include \"xla/client/executable_build_options.h\"\n #include \"xla/debug_options_flags.h\"\n #include \"xla/executable_run_options.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n@@ -84,7 +85,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_client_options.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_execute_options.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_memory.h\"\n@@ -1904,7 +1904,7 @@ absl::StatusOr<PjRtLoadedExecutable::Result> PjRtCpuExecutable::ExecuteHelper(\n   }\n \n   if (fill_future) {\n-    auto [promise, future] = PjRtFuture<>::MakePromise();\n+    auto [promise, future] = Future<>::MakePromise();\n     execute_event.AndThen([promise = std::move(promise),\n                            event = execute_event.CopyRef()]() mutable {\n       if (auto* error = event.GetErrorIfPresent()) {\n@@ -1960,7 +1960,7 @@ absl::StatusOr<std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>>\n PjRtCpuExecutable::Execute(\n     absl::Span<const std::vector<PjRtBuffer*>> argument_handles,\n     const ExecuteOptions& options,\n-    std::optional<std::vector<PjRtFuture<>>>& returned_futures) const {\n+    std::optional<std::vector<Future<>>>& returned_futures) const {\n   RunId run_id(options.launch_id);\n   tsl::profiler::TraceMe trace_me(\"PjRtCpuExecutable::Execute\");\n   if (!options.untuple_result && cpu_executable_->module()\n@@ -2097,7 +2097,7 @@ PjRtCpuExecutable::Execute(\n absl::StatusOr<std::vector<std::unique_ptr<PjRtBuffer>>>\n PjRtCpuExecutable::ExecuteSharded(\n     absl::Span<PjRtBuffer* const> argument_handles, PjRtDevice* device,\n-    const ExecuteOptions& options, std::optional<PjRtFuture<>>& returned_future,\n+    const ExecuteOptions& options, std::optional<Future<>>& returned_future,\n     bool fill_future) const {\n   RunId run_id(options.launch_id);\n   tsl::profiler::TraceMe trace_me(\"PjRtCpuExecutable::ExecuteSharded\");\n@@ -2136,7 +2136,7 @@ PjRtCpuExecutable::ExecuteSharded(\n absl::StatusOr<std::vector<std::unique_ptr<PjRtBuffer>>>\n PjRtCpuExecutable::ExecutePortable(\n     absl::Span<PjRtBuffer* const> argument_handles, PjRtDevice* device,\n-    const ExecuteOptions& options, std::optional<PjRtFuture<>>& returned_future,\n+    const ExecuteOptions& options, std::optional<Future<>>& returned_future,\n     bool fill_future) const {\n   RunId run_id(options.launch_id);\n   tsl::profiler::TraceMe trace_me(\"PjRtCpuExecutable::ExecutePortable\");"
        },
        {
            "sha": "e520c8160c683dc00c3652bbf749518276a51bba",
            "filename": "third_party/xla/xla/pjrt/cpu/cpu_client.h",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.h?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -41,6 +41,7 @@ limitations under the License.\n #include \"mlir/IR/BuiltinOps.h\"\n #include \"xla/backends/cpu/collectives/cpu_collectives.h\"\n #include \"xla/executable_run_options.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/layout.h\"\n@@ -55,7 +56,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_client_options.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_topology_description.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n@@ -68,7 +68,6 @@ limitations under the License.\n #include \"xla/service/hlo_cost_analysis.h\"\n #include \"xla/service/hlo_module_config.h\"\n #include \"xla/shape.h\"\n-#include \"xla/tsl/concurrency/async_value.h\"\n #include \"xla/tsl/concurrency/async_value_ref.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/threadpool.h\"\n@@ -387,21 +386,18 @@ class PjRtCpuExecutable final : public PjRtLoadedExecutable {\n   absl::StatusOr<std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>> Execute(\n       absl::Span<const std::vector<PjRtBuffer*>> argument_handles,\n       const ExecuteOptions& options,\n-      std::optional<std::vector<PjRtFuture<>>>& returned_futures)\n-      const override;\n+      std::optional<std::vector<Future<>>>& returned_futures) const override;\n \n   using PjRtLoadedExecutable::ExecuteSharded;\n   absl::StatusOr<std::vector<std::unique_ptr<PjRtBuffer>>> ExecuteSharded(\n       absl::Span<PjRtBuffer* const> argument_handles, PjRtDevice* device,\n-      const ExecuteOptions& options,\n-      std::optional<PjRtFuture<>>& returned_future,\n+      const ExecuteOptions& options, std::optional<Future<>>& returned_future,\n       bool fill_future) const override;\n \n   using PjRtLoadedExecutable::ExecutePortable;\n   absl::StatusOr<std::vector<std::unique_ptr<PjRtBuffer>>> ExecutePortable(\n       absl::Span<PjRtBuffer* const> argument_handles, PjRtDevice* device,\n-      const ExecuteOptions& options,\n-      std::optional<PjRtFuture<>>& returned_future,\n+      const ExecuteOptions& options, std::optional<Future<>>& returned_future,\n       bool fill_future) const override;\n \n   void Delete() override;"
        },
        {
            "sha": "2de138d3761c011c2d348ec1510027498628bec6",
            "filename": "third_party/xla/xla/pjrt/cpu/raw_buffer.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.cc?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -34,7 +34,7 @@ limitations under the License.\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/types/span.h\"\n #include \"xla/backends/cpu/alignment.h\"\n-#include \"xla/cpu_function_runtime.h\"\n+#include \"xla/future.h\"\n #include \"xla/layout.h\"\n #include \"xla/layout_util.h\"\n #include \"xla/literal.h\"\n@@ -44,7 +44,6 @@ limitations under the License.\n #include \"xla/pjrt/cpu/tracked_cpu_device_buffer.h\"\n #include \"xla/pjrt/device_event.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/pjrt/utils.h\"\n@@ -76,8 +75,8 @@ void CpuTrackedDeviceEventPromise::SetReady() {\n   av_->ForwardTo(tsl::MakeAvailableAsyncValueRef<CpuEvent>());\n }\n \n-PjRtFuture<> CpuTrackedDeviceEvent::GetReadyFuture() {\n-  auto [promise, future] = PjRtFuture<>::MakePromise();\n+Future<> CpuTrackedDeviceEvent::GetReadyFuture() {\n+  auto [promise, future] = Future<>::MakePromise();\n   event_.AndThen([promise = std::move(promise), event = event_]() mutable {\n     if (auto* error = event.GetErrorIfPresent()) {\n       promise.Set(*error);\n@@ -86,17 +85,17 @@ PjRtFuture<> CpuTrackedDeviceEvent::GetReadyFuture() {\n     }\n   });\n \n-  return PjRtFutureHelpers::WithProfiling(\n+  return FutureHelpers::WithProfiling(\n       std::move(future),\n       /*on_block_start=*/\n       [callee_method = callee_method_, callee_type = callee_type_]() {\n         tsl::profiler::TraceMeProducer traceme(\n             [&] { return absl::StrCat(callee_type, \"::\", callee_method); });\n-        return PjRtFutureHelpers::ProfilingKeys({traceme.GetContextId()});\n+        return FutureHelpers::ProfilingKeys({traceme.GetContextId()});\n       },\n       /*on_block_end=*/\n       [callee_method = callee_method_,\n-       callee_type = callee_type_](PjRtFutureHelpers::ProfilingKeys keys) {\n+       callee_type = callee_type_](FutureHelpers::ProfilingKeys keys) {\n         tsl::profiler::TraceMeConsumer traceme(\n             [&] { return absl::StrCat(callee_type, \"::\", callee_method); },\n             keys.traceme_context_id);\n@@ -349,8 +348,7 @@ CpuRawBuffer::MakeAllocationReadyEvent() {\n }\n \n void CpuRawBuffer::CopyToLiteralAsync(\n-    PjRtFuture<>::Promise promise,\n-    tsl::RCReference<PjRtDeviceEventPromise> device_promise,\n+    Promise<> promise, tsl::RCReference<PjRtDeviceEventPromise> device_promise,\n     MutableLiteralBase* literal, xla::Shape shape) {\n   absl::Span<const char> input_span{\n       static_cast<const char*>(buffer_->untyped_data()), buffer_->size_bytes()};"
        },
        {
            "sha": "7eb565af70b6c9661d1cf0de5ccdf0b653d73607",
            "filename": "third_party/xla/xla/pjrt/cpu/raw_buffer.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fraw_buffer.h?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -27,14 +27,14 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/future.h\"\n #include \"xla/layout.h\"\n #include \"xla/literal.h\"\n #include \"xla/pjrt/async_work_runner.h\"\n #include \"xla/pjrt/cpu/cpu_event.h\"\n #include \"xla/pjrt/cpu/tracked_cpu_device_buffer.h\"\n #include \"xla/pjrt/device_event.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/tsl/concurrency/async_value.h\"\n@@ -80,7 +80,7 @@ class CpuTrackedDeviceEvent : public PjRtDeviceEvent {\n     return event_.GetAsyncValue();\n   }\n \n-  PjRtFuture<> GetReadyFuture() override;\n+  Future<> GetReadyFuture() override;\n \n  private:\n   tsl::AsyncValueRef<CpuEvent> event_;\n@@ -150,7 +150,7 @@ class CpuRawBuffer : public CommonPjRtRawBuffer {\n                         xla::Shape shape) override;\n \n   void CopyToLiteralAsync(\n-      PjRtFuture<>::Promise promise,\n+      Promise<> promise,\n       tsl::RCReference<PjRtDeviceEventPromise> device_promise,\n       MutableLiteralBase* literal, xla::Shape shape) override;\n "
        },
        {
            "sha": "f5691607e8d785557da3b5ae9f281b16208ac6b5",
            "filename": "third_party/xla/xla/pjrt/cpu/tracked_cpu_device_buffer.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.cc?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -29,12 +29,12 @@ limitations under the License.\n #include \"absl/strings/str_format.h\"\n #include \"absl/types/span.h\"\n #include \"xla/backends/cpu/alignment.h\"\n+#include \"xla/future.h\"\n #include \"xla/pjrt/common_pjrt_client.h\"\n #include \"xla/pjrt/cpu/cpu_event.h\"\n #include \"xla/pjrt/cpu/raw_buffer.h\"\n #include \"xla/pjrt/device_event.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/tsl/concurrency/async_value.h\"\n #include \"xla/tsl/concurrency/async_value_ref.h\"\n@@ -322,9 +322,8 @@ void TrackedCpuDeviceBuffer::Delete(PjRtMemorySpace* memory_space) {\n   });\n }\n \n-PjRtFuture<> TrackedCpuDeviceBuffer::GetReadyFuture(\n-    PjRtMemorySpace* memory_space) {\n-  auto [promise, future] = PjRtFuture<>::MakePromise();\n+Future<> TrackedCpuDeviceBuffer::GetReadyFuture(PjRtMemorySpace* memory_space) {\n+  auto [promise, future] = Future<>::MakePromise();\n \n   tensorflow::down_cast<CommonPjRtClient*>(memory_space->client())\n       ->TrackFuture(memory_space, \"BufferDefinitionEvent\", future);"
        },
        {
            "sha": "6b019eaf6a533d49157765d039ac19973b43eb70",
            "filename": "third_party/xla/xla/pjrt/cpu/tracked_cpu_device_buffer.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Ftracked_cpu_device_buffer.h?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -26,10 +26,10 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/future.h\"\n #include \"xla/pjrt/abstract_tracked_device_buffer.h\"\n #include \"xla/pjrt/cpu/cpu_event.h\"\n #include \"xla/pjrt/device_event.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/tsl/concurrency/async_value.h\"\n #include \"xla/tsl/concurrency/async_value_ref.h\"\n@@ -211,7 +211,7 @@ class TrackedCpuDeviceBuffer : public AbstractTrackedDeviceBuffer {\n \n   void Delete(PjRtMemorySpace* memory_space) override;\n \n-  PjRtFuture<> GetReadyFuture(PjRtMemorySpace* memory_space) override;\n+  Future<> GetReadyFuture(PjRtMemorySpace* memory_space) override;\n \n   absl::Status BlockForOperationsToComplete(\n       PjRtMemorySpace* memory_space) override;"
        },
        {
            "sha": "60f11cf0a94e3a501d14fa5faaf159d1956ac956",
            "filename": "third_party/xla/xla/tsl/concurrency/future.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Ftsl%2Fconcurrency%2Ffuture.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c12a0d2be571b7159213f89868e2777f6831f159/third_party%2Fxla%2Fxla%2Ftsl%2Fconcurrency%2Ffuture.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fconcurrency%2Ffuture.h?ref=c12a0d2be571b7159213f89868e2777f6831f159",
            "patch": "@@ -889,7 +889,7 @@ class Future<void> : public internal::FutureBase<absl::Status> {\n };\n \n // Bring Promise implementation into the tsl namespace.\n-template <typename T>\n+template <typename T = void>\n using Promise = typename Future<T>::Promise;  // NOLINT\n \n //===----------------------------------------------------------------------===//"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 29,
        "deletions": 37
    }
}