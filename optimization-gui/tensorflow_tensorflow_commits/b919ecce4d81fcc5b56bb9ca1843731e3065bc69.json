{
    "author": "cool-RR",
    "message": "PR #33504: Add human-readable units to \"Out of memory\" errors (e.g. 7.34GB)\n\nImported from GitHub PR https://github.com/openxla/xla/pull/33504\n\n  üìù Summary of Changes\n\n  Improved memory allocation error messages in tf_allocator_adapter.cc to display byte counts with comma separators\n  and human-readable units.\n\n  Before:\n  Out of memory while trying to allocate 7450374152 bytes.\n\n  After:\n  Out of memory while trying to allocate 7,450,374,152 bytes (6.94GiB).\n\n  Changes:\n  - Added FormatByteSize() helper function that formats byte counts with commas for readability\n  - Leverages existing tsl::strings::HumanReadableNumBytes() utility to append human-readable size (MiB/GiB/TiB)\n  - Updated MemoryAllocationError() to use the new formatting\n\n  üéØ Justification\n\n  When debugging out-of-memory errors, users need to quickly understand allocation sizes. Without formatting, it's\n  difficult to distinguish between millions and billions at a glance (e.g., is 7450374152 closer to 7 million or 7\n  billion?).\n\n  This change improves the developer experience by:\n  1. Making large numbers easier to parse with comma separators\n  2. Providing immediate intuition about size magnitude (MB vs GB vs TB)\n  3. Maintaining exact byte precision for detailed debugging\n\n  This benefits all workloads that encounter memory allocation failures, making error messages more actionable.\n\n  üöÄ Kind of Contribution\n\n  ‚ôªÔ∏è Cleanup\n\n  üß™ Unit Tests\n\n  No new unit tests added. This change only affects error message formatting and does not alter program logic or\n  behavior. The existing allocation failure paths remain unchanged.\n\n  üß™ Execution Tests\n\n  No new execution tests needed. This is a cosmetic improvement to error messages that does not affect execution\n  correctness or trigger any new code paths.\nCopybara import of the project:\n\n--\nf738426970e6f067df3dde2f93bd2736294e7e5d by Ram Rachum <ram@rachum.com>:\n\nUse human-readable units in \"Out of memory\" errors (e.g. 7.34GB)\n\nMerging this change closes #33504\n\nPiperOrigin-RevId: 828416974",
    "sha": "b919ecce4d81fcc5b56bb9ca1843731e3065bc69",
    "files": [
        {
            "sha": "044c6e9f109f3f13b133858b40a4e23eac0d5fc9",
            "filename": "third_party/xla/xla/stream_executor/integrations/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b919ecce4d81fcc5b56bb9ca1843731e3065bc69/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b919ecce4d81fcc5b56bb9ca1843731e3065bc69/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2FBUILD?ref=b919ecce4d81fcc5b56bb9ca1843731e3065bc69",
            "patch": "@@ -59,6 +59,7 @@ cc_library(\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:cord\",\n         \"@com_google_absl//absl/synchronization\",\n+        \"@local_tsl//tsl/platform:numbers\",\n     ],\n )\n "
        },
        {
            "sha": "a2c0cea3c7087f06ffcf544df010528a27cd6ce1",
            "filename": "third_party/xla/xla/stream_executor/integrations/tf_allocator_adapter.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b919ecce4d81fcc5b56bb9ca1843731e3065bc69/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Ftf_allocator_adapter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b919ecce4d81fcc5b56bb9ca1843731e3065bc69/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Ftf_allocator_adapter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Ftf_allocator_adapter.cc?ref=b919ecce4d81fcc5b56bb9ca1843731e3065bc69",
            "patch": "@@ -31,6 +31,7 @@ limitations under the License.\n #include \"xla/stream_executor/stream_executor.h\"\n #include \"xla/tsl/framework/allocator.h\"\n #include \"xla/tsl/platform/logging.h\"\n+#include \"tsl/platform/numbers.h\"\n \n namespace stream_executor {\n \n@@ -95,7 +96,8 @@ absl::Status MemoryAllocationError(uint64_t size, bool is_host_mem) {\n \n   absl::Status status = absl::ResourceExhaustedError(\n       absl::StrCat(\"Out of \", (is_host_mem ? \"host \" : \"\"),\n-                   \"memory while trying to allocate \", size, \" bytes.\",\n+                   \"memory while trying to allocate \",\n+                   tsl::strings::HumanReadableNumBytes(size), \".\",\n                    (is_host_mem ? kHostMemoryExplanation : \"\")));\n   status.SetPayload(kMemoryAllocationErrorPayloadKey, absl::Cord());\n   return status;"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
    }
}