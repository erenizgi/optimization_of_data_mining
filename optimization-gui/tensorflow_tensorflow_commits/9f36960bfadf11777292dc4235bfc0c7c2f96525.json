{
    "author": "voznesenskym",
    "message": "Dynamic update slice should propagate memspace to op 0\n\nPiperOrigin-RevId: 803248969",
    "sha": "9f36960bfadf11777292dc4235bfc0c7c2f96525",
    "files": [
        {
            "sha": "d5637aa6ddeef177bd08ad6df068faa9ace873b7",
            "filename": "third_party/xla/xla/hlo/transforms/memory_space_propagation.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9f36960bfadf11777292dc4235bfc0c7c2f96525/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fmemory_space_propagation.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9f36960bfadf11777292dc4235bfc0c7c2f96525/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fmemory_space_propagation.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fmemory_space_propagation.cc?ref=9f36960bfadf11777292dc4235bfc0c7c2f96525",
            "patch": "@@ -125,6 +125,13 @@ bool MemorySpacePropagation::Propagate(ShapeIndexView index,\n     if (src_split_config.has_value()) {\n       shape->mutable_layout()->add_split_configs(*src_split_config);\n     }\n+\n+    if (instruction->opcode() == HloOpcode::kDynamicUpdateSlice) {\n+      auto op_0 = instruction->mutable_operand(0);\n+      op_0->mutable_shape()->mutable_layout()->set_memory_space(\n+          src_shape.layout().memory_space());\n+      op_0->mutable_shape()->mutable_layout()->clear_split_configs();\n+    }\n     modified = true;\n \n     // For fusion outputs, propagate the memory space to the fusion root."
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}