{
    "author": "olegshyshkov",
    "message": "[XLA:GPU] Improve error messages when we fail to tile a fusion.\n\nPiperOrigin-RevId: 841739377",
    "sha": "9981c805dcf2114836c8ea5eae4dc589ff4855fc",
    "files": [
        {
            "sha": "0ac831f03114a394d467259552f7880342cf1ef4",
            "filename": "third_party/xla/xla/codegen/tiling/symbolic_tile_analysis.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9981c805dcf2114836c8ea5eae4dc589ff4855fc/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Fsymbolic_tile_analysis.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9981c805dcf2114836c8ea5eae4dc589ff4855fc/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Fsymbolic_tile_analysis.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Fsymbolic_tile_analysis.cc?ref=9981c805dcf2114836c8ea5eae4dc589ff4855fc",
            "patch": "@@ -459,8 +459,8 @@ FusionDecision ShouldProceedWithSymbolicTileDerivation(\n         SymbolicTile::FromIndexingMap(reshape_indexing_map);\n \n     if (!reshape_symbolic_tile.has_value()) {\n-      return FusionDecision::Forbid(\"Bailing out on reshape \")\n-             << hlo->ToString() << \" with indexing map \"\n+      return FusionDecision::Forbid(\"Bailing out on reshape\")\n+             << \" \" << hlo->ToString() << \" with indexing map \"\n              << ToString(reshape_indexing_map);\n     }\n   }"
        },
        {
            "sha": "dc972406913fc3a8ca8d952c3ab6824b7440164d",
            "filename": "third_party/xla/xla/service/gpu/transforms/nest_gemm_fusion.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9981c805dcf2114836c8ea5eae4dc589ff4855fc/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9981c805dcf2114836c8ea5eae4dc589ff4855fc/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc?ref=9981c805dcf2114836c8ea5eae4dc589ff4855fc",
            "patch": "@@ -1248,13 +1248,13 @@ absl::StatusOr<BlockLevelParameters> FindBlockLevelParameters(\n       SymbolicTileAnalysis::AnalyzeComputation(\n           *computation, ctx,\n           TritonEmitterConstraints::GetBuilder(device_description));\n-  if (std::holds_alternative<FusionDecision>(analysis_or)) {\n+\n+  if (const auto* fusion_decision = std::get_if<FusionDecision>(&analysis_or)) {\n     std::unique_ptr<HloModule> extracted_computation_module =\n         ExtractInstructionIntoNewModule(*computation->FusionInstruction());\n-    return absl::InternalError(\n-        absl::StrCat(\"Failed to analyze the computation (\",\n-                     std::get<FusionDecision>(analysis_or).Explain(),\n-                     \"): \", extracted_computation_module->ToString()));\n+    return absl::InternalError(absl::StrCat(\n+        \"Failed to analyze the computation (\", fusion_decision->Explain(),\n+        \"):\\n\", extracted_computation_module->ToString()));\n   }\n \n   auto& analysis = std::get<SymbolicTileAnalysis>(analysis_or);"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}