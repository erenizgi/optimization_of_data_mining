{
    "author": "d4n1elchen",
    "message": "[XLA:HLO Diff] Consolidate the diff enums.\n\nThe `DiffCode` and `DiffType` enums are now consolidated into a single `DiffType` enum.\n\nThis change improves the code's clarity and reduces redundancies.\n\nPiperOrigin-RevId: 803112761",
    "sha": "98a6b660cd144a077c60d94007a922f723e91d28",
    "files": [
        {
            "sha": "5430c227a16f3e22eff6f91ac8f92bb2767bea3f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_result.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.cc?ref=98a6b660cd144a077c60d94007a922f723e91d28",
            "patch": "@@ -45,33 +45,33 @@ bool IsChangedInstruction(const HloInstructionNode* left_node,\n void DiffResult::AddUnchangedInstruction(const HloInstruction* left,\n                                          const HloInstruction* right) {\n   unchanged_instructions[left] = right;\n-  left_diff_codes[left] = DiffCode::kUnchanged;\n-  right_diff_codes[right] = DiffCode::kUnchanged;\n+  left_diff_codes[left] = DiffType::kUnchanged;\n+  right_diff_codes[right] = DiffType::kUnchanged;\n }\n \n void DiffResult::AddChangedInstruction(const HloInstruction* left,\n                                        const HloInstruction* right) {\n   changed_instructions[left] = right;\n-  left_diff_codes[left] = DiffCode::kChanged;\n-  right_diff_codes[right] = DiffCode::kChanged;\n+  left_diff_codes[left] = DiffType::kChanged;\n+  right_diff_codes[right] = DiffType::kChanged;\n }\n \n void DiffResult::AddMovedInstruction(const HloInstruction* left,\n                                      const HloInstruction* right) {\n   moved_instructions[left] = right;\n-  left_diff_codes[left] = DiffCode::kUnchanged;\n-  right_diff_codes[right] = DiffCode::kUnchanged;\n+  left_diff_codes[left] = DiffType::kUnchanged;\n+  right_diff_codes[right] = DiffType::kUnchanged;\n }\n \n void DiffResult::AddUnmatchedInstruction(const HloInstruction* left,\n                                          const HloInstruction* right) {\n   if (left != nullptr) {\n     left_module_unmatched_instructions.insert(left);\n-    left_diff_codes[left] = DiffCode::kUnmatched;\n+    left_diff_codes[left] = DiffType::kUnmatched;\n   }\n   if (right != nullptr) {\n     right_module_unmatched_instructions.insert(right);\n-    right_diff_codes[right] = DiffCode::kUnmatched;\n+    right_diff_codes[right] = DiffType::kUnmatched;\n   }\n }\n "
        },
        {
            "sha": "6bcacf6b074da93215e44371a1d7cfc8ce8aa529",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_result.h",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result.h?ref=98a6b660cd144a077c60d94007a922f723e91d28",
            "patch": "@@ -33,11 +33,7 @@\n namespace xla {\n namespace hlo_diff {\n \n-enum DiffCode : uint8_t {\n-  kUnchanged,\n-  kChanged,\n-  kUnmatched,\n-};\n+enum DiffType : uint8_t { kUnchanged, kChanged, kUnmatched, kMoved };\n \n // Result of diff'ng the left and right HLO modules. Contains the matched and\n // unmatched instructions in the two modules.\n@@ -56,8 +52,8 @@ struct DiffResult {\n       right_module_unmatched_instructions;\n \n   // Diff codes.\n-  absl::flat_hash_map<const HloInstruction*, DiffCode> left_diff_codes;\n-  absl::flat_hash_map<const HloInstruction*, DiffCode> right_diff_codes;\n+  absl::flat_hash_map<const HloInstruction*, DiffType> left_diff_codes;\n+  absl::flat_hash_map<const HloInstruction*, DiffType> right_diff_codes;\n \n   // Debug info.\n   absl::flat_hash_map<std::pair<const HloInstruction*, const HloInstruction*>,"
        },
        {
            "sha": "7c9342a555182bc5120c11f642befa93bcd31c26",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_result_test.cc",
            "status": "modified",
            "additions": 24,
            "deletions": 24,
            "changes": 48,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_result_test.cc?ref=98a6b660cd144a077c60d94007a922f723e91d28",
            "patch": "@@ -106,19 +106,19 @@ ENTRY entry {\n   EXPECT_THAT(diff_result->left_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kUnchanged),\n+                       DiffType::kUnchanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kChanged)));\n+                       DiffType::kChanged)));\n   EXPECT_THAT(diff_result->right_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kUnchanged),\n+                       DiffType::kUnchanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kChanged)));\n+                       DiffType::kChanged)));\n }\n \n TEST_F(HloDiffTest, MatchedDifferentFingerprintMarkAsChanged) {\n@@ -190,19 +190,19 @@ ENTRY entry {\n   EXPECT_THAT(diff_result->left_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kChanged)));\n+                       DiffType::kChanged)));\n   EXPECT_THAT(diff_result->right_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kChanged),\n+                       DiffType::kChanged),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kChanged)));\n+                       DiffType::kChanged)));\n }\n \n TEST_F(HloDiffTest, UnmatchedInstructionsMarkAsUnmatched) {\n@@ -264,19 +264,19 @@ ENTRY entry {\n   EXPECT_THAT(diff_result->left_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kUnmatched),\n+                       DiffType::kUnmatched),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kUnmatched),\n+                       DiffType::kUnmatched),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kUnchanged)));\n+                       DiffType::kUnchanged)));\n   EXPECT_THAT(diff_result->right_diff_codes,\n               UnorderedElementsAre(\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-                       DiffCode::kUnmatched),\n+                       DiffType::kUnmatched),\n                   Pair(Pointee(Property(&HloInstruction::name, \"parameter.1\")),\n-                       DiffCode::kUnmatched),\n+                       DiffType::kUnmatched),\n                   Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-                       DiffCode::kUnchanged)));\n+                       DiffType::kUnchanged)));\n }\n \n TEST_F(HloDiffTest, ShortFormConstantsMatched) {\n@@ -354,20 +354,20 @@ ENTRY entry {\n       diff_result->left_diff_codes,\n       UnorderedElementsAre(\n           Pair(Pointee(Property(&HloInstruction::name, \"constant.2958\")),\n-               DiffCode::kUnchanged),\n+               DiffType::kUnchanged),\n           Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-               DiffCode::kUnchanged),\n+               DiffType::kUnchanged),\n           Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-               DiffCode::kUnchanged)));\n+               DiffType::kUnchanged)));\n   EXPECT_THAT(\n       diff_result->right_diff_codes,\n       UnorderedElementsAre(\n           Pair(Pointee(Property(&HloInstruction::name, \"constant.2958\")),\n-               DiffCode::kUnchanged),\n+               DiffType::kUnchanged),\n           Pair(Pointee(Property(&HloInstruction::name, \"parameter.0\")),\n-               DiffCode::kUnchanged),\n+               DiffType::kUnchanged),\n           Pair(Pointee(Property(&HloInstruction::name, \"add.0\")),\n-               DiffCode::kUnchanged)));\n+               DiffType::kUnchanged)));\n }\n \n TEST_F(HloDiffTest, DiffResultToAndFromProtoWorks) {"
        },
        {
            "sha": "cd8ecf1bbc8af47aefb12ae7368aeb7cbb13df1f",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/hlo_diff_summary.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/98a6b660cd144a077c60d94007a922f723e91d28/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fhlo_diff_summary.cc?ref=98a6b660cd144a077c60d94007a922f723e91d28",
            "patch": "@@ -123,16 +123,16 @@ struct DiffFingerprint {\n \n DiffFingerprint ComputationDiffFingerprint(\n     const xla::HloComputation* computation,\n-    const absl::flat_hash_map<const HloInstruction*, DiffCode>& diff_codes) {\n+    const absl::flat_hash_map<const HloInstruction*, DiffType>& diff_codes) {\n   absl::flat_hash_map<const HloInstruction*, uint64_t> subgraph_fingerprint;\n   bool all_unchanged = true;\n   for (auto* instruction : computation->MakeInstructionPostOrder()) {\n     uint64_t fp = static_cast<uint64_t>(instruction->opcode());\n-    uint64_t diff_type_fp = DiffCode::kUnchanged;\n+    uint64_t diff_type_fp = DiffType::kUnchanged;\n     if (auto it = diff_codes.find(instruction); it != diff_codes.end()) {\n       diff_type_fp = it->second;\n     }\n-    all_unchanged = all_unchanged && (diff_type_fp == DiffCode::kUnchanged);\n+    all_unchanged = all_unchanged && (diff_type_fp == DiffType::kUnchanged);\n     fp = tsl::FingerprintCat64(fp, diff_type_fp);\n     for (const HloInstruction* operand : instruction->operands()) {\n       fp = tsl::FingerprintCat64(fp, subgraph_fingerprint.at(operand));\n@@ -262,7 +262,7 @@ std::vector<ComputationDiffPattern> FindComputationDiffPatterns(\n // Summarizes all computations in the given graph.\n ComputationSummaryMap SummarizeAllComputationsInGraph(\n     const HloModule& module, const InstructionBimap& mapping,\n-    const absl::flat_hash_map<const HloInstruction*, DiffCode>& diff_codes,\n+    const absl::flat_hash_map<const HloInstruction*, DiffType>& diff_codes,\n     DiffSide side) {\n   ComputationSummaryMap result;\n   for (const HloComputation* computation : module.computations()) {"
        }
    ],
    "stats": {
        "total": 82,
        "additions": 39,
        "deletions": 43
    }
}