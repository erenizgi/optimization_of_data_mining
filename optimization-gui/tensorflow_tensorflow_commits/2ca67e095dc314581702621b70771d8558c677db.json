{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Add double-click functionality to navigate to matching diffs.\n\nPiperOrigin-RevId: 799617498",
    "sha": "2ca67e095dc314581702621b70771d8558c677db",
    "files": [
        {
            "sha": "cf20a636125ce46c6a39915d9e92538198c7deef",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/render/hlo_gumgraph_html_renderer.cc",
            "status": "modified",
            "additions": 66,
            "deletions": 10,
            "changes": 76,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2ca67e095dc314581702621b70771d8558c677db/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2ca67e095dc314581702621b70771d8558c677db/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc?ref=2ca67e095dc314581702621b70771d8558c677db",
            "patch": "@@ -240,7 +240,12 @@ std::string PrintCss() {\n     span.temp-highlight {\n       background-color: #a8c7fa;\n       opacity: 0.7;\n-      transition: background-color 0.5s ease-out;\n+      animation: breathe-highlight 1s infinite alternate;\n+    }\n+    @keyframes breathe-highlight {\n+      0% { opacity: 0.7; }\n+      50% { opacity: 0.9; }\n+      100% { opacity: 0.7; }\n     }\n \n     .hlo-instruction.hidden {\n@@ -334,6 +339,7 @@ std::string PrintJavascriptForHoverEvent() {\n       span.addEventListener('mouseover', handleMouseOver);\n       span.addEventListener('mouseout', handleMouseOut);\n       span.addEventListener('click', handleSpanClick);\n+      span.addEventListener('dblclick', handleSpanDoubleClick);\n   });\n   function handleMouseOver(event) {\n       const diffId = event.target.getAttribute('data-diffid');\n@@ -399,9 +405,62 @@ std::string PrintJavascriptForHoverEvent() {\n               targetSpan.classList.add('temp-highlight');\n               setTimeout(() => {\n                   targetSpan.classList.remove('temp-highlight');\n-              }, 1500); // Remove highlight after 1.5 seconds\n+              }, 2000); // Remove highlight after 2 seconds\n           } else {\n-              ShowSystemMessage(\"Corresponding instruction is in another computation.\");\n+              ShowSystemMessage(\"Corresponding instruction is in another computation, double click to jump to it.\");\n+          }\n+      }\n+  }\n+\n+  function handleSpanDoubleClick(event) {\n+      const diffId = event.target.getAttribute('data-diffid');\n+      if (!diffId) {\n+          return;\n+      }\n+\n+      const clickedSpan = event.target;\n+      const clickedPre = clickedSpan.closest('.hlo-textbox').querySelector('pre');\n+      if (!clickedPre) return;\n+\n+      const idParts = clickedPre.id.split('-');\n+      const fingerprint = idParts[0];\n+      const isLeft = idParts[1] === 'left';\n+      const siblingPreId = fingerprint + '-' + (isLeft ? 'right' : 'left');\n+      const siblingPre = document.getElementById(siblingPreId);\n+\n+      if (siblingPre) {\n+          const targetSpan = siblingPre.querySelector(`span[data-diffid=\"${diffId}\"]`);\n+          if (!targetSpan) {\n+              // Case 2: Corresponding span NOT found in siblingPre.\n+              // Search for the span with the same diffId in other hlo-textbox-pairs.\n+              const allMatchingSpans = document.querySelectorAll(`span[data-diffid=\"${diffId}\"]`);\n+              let foundSpanInOtherPre = null;\n+              allMatchingSpans.forEach(span => {\n+                  if (span !== clickedSpan) {\n+                      foundSpanInOtherPre = span;\n+                  }\n+              });\n+\n+              if (foundSpanInOtherPre) {\n+                  const foundPre = foundSpanInOtherPre.closest('.hlo-textbox').querySelector('pre');\n+                  if (foundPre) {\n+                      // Find ancestor detail and open it.\n+                      let parentDetails = foundSpanInOtherPre.closest('details');\n+                      while (parentDetails) {\n+                          parentDetails.open = true;\n+                          parentDetails = parentDetails.parentElement ? parentDetails.parentElement.closest('details') : null;\n+                      }\n+\n+                      // Scroll the foundPre to make the foundSpanInOtherPre visible.\n+                      foundSpanInOtherPre.scrollIntoView({ behavior: 'smooth', block: 'center' });\n+\n+                      // Temporarily highlight the found span\n+                      foundSpanInOtherPre.classList.add('temp-highlight');\n+                      setTimeout(() => {\n+                          foundSpanInOtherPre.classList.remove('temp-highlight');\n+                      }, 3000);\n+                  }\n+              }\n           }\n       }\n   }\n@@ -553,13 +612,10 @@ std::string PrintTextbox(absl::string_view title, absl::string_view content,\n                          absl::string_view id = \"\") {\n   return absl::StrCat(\n       PrintDiv(title, {\"title\"}),\n-      PrintDiv(\n-          absl::StrCat(\n-              absl::StrFormat(\n-                  R\"html(<pre onscroll=\"TextboxOnScroll(event)\" id=\"%s\">%s</pre>)html\",\n-                  id, content),\n-              PrintClickToCopyButton(\"ðŸ“‹\", content)),\n-          {\"textbox\"}));\n+      PrintDiv(absl::StrCat(absl::StrFormat(R\"html(<pre id=\"%s\">%s</pre>)html\",\n+                                            id, content),\n+                            PrintClickToCopyButton(\"ðŸ“‹\", content)),\n+               {\"textbox\"}));\n }\n \n /*** Summary logic ***/"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 66,
        "deletions": 10
    }
}