{
    "author": "yuriivcs",
    "message": "Add Hermetic C++ OpenMP for Linux aarch64 builds support.\n\nWhen using MKL-DNN on the Linux aarch64 architecture, OpenMP is required for parallelization. Because the Hermetic C++ build environment uses the -nodefaultlibs flag, simply passing -fopenmp is insufficient. OpenMP's dependencies must be explicitly linked to ensure correct inclusion, as automatic linking is disabled.\n\nPiperOrigin-RevId: 840494155",
    "sha": "31228b49f1c3af6f784556a1845782a3969358d6",
    "files": [
        {
            "sha": "83cca313adf4f59450a138f4b52063d2f08d67af",
            "filename": "third_party/xla/third_party/mkl_dnn/mkldnn_acl.BUILD",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31228b49f1c3af6f784556a1845782a3969358d6/third_party%2Fxla%2Fthird_party%2Fmkl_dnn%2Fmkldnn_acl.BUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31228b49f1c3af6f784556a1845782a3969358d6/third_party%2Fxla%2Fthird_party%2Fmkl_dnn%2Fmkldnn_acl.BUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fmkl_dnn%2Fmkldnn_acl.BUILD?ref=31228b49f1c3af6f784556a1845782a3969358d6",
            "patch": "@@ -156,5 +156,13 @@ cc_library(\n     visibility = [\"//visibility:public\"],\n     deps = [\n         \"@compute_library//:arm_compute\",\n-    ],\n+    ] + select({\n+        # When using MKL-DNN on the AArch64 architecture, OpenMP is required\n+        # for parallelization. Because the Hermetic C++ build environment uses\n+        # the -nodefaultlibs flag, simply passing -fopenmp is insufficient.\n+        # OpenMP's dependencies must be explicitly linked to ensure correct\n+        # inclusion, as automatic linking is disabled.\n+        \"@rules_ml_toolchain//common:is_hermetic_cc_enabled\": [\"@rules_ml_toolchain//cc/sysroots:openmp\"],\n+        \"//conditions:default\": [],\n+    }),\n )"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}