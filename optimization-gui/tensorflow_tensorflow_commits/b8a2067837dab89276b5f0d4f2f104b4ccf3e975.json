{
    "author": "ermilovmaxim",
    "message": "Add Shape to MemzeroThunk/MemzeroCmd buffer_uses\n\nModify Thunk's serialization\n\nPiperOrigin-RevId: 841995197",
    "sha": "b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
    "files": [
        {
            "sha": "856ea1bc586623f7d712b7f4f01a251dbc63491a",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -88,6 +88,7 @@ cc_library(\n         \"//xla:util\",\n         \"//xla/backends/gpu/collectives:gpu_clique_key\",\n         \"//xla/core/collectives:communicator\",\n+        \"//xla/core/collectives:reduction_kind\",\n         \"//xla/ffi:attribute_map\",\n         \"//xla/ffi:call_frame\",\n         \"//xla/ffi:execution_state\",\n@@ -101,7 +102,6 @@ cc_library(\n         \"//xla/runtime:object_pool\",\n         \"//xla/runtime:resource_use\",\n         \"//xla/service:buffer_assignment\",\n-        \"//xla/service:collective_ops_utils\",\n         \"//xla/service:computation_placer\",\n         \"//xla/service:custom_call_status_internal\",\n         \"//xla/service:custom_call_status_public_headers\",\n@@ -119,6 +119,7 @@ cc_library(\n         \"//xla/stream_executor:platform\",\n         \"//xla/stream_executor:stream\",\n         \"//xla/stream_executor:stream_executor_h\",\n+        \"//xla/stream_executor:tensor_map\",\n         \"//xla/stream_executor:trace_command_buffer_factory\",\n         \"//xla/stream_executor/gpu:tma_metadata\",\n         \"//xla/tsl/lib/gtl:int_type\",\n@@ -152,7 +153,9 @@ xla_test(\n     deps = [\n         \":command_buffer_cmd\",\n         \":copy_thunk\",\n+        \":shaped_slice\",\n         \":thunk\",\n+        \"//xla:shape_util\",\n         \"//xla/runtime:buffer_use\",\n         \"//xla/service:buffer_assignment\",\n         \"//xla/service:executable\",\n@@ -359,6 +362,7 @@ xla_test(\n         \":gpublas_lt_matmul_thunk\",\n         \":memset_thunk\",\n         \":sequential_thunk\",\n+        \":shaped_slice\",\n         \":thunk\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n@@ -377,6 +381,7 @@ xla_test(\n         \"//xla/stream_executor:device_address_allocator\",\n         \"//xla/stream_executor:device_description\",\n         \"//xla/stream_executor:kernel\",\n+        \"//xla/stream_executor:kernel_args\",\n         \"//xla/stream_executor:kernel_spec\",\n         \"//xla/stream_executor:launch_dim\",\n         \"//xla/stream_executor:platform\",\n@@ -1190,6 +1195,7 @@ cc_library(\n     srcs = [\"memset_thunk.cc\"],\n     hdrs = [\"memset_thunk.h\"],\n     deps = [\n+        \":shaped_slice\",\n         \":thunk\",\n         \"//xla/runtime:buffer_use\",\n         \"//xla/service:buffer_assignment\","
        },
        {
            "sha": "866e9a9f0b870bc394a00e025eca5b94dba11d88",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_cmd.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -62,6 +62,7 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/backends/gpu/runtime/while_thunk.h\"\n #include \"xla/core/collectives/communicator.h\"\n+#include \"xla/core/collectives/reduction_kind.h\"\n #include \"xla/debug_options_flags.h\"\n #include \"xla/executable_run_options.h\"\n #include \"xla/ffi/call_frame.h\"\n@@ -74,7 +75,6 @@ limitations under the License.\n #include \"xla/runtime/execution_graph.h\"\n #include \"xla/runtime/resource_use.h\"\n #include \"xla/service/buffer_assignment.h\"\n-#include \"xla/service/collective_ops_utils.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/custom_call_status.h\"\n #include \"xla/service/custom_call_status_internal.h\"\n@@ -95,6 +95,7 @@ limitations under the License.\n #include \"xla/stream_executor/platform.h\"\n #include \"xla/stream_executor/stream.h\"\n #include \"xla/stream_executor/stream_executor.h\"\n+#include \"xla/stream_executor/tensor_map.h\"\n #include \"xla/stream_executor/trace_command_buffer_factory.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n@@ -1369,20 +1370,20 @@ CommandBufferCmd::BufferUseVector MemcpyDeviceToDeviceCmd::buffers() const {\n // MemzeroCmd\n //===----------------------------------------------------------------------===//\n \n-MemzeroCmd::MemzeroCmd(BufferAllocation::Slice dst)\n+MemzeroCmd::MemzeroCmd(ShapedSlice dst)\n     : CommandBufferCmd(CommandBufferCmdType::kMemzeroCmd), dst_(dst) {}\n \n absl::StatusOr<const se::CommandBuffer::Command*> MemzeroCmd::Record(\n     const Thunk::ExecuteParams& execute_params,\n     const RecordParams& record_params, RecordAction record_action,\n     se::CommandBuffer* command_buffer) {\n   se::DeviceAddressBase dst =\n-      execute_params.buffer_allocations->GetDeviceAddress(dst_);\n+      execute_params.buffer_allocations->GetDeviceAddress(dst_.slice);\n \n   VLOG(5) << \"MemzeroCmd:\";\n   VLOG(5) << \"  Dst: \" << dst_ << \" (\" << dst.opaque() << \")\";\n \n-  if (dst_.size() == 0) {\n+  if (dst_.slice.size() == 0) {\n     VLOG(5) << \"Skip recording MemzeroCmd command of 0 bytes\";\n     return nullptr;\n   }\n@@ -1391,17 +1392,17 @@ absl::StatusOr<const se::CommandBuffer::Command*> MemzeroCmd::Record(\n       std::move(record_action),\n       [&](absl::Span<const se::CommandBuffer::Command* const> dependencies) {\n         return command_buffer->CreateMemset(&dst, uint8_t{0},\n-                                            /*num_elements=*/dst_.size(),\n+                                            /*num_elements=*/dst_.slice.size(),\n                                             dependencies);\n       },\n       [&](const se::CommandBuffer::Command* command) {\n         return command_buffer->UpdateMemset(command, &dst, uint8_t{0},\n-                                            /*num_elements=*/dst_.size());\n+                                            /*num_elements=*/dst_.slice.size());\n       });\n }\n \n CommandBufferCmd::BufferUseVector MemzeroCmd::buffers() const {\n-  return {BufferUse::Write(dst_)};\n+  return {BufferUse::Write(dst_.slice, dst_.shape)};\n }\n \n //===----------------------------------------------------------------------===//"
        },
        {
            "sha": "70114c4b8a2e00789605fd6039bffcdd94628054",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_cmd.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.h?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -46,6 +46,7 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/p2p_thunk_common.h\"\n #include \"xla/backends/gpu/runtime/shaped_slice.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n+#include \"xla/core/collectives/reduction_kind.h\"\n #include \"xla/ffi/api/c_api.h\"\n #include \"xla/ffi/attribute_map.h\"\n #include \"xla/ffi/call_frame.h\"\n@@ -56,7 +57,6 @@ limitations under the License.\n #include \"xla/runtime/object_pool.h\"\n #include \"xla/runtime/resource_use.h\"\n #include \"xla/service/buffer_assignment.h\"\n-#include \"xla/service/collective_ops_utils.h\"\n #include \"xla/service/gpu/buffer_allocations.h\"\n #include \"xla/service/gpu/kernels/custom_kernel.h\"\n #include \"xla/service/gpu/launch_dimensions.h\"\n@@ -767,7 +767,7 @@ class MemcpyDeviceToDeviceCmd : public CommandBufferCmd {\n \n class MemzeroCmd : public CommandBufferCmd {\n  public:\n-  explicit MemzeroCmd(BufferAllocation::Slice dst);\n+  explicit MemzeroCmd(ShapedSlice dst);\n \n   absl::StatusOr<const se::CommandBuffer::Command*> Record(\n       const Thunk::ExecuteParams& execute_params,\n@@ -777,7 +777,7 @@ class MemzeroCmd : public CommandBufferCmd {\n   BufferUseVector buffers() const override;\n \n  private:\n-  BufferAllocation::Slice dst_;\n+  ShapedSlice dst_;\n };\n \n //===----------------------------------------------------------------------===//"
        },
        {
            "sha": "c8e59ba109323333753201a2051417b19f9a8d93",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_cmd_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd_test.cc?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -29,13 +29,16 @@ limitations under the License.\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n #include \"xla/backends/gpu/runtime/copy_thunk.h\"\n+#include \"xla/backends/gpu/runtime/shaped_slice.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/runtime/buffer_use.h\"\n #include \"xla/service/buffer_assignment.h\"\n #include \"xla/service/gpu/buffer_allocations.h\"\n #include \"xla/service/gpu/launch_dimensions.h\"\n #include \"xla/service/platform_util.h\"\n #include \"xla/service/service_executable_run_options.h\"\n+#include \"xla/shape.h\"\n+#include \"xla/shape_util.h\"\n #include \"xla/stream_executor/command_buffer.h\"\n #include \"xla/stream_executor/device_address.h\"\n #include \"xla/stream_executor/gpu/gpu_test_kernels_fatbin.h\"\n@@ -721,6 +724,8 @@ TEST(CommandBufferCmdTest, NestedChildCmdCreateAndUpdate) {\n   // Prepare device memory for three buffers.\n   int64_t length = 4;\n   int64_t byte_length = sizeof(int32_t) * length;\n+  Shape shape = ShapeUtil::MakeShape(S32, {length});\n+\n   se::DeviceAddress<int32_t> a =\n       stream_executor->AllocateArray<int32_t>(length);\n   se::DeviceAddress<int32_t> b =\n@@ -763,7 +768,7 @@ TEST(CommandBufferCmdTest, NestedChildCmdCreateAndUpdate) {\n   CommandBufferCmdSequence outer_seq;\n   outer_seq.Emplace<ChildCmd>(std::move(middle_executor));\n   // Add a couple more commands at the outer level that still don't affect `c`.\n-  outer_seq.Emplace<MemzeroCmd>(slice_b);\n+  outer_seq.Emplace<MemzeroCmd>(ShapedSlice{slice_b, shape});\n   outer_seq.Emplace<EmptyCmd>();\n   TF_ASSERT_OK_AND_ASSIGN(\n       CommandBufferCmdExecutor outer_executor,"
        },
        {
            "sha": "fff417ba5dacbe2e5d025b541d8c91e42dd97c38",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_thunk_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk_test.cc?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -35,6 +35,7 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/gpublas_lt_matmul_thunk.h\"\n #include \"xla/backends/gpu/runtime/memset_thunk.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n+#include \"xla/backends/gpu/runtime/shaped_slice.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/runtime/buffer_use.h\"\n #include \"xla/service/buffer_assignment.h\"\n@@ -54,6 +55,7 @@ limitations under the License.\n #include \"xla/stream_executor/gpu/gpu_test_kernels.h\"\n #include \"xla/stream_executor/gpu/gpu_test_kernels_fatbin.h\"\n #include \"xla/stream_executor/kernel.h\"\n+#include \"xla/stream_executor/kernel_args.h\"\n #include \"xla/stream_executor/kernel_spec.h\"\n #include \"xla/stream_executor/launch_dim.h\"\n #include \"xla/stream_executor/platform.h\"\n@@ -222,6 +224,7 @@ TEST(CommandBufferThunkTest, MemzeroCmd) {\n \n   int64_t length = 4;\n   int64_t byte_length = sizeof(int32_t) * length;\n+  Shape shape = ShapeUtil::MakeShape(S32, {length});\n \n   // Prepare arguments: a=42\n   se::DeviceAddress<int32_t> a =\n@@ -234,7 +237,7 @@ TEST(CommandBufferThunkTest, MemzeroCmd) {\n \n   // Prepare commands sequence for constructing command buffer.\n   CommandBufferCmdSequence commands;\n-  commands.Emplace<MemzeroCmd>(slice_a);\n+  commands.Emplace<MemzeroCmd>(ShapedSlice{slice_a, shape});\n   TF_ASSERT_OK_AND_ASSIGN(\n       CommandBufferCmdExecutor executor,\n       CommandBufferCmdExecutor::Create(std::move(commands), serialize));"
        },
        {
            "sha": "75508e2365b0b8ed598efdb572eb5286c67f895f",
            "filename": "third_party/xla/xla/backends/gpu/runtime/memset_thunk.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.cc?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -21,6 +21,7 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/backends/gpu/runtime/shaped_slice.h\"\n #include \"xla/service/buffer_assignment.h\"\n #include \"xla/stream_executor/device_address.h\"\n #include \"xla/tsl/platform/statusor.h\"\n@@ -30,16 +31,16 @@ namespace gpu {\n \n absl::Status MemzeroThunk::ExecuteOnStream(const ExecuteParams& params) {\n   se::DeviceAddressBase dest_data =\n-      params.buffer_allocations->GetDeviceAddress(dest_);\n+      params.buffer_allocations->GetDeviceAddress(dest_.slice);\n   return params.stream->MemZero(&dest_data, dest_data.size());\n }\n \n absl::StatusOr<std::unique_ptr<MemzeroThunk>> MemzeroThunk::FromProto(\n     ThunkInfo thunk_info, const MemzeroThunkProto& thunk_proto,\n     absl::Span<const BufferAllocation> buffer_allocations) {\n-  TF_ASSIGN_OR_RETURN(BufferAllocation::Slice dest,\n-                      BufferAllocation::Slice::FromProto(\n-                          thunk_proto.dest_buffer(), buffer_allocations));\n+  TF_ASSIGN_OR_RETURN(\n+      ShapedSlice dest,\n+      ShapedSlice::FromProto(thunk_proto.dest_buffer(), buffer_allocations));\n   return std::make_unique<MemzeroThunk>(std::move(thunk_info), dest);\n }\n "
        },
        {
            "sha": "aec432fa785d828cb8ecdb334e9bdbc90d7cd454",
            "filename": "third_party/xla/xla/backends/gpu/runtime/memset_thunk.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk.h?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -22,6 +22,7 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/backends/gpu/runtime/shaped_slice.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/runtime/buffer_use.h\"\n #include \"xla/service/buffer_assignment.h\"\n@@ -35,17 +36,16 @@ namespace gpu {\n // Thunk that zeroes out a given chunk of memory.\n class MemzeroThunk : public Thunk {\n  public:\n-  explicit MemzeroThunk(ThunkInfo thunk_info,\n-                        const BufferAllocation::Slice& dest)\n+  explicit MemzeroThunk(ThunkInfo thunk_info, const ShapedSlice& dest)\n       : Thunk(Kind::kMemzero, thunk_info), dest_(dest) {}\n \n   absl::Status ExecuteOnStream(const ExecuteParams& params) override;\n \n-  const BufferAllocation::Slice& destination() const { return dest_; }\n+  const ShapedSlice& destination() const { return dest_; }\n \n   BufferUses buffer_uses() const override {\n     return {\n-        BufferUse::Write(dest_),\n+        BufferUse::Write(dest_.slice, dest_.shape),\n     };\n   }\n \n@@ -56,7 +56,7 @@ class MemzeroThunk : public Thunk {\n   absl::StatusOr<ThunkProto> ToProto() const override;\n \n  private:\n-  const BufferAllocation::Slice dest_;\n+  const ShapedSlice dest_;\n };\n \n // Thunk that sets a given chunk of memory to a particular 32-bit value.  The"
        },
        {
            "sha": "67a6d8044ab5a43f0b4ea46c17c4d935da75ac7f",
            "filename": "third_party/xla/xla/backends/gpu/runtime/memset_thunk_test.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fmemset_thunk_test.cc?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -41,7 +41,14 @@ TEST(MemzeroThunkTest, ProtoRoundTrip) {\n           execution_stream_id: 2\n         }\n         memzero_thunk {\n-          dest_buffer { offset: 0 size: 4 buffer_allocation_index: 0 }\n+          dest_buffer {\n+            slice { offset: 0 size: 4 buffer_allocation_index: 0 }\n+            shape {\n+              dimensions: 1\n+              element_type: F32\n+              is_dynamic_dimension: false\n+            }\n+          }\n         }\n       )pb\");\n   std::vector<BufferAllocation> buffer_allocations = {"
        },
        {
            "sha": "7b9bbf093b68634825b42e3e32f55f135ac26034",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk.proto",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8a2067837dab89276b5f0d4f2f104b4ccf3e975/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.proto?ref=b8a2067837dab89276b5f0d4f2f104b4ccf3e975",
            "patch": "@@ -191,7 +191,7 @@ message DynamicSliceThunkProto {\n }\n \n message MemzeroThunkProto {\n-  xla.buffer_assignment.BufferAllocationSliceProto dest_buffer = 1;\n+  ShapedSliceProto dest_buffer = 1;\n }\n \n message Memset32BitValueThunkProto {"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 47,
        "deletions": 24
    }
}