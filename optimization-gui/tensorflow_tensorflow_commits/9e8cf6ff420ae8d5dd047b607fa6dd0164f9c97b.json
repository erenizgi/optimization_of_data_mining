{
    "author": "ZixuanJiang",
    "message": "Add CHECK to enforce Shardy for RaggedDot in SPMD partitioner.\n\nPiperOrigin-RevId: 834485194",
    "sha": "9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b",
    "files": [
        {
            "sha": "1802e690ea0b2f17bdf05e133463a12ba7bb8e3c",
            "filename": "third_party/xla/xla/service/spmd/spmd_partitioner.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner.cc?ref=9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b",
            "patch": "@@ -4954,8 +4954,8 @@ absl::Status SpmdPartitioningVisitor::HandlePartitionId(HloInstruction* hlo) {\n }\n \n absl::Status SpmdPartitioningVisitor::HandleRaggedDot(HloInstruction* hlo) {\n-  VLOG(2) << \"You have to use Shardy for RaggedDot. If not, the behavior \"\n-             \"is undefined.\";\n+  CHECK(hlo->parent()->parent()->config().use_shardy_partitioner())\n+      << \"RaggedDot is only supported with Shardy.\";\n \n   const RaggedDotDimensionNumbers& ragged_dot_dnums =\n       hlo->ragged_dot_dimension_numbers();"
        },
        {
            "sha": "fa880889ce9bf994808c597974764f6bcd241527",
            "filename": "third_party/xla/xla/service/spmd/spmd_partitioner_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fspmd_partitioner_test.cc?ref=9e8cf6ff420ae8d5dd047b607fa6dd0164f9c97b",
            "patch": "@@ -96,6 +96,7 @@ class SpmdPartitioningTest\n     HloModuleConfig config = GetModuleConfigForTest();\n     config.set_use_spmd_partitioning(true);\n     config.set_num_partitions(num_devices);\n+    config.set_use_shardy_partitioner(true);\n     if (enable_enzyme_opt) {\n       config.mutable_debug_options().set_xla_enable_enzyme_comms_opt(true);\n     }"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 3,
        "deletions": 2
    }
}