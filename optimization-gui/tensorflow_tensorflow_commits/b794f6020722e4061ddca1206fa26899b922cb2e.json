{
    "author": "derdrdirk",
    "message": "Waymo relies on current AOT flow which might be test covered by the removed unit test.\n\nReverts 7da7258ffecef52ccc4d7a3f44937ddd59e2677a\n\nPiperOrigin-RevId: 811243437",
    "sha": "b794f6020722e4061ddca1206fa26899b922cb2e",
    "files": [
        {
            "sha": "7a9535be13607890e54153815b1a9b9e53600927",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b794f6020722e4061ddca1206fa26899b922cb2e/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b794f6020722e4061ddca1206fa26899b922cb2e/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=b794f6020722e4061ddca1206fa26899b922cb2e",
            "patch": "@@ -14,7 +14,7 @@ load(\n     \"xla_internal\",\n     \"xla_py_proto_library\",\n )\n-load(\"//xla/service:xla_compile.bzl\", \"xla_aot_compile_cpu\", \"xla_aot_compile_gpu\")\n+load(\"//xla/service:xla_compile.bzl\", \"xla_aot_compile_cpu\", \"xla_aot_compile_gpu\", \"xla_aot_compile_gpu_runtime_autotuning\")\n load(\"//xla/stream_executor:build_defs.bzl\", \"if_cuda_or_rocm_is_configured\", \"if_gpu_is_configured\")\n load(\"//xla/tests:build_defs.bzl\", \"xla_test\")\n load(\"//xla/tsl:tsl.bzl\", \"if_google\", \"if_libtpu\", \"internal_visibility\", \"tsl_copts\")\n@@ -5843,6 +5843,12 @@ xla_aot_compile_gpu(\n     module = \"xla_aot_compile_test_convolution.mlir\",\n )\n \n+xla_aot_compile_gpu_runtime_autotuning(\n+    name = \"xla_aot_compile_test_gpu_executable_convolution_runtime_autotuning\",\n+    gpu_target_config = \"//xla/tools/hlo_opt:gpu_specs/h100_sxm.txtpb\",\n+    module = \"xla_aot_compile_test_convolution.mlir\",\n+)\n+\n xla_cc_test(\n     name = \"xla_aot_compile_cpu_test\",\n     srcs = [\"xla_aot_compile_cpu_test.cc\"],\n@@ -5906,6 +5912,7 @@ xla_cc_test(\n         \":xla_aot_compile_test_gpu_executable\",\n         \":xla_aot_compile_test_gpu_executable_constant\",\n         \":xla_aot_compile_test_gpu_executable_convolution\",\n+        \":xla_aot_compile_test_gpu_executable_convolution_runtime_autotuning\",\n         \":xla_aot_compile_test_gpu_executable_hlo\",\n     ],\n     tags = ["
        },
        {
            "sha": "dffebb1728dc5f87a83908372323df82a29821b8",
            "filename": "third_party/xla/xla/service/xla_compile.bzl",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b794f6020722e4061ddca1206fa26899b922cb2e/third_party%2Fxla%2Fxla%2Fservice%2Fxla_compile.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b794f6020722e4061ddca1206fa26899b922cb2e/third_party%2Fxla%2Fxla%2Fservice%2Fxla_compile.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fxla_compile.bzl?ref=b794f6020722e4061ddca1206fa26899b922cb2e",
            "patch": "@@ -81,3 +81,36 @@ def xla_aot_compile_gpu(\n     )\n \n     return\n+\n+def xla_aot_compile_gpu_runtime_autotuning(\n+        name,\n+        module,\n+        gpu_target_config):\n+    \"\"\"Runs xla_compile to compile an MHLO or StableHLO module into an AotCompilationResult for GPU\n+\n+    Args:\n+        name: The name of the build rule.\n+        module: The MHLO or StableHLO file to compile.\n+        gpu_target_config: The serialized GpuTargetConfigProto\n+    \"\"\"\n+\n+    # Run xla_compile to generate the file containing an AotCompilationResult.\n+    native.genrule(\n+        name = (\"gen_\" + name),\n+        srcs = [module, gpu_target_config],\n+        outs = [name],\n+        cmd = (\n+            \"$(location \" + xla_compile_tool + \")\" +\n+            \" --module_file=$(location \" + module + \")\" +\n+            \" --output_file=$(location \" + name + \")\" +\n+            \" --platform=gpu\" +\n+            \" --gpu_target_config=$(location \" + gpu_target_config + \")\"\n+        ),\n+        tools = [xla_compile_tool],\n+        # copybara:comment_begin(oss-only)\n+        target_compatible_with = select({\n+            \"@local_config_cuda//:is_cuda_enabled\": [],\n+            \"//conditions:default\": [\"@platforms//:incompatible\"],\n+        }),\n+        # copybara:comment_end\n+    )"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 41,
        "deletions": 1
    }
}