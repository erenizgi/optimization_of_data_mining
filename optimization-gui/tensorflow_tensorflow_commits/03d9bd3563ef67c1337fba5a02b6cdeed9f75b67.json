{
    "author": "tensorflower-gardener",
    "message": "[SymbolicExpr] Add Walk() method\n\nThis method provides a way to traverse the SymbolicExpr tree in a post-order fashion, similar to mlir::AffineExpr::walk and it's used in IndexingMap::IsSymbolConstrained.\n\nPiperOrigin-RevId: 802496835",
    "sha": "03d9bd3563ef67c1337fba5a02b6cdeed9f75b67",
    "files": [
        {
            "sha": "fad7b3767481e383718a76eb8a3d7d0911358ba5",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_expr.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc?ref=03d9bd3563ef67c1337fba5a02b6cdeed9f75b67",
            "patch": "@@ -21,6 +21,7 @@ limitations under the License.\n #include <cmath>\n #include <cstddef>\n #include <cstdint>\n+#include <functional>\n #include <numeric>\n #include <optional>\n #include <string>\n@@ -902,5 +903,29 @@ SymbolicExpr SymbolicExprContext::Parse(absl::string_view expr_str) {\n   return Parser(expr_str, this).Parse();\n }\n \n+void SymbolicExpr::Walk(\n+    const std::function<void(SymbolicExpr)>& callback) const {\n+  if (!*this) {\n+    return;\n+  }\n+\n+  switch (GetType()) {\n+    case SymbolicExprType::kConstant:\n+    case SymbolicExprType::kVariable:\n+      break;\n+    case SymbolicExprType::kAdd:\n+    case SymbolicExprType::kMul:\n+    case SymbolicExprType::kFloorDiv:\n+    case SymbolicExprType::kCeilDiv:\n+    case SymbolicExprType::kMod:\n+    case SymbolicExprType::kMin:\n+    case SymbolicExprType::kMax:\n+      GetLHS().Walk(callback);\n+      GetRHS().Walk(callback);\n+      break;\n+  }\n+  callback(*this);\n+}\n+\n }  // namespace gpu\n }  // namespace xla"
        },
        {
            "sha": "5b303e864de4fda86d58a9d006daf1d077700076",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_expr.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.h?ref=03d9bd3563ef67c1337fba5a02b6cdeed9f75b67",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n #define XLA_SERVICE_GPU_MODEL_EXPERIMENTAL_SYMBOLIC_EXPR_H_\n \n #include <cstdint>\n+#include <functional>\n #include <string>\n \n #include \"absl/strings/string_view.h\"\n@@ -86,6 +87,10 @@ class SymbolicExpr {\n \n   void GetUsedVariables(llvm::DenseSet<VariableID>& used_vars) const;\n \n+  // Traverses the expression tree and calls the callback for each\n+  // subexpression in postorder.\n+  void Walk(const std::function<void(SymbolicExpr)>& callback) const;\n+\n   SymbolicExpr operator+(int64_t v) const;\n   SymbolicExpr operator+(SymbolicExpr other) const;\n   SymbolicExpr operator-() const;"
        },
        {
            "sha": "6c53efb39ed2c4a7367fab7f847177d4691e9f6c",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_expr_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/03d9bd3563ef67c1337fba5a02b6cdeed9f75b67/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr_test.cc?ref=03d9bd3563ef67c1337fba5a02b6cdeed9f75b67",
            "patch": "@@ -266,6 +266,15 @@ TEST_F(SymbolicExprTest, Canonicalization_DivMod) {\n   EXPECT_EQ(((v0 * 6).ceilDiv(-3)).Canonicalize().ToString(), \"(v0 * -2)\");\n }\n \n+TEST_F(SymbolicExprTest, Walk) {\n+  SymbolicExpr expr = (v0 + 42) * v1;\n+  std::vector<std::string> visited_exprs;\n+  expr.Walk([&](SymbolicExpr e) { visited_exprs.push_back(e.ToString()); });\n+\n+  EXPECT_THAT(visited_exprs, ::testing::ElementsAre(\"v0\", \"42\", \"(v0 + 42)\",\n+                                                    \"v1\", \"((v0 + 42) * v1)\"));\n+}\n+\n }  // namespace\n }  // namespace gpu\n }  // namespace xla"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}