{
    "author": "akuegel",
    "message": "Avoid a CHECK failure when computing the reduction identity for min/max.\n\nFor complex types, there exists no minimum or maximum value.\n\nPiperOrigin-RevId: 810316414",
    "sha": "3acc77a938adf0716ec988c57a0e4ad624515d2e",
    "files": [
        {
            "sha": "fe8973b0f7f1d8f2401b9670148e1a5e16607d7e",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=3acc77a938adf0716ec988c57a0e4ad624515d2e",
            "patch": "@@ -5289,6 +5289,7 @@ xla_cc_test(\n         \":hlo_module_config\",\n         \":source_target_pairs\",\n         \"//xla:array2d\",\n+        \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\","
        },
        {
            "sha": "22450d5fe171a4964fa4024f21f58cac3e11ab0d",
            "filename": "third_party/xla/xla/service/collective_ops_utils.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils.cc?ref=3acc77a938adf0716ec988c57a0e4ad624515d2e",
            "patch": "@@ -38,6 +38,7 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n+#include \"xla/primitive_util.h\"\n #include \"xla/service/collective_permute_cycle.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/global_device_id.h\"\n@@ -140,8 +141,14 @@ std::optional<Literal> GetReductionIdentity(ReductionKind kind,\n     case ReductionKind::PRODUCT:\n       return LiteralUtil::One(type);\n     case ReductionKind::MIN:\n+      if (primitive_util::IsComplexType(type)) {\n+        return std::nullopt;\n+      }\n       return LiteralUtil::MaxValue(type);\n     case ReductionKind::MAX:\n+      if (primitive_util::IsComplexType(type)) {\n+        return std::nullopt;\n+      }\n       return LiteralUtil::MinValue(type);\n     default:\n       return std::nullopt;"
        },
        {
            "sha": "439c90304da7100e675e1086ca63fc80e023f715",
            "filename": "third_party/xla/xla/service/collective_ops_utils_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3acc77a938adf0716ec988c57a0e4ad624515d2e/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcollective_ops_utils_test.cc?ref=3acc77a938adf0716ec988c57a0e4ad624515d2e",
            "patch": "@@ -37,6 +37,7 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/parser/hlo_parser.h\"\n+#include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/service/collective_permute_cycle.h\"\n #include \"xla/service/computation_placer.h\"\n@@ -1250,5 +1251,13 @@ INSTANTIATE_TEST_SUITE_P(\n       return info.param.test_name;\n     });\n \n+TEST(GetReductionIdentity, NoCrashForComplexType) {\n+  std::optional<Literal> identity =\n+      GetReductionIdentity(ReductionKind::MIN, C64);\n+  EXPECT_FALSE(identity.has_value());\n+  identity = GetReductionIdentity(ReductionKind::MAX, C128);\n+  EXPECT_FALSE(identity.has_value());\n+}\n+\n }  // namespace GetPariticipantCountsForReplicaGroupsTest\n }  // namespace xla"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 17,
        "deletions": 0
    }
}