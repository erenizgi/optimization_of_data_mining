{
    "author": "tensorflower-gardener",
    "message": "Bug fixes to enable device loop for step tracking\n\nPiperOrigin-RevId: 829155715",
    "sha": "bb5772c28f0c5cfa2eb5a2c72b86dca4340a4c2e",
    "files": [
        {
            "sha": "7edf70559c50f3b819618da3a7ad829509856099",
            "filename": "third_party/xla/xla/tsl/profiler/utils/group_events.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bb5772c28f0c5cfa2eb5a2c72b86dca4340a4c2e/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fgroup_events.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bb5772c28f0c5cfa2eb5a2c72b86dca4340a4c2e/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fgroup_events.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fgroup_events.cc?ref=bb5772c28f0c5cfa2eb5a2c72b86dca4340a4c2e",
            "patch": "@@ -934,7 +934,15 @@ void GroupXplaneEvents(tensorflow::profiler::XPlane* plane,\n   if (step_line) {\n     bool device_loop = (step_line->events_size() > module_line->events_size());\n     if (device_loop) {\n-      group_line = nullptr;\n+      int32_t group_id = 0;\n+      for (XEvent& event : *step_line->mutable_events()) {\n+        XEventBuilder step_builder(step_line, &plane_builder, &event);\n+        XEventVisitor step_visitor(&plane_visitor, step_line, &event);\n+        if (!step_visitor.GetStat(StatType::kGroupId).has_value()) {\n+          step_builder.AddStatValue(*group_id_stat_metadata, group_id++);\n+        }\n+      }\n+      group_line = step_line;\n     } else {  // host loop\n       if (group_line) {\n         // Determine whether the module line has been grouped."
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}