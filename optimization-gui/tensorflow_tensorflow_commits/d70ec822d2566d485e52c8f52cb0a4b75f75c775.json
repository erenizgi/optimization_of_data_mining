{
    "author": "hhb",
    "message": "Add `DCNTopology` and `EndpointAddresses`\n\nPiperOrigin-RevId: 841850899",
    "sha": "d70ec822d2566d485e52c8f52cb0a4b75f75c775",
    "files": [
        {
            "sha": "888a0978aac8f05250a68d51187db557813fde8a",
            "filename": "third_party/xla/opensource_only.files",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fopensource_only.files",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fopensource_only.files",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fopensource_only.files?ref=d70ec822d2566d485e52c8f52cb0a4b75f75c775",
            "patch": "@@ -1,6 +1,7 @@\n tensorflow/compiler/xla/backends/cpu/nanort/package_groups.bzl:\n tensorflow/compiler/xla/backends/cpu/package_groups.bzl:\n tensorflow/compiler/xla/internal/package_groups.bzl:\n+tensorflow/compiler/xla/megascale/package_groups.bzl:\n tensorflow/compiler/xla/mlir_hlo/WORKSPACE:\n tensorflow/compiler/xla/package_groups.bzl:\n tensorflow/compiler/xla/pjrt/cpu/package_groups.bzl:"
        },
        {
            "sha": "4aa6b4e8f5498e511d60c2c88deccc094915f386",
            "filename": "third_party/xla/xla/megascale/BUILD",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmegascale%2FBUILD?ref=d70ec822d2566d485e52c8f52cb0a4b75f75c775",
            "patch": "@@ -0,0 +1,28 @@\n+load(\"//xla/megascale:package_groups.bzl\", \"megascale_package_groups\")\n+load(\"//xla/tsl:tsl.bzl\", \"internal_visibility\")\n+load(\n+    \"//xla/tsl/platform:build_config.bzl\",\n+    \"tf_proto_library\",\n+)\n+\n+package(\n+    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n+    default_visibility = internal_visibility([\":internal\"]),\n+    licenses = [\"notice\"],\n+)\n+\n+megascale_package_groups()\n+\n+tf_proto_library(\n+    name = \"dcn_topology_proto\",\n+    srcs = [\"dcn_topology.proto\"],\n+    create_grpc_library = True,\n+    make_default_target_header_only = True,\n+)\n+\n+tf_proto_library(\n+    name = \"addresses_proto\",\n+    srcs = [\"addresses.proto\"],\n+    create_grpc_library = True,\n+    make_default_target_header_only = True,\n+)"
        },
        {
            "sha": "ad6611335bbc3cc6f86eb49addbb54a7592211dd",
            "filename": "third_party/xla/xla/megascale/addresses.proto",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Faddresses.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Faddresses.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmegascale%2Faddresses.proto?ref=d70ec822d2566d485e52c8f52cb0a4b75f75c775",
            "patch": "@@ -0,0 +1,28 @@\n+syntax = \"proto3\";\n+\n+package xla.megascale.runtime;\n+\n+option java_multiple_files = true;\n+option java_outer_classname = \"Runtime\";\n+\n+message HostNetworkAddress {\n+  string address = 1;\n+  string interface_name = 2;\n+  // The host name used for debugging only, and is supplied by pathways or MXLA\n+  // coordinator. Do not use this for creating connection to other peers, use\n+  // the address above.\n+  string host_name_for_debugging = 3;\n+}\n+\n+// NetworkAddressMapping provides mapping between a unique endpoint (slice_id,\n+// host_id) and the network address it is reachable at.\n+message NetworkAddressMapping {\n+  int32 slice_id = 1;\n+  int32 host_id = 2;\n+  repeated HostNetworkAddress addresses = 3;\n+}\n+\n+// Holds the network address mapping of all endpoints (slice_id, host_id).\n+message EndpointAddresses {\n+  repeated NetworkAddressMapping address_mappings = 1;\n+}"
        },
        {
            "sha": "de87573195e36b1dfbe21a7b27ff569f5399ad86",
            "filename": "third_party/xla/xla/megascale/dcn_topology.proto",
            "status": "added",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Fdcn_topology.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Fdcn_topology.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmegascale%2Fdcn_topology.proto?ref=d70ec822d2566d485e52c8f52cb0a4b75f75c775",
            "patch": "@@ -0,0 +1,64 @@\n+syntax = \"proto3\";\n+\n+package xla.megascale.runtime;\n+\n+option java_multiple_files = true;\n+option java_outer_classname = \"Runtime\";\n+\n+message DCNTopology {\n+  // SymmetricTree represents a simple network topology with symmetric\n+  // splitting at each level.\n+  message SymmetricTree {\n+    // The length of branching_per_layer is the depth (number of distinct\n+    // layers) of the network topology. The values give the branching factor at\n+    // each layer. Index 0 holds the uppermost level in the topology. For\n+    // example: a 24 slice topology, in three groups of two subgroups of four\n+    // slices would be represented as: branching_per_layer =\n+    // [3, 2, 4] slice_ids are not explicitly specified and are assumed to be\n+    // contiguously assigned. i.e. slice_id = branching_per_layer[0] * 8  +\n+    // branching_per_layer[1] * 4 + branching_per_layer[2]\n+    repeated int32 branching_per_layer = 1;\n+  }\n+\n+  // Node recursively defines a fully specified tree. The tree is expected to\n+  // be balanced but allowed to be asymmetric.\n+  message TreeNode {\n+    // Contiguous range of slices in half-open interval [slice_id_start,\n+    // slice_id_end). The contiguous nature has no special signficance beyond\n+    // compactly represent large number of slices. e.g. SliceRange{0, 10} and\n+    // SliceRange{20, 30} all have the same connectivity between them.\n+    message SliceRange {\n+      int32 slice_id_start = 1;\n+      // Ignored when slice_id_end <= slice_id_start.\n+      int32 slice_id_end = 2;\n+    }\n+\n+    // Optional label for readability.\n+    optional string label = 1;\n+\n+    // We expect the Topology to be a balanced asymmetric tree. This implies\n+    // that at any level we should either have nodes OR slice_ranges.\n+    repeated TreeNode nodes = 2;\n+    repeated SliceRange slice_ranges = 3;\n+\n+    // Specifies the degree to which egress from this node to higher layers in\n+    // topology is constrained. Valid range [0.0, 1.0]. 0.0 -> no\n+    // constraint, 1.0 -> never use. When egress_constraint for a node is higher\n+    // than other nodes with which it performas a reduction, it is assigned\n+    // shards for reduction with less probability. This will result in fewer\n+    // transfers out of these nodes to higher layers in topology.\n+    optional float egress_constraint = 4;\n+\n+    // Whether to perform the ring algorithm instead of the shuffle algorithm\n+    // between the children. The ring order is the order of the children.\n+    bool ring_transfers = 5;\n+  }\n+\n+  oneof representation {\n+    // Simple representation of a symmetric hierarchical network.\n+    SymmetricTree symmetric_tree = 1;\n+    // Fully specified tree with no assumptions on symmetry and slice id\n+    // mappings.\n+    TreeNode tree = 2;\n+  }\n+}"
        },
        {
            "sha": "9d3f8d701a735bed4b12af513bcbd11bce42a618",
            "filename": "third_party/xla/xla/megascale/package_groups.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Fpackage_groups.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d70ec822d2566d485e52c8f52cb0a4b75f75c775/third_party%2Fxla%2Fxla%2Fmegascale%2Fpackage_groups.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmegascale%2Fpackage_groups.bzl?ref=d70ec822d2566d485e52c8f52cb0a4b75f75c775",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Megascale package_group definitions\"\"\"\n+\n+def megascale_package_groups(name = \"megascale_package_groups\"):\n+    native.package_group(\n+        name = \"internal\",\n+        packages = [\"//...\"],\n+    )"
        }
    ],
    "stats": {
        "total": 128,
        "additions": 128,
        "deletions": 0
    }
}