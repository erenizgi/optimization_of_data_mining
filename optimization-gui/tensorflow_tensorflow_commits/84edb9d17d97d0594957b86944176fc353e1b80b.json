{
    "author": "ezhulenev",
    "message": "[xla:ffi] Add XLA_FFI_DECLARE_TYPE_INFO_SYMBOL\n\nPiperOrigin-RevId: 840755778",
    "sha": "84edb9d17d97d0594957b86944176fc353e1b80b",
    "files": [
        {
            "sha": "344b9175592411021e4eec748627c14906978215",
            "filename": "third_party/xla/xla/ffi/api/api.h",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/84edb9d17d97d0594957b86944176fc353e1b80b/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/84edb9d17d97d0594957b86944176fc353e1b80b/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h?ref=84edb9d17d97d0594957b86944176fc353e1b80b",
            "patch": "@@ -2269,6 +2269,14 @@ auto DictionaryDecoder(Members... m) {\n // Following two APIs are intended for users who want to export XLA FFI handler\n // from a shared library as a C function symbol.\n \n+// Declares C function that returns FFI type id.\n+#define XLA_FFI_DECLARE_TYPE_ID_SYMBOL(type_id_fn) \\\n+  extern \"C\" XLA_FFI_TypeId* type_id_fn()\n+\n+// Declares C function that returns FFI type info.\n+#define XLA_FFI_DECLARE_TYPE_INFO_SYMBOL(type_info_fn) \\\n+  extern \"C\" const XLA_FFI_TypeInfo* type_info_fn()\n+\n // Declares C function that implements FFI handler.\n #define XLA_FFI_DECLARE_HANDLER_SYMBOL(fn) \\\n   extern \"C\" XLA_FFI_Error* fn(XLA_FFI_CallFrame* call_frame)"
        },
        {
            "sha": "e3345ebe915146bb7ea18bed33cbd5f8ca2e9fbf",
            "filename": "third_party/xla/xla/ffi/api/ffi_test.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/84edb9d17d97d0594957b86944176fc353e1b80b/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/84edb9d17d97d0594957b86944176fc353e1b80b/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc?ref=84edb9d17d97d0594957b86944176fc353e1b80b",
            "patch": "@@ -1304,8 +1304,20 @@ TypeId MyDataWithAutoTypeId::id = XLA_FFI_UNKNOWN_TYPE_ID;\n static constexpr auto kMyDataWithAutoTypeIdTypeInfo =\n     MakeTypeInfo<MyDataWithAutoTypeId>();\n \n-XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"my_data_auto\", &MyDataWithAutoTypeId::id,\n-                      &kMyDataWithAutoTypeIdTypeInfo);\n+// Test that XLA FFI macro works.\n+XLA_FFI_DECLARE_TYPE_ID_SYMBOL(my_data_type_id);\n+XLA_FFI_DECLARE_TYPE_INFO_SYMBOL(my_data_type_info);\n+\n+extern \"C\" XLA_FFI_TypeId* my_data_type_id() {\n+  return &MyDataWithAutoTypeId::id;\n+}\n+\n+extern \"C\" const XLA_FFI_TypeInfo* my_data_type_info() {\n+  return &kMyDataWithAutoTypeIdTypeInfo;\n+}\n+\n+XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"my_data_auto\", my_data_type_id(),\n+                      my_data_type_info());\n \n // Provide explicit type id and rely on XLA to check that it's unique.\n TypeId MyDataWithExplicitTypeId::id = {42};"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
    }
}