{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@3a6b818132e3\n\nUpdates LLVM usage to match\n[3a6b818132e3](https://github.com/llvm/llvm-project/commit/3a6b818132e3)\n\nPiperOrigin-RevId: 818692560",
    "sha": "893e85d01a54fbeb598f06738474682051aa55d5",
    "files": [
        {
            "sha": "69e643a65037510cb0a1d63937a767af40337ac9",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 160,
            "deletions": 0,
            "changes": 160,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=893e85d01a54fbeb598f06738474682051aa55d5",
            "patch": "@@ -1 +1,161 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n+diff -ruN --strip-trailing-cr a/clang/include/clang/Driver/Options.td b/clang/include/clang/Driver/Options.td\n+--- a/clang/include/clang/Driver/Options.td\n++++ b/clang/include/clang/Driver/Options.td\n+@@ -545,15 +545,16 @@\n+               Group<f_Group>;\n+ }\n+ \n+-// Creates a BoolOption where both of the flags are prefixed with \"g\" and have\n+-// the Group<g_Group>.\n++// Creates a BoolOption where both of the flags are prefixed with \"g\".\n++// Does *not* map to g_Group, because that is reserved for flags that are\n++// intended to enable (or disable) debug info, which is not appropriate for a\n++// negative boolean flag (-gno-${feature}).\n+ // Used for -cc1 frontend options. Driver-only options do not map to\n+ // CompilerInvocation.\n+ multiclass BoolGOption<string flag_base, KeyPathAndMacro kpm,\n+                        Default default, FlagDef flag1, FlagDef flag2,\n+                        BothFlags both = BothFlags<[]>> {\n+-  defm NAME : BoolOption<\"g\", flag_base, kpm, default, flag1, flag2, both>,\n+-              Group<g_Group>;\n++  defm NAME : BoolOption<\"g\", flag_base, kpm, default, flag1, flag2, both>;\n+ }\n+ \n+ multiclass BoolMOption<string flag_base, KeyPathAndMacro kpm,\n+@@ -4845,8 +4846,7 @@\n+                   NegFlag<SetFalse>,\n+                   PosFlag<SetTrue, [], [],\n+                           \"Attach linkage names to C++ constructor/destructor \"\n+-                          \"declarations in DWARF.\"\n+-                          \"Implies -g.\">,\n++                          \"declarations in DWARF.\">,\n+                   BothFlags<[], [ClangOption, CLOption, CC1Option]>>,\n+                   DocBrief<[{On some ABIs (e.g., Itanium), constructors and destructors may have multiple variants. Historically, when generating DWARF, Clang did not attach ``DW_AT_linkage_name`` to structor DIEs because there were multiple possible manglings (depending on the structor variant) that could be used. With ``-gstructor-decl-linkage-names``, for ABIs with structor variants, we attach a \"unified\" mangled name to structor declarations DIEs which debuggers can use to look up all the definitions for a structor declaration. E.g., a \"unified\" mangled name ``_ZN3FooC4Ev`` may have multiple definitions associated with it such as ``_ZN3FooC1Ev`` and ``_ZN3FooC2Ev``.\n+ \n+@@ -4855,7 +4855,7 @@\n+     CodeGenOpts<\"DebugKeyInstructions\">, DefaultFalse,\n+     NegFlag<SetFalse>, PosFlag<SetTrue, [], [],\n+         \"Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code\"\n+-        \" in some debuggers. DWARF only. Implies -g.\">,\n++        \" in some debuggers. DWARF only.\">,\n+     BothFlags<[], [ClangOption, CLOption, CC1Option]>>;\n+ def headerpad__max__install__names : Joined<[\"-\"], \"headerpad_max_install_names\">;\n+ def help : Flag<[\"-\", \"--\"], \"help\">,\n+diff -ruN --strip-trailing-cr a/clang/lib/AST/DeclTemplate.cpp b/clang/lib/AST/DeclTemplate.cpp\n+--- a/clang/lib/AST/DeclTemplate.cpp\n++++ b/clang/lib/AST/DeclTemplate.cpp\n+@@ -1670,20 +1670,25 @@\n+     auto P = CTSD->getSpecializedTemplateOrPartial();\n+     TemplateParameterList *TPL;\n+     if (const auto *CTPSD =\n+-            dyn_cast<ClassTemplatePartialSpecializationDecl *>(P))\n++            dyn_cast<ClassTemplatePartialSpecializationDecl *>(P)) {\n+       TPL = CTPSD->getTemplateParameters();\n+-    else\n+-      TPL = cast<ClassTemplateDecl *>(P)->getTemplateParameters();\n++      // FIXME: Obtain Args deduced for the partial specialization.\n++      return {TPL->getParam(Index), {}};\n++    }\n++    TPL = cast<ClassTemplateDecl *>(P)->getTemplateParameters();\n+     return {TPL->getParam(Index), CTSD->getTemplateArgs()[Index]};\n+   }\n+   case Decl::Kind::VarTemplateSpecialization: {\n+     const auto *VTSD = cast<VarTemplateSpecializationDecl>(D);\n+     auto P = VTSD->getSpecializedTemplateOrPartial();\n+     TemplateParameterList *TPL;\n+-    if (const auto *VTPSD = dyn_cast<VarTemplatePartialSpecializationDecl *>(P))\n++    if (const auto *VTPSD =\n++            dyn_cast<VarTemplatePartialSpecializationDecl *>(P)) {\n+       TPL = VTPSD->getTemplateParameters();\n+-    else\n+-      TPL = cast<VarTemplateDecl *>(P)->getTemplateParameters();\n++      // FIXME: Obtain Args deduced for the partial specialization.\n++      return {TPL->getParam(Index), {}};\n++    }\n++    TPL = cast<VarTemplateDecl *>(P)->getTemplateParameters();\n+     return {TPL->getParam(Index), VTSD->getTemplateArgs()[Index]};\n+   }\n+   case Decl::Kind::ClassTemplatePartialSpecialization:\n+diff -ruN --strip-trailing-cr a/clang/test/DebugInfo/KeyInstructions/flag.cpp b/clang/test/DebugInfo/KeyInstructions/flag.cpp\n+--- a/clang/test/DebugInfo/KeyInstructions/flag.cpp\n++++ b/clang/test/DebugInfo/KeyInstructions/flag.cpp\n+@@ -1,12 +1,15 @@\n+ // RUN: %clang -### -target x86_64 -c -gdwarf -gkey-instructions %s 2>&1 | FileCheck %s --check-prefixes=KEY-INSTRUCTIONS\n+ // RUN: %clang -### -target x86_64 -c -gdwarf -gno-key-instructions %s 2>&1 | FileCheck %s --check-prefixes=NO-KEY-INSTRUCTIONS\n++// RUN: %clang -### -target x86_64 -c -gno-key-instructions %s 2>&1 | FileCheck %s --check-prefixes=NO-DEBUG\n+ \n+ //// Help.\n+ // RUN %clang --help | FileCheck %s --check-prefix=HELP\n+-// HELP: -gkey-instructions  Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code in some debuggers. DWARF only. Implies -g.\n++// HELP: -gkey-instructions  Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code in some debuggers. DWARF only.\n+ \n+ // KEY-INSTRUCTIONS: \"-gkey-instructions\"\n+ // NO-KEY-INSTRUCTIONS-NOT: key-instructions\n++// NO-DEBUG-NOT: debug-info-kind\n++// NO-DEBUG-NOT: dwarf\n+ \n+ //// Help hidden: flag should not be visible.\n+ // RUN: %clang --help | FileCheck %s --check-prefix=HELP\n+diff -ruN --strip-trailing-cr a/clang/test/Driver/debug-options.c b/clang/test/Driver/debug-options.c\n+--- a/clang/test/Driver/debug-options.c\n++++ b/clang/test/Driver/debug-options.c\n+@@ -268,11 +268,11 @@\n+ // RUN: %clang -### -c %s 2>&1 | FileCheck -check-prefix=NORNGBSE %s\n+ // RUN: %clang -### -c -fdebug-ranges-base-address -fno-debug-ranges-base-address %s 2>&1 | FileCheck -check-prefix=NORNGBSE %s\n+ //\n+-// RUN: %clang -### -c -gomit-unreferenced-methods -fno-standalone-debug %s 2>&1 | FileCheck -check-prefix=INCTYPES %s\n++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fno-standalone-debug %s 2>&1 | FileCheck -check-prefix=INCTYPES %s\n+ // RUN: %clang -### -c %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n+-// RUN: %clang -### -c -gomit-unreferenced-methods -fdebug-types-section -target x86_64-unknown-linux %s 2>&1 \\\n++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fdebug-types-section -target x86_64-unknown-linux %s 2>&1 \\\n+ // RUN:        | FileCheck -check-prefix=NOINCTYPES %s\n+-// RUN: %clang -### -c -gomit-unreferenced-methods -fstandalone-debug %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fstandalone-debug %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n+ //\n+ // RUN: %clang -### -c -glldb %s 2>&1 | FileCheck -check-prefix=NOPUB %s\n+ // RUN: %clang -### -c -glldb -gno-pubnames %s 2>&1 | FileCheck -check-prefix=NOPUB %s\n+diff -ruN --strip-trailing-cr a/clang/test/SemaTemplate/concepts.cpp b/clang/test/SemaTemplate/concepts.cpp\n+--- a/clang/test/SemaTemplate/concepts.cpp\n++++ b/clang/test/SemaTemplate/concepts.cpp\n+@@ -1476,3 +1476,20 @@\n+ // expected-error@-1 {{static assertion failed due to requirement 'requires { { &f() } -> C; }'}}\n+ \n+ }\n++\n++namespace GH162770 {\n++  enum e {};\n++  template<e> struct s {};\n++\n++  template<typename> struct specialized;\n++  template<e x> struct specialized<s<x>> {\n++    static auto make(auto) -> s<x>;\n++  };\n++\n++  template<e x> struct check {\n++    static constexpr auto m = requires { specialized<s<x>>::make(0); };\n++  };\n++\n++  template<typename... Ts> auto comma = (..., Ts());\n++  auto b = comma<check<e{}>>;\n++} // namespace GH162770\n+diff -ruN --strip-trailing-cr a/clang/test/SemaTemplate/partial-spec-instantiate.cpp b/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n+--- a/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n++++ b/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n+@@ -152,3 +152,16 @@\n+     ClassTemplate<>::Nested<int> instantiation;\n+   }\n+ }\n++#if __cplusplus >= 201103L\n++namespace GH162855 {\n++  template <class...> using A = int;\n++  template <class, int> struct B;\n++  template <class...> struct C;\n++  template <template <class, int...> class TT, long... X>\n++  struct C<TT<int, X...>> {\n++    template <class... Y> using l = A<B<Y, X>...>;\n++  };\n++  template <class> struct D;\n++  template struct C<D<int>>;\n++} // namespace GH162855\n++#endif"
        },
        {
            "sha": "81b4a541598e1da83c88c4005420805e25cd8cde",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=893e85d01a54fbeb598f06738474682051aa55d5",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"891f002026df122b36813b9e1819769c94327503\"\n-    LLVM_SHA256 = \"0576a3a0b6baf63308c1432ef2c4c4f082fc5a9ca4b298f0a741dab044d598b5\"\n+    LLVM_COMMIT = \"3a6b818132e3133c7d33f8f577e62503f12869b4\"\n+    LLVM_SHA256 = \"a0b3de698393e0f49d0aca3f869cc03bf0c59eba0c65f608e565278943c31958\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "2c39b64ee2d04bd58e7cc47f7071b0f29710911f",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 171,
            "deletions": 89,
            "changes": 260,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=893e85d01a54fbeb598f06738474682051aa55d5",
            "patch": "@@ -1,99 +1,181 @@\n-diff --git a/shardy/dialect/sdy/ir/attrs.td b/shardy/dialect/sdy/ir/attrs.td\n-index 363ddb0..d0647ba 100644\n---- a/shardy/dialect/sdy/ir/attrs.td\n-+++ b/shardy/dialect/sdy/ir/attrs.td\n-@@ -567,9 +567,6 @@ def Sdy_DimensionSharding : AttrDef<Sdy_Dialect, \"DimensionSharding\"> {\n- \n-     // Builds a closed `DimensionShardingAttr` matching `dimSharding` in axes and priority.\n-     static DimensionShardingAttr getClosedLike(DimensionShardingAttr sharding);\n--\n--    // Builds an open `DimensionShardingAttr` matching `dimSharding` in axes and priority.\n--    static DimensionShardingAttr getOpenLike(DimensionShardingAttr sharding);\n-   }];\n- }\n- \n-@@ -820,10 +817,6 @@ def Sdy_TensorSharding : AttrDef<Sdy_Dialect, \"TensorSharding\"> {\n-     // and matching `sharding` in dim sharding axes, `mesh_or_ref` and rank.\n-     static TensorShardingAttr getClosedLike(TensorShardingAttr sharding);\n- \n--    // Builds a `TensorShardingAttr` with all dim shardings being marked open\n--    // and matching `sharding` in dim sharding axes, `mesh_or_ref` and rank.\n--    static TensorShardingAttr getOpenLike(TensorShardingAttr sharding);\n--\n-     // Builds a `TensorShardingAttr` with a closed dim sharding for each axis\n-     // list in `axesPerDim`.\n-     static TensorShardingAttr getClosed(\n-diff --git a/shardy/dialect/sdy/ir/dialect.cc b/shardy/dialect/sdy/ir/dialect.cc\n-index 60abf9f..5113b47 100644\n---- a/shardy/dialect/sdy/ir/dialect.cc\n-+++ b/shardy/dialect/sdy/ir/dialect.cc\n-@@ -694,13 +694,6 @@ DimensionShardingAttr DimensionShardingAttr::getClosedLike(\n-                                     /*priority=*/dimSharding.getPriority());\n- }\n- \n--DimensionShardingAttr DimensionShardingAttr::getOpenLike(\n--    DimensionShardingAttr dimSharding) {\n--  return DimensionShardingAttr::get(dimSharding.getContext(),\n--                                    dimSharding.getAxes(), /*isClosed=*/false,\n--                                    /*priority=*/dimSharding.getPriority());\n--}\n--\n- //===----------------------------------------------------------------------===//\n- // TensorShardingAttr\n- //===----------------------------------------------------------------------===//\n-@@ -787,7 +780,8 @@ TensorShardingAttr TensorShardingAttr::closeShardingDims(\n-   SmallVector<DimensionShardingAttr> dimShardings(getDimShardings().begin(),\n-                                                   getDimShardings().end());\n-   for (int64_t dim : dimIndices) {\n--    dimShardings[dim] = DimensionShardingAttr::getClosedLike(dimShardings[dim]);\n-+    dimShardings[dim] = DimensionShardingAttr::get(\n-+        getContext(), dimShardings[dim].getAxes(), /*isClosed=*/true);\n-   }\n-   return TensorShardingAttr::get(getContext(), getMeshOrRef(), dimShardings,\n-                                  getReplicatedAxes(), getUnreducedAxes());\n-@@ -798,7 +792,8 @@ TensorShardingAttr TensorShardingAttr::openShardingDims(\n-   SmallVector<DimensionShardingAttr> dimShardings(getDimShardings().begin(),\n-                                                   getDimShardings().end());\n-   for (int64_t dim : dimIndices) {\n--    dimShardings[dim] = DimensionShardingAttr::getOpenLike(dimShardings[dim]);\n-+    dimShardings[dim] = DimensionShardingAttr::get(\n-+        getContext(), dimShardings[dim].getAxes(), /*isClosed=*/false);\n-   }\n-   return TensorShardingAttr::get(getContext(), getMeshOrRef(), dimShardings,\n-                                  getReplicatedAxes(), getUnreducedAxes());\n-@@ -880,20 +875,6 @@ TensorShardingAttr TensorShardingAttr::getClosedLike(\n-                                  sharding.getUnreducedAxes());\n- }\n- \n--TensorShardingAttr TensorShardingAttr::getOpenLike(\n--    TensorShardingAttr sharding) {\n--  SmallVector<DimensionShardingAttr> openDimShardings(sharding.getRank());\n--  for (int index = 0; index < sharding.getRank(); index++) {\n--    openDimShardings[index] =\n--        DimensionShardingAttr::getOpenLike(sharding.getDimSharding(index));\n--  }\n--  return TensorShardingAttr::get(\n--      sharding.getContext(), sharding.getMeshOrRef(),\n--      /*dimShardings=*/openDimShardings,\n--      /*replicatedAxes=*/sharding.getReplicatedAxes(),\n--      sharding.getUnreducedAxes());\n--}\n--\n- TensorShardingAttr TensorShardingAttr::getClosed(\n-     MLIRContext* context, Attribute meshOrRef,\n-     ArrayRef<SmallVector<AxisRefAttr>> axesPerDim,\n+diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch\n+index 509398d..69e643a 100644\n+--- a/third_party/llvm/generated.patch\n++++ b/third_party/llvm/generated.patch\n+@@ -1 +1,161 @@\n+ Auto generated patch. Do not edit or delete it, even if empty.\n++diff -ruN --strip-trailing-cr a/clang/include/clang/Driver/Options.td b/clang/include/clang/Driver/Options.td\n++--- a/clang/include/clang/Driver/Options.td\n+++++ b/clang/include/clang/Driver/Options.td\n++@@ -545,15 +545,16 @@\n++               Group<f_Group>;\n++ }\n++ \n++-// Creates a BoolOption where both of the flags are prefixed with \"g\" and have\n++-// the Group<g_Group>.\n+++// Creates a BoolOption where both of the flags are prefixed with \"g\".\n+++// Does *not* map to g_Group, because that is reserved for flags that are\n+++// intended to enable (or disable) debug info, which is not appropriate for a\n+++// negative boolean flag (-gno-${feature}).\n++ // Used for -cc1 frontend options. Driver-only options do not map to\n++ // CompilerInvocation.\n++ multiclass BoolGOption<string flag_base, KeyPathAndMacro kpm,\n++                        Default default, FlagDef flag1, FlagDef flag2,\n++                        BothFlags both = BothFlags<[]>> {\n++-  defm NAME : BoolOption<\"g\", flag_base, kpm, default, flag1, flag2, both>,\n++-              Group<g_Group>;\n+++  defm NAME : BoolOption<\"g\", flag_base, kpm, default, flag1, flag2, both>;\n++ }\n++ \n++ multiclass BoolMOption<string flag_base, KeyPathAndMacro kpm,\n++@@ -4845,8 +4846,7 @@\n++                   NegFlag<SetFalse>,\n++                   PosFlag<SetTrue, [], [],\n++                           \"Attach linkage names to C++ constructor/destructor \"\n++-                          \"declarations in DWARF.\"\n++-                          \"Implies -g.\">,\n+++                          \"declarations in DWARF.\">,\n++                   BothFlags<[], [ClangOption, CLOption, CC1Option]>>,\n++                   DocBrief<[{On some ABIs (e.g., Itanium), constructors and destructors may have multiple variants. Historically, when generating DWARF, Clang did not attach ``DW_AT_linkage_name`` to structor DIEs because there were multiple possible manglings (depending on the structor variant) that could be used. With ``-gstructor-decl-linkage-names``, for ABIs with structor variants, we attach a \"unified\" mangled name to structor declarations DIEs which debuggers can use to look up all the definitions for a structor declaration. E.g., a \"unified\" mangled name ``_ZN3FooC4Ev`` may have multiple definitions associated with it such as ``_ZN3FooC1Ev`` and ``_ZN3FooC2Ev``.\n++ \n++@@ -4855,7 +4855,7 @@\n++     CodeGenOpts<\"DebugKeyInstructions\">, DefaultFalse,\n++     NegFlag<SetFalse>, PosFlag<SetTrue, [], [],\n++         \"Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code\"\n++-        \" in some debuggers. DWARF only. Implies -g.\">,\n+++        \" in some debuggers. DWARF only.\">,\n++     BothFlags<[], [ClangOption, CLOption, CC1Option]>>;\n++ def headerpad__max__install__names : Joined<[\"-\"], \"headerpad_max_install_names\">;\n++ def help : Flag<[\"-\", \"--\"], \"help\">,\n++diff -ruN --strip-trailing-cr a/clang/lib/AST/DeclTemplate.cpp b/clang/lib/AST/DeclTemplate.cpp\n++--- a/clang/lib/AST/DeclTemplate.cpp\n+++++ b/clang/lib/AST/DeclTemplate.cpp\n++@@ -1670,20 +1670,25 @@\n++     auto P = CTSD->getSpecializedTemplateOrPartial();\n++     TemplateParameterList *TPL;\n++     if (const auto *CTPSD =\n++-            dyn_cast<ClassTemplatePartialSpecializationDecl *>(P))\n+++            dyn_cast<ClassTemplatePartialSpecializationDecl *>(P)) {\n++       TPL = CTPSD->getTemplateParameters();\n++-    else\n++-      TPL = cast<ClassTemplateDecl *>(P)->getTemplateParameters();\n+++      // FIXME: Obtain Args deduced for the partial specialization.\n+++      return {TPL->getParam(Index), {}};\n+++    }\n+++    TPL = cast<ClassTemplateDecl *>(P)->getTemplateParameters();\n++     return {TPL->getParam(Index), CTSD->getTemplateArgs()[Index]};\n++   }\n++   case Decl::Kind::VarTemplateSpecialization: {\n++     const auto *VTSD = cast<VarTemplateSpecializationDecl>(D);\n++     auto P = VTSD->getSpecializedTemplateOrPartial();\n++     TemplateParameterList *TPL;\n++-    if (const auto *VTPSD = dyn_cast<VarTemplatePartialSpecializationDecl *>(P))\n+++    if (const auto *VTPSD =\n+++            dyn_cast<VarTemplatePartialSpecializationDecl *>(P)) {\n++       TPL = VTPSD->getTemplateParameters();\n++-    else\n++-      TPL = cast<VarTemplateDecl *>(P)->getTemplateParameters();\n+++      // FIXME: Obtain Args deduced for the partial specialization.\n+++      return {TPL->getParam(Index), {}};\n+++    }\n+++    TPL = cast<VarTemplateDecl *>(P)->getTemplateParameters();\n++     return {TPL->getParam(Index), VTSD->getTemplateArgs()[Index]};\n++   }\n++   case Decl::Kind::ClassTemplatePartialSpecialization:\n++diff -ruN --strip-trailing-cr a/clang/test/DebugInfo/KeyInstructions/flag.cpp b/clang/test/DebugInfo/KeyInstructions/flag.cpp\n++--- a/clang/test/DebugInfo/KeyInstructions/flag.cpp\n+++++ b/clang/test/DebugInfo/KeyInstructions/flag.cpp\n++@@ -1,12 +1,15 @@\n++ // RUN: %clang -### -target x86_64 -c -gdwarf -gkey-instructions %s 2>&1 | FileCheck %s --check-prefixes=KEY-INSTRUCTIONS\n++ // RUN: %clang -### -target x86_64 -c -gdwarf -gno-key-instructions %s 2>&1 | FileCheck %s --check-prefixes=NO-KEY-INSTRUCTIONS\n+++// RUN: %clang -### -target x86_64 -c -gno-key-instructions %s 2>&1 | FileCheck %s --check-prefixes=NO-DEBUG\n++ \n++ //// Help.\n++ // RUN %clang --help | FileCheck %s --check-prefix=HELP\n++-// HELP: -gkey-instructions  Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code in some debuggers. DWARF only. Implies -g.\n+++// HELP: -gkey-instructions  Enable Key Instructions, which reduces the jumpiness of debug stepping in optimized C/C++ code in some debuggers. DWARF only.\n++ \n++ // KEY-INSTRUCTIONS: \"-gkey-instructions\"\n++ // NO-KEY-INSTRUCTIONS-NOT: key-instructions\n+++// NO-DEBUG-NOT: debug-info-kind\n+++// NO-DEBUG-NOT: dwarf\n++ \n++ //// Help hidden: flag should not be visible.\n++ // RUN: %clang --help | FileCheck %s --check-prefix=HELP\n++diff -ruN --strip-trailing-cr a/clang/test/Driver/debug-options.c b/clang/test/Driver/debug-options.c\n++--- a/clang/test/Driver/debug-options.c\n+++++ b/clang/test/Driver/debug-options.c\n++@@ -268,11 +268,11 @@\n++ // RUN: %clang -### -c %s 2>&1 | FileCheck -check-prefix=NORNGBSE %s\n++ // RUN: %clang -### -c -fdebug-ranges-base-address -fno-debug-ranges-base-address %s 2>&1 | FileCheck -check-prefix=NORNGBSE %s\n++ //\n++-// RUN: %clang -### -c -gomit-unreferenced-methods -fno-standalone-debug %s 2>&1 | FileCheck -check-prefix=INCTYPES %s\n+++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fno-standalone-debug %s 2>&1 | FileCheck -check-prefix=INCTYPES %s\n++ // RUN: %clang -### -c %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n++-// RUN: %clang -### -c -gomit-unreferenced-methods -fdebug-types-section -target x86_64-unknown-linux %s 2>&1 \\\n+++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fdebug-types-section -target x86_64-unknown-linux %s 2>&1 \\\n++ // RUN:        | FileCheck -check-prefix=NOINCTYPES %s\n++-// RUN: %clang -### -c -gomit-unreferenced-methods -fstandalone-debug %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n+++// RUN: %clang -### -c -g -gomit-unreferenced-methods -fstandalone-debug %s 2>&1 | FileCheck -check-prefix=NOINCTYPES %s\n++ //\n++ // RUN: %clang -### -c -glldb %s 2>&1 | FileCheck -check-prefix=NOPUB %s\n++ // RUN: %clang -### -c -glldb -gno-pubnames %s 2>&1 | FileCheck -check-prefix=NOPUB %s\n++diff -ruN --strip-trailing-cr a/clang/test/SemaTemplate/concepts.cpp b/clang/test/SemaTemplate/concepts.cpp\n++--- a/clang/test/SemaTemplate/concepts.cpp\n+++++ b/clang/test/SemaTemplate/concepts.cpp\n++@@ -1476,3 +1476,20 @@\n++ // expected-error@-1 {{static assertion failed due to requirement 'requires { { &f() } -> C; }'}}\n++ \n++ }\n+++\n+++namespace GH162770 {\n+++  enum e {};\n+++  template<e> struct s {};\n+++\n+++  template<typename> struct specialized;\n+++  template<e x> struct specialized<s<x>> {\n+++    static auto make(auto) -> s<x>;\n+++  };\n+++\n+++  template<e x> struct check {\n+++    static constexpr auto m = requires { specialized<s<x>>::make(0); };\n+++  };\n+++\n+++  template<typename... Ts> auto comma = (..., Ts());\n+++  auto b = comma<check<e{}>>;\n+++} // namespace GH162770\n++diff -ruN --strip-trailing-cr a/clang/test/SemaTemplate/partial-spec-instantiate.cpp b/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n++--- a/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n+++++ b/clang/test/SemaTemplate/partial-spec-instantiate.cpp\n++@@ -152,3 +152,16 @@\n++     ClassTemplate<>::Nested<int> instantiation;\n++   }\n++ }\n+++#if __cplusplus >= 201103L\n+++namespace GH162855 {\n+++  template <class...> using A = int;\n+++  template <class, int> struct B;\n+++  template <class...> struct C;\n+++  template <template <class, int...> class TT, long... X>\n+++  struct C<TT<int, X...>> {\n+++    template <class... Y> using l = A<B<Y, X>...>;\n+++  };\n+++  template <class> struct D;\n+++  template struct C<D<int>>;\n+++} // namespace GH162855\n+++#endif\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index 0afb70d..b28a9da 100644\n+index b28a9da..81b4a54 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"4d45718b478940cd11ac80dd64db8408bb21dbca\"\n--    LLVM_SHA256 = \"ce14b25873232ca904c3d2bba2ca71a358b9124c3107cde52ed1483a3e2603c8\"\n-+    LLVM_COMMIT = \"891f002026df122b36813b9e1819769c94327503\"\n-+    LLVM_SHA256 = \"0576a3a0b6baf63308c1432ef2c4c4f082fc5a9ca4b298f0a741dab044d598b5\"\n+-    LLVM_COMMIT = \"891f002026df122b36813b9e1819769c94327503\"\n+-    LLVM_SHA256 = \"0576a3a0b6baf63308c1432ef2c4c4f082fc5a9ca4b298f0a741dab044d598b5\"\n++    LLVM_COMMIT = \"3a6b818132e3133c7d33f8f577e62503f12869b4\"\n++    LLVM_SHA256 = \"a0b3de698393e0f49d0aca3f869cc03bf0c59eba0c65f608e565278943c31958\"\n  \n      tf_http_archive(\n          name = name,"
        },
        {
            "sha": "a685b7b9de9d65dc8d34e5d9620f07ce414faa9f",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/893e85d01a54fbeb598f06738474682051aa55d5/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=893e85d01a54fbeb598f06738474682051aa55d5",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"eb89d2f7623bf19fb478627a5304eec9d48e26fc\"\n-    SHARDY_SHA256 = \"aa94690e059be52ae95c9d209d6f79c741d33af6983dcdbb40600e3d72f9293b\"\n+    SHARDY_COMMIT = \"f7d73420eb7af1def1f7024db80256f7b8673651\"\n+    SHARDY_SHA256 = \"377a16da94c93a3eb04d4325739b3e7a0514fa8d02395d74f2e15f1b3bff57ca\"\n \n     tf_http_archive(\n         name = \"shardy\","
        }
    ],
    "stats": {
        "total": 428,
        "additions": 335,
        "deletions": 93
    }
}