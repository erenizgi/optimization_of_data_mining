{
    "author": "beckerhe",
    "message": "Remove `if_google` conditions for `google/protobuf` dependencies in XLA BUILD files.\n\nDue to a recent protobuf cleanup, proto dependencies now work correctly in OSS and we can remove a bunch of if_google guards.\n\nPiperOrigin-RevId: 813107970",
    "sha": "f43168339f4104900b797673d9cd83a0161e234b",
    "files": [
        {
            "sha": "c876cf30961e7fc1831800f100d59faa3a18c060",
            "filename": "third_party/xla/xla/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -75,7 +75,8 @@ tf_proto_library(\n     protodeps = [\n         \":xla_data_proto\",\n         \"//xla/service:hlo_proto\",\n-    ] + if_google([\"@com_google_protobuf//:any_proto\"]),\n+        \"@com_google_protobuf//:any_proto\",\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -1339,10 +1340,9 @@ tf_proto_library(\n     make_default_target_header_only = True,\n     protodeps = [\n         \"//xla/tsl/protobuf:dnn_proto\",\n-    ] + if_google([\n         \"@com_google_protobuf//:any_proto\",\n         \"@com_google_protobuf//:duration_proto\",\n-    ]),\n+    ],\n )\n \n cc_library("
        },
        {
            "sha": "c19b3b8f6722c32bfa0dacefbd2c0d5cdfb88722",
            "filename": "third_party/xla/xla/backends/autotuner/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -1,6 +1,5 @@\n load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n-load(\"//xla/tsl:tsl.bzl\", \"if_google\")\n load(\"//xla/tsl/platform:build_config.bzl\", \"tf_proto_library\")\n \n package(\n@@ -59,11 +58,12 @@ cc_library(\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/time\",\n+        \"@com_google_protobuf//:any_cc_proto\",\n         \"@local_tsl//tsl/platform:blocking_counter\",\n         \"@local_tsl//tsl/platform:fingerprint\",\n         \"@local_tsl//tsl/platform:path\",\n         \"@local_tsl//tsl/platform:protobuf\",\n-    ] + if_google([\"@com_google_protobuf//:any_cc_proto\"]),\n+    ],\n )\n \n xla_cc_test(\n@@ -94,16 +94,17 @@ xla_cc_test(\n         \"@com_google_absl//absl/time\",\n         \"@com_google_absl//absl/types:optional\",\n         \"@com_google_googletest//:gtest_main\",\n+        \"@com_google_protobuf//:any_cc_proto\",\n         \"@local_tsl//tsl/platform:path\",\n         \"@local_tsl//tsl/platform:protobuf\",\n         \"@local_tsl//tsl/platform:test\",\n-    ] + if_google([\"@com_google_protobuf//:any_cc_proto\"]),\n+    ],\n )\n \n tf_proto_library(\n     name = \"autotuner_cache_proto\",\n     srcs = [\"autotuner_cache.proto\"],\n-    deps = if_google([\"@com_google_protobuf//:any_proto\"]),\n+    protodeps = [\"@com_google_protobuf//:any_proto\"],\n )\n \n cc_library(\n@@ -175,6 +176,7 @@ xla_cc_test(\n         \"//xla/tsl/util/proto:proto_matchers\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n+        \"@com_google_protobuf//:any_cc_proto\",\n         \"@local_tsl//tsl/platform:path\",\n-    ] + if_google([\"@com_google_protobuf//:any_cc_proto\"]),\n+    ],\n )"
        },
        {
            "sha": "bb7c9d6793ade41a8d523402ce9b5a1de03ec1bd",
            "filename": "third_party/xla/xla/backends/cpu/runtime/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -1,6 +1,6 @@\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\", \"xla_internal\")\n load(\"//xla/service/cpu:build_defs.bzl\", \"runtime_copts\")\n-load(\"//xla/tsl:tsl.bzl\", \"if_google\", \"if_windows\", \"internal_visibility\")\n+load(\"//xla/tsl:tsl.bzl\", \"if_windows\", \"internal_visibility\")\n load(\"//xla/tsl:tsl.default.bzl\", \"filegroup\")\n load(\"//xla/tsl/platform:build_config.bzl\", \"tf_proto_library\")\n load(\"//xla/tsl/platform:rules_cc.bzl\", \"cc_library\")\n@@ -151,7 +151,8 @@ tf_proto_library(\n         \"//xla/service:buffer_assignment_proto\",\n         \"//xla:xla_data_proto\",\n         \"//xla/service:hlo_proto\",\n-    ] + if_google([\"@com_google_protobuf//:any_proto\"]),\n+        \"@com_google_protobuf//:any_proto\",\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n "
        },
        {
            "sha": "b685483bdbe5b958f94a56afca7d6c2b99f04c66",
            "filename": "third_party/xla/xla/pjrt/proto/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fpjrt%2Fproto%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fpjrt%2Fproto%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fproto%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -1,5 +1,4 @@\n # copybara:uncomment load(\"@rules_python//python:proto.bzl\", \"py_proto_library\")\n-load(\"//xla/tsl:tsl.bzl\", \"if_google\")\n load(\"//xla/tsl:tsl.default.bzl\", \"get_compatible_with_libtpu_portable\", \"get_compatible_with_portable\")\n load(\n     \"//xla/tsl/platform:build_config.bzl\",\n@@ -58,6 +57,6 @@ tf_proto_library(\n     name = \"topology_description_proto\",\n     srcs = [\"topology_description.proto\"],\n     compatible_with = (get_compatible_with_libtpu_portable() + get_compatible_with_portable()),\n+    protodeps = [\"@com_google_protobuf//:any_proto\"],\n     visibility = [\"//visibility:public\"],\n-    deps = if_google([\"@com_google_protobuf//:any_proto\"]),\n )"
        },
        {
            "sha": "02b9fb13ebc75774b8cb5ae7a1c8ea28f3d98d85",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -2,7 +2,7 @@ load(\"@bazel_skylib//rules:build_test.bzl\", \"build_test\")\n load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n load(\"//xla/python/pjrt_ifrt:pjrt_ifrt.bzl\", \"pjrt_ifrt_package_groups\")\n-load(\"//xla/tsl:tsl.bzl\", \"if_google\", \"internal_visibility\")\n+load(\"//xla/tsl:tsl.bzl\", \"internal_visibility\")\n load(\"//xla/tsl:tsl.default.bzl\", \"get_compatible_with_portable\")\n load(\"//xla/tsl/platform:build_config.bzl\", \"tf_proto_library\")\n # copybara:uncomment load(\"@bazel_skylib//:bzl_library.bzl\", \"bzl_library\")\n@@ -65,7 +65,8 @@ tf_proto_library(\n     srcs = [\"xla_host_callback.proto\"],\n     protodeps = [\n         \"//xla:xla_data_proto\",\n-    ] + if_google([\"@com_google_protobuf//:any_proto\"]),\n+        \"@com_google_protobuf//:any_proto\",\n+    ],\n )\n \n tf_proto_library("
        },
        {
            "sha": "0ad3a570a2f3c8a878b9e1c4451ae403f3a6fbef",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -51,7 +51,8 @@ tf_proto_library(\n     protodeps = [\n         \"//xla:xla_data_proto\",\n         \"//xla/service:metrics_proto\",\n-    ] + if_google([\"@com_google_protobuf//:any_proto\"]),\n+        \"@com_google_protobuf//:any_proto\",\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -77,11 +78,11 @@ tf_proto_library(\n     name = \"metrics_proto\",\n     srcs = [\"metrics.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = if_google([\n+    protodeps = [\n         \"@com_google_protobuf//:any_proto\",\n         \"@com_google_protobuf//:duration_proto\",\n         \"@com_google_protobuf//:timestamp_proto\",\n-    ]),\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -5518,14 +5519,15 @@ cc_library(\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n+        \"@com_google_protobuf//:any_cc_proto\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:casts\",\n         \"@local_tsl//tsl/platform:errors\",\n         \"@local_tsl//tsl/platform:logging\",  # fixdeps: keep\n         \"@local_tsl//tsl/platform:protobuf\",\n         \"@local_tsl//tsl/platform:status\",\n         \"@local_tsl//tsl/platform:statusor\",\n-    ] + if_google([\"@com_google_protobuf//:any_cc_proto\"]),\n+    ],\n )\n \n cc_library(\n@@ -6030,7 +6032,8 @@ tf_proto_library(\n     protodeps = [\n         \":hlo_proto\",\n         \"//xla/tsl/protobuf:status_proto\",\n-    ] + if_google([\"@com_google_protobuf//:duration_proto\"]),\n+        \"@com_google_protobuf//:duration_proto\",\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n "
        },
        {
            "sha": "3d4b16005fcf5935480727885074057d76b41519",
            "filename": "third_party/xla/xla/tsl/platform/default/build_config.bzl",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -231,7 +231,11 @@ def tf_proto_library(\n     native.proto_library(\n         name = name,\n         srcs = srcs,\n-        deps = deps + protodeps + well_known_proto_libs(),\n+        deps = deps + protodeps + [\n+            proto_lib\n+            for proto_lib in well_known_proto_libs()\n+            if proto_lib not in protodeps\n+        ],\n         exports = exports,\n         compatible_with = compatible_with,\n         visibility = visibility,"
        },
        {
            "sha": "b7c30635578d7faee9f7e1ef2dc52be6ef6f6e8a",
            "filename": "third_party/xla/xla/tsl/protobuf/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Ftsl%2Fprotobuf%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f43168339f4104900b797673d9cd83a0161e234b/third_party%2Fxla%2Fxla%2Ftsl%2Fprotobuf%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprotobuf%2FBUILD?ref=f43168339f4104900b797673d9cd83a0161e234b",
            "patch": "@@ -28,18 +28,18 @@ tf_proto_library(\n     name = \"test_log_proto\",\n     srcs = [\"test_log.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = if_google([\n+    protodeps = [\n         \"@com_google_protobuf//:any_proto\",\n         \"@com_google_protobuf//:wrappers_proto\",\n-    ]),\n+    ],\n     visibility = [\"//visibility:public\"],\n )\n \n tf_proto_library(\n     name = \"dnn_proto\",\n     srcs = [\"dnn.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = if_google([\"@com_google_protobuf//:wrappers_proto\"]),\n+    protodeps = [\"@com_google_protobuf//:wrappers_proto\"],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -73,7 +73,7 @@ tf_proto_library(\n     create_java_proto = False,\n     create_kotlin_proto = False,\n     create_service = True,\n-    protodeps = if_google([\"@com_google_protobuf//:any_proto\"]),\n+    protodeps = [\"@com_google_protobuf//:any_proto\"],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -103,7 +103,7 @@ tf_proto_library(\n     name = \"error_codes_proto_impl\",\n     srcs = [\"error_codes.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = if_google([\"@com_google_protobuf//:any_proto\"]),\n+    protodeps = [\"@com_google_protobuf//:any_proto\"],\n     visibility = [\"//visibility:public\"],\n )\n \n@@ -123,6 +123,7 @@ tf_proto_library(\n         \":rpc_options_proto\",\n         \":status_proto\",\n         \":test_log_proto\",\n-    ] + if_google([\"@com_google_protobuf//:any_proto\"]),\n+        \"@com_google_protobuf//:any_proto\",\n+    ],\n     visibility = [\"//visibility:public\"],\n )"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 37,
        "deletions": 26
    }
}