{
    "author": "apivovarov",
    "message": "This change replaces uses of std::next_permutation with absl::c_next_permutation, which operate directly on containers. This simplifies the code by removing the need to pass begin() and end() iterators.\n\nAlso includes minor refactoring of if/else structures and updates function signatures for clarity.\n\nPiperOrigin-RevId: 837296580",
    "sha": "50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
    "files": [
        {
            "sha": "91f239040db42ae9e833e011f1b2a43d704abbb0",
            "filename": "third_party/xla/xla/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2FBUILD?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -385,6 +385,7 @@ xla_cc_test(\n         \":permutation_util\",\n         \"//xla/hlo/testlib:test\",\n         \"//xla/tsl/platform:test_main\",\n+        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_googletest//:gtest\",\n     ],\n )\n@@ -557,13 +558,13 @@ xla_cc_test(\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test_benchmark\",\n         \"//xla/tsl/platform:test_main\",\n+        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/status\",\n-        \"@com_google_absl//absl/status:status_matchers\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n         \"@com_google_googletest//:gtest\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n+        \"@com_google_protobuf//:protobuf\",\n     ],\n )\n "
        },
        {
            "sha": "f688617539ae56c7c89c9c6e72a691efecb2e017",
            "filename": "third_party/xla/xla/mlir/tools/mlir_interpreter/framework/tests/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2FBUILD?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -7,6 +7,7 @@ xla_cc_test(\n     srcs = [\"tensor_or_memref_test.cc\"],\n     deps = [\n         \"//xla/mlir/tools/mlir_interpreter/framework\",\n+        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@llvm-project//llvm:Support\","
        },
        {
            "sha": "188996a1701a244fffb0695665a857a8a1c8a39a",
            "filename": "third_party/xla/xla/mlir/tools/mlir_interpreter/framework/tests/tensor_or_memref_test.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2Ftensor_or_memref_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2Ftensor_or_memref_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir%2Ftools%2Fmlir_interpreter%2Fframework%2Ftests%2Ftensor_or_memref_test.cc?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -15,12 +15,12 @@ limitations under the License.\n \n #include \"xla/mlir/tools/mlir_interpreter/framework/tensor_or_memref.h\"\n \n-#include <algorithm>\n #include <cstdint>\n #include <optional>\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/algorithm/container.h\"\n #include \"absl/strings/str_join.h\"\n #include \"llvm/ADT/STLExtras.h\"\n #include \"llvm/ADT/SmallBitVector.h\"\n@@ -63,8 +63,12 @@ std::optional<int64_t> GetCollapsedStrideNaive(llvm::ArrayRef<int64_t> dims,\n     v[*view.GetPhysicalIndex(view_indices)] = true;\n   }\n \n-  if (v.count() != f.GetNumElements()) return std::nullopt;\n-  if (f.GetNumElements() <= 1) return 0;\n+  if (v.count() != f.GetNumElements()) {\n+    return std::nullopt;\n+  }\n+  if (f.GetNumElements() <= 1) {\n+    return 0;\n+  }\n \n   // Check that they have a common stride.\n   int64_t min = v.find_first();\n@@ -79,21 +83,23 @@ std::optional<int64_t> GetCollapsedStrideNaive(llvm::ArrayRef<int64_t> dims,\n }\n \n TEST(TensorOrMemrefTest, CollapsedStride) {\n-  BufferView view{.sizes = {1, 2, 3, 1, 5},\n-                  .strides = BufferView::GetDefaultStrides({1, 2, 3, 1, 5})};\n+  BufferView view{/*offset=*/0, /*sizes=*/{1, 2, 3, 1, 5},\n+                  /*strides=*/BufferView::GetDefaultStrides({1, 2, 3, 1, 5})};\n \n   auto check_all = [&]() {\n     for (int64_t i = 0; i < (1 << view.num_dimensions()); ++i) {\n       SmallVector<int64_t> dims;\n       for (int64_t dim = 0; dim < view.num_dimensions(); ++dim) {\n-        if (i & (1 << dim)) dims.push_back(dim);\n+        if (i & (1 << dim)) {\n+          dims.push_back(dim);\n+        }\n       }\n \n       do {\n         auto v = view.GetCollapsedStride(dims);\n         auto n = GetCollapsedStrideNaive(dims, view);\n         EXPECT_EQ(n, v) << \"checking \" << absl::StrJoin(dims, \", \");\n-      } while (std::next_permutation(dims.begin(), dims.end()));\n+      } while (absl::c_next_permutation(dims));\n     }\n   };\n "
        },
        {
            "sha": "9cc93f66df69b9c41413f6d145d3a35f0ba717b4",
            "filename": "third_party/xla/xla/permutation_util_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fpermutation_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fpermutation_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpermutation_util_test.cc?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -15,13 +15,13 @@ limitations under the License.\n \n #include \"xla/permutation_util.h\"\n \n-#include <algorithm>\n #include <cstdint>\n #include <string>\n #include <vector>\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/algorithm/container.h\"\n #include \"xla/hlo/testlib/test.h\"\n \n namespace xla {\n@@ -53,11 +53,11 @@ TEST(PermutationUtilTest, IsIdentityPermutation_TrueCases) {\n \n TEST(PermutationUtilTest, IsIdentityPermutation_FalseCases) {\n   std::vector<int> v{0, 1, 2, 3};\n-  std::next_permutation(v.begin(), v.end());\n+  absl::c_next_permutation(v);\n \n   do {\n     EXPECT_FALSE(IsIdentityPermutation(v));\n-  } while (std::next_permutation(v.begin(), v.end()));\n+  } while (absl::c_next_permutation(v));\n }\n \n TEST(PermutationUtilTest, PermuteInverse) {\n@@ -90,7 +90,7 @@ TEST(PermutationUtilTest, ComposeAndInversePermutations) {\n \n   do {\n     EXPECT_EQ(ComposePermutations(InversePermutation(p), p), id);\n-  } while (std::next_permutation(p.begin(), p.end()));\n+  } while (absl::c_next_permutation(p));\n }\n \n }  // namespace"
        },
        {
            "sha": "6aee1856096bf0c58e16d6688861fe37a40d612d",
            "filename": "third_party/xla/xla/shape_util_test.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fshape_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Fshape_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fshape_util_test.cc?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include \"xla/shape_util.h\"\n \n-#include <algorithm>\n #include <cstddef>\n #include <cstdint>\n #include <numeric>\n@@ -25,12 +24,13 @@ limitations under the License.\n #include <vector>\n \n #include <gtest/gtest.h>\n+#include \"absl/algorithm/container.h\"\n #include \"absl/status/status.h\"\n-#include \"absl/status/status_matchers.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/types/span.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/hlo/testlib/test.h\"\n #include \"xla/layout.h\"\n #include \"xla/layout_util.h\"\n@@ -41,12 +41,10 @@ limitations under the License.\n #include \"xla/tsl/platform/threadpool.h\"\n #include \"xla/util.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/protobuf.h\"\n \n namespace xla {\n namespace {\n \n-using ::absl_testing::StatusIs;\n using ::testing::ElementsAre;\n \n TEST(ShapeUtilTest, GetDimensionHelperCanNegativeIndex) {\n@@ -1055,8 +1053,8 @@ TEST(ShapeUtilTest, PermuteDimensionsLayout) {\n \n       EXPECT_TRUE(ShapeUtil::TransposeIsBitcast(\n           s, ShapeUtil::PermuteDimensions(permutation, s), permutation));\n-    } while (std::next_permutation(permutation.begin(), permutation.end()));\n-  } while (std::next_permutation(layout.begin(), layout.end()));\n+    } while (absl::c_next_permutation(permutation));\n+  } while (absl::c_next_permutation(layout));\n }\n \n TEST(ShapeUtilTest, UpdateDynamicDimensions) {\n@@ -1094,7 +1092,7 @@ TEST(ShapeUtilTest, PermuteDynamicDimensions) {\n       EXPECT_EQ(permuted.is_dynamic_dimension(i),\n                 shape.is_dynamic_dimension(permutation[i]));\n     }\n-  } while (std::next_permutation(permutation.begin(), permutation.end()));\n+  } while (absl::c_next_permutation(permutation));\n }\n \n TEST(ShapeUtilTest, PrependMajorDimension) {"
        },
        {
            "sha": "457d254f17cdc273c35ab08450c0cc7b33911382",
            "filename": "third_party/xla/xla/tests/client_library_test_base.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Ftests%2Fclient_library_test_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe/third_party%2Fxla%2Fxla%2Ftests%2Fclient_library_test_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fclient_library_test_base.cc?ref=50f5b5cb8dab5dd26a2b8fb3bee5ad2831f709fe",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include \"xla/tests/client_library_test_base.h\"\n \n-#include <algorithm>\n #include <cstdint>\n #include <functional>\n #include <iterator>\n@@ -232,7 +231,7 @@ ClientLibraryTestBase::ComputeAndCompareLiteralWithAllOutputLayouts(\n     verify_output(actual,\n                   absl::StrCat(\"Test with output layout: \",\n                                ShapeUtil::HumanStringWithLayout(layout)));\n-  } while (std::next_permutation(minor_to_major.begin(), minor_to_major.end()));\n+  } while (absl::c_next_permutation(minor_to_major));\n   return absl::OkStatus();\n }\n \n@@ -277,8 +276,7 @@ absl::Status ClientLibraryTestBase::ComputeAndCompareLiteralWithAllInputLayouts(\n         TF_RETURN_IF_ERROR(choose(index + 1));\n         arguments_with_layout.pop_back();\n         layout_strings.pop_back();\n-      } while (\n-          std::next_permutation(minor_to_major.begin(), minor_to_major.end()));\n+      } while (absl::c_next_permutation(minor_to_major));\n       return absl::OkStatus();\n     }\n "
        }
    ],
    "stats": {
        "total": 52,
        "additions": 28,
        "deletions": 24
    }
}