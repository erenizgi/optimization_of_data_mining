{
    "author": "junwhanahn",
    "message": "Stop enabling multi-threading in the MLIR context and expect the program to be already in the right context\n\nPiperOrigin-RevId: 808354670",
    "sha": "4136a234cfbe17dfc65068ea694dcba6a82b559a",
    "files": [
        {
            "sha": "24f25032bba096237fc2382b4c114b791e0d987c",
            "filename": "third_party/xla/xla/python/ifrt/ir/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4136a234cfbe17dfc65068ea694dcba6a82b559a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4136a234cfbe17dfc65068ea694dcba6a82b559a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2FBUILD?ref=4136a234cfbe17dfc65068ea694dcba6a82b559a",
            "patch": "@@ -482,7 +482,6 @@ cc_library(\n         \"//xla/python/ifrt/support:module_parsing\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n-        \"@com_google_absl//absl/cleanup\",\n         \"@com_google_absl//absl/container:inlined_vector\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\","
        },
        {
            "sha": "c8f9617f6b4199f45c48794900b61d0d2777b27d",
            "filename": "third_party/xla/xla/python/ifrt/ir/compiled_ifrt_ir_program.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4136a234cfbe17dfc65068ea694dcba6a82b559a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4136a234cfbe17dfc65068ea694dcba6a82b559a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fcompiled_ifrt_ir_program.cc?ref=4136a234cfbe17dfc65068ea694dcba6a82b559a",
            "patch": "@@ -22,7 +22,6 @@ limitations under the License.\n #include <variant>\n #include <vector>\n \n-#include \"absl/cleanup/cleanup.h\"\n #include \"absl/container/inlined_vector.h\"\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n@@ -338,20 +337,6 @@ absl::StatusOr<CompiledIfrtIrProgram> CompiledIfrtIrProgram::Create(\n                     compile_options->mlir_dump_pass_re,\n                     compile_options->mlir_dump_func_re,\n                     compile_options->mlir_enable_timing);\n-    // We need to ensure that Multithreading is enabled in order to be able\n-    // to dispatch compilations from multiple threads. Otherwise, we would\n-    // trigger data races while printing the ModuleOps for creating the\n-    // compilation cache keys\n-    // (see llvm/llvm-project/mlir/lib/Support/StorageUniquer.cpp).\n-    // JAX currently disables Multithreading for all contexts, but temporarily\n-    // enabling multithreading here is safe because the context is not shared\n-    // across JAX ModuleOps.\n-    bool wasMultithreaded = context->isMultithreadingEnabled();\n-    context->enableMultithreading(true);\n-    absl::Cleanup reset_multithreading = [&]() {\n-      context->enableMultithreading(wasMultithreaded);\n-    };\n-\n     xla::ifrt::IfrtToOutlinedAtomProgramsPipelineOptions\n         outline_pipeline_options;\n     outline_pipeline_options.propagate_shardings ="
        }
    ],
    "stats": {
        "total": 16,
        "additions": 0,
        "deletions": 16
    }
}