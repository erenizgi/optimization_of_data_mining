{
    "author": "SergejSalnikov",
    "message": "Use deps instead of deprecated protodeps field in tf_proto_library\nas it has better compatibility with the tools.\n\nPiperOrigin-RevId: 844954652",
    "sha": "bc72b2ce8d0eb465d783f2bc4127e487e5a229e3",
    "files": [
        {
            "sha": "6ba886d2266ad146d9f75178d1aa3092ea9dd84a",
            "filename": "tensorflow/core/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2FBUILD?ref=bc72b2ce8d0eb465d783f2bc4127e487e5a229e3",
            "patch": "@@ -174,23 +174,23 @@ tf_proto_library(\n     srcs = [],\n     create_go_proto = False,\n     make_default_target_header_only = True,\n-    protodeps = [\n+    visibility = [\"//visibility:public\"],\n+    deps = [\n         \"//tensorflow/core/example:protos_all\",\n         \"//tensorflow/core/framework:protos_all\",\n+        \"//tensorflow/core/grappler/costs:op_performance_data\",\n         \"//tensorflow/core/lib/core:error_codes_proto\",\n         \"//tensorflow/core/profiler:profiler_options_proto\",\n         \"//tensorflow/core/protobuf:error_codes_proto_impl\",\n         \"//tensorflow/core/protobuf:for_core_protos\",\n         \"//tensorflow/core/util:protos_all\",\n         \"//tensorflow/core/util:test_log_proto\",\n-        \"//tensorflow/core/grappler/costs:op_performance_data\",\n         \"@local_tsl//tsl/profiler/protobuf:profiler_options_proto\",\n         \"@local_tsl//tsl/profiler/protobuf:xplane_proto\",\n         \"@local_xla//xla/tsl/protobuf:coordination_config_proto\",\n         \"@local_xla//xla/tsl/protobuf:distributed_runtime_payloads_proto\",\n         \"@local_xla//xla/tsl/protobuf:status_proto\",\n     ],\n-    visibility = [\"//visibility:public\"],\n )\n \n tf_jspb_proto_library("
        },
        {
            "sha": "b6d0a1bee44ad3071be8ad0bec673b88c8184a4c",
            "filename": "tensorflow/core/framework/BUILD",
            "status": "modified",
            "additions": 42,
            "deletions": 42,
            "changes": 84,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2Fframework%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2Fframework%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2FBUILD?ref=bc72b2ce8d0eb465d783f2bc4127e487e5a229e3",
            "patch": "@@ -1554,7 +1554,7 @@ tf_proto_library(\n     name = \"log_memory_proto\",\n     srcs = [\"log_memory.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":allocation_description_proto\",\n         \":tensor_description_proto\",\n         \":tensor_shape_proto\",\n@@ -1572,7 +1572,8 @@ tf_proto_library(\n     name = \"graph_proto\",\n     srcs = [\"graph.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    visibility = [\"//visibility:public\"],\n+    deps = [\n         \":attr_value_proto\",\n         \":function_proto\",\n         \":graph_debug_info_proto\",\n@@ -1584,14 +1585,13 @@ tf_proto_library(\n         \":types_proto\",\n         \":versions_proto\",\n     ],\n-    visibility = [\"//visibility:public\"],\n )\n \n tf_proto_library(\n     name = \"node_def_proto\",\n     srcs = [\"node_def.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":attr_value_proto\",\n         \":full_type_proto\",\n         \":resource_handle_proto\",\n@@ -1623,7 +1623,7 @@ tf_proto_library(\n     name = \"tensor_description_proto\",\n     srcs = [\"tensor_description.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":allocation_description_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n@@ -1641,7 +1641,7 @@ tf_proto_library(\n     name = \"resource_handle_proto\",\n     srcs = [\"resource_handle.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":tensor_shape_proto\",\n         \":types_proto\",\n     ],\n@@ -1651,7 +1651,7 @@ tf_proto_library(\n     name = \"step_stats_proto\",\n     srcs = [\"step_stats.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":allocation_description_proto\",\n         \":tensor_description_proto\",\n         \":tensor_shape_proto\",\n@@ -1669,7 +1669,7 @@ tf_proto_library(\n     name = \"kernel_def_proto\",\n     srcs = [\"kernel_def.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":attr_value_proto\",\n         \":resource_handle_proto\",\n         \":tensor_proto\",\n@@ -1682,30 +1682,24 @@ tf_proto_library(\n     name = \"op_def_proto\",\n     srcs = [\"op_def.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    visibility = [\n+        \"//tensorflow/core:__subpackages__\",\n+        \"//tensorflow/python:__pkg__\",\n+    ],\n+    deps = [\n         \":attr_value_proto\",\n         \":full_type_proto\",\n         \":resource_handle_proto\",\n         \":tensor_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n     ],\n-    visibility = [\n-        \"//tensorflow/core:__subpackages__\",\n-        \"//tensorflow/python:__pkg__\",\n-    ],\n )\n \n tf_proto_library(\n     name = \"attr_value_proto\",\n     srcs = [\"attr_value.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n-        \":resource_handle_proto\",\n-        \":tensor_proto\",\n-        \":tensor_shape_proto\",\n-        \":types_proto\",\n-    ],\n     visibility = [\n         #internal library,\n         \"//tensorflow/core:__subpackages__\",\n@@ -1714,20 +1708,26 @@ tf_proto_library(\n         \"//tensorflow/security/fuzzing:__subpackages__\",\n         \"//waymo/ml/deploy/benchmark:__subpackages__\",\n     ],\n+    deps = [\n+        \":resource_handle_proto\",\n+        \":tensor_proto\",\n+        \":tensor_shape_proto\",\n+        \":types_proto\",\n+    ],\n )\n \n tf_proto_library(\n     name = \"full_type_proto\",\n     srcs = [\"full_type.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [],\n+    deps = [],\n )\n \n tf_proto_library(\n     name = \"tensor_proto\",\n     srcs = [\"tensor.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":resource_handle_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n@@ -1744,7 +1744,7 @@ tf_proto_library(\n     name = \"api_def_proto\",\n     srcs = [\"api_def.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":attr_value_proto\",\n         \":resource_handle_proto\",\n         \":tensor_proto\",\n@@ -1757,7 +1757,7 @@ tf_proto_library(\n     name = \"cpp_shape_inference_proto\",\n     srcs = [\"cpp_shape_inference.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":full_type_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n@@ -1774,7 +1774,7 @@ tf_proto_library(\n     name = \"graph_transfer_info_proto\",\n     srcs = [\"graph_transfer_info.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":types_proto\",\n     ],\n )\n@@ -1796,7 +1796,7 @@ tf_proto_library(\n     name = \"cost_graph_proto\",\n     srcs = [\"cost_graph.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":tensor_shape_proto\",\n         \":types_proto\",\n     ],\n@@ -1812,7 +1812,10 @@ tf_proto_library(\n     name = \"function_proto\",\n     srcs = [\"function.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    visibility = [\n+        \"//tensorflow/python:__pkg__\",\n+    ] + default_visibility,\n+    deps = [\n         \":attr_value_proto\",\n         \":node_def_proto\",\n         \":op_def_proto\",\n@@ -1821,9 +1824,6 @@ tf_proto_library(\n         \":tensor_shape_proto\",\n         \":types_proto\",\n     ],\n-    visibility = [\n-        \"//tensorflow/python:__pkg__\",\n-    ] + default_visibility,\n )\n \n # copybara:uncomment_begin(google-only)\n@@ -1840,14 +1840,14 @@ tf_proto_library(\n     name = \"summary_proto\",\n     srcs = [\"summary.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    exports = [\"@local_xla//xla/tsl/protobuf:histogram_proto\"],\n+    deps = [\n         \":resource_handle_proto\",\n         \":tensor_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n         \"@local_xla//xla/tsl/protobuf:histogram_proto\",\n     ],\n-    exports = [\"@local_xla//xla/tsl/protobuf:histogram_proto\"],\n )\n \n tf_proto_library(\n@@ -1860,7 +1860,7 @@ tf_proto_library(\n     name = \"dataset_proto\",\n     srcs = [\"dataset.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":tensor_proto\",\n         \":tensor_shape_proto\",\n         \":types_proto\",\n@@ -1877,7 +1877,7 @@ tf_proto_library(\n     name = \"dataset_options_proto\",\n     srcs = [\"dataset_options.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    deps = [\n         \":model_proto\",\n     ],\n )\n@@ -1886,24 +1886,27 @@ tf_proto_library(\n     name = \"optimized_function_graph_proto\",\n     srcs = [\"optimized_function_graph.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n-        \":types_proto\",\n+    deps = [\n         \":graph_proto\",\n+        \":types_proto\",\n     ],\n )\n \n tf_proto_library(\n     name = \"protos_all\",\n     make_default_target_header_only = True,\n-    protodeps = [\n+    tags = [\n+        \"alt_dep=//third_party/tensorflow/core:protos_all\",\n+    ],\n+    deps = [\n         \":allocation_description_proto\",\n         \":api_def_proto\",\n-        \":cpp_shape_inference_proto\",\n         \":attr_value_proto\",\n         \":cost_graph_proto\",\n-        \":dataset_proto\",\n+        \":cpp_shape_inference_proto\",\n         \":dataset_metadata_proto\",\n         \":dataset_options_proto\",\n+        \":dataset_proto\",\n         \":device_attributes_proto\",\n         \":full_type_proto\",\n         \":function_proto\",\n@@ -1914,8 +1917,8 @@ tf_proto_library(\n         \":log_memory_proto\",\n         \":model_proto\",\n         \":node_def_proto\",\n-        \":optimized_function_graph_proto\",\n         \":op_def_proto\",\n+        \":optimized_function_graph_proto\",\n         \":reader_base_proto\",\n         \":resource_handle_proto\",\n         \":step_stats_proto\",\n@@ -1928,9 +1931,6 @@ tf_proto_library(\n         \":variable_proto\",\n         \":versions_proto\",\n     ],\n-    tags = [\n-        \"alt_dep=//third_party/tensorflow/core:protos_all\",\n-    ],\n )\n \n tf_cc_fuzz_test("
        },
        {
            "sha": "05ae29c1619d870eb7ee2dc7d75476bde3480f54",
            "filename": "tensorflow/core/util/BUILD",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2Futil%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bc72b2ce8d0eb465d783f2bc4127e487e5a229e3/tensorflow%2Fcore%2Futil%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Futil%2FBUILD?ref=bc72b2ce8d0eb465d783f2bc4127e487e5a229e3",
            "patch": "@@ -953,46 +953,46 @@ tf_proto_library(\n     name = \"test_log_proto\",\n     srcs = [\"test_log.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\"@local_xla//xla/tsl/protobuf:test_log_proto\"],\n     # Not to be used outside of tensorflow/core.\n     visibility = [\"//tensorflow/core:__pkg__\"],\n     exports = [\"@local_xla//xla/tsl/protobuf:test_log_proto\"],\n+    deps = [\"@local_xla//xla/tsl/protobuf:test_log_proto\"],\n )\n \n tf_proto_library(\n     name = \"protos_test\",\n     srcs = [\"example_proto_fast_parsing_test.proto\"],\n-    protodeps = [\"//tensorflow/core:protos_all\"],\n     visibility = [\"//visibility:public\"],\n+    deps = [\"//tensorflow/core:protos_all\"],\n )\n \n tf_proto_library(\n     name = \"event_proto\",\n     srcs = [\"event.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n-        \"//tensorflow/core/framework:summary_proto\",\n+    visibility = [\"//visibility:public\"],\n+    deps = [\n         \"//tensorflow/core/framework:resource_handle_proto\",\n+        \"//tensorflow/core/framework:summary_proto\",\n         \"//tensorflow/core/framework:tensor_proto\",\n         \"//tensorflow/core/framework:tensor_shape_proto\",\n         \"//tensorflow/core/framework:types_proto\",\n     ],\n-    visibility = [\"//visibility:public\"],\n )\n \n tf_proto_library(\n     name = \"saved_tensor_slice_proto\",\n     srcs = [\"saved_tensor_slice.proto\"],\n     make_default_target_header_only = True,\n-    protodeps = [\n+    visibility = [\"//visibility:public\"],\n+    deps = [\n         \"//tensorflow/core/framework:resource_handle_proto\",\n         \"//tensorflow/core/framework:tensor_proto\",\n         \"//tensorflow/core/framework:tensor_shape_proto\",\n         \"//tensorflow/core/framework:tensor_slice_proto\",\n         \"//tensorflow/core/framework:types_proto\",\n         \"//tensorflow/core/framework:versions_proto\",\n     ],\n-    visibility = [\"//visibility:public\"],\n )\n \n tf_proto_library(\n@@ -1005,16 +1005,16 @@ tf_proto_library(\n tf_proto_library(\n     name = \"protos_all\",\n     make_default_target_header_only = True,\n-    protodeps = [\n-        \":event_proto\",\n-        \":saved_tensor_slice_proto\",\n-        \":memmapped_file_system_proto\",\n-        \"//tensorflow/core/util/quantization:uniform_quant_ops_attr_proto\",\n-    ],\n     tags = [\n         \"alt_dep=//third_party/tensorflow/core:protos_all\",\n     ],\n     visibility = [\"//tensorflow/core:__subpackages__\"],\n+    deps = [\n+        \":event_proto\",\n+        \":memmapped_file_system_proto\",\n+        \":saved_tensor_slice_proto\",\n+        \"//tensorflow/core/util/quantization:uniform_quant_ops_attr_proto\",\n+    ],\n )\n \n cc_library("
        }
    ],
    "stats": {
        "total": 116,
        "additions": 58,
        "deletions": 58
    }
}