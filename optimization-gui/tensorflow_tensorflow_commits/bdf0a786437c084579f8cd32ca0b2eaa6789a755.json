{
    "author": "d4n1elchen",
    "message": "[HLO Diff] Add prefixes to diff IDs and adjust CSS for HLO diff rendering.\n\nThe `diffid` and `mapped_diffid` now include \"left:\" or \"right:\" prefixes to ensure unique identification across the two modules, even for instructions with identical names. CSS is updated to reserve space for borders on HLO instructions, preventing layout shifts when an instruction is highlighted.\n\nPiperOrigin-RevId: 809196988",
    "sha": "bdf0a786437c084579f8cd32ca0b2eaa6789a755",
    "files": [
        {
            "sha": "ac91de07acc1e0e2ac7a0ca9bf41821837131a53",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/render/hlo_gumgraph_html_renderer.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 23,
            "changes": 48,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdf0a786437c084579f8cd32ca0b2eaa6789a755/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdf0a786437c084579f8cd32ca0b2eaa6789a755/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc?ref=bdf0a786437c084579f8cd32ca0b2eaa6789a755",
            "patch": "@@ -239,6 +239,8 @@ std::string PrintCss() {\n       display: flex;\n       width: 100%;\n       align-items: flex-start;\n+      border: 2px solid transparent;\n+      box-sizing: border-box;\n     }\n     div.hlo-instruction.expanded {\n       max-width: unset;\n@@ -286,7 +288,7 @@ std::string PrintCss() {\n       line-height: 1.1;\n       cursor: pointer;\n     }\n-    div.bordered {\n+    div.hlo-instruction.bordered {\n       border: 2px solid #4285F4;\n     }\n \n@@ -804,42 +806,42 @@ absl::flat_hash_map<const HloInstruction*, Attributes> GenerateSpanAttributes(\n   for (auto& instruction : diff_result.left_module_unmatched_instructions) {\n     span_attributes[instruction] =\n         Attributes{.highlight = \"red-highlight\",\n-                   .diffid = std::string(instruction->name()),\n+                   .diffid = absl::StrCat(\"left:\", instruction->name()),\n                    .mapped_diffid = \"\",\n                    .mapped_instruction = nullptr};\n   }\n   for (auto& instruction : diff_result.right_module_unmatched_instructions) {\n     span_attributes[instruction] =\n         Attributes{.highlight = \"green-highlight\",\n-                   .diffid = std::string(instruction->name()),\n+                   .diffid = absl::StrCat(\"right:\", instruction->name()),\n                    .mapped_diffid = \"\",\n                    .mapped_instruction = nullptr};\n   }\n   for (const auto& [l_instruction, r_instruction] :\n        diff_result.changed_instructions) {\n-    span_attributes[l_instruction] =\n-        Attributes{.highlight = \"yellow-highlight\",\n-                   .diffid = std::string(l_instruction->name()),\n-                   .mapped_diffid = std::string(r_instruction->name()),\n-                   .mapped_instruction = r_instruction};\n-    span_attributes[r_instruction] =\n-        Attributes{.highlight = \"yellow-highlight\",\n-                   .diffid = std::string(r_instruction->name()),\n-                   .mapped_diffid = std::string(l_instruction->name()),\n-                   .mapped_instruction = l_instruction};\n+    span_attributes[l_instruction] = Attributes{\n+        .highlight = \"yellow-highlight\",\n+        .diffid = absl::StrCat(\"left:\", l_instruction->name()),\n+        .mapped_diffid = absl::StrCat(\"right:\", r_instruction->name()),\n+        .mapped_instruction = r_instruction};\n+    span_attributes[r_instruction] = Attributes{\n+        .highlight = \"yellow-highlight\",\n+        .diffid = absl::StrCat(\"right:\", r_instruction->name()),\n+        .mapped_diffid = absl::StrCat(\"left:\", l_instruction->name()),\n+        .mapped_instruction = l_instruction};\n   }\n   for (const auto& [l_instruction, r_instruction] :\n        diff_result.unchanged_instructions) {\n-    span_attributes[l_instruction] =\n-        Attributes{.highlight = \"\",\n-                   .diffid = std::string(l_instruction->name()),\n-                   .mapped_diffid = std::string(r_instruction->name()),\n-                   .mapped_instruction = r_instruction};\n-    span_attributes[r_instruction] =\n-        Attributes{.highlight = \"\",\n-                   .diffid = std::string(r_instruction->name()),\n-                   .mapped_diffid = std::string(l_instruction->name()),\n-                   .mapped_instruction = l_instruction};\n+    span_attributes[l_instruction] = Attributes{\n+        .highlight = \"\",\n+        .diffid = absl::StrCat(\"left:\", l_instruction->name()),\n+        .mapped_diffid = absl::StrCat(\"right:\", r_instruction->name()),\n+        .mapped_instruction = r_instruction};\n+    span_attributes[r_instruction] = Attributes{\n+        .highlight = \"\",\n+        .diffid = absl::StrCat(\"right:\", r_instruction->name()),\n+        .mapped_diffid = absl::StrCat(\"left:\", l_instruction->name()),\n+        .mapped_instruction = l_instruction};\n   }\n   return span_attributes;\n };"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 25,
        "deletions": 23
    }
}