{
    "author": "mfrancepillois",
    "message": "PR #34156: [ROCm] Add missing dependencies to header file\n\nImported from GitHub PR https://github.com/openxla/xla/pull/34156\n\nüìù Summary of Changes\nThe `rocm_config` bazel target has been included in the `rocm_headers` targets to avoid having to manage the dependency to `rocm_config` target independently when `rocm/rocm_config.h` is included in source code file.\nExisting dependencies to `rocm_config` have been removed from BUILD files.\n\nüéØ Justification\nThe global build of XLA for rocm targets:\n`bazel build --config=rocm_clang_official --build_tag_filters -no_oss,-cuda-only,-oneapi-only --test_tag_filters -no_oss,-cuda-only,-oneapi-only //xla/...`\nwas failing, with the following error:\n```\nxla/tests/dot_operation_test.cc:43:10: fatal error: 'rocm/rocm_config.h' file not found\n  43 | #include \"rocm/rocm_config.h\"\n     |          ^~~~~~~~~~~~~~~~~~~~\n140 warnings and 1 error generated.\n```\nbecause dot_operation_test.cc includes `rocm.rocm_config.h` but the dependency to `rocm_config` was missing from the build instructions.\nIncluding the `rocm_config` target in the `rocm_headers` target fixed this error.\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nNot relevant\n\nüß™ Unit Tests:\nNot relevant\n\nüß™ Execution Tests:\nNot relevant\n\nCopybara import of the project:\n\n--\n9ec19ec3802788f0fc50d862e82b59d7fbad0ea4 by Maxime France-Pillois <mfrancep@amd.com>:\n\n[ROCm] Add missing header file dependencies\n\ndot_operation_test.cc includes \"rocm.rocm_config.h\" but dependency was missing in the build instructions.\n\n--\n03c2908ad12e1ab08c3d8be0196240942627efec by Maxime France-Pillois <mfrancep@amd.com>:\n\nMove the dependency to `rocm_config` target to `rocm_headers` and remove independant dependencies to `rocm_config` in build files.\n\nMerging this change closes #34156\n\nPiperOrigin-RevId: 836569938",
    "sha": "df427e4f26ad7631f54ee46a896c720e90ad2a75",
    "files": [
        {
            "sha": "7a40cb5782a1dc3f172802f41c3e58c555949dc8",
            "filename": "third_party/xla/third_party/gpus/rocm/BUILD.tpl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl?ref=df427e4f26ad7631f54ee46a896c720e90ad2a75",
            "patch": "@@ -94,6 +94,7 @@ cc_library(\n     deps = [\n         \":rocm_headers_includes\",\n         \":rocm_rpath\",\n+        \":rocm_config\",\n     ],\n )\n "
        },
        {
            "sha": "4d2d2bb92be41694f0d7fe2cfff493d3f2e2344e",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD?ref=df427e4f26ad7631f54ee46a896c720e90ad2a75",
            "patch": "@@ -153,7 +153,6 @@ cc_library(\n         \"@local_config_cuda//cuda:cuda_headers\",\n     ]) + if_rocm([\n         # keep sorted\n-        \"@local_config_rocm//rocm:rocm_config\",\n         \"@local_config_rocm//rocm:rocm_headers\",\n     ]),\n )"
        },
        {
            "sha": "467af229fa21cd89ff499b5f5aa011279f02f751",
            "filename": "third_party/xla/xla/tsl/platform/default/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/df427e4f26ad7631f54ee46a896c720e90ad2a75/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD?ref=df427e4f26ad7631f54ee46a896c720e90ad2a75",
            "patch": "@@ -123,7 +123,6 @@ cc_library(\n         \"@local_config_nccl//:nccl_config\",\n         \"@local_config_tensorrt//:tensorrt_headers\",\n     ]) + if_rocm_is_configured([\n-        \"@local_config_rocm//rocm:rocm_config\",\n         \"@local_config_rocm//rocm:rocm_headers\",\n     ]),\n )\n@@ -399,7 +398,6 @@ cc_library(\n     deps = [\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:types\",\n-        \"@local_config_rocm//rocm:rocm_config\",\n         \"@local_config_rocm//rocm:rocm_headers\",\n         \"@local_tsl//tsl/platform:path\",\n     ],"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 1,
        "deletions": 3
    }
}