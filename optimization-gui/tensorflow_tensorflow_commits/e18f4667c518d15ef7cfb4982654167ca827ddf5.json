{
    "author": "vwbaker",
    "message": "[xla:gpu] Allow register spills on fusion autotuner pass\n\nDue to the low number of configs being attempted in this autotuning pass (max 2), it's important that we allow register spills because otherwise we may end up with no valid config. We need to assure that at the very least, the native emitter config can always be emitted (preserving the state before the autotuner pass) and we could consider whether we should allow this for the block level emitter. For now, I am turning it on.\n\nPiperOrigin-RevId: 814339642",
    "sha": "e18f4667c518d15ef7cfb4982654167ca827ddf5",
    "files": [
        {
            "sha": "ec1ef75d2557f363bedec9a7a004001d96d99076",
            "filename": "third_party/xla/xla/service/gpu/nvptx_compiler.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e18f4667c518d15ef7cfb4982654167ca827ddf5/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e18f4667c518d15ef7cfb4982654167ca827ddf5/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fnvptx_compiler.cc?ref=e18f4667c518d15ef7cfb4982654167ca827ddf5",
            "patch": "@@ -418,11 +418,15 @@ absl::Status NVPTXCompiler::AddFusionAutotuningPass(\n   }\n \n   std::vector<std::unique_ptr<CodegenBackend>> backends;\n-  backends.push_back(std::make_unique<BlockLevelEmitterBackend>(\n+  auto ble_backend = std::make_unique<BlockLevelEmitterBackend>(\n       &debug_options, this, shape_size_fn, target_config,\n-      /*use_default_config=*/true));\n-  backends.push_back(std::make_unique<NativeEmitterBackend>(\n-      &debug_options, this, target_config));\n+      /*use_default_config=*/true);\n+  ble_backend->AllowRegisterSpills();\n+  backends.push_back(std::move(ble_backend));\n+  auto native_backend = std::make_unique<NativeEmitterBackend>(\n+      &debug_options, this, target_config);\n+  native_backend->AllowRegisterSpills();\n+  backends.push_back(std::move(native_backend));\n \n   TF_ASSIGN_OR_RETURN(\n       std::unique_ptr<AutotunerPass> autotuner_pass,"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 8,
        "deletions": 4
    }
}