{
    "author": "nvgrw",
    "message": "Migrate triangular_solve_test to PjRt.\n\nPiperOrigin-RevId: 845468800",
    "sha": "989142678572ce991aa0ee2078adbc34aa5a44fb",
    "files": [
        {
            "sha": "e3f85c05b090a66cd51d2571720c17a023efa967",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/989142678572ce991aa0ee2078adbc34aa5a44fb/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/989142678572ce991aa0ee2078adbc34aa5a44fb/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=989142678572ce991aa0ee2078adbc34aa5a44fb",
            "patch": "@@ -3856,13 +3856,15 @@ xla_test(\n     name = \"triangular_solve_test\",\n     srcs = [\"triangular_solve_test.cc\"],\n     real_hardware_only = True,\n-    shard_count = 3,\n+    shard_count = 50,\n     tags = [\n         \"optonly\",\n+        \"test_migrated_to_hlo_runner_pjrt\",\n     ],\n     deps = [\n         \":client_library_test_runner_mixin\",\n-        \":hlo_test_base\",\n+        \":hlo_pjrt_interpreter_reference_mixin\",\n+        \":hlo_pjrt_test_base\",\n         \":xla_internal_test_main\",  # fixdeps: keep\n         \"//xla:array\",\n         \"//xla:array2d\","
        },
        {
            "sha": "2060edcc668b497c1daca7938e188b6dea3adfbd",
            "filename": "third_party/xla/xla/tests/triangular_solve_test.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 17,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/989142678572ce991aa0ee2078adbc34aa5a44fb/third_party%2Fxla%2Fxla%2Ftests%2Ftriangular_solve_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/989142678572ce991aa0ee2078adbc34aa5a44fb/third_party%2Fxla%2Fxla%2Ftests%2Ftriangular_solve_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Ftriangular_solve_test.cc?ref=989142678572ce991aa0ee2078adbc34aa5a44fb",
            "patch": "@@ -34,7 +34,8 @@ limitations under the License.\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/tests/client_library_test_runner_mixin.h\"\n-#include \"xla/tests/hlo_test_base.h\"\n+#include \"xla/tests/hlo_pjrt_interpreter_reference_mixin.h\"\n+#include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/types.h\"\n #include \"xla/xla_data.pb.h\"\n@@ -45,9 +46,10 @@ namespace {\n constexpr float kNan = std::numeric_limits<float>::quiet_NaN();\n constexpr complex64 kNanC64 = complex64(kNan, kNan);\n \n-using TriangularSolveTest = ClientLibraryTestRunnerMixin<HloTestBase>;\n-using TriangularSolveLeftLookingTest =\n-    ClientLibraryTestRunnerMixin<HloTestBase>;\n+using TriangularSolveTest = ClientLibraryTestRunnerMixin<\n+    HloPjRtInterpreterReferenceMixin<HloPjRtTestBase>>;\n+using TriangularSolveLeftLookingTest = ClientLibraryTestRunnerMixin<\n+    HloPjRtInterpreterReferenceMixin<HloPjRtTestBase>>;\n \n Array2D<float> AValsLower() {\n   return {{2, kNan, kNan, kNan},\n@@ -448,24 +450,13 @@ struct TriangularSolveTestSpec {\n };\n \n class TriangularSolveParametricTest\n-    : public ClientLibraryTestRunnerMixin<HloTestBase>,\n+    : public ClientLibraryTestRunnerMixin<\n+          HloPjRtInterpreterReferenceMixin<HloPjRtTestBase>>,\n       public ::testing::WithParamInterface<TriangularSolveTestSpec> {};\n \n TEST_P(TriangularSolveParametricTest, Random) {\n   TriangularSolveTestSpec spec = GetParam();\n \n-  if (backend()\n-          .default_stream_executor()\n-          ->GetDeviceDescription()\n-          .cuda_compute_capability()\n-          .major == 6) {\n-    if (spec.dims.size() == 3 && spec.dims[0] > 1 && spec.dims[1] == 150 &&\n-        (spec.dims[2] == 150 || spec.dims[2] == 5) &&\n-        (!spec.left_side || spec.dims[2] == 150)) {\n-      GTEST_SKIP() << \"triggers a bug in cuda 12. b/287345077\";\n-    }\n-  }\n-\n   XlaBuilder builder(TestName());\n \n   CHECK_GE(spec.dims.size(), 2);"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 12,
        "deletions": 19
    }
}