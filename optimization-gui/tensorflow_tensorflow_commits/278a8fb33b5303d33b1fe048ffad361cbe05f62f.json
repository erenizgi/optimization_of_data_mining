{
    "author": "tensorflower-gardener",
    "message": "IFRT Proxy: Implement `GetHumanReadableProgramText()`.\n\nAlso introduce the call in `xla_executable_impl_test_lib.cc`.\n\nPiperOrigin-RevId: 816411903",
    "sha": "278a8fb33b5303d33b1fe048ffad361cbe05f62f",
    "files": [
        {
            "sha": "2d22ff7086ece27e6f0516e8c69833744c0be828",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -331,8 +331,9 @@ int main(int argc, char** argv) {\n       \"*LoadedExecutableImplTest.Properties*:\"\n       // Incorrect deleted state of donated inputs.\n       \"*LoadedExecutableImplTest.Donation*:\"\n-      // GetHloModules and Analysis methods are not implemented.\n+      // GetHloModules, ProgramText, and Analysis methods are not implemented.\n       \"*LoadedExecutableImplTest.GetHloModules*:\"\n+      \"*LoadedExecutableImplTest.ProgramText*:\"\n       \"*LoadedExecutableImplTest.Analysis*:\"\n       // Serialization is not implemented.\n       \"*SerializeAndLoad*\";"
        },
        {
            "sha": "252b9fddac6f5fe76117de5308481ffc82e09b93",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.cc",
            "status": "modified",
            "additions": 37,
            "deletions": 6,
            "changes": 43,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -530,12 +530,6 @@ absl::StatusOr<std::string> LoadedExecutable::Serialize() const {\n       \"underlying serialization format is not stable\");\n }\n \n-absl::StatusOr<std::string> LoadedExecutable::GetHumanReadableProgramText()\n-    const {\n-  return absl::UnimplementedError(\n-      \"GetHumanReadableProgramText() is unimplemented.\");\n-}\n-\n tsl::Future<> LoadedExecutable::GetReadyFuture() const { return ready_future_; }\n \n int LoadedExecutable::num_devices() const { return num_devices_; }\n@@ -656,6 +650,43 @@ absl::StatusOr<xla::ifrt::AttributeMap> LoadedExecutable::GetCostAnalysis()\n   return *cost_analysis_response_;\n }\n \n+absl::StatusOr<std::string> LoadedExecutable::GetHumanReadableProgramText()\n+    const {\n+  if (rpc_helper_->protocol_version() <\n+      protocol_version::kLoadedExecutableGetHumanReadableProgramText) {\n+    return absl::UnimplementedError(\n+        \"LoadedExecutable::GetHumanReadableProgramText() is unimplemented by \"\n+        \"IFRT proxy\");\n+  }\n+\n+  absl::MutexLock l(human_readable_program_text_mu_);\n+  if (!human_readable_program_text_.has_value()) {\n+    auto req =\n+        std::make_unique<LoadedExecutableHumanReadableProgramTextRequest>();\n+    req->set_loaded_executable_handle(handle_);\n+\n+    absl::StatusOr<\n+        std::shared_ptr<LoadedExecutableHumanReadableProgramTextResponse>>\n+        response =\n+            rpc_helper_\n+                ->LoadedExecutableHumanReadableProgramText(std::move(req))\n+                .Await();\n+\n+    if (!response.ok()) {\n+      // Connection-related error, so log the error.\n+      LOG(ERROR) << \"LoadedExecutableHumanReadableProgramText: Got \"\n+                 << response.status();\n+      human_readable_program_text_ = response.status();\n+    } else if ((*response)->has_human_readable_program_text()) {\n+      human_readable_program_text_ = (*response)->human_readable_program_text();\n+    } else {\n+      human_readable_program_text_ =\n+          tsl::StatusFromProto((*response)->status());\n+    }\n+  }\n+  return *human_readable_program_text_;\n+}\n+\n absl::StatusOr<xla::ifrt::LoadedExecutable::ExecuteResult>\n LoadedExecutable::Execute(absl::Span<xla::ifrt::ArrayRef> args,\n                           const ExecuteOptions& options,"
        },
        {
            "sha": "f32df1dbd925100b16076023755a7c2a64291956",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.h",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -167,6 +167,14 @@ class LoadedExecutable final\n   mutable absl::Mutex cost_analysis_mu_;\n   mutable std::optional<absl::StatusOr<xla::ifrt::AttributeMap>>\n       cost_analysis_response_ ABSL_GUARDED_BY(cost_analysis_mu_);\n+\n+  // The cached value of `GetHumanReadableProgramText()`. The value is obtained\n+  // from the proxy-server the first time that the user invokes\n+  // `GetHumanReadableProgramText()`, and is cached afterwards.\n+  mutable absl::Mutex human_readable_program_text_mu_;\n+  mutable std::optional<absl::StatusOr<std::string>>\n+      human_readable_program_text_\n+          ABSL_GUARDED_BY(human_readable_program_text_mu_);\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "9f6c2ad35fc280d2c44e5eba74db05896a17afce",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -342,6 +342,8 @@ RPC(DeleteArray, delete_array);\n RPC(Compile, compile);\n RPC(LoadedExecutableMetadata, loaded_executable_metadata);\n RPC(LoadedExecutableCostAnalysis, loaded_executable_cost_analysis);\n+RPC(LoadedExecutableHumanReadableProgramText,\n+    loaded_executable_human_readable_program_text);\n RPC(LoadedExecutableExecute, loaded_executable_execute);\n RPC(LoadedExecutableDelete, loaded_executable_delete);\n RPC(LoadedExecutableIsDeleted, loaded_executable_is_deleted);"
        },
        {
            "sha": "73e9a67a8f75bedf40da0dfd0c085ff966228b3e",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -141,6 +141,9 @@ class RpcHelper {\n   ResponseFuture<LoadedExecutableCostAnalysisResponse>\n   LoadedExecutableCostAnalysis(\n       std::unique_ptr<LoadedExecutableCostAnalysisRequest> req);\n+  ResponseFuture<LoadedExecutableHumanReadableProgramTextResponse>\n+  LoadedExecutableHumanReadableProgramText(\n+      std::unique_ptr<LoadedExecutableHumanReadableProgramTextRequest> req);\n   ResponseFuture<LoadedExecutableExecuteResponse> LoadedExecutableExecute(\n       std::unique_ptr<LoadedExecutableExecuteRequest> req);\n   ResponseFuture<LoadedExecutableDeleteResponse> LoadedExecutableDelete("
        },
        {
            "sha": "98ff38871e1cb77d2369622ddcbbfc72f3a62c67",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/VERSION.md",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -110,3 +110,9 @@\n *   Added date: 2025-10-01\n *   Changes:\n     *   Added support for `LoadedExecutable::GetCostAnalysis()`.\n+\n+## Version kLoadedExecutableGetHumanReadableProgramText\n+\n+*   Added date: 2025-10-01\n+*   Changes:\n+    *   Added support for `LoadedExecutable::GetHumanReadableProgramText()`."
        },
        {
            "sha": "6aa8b468cedd5dec7fca74fb16d68d70d8196250",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/ifrt_service.proto",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -37,7 +37,7 @@ message IfrtProxyVersion {\n   int32 ifrt_serdes_version_number = 2;\n }\n \n-// Next ID: 29.\n+// Next ID: 30.\n message IfrtRequest {\n   RequestMetadata request_metadata = 1;\n \n@@ -75,6 +75,8 @@ message IfrtRequest {\n     LoadedExecutableExecuteRequest loaded_executable_execute_request = 15;\n     LoadedExecutableCostAnalysisRequest\n         loaded_executable_cost_analysis_request = 28;\n+    LoadedExecutableHumanReadableProgramTextRequest\n+        loaded_executable_human_readable_program_text_request = 29;\n     LoadedExecutableDeleteRequest loaded_executable_delete_request = 16\n         [deprecated = true];\n     LoadedExecutableIsDeletedRequest loaded_executable_is_deleted_request = 17\n@@ -94,7 +96,7 @@ message IfrtRequest {\n   reserved 10;\n }\n \n-// Next ID: 29.\n+// Next ID: 30.\n message IfrtResponse {\n   ResponseMetadata response_metadata = 1;\n \n@@ -132,6 +134,8 @@ message IfrtResponse {\n     LoadedExecutableExecuteResponse loaded_executable_execute_response = 15;\n     LoadedExecutableCostAnalysisResponse\n         loaded_executable_cost_analysis_response = 28;\n+    LoadedExecutableHumanReadableProgramTextResponse\n+        loaded_executable_human_readable_program_text_response = 29;\n     LoadedExecutableDeleteResponse loaded_executable_delete_response = 16;\n     LoadedExecutableIsDeletedResponse loaded_executable_is_deleted_response =\n         17;\n@@ -520,6 +524,19 @@ message LoadedExecutableCostAnalysisResponse {\n   }\n }\n \n+// Queries the value of `LoadedExecutable::GetHumanReadableProgramText()`.\n+// Separate from LoadedExecutableMetadataRequest since it has non-trivial cost.\n+message LoadedExecutableHumanReadableProgramTextRequest {\n+  fixed64 loaded_executable_handle = 1;\n+}\n+\n+message LoadedExecutableHumanReadableProgramTextResponse {\n+  oneof result {\n+    tensorflow.StatusProto status = 1;\n+    string human_readable_program_text = 2;\n+  }\n+}\n+\n // Mirrors `LoadedExecutable::Execute`. Returns output array handles and a\n // future handle that becomes ready when the execution completes. The latter can\n // be checked by issuing `CheckFutureRequest`."
        },
        {
            "sha": "91539bc0b22972df673c8f437fe53681d08c48f2",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/versions.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -57,6 +57,10 @@ enum {\n   // kLoadedExecutableGetCostAnalysis implements GetCostAnalysis in Executable.\n   kLoadedExecutableGetCostAnalysis = 18,\n \n+  // kLoadedExecutableGetHumanReadableProgramText implements\n+  // GetHumanReadableProgramText in Executable.\n+  kLoadedExecutableGetHumanReadableProgramText = 19,\n+\n   // kSentiel is used to derive kCurrent below. Keep this as the last value of\n   // the enum.\n   kSentiel,"
        },
        {
            "sha": "38de990d81c456c24cff74aad8b6526188e6b3ac",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend.cc",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -596,6 +596,10 @@ tsl::Future<BackendInterface::Response> IfrtBackend::ProcessInternal(\n       return HandleLoadedExecutableMetadataRequest(std::move(request));\n     case IfrtRequest::RequestCase::kLoadedExecutableCostAnalysisRequest:\n       return HandleLoadedExecutableCostAnalysisRequest(std::move(request));\n+    case IfrtRequest::RequestCase::\n+        kLoadedExecutableHumanReadableProgramTextRequest:\n+      return HandleLoadedExecutableHumanReadableProgramTextRequest(\n+          std::move(request));\n     case IfrtRequest::RequestCase::kLoadedExecutableExecuteRequest: {\n       asr.emplace(\n           request->loaded_executable_execute_request().result_array_handle(),\n@@ -1652,6 +1656,34 @@ IfrtBackend::HandleLoadedExecutableCostAnalysisRequest(\n   return tsl::Future<BackendInterface::Response>(std::move(ifrt_resp));\n }\n \n+tsl::Future<BackendInterface::Response>\n+IfrtBackend::HandleLoadedExecutableHumanReadableProgramTextRequest(\n+    std::unique_ptr<IfrtRequest> request) {\n+  absl::StatusOr<std::shared_ptr<LoadedExecutableWithInfo>> executable_info =\n+      GetLoadedExecutable(\n+          request->loaded_executable_human_readable_program_text_request()\n+              .loaded_executable_handle());\n+\n+  if (!executable_info.ok()) {\n+    return tsl::Future<BackendInterface::Response>(executable_info.status());\n+  }\n+\n+  auto result =\n+      executable_info->get()->executable->GetHumanReadableProgramText();\n+\n+  std::unique_ptr<IfrtResponse> ifrt_resp =\n+      NewIfrtResponse(request->request_metadata().op_id());\n+\n+  if (result.ok()) {\n+    *ifrt_resp->mutable_loaded_executable_human_readable_program_text_response()\n+         ->mutable_human_readable_program_text() = *std::move(result);\n+  } else {\n+    *ifrt_resp->mutable_loaded_executable_human_readable_program_text_response()\n+         ->mutable_status() = tsl::StatusToProto(result.status());\n+  }\n+  return tsl::Future<BackendInterface::Response>(std::move(ifrt_resp));\n+}\n+\n absl::StatusOr<BackendInterface::Response>\n IfrtBackend::HandleLoadedExecutableExecuteRequest(\n     ArrayStore::Reservation& asr, std::unique_ptr<IfrtRequest> request) {"
        },
        {
            "sha": "67658af3e2666c3247c46f90970d808c1acaa31f",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -212,7 +212,9 @@ class IfrtBackend final : public BackendInterface {\n \n   tsl::Future<Response> HandleLoadedExecutableMetadataRequest(\n       std::unique_ptr<IfrtRequest> request);\n-  Future<Response> HandleLoadedExecutableCostAnalysisRequest(\n+  tsl::Future<Response> HandleLoadedExecutableCostAnalysisRequest(\n+      std::unique_ptr<IfrtRequest> request);\n+  tsl::Future<Response> HandleLoadedExecutableHumanReadableProgramTextRequest(\n       std::unique_ptr<IfrtRequest> request);\n   absl::StatusOr<Response> HandleLoadedExecutableExecuteRequest(\n       ArrayStore::Reservation& asr, std::unique_ptr<IfrtRequest> request);"
        },
        {
            "sha": "a5a79f7d97386f540189b4e054cb650153893d8e",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/xla_executable_impl_test_lib.cc",
            "status": "modified",
            "additions": 23,
            "deletions": 32,
            "changes": 55,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/278a8fb33b5303d33b1fe048ffad361cbe05f62f/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc?ref=278a8fb33b5303d33b1fe048ffad361cbe05f62f",
            "patch": "@@ -69,6 +69,7 @@ using ::absl_testing::StatusIs;\n using ::testing::AnyOf;\n using ::testing::ElementsAre;\n using ::testing::ElementsAreArray;\n+using ::testing::HasSubstr;\n using ::testing::IsEmpty;\n using ::testing::Not;\n using ::testing::Optional;\n@@ -233,14 +234,8 @@ module @add_sub attributes {\n                     StatusIs(absl::StatusCode::kUnimplemented)));\n }\n \n-TEST_P(LoadedExecutableImplTest, GetHloModules) {\n-  bool serialize = GetParam();\n-\n-  if (serialize) {\n-    GTEST_SKIP()\n-        << \"GetHloModules is not supported for serialized executables.\";\n-  }\n-\n+absl::StatusOr<const LoadedExecutableRef> SimpleAddExecutable(Client* client,\n+                                                              bool serialize) {\n   static constexpr absl::string_view kModule = R\"(\n module @add attributes {\n   mhlo.num_replicas = 1 : i32,\n@@ -253,14 +248,17 @@ module @add attributes {\n     return %0 : tensor<2x3xi32>\n   }\n })\";\n-  TF_ASSERT_OK_AND_ASSIGN(auto client, test_util::GetClient());\n   Compiler* compiler = client->GetDefaultCompiler();\n+  return CompileOnDevices(client, compiler, kModule,\n+                          {client->addressable_devices().front()},\n+                          /*replicated=*/false, serialize);\n+}\n \n+TEST_P(LoadedExecutableImplTest, GetHloModules) {\n+  TF_ASSERT_OK_AND_ASSIGN(auto client, test_util::GetClient());\n   TF_ASSERT_OK_AND_ASSIGN(\n       const LoadedExecutableRef executable,\n-      CompileOnDevices(client.get(), compiler, kModule,\n-                       {client->addressable_devices().front()},\n-                       /*replicated=*/false, serialize));\n+      SimpleAddExecutable(client.get(), /*serialize=*/GetParam()));\n \n   TF_ASSERT_OK_AND_ASSIGN(\n       const std::vector<std::shared_ptr<xla::HloModule>> hlo_modules,\n@@ -269,33 +267,26 @@ module @add attributes {\n   EXPECT_EQ(hlo_modules.front()->name(), \"add\");\n }\n \n-TEST_P(LoadedExecutableImplTest, Analysis) {\n-  bool serialize = GetParam();\n+TEST_P(LoadedExecutableImplTest, ProgramText) {\n+  TF_ASSERT_OK_AND_ASSIGN(auto client, test_util::GetClient());\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      const LoadedExecutableRef executable,\n+      SimpleAddExecutable(client.get(), /*serialize=*/GetParam()));\n+\n+  TF_ASSERT_OK_AND_ASSIGN(const auto program_text,\n+                          executable->GetHumanReadableProgramText());\n+  EXPECT_THAT(program_text, HasSubstr(\"add.\"));\n+}\n \n-  if (serialize) {\n+TEST_P(LoadedExecutableImplTest, Analysis) {\n+  if (const bool serialize = GetParam(); serialize) {\n     GTEST_SKIP() << \"Analysis is not supported for serialized executables.\";\n   }\n \n-  static constexpr absl::string_view kModule = R\"(\n-module @add attributes {\n-  mhlo.num_replicas = 1 : i32,\n-  mhlo.num_partitions = 2 : i32\n-} {\n-  func.func @main(\n-    %arg0: tensor<2x3xi32> {mhlo.sharding = \"{devices=[2,1]<=[2]}\"}\n-  ) -> (tensor<2x3xi32> {mhlo.sharding = \"{devices=[2,1]<=[2]}\"}) {\n-    %0 = stablehlo.add %arg0, %arg0 : tensor<2x3xi32>\n-    return %0 : tensor<2x3xi32>\n-  }\n-})\";\n   TF_ASSERT_OK_AND_ASSIGN(auto client, test_util::GetClient());\n-  Compiler* compiler = client->GetDefaultCompiler();\n-\n   TF_ASSERT_OK_AND_ASSIGN(\n       const LoadedExecutableRef executable,\n-      CompileOnDevices(client.get(), compiler, kModule,\n-                       {client->addressable_devices().front()},\n-                       /*replicated=*/false, serialize));\n+      SimpleAddExecutable(client.get(), /*serialize=*/false));\n \n   TF_ASSERT_OK_AND_ASSIGN(const xla::CompiledMemoryStats compiled_memory_stats,\n                           executable->GetCompiledMemoryStats());"
        }
    ],
    "stats": {
        "total": 181,
        "additions": 139,
        "deletions": 42
    }
}