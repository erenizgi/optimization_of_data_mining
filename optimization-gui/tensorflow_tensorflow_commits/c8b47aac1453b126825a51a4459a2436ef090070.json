{
    "author": "tensorflower-gardener",
    "message": "In profile_data_lib.cc, throw std::runtime_error instead of check fail.\n\nPiperOrigin-RevId: 820351230",
    "sha": "c8b47aac1453b126825a51a4459a2436ef090070",
    "files": [
        {
            "sha": "2ede8186703ca6cbbc7d3105135b85ef76fd073f",
            "filename": "third_party/xla/xla/python/profiler/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2FBUILD?ref=c8b47aac1453b126825a51a4459a2436ef090070",
            "patch": "@@ -16,13 +16,14 @@ cc_library(\n         \"//xla/python:__pkg__\",\n     ],\n     deps = [\n+        \"//xla/pjrt:status_casters\",\n+        \"//xla/tsl/platform:env\",\n+        \"//xla/tsl/platform:logging\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_protobuf//:protobuf_lite\",\n-        \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:logging\",\n         \"@local_tsl//tsl/platform:protobuf\",\n-        \"@local_tsl//tsl/platform:status\",\n         \"@local_tsl//tsl/profiler/protobuf:xplane_proto_cc\",\n         \"@nanobind\",\n     ],"
        },
        {
            "sha": "bbb0a12cef3b0f555e6184cb4719f1e145d97250",
            "filename": "third_party/xla/xla/python/profiler/profile_data_lib.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 9,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.cc?ref=c8b47aac1453b126825a51a4459a2436ef090070",
            "patch": "@@ -18,15 +18,16 @@ limitations under the License.\n #include <cstddef>\n #include <cstdint>\n #include <memory>\n+#include <stdexcept>\n #include <string>\n \n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"nanobind/nanobind.h\"\n #include \"nanobind/stl/string.h\"  // IWYU pragma: keep\n-#include \"tsl/platform/env.h\"\n-#include \"tsl/platform/logging.h\"\n-#include \"tsl/platform/status.h\"\n+#include \"xla/pjrt/status_casters.h\"\n+#include \"xla/tsl/platform/env.h\"\n+#include \"xla/tsl/platform/logging.h\"\n #include \"tsl/profiler/protobuf/xplane.pb.h\"\n \n namespace tensorflow::profiler::python {\n@@ -186,8 +187,8 @@ VisitorIterator<nb::tuple, XStat> ProfilePlane::stats_end() {\n /*static*/ ProfileData ProfileData::from_file(\n     const std::string& proto_file_path) {\n   std::string serialized_xspace;\n-  TF_CHECK_OK(tsl::ReadFileToString(tsl::Env::Default(), proto_file_path,\n-                                    &serialized_xspace));\n+  xla::ThrowIfError(tsl::ReadFileToString(tsl::Env::Default(), proto_file_path,\n+                                          &serialized_xspace));\n   return ProfileData(serialized_xspace.c_str(), serialized_xspace.size());\n }\n \n@@ -198,14 +199,16 @@ VisitorIterator<nb::tuple, XStat> ProfilePlane::stats_end() {\n   return ProfileData(proto_ptr);\n }\n \n-ProfileData::ProfileData(const char* serialized_xspace_ptr,\n+ProfileData::ProfileData(const void* serialized_xspace_ptr,\n                          size_t serialized_xspace_size) {\n   CHECK_NOTNULL(serialized_xspace_ptr);\n \n   if (!xspace_) {\n     xspace_ = std::make_shared<XSpace>();\n   }\n-  CHECK(xspace_->ParseFromArray(serialized_xspace_ptr, serialized_xspace_size));\n+  if (!xspace_->ParseFromArray(serialized_xspace_ptr, serialized_xspace_size)) {\n+    throw std::runtime_error(\"Failed to parse XSpace from array\");\n+  }\n }\n \n /*explicit*/ ProfileData::ProfileData(std::shared_ptr<XSpace> xspace_ptr) {\n@@ -216,8 +219,10 @@ ProfileData::ProfileData(const char* serialized_xspace_ptr,\n   if (!xspace_) {\n     xspace_ = std::make_shared<XSpace>();\n   }\n-  CHECK(xspace_->ParseFromArray(serialized_xspace.data(),\n-                                serialized_xspace.size()));\n+  if (!xspace_->ParseFromArray(serialized_xspace.data(),\n+                               serialized_xspace.size())) {\n+    throw std::runtime_error(\"Failed to parse XSpace from array\");\n+  }\n }\n \n VisitorIterator<ProfilePlane, XPlane> ProfileData::planes_begin() {"
        },
        {
            "sha": "cdfeee940e30e2f12f8790e0066d662fc9209f97",
            "filename": "third_party/xla/xla/python/profiler/profile_data_lib.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c8b47aac1453b126825a51a4459a2436ef090070/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fprofiler%2Fprofile_data_lib.h?ref=c8b47aac1453b126825a51a4459a2436ef090070",
            "patch": "@@ -165,7 +165,7 @@ class ProfileData {\n \n   ProfileData() = delete;\n \n-  ProfileData(const char* serialized_xspace_ptr, size_t serialized_xspace_size);\n+  ProfileData(const void* serialized_xspace_ptr, size_t serialized_xspace_size);\n \n   explicit ProfileData(std::shared_ptr<XSpace> xspace_ptr);\n "
        }
    ],
    "stats": {
        "total": 30,
        "additions": 18,
        "deletions": 12
    }
}