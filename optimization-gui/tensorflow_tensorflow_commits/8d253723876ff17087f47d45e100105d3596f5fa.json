{
    "author": "tensorflower-gardener",
    "message": "[Autotuner] Use CustomKernel fission backend in legacy autotuner cache.\n\nThe current usage is only for triton gemm fusions.\n\nPiperOrigin-RevId: 837052553",
    "sha": "8d253723876ff17087f47d45e100105d3596f5fa",
    "files": [
        {
            "sha": "79242cf983550ce4884c61c06bb79d475041df41",
            "filename": "third_party/xla/xla/backends/gpu/autotuner/legacy_cache.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8d253723876ff17087f47d45e100105d3596f5fa/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8d253723876ff17087f47d45e100105d3596f5fa/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache.cc?ref=8d253723876ff17087f47d45e100105d3596f5fa",
            "patch": "@@ -118,7 +118,7 @@ std::optional<LegacyCache::Config> LegacyCache::GetConfig(\n     config.codegen_backend_name = result.other().name();\n     config.backend_config = result.other().config();\n   } else if (result.has_custom_kernel_fusion()) {\n-    config.codegen_backend_name = \"CustomKernel\";\n+    config.codegen_backend_name = \"CustomKernel_fission\";\n     config.backend_config.PackFrom(result.custom_kernel_fusion());\n   } else {\n     return std::nullopt;\n@@ -136,7 +136,7 @@ std::optional<AutotuneResult> LegacyCache::GetAutotuneResult(\n     config.backend_config.UnpackTo(result.mutable_gemm());\n   } else if (config.codegen_backend_name == \"Cudnn\") {\n     config.backend_config.UnpackTo(result.mutable_algorithm());\n-  } else if (config.codegen_backend_name == \"CustomKernel\") {\n+  } else if (config.codegen_backend_name == \"CustomKernel_fission\") {\n     config.backend_config.UnpackTo(result.mutable_custom_kernel_fusion());\n   } else {\n     result.mutable_other()->set_name(config.codegen_backend_name);"
        },
        {
            "sha": "6c2744e0bd026f356adb8334df64839bf30785ae",
            "filename": "third_party/xla/xla/backends/gpu/autotuner/legacy_cache_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8d253723876ff17087f47d45e100105d3596f5fa/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8d253723876ff17087f47d45e100105d3596f5fa/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Flegacy_cache_test.cc?ref=8d253723876ff17087f47d45e100105d3596f5fa",
            "patch": "@@ -115,9 +115,9 @@ class LegacyCacheTest : public ::testing::Test {\n     return config;\n   }\n \n-  Config CreateDummyCustomKernelConfig() {\n+  Config CreateDummyCustomKernelFissionConfig() {\n     Config config;\n-    config.codegen_backend_name = \"CustomKernel\";\n+    config.codegen_backend_name = \"CustomKernel_fission\";\n     config.backend_config.PackFrom(AutotuneResult::CustomKernelFusionKey());\n     return config;\n   }\n@@ -215,10 +215,10 @@ TEST_F(LegacyCacheTest, InsertAndLookupCudnn) {\n   EXPECT_THAT(cache.Lookup(instr.get()), Optional(ConfigEq(config)));\n }\n \n-TEST_F(LegacyCacheTest, InsertAndLookupCustomKernel) {\n+TEST_F(LegacyCacheTest, InsertAndLookupCustomKernelFission) {\n   auto cache = LegacyCache(test_dir_, mode_, device_desc_);\n   auto instr = CreateDummyInstr(\"hlo4\");\n-  Config config = CreateDummyCustomKernelConfig();\n+  Config config = CreateDummyCustomKernelFissionConfig();\n   TF_ASSERT_OK(cache.Insert(instr.get(), config));\n   EXPECT_THAT(cache.Lookup(instr.get()), Optional(ConfigEq(config)));\n }"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 6,
        "deletions": 6
    }
}