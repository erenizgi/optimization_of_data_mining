{
    "author": "ezhulenev",
    "message": "[xla] Improve memory footprint of HloValue\n\nPiperOrigin-RevId: 797960690",
    "sha": "e0e9045c7138f0a476848b486cabaae30a46beb4",
    "files": [
        {
            "sha": "72608b700df6badd8313baa92390a38c0de554a4",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=e0e9045c7138f0a476848b486cabaae30a46beb4",
            "patch": "@@ -3548,7 +3548,6 @@ cc_library(\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@local_tsl//tsl/platform:logging\",\n     ],\n )\n "
        },
        {
            "sha": "0a9a8db1cdd5fa4338507609e19a752de072cf41",
            "filename": "third_party/xla/xla/service/hlo_value.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.cc?ref=e0e9045c7138f0a476848b486cabaae30a46beb4",
            "patch": "@@ -36,7 +36,6 @@ limitations under the License.\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/util.h\"\n-#include \"tsl/platform/logging.h\"\n \n namespace xla {\n \n@@ -75,7 +74,8 @@ HloValue::HloValue(HloValue::Id id, HloInstruction* instruction,\n                    const ShapeIndex& index, bool is_phi)\n     : BufferValue(instruction, index, id),\n       uses_([this] { return ComputeUses(); }),\n-      is_phi_(is_phi) {\n+      is_phi_(is_phi),\n+      live_out_of_module_(false) {\n   // The defining position is always the first element in the positions_ vector.\n   positions_.push_back(HloPosition{instruction, index});\n }"
        },
        {
            "sha": "74ce09b7b5ab1923349a980fa24778eafacc46f0",
            "filename": "third_party/xla/xla/service/hlo_value.h",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e0e9045c7138f0a476848b486cabaae30a46beb4/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_value.h?ref=e0e9045c7138f0a476848b486cabaae30a46beb4",
            "patch": "@@ -27,6 +27,7 @@ limitations under the License.\n \n #include \"absl/container/flat_hash_set.h\"\n #include \"absl/container/inlined_vector.h\"\n+#include \"absl/log/check.h\"\n #include \"absl/types/span.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/lazy.h\"\n@@ -35,7 +36,6 @@ limitations under the License.\n #include \"xla/shape_tree.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/logging.h\"\n \n namespace xla {\n \n@@ -153,7 +153,7 @@ class HloValue : public BufferValue {\n   // Return the shape of this HloValue.\n   const Shape& shape() const override { return defining_position().shape(); }\n \n-  using Positions = absl::InlinedVector<HloPosition, 3>;\n+  using Positions = absl::InlinedVector<HloPosition, 2>;\n   // Return all positions of the HloValue in the module.\n   const Positions& positions() const { return positions_; }\n \n@@ -181,7 +181,7 @@ class HloValue : public BufferValue {\n   std::string ToString() const override { return ToString(0); }\n \n  private:\n-  using Uses = absl::InlinedVector<HloUse, 3>;\n+  using Uses = absl::InlinedVector<HloUse, 2>;\n   // Called when lazily computing the uses.\n   Uses ComputeUses() const;\n \n@@ -194,10 +194,10 @@ class HloValue : public BufferValue {\n   Lazy<Uses> uses_;\n \n   // Whether this instruction is a phi value.\n-  const bool is_phi_;\n+  bool is_phi_ : 1;\n \n   // Whether this value is live out of the HLO module.\n-  bool live_out_of_module_ = false;\n+  bool live_out_of_module_ : 1;\n };\n \n std::ostream& operator<<(std::ostream& out, const HloValue& hlo_value);\n@@ -242,7 +242,9 @@ class HloValueSet {\n   }\n \n   bool operator==(const HloValueSet& other) const {\n-    if (values_.size() != other.values_.size()) return false;\n+    if (values_.size() != other.values_.size()) {\n+      return false;\n+    }\n     for (size_t i = 0; i < values_.size(); ++i) {\n       if (values_[i]->id() != other.values_[i]->id()) {\n         return false;"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 10,
        "deletions": 9
    }
}