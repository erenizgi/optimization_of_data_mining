{
    "author": "tensorflower-gardener",
    "message": "Do not legalize mhlo.iota to tf.range when element type is ui8, since tf.range doesn't support ui8.\n\nPiperOrigin-RevId: 825298715",
    "sha": "075912cbd6d26377db19b52ef4e6610d63aa1c90",
    "files": [
        {
            "sha": "9a0a185443ebc083e18c4d0d312a6df91179ce79",
            "filename": "tensorflow/compiler/mlir/lite/stablehlo/tests/legalize_hlo.mlir",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/075912cbd6d26377db19b52ef4e6610d63aa1c90/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftests%2Flegalize_hlo.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/075912cbd6d26377db19b52ef4e6610d63aa1c90/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftests%2Flegalize_hlo.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftests%2Flegalize_hlo.mlir?ref=075912cbd6d26377db19b52ef4e6610d63aa1c90",
            "patch": "@@ -3073,6 +3073,13 @@ func.func @convert_iota_ui64() -> tensor<123xui64> {\n   func.return %0 : tensor<123xui64>\n }\n \n+// CHECK-LABEL: func @no_convert_iota_ui8\n+func.func @no_convert_iota_ui8() -> tensor<123xui8> {\n+  // CHECK: \"mhlo.iota\"\n+  %0 = \"mhlo.iota\"() <{ iota_dimension = 0 : i64 }> : () -> tensor<123xui8>\n+  func.return %0 : tensor<123xui8>\n+}\n+\n // CHECK-LABEL:   func @convert_avgpool_valid(\n // CHECK-SAME:                                %[[VAL_0:.*]]: tensor<4x16x16x8xf32>) -> tensor<4x7x7x8xf32> {\n // CHECK:           %[[VAL_1:.*]] = \"tf.AvgPool\"(%[[VAL_0]]) <{data_format = \"NHWC\", ksize = [1, 3, 3, 1], padding = \"VALID\", strides = [1, 2, 2, 1]}> : (tensor<4x16x16x8xf32>) -> tensor<4x7x7x8xf32>"
        },
        {
            "sha": "7608ff985f1eb953fe3947f772be28e42a4f60ad",
            "filename": "tensorflow/compiler/mlir/lite/stablehlo/transforms/legalize_hlo.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/075912cbd6d26377db19b52ef4e6610d63aa1c90/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftransforms%2Flegalize_hlo.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/075912cbd6d26377db19b52ef4e6610d63aa1c90/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftransforms%2Flegalize_hlo.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fstablehlo%2Ftransforms%2Flegalize_hlo.cc?ref=075912cbd6d26377db19b52ef4e6610d63aa1c90",
            "patch": "@@ -2081,8 +2081,10 @@ class ConvertIotaOpToTfRange : public OpConversionPattern<mhlo::IotaOp> {\n       ConversionPatternRewriter& rewriter) const final {\n     RankedTensorType type =\n         mlir::dyn_cast_or_null<RankedTensorType>(iota_op.getType());\n-    // TF::RangeOp doesn't support UI16.\n-    if (!type || type.getElementType().isUnsignedInteger(16)) return failure();\n+    // TF::RangeOp doesn't support UI16 and UI8.\n+    if (!type || type.getElementType().isUnsignedInteger(16) ||\n+        type.getElementType().isUnsignedInteger(8))\n+      return failure();\n \n     const uint64_t dimension = iota_op.getIotaDimension();\n     Type element_type = type.getElementType();"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 11,
        "deletions": 2
    }
}