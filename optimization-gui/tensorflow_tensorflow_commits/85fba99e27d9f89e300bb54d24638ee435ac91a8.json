{
    "author": "ermilovmaxim",
    "message": "Add Shape to While(Thunk|Cmd) buffer_uses\n\nPiperOrigin-RevId: 845344696",
    "sha": "85fba99e27d9f89e300bb54d24638ee435ac91a8",
    "files": [
        {
            "sha": "a99e25ac16bf2125fbe421f4dbf577a319afc56a",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_cmd.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/85fba99e27d9f89e300bb54d24638ee435ac91a8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/85fba99e27d9f89e300bb54d24638ee435ac91a8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_cmd.cc?ref=85fba99e27d9f89e300bb54d24638ee435ac91a8",
            "patch": "@@ -1701,7 +1701,7 @@ bool WhileCmd::force_update() {\n \n CommandBufferCmd::BufferUseVector WhileCmd::buffers() const {\n   absl::flat_hash_set<BufferUse> buffers;\n-  buffers.emplace(BufferUse::Write(pred_));\n+  buffers.emplace(BufferUse::Read(pred_, ShapeUtil::MakeShape(PRED, {})));\n   buffers.insert(cond_commands_.buffers().begin(),\n                  cond_commands_.buffers().end());\n   buffers.insert(body_commands_.buffers().begin(),"
        },
        {
            "sha": "c8af5cf26bf378ad4ba4d1c8105078cd520e66c1",
            "filename": "third_party/xla/xla/backends/gpu/runtime/while_thunk.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/85fba99e27d9f89e300bb54d24638ee435ac91a8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/85fba99e27d9f89e300bb54d24638ee435ac91a8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h?ref=85fba99e27d9f89e300bb54d24638ee435ac91a8",
            "patch": "@@ -103,7 +103,8 @@ class WhileThunk : public Thunk {\n \n   BufferUses buffer_uses() const override {\n     return {\n-        BufferUse::Read(condition_result_buffer_index_),\n+        BufferUse::Read(condition_result_buffer_index_,\n+                        ShapeUtil::MakeShape(PRED, {})),\n     };\n   }\n "
        }
    ],
    "stats": {
        "total": 5,
        "additions": 3,
        "deletions": 2
    }
}