{
    "author": "tensorflower-gardener",
    "message": "Handle wrapt.ObjectProxy in tensor_util and TrackableObject.\n\nResolves a TypeError in Python 3.12 caused by stricter inspect module behavior when accessing __dict__ on wrapt.ObjectProxy subclasses like _DictWrapper. The fix modifies the type-checking logic to bypass incompatible introspection on proxy objects during serialization. This restores tf.saved_model.save functionality and ensures compatibility with the Python 3.12+ runtime.\n\nPiperOrigin-RevId: 842833037",
    "sha": "e1fab9f0bba793ed5a839b92ff9c7cad4789bc84",
    "files": [
        {
            "sha": "7101f046e60b042b0393744902911aebe9fb30b5",
            "filename": "tensorflow/python/framework/tensor_util.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e1fab9f0bba793ed5a839b92ff9c7cad4789bc84/tensorflow%2Fpython%2Fframework%2Ftensor_util.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e1fab9f0bba793ed5a839b92ff9c7cad4789bc84/tensorflow%2Fpython%2Fframework%2Ftensor_util.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fframework%2Ftensor_util.py?ref=e1fab9f0bba793ed5a839b92ff9c7cad4789bc84",
            "patch": "@@ -1281,6 +1281,10 @@ def is_tf_type(x):  # pylint: disable=invalid-name\n   Returns:\n     `True` if `x` is a TensorFlow-native type.\n   \"\"\"\n+  # ObjectProxy is a special type of object that is used by wrapt to wrap\n+  # objects. It is not a Tensor.\n+  if (type(x).__name__ == \"ObjectProxy\"):\n+    return False\n   return isinstance(x, tf_type_classes)\n \n "
        },
        {
            "sha": "3bcb4c9ccba3b9829deffd10d89220636f51b3b0",
            "filename": "tensorflow/python/trackable/data_structures.py",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e1fab9f0bba793ed5a839b92ff9c7cad4789bc84/tensorflow%2Fpython%2Ftrackable%2Fdata_structures.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e1fab9f0bba793ed5a839b92ff9c7cad4789bc84/tensorflow%2Fpython%2Ftrackable%2Fdata_structures.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Ftrackable%2Fdata_structures.py?ref=e1fab9f0bba793ed5a839b92ff9c7cad4789bc84",
            "patch": "@@ -23,9 +23,6 @@\n   # Fall back to the build-time dependency if the system package is not available.\n   from .....third_party import wrapt  # pylint: disable=relative-beyond-top-level\n \n-from tensorflow.python.eager import def_function\n-from tensorflow.python.eager import function as defun\n-from tensorflow.python.ops import variables\n from tensorflow.python.trackable import base\n from tensorflow.python.trackable import layer_utils\n from tensorflow.python.util.compat import collections_abc\n@@ -195,6 +192,8 @@ def trainable(self, value):\n \n   def _track_value(self, value, name):\n     \"\"\"Add a dependency on `value`.\"\"\"\n+    # pylint: disable=g-import-not-at-top\n+    from tensorflow.python.ops import variables\n     value = sticky_attribute_assignment(\n         trackable=self, value=value, name=name)\n     if isinstance(value, variables.Variable):\n@@ -810,6 +809,12 @@ def __reduce_ex__(self, protocol):\n             (self.__wrapped__,))\n \n   def __getattribute__(self, name):\n+    if name == \"__dict__\":\n+      # Returns __dict__ from wrapt.ObjectProxy\n+      try:\n+        return object.__getattribute__(self, \"__dict__\")\n+      except (AttributeError, TypeError):\n+        return {}\n     if (hasattr(type(self), name)\n         and isinstance(getattr(type(self), name), property)):\n       # Bypass ObjectProxy for properties. Whether this workaround is necessary\n@@ -1108,6 +1113,9 @@ def __getattribute__(self, name):\n \n \n def _is_function(x):\n+  # pylint: disable=g-import-not-at-top\n+  from tensorflow.python.eager import def_function\n+  from tensorflow.python.eager import function as defun\n   return isinstance(x, (def_function.Function, defun.ConcreteFunction))\n \n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 15,
        "deletions": 3
    }
}