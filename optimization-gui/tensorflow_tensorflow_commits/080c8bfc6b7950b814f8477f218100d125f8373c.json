{
    "author": "tensorflower-gardener",
    "message": "Add hash and equality functions to CollectiveDeviceList.\n\nPiperOrigin-RevId: 806034113",
    "sha": "080c8bfc6b7950b814f8477f218100d125f8373c",
    "files": [
        {
            "sha": "e6588a7693f7d3f5d725f0cf29043ad92e31d6ee",
            "filename": "third_party/xla/xla/hlo/ir/collective_device_list.h",
            "status": "modified",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/080c8bfc6b7950b814f8477f218100d125f8373c/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fcollective_device_list.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/080c8bfc6b7950b814f8477f218100d125f8373c/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fcollective_device_list.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fcollective_device_list.h?ref=080c8bfc6b7950b814f8477f218100d125f8373c",
            "patch": "@@ -16,6 +16,7 @@ limitations under the License.\n #ifndef XLA_HLO_IR_COLLECTIVE_DEVICE_LIST_H_\n #define XLA_HLO_IR_COLLECTIVE_DEVICE_LIST_H_\n \n+#include <cstddef>\n #include <cstdint>\n #include <memory>\n #include <optional>\n@@ -66,6 +67,13 @@ class IotaReplicaGroupList {\n            transpose_perm() == other.transpose_perm();\n   }\n \n+  template <typename H>\n+  friend H AbslHashValue(H h, const IotaReplicaGroupList& c) {\n+    return H::combine(std::move(h), c.num_replica_groups_,\n+                      c.num_devices_per_group_, c.reshape_dims(),\n+                      c.transpose_perm());\n+  }\n+\n   int64_t num_replica_groups() const;\n   int64_t num_devices_per_group() const;\n   absl::Span<const int64_t> reshape_dims() const {\n@@ -116,6 +124,36 @@ class CollectiveDeviceList {\n       const IotaReplicaGroupList& iota_replica_group_list)\n       : iota_replica_group_list_(iota_replica_group_list) {}\n \n+  bool operator==(const CollectiveDeviceList& other) const {\n+    if (iota_replica_group_list_.has_value() &&\n+        other.iota_replica_group_list_.has_value()) {\n+      return *iota_replica_group_list_ == *other.iota_replica_group_list_;\n+    }\n+    const auto& this_groups = replica_groups();\n+    const auto& other_groups = other.replica_groups();\n+    if (this_groups.size() != other_groups.size()) {\n+      return false;\n+    }\n+    for (size_t i = 0; i < this_groups.size(); ++i) {\n+      if (!tsl::protobuf::util::MessageDifferencer::Equals(this_groups[i],\n+                                                           other_groups[i])) {\n+        return false;\n+      }\n+    }\n+    return true;\n+  }\n+\n+  template <typename H>\n+  friend H AbslHashValue(H h, const CollectiveDeviceList& c) {\n+    const auto& groups = c.replica_groups();\n+    h = H::combine(std::move(h), groups.size());\n+    for (const auto& group : groups) {\n+      h = H::combine_contiguous(std::move(h), group.replica_ids().data(),\n+                                group.replica_ids().size());\n+    }\n+    return h;\n+  }\n+\n   // Lazyly explands iota if applicable.\n   const std::vector<ReplicaGroup>& replica_groups() const;\n   const std::optional<IotaReplicaGroupList>& iota_replica_group_list() const {"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 38,
        "deletions": 0
    }
}