{
    "author": "junwhanahn",
    "message": "Clean up IFRT futures\n\nIFRT defined aliases for futures/promises back when future/promise implementations were in PjRt as (1) it wouldn't make sense for IFRT users to directly use PjRt futures and (2) it might make it easier for IFRT to customize future implementations later. With recent move from PjRt futures to TSL futures, we decided to converge on TSL futures as (1) is no longer a concern and implementing new features on top of TSL futures may benefit other users as well.\n\nAll users of the IFRT futures have already been migrated to directly reference TSL futures.\n\nPiperOrigin-RevId: 812967576",
    "sha": "65335818d04fe1d11dd7b919a530dae16fa62926",
    "files": [
        {
            "sha": "1d40ac8ffe52a6deb0b588461a071967e3bb30e0",
            "filename": "third_party/xla/xla/python/ifrt/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/65335818d04fe1d11dd7b919a530dae16fa62926/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/65335818d04fe1d11dd7b919a530dae16fa62926/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD?ref=65335818d04fe1d11dd7b919a530dae16fa62926",
            "patch": "@@ -55,7 +55,6 @@ cc_library(\n         \"device_list.h\",\n         \"dtype.h\",\n         \"executable.h\",\n-        \"future.h\",\n         \"host_callback.h\",\n         \"index.h\",\n         \"index_domain.h\",\n@@ -234,21 +233,6 @@ xla_cc_test(\n     ],\n )\n \n-xla_cc_test(\n-    name = \"future_test\",\n-    size = \"small\",\n-    srcs = [\"future_test.cc\"],\n-    deps = [\n-        \":ifrt\",\n-        \"//xla/tsl/concurrency:future\",\n-        \"//xla/tsl/lib/core:status_test_util\",\n-        \"@com_google_absl//absl/status\",\n-        \"@com_google_absl//absl/status:status_matchers\",\n-        \"@com_google_absl//absl/types:span\",\n-        \"@com_google_googletest//:gtest_main\",\n-    ],\n-)\n-\n xla_cc_test(\n     name = \"index_domain_test\",\n     size = \"small\","
        },
        {
            "sha": "942b10b372874b7723f21808e00de53b76760fd5",
            "filename": "third_party/xla/xla/python/ifrt/future.h",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6d3931869f719fd8972184d523881f92e78973ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6d3931869f719fd8972184d523881f92e78973ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture.h?ref=6d3931869f719fd8972184d523881f92e78973ab",
            "patch": "@@ -1,45 +0,0 @@\n-/* Copyright 2022 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef XLA_PYTHON_IFRT_FUTURE_H_\n-#define XLA_PYTHON_IFRT_FUTURE_H_\n-\n-#include \"absl/base/macros.h\"\n-#include \"xla/tsl/concurrency/future.h\"\n-\n-namespace xla {\n-namespace ifrt {\n-\n-// Future reuses `tsl::Future` as the short-term implementation.\n-//\n-// We will address the following properties in a new `Future` implementation.\n-//\n-// * Creating and destroying Future should be very cheap if no one ever awaits\n-// on the `Future`.\n-//\n-// * Awaiting on a `Future` should possibly be cancellable to lower overhead\n-// when the `Future` value woudld be no longer useful or relevant.\n-template <typename T = void>\n-using Future ABSL_DEPRECATE_AND_INLINE() = ::tsl::Future<T>;\n-\n-template <typename T = void>\n-using Promise ABSL_DEPRECATE_AND_INLINE() = ::tsl::Promise<T>;\n-\n-using ::tsl::JoinFutures;\n-\n-}  // namespace ifrt\n-}  // namespace xla\n-\n-#endif  // XLA_PYTHON_IFRT_FUTURE_H_"
        },
        {
            "sha": "90578b36d8baa6a4abb3fef8cf718e2fd5585096",
            "filename": "third_party/xla/xla/python/ifrt/future_test.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 140,
            "changes": 140,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6d3931869f719fd8972184d523881f92e78973ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6d3931869f719fd8972184d523881f92e78973ab/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ffuture_test.cc?ref=6d3931869f719fd8972184d523881f92e78973ab",
            "patch": "@@ -1,140 +0,0 @@\n-/* Copyright 2022 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#include \"xla/python/ifrt/future.h\"\n-\n-#include <tuple>\n-#include <utility>\n-#include <vector>\n-\n-#include <gmock/gmock.h>\n-#include <gtest/gtest.h>\n-#include \"absl/status/status.h\"\n-#include \"absl/status/status_matchers.h\"\n-#include \"absl/types/span.h\"\n-#include \"xla/tsl/concurrency/future.h\"\n-#include \"xla/tsl/lib/core/status_test_util.h\"\n-\n-namespace xla::ifrt {\n-namespace {\n-\n-using ::testing::HasSubstr;\n-\n-TEST(FutureTest, JoinZeroFuture) {\n-  tsl::Future<> future = JoinFutures({});\n-\n-  TF_EXPECT_OK(future.Await());\n-}\n-\n-TEST(FutureTest, JoinOneOkFuture) {\n-  auto [promise, future] = tsl::Future<>::MakePromise();\n-  std::vector<tsl::Future<>> futures = {std::move(future)};\n-\n-  tsl::Future<> joined = JoinFutures(absl::MakeSpan(futures));\n-\n-  ASSERT_FALSE(joined.IsReady());\n-  promise.Set(absl::OkStatus());\n-  TF_EXPECT_OK(joined.Await());\n-}\n-\n-TEST(FutureTest, JoinOneFailingFuture) {\n-  auto [promise, future] = tsl::Future<>::MakePromise();\n-  std::vector<tsl::Future<>> futures = {std::move(future)};\n-\n-  tsl::Future<> joined = JoinFutures(absl::MakeSpan(futures));\n-\n-  ASSERT_FALSE(joined.IsReady());\n-  promise.Set(absl::InvalidArgumentError(\"Some error\"));\n-  EXPECT_THAT(joined.Await(),\n-              absl_testing::StatusIs(absl::StatusCode::kInvalidArgument,\n-                                     HasSubstr(\"Some error\")));\n-}\n-\n-TEST(FutureTest, JoinAllOkFutures) {\n-  constexpr int kNumFutures = 3;\n-  std::vector<tsl::Promise<>> promises;\n-  std::vector<tsl::Future<>> futures;\n-  promises.reserve(kNumFutures);\n-  futures.reserve(kNumFutures);\n-  for (int i = 0; i < kNumFutures; ++i) {\n-    std::tie(promises.emplace_back(), futures.emplace_back()) =\n-        tsl::Future<>::MakePromise();\n-  }\n-\n-  tsl::Future<> joined = JoinFutures(absl::MakeSpan(futures));\n-\n-  ASSERT_FALSE(joined.IsReady());\n-  for (tsl::Promise<>& promise : promises) {\n-    promise.Set(absl::OkStatus());\n-  }\n-  TF_EXPECT_OK(joined.Await());\n-}\n-\n-TEST(FutureTest, JoinAllFailingFutures) {\n-  constexpr int kNumFutures = 3;\n-  std::vector<tsl::Promise<>> promises;\n-  std::vector<tsl::Future<>> futures;\n-  promises.reserve(kNumFutures);\n-  futures.reserve(kNumFutures);\n-  for (int i = 0; i < kNumFutures; ++i) {\n-    std::tie(promises.emplace_back(), futures.emplace_back()) =\n-        tsl::Future<>::MakePromise();\n-  }\n-\n-  tsl::Future<> joined = JoinFutures(absl::MakeSpan(futures));\n-\n-  ASSERT_FALSE(joined.IsReady());\n-  for (tsl::Promise<>& promise : promises) {\n-    promise.Set(absl::InvalidArgumentError(\"Some error\"));\n-  }\n-  EXPECT_THAT(joined.Await(),\n-              absl_testing::StatusIs(absl::StatusCode::kInvalidArgument,\n-                                     HasSubstr(\"Some error\")));\n-}\n-\n-class JoinAllOkFuturesExceptForOneTest : public testing::TestWithParam<int> {};\n-\n-TEST_P(JoinAllOkFuturesExceptForOneTest, JoinAllOkFuturesExceptForOne) {\n-  const int kNumFutures = 3;\n-  const int failing_future_idx = GetParam();\n-  std::vector<tsl::Promise<>> promises;\n-  std::vector<tsl::Future<>> futures;\n-  promises.reserve(kNumFutures);\n-  futures.reserve(kNumFutures);\n-  for (int i = 0; i < kNumFutures; ++i) {\n-    std::tie(promises.emplace_back(), futures.emplace_back()) =\n-        tsl::Future<>::MakePromise();\n-  }\n-\n-  tsl::Future<> joined = JoinFutures(absl::MakeSpan(futures));\n-\n-  ASSERT_FALSE(joined.IsReady());\n-  for (int i = 0; i < kNumFutures; ++i) {\n-    if (i == failing_future_idx) {\n-      promises[i].Set(absl::InvalidArgumentError(\"Some error\"));\n-    } else {\n-      promises[i].Set(absl::OkStatus());\n-    }\n-  }\n-  EXPECT_THAT(joined.Await(),\n-              absl_testing::StatusIs(absl::StatusCode::kInvalidArgument,\n-                                     HasSubstr(\"Some error\")));\n-}\n-\n-INSTANTIATE_TEST_SUITE_P(FutureTest, JoinAllOkFuturesExceptForOneTest,\n-                         testing::Range(0, 3));\n-\n-}  // namespace\n-}  // namespace xla::ifrt"
        }
    ],
    "stats": {
        "total": 201,
        "additions": 0,
        "deletions": 201
    }
}