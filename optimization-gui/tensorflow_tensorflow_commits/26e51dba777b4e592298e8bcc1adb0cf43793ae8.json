{
    "author": "tensorflower-gardener",
    "message": "IFRT Proxy: Implement GetCostAnalysis.\n\nThis CL also changes xla_executable_impl_test_lib.cc so that `GetCostAnalysis` is in a separate testcase from `GetHloModules`.\n\nPiperOrigin-RevId: 814333324",
    "sha": "26e51dba777b4e592298e8bcc1adb0cf43793ae8",
    "files": [
        {
            "sha": "212a6573f88e1301f0778d6d02f6585d15e1cced",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client_test.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -331,7 +331,8 @@ int main(int argc, char** argv) {\n       \"*LoadedExecutableImplTest.Properties*:\"\n       // Incorrect deleted state of donated inputs.\n       \"*LoadedExecutableImplTest.Donation*:\"\n-      // Analysis methods are not implemented.\n+      // GetHloModules and Analysis methods are not implemented.\n+      \"*LoadedExecutableImplTest.GetHloModules*:\"\n       \"*LoadedExecutableImplTest.Analysis*:\"\n       // Serialization is not implemented.\n       \"*SerializeAndLoad*\";"
        },
        {
            "sha": "4e4f4b88871c693f2c1085e758dd116f30172202",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 2,
            "changes": 31,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -369,7 +369,6 @@ LoadedExecutable::LoadedExecutable(\n   }\n \n   tsl::profiler::TraceMe traceme_ifrt_entrypoint(\n-\n       \"IfrtProxyEntrypointLoadedExecutableCreate\");\n   // Asynchronously fetch shardings. Since users of `LoadedExecutable` typically\n   // require sharding information to invoke the executable, it is beneficial to\n@@ -620,7 +619,35 @@ LoadedExecutable::GetHloModules() const {\n \n absl::StatusOr<xla::ifrt::AttributeMap> LoadedExecutable::GetCostAnalysis()\n     const {\n-  return absl::UnimplementedError(\"Unimplemented\");\n+  if (rpc_helper_->protocol_version() <\n+      protocol_version::kLoadedExecutableGetCostAnalysis) {\n+    return absl::UnimplementedError(\n+        \"LoadedExecutable::GetCostAnalysis() is unimplemented by IFRT proxy\");\n+  }\n+\n+  absl::MutexLock l(cost_analysis_mu_);\n+  if (!cost_analysis_response_.has_value()) {\n+    auto req = std::make_unique<LoadedExecutableCostAnalysisRequest>();\n+    req->set_loaded_executable_handle(handle_);\n+\n+    absl::StatusOr<std::shared_ptr<LoadedExecutableCostAnalysisResponse>>\n+        response =\n+            rpc_helper_->LoadedExecutableCostAnalysis(std::move(req)).Await();\n+\n+    if (!response.ok()) {\n+      // Connection-related error, so log the error.\n+      LOG(ERROR) << \"LoadedExecutableCostAnalysis: Got \" << response.status();\n+      cost_analysis_response_ = response.status();\n+    }\n+    if (response.ok() && response.value()->has_attributes()) {\n+      cost_analysis_response_ =\n+          AttributeMap::FromProto(response.value()->attributes());\n+    } else {\n+      cost_analysis_response_ =\n+          tsl::StatusFromProto(response.value()->status());\n+    }\n+  }\n+  return *cost_analysis_response_;\n }\n \n absl::StatusOr<xla::ifrt::LoadedExecutable::ExecuteResult>"
        },
        {
            "sha": "1d3bddb45f49312e39ee415e65d2881212623d7f",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.h",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -157,8 +157,15 @@ class LoadedExecutable final\n   const std::unique_ptr<OutputSpecCache> output_spec_cache_;\n \n   // Metadata queried when the executable is created. Declared as `mutable`\n-  // since `tsl::Future::Await()` is not const.\n+  // since `Future::Await()` is not const.\n   mutable tsl::Future<std::shared_ptr<Metadata>> metadata_future_;\n+\n+  // The cached value of `GetCostAnalysis()`. The value is obtained from the\n+  // proxy-server the first time that the user invokes `GetCostAnalysis()`, and\n+  // is cached afterwards.\n+  mutable absl::Mutex cost_analysis_mu_;\n+  mutable std::optional<absl::StatusOr<xla::ifrt::AttributeMap>>\n+      cost_analysis_response_ ABSL_GUARDED_BY(cost_analysis_mu_);\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "aef5b64dc67496c5837312bbde8dacf2a9cca192",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -341,6 +341,7 @@ RPC(FullyReplicatedShard, fully_replicated_shard);\n RPC(DeleteArray, delete_array);\n RPC(Compile, compile);\n RPC(LoadedExecutableMetadata, loaded_executable_metadata);\n+RPC(LoadedExecutableCostAnalysis, loaded_executable_cost_analysis);\n RPC(LoadedExecutableExecute, loaded_executable_execute);\n RPC(LoadedExecutableDelete, loaded_executable_delete);\n RPC(LoadedExecutableIsDeleted, loaded_executable_is_deleted);"
        },
        {
            "sha": "3fb02450a2a78aeb879fa3b3dc06299edf5e7caf",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -138,6 +138,9 @@ class RpcHelper {\n \n   ResponseFuture<LoadedExecutableMetadataResponse> LoadedExecutableMetadata(\n       std::unique_ptr<LoadedExecutableMetadataRequest> req);\n+  ResponseFuture<LoadedExecutableCostAnalysisResponse>\n+  LoadedExecutableCostAnalysis(\n+      std::unique_ptr<LoadedExecutableCostAnalysisRequest> req);\n   ResponseFuture<LoadedExecutableExecuteResponse> LoadedExecutableExecute(\n       std::unique_ptr<LoadedExecutableExecuteRequest> req);\n   ResponseFuture<LoadedExecutableDeleteResponse> LoadedExecutableDelete("
        },
        {
            "sha": "d476275928c326a5be399259de064b81b1b1fa0d",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/VERSION.md",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2FVERSION.md?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -100,7 +100,13 @@\n \n ## Version kGrpcAllowLargeTransferOptimizationViaSharedDirectory\n \n-*   Added date: 2025-10-22\n+*   Added date: 2025-09-22\n *   Changes:\n     *   Optimize large transfers with the proxy-server and client in the same\n     machine to by using the file system.\n+\n+## Version kLoadedExecutableGetCostAnalysis\n+\n+*   Added date: 2025-10-01\n+*   Changes:\n+    *   Added support for `LoadedExecutable::GetCostAnalysis()`."
        },
        {
            "sha": "95b36fc1c3a534026579bc8c253c0251f92526c9",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/ifrt_service.proto",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fifrt_service.proto?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -37,6 +37,7 @@ message IfrtProxyVersion {\n   int32 ifrt_serdes_version_number = 2;\n }\n \n+// Next ID: 29.\n message IfrtRequest {\n   RequestMetadata request_metadata = 1;\n \n@@ -72,6 +73,8 @@ message IfrtRequest {\n     // ===== LoadedExecutable =====\n     LoadedExecutableMetadataRequest loaded_executable_metadata_request = 14;\n     LoadedExecutableExecuteRequest loaded_executable_execute_request = 15;\n+    LoadedExecutableCostAnalysisRequest\n+        loaded_executable_cost_analysis_request = 28;\n     LoadedExecutableDeleteRequest loaded_executable_delete_request = 16\n         [deprecated = true];\n     LoadedExecutableIsDeletedRequest loaded_executable_is_deleted_request = 17\n@@ -91,6 +94,7 @@ message IfrtRequest {\n   reserved 10;\n }\n \n+// Next ID: 29.\n message IfrtResponse {\n   ResponseMetadata response_metadata = 1;\n \n@@ -126,6 +130,8 @@ message IfrtResponse {\n     // ===== LoadedExecutable =====\n     LoadedExecutableMetadataResponse loaded_executable_metadata_response = 14;\n     LoadedExecutableExecuteResponse loaded_executable_execute_response = 15;\n+    LoadedExecutableCostAnalysisResponse\n+        loaded_executable_cost_analysis_response = 28;\n     LoadedExecutableDeleteResponse loaded_executable_delete_response = 16;\n     LoadedExecutableIsDeletedResponse loaded_executable_is_deleted_response =\n         17;\n@@ -500,6 +506,20 @@ message LoadedExecutableMetadataResponse {\n   int64 size_of_generated_code_in_bytes = 12;\n }\n \n+// Queries the value of `LoadedExecutable::GetCostAnalysis()`. Separate from\n+// LoadedExecutableMetadataRequest since `GetCostAnalysis()` has non-trivial\n+// cost.\n+message LoadedExecutableCostAnalysisRequest {\n+  fixed64 loaded_executable_handle = 1;\n+}\n+\n+message LoadedExecutableCostAnalysisResponse {\n+  oneof result {\n+    tensorflow.StatusProto status = 1;\n+    AttributeMapProto attributes = 2;\n+  }\n+}\n+\n // Mirrors `LoadedExecutable::Execute`. Returns output array handles and a\n // future handle that becomes ready when the execution completes. The latter can\n // be checked by issuing `CheckFutureRequest`."
        },
        {
            "sha": "dadc3ce75005e1a3484308aafc7ef3afd7f87941",
            "filename": "third_party/xla/xla/python/ifrt_proxy/common/versions.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fcommon%2Fversions.h?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -54,6 +54,9 @@ enum {\n   // machine to by using the file system.\n   kGrpcAllowLargeTransferOptimizationViaSharedDirectory = 17,\n \n+  // kLoadedExecutableGetCostAnalysis implements GetCostAnalysis in Executable.\n+  kLoadedExecutableGetCostAnalysis = 18,\n+\n   // kSentiel is used to derive kCurrent below. Keep this as the last value of\n   // the enum.\n   kSentiel,"
        },
        {
            "sha": "d0ea05528b72bdeb23a0ac36ae825424f69e296d",
            "filename": "third_party/xla/xla/python/ifrt_proxy/integration_tests/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2FBUILD?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -97,7 +97,6 @@ ifrt_proxy_cc_test(\n     ] + if_oss([\"not_run:arm\"]),  # TODO(b/394180263): reenable this.\n     deps = [\n         \":register_pjrt_cpu_for_ifrt_api_tests\",  # buildcleaner: keep\n-        \"//xla/python/ifrt:test_util\",\n         \"//xla/python/pjrt_ifrt:xla_executable_impl_test_lib\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest\","
        },
        {
            "sha": "d35d219297c031bc32a0ff6115f8085239600192",
            "filename": "third_party/xla/xla/python/ifrt_proxy/integration_tests/executable_impl_test_tfrt_cpu.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2Fexecutable_impl_test_tfrt_cpu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2Fexecutable_impl_test_tfrt_cpu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fintegration_tests%2Fexecutable_impl_test_tfrt_cpu.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -18,12 +18,11 @@\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/strings/string_view.h\"\n-#include \"xla/python/ifrt/test_util.h\"\n \n int main(int argc, char** argv) {\n   const std::string disabled[] = {\n-      // IFRT Proxy does not support `GetHloModules`.\n-      \"*LoadedExecutableImplTest.Analysis*\",\n+      // Neither IFRT Proxy nor PjRt CPU does not support `GetHloModules`.\n+      \"*LoadedExecutableImplTest.GetHloModules*\",\n       // CPU backend does not support serialization.\n       \"*SerializeAndLoad*\",\n   };"
        },
        {
            "sha": "879b8c23864570d15f409cb7f2854c40e6880b7b",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend.cc",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -594,6 +594,8 @@ tsl::Future<BackendInterface::Response> IfrtBackend::ProcessInternal(\n       return tsl::Future<Response>(HandleCompileRequest(std::move(request)));\n     case IfrtRequest::RequestCase::kLoadedExecutableMetadataRequest:\n       return HandleLoadedExecutableMetadataRequest(std::move(request));\n+    case IfrtRequest::RequestCase::kLoadedExecutableCostAnalysisRequest:\n+      return HandleLoadedExecutableCostAnalysisRequest(std::move(request));\n     case IfrtRequest::RequestCase::kLoadedExecutableExecuteRequest: {\n       asr.emplace(\n           request->loaded_executable_execute_request().result_array_handle(),\n@@ -1624,6 +1626,32 @@ IfrtBackend::HandleLoadedExecutableMetadataRequest(\n   });\n }\n \n+tsl::Future<BackendInterface::Response>\n+IfrtBackend::HandleLoadedExecutableCostAnalysisRequest(\n+    std::unique_ptr<IfrtRequest> request) {\n+  absl::StatusOr<std::shared_ptr<LoadedExecutableWithInfo>> executable_info =\n+      GetLoadedExecutable(request->loaded_executable_cost_analysis_request()\n+                              .loaded_executable_handle());\n+\n+  if (!executable_info.ok()) {\n+    return tsl::Future<BackendInterface::Response>(executable_info.status());\n+  }\n+\n+  auto cost_analysis = executable_info->get()->executable->GetCostAnalysis();\n+\n+  std::unique_ptr<IfrtResponse> ifrt_resp =\n+      NewIfrtResponse(request->request_metadata().op_id());\n+\n+  if (cost_analysis.ok()) {\n+    *ifrt_resp->mutable_loaded_executable_cost_analysis_response()\n+         ->mutable_attributes() = cost_analysis->ToProto();\n+  } else {\n+    *ifrt_resp->mutable_loaded_executable_cost_analysis_response()\n+         ->mutable_status() = tsl::StatusToProto(cost_analysis.status());\n+  }\n+  return tsl::Future<BackendInterface::Response>(std::move(ifrt_resp));\n+}\n+\n absl::StatusOr<BackendInterface::Response>\n IfrtBackend::HandleLoadedExecutableExecuteRequest(\n     ArrayStore::Reservation& asr, std::unique_ptr<IfrtRequest> request) {"
        },
        {
            "sha": "1cd0d21f9669acdba411586f4938f6167028f1e6",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.h?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -212,6 +212,8 @@ class IfrtBackend final : public BackendInterface {\n \n   tsl::Future<Response> HandleLoadedExecutableMetadataRequest(\n       std::unique_ptr<IfrtRequest> request);\n+  Future<Response> HandleLoadedExecutableCostAnalysisRequest(\n+      std::unique_ptr<IfrtRequest> request);\n   absl::StatusOr<Response> HandleLoadedExecutableExecuteRequest(\n       ArrayStore::Reservation& asr, std::unique_ptr<IfrtRequest> request);\n   absl::StatusOr<Response> HandleLoadedExecutableDeleteRequest("
        },
        {
            "sha": "541464086485c9f5d4d55d4a202855aeb3340a58",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/xla_executable_impl_test_lib.cc",
            "status": "modified",
            "additions": 36,
            "deletions": 6,
            "changes": 42,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/26e51dba777b4e592298e8bcc1adb0cf43793ae8/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc?ref=26e51dba777b4e592298e8bcc1adb0cf43793ae8",
            "patch": "@@ -233,11 +233,12 @@ module @add_sub attributes {\n                     StatusIs(absl::StatusCode::kUnimplemented)));\n }\n \n-TEST_P(LoadedExecutableImplTest, Analysis) {\n+TEST_P(LoadedExecutableImplTest, GetHloModules) {\n   bool serialize = GetParam();\n \n   if (serialize) {\n-    GTEST_SKIP() << \"Analysis is not supported for serialized executables.\";\n+    GTEST_SKIP()\n+        << \"GetHloModules is not supported for serialized executables.\";\n   }\n \n   static constexpr absl::string_view kModule = R\"(\n@@ -261,15 +262,44 @@ module @add attributes {\n                        {client->addressable_devices().front()},\n                        /*replicated=*/false, serialize));\n \n-  TF_ASSERT_OK_AND_ASSIGN(const xla::CompiledMemoryStats compiled_memory_stats,\n-                          executable->GetCompiledMemoryStats());\n-  EXPECT_GT(compiled_memory_stats.argument_size_in_bytes, 0);\n-\n   TF_ASSERT_OK_AND_ASSIGN(\n       const std::vector<std::shared_ptr<xla::HloModule>> hlo_modules,\n       executable->GetHloModules());\n   ASSERT_EQ(hlo_modules.size(), 1);\n   EXPECT_EQ(hlo_modules.front()->name(), \"add\");\n+}\n+\n+TEST_P(LoadedExecutableImplTest, Analysis) {\n+  bool serialize = GetParam();\n+\n+  if (serialize) {\n+    GTEST_SKIP() << \"Analysis is not supported for serialized executables.\";\n+  }\n+\n+  static constexpr absl::string_view kModule = R\"(\n+module @add attributes {\n+  mhlo.num_replicas = 1 : i32,\n+  mhlo.num_partitions = 2 : i32\n+} {\n+  func.func @main(\n+    %arg0: tensor<2x3xi32> {mhlo.sharding = \"{devices=[2,1]<=[2]}\"}\n+  ) -> (tensor<2x3xi32> {mhlo.sharding = \"{devices=[2,1]<=[2]}\"}) {\n+    %0 = stablehlo.add %arg0, %arg0 : tensor<2x3xi32>\n+    return %0 : tensor<2x3xi32>\n+  }\n+})\";\n+  TF_ASSERT_OK_AND_ASSIGN(auto client, test_util::GetClient());\n+  Compiler* compiler = client->GetDefaultCompiler();\n+\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      const LoadedExecutableRef executable,\n+      CompileOnDevices(client.get(), compiler, kModule,\n+                       {client->addressable_devices().front()},\n+                       /*replicated=*/false, serialize));\n+\n+  TF_ASSERT_OK_AND_ASSIGN(const xla::CompiledMemoryStats compiled_memory_stats,\n+                          executable->GetCompiledMemoryStats());\n+  EXPECT_GT(compiled_memory_stats.argument_size_in_bytes, 0);\n \n   TF_ASSERT_OK_AND_ASSIGN(const auto cost_analysis,\n                           executable->GetCostAnalysis());"
        }
    ],
    "stats": {
        "total": 156,
        "additions": 141,
        "deletions": 15
    }
}