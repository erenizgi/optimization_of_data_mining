{
    "author": "hyeontaek",
    "message": "[IFRT] Remove `GetUserContext()` utility function\n\nThis change removes `xla::ifrt::GetUserContext()` because it serves no\npurposes now. IFRT users will set up a user context using\n`xla::ifrt::UserContextScope`, IFRT implementations will always retrieve\nit using `xla::ifrt::UserContextScope::current()`.\n\n`xla::ifrt::Client::CreateUserContext()` will be removed shortly.\n\nA few locations within IFRT implementations that call `xla::ifrt::GetUserContext()` or set up `xla::ifrt::UserContextScope` have been removed since the IFRT user instead is expected to set up `xla::ifrt::UserContextScope` before calling into these implementation.\n\nPiperOrigin-RevId: 838957560",
    "sha": "4c99929df27ae7a6e0084942aae9e3aaa4ec572e",
    "files": [
        {
            "sha": "a973b6c57f351eb66a2516fca57b9aebaa99cf2f",
            "filename": "third_party/xla/xla/python/ifrt/client_impl_util.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.cc?ref=4c99929df27ae7a6e0084942aae9e3aaa4ec572e",
            "patch": "@@ -92,13 +92,6 @@ bool CanUseMakeArrayFromHostBuffer(\n \n }  // namespace\n \n-UserContextRef GetUserContext(Client* client) {\n-  if (UserContextScope::current() != nullptr) {\n-    return UserContextScope::current();\n-  }\n-  return client->CreateUserContext();\n-}\n-\n absl::StatusOr<std::vector<ArrayRef>> ClientMakeArraysFromHostBufferShards(\n     Client* client,\n     absl::Span<Client::MakeArraysFromHostBufferShardsSpec> specs,"
        },
        {
            "sha": "5027c0be148dfc4a980e46cf386b07279cabf430",
            "filename": "third_party/xla/xla/python/ifrt/client_impl_util.h",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient_impl_util.h?ref=4c99929df27ae7a6e0084942aae9e3aaa4ec572e",
            "patch": "@@ -28,16 +28,6 @@ limitations under the License.\n namespace xla {\n namespace ifrt {\n \n-// Convenient helper to choose the current `UserContextRef` in a uniform way.\n-//\n-// * If `UserContextScope::current() != nullptr`, `UserContextScope::current()`\n-//   is returned.\n-// * Otherwise, `client->CreateUserContext()` is returned.\n-//\n-// TODO(hyeontaek): Remove this helper and use `UserContextScope::current()`\n-// when there is no plural way of getting the current `UserContextRef`.\n-UserContextRef GetUserContext(Client* client);\n-\n // Portable adapter for `MakeArraysFromHostBufferShards`. It breaks downs\n // requests into `MakeArrayFromHostBuffer` calls followed by\n // `AssembleArrayFromSingleDeviceArrays`."
        },
        {
            "sha": "b81df5502354a3c1a883973406114167bb310d81",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4c99929df27ae7a6e0084942aae9e3aaa4ec572e/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend.cc?ref=4c99929df27ae7a6e0084942aae9e3aaa4ec572e",
            "patch": "@@ -950,7 +950,6 @@ IfrtBackend::HandleMakeArraysFromHostBufferShardsRequest(\n \n   std::move(cleanup).Invoke();\n \n-  UserContextScope user_context_scope(client_->CreateUserContext());\n   TF_ASSIGN_OR_RETURN(\n       std::vector<xla::ifrt::ArrayRef> arrays,\n       client_->MakeArraysFromHostBufferShards(\n@@ -1001,7 +1000,6 @@ IfrtBackend::HandleMakeErrorArraysRequest(\n     array_specs.push_back(std::move(array_spec));\n   }\n \n-  UserContextScope user_context_scope(client_->CreateUserContext());\n   TF_ASSIGN_OR_RETURN(std::vector<IfrtArrayRef> arrays,\n                       client_->MakeErrorArrays(error, array_specs));\n "
        }
    ],
    "stats": {
        "total": 19,
        "additions": 0,
        "deletions": 19
    }
}