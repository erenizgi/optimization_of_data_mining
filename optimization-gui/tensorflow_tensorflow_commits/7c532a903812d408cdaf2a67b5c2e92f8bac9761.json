{
    "author": "mwhittaker",
    "message": "Small fixes to copy of coordination service and preemption.\n\nPiperOrigin-RevId: 840328991",
    "sha": "7c532a903812d408cdaf2a67b5c2e92f8bac9761",
    "files": [
        {
            "sha": "2f4d808af8c8f0682f354c9f32b39f2ecf59127c",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2FBUILD?ref=7c532a903812d408cdaf2a67b5c2e92f8bac9761",
            "patch": "@@ -56,6 +56,7 @@ cc_library(\n         \":coordination_client\",\n         \":coordination_service_error_util\",\n         \":key_value_store\",\n+        \"//xla/service:global_device_id\",\n         \"//xla/tsl/distributed_runtime:call_options\",\n         \"//xla/tsl/lib/gtl:int_type\",\n         \"//xla/tsl/platform:env\","
        },
        {
            "sha": "35e174af3a52280bfa56979842aa5eb117c474c5",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h?ref=7c532a903812d408cdaf2a67b5c2e92f8bac9761",
            "patch": "@@ -37,6 +37,7 @@ limitations under the License.\n #include \"absl/time/time.h\"\n #include \"xla/pjrt/distributed/coordination/coordination_client.h\"\n #include \"xla/pjrt/distributed/coordination/key_value_store.h\"\n+#include \"xla/service/global_device_id.h\"\n #include \"xla/tsl/lib/gtl/int_type.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/status.h\"\n@@ -46,8 +47,6 @@ limitations under the License.\n \n namespace xla {\n \n-TSL_LIB_GTL_DEFINE_INT_TYPE(IncarnationId, uint64_t);\n-\n // Coordination service is used for controlling and coordinating distributed\n // execution in a cluster of multiple tasks.\n //"
        },
        {
            "sha": "f09feeb05fcb03359625ed945e3a79f7e1788d98",
            "filename": "third_party/xla/xla/pjrt/distributed/preemption/preemption_notifier.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.cc?ref=7c532a903812d408cdaf2a67b5c2e92f8bac9761",
            "patch": "@@ -116,7 +116,7 @@ void PreemptionNotifier::NotifyRegisteredListeners(\n   callbacks_.clear();\n }\n \n-REGISTER_PREEMPTION_NOTIFIER(\n+REGISTER_XLA_PREEMPTION_NOTIFIER(\n     \"sigterm\", [](tsl::Env* env) -> std::unique_ptr<PreemptionNotifier> {\n       return std::make_unique<SigtermNotifier>(env);\n     });"
        },
        {
            "sha": "d5e073886fb41bea634d7c8ce4009150df1e619c",
            "filename": "third_party/xla/xla/pjrt/distributed/preemption/preemption_notifier.h",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c532a903812d408cdaf2a67b5c2e92f8bac9761/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fpreemption%2Fpreemption_notifier.h?ref=7c532a903812d408cdaf2a67b5c2e92f8bac9761",
            "patch": "@@ -32,16 +32,16 @@ limitations under the License.\n namespace xla {\n \n // Static registration for preemption notifiers.\n-#define REGISTER_PREEMPTION_NOTIFIER(notifier_type_name, factory_fn)        \\\n-  REGISTER_PREEMPTION_NOTIFIER_UNIQ_HELPER(__COUNTER__, notifier_type_name, \\\n-                                           factory_fn)\n-#define REGISTER_PREEMPTION_NOTIFIER_UNIQ_HELPER(counter, notifier_type_name, \\\n-                                                 factory_fn)                  \\\n-  static bool static_preemption_notifier_##counter TF_ATTRIBUTE_UNUSED =      \\\n-      []() {                                                                  \\\n-        ::xla::PreemptionNotifier::RegisterPreemptionNotifier(                \\\n-            notifier_type_name, factory_fn);                                  \\\n-        return true;                                                          \\\n+#define REGISTER_XLA_PREEMPTION_NOTIFIER(notifier_type_name, factory_fn) \\\n+  REGISTER_XLA_PREEMPTION_NOTIFIER_UNIQ_HELPER(__COUNTER__,              \\\n+                                               notifier_type_name, factory_fn)\n+#define REGISTER_XLA_PREEMPTION_NOTIFIER_UNIQ_HELPER(                    \\\n+    counter, notifier_type_name, factory_fn)                             \\\n+  static bool static_preemption_notifier_##counter TF_ATTRIBUTE_UNUSED = \\\n+      []() {                                                             \\\n+        ::xla::PreemptionNotifier::RegisterPreemptionNotifier(           \\\n+            notifier_type_name, factory_fn);                             \\\n+        return true;                                                     \\\n       }()\n \n // Base class for listening and propagating task preemption notices.\n@@ -69,8 +69,8 @@ namespace xla {\n //\n // Users can extend this class to support custom preemption signals, by subclass\n // `PreemptionNotifier` with a custom constructor, register its creator (factory\n-// function) with `REGISTER_PREEMPTION_NOTIFIER`. The custom constructor should\n-// set up the communication with the cluster scheduler, and invoke the\n+// function) with `REGISTER_XLA_PREEMPTION_NOTIFIER`. The custom constructor\n+// should set up the communication with the cluster scheduler, and invoke the\n // `NotifyRegisteredListeners` method once a preemption signal is received.\n // See `SigtermNotifier` as an example.\n "
        }
    ],
    "stats": {
        "total": 30,
        "additions": 15,
        "deletions": 15
    }
}