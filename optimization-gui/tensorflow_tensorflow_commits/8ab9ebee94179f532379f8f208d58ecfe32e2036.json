{
    "author": "basioli-k",
    "message": "[XLA:CPU] Guard LLVM command line options when infering target machine\n\nPiperOrigin-RevId: 825233596",
    "sha": "8ab9ebee94179f532379f8f208d58ecfe32e2036",
    "files": [
        {
            "sha": "f9bdc7b6cfc7c68a49c13731d44ace2b9e55f046",
            "filename": "third_party/xla/xla/service/cpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8ab9ebee94179f532379f8f208d58ecfe32e2036/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8ab9ebee94179f532379f8f208d58ecfe32e2036/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD?ref=8ab9ebee94179f532379f8f208d58ecfe32e2036",
            "patch": "@@ -2170,6 +2170,7 @@ cc_library(\n         \"//xla/service:compiler\",\n         \"//xla/service:executable\",\n         \"//xla/service:hlo_module_config\",\n+        \"//xla/service/llvm_ir:llvm_command_line_options\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/log\","
        },
        {
            "sha": "ea29096a3cbb06e687792fdaaaef1759810a88a2",
            "filename": "third_party/xla/xla/service/cpu/cpu_aot_loader.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8ab9ebee94179f532379f8f208d58ecfe32e2036/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_loader.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8ab9ebee94179f532379f8f208d58ecfe32e2036/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_loader.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_loader.cc?ref=8ab9ebee94179f532379f8f208d58ecfe32e2036",
            "patch": "@@ -40,6 +40,7 @@ limitations under the License.\n #include \"xla/service/cpu/runtime_symbol_generator.h\"\n #include \"xla/service/executable.h\"\n #include \"xla/service/hlo_module_config.h\"\n+#include \"xla/service/llvm_ir/llvm_command_line_options.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/util.h\"\n@@ -88,6 +89,11 @@ absl::StatusOr<std::unique_ptr<FunctionLibrary>> LoadFunctionLibrary(\n     absl::Span<const ObjFileProto> obj_files, const HloModule* hlo_module) {\n   const HloModuleConfig& config = hlo_module->config();\n   const DebugOptions& debug_options = config.debug_options();\n+\n+  auto llvm_options = llvm_ir::ExtractXlaBackendExtraOptions(\n+      config.debug_options().xla_backend_extra_options());\n+  llvm_ir::LLVMCommandLineOptionsLock llvm_lock(llvm_options);\n+\n   TF_ASSIGN_OR_RETURN(\n       std::unique_ptr<llvm::TargetMachine> target_machine,\n       IrCompiler::InferTargetMachine(\n@@ -159,6 +165,10 @@ CpuAotLoader::LoadAotCompilationResult(\n       std::unique_ptr<HloModule> hlo_module,\n       HloModule::CreateFromProtoWithConfig(aot_result_proto.hlo_module()));\n \n+  auto llvm_options = llvm_ir::ExtractXlaBackendExtraOptions(\n+      hlo_module->config().debug_options().xla_backend_extra_options());\n+  llvm_ir::LLVMCommandLineOptionsLock llvm_lock(llvm_options);\n+\n   TF_ASSIGN_OR_RETURN(\n       std::unique_ptr<llvm::TargetMachine> target_machine,\n       IrCompiler::InferTargetMachine("
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}