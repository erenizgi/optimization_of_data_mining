{
    "author": "SiqiaoWu1993",
    "message": "Internal change only\n\nPiperOrigin-RevId: 818753795",
    "sha": "fcd421e9df0946288cbb745ae7193b8b2795d00c",
    "files": [
        {
            "sha": "6ff373d7ce0b439163b90cbb0b132cecee9789c8",
            "filename": "tensorflow/compiler/mlir/tfrt/transforms/ifrt/tf2hlo.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fcd421e9df0946288cbb745ae7193b8b2795d00c/tensorflow%2Fcompiler%2Fmlir%2Ftfrt%2Ftransforms%2Fifrt%2Ftf2hlo.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fcd421e9df0946288cbb745ae7193b8b2795d00c/tensorflow%2Fcompiler%2Fmlir%2Ftfrt%2Ftransforms%2Fifrt%2Ftf2hlo.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftfrt%2Ftransforms%2Fifrt%2Ftf2hlo.h?ref=fcd421e9df0946288cbb745ae7193b8b2795d00c",
            "patch": "@@ -77,6 +77,8 @@ class TfToHloCompiler {\n   virtual absl::StatusOr<std::string> Key(const Tf2HloArg& arg);\n \n   virtual absl::StatusOr<Tf2HloResult> CompileTfToHlo(Tf2HloArg& arg);\n+\n+  virtual bool IsXlaCompilationDisabled() const { return false; }\n };\n \n }  // namespace ifrt_serving"
        },
        {
            "sha": "f04545fcc6671295355e195ce20db96281f8bf39",
            "filename": "tensorflow/core/tfrt/ifrt/ifrt_serving_executable.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fcd421e9df0946288cbb745ae7193b8b2795d00c/tensorflow%2Fcore%2Ftfrt%2Fifrt%2Fifrt_serving_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fcd421e9df0946288cbb745ae7193b8b2795d00c/tensorflow%2Fcore%2Ftfrt%2Fifrt%2Fifrt_serving_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Ftfrt%2Fifrt%2Fifrt_serving_executable.cc?ref=fcd421e9df0946288cbb745ae7193b8b2795d00c",
            "patch": "@@ -590,11 +590,14 @@ IfrtServingExecutable::LookUpOrCreateExecutable(\n       return it->second;\n     }\n \n-    if (is_frozen_) {\n+    if (is_frozen_ || tf_to_hlo_compiler_->IsXlaCompilationDisabled()) {\n       tsl::Future<SharedCachedExecutableBundle> frozen_future(\n-          absl::FailedPreconditionError(\n-              \"Cannot compile for new input shapes after the executable is \"\n-              \"already frozen.\"));\n+          absl::FailedPreconditionError(absl::StrCat(\n+              \"Cannot compile for new input shapes. Either the executable is \"\n+              \"already frozen: \",\n+              is_frozen_,\n+              \" or XLA compilation disabled by ScopedTpuCompileDisabler: \",\n+              tf_to_hlo_compiler_->IsXlaCompilationDisabled())));\n       return frozen_future;\n     }\n "
        }
    ],
    "stats": {
        "total": 13,
        "additions": 9,
        "deletions": 4
    }
}