{
    "author": "ezhulenev",
    "message": "[tf2xla] Move allocator testing to allocator_test.cc\n\nPiperOrigin-RevId: 819967180",
    "sha": "57a6012c2ee442190ecc7fbe1f269f8790c345c1",
    "files": [
        {
            "sha": "2596317806786ce65b674db763770f3e4812a54b",
            "filename": "tensorflow/compiler/tf2xla/BUILD",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/57a6012c2ee442190ecc7fbe1f269f8790c345c1/tensorflow%2Fcompiler%2Ftf2xla%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/57a6012c2ee442190ecc7fbe1f269f8790c345c1/tensorflow%2Fcompiler%2Ftf2xla%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Ftf2xla%2FBUILD?ref=57a6012c2ee442190ecc7fbe1f269f8790c345c1",
            "patch": "@@ -411,6 +411,19 @@ cc_library(\n     ],\n )\n \n+tf_cc_test(\n+    name = \"allocator_test\",\n+    srcs = [\"allocator_test.cc\"],\n+    deps = [\n+        \":allocator\",\n+        \"//tensorflow/core:framework\",\n+        \"//tensorflow/core:test\",\n+        \"//tensorflow/core:test_main\",\n+        \"@local_xla//xla:cpu_function_runtime\",\n+        \"@local_xla//xla/backends/cpu:alignment\",\n+    ],\n+)\n+\n cc_library(\n     name = \"xla_compiled_cpu_function\",\n     srcs = [\"xla_compiled_cpu_function.cc\"],\n@@ -481,19 +494,6 @@ cc_library(\n     alwayslink = 1,\n )\n \n-tf_cc_test(\n-    name = \"cpu_function_runtime_test\",\n-    srcs = [\"cpu_function_runtime_test.cc\"],\n-    deps = [\n-        \":allocator\",\n-        \"//tensorflow/core:framework\",\n-        \"//tensorflow/core:test\",\n-        \"//tensorflow/core:test_main\",\n-        \"@local_xla//xla:cpu_function_runtime\",\n-        \"@local_xla//xla/backends/cpu:alignment\",\n-    ],\n-)\n-\n cc_library(\n     name = \"xla_jit_compiled_cpu_function\",\n     srcs = [\"xla_jit_compiled_cpu_function.cc\"],"
        },
        {
            "sha": "3e331180a8d5ab1bc33bf43e7f42e46b22b5957e",
            "filename": "tensorflow/compiler/tf2xla/allocator_test.cc",
            "status": "renamed",
            "additions": 6,
            "deletions": 24,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/57a6012c2ee442190ecc7fbe1f269f8790c345c1/tensorflow%2Fcompiler%2Ftf2xla%2Fallocator_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/57a6012c2ee442190ecc7fbe1f269f8790c345c1/tensorflow%2Fcompiler%2Ftf2xla%2Fallocator_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Ftf2xla%2Fallocator_test.cc?ref=57a6012c2ee442190ecc7fbe1f269f8790c345c1",
            "patch": "@@ -1,4 +1,4 @@\n-/* Copyright 2017 The TensorFlow Authors. All Rights Reserved.\n+/* Copyright 2025 The TensorFlow Authors. All Rights Reserved.\n \n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n@@ -13,16 +13,16 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/cpu_function_runtime.h\"\n+#include \"tensorflow/compiler/tf2xla/allocator.h\"\n \n #include <algorithm>\n #include <cstddef>\n #include <cstdint>\n #include <iterator>\n #include <vector>\n \n-#include \"tensorflow/compiler/tf2xla/allocator.h\"\n #include \"xla/backends/cpu/alignment.h\"\n+#include \"xla/cpu_function_runtime.h\"\n #include \"tensorflow/core/framework/allocator.h\"\n #include \"tensorflow/core/platform/test.h\"\n \n@@ -31,7 +31,7 @@ namespace {\n \n using ::xla::cpu_function_runtime::BufferInfo;\n \n-TEST(XlaCompiledCpuFunctionTest, AlignmentValue) {\n+TEST(AllocatorTest, AlignmentValue) {\n   // We've chosen 64 byte alignment for the tfcompile runtime to mimic the\n   // regular tensorflow allocator, which was chosen to play nicely with Eigen.\n   // The tfcompile runtime also has a requirement that comes from the xla\n@@ -72,7 +72,7 @@ void* MallocContiguousBuffersFromSizes(const intptr_t* sizes, size_t n,\n                                              bufs, annotate_initialized);\n }\n \n-TEST(XlaCompiledCpuFunctionTest, AlignedBufferBytes) {\n+TEST(AllocatorTest, AlignedBufferBytes) {\n   EXPECT_EQ(AlignedBufferBytesFromSizes(nullptr, 0), 0);\n \n   static constexpr intptr_t sizesA[1] = {-1};\n@@ -96,7 +96,7 @@ void* add_ptr(void* base, uintptr_t delta) {\n // expected nullptrs, and write to each byte of allocated memory.  We rely on\n // the leak checker to tell us if there's an inconsistency between malloc and\n // free.  We also check the contiguous property.\n-TEST(XlaCompiledCpuFunctionTest, MallocFreeContiguousBuffers) {\n+TEST(AllocatorTest, MallocFreeContiguousBuffers) {\n   // Test empty sizes.\n   void* base = MallocContiguousBuffersFromSizes(nullptr, 0, nullptr, false);\n   EXPECT_EQ(base, nullptr);\n@@ -158,23 +158,5 @@ TEST(XlaCompiledCpuFunctionTest, MallocFreeContiguousBuffers) {\n   FreeContiguous(base);\n }\n \n-void CheckRoundTripIsOk(const BufferInfo& buffer_info) {\n-  BufferInfo round_trip(buffer_info.Encode());\n-  ASSERT_EQ(round_trip, buffer_info);\n-}\n-\n-TEST(XlaCompiledCpuFunctionTest, BufferInfoTest) {\n-  CheckRoundTripIsOk(BufferInfo::MakeTempBuffer(0));\n-  CheckRoundTripIsOk(BufferInfo::MakeTempBuffer(4));\n-  CheckRoundTripIsOk(BufferInfo::MakeOnStackBuffer(0));\n-  CheckRoundTripIsOk(BufferInfo::MakeOnStackBuffer(4));\n-  CheckRoundTripIsOk(BufferInfo::MakeConstant(0));\n-  CheckRoundTripIsOk(BufferInfo::MakeConstant(4));\n-  CheckRoundTripIsOk(\n-      BufferInfo::MakeEntryParameter(/*size=*/0, /*param_number=*/4));\n-  CheckRoundTripIsOk(\n-      BufferInfo::MakeEntryParameter(/*size=*/4, /*param_number=*/0));\n-}\n-\n }  // namespace\n }  // namespace tensorflow",
            "previous_filename": "tensorflow/compiler/tf2xla/cpu_function_runtime_test.cc"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 19,
        "deletions": 37
    }
}