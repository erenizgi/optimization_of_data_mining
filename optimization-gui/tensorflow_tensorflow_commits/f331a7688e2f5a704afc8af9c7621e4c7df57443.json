{
    "author": "danilaml",
    "message": "Compile tensorflow shared library with -Bsymbolic-functions\n\nAnd properly version symbols in tensorflow_framework",
    "sha": "f331a7688e2f5a704afc8af9c7621e4c7df57443",
    "files": [
        {
            "sha": "7f22dbe47327b4db947857fdd3d07f94c3b6ef03",
            "filename": "tensorflow/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2FBUILD?ref=f331a7688e2f5a704afc8af9c7621e4c7df57443",
            "patch": "@@ -1163,6 +1163,7 @@ tf_cc_shared_library(\n         ],\n         \"//conditions:default\": [\n             \"-Wl,--version-script,$(location //tensorflow:tf_framework_version_script.lds)\",\n+            \"-Wl,-Bsymbolic-functions\",\n             # copybara:uncomment_begin(google-only)\n             # \"-Wl,--undefined-version\",\n             # copybara:uncomment_end(google-only)\n@@ -1311,6 +1312,7 @@ tf_cc_shared_library(\n         \"//conditions:default\": [\n             \"-Wl,-z,defs\",\n             \"-Wl,--version-script,$(location //tensorflow:tf_version_script.lds)\",\n+            \"-Wl,-Bsymbolic-functions\",\n         ],\n     }),\n     per_os_targets = True,\n@@ -1576,6 +1578,7 @@ exports_files(\n         \"tf_version_script.lds\",\n         \"tf_exported_symbols.lds\",\n         \"tf_private_symbols.lds\",\n+        \"tf_framework_version_script.lds\",\n     ],\n )\n "
        },
        {
            "sha": "e2fe23ed431bbb75fc2d4663dc5eafff67cd0f49",
            "filename": "tensorflow/python/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2Fpython%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2Fpython%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2FBUILD?ref=f331a7688e2f5a704afc8af9c7621e4c7df57443",
            "patch": "@@ -1567,6 +1567,7 @@ pywrap_library(\n                 \"-lpthread\",\n                 \"-ldl\",\n                 \"-lm\",\n+                \"-Wl,-Bsymbolic-functions\",\n             ],\n         }),\n         \"tensorflow/tensorflow_cc\": select({\n@@ -1587,12 +1588,18 @@ pywrap_library(\n                 \"-lpthread\",\n                 \"-ldl\",\n                 \"-lm\",\n+                \"-Wl,-Bsymbolic-functions\",\n             ],\n         }),\n     },\n     # buildifier: disable=unsorted-dict-items\n     # @unsorted-dict-items\n     common_lib_version_scripts = {\n+        \"tensorflow/tensorflow_framework\": select({\n+            \"//tensorflow:windows\": None,\n+            \"//tensorflow:macos\": None,\n+            \"//conditions:default\": \"//tensorflow:tf_framework_version_script.lds\",\n+        }),\n         \"tensorflow/tensorflow_cc\": select({\n             \"//tensorflow:windows\": None,\n             \"//tensorflow:macos\": \"//tensorflow:tf_exported_symbols.lds\","
        },
        {
            "sha": "a95f97d996ea8cf70146e582decac0e24ff8a2f1",
            "filename": "tensorflow/tf_framework_version_script.lds",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2Ftf_framework_version_script.lds",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f331a7688e2f5a704afc8af9c7621e4c7df57443/tensorflow%2Ftf_framework_version_script.lds",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Ftf_framework_version_script.lds?ref=f331a7688e2f5a704afc8af9c7621e4c7df57443",
            "patch": "@@ -1,5 +1,4 @@\n-VERS_1.0 {\n-  # Hide libjpeg symbols to avoid symbol conflict with OpenCV\n-  local:\n-    *mlir*;\n+tensorflow {\n+  global:\n+    *;\n };"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 13,
        "deletions": 4
    }
}