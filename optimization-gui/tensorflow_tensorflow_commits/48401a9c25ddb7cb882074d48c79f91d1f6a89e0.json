{
    "author": "tensorflower-gardener",
    "message": "Use existing NextChannelId function inside CallInliner\n\nUse the existing function NextChannelId from the hlo_query instead of duplicating the logic inside the pass.\n\nPiperOrigin-RevId: 849988876",
    "sha": "48401a9c25ddb7cb882074d48c79f91d1f6a89e0",
    "files": [
        {
            "sha": "31d618c31b886bffef5adb8122da0a0fc16846ab",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/48401a9c25ddb7cb882074d48c79f91d1f6a89e0/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/48401a9c25ddb7cb882074d48c79f91d1f6a89e0/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=48401a9c25ddb7cb882074d48c79f91d1f6a89e0",
            "patch": "@@ -1025,6 +1025,7 @@ cc_library(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/hlo/pass:hlo_pass\",\n         \"//xla/hlo/transforms/simplifiers:hlo_dce\",\n+        \"//xla/hlo/utils:hlo_query\",\n         \"//xla/service/spmd/shardy:constants\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\","
        },
        {
            "sha": "ac16c42f64ca6baef13d69a8fe8ed9c9984e4e91",
            "filename": "third_party/xla/xla/service/call_inliner.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 15,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/48401a9c25ddb7cb882074d48c79f91d1f6a89e0/third_party%2Fxla%2Fxla%2Fservice%2Fcall_inliner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/48401a9c25ddb7cb882074d48c79f91d1f6a89e0/third_party%2Fxla%2Fxla%2Fservice%2Fcall_inliner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcall_inliner.cc?ref=48401a9c25ddb7cb882074d48c79f91d1f6a89e0",
            "patch": "@@ -42,6 +42,7 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_schedule.h\"\n #include \"xla/hlo/ir/hlo_sharding_metadata.h\"\n #include \"xla/hlo/transforms/simplifiers/hlo_dce.h\"\n+#include \"xla/hlo/utils/hlo_query.h\"\n #include \"xla/service/call_graph.h\"\n #include \"xla/service/hlo_domain_isolator.h\"\n #include \"xla/service/spmd/shardy/constants.h\"\n@@ -460,21 +461,7 @@ absl::StatusOr<bool> CallInliner::RunWithInlineMap(\n     const absl::flat_hash_set<absl::string_view>& execution_threads) {\n   std::unique_ptr<CallGraph> call_graph = CallGraph::Build(module);\n   if (uniquify_channel_ids_) {\n-    // If we're going to uniquify channel IDs, make sure the new IDs we assigned\n-    // are not already used in the module. The easiest way is to just start at\n-    // the top currently used ID.\n-    for (HloComputation* computation : module->computations()) {\n-      for (HloInstruction* instruction : computation->instructions()) {\n-        HloChannelInstruction* channel_instruction =\n-            DynCast<HloChannelInstruction>(instruction);\n-        if (channel_instruction &&\n-            channel_instruction->channel_id().has_value()) {\n-          next_unique_channel_id_ =\n-              std::max(next_unique_channel_id_,\n-                       channel_instruction->channel_id().value() + 1);\n-        }\n-      }\n-    }\n+    next_unique_channel_id_ = hlo_query::NextChannelId(*module);\n   }\n \n   // Because call graph nodes are visited in post-order (callees before callers)"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 3,
        "deletions": 15
    }
}