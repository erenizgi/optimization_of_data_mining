{
    "author": "olegshyshkov",
    "message": "[XLA:GPU] Pass `TmaDescriptor` by const reference in `CreateTensorMap`.\n\nPiperOrigin-RevId: 806352690",
    "sha": "afba553b72a87d417295a1983a9759c951e3479e",
    "files": [
        {
            "sha": "97fb21d953e9df66eeacc72c8b407994ff9b9adf",
            "filename": "third_party/xla/xla/backends/gpu/runtime/kernel_thunk.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fkernel_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fkernel_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fkernel_thunk.cc?ref=afba553b72a87d417295a1983a9759c951e3479e",
            "patch": "@@ -227,7 +227,7 @@ absl::Status KernelThunk::ExecuteOnStream(const ExecuteParams& params) {\n     if (auto it = tma_metadata_.arg_index_to_tma_info.find(idx);\n         it != tma_metadata_.arg_index_to_tma_info.end()) {\n       // TMA descriptor argument.\n-      stream_executor::gpu::TmaDescriptor tma_desc = it->second;\n+      const se::gpu::TmaDescriptor& tma_desc = it->second;\n       TF_ASSIGN_OR_RETURN(se::TensorMap tensor_map,\n                           executor->CreateTensorMap(tma_desc, buf.opaque()));\n       VLOG(3) << \"[\" << device_ordinal << \"]  Using TensorMap for arg #\" << idx"
        },
        {
            "sha": "8cfb208961c6cfea1fa9d1399884bbb537b069fd",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_executor.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.cc?ref=afba553b72a87d417295a1983a9759c951e3479e",
            "patch": "@@ -1512,8 +1512,8 @@ absl::StatusOr<const CudaKernel*> CudaExecutor::GetCudaKernel(\n   return static_cast<const CudaKernel*>(*it);\n }\n \n-absl::StatusOr<TensorMap> CudaExecutor::CreateTensorMap(TmaDescriptor tma_desc,\n-                                                        void* global_address) {\n+absl::StatusOr<TensorMap> CudaExecutor::CreateTensorMap(\n+    const TmaDescriptor& tma_desc, void* global_address) {\n   TF_ASSIGN_OR_RETURN(CUtensorMapDataType data_type,\n                       GetTensorMapDataType(tma_desc.element_size()));\n   CUtensorMapSwizzle swizzle = GetTensorMapSwizzle(tma_desc.swizzle());"
        },
        {
            "sha": "fb111717b6885203a424e0d4e9396bf7fcb30e65",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_executor.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_executor.h?ref=afba553b72a87d417295a1983a9759c951e3479e",
            "patch": "@@ -132,7 +132,7 @@ class CudaExecutor : public GpuExecutor {\n   // Creates, allocates, and copies a CUtensorMap object for the given TMA\n   // descriptor. Returns a TensorMap, which is 128 bytes of storage, to be\n   // passed by value to the kernel.\n-  absl::StatusOr<TensorMap> CreateTensorMap(TmaDescriptor tma_desc,\n+  absl::StatusOr<TensorMap> CreateTensorMap(const TmaDescriptor& tma_desc,\n                                             void* global_address) override;\n   absl::StatusOr<std::unique_ptr<MemoryAllocator>> CreateMemoryAllocator(\n       MemoryType type) override;"
        },
        {
            "sha": "ca5b25ed26f8e8c27280c40963ee30206512cef7",
            "filename": "third_party/xla/xla/stream_executor/stream_executor.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fstream_executor.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/afba553b72a87d417295a1983a9759c951e3479e/third_party%2Fxla%2Fxla%2Fstream_executor%2Fstream_executor.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fstream_executor.h?ref=afba553b72a87d417295a1983a9759c951e3479e",
            "patch": "@@ -341,8 +341,8 @@ class StreamExecutor {\n   // descriptor. Returns a TensorMap, which is 128 bytes of storage, to be\n   // passed by value to the kernel.\n   // Only implemented on CUDA GPUs.\n-  virtual absl::StatusOr<TensorMap> CreateTensorMap(gpu::TmaDescriptor tma_desc,\n-                                                    void* global_address) {\n+  virtual absl::StatusOr<TensorMap> CreateTensorMap(\n+      const gpu::TmaDescriptor& tma_desc, void* global_address) {\n     return absl::UnimplementedError(\"Not Implemented\");\n   }\n "
        }
    ],
    "stats": {
        "total": 12,
        "additions": 6,
        "deletions": 6
    }
}