{
    "author": "ecalubaquib",
    "message": "Add transforms for TFlite folder for converter migration and update pywrap\n\nPiperOrigin-RevId: 797886989",
    "sha": "a1f4a39074fcd15b578df72945d40f29c9163963",
    "files": [
        {
            "sha": "ad3ba6ceb9b8127c933e2d006308319f88a7ba4a",
            "filename": "tensorflow/compiler/mlir/lite/python/BUILD",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fpython%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fpython%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Flite%2Fpython%2FBUILD?ref=a1f4a39074fcd15b578df72945d40f29c9163963",
            "patch": "@@ -163,7 +163,16 @@ py_strict_library(\n         \":_pywrap_converter_api\",\n         \"//tensorflow/compiler/mlir/quantization/tensorflow/python:py_function_lib_py\",\n         \"//tensorflow/python:pywrap_tensorflow\",\n-    ],\n+    ] + if_pywrap(\n+        if_true = [] + select({\n+            \"//conditions:default\": [],\n+            # This reqirement is for LiteRT only as tensorflow/compiler/mlirt/lite is\n+            # duplicated in LiteRT/tflite/converter.\n+            \"//tensorflow:disable_tf_lite_py\": [\n+                \"//tensorflow/lite/python:pywrap_tflite\",\n+            ],\n+        }),\n+    ),\n )\n \n config_setting(\n@@ -186,7 +195,7 @@ cc_library(\n     hdrs = [\"converter_python_api.h\"],\n     features = [\"-parse_headers\"],\n     visibility = [\n-        \"//tensorflow/python:__subpackages__\",\n+        \"//visibility:public\",\n     ],\n     deps = [\n         \":flatbuffer_to_mlir\",\n@@ -240,9 +249,7 @@ tf_python_pybind_extension(\n     pytype_srcs = [\n         \"_pywrap_converter_api.pyi\",\n     ],\n-    visibility = [\n-        \"//tensorflow/python:__pkg__\",\n-    ],\n+    visibility = [\"//visibility:public\"],\n     deps = [\n         \"//tensorflow/compiler/mlir/quantization/tensorflow/python:py_function_lib\",\n         \"//tensorflow/python/lib/core:pybind11_lib\","
        },
        {
            "sha": "9a37d8ae832edf654af95153248acd9f5f148097",
            "filename": "tensorflow/lite/python/BUILD",
            "status": "modified",
            "additions": 23,
            "deletions": 3,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Flite%2Fpython%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Flite%2Fpython%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fpython%2FBUILD?ref=a1f4a39074fcd15b578df72945d40f29c9163963",
            "patch": "@@ -2,7 +2,7 @@ load(\"@flatbuffers//:build_defs.bzl\", \"flatbuffer_py_library\")\n load(\"@rules_shell//shell:sh_test.bzl\", \"sh_test\")\n load(\"//tensorflow:pytype.default.bzl\", \"pytype_strict_contrib_test\", \"pytype_strict_library\")\n load(\"//tensorflow:strict.default.bzl\", \"py_strict_binary\", \"py_strict_library\", \"py_strict_test\")\n-load(\"//tensorflow:tensorflow.default.bzl\", \"get_compatible_with_portable\", \"pywrap_binaries\", \"pywrap_library\")\n+load(\"//tensorflow:tensorflow.default.bzl\", \"get_compatible_with_portable\", \"pywrap_binaries\", \"pywrap_library\", \"tf_python_pybind_extension\")\n load(\"//tensorflow/core/platform:build_config_root.bzl\", \"if_pywrap\")\n load(\"//tensorflow/lite:special_rules.bzl\", \"internal_visibility_allowlist\")\n \n@@ -648,6 +648,16 @@ py_strict_test(\n     ],\n )\n \n+# TODO(ecalubaquib): Remove this once the bug b/435507187\n+tf_python_pybind_extension(\n+    name = \"_dummy_pybind\",\n+    srcs = [\"dummy_pybind.cc\"],\n+    visibility = [\"//visibility:private\"],\n+    deps = [\n+        \"@pybind11\",\n+    ],\n+)\n+\n # Use pywrap_library to avoid duplicate registration of pybind11 modules.\n # A great example on how to use pywrap_library is\n # https://github.com/vam-google/symbol-locations/blob/main/pybind/BUILD\n@@ -667,7 +677,17 @@ py_strict_library(\n         \"//tensorflow/lite/testing:_pywrap_string_util\",\n         \"//tensorflow/lite/tools/optimize/python:_pywrap_modify_model_interface\",\n         \"//tensorflow/lite/tools/optimize/sparsity:format_converter_wrapper_pybind11\",\n-    ],\n+    ] + select({\n+        # This is a dummy pybind module that is never used.\n+        # Its to allow using select with pywrap_library till b/435507187 is fixed.\n+        # Using this allows a constant number for pywrap_count in pywrap_library.\n+        \"//conditions:default\": [\":_dummy_pybind\"],\n+        # Only include the pywrap_converter_api when disable_tf_lite_py is set\n+        # which is only when building under LiteRT repo.\n+        \"//tensorflow:disable_tf_lite_py\": [\n+            \"//tensorflow/compiler/mlir/lite/python:_pywrap_converter_api\",\n+        ],\n+    }),\n )\n \n pywrap_library(\n@@ -682,7 +702,7 @@ pywrap_library(\n             \"//conditions:default\": \"pywrap_tflite_common.lds\",\n         }),\n     },\n-    pywrap_count = 8,\n+    pywrap_count = 9,\n     visibility = [\"//visibility:public\"],\n     deps = [\n         \":tflite_pywrap_deps\","
        },
        {
            "sha": "32ad503d6ea11efd849affefc59a96936a323313",
            "filename": "tensorflow/lite/python/dummy_pybind.cc",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Flite%2Fpython%2Fdummy_pybind.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1f4a39074fcd15b578df72945d40f29c9163963/tensorflow%2Flite%2Fpython%2Fdummy_pybind.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fpython%2Fdummy_pybind.cc?ref=a1f4a39074fcd15b578df72945d40f29c9163963",
            "patch": "@@ -0,0 +1,17 @@\n+/* Copyright 2025 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+#include <pybind11/pybind11.h>\n+\n+PYBIND11_MODULE(_dummy_pybind, m) { m.doc() = \"Dummy pybind module.\"; }"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 52,
        "deletions": 8
    }
}