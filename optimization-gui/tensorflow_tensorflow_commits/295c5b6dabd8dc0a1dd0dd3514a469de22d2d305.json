{
    "author": "majnemer",
    "message": "Remove `ProtoParseNumeric` and inline its logic into `SafeStringToNumeric`.\n\nThe `ProtoParseNumeric` helper functions are removed. The `SafeStringToNumeric` template now uses `if constexpr` to directly call the appropriate `absl::SimpleAto*` function based on the numeric type.\n\nPiperOrigin-RevId: 828260928",
    "sha": "295c5b6dabd8dc0a1dd0dd3514a469de22d2d305",
    "files": [
        {
            "sha": "0e7218085f4d3a4b3159beb7d9d42bf5e6285477",
            "filename": "tensorflow/core/platform/numbers.h",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/tensorflow%2Fcore%2Fplatform%2Fnumbers.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/tensorflow%2Fcore%2Fplatform%2Fnumbers.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2Fnumbers.h?ref=295c5b6dabd8dc0a1dd0dd3514a469de22d2d305",
            "patch": "@@ -25,20 +25,12 @@ limitations under the License.\n namespace tensorflow {\n namespace strings {\n // NOLINTBEGIN(misc-unused-using-decls)\n-using tsl::strings::DoubleToBuffer;\n-using tsl::strings::FastInt32ToBufferLeft;\n-using tsl::strings::FastInt64ToBufferLeft;\n-using tsl::strings::FastUInt32ToBufferLeft;\n-using tsl::strings::FastUInt64ToBufferLeft;\n-using tsl::strings::FloatToBuffer;\n using tsl::strings::FpToString;\n using tsl::strings::HexStringToUint64;\n using tsl::strings::HumanReadableElapsedTime;\n using tsl::strings::HumanReadableNum;\n using tsl::strings::HumanReadableNumBytes;\n-using tsl::strings::kFastToBufferSize;\n using tsl::strings::LegacyPrecision;\n-using tsl::strings::ProtoParseNumeric;\n using tsl::strings::safe_strto32;\n using tsl::strings::safe_strto64;\n using tsl::strings::safe_strtod;"
        },
        {
            "sha": "42b442b5c948f158c2dd4f2b8f8b92b8027fa226",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/numbers.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.cc?ref=295c5b6dabd8dc0a1dd0dd3514a469de22d2d305",
            "patch": "@@ -117,6 +117,7 @@ constexpr int NumDecimalDigits(int n) {\n \n template <typename T>\n size_t FpToBuffer(T value, char* buffer) {\n+  using strings_internal::kFastToBufferSize;\n   // Out of an abundance of caution, we ensure that the buffer is large enough\n   // to hold the worst-case formatting of any floating-point number.\n   constexpr size_t kMaxExponentDigits10 ="
        },
        {
            "sha": "43b4ac864141301fee2267c56036643cfb4fd9f9",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/numbers.h",
            "status": "modified",
            "additions": 10,
            "deletions": 67,
            "changes": 77,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers.h?ref=295c5b6dabd8dc0a1dd0dd3514a469de22d2d305",
            "patch": "@@ -20,6 +20,7 @@ limitations under the License.\n #include <cstddef>\n #include <cstdint>\n #include <string>\n+#include <type_traits>\n \n #include \"absl/base/macros.h\"\n #include \"absl/strings/numbers.h\"\n@@ -30,21 +31,7 @@ limitations under the License.\n namespace tsl {\n namespace strings {\n \n-// ----------------------------------------------------------------------\n-// FastIntToBufferLeft()\n-//    These are intended for speed.\n-//\n-//    All functions take the output buffer as an arg.  FastInt() uses\n-//    at most 22 bytes, FastTime() uses exactly 30 bytes.  They all\n-//    return a pointer to the beginning of the output, which is the same as\n-//    the beginning of the input buffer.\n-//\n-//    NOTE: In 64-bit land, sizeof(time_t) is 8, so it is possible\n-//    to pass to FastTimeToBuffer() a time whose year cannot be\n-//    represented in 4 digits. In this case, the output buffer\n-//    will contain the string \"Invalid:<value>\"\n-// ----------------------------------------------------------------------\n-\n+namespace strings_internal {\n // Previously documented minimums -- the buffers provided must be at least this\n // long, though these numbers are subject to change:\n //     Int32, UInt32:                   12 bytes\n@@ -53,33 +40,6 @@ namespace strings {\n // Use kFastToBufferSize rather than hardcoding constants.\n inline constexpr int kFastToBufferSize = 32;\n \n-// ----------------------------------------------------------------------\n-// FastInt32ToBufferLeft()\n-// FastUInt32ToBufferLeft()\n-// FastInt64ToBufferLeft()\n-// FastUInt64ToBufferLeft()\n-//\n-// These functions convert their numeric argument to an ASCII\n-// representation of the numeric value in base 10, with the\n-// representation being left-aligned in the buffer.  The caller is\n-// responsible for ensuring that the buffer has enough space to hold\n-// the output.  The buffer should typically be at least kFastToBufferSize\n-// bytes.\n-//\n-// Returns the number of characters written.\n-// ----------------------------------------------------------------------\n-\n-size_t FastInt32ToBufferLeft(int32_t i, char* buffer);  // at least 12 bytes\n-size_t FastUInt32ToBufferLeft(uint32_t i, char* buffer);  // at least 12 bytes\n-size_t FastInt64ToBufferLeft(int64_t i, char* buffer);  // at least 22 bytes\n-size_t FastUInt64ToBufferLeft(uint64_t i, char* buffer);  // at least 22 bytes\n-\n-// Required buffer size for DoubleToBuffer is kFastToBufferSize.\n-// Required buffer size for FloatToBuffer is kFastToBufferSize.\n-size_t DoubleToBuffer(double value, char* buffer);\n-size_t FloatToBuffer(float value, char* buffer);\n-\n-namespace strings_internal {\n // AlphaNumBuffer allows a way to pass a string to absl::StrCat without having\n // to do memory allocation. It is simply a pair of a fixed-size character\n // array, and a size.  Please don't use outside of the \"strings\" package.\n@@ -173,36 +133,19 @@ inline bool safe_strtod(absl::string_view str, double* value) {\n   return absl::SimpleAtod(str, value);\n }\n \n-inline bool ProtoParseNumeric(absl::string_view s, int32_t* value) {\n-  return absl::SimpleAtoi(s, value);\n-}\n-\n-inline bool ProtoParseNumeric(absl::string_view s, uint32_t* value) {\n-  return absl::SimpleAtoi(s, value);\n-}\n-\n-inline bool ProtoParseNumeric(absl::string_view s, int64_t* value) {\n-  return absl::SimpleAtoi(s, value);\n-}\n-\n-inline bool ProtoParseNumeric(absl::string_view s, uint64_t* value) {\n-  return absl::SimpleAtoi(s, value);\n-}\n-\n-inline bool ProtoParseNumeric(absl::string_view s, float* value) {\n-  return absl::SimpleAtof(s, value);\n-}\n-\n-inline bool ProtoParseNumeric(absl::string_view s, double* value) {\n-  return absl::SimpleAtod(s, value);\n-}\n-\n // Convert strings to number of type T.\n // Leading and trailing spaces are allowed.\n // Values may be rounded on over- and underflow.\n template <typename T>\n bool SafeStringToNumeric(absl::string_view s, T* value) {\n-  return ProtoParseNumeric(s, value);\n+  if constexpr (std::is_integral_v<T>) {\n+    return absl::SimpleAtoi(s, value);\n+  } else if constexpr (std::is_same_v<T, float>) {\n+    return absl::SimpleAtof(s, value);\n+  } else {\n+    static_assert(std::is_same_v<T, double>);\n+    return absl::SimpleAtod(s, value);\n+  }\n }\n \n // Converts from an int64 to a human readable string representing the"
        },
        {
            "sha": "12d09cf21ebf2918781c7890278b45381dad9159",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/numbers_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/295c5b6dabd8dc0a1dd0dd3514a469de22d2d305/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fnumbers_test.cc?ref=295c5b6dabd8dc0a1dd0dd3514a469de22d2d305",
            "patch": "@@ -27,6 +27,8 @@ limitations under the License.\n namespace tsl {\n namespace strings {\n \n+using strings_internal::kFastToBufferSize;\n+\n // NOTE: most of the routines in numbers.h are tested indirectly through\n // strcat_test.cc in this directory.\n "
        }
    ],
    "stats": {
        "total": 88,
        "additions": 13,
        "deletions": 75
    }
}