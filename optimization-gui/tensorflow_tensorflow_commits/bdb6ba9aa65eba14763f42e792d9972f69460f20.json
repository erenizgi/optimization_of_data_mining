{
    "author": "alekstheod",
    "message": "PR #32954: [ROCm] Introduce pool name for rbe\n\nImported from GitHub PR https://github.com/openxla/xla/pull/32954\n\nüìù Summary of Changes\nIntroduce pool name for rbe builds\n\nüéØ Justification\nNeed separate pool name for gpu tests execution.\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: ‚ú® New Feature\n\nüìä Benchmark (for Performance Improvements)\nRbe support for rocm config ci job\n\nüß™ Unit Tests:\nNot relevant\n\nüß™ Execution Tests:\nNot relevant\n\nCopybara import of the project:\n\n--\nd675bf9efcc44a8d740c1be7537737af3cd90f0b by Alexandros Theodoridis <alexandros.theodoridis@amd.com>:\n\nIntroduce pool name for rbe\n\n--\nd5ee82757aa74785bd2a1c68e3639c49d17ba740 by Alexandros Theodoridis <atheodor@amd.com>:\n\nIntroduce rocm rbe pools\n\n--\n36bfa7b258cb3e58430087faccccb413f9bf8a7c by Alexandros Theodoridis <atheodor@amd.com>:\n\nFirst check for multigpu tag\n\n--\n9efa0a7cdfa76bb0d5102ebbee1f9b6a3dab270c by Alexandros Theodoridis <atheodor@amd.com>:\n\nAddress review comments\n\n--\n5b854a7f5915d0c106fd2ba9bc6ff774a885f907 by Alexandros Theodoridis <atheodor@amd.com>:\n\nFix buildifier issue\n\nMerging this change closes #32954\n\nPiperOrigin-RevId: 823077515",
    "sha": "bdb6ba9aa65eba14763f42e792d9972f69460f20",
    "files": [
        {
            "sha": "6464787c427ac564726c3e9529a4194421c0a2b2",
            "filename": "third_party/xla/build_tools/rocm/platform/linux_x64/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb6ba9aa65eba14763f42e792d9972f69460f20/third_party%2Fxla%2Fbuild_tools%2Frocm%2Fplatform%2Flinux_x64%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb6ba9aa65eba14763f42e792d9972f69460f20/third_party%2Fxla%2Fbuild_tools%2Frocm%2Fplatform%2Flinux_x64%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Frocm%2Fplatform%2Flinux_x64%2FBUILD?ref=bdb6ba9aa65eba14763f42e792d9972f69460f20",
            "patch": "@@ -26,7 +26,6 @@ platform(\n         \"@bazel_tools//tools/cpp:clang\",\n     ],\n     exec_properties = {\n-        # SHA256 for rocm/tensorflow-build:latest-jammy-python3.10-rocm7.0.0\n         \"container-image\": \"docker://rocm/tensorflow-build@sha256:7cd444ac48657fee2f5087fbda7766266704d3f8fb2299f681952ae4eabed060\",\n         \"OSFamily\": \"Linux\",\n     },"
        },
        {
            "sha": "d6b786f0fe3a89fe39d2c225e1d2d988d1e94cd7",
            "filename": "third_party/xla/xla/tsl/platform/default/build_config_root.bzl",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb6ba9aa65eba14763f42e792d9972f69460f20/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config_root.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb6ba9aa65eba14763f42e792d9972f69460f20/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config_root.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config_root.bzl?ref=bdb6ba9aa65eba14763f42e792d9972f69460f20",
            "patch": "@@ -19,6 +19,14 @@ GPU_TEST_PROPERTIES = {\n     \"Pool\": \"gpu-pool\",\n }\n \n+ROCM_SINGLE_GPU_TEST_PROPERTIES = {\n+    \"Pool\": \"linux_x64_gpu\",\n+}\n+\n+ROCM_MULTI_GPU_TEST_PROPERTIES = {\n+    \"Pool\": \"linux_x64_multigpu\",\n+}\n+\n def tf_gpu_tests_tags():\n     \"\"\"Gets tags for TensorFlow GPU tests based on the configured environment.\n \n@@ -38,9 +46,23 @@ def tf_gpu_tests_tags():\n def tf_cuda_tests_tags():\n     return tf_gpu_tests_tags()\n \n+def tf_has_tag(kwargs, tag):\n+    return (\"tags\" in kwargs and kwargs[\"tags\"] != None and tag in kwargs[\"tags\"])\n+\n def tf_exec_properties(kwargs):\n-    if (\"tags\" in kwargs and kwargs[\"tags\"] != None and\n-        \"remote-gpu\" in kwargs[\"tags\"]):\n+    \"\"\"Gets execution_properties for TensorFlow GPU tests based on the provided tags.\n+\n+    Args:\n+      kwargs: all arguments of the xla test target\n+    Returns:\n+        execution_properties with the execution pool names for rbe.\n+    \"\"\"\n+    if is_rocm_configured():\n+        if tf_has_tag(kwargs, \"multi_gpu\"):\n+            return ROCM_MULTI_GPU_TEST_PROPERTIES\n+        if tf_has_tag(kwargs, \"gpu\"):\n+            return ROCM_SINGLE_GPU_TEST_PROPERTIES\n+    elif tf_has_tag(kwargs, \"remote-gpu\"):\n         return GPU_TEST_PROPERTIES\n     return {}\n "
        }
    ],
    "stats": {
        "total": 27,
        "additions": 24,
        "deletions": 3
    }
}