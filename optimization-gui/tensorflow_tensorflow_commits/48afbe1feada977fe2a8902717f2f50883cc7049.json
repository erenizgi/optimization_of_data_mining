{
    "author": "thomasjoerg",
    "message": "[XLA:GPU] Add more informative error messages to CHECKs in GpuPerformanceModel.\n\nPiperOrigin-RevId: 833239767",
    "sha": "48afbe1feada977fe2a8902717f2f50883cc7049",
    "files": [
        {
            "sha": "1672ba39783efaeaaf4c96b9202c492c4c6a7fd4",
            "filename": "third_party/xla/xla/service/gpu/model/gpu_performance_model.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/48afbe1feada977fe2a8902717f2f50883cc7049/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fgpu_performance_model.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/48afbe1feada977fe2a8902717f2f50883cc7049/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fgpu_performance_model.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fgpu_performance_model.cc?ref=48afbe1feada977fe2a8902717f2f50883cc7049",
            "patch": "@@ -227,7 +227,11 @@ GpuPerformanceModel::RunTimes GpuPerformanceModel::EstimateRunTimes(\n     const HloInstruction* producer, const GpuHloCostAnalysis* cost_analysis,\n     absl::Span<const HloInstruction* const> fused_consumers) {\n   auto cache_result = gpu_performance_model_cache_.Get(*producer);\n-  CHECK(cache_result.has_value());\n+  CHECK(cache_result.has_value())\n+      << \"Producer `\" << producer->name()\n+      << \"` not found in cache. This should never happen! HLO module name: \"\n+      << producer->GetModule()->name()\n+      << \" HLO Instruction: \" << producer->ToString();\n   EstimateRunTimeData producer_runtime = *cache_result;\n \n   absl::Duration time_unfused =\n@@ -240,7 +244,11 @@ GpuPerformanceModel::RunTimes GpuPerformanceModel::EstimateRunTimes(\n     VLOG(8) << \"Fused consumer: \" << fused_consumer->name();\n \n     auto cache_result = gpu_performance_model_cache_.Get(*fused_consumer);\n-    CHECK(cache_result.has_value());\n+    CHECK(cache_result.has_value())\n+        << \"Consumer `\" << fused_consumer->name()\n+        << \"` not found in cache. This should never happen! HLO module name: \"\n+        << fused_consumer->GetModule()->name()\n+        << \" HLO Instruction: \" << fused_consumer->ToString();\n     EstimateRunTimeData consumer_runtime = *cache_result;\n \n     time_unfused += consumer_runtime.exec_time;"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}