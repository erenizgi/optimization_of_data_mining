{
    "author": "tensorflower-gardener",
    "message": "Add a PJRT Extension API to expose a Host Allocator\n\n- A new PjRtClient::HostAllocator interface and a GetHostAllocator() method on PjRtClient.\n- A C API extension (PJRT_HostAllocator_Extension) to expose this functionality through the PJRT C API.\n- Simple C++ implementation of HostAllocator that uses the extension entry points\n- A PjrtCApiClient implementation of HostAllocator\n- Unit tests.\n- The PJRT C API version is bumped to reflect these changes.\n\nPiperOrigin-RevId: 814269137",
    "sha": "0d2540c5093ec0688450e052aeda64cc75e25bf0",
    "files": [
        {
            "sha": "2a2b1ca634de11010f427cc9d6fbbf27618e64c7",
            "filename": "third_party/xla/xla/pjrt/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -971,6 +971,8 @@ cc_library(\n         \"//xla/pjrt/distributed:key_value_store_interface\",\n         \"//xla/pjrt/extensions/cross_host_transfers:pjrt_c_api_cross_host_transfer_extension\",\n         \"//xla/pjrt/extensions/executable_metadata:executable_metadata_extension\",\n+        \"//xla/pjrt/extensions/host_allocator:host_allocator_extension\",\n+        \"//xla/pjrt/extensions/host_allocator:host_allocator_interface_impl\",\n         \"//xla/pjrt/proto:compile_options_proto_cc\",\n         \"//xla/pjrt/proto:topology_description_proto_cc\",\n         \"//xla/service:computation_placer_hdr\","
        },
        {
            "sha": "69635366025bc7b30052ea16b33facc78e9f940e",
            "filename": "third_party/xla/xla/pjrt/c/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -29,7 +29,6 @@ cc_library(\n     name = \"pjrt_c_api_hdrs\",\n     hdrs = [\"pjrt_c_api.h\"],\n     visibility = [\"//visibility:public\"],\n-    deps = [\"@com_google_absl//absl/status\"],\n )\n \n cc_library("
        },
        {
            "sha": "67db6b050a763df33bc0d8bac0b33c5cfe03672d",
            "filename": "third_party/xla/xla/pjrt/c/CHANGELOG.md",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FCHANGELOG.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FCHANGELOG.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FCHANGELOG.md?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -1,5 +1,9 @@\n # PJRT C API changelog\n \n+## 0.80\n+\n+* Added `PJRT_Extension_Type::PJRT_Extension_Type_HostAllocator`.\n+\n ## 0.79\n \n * Added `PJRT_LoadedExecutable_GetDeviceAssignment.`\n@@ -18,11 +22,11 @@\n \n ## 0.75\n \n-* Added `PJRT_TopologyDescription_Deserialize.`\n+* Added `PJRT_TopologyDescription_Deserialize`.\n \n ## 0.74\n \n-* Added `PJRT_Extension_Type::PJRT_Extension_Type_CrossHostTransfers.`\n+* Added `PJRT_Extension_Type::PJRT_Extension_Type_CrossHostTransfers`.\n \n ## 0.73\n "
        },
        {
            "sha": "c8334878913e53a1df92fab0e7eac3027f8fe5c5",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api.h?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -68,6 +68,7 @@ typedef enum {\n   PJRT_Extension_Type_CrossHostTransfers,\n   PJRT_Extension_Type_ExecutableMetadata,\n   PJRT_Extension_Type_Callback,\n+  PJRT_Extension_Type_HostAllocator,  // Experimental.\n } PJRT_Extension_Type;\n \n // PJRT_Extension_Base contains a type and a pointer to next\n@@ -102,7 +103,7 @@ PJRT_DEFINE_STRUCT_TRAITS(PJRT_Extension_Base, next);\n // Changes include:\n // * Adding a new field to the PJRT_Api or argument structs\n // * Renaming a method or argument (doesn't affect ABI)\n-#define PJRT_API_MINOR 79\n+#define PJRT_API_MINOR 80\n \n // The plugin should set the major_version and minor_version of\n // PJRT_Api.pjrt_api_version to be the `PJRT_API_MAJOR` and `PJRT_API_MINOR` in"
        },
        {
            "sha": "3eeb8e469af53ebd404a91e6836d672fbe2518f2",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/BUILD",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2FBUILD?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,37 @@\n+load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n+load(\"//xla/tsl/platform:rules_cc.bzl\", \"cc_library\")\n+\n+package(\n+    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n+    default_visibility = [\"//visibility:public\"],\n+)\n+\n+cc_library(\n+    name = \"host_allocator_extension\",\n+    srcs = [\"host_allocator_extension.cc\"],\n+    hdrs = [\"host_allocator_extension.h\"],\n+    deps = [\"//xla/pjrt/c:pjrt_c_api_hdrs\"],\n+)\n+\n+cc_library(\n+    name = \"host_allocator_interface_impl\",\n+    srcs = [\"host_allocator_interface_impl.cc\"],\n+    hdrs = [\"host_allocator_interface_impl.h\"],\n+    deps = [\n+        \":host_allocator_extension\",\n+        \"//xla/pjrt:pjrt_client\",\n+        \"//xla/pjrt/c:pjrt_c_api_hdrs\",\n+        \"@com_google_absl//absl/log:check\",\n+    ],\n+)\n+\n+xla_cc_test(\n+    name = \"host_allocator_interface_impl_test\",\n+    srcs = [\"host_allocator_interface_impl_test.cc\"],\n+    deps = [\n+        \":host_allocator_extension\",\n+        \":host_allocator_interface_impl\",\n+        \"//xla/pjrt/c:pjrt_c_api_hdrs\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)"
        },
        {
            "sha": "037f74eec675fc318f5573abc11be34a99fb98a0",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/host_allocator_extension.cc",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.cc?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,41 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_extension.h\"\n+\n+#include \"xla/pjrt/c/pjrt_c_api.h\"\n+\n+namespace pjrt {\n+\n+PJRT_HostAllocator_Extension CreateHostAllocatorExtension(\n+    PJRT_Extension_Base* next,\n+    PJRT_HostAllocator_GetPreferredAlignment get_preferred_alignment,\n+    PJRT_HostAllocator_Allocate allocate, PJRT_HostAllocator_Free free) {\n+  return PJRT_HostAllocator_Extension{\n+      PJRT_Extension_Base{\n+          /*struct_size=*/PJRT_HostAllocator_Extension_STRUCT_SIZE,\n+          /*type=*/PJRT_Extension_Type_HostAllocator,\n+          /*next=*/next,\n+      },\n+      /*get_preferred_alignment=*/\n+      get_preferred_alignment,\n+      /*allocate=*/\n+      allocate,\n+      /*free=*/\n+      free,\n+  };\n+}\n+\n+}  // namespace pjrt"
        },
        {
            "sha": "d3a2d5f7563d647adc13c8bde6dcccc42febd287",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/host_allocator_extension.h",
            "status": "added",
            "additions": 95,
            "deletions": 0,
            "changes": 95,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_extension.h?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,95 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_EXTENSION_H_\n+#define XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_EXTENSION_H_\n+\n+#include <cstddef>\n+\n+#include \"xla/pjrt/c/pjrt_c_api.h\"\n+\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+\n+#define PJRT_API_HOST_ALLOCATOR_EXTENSION_VERSION 0\n+// ---------------------------------- Methods ----------------------------------\n+\n+struct PJRT_HostAllocator_GetPreferredAlignment_Args {\n+  size_t struct_size;\n+  PJRT_Extension_Base* extension_start;\n+\n+  PJRT_Client* client;\n+  size_t preferred_alignment;  // out.\n+};\n+PJRT_DEFINE_STRUCT_TRAITS(PJRT_HostAllocator_GetPreferredAlignment_Args,\n+                          preferred_alignment);\n+\n+// Gets the alignment of the host allocator.\n+typedef PJRT_Error* (*PJRT_HostAllocator_GetPreferredAlignment)(\n+    PJRT_HostAllocator_GetPreferredAlignment_Args* args);\n+\n+struct PJRT_HostAllocator_Allocate_Args {\n+  size_t struct_size;\n+  PJRT_Extension_Base* extension_start;\n+\n+  PJRT_Client* client;\n+  size_t size;\n+  size_t alignment;\n+  void* ptr;  // out.\n+};\n+PJRT_DEFINE_STRUCT_TRAITS(PJRT_HostAllocator_Allocate_Args, ptr);\n+\n+// Allocate memory from the host allocator.\n+typedef PJRT_Error* (*PJRT_HostAllocator_Allocate)(\n+    PJRT_HostAllocator_Allocate_Args* args);\n+\n+struct PJRT_HostAllocator_Free_Args {\n+  size_t struct_size;\n+  PJRT_Extension_Base* extension_start;\n+\n+  PJRT_Client* client;\n+  void* ptr;\n+};\n+PJRT_DEFINE_STRUCT_TRAITS(PJRT_HostAllocator_Free_Args, ptr);\n+\n+// Free memory allocated by the host allocator.\n+typedef PJRT_Error* (*PJRT_HostAllocator_Free)(\n+    PJRT_HostAllocator_Free_Args* args);\n+\n+// --------------------------- Extension entrypoint ----------------------------\n+\n+typedef struct PJRT_HostAllocator_Extension {\n+  PJRT_Extension_Base base;\n+  PJRT_HostAllocator_GetPreferredAlignment get_preferred_alignment;\n+  PJRT_HostAllocator_Allocate allocate;\n+  PJRT_HostAllocator_Free free;\n+} PJRT_HostAllocator_Extension;\n+PJRT_DEFINE_STRUCT_TRAITS(PJRT_HostAllocator_Extension, free);\n+\n+#ifdef __cplusplus\n+}\n+#endif\n+\n+namespace pjrt {\n+\n+PJRT_HostAllocator_Extension CreateHostAllocatorExtension(\n+    PJRT_Extension_Base* next,\n+    PJRT_HostAllocator_GetPreferredAlignment get_preferred_alignment,\n+    PJRT_HostAllocator_Allocate allocate, PJRT_HostAllocator_Free free);\n+\n+}  // namespace pjrt\n+\n+#endif  // XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_EXTENSION_H_"
        },
        {
            "sha": "d058edc6ec43b588bd554775ba208dccfd4397fb",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.cc",
            "status": "added",
            "additions": 65,
            "deletions": 0,
            "changes": 65,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.cc?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,65 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.h\"\n+\n+#include <cstddef>\n+\n+#include \"absl/log/check.h\"\n+#include \"xla/pjrt/c/pjrt_c_api.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_extension.h\"\n+\n+namespace xla {\n+\n+HostAllocatorInterfaceImpl::HostAllocatorInterfaceImpl(\n+    PJRT_Client* client, PJRT_HostAllocator_Extension* extension)\n+    : client_(client), extension_(extension) {}\n+\n+size_t HostAllocatorInterfaceImpl::GetPreferredAlignment() const {\n+  PJRT_HostAllocator_GetPreferredAlignment_Args args = {\n+      /*struct_size=*/sizeof(args),\n+      /*extension_start=*/&extension_->base,\n+      /*client=*/client_,\n+  };\n+  PJRT_Error* error = extension_->get_preferred_alignment(&args);\n+  CHECK_EQ(error, nullptr) << \"Failed to get preferred alignment: \" << error;\n+  return args.preferred_alignment;\n+}\n+\n+void* HostAllocatorInterfaceImpl::Allocate(size_t size, size_t alignment) {\n+  PJRT_HostAllocator_Allocate_Args args = {\n+      /*struct_size=*/sizeof(args),\n+      /*extension_start=*/&extension_->base,\n+      /*client*/ client_,\n+      /*size =*/size,\n+      /*alignment =*/alignment,\n+  };\n+  PJRT_Error* error = extension_->allocate(&args);\n+  CHECK_EQ(error, nullptr) << \"Failed to allocate memory: \" << error;\n+  return args.ptr;\n+}\n+\n+void HostAllocatorInterfaceImpl::Free(void* ptr) {\n+  PJRT_HostAllocator_Free_Args args = {\n+      /*struct_size=*/sizeof(args),\n+      /*extension_start=*/&extension_->base,\n+      /*client=*/client_,\n+      /*ptr=*/ptr,\n+  };\n+  PJRT_Error* error = extension_->free(&args);\n+  CHECK_EQ(error, nullptr) << \"Failed to free memory: \" << error;\n+}\n+\n+}  // namespace xla"
        },
        {
            "sha": "61208d8f330356aa6b22a5ec875ef649d8ccd7a6",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.h",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl.h?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,53 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_INTERFACE_IMPL_H_\n+#define XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_INTERFACE_IMPL_H_\n+\n+#include <cstddef>\n+\n+#include \"xla/pjrt/c/pjrt_c_api.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_extension.h\"\n+#include \"xla/pjrt/pjrt_client.h\"\n+\n+namespace xla {\n+\n+// An implementation of the PjRtClient::HostAllocator interface that uses the\n+// C Client API and HostAllocator extension.\n+class HostAllocatorInterfaceImpl : public PjRtClient::HostAllocator {\n+ public:\n+  // Constructs a HostAllocatorInterfaceImpl.\n+  //\n+  // NOTE: client and extension must outlive this object.\n+  HostAllocatorInterfaceImpl(PJRT_Client* client,\n+                             PJRT_HostAllocator_Extension* extension);\n+\n+  // Returns the preferred alignment for allocations.\n+  size_t GetPreferredAlignment() const override;\n+\n+  // Allocates `size` bytes of memory.\n+  void* Allocate(size_t size, size_t alignment) override;\n+\n+  // Frees `ptr` allocated by this allocator.\n+  void Free(void* ptr) override;\n+\n+ private:\n+  PJRT_Client* const client_;\n+  PJRT_HostAllocator_Extension* const extension_;\n+};\n+\n+}  // namespace xla\n+\n+#endif  // XLA_PJRT_EXTENSIONS_HOST_ALLOCATOR_HOST_ALLOCATOR_INTERFACE_IMPL_H_"
        },
        {
            "sha": "0ad4b7659d74f6b440ad81b9ae2c39bc1ceeae29",
            "filename": "third_party/xla/xla/pjrt/extensions/host_allocator/host_allocator_interface_impl_test.cc",
            "status": "added",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fhost_allocator%2Fhost_allocator_interface_impl_test.cc?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -0,0 +1,93 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.h\"\n+\n+#include <gtest/gtest.h>\n+#include \"xla/pjrt/c/pjrt_c_api.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_extension.h\"\n+\n+namespace xla {\n+namespace {\n+\n+// Returns a dummy client for testing.\n+PJRT_Client* ClientForTest() {\n+  PJRT_Client* client = reinterpret_cast<PJRT_Client*>(0xcafebabe);\n+  return client;\n+}\n+\n+TEST(HostAllocatorInterfaceImplTest, GetPreferredAlignment) {\n+  PJRT_HostAllocator_Extension extension = {\n+      /*base=*/{0},\n+      /*get_preferred_alignment=*/\n+      +[](PJRT_HostAllocator_GetPreferredAlignment_Args* args) -> PJRT_Error* {\n+        EXPECT_EQ(args->client, ClientForTest());\n+        args->preferred_alignment = 64;\n+        return nullptr;\n+      },\n+      /*allocate=*/nullptr,\n+      /*free=*/nullptr,\n+  };\n+  HostAllocatorInterfaceImpl host_allocator_interface_impl(ClientForTest(),\n+                                                           &extension);\n+  EXPECT_EQ(host_allocator_interface_impl.GetPreferredAlignment(), 64);\n+}\n+\n+TEST(HostAllocatorInterfaceImplTest, Allocate) {\n+  PJRT_HostAllocator_Extension extension = {\n+      /*base=*/{0},\n+      /*get_preferred_alignment=*/nullptr,\n+      /*allocate=*/\n+      +[](PJRT_HostAllocator_Allocate_Args* args) -> PJRT_Error* {\n+        EXPECT_EQ(args->client, ClientForTest());\n+        EXPECT_EQ(args->size, 1024);\n+        EXPECT_EQ(args->alignment, 64);\n+        args->ptr = reinterpret_cast<void*>(0xdeadbeef);\n+        return nullptr;\n+      },\n+      /*free=*/nullptr,\n+  };\n+  HostAllocatorInterfaceImpl host_allocator_interface_impl(ClientForTest(),\n+                                                           &extension);\n+  EXPECT_EQ(host_allocator_interface_impl.Allocate(1024, 64),\n+            reinterpret_cast<void*>(0xdeadbeef));\n+}\n+\n+TEST(HostAllocatorInterfaceImplTest, Free) {\n+  PJRT_HostAllocator_Extension extension = {\n+      /*base=*/{0},\n+      /*get_preferred_alignment=*/nullptr,\n+      /*allocate=*/\n+      +[](PJRT_HostAllocator_Allocate_Args* args) -> PJRT_Error* {\n+        EXPECT_EQ(args->client, ClientForTest());\n+        EXPECT_EQ(args->size, 1024);\n+        EXPECT_EQ(args->alignment, 64);\n+        args->ptr = reinterpret_cast<void*>(0xdeadbeef);\n+        return nullptr;\n+      },\n+      /*free=*/\n+      +[](PJRT_HostAllocator_Free_Args* args) -> PJRT_Error* {\n+        EXPECT_EQ(args->client, ClientForTest());\n+        EXPECT_EQ(args->ptr, reinterpret_cast<void*>(0xdeadbeef));\n+        return nullptr;\n+      },\n+  };\n+  HostAllocatorInterfaceImpl host_allocator_interface_impl(ClientForTest(),\n+                                                           &extension);\n+  host_allocator_interface_impl.Free(reinterpret_cast<void*>(0xdeadbeef));\n+}\n+\n+}  // namespace\n+}  // namespace xla"
        },
        {
            "sha": "97531ec449c606d4976feb2aef53950259055727",
            "filename": "third_party/xla/xla/pjrt/pjrt_c_api_client.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -61,6 +61,8 @@ limitations under the License.\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n #include \"xla/pjrt/extensions/cross_host_transfers/pjrt_c_api_cross_host_transfers_extension.h\"\n #include \"xla/pjrt/extensions/executable_metadata/executable_metadata_extension.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_extension.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.h\"\n #include \"xla/pjrt/mlir_to_hlo.h\"\n #include \"xla/pjrt/pjrt_api.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n@@ -123,6 +125,17 @@ InitExtensions(const PJRT_Api* c_api) {\n   return extensions;\n }\n \n+static absl::StatusOr<std::unique_ptr<PjRtClient::HostAllocator>>\n+InitHostAllocator(const PJRT_Api* c_api, PJRT_Client* c_client) {\n+  PJRT_HostAllocator_Extension* extension =\n+      pjrt::FindExtension<PJRT_HostAllocator_Extension>(\n+          c_api, PJRT_Extension_Type::PJRT_Extension_Type_HostAllocator);\n+  if (extension == nullptr) {\n+    return absl::UnimplementedError(\"HostAllocator extension not found\");\n+  }\n+  return std::make_unique<HostAllocatorInterfaceImpl>(c_client, extension);\n+}\n+\n PjRtCApiClient::PjRtCApiClient(\n     const PJRT_Api* c_api, PJRT_Client* c_client,\n     std::unique_ptr<pjrt::PJRT_KeyValueCallbackData> kv_callback_data)\n@@ -132,6 +145,7 @@ PjRtCApiClient::PjRtCApiClient(\n       kv_callback_data_(std::move(kv_callback_data)),\n       topo_desc_(InitClientTopoDesc(c_api, c_client)),\n       extensions_(InitExtensions(c_api)),\n+      host_allocator_(InitHostAllocator(c_api, c_client)),\n       // Example platform version string:\n       //   PJRT C API\n       //   TFRT TPU v2\n@@ -680,6 +694,14 @@ PjRtCApiClient::GetTopologyDescription() const {\n   return &(*topo_desc_);\n }\n \n+absl::StatusOr<PjRtClient::HostAllocator*> PjRtCApiClient::GetHostAllocator()\n+    const {\n+  if (!host_allocator_.ok()) {\n+    return host_allocator_.status();\n+  }\n+  return host_allocator_->get();\n+}\n+\n absl::StatusOr<std::uintptr_t> PjRtCApiClient::UnsafeBufferPointer(\n     PjRtBuffer* buffer) {\n   // Validate that the buffer's client matches the function call's client, since"
        },
        {
            "sha": "e8312f8df04adb283124c6585f2684618303af0d",
            "filename": "third_party/xla/xla/pjrt/pjrt_c_api_client.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -45,6 +45,7 @@ limitations under the License.\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_helpers.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n+#include \"xla/pjrt/extensions/host_allocator/host_allocator_interface_impl.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n@@ -340,6 +341,8 @@ class PjRtCApiClient : public PjRtClient {\n   absl::StatusOr<const PjRtTopologyDescription*> GetTopologyDescription()\n       const override;\n \n+  absl::StatusOr<HostAllocator*> GetHostAllocator() const override;\n+\n   absl::StatusOr<std::unique_ptr<AsyncHostToDeviceTransferManager>>\n   CreateBuffersForAsyncHostToDevice(\n       absl::Span<const ShapeSpec> shape_specs,\n@@ -436,6 +439,8 @@ class PjRtCApiClient : public PjRtClient {\n   // from GetTopologyDescription().\n   absl::StatusOr<const PjRtCApiTopologyDescription> topo_desc_;\n   absl::flat_hash_map<PJRT_Extension_Type, PJRT_Extension_Base*> extensions_;\n+  // Not all PJRT C API implementations support the host allocator extension.\n+  absl::StatusOr<std::unique_ptr<PjRtClient::HostAllocator>> host_allocator_;\n \n   const std::string platform_version_;\n   const std::string platform_name_;"
        },
        {
            "sha": "cc6b342f0730fff4ef82a8e792225e15a48d9578",
            "filename": "third_party/xla/xla/pjrt/pjrt_client.h",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0d2540c5093ec0688450e052aeda64cc75e25bf0/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h?ref=0d2540c5093ec0688450e052aeda64cc75e25bf0",
            "patch": "@@ -702,6 +702,35 @@ class PjRtClient {\n                         platform_name()));\n   }\n \n+  // An allocator for host-side memory.\n+  //\n+  // This is used to allocate memory that lives on the host that may have\n+  // performance benefits when used for certain operations (e.g. premapped\n+  // memory when transferring data to a device via DMA).\n+  //\n+  // This interface is just for host memory, it has nothing to with device\n+  // memory allocation.\n+  //\n+  // Implementations must be thread-safe.\n+  class HostAllocator {\n+   public:\n+    virtual ~HostAllocator() = default;\n+\n+    // Returns the preferred alignment for allocations.\n+    virtual size_t GetPreferredAlignment() const = 0;\n+\n+    // Allocates `size` bytes of memory.\n+    virtual void* Allocate(size_t size, size_t alignment) = 0;\n+\n+    // Frees `ptr` allocated by this allocator.\n+    virtual void Free(void* ptr) = 0;\n+  };\n+\n+  // Returns the host allocator for the client if supported.\n+  virtual absl::StatusOr<HostAllocator*> GetHostAllocator() const {\n+    return absl::UnimplementedError(\"GetHostAllocator is not supported.\");\n+  }\n+\n   // A client may want to create a buffer, and hand the buffer to other PjRt\n   // methods, before the data to store in the buffer is available to the client.\n   // This is supported using CreateBuffersForAsyncHostToDevice, which returns an"
        }
    ],
    "stats": {
        "total": 454,
        "additions": 450,
        "deletions": 4
    }
}