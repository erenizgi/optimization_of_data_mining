{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@917d1f20aecf\n\nUpdates LLVM usage to match\n[917d1f20aecf](https://github.com/llvm/llvm-project/commit/917d1f20aecf)\n\nPiperOrigin-RevId: 823542980",
    "sha": "42d764666d75be5fb6da4cd4f53e3c4e3740165c",
    "files": [
        {
            "sha": "f8fc3c39524a31843a3e1bc7c47848966085d72d",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 13,
            "deletions": 32,
            "changes": 45,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -1,34 +1,15 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n-diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n---- a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n-+++ b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n-@@ -0,0 +1,20 @@\n-+// REQUIRES: asserts\n-+// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n-+\n-+spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n-+    spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {\n-+        %uchar_0 = spirv.Constant 0 : i8\n-+        %ushort_1 = spirv.Constant 1 : i16\n-+        %uint_0 = spirv.Constant 0 : i32\n-+        spirv.FunctionCall @outside.func.with.linkage(%uchar_0):(i8) -> ()\n-+        spirv.Return\n-+    }\n-+    // CHECK: linkage_attributes = #spirv.linkage_attributes<linkage_name = \"outside.func\", linkage_type = <Import>>\n-+    spirv.func @outside.func.with.linkage(%arg0 : i8) -> () \"Pure\" attributes {\n-+      linkage_attributes=#spirv.linkage_attributes<\n-+        linkage_name=\"outside.func\",\n-+        linkage_type=<Import>\n-+      >\n-+    }\n-+    spirv.func @inside.func() -> () \"Pure\" attributes {} {spirv.Return}\n-+}\n-diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations.mlir b/mlir/test/Target/SPIRV/function-decorations.mlir\n---- a/mlir/test/Target/SPIRV/function-decorations.mlir\n-+++ b/mlir/test/Target/SPIRV/function-decorations.mlir\n-@@ -1,5 +1,4 @@\n- // RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file %s | FileCheck %s\n--// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n+diff -ruN --strip-trailing-cr a/mlir/lib/Dialect/OpenMP/Transforms/OpenMPOffloadPrivatizationPrepare.cpp b/mlir/lib/Dialect/OpenMP/Transforms/OpenMPOffloadPrivatizationPrepare.cpp\n+--- a/mlir/lib/Dialect/OpenMP/Transforms/OpenMPOffloadPrivatizationPrepare.cpp\n++++ b/mlir/lib/Dialect/OpenMP/Transforms/OpenMPOffloadPrivatizationPrepare.cpp\n+@@ -189,7 +189,9 @@\n  \n- spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n-     spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {\n+         DominanceInfo dom;\n+         llvm::sort(chainOfOps, [&](Operation *l, Operation *r) {\n+-          return dom.dominates(l, r);\n++          if (l == r)\n++            return false;\n++          return dom.properlyDominates(l, r);\n+         });\n+ \n+         rewriter.setInsertionPoint(chainOfOps.front());"
        },
        {
            "sha": "9aba685255635086a760338065dafd4a3faa21dc",
            "filename": "third_party/xla/third_party/llvm/toolchains.patch",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Ftoolchains.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Ftoolchains.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Ftoolchains.patch?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -55,4 +55,4 @@ index 2e3bff53ead9..8d01617effdc 100644\n +    \"//llvm:macos_x86_64_default\": native_arch_defines(\"X86\", \"x86_64-unknown-darwin\"),\n      \"@bazel_tools//src/conditions:linux_aarch64\": native_arch_defines(\"AArch64\", \"aarch64-unknown-linux-gnu\"),\n      \"@bazel_tools//src/conditions:linux_ppc64le\": native_arch_defines(\"PowerPC\", \"powerpc64le-unknown-linux-gnu\"),\n-     \"@bazel_tools//src/conditions:linux_s390x\": native_arch_defines(\"SystemZ\", \"systemz-unknown-linux_gnu\"),\n+     \"@bazel_tools//src/conditions:linux_riscv64\": native_arch_defines(\"RISCV\", \"riscv64-unknown-linux-gnu\"),"
        },
        {
            "sha": "974f27d1567b314fbf97727ef0d7c5c6815a0379",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"32de3b9ef9e7e8debc14416e968456ca13b48bea\"\n-    LLVM_SHA256 = \"e048b05e1fb9366e224ea3c06f8473714114039bfad00e81db4ecb6409f23efa\"\n+    LLVM_COMMIT = \"917d1f20aecfdbdc9e5a7a0eaf947ff7be6fbe15\"\n+    LLVM_SHA256 = \"8d3d2fe0dfa882a4c4e1c790e2100bc9506b617f50ab30b0c7e303792d9d522f\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "013def573f9cb1b6a44cfb3a195d4954a68dd3d3",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 2224,
            "deletions": 95,
            "changes": 2319,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c"
        },
        {
            "sha": "cfe987d9fb92c61b813f5302b52098c41c0f9f84",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"7fed8c5400d6ffd7e46e9ae318b7f55a5f67b91a\"\n-    SHARDY_SHA256 = \"eb1ce21c6302403d4d215c6f5be24a8790475c861e7303ead2728ab66edeef6d\"\n+    SHARDY_COMMIT = \"7f12ee2785c049ab8e5d2eafe578c70b0944c004\"\n+    SHARDY_SHA256 = \"01740c505add441d4156c2a92c0d819605784fa1753c5f63de12c6bffc074532\"\n \n     tf_http_archive(\n         name = \"shardy\","
        },
        {
            "sha": "8e421c8fc9a06fde60ff5345248e1d20a66030ee",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl823109577.patch",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl823109577.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl823109577.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl823109577.patch?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -0,0 +1,11 @@\n+\n+--- a/python/src/llvm.cc\t2025-08-22 04:02:56.000000000 -0700\n++++ b/python/src/llvm.cc\t2025-10-23 11:14:07.000000000 -0700\n+@@ -53,7 +53,6 @@\n+   bool disableLLVMOpt = mlir::triton::tools::getBoolEnv(\"DISABLE_LLVM_OPT\");\n+   if (enable_fp_fusion)\n+     opt.AllowFPOpFusion = llvm::FPOpFusion::Fast;\n+-  opt.UnsafeFPMath = false;\n+   opt.NoInfsFPMath = false;\n+   opt.NoNaNsFPMath = true;\n+   opt.TrapUnreachable = true;"
        },
        {
            "sha": "3ed40cefadf656150ced022a61413e58a8334aed",
            "filename": "third_party/xla/third_party/triton/llvm_integration/series.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -8,5 +8,6 @@ LLVM nor MLIR integrator, please do not add any patches to this list.\n \"\"\"\n \n llvm_patch_list = [\n+    \"//third_party/triton:llvm_integration/cl823109577.patch\",\n     # Add new patches just above this line\n ]"
        },
        {
            "sha": "5b4b8a69395d458cfe788119363a2beb5e294256",
            "filename": "third_party/xla/xla/pjrt/triton_cuda.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fxla%2Fpjrt%2Ftriton_cuda.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42d764666d75be5fb6da4cd4f53e3c4e3740165c/third_party%2Fxla%2Fxla%2Fpjrt%2Ftriton_cuda.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Ftriton_cuda.cc?ref=42d764666d75be5fb6da4cd4f53e3c4e3740165c",
            "patch": "@@ -93,7 +93,6 @@ absl::StatusOr<std::unique_ptr<llvm::TargetMachine>> CreateTargetMachine(\n   if (enable_fp_fusion) {\n     opt.AllowFPOpFusion = llvm::FPOpFusion::Fast;\n   }\n-  opt.UnsafeFPMath = false;\n   opt.NoInfsFPMath = false;\n   opt.NoNaNsFPMath = true;\n   opt.TrapUnreachable = true;"
        }
    ],
    "stats": {
        "total": 2387,
        "additions": 2254,
        "deletions": 133
    }
}