{
    "author": "olegshyshkov",
    "message": "[XLA:GPU] Use `ExtractInstructionIntoNewModule` to report bad fusion.\n\n`ExtractModule` (without height parameters provided) will extract the fusion and all it's predecessors in the computation.\n\n`ExtractInstructionIntoNewModule` will create an new module with entry computation where root is the fusion we're extracting without other instructions.\n\nPiperOrigin-RevId: 840174789",
    "sha": "9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68",
    "files": [
        {
            "sha": "105fa04e063009c02ee72bbda6422e7ee0c60e65",
            "filename": "third_party/xla/xla/service/gpu/transforms/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD?ref=9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68",
            "patch": "@@ -1939,7 +1939,7 @@ cc_library(\n         \"//xla/service/gpu/model:block_level_parameters\",\n         \"//xla/service/gpu/model:triton_emitter_constraints\",\n         \"//xla/stream_executor:device_description\",\n-        \"//xla/tools:hlo_extractor\",\n+        \"//xla/tools:hlo_decomposer_lib\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/algorithm:container\",\n@@ -1953,6 +1953,7 @@ cc_library(\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n         \"@llvm-project//llvm:Support\",\n+        \"@llvm-project//mlir:IR\",\n     ],\n )\n "
        },
        {
            "sha": "0a8633fd5e7b4dcd70466346857a5abed75ee19a",
            "filename": "third_party/xla/xla/service/gpu/transforms/nest_gemm_fusion.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc?ref=9b6c582ff0cd3b7d75a9f0fa3ec8ac8262881e68",
            "patch": "@@ -38,12 +38,12 @@ limitations under the License.\n #include \"llvm/ADT/SetVector.h\"\n #include \"llvm/ADT/SmallVector.h\"\n #include \"llvm/ADT/iterator_range.h\"\n+#include \"mlir/IR/MLIRContext.h\"\n #include \"xla/backends/gpu/codegen/triton/support.h\"\n #include \"xla/codegen/tiling/symbolic_tile.h\"\n #include \"xla/codegen/tiling/symbolic_tile_analysis.h\"\n #include \"xla/codegen/tiling/symbolic_tiled_hlo_instruction.h\"\n #include \"xla/codegen/tiling/tiling_specification.h\"\n-#include \"xla/hlo/analysis/symbolic_expr.h\"\n #include \"xla/hlo/ir/dfs_hlo_visitor_with_default.h\"\n #include \"xla/hlo/ir/hlo_casting_utils.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n@@ -65,7 +65,7 @@ limitations under the License.\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/stream_executor/device_description.h\"\n-#include \"xla/tools/hlo_extractor.h\"\n+#include \"xla/tools/hlo_decomposer.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/util.h\"\n@@ -1244,7 +1244,7 @@ absl::StatusOr<BlockLevelParameters> FindBlockLevelParameters(\n           TritonEmitterConstraints::GetBuilder(device_description));\n   if (std::holds_alternative<FusionDecision>(analysis_or)) {\n     std::unique_ptr<HloModule> extracted_computation_module =\n-        ExtractModule(computation->FusionInstruction());\n+        ExtractInstructionIntoNewModule(*computation->FusionInstruction());\n     return absl::InternalError(\n         absl::StrCat(\"Failed to analyze the computation (\",\n                      std::get<FusionDecision>(analysis_or).Explain(),"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 5,
        "deletions": 4
    }
}