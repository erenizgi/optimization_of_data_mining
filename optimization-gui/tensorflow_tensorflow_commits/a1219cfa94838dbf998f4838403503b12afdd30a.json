{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@d7e40f3e7165\n\nUpdates LLVM usage to match\n[d7e40f3e7165](https://github.com/llvm/llvm-project/commit/d7e40f3e7165)\n\nPiperOrigin-RevId: 824622381",
    "sha": "a1219cfa94838dbf998f4838403503b12afdd30a",
    "files": [
        {
            "sha": "509398da979e83350e3eb05534a4a72c6e1f3b19",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=a1219cfa94838dbf998f4838403503b12afdd30a",
            "patch": "@@ -1,53 +1 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n-diff -ruN --strip-trailing-cr a/llvm/include/llvm/ExecutionEngine/Orc/Core.h b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n---- a/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n-+++ b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n-@@ -1768,7 +1768,7 @@\n-   // FIXME: We should be able to derive FailedSymsForQuery from each query once\n-   //        we fix how the detach operation works.\n-   struct EmitQueries {\n--    JITDylib::AsynchronousSymbolQuerySet Updated;\n-+    JITDylib::AsynchronousSymbolQuerySet Completed;\n-     JITDylib::AsynchronousSymbolQuerySet Failed;\n-     DenseMap<AsynchronousSymbolQuery *, std::shared_ptr<SymbolDependenceMap>>\n-         FailedSymsForQuery;\n-diff -ruN --strip-trailing-cr a/llvm/lib/ExecutionEngine/Orc/Core.cpp b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n---- a/llvm/lib/ExecutionEngine/Orc/Core.cpp\n-+++ b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n-@@ -2901,13 +2901,23 @@\n- \n-   for (auto &SN : ER.Ready)\n-     IL_collectQueries(\n--        EQ.Updated, SN->defs(),\n-+        EQ.Completed, SN->defs(),\n-         [](JITDylib::SymbolTableEntry &E) { E.setState(SymbolState::Ready); },\n-         [](AsynchronousSymbolQuery &Q, JITDylib &JD,\n-            NonOwningSymbolStringPtr Name, JITDylib::SymbolTableEntry &E) {\n-           Q.notifySymbolMetRequiredState(SymbolStringPtr(Name), E.getSymbol());\n-         });\n- \n-+  // std::erase_if is not available in C++17, and llvm::erase_if does not work\n-+  // here.\n-+  for (auto it = EQ.Completed.begin(), end = EQ.Completed.end(); it != end;) {\n-+    if ((*it)->isComplete()) {\n-+      ++it;\n-+    } else {\n-+      it = EQ.Completed.erase(it);\n-+    }\n-+  }\n-+\n- #ifdef EXPENSIVE_CHECKS\n-   verifySessionState(\"exiting ExecutionSession::IL_emit\");\n- #endif\n-@@ -3043,9 +3053,8 @@\n-     }\n-   }\n- \n--  for (auto &UQ : EmitQueries->Updated)\n--    if (UQ->isComplete())\n--      UQ->handleComplete(*this);\n-+  for (auto &UQ : EmitQueries->Completed)\n-+    UQ->handleComplete(*this);\n- \n-   // If there are any bad dependencies then return an error.\n-   if (!BadDeps.empty()) {"
        },
        {
            "sha": "429d012413b6faa42188bacee15fd5306500558b",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=a1219cfa94838dbf998f4838403503b12afdd30a",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"621ed04e28787ade92b98e296332ac71d1b81678\"\n-    LLVM_SHA256 = \"60729061c07f0e834acb1a18607d2552dc08596e651125a7aea9c37a4b390058\"\n+    LLVM_COMMIT = \"d7e40f3e71654658e249ee481e28aeae0e0410b1\"\n+    LLVM_SHA256 = \"86d7df5660d6e72bd05a486474ba3e811fcc703840ef8efe13529791565d851d\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "97b317799e7512f547dceb12c2792c5c3fa7373e",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 59,
            "deletions": 59,
            "changes": 118,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=a1219cfa94838dbf998f4838403503b12afdd30a",
            "patch": "@@ -1,73 +1,73 @@\n diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch\n-index 509398d..6f93f59 100644\n+index 6f93f59..509398d 100644\n --- a/third_party/llvm/generated.patch\n +++ b/third_party/llvm/generated.patch\n-@@ -1 +1,53 @@\n+@@ -1,53 +1 @@\n  Auto generated patch. Do not edit or delete it, even if empty.\n-+diff -ruN --strip-trailing-cr a/llvm/include/llvm/ExecutionEngine/Orc/Core.h b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n-+--- a/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n-++++ b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n-+@@ -1768,7 +1768,7 @@\n-+   // FIXME: We should be able to derive FailedSymsForQuery from each query once\n-+   //        we fix how the detach operation works.\n-+   struct EmitQueries {\n-+-    JITDylib::AsynchronousSymbolQuerySet Updated;\n-++    JITDylib::AsynchronousSymbolQuerySet Completed;\n-+     JITDylib::AsynchronousSymbolQuerySet Failed;\n-+     DenseMap<AsynchronousSymbolQuery *, std::shared_ptr<SymbolDependenceMap>>\n-+         FailedSymsForQuery;\n-+diff -ruN --strip-trailing-cr a/llvm/lib/ExecutionEngine/Orc/Core.cpp b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n-+--- a/llvm/lib/ExecutionEngine/Orc/Core.cpp\n-++++ b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n-+@@ -2901,13 +2901,23 @@\n-+ \n-+   for (auto &SN : ER.Ready)\n-+     IL_collectQueries(\n-+-        EQ.Updated, SN->defs(),\n-++        EQ.Completed, SN->defs(),\n-+         [](JITDylib::SymbolTableEntry &E) { E.setState(SymbolState::Ready); },\n-+         [](AsynchronousSymbolQuery &Q, JITDylib &JD,\n-+            NonOwningSymbolStringPtr Name, JITDylib::SymbolTableEntry &E) {\n-+           Q.notifySymbolMetRequiredState(SymbolStringPtr(Name), E.getSymbol());\n-+         });\n-+ \n-++  // std::erase_if is not available in C++17, and llvm::erase_if does not work\n-++  // here.\n-++  for (auto it = EQ.Completed.begin(), end = EQ.Completed.end(); it != end;) {\n-++    if ((*it)->isComplete()) {\n-++      ++it;\n-++    } else {\n-++      it = EQ.Completed.erase(it);\n-++    }\n-++  }\n-++\n-+ #ifdef EXPENSIVE_CHECKS\n-+   verifySessionState(\"exiting ExecutionSession::IL_emit\");\n-+ #endif\n-+@@ -3043,9 +3053,8 @@\n-+     }\n-+   }\n-+ \n-+-  for (auto &UQ : EmitQueries->Updated)\n-+-    if (UQ->isComplete())\n-+-      UQ->handleComplete(*this);\n-++  for (auto &UQ : EmitQueries->Completed)\n-++    UQ->handleComplete(*this);\n-+ \n-+   // If there are any bad dependencies then return an error.\n-+   if (!BadDeps.empty()) {\n+-diff -ruN --strip-trailing-cr a/llvm/include/llvm/ExecutionEngine/Orc/Core.h b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n+---- a/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n+-+++ b/llvm/include/llvm/ExecutionEngine/Orc/Core.h\n+-@@ -1768,7 +1768,7 @@\n+-   // FIXME: We should be able to derive FailedSymsForQuery from each query once\n+-   //        we fix how the detach operation works.\n+-   struct EmitQueries {\n+--    JITDylib::AsynchronousSymbolQuerySet Updated;\n+-+    JITDylib::AsynchronousSymbolQuerySet Completed;\n+-     JITDylib::AsynchronousSymbolQuerySet Failed;\n+-     DenseMap<AsynchronousSymbolQuery *, std::shared_ptr<SymbolDependenceMap>>\n+-         FailedSymsForQuery;\n+-diff -ruN --strip-trailing-cr a/llvm/lib/ExecutionEngine/Orc/Core.cpp b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n+---- a/llvm/lib/ExecutionEngine/Orc/Core.cpp\n+-+++ b/llvm/lib/ExecutionEngine/Orc/Core.cpp\n+-@@ -2901,13 +2901,23 @@\n+- \n+-   for (auto &SN : ER.Ready)\n+-     IL_collectQueries(\n+--        EQ.Updated, SN->defs(),\n+-+        EQ.Completed, SN->defs(),\n+-         [](JITDylib::SymbolTableEntry &E) { E.setState(SymbolState::Ready); },\n+-         [](AsynchronousSymbolQuery &Q, JITDylib &JD,\n+-            NonOwningSymbolStringPtr Name, JITDylib::SymbolTableEntry &E) {\n+-           Q.notifySymbolMetRequiredState(SymbolStringPtr(Name), E.getSymbol());\n+-         });\n+- \n+-+  // std::erase_if is not available in C++17, and llvm::erase_if does not work\n+-+  // here.\n+-+  for (auto it = EQ.Completed.begin(), end = EQ.Completed.end(); it != end;) {\n+-+    if ((*it)->isComplete()) {\n+-+      ++it;\n+-+    } else {\n+-+      it = EQ.Completed.erase(it);\n+-+    }\n+-+  }\n+-+\n+- #ifdef EXPENSIVE_CHECKS\n+-   verifySessionState(\"exiting ExecutionSession::IL_emit\");\n+- #endif\n+-@@ -3043,9 +3053,8 @@\n+-     }\n+-   }\n+- \n+--  for (auto &UQ : EmitQueries->Updated)\n+--    if (UQ->isComplete())\n+--      UQ->handleComplete(*this);\n+-+  for (auto &UQ : EmitQueries->Completed)\n+-+    UQ->handleComplete(*this);\n+- \n+-   // If there are any bad dependencies then return an error.\n+-   if (!BadDeps.empty()) {\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index 98e83ed..335486c 100644\n+index 335486c..429d012 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"704240125ddf17b9b4995871af3759c742a202ba\"\n--    LLVM_SHA256 = \"0354f1e0c3842bb9f36e590e17bbb91018b014bd5c72736dff0b14d1b3f256e8\"\n-+    LLVM_COMMIT = \"621ed04e28787ade92b98e296332ac71d1b81678\"\n-+    LLVM_SHA256 = \"60729061c07f0e834acb1a18607d2552dc08596e651125a7aea9c37a4b390058\"\n+-    LLVM_COMMIT = \"621ed04e28787ade92b98e296332ac71d1b81678\"\n+-    LLVM_SHA256 = \"60729061c07f0e834acb1a18607d2552dc08596e651125a7aea9c37a4b390058\"\n++    LLVM_COMMIT = \"d7e40f3e71654658e249ee481e28aeae0e0410b1\"\n++    LLVM_SHA256 = \"86d7df5660d6e72bd05a486474ba3e811fcc703840ef8efe13529791565d851d\"\n  \n      tf_http_archive(\n          name = name,"
        },
        {
            "sha": "6287a075953e2574f313591ed2915c0e23631e18",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a1219cfa94838dbf998f4838403503b12afdd30a/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=a1219cfa94838dbf998f4838403503b12afdd30a",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"59b218bcc81a77142ce68f75b7f3dfce7573dd94\"\n-    SHARDY_SHA256 = \"6e47a724c68dff26b0e7e28b3b191adef1c259ff2eb31ffcda59fd8fbedfc671\"\n+    SHARDY_COMMIT = \"c2e02e3479c33dcc6bb5222683444948144beef9\"\n+    SHARDY_SHA256 = \"896a99739603991b2ef451c466b10a4517574761bb8130b90b4ef8f8280e9caa\"\n \n     tf_http_archive(\n         name = \"shardy\","
        }
    ],
    "stats": {
        "total": 178,
        "additions": 63,
        "deletions": 115
    }
}