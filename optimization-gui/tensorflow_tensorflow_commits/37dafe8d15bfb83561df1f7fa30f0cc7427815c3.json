{
    "author": "EusebioDM",
    "message": "Clean up includes in `gpu_compiler` and `dump`\n\nPiperOrigin-RevId: 827978357",
    "sha": "37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
    "files": [
        {
            "sha": "b70fcb4f9e6661e54aff1083b0c9941e66150998",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -537,6 +537,7 @@ cc_library(\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/types:span\",\n+        \"@com_google_protobuf//:protobuf\",\n         \"@llvm-project//llvm:Support\",\n         \"@llvm-project//mlir:IR\",\n         \"@llvm-project//mlir:Transforms\","
        },
        {
            "sha": "2cd25931440cc803acea283ecfde6809894155b1",
            "filename": "third_party/xla/xla/service/dump.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fdump.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fdump.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fdump.cc?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -45,6 +45,8 @@ limitations under the License.\n #include \"llvm/Support/raw_ostream.h\"\n #include \"mlir/IR/OperationSupport.h\"\n #include \"mlir/Transforms/LocationSnapshot.h\"\n+#include \"google/protobuf/descriptor.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/debug_options_flags.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n@@ -64,7 +66,6 @@ limitations under the License.\n #include \"xla/util.h\"\n #include \"tsl/platform/path.h\"\n #include \"tsl/platform/platform.h\"\n-#include \"tsl/platform/protobuf.h\"\n #include \"tsl/platform/regexp.h\"\n #include \"tsl/profiler/lib/scoped_annotation.h\"\n \n@@ -1176,6 +1177,8 @@ void DumpHloUnoptimizedSnapshotIfEnabled(\n       return;\n     }\n     tsl::WritableFileCopyingOutputStream output_stream(file.get());\n+    // TODO - b/457711066: Add missing include once capybara can re-write the\n+    // dependency correctly.\n     tsl::protobuf::io::CopyingOutputStreamAdaptor adaptor(&output_stream);\n     if (!SerializeHloUnoptimizedSnapshot(hlo_snapshot, &adaptor).ok()) {\n       LOG(ERROR) << \"Failed to serialize HLO unoptimized snapshot proto\";"
        },
        {
            "sha": "cb4f1ec219a6baf2034c87ce9d2d04e6a510a7bf",
            "filename": "third_party/xla/xla/service/gpu/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -1890,6 +1890,7 @@ cc_library(\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/types:span\",\n         \"@com_google_absl//absl/types:variant\",\n+        \"@com_google_protobuf//:protobuf\",\n         \"@llvm-project//llvm:AsmParser\",\n         \"@llvm-project//llvm:BitReader\",\n         \"@llvm-project//llvm:BitWriter\",\n@@ -1944,7 +1945,6 @@ xla_test(\n         \"//xla/backends/gpu/runtime:sequential_thunk\",\n         \"//xla/backends/gpu/runtime:thunk\",\n         \"//xla/hlo/ir:hlo\",\n-        \"//xla/hlo/ir:hlo_module_group\",\n         \"//xla/hlo/testlib:filecheck\",\n         \"//xla/hlo/testlib:pattern_matcher_gmock\",\n         \"//xla/hlo/testlib:verified_hlo_module\",\n@@ -1982,10 +1982,10 @@ xla_test(\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest\",\n+        \"@com_google_protobuf//:protobuf\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:casts\",\n         \"@local_tsl//tsl/platform:path\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n         \"@local_tsl//tsl/platform:regexp\",\n     ],\n )"
        },
        {
            "sha": "8aad660cfeef711f3eb00212584e61c170844109",
            "filename": "third_party/xla/xla/service/gpu/gpu_compiler.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.cc?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -58,8 +58,8 @@ limitations under the License.\n #include \"llvm/TargetParser/Triple.h\"\n #include \"llvm/Transforms/Utils/Cloning.h\"\n #include \"llvm/Transforms/Utils/SplitModule.h\"\n-#include \"mlir/IR/Diagnostics.h\"\n #include \"mlir/Support/LLVM.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/backends/cpu/nanort/nanort_client.h\"\n #include \"xla/backends/cpu/nanort/nanort_executable.h\"\n #include \"xla/backends/gpu/codegen/triton/support.h\"\n@@ -77,7 +77,6 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_instructions.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n-#include \"xla/hlo/ir/hlo_module_group.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/ir/hlo_schedule.h\"\n #include \"xla/hlo/pass/hlo_pass_fix.h\"\n@@ -212,7 +211,6 @@ limitations under the License.\n #include \"xla/service/gpu/transforms/collectives/all_reduce_splitter.h\"\n #include \"xla/service/gpu/transforms/collectives/collective_backend_assigner.h\"\n #include \"xla/service/gpu/transforms/collectives/collective_combiner_annotator.h\"\n-#include \"xla/service/gpu/transforms/collectives/collective_ops_utils.h\"\n #include \"xla/service/gpu/transforms/collectives/collective_permute_cycle_decomposer.h\"\n #include \"xla/service/gpu/transforms/collectives/collective_pipelining_analyzer.h\"\n #include \"xla/service/gpu/transforms/collectives/convert_async_collectives_to_sync.h\""
        },
        {
            "sha": "293a2bf4f0384d5c48031da5f671319652e4f40a",
            "filename": "third_party/xla/xla/service/gpu/gpu_compiler.h",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler.h?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -27,10 +27,8 @@ limitations under the License.\n #include \"llvm/IR/Module.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"xla/autotune_results.pb.h\"\n-#include \"xla/hlo/analysis/hlo_dataflow_analysis.h\"\n #include \"xla/hlo/analysis/symbolic_expr.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n-#include \"xla/hlo/ir/hlo_module_group.h\"\n #include \"xla/hlo/pass/hlo_pass_pipeline.h\"\n #include \"xla/hlo/transforms/simplifiers/algebraic_simplifier.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n@@ -54,7 +52,6 @@ limitations under the License.\n #include \"xla/tsl/platform/threadpool.h\"\n #include \"xla/util.h\"\n #include \"xla/xla.pb.h\"\n-#include \"tsl/platform/threadpool.h\"\n \n namespace xla {\n namespace gpu {"
        },
        {
            "sha": "8c58d5e94dce11086195bd7655f646ed117e7b4b",
            "filename": "third_party/xla/xla/service/gpu/gpu_compiler_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/37dafe8d15bfb83561df1f7fa30f0cc7427815c3/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_compiler_test.cc?ref=37dafe8d15bfb83561df1f7fa30f0cc7427815c3",
            "patch": "@@ -25,7 +25,6 @@ limitations under the License.\n #include <string>\n #include <tuple>\n #include <utility>\n-#include <variant>\n #include <vector>\n \n #include <gmock/gmock.h>\n@@ -41,14 +40,14 @@ limitations under the License.\n #include \"absl/strings/str_replace.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/strings/substitute.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/autotune_results.pb.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n #include \"xla/error_spec.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n-#include \"xla/hlo/ir/hlo_module_group.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/ir/hlo_print_options.h\"\n #include \"xla/hlo/testlib/filecheck.h\"\n@@ -91,7 +90,6 @@ limitations under the License.\n #include \"tsl/platform/casts.h\"\n #include \"tsl/platform/path.h\"\n #include \"tsl/platform/platform.h\"\n-#include \"tsl/platform/protobuf.h\"\n #include \"tsl/platform/regexp.h\"\n \n namespace xla {"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 9,
        "deletions": 12
    }
}