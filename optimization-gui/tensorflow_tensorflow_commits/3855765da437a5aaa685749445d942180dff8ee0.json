{
    "author": "tensorflower-gardener",
    "message": "Add a command line benchmark tool to benchmark dot shapes specified on the command line.\n\nPiperOrigin-RevId: 797329445",
    "sha": "3855765da437a5aaa685749445d942180dff8ee0",
    "files": [
        {
            "sha": "39b542edf0f9a6b266617603c52c12798a6c405c",
            "filename": "third_party/xla/xla/backends/cpu/benchmarks/hlo_benchmark_runner.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.cc?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -346,7 +346,7 @@ namespace {\n \n absl::StatusOr<std::pair<std::unique_ptr<HloModule>,\n                          std::unique_ptr<RunHloModuleIterationLiterals>>>\n-LoadFromHloSnapshotOrHloModuleProto(const std::string& hlo_data,\n+LoadFromHloSnapshotOrHloModuleProto(absl::string_view hlo_data,\n                                     absl::string_view extension) {\n   auto iteration_literals_proto =\n       std::make_unique<RunHloModuleIterationLiterals>();\n@@ -408,4 +408,15 @@ LoadHloModuleAndMaybeIterationLiterals(absl::string_view hlo_path) {\n                                              tsl::io::Extension(hlo_path));\n }\n \n+absl::StatusOr<std::pair<std::unique_ptr<HloModule>,\n+                         std::unique_ptr<RunHloModuleIterationLiterals>>>\n+LoadHloModuleAndMaybeIterationLiteralsFromString(absl::string_view hlo_data) {\n+  HloUnoptimizedSnapshot unoptimized_snapshot;\n+  if (unoptimized_snapshot.ParseFromString(hlo_data)) {\n+    return LoadFromHloUnoptimizedSnapshot(unoptimized_snapshot);\n+  }\n+\n+  return LoadFromHloSnapshotOrHloModuleProto(hlo_data, \"hlo\");\n+}\n+\n }  // namespace xla::cpu"
        },
        {
            "sha": "15aaa3bd5436351fb2f2b72a7cb228299aa293ee",
            "filename": "third_party/xla/xla/backends/cpu/benchmarks/hlo_benchmark_runner.h",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fbenchmarks%2Fhlo_benchmark_runner.h?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -90,6 +90,12 @@ absl::StatusOr<std::pair<std::unique_ptr<HloModule>,\n                          std::unique_ptr<RunHloModuleIterationLiterals>>>\n LoadHloModuleAndMaybeIterationLiterals(absl::string_view hlo_path);\n \n+// Loads an HLO module. If the user provides an HloSnapshot or a\n+// HloUnoptimizedSnapshot the iteration literals will be loaded as well.\n+absl::StatusOr<std::pair<std::unique_ptr<HloModule>,\n+                         std::unique_ptr<RunHloModuleIterationLiterals>>>\n+LoadHloModuleAndMaybeIterationLiteralsFromString(absl::string_view hlo_data);\n+\n }  // namespace xla::cpu\n \n #endif  // XLA_BACKENDS_CPU_BENCHMARKS_HLO_BENCHMARK_RUNNER_H_"
        },
        {
            "sha": "449ea4194bb7063e31965af985a8c4951dc92104",
            "filename": "third_party/xla/xla/hlo/parser/hlo_parser.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.cc?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -267,6 +267,7 @@ class HloParserImpl : public HloParser {\n \n   // Stand alone parsing utils for various aggregate data types.\n   absl::StatusOr<Shape> ParseShapeOnly();\n+  absl::StatusOr<std::vector<Shape>> ParseShapeListOnly();\n   absl::StatusOr<Layout> ParseLayoutOnly();\n   absl::StatusOr<HloSharding> ParseShardingOnly();\n   absl::StatusOr<std::shared_ptr<OriginalValue>> ParseOriginalValueOnly(\n@@ -7281,6 +7282,18 @@ absl::StatusOr<Shape> HloParserImpl::ParseShapeOnly() {\n   return shape;\n }\n \n+absl::StatusOr<std::vector<Shape>> HloParserImpl::ParseShapeListOnly() {\n+  lexer_.Lex();\n+  std::vector<Shape> shapes;\n+  if (!ParseShapeList(&shapes)) {\n+    return InvalidArgument(\"Syntax error:\\n%s\", GetError());\n+  }\n+  if (lexer_.GetKind() != TokKind::kEof) {\n+    return InvalidArgument(\"Syntax error:\\nExtra content after shape\");\n+  }\n+  return shapes;\n+}\n+\n absl::StatusOr<Layout> HloParserImpl::ParseLayoutOnly() {\n   lexer_.Lex();\n   Layout layout;\n@@ -7574,6 +7587,11 @@ absl::StatusOr<Shape> ParseShape(absl::string_view str) {\n   return parser.ParseShapeOnly();\n }\n \n+absl::StatusOr<std::vector<Shape>> ParseShapeList(absl::string_view str) {\n+  HloParserImpl parser(str);\n+  return parser.ParseShapeListOnly();\n+}\n+\n absl::StatusOr<Layout> ParseLayout(absl::string_view str) {\n   HloParserImpl parser(str);\n   return parser.ParseLayoutOnly();"
        },
        {
            "sha": "08f70aaef1fdb2c71007cb6451c4200feed91c76",
            "filename": "third_party/xla/xla/hlo/parser/hlo_parser.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fparser%2Fhlo_parser.h?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -120,6 +120,9 @@ absl::StatusOr<PaddingConfig> ParsePaddingConfig(absl::string_view str);\n // Parses and returns a Shape::ToString-format string.\n absl::StatusOr<Shape> ParseShape(absl::string_view str);\n \n+// Parses a comma-separated list of Shape::ToString-format strings.\n+absl::StatusOr<std::vector<Shape>> ParseShapeList(absl::string_view str);\n+\n // Parses and returns a Layout::ToString-format string.\n absl::StatusOr<Layout> ParseLayout(absl::string_view str);\n "
        },
        {
            "sha": "bc5685ec9dc983718c1352e3f8fb645a460589ff",
            "filename": "third_party/xla/xla/tools/hlo_module_loader.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.cc?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -77,7 +77,7 @@ std::string StripLogHeaders(absl::string_view hlo_string) {\n }\n \n absl::StatusOr<std::unique_ptr<HloModule>> LoadModuleFromData(\n-    const std::string& data, absl::string_view format,\n+    absl::string_view data, absl::string_view format,\n     const hlo_module_loader_details::Config& ovr_config,\n     const std::function<void(HloModuleConfig*)>& config_modifier_hook,\n     BufferAssignmentProto* buffer_assignment_proto, bool fill_missing_layouts) {\n@@ -153,7 +153,7 @@ absl::StatusOr<std::unique_ptr<HloModule>> LoadModuleFromFile(\n }\n \n absl::StatusOr<std::unique_ptr<RunHloModuleIterationLiterals>>\n-LoadInputFromData(const std::string& data, absl::string_view format) {\n+LoadInputFromData(absl::string_view data, absl::string_view format) {\n   HloSnapshot proto;\n   if (format == \"pb\") {\n     if (!proto.ParseFromString(data) &&"
        },
        {
            "sha": "b37a7b4d5940ec8fbefa6b2bb9aa19451cbb46d2",
            "filename": "third_party/xla/xla/tools/hlo_module_loader.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3855765da437a5aaa685749445d942180dff8ee0/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_module_loader.h?ref=3855765da437a5aaa685749445d942180dff8ee0",
            "patch": "@@ -57,7 +57,7 @@ std::string StripLogHeaders(absl::string_view hlo_string);\n // and the hlo module format is proto, it loads buffer assignment from the\n // proto.\n absl::StatusOr<std::unique_ptr<HloModule>> LoadModuleFromData(\n-    const std::string& data, absl::string_view format,\n+    absl::string_view data, absl::string_view format,\n     const hlo_module_loader_details::Config& ovr_config =\n         hlo_module_loader_details::Config(),\n     const std::function<void(HloModuleConfig*)>& config_modifier_hook = {},\n@@ -92,7 +92,7 @@ absl::StatusOr<std::unique_ptr<HloModule>> LoadModuleFromFile(\n // 1) A binary proto (format \"pb\")\n // 2) A text proto (format \"pbtxt\")\n absl::StatusOr<std::unique_ptr<RunHloModuleIterationLiterals>>\n-LoadInputFromData(const std::string& data, absl::string_view format);\n+LoadInputFromData(absl::string_view data, absl::string_view format);\n \n // Loads an HLO snapshot from file, only for its inputs\n // The file must be one of the following:"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 43,
        "deletions": 5
    }
}