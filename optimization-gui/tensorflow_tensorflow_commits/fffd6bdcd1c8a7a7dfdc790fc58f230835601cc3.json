{
    "author": "apivovarov",
    "message": "[tsl] Migrate from strings::Printf to absl::StrFormat.\n\nThis change replaces usages of the deprecated strings::Printf with the recommended absl::StrFormat in several files within tsl, along with updating necessary includes.\n\nPiperOrigin-RevId: 840513665",
    "sha": "fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
    "files": [
        {
            "sha": "08f6200631ee4746e1433d8e4f93d901763b8398",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -42,10 +42,10 @@ cc_library(\n         \"@com_github_grpc_grpc//:grpc++_codegen_proto\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings:cord\",\n+        \"@com_google_absl//absl/strings:str_format\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_protobuf//:protobuf\",\n         \"@local_tsl//tsl/platform:protobuf\",\n-        \"@local_tsl//tsl/platform:stringpiece\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:tstring\",\n     ],\n )"
        },
        {
            "sha": "6c254f67d001958d6763808e503e0f0916e575d2",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_util.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util.h?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -21,13 +21,14 @@ limitations under the License.\n \n #include \"absl/status/status.h\"\n #include \"absl/strings/cord.h\"\n+#include \"absl/strings/str_format.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"grpcpp/grpcpp.h\"\n #include \"grpcpp/support/byte_buffer.h\"\n #include \"xla/tsl/platform/status.h\"\n #include \"xla/tsl/protobuf/distributed_runtime_payloads.pb.h\"\n #include \"tsl/platform/protobuf.h\"\n-#include \"tsl/platform/stringpiece.h\"\n-#include \"tsl/platform/stringprintf.h\"\n+#include \"tsl/platform/tstring.h\"\n \n namespace tsl {\n \n@@ -98,7 +99,7 @@ inline ::grpc::Status ToGrpcStatus(const absl::Status& s) {\n   } else {\n     if (s.message().size() > 3072 /* 3k bytes */) {\n       // TODO(b/62947679): Remove truncation once the gRPC issue is resolved.\n-      std::string scratch = strings::Printf(\"%.3072s ... [truncated]\",\n+      std::string scratch = absl::StrFormat(\"%.3072s ... [truncated]\",\n                                             absl::StatusMessageAsCStr(s));\n       LOG(ERROR) << \"Truncated error message: \" << s;\n       return ::grpc::Status(static_cast<::grpc::StatusCode>(s.code()), scratch,"
        },
        {
            "sha": "be01eb9ef4306e3fe19d20986364457e7adaedca",
            "filename": "third_party/xla/xla/tsl/framework/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -114,13 +114,13 @@ cc_library(\n         \":type_traits\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ] + if_static(\n         extra_deps = [\n             \":allocator_registry_impl\",\n             \"@com_google_absl//absl/synchronization\",\n             \"//xla/tsl/lib/gtl:inlined_vector\",\n             \"@local_tsl//tsl/platform:strcat\",\n-            \"@local_tsl//tsl/platform:stringprintf\",\n             \"//xla/tsl/platform:env\",\n             \"//xla/tsl/platform:env_impl\",\n             \"//xla/tsl/platform:logging\",\n@@ -171,8 +171,6 @@ cc_library(\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-        \"@local_tsl//tsl/platform:strcat\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n         \"@local_tsl//tsl/profiler/lib:scoped_memory_debug_annotation\",\n         \"@local_tsl//tsl/profiler/lib:traceme\","
        },
        {
            "sha": "0c496045c93e56e1c651b5eb3ea78673ff7faa31",
            "filename": "third_party/xla/xla/tsl/framework/allocator.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fallocator.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fallocator.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fallocator.cc?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -15,19 +15,21 @@ limitations under the License.\n \n #include \"xla/tsl/framework/allocator.h\"\n \n-#include <atomic>\n+#include <cstddef>\n+#include <string>\n+#include <vector>\n \n+#include \"absl/strings/str_format.h\"\n #include \"xla/tsl/framework/allocator_registry.h\"\n #include \"xla/tsl/framework/tracking_allocator.h\"\n #include \"xla/tsl/platform/types.h\"\n #include \"tsl/platform/mem.h\"\n #include \"tsl/platform/strcat.h\"\n-#include \"tsl/platform/stringprintf.h\"\n \n namespace tsl {\n \n std::string AllocatorStats::DebugString() const {\n-  return strings::Printf(\n+  return absl::StrFormat(\n       \"Limit:            %20lld\\n\"\n       \"InUse:            %20lld\\n\"\n       \"MaxInUse:         %20lld\\n\""
        },
        {
            "sha": "50718ba6fc77986b126cb23dded25395e3009286",
            "filename": "third_party/xla/xla/tsl/framework/cpu_allocator_impl.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcpu_allocator_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcpu_allocator_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcpu_allocator_impl.cc?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -23,8 +23,6 @@ limitations under the License.\n #include \"xla/tsl/framework/tracking_allocator.h\"\n #include \"xla/tsl/platform/types.h\"\n #include \"tsl/platform/mem.h\"\n-#include \"tsl/platform/strcat.h\"\n-#include \"tsl/platform/stringprintf.h\"\n #include \"tsl/profiler/lib/scoped_memory_debug_annotation.h\"\n #include \"tsl/profiler/lib/traceme.h\"\n "
        },
        {
            "sha": "3904b0bf26bca6e91fae3b047b6867a8eebf573e",
            "filename": "third_party/xla/xla/tsl/platform/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -593,7 +593,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:stacktrace\",\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n     ] + tf_platform_deps(\"status\"),\n )"
        },
        {
            "sha": "cc7baaba71c13782647e68410953a513537accab",
            "filename": "third_party/xla/xla/tsl/platform/cloud/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -136,6 +136,7 @@ cc_library(\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n         \"@com_google_absl//absl/types:span\",\n@@ -146,7 +147,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:retrying_utils\",\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n         \"@local_tsl//tsl/profiler/lib:traceme\",\n     ],\n@@ -184,6 +184,7 @@ cc_library(\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n         \"@com_google_absl//absl/types:span\",\n@@ -194,7 +195,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:retrying_utils\",\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n         \"@local_tsl//tsl/profiler/lib:traceme\",\n     ],"
        },
        {
            "sha": "0f625395e0489dbb33e7c42cd054cfad817f857f",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -32,6 +32,7 @@ limitations under the License.\n #include \"absl/strings/match.h\"\n #include \"absl/strings/numbers.h\"\n #include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/strings/str_split.h\"\n #include \"absl/strings/string_view.h\"\n@@ -84,7 +85,6 @@ limitations under the License.\n #include \"tsl/platform/path.h\"\n #include \"tsl/platform/retrying_utils.h\"\n #include \"tsl/platform/str_util.h\"\n-#include \"tsl/platform/stringprintf.h\"\n #include \"tsl/platform/thread_annotations.h\"\n #include \"tsl/profiler/lib/traceme.h\"\n \n@@ -1183,7 +1183,7 @@ absl::Status GcsFileSystem::LoadBufferFromGCS(const string& fname,\n     GcsFileStat stat;\n     if (stat_cache_->Lookup(fname, &stat)) {\n       if (offset + bytes_read < stat.base.length) {\n-        return absl::InternalError(strings::Printf(\n+        return absl::InternalError(absl::StrFormat(\n             \"File contents are inconsistent for file: %s @ %lu.\", fname.c_str(),\n             offset));\n       }\n@@ -1607,7 +1607,7 @@ absl::Status GcsFileSystem::StatForObject(const string& fname,\n                                           const string& object,\n                                           GcsFileStat* stat) {\n   if (object.empty()) {\n-    return absl::InvalidArgumentError(strings::Printf(\n+    return absl::InvalidArgumentError(absl::StrFormat(\n         \"'object' must be a non-empty string. (File: %s)\", fname.c_str()));\n   }\n \n@@ -1652,7 +1652,7 @@ absl::Status GcsFileSystem::CheckBucketLocationConstraint(\n     return absl::OkStatus();\n   }\n \n-  return absl::FailedPreconditionError(strings::Printf(\n+  return absl::FailedPreconditionError(absl::StrFormat(\n       \"Bucket '%s' is in '%s' location, allowed locations are: (%s).\",\n       bucket.c_str(), location.c_str(),\n       absl::StrJoin(allowed_locations_, \", \").c_str()));"
        },
        {
            "sha": "b793a0aea0721d01be04a01285a81e9136ec4bb1",
            "filename": "third_party/xla/xla/tsl/platform/profile_utils/android_armv7a_cpu_utils_helper.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fprofile_utils%2Fandroid_armv7a_cpu_utils_helper.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fprofile_utils%2Fandroid_armv7a_cpu_utils_helper.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fprofile_utils%2Fandroid_armv7a_cpu_utils_helper.cc?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -29,8 +29,8 @@ limitations under the License.\n #include <sys/types.h>\n #include <unistd.h>\n \n+#include \"absl/strings/str_format.h\"\n #include \"xla/tsl/platform/logging.h\"\n-#include \"tsl/platform/stringprintf.h\"\n \n namespace tsl {\n namespace profile_utils {\n@@ -113,7 +113,7 @@ int AndroidArmV7ACpuUtilsHelper::OpenPerfEvent(perf_event_attr *const hw_event,\n \n int64 AndroidArmV7ACpuUtilsHelper::ReadCpuFrequencyFile(\n     const int cpu_id, const char *const type) {\n-  const string file_path = strings::Printf(\n+  const string file_path = absl::StrFormat(\n       \"/sys/devices/system/cpu/cpu%d/cpufreq/%s_freq\", cpu_id, type);\n   FILE *fp = fopen(file_path.c_str(), \"r\");\n   if (fp == nullptr) {"
        },
        {
            "sha": "ec8f04788bd83ffe57c0dfd3e2c78bf83f019918",
            "filename": "third_party/xla/xla/tsl/platform/windows/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD?ref=fffd6bdcd1c8a7a7dfdc790fc58f230835601cc3",
            "patch": "@@ -59,6 +59,7 @@ cc_library(\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/functional:any_invocable\",\n+        \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/time\",\n         \"@eigen_archive//:eigen3\",\n@@ -77,7 +78,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n         \"@local_tsl//tsl/platform:stringpiece\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:tracing\",\n     ],\n )"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 21,
        "deletions": 23
    }
}