{
    "author": "tensorflower-gardener",
    "message": "[XLA] Use absl::AnyInvocable instead of std::function since it can't be copied.\n\nPiperOrigin-RevId: 831294155",
    "sha": "bea62b9acc239bbc5981a97841c262457b5838ae",
    "files": [
        {
            "sha": "cf7eb953e2533bc98af48a023a00bba486647043",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -4386,9 +4386,9 @@ cc_library(\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/hlo/ir:hlo\",\n-        \"//xla/stream_executor/integrations:tf_allocator_adapter\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/base:nullability\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/log:die_if_null\",\n@@ -4438,6 +4438,7 @@ cc_library(\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n@@ -4478,6 +4479,7 @@ cc_library(\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:die_if_null\",\n         \"@com_google_absl//absl/status\","
        },
        {
            "sha": "c050db3ab724c0376ff202ea9e65e968079628a7",
            "filename": "third_party/xla/xla/service/hlo_runner.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -16,14 +16,13 @@ limitations under the License.\n #include \"xla/service/hlo_runner.h\"\n \n #include <cstdint>\n-#include <functional>\n #include <memory>\n #include <string>\n #include <utility>\n-#include <variant>\n #include <vector>\n \n #include \"absl/base/nullability.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n@@ -481,12 +480,12 @@ absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicated(\n }\n \n absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicatedImpl(\n-    std::function<absl::StatusOr<std::vector<ScopedShapedBuffer>>(\n+    absl::AnyInvocable<absl::StatusOr<std::vector<ScopedShapedBuffer>>(\n         const std::vector<ServiceExecutableRunOptions>&,\n         const std::vector<absl::Span<const ShapedBuffer* const>>&)>\n         execution_helper,\n-    std::function<int64_t(int64_t)> argument_count_provider,\n-    std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+    absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+    absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n     const ReplicatedExecuteOptions& options,\n     DeviceAssignment* device_assignment) {\n   std::vector<std::unique_ptr<se::Stream>> streams;\n@@ -671,9 +670,9 @@ absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicated(\n }\n \n absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicated(\n-    std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-    std::function<int64_t(int64_t)> argument_count_provider,\n-    std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+    absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+    absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+    absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n     const ReplicatedExecuteOptions& options,\n     DeviceAssignment* device_assignment) {\n   DeviceAssignment computation_device_assignment;\n@@ -725,7 +724,8 @@ absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicated(\n         }\n         return results;\n       },\n-      argument_count_provider, argument_provider, options, device_assignment);\n+      std::move(argument_count_provider), std::move(argument_provider), options,\n+      device_assignment);\n }\n \n absl::StatusOr<std::vector<Literal>> HloRunner::ExecuteReplicated("
        },
        {
            "sha": "0673c0444aafdc870ca07ba9e0b57570c8360dfc",
            "filename": "third_party/xla/xla/service/hlo_runner.h",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.h?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -17,13 +17,13 @@ limitations under the License.\n #define XLA_SERVICE_HLO_RUNNER_H_\n \n #include <cstdint>\n-#include <functional>\n #include <memory>\n #include <vector>\n \n #include \"absl/base/nullability.h\"\n #include \"absl/base/thread_annotations.h\"\n #include \"absl/container/flat_hash_set.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n@@ -188,9 +188,9 @@ class HloRunner : public HloRunnerInterface {\n   // Note that this call ignores `ReplicatedExecutionOptions::run_hlo_passes`,\n   // since we've already compiled the `Executable`.\n   absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment) override;\n \n@@ -264,12 +264,12 @@ class HloRunner : public HloRunnerInterface {\n \n   // Common implementation code for ExecuteReplicated() above.\n   absl::StatusOr<std::vector<Literal>> ExecuteReplicatedImpl(\n-      std::function<absl::StatusOr<std::vector<ScopedShapedBuffer>>(\n+      absl::AnyInvocable<absl::StatusOr<std::vector<ScopedShapedBuffer>>(\n           const std::vector<ServiceExecutableRunOptions>&,\n           const std::vector<absl::Span<const ShapedBuffer* const>>&)>\n           execution_helper,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment);\n "
        },
        {
            "sha": "a7141a9c02482e0f52158e2b8f64544be1cd98fc",
            "filename": "third_party/xla/xla/service/hlo_runner_interface.h",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_interface.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_interface.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_interface.h?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -17,12 +17,12 @@ limitations under the License.\n #define XLA_SERVICE_HLO_RUNNER_INTERFACE_H_\n \n #include <cstdint>\n-#include <functional>\n #include <memory>\n #include <utility>\n #include <vector>\n \n #include \"absl/base/nullability.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/die_if_null.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n@@ -291,9 +291,9 @@ class HloRunnerInterface {\n       DeviceAssignment* device_assignment) = 0;\n \n   virtual absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment) = 0;\n "
        },
        {
            "sha": "45d3963cc253d1e80646cac4efecee5cd1653072",
            "filename": "third_party/xla/xla/service/hlo_runner_pjrt.cc",
            "status": "modified",
            "additions": 21,
            "deletions": 15,
            "changes": 36,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -17,7 +17,6 @@ limitations under the License.\n \n #include <array>\n #include <cstdint>\n-#include <functional>\n #include <memory>\n #include <optional>\n #include <string>\n@@ -26,6 +25,7 @@ limitations under the License.\n \n #include \"absl/algorithm/container.h\"\n #include \"absl/base/nullability.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/die_if_null.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n@@ -563,7 +563,9 @@ absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicated(\n \n   xla::ExecuteOptions execute_options;\n   return ExecuteReplicatedImpl(\n-      [&](absl::Span<const std::vector<PjRtBuffer*>> argument_buffer_slices)\n+      [&](absl::Span<const std::vector<PjRtBuffer*>> argument_buffer_slices,\n+          absl::AnyInvocable<OpaqueExecutable*(int64_t)>\n+              executable_provider_arg)\n           -> absl::StatusOr<\n               std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>> {\n         tsl::recordphase::RecordScoped rs(\"HloRunnerPjRt_Execute\",\n@@ -581,15 +583,17 @@ absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicated(\n }\n \n absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicated(\n-    std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-    std::function<int64_t(int64_t)> argument_count_provider,\n-    std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+    absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+    absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+    absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n     const HloRunnerInterface::ReplicatedExecuteOptions& options,\n     DeviceAssignment* device_assignment) {\n   TF_RET_CHECK(device_assignment->computation_count() == 1)\n       << \"Only single-computation execution is supported.\";\n   return ExecuteReplicatedImpl(\n-      [&](absl::Span<const std::vector<PjRtBuffer*>> argument_buffer_slices)\n+      [&](absl::Span<const std::vector<PjRtBuffer*>> argument_buffer_slices,\n+          absl::AnyInvocable<OpaqueExecutable*(int64_t)>\n+              executable_provider_arg)\n           -> absl::StatusOr<\n               std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>> {\n         tsl::recordphase::RecordScoped rs(\"HloRunnerPjRt_Execute\",\n@@ -613,7 +617,7 @@ absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicated(\n             }\n             TF_ASSIGN_OR_RETURN(HloRunnerPjRtExecutable* const executable,\n                                 HloRunnerPjRtExecutable::TryUnwrap(\n-                                    *this, executable_provider(i)));\n+                                    *this, executable_provider_arg(i)));\n             TF_ASSIGN_OR_RETURN(\n                 PjRtLoadedExecutable * pjrt_executable,\n                 executable->GetOrLoadExecutable(pjrt_client_.get()));\n@@ -650,18 +654,19 @@ absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicated(\n         }\n         return results;\n       },\n-      executable_provider, argument_count_provider, argument_provider, options,\n-      device_assignment);\n+      std::move(executable_provider), std::move(argument_count_provider),\n+      std::move(argument_provider), options, device_assignment);\n }\n \n absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicatedImpl(\n-    std::function<\n+    absl::AnyInvocable<\n         absl::StatusOr<std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>>(\n-            absl::Span<const std::vector<PjRtBuffer*>>)>\n+            absl::Span<const std::vector<PjRtBuffer*>>,\n+            absl::AnyInvocable<OpaqueExecutable*(int64_t)>)>\n         execution_helper,\n-    std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-    std::function<int64_t(int64_t)> argument_count_provider,\n-    std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+    absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+    absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+    absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n     const ReplicatedExecuteOptions& options,\n     DeviceAssignment* device_assignment) {\n   TF_RET_CHECK(options.infeed_values.empty() ||\n@@ -770,7 +775,8 @@ absl::StatusOr<std::vector<Literal>> HloRunnerPjRt::ExecuteReplicatedImpl(\n   TF_ASSIGN_OR_RETURN(\n       const std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>\n           result_buffers,\n-      execution_helper(BufferMatToPointerMat(argument_buffer_slices)));\n+      execution_helper(BufferMatToPointerMat(argument_buffer_slices),\n+                       std::move(executable_provider)));\n   VLOG(1) << \"Replicated execution terminated\";\n \n   // Get the result from execution."
        },
        {
            "sha": "488a0777aadcf49b3643a86117c246ee4fe1d976",
            "filename": "third_party/xla/xla/service/hlo_runner_pjrt.h",
            "status": "modified",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.h?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -17,14 +17,14 @@ limitations under the License.\n #define XLA_SERVICE_HLO_RUNNER_PJRT_H_\n \n #include <cstdint>\n-#include <functional>\n #include <memory>\n #include <string>\n #include <utility>\n #include <vector>\n \n #include \"absl/base/nullability.h\"\n #include \"absl/container/flat_hash_set.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n@@ -102,9 +102,9 @@ class HloRunnerPjRt : public HloRunnerInterface {\n       DeviceAssignment* device_assignment) override;\n \n   absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment) override;\n \n@@ -137,13 +137,14 @@ class HloRunnerPjRt : public HloRunnerInterface {\n       HloModule* module, bool run_hlo_passes);\n \n   absl::StatusOr<std::vector<Literal>> ExecuteReplicatedImpl(\n-      std::function<\n+      absl::AnyInvocable<\n           absl::StatusOr<std::vector<std::vector<std::unique_ptr<PjRtBuffer>>>>(\n-              absl::Span<const std::vector<PjRtBuffer*>>)>\n+              absl::Span<const std::vector<PjRtBuffer*>>,\n+              absl::AnyInvocable<OpaqueExecutable*(int64_t)>)>\n           execution_helper,\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment);\n \n@@ -175,9 +176,9 @@ class CompilePhaseHloRunnerPjRt : public HloRunnerPjRt {\n   }\n \n   absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const ReplicatedExecuteOptions& options,\n       DeviceAssignment* device_assignment) override {\n     return absl::UnimplementedError("
        },
        {
            "sha": "4aac432445ab508028c7d481c0d8751035f12c92",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -235,6 +235,7 @@ cc_library(\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:nullability\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n@@ -2882,6 +2883,7 @@ xla_test(\n         \"//xla/tsl/platform:test\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\","
        },
        {
            "sha": "917ad2db33c198a9a7f70e3c5e18130e8a1b1474",
            "filename": "third_party/xla/xla/tests/collective_ops_e2e_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fcollective_ops_e2e_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fcollective_ops_e2e_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fcollective_ops_e2e_test.cc?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -22,11 +22,11 @@ limitations under the License.\n #include <string>\n #include <tuple>\n #include <utility>\n-#include <variant>\n #include <vector>\n \n #include \"absl/algorithm/container.h\"\n #include \"absl/container/flat_hash_map.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n@@ -154,11 +154,10 @@ class CollectiveOpsE2ETestBase : public HloHardwareIndependentTestBase {\n         reference_platform, /*intra_op_parallelism_threads=*/0);\n   }\n \n-  // TODO(b/449655621) Use absl::AnyInvocable instead of std::function.\n   absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      const std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      const std::function<int64_t(int64_t)> argument_count_provider,\n-      const std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       const int64_t num_replicas, const bool run_hlo_passes,\n       DeviceAssignment* const device_assignment) {\n     // TODO(b/441865120): Use designated initializers this once XLA moves to"
        },
        {
            "sha": "0f03467cf92087627a6d9f60bc388abd60c2c58d",
            "filename": "third_party/xla/xla/tests/hlo_runner_agnostic_test_base.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -26,6 +26,7 @@ limitations under the License.\n \n #include \"absl/algorithm/container.h\"\n #include \"absl/base/nullability.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n@@ -176,18 +177,18 @@ HloRunnerAgnosticTestBase::ExecuteReplicated(\n \n absl::StatusOr<std::vector<Literal>>\n HloRunnerAgnosticTestBase::ExecuteReplicated(\n-    const std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-    const std::function<int64_t(int64_t)> argument_count_provider,\n-    const std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+    absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+    absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+    absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n     const int64_t num_replicas, const bool run_hlo_passes,\n     DeviceAssignment* const device_assignment) {\n   HloRunnerInterface::ReplicatedExecuteOptions options;\n   options.num_replicas = num_replicas;\n   options.run_hlo_passes = run_hlo_passes;\n   options.use_threads = true;\n   return test_runner_->ExecuteReplicated(\n-      executable_provider, argument_count_provider, argument_provider,\n-      std::move(options), device_assignment);\n+      std::move(executable_provider), std::move(argument_count_provider),\n+      std::move(argument_provider), std::move(options), device_assignment);\n }\n \n absl::StatusOr<std::vector<Literal>>"
        },
        {
            "sha": "d7460df59858f2ff2a635d2b9a1b9437b23bb98b",
            "filename": "third_party/xla/xla/tests/hlo_runner_agnostic_test_base.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bea62b9acc239bbc5981a97841c262457b5838ae/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h?ref=bea62b9acc239bbc5981a97841c262457b5838ae",
            "patch": "@@ -26,6 +26,7 @@ limitations under the License.\n \n #include \"absl/base/attributes.h\"\n #include \"absl/base/nullability.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n@@ -176,9 +177,9 @@ class HloRunnerAgnosticTestBase : public HloHardwareIndependentTestBase {\n \n   // Same as above, but allows passing different programs for replicas.\n   absl::StatusOr<std::vector<Literal>> ExecuteReplicated(\n-      std::function<OpaqueExecutable*(int64_t)> executable_provider,\n-      std::function<int64_t(int64_t)> argument_count_provider,\n-      std::function<const Literal*(int64_t, int64_t)> argument_provider,\n+      absl::AnyInvocable<OpaqueExecutable*(int64_t)> executable_provider,\n+      absl::AnyInvocable<int64_t(int64_t)> argument_count_provider,\n+      absl::AnyInvocable<const Literal*(int64_t, int64_t)> argument_provider,\n       int64_t num_replicas, bool run_hlo_passes,\n       DeviceAssignment* device_assignment = nullptr);\n "
        }
    ],
    "stats": {
        "total": 134,
        "additions": 73,
        "deletions": 61
    }
}