{
    "author": "beckerhe",
    "message": "Remove platform IDs declarations from platform headers\n\nPlatformIds like `kCudaPlatformId` and `kRocmPlatformId` are currently declared both in `xyz_platform.h` and `xyz_platform_id.h`. But users should include the `xyz_platform_id.h` header instead of the `xyz_platform.h` header when they only need the platform ID. The difference is that the platform targets depend on the entire platform SW stack (CUDA or ROCm libraries) while the platform ID targets are lightweight and don't have any additional dependencies.\n\nRemoving the ID declarations from `xyz_platform.h` forces users to include the correct header and allows removal of the dependency on the plaform target if not needed.\n\nPiperOrigin-RevId: 832277106",
    "sha": "f895a53e79ec7c0b0ef935a89beca4a85447f790",
    "files": [
        {
            "sha": "7e175865b87390ab79725f52a5c128908e9653fa",
            "filename": "third_party/xla/xla/backends/gpu/profiler/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2FBUILD?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -32,7 +32,7 @@ cc_library(\n         \"//xla/backends/profiler/gpu:cupti_collector\",\n         \"//xla/backends/profiler/gpu:cupti_tracer\",\n         \"//xla/stream_executor:platform\",\n-        \"//xla/stream_executor/cuda:cuda_platform\",\n+        \"//xla/stream_executor/cuda:cuda_platform_id\",\n         \"//xla/stream_executor/platform:platform_object_registry\",\n         \"//xla/tsl/profiler/utils:time_utils\",\n         \"@com_google_absl//absl/status:statusor\","
        },
        {
            "sha": "3f85e66973a1d3a3c2b37e61931ffa425bac1e7d",
            "filename": "third_party/xla/xla/backends/gpu/profiler/kernel_name_tracer_cuda.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2Fkernel_name_tracer_cuda.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2Fkernel_name_tracer_cuda.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fprofiler%2Fkernel_name_tracer_cuda.cc?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -22,7 +22,7 @@ limitations under the License.\n #include \"xla/backends/gpu/profiler/kernel_name_tracer_factory.h\"\n #include \"xla/backends/profiler/gpu/cupti_collector.h\"\n #include \"xla/backends/profiler/gpu/cupti_tracer.h\"\n-#include \"xla/stream_executor/cuda/cuda_platform.h\"\n+#include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/platform/platform_object_registry.h\"\n #include \"xla/tsl/profiler/utils/time_utils.h\"\n #include \"tsl/profiler/protobuf/xplane.pb.h\""
        },
        {
            "sha": "23255ba3864541303f1b6ce89703f389f7dd8110",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -3190,9 +3190,7 @@ cc_library(\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n-    ] + if_cuda_is_configured([\n-        \"//xla/stream_executor/cuda:buffer_debug_float_check_kernel_cuda\",\n-    ]),\n+    ],\n )\n \n xla_test("
        },
        {
            "sha": "0075448c8da9836b72f422ebac586fa4e89e3e45",
            "filename": "third_party/xla/xla/stream_executor/cuda/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2FBUILD?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -403,7 +403,7 @@ cuda_library(\n         \"gpu\",\n     ],\n     deps = [\n-        \":cuda_platform\",\n+        \":cuda_platform_id\",\n         \"//xla/backends/gpu/runtime:buffer_debug_log_structs\",\n         \"//xla/stream_executor:kernel_spec\",\n         \"//xla/stream_executor/gpu:buffer_debug_xor_checksum_kernel\",\n@@ -456,7 +456,7 @@ cuda_library(\n         \"gpu\",\n     ],\n     deps = [\n-        \":cuda_platform\",\n+        \":cuda_platform_id\",\n         \"//xla/backends/gpu/runtime:buffer_debug_log_structs\",\n         \"//xla/stream_executor:kernel_spec\",\n         \"//xla/stream_executor/gpu:buffer_debug_float_check_kernel\",\n@@ -2361,7 +2361,7 @@ cuda_library(\n         \"gpu\",\n     ],\n     deps = [\n-        \":cuda_platform\",\n+        \":cuda_platform_id\",\n         \"//xla/stream_executor:device_memory\",\n         \"//xla/stream_executor:kernel\",\n         \"//xla/stream_executor:kernel_spec\","
        },
        {
            "sha": "2325478c1256fb946b8d659bda7d946b8e7f8701",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_float_check_kernel_cuda.cu.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_float_check_kernel_cuda.cu.cc?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -13,19 +13,17 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include <cassert>\n #include <cmath>\n #include <cstdint>\n-#include <cstdlib>\n-#include <cstring>\n \n #include \"absl/base/casts.h\"\n #include \"third_party/gpus/cuda/include/cuda/atomic\"\n #include \"xla/backends/gpu/runtime/buffer_debug_log_structs.h\"\n-#include \"xla/stream_executor/cuda/cuda_platform.h\"\n+#include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/gpu/buffer_debug_float_check_kernel.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/kernel_spec.h\"\n-#include \"xla/tsl/platform/logging.h\"\n \n namespace se = stream_executor;\n "
        },
        {
            "sha": "412441afb61926f3e92315336530abff87c0d349",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -20,7 +20,7 @@ limitations under the License.\n #include \"absl/base/casts.h\"\n #include \"third_party/gpus/cuda/include/cuda/atomic\"\n #include \"xla/backends/gpu/runtime/buffer_debug_log_structs.h\"\n-#include \"xla/stream_executor/cuda/cuda_platform.h\"\n+#include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/gpu/buffer_debug_xor_checksum_kernel.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/kernel_spec.h\""
        },
        {
            "sha": "bba9f74d7299a1eceaa61a221db63715f37a9bd1",
            "filename": "third_party/xla/xla/stream_executor/cuda/cub_prefix_sum_kernel_cuda.cu.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcub_prefix_sum_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcub_prefix_sum_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcub_prefix_sum_kernel_cuda.cu.cc?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -18,7 +18,7 @@ limitations under the License.\n #include \"cub/block/block_scan.cuh\"\n #include \"third_party/gpus/cuda/include/cuda.h\"\n #include \"third_party/gpus/cuda/include/cuda_fp16.h\"\n-#include \"xla/stream_executor/cuda/cuda_platform.h\"\n+#include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/gpu/gpu_kernel_registry.h\"\n #include \"xla/stream_executor/gpu/prefix_sum_kernel.h\"\n #include \"xla/stream_executor/kernel_spec.h\""
        },
        {
            "sha": "3d50e92cc107fa8f38f969da8bfc1b2305eee1b2",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_platform.h",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_platform.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_platform.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_platform.h?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -25,13 +25,6 @@ limitations under the License.\n #include \"xla/stream_executor/stream_executor.h\"\n \n namespace stream_executor {\n-namespace cuda {\n-// Opaque and unique identifier for the CUDA platform plugin.\n-// This is needed so that plugins can refer to/identify this platform without\n-// instantiating a CudaPlatform object.\n-extern const Platform::Id kCudaPlatformId;\n-}  // namespace cuda\n-\n namespace gpu {\n // Cuda-specific platform plugin, registered as a singleton value via module\n // initializer."
        },
        {
            "sha": "64ce30286953c9e43d35d9a3017390e87c9b6b1d",
            "filename": "third_party/xla/xla/stream_executor/rocm/rocm_platform.h",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2Frocm_platform.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2Frocm_platform.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2Frocm_platform.h?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -29,11 +29,6 @@ limitations under the License.\n namespace stream_executor {\n namespace gpu {\n \n-// Opaque and unique identifier for the ROCM platform plugin.\n-// This is needed so that plugins can refer to/identify this platform without\n-// instantiating a ROCmPlatform object.\n-extern const Platform::Id kROCmPlatformId;\n-\n // ROCm-specific platform plugin, registered as a singleton value via module\n // initializer.\n class ROCmPlatform : public Platform {"
        },
        {
            "sha": "be65d61c2c7f9056cb287027531fa966120b004e",
            "filename": "third_party/xla/xla/stream_executor/sycl/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -47,7 +47,6 @@ cc_library(\n         \"//xla/stream_executor:platform_manager\",\n         \"//xla/stream_executor:stream_executor_h\",\n         \"//xla/stream_executor/platform:initialize\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\","
        },
        {
            "sha": "69fc648cd167c5e0d01811bf34980a0cfd2cce2e",
            "filename": "third_party/xla/xla/stream_executor/sycl/sycl_platform.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.cc?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -27,7 +27,6 @@ limitations under the License.\n #include \"xla/stream_executor/platform/initialize.h\"\n #include \"xla/stream_executor/platform_manager.h\"\n #include \"xla/stream_executor/sycl/sycl_platform_id.h\"\n-#include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/status.h\"\n \n namespace stream_executor {"
        },
        {
            "sha": "1fe8e301d735d73928c844b86dfd27db54701d1a",
            "filename": "third_party/xla/xla/stream_executor/sycl/sycl_platform.h",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f895a53e79ec7c0b0ef935a89beca4a85447f790/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_platform.h?ref=f895a53e79ec7c0b0ef935a89beca4a85447f790",
            "patch": "@@ -20,18 +20,13 @@ limitations under the License.\n #include <string>\n \n #include \"absl/status/statusor.h\"\n+#include \"xla/stream_executor/device_description.h\"\n #include \"xla/stream_executor/executor_cache.h\"\n #include \"xla/stream_executor/platform.h\"\n-#include \"xla/stream_executor/platform_manager.h\"\n #include \"xla/stream_executor/stream_executor.h\"\n \n namespace stream_executor::sycl {\n \n-// Opaque and unique identifier for the SYCL platform plugin.\n-// This is needed so that plugins can refer to/identify this platform without\n-// instantiating a SyclPlatform object.\n-extern const Platform::Id kSyclPlatformId;\n-\n // SYCL-specific platform plugin, registered as a singleton value via module\n // initializer.\n class SyclPlatform : public Platform {\n@@ -40,7 +35,7 @@ class SyclPlatform : public Platform {\n   ~SyclPlatform() override;\n \n   // Platform interface implementation:\n-  // Returns the same value as kSyclPlatform above.\n+  // Returns the same value as kSyclPlatformId above.\n   Platform::Id id() const override;\n \n   // Returns -1 as a sentinel on internal failure (and logs the error)."
        }
    ],
    "stats": {
        "total": 47,
        "additions": 12,
        "deletions": 35
    }
}