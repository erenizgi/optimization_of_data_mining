{
    "author": "ezhulenev",
    "message": "[xla] Delete unused APIs to create and track user promise\n\nPiperOrigin-RevId: 808037652",
    "sha": "ccf09202831d2ac394f41d4cdcb10296cbe5adb0",
    "files": [
        {
            "sha": "f1a72ab5524d5662fc8d4305cfd8c26883a1fe19",
            "filename": "third_party/xla/xla/pjrt/common_pjrt_client.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 17,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ccf09202831d2ac394f41d4cdcb10296cbe5adb0/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ccf09202831d2ac394f41d4cdcb10296cbe5adb0/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.cc?ref=ccf09202831d2ac394f41d4cdcb10296cbe5adb0",
            "patch": "@@ -65,18 +65,6 @@ limitations under the License.\n \n namespace xla {\n \n-PjRtFuture<>::Promise CommonPjRtClient::CreateUserPromise(\n-    PjRtMemorySpace* memory_space, absl::string_view debug_info) {\n-  return PjRtFuture<>::CreatePromise();\n-}\n-\n-PjRtFuture<> CommonPjRtClient::CreateFutureFromUserPromise(\n-    PjRtMemorySpace* memory_space, const char* callee_type,\n-    const char* callee_method, PjRtFuture<>::Promise promise) {\n-  return CreateProfiledFuture(memory_space, callee_type, callee_method,\n-                              PjRtFuture<>(std::move(promise)));\n-}\n-\n void CommonPjRtClient::TrackFuture(PjRtMemorySpace* memory_space,\n                                    absl::string_view debug_info,\n                                    const PjRtFuture<>& future) {}\n@@ -103,15 +91,16 @@ PjRtFuture<> CommonPjRtClient::CreateProfiledFuture(\n       });\n }\n \n-std::pair<PjRtFuture<>::Promise, PjRtFuture<>>\n+std::pair<PjRtFuture<>::MoveOnlyPromise, PjRtFuture<>>\n CommonPjRtClient::CreateLinkedUserPromise(PjRtMemorySpace* memory_space,\n                                           const char* callee_type,\n                                           const char* callee_method,\n                                           absl::string_view debug_info) {\n-  PjRtFuture<>::Promise promise = CreateUserPromise(memory_space, debug_info);\n-  auto result = CreateFutureFromUserPromise(memory_space, callee_type,\n-                                            callee_method, promise);\n-  return std::make_pair(std::move(promise), std::move(result));\n+  auto [promise, future] = PjRtFuture<>::MakePromise();\n+  auto profiled_future = CreateProfiledFuture(memory_space, callee_type,\n+                                              callee_method, std::move(future));\n+  TrackFuture(memory_space, debug_info, profiled_future);\n+  return std::make_pair(std::move(promise), std::move(profiled_future));\n }\n \n tsl::AsyncValueRef<bool> CommonPjRtClient::CreateAllocationEventForTransfers("
        },
        {
            "sha": "c2aadc723f9c88019bc3f44dd204241d0e8cba5d",
            "filename": "third_party/xla/xla/pjrt/common_pjrt_client.h",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ccf09202831d2ac394f41d4cdcb10296cbe5adb0/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ccf09202831d2ac394f41d4cdcb10296cbe5adb0/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcommon_pjrt_client.h?ref=ccf09202831d2ac394f41d4cdcb10296cbe5adb0",
            "patch": "@@ -121,17 +121,6 @@ class CommonPjRtClient : public PjRtClient {\n         \"CreateLinkedEventPromise is not supported\");\n   }\n \n-  // Create a promise with potentially attached debug_info (if\n-  // event_tracking_enabled()).\n-  virtual PjRtFuture<>::Promise CreateUserPromise(PjRtMemorySpace* memory_space,\n-                                                  absl::string_view debug_info);\n-\n-  // Creates a future from a promise PjRtFuture<>(promise) but with event\n-  // tracking and traceme scopes.\n-  virtual PjRtFuture<> CreateFutureFromUserPromise(\n-      PjRtMemorySpace* memory_space, const char* callee_type,\n-      const char* callee_method, PjRtFuture<>::Promise promise);\n-\n   // Track a user-provided future with attached debug_info (if\n   // event_tracking_enabled()).\n   virtual void TrackFuture(PjRtMemorySpace* memory_space,\n@@ -148,9 +137,10 @@ class CommonPjRtClient : public PjRtClient {\n   // Create a linked PjRtFuture<> and ::Promise pair for operations on\n   // buffers in memory_space which populates debug information like linked\n   // tracmes.\n-  std::pair<PjRtFuture<>::Promise, PjRtFuture<>> CreateLinkedUserPromise(\n-      PjRtMemorySpace* memory_space, const char* callee_type,\n-      const char* callee_method, absl::string_view debug_info);\n+  std::pair<PjRtFuture<>::MoveOnlyPromise, PjRtFuture<>>\n+  CreateLinkedUserPromise(PjRtMemorySpace* memory_space,\n+                          const char* callee_type, const char* callee_method,\n+                          absl::string_view debug_info);\n \n   template <typename T, std::enable_if_t<std::is_invocable_v<T>, bool> = true>\n   absl::StatusOr<std::pair<tsl::RCReference<PjRtDeviceEventPromise>,"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 10,
        "deletions": 31
    }
}