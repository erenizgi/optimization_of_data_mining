{
    "author": "hawkinsp",
    "message": "Define StructuredTensor.FieldName outside the class.\n\nFixes a problem where structured_tensor fails to import under Python 3.14 with the error:\n\n```\n  File \".../tensorflow/python/ops/structured/structured_tensor.py\", line 54, in <module>\n    class StructuredTensor(extension_type.BatchableExtensionType):\n    ...<1135 lines>...\n          return self._ragged_shape.rank\n  File \".../tensorflow/python/framework/extension_type.py\", line 90, in __init__\n    _check_field_annotations(cls)\n    ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^\n  File \".../tensorflow/python/framework/extension_type.py\", line 935, in _check_field_annotations\n    raise ValueError(\n    ...<2 lines>...\n    )\nValueError: The field annotations for StructuredTensor are invalid. Field FieldName is missing a type annotation.\n```\nPiperOrigin-RevId: 834982237",
    "sha": "00931720105b0c427715ddc4b1bff3f46748970e",
    "files": [
        {
            "sha": "0d68e5aa1906542fe782c67ca4ef42d24d1b9c16",
            "filename": "tensorflow/python/ops/structured/structured_tensor.py",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/00931720105b0c427715ddc4b1bff3f46748970e/tensorflow%2Fpython%2Fops%2Fstructured%2Fstructured_tensor.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/00931720105b0c427715ddc4b1bff3f46748970e/tensorflow%2Fpython%2Fops%2Fstructured%2Fstructured_tensor.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fops%2Fstructured%2Fstructured_tensor.py?ref=00931720105b0c427715ddc4b1bff3f46748970e",
            "patch": "@@ -14,6 +14,8 @@\n # ==============================================================================\n \"\"\"Structured Tensors.\"\"\"\n \n+from __future__ import annotations\n+\n import re\n from typing import Callable, Dict, List, Mapping, Optional, Sequence, Tuple, Union\n \n@@ -49,6 +51,10 @@\n # FieldValue.\n _FieldFn = Callable[[_FieldValue], _FieldValue]\n \n+# Field names work as key, and they can be a sequence to refer to the\n+# sub-levels (embedded) StructuredTensor's.\n+FieldName = Union[str, Sequence[str]]\n+\n \n @tf_export('experimental.StructuredTensor')\n class StructuredTensor(extension_type.BatchableExtensionType):\n@@ -99,15 +105,6 @@ class StructuredTensor(extension_type.BatchableExtensionType):\n   _ragged_shape: dynamic_ragged_shape.DynamicRaggedShape\n \n   __name__ = 'tf.StructuredTensor'\n-  #=============================================================================\n-  # Common Types\n-  #=============================================================================\n-  # pylint: disable=invalid-name\n-  # Field names work as key, and they can be a sequence to refer to the\n-  # sub-levels (embedded) StructuredTensor's.\n-  FieldName = Union[str, Sequence[str]]\n-\n-  # pylint: enable=invalid-name\n \n   #=============================================================================\n   # Constructor & Factory Methods\n@@ -1190,6 +1187,11 @@ def rank(self):\n       return self._ragged_shape.rank\n \n \n+# We cannot define this inside the class in the usual way because under Python\n+# 3.14 we attempt to interpret it as an ExtensionType field. It would be cleaner\n+# not to define it inside the class at all, but we want to avoid an API break.\n+StructuredTensor.FieldName = FieldName\n+\n # Regular expression used to determine whether a string is a valid field name.\n # Note: we plan to relax (or possibly eliminate) this in the future; you\n # should not rely on the fact that some field names are currently disallowed."
        }
    ],
    "stats": {
        "total": 20,
        "additions": 11,
        "deletions": 9
    }
}