{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Make section headers sticky and add click-to-sync-scroll for diffs.\n\nPiperOrigin-RevId: 797945503",
    "sha": "680b2e084a04c9f7139df73be9d1d3b46a8b2592",
    "files": [
        {
            "sha": "0cd40ff5afd735f5e38536638c0b6abf0b0de4c5",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/render/hlo_gumgraph_html_renderer.cc",
            "status": "modified",
            "additions": 59,
            "deletions": 11,
            "changes": 70,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/680b2e084a04c9f7139df73be9d1d3b46a8b2592/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/680b2e084a04c9f7139df73be9d1d3b46a8b2592/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Frender%2Fhlo_gumgraph_html_renderer.cc?ref=680b2e084a04c9f7139df73be9d1d3b46a8b2592",
            "patch": "@@ -67,7 +67,12 @@ std::string PrintCss() {\n     .section > .header {\n       font-size: 16px;\n       font-weight: bold;\n-      margin-bottom: 5px;\n+      padding: 0.5rem;\n+      background-color: white; /* Add a background to cover content while sticking */\n+      position: sticky;\n+      top: 0;\n+      z-index: 2; /* Ensure it stays above other content */\n+      border-bottom: 1px solid #cccccc;\n     }\n     .section > .content {\n       font-size: 14px;\n@@ -231,6 +236,11 @@ std::string PrintCss() {\n     span.yellow-highlight {\n       background-color: #feefc3;\n     }\n+    span.temp-highlight {\n+      background-color: #a8c7fa;\n+      opacity: 0.7;\n+      transition: background-color 0.5s ease-out;\n+    }\n \n     .hlo-instruction.hidden {\n       display: none;\n@@ -265,16 +275,6 @@ std::string PrintJavascript() {\n       tooltip.textContent = 'Click to copy';\n     }, 2000);\n   }\n-\n-  function TextboxOnScroll(event) {\n-    const textbox = event.target;\n-    const idParts = textbox.id.split('-');\n-    const id = idParts[0];\n-    const isLeft = idParts[1] == 'left';\n-    const sibling = document.getElementById(id + '-' + (isLeft ? 'right' : 'left'));\n-    sibling.scrollTop = textbox.scrollTop;\n-    sibling.scrollLeft = textbox.scrollLeft;\n-  }\n   </script>\n   )html\";\n }\n@@ -286,6 +286,7 @@ std::string PrintJavascriptForHoverEvent() {\n   allSpans.forEach(span => {\n       span.addEventListener('mouseover', handleMouseOver);\n       span.addEventListener('mouseout', handleMouseOut);\n+      span.addEventListener('click', handleSpanClick);\n   });\n   function handleMouseOver(event) {\n       const diffId = event.target.getAttribute('data-diffid');\n@@ -308,6 +309,53 @@ std::string PrintJavascriptForHoverEvent() {\n           relatedSpan.classList.remove('bordered');\n       });\n   }\n+\n+  function handleSpanClick(event) {\n+      const diffId = event.target.getAttribute('data-diffid');\n+      if (!diffId) {\n+          return;\n+      }\n+\n+      const clickedSpan = event.target;\n+      const clickedPre = clickedSpan.closest('.hlo-textbox').querySelector('pre');\n+      if (!clickedPre) return;\n+\n+      const idParts = clickedPre.id.split('-');\n+      const fingerprint = idParts[0];\n+      const isLeft = idParts[1] === 'left';\n+      const siblingPreId = fingerprint + '-' + (isLeft ? 'right' : 'left');\n+      const siblingPre = document.getElementById(siblingPreId);\n+\n+      if (siblingPre) {\n+          const targetSpan = siblingPre.querySelector(`span[data-diffid=\"${diffId}\"]`);\n+          if (targetSpan) {\n+              // Calculate the vertical offset of the clicked span from the top of its visible area.\n+              const clickedSpanViewportOffset = clickedSpan.offsetTop - clickedPre.scrollTop;\n+\n+              // Calculate the percentage of this offset within the clickedPre's visible height.\n+              const percentage = clickedPre.clientHeight > 0 ?\n+                  clickedSpanViewportOffset / clickedPre.clientHeight : 0;\n+\n+              // Calculate the desired offset for the targetSpan within the siblingPre's visible area.\n+              const desiredSiblingViewportOffset = percentage * siblingPre.clientHeight;\n+\n+              // Calculate the new scrollTop for siblingPre to achieve this alignment.\n+              const newScrollTop = targetSpan.offsetTop - desiredSiblingViewportOffset;\n+\n+              // Scroll the siblingPre element smoothly.\n+              siblingPre.scrollTo({\n+                  top: Math.max(0, newScrollTop),\n+                  behavior: 'smooth'\n+              });\n+\n+              // Temporarily highlight the target span\n+              targetSpan.classList.add('temp-highlight');\n+              setTimeout(() => {\n+                  targetSpan.classList.remove('temp-highlight');\n+              }, 1500); // Remove highlight after 1.5 seconds\n+          }\n+      }\n+  }\n   </script>\n   )html\";\n }"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 59,
        "deletions": 11
    }
}