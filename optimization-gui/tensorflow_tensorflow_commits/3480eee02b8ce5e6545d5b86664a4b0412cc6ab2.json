{
    "author": "nvgrw",
    "message": "Add HloModuleFromXlaComputation to HloRunnerAgnosticTestBase.\n\nSometimes it is useful to turn an XlaComputation straight into a HloModule in a\ntest. This is already functionality we basically support, but until now the\ncomputation had to be in the form of an XlaBuilder, which is not always\npractical.\n\nPiperOrigin-RevId: 847856677",
    "sha": "3480eee02b8ce5e6545d5b86664a4b0412cc6ab2",
    "files": [
        {
            "sha": "88057624154aa1d91b8064d040978c457eb09384",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=3480eee02b8ce5e6545d5b86664a4b0412cc6ab2",
            "patch": "@@ -232,7 +232,6 @@ cc_library(\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"@com_google_absl//absl/algorithm:container\",\n-        \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log\",\n@@ -244,7 +243,6 @@ cc_library(\n         \"@com_google_absl//absl/types:span\",\n         \"@com_google_protobuf//:protobuf\",\n         \"@llvm-project//llvm:Support\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n     ],\n )\n "
        },
        {
            "sha": "d0e54a61e4660f7fdbf1cfa7c466a8029d560160",
            "filename": "third_party/xla/xla/tests/hlo_runner_agnostic_test_base.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.cc?ref=3480eee02b8ce5e6545d5b86664a4b0412cc6ab2",
            "patch": "@@ -56,7 +56,6 @@ limitations under the License.\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/util.h\"\n-#include \"tsl/platform/protobuf.h\"\n \n namespace xla {\n \n@@ -108,9 +107,9 @@ HloRunnerAgnosticTestBase::ParseAndReturnVerifiedModule(\n }\n \n absl::StatusOr<std::unique_ptr<HloModule>>\n-HloRunnerAgnosticTestBase::HloModuleFromXlaBuilder(\n-    XlaBuilder* builder, const ExecutionOptions& execution_options) const {\n-  TF_ASSIGN_OR_RETURN(XlaComputation computation, builder->Build());\n+HloRunnerAgnosticTestBase::HloModuleFromXlaComputation(\n+    const XlaComputation& computation,\n+    const ExecutionOptions& execution_options) const {\n   TF_ASSIGN_OR_RETURN(\n       HloModuleConfig module_config,\n       HloModule::CreateModuleConfigFromProto(computation.proto(),\n@@ -123,6 +122,13 @@ HloRunnerAgnosticTestBase::HloModuleFromXlaBuilder(\n   return module;\n }\n \n+absl::StatusOr<std::unique_ptr<HloModule>>\n+HloRunnerAgnosticTestBase::HloModuleFromXlaBuilder(\n+    XlaBuilder* builder, const ExecutionOptions& execution_options) const {\n+  TF_ASSIGN_OR_RETURN(XlaComputation computation, builder->Build());\n+  return HloModuleFromXlaComputation(computation, execution_options);\n+}\n+\n HloComputation*\n HloRunnerAgnosticTestBase::AddEntryComputationAndUpdateEntryComputationLayout(\n     HloModule* const module, std::unique_ptr<HloComputation> computation) {"
        },
        {
            "sha": "bbce2c3037becb1465c68c307758dc83a7b0d57d",
            "filename": "third_party/xla/xla/tests/hlo_runner_agnostic_test_base.h",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3480eee02b8ce5e6545d5b86664a4b0412cc6ab2/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fhlo_runner_agnostic_test_base.h?ref=3480eee02b8ce5e6545d5b86664a4b0412cc6ab2",
            "patch": "@@ -24,7 +24,6 @@ limitations under the License.\n #include <utility>\n #include <vector>\n \n-#include \"absl/base/attributes.h\"\n #include \"absl/base/nullability.h\"\n #include \"absl/functional/any_invocable.h\"\n #include \"absl/log/log.h\"\n@@ -34,6 +33,7 @@ limitations under the License.\n #include \"absl/types/span.h\"\n #include \"xla/error_spec.h\"\n #include \"xla/hlo/builder/xla_builder.h\"\n+#include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n@@ -139,6 +139,12 @@ class HloRunnerAgnosticTestBase : public HloHardwareIndependentTestBase {\n       absl::string_view hlo_text, const HloModuleConfig& config,\n       const HloParserOptions& parser_options = HloParserOptions()) const;\n \n+  // Builds an HLO module from the given XlaComputation using the given\n+  // execution options.\n+  absl::StatusOr<std::unique_ptr<HloModule>> HloModuleFromXlaComputation(\n+      const XlaComputation& computation,\n+      const ExecutionOptions& execution_options) const;\n+\n   // Builds an HLO module from the given XlaBuilder using the given\n   // execution options.\n   absl::StatusOr<std::unique_ptr<HloModule>> HloModuleFromXlaBuilder("
        }
    ],
    "stats": {
        "total": 24,
        "additions": 17,
        "deletions": 7
    }
}