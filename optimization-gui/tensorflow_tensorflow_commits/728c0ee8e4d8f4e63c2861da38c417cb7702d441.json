{
    "author": "mwhittaker",
    "message": "Remove unused `CoordinationService::Config::recoverable_jobs` field.\n\nPiperOrigin-RevId: 846472174",
    "sha": "728c0ee8e4d8f4e63c2861da38c417cb7702d441",
    "files": [
        {
            "sha": "2c676d3b6be4fb248c203ced311a7fdd138c3114",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc?ref=728c0ee8e4d8f4e63c2861da38c417cb7702d441",
            "patch": "@@ -889,8 +889,7 @@ absl::Status CoordinationService::RecordHeartbeat(const CoordinatedTask& task,\n bool CoordinationService::AllTasksAreRecoverable(\n     const std::vector<CoordinatedTask>& tasks) {\n   for (const auto& task : tasks) {\n-    if (!cluster_state_[GetTaskName(task)]->IsRecoverable() &&\n-        !isRecoverableJob(task.job_name())) {\n+    if (!cluster_state_[GetTaskName(task)]->IsRecoverable()) {\n       return false;\n     }\n   }\n@@ -1757,12 +1756,6 @@ void CoordinationService::CompleteShutdownAfterBarrier(\n   }\n }\n \n-bool CoordinationService::isRecoverableJob(\n-    const absl::string_view task_name) const {\n-  return config_.recoverable_jobs.find(task_name) !=\n-         config_.recoverable_jobs.end();\n-}\n-\n void CoordinationService::SendErrorPollingResponseOrFailAllTasks(\n     const absl::Status& error) {\n   CHECK(!error.ok()) << \"SendErrorPollingResponseOrFailAllTasks called with OK \""
        },
        {
            "sha": "6c2ddb1b4cda1bf3ae7a018e3d58205bbec3f33c",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service.h",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h?ref=728c0ee8e4d8f4e63c2861da38c417cb7702d441",
            "patch": "@@ -89,12 +89,6 @@ class CoordinationService {\n     // worker can disconnect individually.\n     absl::Duration shutdown_barrier_timeout = absl::ZeroDuration();\n \n-    // The list of jobs which are recoverable. If a task in this list fails,\n-    // it will not propagate error to other tasks.\n-    // If empty, no jobs will be recoverable and every task failure will cause\n-    // error propagation to other tasks.\n-    absl::flat_hash_set<std::string> recoverable_jobs;\n-\n     // If a task restarts with a new incarnation, we may allow it to reconnect\n     // silently. This is useful when we know that a task can immediately resume\n     // work upon re-connecting to the service."
        },
        {
            "sha": "ee224bc5bebb44d370eaab6046afa45a089a32ed",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/728c0ee8e4d8f4e63c2861da38c417cb7702d441/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc?ref=728c0ee8e4d8f4e63c2861da38c417cb7702d441",
            "patch": "@@ -224,7 +224,8 @@ class CoordinateTwoTasksTest : public ::testing::Test {\n         GetCoordinationServiceConfig(/*num_tasks=*/2);\n     config.heartbeat_timeout = kHeartbeatTimeout;\n     if (set_worker_job_recoverable) {\n-      config.recoverable_jobs.insert(\"worker\");\n+      task_0_.set_recoverable(true);\n+      task_1_.set_recoverable(true);\n     }\n     if (enable_shutdown_barrier) {\n       config.shutdown_barrier_timeout = kShutdownBarrierTimeout;\n@@ -1912,16 +1913,17 @@ TEST_F(CoordinateTwoTasksTest,\n TEST(CoordinationServiceTest, RecoverableAndNonRecoverableTasks) {\n   CoordinationService::Config config;\n   // Workers are recoverable, chief is not.\n-  config.recoverable_jobs.insert(\"worker\");\n   CoordinatedTask chief;\n   chief.set_job_name(\"chief\");\n   chief.set_task_id(0);\n   CoordinatedTask task_0;\n   task_0.set_job_name(\"worker\");\n   task_0.set_task_id(0);\n+  task_0.set_recoverable(true);\n   CoordinatedTask task_1;\n   task_1.set_job_name(\"worker\");\n   task_1.set_task_id(1);\n+  task_1.set_recoverable(true);\n   CoordinatedJob chief_job;\n   chief_job.set_name(\"chief\");\n   chief_job.set_num_tasks(1);"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 5,
        "deletions": 16
    }
}