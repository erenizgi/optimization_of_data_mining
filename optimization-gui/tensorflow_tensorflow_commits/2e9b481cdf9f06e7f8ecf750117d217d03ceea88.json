{
    "author": "ybaturina",
    "message": "Add JAX Windows presubmit job to XLA repo.\n\nPiperOrigin-RevId: 833864469",
    "sha": "2e9b481cdf9f06e7f8ecf750117d217d03ceea88",
    "files": [
        {
            "sha": "f0df7e75993c4542bde995391684345e6c7fbe34",
            "filename": "third_party/xla/.github/workflows/ci.yml",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml?ref=2e9b481cdf9f06e7f8ecf750117d217d03ceea88",
            "patch": "@@ -78,6 +78,12 @@ jobs:\n             name: \"JAX Linux x86 CPU\",\n             repo: \"jax-ml/jax\",\n           },\n+          {\n+            pool: \"windows-x86-n2-16\",\n+            container: null,\n+            name: \"JAX Windows x86 CPU\",\n+            repo: \"jax-ml/jax\",\n+          },\n           {\n             pool: \"linux-x86-g2-16-l4-1gpu\",\n             container: \"gcr.io/tensorflow-sigs/build:latest-python3.11\",\n@@ -121,4 +127,9 @@ jobs:\n           halt-dispatch-input: ${{ inputs.halt-for-connection }}\n       - name: \"Run build.py\"\n         working-directory: ${{ matrix.job_info.repo }}\n-        run: $GITHUB_WORKSPACE/openxla/xla/build_tools/ci/build.py --build=\"${{ matrix.job_info.name }}_github_actions\"\n+        run: |\n+          if [[ \"${{ matrix.job_info.pool }}\" == *windows* ]]; then\n+            python $GITHUB_WORKSPACE\\\\openxla\\\\xla\\\\build_tools\\\\ci\\\\build.py --build=\"${{ matrix.job_info.name }}_github_actions\"\n+          else\n+            $GITHUB_WORKSPACE/openxla/xla/build_tools/ci/build.py --build=\"${{ matrix.job_info.name }}_github_actions\"\n+          fi"
        },
        {
            "sha": "17af3bf0d9280ecee30493c3f6270e484bb49b82",
            "filename": "third_party/xla/build_tools/ci/build.py",
            "status": "modified",
            "additions": 33,
            "deletions": 2,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py?ref=2e9b481cdf9f06e7f8ecf750117d217d03ceea88",
            "patch": "@@ -126,6 +126,7 @@ class BuildType(enum.Enum):\n   XLA_MACOS_ARM64_CPU_KOKORO = enum.auto()\n \n   JAX_LINUX_X86_CPU_GITHUB_ACTIONS = enum.auto()\n+  JAX_WINDOWS_X86_CPU_GITHUB_ACTIONS = enum.auto()\n   JAX_LINUX_X86_GPU_L4_GITHUB_ACTIONS = enum.auto()\n \n   TENSORFLOW_LINUX_X86_CPU_GITHUB_ACTIONS = enum.auto()\n@@ -159,6 +160,7 @@ class Build:\n   repo_env: Dict[str, Any] = dataclasses.field(default_factory=dict)\n   override_repository: Dict[str, str] = dataclasses.field(default_factory=dict)\n   options: Dict[str, Any] = dataclasses.field(default_factory=dict)\n+  startup_options: Dict[str, Any] = dataclasses.field(default_factory=dict)\n   extra_setup_commands: Tuple[List[str], ...] = ()\n \n   def __post_init__(self):\n@@ -187,6 +189,7 @@ def bazel_command(\n     Returns: List of command line arguments\n     \"\"\"\n     options = _dict_to_cli_options(self.options)\n+    startup_options = _dict_to_cli_options(self.startup_options)\n     configs = [f\"--config={config}\" for config in self.configs]\n     build_tag_filters = (\n         f\"--build_tag_filters={','.join(self.build_tag_filters)}\"\n@@ -211,7 +214,14 @@ def bazel_command(\n         + options\n         + list(extra_options)\n     )\n-    return [\"bazel\", subcommand, *all_options, \"--\", *self.target_patterns]\n+    return [\n+        \"bazel\",\n+        *startup_options,\n+        subcommand,\n+        *all_options,\n+        \"--\",\n+        *self.target_patterns,\n+    ]\n \n   def commands(self) -> List[List[str]]:\n     \"\"\"Returns list of commands for a build.\"\"\"\n@@ -228,7 +238,8 @@ def commands(self) -> List[List[str]]:\n         self.type_ == BuildType.XLA_MACOS_X86_CPU_KOKORO\n         or self.type_ == BuildType.XLA_MACOS_ARM64_CPU_KOKORO\n     )\n-    if not macos_build:\n+    windows_build = (self.type_ == BuildType.JAX_WINDOWS_X86_CPU_GITHUB_ACTIONS)\n+    if not (macos_build or windows_build):\n       cmds.append(\n           retry(\n               self.bazel_command(\n@@ -707,6 +718,26 @@ def nvidia_gpu_build_with_compute_capability(\n     repo_env={\"HERMETIC_PYTHON_VERSION\": \"3.12\"},\n )\n \n+Build(\n+    type_=BuildType.JAX_WINDOWS_X86_CPU_GITHUB_ACTIONS,\n+    repo=\"google/jax\",\n+    configs=(\"rbe_windows_amd64\",),\n+    target_patterns=(\"//tests:cpu_tests\", \"//tests:backend_independent_tests\"),\n+    test_env=dict(\n+        JAX_NUM_GENERATED_CASES=25,\n+        JAX_SKIP_SLOW_TESTS=1,\n+    ),\n+    override_repository=dict(\n+        xla=f\"{_GITHUB_WORKSPACE}\\\\openxla\\\\xla\",\n+    ),\n+    options={**_DEFAULT_BAZEL_OPTIONS, \"build_runfile_links\": False},\n+    repo_env={\"HERMETIC_PYTHON_VERSION\": \"3.12\"},\n+    subcommand=\"build\",\n+    startup_options={\n+        \"output_base\": f\"{_GITHUB_WORKSPACE}\\\\bazel_output_base\",\n+    },\n+)\n+\n Build(\n     type_=BuildType.JAX_LINUX_X86_GPU_L4_GITHUB_ACTIONS,\n     repo=\"google/jax\","
        },
        {
            "sha": "0b160bfa3ef2e8fe818b3f7f1ab09d5e7fe8d26c",
            "filename": "third_party/xla/build_tools/ci/golden_commands.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e9b481cdf9f06e7f8ecf750117d217d03ceea88/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt?ref=2e9b481cdf9f06e7f8ecf750117d217d03ceea88",
            "patch": "@@ -9,6 +9,10 @@ parallel --ungroup --retries 3 --delay 15 --nonall -- bazel build --build_tag_fi\n bazel test --build_tag_filters=-multiaccelerator --test_tag_filters=-multiaccelerator --config=rbe_linux_x86_64_cuda --test_env=JAX_SKIP_SLOW_TESTS=1 --test_env=TF_CPP_MIN_LOG_LEVEL=0 --test_env=JAX_EXCLUDE_TEST_TARGETS=PmapTest.testSizeOverflow --repo_env=HERMETIC_PYTHON_VERSION=3.11 --override_repository=xla=$GITHUB_WORKSPACE/openxla/xla --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async -- //tests:gpu_tests //tests:backend_independent_tests\n bazel analyze-profile profile.json.gz\n # END BuildType.JAX_LINUX_X86_GPU_L4_GITHUB_ACTIONS\n+# BEGIN BuildType.JAX_WINDOWS_X86_CPU_GITHUB_ACTIONS\n+bazel --output_base=$GITHUB_WORKSPACE\\bazel_output_base build --build_tag_filters= --test_tag_filters= --config=rbe_windows_amd64 --test_env=JAX_NUM_GENERATED_CASES=25 --test_env=JAX_SKIP_SLOW_TESTS=1 --repo_env=HERMETIC_PYTHON_VERSION=3.12 --override_repository=xla=$GITHUB_WORKSPACE\\openxla\\xla --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --build_runfile_links=False -- //tests:cpu_tests //tests:backend_independent_tests\n+bazel analyze-profile profile.json.gz\n+# END BuildType.JAX_WINDOWS_X86_CPU_GITHUB_ACTIONS\n # BEGIN BuildType.TENSORFLOW_LINUX_X86_CPU_GITHUB_ACTIONS\n find $GITHUB_WORKSPACE/openxla/xla -type f -exec sed -i s/@local_xla/@local_xla/g {} +\n find $GITHUB_WORKSPACE/openxla/xla -type f -exec sed -i s/@local_tsl/@local_tsl/g {} +"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 49,
        "deletions": 3
    }
}