{
    "author": "allanrenucci",
    "message": "[NFC] Simplifications to `CommandBufferConversionPass`.\n\nPiperOrigin-RevId: 818763449",
    "sha": "da9375fa7423de4759e54a2fd33d60b9cfef7bdd",
    "files": [
        {
            "sha": "d4c47e96cee302c6909e1d2a359d2230718aec16",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=da9375fa7423de4759e54a2fd33d60b9cfef7bdd",
            "patch": "@@ -2725,6 +2725,7 @@ cc_library(\n         \"//xla/stream_executor/cuda:cuda_compute_capability\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n+        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n         \"@com_google_absl//absl/functional:overload\","
        },
        {
            "sha": "32eb2233c94acbe4c0f93f24886ba53c7503e4cb",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_conversion_pass.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 17,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.cc?ref=da9375fa7423de4759e54a2fd33d60b9cfef7bdd",
            "patch": "@@ -26,11 +26,13 @@ limitations under the License.\n #include <variant>\n #include <vector>\n \n+#include \"absl/algorithm/container.h\"\n #include \"absl/container/flat_hash_set.h\"\n #include \"absl/functional/overload.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/types/span.h\"\n #include \"xla/backends/gpu/runtime/command_buffer_cmd.h\"\n@@ -56,22 +58,10 @@ limitations under the License.\n \n namespace xla {\n namespace gpu {\n+namespace {\n \n using CommandBufferConfig = CommandBufferConversionPass::CommandBufferConfig;\n \n-std::string CommandBufferConversionPass::CommandBufferConfig::ToString() const {\n-  std::vector<std::string> cmd_names;\n-  cmd_names.reserve(enabled_commands.size());\n-  for (auto cmd : enabled_commands) {\n-    cmd_names.push_back(DebugOptions::CommandBufferCmdType_Name(cmd));\n-  }\n-  std::string out;\n-  out += \"enabled_commands: [\" + absl::StrJoin(cmd_names, \", \") + \"]\";\n-  return out;\n-}\n-\n-namespace {\n-\n CommandBufferConfig GetCommandBufferConfig(\n     const DebugOptions& debug_options,\n     const se::DeviceDescription& device_info) {\n@@ -414,6 +404,15 @@ absl::Status FlushCommandBuffer(\n \n }  // namespace\n \n+std::string CommandBufferConversionPass::CommandBufferConfig::ToString() const {\n+  auto formatter = [](std::string* out,\n+                      DebugOptions::CommandBufferCmdType cmd) {\n+    absl::StrAppend(out, DebugOptions::CommandBufferCmdType_Name(cmd));\n+  };\n+  std::string cmd_names = absl::StrJoin(enabled_commands, \", \", formatter);\n+  return absl::StrCat(\"enabled_commands: [\", cmd_names, \"]\");\n+}\n+\n absl::StatusOr<bool> CommandBufferConversionPass::Run(\n     SequentialThunk* root_thunk, const DebugOptions& debug_options,\n     const se::DeviceDescription& device_info,\n@@ -455,11 +454,8 @@ absl::StatusOr<bool> CommandBufferConversionPass::Run(\n       if (!region.empty()) {\n         // If a valid region is found, add the whole region to the current\n         // sequence and continue processing.\n-        current_command_buffer_thunks.insert(\n-            current_command_buffer_thunks.end(),\n-            std::make_move_iterator(region.begin()),\n-            std::make_move_iterator(region.end()));\n         i += region.size() - 1;\n+        absl::c_move(region, std::back_inserter(current_command_buffer_thunks));\n         continue;\n       }\n     } else if (IsConvertible(*thunk.get(), config) && !thunk->IsAsyncDone()) {"
        },
        {
            "sha": "1a061aa404967efb63a504a1029cfcfe904ed7f3",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_conversion_pass.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/da9375fa7423de4759e54a2fd33d60b9cfef7bdd/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_conversion_pass.h?ref=da9375fa7423de4759e54a2fd33d60b9cfef7bdd",
            "patch": "@@ -32,7 +32,7 @@ namespace gpu {\n // Converts compatible sequences of Thunks into CommandBufferThunks.\n class CommandBufferConversionPass : public ThunkPassInterface {\n  public:\n-  CommandBufferConversionPass(absl::string_view module_name = \"\")\n+  explicit CommandBufferConversionPass(absl::string_view module_name = \"\")\n       : module_name_(module_name) {}\n \n   absl::string_view name() const override {"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 15,
        "deletions": 18
    }
}