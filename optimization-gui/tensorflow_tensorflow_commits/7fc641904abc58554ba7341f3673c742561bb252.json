{
    "author": "zacmustin",
    "message": "Optimize `Convert2DCBuffersToCppBuffers`.\n\nThis function iterates through the two-dimensional `c_lists` of buffers and retrieving the C++ buffers. Now we make a time saving by pre-allocating the inner vectors to their final size instead of dynamically growing them with `push_back`.\n\nPiperOrigin-RevId: 813107171",
    "sha": "7fc641904abc58554ba7341f3673c742561bb252",
    "files": [
        {
            "sha": "cd4cf23ececb07f17b74a31fe53593719904f696",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_wrapper_impl.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7fc641904abc58554ba7341f3673c742561bb252/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7fc641904abc58554ba7341f3673c742561bb252/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc?ref=7fc641904abc58554ba7341f3673c742561bb252",
            "patch": "@@ -1772,10 +1772,12 @@ static std::vector<std::vector<xla::PjRtBuffer*>> Convert2DCBuffersToCppBuffers(\n   std::vector<std::vector<xla::PjRtBuffer*>> cpp_lists;\n   cpp_lists.reserve(outer_size);\n   for (int i = 0; i < outer_size; ++i) {\n-    auto& cpp_list = cpp_lists.emplace_back();\n-    cpp_list.reserve(inner_size);\n+    // Since this function gets called very frequently, we initialize the inner\n+    // vector with the correct size to avoid resizing and maximize performance.\n+    cpp_lists.emplace_back(inner_size);\n+    auto& inner_list = cpp_lists.back();\n     for (int j = 0; j < inner_size; ++j) {\n-      cpp_list.push_back(c_lists[i][j]->buffer.get());\n+      inner_list[j] = c_lists[i][j]->buffer.get();\n     }\n   }\n   return cpp_lists;"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 5,
        "deletions": 3
    }
}