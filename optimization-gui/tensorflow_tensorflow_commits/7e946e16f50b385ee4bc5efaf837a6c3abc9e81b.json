{
    "author": "blakehechtman",
    "message": "[XLA] The slice based simplification seems to be imprecise somehow. bail out of\nthe transformation instead.\n\nPiperOrigin-RevId: 845276118",
    "sha": "7e946e16f50b385ee4bc5efaf837a6c3abc9e81b",
    "files": [
        {
            "sha": "f56bf656b9d72de2a063f9f7cfd1869afb74b230",
            "filename": "third_party/xla/xla/service/all_gather_simplifier.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7e946e16f50b385ee4bc5efaf837a6c3abc9e81b/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7e946e16f50b385ee4bc5efaf837a6c3abc9e81b/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier.cc?ref=7e946e16f50b385ee4bc5efaf837a6c3abc9e81b",
            "patch": "@@ -66,11 +66,7 @@ absl::StatusOr<bool> AllGatherSimplifier::RunImpl(\n           HloInstruction* ds = all_gather->users().front();\n           HloInstruction* ag_operand = all_gather->mutable_operand(0);\n           if (!ShapeUtil::Compatible(ds->shape(), ag_operand->shape())) {\n-            ag_operand = ag_operand->AddInstruction(HloInstruction::CreateSlice(\n-                ds->shape(), ag_operand,\n-                DimensionVector(ds->shape().dimensions().size(), 0),\n-                ds->shape().dimensions(),\n-                DimensionVector(ds->shape().dimensions().size(), 1)));\n+            continue;\n           }\n           changed = true;\n           TF_RETURN_IF_ERROR(ds->ReplaceAllUsesWith(ag_operand));"
        },
        {
            "sha": "418fa8f91347634c2c7ceca4d9e9cd71f5c42ad0",
            "filename": "third_party/xla/xla/service/all_gather_simplifier_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7e946e16f50b385ee4bc5efaf837a6c3abc9e81b/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7e946e16f50b385ee4bc5efaf837a6c3abc9e81b/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fall_gather_simplifier_test.cc?ref=7e946e16f50b385ee4bc5efaf837a6c3abc9e81b",
            "patch": "@@ -80,9 +80,7 @@ test {\n   AllGatherSimplifier ag_simplifier;\n   auto result = ag_simplifier.Run(module.get());\n   ASSERT_TRUE(result.ok()) << result.status();\n-  ASSERT_TRUE(result.value());\n-  EXPECT_THAT(module->entry_computation()->root_instruction(),\n-              GmockMatch(m::Slice(m::Parameter(0))));\n+  ASSERT_FALSE(result.value());\n }\n \n }  // namespace"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 2,
        "deletions": 8
    }
}