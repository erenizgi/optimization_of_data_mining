{
    "author": "yangustc07",
    "message": "Add a unit test for registering the same dataset multiple times.\n\nPiperOrigin-RevId: 811087820",
    "sha": "5763b568a00850f48a946a30b73c9c984ad908aa",
    "files": [
        {
            "sha": "02f370121c7ed5f55e0c7bc8a4431e998d7a8536",
            "filename": "tensorflow/python/data/experimental/kernel_tests/service/dynamic_sharding_test.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5763b568a00850f48a946a30b73c9c984ad908aa/tensorflow%2Fpython%2Fdata%2Fexperimental%2Fkernel_tests%2Fservice%2Fdynamic_sharding_test.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5763b568a00850f48a946a30b73c9c984ad908aa/tensorflow%2Fpython%2Fdata%2Fexperimental%2Fkernel_tests%2Fservice%2Fdynamic_sharding_test.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fdata%2Fexperimental%2Fkernel_tests%2Fservice%2Fdynamic_sharding_test.py?ref=5763b568a00850f48a946a30b73c9c984ad908aa",
            "patch": "@@ -415,6 +415,35 @@ def flat_map_fn(_):\n     self.assertDatasetProduces(\n         ds, [b\"a\", b\"b\", b\"c\"] * 50, assert_items_equal=True)\n \n+  @combinations.generate(test_base.default_test_combinations())\n+  def testMultipleRegistration(self):\n+    cluster = data_service_test_base.TestCluster(num_workers=2)\n+    dataset = dataset_ops.Dataset.range(100)\n+    dataset1 = dataset.apply(\n+        data_service_ops.distribute(\n+            data_service_ops.ShardingPolicy.DYNAMIC,\n+            cluster.dispatcher_address(),\n+            job_name=\"shared_job\"\n+        )\n+    )\n+    dataset2 = dataset.apply(\n+        data_service_ops.distribute(\n+            data_service_ops.ShardingPolicy.DYNAMIC,\n+            cluster.dispatcher_address(),\n+            job_name=\"shared_job\"\n+        )\n+    )\n+\n+    output = []\n+    iter1 = self.getNext(dataset1)\n+    iter2 = self.getNext(dataset2)\n+    for _ in range(5):\n+      output.append(self.evaluate(iter1()))\n+      output.append(self.evaluate(iter2()))\n+    output.extend(self.getIteratorOutput(iter1))\n+    output.extend(self.getIteratorOutput(iter2))\n+    self.assertEqual(sorted(output), list(range(100)))\n+\n \n class DynamicShardingFilesTest(data_service_test_base.TestBase,\n                                tf_record_test_base.TFRecordTestBase,"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 29,
        "deletions": 0
    }
}