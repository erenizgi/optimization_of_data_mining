{
    "author": "majnemer",
    "message": "[TSL] Replace `tsl::StringPiece` with `absl::string_view`.\n\nThis change updates code to directly use `absl::string_view` instead of the aliased `tsl::StringPiece`, and adjusts build dependencies accordingly. The `tsl/platform/stringpiece.h` header is updated to guide users to include `absl/strings/string_view.h` directly.\n\nPiperOrigin-RevId: 829689298",
    "sha": "68236ced376b1553cb6593b9a9a18d2418c0b3c5",
    "files": [
        {
            "sha": "8cb3b304b23695daaeb7f517834548012df4db6c",
            "filename": "tensorflow/python/_pywrap_tensorflow.def",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2F_pywrap_tensorflow.def?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -111,6 +111,7 @@ EXPORTS\n   ??0SignatureDef@tensorflow@@IEAA@PEAVArena@protobuf@google@@@Z\n   ??0SimpleFieldComparator@util@protobuf@google@@QEAA@XZ\n   ??0SingleMachine@grappler@tensorflow@@QEAA@HHH@Z\n+  ??0SnappyOutputBuffer@io@tsl@@QEAA@PEAVWritableFile@2@HH@Z\n   ??0SourceMgr@llvm@@QEAA@XZ\n   ??0SourceMgrDiagnosticHandler@mlir@@QEAA@AEAVSourceMgr@llvm@@PEAVMLIRContext@1@$$QEAV?$unique_function@$$A6A_NVLocation@mlir@@@Z@3@@Z\n   ??0SparseCoreLayoutStacker@tpu@tensorflow@@QEAA@H_NH@Z"
        },
        {
            "sha": "e2c4d41b4f3fca71733441ab085602842acc2af6",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -1086,10 +1086,9 @@ tsl_cc_test(\n     srcs = [\"path_test.cc\"],\n     deps = [\n         \":path\",\n-        \":stringpiece\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@local_xla//xla/tsl/platform:env\",\n-        \"@local_xla//xla/tsl/platform:env_impl\",\n         \"@local_xla//xla/tsl/platform:test\",\n     ],\n )"
        },
        {
            "sha": "4fa6cff629ef2fb85856abd0274d050f52434f6d",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/path_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fpath_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fpath_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fpath_test.cc?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -17,9 +17,9 @@ limitations under the License.\n \n #include <string>\n \n+#include \"absl/strings/string_view.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/test.h\"\n-#include \"tsl/platform/stringpiece.h\"\n \n namespace tsl {\n namespace io {\n@@ -106,8 +106,8 @@ TEST(PathTest, CleanPath) {\n \n #define EXPECT_PARSE_URI(uri, scheme, host, path)  \\\n   do {                                             \\\n-    StringPiece u(uri);                            \\\n-    StringPiece s, h, p;                           \\\n+    absl::string_view u(uri);                      \\\n+    absl::string_view s, h, p;                     \\\n     ParseURI(u, &s, &h, &p);                       \\\n     EXPECT_EQ(scheme, s);                          \\\n     EXPECT_EQ(host, h);                            \\"
        },
        {
            "sha": "c885f477e0a3908091ad346014cc83a59499a676",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/stringpiece.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringpiece.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringpiece.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringpiece.h?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -26,8 +26,10 @@ limitations under the License.\n #ifndef TENSORFLOW_TSL_PLATFORM_STRINGPIECE_H_\n #define TENSORFLOW_TSL_PLATFORM_STRINGPIECE_H_\n \n+// IWYU pragma: private, include \"absl/strings/string_view.h\"\n+\n #include \"absl/base/macros.h\"\n-#include \"absl/strings/string_view.h\"  // IWYU pragma: export\n+#include \"absl/strings/string_view.h\"\n \n namespace tsl {\n "
        },
        {
            "sha": "42c1d54909cafc3e1ea2a62cce87afe5f6bad618",
            "filename": "third_party/xla/xla/tsl/platform/windows/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2FBUILD?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -58,6 +58,7 @@ cc_library(\n         \"//xla/tsl/protobuf:error_codes_proto_impl_cc\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/functional:any_invocable\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/time\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform\","
        },
        {
            "sha": "275f72c817906c2cb037f33e93339605613ce96e",
            "filename": "third_party/xla/xla/tsl/platform/windows/windows_file_system.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -28,6 +28,7 @@ limitations under the License.\n #include <time.h>\n \n #include \"absl/status/status.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/file_system_helper.h\"\n@@ -118,12 +119,12 @@ class WindowsRandomAccessFile : public RandomAccessFile {\n     }\n   }\n \n-  Status Name(StringPiece* result) const override {\n+  Status Name(absl::string_view* result) const override {\n     *result = filename_;\n     return absl::OkStatus();\n   }\n \n-  Status Read(uint64 offset, size_t n, StringPiece* result,\n+  Status Read(uint64 offset, size_t n, absl::string_view* result,\n               char* scratch) const override {\n     Status s;\n     char* dst = scratch;\n@@ -148,7 +149,7 @@ class WindowsRandomAccessFile : public RandomAccessFile {\n         s = IOError(filename_, errno);\n       }\n     }\n-    *result = StringPiece(scratch, dst - scratch);\n+    *result = absl::string_view(scratch, dst - scratch);\n     return s;\n   }\n \n@@ -169,7 +170,7 @@ class WindowsRandomAccessFile : public RandomAccessFile {\n                                        \" bytes for file reading.\");\n     }\n \n-    StringPiece tmp;\n+    absl::string_view tmp;\n     Status s = Read(offset, n, &tmp, scratch);\n \n     absl::Cord tmp_cord = absl::MakeCordFromExternal(\n@@ -196,7 +197,7 @@ class WindowsWritableFile : public WritableFile {\n     }\n   }\n \n-  Status Append(StringPiece data) override {\n+  Status Append(absl::string_view data) override {\n     DWORD bytes_written = 0;\n     DWORD data_size = static_cast<DWORD>(data.size());\n     BOOL write_result =\n@@ -267,7 +268,7 @@ class WindowsWritableFile : public WritableFile {\n     return absl::OkStatus();\n   }\n \n-  Status Name(StringPiece* result) const override {\n+  Status Name(absl::string_view* result) const override {\n     *result = filename_;\n     return absl::OkStatus();\n   }\n@@ -559,7 +560,7 @@ Status WindowsFileSystem::GetChildren(const string& dir,\n \n   do {\n     string file_name = WideCharToUtf8(find_data.cFileName);\n-    const StringPiece basename = file_name;\n+    const absl::string_view basename = file_name;\n     if (basename != \".\" && basename != \"..\") {\n       result->push_back(file_name);\n     }"
        },
        {
            "sha": "75fc104940368f3802d67c830fb5b0391c1f6abd",
            "filename": "third_party/xla/xla/tsl/platform/windows/windows_file_system.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/68236ced376b1553cb6593b9a9a18d2418c0b3c5/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.h?ref=68236ced376b1553cb6593b9a9a18d2418c0b3c5",
            "patch": "@@ -16,6 +16,7 @@ limitations under the License.\n #ifndef XLA_TSL_PLATFORM_WINDOWS_WINDOWS_FILE_SYSTEM_H_\n #define XLA_TSL_PLATFORM_WINDOWS_WINDOWS_FILE_SYSTEM_H_\n \n+#include \"absl/strings/string_view.h\"\n #include \"xla/tsl/platform/file_system.h\"\n #include \"tsl/platform/path.h\"\n #include \"tsl/platform/platform.h\"\n@@ -88,7 +89,7 @@ class WindowsFileSystem : public FileSystem {\n class LocalWinFileSystem : public WindowsFileSystem {\n  public:\n   string TranslateName(const string& name) const override {\n-    StringPiece scheme, host, path;\n+    absl::string_view scheme, host, path;\n     io::ParseURI(name, &scheme, &host, &path);\n     return string(path);\n   }"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 19,
        "deletions": 14
    }
}