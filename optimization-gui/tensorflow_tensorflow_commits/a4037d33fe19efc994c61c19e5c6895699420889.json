{
    "author": "felixwqp",
    "message": "Allow the customized thread manager in `UnboundedWorkQueue` with high stack size limit.\n\nPiperOrigin-RevId: 811174533",
    "sha": "a4037d33fe19efc994c61c19e5c6895699420889",
    "files": [
        {
            "sha": "a716ca86645d0127b69e895e160a1ae17fc2b6f5",
            "filename": "tensorflow/core/common_runtime/collective_executor_mgr.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4037d33fe19efc994c61c19e5c6895699420889/tensorflow%2Fcore%2Fcommon_runtime%2Fcollective_executor_mgr.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4037d33fe19efc994c61c19e5c6895699420889/tensorflow%2Fcore%2Fcommon_runtime%2Fcollective_executor_mgr.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Fcollective_executor_mgr.cc?ref=a4037d33fe19efc994c61c19e5c6895699420889",
            "patch": "@@ -14,6 +14,8 @@ limitations under the License.\n ==============================================================================*/\n #include \"tensorflow/core/common_runtime/collective_executor_mgr.h\"\n \n+#include <cstddef>\n+\n #include \"absl/memory/memory.h\"\n #include \"tensorflow/core/common_runtime/base_collective_executor.h\"\n #include \"tensorflow/core/common_runtime/build_graph_options.h\"\n@@ -37,8 +39,12 @@ CollectiveExecutorMgr::CollectiveExecutorMgr(\n       gpu_ring_order_(\n           config.gpu_options().experimental().collective_ring_order()),\n       nccl_communicator_(std::move(nccl_communicator)),\n-      work_queue_(std::make_shared<UnboundedWorkQueue>(Env::Default(),\n-                                                       \"collective_ops\")) {}\n+      work_queue_(std::make_shared<UnboundedWorkQueue>(\n+          Env::Default(), \"collective_ops\",\n+          // Use a 8MB stack size for collective operations. The default stack\n+          // size is 64KB in thread_manager.cc is not enough for NCCL\n+          // operations, b/446237508.\n+          ThreadOptions{.stack_size = 8 * 1024 * 1024})) {}\n \n CollectiveExecutorMgr::~CollectiveExecutorMgr() {\n   for (auto iter : executor_table_) {"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 8,
        "deletions": 2
    }
}