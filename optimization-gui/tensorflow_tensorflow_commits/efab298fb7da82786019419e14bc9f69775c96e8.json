{
    "author": "majnemer",
    "message": "Refactor: Use `absl::ascii_*` functions and improve string parsing.\n\nThis change replaces manual character range checks (e.g., `c >= '0' && c <= '9'`) with more idiomatic and potentially safer `absl::ascii_isdigit`, `absl::ascii_isalpha`, and `absl::ascii_isalnum` functions. Additionally, it refactors `ParseTensorName` to use `absl::string_view` methods and `tsl::str_util::ConsumeLeadingDigits`, and updates `ConsumeLeadingDigits` to use `std::from_chars`. The unused `Strnlen` function is also removed.\n\nPiperOrigin-RevId: 829600440",
    "sha": "efab298fb7da82786019419e14bc9f69775c96e8",
    "files": [
        {
            "sha": "eb5d86768b6fba5309e0fff12347b228c4b4af21",
            "filename": "tensorflow/core/framework/ops_util.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fframework%2Fops_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fframework%2Fops_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2Fops_util.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -13,11 +13,13 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include \"tensorflow/core/framework/ops_util.h\"\n+\n #include <algorithm>\n #include <cmath>\n \n+#include \"absl/strings/ascii.h\"\n #include \"tensorflow/core/framework/attr_value.pb.h\"\n-#include \"tensorflow/core/framework/ops_util.h\"\n #include \"tensorflow/core/lib/core/errors.h\"\n #include \"tensorflow/core/lib/strings/str_util.h\"\n #include \"tensorflow/core/util/padding.h\"\n@@ -66,8 +68,7 @@ string SanitizeThreadSuffix(string suffix) {\n   string clean;\n   for (int i = 0; i < suffix.size(); ++i) {\n     const char ch = suffix[i];\n-    if ((ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z') ||\n-        (ch >= '0' && ch <= '9') || ch == '_' || ch == '-') {\n+    if (absl::ascii_isalnum(ch) || ch == '_' || ch == '-') {\n       clean += ch;\n     } else {\n       clean += '_';"
        },
        {
            "sha": "901273fb7e07756a2fa497ca57eb144c8255de87",
            "filename": "tensorflow/core/graph/tensor_id.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 27,
            "changes": 45,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fgraph%2Ftensor_id.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fgraph%2Ftensor_id.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fgraph%2Ftensor_id.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -15,21 +15,21 @@ limitations under the License.\n \n #include \"tensorflow/core/graph/tensor_id.h\"\n \n+#include <cstddef>\n+#include <cstdint>\n #include <string>\n \n-#include \"tensorflow/core/lib/core/stringpiece.h\"\n-#include \"tensorflow/core/lib/strings/str_util.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/strings/strip.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n+#include \"tensorflow/core/platform/str_util.h\"\n \n namespace tensorflow {\n \n TensorId::TensorId(const SafeTensorId& id) : TensorId(id.first, id.second) {}\n \n SafeTensorId::SafeTensorId(const TensorId& id)\n-    : SafeTensorId(string(id.first), id.second) {}\n-\n-TensorId ParseTensorName(const string& name) {\n-  return ParseTensorName(absl::string_view(name.data(), name.size()));\n-}\n+    : SafeTensorId(std::string(id.first), id.second) {}\n \n TensorId ParseTensorName(absl::string_view name) {\n   // Parse either a name, ^name, or name:digits.  To do so, we go backwards from\n@@ -38,28 +38,19 @@ TensorId ParseTensorName(absl::string_view name) {\n   // see if the name starts with '^', indicating a control edge. If we find\n   // neither ':' nor '^' characters, the output index is implicitly 0, and the\n   // whole name string forms the first part of the tensor name.\n-  const char* base = name.data();\n-  const char* p = base + name.size() - 1;\n-  unsigned int index = 0;\n-  unsigned int mul = 1;\n-  while (p > base && (*p >= '0' && *p <= '9')) {\n-    index += ((*p - '0') * mul);\n-    mul *= 10;\n-    p--;\n+  size_t colon_pos = name.rfind(':');\n+  if (colon_pos != absl::string_view::npos) {\n+    absl::string_view prefix = name.substr(0, colon_pos);\n+    absl::string_view suffix = name.substr(colon_pos + 1);\n+    uint64_t index;\n+    if (str_util::ConsumeLeadingDigits(&suffix, &index) && suffix.empty()) {\n+      return TensorId(prefix, index);\n+    }\n   }\n-  TensorId id;\n-  if (p > base && *p == ':' && mul > 1) {\n-    id.first = absl::string_view(base, p - base);\n-    id.second = index;\n-  } else if (absl::StartsWith(name, \"^\")) {\n-    // Control edge\n-    id.first = absl::string_view(base + 1);\n-    id.second = Graph::kControlSlot;\n-  } else {\n-    id.first = name;\n-    id.second = 0;\n+  if (absl::ConsumePrefix(&name, \"^\")) {\n+    return TensorId(name, Graph::kControlSlot);\n   }\n-  return id;\n+  return TensorId(name, 0);\n }\n \n bool IsTensorIdControl(const TensorId& tensor_id) {"
        },
        {
            "sha": "31b30fa14af4633929ec946b3de1cf771e9a87f9",
            "filename": "tensorflow/core/graph/tensor_id.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fgraph%2Ftensor_id.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fgraph%2Ftensor_id.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fgraph%2Ftensor_id.h?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -57,7 +57,6 @@ struct TensorId : public std::pair<absl::string_view, int> {\n   };\n };\n \n-TensorId ParseTensorName(const string& name);\n TensorId ParseTensorName(absl::string_view name);\n \n bool IsTensorIdControl(const TensorId& tensor_id);"
        },
        {
            "sha": "a0eb727f1a43437abc158f2c631a6de92d57246a",
            "filename": "tensorflow/core/lib/db/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -25,6 +25,7 @@ cc_library(\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@org_sqlite\",\n     ],"
        },
        {
            "sha": "defbd1bee365c6ad5ef36c4111375fa96ea6d08f",
            "filename": "tensorflow/core/lib/db/sqlite.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -19,6 +19,7 @@ limitations under the License.\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/ascii.h\"\n #include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/lib/core/errors.h\"\n #include \"tensorflow/core/platform/status.h\"\n@@ -99,8 +100,7 @@ absl::Status SetPragma(Sqlite* db, const char* pragma,\n                        const absl::string_view& value) {\n   if (value.empty()) return absl::OkStatus();\n   for (auto p = value.begin(); p < value.end(); ++p) {\n-    if (!(('0' <= *p && *p <= '9') || ('A' <= *p && *p <= 'Z') ||\n-          ('a' <= *p && *p <= 'z') || *p == '-')) {\n+    if (!(absl::ascii_isalnum(*p) || *p == '-')) {\n       return errors::InvalidArgument(\"Illegal pragma character\");\n     }\n   }"
        },
        {
            "sha": "1ba5b1ad531485ff5db5499ef7344943670daaa2",
            "filename": "tensorflow/core/platform/str_util.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fplatform%2Fstr_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Fplatform%2Fstr_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2Fstr_util.h?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -51,7 +51,6 @@ using tsl::str_util::StringReplace;\n using tsl::str_util::StripPrefix;\n using tsl::str_util::StripSuffix;\n using tsl::str_util::StripTrailingWhitespace;\n-using tsl::str_util::Strnlen;\n using tsl::str_util::TitlecaseString;\n using tsl::str_util::Uppercase;\n // NOLINTEND(misc-unused-using-decls)"
        },
        {
            "sha": "82ab2423465bc888a6d6933814bf262a9dfecd0c",
            "filename": "tensorflow/core/util/memmapped_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Futil%2Fmemmapped_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Futil%2Fmemmapped_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Futil%2Fmemmapped_file_system.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -269,8 +269,7 @@ bool MemmappedFileSystem::IsMemmappedPackageFilename(\n \n namespace {\n bool IsValidRegionChar(char c) {\n-  return (c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z') ||\n-         (c >= '0' && c <= '9') || c == '_' || c == '.';\n+  return absl::ascii_isalnum(c) || c == '_' || c == '.';\n }\n }  // namespace\n "
        },
        {
            "sha": "22d7eaca0431271f1a7bc5604add33c002054c7e",
            "filename": "tensorflow/core/util/semver_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Futil%2Fsemver_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fcore%2Futil%2Fsemver_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Futil%2Fsemver_test.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -15,6 +15,7 @@ limitations under the License.\n \n #include <cstddef>\n \n+#include \"absl/strings/ascii.h\"\n #include \"absl/strings/strip.h\"\n #include \"tensorflow/core/lib/core/stringpiece.h\"\n #include \"tensorflow/core/lib/strings/str_util.h\"\n@@ -27,10 +28,7 @@ namespace {\n bool IsDotOrIdentifierChar(char c) {\n   if (c == '.') return true;\n   if (c == '-') return true;\n-  if (c >= 'A' && c <= 'Z') return true;\n-  if (c >= 'a' && c <= 'z') return true;\n-  if (c >= '0' && c <= '9') return true;\n-  return false;\n+  return absl::ascii_isalnum(c);\n }\n \n bool ConsumeDotSeparatedIdentifiers(absl::string_view* s,"
        },
        {
            "sha": "cae51b2ae8f5d2dc5553ba4dbd590c3b9220224a",
            "filename": "tensorflow/security/fuzzing/cc/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -33,6 +33,7 @@ tf_cc_fuzz_test(\n     deps = [\n         \"//tensorflow/core/platform:str_util\",\n         \"//tensorflow/core/platform:stringpiece\",\n+        \"@com_google_absl//absl/strings\",\n     ],\n )\n "
        },
        {
            "sha": "1f09a16a700d7753dbb7dbf6f4605950d6454fbd",
            "filename": "tensorflow/security/fuzzing/cc/arg_def_case_fuzz.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Farg_def_case_fuzz.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Farg_def_case_fuzz.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Farg_def_case_fuzz.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n #include <string_view>\n \n #include \"fuzztest/fuzztest.h\"\n+#include \"absl/strings/ascii.h\"\n #include \"tensorflow/core/platform/str_util.h\"\n #include \"tensorflow/core/platform/stringpiece.h\"\n \n@@ -27,8 +28,8 @@ namespace {\n void FuzzTest(std::string_view data) {\n   std::string ns = tensorflow::str_util::ArgDefCase(data);\n   for (const auto &c : ns) {\n-    const bool is_letter = 'a' <= c && c <= 'z';\n-    const bool is_digit = '0' <= c && c <= '9';\n+    const bool is_letter = absl::ascii_isalpha(c);\n+    const bool is_digit = absl::ascii_isdigit(c);\n     if (!is_letter && !is_digit) {\n       assert(c == '_');\n     }"
        },
        {
            "sha": "4d4881a827a1f5457c3490d6506b548cfe0dfe2c",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/str_util.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 29,
            "changes": 39,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -15,10 +15,11 @@ limitations under the License.\n \n #include \"tsl/platform/str_util.h\"\n \n-#include <cctype>\n+#include <charconv>\n #include <cstddef>\n #include <cstdint>\n #include <string>\n+#include <system_error>  // NOLINT\n \n #include \"absl/strings/ascii.h\"\n #include \"absl/strings/match.h\"\n@@ -50,28 +51,16 @@ size_t RemoveWhitespaceContext(absl::string_view* text) {\n }\n \n bool ConsumeLeadingDigits(absl::string_view* s, uint64_t* val) {\n-  const char* p = s->data();\n-  const char* limit = p + s->size();\n-  uint64_t v = 0;\n-  while (p < limit) {\n-    const char c = *p;\n-    if (c < '0' || c > '9') break;\n-    uint64_t new_v = (v * 10) + (c - '0');\n-    if (new_v / 8 < v) {\n-      // Overflow occurred\n-      return false;\n-    }\n-    v = new_v;\n-    p++;\n-  }\n-  if (p > s->data()) {\n-    // Consume some digits\n-    s->remove_prefix(p - s->data());\n-    *val = v;\n-    return true;\n-  } else {\n+  uint64_t v;\n+  auto [p, ec] =\n+      std::from_chars(s->data(), s->data() + s->size(), v, /*base=*/10);\n+  if (ec != std::errc{}) {\n     return false;\n   }\n+  // Consume some digits\n+  s->remove_prefix(p - s->data());\n+  *val = v;\n+  return true;\n }\n \n bool ConsumeNonWhitespace(absl::string_view* s, absl::string_view* val) {\n@@ -122,14 +111,6 @@ string StringReplace(absl::string_view s, absl::string_view oldsub,\n   return res;\n }\n \n-size_t Strnlen(const char* str, const size_t string_max_len) {\n-  size_t len = 0;\n-  while (len < string_max_len && str[len] != '\\0') {\n-    ++len;\n-  }\n-  return len;\n-}\n-\n string ArgDefCase(absl::string_view s) {\n   const size_t n = s.size();\n "
        },
        {
            "sha": "62c0b7a6de53c05495fcb93a41f77866f81a24be",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/str_util.h",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util.h?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -210,11 +210,6 @@ inline bool StrContains(absl::string_view haystack, absl::string_view needle) {\n   return absl::StrContains(haystack, needle);\n }\n \n-// Returns the length of the given null-terminated byte string 'str'.\n-// Returns 'string_max_len' if the null character was not found in the first\n-// 'string_max_len' bytes of 'str'.\n-size_t Strnlen(const char* str, const size_t string_max_len);\n-\n //   ----- NON STANDARD, TF SPECIFIC METHOD -----\n // Converts \"^2ILoveYou!\" to \"i_love_you_\". More specifically:\n // - converts all non-alphanumeric characters to underscores"
        },
        {
            "sha": "4a2e14dd1d78f34f65f79b2ebc7f7fa7714d5d0c",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/str_util_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstr_util_test.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -367,12 +367,4 @@ TEST(StringReplace, EmptyStringReplaceAll) {\n   EXPECT_EQ(\"\", str_util::StringReplace(\"\", \"a\", \"X\", /*replace_all=*/true));\n }\n \n-TEST(Strnlen, Basic) {\n-  EXPECT_EQ(0, str_util::Strnlen(\"ab\", 0));\n-  EXPECT_EQ(1, str_util::Strnlen(\"a\", 1));\n-  EXPECT_EQ(2, str_util::Strnlen(\"abcd\", 2));\n-  EXPECT_EQ(3, str_util::Strnlen(\"abc\", 10));\n-  EXPECT_EQ(4, str_util::Strnlen(\"a \\t\\n\", 10));\n-}\n-\n }  // namespace tsl"
        },
        {
            "sha": "876b5f222f4a41715dab405c8df4cc82d0c6bbb9",
            "filename": "third_party/xla/xla/service/llvm_ir/llvm_util.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 10,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Fservice%2Fllvm_ir%2Fllvm_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Fservice%2Fllvm_ir%2Fllvm_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fllvm_ir%2Fllvm_util.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -31,6 +31,7 @@ limitations under the License.\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/ascii.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_format.h\"\n #include \"absl/strings/string_view.h\"\n@@ -626,23 +627,20 @@ std::string SanitizeFunctionName(std::string function_name) {\n   // are illegal.\n \n   // Sanitize chars in function_name.\n-  std::transform(function_name.begin(), function_name.end(),\n-                 function_name.begin(), [](char c) {\n-                   if (('a' <= c && c <= 'z') || ('A' <= c && c <= 'Z') ||\n-                       ('0' <= c && c <= '9') || c == '_' || c == '$') {\n-                     return c;\n-                   }\n-                   return '_';\n-                 });\n+  absl::c_transform(function_name, function_name.begin(), [](char c) {\n+    if (absl::ascii_isalnum(c) || c == '_' || c == '$') {\n+      return c;\n+    }\n+    return '_';\n+  });\n \n   // Ensure the name isn't empty.\n   if (function_name.empty()) {\n     function_name = \"__unnamed\";\n   }\n \n   // Ensure the name doesn't start with a number.\n-  if (!function_name.empty() && function_name[0] >= '0' &&\n-      function_name[0] <= '9') {\n+  if (!function_name.empty() && absl::ascii_isdigit(function_name[0])) {\n     function_name.insert(function_name.begin(), '_');\n   }\n "
        },
        {
            "sha": "412f30b42260771b85f3c91cbabd19c61e0e4666",
            "filename": "third_party/xla/xla/sort_json.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Fsort_json.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Fsort_json.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fsort_json.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -104,7 +104,7 @@ absl::StatusOr<std::unique_ptr<T>> ParseSequence(absl::string_view outer_json,\n \n absl::Status EnsureValidLiteralStart(char c) {\n   if (c != '\"' && c != '+' && c != '-' && c != 'f' && c != 't' && c != 'n' &&\n-      (c < '0' || c > '9')) {\n+      !absl::ascii_isdigit(c)) {\n     return absl::InvalidArgumentError(absl::StrCat(\n         \"Invalid first character of literal: '\", std::string(1, c), \"'.\"));\n   }"
        },
        {
            "sha": "47817d98e0d94ccb83811b9772bc811b21bb4212",
            "filename": "third_party/xla/xla/tsl/util/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -278,6 +278,8 @@ cc_library(\n     deps = [\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:stringpiece\",\n     ],"
        },
        {
            "sha": "a3bc7abf1f341b48bc0c87e264db9bc8044e6f2f",
            "filename": "third_party/xla/xla/tsl/util/device_name_utils.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 13,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fdevice_name_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/efab298fb7da82786019419e14bc9f69775c96e8/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fdevice_name_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fdevice_name_utils.cc?ref=efab298fb7da82786019419e14bc9f69775c96e8",
            "patch": "@@ -16,29 +16,30 @@ limitations under the License.\n #include \"xla/tsl/util/device_name_utils.h\"\n \n #include <algorithm>\n+#include <cstdint>\n+#include <string>\n \n+#include \"absl/strings/ascii.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"tsl/platform/str_util.h\"\n \n namespace tsl {\n \n-static bool IsAlpha(char c) {\n-  return (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z');\n-}\n-\n static bool IsAlphaNumOrUnderscore(char c) {\n-  return IsAlpha(c) || (c >= '0' && c <= '9') || c == '_';\n+  return absl::ascii_isalnum(c) || c == '_';\n }\n \n // Returns true iff \"in\" is a valid job name.\n static bool IsJobName(absl::string_view in) {\n-  return !in.empty() && IsAlpha(in.front()) &&\n+  return !in.empty() && absl::ascii_isalpha(in.front()) &&\n          std::all_of(in.begin(), in.end(), IsAlphaNumOrUnderscore);\n }\n \n static bool ConsumePrefix(absl::string_view* in, string* out,\n                           absl::string_view prefix_terminators) {\n-  if (in->empty() || !IsAlpha(in->front())) {\n+  if (in->empty() || !absl::ascii_isalpha(in->front())) {\n     return false;\n   }\n   const auto end_it =\n@@ -66,7 +67,7 @@ static bool ConsumeDeviceType(absl::string_view* in, string* device_type) {\n // Returns true and fills in \"*val\" iff \"*in\" starts with a decimal\n // number.\n static bool ConsumeNumber(absl::string_view* in, int* val) {\n-  uint64 tmp;\n+  uint64_t tmp;\n   if (str_util::ConsumeLeadingDigits(in, &tmp)) {\n     *val = tmp;\n     return true;\n@@ -75,16 +76,16 @@ static bool ConsumeNumber(absl::string_view* in, int* val) {\n }\n \n // Returns a fully qualified device name given the parameters.\n-static string DeviceName(const string& job, int replica, int task,\n-                         const string& device_prefix, const string& device_type,\n-                         int id) {\n+static std::string DeviceName(absl::string_view job, int replica, int task,\n+                              absl::string_view device_prefix,\n+                              absl::string_view device_type, int id) {\n   CHECK(IsJobName(job)) << job;\n   CHECK_LE(0, replica);\n   CHECK_LE(0, task);\n   CHECK(!device_type.empty());\n   CHECK_LE(0, id);\n-  return strings::StrCat(\"/job:\", job, \"/replica:\", replica, \"/task:\", task,\n-                         device_prefix, device_type, \":\", id);\n+  return absl::StrCat(\"/job:\", job, \"/replica:\", replica, \"/task:\", task,\n+                      device_prefix, device_type, \":\", id);\n }\n \n /* static */"
        }
    ],
    "stats": {
        "total": 175,
        "additions": 67,
        "deletions": 108
    }
}