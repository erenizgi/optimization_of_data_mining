{
    "author": "tensorflower-gardener",
    "message": "#HLODiff Continue doing hlo diff when value tracing errors.\n\nPiperOrigin-RevId: 840347255",
    "sha": "54f78c5142930de6813dcdd7d56f51f811a1362d",
    "files": [
        {
            "sha": "a0e6a90852c55315dd1f0b74e9d919cbfce5ca44",
            "filename": "third_party/xla/xla/hlo/tools/hlo_diff/graph/hlo_gumgraph.cc",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/54f78c5142930de6813dcdd7d56f51f811a1362d/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/54f78c5142930de6813dcdd7d56f51f811a1362d/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftools%2Fhlo_diff%2Fgraph%2Fhlo_gumgraph.cc?ref=54f78c5142930de6813dcdd7d56f51f811a1362d",
            "patch": "@@ -321,6 +321,11 @@ absl::Status HloGumgraph::PrecomputeComputationFingerprint() {\n \n void HloGumgraph::PrecomputeInstructionDependencies() {\n   LOG(INFO) << \"Precomputing instruction dependencies\";\n+  if (hlo_value_tracing_ == nullptr) {\n+    LOG(WARNING) << \"Skipping PrecomputeInstructionDependencies because \"\n+                    \"HloValueTracing failed to initialize.\";\n+    return;\n+  }\n   for (auto* computation : hlo_module_.MakeComputationPostOrder()) {\n     for (auto* instruction : computation->MakeInstructionPostOrder()) {\n       HloInstructionNode* node = GetNode(instruction);\n@@ -370,11 +375,23 @@ absl::StatusOr<std::unique_ptr<const HloGumgraph>> HloGumgraph::Create(\n       << \"Expected a non-null entry computation\";\n \n   std::unique_ptr<CallGraph> call_graph = CallGraph::Build(hlo_module);\n-  TF_ASSIGN_OR_RETURN(std::unique_ptr<HloValueTracing> hlo_value_tracing,\n-                      HloValueTracing::Run(*hlo_module));\n+  precompute_instruction_dependencies = true;\n+  std::unique_ptr<HloValueTracing> hlo_value_tracing_ptr = nullptr;\n+  if (precompute_instruction_dependencies) {\n+    absl::StatusOr<std::unique_ptr<HloValueTracing>> hlo_value_tracing =\n+        HloValueTracing::Run(*hlo_module);\n+    if (hlo_value_tracing.ok()) {\n+      hlo_value_tracing_ptr = *std::move(hlo_value_tracing);\n+    } else {\n+      LOG(WARNING) << \"Failed to run HloValueTracing: \"\n+                   << hlo_value_tracing.status();\n+      // hlo_value_tracing_ptrs is left as nullptr.\n+    }\n+  }\n+\n   auto graph = absl::WrapUnique(\n       new HloGumgraph(*hlo_module, fingerprint_options, std::move(call_graph),\n-                      std::move(hlo_value_tracing)));\n+                      std::move(hlo_value_tracing_ptr)));\n \n   TF_RETURN_IF_ERROR(graph->ConstructGraph(*hlo_module));\n   TF_ASSIGN_OR_RETURN(std::vector<HloInstructionNode*> zero_indegree_nodes,"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 20,
        "deletions": 3
    }
}