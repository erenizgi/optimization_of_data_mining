{
    "author": "ezhulenev",
    "message": "[xla:ffi] Add execution stage to all error messages when checking FFI signature\n\nPiperOrigin-RevId: 837117056",
    "sha": "9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6",
    "files": [
        {
            "sha": "124eff429072bf7988e09a91ebe6ed49638128f6",
            "filename": "third_party/xla/xla/ffi/api/api.h",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h?ref=9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6",
            "patch": "@@ -1690,23 +1690,26 @@ class Handler : public Ffi {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->args.size < kNumArgs)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of arguments: expected at least \",\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of arguments: expected at least \",\n                    kNumArgs - kNumOptionalArgs - 1, \" but got \",\n                    call_frame->args.size));\n       }\n     } else if constexpr (internal::HasOptionalArgTag<Ts...>::value) {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->args.size < kNumArgs)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of arguments: expected at least \",\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of arguments: expected at least \",\n                    kNumArgs - kNumOptionalArgs, \" but got \",\n                    call_frame->args.size));\n       }\n     } else {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->args.size != kNumArgs)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of arguments: expected \", kNumArgs,\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of arguments: expected \", kNumArgs,\n                    \" but got \", call_frame->args.size));\n       }\n     }\n@@ -1717,23 +1720,26 @@ class Handler : public Ffi {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->rets.size < kNumRets)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of results: expected at least \",\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of results: expected at least \",\n                    kNumRets - kNumOptionalRets - 1, \" but got \",\n                    call_frame->rets.size));\n       }\n     } else if constexpr (internal::HasOptionalRetTag<Ts...>::value) {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->rets.size < kNumRets)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of results: expected at least \",\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of results: expected at least \",\n                    kNumRets - kNumOptionalRets, \" but got \",\n                    call_frame->rets.size));\n       }\n     } else {\n       if (XLA_FFI_PREDICT_FALSE(call_frame->rets.size != kNumRets)) {\n         return InvalidArgument(\n             call_frame->api,\n-            StrCat(\"Wrong number of results: expected \", kNumRets, \" but got \",\n+            StrCat(\"[\", call_frame->stage, \"] \",\n+                   \"Wrong number of results: expected \", kNumRets, \" but got \",\n                    call_frame->rets.size));\n       }\n     }\n@@ -1746,7 +1752,8 @@ class Handler : public Ffi {\n     if (XLA_FFI_PREDICT_FALSE(kNumDictAttrs == 0 &&\n                               call_frame->attrs.size != kNumAttrs)) {\n       std::stringstream msg;\n-      msg << \"Wrong number of attributes: expected \" << kNumAttrs << \" but got \"\n+      msg << \"[\" << call_frame->stage << \"] \"\n+          << \"Wrong number of attributes: expected \" << kNumAttrs << \" but got \"\n           << call_frame->attrs.size;\n       if (call_frame->attrs.size > 0) {\n         msg << \" with name(s): \";"
        },
        {
            "sha": "da6c6a1ca0cd024d955e87275d3bb394788820ff",
            "filename": "third_party/xla/xla/ffi/ffi_test.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fffi_test.cc?ref=9e662ca5a1faa78d0aeaeb08c16c8f690de57cb6",
            "patch": "@@ -185,8 +185,12 @@ TEST(FfiTest, WrongNumArgs) {\n \n   auto status = Call(*handler, call_frame);\n \n-  ASSERT_EQ(status.message(),\n-            \"Wrong number of arguments: expected 2 but got 1\");\n+  EXPECT_THAT(\n+      status,\n+      absl_testing::StatusIs(\n+          absl::StatusCode::kInvalidArgument,\n+          HasSubstr(\n+              \"[execute] Wrong number of arguments: expected 2 but got 1\")));\n }\n \n TEST(FfiTest, WrongNumAttrs) {\n@@ -207,7 +211,8 @@ TEST(FfiTest, WrongNumAttrs) {\n       status,\n       absl_testing::StatusIs(\n           absl::StatusCode::kInvalidArgument,\n-          HasSubstr(\"Wrong number of attributes: expected 1 but got 2\")));\n+          HasSubstr(\n+              \"[execute] Wrong number of attributes: expected 1 but got 2\")));\n }\n \n TEST(FfiTest, RunId) {"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 22,
        "deletions": 10
    }
}