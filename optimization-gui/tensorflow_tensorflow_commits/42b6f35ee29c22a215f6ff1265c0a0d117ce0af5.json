{
    "author": "bchetioui",
    "message": "[XLA] Document what it means for a custom call to be command-buffer-compatible.\n\nPiperOrigin-RevId: 813748753",
    "sha": "42b6f35ee29c22a215f6ff1265c0a0d117ce0af5",
    "files": [
        {
            "sha": "e28e8993fc8740d7dd1cc5f61ea7940f156fef57",
            "filename": "third_party/xla/xla/ffi/api/api.h",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/42b6f35ee29c22a215f6ff1265c0a0d117ce0af5/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/42b6f35ee29c22a215f6ff1265c0a0d117ce0af5/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h?ref=42b6f35ee29c22a215f6ff1265c0a0d117ce0af5",
            "patch": "@@ -202,6 +202,21 @@ enum class ExecutionStage : uint8_t {\n };\n \n enum class Traits : uint32_t {\n+  // Indicates that the handler is compatible with command buffers. In the\n+  // XLA:GPU CUDA backend, we rely on graph capture to trace the execution of a\n+  // FFI handler and record it as a command buffer (CUDA graph). For a FFI\n+  // handler to be compatible with CUDA graphs, it has to satisfy certain\n+  // constraints as documented in\n+  // https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#prohibited-and-unhandled-operations.\n+  //\n+  // Broadly speaking, a handler that satisfies the following conditions should\n+  // be compatible with command buffers:\n+  //   1. it only launches kernels that must be captured in command buffers on\n+  //      the device (e.g. it does *not* do autotuning). This is because\n+  //      everything it launches will be captured in the command buffer;\n+  //   2. the FFI handler only uses device allocations passed in as buffer\n+  //      arguments (e.g. it does *not* do any runtime device memory\n+  //      allocations).\n   kCmdBufferCompatible = XLA_FFI_HANDLER_TRAITS_COMMAND_BUFFER_COMPATIBLE,\n };\n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
    }
}