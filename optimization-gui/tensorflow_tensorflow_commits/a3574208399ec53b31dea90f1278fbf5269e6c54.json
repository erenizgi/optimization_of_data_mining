{
    "author": "ezhulenev",
    "message": "[xla:cpu] Overwrite HloModuleMetadata with an empty one\n\nResetting hlo pass metadata does not release allocated memory.\n\nPiperOrigin-RevId: 797914645",
    "sha": "a3574208399ec53b31dea90f1278fbf5269e6c54",
    "files": [
        {
            "sha": "a48059bde6549727ab9a20b33d936b1c9d663253",
            "filename": "third_party/xla/xla/service/cpu/cpu_executable.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3574208399ec53b31dea90f1278fbf5269e6c54/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3574208399ec53b31dea90f1278fbf5269e6c54/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc?ref=a3574208399ec53b31dea90f1278fbf5269e6c54",
            "patch": "@@ -49,6 +49,7 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_input_output_alias_config.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n+#include \"xla/hlo/ir/hlo_module_metadata.h\"\n #include \"xla/service/buffer_assignment.h\"\n #include \"xla/service/cpu/cpu_runtime.h\"\n #include \"xla/service/custom_call_status.h\"\n@@ -161,9 +162,9 @@ CpuExecutable::CpuExecutable(\n   }\n \n   // Once we compiled HLO module to CPU executable, we don't need to keep the\n-  // pass metadata around.\n+  // HLO module metadata around.\n   if (has_module()) {\n-    shared_module()->metadata()->ClearPassMetadata();\n+    *shared_module()->metadata() = HloModuleMetadata(tsl::Env::Default());\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 5,
        "additions": 3,
        "deletions": 2
    }
}