{
    "author": "loislo",
    "message": "This change replaces the deprecated tsl::errors::Internal function with absl::InternalError, as part of the XLA/TSL cleanup.\nIt also adds the necessary absl/strings/str_cat.h include and dependency.\n\nPiperOrigin-RevId: 837776932",
    "sha": "f3903471f0612b136ec4e1881704d9e9a953dddc",
    "files": [
        {
            "sha": "9de70eb28c1b0778bc9a18996504f4f4cd69d01e",
            "filename": "tensorflow/core/framework/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f3903471f0612b136ec4e1881704d9e9a953dddc/tensorflow%2Fcore%2Fframework%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f3903471f0612b136ec4e1881704d9e9a953dddc/tensorflow%2Fcore%2Fframework%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2FBUILD?ref=f3903471f0612b136ec4e1881704d9e9a953dddc",
            "patch": "@@ -712,6 +712,8 @@ cc_library(\n         \"//tensorflow/core/platform:status\",\n         \"//tensorflow/core/platform:statusor\",\n         \"//tensorflow/core/util:overflow\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@eigen_archive//:eigen3\",\n     ],\n     alwayslink = 1,"
        },
        {
            "sha": "6e60a6412eaee3ad90c99ff7e0dc5d51153e7e22",
            "filename": "tensorflow/core/framework/tensor_shape.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f3903471f0612b136ec4e1881704d9e9a953dddc/tensorflow%2Fcore%2Fframework%2Ftensor_shape.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f3903471f0612b136ec4e1881704d9e9a953dddc/tensorflow%2Fcore%2Fframework%2Ftensor_shape.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2Ftensor_shape.cc?ref=f3903471f0612b136ec4e1881704d9e9a953dddc",
            "patch": "@@ -15,6 +15,8 @@ limitations under the License.\n \n #include \"tensorflow/core/framework/tensor_shape.h\"\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"tensorflow/core/framework/bounds_check.h\"\n #include \"tensorflow/core/framework/tensor_shape.pb.h\"\n #include \"tensorflow/core/lib/strings/str_util.h\"\n@@ -546,16 +548,16 @@ absl::Status TensorShapeBase<Shape>::InsertDimWithStatus(int d, int64_t size) {\n   }\n \n   if (TF_PREDICT_FALSE(d < 0)) {\n-    return errors::Internal(\"The insertion index must be non-negative, got \",\n-                            d);\n+    return absl::InternalError(\n+        absl::StrCat(\"The insertion index must be non-negative, got \", d));\n   }\n   if (TF_PREDICT_FALSE(d > dims())) {\n-    return errors::Internal(\"The insertion index must be at most \", dims(),\n-                            \" got \", d);\n+    return absl::InternalError(absl::StrCat(\n+        \"The insertion index must be at most \", dims(), \" got \", d));\n   }\n   if (TF_PREDICT_FALSE(dims() >= MaxDimensions())) {\n-    return errors::Internal(\"Shape has \", dims(),\n-                            \" dimensions which is the maximum allowed\");\n+    return absl::InternalError(absl::StrCat(\n+        \"Shape has \", dims(), \" dimensions which is the maximum allowed\"));\n   }\n \n   absl::InlinedVector<int64_t, 8UL> vals;\n@@ -681,18 +683,20 @@ absl::Status TensorShapeBase<Shape>::RemoveDimRangeWithStatus(int begin,\n   end = end < 0 ? dims() + end + 1 : end;\n \n   if (TF_PREDICT_FALSE(begin < 0)) {\n-    return errors::Internal(\"Start index must be non-negative, got \", begin);\n+    return absl::InternalError(\n+        absl::StrCat(\"Start index must be non-negative, got \", begin));\n   }\n   if (TF_PREDICT_FALSE(begin > dims())) {\n-    return errors::Internal(\"Start index must be less than \", dims(), \", got \",\n-                            begin);\n+    return absl::InternalError(absl::StrCat(\"Start index must be less than \",\n+                                            dims(), \", got \", begin));\n   }\n   if (TF_PREDICT_FALSE(end < 0)) {\n-    return errors::Internal(\"End index must be non-negative, got \", end);\n+    return absl::InternalError(\n+        absl::StrCat(\"End index must be non-negative, got \", end));\n   }\n   if (TF_PREDICT_FALSE(end > dims())) {\n-    return errors::Internal(\"End index must be less than \", dims(), \", got \",\n-                            end);\n+    return absl::InternalError(\n+        absl::StrCat(\"End index must be less than \", dims(), \", got \", end));\n   }\n \n   if (begin >= end) {\n@@ -932,7 +936,7 @@ absl::Status PartialTensorShape::MergeWith(const PartialTensorShape& shape,\n   }\n \n   if (result == this) {\n-    return errors::Internal(\n+    return absl::InternalError(\n         \"PartialTensorShape::MergeWith: Cannot output result to itself\");\n   }\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 19,
        "deletions": 13
    }
}