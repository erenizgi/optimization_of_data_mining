{
    "author": "majnemer",
    "message": "[TSL] Clean up integral types\n\nLet's migrate to u?int\\d+_t types instead of our own bespoke stuff.\n\nPiperOrigin-RevId: 820815523",
    "sha": "bdb78510d0ce35ea98eb298fc770657a16056a2c",
    "files": [
        {
            "sha": "d316fc512187d657b2f775d04ddb033ea3f09434",
            "filename": "tensorflow/core/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -493,7 +493,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:framework_lite_hdrs\",\n         \"@local_xla//xla/tsl/framework:numeric_types.h\",\n         \"@local_xla//xla/tsl/framework:type_traits.h\",\n-        \"@local_xla//xla/tsl/platform/default:integral_types.h\",\n     ],\n     visibility = [\"//visibility:public\"],\n     deps = [\n@@ -1537,7 +1536,6 @@ cc_library(\n     hdrs = [\n         \"//tensorflow/core/platform:tflite_portable_logging_hdrs\",\n         \"@local_tsl//tsl/platform:tflite_portable_logging_hdrs\",\n-        \"@local_xla//xla/tsl/platform/default:integral_types.h\",\n     ],\n     compatible_with = get_compatible_with_portable(),\n     copts = tf_copts(),"
        },
        {
            "sha": "072c3353c5b8d9958d901f7917e49577c7c33abc",
            "filename": "tensorflow/core/common_runtime/graph_view.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fcommon_runtime%2Fgraph_view.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fcommon_runtime%2Fgraph_view.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Fgraph_view.cc?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -16,7 +16,9 @@ limitations under the License.\n #include \"tensorflow/core/common_runtime/graph_view.h\"\n \n #include <atomic>\n+#include <cstdint>\n #include <deque>\n+#include <limits>\n #include <memory>\n #include <string>\n #include <unordered_map>\n@@ -252,9 +254,9 @@ absl::Status GraphView::Initialize(const Graph* g) {\n   for (const Node* n : g->nodes()) {\n     if (n->out_edges().size() > kint32max) {\n       return errors::InvalidArgument(\n-          \"The executor cannot handle nodes with more than \", kint32max,\n-          \" output edges. Node \", n->name(), \" had \", n->out_edges().size(),\n-          \" output edges.\");\n+          \"The executor cannot handle nodes with more than \",\n+          std::numeric_limits<int32_t>::max(), \" output edges. Node \",\n+          n->name(), \" had \", n->out_edges().size(), \" output edges.\");\n     }\n     total_bytes += NodeItemBytes(n);\n   }"
        },
        {
            "sha": "7697d08819a051bcf7225f8f03487b2506aec780",
            "filename": "tensorflow/core/lib/gif/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Flib%2Fgif%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Flib%2Fgif%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fgif%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -52,7 +52,6 @@ cc_library(\n         \"//tensorflow/core/lib/gtl:legacy_android_gif_internal_headers\",\n         \"//tensorflow/core/platform:gif_internal_hdrs\",\n         \"@local_tsl//tsl/platform:gif_internal_hdrs\",\n-        \"@local_xla//xla/tsl/platform/default:integral_types.h\",\n     ],\n     copts = tf_copts(),\n     features = [\"-layering_check\"],"
        },
        {
            "sha": "ce705066f161d71bb85f574ef3392ab2295c75b2",
            "filename": "tensorflow/core/lib/jpeg/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Flib%2Fjpeg%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Flib%2Fjpeg%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fjpeg%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -61,7 +61,6 @@ cc_library(\n         \"//tensorflow/core/lib/core:legacy_lib_core_stringpiece_header\",\n         \"//tensorflow/core/platform:jpeg_internal_hdrs\",\n         \"@local_tsl//tsl/platform:jpeg_internal_hdrs\",\n-        \"@local_xla//xla/tsl/platform/default:integral_types.h\",\n     ],\n     copts = tf_copts(),\n     linkopts = if_android([\"-ldl\"]),"
        },
        {
            "sha": "41c022c72504485dec0b76a5f066bb8440f97599",
            "filename": "tensorflow/core/platform/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -940,6 +940,7 @@ cc_library(\n         \":bfloat16\",\n         \":platform\",\n         \":tstring\",\n+        \"@com_google_absl//absl/base:core_headers\",\n         \"@local_tsl//tsl/platform:bfloat16\",\n         \"@local_tsl//tsl/platform:ml_dtypes\",\n         \"@local_tsl//tsl/platform:tstring\","
        },
        {
            "sha": "cee95ef4324c64238f41329c12817074a9cfff7e",
            "filename": "tensorflow/core/platform/types.h",
            "status": "modified",
            "additions": 22,
            "deletions": 22,
            "changes": 44,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fplatform%2Ftypes.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fcore%2Fplatform%2Ftypes.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2Ftypes.h?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -19,51 +19,51 @@ limitations under the License.\n #include <cstdint>\n #include <string>\n \n+#include \"absl/base/macros.h\"\n #include \"xla/tsl/platform/types.h\"\n #include \"tensorflow/core/platform/bfloat16.h\"\n #include \"tensorflow/core/platform/platform.h\"\n #include \"tensorflow/core/platform/tstring.h\"\n #include \"tsl/platform/bfloat16.h\"\n #include \"tsl/platform/tstring.h\"\n-#include \"tsl/platform/types.h\"\n \n namespace tensorflow {\n \n // Alias tensorflow::string to std::string.\n-using tsl::string;\n+using string ABSL_DEPRECATE_AND_INLINE() = std::string;\n \n-using tsl::uint16;\n using tsl::uint2;\n-using tsl::uint32;\n using tsl::uint4;\n-using tsl::uint64;\n-using tsl::uint8;\n+using uint8 ABSL_DEPRECATE_AND_INLINE() = uint8_t;\n+using uint16 ABSL_DEPRECATE_AND_INLINE() = uint16_t;\n+using uint32 ABSL_DEPRECATE_AND_INLINE() = uint32_t;\n+using uint64 ABSL_DEPRECATE_AND_INLINE() = uint64_t;\n \n-using tsl::int16;\n using tsl::int2;\n-using tsl::int32;\n using tsl::int4;\n-using tsl::int64;\n-using tsl::int8;\n+using int8 ABSL_DEPRECATE_AND_INLINE() = int8_t;\n+using int16 ABSL_DEPRECATE_AND_INLINE() = int16_t;\n+using int32 ABSL_DEPRECATE_AND_INLINE() = int32_t;\n+using int64 ABSL_DEPRECATE_AND_INLINE() = int64_t;\n \n using tsl::float8_e4m3b11fnuz;\n using tsl::float8_e4m3fn;\n using tsl::float8_e4m3fnuz;\n using tsl::float8_e5m2;\n using tsl::float8_e5m2fnuz;\n \n-static const uint8 kuint8max = tsl::kuint8max;\n-static const uint16 kuint16max = tsl::kuint16max;\n-static const uint32 kuint32max = tsl::kuint32max;\n-static const uint64 kuint64max = tsl::kuint64max;\n-static const int8_t kint8min = tsl::kint8min;\n-static const int8_t kint8max = tsl::kint8max;\n-static const int16_t kint16min = tsl::kint16min;\n-static const int16_t kint16max = tsl::kint16max;\n-static const int32_t kint32min = tsl::kint32min;\n-static const int32_t kint32max = tsl::kint32max;\n-static const int64_t kint64min = tsl::kint64min;\n-static const int64_t kint64max = tsl::kint64max;\n+using tsl::kint16max;\n+using tsl::kint16min;\n+using tsl::kint32max;\n+using tsl::kint32min;\n+using tsl::kint64max;\n+using tsl::kint64min;\n+using tsl::kint8max;\n+using tsl::kint8min;\n+using tsl::kuint16max;\n+using tsl::kuint32max;\n+using tsl::kuint64max;\n+using tsl::kuint8max;\n \n // A typedef for a uint64 used as a short fingerprint.\n using tsl::bfloat16;"
        },
        {
            "sha": "a98829792ec794b55233913a993a17a699fe4083",
            "filename": "tensorflow/python/_pywrap_tensorflow.def",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2F_pywrap_tensorflow.def?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -123,6 +123,7 @@ EXPORTS\n   ??0Tensor@tensorflow@@QEAA@XZ\n   ??0TensorFlowDialect@TF@mlir@@QEAA@PEAVMLIRContext@2@@Z\n   ??0VirtualCluster@grappler@tensorflow@@QEAA@AEBV?$unordered_map@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@VDeviceProperties@tensorflow@@U?$hash@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@2@U?$equal_to@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@2@V?$allocator@U?$pair@$$CBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@VDeviceProperties@tensorflow@@@std@@@2@@std@@@Z\n+  ??0VirtualPlacer@grappler@tensorflow@@QEAA@AEBV?$unordered_map@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@VDeviceProperties@tensorflow@@U?$hash@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@2@U?$equal_to@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@2@V?$allocator@U?$pair@$$CBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@VDeviceProperties@tensorflow@@@std@@@2@@std@@@Z\n   ??0WorkerConfig@experimental@data@tensorflow@@IEAA@PEAVArena@protobuf@google@@@Z\n   ??1ApiDefMap@tensorflow@@QEAA@XZ\n   ??1AttrValue@tensorflow@@UEAA@XZ\n@@ -799,6 +800,8 @@ EXPORTS\n   ?getMemBuffer@MemoryBuffer@llvm@@SA?AV?$unique_ptr@VMemoryBuffer@llvm@@U?$default_delete@VMemoryBuffer@llvm@@@std@@@std@@VStringRef@2@0_N@Z\n   ?getOrLoadDialect@MLIRContext@mlir@@QEAAPEAVDialect@2@VStringRef@llvm@@VTypeID@2@V?$function_ref@$$A6A?AV?$unique_ptr@VDialect@mlir@@U?$default_delete@VDialect@mlir@@@std@@@std@@XZ@5@@Z\n   ?getValuePtr@?$SpecificNodeAccess@U?$node_options@VOperation@mlir@@$0A@$0A@X$0A@X@ilist_detail@llvm@@@ilist_detail@llvm@@KAPEAVOperation@mlir@@PEAV?$ilist_node_impl@U?$node_options@VOperation@mlir@@$0A@$0A@X$0A@X@ilist_detail@llvm@@@3@@Z\n+  ?get_canonical_device_name@VirtualPlacer@grappler@tensorflow@@QEBA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@AEBVNodeDef@3@@Z\n+  ?get_device@VirtualPlacer@grappler@tensorflow@@QEBAAEBVDeviceProperties@3@AEBVNodeDef@3@@Z\n   ?id@?$TypeIDResolver@VArithDialect@arith@mlir@@X@detail@mlir@@0VSelfOwningTypeID@3@A\n   ?id@?$TypeIDResolver@VFuncDialect@func@mlir@@X@detail@mlir@@0VSelfOwningTypeID@3@A\n   ?id@?$TypeIDResolver@VModuleOp@mlir@@X@detail@mlir@@0VSelfOwningTypeID@3@A"
        },
        {
            "sha": "9f8e92700add3b858410e202d068d14191dcd2a6",
            "filename": "third_party/xla/xla/tsl/platform/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -729,6 +729,7 @@ cc_library(\n     hdrs = [\"types.h\"],\n     compatible_with = get_compatible_with_portable(),\n     deps = [\n+        \"@com_google_absl//absl/base:core_headers\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:bfloat16\",\n         \"@local_tsl//tsl/platform:ml_dtypes\","
        },
        {
            "sha": "ad10455ced05ede1c662ccb277998a9502a68aca",
            "filename": "third_party/xla/xla/tsl/platform/default/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -298,7 +298,6 @@ filegroup(\n     name = \"xla_cpu_runtime_srcs\",\n     srcs = [\n         \"context.h\",\n-        \"integral_types.h\",\n     ] + if_not_windows([\"env_time.cc\"]),\n )\n \n@@ -477,7 +476,6 @@ cc_library(\n         \"no_oss\",\n         \"nobuilder\",\n     ],\n-    textual_hdrs = [\"integral_types.h\"],\n )\n \n cc_library(\n@@ -638,7 +636,6 @@ exports_files(\n     srcs = glob(\n         [\"*\"],\n         exclude = [\n-            \"integral_types.h\",\n             \"test.cc\",\n         ],\n     ),\n@@ -647,7 +644,6 @@ exports_files(\n \n exports_files(\n     srcs = [\n-        \"integral_types.h\",\n         \"test.cc\",\n     ],\n     visibility = internal_visibility(["
        },
        {
            "sha": "51a159afb44dc3783947e167126f2b0418c4ff5f",
            "filename": "third_party/xla/xla/tsl/platform/default/build_config.bzl",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fbuild_config.bzl?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -321,7 +321,6 @@ def tf_additional_lib_hdrs():\n         clean_dep(\"//xla/tsl/platform/default:casts.h\"),\n         clean_dep(\"//xla/tsl/platform/default:context.h\"),\n         clean_dep(\"//xla/tsl/platform/default:criticality.h\"),\n-        clean_dep(\"//xla/tsl/platform/default:integral_types.h\"),\n         clean_dep(\"//xla/tsl/platform/default:stacktrace.h\"),\n         clean_dep(\"//xla/tsl/platform/default:status.h\"),\n         clean_dep(\"//xla/tsl/platform/default:statusor.h\"),"
        },
        {
            "sha": "65c457564105c9bde7e9cd38dbaa2549fc072015",
            "filename": "third_party/xla/xla/tsl/platform/types.h",
            "status": "modified",
            "additions": 202,
            "deletions": 31,
            "changes": 233,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Ftypes.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Ftypes.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Ftypes.h?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -16,47 +16,218 @@ limitations under the License.\n #ifndef XLA_TSL_PLATFORM_TYPES_H_\n #define XLA_TSL_PLATFORM_TYPES_H_\n \n+#include <cstdint>\n+#include <limits>\n #include <string>\n \n-#include \"tsl/platform/bfloat16.h\"\n+#include \"absl/base/const_init.h\"\n+#include \"absl/base/macros.h\"\n+#include \"tsl/platform/bfloat16.h\"  // IWYU pragma: export\n #include \"tsl/platform/ml_dtypes.h\"  // IWYU pragma: export\n-#include \"tsl/platform/platform.h\"\n #include \"tsl/platform/tstring.h\"\n \n-// Include appropriate platform-dependent implementations\n-#if defined(PLATFORM_GOOGLE) || defined(GOOGLE_INTEGRAL_TYPES)\n-#include \"xla/tsl/platform/google/integral_types.h\"  // IWYU pragma: export\n-#elif defined(PLATFORM_POSIX) || defined(PLATFORM_POSIX_ANDROID) ||    \\\n-    defined(PLATFORM_GOOGLE_ANDROID) || defined(PLATFORM_POSIX_IOS) || \\\n-    defined(PLATFORM_GOOGLE_IOS) || defined(PLATFORM_WINDOWS)\n-#include \"xla/tsl/platform/default/integral_types.h\"  // IWYU pragma: export\n-#else\n-#error Define the appropriate PLATFORM_<foo> macro for this platform\n-#endif\n-\n namespace tsl {\n \n // Alias tsl::string to std::string.\n-using std::string;\n-\n-static const uint4 kuint4max = static_cast<uint4>(0x0F);\n-static const uint8 kuint8max = static_cast<uint8>(0xFF);\n-static const uint16 kuint16max = static_cast<uint16>(0xFFFF);\n-static const uint32 kuint32max = static_cast<uint32>(0xFFFFFFFF);\n-static const uint64 kuint64max = static_cast<uint64>(0xFFFFFFFFFFFFFFFFull);\n-static const int8_t kint8min = static_cast<int8>(~0x7F);\n-static const int8_t kint8max = static_cast<int8>(0x7F);\n-static const int4 kint4min = static_cast<int4>(0x08);\n-static const int4 kint4max = static_cast<int4>(0x07);\n-static const int16_t kint16min = static_cast<int16>(~0x7FFF);\n-static const int16_t kint16max = static_cast<int16>(0x7FFF);\n-static const int32_t kint32min = static_cast<int32>(~0x7FFFFFFF);\n-static const int32_t kint32max = static_cast<int32>(0x7FFFFFFF);\n-static const int64_t kint64min = static_cast<int64_t>(~0x7FFFFFFFFFFFFFFFll);\n-static const int64_t kint64max = static_cast<int64_t>(0x7FFFFFFFFFFFFFFFll);\n+using string ABSL_DEPRECATE_AND_INLINE() = std::string;\n+using uint8 ABSL_DEPRECATE_AND_INLINE() = uint8_t;\n+using uint16 ABSL_DEPRECATE_AND_INLINE() = uint16_t;\n+using uint32 ABSL_DEPRECATE_AND_INLINE() = uint32_t;\n+using uint64 ABSL_DEPRECATE_AND_INLINE() = uint64_t;\n+using int8 ABSL_DEPRECATE_AND_INLINE() = int8_t;\n+using int16 ABSL_DEPRECATE_AND_INLINE() = int16_t;\n+using int32 ABSL_DEPRECATE_AND_INLINE() = int32_t;\n+using int64 ABSL_DEPRECATE_AND_INLINE() = int64_t;\n+\n+// Note: This duplication is necessary because the inliner doesn't handle\n+// macros very well and templates will cause it to replace int32_t with int.\n+namespace detail {\n+class Uint8Max {\n+ public:\n+  constexpr explicit Uint8Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Uint8Max(const Uint8Max&) = delete;\n+  Uint8Max& operator=(const Uint8Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator uint8_t() const {\n+    return std::numeric_limits<uint8_t>::max();\n+  }\n+};\n+\n+class Uint16Max {\n+ public:\n+  constexpr explicit Uint16Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Uint16Max(const Uint16Max&) = delete;\n+  Uint16Max& operator=(const Uint16Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator uint16_t() const {\n+    return std::numeric_limits<uint16_t>::max();\n+  }\n+};\n+\n+class Uint32Max {\n+ public:\n+  constexpr explicit Uint32Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Uint32Max(const Uint32Max&) = delete;\n+  Uint32Max& operator=(const Uint32Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator uint32_t() const {\n+    return std::numeric_limits<uint32_t>::max();\n+  }\n+};\n+\n+class Uint64Max {\n+ public:\n+  constexpr explicit Uint64Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Uint64Max(const Uint64Max&) = delete;\n+  Uint64Max& operator=(const Uint64Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator uint64_t() const {\n+    return std::numeric_limits<uint64_t>::max();\n+  }\n+};\n+\n+class Int8Min {\n+ public:\n+  constexpr explicit Int8Min(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int8Min(const Int8Min&) = delete;\n+  Int8Min& operator=(const Int8Min&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int8_t() const {\n+    return std::numeric_limits<int8_t>::min();\n+  }\n+};\n+\n+class Int16Min {\n+ public:\n+  constexpr explicit Int16Min(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int16Min(const Int16Min&) = delete;\n+  Int16Min& operator=(const Int16Min&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int16_t() const {\n+    return std::numeric_limits<int16_t>::min();\n+  }\n+};\n+\n+class Int32Min {\n+ public:\n+  constexpr explicit Int32Min(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int32Min(const Int32Min&) = delete;\n+  Int32Min& operator=(const Int32Min&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int32_t() const {\n+    return std::numeric_limits<int32_t>::min();\n+  }\n+};\n+\n+class Int64Min {\n+ public:\n+  constexpr explicit Int64Min(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int64Min(const Int64Min&) = delete;\n+  Int64Min& operator=(const Int64Min&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int64_t() const {\n+    return std::numeric_limits<int64_t>::min();\n+  }\n+};\n+\n+class Int8Max {\n+ public:\n+  constexpr explicit Int8Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int8Max(const Int8Max&) = delete;\n+  Int8Max& operator=(const Int8Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int8_t() const {\n+    return std::numeric_limits<int8_t>::max();\n+  }\n+};\n+\n+class Int16Max {\n+ public:\n+  constexpr explicit Int16Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int16Max(const Int16Max&) = delete;\n+  Int16Max& operator=(const Int16Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int16_t() const {\n+    return std::numeric_limits<int16_t>::max();\n+  }\n+};\n+\n+class Int32Max {\n+ public:\n+  constexpr explicit Int32Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int32Max(const Int32Max&) = delete;\n+  Int32Max& operator=(const Int32Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int32_t() const {\n+    return std::numeric_limits<int32_t>::max();\n+  }\n+};\n+\n+class Int64Max {\n+ public:\n+  constexpr explicit Int64Max(absl::ConstInitType) {}\n+  // Not copyable or movable.\n+  Int64Max(const Int64Max&) = delete;\n+  Int64Max& operator=(const Int64Max&) = delete;\n+\n+  ABSL_DEPRECATE_AND_INLINE()\n+  // NOLINTNEXTLINE(google-explicit-constructor)\n+  constexpr operator int64_t() const {\n+    return std::numeric_limits<int64_t>::max();\n+  }\n+};\n+}  // namespace detail\n+\n+inline constexpr detail::Uint8Max kuint8max{absl::kConstInit};\n+inline constexpr detail::Uint16Max kuint16max{absl::kConstInit};\n+inline constexpr detail::Uint32Max kuint32max{absl::kConstInit};\n+inline constexpr detail::Uint64Max kuint64max{absl::kConstInit};\n+\n+inline constexpr detail::Int8Min kint8min{absl::kConstInit};\n+inline constexpr detail::Int16Min kint16min{absl::kConstInit};\n+inline constexpr detail::Int32Min kint32min{absl::kConstInit};\n+inline constexpr detail::Int64Min kint64min{absl::kConstInit};\n+\n+inline constexpr detail::Int8Max kint8max{absl::kConstInit};\n+inline constexpr detail::Int16Max kint16max{absl::kConstInit};\n+inline constexpr detail::Int32Max kint32max{absl::kConstInit};\n+inline constexpr detail::Int64Max kint64max{absl::kConstInit};\n \n // A typedef for a uint64 used as a short fingerprint.\n-using Fprint = uint64;\n+using Fprint = uint64_t;\n \n }  // namespace tsl\n "
        },
        {
            "sha": "6e66772c7ff08d7dead79690dc0d3f6f73b4dd93",
            "filename": "third_party/xprof/xprof.patch",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxprof%2Fxprof.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bdb78510d0ce35ea98eb298fc770657a16056a2c/third_party%2Fxprof%2Fxprof.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxprof%2Fxprof.patch?ref=bdb78510d0ce35ea98eb298fc770657a16056a2c",
            "patch": "@@ -54,3 +54,33 @@ diff --git a/xprof/convert/xplane_to_tools_data.cc b/xprof/convert/xplane_to_too\n  \n    auto encode_status =\n        tsl::protobuf::util::MessageToJsonString(profile, &json_output, opts);\n+diff --git a/xprof/convert/trace_viewer/trace_events.cc b/xprof/convert/trace_viewer/trace_events.cc\n+--- a/xprof/convert/trace_viewer/trace_events.cc\n++++ b/xprof/convert/trace_viewer/trace_events.cc\n+@@ -38,9 +38,7 @@ limitations under the License.\n+ #include \"xla/tsl/platform/env.h\"\n+ #include \"xla/tsl/platform/errors.h\"\n+ #include \"xla/tsl/platform/file_system.h\"\n+-#include \"xla/tsl/platform/macros.h\"\n+ #include \"xla/tsl/profiler/utils/timespan.h\"\n+-#include \"xla/tsl/platform/types.h\"\n+ #include \"xprof/convert/trace_viewer/trace_events_filter_interface.h\"\n+ #include \"xprof/convert/trace_viewer/trace_events_util.h\"\n+ #include \"xprof/convert/trace_viewer/trace_viewer_visibility.h\"\n+@@ -49,7 +47,6 @@ limitations under the License.\n+\n+ namespace tensorflow {\n+ namespace profiler {\n+-using tsl::kint64max;\n+\n+ namespace {\n+\n+@@ -137,7 +134,7 @@ std::pair<uint64_t, uint64_t> GetLevelBoundsForDuration(uint64_t duration_ps) {\n+   for (; i < NumLevels(); ++i) {\n+     if (duration_ps > kLayerResolutions[i]) {\n+       if (i == 0) {\n+-        return std::make_pair(kLayerResolutions[i], kint64max);\n++        return std::make_pair(kLayerResolutions[i], std::numeric_limits<int64_t>::max());\n+       } else {\n+         return std::make_pair(kLayerResolutions[i], kLayerResolutions[i - 1]);\n+       }\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 329,
        "additions": 264,
        "deletions": 65
    }
}