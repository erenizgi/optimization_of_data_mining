{
    "author": "terryheo",
    "message": "Populate input and output names of placeholder Signature\n\nIn LiteRT, input and output names shouldn't be empty. Populate default names\nif tensors don't have names.\n\nPiperOrigin-RevId: 834808503",
    "sha": "e9c617208058a76572646773e2253a8cd9763e75",
    "files": [
        {
            "sha": "fd1cffa0d561cf8641f25837c6b3f5c2e7299d2f",
            "filename": "tensorflow/lite/core/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fcore%2FBUILD?ref=e9c617208058a76572646773e2253a8cd9763e75",
            "patch": "@@ -342,6 +342,8 @@ cc_test(\n     srcs = [\"signature_runner_test.cc\"],\n     data = [\n         \"//tensorflow/lite:testdata/multi_signatures.bin\",\n+        \"//tensorflow/lite:testdata/no_signatures.bin\",\n+        \"//tensorflow/lite:testdata/no_signatures_no_tensor_names.bin\",\n         \"//tensorflow/lite:testdata/reverse_signature_model.bin\",\n     ],\n     deps = ["
        },
        {
            "sha": "c7d3ebb4c0801f8592f47c1952c6402526010766",
            "filename": "tensorflow/lite/core/interpreter.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Finterpreter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Finterpreter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fcore%2Finterpreter.cc?ref=e9c617208058a76572646773e2253a8cd9763e75",
            "patch": "@@ -568,10 +568,18 @@ Interpreter::CreatePlaceholderSignatureDef() {\n   auto placeholder_signature_def = std::make_unique<internal::SignatureDef>();\n   for (auto i = 0; i < inputs().size(); ++i) {\n     auto* name = GetInputName(i);\n+    if (*name == 0) {\n+      placeholder_input_names_.push_back(\"input\" + std::to_string(i));\n+      name = placeholder_input_names_.back().c_str();\n+    }\n     placeholder_signature_def->inputs[name] = inputs()[i];\n   }\n   for (auto i = 0; i < outputs().size(); ++i) {\n     auto* name = GetOutputName(i);\n+    if (*name == 0) {\n+      placeholder_output_names_.push_back(\"output\" + std::to_string(i));\n+      name = placeholder_output_names_.back().c_str();\n+    }\n     placeholder_signature_def->outputs[name] = outputs()[i];\n   }\n   placeholder_signature_def->signature_key = kPlaceholderSignatureDefKey;"
        },
        {
            "sha": "8fef5727a011968e500dc8ff5dce7f37e344ce3c",
            "filename": "tensorflow/lite/core/interpreter.h",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Finterpreter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Finterpreter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fcore%2Finterpreter.h?ref=e9c617208058a76572646773e2253a8cd9763e75",
            "patch": "@@ -1069,6 +1069,14 @@ class Interpreter {\n   static constexpr char kPlaceholderSignatureDefKey[] =\n       \"<placeholder signature>\";\n \n+  // Placeholder input names to use when the model has with no signatures & no\n+  // tensor names.\n+  std::vector<std::string> placeholder_input_names_;\n+\n+  // Placeholder output names to use when the model has with no signatures & no\n+  // tensor names.\n+  std::vector<std::string> placeholder_output_names_;\n+\n   // Placeholder SignatureDef for legacy models with no signatures.\n   std::unique_ptr<internal::SignatureDef> placeholder_signature_def_;\n "
        },
        {
            "sha": "d18affa28a037297f0f983280d6157dcb5cfb5fe",
            "filename": "tensorflow/lite/core/signature_runner_test.cc",
            "status": "modified",
            "additions": 59,
            "deletions": 0,
            "changes": 59,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Fsignature_runner_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Fcore%2Fsignature_runner_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Fcore%2Fsignature_runner_test.cc?ref=e9c617208058a76572646773e2253a8cd9763e75",
            "patch": "@@ -134,6 +134,65 @@ TEST(SignatureRunnerTest, ReverseSignatureModel) {\n   EXPECT_STREQ(subgraph_output_names[1], \"prod\");\n }\n \n+TEST(SignatureRunnerTest, TestPlaceholderSignatures) {\n+  TestErrorReporter reporter;\n+  auto model = FlatBufferModel::BuildFromFile(\n+      \"tensorflow/lite/testdata/no_signatures.bin\", &reporter);\n+  ASSERT_TRUE(model);\n+  ops::builtin::BuiltinOpResolver resolver;\n+  InterpreterBuilder builder(*model, resolver);\n+\n+  std::unique_ptr<Interpreter> interpreter;\n+  ASSERT_EQ(builder(&interpreter), kTfLiteOk);\n+  ASSERT_NE(interpreter, nullptr);\n+\n+  std::vector<const std::string*> signature_defs =\n+      interpreter->signature_keys();\n+  ASSERT_EQ(signature_defs.size(), 0);\n+\n+  SignatureRunner* default_runner =\n+      interpreter->GetSignatureRunner(/*signature_key=*/nullptr);\n+  ASSERT_NE(default_runner, nullptr);\n+  EXPECT_EQ(default_runner->signature_key(), \"<placeholder signature>\");\n+  const std::vector<const char*>& input_names = default_runner->input_names();\n+  const std::vector<const char*>& output_names = default_runner->output_names();\n+  ASSERT_EQ(input_names.size(), 2);\n+  EXPECT_EQ(std::string(input_names[0]), \"x1\");\n+  EXPECT_EQ(std::string(input_names[1]), \"x2\");\n+  ASSERT_EQ(output_names.size(), 1);\n+  EXPECT_EQ(std::string(output_names[0]), \"Identity\");\n+}\n+\n+TEST(SignatureRunnerTest, TestPlaceholderSignaturesDefaultNames) {\n+  TestErrorReporter reporter;\n+  auto model = FlatBufferModel::BuildFromFile(\n+      \"tensorflow/lite/testdata/no_signatures_no_tensor_names.bin\",\n+      &reporter);\n+  ASSERT_TRUE(model);\n+  ops::builtin::BuiltinOpResolver resolver;\n+  InterpreterBuilder builder(*model, resolver);\n+\n+  std::unique_ptr<Interpreter> interpreter;\n+  ASSERT_EQ(builder(&interpreter), kTfLiteOk);\n+  ASSERT_NE(interpreter, nullptr);\n+\n+  std::vector<const std::string*> signature_defs =\n+      interpreter->signature_keys();\n+  ASSERT_EQ(signature_defs.size(), 0);\n+\n+  SignatureRunner* default_runner =\n+      interpreter->GetSignatureRunner(/*signature_key=*/nullptr);\n+  ASSERT_NE(default_runner, nullptr);\n+  EXPECT_EQ(default_runner->signature_key(), \"<placeholder signature>\");\n+  const std::vector<const char*>& input_names = default_runner->input_names();\n+  const std::vector<const char*>& output_names = default_runner->output_names();\n+  ASSERT_EQ(input_names.size(), 2);\n+  EXPECT_EQ(std::string(input_names[0]), \"input0\");\n+  EXPECT_EQ(std::string(input_names[1]), \"input1\");\n+  ASSERT_EQ(output_names.size(), 1);\n+  EXPECT_EQ(std::string(output_names[0]), \"output0\");\n+}\n+\n }  // namespace\n }  // namespace impl\n }  // namespace tflite"
        },
        {
            "sha": "c5d285995a637cc7f063e82c1cf494801b516426",
            "filename": "tensorflow/lite/testdata/no_signatures_no_tensor_names.bin",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Ftestdata%2Fno_signatures_no_tensor_names.bin",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e9c617208058a76572646773e2253a8cd9763e75/tensorflow%2Flite%2Ftestdata%2Fno_signatures_no_tensor_names.bin",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftestdata%2Fno_signatures_no_tensor_names.bin?ref=e9c617208058a76572646773e2253a8cd9763e75"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 77,
        "deletions": 0
    }
}