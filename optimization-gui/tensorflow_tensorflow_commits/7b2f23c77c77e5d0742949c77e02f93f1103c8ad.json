{
    "author": "bixia1",
    "message": "Make all-gather(weight) to have weight semantics.\n\nPiperOrigin-RevId: 814454016",
    "sha": "7b2f23c77c77e5d0742949c77e02f93f1103c8ad",
    "files": [
        {
            "sha": "e5ba48b71f5991c5db2e54963c2ebd8fec395686",
            "filename": "third_party/xla/xla/hlo/analysis/hlo_dimension_analysis.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.cc?ref=7b2f23c77c77e5d0742949c77e02f93f1103c8ad",
            "patch": "@@ -297,4 +297,8 @@ absl::Status HloWeightPropagation::HandleOptimizationBarrier(\n   return absl::OkStatus();\n }\n \n+absl::Status HloWeightPropagation::HandleAllGather(HloInstruction* all_gather) {\n+  return HandleSimpleOp(all_gather);\n+}\n+\n }  // namespace xla"
        },
        {
            "sha": "6e3466ddae93a8699ac826c010d9d4e39505d39c",
            "filename": "third_party/xla/xla/hlo/analysis/hlo_dimension_analysis.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis.h?ref=7b2f23c77c77e5d0742949c77e02f93f1103c8ad",
            "patch": "@@ -145,6 +145,7 @@ class HloWeightPropagation : public DfsHloVisitorWithDefault {\n   absl::Status HandleBitcastConvert(HloInstruction* bitcast_convert) override;\n   absl::Status HandleOptimizationBarrier(\n       HloInstruction* optimization_barrier) override;\n+  absl::Status HandleAllGather(HloInstruction* all_gather) override;\n \n  protected:\n   HloDimensionAnalysis* analysis_;"
        },
        {
            "sha": "5fcccfccb9e67d5a1b3f5662c7fc6fbf345f0cdb",
            "filename": "third_party/xla/xla/hlo/analysis/hlo_dimension_analysis_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b2f23c77c77e5d0742949c77e02f93f1103c8ad/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fanalysis%2Fhlo_dimension_analysis_test.cc?ref=7b2f23c77c77e5d0742949c77e02f93f1103c8ad",
            "patch": "@@ -70,7 +70,8 @@ ENTRY entry {\n   multiply.52 = f32[32,128]{0,1} multiply(dot.2, broadcast.12), sharding={devices=[2,1]0,1}\n   add.93 = f32[32,128]{1,0} add(Arg_1.2, multiply.52), sharding={devices=[2,1]0,1}\n   reduce.43 = f32[] reduce(maximum.33, constant.5), dimensions={0,1}, to_apply=region_0.39, sharding={replicated}\n-  ROOT tuple.109 = (f32[32,128]{1,0}, f32[]) tuple(add.93, reduce.43), sharding={{devices=[2,1]0,1}, {replicated}}\n+  all-gather = f32[64, 128]{1,0} all-gather(Arg_1.2), channel_id=1, replica_groups={{0,1}}, dimensions={0}, use_global_device_ids=true\n+  ROOT tuple.109 = (f32[32,128]{1,0}, f32[], f32[64,128]{1,0}) tuple(add.93, reduce.43, all-gather), sharding={{devices=[2,1]0,1}, {replicated}}\n }\n )\";\n \n@@ -81,6 +82,7 @@ ENTRY entry {\n       HloDimensionAnalysis::Run(*module));\n   EXPECT_TRUE(IsWeight(*hlo_dimension_analysis, module.get(), \"copy\"));\n   EXPECT_TRUE(IsWeight(*hlo_dimension_analysis, module.get(), \"Arg_1.2\"));\n+  EXPECT_TRUE(IsWeight(*hlo_dimension_analysis, module.get(), \"all-gather\"));\n }\n \n TEST_F(HloDimensionAnalysisTest, RepeatWhile) {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}