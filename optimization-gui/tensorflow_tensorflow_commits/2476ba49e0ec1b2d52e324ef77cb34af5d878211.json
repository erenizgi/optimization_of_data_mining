{
    "author": "tensorflower-gardener",
    "message": "Minor code improvement on `tsl::monitoring::testing::CellReader`.\n\nSave a `GetLatestValueOrDefault` call when the result is not used. Also save two map lookups.\n\nPiperOrigin-RevId: 822182539",
    "sha": "2476ba49e0ec1b2d52e324ef77cb34af5d878211",
    "files": [
        {
            "sha": "ce906ee8ecbb575be52bda0e8f1c7b02c75b0352",
            "filename": "third_party/xla/xla/tsl/lib/monitoring/cell_reader.h",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2476ba49e0ec1b2d52e324ef77cb34af5d878211/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2476ba49e0ec1b2d52e324ef77cb34af5d878211/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Fcell_reader.h?ref=2476ba49e0ec1b2d52e324ef77cb34af5d878211",
            "patch": "@@ -150,12 +150,16 @@ ValueType CellReader<ValueType>::Delta(const LabelType&... labels) {\n   std::unique_ptr<CollectedMetrics> metrics = internal::CollectMetrics();\n   ValueType value = internal::GetLatestValueOrDefault<ValueType>(\n       *metrics, metric_name_, labels_list);\n-  ValueType initial_value = internal::GetLatestValueOrDefault<ValueType>(\n-      *initial_metrics_, metric_name_, labels_list);\n-  if (delta_map_.contains(labels_list)) {\n-    initial_value = delta_map_[labels_list];\n+  auto it = delta_map_.find(labels_list);\n+  ValueType initial_value;\n+  if (it == delta_map_.end()) {\n+    initial_value = internal::GetLatestValueOrDefault<ValueType>(\n+        *initial_metrics_, metric_name_, labels_list);\n+    delta_map_[labels_list] = value;\n+  } else {\n+    initial_value = it->second;\n+    it->second = value;\n   }\n-  delta_map_[labels_list] = value;\n   return internal::GetDelta<ValueType>(value, initial_value);\n }\n "
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}