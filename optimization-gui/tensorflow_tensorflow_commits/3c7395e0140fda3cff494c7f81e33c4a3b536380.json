{
    "author": "seantalts",
    "message": "[XLA:CPU] Fix intrinsic library failing when passed an already vectorized call. From Will Froom.\n\nPiperOrigin-RevId: 819867554",
    "sha": "3c7395e0140fda3cff494c7f81e33c4a3b536380",
    "files": [
        {
            "sha": "ef5eedd89cb59d664223844367fa7e2cbe49efa1",
            "filename": "third_party/xla/xla/codegen/intrinsic_lib.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3c7395e0140fda3cff494c7f81e33c4a3b536380/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3c7395e0140fda3cff494c7f81e33c4a3b536380/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib.cc?ref=3c7395e0140fda3cff494c7f81e33c4a3b536380",
            "patch": "@@ -251,7 +251,8 @@ std::vector<llvm::VecDesc> IntrinsicFunctionLib::Vectorizations() {\n          math_func->SupportedVectorTypes(options_.features)) {\n       for (const auto& vector_types :\n            math_func->SupportedVectorTypes(options_.features)) {\n-        if (!ElementTypesMatch(target_types, vector_types)) {\n+        if (!ElementTypesMatch(target_types, vector_types) ||\n+            target_types.front().is_vector()) {\n           continue;\n         }\n         absl::string_view target_name = intrinsic::StringInterner::Get().Intern("
        },
        {
            "sha": "c25e038f6e884925886c844d76ede5ffa3639e17",
            "filename": "third_party/xla/xla/codegen/intrinsic_lib_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3c7395e0140fda3cff494c7f81e33c4a3b536380/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3c7395e0140fda3cff494c7f81e33c4a3b536380/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic_lib_test.cc?ref=3c7395e0140fda3cff494c7f81e33c4a3b536380",
            "patch": "@@ -50,20 +50,10 @@ TEST(IntrinsicLibTest, ExpVectorizations) {\n     }\n   }\n \n-  EXPECT_THAT(\n-      vec_descs_str,\n-      UnorderedElementsAre(\"xla.exp.f64:xla.exp.v2f64:2:_ZGV_LLVM_N2v\",\n-                           \"xla.exp.f64:xla.exp.v4f64:4:_ZGV_LLVM_N4v\",\n-                           \"xla.exp.f64:xla.exp.v8f64:8:_ZGV_LLVM_N8v\",\n-                           \"xla.exp.v2f64:xla.exp.f64:1:_ZGV_LLVM_N1s\",\n-                           \"xla.exp.v2f64:xla.exp.v4f64:4:_ZGV_LLVM_N4v\",\n-                           \"xla.exp.v2f64:xla.exp.v8f64:8:_ZGV_LLVM_N8v\",\n-                           \"xla.exp.v4f64:xla.exp.f64:1:_ZGV_LLVM_N1s\",\n-                           \"xla.exp.v4f64:xla.exp.v2f64:2:_ZGV_LLVM_N2v\",\n-                           \"xla.exp.v4f64:xla.exp.v8f64:8:_ZGV_LLVM_N8v\",\n-                           \"xla.exp.v8f64:xla.exp.f64:1:_ZGV_LLVM_N1s\",\n-                           \"xla.exp.v8f64:xla.exp.v2f64:2:_ZGV_LLVM_N2v\",\n-                           \"xla.exp.v8f64:xla.exp.v4f64:4:_ZGV_LLVM_N4v\"));\n+  EXPECT_THAT(vec_descs_str, UnorderedElementsAre(\n+                                 \"xla.exp.f64:xla.exp.v2f64:2:_ZGV_LLVM_N2v\",\n+                                 \"xla.exp.f64:xla.exp.v4f64:4:_ZGV_LLVM_N4v\",\n+                                 \"xla.exp.f64:xla.exp.v8f64:8:_ZGV_LLVM_N8v\"));\n }\n \n }  // namespace"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 6,
        "deletions": 15
    }
}