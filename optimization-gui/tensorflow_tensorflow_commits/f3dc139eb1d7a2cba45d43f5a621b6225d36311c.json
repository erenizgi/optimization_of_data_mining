{
    "author": "basioli-k",
    "message": "[XLA][codegen] Integers with bitwidth 1 should be emitted in MLIR as I8\n\nPREDs are emitted as I8 for historical reasons so the same should be true for S1 and U1.\n\nPiperOrigin-RevId: 844800138",
    "sha": "f3dc139eb1d7a2cba45d43f5a621b6225d36311c",
    "files": [
        {
            "sha": "c498ed84daf60490e7db088ab2ba6fd087627754",
            "filename": "third_party/xla/xla/codegen/emitters/type_util.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f3dc139eb1d7a2cba45d43f5a621b6225d36311c/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f3dc139eb1d7a2cba45d43f5a621b6225d36311c/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util.cc?ref=f3dc139eb1d7a2cba45d43f5a621b6225d36311c",
            "patch": "@@ -33,7 +33,11 @@ namespace emitters {\n \n mlir::Type PrimitiveTypeToMlirType(PrimitiveType type, mlir::OpBuilder& b) {\n   if (primitive_util::IsIntegralType(type)) {\n-    return b.getIntegerType(primitive_util::BitWidth(type));\n+    auto bitwidth = primitive_util::BitWidth(type);\n+    if (bitwidth == 1) {\n+      return b.getI8Type();\n+    }\n+    return b.getIntegerType(bitwidth);\n   }\n   return PrimitiveTypeToMlirTypeWithSign(type, b);\n }"
        },
        {
            "sha": "96df881acc08918d981495f65d1457abe4b7e4ee",
            "filename": "third_party/xla/xla/codegen/emitters/type_util_test.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f3dc139eb1d7a2cba45d43f5a621b6225d36311c/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f3dc139eb1d7a2cba45d43f5a621b6225d36311c/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Femitters%2Ftype_util_test.cc?ref=f3dc139eb1d7a2cba45d43f5a621b6225d36311c",
            "patch": "@@ -61,6 +61,22 @@ TEST(TensorShapeTest, ConvertsPred) {\n             \"tensor<4x5x6xi8>\");\n }\n \n+TEST(TensorShapeTest, ConvertsU1) {\n+  mlir::MLIRContext ctx;\n+  mlir::OpBuilder b(&ctx);\n+  EXPECT_EQ(TypeToString(\n+                TensorShapeToMlirType(ShapeUtil::MakeShape(U1, {4, 5, 6}), b)),\n+            \"tensor<4x5x6xi8>\");\n+}\n+\n+TEST(TensorShapeTest, ConvertsS1) {\n+  mlir::MLIRContext ctx;\n+  mlir::OpBuilder b(&ctx);\n+  EXPECT_EQ(TypeToString(\n+                TensorShapeToMlirType(ShapeUtil::MakeShape(S1, {4, 5, 6}), b)),\n+            \"tensor<4x5x6xi8>\");\n+}\n+\n TEST(TensorShapeTest, ConvertsLayout) {\n   mlir::MLIRContext ctx;\n   mlir::OpBuilder b(&ctx);"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 21,
        "deletions": 1
    }
}