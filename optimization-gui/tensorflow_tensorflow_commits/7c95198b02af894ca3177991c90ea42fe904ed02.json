{
    "author": "thomasjoerg",
    "message": "[XLA:GPU] Return early in `CalculateBitcastOfTransposeImpl` if indices are empty.\n\nThis avoids hitting an assert later. This is a stop gap solution until support for size-1 dims in bitcasts has been added.\n\nPiperOrigin-RevId: 841687992",
    "sha": "7c95198b02af894ca3177991c90ea42fe904ed02",
    "files": [
        {
            "sha": "3383d936a0c93112aca16a54b7ce93fb6a10ae12",
            "filename": "third_party/xla/xla/service/gpu/transforms/nest_gemm_fusion.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7c95198b02af894ca3177991c90ea42fe904ed02/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7c95198b02af894ca3177991c90ea42fe904ed02/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fnest_gemm_fusion.cc?ref=7c95198b02af894ca3177991c90ea42fe904ed02",
            "patch": "@@ -679,6 +679,12 @@ absl::StatusOr<BitcastParams> CalculateBitcastOfTransposeImpl(\n       indices.push_back(index);\n     };\n \n+    if (indices.empty()) {\n+      return absl::InvalidArgumentError(\n+          absl::StrCat(\"Cannot hoist bitcast across \", transpose->ToString(),\n+                       \" because size-1 dims in bitcasts are not yet supported \"\n+                       \"(b/466065483).\"));\n+    }\n     if (indices.back() - indices.front() >= transpose_to - transpose_from ||\n         !absl::c_is_sorted(indices)) {\n       return absl::InvalidArgumentError("
        }
    ],
    "stats": {
        "total": 6,
        "additions": 6,
        "deletions": 0
    }
}