{
    "author": "alexander-shaposhnikov",
    "message": "Add a defensive check for dot layout before offloading to XNNPACK.\n\nPiperOrigin-RevId: 800159987",
    "sha": "ca6db3cbab311c761f6a5d9e9cb3c979ef3a38d1",
    "files": [
        {
            "sha": "a27df279a24a293b331d44e94c002d4c4397282e",
            "filename": "third_party/xla/xla/backends/cpu/xnn_support.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ca6db3cbab311c761f6a5d9e9cb3c979ef3a38d1/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fxnn_support.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ca6db3cbab311c761f6a5d9e9cb3c979ef3a38d1/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fxnn_support.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fxnn_support.cc?ref=ca6db3cbab311c761f6a5d9e9cb3c979ef3a38d1",
            "patch": "@@ -81,6 +81,11 @@ absl::StatusOr<bool> IsDotSupportedByXnn(\n   if (!AreDtypesSupported(lhs_shape, rhs_shape, out_shape, cpu_features)) {\n     return false;\n   }\n+  if (!IsLayoutSupportedByXnn(lhs_shape) ||\n+      !IsLayoutSupportedByXnn(rhs_shape) ||\n+      !IsLayoutSupportedByXnn(out_shape)) {\n+    return false;\n+  }\n \n   // Check shapes.\n   TF_ASSIGN_OR_RETURN(DotShape dot_shape, GetDotShape(dot_dimensions, lhs_shape,"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 5,
        "deletions": 0
    }
}