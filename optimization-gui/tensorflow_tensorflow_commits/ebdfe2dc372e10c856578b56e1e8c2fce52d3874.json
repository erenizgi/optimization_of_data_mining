{
    "author": "mwhittaker",
    "message": "Removed unused `GetTaskState` from coordination service.\n\nPiperOrigin-RevId: 846002428",
    "sha": "ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
    "files": [
        {
            "sha": "c7e70795b97fba30567aa80e4689ba3fb4a6b174",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_client.h",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_client.h?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -36,8 +36,6 @@ using tensorflow::GetKeyValueDirRequest;\n using tensorflow::GetKeyValueDirResponse;\n using tensorflow::GetKeyValueRequest;\n using tensorflow::GetKeyValueResponse;\n-using tensorflow::GetTaskStateRequest;\n-using tensorflow::GetTaskStateResponse;\n using tensorflow::HeartbeatRequest;\n using tensorflow::HeartbeatResponse;\n using tensorflow::IncrementKeyValueRequest;\n@@ -82,10 +80,6 @@ class CoordinationClient {\n                               ResetTaskResponse* response,\n                               tsl::StatusCallback done) = 0;\n \n-  virtual void GetTaskStateAsync(const GetTaskStateRequest* request,\n-                                 GetTaskStateResponse* response,\n-                                 tsl::StatusCallback done) = 0;\n-\n   virtual void WatchJobStateAsync(tsl::CallOptions* call_opts,\n                                   const WatchJobStateRequest* request,\n                                   WatchJobStateResponse* response,"
        },
        {
            "sha": "0326b3c5cbb270df8a58fa548dce8117cba73426",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -796,19 +796,6 @@ CoordinatedTaskStateInfo CoordinationService::CreateTaskStateInfo(\n   return info;\n }\n \n-std::vector<CoordinatedTaskStateInfo> CoordinationService::GetTaskState(\n-    const std::vector<CoordinatedTask>& tasks) {\n-  std::vector<CoordinatedTaskStateInfo> states_info;\n-  states_info.reserve(tasks.size());\n-\n-  absl::MutexLock l(state_mu_);\n-  for (const auto& task : tasks) {\n-    states_info.push_back(\n-        CreateTaskStateInfo(task, *cluster_state_[GetTaskName(task)]));\n-  }\n-  return states_info;\n-}\n-\n std::vector<CoordinatedTaskStateInfo> CoordinationService::GetJobState(\n     absl::string_view job_name) {\n   std::vector<CoordinatedTaskStateInfo> states_info;"
        },
        {
            "sha": "1c302da245c90a05e161e795ab4adb66010d70a0",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service.h?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -173,10 +173,6 @@ class CoordinationService {\n   absl::Status ReportTaskError(const tensorflow::CoordinatedTask& task,\n                                const absl::Status& error);\n \n-  // Get the state and the error status of the tasks.\n-  std::vector<tensorflow::CoordinatedTaskStateInfo> GetTaskState(\n-      const std::vector<tensorflow::CoordinatedTask>& task);\n-\n   // Watches the state and the error status of the job.\n   using WatchJobStateCallback = absl::AnyInvocable<void(\n       std::vector<tensorflow::CoordinatedTaskStateInfo>, int64_t)>;"
        },
        {
            "sha": "bc6788cb7ecabc08859e43c57b702575d8990cc5",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_agent.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -362,29 +362,6 @@ absl::StatusOr<CoordinatedTask> CoordinationServiceAgent::GetOwnTask() {\n   return task_;\n }\n \n-absl::StatusOr<std::vector<CoordinatedTaskStateInfo>>\n-CoordinationServiceAgent::GetTaskState(\n-    const std::vector<CoordinatedTask>& tasks) {\n-  GetTaskStateRequest request;\n-  *request.mutable_source_task() = {tasks.begin(), tasks.end()};\n-  GetTaskStateResponse response;\n-  absl::Notification n;\n-  absl::StatusOr<std::vector<CoordinatedTaskStateInfo>> result;\n-  leader_client_->GetTaskStateAsync(\n-      &request, &response, [&](const absl::Status& s) {\n-        if (s.ok()) {\n-          result = std::vector<CoordinatedTaskStateInfo>(\n-              std::make_move_iterator(response.task_state().begin()),\n-              std::make_move_iterator(response.task_state().end()));\n-        } else {\n-          result = s;\n-        }\n-        n.Notify();\n-      });\n-  n.WaitForNotification();\n-  return result;\n-}\n-\n std::shared_ptr<tsl::CallOptions> CoordinationServiceAgent::WatchJobStateAsync(\n     absl::string_view job_name, std::optional<int64_t> version_number,\n     std::function<void(absl::StatusOr<tensorflow::WatchJobStateResponse>)>"
        },
        {
            "sha": "cbec2894d157938a6d010d1cd3c239c0307e9f49",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_agent.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent.h?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -163,10 +163,6 @@ class CoordinationServiceAgent {\n   // Get task associated with this agent.\n   absl::StatusOr<tensorflow::CoordinatedTask> GetOwnTask();\n \n-  // Get status of a remote task.\n-  absl::StatusOr<std::vector<tensorflow::CoordinatedTaskStateInfo>>\n-  GetTaskState(const std::vector<tensorflow::CoordinatedTask>& task);\n-\n   // Watches the status of a remote job.\n   absl::StatusOr<tensorflow::WatchJobStateResponse> WatchJobState(\n       absl::string_view job_name, std::optional<int64_t> version_number);"
        },
        {
            "sha": "43c59e7a611ce54d6ea1302a61accfbaed7fa0c1",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_agent_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_agent_test.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -120,10 +120,6 @@ class TestCoordinationClient : public CoordinationClient {\n               (const GetAliveTasksRequest*, GetAliveTasksResponse*,\n                tsl::StatusCallback),\n               (override));\n-  MOCK_METHOD(void, GetTaskStateAsync,\n-              (const GetTaskStateRequest*, GetTaskStateResponse*,\n-               tsl::StatusCallback),\n-              (override));\n   MOCK_METHOD(void, WatchJobStateAsync,\n               (tsl::CallOptions*, const WatchJobStateRequest*,\n                WatchJobStateResponse*, tsl::StatusCallback),\n@@ -153,8 +149,6 @@ class CoordinationServiceAgentTest : public ::testing::Test {\n         .WillByDefault(InvokeArgument<3>(absl::OkStatus()));\n     ON_CALL(*client_, CancelBarrierAsync(_, _, _))\n         .WillByDefault(InvokeArgument<2>(absl::OkStatus()));\n-    ON_CALL(*client_, GetTaskStateAsync(_, _, _))\n-        .WillByDefault(InvokeArgument<2>(absl::OkStatus()));\n   }\n \n   // Should be called after mocking service responses, before testing the agent."
        },
        {
            "sha": "a94a4189881c4e59e21712e4f712fb3fbf00f3d7",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_rpc_handler.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -116,22 +116,6 @@ void CoordinationServiceRpcHandler::ResetTaskAsync(\n   done(service_->ResetTask(request->source_task()));\n }\n \n-void CoordinationServiceRpcHandler::GetTaskStateAsync(\n-    const tensorflow::GetTaskStateRequest* request,\n-    tensorflow::GetTaskStateResponse* response, tsl::StatusCallback done) {\n-  absl::ReaderMutexLock l(mu_);\n-  if (service_ == nullptr) {\n-    done(MakeCoordinationError(\n-        absl::InternalError(\"Coordination service is not enabled.\")));\n-    return;\n-  }\n-  auto result = service_->GetTaskState(\n-      {request->source_task().begin(), request->source_task().end()});\n-  absl::c_move(result, tsl::protobuf::RepeatedFieldBackInserter(\n-                           response->mutable_task_state()));\n-  done(absl::OkStatus());\n-}\n-\n void CoordinationServiceRpcHandler::WatchJobStateAsync(\n     const tensorflow::WatchJobStateRequest* request,\n     tensorflow::WatchJobStateResponse* response, tsl::StatusCallback done) {"
        },
        {
            "sha": "04e7645cd9c7666ae2dad1949e0605c7c9f35b90",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_rpc_handler.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_rpc_handler.h?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -48,10 +48,6 @@ class CoordinationServiceRpcHandler {\n                       tensorflow::ResetTaskResponse* response,\n                       tsl::StatusCallback done);\n \n-  void GetTaskStateAsync(const tensorflow::GetTaskStateRequest* request,\n-                         tensorflow::GetTaskStateResponse* response,\n-                         tsl::StatusCallback done);\n-\n   void WatchJobStateAsync(const tensorflow::WatchJobStateRequest* request,\n                           tensorflow::WatchJobStateResponse* response,\n                           tsl::StatusCallback done);"
        },
        {
            "sha": "ec75076d4c62080196fb52b1eeb44f98efaa0d2c",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/coordination_service_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fcoordination_service_test.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -111,7 +111,6 @@ class TestCoordinationClient : public CoordinationClient {\n   }\n \n   UNIMPLEMENTED(ResetTask);\n-  UNIMPLEMENTED(GetTaskState);\n   UNIMPLEMENTED(InsertKeyValue);\n   UNIMPLEMENTED(TryGetKeyValue);\n   UNIMPLEMENTED(IncrementKeyValue);"
        },
        {
            "sha": "9e7a3269aa9655f74a420815e41b8a109dfa2a83",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/grpc_coordination_client.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_client.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -53,8 +53,6 @@ using tensorflow::GetKeyValueDirRequest;\n using tensorflow::GetKeyValueDirResponse;\n using tensorflow::GetKeyValueRequest;\n using tensorflow::GetKeyValueResponse;\n-using tensorflow::GetTaskStateRequest;\n-using tensorflow::GetTaskStateResponse;\n using tensorflow::HeartbeatRequest;\n using tensorflow::HeartbeatResponse;\n using tensorflow::IncrementKeyValueRequest;\n@@ -162,16 +160,6 @@ class GrpcCoordinationClient : public CoordinationClient {\n         /*fail_fast=*/true, &target_);\n   }\n \n-  void GetTaskStateAsync(const GetTaskStateRequest* request,\n-                         GetTaskStateResponse* response,\n-                         tsl::StatusCallback done) override {\n-    new tsl::RPCState<tsl::protobuf::Message>(\n-        &stub_, cq_, \"/tensorflow.CoordinationService/GetTaskState\", *request,\n-        response, std::move(done), /*call_opts=*/nullptr,\n-        /*threadpool=*/nullptr, /*max_retries=*/0, /*fail_fast=*/true,\n-        &target_);\n-  }\n-\n   void WatchJobStateAsync(tsl::CallOptions* call_opts,\n                           const WatchJobStateRequest* request,\n                           WatchJobStateResponse* response,"
        },
        {
            "sha": "1e4c9030f4aed9651f39ecf3a80ceb67910d314a",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/grpc_coordination_service_impl.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.cc?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -47,7 +47,6 @@ void GrpcCoordinationServiceImpl::HandleRPCsLoop() {\n   ENQUEUE_REQUEST(ShutdownTask);\n   ENQUEUE_REQUEST(ResetTask);\n   ENQUEUE_REQUEST(Heartbeat);\n-  ENQUEUE_REQUEST(GetTaskState);\n   ENQUEUE_REQUEST(WatchJobState);\n   ENQUEUE_REQUEST(InsertKeyValue);\n   ENQUEUE_REQUEST(GetKeyValue);"
        },
        {
            "sha": "bf5941d78deadc222c8b26dc457e9de42a227f80",
            "filename": "third_party/xla/xla/pjrt/distributed/coordination/grpc_coordination_service_impl.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ebdfe2dc372e10c856578b56e1e8c2fce52d3874/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Fcoordination%2Fgrpc_coordination_service_impl.h?ref=ebdfe2dc372e10c856578b56e1e8c2fce52d3874",
            "patch": "@@ -88,7 +88,6 @@ class GrpcCoordinationServiceImpl : public tsl::AsyncServiceInterface {\n   HANDLER(ShutdownTask);\n   HANDLER(ResetTask);\n   HANDLER(Heartbeat);\n-  HANDLER(GetTaskState);\n   HANDLER(WatchJobState);\n   HANDLER(InsertKeyValue);\n   HANDLER(GetKeyValue);"
        }
    ],
    "stats": {
        "total": 91,
        "additions": 0,
        "deletions": 91
    }
}