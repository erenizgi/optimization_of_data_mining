{
    "author": "zvikinoza",
    "message": "UnflattenCallGraph - get rid of unecessary manual clean up which is already covered with call to `RemoveUnusedComputations`\n\nPiperOrigin-RevId: 833351035",
    "sha": "8a623b216ea40eaa5457b48f439d8e7d51e945bc",
    "files": [
        {
            "sha": "bcbc055e2702eb7a5807003b1c1a3c77295d4298",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/unflatten_call_graph.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8a623b216ea40eaa5457b48f439d8e7d51e945bc/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Funflatten_call_graph.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8a623b216ea40eaa5457b48f439d8e7d51e945bc/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Funflatten_call_graph.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Funflatten_call_graph.cc?ref=8a623b216ea40eaa5457b48f439d8e7d51e945bc",
            "patch": "@@ -48,6 +48,7 @@ namespace {\n \n // Struct to hold all call instructions and called computations in a module.\n struct HloCalls {\n+  // All callsites are guaranteed to be `kCall` instructions.\n   std::vector<HloInstruction*> call_sites;\n   absl::flat_hash_set<HloComputation*> targets;\n };\n@@ -188,13 +189,6 @@ absl::StatusOr<bool> UnflattenCallGraph::RunImpl(\n   }\n \n   if (changed) {\n-    // Clean up any computations that are now no longer called.\n-    for (const ComputationHashResult& result : hash_results) {\n-      if (!hash_to_canonical.contains(result.hash)) {\n-        TF_RETURN_IF_ERROR(\n-            module->RemoveEmbeddedComputation(result.computation));\n-      }\n-    }\n     TF_RETURN_IF_ERROR(module->RemoveUnusedComputations());\n     module->CleanupComputations();\n   }"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 1,
        "deletions": 7
    }
}