{
    "author": "KanishAnand",
    "message": "Add tests for handling tuple in/out shardings\n\nPiperOrigin-RevId: 799635808",
    "sha": "47dd7ea73c311cfd94200b9db9cb36b5bba016d9",
    "files": [
        {
            "sha": "b872bec591cae2faf216f0760948f56b9601381d",
            "filename": "third_party/xla/xla/service/spmd/shardy/sdy_round_trip/import_shardy_attrs.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/47dd7ea73c311cfd94200b9db9cb36b5bba016d9/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fimport_shardy_attrs.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/47dd7ea73c311cfd94200b9db9cb36b5bba016d9/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fimport_shardy_attrs.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fimport_shardy_attrs.cc?ref=47dd7ea73c311cfd94200b9db9cb36b5bba016d9",
            "patch": "@@ -238,7 +238,6 @@ void convertShardyAttrs(FuncOp funcOp, IRRewriter& rewriter) {\n   });\n }\n \n-// TODO (b/432659630): Add tests\n using ShardingSetter =\n     absl::AnyInvocable<void(FuncOp, int64_t, TensorShardingAttr)>;\n LogicalResult handleFuncTupleInOutShardings(ModuleOp moduleOp, FuncOp funcOp,"
        },
        {
            "sha": "ac78d7120b4b53a19fca1eac8993922da8892eff",
            "filename": "third_party/xla/xla/service/spmd/shardy/test/sdy_round_trip_import_pipeline.mlir",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/47dd7ea73c311cfd94200b9db9cb36b5bba016d9/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Ftest%2Fsdy_round_trip_import_pipeline.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/47dd7ea73c311cfd94200b9db9cb36b5bba016d9/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Ftest%2Fsdy_round_trip_import_pipeline.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Ftest%2Fsdy_round_trip_import_pipeline.mlir?ref=47dd7ea73c311cfd94200b9db9cb36b5bba016d9",
            "patch": "@@ -415,3 +415,32 @@ func.func private @foo(%arg0: tensor<8xf32>) -> tensor<8xf32> {\n   %0 = stablehlo.add %arg0, %arg0 : tensor<8xf32>\n   return %0 : tensor<8xf32>\n }\n+\n+// -----\n+// CHECK-LABEL: module @main_func_in_out_tuple_shardings\n+// CHECK-NOT: xla.sdy.tuple_args_shardings\n+// CHECK-NOT: xla.sdy.tuple_results_shardings\n+module @main_func_in_out_tuple_shardings attributes {mhlo.frontend_attributes = {\n+  xla.sdy.meshes = \"{mesh = #sdy.mesh<[\\\"a\\\"=8, \\\"b\\\"=8, \\\"c\\\"=8]>}\",\n+  xla.sdy.tuple_args_shardings = \"#sdy.sharding_per_value<[<@mesh, [{\\\"a\\\"}]>, <@mesh, [{\\\"b\\\"}]>]>\",\n+  xla.sdy.use_tuple_args = \"true\",\n+  xla.sdy.tuple_results_shardings = \"#sdy.sharding_per_value<[<@mesh, [{\\\"c\\\"}]>]>\"}} {\n+  // CHECK: sdy.mesh @mesh = <[\"a\"=8, \"b\"=8, \"c\"=8]>\n+  // CHECK-LABEL: func @main(\n+  // CHECK-SAME:    %arg0: tensor<32xi32> {sdy.sharding = #sdy.sharding<@mesh, [{\"a\"}]>},\n+  // CHECK-SAME:    %arg1: tensor<32xi32> {sdy.sharding = #sdy.sharding<@mesh, [{\"b\"}]>}\n+  // CHECK-SAME:  ) -> (\n+  // CHECK-SAME:    tensor<32xi32> {sdy.sharding = #sdy.sharding<@mesh, [{\"c\"}]>}\n+  // CHECK-SAME:  ) {\n+  func.func @main(%arg0: tensor<32xi32>, %arg1: tensor<32xi32>) -> tensor<32xi32> {\n+    // CHECK-NEXT: return %arg0 : tensor<32xi32>\n+    return %arg0 : tensor<32xi32>\n+  }\n+\n+  // CHECK-LABEL: func @non_main_func(\n+  // CHECK-SAME:    %arg0: tensor<32xi32>, %arg1: tensor<32xi32>) -> tensor<32xi32> {\n+  func.func @non_main_func(%arg0: tensor<32xi32>, %arg1: tensor<32xi32>) -> tensor<32xi32> {\n+    // CHECK-NEXT: return %arg0 : tensor<32xi32>\n+    return %arg0 : tensor<32xi32>\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 29,
        "deletions": 1
    }
}