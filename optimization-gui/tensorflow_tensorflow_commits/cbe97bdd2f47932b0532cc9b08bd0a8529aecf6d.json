{
    "author": "ermilovmaxim",
    "message": "speed up xla_device_test 5x by reusing session\n\nPiperOrigin-RevId: 835259040",
    "sha": "cbe97bdd2f47932b0532cc9b08bd0a8529aecf6d",
    "files": [
        {
            "sha": "7f84349bffd15b5f13884e7efc3d452147ff1221",
            "filename": "tensorflow/compiler/tests/xla_device_test.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cbe97bdd2f47932b0532cc9b08bd0a8529aecf6d/tensorflow%2Fcompiler%2Ftests%2Fxla_device_test.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cbe97bdd2f47932b0532cc9b08bd0a8529aecf6d/tensorflow%2Fcompiler%2Ftests%2Fxla_device_test.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Ftests%2Fxla_device_test.py?ref=cbe97bdd2f47932b0532cc9b08bd0a8529aecf6d",
            "patch": "@@ -31,9 +31,9 @@ def testCopies(self):\n     \"\"\"Tests that copies onto and off XLA devices work.\"\"\"\n     shapes = [[0], [1], [1, 0], [1024, 0], [1024, 1], [3, 777], [777, 3],\n               [16384, 1], [1, 16384], [1, 20000, 1, 1]]\n-    for dtype in self.numeric_types:\n-      for shape in shapes:\n-        with self.session() as sess:\n+    with self.session() as sess:\n+      for dtype in self.numeric_types:\n+        for shape in shapes:\n           with ops.device(\"CPU\"):\n             x = array_ops.placeholder(dtype, shape)\n           with self.test_scope():\n@@ -53,8 +53,8 @@ def testCopiesOfUnsupportedTypesFailGracefully(self):\n         dtypes.bfloat16.as_numpy_dtype\n     ])\n     shape = (10, 10)\n-    for unsupported_dtype in test_types - self.all_types:\n-      with self.session() as sess:\n+    with self.session() as sess:\n+      for unsupported_dtype in test_types - self.all_types:\n         with ops.device(\"CPU\"):\n           x = array_ops.placeholder(unsupported_dtype, shape)\n         with self.test_scope():"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}