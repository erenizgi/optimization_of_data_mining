{
    "author": "ezhulenev",
    "message": "[xla:pjrt] Move ScopedAsyncTrackingEvent to a separate target\n\nIn preparation for removing pjrt_future.h header file move ScopedAsyncTrackingEvent, which is only used by PjRtDevice to a separate target.\n\nPiperOrigin-RevId: 812457192",
    "sha": "8f557b12eed1c94613e0574edc43ef549a81c4f4",
    "files": [
        {
            "sha": "85c9342ddbb78d8a54445314939da9759d94ac32",
            "filename": "third_party/xla/xla/pjrt/BUILD",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD?ref=8f557b12eed1c94613e0574edc43ef549a81c4f4",
            "patch": "@@ -271,6 +271,7 @@ cc_library(\n         \":pjrt_executable\",\n         \":pjrt_future\",\n         \":pjrt_layout\",\n+        \":scoped_async_tracking_event\",\n         \":utils\",\n         \"//xla:future\",\n         \"//xla:literal\",\n@@ -808,6 +809,17 @@ cc_library(\n     ],\n )\n \n+cc_library(\n+    name = \"scoped_async_tracking_event\",\n+    hdrs = [\"scoped_async_tracking_event.h\"],\n+    visibility = internal_visibility([\":friends\"]),\n+    deps = [\n+        \"//xla:future\",\n+        \"//xla/tsl/concurrency:async_value\",\n+        \"//xla/tsl/concurrency:ref_count\",\n+    ],\n+)\n+\n cc_library(\n     name = \"host_memory_spaces\",\n     srcs = [\"host_memory_spaces.cc\"],"
        },
        {
            "sha": "e48f7308204882527228d651dadf66809a30b9a8",
            "filename": "third_party/xla/xla/pjrt/pjrt_client.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_client.h?ref=8f557b12eed1c94613e0574edc43ef549a81c4f4",
            "patch": "@@ -51,8 +51,8 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/pjrt_layout.h\"\n+#include \"xla/pjrt/scoped_async_tracking_event.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/hlo_cost_analysis.h\"\n #include \"xla/shape.h\""
        },
        {
            "sha": "32aca76113858870c9c9b8bb72f11be9f1fbe89f",
            "filename": "third_party/xla/xla/pjrt/pjrt_future.h",
            "status": "modified",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_future.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_future.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_future.h?ref=8f557b12eed1c94613e0574edc43ef549a81c4f4",
            "patch": "@@ -18,8 +18,6 @@ limitations under the License.\n \n #include \"absl/base/macros.h\"\n #include \"xla/future.h\"\n-#include \"xla/tsl/concurrency/async_value.h\"\n-#include \"xla/tsl/concurrency/ref_count.h\"\n \n namespace xla {\n \n@@ -28,38 +26,6 @@ using PjRtFuture ABSL_DEPRECATE_AND_INLINE() = ::xla::Future<T>;\n \n using PjRtFutureHelpers ABSL_DEPRECATE_AND_INLINE() = ::xla::FutureHelpers;\n \n-// An RAII event that a caller can use to tell the PjRtClient about asynchronous\n-// actions outside PjRt.\n-//\n-// A ScopedAsyncTrackingEvent can be generated by the caller by calling a method\n-// on PjRtDevice, and the creation of a ScopedAsyncTrackingEvent tells the\n-// PjRtClient that the client is creating some outstanding asynchronous work\n-// that depends on activities happening on the PjRtDevice.\n-//\n-// The caller can indicate that a ScopedAsyncTrackingEvent event cannot complete\n-// until after some PjRtFuture becomes ready, by calling\n-// event.AddDependency(future).\n-//\n-// The caller indicates that the work tracked by the ScopedAsyncTrackingEvent\n-// has completed by letting the event go out of scope.\n-//\n-// ScopedAsyncTrackingEvent is used by some PjRtClient implementations to\n-// monitor system-wide dependencies.\n-class ScopedAsyncTrackingEvent {\n- public:\n-  virtual ~ScopedAsyncTrackingEvent() = default;\n-\n-  template <typename T>\n-  void AddDependency(const PjRtFuture<T>& future) {\n-    AddDependency(FormRef(future.async_value()));\n-  }\n-\n- private:\n-  // Indicates that the ScopedAsyncTrackingEvent won't complete until dependency\n-  // becomes available. Called only by PjRtFuture.\n-  virtual void AddDependency(tsl::RCReference<tsl::AsyncValue> dependency) = 0;\n-};\n-\n }  // namespace xla\n \n #endif  // XLA_PJRT_PJRT_FUTURE_H_"
        },
        {
            "sha": "6fe14eb7db848d4bada8100ca4609e98cdcc3af0",
            "filename": "third_party/xla/xla/pjrt/scoped_async_tracking_event.h",
            "status": "added",
            "additions": 59,
            "deletions": 0,
            "changes": 59,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fscoped_async_tracking_event.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8f557b12eed1c94613e0574edc43ef549a81c4f4/third_party%2Fxla%2Fxla%2Fpjrt%2Fscoped_async_tracking_event.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fscoped_async_tracking_event.h?ref=8f557b12eed1c94613e0574edc43ef549a81c4f4",
            "patch": "@@ -0,0 +1,59 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_PJRT_SCOPED_ASYNC_TRACKING_EVENT_H_\n+#define XLA_PJRT_SCOPED_ASYNC_TRACKING_EVENT_H_\n+\n+#include \"xla/future.h\"\n+#include \"xla/tsl/concurrency/async_value.h\"\n+#include \"xla/tsl/concurrency/ref_count.h\"\n+\n+namespace xla {\n+\n+// An RAII event that a caller can use to tell the PjRtClient about asynchronous\n+// actions outside PjRt.\n+//\n+// A ScopedAsyncTrackingEvent can be generated by the caller by calling a method\n+// on PjRtDevice, and the creation of a ScopedAsyncTrackingEvent tells the\n+// PjRtClient that the client is creating some outstanding asynchronous work\n+// that depends on activities happening on the PjRtDevice.\n+//\n+// The caller can indicate that a ScopedAsyncTrackingEvent event cannot complete\n+// until after some PjRtFuture becomes ready, by calling\n+// event.AddDependency(future).\n+//\n+// The caller indicates that the work tracked by the ScopedAsyncTrackingEvent\n+// has completed by letting the event go out of scope.\n+//\n+// ScopedAsyncTrackingEvent is used by some PjRtClient implementations to\n+// monitor system-wide dependencies.\n+class ScopedAsyncTrackingEvent {\n+ public:\n+  virtual ~ScopedAsyncTrackingEvent() = default;\n+\n+  template <typename T>\n+  void AddDependency(const Future<T>& future) {\n+    AddDependency(FormRef(future.async_value()));\n+  }\n+\n+ private:\n+  // Indicates that the ScopedAsyncTrackingEvent won't complete until dependency\n+  // becomes available.\n+  virtual void AddDependency(tsl::RCReference<tsl::AsyncValue> dependency) = 0;\n+};\n+\n+}  // namespace xla\n+\n+#endif  // XLA_PJRT_SCOPED_ASYNC_TRACKING_EVENT_H_"
        }
    ],
    "stats": {
        "total": 107,
        "additions": 72,
        "deletions": 35
    }
}