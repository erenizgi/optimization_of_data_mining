{
    "author": "beckerhe",
    "message": "Remove unused dependencies and conditional compilation from XLA GPU emitter transforms.\n\nThis change prunes unnecessary dependencies from the `passes` target in //third_party/tensorflow/compiler/xla/backends/gpu/codegen/emitters/transforms/BUILD. It also removes conditional compilation flags and dependencies related to CUDA and ROCM, as they are not required for the current functionality. Additionally, it updates convert_float_amd.cc to use proto2::TextFormat directly.\n\nPiperOrigin-RevId: 846589876",
    "sha": "5451b22b40d7ef3c9881040edc6647df05d11bf0",
    "files": [
        {
            "sha": "2446234eacb08906fec144ed81dd6b724ae690ef",
            "filename": "third_party/xla/xla/backends/gpu/codegen/emitters/transforms/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 26,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5451b22b40d7ef3c9881040edc6647df05d11bf0/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5451b22b40d7ef3c9881040edc6647df05d11bf0/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2FBUILD?ref=5451b22b40d7ef3c9881040edc6647df05d11bf0",
            "patch": "@@ -1,10 +1,5 @@\n load(\"@llvm-project//mlir:tblgen.bzl\", \"gentbl_cc_library\")\n-load(\"@local_config_rocm//rocm:build_defs.bzl\", \"if_rocm_is_configured\")\n load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n-load(\n-    \"//xla/tsl/platform/default:cuda_build_defs.bzl\",\n-    \"if_cuda_is_configured\",\n-)\n \n package(\n     # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n@@ -43,37 +38,22 @@ cc_library(\n         \"recover_exp2.cc\",\n     ],\n     hdrs = [\"passes.h\"],\n-    copts = if_cuda_is_configured([\"-DGOOGLE_CUDA=1\"]) + if_rocm_is_configured([\"-DTENSORFLOW_USE_ROCM=1\"]),\n     deps = [\n         \":passes_inc_gen\",\n-        \"//xla:shape_util\",\n-        \"//xla:util\",\n         \"//xla/backends/gpu/codegen/emitters/ir:xla_gpu\",\n         \"//xla/codegen/emitters/ir:xla\",\n-        \"//xla/codegen/emitters/ir:xla_dialect_inc_gen\",\n-        \"//xla/codegen/emitters/transforms:atomic_rmw_utils\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n-        \"//xla/mlir_hlo\",\n-        \"//xla/mlir_hlo:map_mhlo_to_scalar_op\",\n         \"//xla/service/gpu:gpu_fusible\",\n-        \"//xla/service/gpu:ir_emission_utils\",\n         \"//xla/stream_executor:device_description\",\n         \"//xla/stream_executor:device_description_proto_cc\",\n-        \"//xla/stream_executor:semantic_version\",\n         \"//xla/stream_executor/rocm:rocm_compute_capability\",\n-        \"//xla/tsl/platform:status\",\n         \"@com_google_absl//absl/algorithm:container\",\n-        \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_protobuf//:protobuf\",\n         \"@llvm-project//llvm:Support\",\n-        \"@llvm-project//mlir:AffineDialect\",\n-        \"@llvm-project//mlir:AffineUtils\",\n         \"@llvm-project//mlir:ArithDialect\",\n-        \"@llvm-project//mlir:CallOpInterfaces\",\n-        \"@llvm-project//mlir:ComplexDialect\",\n         \"@llvm-project//mlir:DataLayoutInterfaces\",\n         \"@llvm-project//mlir:FuncDialect\",\n         \"@llvm-project//mlir:GPUDialect\",\n@@ -88,10 +68,5 @@ cc_library(\n         \"@llvm-project//mlir:TensorDialect\",\n         \"@llvm-project//mlir:TransformUtils\",\n         \"@llvm-project//mlir:VectorDialect\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n-    ] + if_cuda_is_configured([\n-        \"//xla/service/gpu/llvm_gpu_backend:nvptx_backend\",\n-    ]) + if_rocm_is_configured([\n-        \"//xla/service/gpu/llvm_gpu_backend:amdgpu_backend\",\n-    ]),\n+    ],\n )"
        },
        {
            "sha": "1e7d6464ad1d0f99bbf54fd31b12906f569346fb",
            "filename": "third_party/xla/xla/backends/gpu/codegen/emitters/transforms/convert_float_amd.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5451b22b40d7ef3c9881040edc6647df05d11bf0/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Fconvert_float_amd.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5451b22b40d7ef3c9881040edc6647df05d11bf0/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Fconvert_float_amd.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Fconvert_float_amd.cc?ref=5451b22b40d7ef3c9881040edc6647df05d11bf0",
            "patch": "@@ -43,11 +43,11 @@ limitations under the License.\n #include \"mlir/Pass/Pass.h\"\n #include \"mlir/Support/LLVM.h\"\n #include \"mlir/Transforms/GreedyPatternRewriteDriver.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/backends/gpu/codegen/emitters/transforms/passes.h\"\n #include \"xla/stream_executor/device_description.h\"\n #include \"xla/stream_executor/device_description.pb.h\"\n #include \"xla/stream_executor/rocm/rocm_compute_capability.h\"\n-#include \"tsl/platform/protobuf.h\"\n \n namespace xla {\n namespace gpu {\n@@ -561,8 +561,8 @@ class ConvertFloatAMDPass\n   void runOnOperation() override {\n     if (!gpu_device_info_.empty()) {\n       se::GpuDeviceInfoProto device_info;\n-      CHECK(tsl::protobuf::TextFormat::ParseFromString(gpu_device_info_,\n-                                                       &device_info));\n+      CHECK(\n+          google::protobuf::TextFormat::ParseFromString(gpu_device_info_, &device_info));\n       absl::StatusOr<se::DeviceDescription> device_description =\n           se::DeviceDescription::FromProto(device_info);\n       CHECK_OK(device_description.status());"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 4,
        "deletions": 29
    }
}