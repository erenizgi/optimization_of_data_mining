{
    "author": "WillFroom",
    "message": "[XLA:CPU/GPU] Move affine map evaluator to shared directory.\n\nPiperOrigin-RevId: 813733107",
    "sha": "b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
    "files": [
        {
            "sha": "41e697b6c8fa6c8df244879c4208dcad515d6135",
            "filename": "third_party/xla/xla/codegen/tiling/BUILD",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2FBUILD?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -109,3 +109,30 @@ xla_cc_test(\n         \"@llvm-project//mlir:IR\",\n     ],\n )\n+\n+cc_library(\n+    name = \"affine_map_evaluator\",\n+    srcs = [\"affine_map_evaluator.cc\"],\n+    hdrs = [\"affine_map_evaluator.h\"],\n+    deps = [\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/types:span\",\n+        \"@llvm-project//llvm:Support\",\n+        \"@llvm-project//mlir:IR\",\n+        \"@llvm-project//mlir:Support\",\n+        \"@local_tsl//tsl/platform:logging\",\n+    ],\n+)\n+\n+xla_cc_test(\n+    name = \"affine_map_evaluator_test\",\n+    srcs = [\"affine_map_evaluator_test.cc\"],\n+    deps = [\n+        \":affine_map_evaluator\",\n+        \"//xla/hlo/testlib:hlo_hardware_independent_test_base\",\n+        \"//xla/tests:xla_internal_test_main\",\n+        \"@com_google_googletest//:gtest\",\n+        \"@llvm-project//mlir:IR\",\n+        \"@local_tsl//tsl/platform:test\",\n+    ],\n+)"
        },
        {
            "sha": "4c79247b98d64615c6807508057b79aef3457bb4",
            "filename": "third_party/xla/xla/codegen/tiling/affine_map_evaluator.cc",
            "status": "renamed",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n \n #include <cstdint>\n \n@@ -26,7 +26,6 @@ limitations under the License.\n #include \"tsl/platform/logging.h\"  // IWYU pragma: keep\n \n namespace xla {\n-namespace gpu {\n \n namespace {\n \n@@ -90,5 +89,4 @@ SmallVector<int64_t> EvaluateAffineMap(\n   return results;\n }\n \n-}  // namespace gpu\n }  // namespace xla",
            "previous_filename": "third_party/xla/xla/service/gpu/model/affine_map_evaluator.cc"
        },
        {
            "sha": "f67725734f0803d3db78b95eed8b333cf93c3997",
            "filename": "third_party/xla/xla/codegen/tiling/affine_map_evaluator.h",
            "status": "renamed",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator.h?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -13,8 +13,8 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#ifndef XLA_SERVICE_GPU_MODEL_AFFINE_MAP_EVALUATOR_H_\n-#define XLA_SERVICE_GPU_MODEL_AFFINE_MAP_EVALUATOR_H_\n+#ifndef XLA_CODEGEN_TILING_AFFINE_MAP_EVALUATOR_H_\n+#define XLA_CODEGEN_TILING_AFFINE_MAP_EVALUATOR_H_\n \n #include <cstdint>\n #include <vector>\n@@ -25,7 +25,6 @@ limitations under the License.\n #include \"mlir/IR/AffineMap.h\"\n \n namespace xla {\n-namespace gpu {\n \n // Given an AffineExpr and the values for its dimensions and symbols, evaluates\n // the result.\n@@ -39,7 +38,6 @@ llvm::SmallVector<int64_t> EvaluateAffineMap(\n     mlir::AffineMap affine_map, absl::Span<int64_t const> dim_values,\n     absl::Span<int64_t const> symbol_values = {});\n \n-}  // namespace gpu\n }  // namespace xla\n \n-#endif  // XLA_SERVICE_GPU_MODEL_AFFINE_MAP_EVALUATOR_H_\n+#endif  // XLA_CODEGEN_TILING_AFFINE_MAP_EVALUATOR_H_",
            "previous_filename": "third_party/xla/xla/service/gpu/model/affine_map_evaluator.h"
        },
        {
            "sha": "dc42671fcfbcb4bd3cbdd9e0698defbbf5ddd40d",
            "filename": "third_party/xla/xla/codegen/tiling/affine_map_evaluator_test.cc",
            "status": "renamed",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftiling%2Faffine_map_evaluator_test.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n@@ -24,7 +24,6 @@ limitations under the License.\n #include \"tsl/platform/test.h\"\n \n namespace xla {\n-namespace gpu {\n namespace {\n \n using ::mlir::AffineExpr;\n@@ -57,5 +56,4 @@ TEST_F(AffineMapEvaluator, EvaluateMap) {\n }\n \n }  // namespace\n-}  // namespace gpu\n }  // namespace xla",
            "previous_filename": "third_party/xla/xla/service/gpu/model/affine_map_evaluator_test.cc"
        },
        {
            "sha": "b2bff768cfd7788648605278d0bdb5b225f0b9b1",
            "filename": "third_party/xla/xla/service/gpu/model/BUILD",
            "status": "modified",
            "additions": 5,
            "deletions": 32,
            "changes": 37,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2FBUILD?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -584,39 +584,12 @@ xla_cc_test(\n     ],\n )\n \n-cc_library(\n-    name = \"affine_map_evaluator\",\n-    srcs = [\"affine_map_evaluator.cc\"],\n-    hdrs = [\"affine_map_evaluator.h\"],\n-    deps = [\n-        \"@com_google_absl//absl/log\",\n-        \"@com_google_absl//absl/types:span\",\n-        \"@llvm-project//llvm:Support\",\n-        \"@llvm-project//mlir:IR\",\n-        \"@llvm-project//mlir:Support\",\n-        \"@local_tsl//tsl/platform:logging\",\n-    ],\n-)\n-\n-xla_cc_test(\n-    name = \"affine_map_evaluator_test\",\n-    srcs = [\"affine_map_evaluator_test.cc\"],\n-    deps = [\n-        \":affine_map_evaluator\",\n-        \"//xla/hlo/testlib:hlo_hardware_independent_test_base\",\n-        \"//xla/tests:xla_internal_test_main\",\n-        \"@com_google_googletest//:gtest\",\n-        \"@llvm-project//mlir:IR\",\n-        \"@local_tsl//tsl/platform:test\",\n-    ],\n-)\n-\n cc_library(\n     name = \"constraint_expression\",\n     srcs = [\"constraint_expression.cc\"],\n     hdrs = [\"constraint_expression.h\"],\n     deps = [\n-        \":affine_map_evaluator\",\n+        \"//xla/codegen/tiling:affine_map_evaluator\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n@@ -665,9 +638,9 @@ cc_library(\n     srcs = [\"symbolic_tile.cc\"],\n     hdrs = [\"symbolic_tile.h\"],\n     deps = [\n-        \":affine_map_evaluator\",\n         \":constraint_expression\",\n         \":size_and_stride_expression\",\n+        \"//xla/codegen/tiling:affine_map_evaluator\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/log\",\n@@ -683,8 +656,8 @@ xla_cc_test(\n     name = \"symbolic_tile_test\",\n     srcs = [\"symbolic_tile_test.cc\"],\n     deps = [\n-        \":affine_map_evaluator\",\n         \":symbolic_tile\",\n+        \"//xla/codegen/tiling:affine_map_evaluator\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n         \"//xla/hlo/analysis:indexing_test_utils\",\n         \"//xla/tests:xla_internal_test_main\",\n@@ -818,13 +791,13 @@ cc_library(\n     srcs = [\"triton_emitter_constraints.cc\"],\n     hdrs = [\"triton_emitter_constraints.h\"],\n     deps = [\n-        \":affine_map_evaluator\",\n         \":constraint_expression\",\n         \":symbolic_tile\",\n         \":symbolic_tile_analysis\",\n         \":symbolic_tiled_hlo_instruction\",\n         \"//xla:shape_util\",\n         \"//xla:util\",\n+        \"//xla/codegen/tiling:affine_map_evaluator\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n         \"//xla/hlo/analysis:interval\",\n         \"//xla/hlo/ir:hlo\",\n@@ -870,12 +843,12 @@ cc_library(\n     srcs = [\"coalescing_analysis.cc\"],\n     hdrs = [\"coalescing_analysis.h\"],\n     deps = [\n-        \":affine_map_evaluator\",\n         \"//xla:shape_util\",\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/backends/gpu/codegen:fusion_emitter\",\n         \"//xla/backends/gpu/codegen:fusions\",\n+        \"//xla/codegen/tiling:affine_map_evaluator\",\n         \"//xla/codegen/tiling:tiled_hlo_instruction\",\n         \"//xla/hlo/analysis:indexing_analysis\",\n         \"//xla/hlo/ir:hlo\","
        },
        {
            "sha": "b7d1148409fc92c5242ba03a00e25516de632906",
            "filename": "third_party/xla/xla/service/gpu/model/coalescing_analysis.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -34,6 +34,7 @@ limitations under the License.\n #include \"mlir/Support/LLVM.h\"\n #include \"xla/backends/gpu/codegen/fusion_emitter.h\"\n #include \"xla/backends/gpu/codegen/fusions.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n #include \"xla/hlo/analysis/indexing_analysis.h\"\n #include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n@@ -42,7 +43,6 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/service/gpu/gpu_fusible.h\"\n #include \"xla/service/gpu/hlo_fusion_analysis.h\"\n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/stream_executor/device_description.h\""
        },
        {
            "sha": "803699693d76418c8644e669a04dba169c720725",
            "filename": "third_party/xla/xla/service/gpu/model/constraint_expression.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fconstraint_expression.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fconstraint_expression.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fconstraint_expression.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -38,9 +38,9 @@ limitations under the License.\n #include \"mlir/IR/AffineExpr.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"mlir/Support/LLVM.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n #include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/hlo/analysis/indexing_map_serialization.h\"\n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n \n namespace xla {\n namespace gpu {"
        },
        {
            "sha": "d9e13592b8b44b89f5e40d2d79095828a865553a",
            "filename": "third_party/xla/xla/service/gpu/model/symbolic_tile.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -36,9 +36,9 @@ limitations under the License.\n #include \"mlir/IR/AffineMap.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"mlir/Support/LLVM.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n #include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/hlo/analysis/indexing_map_serialization.h\"\n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n #include \"xla/service/gpu/model/constraint_expression.h\"\n #include \"xla/service/gpu/model/size_and_stride_expression.h\"\n "
        },
        {
            "sha": "8be325b60f375a3d4047572c2e96bd60de5f9914",
            "filename": "third_party/xla/xla/service/gpu/model/symbolic_tile_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fsymbolic_tile_test.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -22,10 +22,10 @@ limitations under the License.\n #include <gtest/gtest.h>\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n #include \"xla/hlo/analysis/indexing_analysis.h\"\n #include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/hlo/analysis/indexing_test_utils.h\"\n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n \n namespace xla {\n namespace gpu {"
        },
        {
            "sha": "adfb2331fe25dd601de750dfacc26811c9e471c1",
            "filename": "third_party/xla/xla/service/gpu/model/triton_emitter_constraints.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Ftriton_emitter_constraints.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Ftriton_emitter_constraints.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Ftriton_emitter_constraints.cc?ref=b8ef6d1d7c5522c8dbe99efa9a3ad73544d51481",
            "patch": "@@ -35,14 +35,14 @@ limitations under the License.\n #include \"mlir/IR/AffineExpr.h\"\n #include \"mlir/IR/AffineMap.h\"\n #include \"mlir/IR/MLIRContext.h\"\n+#include \"xla/codegen/tiling/affine_map_evaluator.h\"\n #include \"xla/hlo/analysis/indexing_analysis.h\"\n #include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/hlo/analysis/indexing_map_serialization.h\"\n #include \"xla/hlo/analysis/interval.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/utils/hlo_traversal.h\"\n-#include \"xla/service/gpu/model/affine_map_evaluator.h\"\n #include \"xla/service/gpu/model/constraint_expression.h\"\n #include \"xla/service/gpu/model/symbolic_tile.h\"\n #include \"xla/service/gpu/model/symbolic_tile_analysis.h\""
        }
    ],
    "stats": {
        "total": 90,
        "additions": 42,
        "deletions": 48
    }
}