{
    "author": "tensorflower-gardener",
    "message": "Guard for `effect.getValue() == nullptr` before getDefiningOp on it in CopyCleanUpPass.\n\nIf memory effect is attached to an op rather than an OpOperand, the `effect.getValue()` can be nullptr.\n\nPiperOrigin-RevId: 798861213",
    "sha": "4063db39a645c6705cb0962b96fe2f0d28ef8bad",
    "files": [
        {
            "sha": "d590a953232018fe6a0792aeba31db9df84ed1d5",
            "filename": "tensorflow/compiler/mlir/tools/kernel_gen/transforms/copy_cleanup_pass.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4063db39a645c6705cb0962b96fe2f0d28ef8bad/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Fcopy_cleanup_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4063db39a645c6705cb0962b96fe2f0d28ef8bad/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Fcopy_cleanup_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Ftools%2Fkernel_gen%2Ftransforms%2Fcopy_cleanup_pass.cc?ref=4063db39a645c6705cb0962b96fe2f0d28ef8bad",
            "patch": "@@ -104,10 +104,12 @@ void RemoveCopyIfTargetOnlyRead(func::FuncOp func) {\n       SmallVector<MemoryEffects::EffectInstance, 2> effects;\n       effect_interface.getEffects<MemoryEffects::Write>(effects);\n       for (auto effect : effects) {\n-        if (auto alloc = effect.getValue().getDefiningOp<memref::AllocOp>()) {\n-          if (alloc->getBlock() == copy->getBlock() &&\n-              copy->isBeforeInBlock(alloc)) {\n-            continue;\n+        if (effect.getValue() != nullptr) {\n+          if (auto alloc = effect.getValue().getDefiningOp<memref::AllocOp>()) {\n+            if (alloc->getBlock() == copy->getBlock() &&\n+                copy->isBeforeInBlock(alloc)) {\n+              continue;\n+            }\n           }\n         }\n         source_is_mutated = true;"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 6,
        "deletions": 4
    }
}