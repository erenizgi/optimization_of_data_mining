{
    "author": "tensorflower-gardener",
    "message": "Use the new `tsl::proto_testing::EquivToProto` in \"python/ifrt_proxy/client/client_test.cc\".\n\nPiperOrigin-RevId: 798309860",
    "sha": "3c460b428c3b37ab94aaaac5fe2f168bb8d49730",
    "files": [
        {
            "sha": "54cdf4bfd11522e17d0f81331c8f0e5f850369ba",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3c460b428c3b37ab94aaaac5fe2f168bb8d49730/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3c460b428c3b37ab94aaaac5fe2f168bb8d49730/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD?ref=3c460b428c3b37ab94aaaac5fe2f168bb8d49730",
            "patch": "@@ -214,15 +214,15 @@ ifrt_proxy_cc_test(\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/tsl/concurrency:ref_count\",\n-        \"//xla/tsl/platform:status_matchers\",\n         \"//xla/tsl/platform:statusor\",\n+        \"//xla/tsl/util/proto:proto_matchers\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:status_matchers\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/types:span\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@llvm-project//llvm:Support\",\n-        \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:protobuf\",\n     ],\n )"
        },
        {
            "sha": "a5de0be104876cd713b75af6c3ce843695de0496",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3c460b428c3b37ab94aaaac5fe2f168bb8d49730/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3c460b428c3b37ab94aaaac5fe2f168bb8d49730/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc?ref=3c460b428c3b37ab94aaaac5fe2f168bb8d49730",
            "patch": "@@ -22,6 +22,7 @@\n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n #include \"absl/status/status.h\"\n+#include \"absl/status/status_matchers.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n@@ -49,9 +50,8 @@\n #include \"xla/python/ifrt_proxy/common/types.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n-#include \"xla/tsl/platform/status_matchers.h\"\n #include \"xla/tsl/platform/statusor.h\"\n-#include \"tsl/platform/platform.h\"\n+#include \"xla/tsl/util/proto/proto_matchers.h\"\n #include \"tsl/platform/protobuf.h\"  // IWYU pragma: keep\n \n namespace xla {\n@@ -66,13 +66,9 @@ using ::testing::Pointee;\n using ::testing::Return;\n using ::testing::SizeIs;\n using ::testing::UnorderedElementsAre;\n-using ::tsl::testing::IsOk;\n-using ::tsl::testing::IsOkAndHolds;\n \n-#if defined(PLATFORM_GOOGLE)\n-using ::testing::EquivToProto;\n-using ::testing::proto::Partially;\n-#endif\n+using ::tsl::proto_testing::EquivToProto;\n+using ::tsl::proto_testing::Partially;\n \n class ClientTest : public ::testing::TestWithParam</*protocol_version=*/int> {\n  protected:\n@@ -430,8 +426,6 @@ TEST_P(ClientTest, CopyArraysCustomLayoutSuccess) {\n       layout_2_->ToString());\n }\n \n-// TODO(b/315809436): Test needs rewrite because protobuf matchers are not OSS\n-#if defined(PLATFORM_GOOGLE)\n TEST_P(ClientTest, GetDefaultDeviceAssignmentSuccess) {\n   IfrtResponse response;\n   xla::DeviceAssignment assignment(1, 3);\n@@ -453,10 +447,7 @@ TEST_P(ClientTest, GetDefaultDeviceAssignmentSuccess) {\n   EXPECT_EQ(assignment_got.replica_count(), 1);\n   EXPECT_EQ(assignment_got.computation_count(), 3);\n }\n-#endif\n \n-// TODO(b/315809436): Test needs rewrite because protobuf matchers are not OSS\n-#if defined(PLATFORM_GOOGLE)\n TEST_P(ClientTest, GetDefaultDeviceAssignmentFailure) {\n   EXPECT_CALL(*session_, Enqueue(Pointee(Partially(EquivToProto(\n                              R\"pb(\n@@ -471,7 +462,6 @@ TEST_P(ClientTest, GetDefaultDeviceAssignmentFailure) {\n   EXPECT_THAT(client_->GetDefaultDeviceAssignment(1, 3),\n               Not(absl_testing::IsOk()));\n }\n-#endif\n \n INSTANTIATE_TEST_SUITE_P(\n     ClientTestWithAllVersions, ClientTest,"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 6,
        "deletions": 16
    }
}