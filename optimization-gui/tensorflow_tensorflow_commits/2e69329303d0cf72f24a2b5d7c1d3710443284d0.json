{
    "author": "junwhanahn",
    "message": "Verify that input arrays are on the expected devices before execution\n\nThis is to generate more helpful error messages than failing at the IFRT op execution level, e.g., `CopyArrays` complaining about mismatching devices.\n\nPiperOrigin-RevId: 837895552",
    "sha": "2e69329303d0cf72f24a2b5d7c1d3710443284d0",
    "files": [
        {
            "sha": "a06ae96b394215397d2ce7e4caca5cff4ba19158",
            "filename": "third_party/xla/xla/python/ifrt/ir/program_interpreter.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e69329303d0cf72f24a2b5d7c1d3710443284d0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fprogram_interpreter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e69329303d0cf72f24a2b5d7c1d3710443284d0/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fprogram_interpreter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fir%2Fprogram_interpreter.cc?ref=2e69329303d0cf72f24a2b5d7c1d3710443284d0",
            "patch": "@@ -220,6 +220,13 @@ absl::StatusOr<ExecuteResult> ProgramInterpreter::Execute(\n           \"Input array #\", idx, \" of program \", program_->program_name,\n           \" has already been deleted or donated.\"));\n     }\n+    if (array->sharding().devices() !=\n+        program_->in_specs[idx].sharding->devices()) {\n+      return absl::InvalidArgumentError(absl::StrCat(\n+          \"Program \", program_->program_name, \" expects input array #\", idx,\n+          \" to be on devices \", program_->in_specs[idx].sharding->devices(),\n+          \" but it is on devices \", array->sharding().devices(), \".\"));\n+    }\n   }\n \n   Environment env;"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}