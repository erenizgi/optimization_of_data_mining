{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::Cancelled in xla\n\nThis change replaces usages of tsl::errors::Cancelled with absl::CancelledError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nChanges:\n- Replaced errors::Cancelled with absl::CancelledError.\n- Used absl::StrCat to construct error messages where necessary.\nPiperOrigin-RevId: 837505397",
    "sha": "1ffcd1c05d57e5acf512a54964b26e52a13eea94",
    "files": [
        {
            "sha": "45ba9f85252dc13aca4c300ea0347cf43ce45048",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/preemption/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2FBUILD?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -19,8 +19,10 @@ cc_library(\n     compatible_with = get_compatible_with_portable(),\n     deps = [\n         \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\","
        },
        {
            "sha": "ef8b060d189dfe95a4e8ed9ad8293d468b23cf90",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/preemption/preemption_notifier.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2Fpreemption_notifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2Fpreemption_notifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Fpreemption%2Fpreemption_notifier.cc?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -20,13 +20,14 @@ limitations under the License.\n #include <memory>\n #include <utility>\n \n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/status/statusor.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/synchronization/notification.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n #include \"xla/tsl/platform/env.h\"\n-#include \"xla/tsl/platform/errors.h\"\n-#include \"xla/tsl/platform/statusor.h\"\n #if defined(PLATFORM_GOOGLE)\n #include \"thread/executor.h\"\n #include \"thread/signal.h\"\n@@ -80,7 +81,7 @@ void SigtermNotifier::StartListenerThread() {\n             // 1) Cancel any pending callbacks and blocking WillBePreemptedAt()\n             // calls.\n             NotifyRegisteredListeners(\n-                errors::Cancelled(\"Preemption notifier is being deleted.\"));\n+                absl::CancelledError(\"Preemption notifier is being deleted.\"));\n             // 2) Exit listener thread.\n             return;\n           }"
        },
        {
            "sha": "c7f2ff5e398b7aa046a2bdc429cec31e24dc29b7",
            "filename": "third_party/xla/xla/tsl/framework/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2FBUILD?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -366,11 +366,12 @@ cc_library(\n     visibility = [\"//visibility:public\"],\n     deps = [\n         \"//xla/tsl/lib/gtl:flatmap\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/memory\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@local_tsl//tsl/platform:hash\",\n         \"@local_tsl//tsl/platform:stringpiece\","
        },
        {
            "sha": "8380fc2493c9bf48c765a7fbd94b488fbc5d0a99",
            "filename": "third_party/xla/xla/tsl/framework/cancellation.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.cc?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -15,11 +15,19 @@ limitations under the License.\n \n #include \"xla/tsl/framework/cancellation.h\"\n \n+#include <atomic>\n #include <forward_list>\n+#include <functional>\n+#include <memory>\n+#include <string>\n+#include <utility>\n \n #include \"absl/memory/memory.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n-#include \"xla/tsl/platform/errors.h\"\n+#include \"absl/synchronization/notification.h\"\n+#include \"xla/tsl/lib/gtl/flatmap.h\"\n #include \"xla/tsl/platform/logging.h\"\n #include \"xla/tsl/platform/status.h\"\n \n@@ -116,7 +124,7 @@ bool CancellationManager::RegisterCallbackConfig(CancellationToken token,\n   bool should_register = !is_cancelled_ && !is_cancelling_;\n   if (should_register) {\n     if (!state_) {\n-      state_ = absl::make_unique<State>();\n+      state_ = std::make_unique<State>();\n     }\n     std::swap(state_->callbacks[token], config);\n   }\n@@ -240,7 +248,7 @@ absl::Status RegisterCancellationCallback(\n   if (cancellation_manager) {\n     CancellationToken token = cancellation_manager->get_cancellation_token();\n     if (!cancellation_manager->RegisterCallback(token, std::move(callback))) {\n-      return errors::Cancelled(\"Operation was cancelled\");\n+      return absl::CancelledError(\"Operation was cancelled\");\n     }\n     *deregister_fn = [cancellation_manager, token]() {\n       cancellation_manager->DeregisterCallback(token);"
        },
        {
            "sha": "f3156cbcaccb678a882ae68650f376894f198c56",
            "filename": "third_party/xla/xla/tsl/framework/cancellation.h",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fcancellation.h?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -17,15 +17,16 @@ limitations under the License.\n #define XLA_TSL_FRAMEWORK_CANCELLATION_H_\n \n #include <atomic>\n+#include <cstdint>\n #include <functional>\n+#include <memory>\n+#include <string>\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/synchronization/notification.h\"\n #include \"xla/tsl/lib/gtl/flatmap.h\"\n-#include \"xla/tsl/platform/status.h\"\n-#include \"xla/tsl/platform/types.h\"\n-#include \"tsl/platform/hash.h\"\n-#include \"tsl/platform/stringpiece.h\"\n #include \"tsl/platform/thread_annotations.h\"\n \n namespace tsl {\n@@ -109,7 +110,7 @@ class CancellationManager {\n   //       }\n   //     }\n   //     if (already_cancelled) {\n-  //       callback(errors::Cancelled(\"Operation was cancelled\"));\n+  //       callback(absl::CancelledError(\"Operation was cancelled\"));\n   //     }\n   //   }\n   //"
        },
        {
            "sha": "f7b6ac89602d3c549daec15b5a75fdd7f9f1a849",
            "filename": "third_party/xla/xla/tsl/platform/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -639,13 +639,13 @@ tsl_cc_test(\n     size = \"small\",\n     srcs = [\"statusor_test.cc\"],\n     deps = [\n-        \":errors\",\n         \":macros\",\n         \":statusor\",\n         \":test\",\n         \":test_benchmark\",\n         \":test_main\",\n-        \"@com_google_absl//absl/base:config\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:statusor\",\n     ],\n )\n "
        },
        {
            "sha": "d626582c9c5f96081219832afd9b3ef902a1ef4c",
            "filename": "third_party/xla/xla/tsl/platform/statusor_test.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatusor_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ffcd1c05d57e5acf512a54964b26e52a13eea94/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatusor_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatusor_test.cc?ref=1ffcd1c05d57e5acf512a54964b26e52a13eea94",
            "patch": "@@ -18,12 +18,13 @@ limitations under the License.\n #include \"xla/tsl/platform/statusor.h\"\n \n #include <memory>\n+#include <string>\n #include <type_traits>\n #include <utility>\n #include <vector>\n \n-#include \"absl/base/config.h\"\n-#include \"xla/tsl/platform/errors.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/status/statusor.h\"\n #include \"xla/tsl/platform/macros.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/tsl/platform/test_benchmark.h\"\n@@ -82,7 +83,7 @@ TEST(StatusOr, NullPointerStatusOr) {\n \n TEST(StatusOr, TestNoDefaultConstructorInitialization) {\n   // Explicitly initialize it with an error code.\n-  absl::StatusOr<NoDefaultConstructor> statusor(errors::Cancelled(\"\"));\n+  absl::StatusOr<NoDefaultConstructor> statusor(absl::CancelledError(\"\"));\n   EXPECT_FALSE(statusor.ok());\n   EXPECT_EQ(statusor.status().code(), absl::StatusCode::kCancelled);\n \n@@ -105,7 +106,7 @@ TEST(StatusOr, TestMoveOnlyInitialization) {\n }\n \n TEST(StatusOr, TestMoveOnlyStatusCtr) {\n-  absl::StatusOr<std::unique_ptr<int>> thing(errors::Cancelled(\"\"));\n+  absl::StatusOr<std::unique_ptr<int>> thing(absl::CancelledError(\"\"));\n   ASSERT_FALSE(thing.ok());\n }\n "
        }
    ],
    "stats": {
        "total": 52,
        "additions": 33,
        "deletions": 19
    }
}