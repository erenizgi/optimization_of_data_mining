{
    "author": "tensorflower-gardener",
    "message": "[XLA:GPU] Enable chlo.asin -> kAsin `HloInstruction` lowering.\n\nPiperOrigin-RevId: 819720031",
    "sha": "95672254741cae1ceac1d82038224c624a76d209",
    "files": [
        {
            "sha": "55a15be79108c3ebfa5e0d3a0858914d1b0196fb",
            "filename": "third_party/xla/xla/backends/gpu/codegen/emitters/transforms/optimize_loops.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Foptimize_loops.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Foptimize_loops.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Femitters%2Ftransforms%2Foptimize_loops.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -53,6 +53,7 @@ bool IsExpensiveToUnroll(mlir::Operation* op) {\n       mlir::func::CallOp,\n       mlir::math::AcosOp,\n       mlir::math::AcoshOp,\n+      mlir::math::AsinOp,\n       mlir::math::AtanhOp,\n       mlir::math::SinhOp,\n       mlir::scf::ForOp"
        },
        {
            "sha": "0b58c5481c8ea519a01854e0e17e80148ec75ac2",
            "filename": "third_party/xla/xla/hlo/builder/lib/math.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -1191,7 +1191,11 @@ XlaOp Acos(XlaOp x, const std::optional<ResultAccuracy>& result_accuracy,\n }\n \n // asin(x) = 2 * atan(x / (1 + sqrt(1 - x^2)))\n-XlaOp Asin(XlaOp x) {\n+XlaOp Asin(XlaOp x, const std::optional<ResultAccuracy>& result_accuracy,\n+           bool expand) {\n+  if (!expand) {\n+    return x.builder()->UnaryOp(HloOpcode::kAsin, x, result_accuracy);\n+  }\n   XlaBuilder* b = x.builder();\n   auto do_it = [&](XlaOp z) -> absl::StatusOr<XlaOp> {\n     TF_ASSIGN_OR_RETURN(auto shape, b->GetShape(z));"
        },
        {
            "sha": "b4f1a3ad874e05ccb65f308abd346ab85d95cbc2",
            "filename": "third_party/xla/xla/hlo/builder/lib/math.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fmath.h?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -89,7 +89,9 @@ XlaOp Acos(XlaOp x,\n            bool expand = true);\n \n // Computes the arc sine of 'x'.\n-XlaOp Asin(XlaOp x);\n+XlaOp Asin(XlaOp x,\n+           const std::optional<ResultAccuracy>& result_accuracy = std::nullopt,\n+           bool expand = true);\n \n // Computes the arc tangent of 'x'.\n XlaOp Atan(XlaOp x);"
        },
        {
            "sha": "adeb47cdb8f3673d5bcf6642aadf1e0a444ee637",
            "filename": "third_party/xla/xla/hlo/builder/xla_builder.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Fxla_builder.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Fxla_builder.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Fxla_builder.h?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -1742,6 +1742,9 @@ class XlaBuilder {\n   friend XlaOp Acosh(XlaOp x,\n                      const std::optional<ResultAccuracy>& result_accuracy,\n                      bool expand);\n+  friend XlaOp Asin(XlaOp x,\n+                    const std::optional<ResultAccuracy>& result_accuracy,\n+                    bool expand);\n   friend XlaOp Atan2(XlaOp y, XlaOp x,\n                      absl::Span<const int64_t> broadcast_dimensions);\n   friend XlaOp Atanh(XlaOp x,"
        },
        {
            "sha": "50e863b31e8a111bcb87fc9d94bf39bfced7512a",
            "filename": "third_party/xla/xla/hlo/translate/mhlo_to_hlo/gen_hlo_op_writer.td",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fgen_hlo_op_writer.td",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fgen_hlo_op_writer.td",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fgen_hlo_op_writer.td?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -203,6 +203,7 @@ defvar CustomHloConverterOps = [\n   MHLO_AllGatherOp,\n   MHLO_AllReduceOp,\n   MHLO_AllToAllOp,\n+  MHLO_AsinOp,\n   MHLO_AsyncDoneOp,\n   MHLO_AsyncStartOp,\n   MHLO_AsyncUpdateOp,"
        },
        {
            "sha": "9615b947ffaa9e90614a78e6e967b0979223d696",
            "filename": "third_party/xla/xla/hlo/translate/mhlo_to_hlo/mlir_hlo_to_hlo.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Fmlir_hlo_to_hlo.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -5208,6 +5208,17 @@ LogicalResult ExportElementwiseXlaOp(Op op, OpLoweringContext ctx) {\n   return success();\n }\n \n+LogicalResult ExportXlaOp(AsinOp op, OpLoweringContext ctx) {\n+  auto& value_map = *ctx.values;\n+  xla::XlaOp operand;\n+  if (failed(GetXlaOp(op.getOperand(), value_map, &operand, op))) {\n+    return failure();\n+  }\n+  value_map[op] =\n+      xla::Asin(operand, /*result_accuracy=*/std::nullopt, /*expand=*/false);\n+  return success();\n+}\n+\n LogicalResult ExportXlaOp(AcosOp op, OpLoweringContext ctx) {\n   return ExportElementwiseXlaOp<AcosOp, xla::Acos>(op, ctx);\n }"
        },
        {
            "sha": "f123ff717a5cad5eb75ab49120317ab315d301d5",
            "filename": "third_party/xla/xla/hlo/translate/mhlo_to_hlo/tests/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2FBUILD?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -12,6 +12,7 @@ lit_test_suite(\n         [\n             \"acos.mlir\",\n             \"acosh.mlir\",\n+            \"asin.mlir\",\n             \"add.mlir\",\n             \"atanh.mlir\",\n             \"attributes.mlir\","
        },
        {
            "sha": "657bf5e5f7511656bd9268c07f350371127c1d6d",
            "filename": "third_party/xla/xla/hlo/translate/mhlo_to_hlo/tests/asin.mlir",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2Fasin.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2Fasin.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftranslate%2Fmhlo_to_hlo%2Ftests%2Fasin.mlir?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -0,0 +1,7 @@\n+// RUN: xla-translate -mlir-hlo-to-hlo-text %s | FileCheck %s\n+\n+func.func @main(%arg0: tensor<4xf32>) -> tensor<4xf32> {\n+  // CHECK: f32[4] asin\n+  %0 = \"mhlo.asin\"(%arg0) : (tensor<4xf32>) -> tensor<4xf32>\n+  func.return %0 : tensor<4xf32>\n+}"
        },
        {
            "sha": "2b48a04a2625d1e25eafeff96a169965d893089e",
            "filename": "third_party/xla/xla/mlir_hlo/mhlo/transforms/chlo_legalize_to_hlo/chlo_legalize_to_hlo_pass.cc",
            "status": "modified",
            "additions": 27,
            "deletions": 6,
            "changes": 33,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fchlo_legalize_to_hlo%2Fchlo_legalize_to_hlo_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fchlo_legalize_to_hlo%2Fchlo_legalize_to_hlo_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fchlo_legalize_to_hlo%2Fchlo_legalize_to_hlo_pass.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -49,17 +49,16 @@ namespace mhlo {\n \n namespace {\n \n-ChloLegalizeToHighLevelMhloPassOptions FromPassOptions(bool enableAcosh,\n-                                                       bool enableAcos,\n-                                                       bool enableAtanh,\n-                                                       bool enableCosh,\n-                                                       bool enableSinh) {\n+ChloLegalizeToHighLevelMhloPassOptions FromPassOptions(\n+    bool enableAcosh, bool enableAcos, bool enableAsin, bool enableAtanh,\n+    bool enableCosh, bool enableSinh) {\n   ChloLegalizeToHighLevelMhloPassOptions options;\n   options.enable_acosh_ = enableAcosh;\n   options.enable_acos_ = enableAcos;\n   options.enable_atanh_ = enableAtanh;\n   options.enable_cosh_ = enableCosh;\n   options.enable_sinh_ = enableSinh;\n+  options.enable_asin_ = enableAsin;\n   return options;\n }\n \n@@ -83,6 +82,10 @@ static bool qualifiesForDirectMhloLoweringSinh(chlo::SinhOp op) {\n   return llvm::isa<FloatType>(getElementTypeOrSelf(op.getType()));\n }\n \n+static bool qualifiesForDirectMhloLoweringAsin(chlo::AsinOp op) {\n+  return llvm::isa<FloatType>(getElementTypeOrSelf(op.getType()));\n+}\n+\n struct ChloLegalizeToHighLevelMhloPass\n     : public impl::ChloLegalizeToHighLevelMhloPassBase<\n           ChloLegalizeToHighLevelMhloPass> {\n@@ -100,7 +103,7 @@ struct ChloLegalizeToHighLevelMhloPass\n     chlo::populateChloToHighLevelMhloOpPatterns(\n         &context, &conversionPatterns,\n         FromPassOptions(enable_acosh_, enable_acos_, enable_atanh_,\n-                        enable_cosh_, enable_sinh_));\n+                        enable_cosh_, enable_sinh_, enable_asin_));\n \n     // Consider the mhlo dialect legal for tests. Also add helper dialects\n     // that are needed by the patterns.\n@@ -132,6 +135,11 @@ struct ChloLegalizeToHighLevelMhloPass\n         return !qualifiesForDirectMhloLoweringSinh(op);\n       });\n     }\n+    if (enable_asin_) {\n+      conversionTarget.addDynamicallyLegalOp<chlo::AsinOp>([](chlo::AsinOp op) {\n+        return !qualifiesForDirectMhloLoweringAsin(op);\n+      });\n+    }\n     conversionTarget\n         .addIllegalOp<chlo::TopKOp, chlo::ErfOp, chlo::RaggedDotOp>();\n \n@@ -274,6 +282,15 @@ LogicalResult convertSinhChloToMhlo(chlo::SinhOp op,\n   return success();\n }\n \n+LogicalResult convertAsinChloToMhlo(chlo::AsinOp op,\n+                                    PatternRewriter& rewriter) {\n+  if (!mhlo::qualifiesForDirectMhloLoweringAsin(op)) {\n+    return failure();\n+  }\n+  rewriter.replaceOpWithNewOp<mhlo::AsinOp>(op, op->getOperands());\n+  return success();\n+}\n+\n }  // namespace\n \n ChloLegalizeToHighLevelMhloPassOptions getDefaultChloToHighLevelMhloOptions() {\n@@ -287,6 +304,7 @@ ChloLegalizeToHighLevelMhloPassOptions getGpuChloToHighLevelMhloOptions() {\n   opts.enable_atanh_ = true;\n   opts.enable_cosh_ = true;\n   opts.enable_sinh_ = true;\n+  opts.enable_asin_ = true;\n   return opts;\n }\n \n@@ -316,6 +334,9 @@ void populateChloToHighLevelMhloOpPatterns(\n   if (options.enable_sinh_) {\n     patterns->add(mhlo::convertSinhChloToMhlo, kBenefit);\n   }\n+  if (options.enable_asin_) {\n+    patterns->add(mhlo::convertAsinChloToMhlo, kBenefit);\n+  }\n   patterns->add(mhlo::convertRaggedDotChloToMhlo, kBenefit);\n   populateWithGenerated(*patterns);\n }"
        },
        {
            "sha": "6d76abee712c2724aabbed0edbdd47d9910e66cb",
            "filename": "third_party/xla/xla/mlir_hlo/mhlo/transforms/hlo_legalize_to_stablehlo/hlo_legalize_to_stablehlo.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fhlo_legalize_to_stablehlo%2Fhlo_legalize_to_stablehlo.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fhlo_legalize_to_stablehlo%2Fhlo_legalize_to_stablehlo.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fhlo_legalize_to_stablehlo%2Fhlo_legalize_to_stablehlo.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -135,6 +135,11 @@ std::optional<int64_t> getPublicFeaturesNotInStablehlo(HloOpTy hloOp) {\n     // Version 1: Initial version for CoshOp.\n     return 1;\n   }\n+  // StableHLO doesn't support Asin yet.\n+  if constexpr (std::is_same<HloOpTy, mhlo::AsinOp>::value) {\n+    // Version 1: Initial version for AsinOp.\n+    return 1;\n+  }\n   return std::nullopt;\n }\n \n@@ -469,6 +474,7 @@ LogicalResult convertAttributes(ConversionPatternRewriter& rewriter,\n                   !std::is_same<HloOpTy, mhlo::AtanhOp>::value &&\n                   !std::is_same<HloOpTy, mhlo::CoshOp>::value &&\n                   !std::is_same<HloOpTy, mhlo::SinhOp>::value &&\n+                  !std::is_same<HloOpTy, mhlo::AsinOp>::value &&\n                   !std::is_same<HloOpTy, mhlo::ErfOp>::value &&\n                   !std::is_same<HloOpTy, mhlo::TopKOp>::value) {\n       if (!stablehloAttr) {\n@@ -763,9 +769,9 @@ void populateHloToStablehloPatterns(RewritePatternSet* patterns,\n       allowXlaFeatures);\n \n   populateHloToStablehloCustomCallPatterns<\n-      mhlo::AcosOp, mhlo::AcoshOp, mhlo::AtanhOp, mhlo::CoshOp, mhlo::SinhOp,\n-      mhlo::ErfOp, mhlo::TopKOp>(patterns, converter, context,\n-                                 allowExperimentalFeatures);\n+      mhlo::AcosOp, mhlo::AcoshOp, mhlo::AsinOp, mhlo::AtanhOp, mhlo::CoshOp,\n+      mhlo::SinhOp, mhlo::ErfOp, mhlo::TopKOp>(patterns, converter, context,\n+                                               allowExperimentalFeatures);\n }\n \n }  // namespace stablehlo"
        },
        {
            "sha": "a04a5b89750b3ec7e6004cfe081647f96e9e58d2",
            "filename": "third_party/xla/xla/mlir_hlo/mhlo/transforms/mhlo_passes.td",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fmhlo_passes.td",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fmhlo_passes.td",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fmhlo%2Ftransforms%2Fmhlo_passes.td?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -32,7 +32,9 @@ def ChloLegalizeToHighLevelMhloPass : Pass<\"chlo-legalize-to-high-level-mhlo\", \"\n     Option<\"enable_cosh_\", \"enable-cosh\", \"bool\", /*default=*/\"false\",\n            \"Enable chlo.cosh to mhlo.cosh lowering.\">,\n     Option<\"enable_sinh_\", \"enable-sinh\", \"bool\", /*default=*/\"false\",\n-           \"Enable chlo.sinh to mhlo.sinh lowering.\">\n+           \"Enable chlo.sinh to mhlo.sinh lowering.\">,\n+    Option<\"enable_asin_\", \"enable-asin\", \"bool\", /*default=*/\"false\",\n+           \"Enable chlo.asin to mhlo.asin lowering.\">\n   ];\n   let dependentDialects = [\"mhlo::MhloDialect\"];\n }"
        },
        {
            "sha": "596e9e52fdd0ba0bd8a7b4fbf313717ec07f7bf3",
            "filename": "third_party/xla/xla/mlir_hlo/stablehlo_ext/transforms/chlo_preserve_high_level_ops.cpp",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_preserve_high_level_ops.cpp",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_preserve_high_level_ops.cpp",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_preserve_high_level_ops.cpp?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -275,6 +275,15 @@ struct SinhOpToCustomCallPattern : public OpRewritePattern<chlo::SinhOp> {\n   }\n };\n \n+struct AsinOpToCustomCallPattern : public OpRewritePattern<chlo::AsinOp> {\n+  using OpRewritePattern::OpRewritePattern;\n+  LogicalResult matchAndRewrite(chlo::AsinOp op,\n+                                PatternRewriter& rewriter) const override {\n+    return wrapChloOperationInCustomCall(rewriter, op, \"mhlo.asin\",\n+                                         /*version=*/1);\n+  }\n+};\n+\n ///////\n // CHLO to CompositeOp Patterns\n ///////\n@@ -358,6 +367,14 @@ struct SinhOpToCompositePattern : public OpRewritePattern<chlo::SinhOp> {\n   }\n };\n \n+struct AsinOpToCompositePattern : public OpRewritePattern<chlo::AsinOp> {\n+  using OpRewritePattern::OpRewritePattern;\n+  LogicalResult matchAndRewrite(chlo::AsinOp op,\n+                                PatternRewriter& rewriter) const override {\n+    return wrapChloOpInComposite(op, /*version=*/1, rewriter);\n+  }\n+};\n+\n }  // namespace\n \n struct ChloPreserveHighLevelOpsPass\n@@ -382,6 +399,7 @@ struct ChloPreserveHighLevelOpsPass\n       // Deprecated CustomCall encoding.\n       patterns.add<\n         AcosOpToCustomCallPattern,\n+        AsinOpToCustomCallPattern,\n         AcoshOpToCustomCallPattern,\n         AtanhOpToCustomCallPattern,\n         CoshOpToCustomCallPattern,\n@@ -392,6 +410,7 @@ struct ChloPreserveHighLevelOpsPass\n     } else {\n       patterns.add<\n         AcosOpToCompositePattern,\n+        AsinOpToCompositePattern,\n         AcoshOpToCompositePattern,\n         AtanhOpToCompositePattern,\n         CoshOpToCompositePattern,"
        },
        {
            "sha": "c37cd63381a7b98c10078950d1bbbeb7d805cd81",
            "filename": "third_party/xla/xla/mlir_hlo/stablehlo_ext/transforms/chlo_recompose_ops.cpp",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_recompose_ops.cpp",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_recompose_ops.cpp",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Fstablehlo_ext%2Ftransforms%2Fchlo_recompose_ops.cpp?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -328,6 +328,22 @@ struct SinhOpRecomposePattern\n   }\n };\n \n+struct AsinOpRecomposePattern\n+    : public OpRewritePattern<stablehlo::CompositeOp> {\n+  using OpRewritePattern::OpRewritePattern;\n+  LogicalResult matchAndRewrite(stablehlo::CompositeOp op,\n+                                PatternRewriter& rewriter) const override {\n+    if (op.getName() != \"chlo.asin\") {\n+      return rewriter.notifyMatchFailure(op, \"not a chlo.asin\");\n+    }\n+    if (op.getVersion() != 1) {\n+      return rewriter.notifyMatchFailure(\n+          op, \"unsupported version for chlo.asin composite\");\n+    }\n+    return recomposeChloOpFromCompositeOp<chlo::AsinOp>(op, rewriter);\n+  }\n+};\n+\n struct ErfOpRecomposePattern : public OpRewritePattern<stablehlo::CompositeOp> {\n   using OpRewritePattern::OpRewritePattern;\n   LogicalResult matchAndRewrite(stablehlo::CompositeOp op,\n@@ -467,6 +483,16 @@ struct SinhOpCustomCallRecomposePattern\n   }\n };\n \n+struct AsinOpCustomCallRecomposePattern\n+    : public OpRewritePattern<stablehlo::CustomCallOp> {\n+  using OpRewritePattern::OpRewritePattern;\n+  LogicalResult matchAndRewrite(stablehlo::CustomCallOp op,\n+                                PatternRewriter& rewriter) const override {\n+    return recomposeChloOpFromCustomCall<chlo::AsinOp>(\n+        op, {\"mhlo.asin\", \"chlo.asin\"}, rewriter);\n+  }\n+};\n+\n }  // namespace\n \n struct ChloRecomposeOpsPass\n@@ -488,6 +514,7 @@ struct ChloRecomposeOpsPass\n     // CustomCall Patterns\n     patterns.add<\n       AcosOpCustomCallRecomposePattern,\n+      AsinOpCustomCallRecomposePattern,\n       AcoshOpCustomCallRecomposePattern,\n       AtanhOpCustomCallRecomposePattern,\n       CoshOpCustomCallRecomposePattern,\n@@ -500,6 +527,7 @@ struct ChloRecomposeOpsPass\n     // Composite Patterns\n     patterns.add<\n       AcosOpRecomposePattern,\n+      AsinOpRecomposePattern,\n       AcoshOpRecomposePattern,\n       AtanhOpRecomposePattern,\n       CoshOpRecomposePattern,"
        },
        {
            "sha": "47618374dfc6791c15d7bac8ef0011edec9484a8",
            "filename": "third_party/xla/xla/mlir_hlo/tests/Dialect/chlo/chlo_legalize_to_mhlo.mlir",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2FDialect%2Fchlo%2Fchlo_legalize_to_mhlo.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2FDialect%2Fchlo%2Fchlo_legalize_to_mhlo.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2FDialect%2Fchlo%2Fchlo_legalize_to_mhlo.mlir?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -1,5 +1,5 @@\n // RUN: mlir-hlo-opt --chlo-legalize-to-hlo --split-input-file -verify-diagnostics %s | FileCheck %s --dump-input-context=20\n-// RUN: mlir-hlo-opt --chlo-legalize-to-high-level-mhlo=\"enable-acosh enable-acos enable-atanh enable-cosh enable-sinh\" --split-input-file -verify-diagnostics %s | FileCheck %s --check-prefix=CHECK-HIGH-LEVEL\n+// RUN: mlir-hlo-opt --chlo-legalize-to-high-level-mhlo=\"enable-acosh enable-acos enable-atanh enable-cosh enable-sinh enable-asin\" --split-input-file -verify-diagnostics %s | FileCheck %s --check-prefix=CHECK-HIGH-LEVEL\n \n // CHECK-LABEL: func.func @asin_bf16(\n // CHECK-SAME:    %[[TMP_arg0:.*]]: tensor<bf16>\n@@ -20,6 +20,7 @@ func.func @asin_bf16(%arg : tensor<bf16>) -> tensor<bf16> {\n // -----\n \n // CHECK-LABEL: func.func @asin_f16(\n+// CHECK-HIGH-LEVEL-LABEL: func.func @asin_f16(\n // CHECK-SAME:    %[[TMP_arg0:.*]]: tensor<f16>\n // CHECK-NEXT:    %[[TMP_1:.*]] = mhlo.constant dense<1.000000e+00> : tensor<f16>\n // CHECK-NEXT:    %[[TMP_2:.*]] = mhlo.subtract %[[TMP_1]], %[[TMP_arg0]] : tensor<f16>\n@@ -31,13 +32,15 @@ func.func @asin_bf16(%arg : tensor<bf16>) -> tensor<bf16> {\n // CHECK-NEXT:    %[[TMP_8:.*]] = mhlo.add %[[TMP_7]], %[[TMP_7]] : tensor<f16>\n // CHECK-NEXT:    return %[[TMP_8]] : tensor<f16>\n func.func @asin_f16(%arg : tensor<f16>) -> tensor<f16> {\n+  // CHECK-HIGH-LEVEL: mhlo.asin\n   %result = \"chlo.asin\"(%arg) : (tensor<f16>) -> tensor<f16>\n   func.return %result : tensor<f16>\n }\n \n // -----\n \n // CHECK-LABEL: func.func @asin_f32(\n+// CHECK-HIGH-LEVEL-LABEL: func.func @asin_f32(\n // CHECK-SAME:    %[[TMP_arg0:.*]]: tensor<f32>) -> tensor<f32>\n // CHECK-NEXT:    %[[TMP_1:.*]] = mhlo.constant dense<1.000000e+00> : tensor<f32>\n // CHECK-NEXT:    %[[TMP_2:.*]] = mhlo.subtract %[[TMP_1]], %[[TMP_arg0]] : tensor<f32>\n@@ -49,13 +52,14 @@ func.func @asin_f16(%arg : tensor<f16>) -> tensor<f16> {\n // CHECK-NEXT:    %[[TMP_8:.*]] = mhlo.add %[[TMP_7]], %[[TMP_7]] : tensor<f32>\n // CHECK-NEXT:    return %[[TMP_8]] : tensor<f32>\n func.func @asin_f32(%arg : tensor<f32>) -> tensor<f32> {\n+  // CHECK-HIGH-LEVEL: mhlo.asin\n   %result = \"chlo.asin\"(%arg) : (tensor<f32>) -> tensor<f32>\n   func.return %result : tensor<f32>\n }\n \n // -----\n-\n // CHECK-LABEL:  func.func @asin_f64(\n+// CHECK-HIGH-LEVEL-LABEL: func.func @asin_f64(\n // CHECK-SAME:    %[[TMP_arg0:.*]]: tensor<f64>) -> tensor<f64>\n // CHECK-NEXT:    %[[TMP_1:.*]] = mhlo.constant dense<1.000000e+00> : tensor<f64>\n // CHECK-NEXT:    %[[TMP_2:.*]] = mhlo.subtract %[[TMP_1]], %[[TMP_arg0]] : tensor<f64>\n@@ -67,13 +71,15 @@ func.func @asin_f32(%arg : tensor<f32>) -> tensor<f32> {\n // CHECK-NEXT:    %[[TMP_8:.*]] = mhlo.add %[[TMP_7]], %[[TMP_7]] : tensor<f64>\n // CHECK-NEXT:    return %[[TMP_8]] : tensor<f64>\n func.func @asin_f64(%arg : tensor<f64>) -> tensor<f64> {\n+  // CHECK-HIGH-LEVEL: mhlo.asin\n   %result = \"chlo.asin\"(%arg) : (tensor<f64>) -> tensor<f64>\n   func.return %result : tensor<f64>\n }\n \n // -----\n \n // CHECK-LABEL: func.func @asin_complex_f32(\n+// CHECK-HIGH-LEVEL-LABEL: func.func @asin_complex_f32(\n // CHECK-SAME:   %[[TEMP_arg0:.*]]: tensor<complex<f32>>) -> tensor<complex<f32>>\n // CHECK: %[[TEMP_0:.*]] = mhlo.real %[[TEMP_arg0:.*]] : (tensor<complex<f32>>) -> tensor<f32>\n // CHECK: %[[TEMP_1:.*]] = mhlo.real %[[TEMP_arg0:.*]] : (tensor<complex<f32>>) -> tensor<f32>\n@@ -220,6 +226,7 @@ func.func @asin_complex_f32(%arg : tensor<complex<f32>>) -> tensor<complex<f32>>\n   %result = \"chlo.asin\"(%arg) : (tensor<complex<f32>>) -> tensor<complex<f32>>\n   func.return %result : tensor<complex<f32>>\n }\n+// CHECK-HIGH-LEVEL-NOT: mhlo.asin\n \n // -----\n "
        },
        {
            "sha": "149686f99b393c592492f070eace93851d54fc61",
            "filename": "third_party/xla/xla/mlir_hlo/tests/stablehlo_ext/chlo_preserve_high_level_ops.mlir",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_preserve_high_level_ops.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_preserve_high_level_ops.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_preserve_high_level_ops.mlir?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -123,6 +123,16 @@ func.func @sinh_preserve(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n \n // -----\n \n+// CHECK-LABEL: func @asin_preserve\n+func.func @asin_preserve(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n+  // CHECK-CC: stablehlo.custom_call @mhlo.asin(%arg0) {mhlo.attributes = {}, mhlo.version = 1 : i64} : (tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16>\n+  // CHECK: stablehlo.composite \"chlo.asin\" %arg0 {decomposition = @chlo.asin.impl, version = 1 : i32}\n+  %0 = chlo.asin %arg0 : tensor<3x20x20xbf16> -> tensor<?x20x20xbf16>\n+  return %0 : tensor<?x20x20xbf16>\n+}\n+\n+// -----\n+\n // CHECK-LABEL: func @tan_no_preserve\n func.func @tan_no_preserve(%arg0: tensor<16xf32>) -> tensor<?xf32> {\n   // CHECK: chlo.tan"
        },
        {
            "sha": "b74c36dc048e272b6de2375e46653b72044f787f",
            "filename": "third_party/xla/xla/mlir_hlo/tests/stablehlo_ext/chlo_recompose_ops.mlir",
            "status": "modified",
            "additions": 19,
            "deletions": 4,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_recompose_ops.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_recompose_ops.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftests%2Fstablehlo_ext%2Fchlo_recompose_ops.mlir?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -93,6 +93,21 @@ func.func private @chlo.sinh.impl(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20\n \n // -----\n \n+// CHECK-LABEL: func @asin_recompose_composite\n+func.func @asin_recompose_composite(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n+  // CHECK-NEXT: chlo.asin\n+  // CHECK-NOT: stablehlo.composite\n+  %0 = stablehlo.composite \"chlo.asin\" %arg0 {decomposition = @chlo.asin.impl, version = 1 : i32} : (tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16>\n+  return %0 : tensor<?x20x20xbf16>\n+}\n+// CHECK-NOT: @chlo.asin.impl\n+func.func private @chlo.asin.impl(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n+  %0 = chlo.asin %arg0 : tensor<3x20x20xbf16> -> tensor<?x20x20xbf16>\n+  return %0 : tensor<?x20x20xbf16>\n+}\n+\n+// -----\n+\n // CHECK-LABEL: func @ragged_dot_recompose_composite\n func.func @ragged_dot_recompose_composite(%arg0: tensor<2x11x5xf32>, %arg1: tensor<3x2x5x7xf32>, %arg2: tensor<3xi64>) -> tensor<2x11x7xf32> {\n   // CHECK: \"chlo.ragged_dot\"(%arg0, %arg1, %arg2) <{precision_config = [#chlo<precision DEFAULT>, #chlo<precision DEFAULT>], ragged_dot_dimension_numbers = #chlo.ragged_dot<lhs_batching_dimensions = [0], rhs_batching_dimensions = [1], lhs_contracting_dimensions = [2], rhs_contracting_dimensions = [2], lhs_ragged_dimensions = [1], rhs_group_dimensions = [0]>}> : (tensor<2x11x5xf32>, tensor<3x2x5x7xf32>, tensor<3xi64>) -> tensor<2x11x7xf32>\n@@ -196,12 +211,12 @@ func.func @cosh_recompose_cc(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16\n \n // -----\n \n-// CHECK-LABEL: @sinh_recompose_cc\n-func.func @sinh_recompose_cc(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n-  // CHECK: %0 = chlo.sinh %arg0 : tensor<3x20x20xbf16> -> tensor<?x20x20xbf16>\n+// CHECK-LABEL: @asin_recompose_cc\n+func.func @asin_recompose_cc(%arg0: tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16> {\n+  // CHECK: %0 = chlo.asin %arg0 : tensor<3x20x20xbf16> -> tensor<?x20x20xbf16>\n   %0 = \"stablehlo.custom_call\"(%arg0) {\n     backend_config = \"\",\n-    call_target_name = \"mhlo.sinh\",\n+    call_target_name = \"mhlo.asin\",\n     mhlo.attributes = {},\n     mhlo.version = 1 : i64\n   } : (tensor<3x20x20xbf16>) -> tensor<?x20x20xbf16>"
        },
        {
            "sha": "ca72d0c988af2a0a438f633cbf22a2a4603c304d",
            "filename": "third_party/xla/xla/tests/complex_unary_op_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Ftests%2Fcomplex_unary_op_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Ftests%2Fcomplex_unary_op_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fcomplex_unary_op_test.cc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -116,8 +116,10 @@ TEST_F(ComplexUnaryOpTest, TanTest) {\n }\n \n TEST_F(ComplexUnaryOpTest, AsinTest) {\n-  UnaryTestHelper<complex_unary_op_samples::Asin<float>>(Asin);\n-  UnaryTestHelper<complex_unary_op_samples::Asin<double>>(Asin);\n+  UnaryTestHelper<complex_unary_op_samples::Asin<float>>(\n+      [](XlaOp x) { return Asin(x); });\n+  UnaryTestHelper<complex_unary_op_samples::Asin<double>>(\n+      [](XlaOp x) { return Asin(x); });\n }\n \n TEST_F(ComplexUnaryOpTest, AsinhTest) {"
        },
        {
            "sha": "50b7afe438caec9ae76d46fbb8ff60601156b6a0",
            "filename": "third_party/xla/xla/tests/exhaustive/exhaustive_unary_test_ops.inc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Ftests%2Fexhaustive%2Fexhaustive_unary_test_ops.inc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/95672254741cae1ceac1d82038224c624a76d209/third_party%2Fxla%2Fxla%2Ftests%2Fexhaustive%2Fexhaustive_unary_test_ops.inc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fexhaustive%2Fexhaustive_unary_test_ops.inc?ref=95672254741cae1ceac1d82038224c624a76d209",
            "patch": "@@ -205,7 +205,8 @@ DEFINE_UNARY_TEST_OP(\n     { return std::atanh; });\n DEFINE_UNARY_TEST_OP(\n     AcosOp, { return [](XlaOp x) { return Acos(x); }; }, { return std::acos; });\n-DEFINE_UNARY_TEST_OP(AsinOp, { return Asin; }, { return std::asin; });\n+DEFINE_UNARY_TEST_OP(\n+    AsinOp, { return [](XlaOp x) { return Asin(x); }; }, { return std::asin; });\n DEFINE_UNARY_TEST_OP(AtanOp, { return Atan; }, { return std::atan; });\n DEFINE_UNARY_TEST_OP(\n     CoshOp, { return [](XlaOp x) { return Cosh(x); }; }, { return std::cosh; });"
        }
    ],
    "stats": {
        "total": 183,
        "additions": 162,
        "deletions": 21
    }
}