{
    "author": "GleasonK",
    "message": "[XLA:CPU] Add PJRT Reproducers to XLA:CPU\n\nPiperOrigin-RevId: 799244033",
    "sha": "5394bad097b12b8c574d3ae78abc280eb1f7d799",
    "files": [
        {
            "sha": "57144b9ceb5448add49034d8d6e30780e3a31db1",
            "filename": "third_party/xla/xla/pjrt/cpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD?ref=5394bad097b12b8c574d3ae78abc280eb1f7d799",
            "patch": "@@ -163,7 +163,6 @@ cc_library(\n         \"//xla/hlo/builder:xla_computation\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/hlo/ir:hlo_module_group\",\n-        \"//xla/pjrt:abstract_tracked_device_buffer\",\n         \"//xla/pjrt:async_work_runner\",\n         \"//xla/pjrt:common_pjrt_client\",\n         \"//xla/pjrt:device_event\",\n@@ -182,6 +181,7 @@ cc_library(\n         \"//xla/pjrt:thread_pool_async_work_runner\",\n         \"//xla/pjrt:transpose\",\n         \"//xla/pjrt:utils\",\n+        \"//xla/pjrt/dump\",\n         \"//xla/pjrt/plugin/xla_cpu:cpu_client_options\",\n         \"//xla/pjrt/plugin/xla_cpu:cpu_execute_options\",\n         \"//xla/pjrt/plugin/xla_cpu:cpu_topology\","
        },
        {
            "sha": "e0a019040437acc53ece9a98489b1f046e24ee58",
            "filename": "third_party/xla/xla/pjrt/cpu/cpu_client.cc",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc?ref=5394bad097b12b8c574d3ae78abc280eb1f7d799",
            "patch": "@@ -74,6 +74,7 @@ limitations under the License.\n #include \"xla/pjrt/cpu/raw_buffer.h\"\n #include \"xla/pjrt/cpu/tracked_cpu_device_buffer.h\"\n #include \"xla/pjrt/device_event.h\"\n+#include \"xla/pjrt/dump/dump.h\"\n #include \"xla/pjrt/host_callback.h\"\n #include \"xla/pjrt/host_memory_spaces.h\"\n #include \"xla/pjrt/host_to_device_transfer_manager.h\"\n@@ -589,6 +590,20 @@ static absl::StatusOr<std::unique_ptr<xla::Executable>> CompileAheadOfTime(\n \n absl::StatusOr<std::unique_ptr<PjRtLoadedExecutable>>\n PjRtCpuClient::CompileAndLoad(mlir::ModuleOp module, CompileOptions options) {\n+  // Dump compile inputs to the specified path if populated.\n+  if (options.executable_build_options.has_debug_options()) {\n+    std::string dump_path =\n+        options.executable_build_options.debug_options().xla_dump_to();\n+    if (!dump_path.empty()) {\n+      LOG(INFO) << \"Dumping compile inputs to \" << dump_path;\n+      auto dump_status =\n+          pjrt::DumpCompileInputs(dump_path, options, module, topology_);\n+      if (!dump_status.ok()) {\n+        LOG(WARNING) << \"Failed to dump compile inputs: \" << dump_status;\n+      }\n+    }\n+  }\n+\n   XlaComputation xla_computation;\n   ExecutableBuildOptions& exec_build_options = options.executable_build_options;\n   TF_RETURN_IF_ERROR(MlirToXlaComputation("
        },
        {
            "sha": "c7b2b097a61da88ff3f2260ec42831f4405bf897",
            "filename": "third_party/xla/xla/pjrt/dump/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fdump%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5394bad097b12b8c574d3ae78abc280eb1f7d799/third_party%2Fxla%2Fxla%2Fpjrt%2Fdump%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdump%2FBUILD?ref=5394bad097b12b8c574d3ae78abc280eb1f7d799",
            "patch": "@@ -1,6 +1,6 @@\n load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n-load(\"//xla/tsl:tsl.default.bzl\", \"get_compatible_with_libtpu_portable\")\n+load(\"//xla/tsl:tsl.default.bzl\", \"get_compatible_with_libtpu_portable\", \"get_compatible_with_portable\")\n \n package(\n     # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n@@ -12,7 +12,7 @@ cc_library(\n     name = \"dump\",\n     srcs = [\"dump.cc\"],\n     hdrs = [\"dump.h\"],\n-    compatible_with = get_compatible_with_libtpu_portable(),\n+    compatible_with = (get_compatible_with_libtpu_portable() + get_compatible_with_portable()),\n     deps = [\n         \":mlir\",\n         \"//xla/pjrt:pjrt_compiler\",\n@@ -62,7 +62,7 @@ cc_library(\n     name = \"mlir\",\n     srcs = [\"mlir.cc\"],\n     hdrs = [\"mlir.h\"],\n-    compatible_with = get_compatible_with_libtpu_portable(),\n+    compatible_with = (get_compatible_with_libtpu_portable() + get_compatible_with_portable()),\n     deps = [\n         \"//xla/tsl/platform:env\",\n         \"@com_google_absl//absl/status\",\n@@ -74,7 +74,7 @@ cc_library(\n xla_cc_test(\n     name = \"mlir_test\",\n     srcs = [\"mlir_test.cc\"],\n-    compatible_with = get_compatible_with_libtpu_portable(),\n+    compatible_with = (get_compatible_with_libtpu_portable() + get_compatible_with_portable()),\n     deps = [\n         \":mlir\",\n         \"//xla/mlir_hlo\","
        }
    ],
    "stats": {
        "total": 25,
        "additions": 20,
        "deletions": 5
    }
}