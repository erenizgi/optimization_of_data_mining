{
    "author": "tensorflower-gardener",
    "message": "Merge pull request #100869 from Ma-gi-cian:fix-dtypes-argmax\n\nPiperOrigin-RevId: 817532668",
    "sha": "cc64982cc7ce14af833a99694c5b58b749e32b26",
    "files": [
        {
            "sha": "7a2bf539784f65c0090905a9580089ca534f5526",
            "filename": "tensorflow/python/ops/math_ops.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cc64982cc7ce14af833a99694c5b58b749e32b26/tensorflow%2Fpython%2Fops%2Fmath_ops.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cc64982cc7ce14af833a99694c5b58b749e32b26/tensorflow%2Fpython%2Fops%2Fmath_ops.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fops%2Fmath_ops.py?ref=cc64982cc7ce14af833a99694c5b58b749e32b26",
            "patch": "@@ -300,19 +300,21 @@ def argmax_v2(input, axis=None, output_type=dtypes.int64, name=None):\n     axis = 0\n \n   if hasattr(axis, \"dtype\"):\n-    if axis.dtype not in (\n+    allowed_dtypes = {\n         dtypes.int8,\n         dtypes.uint8,\n         dtypes.int16,\n         dtypes.uint16,\n         dtypes.int32,\n         dtypes.int64,\n-    ):\n+    }\n+    if axis.dtype not in allowed_dtypes:\n       raise TypeError(f\"axis tensor dtypes {axis.dtype} is not supported\")\n-    if axis.dtype in (dtypes.int8, dtypes.int16, dtypes.uint8, dtypes.uint16):\n+    castable_types = {dtypes.int8, dtypes.int16, dtypes.uint8, dtypes.uint16}\n+    if axis.dtype in castable_types:\n       axis = cast(axis, dtypes.int32)\n   elif not isinstance(axis, int):\n-    raise TypeError(f\"axis must be int or Tensor with integer datatype\")\n+    raise TypeError(\"axis must be int or Tensor with integer datatype\")\n \n   return gen_math_ops.arg_max(input, axis, name=name, output_type=output_type)\n "
        },
        {
            "sha": "72019554c491b743290527568ab2dbe54881e686",
            "filename": "tensorflow/python/ops/math_ops_test.py",
            "status": "modified",
            "additions": 22,
            "deletions": 5,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/cc64982cc7ce14af833a99694c5b58b749e32b26/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/cc64982cc7ce14af833a99694c5b58b749e32b26/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py?ref=cc64982cc7ce14af833a99694c5b58b749e32b26",
            "patch": "@@ -1379,7 +1379,7 @@ def testErfcinv(self):\n \n \n @test_util.run_all_in_graph_and_eager_modes\n-class ArgMaxMinTest(test_util.TensorFlowTestCase):\n+class ArgMaxMinTest(test_util.TensorFlowTestCase, parameterized.TestCase):\n \n   def _generateRandomTensor(self, dtype, shape):\n     if dtype.is_integer:\n@@ -1427,19 +1427,36 @@ def testArgMaxUint16(self):\n             tf_values, axis=axis, output_type=dtypes.uint16)\n         self.assertAllEqual(tf_max, np_max)\n \n-  def testArgMaxInt16(self):\n+  @parameterized.parameters(\n+      dtypes.int8,\n+      dtypes.uint8,\n+      dtypes.int16,\n+      dtypes.uint16,\n+      dtypes.int32,\n+      dtypes.int64,\n+  )\n+  def testArgMaxWithIntegerDtypes(self, dtype):\n     shape = (24, 8)\n-    tf_values = self._generateRandomTensor(dtypes.int16, shape)\n+    tf_values = self._generateRandomTensor(dtype, shape)\n     np_values = self.evaluate(tf_values)\n-    for axis in range(0, len(shape)):\n+    for axis in range(len(shape)):\n       np_max = np.argmax(np_values, axis=axis)\n       tf_max = math_ops.argmax(\n           tf_values,\n-          axis=constant_op.constant(axis, dtype=dtypes.int16),\n+          axis=constant_op.constant(axis, dtype=dtype),\n           output_type=dtypes.int32,\n       )\n       self.assertAllEqual(tf_max, np_max)\n \n+  def testArgMaxRaisesInvalidDtype(self):\n+    invalid_axis = constant_op.constant(1, dtype=dtypes.float32)\n+    with self.assertRaises(TypeError):\n+      math_ops.argmax(\n+          constant_op.constant([1, 2, 3]),\n+          axis=invalid_axis,\n+          output_type=dtypes.int32,\n+      )\n+\n   def testArgMin(self):\n     shape = (24, 8)\n     for dtype in self._getValidDtypes():"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 28,
        "deletions": 9
    }
}