{
    "author": "vwbaker",
    "message": "Cherry-pick https://github.com/triton-lang/triton/pull/7719\n\nFixes dominance issues discovered in some of our workloads.\n\nPiperOrigin-RevId: 811805618",
    "sha": "da9e4bea8d15718f8a70294f9cc222c66d981c0e",
    "files": [
        {
            "sha": "084249e632d1a9b3232c3b9503f37d9187bc60b7",
            "filename": "third_party/xla/third_party/triton/temporary/cherrypick_dominance_fix.patch",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/da9e4bea8d15718f8a70294f9cc222c66d981c0e/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fcherrypick_dominance_fix.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/da9e4bea8d15718f8a70294f9cc222c66d981c0e/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fcherrypick_dominance_fix.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fcherrypick_dominance_fix.patch?ref=da9e4bea8d15718f8a70294f9cc222c66d981c0e",
            "patch": "@@ -0,0 +1,19 @@\n+This is a cherry-pick of https://github.com/triton-lang/triton/pull/7719 which\n+should make it into the next integration so this patch can simply be deleted\n+next integrate.\n+\n+diff --git a/lib/Dialect/TritonGPU/Transforms/HoistTMEMAlloc.cpp b/lib/Dialect/TritonGPU/Transforms/HoistTMEMAlloc.cpp\n+--- a/lib/Dialect/TritonGPU/Transforms/HoistTMEMAlloc.cpp\n++++ b/lib/Dialect/TritonGPU/Transforms/HoistTMEMAlloc.cpp\n+@@ -181,6 +181,11 @@ public:\n+       return failure();\n+     if (alloc->getBlock() != store->getBlock())\n+       return failure();\n++    if (auto srcDef = store.getSrc().getDefiningOp()) {\n++      if (alloc->getBlock() == srcDef->getBlock() &&\n++          alloc->isBeforeInBlock(srcDef))\n++        return failure();\n++    }\n+     alloc.getSrcMutable().assign(store.getSrc());\n+     rewriter.replaceOp(store, alloc.getToken());\n+     return success();"
        },
        {
            "sha": "870af59b86424c0d9b7fefabd4cba895c7e574ae",
            "filename": "third_party/xla/third_party/triton/temporary/series.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/da9e4bea8d15718f8a70294f9cc222c66d981c0e/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/da9e4bea8d15718f8a70294f9cc222c66d981c0e/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Ftemporary%2Fseries.bzl?ref=da9e4bea8d15718f8a70294f9cc222c66d981c0e",
            "patch": "@@ -19,5 +19,6 @@ temporary_patch_list = [\n     \"//third_party/triton:temporary/launcher_overflow_fix.patch\",\n     \"//third_party/triton:temporary/convert_layout_op_to_llvm_small_width.patch\",\n     \"//third_party/triton:temporary/convert_layout_op_to_llvm_small_width_2.patch\",\n+    \"//third_party/triton:temporary/cherrypick_dominance_fix.patch\",\n     # Add new patches just above this line\n ]"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 20,
        "deletions": 0
    }
}