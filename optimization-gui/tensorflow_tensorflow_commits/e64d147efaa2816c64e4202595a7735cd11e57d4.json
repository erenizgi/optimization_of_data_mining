{
    "author": "dubstack",
    "message": "Define a new ErrorSpace for XLA errors, seed it with generic error codes\n\nThese new XLA error-codes aim to provide finer-grained details in comparison to absl::Status codes: https://abseil.io/docs/cpp/guides/status-codes. Each distinct error code would be linked to corresponding documentation on the OpenXLA website outlining error details, and potential solutions.\n\nPiperOrigin-RevId: 807428916",
    "sha": "e64d147efaa2816c64e4202595a7735cd11e57d4",
    "files": [
        {
            "sha": "a4d5747b957c411d73c8029edb06ea3aa5e51c37",
            "filename": "third_party/xla/xla/errors/BUILD",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ferrors%2FBUILD?ref=e64d147efaa2816c64e4202595a7735cd11e57d4",
            "patch": "@@ -0,0 +1,27 @@\n+load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n+load(\"//xla/tsl/platform:rules_cc.bzl\", \"cc_library\")\n+\n+package(\n+    # copybara:uncomment default_applicable_licenses = [\"//tensorflow:license\"],\n+    default_visibility = [\"//visibility:public\"],\n+)\n+\n+cc_library(\n+    name = \"error_codes\",\n+    hdrs = [\"error_codes.h\"],\n+    deps = [\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:str_format\",\n+    ],\n+)\n+\n+xla_cc_test(\n+    name = \"error_codes_test\",\n+    srcs = [\"error_codes_test.cc\"],\n+    deps = [\n+        \":error_codes\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)"
        },
        {
            "sha": "9704483d9bbd7e8283c0aa580507399cdeaf3ae6",
            "filename": "third_party/xla/xla/errors/error_codes.h",
            "status": "added",
            "additions": 168,
            "deletions": 0,
            "changes": 168,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes.h?ref=e64d147efaa2816c64e4202595a7735cd11e57d4",
            "patch": "@@ -0,0 +1,168 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_ERRORS_ERROR_CODES_H_\n+#define XLA_ERRORS_ERROR_CODES_H_\n+\n+#include <string>\n+\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_format.h\"\n+#include \"absl/strings/string_view.h\"\n+\n+namespace xla::error {\n+\n+// The single source of truth for all XLA error codes. These error codes provide\n+// a consistent way to report errors across XLA. They provide finer grained\n+// error codes than absl::Status codes and each error code is linked to a\n+// corresponding page in the XLA documentation with more details about the error\n+// and potential solutions.\n+\n+// The format of the macro declaration is:\n+// X(ErrorCode, ErrorCodeName, absl::StatusCode)\n+// where:\n+// - ErrorCode is the canonical identifier of the error code - all XLA error\n+//   messages are prefixed with this identifier. Additionally all XLA\n+//   documentation is indexed by this identifier.\n+// - ErrorCodeName is a canonical name for the error code also present in all\n+//   XLA error messsages. Additionally used in the XLA codebase as the ErrorCode\n+//   Enum value.\n+// - absl::StatusCode is the canonical absl::StatusCode that most closely\n+//   matches the error code.\n+// e.g. For X(\"E1234\", BinaryTooLarge, absl::StatusCode::kResourceExhausted)\n+// we generate:\n+// - ErrorCode::kBinaryTooLarge enum value\n+// - absl::Status BinaryTooLarge(...) factory function.\n+// These can be used in the XLA codebase to uniquely identify errors and to\n+// generate absl::Status objects with the correct error code respectively.\n+\n+#define XLA_ERROR_CODE_LIST(X)                                          \\\n+  /* go/keep-sorted start */                                            \\\n+  /* E00xx - Generic Error Codes mimicking absl::Status codes. */       \\\n+  X(\"E0000\", Cancelled, absl::StatusCode::kCancelled)                   \\\n+  X(\"E0001\", Unknown, absl::StatusCode::kUnknown)                       \\\n+  X(\"E0002\", InvalidArgument, absl::StatusCode::kInvalidArgument)       \\\n+  X(\"E0003\", DeadlineExceeded, absl::StatusCode::kDeadlineExceeded)     \\\n+  X(\"E0004\", NotFound, absl::StatusCode::kNotFound)                     \\\n+  X(\"E0005\", AlreadyExists, absl::StatusCode::kAlreadyExists)           \\\n+  X(\"E0006\", PermissionDenied, absl::StatusCode::kPermissionDenied)     \\\n+  X(\"E0007\", ResourceExhausted, absl::StatusCode::kResourceExhausted)   \\\n+  X(\"E0008\", FailedPrecondition, absl::StatusCode::kFailedPrecondition) \\\n+  X(\"E0009\", Aborted, absl::StatusCode::kAborted)                       \\\n+  X(\"E0010\", OutOfRange, absl::StatusCode::kOutOfRange)                 \\\n+  X(\"E0011\", Unimplemented, absl::StatusCode::kUnimplemented)           \\\n+  X(\"E0012\", Internal, absl::StatusCode::kInternal)                     \\\n+  X(\"E0013\", Unavailable, absl::StatusCode::kUnavailable)               \\\n+  X(\"E0014\", DataLoss, absl::StatusCode::kDataLoss)                     \\\n+  X(\"E0015\", Unauthenticated, absl::StatusCode::kUnauthenticated)       \\\n+                                                                        \\\n+  /* E1xxx - Compile Time OOM Error Codes */                            \\\n+                                                                        \\\n+  /* E2xxx - Compile Time Internal Error Codes */                       \\\n+                                                                        \\\n+  /* E3xxx - Compile Time Unimplemented Error Codes */                  \\\n+                                                                        \\\n+  /* E41xx - Compile Time Mosaic Internal Error Codes */                \\\n+                                                                        \\\n+  /* E42xx - Compile Time Mosaic User Error Codes */                    \\\n+                                                                        \\\n+  /* E43xx - Compile Time Mosaic Unimplemented Error Codes */           \\\n+                                                                        \\\n+  /* E4xxx - Compile Time Mosaic Deserialization Error Codes */         \\\n+                                                                        \\\n+  /* E50xx - Resource Exhausted, Memory Allocation Error Codes */       \\\n+                                                                        \\\n+  /* E51xx - Compiler Inserted Scheck(TC)/Assert(SC) Error Codes */     \\\n+                                                                        \\\n+  /* E52xx - Hardware Detected Program/User Errors Codes */             \\\n+                                                                        \\\n+  /* E53xx - Hardware/Network/Power Fatal Error Codes */                \\\n+                                                                        \\\n+  /* E54xx - Runtime Initiated Cancellations Error Codes */             \\\n+                                                                        \\\n+  /* E6xxx - Megascale, XLA “extensions” Error Codes */                 \\\n+                                                                        \\\n+  /* go/keep-sorted end */\n+\n+// Enum that enumerates all XLA error codes.\n+enum class ErrorCode {\n+#define DECLARE_ERROR_CODE_ENUM(string_id, enum_name, ...) k##enum_name,\n+  XLA_ERROR_CODE_LIST(DECLARE_ERROR_CODE_ENUM)\n+#undef DECLARE_ERROR_CODE_ENUM\n+};\n+\n+// === HELPER FUNCTIONS ===\n+\n+// Returns the canonical identifier of the error code. This is the identifier\n+// that is used in the XLA documentation to link to the documentation page for\n+// the error code.\n+inline absl::string_view ErrorCodeToStringIdentifier(ErrorCode code) {\n+  switch (code) {\n+#define GET_STRING_IDENTIFIER_CASE(string_id, enum_name, ...) \\\n+  case ErrorCode::k##enum_name:                               \\\n+    return string_id;\n+    XLA_ERROR_CODE_LIST(GET_STRING_IDENTIFIER_CASE)\n+#undef GET_STRING_IDENTIFIER_CASE\n+  }\n+  return \"UNKNOWN_CODE\";\n+}\n+\n+// Returns the human readable name of the error code.\n+inline absl::string_view ErrorCodeToName(ErrorCode code) {\n+  switch (code) {\n+#define GET_NAME_CASE(string_id, enum_name, _) \\\n+  case ErrorCode::k##enum_name:                \\\n+    return #enum_name;\n+    XLA_ERROR_CODE_LIST(GET_NAME_CASE)\n+#undef GET_NAME_CASE\n+  }\n+  return \"An unknown error occurred.\";\n+}\n+\n+// Returns the error code and name as a string, e.g. \"E0000: Cancelled\".\n+inline std::string GetErrorCodeAndName(ErrorCode code) {\n+  return absl::StrCat(ErrorCodeToStringIdentifier(code), \": \",\n+                      ErrorCodeToName(code));\n+}\n+\n+// Generates a URL for the error's documentation page.\n+// A string like \"https://openxla.org/xla/errors/E0000\".\n+inline std::string GetErrorUrl(ErrorCode code) {\n+  return absl::StrCat(\"https://openxla.org/xla/errors/\",\n+                      ErrorCodeToStringIdentifier(code));\n+}\n+\n+// === ErrorCode specific absl::Status factory functions ===\n+// Automatically generates a factory function for each error code\n+// to easily create a properly formatted absl::Status object.\n+// e.g. can be used as:\n+// error::InvalidArgument(\"Compilation failed with error: %s\", my_message);\n+#define DEFINE_ERROR_FACTORY_FUNCTION(string_id, enum_name, status_code) \\\n+  template <typename... Args>                                            \\\n+  inline absl::Status enum_name(const absl::FormatSpec<Args...>& format, \\\n+                                const Args&... args) {                   \\\n+    return absl::Status(                                                 \\\n+        status_code,                                                     \\\n+        absl::StrCat(GetErrorCodeAndName(ErrorCode::k##enum_name), \": \", \\\n+                     absl::StrFormat(format, args...)));                 \\\n+  }\n+\n+XLA_ERROR_CODE_LIST(DEFINE_ERROR_FACTORY_FUNCTION)\n+#undef DEFINE_ERROR_FACTORY_FUNCTION\n+\n+}  // namespace xla::error\n+\n+#endif  // XLA_ERRORS_ERROR_CODES_H_"
        },
        {
            "sha": "fbb83b5cf9db8d79776776d8b5438060e1912440",
            "filename": "third_party/xla/xla/errors/error_codes_test.cc",
            "status": "added",
            "additions": 63,
            "deletions": 0,
            "changes": 63,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e64d147efaa2816c64e4202595a7735cd11e57d4/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ferrors%2Ferror_codes_test.cc?ref=e64d147efaa2816c64e4202595a7735cd11e57d4",
            "patch": "@@ -0,0 +1,63 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/errors/error_codes.h\"\n+\n+#include <string>\n+\n+#include <gtest/gtest.h>\n+#include \"absl/status/status.h\"\n+\n+namespace xla::error {\n+namespace {\n+\n+// We will use kInvalidArgument for all single-value tests.\n+constexpr ErrorCode kTestCode = ErrorCode::kInvalidArgument;\n+\n+TEST(ErrorCodesTest, ErrorCodeToStringIdentifier) {\n+  // E0002 is the string_id for InvalidArgument in the macro list.\n+  EXPECT_EQ(ErrorCodeToStringIdentifier(kTestCode), \"E0002\");\n+}\n+\n+TEST(ErrorCodesTest, ErrorCodeToName) {\n+  // InvalidArgument is the enum_name for kInvalidArgument.\n+  EXPECT_EQ(ErrorCodeToName(kTestCode), \"InvalidArgument\");\n+}\n+\n+TEST(ErrorCodesTest, GetErrorCodeAndName) {\n+  // Should combine the string_id and enum_name.\n+  EXPECT_EQ(GetErrorCodeAndName(kTestCode), \"E0002: InvalidArgument\");\n+}\n+\n+TEST(ErrorCodesTest, GetErrorUrl) {\n+  // Should produce the documentation URL using the string_id.\n+  EXPECT_EQ(GetErrorUrl(kTestCode), \"https://openxla.org/xla/errors/E0002\");\n+}\n+\n+TEST(ErrorCodesTest, FactoryFunction) {\n+  // Test one of the generated factory functions.\n+  std::string detail = \"Something was wrong\";\n+  absl::Status status = InvalidArgument(\"Test error: %s\", detail);\n+\n+  // Check the absl::StatusCode defined in the macro.\n+  EXPECT_EQ(status.code(), absl::StatusCode::kInvalidArgument);\n+\n+  // Check the full formatted error message.\n+  EXPECT_EQ(status.message(),\n+            \"E0002: InvalidArgument: Test error: Something was wrong\");\n+}\n+\n+}  // namespace\n+}  // namespace xla::error"
        }
    ],
    "stats": {
        "total": 258,
        "additions": 258,
        "deletions": 0
    }
}