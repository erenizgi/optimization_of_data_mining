{
    "author": "majnemer",
    "message": "[TSL] Migrate code to using ABSL types\n\nNo functional change is intended.\n\nPiperOrigin-RevId: 828151815",
    "sha": "7171ee13715bcc096e67d015b6dca9b11cf51685",
    "files": [
        {
            "sha": "428cd23c16958a3dde9e66836834e20ccf9c8bbb",
            "filename": "tensorflow/python/_pywrap_tensorflow.def",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7171ee13715bcc096e67d015b6dca9b11cf51685/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7171ee13715bcc096e67d015b6dca9b11cf51685/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2F_pywrap_tensorflow.def?ref=7171ee13715bcc096e67d015b6dca9b11cf51685",
            "patch": "@@ -311,6 +311,7 @@ EXPORTS\n   ?EncodeToProto@ThreadSafeHistogram@histogram@tsl@@QEBAXPEAVHistogramProto@tensorflow@@_N@Z\n   ?EnqueueOpsFanin@GrapplerItem@grappler@tensorflow@@QEBA?AV?$vector@PEBVNodeDef@tensorflow@@V?$allocator@PEBVNodeDef@tensorflow@@@std@@@std@@XZ\n   ?EnsureInitialized@DataServiceDispatcherClient@data@tensorflow@@MEAA?AVStatus@lts_20250814@absl@@XZ\n+  ?EnsureMemoryTypes@tensorflow@@YA?AVStatus@lts_20250814@absl@@AEBVDeviceType@tsl@@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@PEAVGraph@1@@Z\n   ?Enter@PyContextManager@tensorflow@@QEAA_NPEAU_object@@@Z\n   ?EqualAttrValueWrapper@tensorflow@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@AEBV23@0@Z\n   ?EqualGraphDefWrapper@tensorflow@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@AEBV23@0@Z\n@@ -514,6 +515,7 @@ EXPORTS\n   ?Matrix@InferenceContext@shape_inference@tensorflow@@QEAA?AVShapeHandle@23@UDimensionOrConstant@23@0@Z\n   ?MaybeRaiseExceptionFromTFStatus@tensorflow@@YAHPEAUTSL_Status@@PEAU_object@@@Z\n   ?MemoryTypesForNode@tensorflow@@YA?AVStatus@lts_20250814@absl@@PEBVOpRegistryInterface@1@AEBVDeviceType@tsl@@AEBVNodeDef@1@PEAV?$InlinedVector@W4MemoryType@tensorflow@@$03V?$allocator@W4MemoryType@tensorflow@@@std@@@34@3@Z\n+  ?MemoryTypeForOutput@tensorflow@@YA?AVStatus@lts_20250814@absl@@AEBVDeviceType@tsl@@PEBVGraph@1@PEBVNode@1@HPEAW4MemoryType@1@@Z\n   ?Merge@InferenceContext@shape_inference@tensorflow@@QEAA?AVStatus@lts_20250814@absl@@VDimensionHandle@23@0PEAV723@@Z\n   ?Merge@InferenceContext@shape_inference@tensorflow@@QEAA?AVStatus@lts_20250814@absl@@VShapeHandle@23@0PEAV723@@Z\n   ?MeshDimNames@Mesh@dtensor@tensorflow@@QEBA?AV?$vector@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$allocator@V?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@2@@std@@XZ"
        },
        {
            "sha": "aa9ab54d7edf5ae580b39f97b698423db4bc62a5",
            "filename": "third_party/xla/xla/tsl/util/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD?ref=7171ee13715bcc096e67d015b6dca9b11cf51685",
            "patch": "@@ -305,11 +305,11 @@ cc_library(\n     hdrs = [\"command_line_flags.h\"],\n     deps = [\n         \"//xla/tsl/platform:logging\",\n-        \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/algorithm:container\",\n+        \"@com_google_absl//absl/functional:function_ref\",\n         \"@com_google_absl//absl/strings\",\n-        \"@local_tsl//tsl/platform:str_util\",\n-        \"@local_tsl//tsl/platform:stringpiece\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n+        \"@com_google_absl//absl/strings:str_format\",\n+        \"@com_google_absl//absl/types:span\",\n     ],\n )\n "
        },
        {
            "sha": "b5f12b443e667f3b848bd56c4cdfbc3f7c3a47c9",
            "filename": "third_party/xla/xla/tsl/util/command_line_flags.cc",
            "status": "modified",
            "additions": 69,
            "deletions": 91,
            "changes": 160,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.cc?ref=7171ee13715bcc096e67d015b6dca9b11cf51685",
            "patch": "@@ -16,68 +16,53 @@ limitations under the License.\n #include \"xla/tsl/util/command_line_flags.h\"\n \n #include <algorithm>\n-#include <cinttypes>\n-#include <cstring>\n+#include <cstdint>\n+#include <functional>\n+#include <limits>\n #include <string>\n+#include <utility>\n #include <vector>\n \n+#include \"absl/algorithm/container.h\"\n+#include \"absl/functional/function_ref.h\"\n #include \"absl/strings/match.h\"\n+#include \"absl/strings/numbers.h\"\n+#include \"absl/strings/str_format.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/strings/strip.h\"\n+#include \"absl/types/span.h\"\n #include \"xla/tsl/platform/logging.h\"\n-#include \"tsl/platform/str_util.h\"\n-#include \"tsl/platform/stringpiece.h\"\n-#include \"tsl/platform/stringprintf.h\"\n \n namespace tsl {\n namespace {\n \n bool ParseStringFlag(absl::string_view arg, absl::string_view flag,\n-                     const std::function<bool(string)>& hook,\n+                     absl::FunctionRef<bool(std::string)> hook,\n                      bool* value_parsing_ok) {\n   *value_parsing_ok = true;\n   if (absl::ConsumePrefix(&arg, \"--\") && absl::ConsumePrefix(&arg, flag) &&\n       absl::ConsumePrefix(&arg, \"=\")) {\n-    *value_parsing_ok = hook(string(arg));\n+    *value_parsing_ok = hook(std::string(arg));\n     return true;\n   }\n \n   return false;\n }\n \n-bool ParseInt32Flag(absl::string_view arg, absl::string_view flag,\n-                    const std::function<bool(int32_t)>& hook,\n-                    bool* value_parsing_ok) {\n+template <typename T>\n+bool ParseIntFlag(absl::string_view arg, absl::string_view flag,\n+                  absl::FunctionRef<bool(T)> hook, bool* value_parsing_ok) {\n+  static_assert(std::numeric_limits<T>::is_integer);\n   *value_parsing_ok = true;\n   if (absl::ConsumePrefix(&arg, \"--\") && absl::ConsumePrefix(&arg, flag) &&\n       absl::ConsumePrefix(&arg, \"=\")) {\n-    char extra;\n-    int32_t parsed_int32;\n-    if (sscanf(arg.data(), \"%d%c\", &parsed_int32, &extra) != 1) {\n-      LOG(ERROR) << \"Couldn't interpret value \" << arg << \" for flag \" << flag\n-                 << \".\";\n-      *value_parsing_ok = false;\n+    T parsed_int;\n+    if (absl::SimpleAtoi(arg, &parsed_int)) {\n+      *value_parsing_ok = hook(parsed_int);\n     } else {\n-      *value_parsing_ok = hook(parsed_int32);\n-    }\n-    return true;\n-  }\n-\n-  return false;\n-}\n-\n-bool ParseInt64Flag(absl::string_view arg, absl::string_view flag,\n-                    const std::function<bool(int64_t)>& hook,\n-                    bool* value_parsing_ok) {\n-  *value_parsing_ok = true;\n-  if (absl::ConsumePrefix(&arg, \"--\") && absl::ConsumePrefix(&arg, flag) &&\n-      absl::ConsumePrefix(&arg, \"=\")) {\n-    char extra;\n-    int64_t parsed_int64;\n-    if (sscanf(arg.data(), \"%\" SCNd64 \"%c\", &parsed_int64, &extra) != 1) {\n       LOG(ERROR) << \"Couldn't interpret value \" << arg << \" for flag \" << flag\n                  << \".\";\n       *value_parsing_ok = false;\n-    } else {\n-      *value_parsing_ok = hook(parsed_int64);\n     }\n     return true;\n   }\n@@ -86,8 +71,7 @@ bool ParseInt64Flag(absl::string_view arg, absl::string_view flag,\n }\n \n bool ParseBoolFlag(absl::string_view arg, absl::string_view flag,\n-                   const std::function<bool(bool)>& hook,\n-                   bool* value_parsing_ok) {\n+                   absl::FunctionRef<bool(bool)> hook, bool* value_parsing_ok) {\n   *value_parsing_ok = true;\n   if (absl::ConsumePrefix(&arg, \"--\") && absl::ConsumePrefix(&arg, flag)) {\n     if (arg.empty()) {\n@@ -105,31 +89,29 @@ bool ParseBoolFlag(absl::string_view arg, absl::string_view flag,\n     if (absl::EqualsIgnoreCase(arg, \"false\") || arg == \"0\") {\n       *value_parsing_ok = hook(false);\n       return true;\n-    } else {\n-      LOG(ERROR) << \"Couldn't interpret value \" << arg << \" for flag \" << flag\n-                 << \".\";\n-      *value_parsing_ok = false;\n-      return true;\n     }\n+    LOG(ERROR) << \"Couldn't interpret value \" << arg << \" for flag \" << flag\n+               << \".\";\n+    *value_parsing_ok = false;\n+    return true;\n   }\n \n   return false;\n }\n \n bool ParseFloatFlag(absl::string_view arg, absl::string_view flag,\n-                    const std::function<bool(float)>& hook,\n+                    absl::FunctionRef<bool(float)> hook,\n                     bool* value_parsing_ok) {\n   *value_parsing_ok = true;\n   if (absl::ConsumePrefix(&arg, \"--\") && absl::ConsumePrefix(&arg, flag) &&\n       absl::ConsumePrefix(&arg, \"=\")) {\n-    char extra;\n     float parsed_float;\n-    if (sscanf(arg.data(), \"%f%c\", &parsed_float, &extra) != 1) {\n+    if (absl::SimpleAtof(arg, &parsed_float)) {\n+      *value_parsing_ok = hook(parsed_float);\n+    } else {\n       LOG(ERROR) << \"Couldn't interpret value \" << arg << \" for flag \" << flag\n                  << \".\";\n       *value_parsing_ok = false;\n-    } else {\n-      *value_parsing_ok = hook(parsed_float);\n     }\n     return true;\n   }\n@@ -139,7 +121,7 @@ bool ParseFloatFlag(absl::string_view arg, absl::string_view flag,\n \n }  // namespace\n \n-Flag::Flag(const char* name, int32_t* dst, const string& usage_text,\n+Flag::Flag(const char* name, int32_t* dst, absl::string_view usage_text,\n            bool* dst_updated)\n     : name_(name),\n       type_(TYPE_INT32),\n@@ -153,7 +135,7 @@ Flag::Flag(const char* name, int32_t* dst, const string& usage_text,\n       int32_default_for_display_(*dst),\n       usage_text_(usage_text) {}\n \n-Flag::Flag(const char* name, int64_t* dst, const string& usage_text,\n+Flag::Flag(const char* name, int64_t* dst, absl::string_view usage_text,\n            bool* dst_updated)\n     : name_(name),\n       type_(TYPE_INT64),\n@@ -167,7 +149,7 @@ Flag::Flag(const char* name, int64_t* dst, const string& usage_text,\n       int64_default_for_display_(*dst),\n       usage_text_(usage_text) {}\n \n-Flag::Flag(const char* name, float* dst, const string& usage_text,\n+Flag::Flag(const char* name, float* dst, absl::string_view usage_text,\n            bool* dst_updated)\n     : name_(name),\n       type_(TYPE_FLOAT),\n@@ -181,7 +163,7 @@ Flag::Flag(const char* name, float* dst, const string& usage_text,\n       float_default_for_display_(*dst),\n       usage_text_(usage_text) {}\n \n-Flag::Flag(const char* name, bool* dst, const string& usage_text,\n+Flag::Flag(const char* name, bool* dst, absl::string_view usage_text,\n            bool* dst_updated)\n     : name_(name),\n       type_(TYPE_BOOL),\n@@ -195,11 +177,11 @@ Flag::Flag(const char* name, bool* dst, const string& usage_text,\n       bool_default_for_display_(*dst),\n       usage_text_(usage_text) {}\n \n-Flag::Flag(const char* name, string* dst, const string& usage_text,\n+Flag::Flag(const char* name, std::string* dst, absl::string_view usage_text,\n            bool* dst_updated)\n     : name_(name),\n       type_(TYPE_STRING),\n-      string_hook_([dst, dst_updated](string value) {\n+      string_hook_([dst, dst_updated](std::string value) {\n         *dst = std::move(value);\n         if (dst_updated) {\n           *dst_updated = true;\n@@ -210,51 +192,51 @@ Flag::Flag(const char* name, string* dst, const string& usage_text,\n       usage_text_(usage_text) {}\n \n Flag::Flag(const char* name, std::function<bool(int32_t)> int32_hook,\n-           int32_t default_value_for_display, const string& usage_text)\n+           int32_t default_value_for_display, absl::string_view usage_text)\n     : name_(name),\n       type_(TYPE_INT32),\n       int32_hook_(std::move(int32_hook)),\n       int32_default_for_display_(default_value_for_display),\n       usage_text_(usage_text) {}\n \n Flag::Flag(const char* name, std::function<bool(int64_t)> int64_hook,\n-           int64_t default_value_for_display, const string& usage_text)\n+           int64_t default_value_for_display, absl::string_view usage_text)\n     : name_(name),\n       type_(TYPE_INT64),\n       int64_hook_(std::move(int64_hook)),\n       int64_default_for_display_(default_value_for_display),\n       usage_text_(usage_text) {}\n \n Flag::Flag(const char* name, std::function<bool(float)> float_hook,\n-           float default_value_for_display, const string& usage_text)\n+           float default_value_for_display, absl::string_view usage_text)\n     : name_(name),\n       type_(TYPE_FLOAT),\n       float_hook_(std::move(float_hook)),\n       float_default_for_display_(default_value_for_display),\n       usage_text_(usage_text) {}\n \n Flag::Flag(const char* name, std::function<bool(bool)> bool_hook,\n-           bool default_value_for_display, const string& usage_text)\n+           bool default_value_for_display, absl::string_view usage_text)\n     : name_(name),\n       type_(TYPE_BOOL),\n       bool_hook_(std::move(bool_hook)),\n       bool_default_for_display_(default_value_for_display),\n       usage_text_(usage_text) {}\n \n-Flag::Flag(const char* name, std::function<bool(string)> string_hook,\n-           string default_value_for_display, const string& usage_text)\n+Flag::Flag(const char* name, std::function<bool(std::string)> string_hook,\n+           std::string default_value_for_display, absl::string_view usage_text)\n     : name_(name),\n       type_(TYPE_STRING),\n       string_hook_(std::move(string_hook)),\n       string_default_for_display_(std::move(default_value_for_display)),\n       usage_text_(usage_text) {}\n \n-bool Flag::Parse(string arg, bool* value_parsing_ok) const {\n+bool Flag::Parse(absl::string_view arg, bool* value_parsing_ok) const {\n   bool result = false;\n   if (type_ == TYPE_INT32) {\n-    result = ParseInt32Flag(arg, name_, int32_hook_, value_parsing_ok);\n+    result = ParseIntFlag<int32_t>(arg, name_, int32_hook_, value_parsing_ok);\n   } else if (type_ == TYPE_INT64) {\n-    result = ParseInt64Flag(arg, name_, int64_hook_, value_parsing_ok);\n+    result = ParseIntFlag<int64_t>(arg, name_, int64_hook_, value_parsing_ok);\n   } else if (type_ == TYPE_BOOL) {\n     result = ParseBoolFlag(arg, name_, bool_hook_, value_parsing_ok);\n   } else if (type_ == TYPE_STRING) {\n@@ -266,11 +248,12 @@ bool Flag::Parse(string arg, bool* value_parsing_ok) const {\n }\n \n /*static*/ bool Flags::Parse(int* argc, char** argv,\n-                             const std::vector<Flag>& flag_list) {\n+                             absl::Span<const Flag> flag_list) {\n   bool result = true;\n   std::vector<char*> unknown_flags;\n   for (int i = 1; i < *argc; ++i) {\n-    if (string(argv[i]) == \"--\") {\n+    absl::string_view arg = argv[i];\n+    if (arg == \"--\") {\n       while (i < *argc) {\n         unknown_flags.push_back(argv[i]);\n         ++i;\n@@ -281,7 +264,7 @@ bool Flag::Parse(string arg, bool* value_parsing_ok) const {\n     bool was_found = false;\n     for (const Flag& flag : flag_list) {\n       bool value_parsing_ok;\n-      was_found = flag.Parse(argv[i], &value_parsing_ok);\n+      was_found = flag.Parse(arg, &value_parsing_ok);\n       if (!value_parsing_ok) {\n         result = false;\n       }\n@@ -294,17 +277,14 @@ bool Flag::Parse(string arg, bool* value_parsing_ok) const {\n     }\n   }\n   // Passthrough any extra flags.\n-  int dst = 1;  // Skip argv[0]\n-  for (char* f : unknown_flags) {\n-    argv[dst++] = f;\n-  }\n-  argv[dst++] = nullptr;\n+  absl::c_copy(unknown_flags, argv + 1);\n   *argc = unknown_flags.size() + 1;\n-  return result && (*argc < 2 || strcmp(argv[1], \"--help\") != 0);\n+  argv[*argc] = nullptr;\n+  return result && (*argc < 2 || absl::string_view(argv[1]) != \"--help\");\n }\n \n /*static*/ bool Flags::Parse(std::vector<std::string>& flags,\n-                             const std::vector<Flag>& flag_list) {\n+                             absl::Span<const Flag> flag_list) {\n   bool result = true;\n   std::vector<std::string> unknown_flags;\n   for (auto& flag : flags) {\n@@ -321,47 +301,45 @@ bool Flag::Parse(string arg, bool* value_parsing_ok) const {\n       }\n     }\n   }\n-  auto IsEmpty = [](const std::string& flag) { return flag.empty(); };\n+  auto IsEmpty = [](absl::string_view flag) { return flag.empty(); };\n   flags.erase(std::remove_if(flags.begin(), flags.end(), IsEmpty), flags.end());\n   return result;\n }\n \n-/*static*/ string Flags::Usage(const string& cmdline,\n-                               const std::vector<Flag>& flag_list) {\n-  string usage_text;\n+/*static*/ std::string Flags::Usage(absl::string_view cmdline,\n+                                    absl::Span<const Flag> flag_list) {\n+  std::string usage_text;\n   if (!flag_list.empty()) {\n-    strings::Appendf(&usage_text, \"usage: %s\\nFlags:\\n\", cmdline.c_str());\n+    absl::StrAppendFormat(&usage_text, \"usage: %s\\nFlags:\\n\", cmdline);\n   } else {\n-    strings::Appendf(&usage_text, \"usage: %s\\n\", cmdline.c_str());\n+    absl::StrAppendFormat(&usage_text, \"usage: %s\\n\", cmdline);\n   }\n   for (const Flag& flag : flag_list) {\n     const char* type_name = \"\";\n-    string flag_string;\n+    std::string flag_string;\n     if (flag.type_ == Flag::TYPE_INT32) {\n       type_name = \"int32\";\n-      flag_string = strings::Printf(\"--%s=%d\", flag.name_.c_str(),\n+      flag_string = absl::StrFormat(\"--%s=%d\", flag.name_,\n                                     flag.int32_default_for_display_);\n     } else if (flag.type_ == Flag::TYPE_INT64) {\n       type_name = \"int64\";\n-      flag_string = strings::Printf(\n-          \"--%s=%lld\", flag.name_.c_str(),\n-          static_cast<long long>(flag.int64_default_for_display_));\n+      flag_string = absl::StrFormat(\"--%s=%d\", flag.name_,\n+                                    flag.int64_default_for_display_);\n     } else if (flag.type_ == Flag::TYPE_BOOL) {\n       type_name = \"bool\";\n-      flag_string =\n-          strings::Printf(\"--%s=%s\", flag.name_.c_str(),\n-                          flag.bool_default_for_display_ ? \"true\" : \"false\");\n+      flag_string = absl::StrFormat(\"--%s=%v\", flag.name_,\n+                                    flag.bool_default_for_display_);\n     } else if (flag.type_ == Flag::TYPE_STRING) {\n       type_name = \"string\";\n-      flag_string = strings::Printf(\"--%s=\\\"%s\\\"\", flag.name_.c_str(),\n-                                    flag.string_default_for_display_.c_str());\n+      flag_string = absl::StrFormat(\"--%s=\\\"%s\\\"\", flag.name_,\n+                                    flag.string_default_for_display_);\n     } else if (flag.type_ == Flag::TYPE_FLOAT) {\n       type_name = \"float\";\n-      flag_string = strings::Printf(\"--%s=%f\", flag.name_.c_str(),\n+      flag_string = absl::StrFormat(\"--%s=%f\", flag.name_,\n                                     flag.float_default_for_display_);\n     }\n-    strings::Appendf(&usage_text, \"\\t%-33s\\t%s\\t%s\\n\", flag_string.c_str(),\n-                     type_name, flag.usage_text_.c_str());\n+    absl::StrAppendFormat(&usage_text, \"\\t%-33s\\t%s\\t%s\\n\", flag_string,\n+                          type_name, flag.usage_text_);\n   }\n   return usage_text;\n }"
        },
        {
            "sha": "55fd3366eaf67a24ad5e17a59515fc85810af440",
            "filename": "third_party/xla/xla/tsl/util/command_line_flags.h",
            "status": "modified",
            "additions": 24,
            "deletions": 22,
            "changes": 46,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7171ee13715bcc096e67d015b6dca9b11cf51685/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fcommand_line_flags.h?ref=7171ee13715bcc096e67d015b6dca9b11cf51685",
            "patch": "@@ -16,11 +16,13 @@ limitations under the License.\n #ifndef XLA_TSL_UTIL_COMMAND_LINE_FLAGS_H_\n #define XLA_TSL_UTIL_COMMAND_LINE_FLAGS_H_\n \n+#include <cstdint>\n #include <functional>\n #include <string>\n #include <vector>\n \n-#include \"xla/tsl/platform/types.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n \n namespace tsl {\n \n@@ -63,15 +65,15 @@ namespace tsl {\n // text, and a pointer to the corresponding variable.\n class Flag {\n  public:\n-  Flag(const char* name, int32* dst, const string& usage_text,\n+  Flag(const char* name, int32_t* dst, absl::string_view usage_text,\n        bool* dst_updated = nullptr);\n-  Flag(const char* name, int64_t* dst, const string& usage_text,\n+  Flag(const char* name, int64_t* dst, absl::string_view usage_text,\n        bool* dst_updated = nullptr);\n-  Flag(const char* name, bool* dst, const string& usage_text,\n+  Flag(const char* name, bool* dst, absl::string_view usage_text,\n        bool* dst_updated = nullptr);\n-  Flag(const char* name, string* dst, const string& usage_text,\n+  Flag(const char* name, std::string* dst, absl::string_view usage_text,\n        bool* dst_updated = nullptr);\n-  Flag(const char* name, float* dst, const string& usage_text,\n+  Flag(const char* name, float* dst, absl::string_view usage_text,\n        bool* dst_updated = nullptr);\n \n   // These constructors invoke a hook on a match instead of writing to a\n@@ -81,22 +83,22 @@ class Flag {\n   // \"default_value_for_display\" is shown as the default value of this flag in\n   // Flags::Usage().\n   Flag(const char* name, std::function<bool(int32_t)> int32_hook,\n-       int32_t default_value_for_display, const string& usage_text);\n+       int32_t default_value_for_display, absl::string_view usage_text);\n   Flag(const char* name, std::function<bool(int64_t)> int64_hook,\n-       int64_t default_value_for_display, const string& usage_text);\n+       int64_t default_value_for_display, absl::string_view usage_text);\n   Flag(const char* name, std::function<bool(float)> float_hook,\n-       float default_value_for_display, const string& usage_text);\n+       float default_value_for_display, absl::string_view usage_text);\n   Flag(const char* name, std::function<bool(bool)> bool_hook,\n-       bool default_value_for_display, const string& usage_text);\n-  Flag(const char* name, std::function<bool(string)> string_hook,\n-       string default_value_for_display, const string& usage_text);\n+       bool default_value_for_display, absl::string_view usage_text);\n+  Flag(const char* name, std::function<bool(std::string)> string_hook,\n+       std::string default_value_for_display, absl::string_view usage_text);\n \n  private:\n   friend class Flags;\n \n-  bool Parse(string arg, bool* value_parsing_ok) const;\n+  bool Parse(absl::string_view arg, bool* value_parsing_ok) const;\n \n-  string name_;\n+  std::string name_;\n   enum {\n     TYPE_INT32,\n     TYPE_INT64,\n@@ -106,7 +108,7 @@ class Flag {\n   } type_;\n \n   std::function<bool(int32_t)> int32_hook_;\n-  int32 int32_default_for_display_;\n+  int32_t int32_default_for_display_;\n \n   std::function<bool(int64_t)> int64_hook_;\n   int64_t int64_default_for_display_;\n@@ -117,10 +119,10 @@ class Flag {\n   std::function<bool(bool)> bool_hook_;\n   bool bool_default_for_display_;\n \n-  std::function<bool(string)> string_hook_;\n-  string string_default_for_display_;\n+  std::function<bool(std::string)> string_hook_;\n+  std::string string_default_for_display_;\n \n-  string usage_text_;\n+  std::string usage_text_;\n };\n \n class Flags {\n@@ -130,17 +132,17 @@ class Flags {\n   // with matching flags, and remove the matching arguments from (*argc, argv).\n   // Return true iff all recognized flag values were parsed correctly, and the\n   // first remaining argument is not \"--help\".\n-  static bool Parse(int* argc, char** argv, const std::vector<Flag>& flag_list);\n+  static bool Parse(int* argc, char** argv, absl::Span<const Flag> flag_list);\n \n   // Similar as above, but accepts a mutable vector of strings in place of\n   // argc and argv. Doesn't ignore the first flag, and return the unknown flags\n   // back in flags vector.\n   static bool Parse(std::vector<std::string>& flags,\n-                    const std::vector<Flag>& flag_list);\n+                    absl::Span<const Flag> flag_list);\n   // Return a usage message with command line cmdline, and the\n   // usage_text strings in flag_list[].\n-  static string Usage(const string& cmdline,\n-                      const std::vector<Flag>& flag_list);\n+  static std::string Usage(absl::string_view cmdline,\n+                           absl::Span<const Flag> flag_list);\n };\n \n }  // namespace tsl"
        }
    ],
    "stats": {
        "total": 216,
        "additions": 99,
        "deletions": 117
    }
}