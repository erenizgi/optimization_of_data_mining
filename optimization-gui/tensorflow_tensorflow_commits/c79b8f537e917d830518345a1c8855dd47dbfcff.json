{
    "author": "tensorflower-gardener",
    "message": "Remove IndexingMap dependency from symbolic_map_converter\n\nThis CL removes this dependency by:\n- Templatizing the `ConvertAffineConstraintsToSymbolicConstraints` function, making it generic with respect to the Interval type used.\n- Moving the template function definition to the header file.\n- Copying the necessary `ParseAffineMap` test utility function into `symbolic_map_converter_test.cc`.\n\nThis change decouples `symbolic_map_converter` from the larger `IndexingMap` component, making it more self-contained and allowing to include it in IndexingMap in a following CL.\n\nPiperOrigin-RevId: 810837686",
    "sha": "c79b8f537e917d830518345a1c8855dd47dbfcff",
    "files": [
        {
            "sha": "c68e5a652dcc3837c92c07eb6d538b0733488c22",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/BUILD",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2FBUILD?ref=c79b8f537e917d830518345a1c8855dd47dbfcff",
            "patch": "@@ -269,7 +269,7 @@ cc_library(\n     deps = [\n         \":symbolic_expr\",\n         \":symbolic_map\",\n-        \"//xla/hlo/analysis:indexing_analysis\",\n+        \"//xla/hlo/analysis:interval\",\n         \"@llvm-project//llvm:Support\",\n         \"@llvm-project//mlir:IR\",\n         \"@llvm-project//mlir:Support\",\n@@ -283,10 +283,12 @@ xla_cc_test(\n         \":symbolic_expr\",\n         \":symbolic_map\",\n         \":symbolic_map_converter\",\n-        \"//xla/hlo/analysis:indexing_analysis\",\n-        \"//xla/hlo/analysis:indexing_test_utils\",\n+        \"//xla/hlo/analysis:interval\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@llvm-project//llvm:Support\",\n+        \"@llvm-project//mlir:AsmParser\",\n         \"@llvm-project//mlir:IR\",\n+        \"@llvm-project//mlir:Support\",\n     ],\n )"
        },
        {
            "sha": "7b5253b4d00c7cf189172a262e0917d28eec0725",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_map_converter.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.cc?ref=c79b8f537e917d830518345a1c8855dd47dbfcff",
            "patch": "@@ -17,13 +17,11 @@ limitations under the License.\n \n #include <cstdint>\n \n-#include \"llvm/ADT/MapVector.h\"\n #include \"llvm/ADT/SmallVector.h\"\n #include \"mlir/IR/AffineExpr.h\"\n #include \"mlir/IR/AffineMap.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"mlir/Support/LLVM.h\"\n-#include \"xla/hlo/analysis/indexing_map.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_expr.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_map.h\"\n "
        },
        {
            "sha": "362f0f41943dd420e5c23cb50e638be74cd23ccb",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_map_converter.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter.h?ref=c79b8f537e917d830518345a1c8855dd47dbfcff",
            "patch": "@@ -20,7 +20,7 @@ limitations under the License.\n #include \"mlir/IR/AffineExpr.h\"\n #include \"mlir/IR/AffineMap.h\"\n #include \"mlir/IR/MLIRContext.h\"\n-#include \"xla/hlo/analysis/indexing_map.h\"\n+#include \"xla/hlo/analysis/interval.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_expr.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_map.h\"\n "
        },
        {
            "sha": "219129d784fb68f84d6c9c9a2b7b11798eac3d24",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_map_converter_test.cc",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c79b8f537e917d830518345a1c8855dd47dbfcff/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_map_converter_test.cc?ref=c79b8f537e917d830518345a1c8855dd47dbfcff",
            "patch": "@@ -15,14 +15,20 @@ limitations under the License.\n \n #include \"xla/service/gpu/model/experimental/symbolic_map_converter.h\"\n \n+#include <string>\n+\n #include <gtest/gtest.h>\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"llvm/ADT/MapVector.h\"\n #include \"llvm/ADT/SmallVector.h\"\n+#include \"mlir/AsmParser/AsmParser.h\"\n #include \"mlir/IR/AffineExpr.h\"\n #include \"mlir/IR/AffineMap.h\"\n+#include \"mlir/IR/BuiltinAttributes.h\"\n #include \"mlir/IR/MLIRContext.h\"\n-#include \"xla/hlo/analysis/indexing_map.h\"\n-#include \"xla/hlo/analysis/indexing_test_utils.h\"\n+#include \"mlir/Support/LLVM.h\"\n+#include \"xla/hlo/analysis/interval.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_expr.h\"\n #include \"xla/service/gpu/model/experimental/symbolic_map.h\"\n \n@@ -33,6 +39,19 @@ namespace {\n using ::mlir::AffineMap;\n using ::mlir::MLIRContext;\n \n+// TODO: b/433693782 - This code is duplicated from indexing_test_utils. Remove\n+// this function as soon as symbolic_map_converter is not needed anymore. If\n+// not, we should refactor it to a common test library.\n+// Helper function to parse an AffineMap from a string.\n+AffineMap ParseAffineMap(absl::string_view serialized_affine_map,\n+                         MLIRContext* context) {\n+  std::string full_affine_map_string =\n+      absl::StrCat(\"affine_map<\", serialized_affine_map, \">\");\n+  return mlir::cast<mlir::AffineMapAttr>(\n+             mlir::parseAttribute(full_affine_map_string, context))\n+      .getValue();\n+}\n+\n TEST(SymbolicMapConverterTest, AffineToSymbolicRoundTrip) {\n   MLIRContext mlir_context;\n   SymbolicExprContext symbolic_context;"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 27,
        "deletions": 8
    }
}