{
    "author": "emilyfertig",
    "message": "[PJRT C API] Fix ASAN bug in cross-host transfer extension tests.\n\nPiperOrigin-RevId: 835632632",
    "sha": "2927021c6ceb68a13639b9107fba227f69c3fca3",
    "files": [
        {
            "sha": "1246e1a487421cc6ede6340d4854eaff1a32a445",
            "filename": "third_party/xla/xla/pjrt/extensions/cross_host_transfers/pjrt_c_api_cross_host_transfers_extension_gpu_test.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2927021c6ceb68a13639b9107fba227f69c3fca3/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fcross_host_transfers%2Fpjrt_c_api_cross_host_transfers_extension_gpu_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2927021c6ceb68a13639b9107fba227f69c3fca3/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fcross_host_transfers%2Fpjrt_c_api_cross_host_transfers_extension_gpu_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fextensions%2Fcross_host_transfers%2Fpjrt_c_api_cross_host_transfers_extension_gpu_test.cc?ref=2927021c6ceb68a13639b9107fba227f69c3fca3",
            "patch": "@@ -211,6 +211,9 @@ absl::Status SuccessfulCrossHostTransferTestBody(bool is_sender,\n     std::vector<PJRT_Buffer*> raw_buffers;\n     std::vector<xla::PjRtGlobalDeviceId> dst_device_ids;\n     std::vector<xla::CrossHostTransferKey> transfer_keys;\n+    raw_buffers.reserve(num_arrays);\n+    dst_device_ids.reserve(num_arrays);\n+    transfer_keys.reserve(num_arrays);\n     for (int i = 0; i < num_arrays; ++i) {\n       // Create buffers to send.\n       std::vector<float> data = {1, 2, 3, 4, 5, 6 * static_cast<float>(i)};\n@@ -287,6 +290,13 @@ absl::Status SuccessfulCrossHostTransferTestBody(bool is_sender,\n     std::vector<const int64_t*> num_dims;\n     std::vector<PJRT_Buffer_Type> element_types;\n     std::vector<PJRT_Buffer_MemoryLayout*> layouts;\n+    shapes.reserve(num_arrays);\n+    src_device_ids.reserve(num_arrays);\n+    transfer_keys.reserve(num_arrays);\n+    shape_num_dims.reserve(num_arrays);\n+    num_dims.reserve(num_arrays);\n+    element_types.reserve(num_arrays);\n+    layouts.reserve(num_arrays);\n     xla::PjRtGlobalDeviceId dst_device_id =\n         GetClientAddressableDevices(create_arg.client, api)[0]\n             ->device->global_device_id();"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 10,
        "deletions": 0
    }
}