{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@d5ce81dc8143\n\nUpdates LLVM usage to match\n[d5ce81dc8143](https://github.com/llvm/llvm-project/commit/d5ce81dc8143)\n\nPiperOrigin-RevId: 821627987",
    "sha": "789f9c8c928265429d400c0e3622eab712f5c4d7",
    "files": [
        {
            "sha": "4811331ef1a8faf45f62423a8f8efd4119dfe4c9",
            "filename": "tensorflow/dtensor/mlir/ir/tf_dtensor.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/789f9c8c928265429d400c0e3622eab712f5c4d7/tensorflow%2Fdtensor%2Fmlir%2Fir%2Ftf_dtensor.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/789f9c8c928265429d400c0e3622eab712f5c4d7/tensorflow%2Fdtensor%2Fmlir%2Fir%2Ftf_dtensor.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fdtensor%2Fmlir%2Fir%2Ftf_dtensor.cc?ref=789f9c8c928265429d400c0e3622eab712f5c4d7",
            "patch": "@@ -35,6 +35,8 @@ limitations under the License.\n // TableGen'd op method definitions\n //===----------------------------------------------------------------------===//\n \n+using namespace mlir;  // NOLINT\n+\n namespace mlir {\n namespace TF {\n namespace {"
        },
        {
            "sha": "622428b6e1a8579d1dfb1c48d9eaa54450bf4532",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=789f9c8c928265429d400c0e3622eab712f5c4d7",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"bfee9db7857757e63b64fb4d411a264690ff711a\"\n-    LLVM_SHA256 = \"b14cb659a35562d1fccee470d0bba41cf96363e1b576e113a3a795db9ad78e3e\"\n+    LLVM_COMMIT = \"d5ce81dc8143eed18a7342093b991a63b025e2d9\"\n+    LLVM_SHA256 = \"07efbd552b4539a0b52201cfe73767a4265720789facdfa0d73bfeeb78ea19d3\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "98168ce1d09c1995f1f0dbc2e7c1e61e0624c5dc",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 45,
            "deletions": 61,
            "changes": 106,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=789f9c8c928265429d400c0e3622eab712f5c4d7",
            "patch": "@@ -1,71 +1,55 @@\n-diff --git a/docs/mpmd/mpmd_sharding_propagation_passes.md b/docs/mpmd/mpmd_sharding_propagation_passes.md\n-index a3b51cc..3b40773 100644\n---- a/docs/mpmd/mpmd_sharding_propagation_passes.md\n-+++ b/docs/mpmd/mpmd_sharding_propagation_passes.md\n-@@ -57,10 +57,3 @@ This pass is only applied to MPMD functions in global view and with a\n- homogeneous topology.\n- \n- Precondition: all shardings are specified as op attributes and not in types.\n--\n--### `-mpmd-simplify-program`\n--\n--_Removes redundant arg/results from fragments._\n--\n--Simplifies a fragment or loop, its operands and results, and their\n--corresponding block arguments and return values.\n-diff --git a/shardy/dialect/sdy/transforms/export/explicit_reshards_util.cc b/shardy/dialect/sdy/transforms/export/explicit_reshards_util.cc\n-index 862a2da..be8f02c 100644\n---- a/shardy/dialect/sdy/transforms/export/explicit_reshards_util.cc\n-+++ b/shardy/dialect/sdy/transforms/export/explicit_reshards_util.cc\n-@@ -433,9 +433,11 @@ class FactorAxesCandidateBag {\n-         for (int64_t index = 1; index < factorIndices.size(); index++) {\n-           int64_t factorIndex = factorIndices[index];\n-           int64_t dependsOn = factorIndices[index - 1];\n--          factorDependenciesMap\n--              .try_emplace(factorIndex, shardingRule.getNumFactors())\n--              .first->second.set(dependsOn);\n-+          if (!factorDependenciesMap.contains(factorIndex)) {\n-+            factorDependenciesMap.try_emplace(factorIndex,\n-+                                              shardingRule.getNumFactors());\n-+          }\n-+          factorDependenciesMap[factorIndex].set(dependsOn);\n-         }\n-       }\n-     }\n-diff --git a/shardy/dialect/sdy/transforms/export/insert_explicit_reshards.cc b/shardy/dialect/sdy/transforms/export/insert_explicit_reshards.cc\n-index dcec262..b1d7585 100644\n---- a/shardy/dialect/sdy/transforms/export/insert_explicit_reshards.cc\n-+++ b/shardy/dialect/sdy/transforms/export/insert_explicit_reshards.cc\n-@@ -77,7 +77,7 @@ void insertExplicitReshardsToTargetSharding(OpOperand& opOperand,\n-         rewriter, operand.getLoc(), operand,\n-         targetSharding\n-             ? targetSharding\n--            // Since operand and target shardings are not equivalent and\n-+            // Since opearand and target shardings are not equivalent and\n-             // `targetSharding` is empty, `operandSharding` is guaranteed to be\n-             // nonempty.\n-             : TensorShardingAttr::getFullyClosedLike(operandSharding));\n-@@ -327,7 +327,7 @@ void insertAllReduceOnOpIfUnreducedToReplicated(\n-       return sharding && !sharding.getUnreducedAxes().empty();\n-     };\n-     SDY_CHECK(!llvm::any_of(op->getOpOperands(), operandHasUnreducedAxes))\n--        << \"Some operands have unreduced axes but the operation has no \"\n-+        << \"Some operands has unreduced axes but the operation has no \"\n-           \"results. \";\n-     return;\n-   }\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index ed562d4..ba4c1a2 100644\n+index ba4c1a2..622428b 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"267fa8dd1efce0b79ebcaa804d54542c99918df2\"\n--    LLVM_SHA256 = \"a72180219b02c46a11fa11d7ca3e5c4f57ecaa348162e010e73a59bd26623950\"\n-+    LLVM_COMMIT = \"bfee9db7857757e63b64fb4d411a264690ff711a\"\n-+    LLVM_SHA256 = \"b14cb659a35562d1fccee470d0bba41cf96363e1b576e113a3a795db9ad78e3e\"\n+-    LLVM_COMMIT = \"bfee9db7857757e63b64fb4d411a264690ff711a\"\n+-    LLVM_SHA256 = \"b14cb659a35562d1fccee470d0bba41cf96363e1b576e113a3a795db9ad78e3e\"\n++    LLVM_COMMIT = \"d5ce81dc8143eed18a7342093b991a63b025e2d9\"\n++    LLVM_SHA256 = \"07efbd552b4539a0b52201cfe73767a4265720789facdfa0d73bfeeb78ea19d3\"\n  \n      tf_http_archive(\n          name = name,\n+diff --git a/third_party/stablehlo/temporary.patch b/third_party/stablehlo/temporary.patch\n+index 8949936..473baf0 100755\n+--- a/third_party/stablehlo/temporary.patch\n++++ b/third_party/stablehlo/temporary.patch\n+@@ -537,6 +537,17 @@ diff --ruN a/stablehlo/stablehlo/conversions/tosa/transforms/StablehloQuantLegal\n+    // unary ops\n+    patterns->addWithLabel<QuantizedStablehloOpConversion<stablehlo::AbsOp>>(\n+        {\"StablehloQuantAbsOp\"}, context);\n++diff --ruN a/stablehlo/stablehlo/dialect/StablehloOps.cpp b/stablehlo/stablehlo/dialect/StablehloOps.cpp\n++--- stablehlo/stablehlo/dialect/StablehloOps.cpp\n+++++ stablehlo/stablehlo/dialect/StablehloOps.cpp\n++@@ -3164,6 +3164,7 @@\n++ using mlir::hlo::printVariadicOperandWithAttribute;\n++ using mlir::hlo::printVariadicSameOperandsAndResultType;\n++ \n+++using mlir::stablehlo::TokenType;\n++ #define GET_OP_CLASSES\n++ #include \"stablehlo/dialect/StablehloOps.cpp.inc\"\n++ \n+ diff --ruN a/stablehlo/stablehlo/integrations/c/VhloDialect.h b/stablehlo/stablehlo/integrations/c/VhloDialect.h\n+ --- stablehlo/stablehlo/integrations/c/VhloDialect.h\n+ +++ stablehlo/stablehlo/integrations/c/VhloDialect.h\n+@@ -787,6 +798,17 @@ diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/StablehloBuilderTest.c\n+ +\n+  }  // namespace stablehlo\n+  }  // namespace mlir\n++diff --ruN a/stablehlo/stablehlo/reference/InterpreterOps.cpp b/stablehlo/stablehlo/reference/InterpreterOps.cpp\n++--- stablehlo/stablehlo/reference/InterpreterOps.cpp\n+++++ stablehlo/stablehlo/reference/InterpreterOps.cpp\n++@@ -46,6 +46,7 @@\n++ #include \"stablehlo/reference/ProcessGrid.h\"\n++ #include \"stablehlo/reference/Value.h\"\n++ \n+++using mlir::stablehlo::TokenType;\n++ #define GET_OP_CLASSES\n++ #include \"stablehlo/reference/InterpreterOps.cpp.inc\"\n++ \n+ diff --ruN a/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir b/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n+ --- stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n+ +++ stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir"
        },
        {
            "sha": "dce73854b3d7d1d016fb66d7333030c738dea7fd",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=789f9c8c928265429d400c0e3622eab712f5c4d7",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"8349f4b45638848d28fb7ad366c68d4ed16710ab\"\n-    SHARDY_SHA256 = \"cc7856517bec649903d302496922cef92373bb654c5f53da0014822bbff6835f\"\n+    SHARDY_COMMIT = \"979d3d27750f9dc3d7596823f30a10511f73f25a\"\n+    SHARDY_SHA256 = \"aee2b07f6925a71ac582c44e758b63b7ea53c30c8324ee5e917ab18e090a8f42\"\n \n     tf_http_archive(\n         name = \"shardy\","
        },
        {
            "sha": "473baf0999de10562e9d35dc8ff9c587e6deee83",
            "filename": "third_party/xla/third_party/stablehlo/temporary.patch",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/789f9c8c928265429d400c0e3622eab712f5c4d7/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch?ref=789f9c8c928265429d400c0e3622eab712f5c4d7",
            "patch": "@@ -537,6 +537,17 @@ diff --ruN a/stablehlo/stablehlo/conversions/tosa/transforms/StablehloQuantLegal\n    // unary ops\n    patterns->addWithLabel<QuantizedStablehloOpConversion<stablehlo::AbsOp>>(\n        {\"StablehloQuantAbsOp\"}, context);\n+diff --ruN a/stablehlo/stablehlo/dialect/StablehloOps.cpp b/stablehlo/stablehlo/dialect/StablehloOps.cpp\n+--- stablehlo/stablehlo/dialect/StablehloOps.cpp\n++++ stablehlo/stablehlo/dialect/StablehloOps.cpp\n+@@ -3164,6 +3164,7 @@\n+ using mlir::hlo::printVariadicOperandWithAttribute;\n+ using mlir::hlo::printVariadicSameOperandsAndResultType;\n+ \n++using mlir::stablehlo::TokenType;\n+ #define GET_OP_CLASSES\n+ #include \"stablehlo/dialect/StablehloOps.cpp.inc\"\n+ \n diff --ruN a/stablehlo/stablehlo/integrations/c/VhloDialect.h b/stablehlo/stablehlo/integrations/c/VhloDialect.h\n --- stablehlo/stablehlo/integrations/c/VhloDialect.h\n +++ stablehlo/stablehlo/integrations/c/VhloDialect.h\n@@ -787,6 +798,17 @@ diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/StablehloBuilderTest.c\n +\n  }  // namespace stablehlo\n  }  // namespace mlir\n+diff --ruN a/stablehlo/stablehlo/reference/InterpreterOps.cpp b/stablehlo/stablehlo/reference/InterpreterOps.cpp\n+--- stablehlo/stablehlo/reference/InterpreterOps.cpp\n++++ stablehlo/stablehlo/reference/InterpreterOps.cpp\n+@@ -46,6 +46,7 @@\n+ #include \"stablehlo/reference/ProcessGrid.h\"\n+ #include \"stablehlo/reference/Value.h\"\n+ \n++using mlir::stablehlo::TokenType;\n+ #define GET_OP_CLASSES\n+ #include \"stablehlo/reference/InterpreterOps.cpp.inc\"\n+ \n diff --ruN a/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir b/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n --- stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n +++ stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir"
        }
    ],
    "stats": {
        "total": 138,
        "additions": 73,
        "deletions": 65
    }
}