{
    "author": "kanvi-nervana",
    "message": "PR #30555: [XLA:GPU][oneAPI] Add sycl_timer component and test\n\nImported from GitHub PR https://github.com/openxla/xla/pull/30555\n\nco-author: @bhavani-subramanian\nThis PR adds the sycl_timer component and corresponding test.\nCopybara import of the project:\n\n--\n5be9693f3d5e7c72266426db2a4c4318a39e2ea6 by Bhavani Subramanian <bhavani1.subramanian@intel.com>:\n\nAdded support for sycl_event and corresponding test\n\n--\nf852fdcf2a8f2bcbd5aa253bc331775758ecb964 by Bhavani Subramanian <bhavani1.subramanian@intel.com>:\n\nUsed sycl_library instead of cc_library for sycl_kernel target\n\n--\n25a9c17618c9c77dcf93696a7a8d605dbb899ef8 by kanvi khanna <kanvi.khanna@intel.com>:\n\nAdd sycl timer component and test\n\n--\n819250c19355b8988889ae58a9d3c2d34fd123da by kanvi khanna <kanvi.khanna@intel.com>:\n\nremove individual targets from test script\n\n--\n9f2e70283b9220346c1fa4fdb7ba371e271a15e0 by kanvi khanna <kanvi.khanna@intel.com>:\n\nchange permissions\n\nMerging this change closes #30555\n\nPiperOrigin-RevId: 806224706",
    "sha": "7d9eb126082adb241f27e34249187b32ba4f3c80",
    "files": [
        {
            "sha": "547e67958714e3f362889fbf883ba519581b47a7",
            "filename": "third_party/xla/build_tools/sycl/ci_test_xla.sh",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fbuild_tools%2Fsycl%2Fci_test_xla.sh",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fbuild_tools%2Fsycl%2Fci_test_xla.sh",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fsycl%2Fci_test_xla.sh?ref=7d9eb126082adb241f27e34249187b32ba4f3c80",
            "patch": "@@ -22,6 +22,4 @@ bazel test \\\n       --verbose_failures -c opt \\\n       --build_tag_filters=gpu,oneapi-only,requires-gpu-intel,-requires-gpu-amd,-requires-gpu-nvidia,-no_oss,-cuda-only,-rocm-only,-no-oneapi \\\n       --test_tag_filters=gpu,oneapi-only,requires-gpu-intel,-requires-gpu-amd,-requires-gpu-nvidia,-no_oss,-cuda-only,-rocm-only,-no-oneapi \\\n-      //xla/stream_executor/sycl:sycl_status_test \\\n-      //xla/stream_executor/sycl:sycl_event_test_intelgpu_any \\\n-      //xla/stream_executor/sycl:sycl_kernel_test_intelgpu_any\n+      //xla/stream_executor/sycl/..."
        },
        {
            "sha": "0af5d7116a532ffa897627443d0ec0367c300b43",
            "filename": "third_party/xla/xla/stream_executor/sycl/BUILD",
            "status": "modified",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2FBUILD?ref=7d9eb126082adb241f27e34249187b32ba4f3c80",
            "patch": "@@ -218,3 +218,38 @@ xla_test(\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n+\n+sycl_library(\n+    name = \"sycl_timer\",\n+    srcs = [\"sycl_timer.cc\"],\n+    hdrs = [\"sycl_timer.h\"],\n+    tags = [\n+        \"gpu\",\n+        \"oneapi-only\",\n+    ],\n+    deps = [\n+        \":sycl_event\",\n+        \"//xla/stream_executor:event_based_timer\",\n+        \"//xla/stream_executor:stream\",\n+        \"//xla/stream_executor:stream_executor_h\",\n+        \"@com_google_absl//absl/status:statusor\",\n+        \"@com_google_absl//absl/time\",\n+    ],\n+)\n+\n+xla_test(\n+    name = \"sycl_timer_test\",\n+    srcs = [\"sycl_timer_test.cc\"],\n+    backends = [\"gpu\"],\n+    tags = [\n+        \"gpu\",\n+        \"oneapi-only\",\n+    ],\n+    deps = [\n+        \":sycl_timer\",\n+        \"//xla/stream_executor:platform_manager\",\n+        \"//xla/stream_executor:typed_kernel_factory\",\n+        \"//xla/tsl/platform:status_matchers\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)"
        },
        {
            "sha": "98cc839ba89a67616b03bebbffc2f2c871dfeda6",
            "filename": "third_party/xla/xla/stream_executor/sycl/sycl_timer.cc",
            "status": "added",
            "additions": 110,
            "deletions": 0,
            "changes": 110,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.cc?ref=7d9eb126082adb241f27e34249187b32ba4f3c80",
            "patch": "@@ -0,0 +1,110 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/stream_executor/sycl/sycl_timer.h\"\n+\n+#include <level_zero/ze_api.h>\n+\n+#include \"xla/stream_executor/activate_context.h\"\n+\n+constexpr int kMsecInSec = 1000;\n+\n+namespace stream_executor::gpu {\n+\n+namespace {\n+\n+absl::StatusOr<float> GetEventElapsedTime(StreamExecutor* executor,\n+                                          const sycl::event& start,\n+                                          const sycl::event& stop) {\n+  std::unique_ptr<ActivateContext> activation = executor->Activate();\n+\n+  // Get the native Level Zero event handles.\n+  ze_event_handle_t start_event =\n+      ::sycl::get_native<sycl::backend::ext_oneapi_level_zero>(start);\n+  ze_event_handle_t end_event =\n+      ::sycl::get_native<sycl::backend::ext_oneapi_level_zero>(stop);\n+\n+  // Synchronize the events to ensure they are complete.\n+  ze_result_t sync_result = zeEventHostSynchronize(end_event, UINT64_MAX);\n+  if (sync_result != ZE_RESULT_SUCCESS) {\n+    return absl::InternalError(\n+        \"GetEventElapsedTime: Failed to synchronize end event\");\n+  }\n+\n+  // Query the kernel timestamps for the start and end events.\n+  ze_kernel_timestamp_result_t start_timestamp{}, end_timestamp{};\n+  if (zeEventQueryKernelTimestamp(start_event, &start_timestamp) !=\n+          ZE_RESULT_SUCCESS ||\n+      zeEventQueryKernelTimestamp(end_event, &end_timestamp) !=\n+          ZE_RESULT_SUCCESS) {\n+    return absl::InternalError(\n+        \"GetEventElapsedTime: Failed to query kernel timestamps for events\");\n+  }\n+\n+  // Get the frequency and mask for the device to convert timestamps to\n+  // milliseconds.\n+  // TODO(intel-tf): Remove the hardcoded frequency and mask values once\n+  // SyclGetFrequencyMask is implemented for all devices in SYCL GPU runtime.\n+  constexpr uint64_t frequency = 12500000;  // 12.5 MHz\n+  constexpr uint64_t mask = 4294967295;     // 0xFFFFFFFF\n+\n+  const uint64_t kernel_start_time = start_timestamp.global.kernelStart;\n+  const uint64_t kernel_end_time = end_timestamp.global.kernelEnd;\n+  uint64_t elapsed_ticks;\n+  if (kernel_start_time < kernel_end_time) {\n+    elapsed_ticks = kernel_end_time - kernel_start_time;\n+  } else {\n+    elapsed_ticks = (mask + 1ull) + kernel_end_time - kernel_start_time;\n+  }\n+  float elapsed_milliseconds =\n+      static_cast<float>(elapsed_ticks) * kMsecInSec / frequency;\n+\n+  VLOG(1) << \"Frequency: \" << frequency << \", mask: \" << mask;\n+  VLOG(1) << \"The duration between start and stop events is \"\n+          << elapsed_milliseconds << \" ms.\";\n+  return elapsed_milliseconds;\n+}\n+\n+}  // namespace\n+\n+SyclTimer::SyclTimer(StreamExecutor* executor, SyclEvent start_event,\n+                     SyclEvent stop_event, Stream* stream)\n+    : executor_(executor),\n+      stream_(stream),\n+      start_event_(std::move(start_event)),\n+      stop_event_(std::move(stop_event)) {}\n+\n+absl::StatusOr<absl::Duration> SyclTimer::GetElapsedDuration() {\n+  if (is_timer_stopped_) {\n+    return absl::FailedPreconditionError(\"Measuring inactive timer\");\n+  }\n+  TF_RETURN_IF_ERROR(stream_->RecordEvent(&stop_event_));\n+  TF_ASSIGN_OR_RETURN(float elapsed_milliseconds,\n+                      GetEventElapsedTime(executor_, start_event_.GetEvent(),\n+                                          stop_event_.GetEvent()));\n+  is_timer_stopped_ = true;\n+  return absl::Milliseconds(elapsed_milliseconds);\n+}\n+\n+absl::StatusOr<SyclTimer> SyclTimer::Create(StreamExecutor* executor,\n+                                            Stream* stream) {\n+  TF_ASSIGN_OR_RETURN(SyclEvent start_event, SyclEvent::Create(executor));\n+  TF_ASSIGN_OR_RETURN(SyclEvent stop_event, SyclEvent::Create(executor));\n+  TF_RETURN_IF_ERROR(stream->RecordEvent(&start_event));\n+  return SyclTimer(executor, std::move(start_event), std::move(stop_event),\n+                   stream);\n+}\n+\n+}  // namespace stream_executor::gpu"
        },
        {
            "sha": "121332ac4ea4794b0e00e18f89a0f62d3641994e",
            "filename": "third_party/xla/xla/stream_executor/sycl/sycl_timer.h",
            "status": "added",
            "additions": 70,
            "deletions": 0,
            "changes": 70,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer.h?ref=7d9eb126082adb241f27e34249187b32ba4f3c80",
            "patch": "@@ -0,0 +1,70 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_STREAM_EXECUTOR_SYCL_SYCL_TIMER_H_\n+#define XLA_STREAM_EXECUTOR_SYCL_SYCL_TIMER_H_\n+\n+#include \"absl/status/statusor.h\"\n+#include \"absl/time/time.h\"\n+#include \"xla/stream_executor/event_based_timer.h\"\n+#include \"xla/stream_executor/stream.h\"\n+#include \"xla/stream_executor/stream_executor.h\"\n+#include \"xla/stream_executor/sycl/sycl_event.h\"\n+\n+namespace stream_executor::gpu {\n+\n+// This class implements a timer for SYCL streams by measuring the elapsed\n+// time between two SYCL events using Level-Zero backend timestamps.\n+//\n+// It uses two SYCL events: one for the start time and one for the stop time.\n+// The timer does not take ownership of the SYCL events, so the caller must\n+// ensure that the events remain valid for the lifetime of this SyclTimer.\n+//\n+// The timer is not thread-safe and should be used in a single-threaded context.\n+class SyclTimer : public EventBasedTimer {\n+ public:\n+  // Move constructor and move assignment operator.\n+  SyclTimer(SyclTimer&&) = default;\n+  SyclTimer& operator=(SyclTimer&&) = default;\n+\n+  // Delete copy constructor and copy assignment operator.\n+  SyclTimer(const SyclTimer&) = delete;\n+  SyclTimer& operator=(const SyclTimer&) = delete;\n+\n+  ~SyclTimer() override = default;\n+\n+  // Stops the timer (via is_timer_stopped_) on the first call and returns the\n+  // elapsed duration. Subsequent calls error out.\n+  absl::StatusOr<absl::Duration> GetElapsedDuration() override;\n+\n+  // Creates a SyclTimer instance.\n+  // The SyclTimer does not initialize the start and stop events.\n+  // The caller must ensure that the events are initialized before use.\n+  static absl::StatusOr<SyclTimer> Create(StreamExecutor* executor,\n+                                          Stream* stream);\n+\n+ private:\n+  SyclTimer(StreamExecutor* executor, SyclEvent start_event,\n+            SyclEvent stop_event, Stream* stream);\n+\n+  bool is_timer_stopped_ = false;\n+  StreamExecutor* executor_;\n+  Stream* stream_;\n+  SyclEvent start_event_;\n+  SyclEvent stop_event_;\n+};\n+}  // namespace stream_executor::gpu\n+\n+#endif  // XLA_STREAM_EXECUTOR_SYCL_SYCL_TIMER_H_"
        },
        {
            "sha": "e9f50b84712814376ee5a05375bdff523a649a76",
            "filename": "third_party/xla/xla/stream_executor/sycl/sycl_timer_test.cc",
            "status": "added",
            "additions": 242,
            "deletions": 0,
            "changes": 242,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7d9eb126082adb241f27e34249187b32ba4f3c80/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fsycl%2Fsycl_timer_test.cc?ref=7d9eb126082adb241f27e34249187b32ba4f3c80",
            "patch": "@@ -0,0 +1,242 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/stream_executor/sycl/sycl_timer.h\"\n+\n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n+#include \"xla/stream_executor/platform_manager.h\"\n+#include \"xla/stream_executor/sycl/sycl_platform_id.h\"\n+#include \"xla/stream_executor/typed_kernel_factory.h\"\n+#include \"xla/tsl/platform/status_matchers.h\"\n+\n+namespace stream_executor::gpu {\n+namespace {\n+\n+const int kDefaultDeviceOrdinal = 0;\n+\n+using ::testing::Gt;\n+using ::tsl::testing::IsOk;\n+\n+class SyclTimerTest : public ::testing::Test {\n+ public:\n+  void LaunchSomeKernel(StreamExecutor* executor, Stream* stream) {\n+    using AddKernel =\n+        TypedKernelFactory<DeviceMemory<float>, DeviceMemory<float>,\n+                           DeviceMemory<float>>;\n+\n+    // TODO(intel-tf): This is a temporary workaround to get the test working.\n+    // This will be replaced with hlo-based spv binary generation once MLIR\n+    // changes are in place.\n+    const unsigned char kAddSpv[] = {\n+        0x03, 0x02, 0x23, 0x07, 0x00, 0x01, 0x01, 0x00, 0x0E, 0x00, 0x06, 0x00,\n+        0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x11, 0x00, 0x02, 0x00, 0x06, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,\n+        0x0B, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00, 0x3A, 0x00, 0x00, 0x00,\n+        0x11, 0x00, 0x02, 0x00, 0xFD, 0x15, 0x00, 0x00, 0x0A, 0x00, 0x07, 0x00,\n+        0x53, 0x50, 0x56, 0x5F, 0x4B, 0x48, 0x52, 0x5F, 0x65, 0x78, 0x70, 0x65,\n+        0x63, 0x74, 0x5F, 0x61, 0x73, 0x73, 0x75, 0x6D, 0x65, 0x00, 0x00, 0x00,\n+        0x0B, 0x00, 0x05, 0x00, 0x01, 0x00, 0x00, 0x00, 0x4F, 0x70, 0x65, 0x6E,\n+        0x43, 0x4C, 0x2E, 0x73, 0x74, 0x64, 0x00, 0x00, 0x0E, 0x00, 0x03, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x08, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x1D, 0x00, 0x00, 0x00, 0x77, 0x72, 0x61, 0x70,\n+        0x70, 0x65, 0x64, 0x5F, 0x61, 0x64, 0x64, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x10, 0x00, 0x03, 0x00, 0x1D, 0x00, 0x00, 0x00,\n+        0x1F, 0x00, 0x00, 0x00, 0x10, 0x00, 0x04, 0x00, 0x1D, 0x00, 0x00, 0x00,\n+        0x23, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x00,\n+        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x09, 0x00,\n+        0x05, 0x00, 0x00, 0x00, 0x5F, 0x5F, 0x73, 0x70, 0x69, 0x72, 0x76, 0x5F,\n+        0x42, 0x75, 0x69, 0x6C, 0x74, 0x49, 0x6E, 0x57, 0x6F, 0x72, 0x6B, 0x67,\n+        0x72, 0x6F, 0x75, 0x70, 0x49, 0x64, 0x00, 0x00, 0x05, 0x00, 0x0B, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x5F, 0x5F, 0x73, 0x70, 0x69, 0x72, 0x76, 0x5F,\n+        0x42, 0x75, 0x69, 0x6C, 0x74, 0x49, 0x6E, 0x4C, 0x6F, 0x63, 0x61, 0x6C,\n+        0x49, 0x6E, 0x76, 0x6F, 0x63, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x49, 0x64,\n+        0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x05, 0x00, 0x0B, 0x00, 0x00, 0x00,\n+        0x77, 0x72, 0x61, 0x70, 0x70, 0x65, 0x64, 0x5F, 0x61, 0x64, 0x64, 0x00,\n+        0x05, 0x00, 0x04, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x61, 0x72, 0x67, 0x30,\n+        0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x00, 0x0D, 0x00, 0x00, 0x00,\n+        0x61, 0x72, 0x67, 0x31, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x00,\n+        0x0E, 0x00, 0x00, 0x00, 0x61, 0x72, 0x67, 0x32, 0x00, 0x00, 0x00, 0x00,\n+        0x05, 0x00, 0x04, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x65, 0x6E, 0x74, 0x72,\n+        0x79, 0x00, 0x00, 0x00, 0x05, 0x00, 0x08, 0x00, 0x19, 0x00, 0x00, 0x00,\n+        0x6C, 0x69, 0x6E, 0x65, 0x61, 0x72, 0x5F, 0x69, 0x6E, 0x64, 0x65, 0x78,\n+        0x5F, 0x69, 0x6E, 0x5F, 0x72, 0x61, 0x6E, 0x67, 0x65, 0x00, 0x00, 0x00,\n+        0x05, 0x00, 0x04, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x61, 0x64, 0x64, 0x2E,\n+        0x34, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x00, 0x1E, 0x00, 0x00, 0x00,\n+        0x61, 0x72, 0x67, 0x30, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x00,\n+        0x1F, 0x00, 0x00, 0x00, 0x61, 0x72, 0x67, 0x31, 0x00, 0x00, 0x00, 0x00,\n+        0x05, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00, 0x61, 0x72, 0x67, 0x32,\n+        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x0B, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x29, 0x00, 0x00, 0x00, 0x5F, 0x5F, 0x73, 0x70, 0x69, 0x72, 0x76, 0x5F,\n+        0x42, 0x75, 0x69, 0x6C, 0x74, 0x49, 0x6E, 0x57, 0x6F, 0x72, 0x6B, 0x67,\n+        0x72, 0x6F, 0x75, 0x70, 0x49, 0x64, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x03, 0x00, 0x05, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00,\n+        0x1A, 0x00, 0x00, 0x00, 0x47, 0x00, 0x0D, 0x00, 0x06, 0x00, 0x00, 0x00,\n+        0x29, 0x00, 0x00, 0x00, 0x5F, 0x5F, 0x73, 0x70, 0x69, 0x72, 0x76, 0x5F,\n+        0x42, 0x75, 0x69, 0x6C, 0x74, 0x49, 0x6E, 0x4C, 0x6F, 0x63, 0x61, 0x6C,\n+        0x49, 0x6E, 0x76, 0x6F, 0x63, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x49, 0x64,\n+        0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x1B, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x07, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00,\n+        0x77, 0x72, 0x61, 0x70, 0x70, 0x65, 0x64, 0x5F, 0x61, 0x64, 0x64, 0x00,\n+        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x0C, 0x00, 0x00, 0x00,\n+        0x26, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x0C, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n+        0x06, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x0C, 0x00, 0x00, 0x00,\n+        0x2C, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x0C, 0x00, 0x00, 0x00, 0x2D, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x0D, 0x00, 0x00, 0x00,\n+        0x26, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x0D, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,\n+        0x10, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x0D, 0x00, 0x00, 0x00,\n+        0x2D, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x0E, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x0E, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n+        0x05, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x0E, 0x00, 0x00, 0x00,\n+        0x2C, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x0E, 0x00, 0x00, 0x00, 0x2D, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x1E, 0x00, 0x00, 0x00,\n+        0x26, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x1E, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,\n+        0x10, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x1E, 0x00, 0x00, 0x00,\n+        0x2D, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x1F, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n+        0x05, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x1F, 0x00, 0x00, 0x00,\n+        0x26, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x1F, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x2D, 0x00, 0x00, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00,\n+        0x26, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,\n+        0x20, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x47, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,\n+        0x80, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00,\n+        0x2D, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x15, 0x00, 0x04, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+        0x2B, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00, 0x15, 0x00, 0x00, 0x00,\n+        0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x05, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+        0x00, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00, 0x03, 0x00, 0x00, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,\n+        0x13, 0x00, 0x02, 0x00, 0x07, 0x00, 0x00, 0x00, 0x16, 0x00, 0x03, 0x00,\n+        0x08, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00,\n+        0x09, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,\n+        0x21, 0x00, 0x06, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,\n+        0x09, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,\n+        0x14, 0x00, 0x02, 0x00, 0x18, 0x00, 0x00, 0x00, 0x3B, 0x00, 0x04, 0x00,\n+        0x04, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,\n+        0x3B, 0x00, 0x04, 0x00, 0x04, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,\n+        0x01, 0x00, 0x00, 0x00, 0x36, 0x00, 0x05, 0x00, 0x07, 0x00, 0x00, 0x00,\n+        0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00,\n+        0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00,\n+        0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00,\n+        0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00,\n+        0xF8, 0x00, 0x02, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x3D, 0x00, 0x06, 0x00,\n+        0x03, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x51, 0x00, 0x05, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,\n+        0x00, 0x00, 0x00, 0x00, 0x3D, 0x00, 0x06, 0x00, 0x03, 0x00, 0x00, 0x00,\n+        0x12, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,\n+        0x20, 0x00, 0x00, 0x00, 0x51, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00,\n+        0x13, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+        0xC5, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,\n+        0x13, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0xC7, 0x00, 0x05, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00,\n+        0x15, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x05, 0x00, 0x18, 0x00, 0x00, 0x00,\n+        0x19, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00,\n+        0xFE, 0x15, 0x02, 0x00, 0x19, 0x00, 0x00, 0x00, 0x3D, 0x00, 0x06, 0x00,\n+        0x08, 0x00, 0x00, 0x00, 0x1A, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x3D, 0x00, 0x06, 0x00,\n+        0x08, 0x00, 0x00, 0x00, 0x1B, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00,\n+        0x02, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x81, 0x00, 0x05, 0x00,\n+        0x08, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x1A, 0x00, 0x00, 0x00,\n+        0x1B, 0x00, 0x00, 0x00, 0x3E, 0x00, 0x05, 0x00, 0x0E, 0x00, 0x00, 0x00,\n+        0x1C, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,\n+        0xFD, 0x00, 0x01, 0x00, 0x38, 0x00, 0x01, 0x00, 0x36, 0x00, 0x05, 0x00,\n+        0x07, 0x00, 0x00, 0x00, 0x1D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n+        0x0A, 0x00, 0x00, 0x00, 0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00,\n+        0x1E, 0x00, 0x00, 0x00, 0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00,\n+        0x1F, 0x00, 0x00, 0x00, 0x37, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00,\n+        0x20, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x02, 0x00, 0x21, 0x00, 0x00, 0x00,\n+        0x39, 0x00, 0x07, 0x00, 0x07, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00,\n+        0x0B, 0x00, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00,\n+        0x20, 0x00, 0x00, 0x00, 0xFD, 0x00, 0x01, 0x00, 0x38, 0x00, 0x01, 0x00};\n+\n+    constexpr size_t kAddSpvSize = sizeof(kAddSpv);\n+\n+    KernelLoaderSpec spec = KernelLoaderSpec::CreateCudaCubinInMemorySpec(\n+        absl::Span<const uint8_t>(reinterpret_cast<const uint8_t*>(kAddSpv),\n+                                  kAddSpvSize),\n+        \"wrapped_add\", 3);\n+\n+    TF_ASSERT_OK_AND_ASSIGN(auto add, AddKernel::Create(executor, spec));\n+\n+    const int64_t kLength = 4;\n+    const int64_t kByteLength = sizeof(float) * kLength;\n+\n+    // Prepare arguments: a=1.0, b=2.0, c=0.0\n+    DeviceMemory<float> a = executor->AllocateArray<float>(kLength, 0);\n+    DeviceMemory<float> b = executor->AllocateArray<float>(kLength, 0);\n+    DeviceMemory<float> c = executor->AllocateArray<float>(kLength, 0);\n+\n+    ASSERT_THAT(stream->Memset32(&a, 1.0, kByteLength), IsOk());\n+    ASSERT_THAT(stream->Memset32(&b, 2.0, kByteLength), IsOk());\n+    ASSERT_THAT(stream->Memset32(&c, 0.0, kByteLength), IsOk());\n+    ASSERT_THAT(add.Launch(ThreadDim(), BlockDim(kLength), stream, a, b, c),\n+                IsOk());\n+  }\n+\n+ protected:\n+  void SetUp() override {\n+    TF_ASSERT_OK_AND_ASSIGN(Platform * platform,\n+                            stream_executor::PlatformManager::PlatformWithId(\n+                                stream_executor::sycl::kSyclPlatformId));\n+    TF_ASSERT_OK_AND_ASSIGN(executor_,\n+                            platform->ExecutorForDevice(kDefaultDeviceOrdinal));\n+    TF_ASSERT_OK_AND_ASSIGN(stream_,\n+                            executor_->CreateStream(/*priority=*/std::nullopt));\n+  }\n+\n+  // TODO(intel-tf): Use SyclExecutor instead of StreamExecutor.\n+  StreamExecutor* executor_;\n+  std::unique_ptr<Stream> stream_;\n+};\n+\n+TEST_F(SyclTimerTest, Create) {\n+  TF_ASSERT_OK_AND_ASSIGN(SyclTimer timer,\n+                          SyclTimer::Create(executor_, stream_.get()));\n+\n+  // We don't really care what kernel we launch here as long as it takes a\n+  // non-zero amount of time.\n+  LaunchSomeKernel(executor_, stream_.get());\n+\n+  TF_ASSERT_OK_AND_ASSIGN(absl::Duration timer_result,\n+                          timer.GetElapsedDuration());\n+  EXPECT_THAT(timer_result, Gt(absl::ZeroDuration()));\n+  EXPECT_THAT(timer.GetElapsedDuration(),\n+              tsl::testing::StatusIs(absl::StatusCode::kFailedPrecondition));\n+}\n+\n+}  // namespace\n+}  // namespace stream_executor::gpu"
        }
    ],
    "stats": {
        "total": 461,
        "additions": 458,
        "deletions": 3
    }
}