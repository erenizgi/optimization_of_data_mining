{
    "author": "tensorflower-gardener",
    "message": "Add `ReshardArrays` to `xla::ifrt::Client` API\n\nPiperOrigin-RevId: 799680488",
    "sha": "56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
    "files": [
        {
            "sha": "eef4cfff7a700ea835404ce7cca275ea640004d7",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -1382,6 +1382,13 @@ absl::StatusOr<std::vector<ifrt::ArrayRef>> NanoIfrtClient::RemapArrays(\n   return absl::UnimplementedError(\"RemapArrays is not implemented.\");\n }\n \n+absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> NanoIfrtClient::ReshardArrays(\n+    absl::Span<xla::ifrt::ArrayRef> arrays,\n+    absl::Span<const xla::ifrt::ArraySpec> specs,\n+    xla::ifrt::ArrayCopySemantics semantics) {\n+  return absl::UnimplementedError(\"ReshardArrays is not implemented.\");\n+}\n+\n ifrt::Future<> NanoIfrtClient::GetReadyFuture(\n     absl::Span<const ifrt::ValueRef> values) {\n   return Ready();"
        },
        {
            "sha": "a34e4c9b9c459a1e7cd0f5d45d5307b1adc1590a",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -147,6 +147,11 @@ class NanoIfrtClient : public llvm::RTTIExtends<NanoIfrtClient, ifrt::Client> {\n       const ifrt::RemapPlan& plan, absl::Span<ifrt::ArrayRef> arrays,\n       ifrt::ArrayCopySemantics semantics) override;\n \n+  absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> ReshardArrays(\n+      absl::Span<xla::ifrt::ArrayRef> arrays,\n+      absl::Span<const xla::ifrt::ArraySpec> specs,\n+      xla::ifrt::ArrayCopySemantics semantics) override;\n+\n   ifrt::Future<> GetReadyFuture(\n       absl::Span<const ifrt::ValueRef> values) override;\n "
        },
        {
            "sha": "4efca0f4d3926dcd1053eba74c9812b47bf6fd58",
            "filename": "third_party/xla/xla/python/compile_only_ifrt/client.h",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fcompile_only_ifrt%2Fclient.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fcompile_only_ifrt%2Fclient.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fcompile_only_ifrt%2Fclient.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -256,6 +256,14 @@ class CompileOnlyIfRtClient final\n     return Unimplemented(\"RemapArrays not available with compile-only client.\");\n   }\n \n+  absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> ReshardArrays(\n+      absl::Span<xla::ifrt::ArrayRef> arrays,\n+      absl::Span<const xla::ifrt::ArraySpec> specs,\n+      xla::ifrt::ArrayCopySemantics semantics) override {\n+    return Unimplemented(\n+        \"ReshardArrays not available with compile-only client.\");\n+  }\n+\n   ifrt::Future<> GetReadyFuture(\n       absl::Span<const ifrt::ValueRef> values) override {\n     return ifrt::Future<>(Unimplemented("
        },
        {
            "sha": "4d2f2b0c6520a65ac518f0f8f2af74a15f18ade6",
            "filename": "third_party/xla/xla/python/ifrt/client.h",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fclient.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -253,6 +253,16 @@ class Client : public llvm::RTTIExtends<Client, llvm::RTTIRoot> {\n       const RemapPlan& plan, absl::Span<xla::ifrt::ArrayRef> arrays,\n       ArrayCopySemantics semantics) = 0;\n \n+  // Reshards arrays to new arrays according to the given specs.\n+  //\n+  // If destination specs have the layout specifications, applies it to the\n+  // output arrays, if not, uses the device-default layout.\n+  //\n+  // NOTE: `ArrayCopySemantics::kReuseInput` is not allowed.\n+  virtual absl::StatusOr<std::vector<ArrayRef>> ReshardArrays(\n+      absl::Span<ArrayRef> arrays, absl::Span<const ArraySpec> specs,\n+      ArrayCopySemantics semantics) = 0;\n+\n   // Returns a future that becomes ready once all of the values become ready.\n   //\n   // Timing and error semantics:"
        },
        {
            "sha": "e25f96e51defd47e338c600afafae3cb4960fb7c",
            "filename": "third_party/xla/xla/python/ifrt/mock.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.cc?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -153,6 +153,12 @@ MockClient::MockClient(std::unique_ptr<xla::ifrt::Client> delegated)\n                             ArrayCopySemantics semantics) {\n         return delegated_->RemapArrays(plan, arrays, semantics);\n       });\n+  ON_CALL(*this, ReshardArrays)\n+      .WillByDefault([this](absl::Span<ArrayRef> arrays,\n+                            absl::Span<const ArraySpec> specs,\n+                            ArrayCopySemantics semantics) {\n+        return delegated_->ReshardArrays(arrays, specs, semantics);\n+      });\n   ON_CALL(*this, GetReadyFuture)\n       .WillByDefault([this](absl::Span<const ValueRef> values) {\n         return delegated_->GetReadyFuture(values);"
        },
        {
            "sha": "e7d300e850553dc2688c64e6493dd290109ebf1a",
            "filename": "third_party/xla/xla/python/ifrt/mock.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -147,6 +147,10 @@ class MockClient : public llvm::RTTIExtends<MockClient, Client> {\n               (const RemapPlan& plan, absl::Span<ArrayRef> arrays,\n                ArrayCopySemantics semantics),\n               (final));\n+  MOCK_METHOD(absl::StatusOr<std::vector<ArrayRef>>, ReshardArrays,\n+              (absl::Span<ArrayRef> arrays, absl::Span<const ArraySpec> specs,\n+               ArrayCopySemantics semantics),\n+              (final));\n   MOCK_METHOD(Future<>, GetReadyFuture, (absl::Span<const ValueRef> values),\n               (final));\n   MOCK_METHOD(absl::StatusOr<tsl::RCReference<Tuple>>, MakeTuple,"
        },
        {
            "sha": "0337f7f97a730abcb037880d2f95c80770275df4",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client.h",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -96,6 +96,13 @@ class Client final : public llvm::RTTIExtends<Client, xla::ifrt::Client> {\n       const RemapPlan& plan, absl::Span<xla::ifrt::ArrayRef> arrays,\n       ArrayCopySemantics semantics) override;\n \n+  absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> ReshardArrays(\n+      absl::Span<ArrayRef> arrays, absl::Span<const ArraySpec> specs,\n+      ArrayCopySemantics semantics) override {\n+    return absl::UnimplementedError(\n+        \"ReshardArrays is not supported for the IFRT proxy client.\");\n+  }\n+\n   xla::ifrt::Future<> GetReadyFuture(\n       absl::Span<const ValueRef> values) override;\n "
        },
        {
            "sha": "3ed0c7e50fd88fb45a6a798fa2b483d29ccfa878",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/pjrt_client.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.cc?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -1577,6 +1577,12 @@ absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> PjRtClient::RemapArrays(\n   return PjRtCompatibleClientRemapArrays(this, plan, arrays, semantics);\n }\n \n+absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> PjRtClient::ReshardArrays(\n+    absl::Span<ArrayRef> arrays, absl::Span<const ArraySpec> specs,\n+    ArrayCopySemantics semantics) {\n+  return Unimplemented(\"ReshardArrays not available with pjrt-ifrt client.\");\n+}\n+\n Future<> PjRtClient::GetReadyFuture(absl::Span<const ValueRef> values) {\n   absl::InlinedVector<Future<>, 1> futures;\n   futures.reserve(values.size());"
        },
        {
            "sha": "147f43e66d5c12e21f3d5fa449aa689fa5b17743",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/pjrt_client.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/56e501dc28e3149ab17d6d8bdab4d37a75cff3f9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_client.h?ref=56e501dc28e3149ab17d6d8bdab4d37a75cff3f9",
            "patch": "@@ -219,6 +219,10 @@ class PjRtClient final\n       const RemapPlan& plan, absl::Span<xla::ifrt::ArrayRef> arrays,\n       ArrayCopySemantics semantics) override;\n \n+  absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> ReshardArrays(\n+      absl::Span<ArrayRef> arrays, absl::Span<const ArraySpec> specs,\n+      ArrayCopySemantics semantics) override;\n+\n   Future<> GetReadyFuture(absl::Span<const ValueRef> values) override;\n \n   absl::StatusOr<tsl::RCReference<Tuple>> MakeTuple("
        }
    ],
    "stats": {
        "total": 57,
        "additions": 57,
        "deletions": 0
    }
}