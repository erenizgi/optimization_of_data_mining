{
    "author": "ezhulenev",
    "message": "[xla:ffi] Fix clang macro expansion warnings\n\nPiperOrigin-RevId: 820212080",
    "sha": "d52ccd4d4bce468ff8d8a8163d46fc60c9172456",
    "files": [
        {
            "sha": "caa8b94e48124986952158835be2b5102b2e28ee",
            "filename": "third_party/xla/xla/ffi/api/api.h",
            "status": "modified",
            "additions": 14,
            "deletions": 13,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d52ccd4d4bce468ff8d8a8163d46fc60c9172456/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d52ccd4d4bce468ff8d8a8163d46fc60c9172456/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fapi.h?ref=d52ccd4d4bce468ff8d8a8163d46fc60c9172456",
            "patch": "@@ -1948,8 +1948,15 @@ auto DictionaryDecoder(Members... m) {\n #define XLA_FFI_ATTRIBUTE_UNUSED\n #endif\n \n-// Use captureless lambda to function pointer conversion to create a static\n-// XLA_FFI_Handler function pointer variable.\n+// In all macros below we use captureless lambda to function pointer conversion\n+// to create a static XLA_FFI_Handler function pointer variable.\n+\n+// Use explicit binding specification and traits to create a handler.\n+#define XLA_FFI_DEFINE_HANDLER_EXPLICIT_WITH_TRAITS(fn, impl, binding, traits) \\\n+  static constexpr XLA_FFI_Handler* fn = +[](XLA_FFI_CallFrame* call_frame) {  \\\n+    static auto* handler = binding.To(impl, traits).release();                 \\\n+    return handler->Call(call_frame);                                          \\\n+  }\n \n // Use explicit binding specification to create a handler.\n #define XLA_FFI_DEFINE_HANDLER_EXPLICIT(fn, impl, binding)                    \\\n@@ -1958,12 +1965,6 @@ auto DictionaryDecoder(Members... m) {\n     return handler->Call(call_frame);                                         \\\n   }\n \n-#define XLA_FFI_DEFINE_HANDLER_EXPLICIT_WITH_TRAITS(fn, impl, binding, traits) \\\n-  static constexpr XLA_FFI_Handler* fn = +[](XLA_FFI_CallFrame* call_frame) {  \\\n-    static auto* handler = binding.To(impl, traits).release();                 \\\n-    return handler->Call(call_frame);                                          \\\n-  }\n-\n // Automatically infer binding specification from the implementation.\n #define XLA_FFI_DEFINE_HANDLER_AUTO(fn, impl)                                 \\\n   static constexpr XLA_FFI_Handler* fn = +[](XLA_FFI_CallFrame* call_frame) { \\\n@@ -1978,11 +1979,11 @@ auto DictionaryDecoder(Members... m) {\n //\n // This is a trick to define macro with optional parameters.\n // Source: https://stackoverflow.com/a/8814003\n-#define XLA_FFI_DEFINE_HANDLER(fn, impl, ...)                             \\\n-  XLA_FFI_DEFINE_HANDLER_X(                                               \\\n-      , fn, impl, ##__VA_ARGS__,                                          \\\n-      XLA_FFI_DEFINE_HANDLER_EXPLICIT_WITH_TRAITS(fn, impl, __VA_ARGS__), \\\n-      XLA_FFI_DEFINE_HANDLER_EXPLICIT(fn, impl, __VA_ARGS__),             \\\n+#define XLA_FFI_DEFINE_HANDLER(fn, impl, ...)                               \\\n+  XLA_FFI_DEFINE_HANDLER_X(                                                 \\\n+      , fn, impl, ##__VA_ARGS__,                                            \\\n+      XLA_FFI_DEFINE_HANDLER_EXPLICIT_WITH_TRAITS(fn, impl, ##__VA_ARGS__), \\\n+      XLA_FFI_DEFINE_HANDLER_EXPLICIT(fn, impl, ##__VA_ARGS__),             \\\n       XLA_FFI_DEFINE_HANDLER_AUTO(fn, impl))\n \n // TODO(ezhulenev): Add a callback so that end users can log registration error"
        },
        {
            "sha": "53c10edf5412c1a97cd849016ad4db7f526a08e9",
            "filename": "third_party/xla/xla/ffi/api/ffi.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d52ccd4d4bce468ff8d8a8163d46fc60c9172456/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d52ccd4d4bce468ff8d8a8163d46fc60c9172456/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h?ref=d52ccd4d4bce468ff8d8a8163d46fc60c9172456",
            "patch": "@@ -1480,8 +1480,7 @@ XLA_FFI_TypeInfo TypeInfo() {\n         return ::xla::ffi::Ffi::RegisterTypeId(API, NAME, TYPE_ID, TYPE_INFO); \\\n       }()\n \n-#define XLA_FFI_REGISTER_TYPE_X(x, API, NAME, TYPE_ID, TYPE_INFO, FUNC, ...) \\\n-  FUNC\n+#define XLA_FFI_REGISTER_TYPE_X(x, API, NAME, TYPE_ID, TYPE_INFO, FUNC) FUNC\n \n // Registers external type with XLA runtime and assigns it a unique type id.\n //"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 15,
        "deletions": 15
    }
}