{
    "author": "akuegel",
    "message": "Adapt non-determinism scatter test.\n\nOn Nvidia GPUs it looks like we can rely on that the non-determinism affects\nonly the row, while on AMD GPUs it seems to affect every single element of the\nrow. Relax the test expectations accordingly.\n\nPiperOrigin-RevId: 841613257",
    "sha": "3599eb03ec138525e2ec083cdb8d00e560c48e05",
    "files": [
        {
            "sha": "1f394a4855fb09bb32f2c418cc158901f383eb8e",
            "filename": "third_party/xla/xla/tests/scatter_test.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3599eb03ec138525e2ec083cdb8d00e560c48e05/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3599eb03ec138525e2ec083cdb8d00e560c48e05/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc?ref=3599eb03ec138525e2ec083cdb8d00e560c48e05",
            "patch": "@@ -119,11 +119,13 @@ ENTRY main {\n   TF_ASSERT_OK_AND_ASSIGN(\n       Literal result,\n       Execute(std::move(module), {&operand, &scatter_indices, &updates}));\n-  Literal expected_option_one =\n-      LiteralUtil::CreateR2<int32_t>({{10, 20, 30}, {4, 5, 6}, {7, 8, 9}});\n-  Literal expected_option_two =\n-      LiteralUtil::CreateR2<int32_t>({{70, 80, 90}, {4, 5, 6}, {7, 8, 9}});\n-  EXPECT_TRUE(result == expected_option_one || result == expected_option_two);\n+  auto data = result.data<int32_t>();\n+  // The first row is written twice, so it is not deterministic which of the two\n+  // writes \"wins\".\n+  EXPECT_TRUE(data[0] == 10 || data[0] == 70);\n+  EXPECT_TRUE(data[1] == 20 || data[1] == 80);\n+  EXPECT_TRUE(data[2] == 30 || data[2] == 90);\n+  EXPECT_EQ(data.subspan(3), (std::vector<int32_t>{4, 5, 6, 7, 8, 9}));\n }\n \n TEST_F(ScatterTest, TensorFlowScatterV1_WithFusedAdds) {"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 7,
        "deletions": 5
    }
}