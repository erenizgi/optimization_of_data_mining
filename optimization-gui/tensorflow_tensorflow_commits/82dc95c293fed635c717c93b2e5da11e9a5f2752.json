{
    "author": "loislo",
    "message": "[XLA:GPU] rename thunk_checksum_tracing_pass to thunk_buffer_debug_pass\n\nIt is pure mechanical move cl.\n\nThe goal is to use the pass for all the buffer debug checks. We have checksum and nan_counter kernels at the moment.\n\nPiperOrigin-RevId: 825602375",
    "sha": "82dc95c293fed635c717c93b2e5da11e9a5f2752",
    "files": [
        {
            "sha": "36d3a3d8c483af01d85df7997fc177507823f484",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -2878,9 +2878,9 @@ xla_test(\n )\n \n cc_library(\n-    name = \"thunk_checksum_tracing_pass\",\n-    srcs = [\"thunk_checksum_tracing_pass.cc\"],\n-    hdrs = [\"thunk_checksum_tracing_pass.h\"],\n+    name = \"thunk_buffer_debug_pass\",\n+    srcs = [\"thunk_buffer_debug_pass.cc\"],\n+    hdrs = [\"thunk_buffer_debug_pass.h\"],\n     deps = [\n         \":buffers_checksum_thunk\",\n         \":custom_call_thunk\",\n@@ -2911,15 +2911,15 @@ cc_library(\n )\n \n xla_cc_test(\n-    name = \"thunk_checksum_tracing_pass_test\",\n-    srcs = [\"thunk_checksum_tracing_pass_test.cc\"],\n+    name = \"thunk_buffer_debug_pass_test\",\n+    srcs = [\"thunk_buffer_debug_pass_test.cc\"],\n     deps = [\n         \":buffers_checksum_thunk\",\n         \":custom_call_thunk\",\n         \":sequential_thunk\",\n         \":thunk\",\n+        \":thunk_buffer_debug_pass\",\n         \":thunk_buffer_id\",\n-        \":thunk_checksum_tracing_pass\",\n         \":thunk_id\",\n         \":thunk_pass_pipeline\",\n         \"//xla:literal_util\","
        },
        {
            "sha": "52cd22d032ea9efb748fa49f6a72e21ca8dccb32",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass.cc",
            "status": "renamed",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.cc?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/backends/gpu/runtime/thunk_checksum_tracing_pass.h\"\n+#include \"xla/backends/gpu/runtime/thunk_buffer_debug_pass.h\"\n \n #include <cstddef>\n #include <cstring>\n@@ -165,12 +165,12 @@ XLA_FFI_DEFINE_HANDLER_SYMBOL(\n \n }  // namespace\n \n-absl::StatusOr<bool> ThunkChecksumTracingPass::Run(\n+absl::StatusOr<bool> ThunkBufferDebugPass::Run(\n     SequentialThunk* root_thunk, const DebugOptions& debug_options,\n     const HloModule* absl_nullable hlo_module,\n     const se::DeviceDescription& device_info,\n     ThunkPassBufferAllocator& allocator) {\n-  VLOG(1) << \"ThunkChecksumTracingPass running\";\n+  VLOG(1) << \"ThunkBufferDebugPass running\";\n   if (hlo_module == nullptr) {\n     // We need the HLO module to dump the buffer debug log proto to a file. If\n     // it's not available, there's no point in doing extra work.",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/thunk_checksum_tracing_pass.cc"
        },
        {
            "sha": "f219f5d38454b7f77759410301f32308e7e91885",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass.h",
            "status": "renamed",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass.h?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -13,8 +13,8 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#ifndef XLA_BACKENDS_GPU_RUNTIME_THUNK_CHECKSUM_TRACING_PASS_H_\n-#define XLA_BACKENDS_GPU_RUNTIME_THUNK_CHECKSUM_TRACING_PASS_H_\n+#ifndef XLA_BACKENDS_GPU_RUNTIME_THUNK_BUFFER_DEBUG_PASS_H_\n+#define XLA_BACKENDS_GPU_RUNTIME_THUNK_BUFFER_DEBUG_PASS_H_\n \n #include \"absl/base/nullability.h\"\n #include \"absl/status/statusor.h\"\n@@ -27,12 +27,12 @@ limitations under the License.\n namespace xla {\n namespace gpu {\n \n-// Adds checksum tracing to thunks.\n-class ThunkChecksumTracingPass : public ThunkPassInterface {\n+// Adds buffer debug tracing to thunks.\n+class ThunkBufferDebugPass : public ThunkPassInterface {\n  public:\n-  ThunkChecksumTracingPass() = default;\n+  ThunkBufferDebugPass() = default;\n \n-  absl::string_view name() const override { return \"thunk-checksum-tracing\"; }\n+  absl::string_view name() const override { return \"thunk-buffer-debug\"; }\n \n   absl::StatusOr<bool> Run(SequentialThunk* root_thunk,\n                            const DebugOptions& debug_options,\n@@ -44,4 +44,4 @@ class ThunkChecksumTracingPass : public ThunkPassInterface {\n }  // namespace gpu\n }  // namespace xla\n \n-#endif  // XLA_BACKENDS_GPU_RUNTIME_THUNK_CHECKSUM_TRACING_PASS_H_\n+#endif  // XLA_BACKENDS_GPU_RUNTIME_THUNK_BUFFER_DEBUG_PASS_H_",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/thunk_checksum_tracing_pass.h"
        },
        {
            "sha": "bd58513070133ed52592c8631eb861da8d40b3cb",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk_buffer_debug_pass_test.cc",
            "status": "renamed",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk_buffer_debug_pass_test.cc?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -13,7 +13,7 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/backends/gpu/runtime/thunk_checksum_tracing_pass.h\"\n+#include \"xla/backends/gpu/runtime/thunk_buffer_debug_pass.h\"\n \n #include <cstdint>\n #include <memory>\n@@ -85,7 +85,7 @@ class FakeThunk : public Thunk {\n   BufferUses buffer_uses_;\n };\n \n-TEST(ThunkChecksumTracingPassTest, IsNoOpWhenHloModuleIsNull) {\n+TEST(ThunkBufferDebugPassTest, IsNoOpWhenHloModuleIsNull) {\n   DebugOptions debug_options;\n   debug_options.set_xla_gpu_experimental_enable_checksum_tracing_on_thunks(\n       true);\n@@ -101,22 +101,22 @@ TEST(ThunkChecksumTracingPassTest, IsNoOpWhenHloModuleIsNull) {\n   auto root_thunk =\n       std::make_unique<SequentialThunk>(Thunk::ThunkInfo(), std::move(thunks));\n \n-  ThunkChecksumTracingPass pass;\n+  ThunkBufferDebugPass pass;\n   TF_ASSERT_OK_AND_ASSIGN(\n       bool changed, pass.Run(root_thunk.get(), debug_options,\n                              /*hlo_module=*/nullptr, device_info, allocator));\n   EXPECT_FALSE(changed);\n   EXPECT_THAT(root_thunk->thunks(), ElementsAre(Pointer(fake_thunk_ptr)));\n }\n \n-TEST(ThunkChecksumTracingPassTest, InsertsBuffersDebugChecksumThunks) {\n+TEST(ThunkBufferDebugPassTest, InsertsBuffersDebugChecksumThunks) {\n   static constexpr ThunkId kTestThunkId = ThunkId(123);\n   DebugOptions debug_options;\n   debug_options.set_xla_gpu_experimental_enable_checksum_tracing_on_thunks(\n       true);\n   se::DeviceDescription device_info;\n   FakeThunkPassBufferAllocator allocator;\n-  // The callbacks created by ThunkChecksumTracingPass require a HloModule with\n+  // The callbacks created by ThunkBufferDebugPass require a HloModule with\n   // a non-null entry computation.\n   auto builder = HloComputation::Builder(\"entry\");\n   HloInstruction* root = builder.AddInstruction(\n@@ -152,7 +152,7 @@ TEST(ThunkChecksumTracingPassTest, InsertsBuffersDebugChecksumThunks) {\n   auto root_thunk =\n       std::make_unique<SequentialThunk>(Thunk::ThunkInfo(), std::move(thunks));\n \n-  ThunkChecksumTracingPass pass;\n+  ThunkBufferDebugPass pass;\n   TF_ASSERT_OK_AND_ASSIGN(bool changed,\n                           pass.Run(root_thunk.get(), debug_options, &hlo_module,\n                                    device_info, allocator));",
            "previous_filename": "third_party/xla/xla/backends/gpu/runtime/thunk_checksum_tracing_pass_test.cc"
        },
        {
            "sha": "e2bc6f9806ac0031d62d3519d4ebadff5443d7b7",
            "filename": "third_party/xla/xla/service/gpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -738,7 +738,7 @@ cc_library(\n         \"//xla/backends/gpu/runtime:nvshmem_collective_thunk\",\n         \"//xla/backends/gpu/runtime:sequential_thunk\",\n         \"//xla/backends/gpu/runtime:thunk\",\n-        \"//xla/backends/gpu/runtime:thunk_checksum_tracing_pass\",\n+        \"//xla/backends/gpu/runtime:thunk_buffer_debug_pass\",\n         \"//xla/backends/gpu/runtime:thunk_pass_pipeline\",\n         \"//xla/core/collectives:clique_key\",\n         \"//xla/hlo/ir:hlo\","
        },
        {
            "sha": "564ce6bf3acb751ae3562b03ad0871750493e9b7",
            "filename": "third_party/xla/xla/service/gpu/gpu_executable.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/82dc95c293fed635c717c93b2e5da11e9a5f2752/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc?ref=82dc95c293fed635c717c93b2e5da11e9a5f2752",
            "patch": "@@ -45,7 +45,7 @@ limitations under the License.\n #include \"xla/backends/gpu/runtime/nvshmem_collective_thunk.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\"\n-#include \"xla/backends/gpu/runtime/thunk_checksum_tracing_pass.h\"\n+#include \"xla/backends/gpu/runtime/thunk_buffer_debug_pass.h\"\n #include \"xla/backends/gpu/runtime/thunk_pass_pipeline.h\"\n #include \"xla/core/collectives/clique_key.h\"\n #include \"xla/executable_run_options.h\"\n@@ -177,7 +177,7 @@ static absl::Status RunThunkPasses(const DebugOptions& debug_options,\n                                    ThunkPassBufferAllocator& allocator) {\n   ThunkPassPipeline pipeline(\"thunk-passes\");\n   if (debug_options.xla_gpu_experimental_enable_checksum_tracing_on_thunks()) {\n-    pipeline.AddPass(std::make_unique<ThunkChecksumTracingPass>());\n+    pipeline.AddPass(std::make_unique<ThunkBufferDebugPass>());\n   }\n   if (debug_options.xla_gpu_experimental_enable_command_buffer_on_thunks()) {\n     pipeline.AddPass(std::make_unique<CommandBufferConversionPass>("
        }
    ],
    "stats": {
        "total": 50,
        "additions": 25,
        "deletions": 25
    }
}