{
    "author": "ezhulenev",
    "message": "[xla] Migrate XLA to MaybeOwningDeviceMemory\n\nPiperOrigin-RevId: 841862688",
    "sha": "a3f49eccd20479d5f910b481e15c076c741737db",
    "files": [
        {
            "sha": "401f15587fcf39bd2a7c083c6092fe9828e76ed3",
            "filename": "tensorflow/compiler/jit/xla_launch_util.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -29,6 +29,7 @@ limitations under the License.\n #include \"tensorflow/compiler/tf2xla/xla_compiler.h\"\n #include \"xla/client/local_client.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n+#include \"xla/service/maybe_owning_device_memory.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/stream_executor/device_memory_allocator.h\"\n #include \"tensorflow/core/framework/allocation_description.pb.h\""
        },
        {
            "sha": "81247efe7e118a249f40f97384fa88182ed3229d",
            "filename": "third_party/xla/xla/backends/cpu/autotuner/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -46,7 +46,7 @@ cc_library(\n         \"//xla/backends/autotuner:profiler\",\n         \"//xla/service:buffer_assignment\",\n         \"//xla/service:executable\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service/cpu:cpu_executable\",\n         \"//xla/tsl/platform:errors\","
        },
        {
            "sha": "6e841511d97c18f96f4ca8369a8612276d30a89a",
            "filename": "third_party/xla/xla/backends/cpu/autotuner/cpu_profiler.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -31,7 +31,7 @@ limitations under the License.\n #include \"xla/service/buffer_assignment.h\"\n #include \"xla/service/cpu/cpu_executable.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/xla_data.pb.h\"\n@@ -94,7 +94,7 @@ absl::StatusOr<ProfileResult> CpuProfiler::Profile(\n }\n \n absl::Status CpuProfiler::Execute(\n-    Executable* executable, absl::Span<const MaybeOwningDeviceMemory> buffers,\n+    Executable* executable, absl::Span<const MaybeOwningDeviceAddress> buffers,\n     ExecutionProfile* profile) {\n   ExecutableRunOptions run_options;\n   run_options.set_execution_profile(profile);"
        },
        {
            "sha": "5d5f32c780cd20831b23548c250e4b051c2f8c38",
            "filename": "third_party/xla/xla/backends/cpu/autotuner/cpu_profiler.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fautotuner%2Fcpu_profiler.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -25,15 +25,15 @@ limitations under the License.\n #include \"xla/backends/autotuner/profiler.h\"\n #include \"xla/literal.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/xla_data.pb.h\"\n \n namespace xla::cpu {\n \n struct LiteralBackedCpuBuffers : public InputBuffers {\n   std::vector<Literal> backing_literals;\n-  std::vector<MaybeOwningDeviceMemory> buffers;\n+  std::vector<MaybeOwningDeviceAddress> buffers;\n };\n \n class CpuProfiler : public Profiler {\n@@ -60,7 +60,7 @@ class CpuProfiler : public Profiler {\n   explicit CpuProfiler(ProfileOptions options) : options_(options) {}\n \n   absl::Status Execute(Executable* executable,\n-                       absl::Span<const MaybeOwningDeviceMemory> buffers,\n+                       absl::Span<const MaybeOwningDeviceAddress> buffers,\n                        ExecutionProfile* profile);\n \n  private:"
        },
        {
            "sha": "026a0476d92786b6c0a2d6a425af047aec39609a",
            "filename": "third_party/xla/xla/backends/cpu/runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -56,7 +56,7 @@ cc_library(\n     deps = [\n         \"//xla:util\",\n         \"//xla/service:buffer_assignment\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/stream_executor:device_address\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/container:inlined_vector\","
        },
        {
            "sha": "d91f41dcec389a3046ace15d177958c30717ae7e",
            "filename": "third_party/xla/xla/backends/cpu/runtime/buffer_allocations.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fbuffer_allocations.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fbuffer_allocations.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fbuffer_allocations.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -26,7 +26,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/types/span.h\"\n #include \"xla/service/buffer_assignment.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/stream_executor/device_address.h\"\n #include \"xla/util.h\"\n \n@@ -40,7 +40,8 @@ class BufferAllocations {\n \n   explicit BufferAllocations(Buffers buffers);\n   explicit BufferAllocations(absl::Span<const se::DeviceAddressBase> buffers);\n-  explicit BufferAllocations(absl::Span<const MaybeOwningDeviceMemory> buffers);\n+  explicit BufferAllocations(\n+      absl::Span<const MaybeOwningDeviceAddress> buffers);\n \n   // Returns the device address of buffer at the given index. Returns an error\n   // if the index is out of range.\n@@ -80,7 +81,7 @@ inline BufferAllocations::BufferAllocations(\n       num_buffers_(buffers_.size()) {}\n \n inline BufferAllocations::BufferAllocations(\n-    absl::Span<const MaybeOwningDeviceMemory> buffers)\n+    absl::Span<const MaybeOwningDeviceAddress> buffers)\n     : buffers_(buffers.size()),\n       buffers_data_(buffers_.data()),\n       num_buffers_(buffers_.size()) {"
        },
        {
            "sha": "662e3f7e03ddf59d9875ec5a942f7161814ee516",
            "filename": "third_party/xla/xla/backends/gpu/autotuner/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -507,7 +507,7 @@ cc_library(\n         \"//xla/backends/gpu/runtime:buffer_comparator\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:executable\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service/gpu:gpu_executable_run_options\",\n         \"//xla/service/gpu/autotuning:redzone_buffers\","
        },
        {
            "sha": "82c8405af97e3de2cf927fd36579ac56d0f3c25a",
            "filename": "third_party/xla/xla/backends/gpu/autotuner/gpu_profiler.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Fgpu_profiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Fgpu_profiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fautotuner%2Fgpu_profiler.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -33,7 +33,7 @@ limitations under the License.\n #include \"xla/service/executable.h\"\n #include \"xla/service/gpu/autotuning/redzone_buffers.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n@@ -62,7 +62,7 @@ std::vector<ExecutionInput> CreateExecutionInputsFromBuffers(\n     // Our executable doesn't have input-output aliasing, so we can pass\n     // unowned input buffers.\n     inputs.back().SetUnownedBuffer(\n-        /*index=*/{}, MaybeOwningDeviceMemory(/*unowned=*/buffers.at(i)));\n+        /*index=*/{}, MaybeOwningDeviceAddress(/*unowned=*/buffers.at(i)));\n   }\n   return inputs;\n }"
        },
        {
            "sha": "b8af7e32ada24ef91f559c23e1b1d91cc47c7088",
            "filename": "third_party/xla/xla/backends/interpreter/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -84,7 +84,7 @@ cc_library(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:dynamic_dimension_inference\",\n         \"//xla/service:executable\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:transfer_manager\",\n         \"//xla/stream_executor:device_address\","
        },
        {
            "sha": "eb7fa5d4c078326546ac10e493da81aa1db6e963",
            "filename": "third_party/xla/xla/backends/interpreter/executable_base.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -31,7 +31,7 @@ limitations under the License.\n #include \"xla/layout_util.h\"\n #include \"xla/literal.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n@@ -73,7 +73,7 @@ absl::StatusOr<ExecutionOutput> InterpreterExecutableBase::ExecuteAsyncOnStream(\n     device_ordinal = 0;\n   }\n   for (auto& argument : arguments) {\n-    const ShapeTree<MaybeOwningDeviceMemory>& buffers = argument.Buffers();\n+    const ShapeTree<MaybeOwningDeviceAddress>& buffers = argument.Buffers();\n     argument_buffers.push_back(ShapedBuffer(buffers.shape(),\n                                             /*device_ordinal=*/device_ordinal));\n     auto in_it = buffers.begin();\n@@ -179,7 +179,7 @@ InterpreterExecutableBase::AllocateOutputMemoryWithInputReuse(\n           -> absl::Status {\n         if (alias && alias->must_alias()) {\n           VLOG(1) << alias->ToString();\n-          const MaybeOwningDeviceMemory& original_input =\n+          const MaybeOwningDeviceAddress& original_input =\n               (*arguments)[alias->parameter_number].Buffers().element(\n                   alias->parameter_index);\n           if (!original_input.HasOwnership()) {\n@@ -214,7 +214,7 @@ InterpreterExecutableBase::AllocateOutputMemoryWithInputReuse(\n     if (alias) {\n       TF_RET_CHECK(alias->parameter_number < arguments->size());\n       ExecutionInput& input = (*arguments)[alias->parameter_number];\n-      MaybeOwningDeviceMemory* device_memory =\n+      MaybeOwningDeviceAddress* device_memory =\n           input.MutableBuffer(alias->parameter_index);\n       if (auto owning = device_memory->Release()) {\n         se::DeviceAddressBase device_memory_base = owning->Release();"
        },
        {
            "sha": "c2801fa3fa8410781712be4c3d28c62796938ba8",
            "filename": "third_party/xla/xla/client/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fclient%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -124,7 +124,7 @@ cc_library(\n         \"//xla/service:dump\",\n         \"//xla/service:executable\",\n         \"//xla/service:local_service\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:source_map_util\",\n         \"//xla/service:stream_pool\","
        },
        {
            "sha": "cc383a9aa81b347735d643ef239dd1ca8df79531",
            "filename": "third_party/xla/xla/client/local_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -37,7 +37,7 @@ limitations under the License.\n #include \"xla/service/computation_layout.h\"\n #include \"xla/service/dump.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/source_map_util.h\"\n@@ -319,7 +319,7 @@ absl::StatusOr<ScopedShapedBuffer> LocalExecutable::RunAsync(\n }\n \n static ShapedBuffer MaybeOwningShapeTreeToShapedBuffer(\n-    const ShapeTree<MaybeOwningDeviceMemory>& tree, int device_ordinal) {\n+    const ShapeTree<MaybeOwningDeviceAddress>& tree, int device_ordinal) {\n   ShapedBuffer result(tree.shape(), device_ordinal);\n   auto it = tree.begin();\n   auto out_it = result.buffers().begin();"
        },
        {
            "sha": "3ccda5d43f6794de0155ff41e9b100e1fc3c63ec",
            "filename": "third_party/xla/xla/client/local_client.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fclient%2Flocal_client.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -34,7 +34,7 @@ limitations under the License.\n #include \"xla/service/compiler.h\"\n #include \"xla/service/executable.h\"\n #include \"xla/service/local_service.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/stream_pool.h\""
        },
        {
            "sha": "6b382142dbb42f49182eac33b3fa75bddd57b50d",
            "filename": "third_party/xla/xla/pjrt/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -710,7 +710,7 @@ cc_library(\n         \"//xla/service:generic_transfer_manager\",\n         \"//xla/service:hlo_cost_analysis\",\n         \"//xla/service:hlo_proto_cc\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:transfer_manager\",\n         \"//xla/service/gpu:gpu_executable_run_options\","
        },
        {
            "sha": "6e7d2fad54a6dcd820124d97121dcff0ddd10ed6",
            "filename": "third_party/xla/xla/pjrt/cpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -202,7 +202,7 @@ cc_library(\n         \"//xla/service:hlo_module_util\",\n         \"//xla/service:hlo_proto_cc\",\n         \"//xla/service:hlo_value\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service/cpu:cpu_compiler\",\n         \"//xla/service/cpu:cpu_executable\",\n         \"//xla/service/cpu:cpu_executable_run_options\","
        },
        {
            "sha": "5e2f7aa65df9eff48014e34a600ca35443405d36",
            "filename": "third_party/xla/xla/pjrt/cpu/cpu_client.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fcpu%2Fcpu_client.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -114,7 +114,7 @@ limitations under the License.\n #include \"xla/service/hlo_module_util.h\"\n #include \"xla/service/hlo_value.h\"\n #include \"xla/service/llvm_ir/llvm_command_line_options.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/stream_executor/device_memory.h\"\n@@ -1620,7 +1620,7 @@ absl::StatusOr<PjRtLoadedExecutable::Result> PjRtCpuExecutable::ExecuteHelper(\n \n     if (cpu_executable->has_thunks()) {\n       // Call interpreted thunk sequence implementing XLA executable.\n-      absl::InlinedVector<MaybeOwningDeviceMemory, 8> buffer_device_mem;\n+      absl::InlinedVector<MaybeOwningDeviceAddress, 8> buffer_device_mem;\n       buffer_device_mem.reserve(buffer_table.size());\n       for (const auto& buffer_info : buffer_table) {\n         buffer_device_mem.emplace_back(\n@@ -1764,7 +1764,7 @@ absl::StatusOr<PjRtLoadedExecutable::Result> PjRtCpuExecutable::ExecuteHelper(\n           absl::Status status;\n           if (cpu_executable->has_thunks()) {\n             // Call interpreted thunk sequence implementing XLA executable.\n-            absl::InlinedVector<MaybeOwningDeviceMemory, 8> buffer_device_mem;\n+            absl::InlinedVector<MaybeOwningDeviceAddress, 8> buffer_device_mem;\n             buffer_device_mem.reserve(buffer_table.size());\n             for (const auto& buffer_info : buffer_table) {\n               buffer_device_mem.emplace_back("
        },
        {
            "sha": "b6d28c5e744e7f2ccc009be063d9084eda43058c",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -100,7 +100,7 @@ cc_library(\n         \"//xla/service:generic_transfer_manager\",\n         \"//xla/service:hlo_cost_analysis\",\n         \"//xla/service:hlo_proto_cc\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:transfer_manager\",\n         \"//xla/service/gpu:gpu_executable_run_options\","
        },
        {
            "sha": "1c97ab898cbd2100aad29d3ef9ef5b02608621d7",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_executable.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -69,7 +69,7 @@ limitations under the License.\n #include \"xla/service/executable.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n #include \"xla/service/hlo.pb.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n #include \"xla/shape.h\"\n@@ -902,19 +902,19 @@ absl::StatusOr<PjRtLoadedExecutable::Result> TfrtGpuExecutable::ExecuteHelper(\n         std::vector<ExecutionInput> inputs;\n         if (parameter_is_tupled_arguments) {\n           inputs.emplace_back(\n-              ShapeTree<MaybeOwningDeviceMemory>(&parameter_shapes->front()));\n+              ShapeTree<MaybeOwningDeviceAddress>(&parameter_shapes->front()));\n           ExecutionInput& input = inputs.back();\n           for (int i = 0; i < tracked_buffers.size(); ++i) {\n             VLOG(4) << \"tupled input[\" << i\n                     << \"]: \" << tracked_buffers[i]->buffer()->buffer().opaque();\n             if (buffer_is_donated[i]) {\n               input.SetUnownedBuffer(\n-                  {i}, MaybeOwningDeviceMemory(se::OwningDeviceMemory(\n+                  {i}, MaybeOwningDeviceAddress(se::OwningDeviceMemory(\n                            tracked_buffers[i]->buffer()->buffer(),\n                            device->local_hardware_id().value(),\n                            client->allocator())));\n             } else {\n-              input.SetBuffer({i}, MaybeOwningDeviceMemory(\n+              input.SetBuffer({i}, MaybeOwningDeviceAddress(\n                                        tracked_buffers[i]->buffer()->buffer()));\n             }\n           }\n@@ -924,16 +924,16 @@ absl::StatusOr<PjRtLoadedExecutable::Result> TfrtGpuExecutable::ExecuteHelper(\n             VLOG(4) << \"untupled input[\" << i\n                     << \"]: \" << tracked_buffers[i]->buffer()->buffer().opaque();\n             inputs.emplace_back(\n-                ShapeTree<MaybeOwningDeviceMemory>(&(*parameter_shapes)[i]));\n+                ShapeTree<MaybeOwningDeviceAddress>(&(*parameter_shapes)[i]));\n             ExecutionInput& input = inputs.back();\n             if (buffer_is_donated[i]) {\n               input.SetUnownedBuffer(\n-                  {}, MaybeOwningDeviceMemory(se::OwningDeviceMemory(\n+                  {}, MaybeOwningDeviceAddress(se::OwningDeviceMemory(\n                           tracked_buffers[i]->buffer()->buffer(),\n                           device->local_hardware_id().value(),\n                           client->allocator())));\n             } else {\n-              input.SetBuffer({}, MaybeOwningDeviceMemory(\n+              input.SetBuffer({}, MaybeOwningDeviceAddress(\n                                       tracked_buffers[i]->buffer()->buffer()));\n             }\n           }"
        },
        {
            "sha": "19c949075f320da08158415fad113c3f18fbe502",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tracked_gpu_device_buffer.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftracked_gpu_device_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftracked_gpu_device_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftracked_gpu_device_buffer.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -35,7 +35,7 @@ limitations under the License.\n #include \"xla/tsl/concurrency/async_value_ref.h\"\n \n namespace xla {\n-// TODO(b/400541410): Refactor and Merge this with MaybeOwningDeviceMemory.\n+// TODO(b/400541410): Refactor and Merge this with MaybeOwningDeviceAddress.\n \n // GpuDeviceMemory represents either an owned or unowned GPU memory. It\n // owns GPU memory if an allocator is provided. When the object goes output of"
        },
        {
            "sha": "4c175b7390e14c01190f69d91c9f7a8696ffa1d9",
            "filename": "third_party/xla/xla/pjrt/pjrt_stream_executor_client.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_stream_executor_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_stream_executor_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_stream_executor_client.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -141,7 +141,7 @@ limitations under the License.\n #include \"xla/service/executable.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/hlo_cost_analysis.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n #include \"xla/shape.h\"\n@@ -1673,12 +1673,12 @@ PjRtStreamExecutorClient::RunAsync(\n     auto it = tmp.MutableBuffers()->begin();\n     for (auto& v : input) {\n       if (v.second.is_donated) {\n-        it->second = MaybeOwningDeviceMemory(se::OwningDeviceMemory(\n+        it->second = MaybeOwningDeviceAddress(se::OwningDeviceMemory(\n             v.second.buf->mem(), device->local_device_id().value(),\n             run_options.allocator()));\n         tmp.SetUnownedIndex(it->first);\n       } else {\n-        it->second = MaybeOwningDeviceMemory(v.second.buf->mem());\n+        it->second = MaybeOwningDeviceAddress(v.second.buf->mem());\n       }\n       ++it;\n     }"
        },
        {
            "sha": "62b36de492388130412da957ee497888f4442f21",
            "filename": "third_party/xla/xla/pjrt/tracked_device_buffer.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Ftracked_device_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fpjrt%2Ftracked_device_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Ftracked_device_buffer.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -39,7 +39,7 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_tree.h\"\n@@ -109,8 +109,8 @@ class TrackedDeviceBuffer : public AbstractTrackedDeviceBuffer {\n   // on_device_shape matches that of the TrackedDeviceBuffer. 'end' is used to\n   // check that 'iterator' doesn't run out of bounds.\n   void AddToInputAsImmutable(\n-      ShapeTree<MaybeOwningDeviceMemory>::iterator* iterator,\n-      const ShapeTree<MaybeOwningDeviceMemory>::iterator& end) const;\n+      ShapeTree<MaybeOwningDeviceAddress>::iterator* iterator,\n+      const ShapeTree<MaybeOwningDeviceAddress>::iterator& end) const;\n \n   // Adds the owned device buffers in order to 'iterator', marking them as\n   // available to be donated. If donation succeeds, i.e., execution_input is\n@@ -121,8 +121,8 @@ class TrackedDeviceBuffer : public AbstractTrackedDeviceBuffer {\n   // that of the TrackedDeviceBuffer. 'end' is used to check that 'iterator'\n   // doesn't run out of bounds.\n   void AddToInputAsDonated(\n-      ShapeTree<MaybeOwningDeviceMemory>::iterator* iterator,\n-      const ShapeTree<MaybeOwningDeviceMemory>::iterator& end,\n+      ShapeTree<MaybeOwningDeviceAddress>::iterator* iterator,\n+      const ShapeTree<MaybeOwningDeviceAddress>::iterator& end,\n       ExecutionInput* execution_input,\n       se::DeviceMemoryAllocator* allocator) const;\n "
        },
        {
            "sha": "b87bc885903e108d42a05dfb25c1971d8e7a89fa",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -1528,7 +1528,7 @@ cc_library(\n         \":computation_layout\",\n         \":hlo_module_config\",\n         \":hlo_proto_cc\",\n-        \":maybe_owning_device_memory\",\n+        \":maybe_owning_device_address\",\n         \":shaped_buffer\",\n         \":stream_pool\",\n         \"//xla:executable_run_options\",\n@@ -1666,7 +1666,7 @@ cc_library(\n     hdrs = [\"transfer_manager.h\"],\n     deps = [\n         \":compiler\",\n-        \":maybe_owning_device_memory\",\n+        \":maybe_owning_device_address\",\n         \":shaped_buffer\",\n         \"//xla:literal\",\n         \"//xla:shape_tree\",\n@@ -4460,7 +4460,7 @@ cc_library(\n         \":executable\",\n         \":hlo_module_util\",\n         \":hlo_runner_interface\",\n-        \":maybe_owning_device_memory\",\n+        \":maybe_owning_device_address\",\n         \":shaped_buffer\",\n         \":transfer_manager\",\n         \"//xla:executable_run_options\","
        },
        {
            "sha": "f9d93965489130cc218d09b2b1a98521c655ba68",
            "filename": "third_party/xla/xla/service/cpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -550,7 +550,7 @@ cc_library(\n         \"//xla/service:hlo_execution_profile\",\n         \"//xla/service:hlo_profile_printer_data_cc\",\n         \"//xla/service:hlo_value\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:xla_debug_info_manager\",\n         \"//xla/stream_executor:device_address\","
        },
        {
            "sha": "c0c1e6446220fa3b7ee31ff4ec9bff90fec7dfa8",
            "filename": "third_party/xla/xla/service/cpu/cpu_executable.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -58,7 +58,7 @@ limitations under the License.\n #include \"xla/service/hlo_execution_profile.h\"\n #include \"xla/service/hlo_profile_printer_data.pb.h\"\n #include \"xla/service/hlo_value.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/xla_debug_info_manager.h\"\n@@ -156,7 +156,7 @@ CpuExecutable::~CpuExecutable() {\n   }\n }\n \n-static absl::StatusOr<MaybeOwningDeviceMemory> MemoryForAllocation(\n+static absl::StatusOr<MaybeOwningDeviceAddress> MemoryForAllocation(\n     const BufferAllocation& allocation,\n     absl::Span<const ExecutionInput> arguments,\n     absl::Span<const ConstantAllocation> constants,\n@@ -170,17 +170,17 @@ static absl::StatusOr<MaybeOwningDeviceMemory> MemoryForAllocation(\n         << \"Size mismatch on param \" << allocation.parameter_number()\n         << \" at shape index \" << allocation.param_shape_index().ToString();\n     VLOG(3) << \"allocation is a parameter\";\n-    return MaybeOwningDeviceMemory{out};\n+    return MaybeOwningDeviceAddress{out};\n   } else if (allocation.is_constant()) {\n     VLOG(3) << \"allocation is a constant\";\n     if (allocation.index() < constants.size()) {\n-      return MaybeOwningDeviceMemory(\n+      return MaybeOwningDeviceAddress(\n           constants[allocation.index()].AsDeviceMemoryBase());\n     }\n-    return MaybeOwningDeviceMemory{se::DeviceAddressBase{}};\n+    return MaybeOwningDeviceAddress{se::DeviceAddressBase{}};\n   } else if (allocation.is_thread_local()) {\n     VLOG(3) << \"buffer is thread-local\";\n-    return MaybeOwningDeviceMemory{se::DeviceAddressBase{}};\n+    return MaybeOwningDeviceAddress{se::DeviceAddressBase{}};\n   }\n \n   int64_t buffer_size = allocation.size();\n@@ -194,14 +194,14 @@ static absl::StatusOr<MaybeOwningDeviceMemory> MemoryForAllocation(\n   // initialized. Mark them initialized so that memory sanitizer doesn't flag\n   // loads from these buffers.\n   ABSL_ANNOTATE_MEMORY_IS_INITIALIZED(out->opaque(), buffer_size);\n-  return MaybeOwningDeviceMemory{std::move(out)};\n+  return MaybeOwningDeviceAddress{std::move(out)};\n }\n \n-absl::StatusOr<std::vector<MaybeOwningDeviceMemory>>\n+absl::StatusOr<std::vector<MaybeOwningDeviceAddress>>\n CpuExecutable::CreateBufferTable(se::DeviceAddressAllocator* memory_allocator,\n                                  int device_ordinal,\n                                  absl::Span<ExecutionInput const> arguments) {\n-  std::vector<MaybeOwningDeviceMemory> buffers(\n+  std::vector<MaybeOwningDeviceAddress> buffers(\n       assignment_->Allocations().size());\n   VLOG(3) << \"Allocating \" << assignment_->Allocations().size()\n           << \" allocations for module \" << module().name();\n@@ -233,7 +233,7 @@ static int32_t GetDeviceOrdinal(const ExecutableRunOptions* run_options) {\n \n absl::Status CpuExecutable::ExecuteThunks(\n     const ExecutableRunOptions* run_options,\n-    absl::Span<MaybeOwningDeviceMemory const> buffers) {\n+    absl::Span<MaybeOwningDeviceAddress const> buffers) {\n   uint64_t start_ns = tsl::Env::Default()->NowNanos();\n \n   size_t profile_counters_size = 0;\n@@ -244,7 +244,7 @@ absl::Status CpuExecutable::ExecuteThunks(\n   VLOG(3) << \"Executing XLA:CPU thunks:\";\n   VLOG(3) << absl::StrFormat(\"  Number of buffer allocations: %u\",\n                              buffers.size());\n-  auto mem_printer = [](std::string* out, const MaybeOwningDeviceMemory& mem) {\n+  auto mem_printer = [](std::string* out, const MaybeOwningDeviceAddress& mem) {\n     absl::StrAppend(out,\n                     absl::StrFormat(\"%p\", mem.AsDeviceMemoryBase().opaque()));\n   };\n@@ -308,7 +308,7 @@ absl::Status CpuExecutable::ExecuteThunks(\n \n absl::StatusOr<ExecutionOutput> CpuExecutable::CreateResultShapedBuffer(\n     const ServiceExecutableRunOptions* run_options,\n-    absl::Span<MaybeOwningDeviceMemory> buffers,\n+    absl::Span<MaybeOwningDeviceAddress> buffers,\n     absl::Span<ExecutionInput> arguments) {\n   se::Stream* stream = run_options->stream();\n   ExecutionOutput result(/*on_device_shape=*/result_shape(),\n@@ -345,7 +345,7 @@ absl::StatusOr<ExecutionOutput> CpuExecutable::CreateResultShapedBuffer(\n     if (alias) {\n       CHECK_LT(alias->parameter_number, arguments.size());\n       ExecutionInput& input = arguments[alias->parameter_number];\n-      MaybeOwningDeviceMemory* maybe_owning_memory =\n+      MaybeOwningDeviceAddress* maybe_owning_memory =\n           input.MutableBuffer(alias->parameter_index);\n       if (alias->must_alias() && !maybe_owning_memory->HasOwnership()) {\n         return InvalidArgument(\n@@ -381,7 +381,7 @@ absl::StatusOr<ExecutionOutput> CpuExecutable::CreateResultShapedBuffer(\n             run_options->allocator()->Allocate(\n                 stream->parent()->device_ordinal(), allocation_size));\n         result_buffer = allocated_buffer.Release();\n-        MaybeOwningDeviceMemory& registered_buffer = buffers[buffer_index];\n+        MaybeOwningDeviceAddress& registered_buffer = buffers[buffer_index];\n         CHECK_EQ(result_buffer.size(),\n                  registered_buffer.AsDeviceMemoryBase().size());\n         std::memcpy(/*dest=*/result_buffer.opaque(),\n@@ -392,7 +392,7 @@ absl::StatusOr<ExecutionOutput> CpuExecutable::CreateResultShapedBuffer(\n     }\n \n     if (result_buffer.is_null()) {\n-      MaybeOwningDeviceMemory& buffer = buffers[buffer_index];\n+      MaybeOwningDeviceAddress& buffer = buffers[buffer_index];\n       if (std::optional<se::ScopedDeviceAddress<uint8_t>> owned_buffer =\n               buffer.Release()) {\n         result_buffer = owned_buffer->Release();\n@@ -437,7 +437,7 @@ absl::StatusOr<ExecutionOutput> CpuExecutable::ExecuteAsyncOnStream(\n   se::Stream* stream = run_options->stream();\n   se::DeviceAddressAllocator* memory_allocator = run_options->allocator();\n   TF_ASSIGN_OR_RETURN(\n-      std::vector<MaybeOwningDeviceMemory> buffers,\n+      std::vector<MaybeOwningDeviceAddress> buffers,\n       CreateBufferTable(memory_allocator, stream->parent()->device_ordinal(),\n                         arguments));\n "
        },
        {
            "sha": "3db37885900445315a5eb0f7b8f321e14b9fa3ea",
            "filename": "third_party/xla/xla/service/cpu/cpu_executable.h",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -43,7 +43,7 @@ limitations under the License.\n #include \"xla/service/hlo_execution_profile.h\"\n #include \"xla/service/hlo_profile_printer_data.pb.h\"\n #include \"xla/service/hlo_value.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/stream_executor/device_address_allocator.h\"\n \n@@ -72,8 +72,9 @@ class CpuExecutable : public Executable {\n \n   // Calls emitted thunk sequence with the given arguments using the supplied\n   // buffers.\n-  absl::Status ExecuteThunks(const ExecutableRunOptions* run_options,\n-                             absl::Span<MaybeOwningDeviceMemory const> buffers);\n+  absl::Status ExecuteThunks(\n+      const ExecutableRunOptions* run_options,\n+      absl::Span<MaybeOwningDeviceAddress const> buffers);\n \n   absl::Span<const ObjFileProto> obj_files() const { return obj_files_; }\n \n@@ -172,7 +173,7 @@ class CpuExecutable : public Executable {\n   //\n   //  - buffers_to_free: buffers whose ownership was donated by the caller that\n   //    are to be freed by the caller.\n-  absl::StatusOr<std::vector<MaybeOwningDeviceMemory>> CreateBufferTable(\n+  absl::StatusOr<std::vector<MaybeOwningDeviceAddress>> CreateBufferTable(\n       se::DeviceAddressAllocator* memory_allocator, int device_ordinal,\n       absl::Span<ExecutionInput const> arguments);\n \n@@ -182,7 +183,7 @@ class CpuExecutable : public Executable {\n   // assignment.\n   absl::StatusOr<ExecutionOutput> CreateResultShapedBuffer(\n       const ServiceExecutableRunOptions* run_options,\n-      absl::Span<MaybeOwningDeviceMemory> buffers,\n+      absl::Span<MaybeOwningDeviceAddress> buffers,\n       absl::Span<ExecutionInput> arguments);\n \n   // Returns the instruction value set of the root instruction of the entry"
        },
        {
            "sha": "a9f8da25d12d1cc0dad363d7299e1958b8d8002b",
            "filename": "third_party/xla/xla/service/executable.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -27,7 +27,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/types/span.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n@@ -70,7 +70,7 @@ absl::Status ExecutionInput::SetDynamicShape(Shape dynamic_shape) {\n }\n \n void ExecutionInput::SetUnownedBuffer(const ShapeIndex& index,\n-                                      MaybeOwningDeviceMemory buffer) {\n+                                      MaybeOwningDeviceAddress buffer) {\n   *buffers_.mutable_element(index) = std::move(buffer);\n   unowned_indices_.insert(index);\n }\n@@ -86,12 +86,12 @@ absl::StatusOr<ScopedShapedBuffer> Executable::ExecuteOnStream(\n   return result;\n }\n \n-static ExecutionInput MakeMaybeOwningDeviceMemoryTree(\n+static ExecutionInput MakeMaybeOwningDeviceAddressTree(\n     const ShapedBuffer& shaped_buffer) {\n   ExecutionInput result(shaped_buffer.on_device_shape());\n   shaped_buffer.buffers().ForEachElement(\n       [&](const ShapeIndex& index, const se::DeviceAddressBase& mem) {\n-        result.SetBuffer(index, MaybeOwningDeviceMemory(mem));\n+        result.SetBuffer(index, MaybeOwningDeviceAddress(mem));\n       });\n   return result;\n }\n@@ -102,7 +102,7 @@ absl::StatusOr<ScopedShapedBuffer> Executable::ExecuteAsyncOnStream(\n   std::vector<ExecutionInput> args;\n   args.reserve(arguments.size());\n   for (const ShapedBuffer* arg : arguments) {\n-    args.emplace_back(MakeMaybeOwningDeviceMemoryTree(*arg));\n+    args.emplace_back(MakeMaybeOwningDeviceAddressTree(*arg));\n   }\n   TF_ASSIGN_OR_RETURN(ExecutionOutput out,\n                       ExecuteAsyncOnStream(run_options, std::move(args)));"
        },
        {
            "sha": "e76038f8a95f9a631941ce577926beda75f41989",
            "filename": "third_party/xla/xla/service/executable.h",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -37,7 +37,7 @@ limitations under the License.\n #include \"xla/service/computation_layout.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/hlo_module_config.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n@@ -61,11 +61,11 @@ namespace xla {\n // 3) Donated by the caller and freed on error.\n //\n // Case (1) buffers are stored as\n-// MaybeOwningDeviceMemory(DeviceAddressBase). Case (2) buffers are\n-// stored as MaybeOwningDeviceMemory(ScopedDeviceAddress<uint8_t>),\n+// MaybeOwningDeviceAddress(DeviceAddressBase). Case (2) buffers are\n+// stored as MaybeOwningDeviceAddress(ScopedDeviceAddress<uint8_t>),\n //   with their indices present in unowned_indices_.\n // Case (3) buffers are stored as\n-// MaybeOwningDeviceMemory(ScopedDeviceAddress<uint8_t>),\n+// MaybeOwningDeviceAddress(ScopedDeviceAddress<uint8_t>),\n //   with their indices absent from unowned_indices_.\n class ExecutionInput {\n  public:\n@@ -88,14 +88,14 @@ class ExecutionInput {\n     }\n   }\n \n-  explicit ExecutionInput(ShapeTree<MaybeOwningDeviceMemory> buffers)\n+  explicit ExecutionInput(ShapeTree<MaybeOwningDeviceAddress> buffers)\n       : buffers_(std::move(buffers)) {\n     if (!ShapeUtil::DeviceShapeIsHostShape(buffers_.shape())) {\n       SetHostShape(ShapeUtil::DeviceShapeToHostShape(buffers_.shape()));\n     }\n   }\n   // TODO(b/170310047): remove this overload.\n-  ExecutionInput(ShapeTree<MaybeOwningDeviceMemory> buffers,\n+  ExecutionInput(ShapeTree<MaybeOwningDeviceAddress> buffers,\n                  xla::Shape host_shape)\n       : buffers_(std::move(buffers)) {\n     if (!ShapeUtil::DeviceShapeIsHostShape(buffers_.shape())) {\n@@ -119,12 +119,12 @@ class ExecutionInput {\n \n   absl::Status SetDynamicShape(Shape dynamic_shape);\n \n-  void SetBuffer(const ShapeIndex& index, MaybeOwningDeviceMemory buffer) {\n+  void SetBuffer(const ShapeIndex& index, MaybeOwningDeviceAddress buffer) {\n     *buffers_.mutable_element(index) = std::move(buffer);\n   }\n \n   void SetUnownedBuffer(const ShapeIndex& index,\n-                        MaybeOwningDeviceMemory buffer);\n+                        MaybeOwningDeviceAddress buffer);\n \n   void SetUnownedIndex(const ShapeIndex& index) {\n     unowned_indices_.insert(index);\n@@ -138,15 +138,17 @@ class ExecutionInput {\n     return unowned_indices_;\n   }\n \n-  const ShapeTree<MaybeOwningDeviceMemory>& Buffers() const { return buffers_; }\n+  const ShapeTree<MaybeOwningDeviceAddress>& Buffers() const {\n+    return buffers_;\n+  }\n \n-  ShapeTree<MaybeOwningDeviceMemory>* MutableBuffers() { return &buffers_; }\n+  ShapeTree<MaybeOwningDeviceAddress>* MutableBuffers() { return &buffers_; }\n \n-  MaybeOwningDeviceMemory* MutableBuffer(const ShapeIndex& index) {\n+  MaybeOwningDeviceAddress* MutableBuffer(const ShapeIndex& index) {\n     return buffers_.mutable_element(index);\n   }\n \n-  const MaybeOwningDeviceMemory& Buffer(const ShapeIndex& index) const {\n+  const MaybeOwningDeviceAddress& Buffer(const ShapeIndex& index) const {\n     return buffers_.element(index);\n   }\n \n@@ -157,7 +159,7 @@ class ExecutionInput {\n     }\n   }\n \n-  ShapeTree<MaybeOwningDeviceMemory> buffers_;\n+  ShapeTree<MaybeOwningDeviceAddress> buffers_;\n \n   // Set of indices of buffers that should be returned to the caller if an error\n   // occurs when enqueuing the computation."
        },
        {
            "sha": "b9a929cdf282fecca983ef3e0ce92d6aac132165",
            "filename": "third_party/xla/xla/service/gpu/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -712,7 +712,7 @@ cc_library(\n         \"//xla/service:dump\",\n         \"//xla/service:executable\",\n         \"//xla/service:hlo_value\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:rendezvous\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:stream_pool\","
        },
        {
            "sha": "56d8c4cb2f64ee54609839a1644a48d22531f053",
            "filename": "third_party/xla/xla/service/gpu/autotuning/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -496,7 +496,7 @@ cc_library(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:compiler\",\n         \"//xla/service:executable\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service/gpu:gpu_executable_run_options\",\n         \"//xla/service/gpu:ir_emission_utils\","
        },
        {
            "sha": "290187c503292d8e99ccc37a9ff588ea3bfd7b55",
            "filename": "third_party/xla/xla/service/gpu/autotuning/autotuner_compile_util.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2Fautotuner_compile_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2Fautotuner_compile_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fautotuning%2Fautotuner_compile_util.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -36,7 +36,7 @@ limitations under the License.\n #include \"xla/service/gpu/autotuning/autotuner_util.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n #include \"xla/service/gpu/ir_emission_utils.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n@@ -63,7 +63,7 @@ std::vector<ExecutionInput> ExecutionInputsFromBuffers(\n     // Our executable doesn't have input-output aliasing, so we can pass\n     // unowned input buffers.\n     inputs.back().SetUnownedBuffer(\n-        /*index=*/{}, MaybeOwningDeviceMemory(/*unowned=*/buffers.at(i)));\n+        /*index=*/{}, MaybeOwningDeviceAddress(/*unowned=*/buffers.at(i)));\n   }\n   return inputs;\n }"
        },
        {
            "sha": "905cac3061925c32ab72e1907f148ec954623c0d",
            "filename": "third_party/xla/xla/service/gpu/gpu_executable.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fgpu_executable.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -72,7 +72,7 @@ limitations under the License.\n #include \"xla/service/gpu/ir_emission_utils.h\"\n #include \"xla/service/gpu/stream_executor_util.h\"\n #include \"xla/service/hlo_value.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/rendezvous.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n@@ -937,8 +937,8 @@ absl::StatusOr<ExecutionOutput> GpuExecutable::ExecuteAsyncOnStreamImpl(\n             << \" @ index: \" << index.ToString();\n \n     if (output_info.alias_config) {\n-      MaybeOwningDeviceMemory* maybe_owning_memory =\n-          [&]() -> xla::MaybeOwningDeviceMemory* {\n+      MaybeOwningDeviceAddress* maybe_owning_memory =\n+          [&]() -> xla::MaybeOwningDeviceAddress* {\n         // ScopedBuffer is never an owned buffer.\n         if (std::holds_alternative<absl::Span<const ShapedBuffer* const>>(\n                 arguments)) {"
        },
        {
            "sha": "077c92bf517de3744ebd4796b55c38b011fe9bcd",
            "filename": "third_party/xla/xla/service/hlo_runner.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -41,7 +41,7 @@ limitations under the License.\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n #include \"xla/service/hlo_module_util.h\"\n #include \"xla/service/hlo_runner_interface.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n@@ -294,7 +294,7 @@ static std::vector<ExecutionInput> ExecutionInputsFromScopedShapedBuffers(\n \n   for (int param_num = 0; param_num < inputs.size(); param_num++) {\n     const ScopedShapedBuffer& input_buffer = inputs[param_num];\n-    ShapeTree<MaybeOwningDeviceMemory> buffer_tree(\n+    ShapeTree<MaybeOwningDeviceAddress> buffer_tree(\n         input_buffer.on_device_shape());\n \n     input_buffer.buffers().ForEachElement(\n@@ -329,7 +329,7 @@ static void ExecutionInputsFromMovedScopedShapedBuffers(\n   for (int param_num = 0; param_num < inputs.size(); param_num++) {\n     ShapedBuffer input_buffer = inputs[param_num].release();\n \n-    ShapeTree<MaybeOwningDeviceMemory> buffer_tree(\n+    ShapeTree<MaybeOwningDeviceAddress> buffer_tree(\n         input_buffer.on_device_shape());\n \n     input_buffer.buffers().ForEachElement("
        },
        {
            "sha": "4fbdcdc58ce116b290d035b47325761ebb3bc4f8",
            "filename": "third_party/xla/xla/service/transfer_manager.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -32,7 +32,7 @@ limitations under the License.\n #include \"absl/synchronization/notification.h\"\n #include \"xla/literal.h\"\n #include \"xla/service/compiler.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n@@ -288,7 +288,8 @@ absl::Status TransferManager::WriteRootTupleIndexTable(\n }\n \n absl::Status TransferManager::WriteRootTupleIndexTable(\n-    se::Stream* stream, const ShapeTree<MaybeOwningDeviceMemory>& buffer_tree) {\n+    se::Stream* stream,\n+    const ShapeTree<MaybeOwningDeviceAddress>& buffer_tree) {\n   TF_RET_CHECK(buffer_tree.shape().IsTuple());\n   if (ShapeUtil::TupleElementCount(buffer_tree.shape()) == 0) {\n     return absl::OkStatus();"
        },
        {
            "sha": "811138ba23f90545b0f0b0e72f1e5215cbfcb4c7",
            "filename": "third_party/xla/xla/service/transfer_manager.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Ftransfer_manager.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -26,7 +26,7 @@ limitations under the License.\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/types/span.h\"\n #include \"xla/literal.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_tree.h\"\n@@ -215,7 +215,7 @@ class TransferManager {\n                                         const ShapedBuffer& device_buffer);\n   absl::Status WriteRootTupleIndexTable(\n       se::Stream* stream,\n-      const ShapeTree<MaybeOwningDeviceMemory>& buffer_tree);\n+      const ShapeTree<MaybeOwningDeviceAddress>& buffer_tree);\n \n   // Determines the byte size requirement for the given shape on the underlying\n   // architecture. This will be used to allocate an appropriately sized memory"
        },
        {
            "sha": "1bc9dc62a099edc08e2aa3fdeb09b4dfc52928b6",
            "filename": "third_party/xla/xla/stream_executor/tpu/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -72,7 +72,7 @@ cc_library(\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/service:hlo_module_config\",\n         \"//xla/service:hlo_proto_cc\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/stream_executor:device_address\",\n         \"//xla/stream_executor:device_address_allocator\",\n@@ -608,7 +608,7 @@ cc_library(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:compiler\",\n         \"//xla/service:executable\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:transfer_manager\",\n         \"//xla/stream_executor:device_address\","
        },
        {
            "sha": "58eb6c2c3033f9859f76cd06c2b4592f3491ec8e",
            "filename": "third_party/xla/xla/stream_executor/tpu/c_api_conversions.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -34,7 +34,7 @@ limitations under the License.\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/hlo_module_config.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_layout.h\"\n@@ -158,14 +158,14 @@ xla::ShapedBuffer FromC(XLA_ShapedBuffer* c_buffer) {\n   return xla_shaped_buffer;\n }\n \n-SE_MaybeOwningDeviceMemory ToC(xla::MaybeOwningDeviceMemory& mem,\n+SE_MaybeOwningDeviceMemory ToC(xla::MaybeOwningDeviceAddress& mem,\n                                bool aliased) {\n   SE_MaybeOwningDeviceMemory se_mem;\n   se_mem.owned = mem.HasOwnership();\n-  se_mem.memory = ApiConverter::ToC(mem.AsDeviceMemoryBase());\n+  se_mem.memory = ApiConverter::ToC(mem.AsDeviceAddress());\n   if (mem.HasOwnership()) {\n-    const stream_executor::OwningDeviceAddress* owned =\n-        mem.AsOwningDeviceMemory();\n+    const stream_executor::ScopedDeviceAddress<uint8_t>* owned =\n+        mem.AsScopedDeviceAddress();\n     se_mem.device_ordinal = owned->device_ordinal();\n     se_mem.allocator = ApiConverter::ToC(owned->allocator());\n     if (!aliased) {\n@@ -180,15 +180,15 @@ SE_MaybeOwningDeviceMemory ToC(xla::MaybeOwningDeviceMemory& mem,\n   return se_mem;\n }\n \n-xla::MaybeOwningDeviceMemory FromC(\n+xla::MaybeOwningDeviceAddress FromC(\n     SE_MaybeOwningDeviceMemory* se_mem,\n     stream_executor::DeviceAddressAllocator* allocator) {\n   if (se_mem->owned) {\n-    return xla::MaybeOwningDeviceMemory(stream_executor::OwningDeviceAddress(\n+    return xla::MaybeOwningDeviceAddress(stream_executor::OwningDeviceAddress(\n         ApiConverter::FromC(se_mem->memory), se_mem->device_ordinal,\n         allocator));\n   } else {\n-    return xla::MaybeOwningDeviceMemory(ApiConverter::FromC(se_mem->memory));\n+    return xla::MaybeOwningDeviceAddress(ApiConverter::FromC(se_mem->memory));\n   }\n }\n "
        },
        {
            "sha": "da3db36c17a1d235c9a4c93864bcf562d86b7f2c",
            "filename": "third_party/xla/xla/stream_executor/tpu/c_api_conversions.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_conversions.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -28,7 +28,7 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/literal.h\"\n #include \"xla/service/hlo_module_config.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n@@ -117,7 +117,7 @@ struct TpuEmbeddingEngineParametersData {\n \n std::unique_ptr<TpuEmbeddingEngineParametersData> Create(int num_tables);\n \n-xla::MaybeOwningDeviceMemory FromC(\n+xla::MaybeOwningDeviceAddress FromC(\n     SE_MaybeOwningDeviceMemory* se_mem,\n     stream_executor::DeviceAddressAllocator* allocator);\n \n@@ -132,7 +132,8 @@ SE_MaybeOwningDeviceMemory ToC(stream_executor::OwningDeviceAddress* mem);\n // mem.HasOwnership() may be true if the buffer is aliased and shouldn't be\n // released. 'aliased' should be true in this case. 'aliased' has no effect if\n // 'mem' is unowned.\n-SE_MaybeOwningDeviceMemory ToC(xla::MaybeOwningDeviceMemory& mem, bool aliased);\n+SE_MaybeOwningDeviceMemory ToC(xla::MaybeOwningDeviceAddress& mem,\n+                               bool aliased);\n \n // HloModule\n XLA_HloModule ToC(const xla::HloModule& module);"
        },
        {
            "sha": "834a3da9f4ed0d592605299386d12f0f45b8d9e2",
            "filename": "third_party/xla/xla/stream_executor/tpu/c_api_decl.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_decl.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_decl.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Fc_api_decl.h?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -277,18 +277,18 @@ typedef struct XLA_Literal {\n   XLA_Shape shape;\n } XLA_Literal;\n \n-typedef struct XLA_MaybeOwningDeviceMemoryShapeTree {\n+typedef struct XLA_MaybeOwningDeviceAddressShapeTree {\n   XLA_Shape shape;\n   SE_MaybeOwningDeviceMemory* buffers;\n-} XLA_MaybeOwningDeviceMemoryShapeTree;\n+} XLA_MaybeOwningDeviceAddressShapeTree;\n \n typedef struct XLA_ShapeIndex {\n   int64_t indices[8];\n   int64_t count;\n } XLA_ShapeIndex;\n \n typedef struct SE_ExecutionInput {\n-  XLA_MaybeOwningDeviceMemoryShapeTree shape_tree;\n+  XLA_MaybeOwningDeviceAddressShapeTree shape_tree;\n   XLA_ShapeIndex* unowned_indices;\n   int unowned_indices_size;\n   XLA_Shape dynamic_shape;"
        },
        {
            "sha": "ab8616ddc8ecc4ad3a610295d375e921015eafc1",
            "filename": "third_party/xla/xla/stream_executor/tpu/tpu_executable_interface.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Ftpu_executable_interface.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Ftpu_executable_interface.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Ftpu%2Ftpu_executable_interface.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -31,7 +31,7 @@ limitations under the License.\n #include \"xla/layout_util.h\"\n #include \"xla/service/compiler.h\"\n #include \"xla/service/executable.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n@@ -106,7 +106,7 @@ TpuExecutableInterface::AllocateOutputMemoryWithInputReuse(\n           -> absl::Status {\n         if (alias && alias->must_alias()) {\n           VLOG(1) << alias->ToString();\n-          const MaybeOwningDeviceMemory& original_input =\n+          const MaybeOwningDeviceAddress& original_input =\n               (*arguments)[alias->parameter_number].Buffers().element(\n                   alias->parameter_index);\n           if (!original_input.HasOwnership()) {\n@@ -152,7 +152,7 @@ TpuExecutableInterface::AllocateOutputMemoryWithInputReuse(\n     if (alias) {\n       TF_RET_CHECK(alias->parameter_number < arguments->size());\n       ExecutionInput& input = (*arguments)[alias->parameter_number];\n-      MaybeOwningDeviceMemory* device_memory =\n+      MaybeOwningDeviceAddress* device_memory =\n           input.MutableBuffer(alias->parameter_index);\n       if (auto owning = device_memory->Release()) {\n         // If the caller passes the ownership of the device memory, reuse it"
        },
        {
            "sha": "9f617478a6ea7b853d1b9d2bc5658756002d3930",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -520,7 +520,7 @@ xla_test(\n         \"//xla/service:backend\",\n         \"//xla/service:executable\",\n         \"//xla/service:hlo_module_config\",\n-        \"//xla/service:maybe_owning_device_memory\",\n+        \"//xla/service:maybe_owning_device_address\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/stream_executor:device_memory\",\n         \"//xla/stream_executor:device_memory_allocator\","
        },
        {
            "sha": "324917cbd57df684be1831db2ea67534d82c58cd",
            "filename": "third_party/xla/xla/tests/buffer_donation_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Ftests%2Fbuffer_donation_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a3f49eccd20479d5f910b481e15c076c741737db/third_party%2Fxla%2Fxla%2Ftests%2Fbuffer_donation_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fbuffer_donation_test.cc?ref=a3f49eccd20479d5f910b481e15c076c741737db",
            "patch": "@@ -39,7 +39,7 @@ limitations under the License.\n #include \"xla/service/backend.h\"\n #include \"xla/service/executable.h\"\n #include \"xla/service/hlo_module_config.h\"\n-#include \"xla/service/maybe_owning_device_memory.h\"\n+#include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/service_executable_run_options.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/shape.h\"\n@@ -132,10 +132,11 @@ class BufferDonationTest : public HloTestBase {\n           stream.get(), argument_literal, shaped_buffer));\n       ShapeTree<se::DeviceMemoryBase> input_buffers = shaped_buffer.buffers();\n       inputs_buffers.push_back(input_buffers);\n-      ShapeTree<MaybeOwningDeviceMemory> owned_buffers(\n+      ShapeTree<MaybeOwningDeviceAddress> owned_buffers(\n           argument_literal.shape());\n       owned_buffers.ForEachMutableElement(\n-          [&](const ShapeIndex& index, MaybeOwningDeviceMemory* device_memory) {\n+          [&](const ShapeIndex& index,\n+              MaybeOwningDeviceAddress* device_memory) {\n             if (donate_argument) {\n               *device_memory = se::OwningDeviceMemory(\n                   input_buffers.element(index), executor_->device_ordinal(),"
        }
    ],
    "stats": {
        "total": 256,
        "additions": 132,
        "deletions": 124
    }
}