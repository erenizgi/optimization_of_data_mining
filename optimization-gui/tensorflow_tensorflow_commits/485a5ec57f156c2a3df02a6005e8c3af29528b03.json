{
    "author": "chsigg",
    "message": "NFC: Add bounds checks in Triton fusion emitter.\n\nThis change adds checks to ensure that indices used to access `lhs_output_tile_sizes` and `block_level_parameters.output_tile_sizes` are within the valid range, preventing potential out-of-bounds errors.\n\nPiperOrigin-RevId: 830855360",
    "sha": "485a5ec57f156c2a3df02a6005e8c3af29528b03",
    "files": [
        {
            "sha": "b8f8f4df8011e2ed870f941710fa872c19eaf51c",
            "filename": "third_party/xla/xla/backends/gpu/codegen/triton/fusion_emitter.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/485a5ec57f156c2a3df02a6005e8c3af29528b03/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/485a5ec57f156c2a3df02a6005e8c3af29528b03/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ffusion_emitter.cc?ref=485a5ec57f156c2a3df02a6005e8c3af29528b03",
            "patch": "@@ -1601,6 +1601,11 @@ absl::StatusOr<Tiling> TilingFromAnnotatedFusion(\n       dot_tiling_parameters.reserve(num_tiling_parameters);\n       for (int64_t contracting_dim_id :\n            hlo->dot_dimension_numbers().lhs_contracting_dimensions()) {\n+        if (contracting_dim_id >= lhs_output_tile_sizes.size()) {\n+          return absl::FailedPreconditionError(\n+              absl::StrCat(\"Output tile sizes index \", contracting_dim_id,\n+                           \" is out of bounds for \", lhs->ToString()));\n+        }\n         dot_tiling_parameters.push_back(\n             lhs_output_tile_sizes[contracting_dim_id]);\n       }\n@@ -1611,6 +1616,12 @@ absl::StatusOr<Tiling> TilingFromAnnotatedFusion(\n     // TODO(b/390559452): this should change for generalized multi-output\n     // fusions.\n     if (hlo == real_root) {\n+      if (real_root_index >= block_level_parameters.output_tile_sizes.size()) {\n+        return absl::FailedPreconditionError(absl::StrCat(\n+            \"Output tile sizes index \", real_root_index,\n+            \" is out of bounds for block level fusion config: \",\n+            block_level_parameters.ToBlockLevelFusionConfig().DebugString()));\n+      }\n       absl::Span<const int64_t> output_tile_sizes =\n           block_level_parameters.output_tile_sizes[real_root_index];\n       tile_mapping[hlo].insert(tile_mapping[hlo].end(),"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}