{
    "author": "olupton",
    "message": "PR #35339: Improve memory allocation error message\n\nImported from GitHub PR https://github.com/openxla/xla/pull/35339\n\nüìù Summary of Changes\nShow the actual error message when allocator fails, and fix stringification of an enum.\n\nüéØ Justification\nWithout this, the error message is vague.\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nn/a\n\nüß™ Unit Tests:\nn/a\n\nüß™ Execution Tests:\nn/a\nCopybara import of the project:\n\n--\nd0bee7837f1c70a7494acc7e7088d211e554b981 by Olli Lupton <olupton@nvidia.com>:\n\nImprove memory allocation error message\n\nMerging this change closes #35339\n\nPiperOrigin-RevId: 845826162",
    "sha": "24d56183bf16fb2de62d270a6cd36397cc9cdcad",
    "files": [
        {
            "sha": "b6a705673e91f931c8deef180bb839b6abb23a0f",
            "filename": "third_party/xla/xla/stream_executor/cuda/cuda_memory_allocator.h",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/24d56183bf16fb2de62d270a6cd36397cc9cdcad/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_memory_allocator.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/24d56183bf16fb2de62d270a6cd36397cc9cdcad/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_memory_allocator.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fcuda_memory_allocator.h?ref=24d56183bf16fb2de62d270a6cd36397cc9cdcad",
            "patch": "@@ -29,14 +29,14 @@ namespace stream_executor::gpu {\n // A type of memory allocator for kCollective memory space.\n enum class CollectiveAllocatorType { kNccl, kNvshmem };\n \n-template <typename T>\n-void AbslStringify(std::string* str, CollectiveAllocatorType allocator_type) {\n+template <typename Sink>\n+void AbslStringify(Sink& sink, CollectiveAllocatorType allocator_type) {\n   switch (allocator_type) {\n     case CollectiveAllocatorType::kNccl:\n-      *str = \"NCCL\";\n+      sink.Append(\"NCCL\");\n       break;\n     case CollectiveAllocatorType::kNvshmem:\n-      *str = \"NVSHMEM\";\n+      sink.Append(\"NVSHMEM\");\n       break;\n   }\n }"
        },
        {
            "sha": "cf2ad44a4b0b85f87e4c6d801d8f6c4383545f8e",
            "filename": "third_party/xla/xla/stream_executor/integrations/stream_executor_allocator.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/24d56183bf16fb2de62d270a6cd36397cc9cdcad/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Fstream_executor_allocator.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/24d56183bf16fb2de62d270a6cd36397cc9cdcad/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Fstream_executor_allocator.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fintegrations%2Fstream_executor_allocator.cc?ref=24d56183bf16fb2de62d270a6cd36397cc9cdcad",
            "patch": "@@ -65,7 +65,8 @@ void* StreamExecutorAllocator::Alloc(size_t alignment, size_t num_bytes,\n     auto allocation = memory_allocator_->Allocate(num_bytes);\n     if (!allocation.ok()) {\n       LOG(WARNING) << \"could not allocate \" << MemorySpaceToString(memory_type_)\n-                   << \" of size: \" << num_bytes;\n+                   << \" of size: \" << num_bytes << \" (\" << allocation.status()\n+                   << ')';\n       *bytes_received = 0;\n       return nullptr;\n     }"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}