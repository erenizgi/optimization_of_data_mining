{
    "author": "tensorflower-gardener",
    "message": "Merge pull request #99046 from stevemcgregory:fix/gpu-shared-mem-alignment\n\nPiperOrigin-RevId: 803065740",
    "sha": "604991290bc0b0cb87b86f7245583946a16dbf01",
    "files": [
        {
            "sha": "a6cece16d20ddf91536ba82ce8b03af4c2c5b5d6",
            "filename": "tensorflow/core/kernels/concat_lib_gpu_impl.cu.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/604991290bc0b0cb87b86f7245583946a16dbf01/tensorflow%2Fcore%2Fkernels%2Fconcat_lib_gpu_impl.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/604991290bc0b0cb87b86f7245583946a16dbf01/tensorflow%2Fcore%2Fkernels%2Fconcat_lib_gpu_impl.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fconcat_lib_gpu_impl.cu.cc?ref=604991290bc0b0cb87b86f7245583946a16dbf01",
            "patch": "@@ -70,7 +70,10 @@ __global__ void concat_variable_kernel(\n   IntType num_inputs = input_ptr_data.size;\n \n   // verbose declaration needed due to template\n-  GPU_DYNAMIC_SHARED_MEM_DECL(sizeof(T), unsigned char, smem);\n+  constexpr size_t kAlignTI =\n+      (alignof(T) > alignof(IntType)) ? alignof(T) : alignof(IntType);\n+  constexpr size_t kAlign = (kAlignTI < 16) ? 16 : kAlignTI;\n+  GPU_DYNAMIC_SHARED_MEM_DECL(kAlign, unsigned char, smem);\n   IntType* smem_col_scan = reinterpret_cast<IntType*>(smem);\n \n   if (useSmem) {"
        },
        {
            "sha": "b55845bb4e9f6f31a0aa1e81b5524d8ef39ce801",
            "filename": "tensorflow/core/kernels/split_lib_gpu.cu.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/604991290bc0b0cb87b86f7245583946a16dbf01/tensorflow%2Fcore%2Fkernels%2Fsplit_lib_gpu.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/604991290bc0b0cb87b86f7245583946a16dbf01/tensorflow%2Fcore%2Fkernels%2Fsplit_lib_gpu.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fsplit_lib_gpu.cu.cc?ref=604991290bc0b0cb87b86f7245583946a16dbf01",
            "patch": "@@ -120,7 +120,10 @@ __global__ void split_v_kernel(const T* __restrict__ input_ptr,\n   int num_outputs = output_ptr_data.size;\n \n   // verbose declaration needed due to template\n-  GPU_DYNAMIC_SHARED_MEM_DECL(sizeof(T), unsigned char, smem);\n+  constexpr size_t kAlignTI =\n+      (alignof(T) > alignof(IntType)) ? alignof(T) : alignof(IntType);\n+  constexpr size_t kAlign = (kAlignTI < 16) ? 16 : kAlignTI;\n+  GPU_DYNAMIC_SHARED_MEM_DECL(kAlign, unsigned char, smem);\n   IntType* smem_col_scan = reinterpret_cast<IntType*>(smem);\n \n   if (useSmem) {"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 8,
        "deletions": 2
    }
}