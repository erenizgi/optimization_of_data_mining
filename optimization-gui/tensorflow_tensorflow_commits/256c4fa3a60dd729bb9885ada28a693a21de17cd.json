{
    "author": "seherellis",
    "message": "[XLA:LHS] Fix minor issues:\n- `computed_memory_increases` should be initialized to false.\n- `ready_chosen_orig` and `ready_candidate_orig` do not have `has_pressure_change` set, because `MaybeUpdate` will modify `ready_chosen` and `ready_candidate`. We should use those instead. No need to save the originals.\n- Remove `unused` field in `ScheduleCandidate`. It is unused.\n\nPiperOrigin-RevId: 836300485",
    "sha": "256c4fa3a60dd729bb9885ada28a693a21de17cd",
    "files": [
        {
            "sha": "922084a5c4cc4425361498367ee70a3db6c3b10a",
            "filename": "third_party/xla/xla/service/latency_hiding_scheduler.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 17,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/256c4fa3a60dd729bb9885ada28a693a21de17cd/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/256c4fa3a60dd729bb9885ada28a693a21de17cd/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc?ref=256c4fa3a60dd729bb9885ada28a693a21de17cd",
            "patch": "@@ -1307,7 +1307,7 @@ class ReadySetLt {\n \n     std::pair<int64_t, int64_t> a_increase = {0, 0};\n     std::pair<int64_t, int64_t> b_increase = {0, 0};\n-    bool computed_memory_increases = true;\n+    bool computed_memory_increases = false;\n     if (config_has_memory_limit_ &&\n         sched_state_.memory_pressure_tracker->memory_usage() >\n             (config_memory_limit_ / 2)) {\n@@ -1665,9 +1665,7 @@ DefaultSchedulerCore::FindAndExtractBestNodeAvailable(\n                         early_target_scheduling_rule_};\n     // Construct a schedule candidate for caching.\n     ScheduleCandidate ready_chosen;\n-    ScheduleCandidate ready_chosen_orig;\n     bool ready_chosen_valid = false;\n-    ScheduleCandidate ready_candidate_orig;\n     auto chosen_it = sched_state.ready_set.end();\n \n     // Try to pick nodes from the ready set first that are the ones that cause\n@@ -1744,10 +1742,6 @@ DefaultSchedulerCore::FindAndExtractBestNodeAvailable(\n         continue;\n       }\n \n-      if (ABSL_PREDICT_FALSE(vlog_2)) {\n-        ready_chosen_orig = ready_chosen;\n-        ready_candidate_orig = ready_candidate;\n-      }\n       const char* reason;\n       bool new_candidate_selected =\n           ready_lt.MaybeUpdate(ready_candidate, ready_chosen, &reason);\n@@ -1761,20 +1755,18 @@ DefaultSchedulerCore::FindAndExtractBestNodeAvailable(\n             };\n         VLOG(2) << \"Choosing from ready (\"\n                 << (new_candidate_selected\n-                        ? ready_candidate_orig.node->GetInstr().name()\n-                        : ready_chosen_orig.node->GetInstr().name())\n+                        ? ready_candidate.node->GetInstr().name()\n+                        : ready_chosen.node->GetInstr().name())\n                 << \") vs (\"\n                 << (new_candidate_selected\n-                        ? ready_chosen_orig.node->GetInstr().name()\n-                        : ready_candidate_orig.node->GetInstr().name())\n+                        ? ready_chosen.node->GetInstr().name()\n+                        : ready_candidate.node->GetInstr().name())\n                 << \") Reason: \" << reason << \" mem pressure chosen \"\n-                << print_pressure_change(new_candidate_selected\n-                                             ? ready_candidate_orig\n-                                             : ready_chosen_orig)\n+                << print_pressure_change(\n+                       new_candidate_selected ? ready_candidate : ready_chosen)\n                 << \" mem pressure other \"\n-                << print_pressure_change(new_candidate_selected\n-                                             ? ready_chosen_orig\n-                                             : ready_candidate_orig);\n+                << print_pressure_change(\n+                       new_candidate_selected ? ready_chosen : ready_candidate);\n       }\n \n       if (new_candidate_selected) {"
        },
        {
            "sha": "01630bbaa5bf5e89abe824b350daa2d09bddb187",
            "filename": "third_party/xla/xla/service/latency_hiding_scheduler.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/256c4fa3a60dd729bb9885ada28a693a21de17cd/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/256c4fa3a60dd729bb9885ada28a693a21de17cd/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.h?ref=256c4fa3a60dd729bb9885ada28a693a21de17cd",
            "patch": "@@ -1530,7 +1530,6 @@ class DefaultSchedulerCore : public SchedulerCore {\n     bool has_pressure_change = false;\n     bool has_estimated_connected_send_ready_time = false;\n     bool has_resource_constrained = false;\n-    bool unused = false;\n \n     int64_t pressure_change_first;\n     int64_t pressure_change_second;"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 9,
        "deletions": 18
    }
}