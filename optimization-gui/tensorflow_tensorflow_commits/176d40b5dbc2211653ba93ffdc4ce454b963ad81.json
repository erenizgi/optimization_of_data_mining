{
    "author": "sfvaroglu",
    "message": "PR #34707: Preserve existing backend config in WhileLoopTripCountAnnotator\n\nImported from GitHub PR https://github.com/openxla/xla/pull/34707\n\nüìù Summary of Changes\nThis PR fixes a bug in WhileLoopTripCountAnnotator where it would overwrite the entire WhileLoopBackendConfig, causing loss of data set by previous passes.\n\nüéØ Justification\nPreviously, WhileLoopTripCountAnnotator would overwrite the entire WhileLoopBackendConfig when setting trip count and induction variable information. This caused loss of any previously set backend config data.\n\nThis change preserves existing backend config fields by reading the current config first before adding new trip count annotations. This is important for passes that set backend config before this annotator runs, such as CollectivePipeliner which may set dynamic variable information.\n\nWithout this fix, dynamic variable tuple indices would be lost, breaking optimizations like FusionDynamicMemcpyRewriter that depend on this data.\n\nüöÄ Kind of Contribution\n üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nN/A (split from https://github.com/openxla/xla/pull/32297)\n\nüß™ Unit Tests:\nN/A (split from https://github.com/openxla/xla/pull/32297)\n\nüß™ Execution Tests:\nN/A (split from https://github.com/openxla/xla/pull/32297)\n\nCopybara import of the project:\n\n--\nd1daf802efa79e49a747948c802c5c6305c601fd by Sevin Varoglu <svaroglu@nvidia.com>:\n\nPreserve existing backend config in WhileLoopTripCountAnnotator\n\nMerging this change closes #34707\n\nPiperOrigin-RevId: 840292778",
    "sha": "176d40b5dbc2211653ba93ffdc4ce454b963ad81",
    "files": [
        {
            "sha": "1236d24a48c0492a8851bf5e5c8bc91bcd31c2c5",
            "filename": "third_party/xla/xla/hlo/transforms/while_loop_trip_count_annotator.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/176d40b5dbc2211653ba93ffdc4ce454b963ad81/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fwhile_loop_trip_count_annotator.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/176d40b5dbc2211653ba93ffdc4ce454b963ad81/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fwhile_loop_trip_count_annotator.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fwhile_loop_trip_count_annotator.cc?ref=176d40b5dbc2211653ba93ffdc4ce454b963ad81",
            "patch": "@@ -44,6 +44,13 @@ absl::StatusOr<bool> WhileLoopTripCountAnnotator::RunImpl(\n         // The following analyses all need the induction variable index.\n         WhileLoopBackendConfig config;\n \n+        // Preserve existing backend config data\n+        if (auto existing_config =\n+                instr->backend_config<WhileLoopBackendConfig>();\n+            existing_config.ok()) {\n+          config = *existing_config;\n+        }\n+\n         config.mutable_known_induction_variable()->set_tuple_index(\n             *induction_variable_index);\n         if (auto range = MatchTrivialLoopRange(instr);"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}