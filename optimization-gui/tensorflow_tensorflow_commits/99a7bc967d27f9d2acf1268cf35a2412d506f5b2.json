{
    "author": "nvgrw",
    "message": "BufferValue::SizeFunction should be AnyInvocable\n\nSizeFunction is often passed around with std::move, but rarely if ever can it\nactally be 'moved'. We can't use move captures with the old definition of\nSizeFunction and therefore have to use clever workarounds for lifetime issues\nwith reference captures. This patch aims to change this once and for all. While\nthe size function can still be passed around by reference/pointer, we explicitly\nforbid copies to allow real moves.\n\nPiperOrigin-RevId: 814730267",
    "sha": "99a7bc967d27f9d2acf1268cf35a2412d506f5b2",
    "files": [
        {
            "sha": "3f2ea9e52290ff9ac5088399b853064ab886c1ac",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/99a7bc967d27f9d2acf1268cf35a2412d506f5b2/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/99a7bc967d27f9d2acf1268cf35a2412d506f5b2/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=99a7bc967d27f9d2acf1268cf35a2412d506f5b2",
            "patch": "@@ -3473,6 +3473,7 @@ cc_library(\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/hlo/ir:hlo\",\n         \"@com_google_absl//absl/base:core_headers\",\n+        \"@com_google_absl//absl/functional:any_invocable\",\n         \"@com_google_absl//absl/log:check\",\n     ],\n )"
        },
        {
            "sha": "a1bdc14d190020ec7cd09918160d3ba5c2174308",
            "filename": "third_party/xla/xla/service/buffer_value.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/99a7bc967d27f9d2acf1268cf35a2412d506f5b2/third_party%2Fxla%2Fxla%2Fservice%2Fbuffer_value.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/99a7bc967d27f9d2acf1268cf35a2412d506f5b2/third_party%2Fxla%2Fxla%2Fservice%2Fbuffer_value.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fbuffer_value.h?ref=99a7bc967d27f9d2acf1268cf35a2412d506f5b2",
            "patch": "@@ -22,6 +22,7 @@ limitations under the License.\n #include <string>\n \n #include \"absl/base/attributes.h\"\n+#include \"absl/functional/any_invocable.h\"\n #include \"absl/log/check.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/service/hlo.pb.h\"\n@@ -92,7 +93,7 @@ class BufferValue {\n   using Id = int64_t;\n \n   // Functions which return the size and alignment of a logical buffer in bytes.\n-  using SizeFunction = std::function<int64_t(const BufferValue&)>;\n+  using SizeFunction = absl::AnyInvocable<int64_t(const BufferValue&) const>;\n   using AlignmentFunction = std::function<int64_t(BufferValue::Color)>;\n \n   // Prevent value being copied, allowing comparison by pointer,"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 3,
        "deletions": 1
    }
}