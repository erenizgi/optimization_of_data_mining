{
    "author": "beckerhe",
    "message": "Remove HloProfilePrinterData and HloProfileIndexMap from Executable.\n\nThis change removes the HloProfilePrinterData and HloProfileIndexMap members from the Executable base class and updates all derived classes and call sites to reflect this change. The profiling data is no longer stored within the Executable.\n\nPiperOrigin-RevId: 841638347",
    "sha": "ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
    "files": [
        {
            "sha": "7ba92f41d877015cdba2998326b593658501d45f",
            "filename": "third_party/xla/xla/backends/interpreter/executable_base.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Finterpreter%2Fexecutable_base.cc?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -55,8 +55,7 @@ namespace interpreter {\n \n InterpreterExecutableBase::InterpreterExecutableBase(\n     std::unique_ptr<HloModule> hlo_module)\n-    : Executable(std::move(hlo_module), /*hlo_profile_printer_data=*/nullptr,\n-                 /*hlo_profile_index_map=*/nullptr) {}\n+    : Executable(std::move(hlo_module)) {}\n \n absl::StatusOr<ExecutionOutput> InterpreterExecutableBase::ExecuteAsyncOnStream(\n     const ServiceExecutableRunOptions* run_options,"
        },
        {
            "sha": "fb4b60aedea3f15041270ed1ef82cc0995d1b9f5",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -1526,7 +1526,6 @@ cc_library(\n     deps = [\n         \":buffer_assignment\",\n         \":computation_layout\",\n-        \":hlo_execution_profile\",\n         \":hlo_module_config\",\n         \":hlo_proto_cc\",\n         \":maybe_owning_device_memory\","
        },
        {
            "sha": "31ca1d590cd2925b508bb6d2fdfba0c5d6ebd91c",
            "filename": "third_party/xla/xla/service/cpu/cpu_aot_compilation_result.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.cc?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -196,8 +196,8 @@ CpuAotCompilationResult::LoadExecutable(\n       cpu_executable,\n       CpuExecutable::Create(std::move(function_library_),\n                             std::move(buffer_assignment), std::move(module),\n-                            std::move(*thunks), std::move(constants), nullptr,\n-                            nullptr, target_machine_options));\n+                            std::move(*thunks), std::move(constants),\n+                            target_machine_options));\n \n   // Dump computation proto state and buffer assignment for\n   // GetCompiledMemoryStats results."
        },
        {
            "sha": "4817200999814f58af540be31727a3d454d8c54e",
            "filename": "third_party/xla/xla/service/cpu/cpu_aot_compilation_result.h",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_aot_compilation_result.h?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -110,24 +110,6 @@ class CpuAotCompilationResult : public AotCompilationResult {\n       TargetMachineOptionsProto target_machine_options =\n           TargetMachineOptionsProto());\n \n-  [[deprecated(\n-      \"HloProfilePrinterData is not used anymore. Use the other Create \"\n-      \"method instead.\")]] static absl::\n-      StatusOr<std::unique_ptr<CpuAotCompilationResult>>\n-      Create(const HloModule* hlo_module,\n-             const BufferAssignment* buffer_assignment,\n-             absl::string_view function_name,\n-             std::vector<ObjFileProto> obj_files,\n-             std::vector<SymbolProto> symbols, const ThunkSequence& thunks,\n-             std::unique_ptr<FunctionLibrary> function_library,\n-             std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-             TargetMachineOptionsProto target_machine_options =\n-                 TargetMachineOptionsProto()) {\n-    return Create(hlo_module, buffer_assignment, function_name,\n-                  std::move(obj_files), std::move(symbols), thunks,\n-                  std::move(function_library), target_machine_options);\n-  }\n-\n   ~CpuAotCompilationResult() override = default;\n \n   absl::StatusOr<std::string> SerializeAsString() const override {"
        },
        {
            "sha": "a6117a8169ddc310b47f94e38d7931847bc867d5",
            "filename": "third_party/xla/xla/service/cpu/cpu_compiler.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 19,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_compiler.cc?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -2019,11 +2019,10 @@ CpuCompiler::CompileCpuExecutable(\n \n   TF_ASSIGN_OR_RETURN(\n       auto cpu_executable,\n-      CpuExecutable::Create(\n-          std::move(function_library), std::move(assignment), std::move(module),\n-          std::move(thunks), std::move(constants),\n-          std::move(hlo_profile_printer_data), std::move(hlo_profile_index_map),\n-          std::move(target_machine_options)));\n+      CpuExecutable::Create(std::move(function_library), std::move(assignment),\n+                            std::move(module), std::move(thunks),\n+                            std::move(constants),\n+                            std::move(target_machine_options)));\n \n   // Save object files to be able to export them to AOT compilation\n   // result.\n@@ -2243,12 +2242,6 @@ CpuCompiler::CompileAheadOfTimeThunks(\n   const ThunkSequence& thunk_sequence =\n       cpu_executable->thunks().thunk_sequence();\n \n-  std::unique_ptr<HloProfilePrinterData> executable_hlo_profile_printer_data =\n-      cpu_executable->module().config().hlo_profiling_enabled()\n-          ? std::make_unique<HloProfilePrinterData>(\n-                cpu_executable->hlo_profile_printer_data())\n-          : nullptr;\n-\n   if (cpu_executable->obj_files().size() > 1) {\n     return Internal(\n         \"Expected at most one object file for AOT compilation, but got %d\",\n@@ -2266,7 +2259,6 @@ CpuCompiler::CompileAheadOfTimeThunks(\n       cpu_executable->module_name(), std::move(obj_files),\n       cpu_executable->get_compiled_symbols_proto(), thunk_sequence,\n       std::move(*cpu_executable).consume_function_library(),\n-      std::move(executable_hlo_profile_printer_data),\n       cpu_executable->target_machine_options().ToProto());\n }\n \n@@ -2299,12 +2291,6 @@ absl::StatusOr<std::unique_ptr<AotCompilationResult>> CpuCompiler::Export(\n   std::vector<SymbolProto> compiled_symbols_proto =\n       cpu_executable->get_compiled_symbols_proto();\n \n-  std::unique_ptr<HloProfilePrinterData> executable_hlo_profile_printer_data =\n-      cpu_executable->module().config().hlo_profiling_enabled()\n-          ? std::make_unique<HloProfilePrinterData>(\n-                cpu_executable->hlo_profile_printer_data())\n-          : nullptr;\n-\n   TF_ASSIGN_OR_RETURN(auto compiled_symbols,\n                       GetCompiledSymbolsFromProto(compiled_symbols_proto));\n \n@@ -2319,7 +2305,6 @@ absl::StatusOr<std::unique_ptr<AotCompilationResult>> CpuCompiler::Export(\n       cpu_executable->module_name(), std::move(obj_files),\n       std::move(compiled_symbols_proto), *thunk_sequence,\n       std::move(function_library),\n-      std::move(executable_hlo_profile_printer_data),\n       cpu_executable->target_machine_options().ToProto());\n }\n "
        },
        {
            "sha": "6bb3a695e9523e8a416eab82e4b5e79884e33f8c",
            "filename": "third_party/xla/xla/service/cpu/cpu_executable.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 14,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.cc?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -88,16 +88,13 @@ absl::StatusOr<std::unique_ptr<CpuExecutable>> CpuExecutable::Create(\n     std::unique_ptr<BufferAssignment> assignment,\n     std::unique_ptr<HloModule> hlo_module, ThunkSequence thunks,\n     std::vector<ConstantAllocation> constants,\n-    std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-    std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map,\n     TargetMachineOptions target_machine_options) {\n   VLOG(2) << \"Create CpuExecutable from a thunk sequence; module=\"\n           << hlo_module->name() << \", constants=\" << constants.size();\n \n-  std::unique_ptr<CpuExecutable> executable(new CpuExecutable(\n-      std::move(hlo_module), std::move(hlo_profile_printer_data),\n-      std::move(hlo_profile_index_map), std::move(assignment),\n-      std::move(target_machine_options)));\n+  std::unique_ptr<CpuExecutable> executable(\n+      new CpuExecutable(std::move(hlo_module), std::move(assignment),\n+                        std::move(target_machine_options)));\n   executable->function_library_ = std::move(function_library);\n \n   ThunkExecutor::Options thunk_executor_options;\n@@ -129,14 +126,10 @@ absl::StatusOr<std::unique_ptr<CpuExecutable>> CpuExecutable::Create(\n   return executable;\n }\n \n-CpuExecutable::CpuExecutable(\n-    std::unique_ptr<HloModule> hlo_module,\n-    std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-    std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map,\n-    std::unique_ptr<BufferAssignment> assignment,\n-    TargetMachineOptions target_machine_options)\n-    : Executable(std::move(hlo_module), std::move(hlo_profile_printer_data),\n-                 std::move(hlo_profile_index_map)),\n+CpuExecutable::CpuExecutable(std::unique_ptr<HloModule> hlo_module,\n+                             std::unique_ptr<BufferAssignment> assignment,\n+                             TargetMachineOptions target_machine_options)\n+    : Executable(std::move(hlo_module)),\n       assignment_(std::move(assignment)),\n       target_machine_options_(std::move(target_machine_options)) {\n   if (assignment_ && has_module()) {"
        },
        {
            "sha": "ebb97baf217e47ae1ff6f682d8a6f55827f2e77f",
            "filename": "third_party/xla/xla/service/cpu/cpu_executable.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fcpu_executable.h?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -62,8 +62,6 @@ class CpuExecutable : public Executable {\n       std::unique_ptr<BufferAssignment> assignment,\n       std::unique_ptr<HloModule> hlo_module, ThunkSequence thunks,\n       std::vector<ConstantAllocation> constants,\n-      std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-      std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map,\n       TargetMachineOptions target_machine_options);\n \n   ~CpuExecutable() override;\n@@ -246,8 +244,6 @@ class CpuExecutable : public Executable {\n   std::string entry_function_name_;\n \n   CpuExecutable(std::unique_ptr<HloModule> hlo_module,\n-                std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-                std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map,\n                 std::unique_ptr<BufferAssignment> assignment,\n                 TargetMachineOptions target_machine_options);\n   CpuExecutable(const CpuExecutable&) = delete;"
        },
        {
            "sha": "e59ac39a932d44aa1702f97d9dd39e68aeb3d74c",
            "filename": "third_party/xla/xla/service/executable.h",
            "status": "modified",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ea054af52030b0d5af9e5b5dfd66c5d853affa7f/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fexecutable.h?ref=ea054af52030b0d5af9e5b5dfd66c5d853affa7f",
            "patch": "@@ -18,7 +18,6 @@ limitations under the License.\n \n #include <cstdint>\n #include <memory>\n-#include <string>\n #include <utility>\n #include <vector>\n \n@@ -37,7 +36,6 @@ limitations under the License.\n #include \"xla/service/buffer_assignment.h\"\n #include \"xla/service/computation_layout.h\"\n #include \"xla/service/hlo.pb.h\"\n-#include \"xla/service/hlo_execution_profile.h\"\n #include \"xla/service/hlo_module_config.h\"\n #include \"xla/service/maybe_owning_device_memory.h\"\n #include \"xla/service/service_executable_run_options.h\"\n@@ -265,20 +263,6 @@ class Executable {\n   // doesn't need it for execution.\n   explicit Executable(std::shared_ptr<HloModule> hlo_module)\n       : hlo_module_(std::move(hlo_module)) {}\n-\n-  // TODO(b/172012028): Remove this constructor.\n-  // The hlo_module parameter may be nullptr, if the given executable type\n-  // doesn't need it for execution.\n-  explicit Executable(\n-      std::shared_ptr<HloModule> hlo_module,\n-      std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data,\n-      std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map)\n-      : hlo_module_(std::move(hlo_module)),\n-        hlo_profile_printer_data_(std::move(hlo_profile_printer_data)),\n-        hlo_profile_index_map_(std::move(hlo_profile_index_map)) {\n-    CHECK_EQ(hlo_profile_printer_data_.get() == nullptr,\n-             hlo_profile_index_map_.get() == nullptr);\n-  }\n   virtual ~Executable() = default;\n \n   // Enqueues the compilation result on the provided stream, passing the given\n@@ -344,22 +328,6 @@ class Executable {\n       const ServiceExecutableRunOptions* run_options,\n       std::vector<ExecutionInput> arguments);\n \n-  const HloProfilePrinterData& hlo_profile_printer_data() const {\n-    CHECK(hlo_profiling_enabled());\n-    return *hlo_profile_printer_data_;\n-  }\n-\n-  const HloProfileIndexMap& hlo_profile_index_map() const {\n-    CHECK(hlo_profiling_enabled());\n-    return *hlo_profile_index_map_;\n-  }\n-\n-  // Returns whether this executable was compiled with HLO profilings support\n-  // enabled. If not, the caller should not expect an hlo_execution_profile\n-  // passed to ExecuteOnStream above to be populated during execution.\n-  bool hlo_profiling_enabled() const {\n-    return hlo_profile_printer_data_ != nullptr;\n-  }\n \n   HloModule& module() const {\n     CHECK(hlo_module_ != nullptr);\n@@ -477,9 +445,6 @@ class Executable {\n   // execution.\n   int64_t execution_count_ = 0;\n \n-  std::unique_ptr<HloProfilePrinterData> hlo_profile_printer_data_;\n-  std::unique_ptr<HloProfileIndexMap> hlo_profile_index_map_;\n-\n   // A map from kernel name to relevant kernel stats.\n   ModuleStats module_stats_;\n "
        }
    ],
    "stats": {
        "total": 109,
        "additions": 14,
        "deletions": 95
    }
}