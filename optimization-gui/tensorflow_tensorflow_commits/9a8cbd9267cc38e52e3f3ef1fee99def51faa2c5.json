{
    "author": "seantalts",
    "message": "[XLA:CPU] Compile Eigen to LLVM IR.\n\n<details>\n\n<summary>Expand for generated LLVM IR</summary>\n\n```\ndefine noundef <4 x float> @_ZN3xla7codegen9FastTanhfEDv4_f(<4 x float> noundef %0) local_unnamed_addr #0 {\n  %2 = tail call noundef <4 x float> @llvm.x86.sse.min.ps(<4 x float> splat (float 0x401FA12AC0000000), <4 x float> %0)\n  %3 = tail call noundef <4 x float> @llvm.x86.sse.max.ps(<4 x float> splat (float 0xC01FA12AC0000000), <4 x float> %2)\n  %4 = fmul <4 x float> %3, %3\n  %5 = fmul <4 x float> %3, %4\n  %6 = fmul <4 x float> %4, splat (float 0x3E4DF2A3C0000000)\n  %7 = fadd <4 x float> %6, splat (float 0x3EF60C7B80000000)\n  %8 = fmul <4 x float> %4, %7\n  %9 = fadd <4 x float> %8, splat (float 0x3F6CD78FE0000000)\n  %10 = fmul <4 x float> %4, %9\n  %11 = fadd <4 x float> %10, splat (float 0x3FC1279EC0000000)\n  %12 = fmul <4 x float> %4, splat (float 0x3EAAE58000000000)\n  %13 = fadd <4 x float> %12, splat (float 0x3F35CDB2C0000000)\n  %14 = fmul <4 x float> %4, %13\n  %15 = fadd <4 x float> %14, splat (float 0x3F9A988C00000000)\n  %16 = fmul <4 x float> %4, %15\n  %17 = fadd <4 x float> %16, splat (float 0x3FDDE92440000000)\n  %18 = fmul <4 x float> %4, %17\n  %19 = fadd <4 x float> %18, splat (float 1.000000e+00)\n  %20 = fmul <4 x float> %5, %11\n  %21 = fadd <4 x float> %3, %20\n  %22 = fdiv <4 x float> %21, %19\n  ret <4 x float> %22\n}\n```\n\n</details>\n\nPiperOrigin-RevId: 814631127",
    "sha": "9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
    "files": [
        {
            "sha": "ddd8ab06e6ae62d9705e3768fa68359fdc684b78",
            "filename": "third_party/xla/xla/codegen/intrinsic/cpp/BUILD",
            "status": "modified",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2FBUILD?ref=9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
            "patch": "@@ -75,3 +75,50 @@ xla_cc_test(\n         \"@local_tsl//tsl/platform:test\",\n     ],\n )\n+\n+cc_library(\n+    name = \"eigen_unary\",\n+    srcs = [\"eigen_unary.cc\"],\n+    hdrs = [\"eigen_unary.h\"],\n+    deps = [\n+        \":vector_ops\",\n+        \"@eigen_archive//:eigen3\",\n+    ],\n+)\n+\n+cc_to_llvm_ir(\n+    name = \"eigen_unary_ir_file\",\n+    src = \"eigen_unary.cc\",\n+    out = \"eigen_unary.ll\",\n+    deps = [\n+        \":cpp_context_provider\",\n+        \":eigen_unary\",\n+    ],\n+)\n+\n+cc_library(\n+    name = \"eigen_unary_ll_header_lib\",\n+    hdrs = [\":eigen_unary_ll_header\"],\n+)\n+\n+genrule(\n+    name = \"eigen_unary_ll_header\",\n+    srcs = [\":eigen_unary_ir_file\"],\n+    outs = [\"eigen_unary_ll.h\"],\n+    cmd = \"\"\"\n+        echo 'constexpr const char* eigen_unary_ir_string = R\"gen_ir(' > $@ && \\\\\n+        cat $(location :eigen_unary_ir_file) >> $@ && \\\\\n+        echo ')gen_ir\";' >> $@\n+    \"\"\",\n+)\n+\n+xla_cc_test(\n+    name = \"eigen_unary_test\",\n+    srcs = [\"eigen_unary_test.cc\"],\n+    deps = [\n+        \":eigen_unary\",\n+        \":eigen_unary_ll_header_lib\",\n+        \"@com_google_googletest//:gtest_main\",\n+        \"@eigen_archive//:eigen3\",\n+    ],\n+)"
        },
        {
            "sha": "41f09ef3ac137c919a93c2423ed32182f3366200",
            "filename": "third_party/xla/xla/codegen/intrinsic/cpp/cc_to_llvm_ir.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Fcc_to_llvm_ir.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Fcc_to_llvm_ir.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Fcc_to_llvm_ir.bzl?ref=9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
            "patch": "@@ -29,7 +29,7 @@ def _cc_to_llvm_ir_impl(ctx):\n             \"-S\",\n             \"-emit-llvm\",\n         ],\n-        name = \"cc_to_llvm_ir\",\n+        name = ctx.label.name,\n         compilation_contexts = dep_compilation_contexts,\n     )\n "
        },
        {
            "sha": "9ea71f8862a4a49a6f2fa17be1e2f6f3b00f4496",
            "filename": "third_party/xla/xla/codegen/intrinsic/cpp/eigen_unary.cc",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.cc?ref=9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
            "patch": "@@ -0,0 +1,30 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/codegen/intrinsic/cpp/eigen_unary.h\"\n+\n+#include \"Eigen/Core\"\n+#include \"xla/codegen/intrinsic/cpp/vector_ops.h\"\n+\n+namespace xla::codegen {\n+\n+Vec4f FastTanhf(const Vec4f x) {\n+  Eigen::Map<const Eigen::Array4f> eigen_view(\n+      reinterpret_cast<const float*>(&x));\n+  Eigen::Array4f result_array = eigen_view.tanh();\n+  return *reinterpret_cast<Vec4f*>(&result_array);\n+}\n+\n+}  // namespace xla::codegen"
        },
        {
            "sha": "bf5ef161f9a0c4359fe49691090b6a3e684f64c9",
            "filename": "third_party/xla/xla/codegen/intrinsic/cpp/eigen_unary.h",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary.h?ref=9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
            "patch": "@@ -0,0 +1,26 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+#ifndef XLA_CODEGEN_INTRINSIC_CPP_EIGEN_UNARY_H_\n+#define XLA_CODEGEN_INTRINSIC_CPP_EIGEN_UNARY_H_\n+\n+#include \"xla/codegen/intrinsic/cpp/vector_ops.h\"\n+\n+namespace xla::codegen {\n+\n+Vec4f FastTanhf(Vec4f x);\n+\n+}  // namespace xla::codegen\n+\n+#endif  // XLA_CODEGEN_INTRINSIC_CPP_EIGEN_UNARY_H_"
        },
        {
            "sha": "88a267d269db8410de037348e828e9baf14a6b0e",
            "filename": "third_party/xla/xla/codegen/intrinsic/cpp/eigen_unary_test.cc",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fintrinsic%2Fcpp%2Feigen_unary_test.cc?ref=9a8cbd9267cc38e52e3f3ef1fee99def51faa2c5",
            "patch": "@@ -0,0 +1,32 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+#include <string>\n+\n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n+#include \"xla/codegen/intrinsic/cpp/eigen_unary_ll.h\"\n+\n+namespace xla::codegen {\n+namespace {\n+using ::testing::ContainsRegex;\n+\n+TEST(EigenUnaryTest, FastTanhfIsVectorized) {\n+  std::string ir = eigen_unary_ir_string;\n+  EXPECT_THAT(ir, ContainsRegex(\"fmul <4 x float>\"));\n+  EXPECT_THAT(ir, ContainsRegex(\"<4 x float>.*0x3E4DF2A3C0000000\"));\n+}\n+\n+}  // namespace\n+}  // namespace xla::codegen"
        }
    ],
    "stats": {
        "total": 137,
        "additions": 136,
        "deletions": 1
    }
}