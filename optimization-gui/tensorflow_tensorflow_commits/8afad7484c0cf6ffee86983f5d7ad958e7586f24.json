{
    "author": "ezhulenev",
    "message": "[xla:pjrt] Migrate PjRt C API client to PjRtFuture::MakePromise()\n\nPiperOrigin-RevId: 803892813",
    "sha": "8afad7484c0cf6ffee86983f5d7ad958e7586f24",
    "files": [
        {
            "sha": "7945c3cf0037a3523badf297b15b7859b996cb2d",
            "filename": "third_party/xla/xla/pjrt/pjrt_c_api_client.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8afad7484c0cf6ffee86983f5d7ad958e7586f24/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8afad7484c0cf6ffee86983f5d7ad958e7586f24/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.cc?ref=8afad7484c0cf6ffee86983f5d7ad958e7586f24",
            "patch": "@@ -2652,11 +2652,13 @@ void PjRtCApiBuffer::MakePromiseTrackEvent() {\n \n PjRtFuture<> PjRtCApiBuffer::GetReadyFuture() {\n   if (readiness_promise_ == nullptr) {\n+    auto [promise, future] = PjRtFuture<>::MakePromise();\n     readiness_promise_ =\n-        std::make_shared<PjRtFuture<>::Promise>(PjRtFuture<>::CreatePromise());\n+        std::make_shared<PjRtFuture<>::Promise>(std::move(promise));\n+    readiness_future_ = std::move(future);\n     MakePromiseTrackEvent();\n   }\n-  return PjRtFuture<>{*readiness_promise_};\n+  return readiness_future_;\n }\n \n absl::StatusOr<std::unique_ptr<PjRtBuffer::ExternalReference>>"
        },
        {
            "sha": "203485d44f442d5881549afdd97a93a785412e0a",
            "filename": "third_party/xla/xla/pjrt/pjrt_c_api_client.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8afad7484c0cf6ffee86983f5d7ad958e7586f24/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8afad7484c0cf6ffee86983f5d7ad958e7586f24/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fpjrt_c_api_client.h?ref=8afad7484c0cf6ffee86983f5d7ad958e7586f24",
            "patch": "@@ -514,6 +514,8 @@ class PjRtCApiBuffer : public PjRtBuffer {\n   // `readiness_promise` is destroyed before `readiness_event`, and the callback\n   // we set on `readiness_event` modifies `readiness_promise_`.\n   std::shared_ptr<PjRtFuture<>::Promise> readiness_promise_;\n+  // Future tied to the `readiness_promise_`.\n+  PjRtFuture<> readiness_future_;\n   // Set and cached the first time layout() is called.\n   mutable std::shared_ptr<const PjRtLayout> layout_;\n   // Set and cached the first time is_dynamic_dimension() is called."
        }
    ],
    "stats": {
        "total": 8,
        "additions": 6,
        "deletions": 2
    }
}