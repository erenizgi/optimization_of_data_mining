{
    "author": "hyeontaek",
    "message": "[IFRT] Remove `UserContext::Fingerprint()`\n\nThe fingerprinting of `xla::ifrt::UserContext` is no longer required and is\nremoved in this change. The implementations of `UserContext::Id()` inline\nfingerprintting (which is still allowed) or migrated to use a random number\ngenerated at `UserContext` instance construction time for fast ID generation\n(notably `jax::PyUserContext`).\n\nPiperOrigin-RevId: 809161796",
    "sha": "a61d8f61b240faa497481582760affa49c721e35",
    "files": [
        {
            "sha": "2dcafddd744b4d45d8fbeaffe7fedb2910df5566",
            "filename": "third_party/xla/xla/python/ifrt/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2FBUILD?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -1110,7 +1110,6 @@ cc_library(\n     deps = [\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/lib/gtl:int_type\",\n-        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:no_destructor\",\n         \"@com_google_absl//absl/base:nullability\",\n@@ -1119,7 +1118,6 @@ cc_library(\n         \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/types:span\",\n         \"@llvm-project//llvm:Support\",\n-        \"@local_tsl//tsl/platform:fingerprint\",\n         \"@local_tsl//tsl/platform:random\",\n     ],\n )"
        },
        {
            "sha": "917b52ced947a71dccfa58b44a2be958658f6005",
            "filename": "third_party/xla/xla/python/ifrt/array_impl_test_lib.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 16,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -106,7 +106,7 @@ TEST(ArrayImplTest, MakeArrayFromHostBuffer) {\n   EXPECT_EQ(array->dtype(), dtype);\n   EXPECT_EQ(array->shape(), shape);\n   EXPECT_EQ(array->shared_ptr_sharding().get(), sharding.get());\n-  EXPECT_EQ(array->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(array->user_context()->Id(), UserContextId(100));\n }\n \n TEST(ArrayImplTest,\n@@ -146,7 +146,7 @@ TEST(ArrayImplTest,\n   EXPECT_EQ(array->dtype(), dtype);\n   EXPECT_EQ(array->shape(), shape);\n   EXPECT_EQ(array->shared_ptr_sharding().get(), sharding.get());\n-  EXPECT_EQ(array->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(array->user_context()->Id(), UserContextId(100));\n }\n \n class ArrayImplWithHostBufferSemanticsTest\n@@ -540,7 +540,7 @@ TEST(ArrayImplTest, MakeArraysFromHostBufferShardsAndCopyToHostBuffer) {\n   // There should be no use-after-free.\n \n   for (int i = 0; i < arrays.size(); ++i) {\n-    EXPECT_EQ(arrays[i]->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(arrays[i]->user_context()->Id(), UserContextId(100));\n     TF_ASSERT_OK_AND_ASSIGN(\n         auto single_device_arrays,\n         arrays[i]->DisassembleIntoSingleDeviceArrays(\n@@ -741,7 +741,7 @@ TEST(ArrayImplTest, MakeArrayFromHostBufferAndCopyToHostBufferWithString) {\n           /*byte_strides=*/std::nullopt, std::move(sharding),\n           Client::HostBufferSemantics::kImmutableUntilTransferCompletes,\n           /*on_done_with_host_buffer=*/[cords = std::move(cords)]() {}));\n-  EXPECT_EQ(array->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(array->user_context()->Id(), UserContextId(100));\n \n   std::vector<absl::Cord> out_data(shape.num_elements());\n   auto future =\n@@ -837,7 +837,7 @@ TEST(ArrayImplTest,\n   cords1 = nullptr;\n \n   for (int i = 0; i < arrays.size(); ++i) {\n-    EXPECT_EQ(arrays[i]->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(arrays[i]->user_context()->Id(), UserContextId(100));\n     TF_ASSERT_OK_AND_ASSIGN(\n         auto single_device_arrays,\n         arrays[i]->DisassembleIntoSingleDeviceArrays(\n@@ -969,8 +969,8 @@ TEST(ArrayImplTest, MakeErrorArrays) {\n               StatusIs(_, HasSubstr(\"injected error\")));\n   EXPECT_THAT(arrays[1]->GetReadyFuture().Await(),\n               StatusIs(_, HasSubstr(\"injected error\")));\n-  EXPECT_EQ(arrays[0]->user_context()->Fingerprint(), 100);\n-  EXPECT_EQ(arrays[1]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(arrays[0]->user_context()->Id(), UserContextId(100));\n+  EXPECT_EQ(arrays[1]->user_context()->Id(), UserContextId(100));\n }\n \n TEST(ArrayImplTest, MakeErrorArraysWithAddressableAndNonAddressableDevice) {\n@@ -1009,8 +1009,8 @@ TEST(ArrayImplTest, MakeErrorArraysWithAddressableAndNonAddressableDevice) {\n               StatusIs(_, HasSubstr(\"injected error\")));\n   EXPECT_THAT(arrays[1]->GetReadyFuture().Await(),\n               StatusIs(_, HasSubstr(\"injected error\")));\n-  EXPECT_EQ(arrays[0]->user_context()->Fingerprint(), 100);\n-  EXPECT_EQ(arrays[1]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(arrays[0]->user_context()->Id(), UserContextId(100));\n+  EXPECT_EQ(arrays[1]->user_context()->Id(), UserContextId(100));\n }\n \n TEST(ArrayImplTest, AssembleArray) {\n@@ -1059,7 +1059,7 @@ TEST(ArrayImplTest, AssembleArray) {\n   EXPECT_EQ(assembled_array->shape(), assembled_shape);\n   EXPECT_EQ(assembled_array->shared_ptr_sharding().get(),\n             assembled_sharding.get());\n-  EXPECT_EQ(assembled_array->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(assembled_array->user_context()->Id(), UserContextId(100));\n }\n \n TEST(ArrayImplTest, AssembleAndDisassembleArray) {\n@@ -1128,12 +1128,14 @@ TEST(ArrayImplTest, AssembleAndDisassembleArray) {\n     EXPECT_EQ(single_device_arrays[0]->shape(), array0->shape());\n     EXPECT_THAT(single_device_arrays[0]->sharding().devices()->devices(),\n                 ElementsAreArray(array0->sharding().devices()->devices()));\n-    EXPECT_EQ(single_device_arrays[0]->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(single_device_arrays[0]->user_context()->Id(),\n+              UserContextId(100));\n     EXPECT_EQ(single_device_arrays[1]->dtype(), array1->dtype());\n     EXPECT_EQ(single_device_arrays[1]->shape(), array1->shape());\n     EXPECT_THAT(single_device_arrays[1]->sharding().devices()->devices(),\n                 ElementsAreArray(array1->sharding().devices()->devices()));\n-    EXPECT_EQ(single_device_arrays[1]->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(single_device_arrays[1]->user_context()->Id(),\n+              UserContextId(100));\n   }\n }\n \n@@ -1182,7 +1184,7 @@ TEST(ArrayImplTest, AssembleAndDisassembleSingleDeviceArray) {\n   ASSERT_EQ(single_device_arrays[0]->shape(), array->shape());\n   EXPECT_THAT(single_device_arrays[0]->sharding().devices()->devices(),\n               ElementsAreArray(array->sharding().devices()->devices()));\n-  EXPECT_EQ(single_device_arrays[0]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(single_device_arrays[0]->user_context()->Id(), UserContextId(100));\n }\n \n TEST(ArrayImplTest, CopyToSameDevices) {\n@@ -1208,7 +1210,7 @@ TEST(ArrayImplTest, CopyToSameDevices) {\n       client->CopyArrays(absl::MakeSpan(&array, 1), sharding->devices(),\n                          MemoryKind(), ArrayCopySemantics::kAlwaysCopy));\n   ASSERT_THAT(new_arrays, SizeIs(1));\n-  EXPECT_EQ(new_arrays[0]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(new_arrays[0]->user_context()->Id(), UserContextId(100));\n \n   std::vector<float> out_data(6);\n   auto future = new_arrays[0]->CopyToHostBuffer(\n@@ -1265,7 +1267,7 @@ TEST(ArrayImplTest, AssembleAndDisassembleNonAddressableArray) {\n             dtype, assembled_shape, assembled_sharding, absl::MakeSpan(arrays),\n             ArrayCopySemantics::kAlwaysCopy,\n             SingleDeviceShardSemantics::kAddressableShards));\n-    EXPECT_EQ(assembled_array->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(assembled_array->user_context()->Id(), UserContextId(100));\n \n     TF_ASSERT_OK_AND_ASSIGN(\n         auto single_device_arrays,\n@@ -1341,7 +1343,7 @@ TEST(ArrayImplTest, CopyToDifferentDevice) {\n         auto expected_sharding,\n         arrays[i]->sharding().WithDeviceAssignment(device_list, MemoryKind()));\n     EXPECT_EQ(new_arrays[i]->sharding(), *expected_sharding);\n-    EXPECT_EQ(new_arrays[i]->user_context()->Fingerprint(), 100);\n+    EXPECT_EQ(new_arrays[i]->user_context()->Id(), UserContextId(100));\n \n     TF_ASSERT_OK_AND_ASSIGN(\n         auto shards, arrays[i]->DisassembleIntoSingleDeviceArrays("
        },
        {
            "sha": "b6273a0c748c76751c408e613e1c6075a97cd158",
            "filename": "third_party/xla/xla/python/ifrt/test_util.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ftest_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ftest_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Ftest_util.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -131,7 +131,6 @@ class TestUserContext : public llvm::RTTIExtends<TestUserContext, UserContext> {\n  public:\n   explicit TestUserContext(UserContextId id) : id_(id) {}\n \n-  uint64_t Fingerprint() const override { return id_.value(); }\n   UserContextId Id() const override { return id_; }\n \n   std::string DebugString() const override {"
        },
        {
            "sha": "e1456d2d6c951767facca66707e48431f1e0359d",
            "filename": "third_party/xla/xla/python/ifrt/user_context.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 42,
            "changes": 42,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -15,12 +15,10 @@ limitations under the License.\n \n #include \"xla/python/ifrt/user_context.h\"\n \n-#include <cstdint>\n #include <string>\n #include <utility>\n #include <vector>\n \n-#include \"absl/algorithm/container.h\"\n #include \"absl/base/attributes.h\"\n #include \"absl/base/no_destructor.h\"\n #include \"absl/base/nullability.h\"\n@@ -29,7 +27,6 @@ limitations under the License.\n #include \"absl/strings/str_join.h\"\n #include \"absl/types/span.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n-#include \"tsl/platform/fingerprint.h\"\n #include \"tsl/platform/random.h\"\n \n namespace xla {\n@@ -62,14 +59,6 @@ AnnotatedUserContext::AnnotatedUserContext(UserContextRef user_context,\n       user_context_(std::move(user_context)),\n       msg_(std::move(msg)) {}\n \n-uint64_t AnnotatedUserContext::Fingerprint() const {\n-  if (user_context_ != nullptr) {\n-    return tsl::FingerprintCat64(user_context_->Fingerprint(),\n-                                 tsl::Fingerprint64(msg_));\n-  }\n-  return tsl::Fingerprint64(msg_);\n-}\n-\n UserContextId AnnotatedUserContext::Id() const { return id_; }\n \n std::string AnnotatedUserContext::DebugString() const {\n@@ -88,19 +77,6 @@ ChainedUserContext::ChainedUserContext(\n     : id_(tsl::random::ThreadLocalNew64()),\n       user_contexts_(user_contexts.begin(), user_contexts.end()) {}\n \n-uint64_t ChainedUserContext::Fingerprint() const {\n-  static const uint64_t kFingerprintInitialValue =\n-      tsl::Fingerprint64(\"ChainedUserContext\");\n-  uint64_t fingerprint = kFingerprintInitialValue;\n-  for (int i = 0; i < user_contexts_.size(); ++i) {\n-    if (user_contexts_[i] != nullptr) {\n-      fingerprint =\n-          tsl::FingerprintCat64(fingerprint, user_contexts_[i]->Fingerprint());\n-    }\n-  }\n-  return fingerprint;\n-}\n-\n UserContextId ChainedUserContext::Id() const { return id_; }\n \n std::string ChainedUserContext::DebugString() const {\n@@ -122,24 +98,6 @@ FusedUserContext::FusedUserContext(\n     : id_(tsl::random::ThreadLocalNew64()),\n       user_contexts_(user_contexts.begin(), user_contexts.end()) {}\n \n-uint64_t FusedUserContext::Fingerprint() const {\n-  static const uint64_t kFingerprintInitialValue =\n-      tsl::Fingerprint64(\"FusedUserContext\");\n-  std::vector<uint64_t> fingerprints;\n-  fingerprints.reserve(user_contexts_.size());\n-  for (int i = 0; i < user_contexts_.size(); ++i) {\n-    if (user_contexts_[i] != nullptr) {\n-      fingerprints.push_back(user_contexts_[i]->Fingerprint());\n-    }\n-  }\n-  absl::c_sort(fingerprints);\n-  uint64_t fingerprint = kFingerprintInitialValue;\n-  for (uint64_t user_context_fingerprint : fingerprints) {\n-    fingerprint = tsl::FingerprintCat64(fingerprint, user_context_fingerprint);\n-  }\n-  return fingerprint;\n-}\n-\n UserContextId FusedUserContext::Id() const { return id_; }\n \n std::string FusedUserContext::DebugString() const {"
        },
        {
            "sha": "ee71b96bad73586d08ef7a177af80c40a7999bda",
            "filename": "third_party/xla/xla/python/ifrt/user_context.h",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context.h?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -43,19 +43,6 @@ class UserContext : public tsl::ReferenceCounted<UserContext>,\n  public:\n   ~UserContext() override = default;\n \n-  // Returns a fingerprint of the `UserContext`. The returned fingerprint must\n-  // be non-zero, as the special value of zero is reserved for the IFRT\n-  // implementations for their internal default `UserContext`.  IFRT\n-  // implementations may use internally. IFRT implementations\n-  // may also use this as a key for holding the UserContexts in a container, and\n-  // so this should be efficient enough to called multiple times.\n-  //\n-  // TODO(hyeontaek): Remove this method once we migrate all users of\n-  // `Fingerprint()` to `Id()`. This will require the users to stop expecting to\n-  // see a small finite set of unique IDs over the lifetime of a process because\n-  // `Id()` semantics allows an indefinite set of IDs.\n-  virtual uint64_t Fingerprint() const = 0;\n-\n   // Returns the unique ID of the `UserContext`. This ID is expected to be\n   // globally unique for a certain context. For instance, both a global random\n   // ID and the fingerprint of the `UserContext` content may be used as the ID.\n@@ -96,7 +83,6 @@ class AnnotatedUserContext\n \n   // `UserContext` implementation.\n \n-  uint64_t Fingerprint() const override;\n   UserContextId Id() const override;\n   std::string DebugString() const override;\n \n@@ -137,7 +123,6 @@ class ChainedUserContext\n \n   // `UserContext` implementation.\n \n-  uint64_t Fingerprint() const override;\n   UserContextId Id() const override;\n   std::string DebugString() const override;\n \n@@ -176,7 +161,6 @@ class FusedUserContext\n \n   // `UserContext` implementation.\n \n-  uint64_t Fingerprint() const override;\n   UserContextId Id() const override;\n   std::string DebugString() const override;\n "
        },
        {
            "sha": "884116cb57664983993ec0b520a08b38723984ce",
            "filename": "third_party/xla/xla/python/ifrt/user_context_registry.h",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry.h?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -88,10 +88,9 @@ class UserContextRegistry {\n                   const TrackedUserContext* tracked_user_context);\n \n   mutable absl::Mutex mu_;\n-  // A map from `UserContext::Fingerprint()` to a weak reference of\n-  // `TrackedUserContext`. The raw pointer is used for handling a race condition\n-  // between `Register()` and destruction of `TrackedUserContext` for the same\n-  // ID.\n+  // A map from `UserContext::Id()` to a weak reference of `TrackedUserContext`.\n+  // The raw pointer is used for handling a race condition between `Register()`\n+  // and destruction of `TrackedUserContext` for the same ID.\n   absl::flat_hash_map<\n       UserContextId,\n       std::pair<std::weak_ptr<TrackedUserContext>, const TrackedUserContext*>>"
        },
        {
            "sha": "6baea7daa2d14403762144cfd166273ee88b815f",
            "filename": "third_party/xla/xla/python/ifrt/user_context_registry_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_registry_test.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include \"xla/python/ifrt/user_context_registry.h\"\n \n-#include <cstdint>\n #include <memory>\n #include <string>\n #include <vector>\n@@ -41,7 +40,6 @@ class TestUserContext : public llvm::RTTIExtends<TestUserContext, UserContext> {\n     return tsl::TakeRef<TestUserContext>(new TestUserContext(id));\n   }\n \n-  uint64_t Fingerprint() const override { return id_.value(); }\n   UserContextId Id() const override { return UserContextId(id_); }\n \n   std::string DebugString() const override {"
        },
        {
            "sha": "6a5c918215499e0f0c2e65bedc562cb70d8e835b",
            "filename": "third_party/xla/xla/python/ifrt/user_context_status_util_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_status_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_status_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_status_util_test.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include \"xla/python/ifrt/user_context_status_util.h\"\n \n-#include <cstdint>\n #include <optional>\n #include <string>\n #include <utility>\n@@ -45,7 +44,6 @@ class TestUserContext : public llvm::RTTIExtends<TestUserContext, UserContext> {\n     return tsl::TakeRef<TestUserContext>(new TestUserContext(id));\n   }\n \n-  uint64_t Fingerprint() const override { return id_.value(); }\n   UserContextId Id() const override { return id_; }\n \n   std::string DebugString() const override {"
        },
        {
            "sha": "c3bae7823883a279f23e72c6abac0726f590fb24",
            "filename": "third_party/xla/xla/python/ifrt/user_context_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fuser_context_test.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -15,7 +15,6 @@ limitations under the License.\n \n #include \"xla/python/ifrt/user_context.h\"\n \n-#include <cstdint>\n #include <string>\n \n #include <gtest/gtest.h>\n@@ -38,7 +37,6 @@ class TestUserContext : public llvm::RTTIExtends<TestUserContext, UserContext> {\n     return tsl::TakeRef<TestUserContext>(new TestUserContext(id));\n   }\n \n-  uint64_t Fingerprint() const override { return id_.value(); }\n   UserContextId Id() const override { return id_; }\n \n   std::string DebugString() const override {\n@@ -70,25 +68,6 @@ TEST(AnnotatedUserContextTest, Id) {\n   EXPECT_NE(annotated_context3->Id(), annotated_context1->Id());\n }\n \n-TEST(AnnotatedUserContextTest, Fingerprint) {\n-  const UserContextId kUserContextId(100);\n-  UserContextRef context = TestUserContext::Create(kUserContextId);\n-\n-  UserContextRef annotated_context1 =\n-      AnnotatedUserContext::Create(context, \"test annotation\");\n-  EXPECT_NE(annotated_context1->Fingerprint(), context->Fingerprint());\n-\n-  UserContextRef annotated_context2 =\n-      AnnotatedUserContext::Create(context, \"test annotation 2\");\n-  EXPECT_NE(annotated_context2->Fingerprint(),\n-            annotated_context1->Fingerprint());\n-\n-  UserContextRef annotated_context3 =\n-      AnnotatedUserContext::Create(UserContextRef(), \"test annotation\");\n-  EXPECT_NE(annotated_context3->Fingerprint(),\n-            annotated_context1->Fingerprint());\n-}\n-\n TEST(AnnotatedUserContextTest, DebugString) {\n   {\n     const UserContextId kUserContextId(100);\n@@ -117,20 +96,6 @@ TEST(ChainedUserContextTest, Id) {\n   EXPECT_NE(chained_context->Id(), context2->Id());\n }\n \n-TEST(ChainedUserContextTest, Fingerprint) {\n-  const UserContextId kUserContextId1(100);\n-  const UserContextId kUserContextId2(200);\n-  UserContextRef context1 = TestUserContext::Create(kUserContextId1);\n-  UserContextRef context2 = TestUserContext::Create(kUserContextId2);\n-  UserContextRef chained_context1 =\n-      ChainedUserContext::Create({context1, UserContextRef(), context2});\n-  EXPECT_NE(chained_context1->Fingerprint(), context1->Fingerprint());\n-  EXPECT_NE(chained_context1->Fingerprint(), context2->Fingerprint());\n-  UserContextRef chained_context2 =\n-      ChainedUserContext::Create({context2, UserContextRef(), context1});\n-  EXPECT_NE(chained_context2->Fingerprint(), chained_context1->Fingerprint());\n-}\n-\n TEST(ChainedUserContextTest, DebugString) {\n   const UserContextId kUserContextId1(100);\n   const UserContextId kUserContextId2(200);\n@@ -154,20 +119,6 @@ TEST(FusedUserContextTest, Id) {\n   EXPECT_NE(fused_context->Id(), context2->Id());\n }\n \n-TEST(FusedUserContextTest, Fingerprint) {\n-  const UserContextId kUserContextId1(100);\n-  const UserContextId kUserContextId2(200);\n-  UserContextRef context1 = TestUserContext::Create(kUserContextId1);\n-  UserContextRef context2 = TestUserContext::Create(kUserContextId2);\n-  UserContextRef fused_context1 =\n-      FusedUserContext::Create({context1, UserContextRef(), context2});\n-  EXPECT_NE(fused_context1->Fingerprint(), context1->Fingerprint());\n-  EXPECT_NE(fused_context1->Fingerprint(), context2->Fingerprint());\n-  UserContextRef fused_context2 =\n-      FusedUserContext::Create({context2, UserContextRef(), context1});\n-  EXPECT_EQ(fused_context2->Fingerprint(), fused_context1->Fingerprint());\n-}\n-\n TEST(FusedUserContextTest, DebugString) {\n   const UserContextId kUserContextId1(100);\n   const UserContextId kUserContextId2(200);\n@@ -194,7 +145,6 @@ TEST(UserContextScopeTest, SingleScope) {\n TEST(UserContextScopeTest, SingleScopeWithInlineContextCreation) {\n   const UserContextId kUserContextId(100);\n   UserContextScope scope(TestUserContext::Create(kUserContextId));\n-  EXPECT_EQ(UserContextScope::current()->Fingerprint(), kUserContextId.value());\n   EXPECT_EQ(UserContextScope::current()->Id(), kUserContextId);\n }\n "
        },
        {
            "sha": "6d2447d876034ebcea1136beaf27eb891ebca6ee",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2FBUILD?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -181,6 +181,7 @@ cc_library(\n     deps = [\n         \":executable_metadata_proto_cc\",\n         \":pjrt_layout\",\n+        \":xla_executable_version\",\n         \":xla_ifrt\",\n         \"//xla/client:executable_build_options\",\n         \"//xla/pjrt:mlir_to_hlo\",\n@@ -189,7 +190,6 @@ cc_library(\n         \"//xla/python/ifrt:test_util\",\n         \"//xla/python/ifrt:user_context\",\n         \"//xla/python/ifrt/hlo:hlo_program\",\n-        \"//xla/python/pjrt_ifrt:xla_executable_version\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\","
        },
        {
            "sha": "4ab89736ea86ba2dcd4c5e57e036fb85f03b20e8",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/xla_executable_impl_test_lib.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_executable_impl_test_lib.cc?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -328,7 +328,7 @@ TEST_P(LoadedExecutableImplTest, CompileAndExecute) {\n         CompileOnDevices(client.get(), compiler, module_add_one, devices,\n                          /*replicated=*/false, serialize));\n   }\n-  EXPECT_EQ(loaded_executable->user_context()->Fingerprint(), 20);\n+  EXPECT_EQ(loaded_executable->user_context()->Id(), UserContextId(20));\n \n   DType dtype(DType::kF32);\n   Shape shape({2, 3});\n@@ -356,7 +356,7 @@ TEST_P(LoadedExecutableImplTest, CompileAndExecute) {\n   }\n   TF_ASSERT_OK(result.status.Await());\n   EXPECT_THAT(result.outputs, SizeIs(1));\n-  EXPECT_EQ(result.outputs[0]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(result.outputs[0]->user_context()->Id(), UserContextId(100));\n \n   std::vector<float> out_data(6);\n   auto future = result.outputs[0]->CopyToHostBuffer(\n@@ -384,7 +384,7 @@ TEST_P(LoadedExecutableImplTest, CompileAndExecutePortable) {\n         CompileOnDevices(client.get(), compiler, module_add_one, devices,\n                          /*replicated=*/false, serialize));\n   }\n-  EXPECT_EQ(loaded_executable->user_context()->Fingerprint(), 20);\n+  EXPECT_EQ(loaded_executable->user_context()->Id(), UserContextId(20));\n \n   DType dtype(DType::kF32);\n   Shape shape({2, 3});\n@@ -414,7 +414,7 @@ TEST_P(LoadedExecutableImplTest, CompileAndExecutePortable) {\n   }\n   TF_ASSERT_OK(result.status.Await());\n   EXPECT_THAT(result.outputs, SizeIs(1));\n-  EXPECT_EQ(result.outputs[0]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(result.outputs[0]->user_context()->Id(), UserContextId(100));\n \n   std::vector<float> out_data(6);\n   auto future = result.outputs[0]->CopyToHostBuffer(\n@@ -462,7 +462,7 @@ TEST_P(LoadedExecutableImplTest, DoNotFillStatus) {\n                                  /*devices=*/std::nullopt));\n   EXPECT_FALSE(result.status.IsValid());\n   EXPECT_THAT(result.outputs, SizeIs(1));\n-  EXPECT_EQ(result.outputs[0]->user_context()->Fingerprint(), 100);\n+  EXPECT_EQ(result.outputs[0]->user_context()->Id(), UserContextId(100));\n \n   std::vector<float> out_data(6);\n   auto future = result.outputs[0]->CopyToHostBuffer("
        },
        {
            "sha": "1cf099b9238e877aa159e1e0fd8c5c60b73e2c11",
            "filename": "third_party/xla/xla/python/version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a61d8f61b240faa497481582760affa49c721e35/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fversion.h?ref=a61d8f61b240faa497481582760affa49c721e35",
            "patch": "@@ -18,6 +18,6 @@ limitations under the License.\n \n // An increasing version number to protect jax code against breaking changes.\n // In JAX, reference this via jax._src.lib.ifrt_version.\n-#define JAX_IFRT_VERSION_NUMBER 27\n+#define JAX_IFRT_VERSION_NUMBER 28\n \n #endif  // XLA_PYTHON_VERSION_H_"
        }
    ],
    "stats": {
        "total": 170,
        "additions": 28,
        "deletions": 142
    }
}