{
    "author": "alekstheod",
    "message": "PR #35670: [ROCm] Fix invalid rocm_distro argument\n\nImported from GitHub PR https://github.com/openxla/xla/pull/35670\n\nüìù Summary of Changes\nFix regression in hermetic rocm builds due to an invalid argument\n\nüéØ Justification\nFix invalid argument passed to setup rocm redist directory\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nNot relevant\n\nüß™ Unit Tests:\nNot relevant\n\nüß™ Execution Tests:\nNot relevant\n\nCopybara import of the project:\n\n--\nfadf42fb6152b73997e988bed12afdb29b5ebc47 by Alexandros Theodoridis <atheodor@amd.com>:\n\nFix invalid rocm_distro argument\n\n--\ne01b84f4501eccf964b459a1562885c510465dea by Alexandros Theodoridis <atheodor@amd.com>:\n\nCleanup\n\n--\n4926f012009bc6a66ad7ab6596337d92df6cf8a2 by Alexandros Theodoridis <atheodor@amd.com>:\n\nFix malformed call to fail\n\n--\n99a8ae5d08a4d6ffe884439aced99beffd33b917 by Alexandros Theodoridis <atheodor@amd.com>:\n\nAdd debug print for downloaded files\n\nMerging this change closes #35670\n\nPiperOrigin-RevId: 849958226",
    "sha": "720202b2eea037bb6dcf321c63de9be718e9f080",
    "files": [
        {
            "sha": "2d4da4e1f9185c82da89451f10a891bd4794327d",
            "filename": "third_party/xla/tensorflow.bazelrc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/720202b2eea037bb6dcf321c63de9be718e9f080/third_party%2Fxla%2Ftensorflow.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/720202b2eea037bb6dcf321c63de9be718e9f080/third_party%2Fxla%2Ftensorflow.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Ftensorflow.bazelrc?ref=720202b2eea037bb6dcf321c63de9be718e9f080",
            "patch": "@@ -288,9 +288,7 @@ common:rocm_ci --config=rocm\n \n common:rocm_ci_hermetic --dynamic_mode=off\n common:rocm_ci_hermetic --config=rocm_clang_official\n-common:rocm_ci_hermetic --repo_env=\"ROCM_DISTRO_URL=https://therock-nightly-tarball.s3.amazonaws.com/therock-dist-linux-gfx94X-dcgpu-7.10.0a20251107.tar.gz\"\n-common:rocm_ci_hermetic --repo_env=\"ROCM_DISTRO_HASH=486dbf647bcf9b78f21d7477f43addc7b2075b1a322a119045db9cdc5eb98380\"\n-common:rocm_ci_hermetic --repo_env=\"ROCM_DISTRO_LINKS=llvm/amdgcn:amdgcn\"\n+common:rocm_ci_hermetic --repo_env=\"ROCM_DISTRO_VERSION=rocm_7.10.0_gfx90X\"\n common:rocm_ci_hermetic --@local_config_rocm//rocm:rocm_path_type=hermetic\n \n # This config option is used for SYCL as GPU backend."
        },
        {
            "sha": "151014051deba46c220ba0466f70e47544690171",
            "filename": "third_party/xla/third_party/gpus/rocm_configure.bzl",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/720202b2eea037bb6dcf321c63de9be718e9f080/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/720202b2eea037bb6dcf321c63de9be718e9f080/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl?ref=720202b2eea037bb6dcf321c63de9be718e9f080",
            "patch": "@@ -527,6 +527,7 @@ def _get_file_name(url):\n def _download_package(repository_ctx, pkg):\n     file_name = _get_file_name(pkg[\"url\"])\n \n+    print(\"Downloading {}\".format(pkg[\"url\"]))\n     repository_ctx.report_progress(\"Downloading and extracting {}, expected hash is {}\".format(pkg[\"url\"], pkg[\"sha256\"]))  # buildifier: disable=print\n     repository_ctx.download_and_extract(\n         url = pkg[\"url\"],\n@@ -569,17 +570,17 @@ def _setup_rocm_distro_dir(repository_ctx):\n     if rocm_distro_url:\n         rocm_distro_hash = repository_ctx.os.environ.get(_ROCM_DISTRO_HASH)\n         if not rocm_distro_hash:\n-            fail(\"{} environment variable is required\", _ROCM_DISTRO_HASH)\n+            fail(\"{} environment variable is required\".format(_ROCM_DISTRO_HASH))\n         rocm_distro_links = repository_ctx.os.environ.get(_ROCM_DISTRO_LINKS, \"\")\n         rocm_distro = create_rocm_distro(rocm_distro_url, rocm_distro_hash, rocm_distro_links)\n         return _setup_rocm_distro_dir_impl(repository_ctx, rocm_distro)\n \n     rocm_distro = repository_ctx.os.environ.get(_ROCM_DISTRO_VERSION)\n-    multiple_paths = repository_ctx.os.environ.get(_TF_ROCM_MULTIPLE_PATHS)\n     if rocm_distro:\n-        redist = rocm_redist[rocm_distro]\n-        return _setup_rocm_distro_dir_impl(repository_ctx, rocm_distro)\n-    elif multiple_paths:\n+        return _setup_rocm_distro_dir_impl(repository_ctx, rocm_redist[rocm_distro])\n+\n+    multiple_paths = repository_ctx.os.environ.get(_TF_ROCM_MULTIPLE_PATHS)\n+    if multiple_paths:\n         paths_list = multiple_paths.split(\":\")\n         for rocm_custom_path in paths_list:\n             cmd = \"find \" + rocm_custom_path + \"/* \\\\( -type f -o -type l \\\\)\""
        }
    ],
    "stats": {
        "total": 15,
        "additions": 7,
        "deletions": 8
    }
}