{
    "author": "tensorflower-gardener",
    "message": "Remove obsolete Triton LLVM integration patches.\n\nThese patches are no longer needed as the corresponding changes have been integrated into the Triton codebase.\n\nPiperOrigin-RevId: 820140492",
    "sha": "41549024ea4eedf20db0fd436c0cb936572fd636",
    "files": [
        {
            "sha": "ae836b4d9efb843a3bfbafb79113efc131fb0429",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl801607173.patch",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl801607173.patch?ref=379d3eba7b91454ab9f0123e48a4e2385c211a81",
            "patch": "@@ -1,35 +0,0 @@\n-\n---- a/third_party/amd/lib/TritonAMDGPUToLLVM/AtomicRMWOpsEmitter.cpp\n-+++ b/third_party/amd/lib/TritonAMDGPUToLLVM/AtomicRMWOpsEmitter.cpp\n-@@ -407,13 +407,28 @@ Value AtomicRMWEmitter::atomicIntraWaveReduce(RewriterBase &rewriter,\n-   Value start = loopBody->getArgument(0);\n-   Value cnt = b.trunc(i32_ty, generatePopcount64(rewriter, mask));\n-   Value maskLo = b.trunc(i32_ty, mask);\n-+  NamedAttribute noundef = rewriter.getNamedAttr(\n-+      LLVM::LLVMDialect::getNoUndefAttrName(), rewriter.getUnitAttr());\n-+  NamedAttribute lowRange = rewriter.getNamedAttr(\n-+      LLVM::LLVMDialect::getRangeAttrName(),\n-+      LLVM::ConstantRangeAttr::get(rewriter.getContext(), APInt::getZero(32),\n-+                                   APInt(32, 32)));\n-+  NamedAttribute highRange = rewriter.getNamedAttr(\n-+      LLVM::LLVMDialect::getRangeAttrName(),\n-+      LLVM::ConstantRangeAttr::get(rewriter.getContext(), APInt::getZero(32),\n-+                                   APInt(32, 64)));\n-   Value mbcntLoRes =\n--      ROCDL::MbcntLoOp::create(rewriter, loc, i32_ty, maskLo, b.i32_val(0),\n--                               /*arg_attrs=*/{}, /*res_attrs=*/{});\n-+      ROCDL::MbcntLoOp::create(\n-+        rewriter, loc, i32_ty, maskLo, b.i32_val(0),\n-+        /*arg_attrs=*/{},\n-+        /*res_attrs=*/rewriter.getArrayAttr(\n-+          rewriter.getDictionaryAttr({noundef, lowRange})));\n-   Value maskHi = b.trunc(i32_ty, b.lshr(mask, b.i64_val(32)));\n-   Value idx =\n-       ROCDL::MbcntHiOp::create(rewriter, loc, i32_ty, maskHi, mbcntLoRes,\n--                               /*arg_attrs=*/{}, /*res_attrs=*/{});\n-+        /*arg_attrs=*/{},\n-+        /*res_attrs=*/rewriter.getArrayAttr(\n-+          rewriter.getDictionaryAttr({noundef, highRange})));\n-   Value base = b.add(start, cnt);\n-   Value leader = b.icmp_eq(idx, b.i32_val(0));\n-   cnt = b.sub(cnt, idx);"
        },
        {
            "sha": "5e7c6765cb4c3575e3c22f352f565e48385c9edb",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl808150672.patch",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl808150672.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl808150672.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl808150672.patch?ref=379d3eba7b91454ab9f0123e48a4e2385c211a81",
            "patch": "@@ -1,45 +0,0 @@\n-\n---- a/test/Conversion/tritongpu_to_llvm.mlir\n-+++ b/test/Conversion/tritongpu_to_llvm.mlir\n-@@ -1,4 +1,7 @@\n--// RUN: triton-opt %s -split-input-file --allocate-shared-memory-nv --convert-triton-gpu-to-llvm 2>/dev/null | FileCheck %s --dump-input-context 20\n-+// RUN: triton-opt %s -split-input-file \\\n-+// RUN:   --allocate-shared-memory-nv --convert-triton-gpu-to-llvm \\\n-+// RUN:   --reconcile-unrealized-casts 2>/dev/null \\\n-+// RUN:   | FileCheck %s --dump-input-context 20\n-\n- module attributes {\"ttg.num-ctas\" = 1 : i32, \"ttg.num-warps\" = 4 : i32} {\n-   // CHECK: llvm.func @test_empty_kernel(%arg0: i32, %arg1: !llvm.ptr<1>, %arg2: !llvm.ptr<1>, %arg3: !llvm.ptr<1>)\n-\n---- a/test/Conversion/tritonnvidiagpu_to_llvm.mlir\n-+++ b/test/Conversion/tritonnvidiagpu_to_llvm.mlir\n-@@ -1,4 +1,7 @@\n--// RUN: triton-opt %s -split-input-file --convert-triton-gpu-to-llvm=compute-capability=90 | FileCheck %s\n-+// RUN: triton-opt %s -split-input-file \\\n-+// RUN: --convert-triton-gpu-to-llvm=compute-capability=90 \\\n-+// RUN: --reconcile-unrealized-casts \\\n-+// RUN: | FileCheck %s\n-\n- #shared0 = #ttg.swizzled_shared<{vec = 1, perPhase = 1, maxPhase = 1, order = [0], CTAsPerCGA = [1], CTASplitNum = [1], CTAOrder = [0]}>\n- #smem = #ttg.shared_memory\n-\n---- a/third_party/amd/lib/TritonAMDGPUTransforms/CanonicalizePointers.cpp\n-+++ b/third_party/amd/lib/TritonAMDGPUTransforms/CanonicalizePointers.cpp\n-@@ -1415,7 +1415,7 @@\n-     if (auto integerAttr =\n-             llvm::dyn_cast_or_null<mlir::IntegerAttr>(maybeAttr)) {\n-       if (integerAttr.getValue() == 0) {\n--        rewriter.replaceAllUsesWith(castOp.getResult(0), fatPtrBase);\n-+        rewriter.RewriterBase::replaceAllUsesWith(castOp.getResult(0), fatPtrBase);\n-         rewriter.eraseOp(castOp);\n-         return success();\n-       }\n-@@ -1425,7 +1425,7 @@\n-         fatPtrs.at({fatPtrBase, fatPtrOffset});\n-     auto newPtr = createTensorPointer(rewriter, fatPtrBase, fatPtrOffset,\n-                                       castOp.getLoc(), fatPtrAttrs);\n--    rewriter.replaceAllUsesWith(newPtr, fatPtrBase);\n-+    rewriter.RewriterBase::replaceAllUsesWith(newPtr, fatPtrBase);\n-     rewriter.eraseOp(castOp);\n-     return success();\n-   }"
        },
        {
            "sha": "f44e7e5712659f0c08f0de2e92b9ab28d99cd285",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl809972027.patch",
            "status": "removed",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl809972027.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl809972027.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl809972027.patch?ref=379d3eba7b91454ab9f0123e48a4e2385c211a81",
            "patch": "@@ -1,40 +0,0 @@\n-\n---- a/third_party/amd/lib/TritonAMDGPUToLLVM/TritonGPUToLLVM.cpp\t2025-07-31 00:13:23.000000000 -0700\n-+++ b/third_party/amd/lib/TritonAMDGPUToLLVM/TritonGPUToLLVM.cpp\t2025-09-22 05:43:47.000000000 -0700\n-@@ -257,7 +257,7 @@\n-         loc, arrayTy, /*isConstant=*/false, LLVM::Linkage::External,\n-         \"global_smem\", /*value=*/Attribute(), /*alignment=*/16,\n-         // Add ROCm support.\n--        static_cast<unsigned>(NVVM::NVVMMemorySpace::kSharedMemorySpace));\n-+        static_cast<unsigned>(NVVM::NVVMMemorySpace::Shared));\n-   }\n- };\n- \n-\n---- a/third_party/amd/lib/TritonAMDGPUTransforms/Utility.cpp\t2025-04-25 05:19:43.000000000 -0700\n-+++ b/third_party/amd/lib/TritonAMDGPUTransforms/Utility.cpp\t2025-09-22 05:43:47.000000000 -0700\n-@@ -24,9 +24,9 @@\n-           deduceMinCountInBlock(ifOp.getElseRegion().front(), countFunc);\n-       count += std::min(minThen, minElse);\n-     } else if (auto forOp = llvm::dyn_cast<scf::ForOp>(op)) {\n--      auto tripCount = constantTripCount(forOp.getLowerBound(),\n--                                         forOp.getUpperBound(), forOp.getStep())\n--                           .value_or(0);\n-+      int64_t tripCount = forOp.getStaticTripCount()\n-+                              .value_or(llvm::APInt(64, 0))\n-+                              .getZExtValue();\n-       if (tripCount > 0) {\n-         count += tripCount * deduceMinCountInBlock(*forOp.getBody(), countFunc);\n-       }\n-\n---- a/third_party/nvidia/lib/TritonNVIDIAGPUToLLVM/TritonGPUToLLVM.cpp\t2025-08-22 04:02:56.000000000 -0700\n-+++ b/third_party/nvidia/lib/TritonNVIDIAGPUToLLVM/TritonGPUToLLVM.cpp\t2025-09-22 05:43:47.000000000 -0700\n-@@ -223,7 +223,7 @@\n-         loc, arrayTy, /*isConstant=*/false, LLVM::Linkage::External,\n-         \"global_smem\", /*value=*/Attribute(), /*alignment=*/16,\n-         // Add ROCm support.\n--        static_cast<unsigned>(NVVM::NVVMMemorySpace::kSharedMemorySpace));\n-+        static_cast<unsigned>(NVVM::NVVMMemorySpace::Shared));\n-   }\n- };\n- "
        },
        {
            "sha": "2c6ffbd7ec984432757a09297cecbb249fd6328e",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl812994567.patch",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl812994567.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/379d3eba7b91454ab9f0123e48a4e2385c211a81/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl812994567.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl812994567.patch?ref=379d3eba7b91454ab9f0123e48a4e2385c211a81",
            "patch": "@@ -1,12 +0,0 @@\n-\n---- a/third_party/amd/lib/TritonAMDGPUToLLVM/BufferOpsEmitter.cpp\t2025-08-22 04:02:56.000000000 -0700\n-+++ b/third_party/amd/lib/TritonAMDGPUToLLVM/BufferOpsEmitter.cpp\t2025-09-29 17:07:00.000000000 -0700\n-@@ -82,7 +82,7 @@\n- \n-   Value flagsConst = b.int_val(32, flags);\n-   Type rsrcType = LLVM::LLVMPointerType::get(rewriter.getContext(), 8);\n--  Value numRecordsByte = b.int_val(32, std::numeric_limits<int>::max() - 1);\n-+  Value numRecordsByte = b.int_val(64, std::numeric_limits<int>::max() - 1);\n- \n-   Value resource = rewriter.createOrFold<ROCDL::MakeBufferRsrcOp>(\n-       loc, rsrcType, basePtr, stride, numRecordsByte, flagsConst);"
        }
    ],
    "stats": {
        "total": 132,
        "additions": 0,
        "deletions": 132
    }
}