{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::OutOfRange in xla\n\nThis change replaces usages of tsl::errors::OutOfRange with absl::OutOfRangeError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nThe deprecated tsl::errors::OutOfRange function was identified in third_party/tensorflow/compiler/xla/tsl/platform/errors.h.\n\nChanges:\n- Replaced errors::OutOfRange with absl::OutOfRangeError.\n- Used absl::StrCat to construct error messages where necessary.\nPiperOrigin-RevId: 838006439",
    "sha": "50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
    "files": [
        {
            "sha": "effeac3855f01befbbc2a8c7c9114c3fc0f9fa16",
            "filename": "third_party/xla/xla/service/gpu/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2FBUILD?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -1332,7 +1332,6 @@ xla_cc_test(\n         \"//xla/hlo/testlib:test\",\n         \"//xla/hlo/testlib:verified_hlo_module\",\n         \"//xla/tests:xla_internal_test_main\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/log\","
        },
        {
            "sha": "5426f4b2147be6dd35fd9199f00c6f3977fdf6e0",
            "filename": "third_party/xla/xla/service/gpu/cudnn_support_utils_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fcudnn_support_utils_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fcudnn_support_utils_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fcudnn_support_utils_test.cc?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -38,7 +38,6 @@ limitations under the License.\n #include \"xla/hlo/testlib/verified_hlo_module.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n-#include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/util.h\"\n "
        },
        {
            "sha": "dac9eaa25b6503aae8ab575c40e7fe16d31d9783",
            "filename": "third_party/xla/xla/tsl/lib/io/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -527,7 +527,6 @@ tsl_cc_test(\n     deps = [\n         \":inputstream_interface\",\n         \"//xla/tsl/lib/core:status_test_util\",\n-        \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:test\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\","
        },
        {
            "sha": "96306ec7a4a2599040bd716ebdef1f07327cba75",
            "filename": "third_party/xla/xla/tsl/lib/io/inputbuffer.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.h?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -139,7 +139,7 @@ inline absl::Status InputBuffer::ReadVarint32(uint32_t* result) {\n     // Fast path: directly parse from buffered data.\n     // Reads strictly from the range [pos_, limit_).\n     const char* const new_pos = core::GetVarint32Ptr(pos_, limit_, result);\n-    if (new_pos == nullptr) return errors::OutOfRange(\"Parsed past limit.\");\n+    if (new_pos == nullptr) return absl::OutOfRangeError(\"Parsed past limit.\");\n     const int offset = new_pos - buf();\n     pos_ = buf() + offset;\n     return absl::OkStatus();\n@@ -154,7 +154,7 @@ inline absl::Status InputBuffer::ReadVarint64(uint64_t* result) {\n     // Fast path: directly parse from buffered data.\n     // Reads strictly from the range [pos_, limit_).\n     const char* const new_pos = core::GetVarint64Ptr(pos_, limit_, result);\n-    if (new_pos == nullptr) return errors::OutOfRange(\"Parsed past limit.\");\n+    if (new_pos == nullptr) return absl::OutOfRangeError(\"Parsed past limit.\");\n     const int offset = new_pos - buf();\n     pos_ = buf() + offset;\n     return absl::OkStatus();"
        },
        {
            "sha": "251a6584ad6f56a15aa77fe77796bf047f150404",
            "filename": "third_party/xla/xla/tsl/lib/io/inputstream_interface_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface_test.cc?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -15,8 +15,8 @@ limitations under the License.\n \n #include \"xla/tsl/lib/io/inputstream_interface.h\"\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n-#include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/test.h\"\n \n namespace tsl {\n@@ -30,7 +30,7 @@ class TestStringStream : public InputStreamInterface {\n   absl::Status ReadNBytes(int64_t bytes_to_read, tstring* result) override {\n     result->clear();\n     if (pos_ + bytes_to_read > content_.size()) {\n-      return errors::OutOfRange(\"limit reached\");\n+      return absl::OutOfRangeError(\"limit reached\");\n     }\n     *result = content_.substr(pos_, bytes_to_read);\n     pos_ += bytes_to_read;"
        },
        {
            "sha": "f2c4e42b8d5159ec93f0026673cecf8213426f91",
            "filename": "third_party/xla/xla/tsl/lib/io/random_inputstream.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -18,6 +18,7 @@ limitations under the License.\n #include <memory>\n \n #include \"absl/status/status.h\"\n+\n namespace tsl {\n namespace io {\n "
        },
        {
            "sha": "a5f0763603ef858d82aaddff80e08be9158af5cb",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -108,7 +108,6 @@ tsl_cc_test(\n         \":snappy_inputbuffer\",\n         \":snappy_inputstream\",\n         \":snappy_outputbuffer\",\n-        \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/lib/io:inputbuffer\",\n         \"//xla/tsl/lib/io:random_inputstream\",\n         \"//xla/tsl/platform:env\","
        },
        {
            "sha": "744cc843e265f696621264df26c41b0c941d9795",
            "filename": "third_party/xla/xla/tsl/platform/cloud/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -67,6 +67,8 @@ cc_library(\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/cleanup\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n         \"@local_tsl//tsl/platform:notification\",\n@@ -188,7 +190,6 @@ cc_library(\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n         \"@local_tsl//tsl/platform:retrying_file_system\",\n         \"@local_tsl//tsl/platform:retrying_utils\",\n         \"@local_tsl//tsl/platform:str_util\","
        },
        {
            "sha": "7bbe18f3c3a907a8efdcf2e91c30ede87f5d0eed",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -1080,9 +1080,9 @@ absl::Status GcsFileSystem::NewRandomAccessFile(\n                                                  &bytes_transferred));\n       *result = absl::string_view(scratch, bytes_transferred);\n       if (bytes_transferred < n) {\n-        return errors::OutOfRange(\"EOF reached, \", result->size(),\n-                                  \" bytes were read out of \", n,\n-                                  \" bytes requested.\");\n+        return absl::OutOfRangeError(\n+            absl::StrCat(\"EOF reached, \", result->size(),\n+                         \" bytes were read out of \", n, \" bytes requested.\"));\n       }\n       return absl::OkStatus();\n     }));\n@@ -1097,9 +1097,9 @@ absl::Status GcsFileSystem::NewRandomAccessFile(\n               LoadBufferFromGCS(fname, offset, n, scratch, &bytes_transferred));\n           *result = absl::string_view(scratch, bytes_transferred);\n           if (bytes_transferred < n) {\n-            return errors::OutOfRange(\"EOF reached, \", result->size(),\n-                                      \" bytes were read out of \", n,\n-                                      \" bytes requested.\");\n+            return absl::OutOfRangeError(absl::StrCat(\n+                \"EOF reached, \", result->size(), \" bytes were read out of \", n,\n+                \" bytes requested.\"));\n           }\n           return absl::OkStatus();\n         }));"
        },
        {
            "sha": "bf6d7e2cb5ecc1020d7415159b38014bc8868de6",
            "filename": "third_party/xla/xla/tsl/platform/cloud/ram_file_block_cache.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fram_file_block_cache.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fram_file_block_cache.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fram_file_block_cache.cc?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -19,6 +19,8 @@ limitations under the License.\n #include <memory>\n \n #include \"absl/cleanup/cleanup.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/time/time.h\"\n #include \"xla/tsl/platform/env.h\"\n@@ -204,9 +206,9 @@ absl::Status RamFileBlockCache::Read(const std::string& filename, size_t offset,\n       // happen if `offset` is not block-aligned, and the read returns the last\n       // block in the file, which does not extend all the way out to `offset`.\n       *bytes_transferred = total_bytes_transferred;\n-      return errors::OutOfRange(\"EOF at offset \", offset, \" in file \", filename,\n-                                \" at position \", pos, \"with data size \",\n-                                data.size());\n+      return absl::OutOfRangeError(\n+          absl::StrCat(\"EOF at offset \", offset, \" in file \", filename,\n+                       \" at position \", pos, \"with data size \", data.size()));\n     }\n     auto begin = data.begin();\n     if (offset > pos) {"
        },
        {
            "sha": "a00d12b2cc0137d2e20f3727c859971cd728b176",
            "filename": "third_party/xla/xla/tsl/platform/ram_file_system.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/50667d9a05b1ea9f0b7c20a01d4e0f1355832fae/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h?ref=50667d9a05b1ea9f0b7c20a01d4e0f1355832fae",
            "patch": "@@ -69,7 +69,7 @@ class RamRandomAccessFile : public RandomAccessFile, public WritableFile {\n   absl::Status Read(uint64 offset, size_t n, absl::string_view* result,\n                     char* scratch) const override {\n     if (offset >= data_->size()) {\n-      return errors::OutOfRange(\"\");\n+      return absl::OutOfRangeError(\"\");\n     }\n \n     uint64 left = std::min(static_cast<uint64>(n), data_->size() - offset);\n@@ -82,7 +82,7 @@ class RamRandomAccessFile : public RandomAccessFile, public WritableFile {\n     // In case of a partial read, we must still fill `result`, but also return\n     // OutOfRange.\n     if (left < n) {\n-      return errors::OutOfRange(\"\");\n+      return absl::OutOfRangeError(\"\");\n     }\n     return absl::OkStatus();\n   }"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 20,
        "deletions": 20
    }
}