{
    "author": "hawkinsp",
    "message": "Add a helper for computing the nesting depth of a computation.\n\nPiperOrigin-RevId: 815866777",
    "sha": "6a6e91004b67ef3ac8b14a210d12920d2bdb2bec",
    "files": [
        {
            "sha": "09a30b42bcd3ad3241dc5f32798e818fd3fb6533",
            "filename": "third_party/xla/xla/hlo/ir/hlo_instruction_utils.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6a6e91004b67ef3ac8b14a210d12920d2bdb2bec/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6a6e91004b67ef3ac8b14a210d12920d2bdb2bec/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.cc?ref=6a6e91004b67ef3ac8b14a210d12920d2bdb2bec",
            "patch": "@@ -24,6 +24,7 @@ limitations under the License.\n #include \"absl/log/check.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n+#include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/primitive_util.h\"\n@@ -68,5 +69,21 @@ void AddOrUpdateVectorOfPairsAsAttribute(HloInstruction* instr,\n   instr->set_frontend_attributes(attributes);\n }\n \n+int32_t NestingDepth(const HloInstruction* hlo) {\n+  int level = 0;\n+  const HloComputation* c = hlo->parent();\n+  while (c != nullptr) {\n+    auto callers = c->caller_instructions();\n+    if (callers.empty()) {\n+      break;\n+    }\n+    // TODO(b/260601110): it's not clear what we should do if there are\n+    // multiple callers. For now, we just pick the first one.\n+    c = callers.front()->parent();\n+    ++level;\n+  }\n+  return level;\n+}\n+\n }  // namespace hlo_instruction_utils\n }  // namespace xla"
        },
        {
            "sha": "064077c30e2808b625787e4bb884dacc2dd45672",
            "filename": "third_party/xla/xla/hlo/ir/hlo_instruction_utils.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6a6e91004b67ef3ac8b14a210d12920d2bdb2bec/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6a6e91004b67ef3ac8b14a210d12920d2bdb2bec/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_instruction_utils.h?ref=6a6e91004b67ef3ac8b14a210d12920d2bdb2bec",
            "patch": "@@ -39,6 +39,10 @@ void AddOrUpdateVectorOfPairsAsAttribute(\n     HloInstruction* instr, std::string attr_name,\n     std::vector<std::pair<int64_t, int64_t>> intervals);\n \n+// Returns the nesting depth in computations from the top-level computation of\n+// `hlo`. i.e. 0 = in the top-level computation, ...\n+int32_t NestingDepth(const HloInstruction* hlo);\n+\n }  // namespace hlo_instruction_utils\n }  // namespace xla\n "
        }
    ],
    "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
    }
}