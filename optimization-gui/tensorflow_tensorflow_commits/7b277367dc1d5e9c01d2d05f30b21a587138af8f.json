{
    "author": "ermilovmaxim",
    "message": "Remove inheritance of GpuComputeCapability from std::variant\n\nPiperOrigin-RevId: 822701900",
    "sha": "7b277367dc1d5e9c01d2d05f30b21a587138af8f",
    "files": [
        {
            "sha": "967f0e0602697643e25226f920613750d892fba8",
            "filename": "third_party/xla/xla/stream_executor/device_description.h",
            "status": "modified",
            "additions": 30,
            "deletions": 13,
            "changes": 43,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b277367dc1d5e9c01d2d05f30b21a587138af8f/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b277367dc1d5e9c01d2d05f30b21a587138af8f/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h?ref=7b277367dc1d5e9c01d2d05f30b21a587138af8f",
            "patch": "@@ -23,7 +23,6 @@ limitations under the License.\n #include <cassert>\n #include <cstdint>\n #include <string>\n-#include <type_traits>\n #include <utility>\n #include <variant>\n \n@@ -36,26 +35,40 @@ limitations under the License.\n \n namespace stream_executor {\n \n-class GpuComputeCapability\n-    : public std::variant<CudaComputeCapability, RocmComputeCapability> {\n+class GpuComputeCapability {\n  public:\n-  using std::variant<CudaComputeCapability, RocmComputeCapability>::variant;\n-  using std::variant<CudaComputeCapability, RocmComputeCapability>::operator=;\n+  GpuComputeCapability() = default;\n+  GpuComputeCapability(const CudaComputeCapability& compute_capability)\n+      : compute_capability_(compute_capability) {}\n+  explicit GpuComputeCapability(const RocmComputeCapability& compute_capability)\n+      : compute_capability_(compute_capability) {}\n+\n+  GpuComputeCapability& operator=(\n+      const CudaComputeCapability& compute_capability) {\n+    compute_capability_ = compute_capability;\n+    return *this;\n+  }\n+\n+  GpuComputeCapability& operator=(\n+      const RocmComputeCapability& compute_capability) {\n+    compute_capability_ = compute_capability;\n+    return *this;\n+  }\n \n   bool IsCuda() const {\n-    return std::holds_alternative<CudaComputeCapability>(*this);\n+    return std::holds_alternative<CudaComputeCapability>(compute_capability_);\n   }\n \n   bool IsRocm() const {\n-    return std::holds_alternative<RocmComputeCapability>(*this);\n+    return std::holds_alternative<RocmComputeCapability>(compute_capability_);\n   }\n \n   const CudaComputeCapability* cuda_compute_capability() const {\n-    return std::get_if<CudaComputeCapability>(this);\n+    return std::get_if<CudaComputeCapability>(&compute_capability_);\n   }\n \n   const RocmComputeCapability* rocm_compute_capability() const {\n-    return std::get_if<RocmComputeCapability>(this);\n+    return std::get_if<RocmComputeCapability>(&compute_capability_);\n   }\n \n   std::string ToString() const {\n@@ -64,6 +77,10 @@ class GpuComputeCapability\n     }\n     return rocm_compute_capability()->ToString();\n   }\n+\n+ private:\n+  std::variant<CudaComputeCapability, RocmComputeCapability>\n+      compute_capability_;\n };\n \n // Data that describes the execution target of the StreamExecutor, in terms of\n@@ -273,10 +290,6 @@ class DeviceDescription {\n   // value will be provided.\n   static inline const char* const kUndefinedString = \"<undefined>\";\n \n-  void set_gpu_compute_capability(const GpuComputeCapability& c) {\n-    gpu_compute_capability_ = c;\n-  }\n-\n   void set_block_dim_limit_x(int64_t limit) { block_dim_limit_.x = limit; }\n \n   void set_block_dim_limit_y(int64_t limit) { block_dim_limit_.y = limit; }\n@@ -340,6 +353,10 @@ class DeviceDescription {\n \n   void set_clock_rate_ghz(float value) { clock_rate_ghz_ = value; }\n \n+  void set_gpu_compute_capability(const GpuComputeCapability& c) {\n+    gpu_compute_capability_ = c;\n+  }\n+\n   void set_cuda_compute_capability(const CudaComputeCapability& cc) {\n     gpu_compute_capability_ = cc;\n   }"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 30,
        "deletions": 13
    }
}