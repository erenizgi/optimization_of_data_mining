{
    "author": "chsigg",
    "message": "Simplify `tf_vendored` repo rule.\n\nPiperOrigin-RevId: 814099609",
    "sha": "239c89159cdc14428d2c14a67c7b678e24cff837",
    "files": [
        {
            "sha": "adabcc54fc586d854a364a7fdd964b93da3e613b",
            "filename": "tensorflow/workspace3.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/239c89159cdc14428d2c14a67c7b678e24cff837/tensorflow%2Fworkspace3.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/239c89159cdc14428d2c14a67c7b678e24cff837/tensorflow%2Fworkspace3.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fworkspace3.bzl?ref=239c89159cdc14428d2c14a67c7b678e24cff837",
            "patch": "@@ -5,8 +5,8 @@ load(\"//third_party:repo.bzl\", \"tf_vendored\")\n load(\"//third_party/tf_runtime:workspace.bzl\", tf_runtime = \"repo\")\n \n def workspace():\n-    tf_vendored(name = \"local_xla\", relpath = \"third_party/xla\")\n-    tf_vendored(name = \"local_tsl\", relpath = \"third_party/xla/third_party/tsl\")\n+    tf_vendored(name = \"local_xla\", path = \"third_party/xla\")\n+    tf_vendored(name = \"local_tsl\", path = \"third_party/xla/third_party/tsl\")\n \n     http_archive(\n         name = \"io_bazel_rules_closure\","
        },
        {
            "sha": "05907086249e01d426abae0722b87ca51ba9aa36",
            "filename": "third_party/repo.bzl",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Frepo.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Frepo.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Frepo.bzl?ref=239c89159cdc14428d2c14a67c7b678e24cff837",
            "patch": "@@ -140,21 +140,16 @@ def tf_http_archive(name, sha256, urls, **kwargs):\n         **kwargs\n     )\n \n-def _tf_vendored_impl(repository_ctx):\n-    parent_path = repository_ctx.path(repository_ctx.attr.parent).dirname\n-\n-    # get_child doesn't allow slashes. Yes this is silly. bazel_skylib paths\n-    # doesn't work with path objects.\n-    relpath_parts = repository_ctx.attr.relpath.split(\"/\")\n-    vendored_path = parent_path\n-    for part in relpath_parts:\n-        vendored_path = vendored_path.get_child(part)\n-    repository_ctx.symlink(vendored_path, \".\")\n+def _tf_vendored_impl(ctx):\n+    ctx.symlink(ctx.path(ctx.attr._root).dirname.get_child(ctx.attr.path), \".\")\n \n tf_vendored = repository_rule(\n     implementation = _tf_vendored_impl,\n+    doc = \"Similar to local_repository, but path is relative to the root of the \" +\n+          \"repository, not the root of the workspace.\",\n     attrs = {\n-        \"parent\": attr.label(default = \"//:WORKSPACE\"),\n-        \"relpath\": attr.string(),\n+        \"_root\": attr.label(default = \"//:unused\"),\n+        \"path\": attr.string(),\n     },\n+    local = True,\n )"
        },
        {
            "sha": "326276e11d95f8209c76f1c7a3136c7e692c9eb8",
            "filename": "third_party/xla/third_party/repo.bzl",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Fxla%2Fthird_party%2Frepo.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Fxla%2Fthird_party%2Frepo.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Frepo.bzl?ref=239c89159cdc14428d2c14a67c7b678e24cff837",
            "patch": "@@ -138,21 +138,16 @@ def tf_http_archive(name, sha256, urls, **kwargs):\n         **kwargs\n     )\n \n-def _tf_vendored_impl(repository_ctx):\n-    parent_path = repository_ctx.path(repository_ctx.attr.parent).dirname\n-\n-    # get_child doesn't allow slashes. Yes this is silly. bazel_skylib paths\n-    # doesn't work with path objects.\n-    relpath_parts = repository_ctx.attr.relpath.split(\"/\")\n-    vendored_path = parent_path\n-    for part in relpath_parts:\n-        vendored_path = vendored_path.get_child(part)\n-    repository_ctx.symlink(vendored_path, \".\")\n+def _tf_vendored_impl(ctx):\n+    ctx.symlink(ctx.path(ctx.attr._root).dirname.get_child(ctx.attr.path), \".\")\n \n tf_vendored = repository_rule(\n     implementation = _tf_vendored_impl,\n+    doc = \"Similar to local_repository, but path is relative to the root of the \" +\n+          \"repository, not the root of the workspace.\",\n     attrs = {\n-        \"parent\": attr.label(default = \"//:WORKSPACE\"),\n-        \"relpath\": attr.string(),\n+        \"_root\": attr.label(default = \"//:unused\"),\n+        \"path\": attr.string(),\n     },\n+    local = True,\n )"
        },
        {
            "sha": "446c70dab328ae3a79f96b410ca361758a12828f",
            "filename": "third_party/xla/workspace4.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Fxla%2Fworkspace4.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/239c89159cdc14428d2c14a67c7b678e24cff837/third_party%2Fxla%2Fworkspace4.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fworkspace4.bzl?ref=239c89159cdc14428d2c14a67c7b678e24cff837",
            "patch": "@@ -6,7 +6,7 @@ load(\"//third_party:repo.bzl\", \"tf_vendored\")\n # buildifier: disable=unnamed-macro\n def workspace():\n     # Declares @tsl\n-    tf_vendored(name = \"tsl\", relpath = \"third_party/tsl\")\n+    tf_vendored(name = \"tsl\", path = \"third_party/tsl\")\n \n # Alias so it can be loaded without assigning to a different symbol to prevent\n # shadowing previous loads and trigger a buildifier warning."
        }
    ],
    "stats": {
        "total": 44,
        "additions": 17,
        "deletions": 27
    }
}