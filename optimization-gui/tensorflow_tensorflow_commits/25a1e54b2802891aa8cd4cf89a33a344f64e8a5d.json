{
    "author": "majnemer",
    "message": "Remove `tsl::NullTerminatedMessage` and `tsl::TfCheckOpHelper`.\n\nThis change removes the `tsl::NullTerminatedMessage` utility, replacing its uses with `absl::StatusMessageAsCStr`. It also removes the `tsl::TfCheckOpHelper` and `tsl::TfCheckOpHelperOutOfLine` functions, and updates the `TF_CHECK_OK`, `TF_QCHECK_OK`, and `TF_DCHECK_OK` macros to directly use the standard `CHECK_OK`, `QCHECK_OK`, and `DCHECK_OK` macros.\n\nPiperOrigin-RevId: 806794087",
    "sha": "25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
    "files": [
        {
            "sha": "793348248a7ac2ea77507fdacbc02747c35fd892",
            "filename": "tensorflow/core/platform/status.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fcore%2Fplatform%2Fstatus.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fcore%2Fplatform%2Fstatus.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2Fstatus.h?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -36,8 +36,6 @@ using Status ABSL_DEPRECATE_AND_INLINE() = ::absl::Status;\n #endif\n using tsl::StatusCallback;\n using tsl::StatusGroup;\n-using tsl::TfCheckOpHelper;\n-using tsl::TfCheckOpHelperOutOfLine;\n \n namespace errors {\n #ifdef SWIG"
        },
        {
            "sha": "66ae41086b2001cdf1d1e30384cce37cd1a6f0d4",
            "filename": "tensorflow/dtensor/cc/dtensor_device_util.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fdtensor%2Fcc%2Fdtensor_device_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fdtensor%2Fcc%2Fdtensor_device_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fdtensor%2Fcc%2Fdtensor_device_util.h?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -26,6 +26,7 @@ limitations under the License.\n #include <vector>\n \n #include \"absl/memory/memory.h\"\n+#include \"absl/status/status.h\"\n #include \"llvm/Support/ExtensibleRTTI.h\"\n #include \"mlir/IR/BuiltinOps.h\"  // from @llvm-project\n #include \"mlir/IR/OwningOpRef.h\"  // from @llvm-project\n@@ -69,7 +70,7 @@ using TensorHandlePtr = tensorflow::Safe_TFE_TensorHandlePtr;\n     if (!return_if_not_ok_status.ok()) {                                  \\\n       RETURN_STATUS((c_status),                                           \\\n                     static_cast<TF_Code>(return_if_not_ok_status.code()), \\\n-                    tsl::NullTerminatedMessage(return_if_not_ok_status)); \\\n+                    absl::StatusMessageAsCStr(return_if_not_ok_status));  \\\n     }                                                                     \\\n   }\n "
        },
        {
            "sha": "cabdd9b83c52037c5c3bbc0969b2dc5920e68ea4",
            "filename": "tensorflow/python/_pywrap_tensorflow.def",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2F_pywrap_tensorflow.def?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -497,6 +497,7 @@ EXPORTS\n   ?Lookup@PyExceptionRegistry@tensorflow@@SAPEAU_object@@W4TSL_Code@@@Z\n   ?Main@tfcompile@tensorflow@@YA?AVStatus@lts_20250512@absl@@AEBUMainFlags@12@@Z\n   ?MainOpsFanin@GrapplerItem@grappler@tensorflow@@QEBA?AV?$vector@PEBVNodeDef@tensorflow@@V?$allocator@PEBVNodeDef@tensorflow@@@std@@@std@@XZ\n+  ?MakeCheckFailString@status_internal@lts_20250512@absl@@YAPEBDPEBVStatus@23@PEBD@Z\n   ?MakeEagerContextThreadLocalData@tensorflow@@YAXPEAU_object@@00@Z\n   ?MakeFingerprintJson@metrics@tensorflow@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@VFingerprintDef@2@@Z\n   ?MakeRefCountingHandle@ResourceHandle@tensorflow@@SA?AV12@PEAVResourceBase@2@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@AEBVTypeIndex@2@AEBV?$vector@UDtypeAndPartialTensorShape@tensorflow@@V?$allocator@UDtypeAndPartialTensorShape@tensorflow@@@std@@@5@AEBV?$optional@VManagedStackTrace@tensorflow@@@5@@Z\n@@ -531,7 +532,6 @@ EXPORTS\n   ?NewWorkerServer@data@tensorflow@@YA?AVStatus@lts_20250512@absl@@AEBVWorkerConfig@experimental@12@AEAV?$unique_ptr@VWorkerGrpcDataServer@data@tensorflow@@U?$default_delete@VWorkerGrpcDataServer@data@tensorflow@@@std@@@std@@@Z\n   ?NewWritableFile@Env@tsl@@QEAA?AVStatus@lts_20250512@absl@@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@PEAV?$unique_ptr@VWritableFile@tsl@@U?$default_delete@VWritableFile@tsl@@@std@@@7@@Z\n   ?NotFoundError@lts_20250512@absl@@YA?AVStatus@12@V?$basic_string_view@DU?$char_traits@D@std@@@std@@@Z\n-  ?NullTerminatedMessage@tsl@@YAPEBDAEBVStatus@lts_20250512@absl@@@Z\n   ?NumCheckpointShardsWritten@metrics@tensorflow@@YAAEAVCounterCell@monitoring@tsl@@XZ\n   ?NumTasks@WorkerGrpcDataServer@data@tensorflow@@QEAA?AVStatus@lts_20250512@absl@@PEAH@Z\n   ?NumWorkers@DispatchGrpcDataServer@data@tensorflow@@QEAA?AVStatus@lts_20250512@absl@@PEAH@Z\n@@ -732,7 +732,6 @@ EXPORTS\n   ?TPUCoreLocationsToIDs@dtensor@tensorflow@@YA?AV?$vector@HV?$allocator@H@std@@@std@@PEAUTFE_Context@@AEBV?$vector@V?$vector@HV?$allocator@H@std@@@std@@V?$allocator@V?$vector@HV?$allocator@H@std@@@std@@@2@@4@PEAX@Z\n   ?TensorToNdarray@tensorflow@@YA?AVStatus@lts_20250512@absl@@AEBVTensor@1@PEAPEAU_object@@@Z\n   ?TestCounter@metrics@tensorflow@@YAPEBVCounterCell@monitoring@tsl@@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@0@Z\n-  ?TfCheckOpHelperOutOfLine@tsl@@YAPEAV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@AEBVStatus@lts_20250512@absl@@PEBD@Z\n   ?ThrowBadStatusOrAccess@internal_statusor@lts_20250512@absl@@YAXVStatus@23@@Z\n   ?ThrowStdOutOfRange@base_internal@lts_20250512@absl@@YAXPEBD@Z\n   ?ToDeviceType@Mesh@dtensor@tensorflow@@QEBA?AV?$StatusOr@VMesh@dtensor@tensorflow@@@lts_20250512@absl@@AEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z"
        },
        {
            "sha": "9fd4238ce645ee8f6ffdaeb3aaf32e9e8b3b769d",
            "filename": "tensorflow/python/lib/core/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2Flib%2Fcore%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2Flib%2Fcore%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Flib%2Fcore%2FBUILD?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -96,6 +96,7 @@ cc_library(\n     deps = [\n         \"//tensorflow/core:protos_all_cc\",\n         \"//tensorflow/core/common_runtime:core_cpu_headers_lib\",\n+        \"@com_google_absl//absl/status\",\n         \"@local_xla//third_party/python_runtime:headers\",\n         \"@pybind11\",\n     ],\n@@ -112,6 +113,7 @@ cc_library(\n     deps = [\n         \":pybind11_status_headers\",\n         \"//tensorflow/core:lib\",\n+        \"@com_google_absl//absl/status\",\n     ],\n )\n "
        },
        {
            "sha": "840625421d48644bd6d0e53ba657a9f011cd464a",
            "filename": "tensorflow/python/lib/core/pybind11_status.h",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2Flib%2Fcore%2Fpybind11_status.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/tensorflow%2Fpython%2Flib%2Fcore%2Fpybind11_status.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Flib%2Fcore%2Fpybind11_status.h?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -18,10 +18,12 @@ limitations under the License.\n \n #include <Python.h>\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"pybind11/cast.h\"  // from @pybind11\n #include \"pybind11/pybind11.h\"  // from @pybind11\n+#include \"pybind11/pytypes.h\"  // from @pybind11\n #include \"tensorflow/c/tf_status_internal.h\"\n-#include \"tensorflow/core/lib/core/status.h\"\n #include \"tensorflow/core/platform/errors.h\"\n #include \"tensorflow/core/platform/statusor.h\"\n #include \"tensorflow/core/protobuf/error_codes.pb.h\"\n@@ -70,8 +72,10 @@ inline pybind11::dict TFStatusPayloadToDict(TF_Status* status) {\n \n inline void MaybeRaiseFromStatus(const absl::Status& status) {\n   if (!status.ok()) {\n-    PyErr_SetString(internal::StatusToPyExc(status),\n-                    tsl::NullTerminatedMessage(status));\n+    absl::string_view status_message = status.message();\n+    pybind11::set_error(\n+        internal::StatusToPyExc(status),\n+        pybind11::str(status_message.data(), status_message.size()));\n     throw pybind11::error_already_set();\n   }\n }"
        },
        {
            "sha": "c2981a28aee33540a0c29a7be99c028857f9f97a",
            "filename": "third_party/xla/xla/tsl/platform/status.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.cc?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -162,22 +162,6 @@ std::vector<StackFrame> GetStackTrace(const absl::Status& status) {\n \n }  // namespace errors\n \n-// NB: This Windows-only implementation is exists only to avoid a linker error.\n-// Remove if this is resolved.\n-#ifdef _WIN32\n-const char* NullTerminatedMessage(const absl::Status& status) {\n-  return absl::StatusMessageAsCStr(status);\n-}\n-#endif\n-\n-std::string* TfCheckOpHelperOutOfLine(const absl::Status& v, const char* msg) {\n-  std::stringstream ss;\n-  ss << \"Non-OK-status: \" << msg << \"\\nStatus: \" << v;\n-\n-  // Leaks string but this is only to be used in a fatal error message\n-  return new std::string(ss.str());\n-}\n-\n StatusGroup::StatusGroup() {}\n \n StatusGroup::StatusGroup(std::initializer_list<absl::Status> statuses) {"
        },
        {
            "sha": "861be5da98ef3578628dddd7ceae694f71d20d89",
            "filename": "third_party/xla/xla/tsl/platform/status.h",
            "status": "modified",
            "additions": 3,
            "deletions": 39,
            "changes": 42,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/25a1e54b2802891aa8cd4cf89a33a344f64e8a5d/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fstatus.h?ref=25a1e54b2802891aa8cd4cf89a33a344f64e8a5d",
            "patch": "@@ -101,23 +101,7 @@ namespace tsl {\n // usage of `OkStatus()` when constructing such an OK status.\n ABSL_DEPRECATE_AND_INLINE() inline absl::Status OkStatus() {\n   return absl::OkStatus();\n-};\n-\n-// Given `Status.message()` does not guarantee to be always backed by a\n-// null-terminated string, we have this utility function when it's needed for\n-// the Tensorflow C-API.\n-// A more robust API would be to get both a `char*` of the beginning of the\n-// string, plus the size (see e.g. `XlaCustomCallStatusSetFailure`).\n-// NB: This Windows-only implementation is exists only to avoid a linker error.\n-// Remove if this is resolved.\n-#ifdef _WIN32\n-const char* NullTerminatedMessage(const absl::Status& status);\n-#else\n-ABSL_DEPRECATE_AND_INLINE()\n-inline const char* NullTerminatedMessage(const absl::Status& status) {\n-  return absl::StatusMessageAsCStr(status);\n }\n-#endif\n \n // TODO(b/197552541) Move this namespace to errors.h.\n namespace errors {\n@@ -186,29 +170,9 @@ class StatusGroup {\n \n typedef std::function<void(const absl::Status&)> StatusCallback;\n \n-extern ::tsl::string* TfCheckOpHelperOutOfLine(const absl::Status& v,\n-                                               const char* msg);\n-\n-inline ::tsl::string* TfCheckOpHelper(absl::Status v, const char* msg) {\n-  if (v.ok()) return nullptr;\n-  return TfCheckOpHelperOutOfLine(v, msg);\n-}\n-\n-#define TF_DO_CHECK_OK(val, level)                          \\\n-  while (auto* _result = ::tsl::TfCheckOpHelper(val, #val)) \\\n-  LOG(level) << *(_result)\n-\n-#define TF_CHECK_OK(val) TF_DO_CHECK_OK(val, FATAL)\n-#define TF_QCHECK_OK(val) TF_DO_CHECK_OK(val, QFATAL)\n-\n-// DEBUG only version of TF_CHECK_OK.  Compiler still parses 'val' even in opt\n-// mode.\n-#ifndef NDEBUG\n-#define TF_DCHECK_OK(val) TF_CHECK_OK(val)\n-#else\n-#define TF_DCHECK_OK(val) \\\n-  while (false && (absl::OkStatus() == (val))) LOG(FATAL)\n-#endif\n+#define TF_CHECK_OK(val) CHECK_OK(val)\n+#define TF_QCHECK_OK(val) QCHECK_OK(val)\n+#define TF_DCHECK_OK(val) DCHECK_OK(val)\n \n }  // namespace tsl\n "
        }
    ],
    "stats": {
        "total": 78,
        "additions": 15,
        "deletions": 63
    }
}