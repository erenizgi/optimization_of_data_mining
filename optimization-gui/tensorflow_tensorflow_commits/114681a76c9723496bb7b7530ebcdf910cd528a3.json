{
    "author": "tensorflower-gardener",
    "message": "Automated Code Change\n\nPiperOrigin-RevId: 845757791",
    "sha": "114681a76c9723496bb7b7530ebcdf910cd528a3",
    "files": [
        {
            "sha": "becff37233c6307af2ef78485e1af91d5d9d58d1",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_channel.cc",
            "status": "modified",
            "additions": 38,
            "deletions": 36,
            "changes": 74,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc?ref=114681a76c9723496bb7b7530ebcdf910cd528a3",
            "patch": "@@ -46,20 +46,20 @@ namespace tsl {\n \n namespace {\n \n-string MakeAddress(const string& job, int replica, int task) {\n+std::string MakeAddress(const std::string& job, int replica, int task) {\n   return strings::StrCat(\"/job:\", job, \"/replica:\", replica, \"/task:\", task);\n }\n \n // Allows the host to be a raw IP (either v4 or v6).\n-absl::Status ValidateHostPortPair(const string& host_port) {\n-  string bns_prefix = \"/bns/\";\n+absl::Status ValidateHostPortPair(const std::string& host_port) {\n+  std::string bns_prefix = \"/bns/\";\n   if (host_port.substr(0, bns_prefix.length()) == bns_prefix) {\n     return absl::OkStatus();\n   }\n-  uint32 port;\n+  uint32_t port;\n   auto colon_index = host_port.find_last_of(':');\n   if (!absl::SimpleAtoi(host_port.substr(colon_index + 1), &port) ||\n-      host_port.substr(0, colon_index).find('/') != string::npos) {\n+      host_port.substr(0, colon_index).find('/') != std::string::npos) {\n     return absl::InvalidArgumentError(absl::StrCat(\n         \"Could not interpret \\\"\", host_port, \"\\\" as a host-port pair.\"));\n   }\n@@ -71,17 +71,18 @@ ::grpc::ChannelArguments* CreateDefaultChannelArguments() {\n   const char* env = std::getenv(\"TF_GRPC_DEFAULT_OPTIONS\");\n   if (env != nullptr) {\n     for (auto& grpc_option : absl::StrSplit(env, ',')) {\n-      std::vector<string> name_value = absl::StrSplit(grpc_option, '=');\n+      std::vector<std::string> name_value = absl::StrSplit(grpc_option, '=');\n       if (name_value.size() != 2) {\n         LOG(ERROR) << \"Invalid GRPC options format: \" << grpc_option;\n         continue;\n       }\n       VLOG(3) << \"Setting GRPC default for '\" << name_value[0] << \"' to '\"\n               << name_value[1] << \"'\";\n       if (name_value[1].size() >= 2 && name_value[1][0] == '\"') {\n-        string ue_value = name_value[1].substr(1, name_value[1].size() - 2);\n-        string value;\n-        string error;\n+        std::string ue_value =\n+            name_value[1].substr(1, name_value[1].size() - 2);\n+        std::string value;\n+        std::string error;\n         if (!absl::CUnescape(ue_value, &value, &error)) {\n           LOG(ERROR) << \"Failed to parse escaped string for \" << grpc_option\n                      << \": \" << error;\n@@ -111,7 +112,7 @@ const ::grpc::ChannelArguments* GetDefaultChannelArguments() {\n ::grpc::ChannelArguments GetChannelArguments(const RPCOptions* rpc_options) {\n   // TODO(mrry): Implement secure channels.\n   ::grpc::ChannelArguments args = *GetDefaultChannelArguments();\n-  args.SetInt(GRPC_ARG_MAX_MESSAGE_LENGTH, std::numeric_limits<int32>::max());\n+  args.SetInt(GRPC_ARG_MAX_MESSAGE_LENGTH, std::numeric_limits<int32_t>::max());\n   // NOTE(mrry): Some versions of gRPC use a 20-second minimum backoff\n   // on connection failure, which makes our tests time out.\n   args.SetInt(GRPC_ARG_MAX_RECONNECT_BACKOFF_MS, 1000);\n@@ -142,7 +143,7 @@ ::grpc::ChannelArguments GetChannelArguments(const RPCOptions* rpc_options) {\n   return args;\n }\n \n-absl::Status NewHostPortGrpcChannel(const string& target,\n+absl::Status NewHostPortGrpcChannel(const std::string& target,\n                                     const RPCOptions* rpc_options,\n                                     SharedGrpcChannelPtr* channel_pointer) {\n   // Minimally ensure that the target is valid\n@@ -155,10 +156,11 @@ absl::Status NewHostPortGrpcChannel(const string& target,\n }\n \n ChannelCreationFunction ConvertToChannelCreationFunction(\n-    const std::function<absl::Status(string, const RPCOptions*,\n+    const std::function<absl::Status(std::string, const RPCOptions*,\n                                      SharedGrpcChannelPtr*)>&\n         new_channel_func_ptr) {\n-  return [new_channel_func_ptr](const string& target) -> SharedGrpcChannelPtr {\n+  return [new_channel_func_ptr](\n+             const std::string& target) -> SharedGrpcChannelPtr {\n     SharedGrpcChannelPtr channel_ptr;\n     if (new_channel_func_ptr(target, /*rpc_options=*/nullptr, &channel_ptr)\n             .ok()) {\n@@ -170,7 +172,7 @@ ChannelCreationFunction ConvertToChannelCreationFunction(\n }\n \n absl::Status GrpcChannelSpec::AddHostPortsJob(\n-    const string& job_id, const std::map<int, string>& host_ports) {\n+    const std::string& job_id, const std::map<int, std::string>& host_ports) {\n   if (!job_ids_.insert(job_id).second) {\n     return absl::InvalidArgumentError(\n         absl::StrCat(\"Duplicate job ID in cluster specification: \", job_id));\n@@ -201,25 +203,25 @@ class MultiGrpcChannelCache : public CachingGrpcChannelCache {\n     }\n   }\n \n-  void ListWorkers(std::vector<string>* workers) override {\n+  void ListWorkers(std::vector<std::string>* workers) override {\n     for (GrpcChannelCache* cache : caches_) {\n       cache->ListWorkers(workers);\n     }\n   }\n \n-  void ListWorkersInJob(const string& job_name,\n-                        std::vector<string>* workers) override {\n+  void ListWorkersInJob(const std::string& job_name,\n+                        std::vector<std::string>* workers) override {\n     for (GrpcChannelCache* cache : caches_) {\n       cache->ListWorkersInJob(job_name, workers);\n     }\n   }\n \n-  string TranslateTask(const string& target) override {\n+  std::string TranslateTask(const std::string& target) override {\n     absl::MutexLock l(mu_);  // could use reader lock\n     GrpcChannelCache* cache = gtl::FindPtrOrNull(target_caches_, target);\n     if (cache == nullptr) {\n       for (GrpcChannelCache* c : caches_) {\n-        string r = c->TranslateTask(target);\n+        std::string r = c->TranslateTask(target);\n         if (!r.empty()) {\n           target_caches_.insert({target, c});\n           cache = c;\n@@ -233,7 +235,7 @@ class MultiGrpcChannelCache : public CachingGrpcChannelCache {\n   }\n \n  protected:\n-  SharedGrpcChannelPtr FindChannelOnce(const string& target) override {\n+  SharedGrpcChannelPtr FindChannelOnce(const std::string& target) override {\n     for (GrpcChannelCache* cache : caches_) {\n       SharedGrpcChannelPtr ch(cache->FindWorkerChannel(target));\n       if (ch) {\n@@ -252,14 +254,14 @@ class MultiGrpcChannelCache : public CachingGrpcChannelCache {\n   absl::Mutex mu_;\n   // Cache of channels keyed by the target they are handling.\n   // The same GrpcChannelCache can appear multiple times in the cache.\n-  std::unordered_map<string, GrpcChannelCache*> target_caches_\n+  std::unordered_map<std::string, GrpcChannelCache*> target_caches_\n       TF_GUARDED_BY(mu_);\n };\n \n class SparseGrpcChannelCache : public CachingGrpcChannelCache {\n  public:\n-  SparseGrpcChannelCache(const string& job_id,\n-                         const std::map<int, string>& host_ports,\n+  SparseGrpcChannelCache(const std::string& job_id,\n+                         const std::map<int, std::string>& host_ports,\n                          ChannelCreationFunction channel_func,\n                          int num_channels_per_target)\n       : CachingGrpcChannelCache(num_channels_per_target),\n@@ -270,7 +272,7 @@ class SparseGrpcChannelCache : public CachingGrpcChannelCache {\n   }\n   ~SparseGrpcChannelCache() override {}\n \n-  void ListWorkers(std::vector<string>* workers) override {\n+  void ListWorkers(std::vector<std::string>* workers) override {\n     workers->reserve(workers->size() + host_ports_.size());\n     for (const auto& id_host_port : host_ports_) {\n       std::vector<std::string> replicas =\n@@ -282,14 +284,14 @@ class SparseGrpcChannelCache : public CachingGrpcChannelCache {\n     }\n   }\n \n-  void ListWorkersInJob(const string& job_name,\n-                        std::vector<string>* workers) override {\n+  void ListWorkersInJob(const std::string& job_name,\n+                        std::vector<std::string>* workers) override {\n     if (job_name == job_id_) {\n       ListWorkers(workers);\n     }\n   }\n \n-  string TranslateTask(const string& target) override {\n+  std::string TranslateTask(const std::string& target) override {\n     DeviceNameUtils::ParsedName parsed;\n     if (!DeviceNameUtils::ParseFullName(target, &parsed)) {\n       LOG(WARNING) << \"Invalid target: \" << target;\n@@ -319,8 +321,8 @@ class SparseGrpcChannelCache : public CachingGrpcChannelCache {\n   }\n \n  protected:\n-  SharedGrpcChannelPtr FindChannelOnce(const string& target) override {\n-    const string host_port = TranslateTask(target);\n+  SharedGrpcChannelPtr FindChannelOnce(const std::string& target) override {\n+    const std::string host_port = TranslateTask(target);\n     if (host_port.empty()) {\n       return nullptr;\n     }\n@@ -332,19 +334,19 @@ class SparseGrpcChannelCache : public CachingGrpcChannelCache {\n   }\n \n  private:\n-  string ToString() {\n-    std::vector<string> task_strings;\n+  std::string ToString() {\n+    std::vector<std::string> task_strings;\n     task_strings.reserve(host_ports_.size());\n     for (const auto& id_host_port : host_ports_) {\n       task_strings.emplace_back(\n-          strings::StrCat(id_host_port.first, \" -> \", id_host_port.second));\n+          absl::StrCat(id_host_port.first, \" -> \", id_host_port.second));\n     }\n-    return strings::StrCat(job_id_, \" -> {\", absl::StrJoin(task_strings, \", \"),\n-                           \"}\");\n+    return absl::StrCat(job_id_, \" -> {\", absl::StrJoin(task_strings, \", \"),\n+                        \"}\");\n   }\n \n-  const string job_id_;\n-  const std::map<int, string> host_ports_;\n+  const std::string job_id_;\n+  const std::map<int, std::string> host_ports_;\n   const ChannelCreationFunction channel_func_;\n   SparseGrpcChannelCache(const SparseGrpcChannelCache&) = delete;\n   void operator=(const SparseGrpcChannelCache&) = delete;"
        },
        {
            "sha": "7611409f93642492de4686a6633bd04c33c7f864",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_channel.h",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.h?ref=114681a76c9723496bb7b7530ebcdf910cd528a3",
            "patch": "@@ -37,22 +37,23 @@ using tensorflow::RPCOptions;\n class GrpcChannelSpec {\n  public:\n   struct HostPortsJob {\n-    HostPortsJob(const string& job_id, const std::map<int, string>& host_ports)\n+    HostPortsJob(const std::string& job_id,\n+                 const std::map<int, std::string>& host_ports)\n         : job_id(job_id), host_ports(host_ports) {}\n-    const string job_id;\n-    const std::map<int, string> host_ports;\n+    const std::string job_id;\n+    const std::map<int, std::string> host_ports;\n   };\n \n-  absl::Status AddHostPortsJob(const string& job_id,\n-                               const std::map<int, string>& host_ports);\n+  absl::Status AddHostPortsJob(const std::string& job_id,\n+                               const std::map<int, std::string>& host_ports);\n \n   const std::vector<HostPortsJob>& host_ports_jobs() const {\n     return host_ports_jobs_;\n   }\n \n  private:\n   std::vector<HostPortsJob> host_ports_jobs_;\n-  std::set<string> job_ids_;\n+  std::set<std::string> job_ids_;\n };\n \n class GrpcChannelCache {\n@@ -63,21 +64,22 @@ class GrpcChannelCache {\n   // was created to handle.  Worker names are in the format\n   //  /job:<job identifier>/task:<task id>\n   // e.g. /job:mnist/task:2\n-  virtual void ListWorkers(std::vector<string>* workers) = 0;\n-  virtual void ListWorkersInJob(const string& job_name,\n-                                std::vector<string>* workers) = 0;\n+  virtual void ListWorkers(std::vector<std::string>* workers) = 0;\n+  virtual void ListWorkersInJob(const std::string& job_name,\n+                                std::vector<std::string>* workers) = 0;\n \n   // If found, returns a gRPC channel that is connected to the remote\n   // worker named by 'target'. 'target' is of the following\n   // format: /job:<job identifier>/task:<task id>\n   // E.g., /job:mnist/task:2\n-  virtual SharedGrpcChannelPtr FindWorkerChannel(const string& target) = 0;\n+  virtual SharedGrpcChannelPtr FindWorkerChannel(const std::string& target) = 0;\n \n   // Translates a string in the form `/job:X/task:Z` into a host_port.\n-  virtual string TranslateTask(const string& task) = 0;\n+  virtual std::string TranslateTask(const std::string& task) = 0;\n };\n \n-typedef std::function<SharedGrpcChannelPtr(string)> ChannelCreationFunction;\n+typedef std::function<SharedGrpcChannelPtr(std::string)>\n+    ChannelCreationFunction;\n \n GrpcChannelCache* NewGrpcChannelCache(\n     const GrpcChannelSpec& channel_spec, ChannelCreationFunction channel_func,\n@@ -92,7 +94,7 @@ ChannelCreationFunction ConvertToChannelCreationFunction(\n                                      SharedGrpcChannelPtr*)>&\n         new_channel_func_ptr);\n \n-absl::Status NewHostPortGrpcChannel(const string& target,\n+absl::Status NewHostPortGrpcChannel(const std::string& target,\n                                     const RPCOptions* rpc_options,\n                                     SharedGrpcChannelPtr* channel_pointer);\n "
        },
        {
            "sha": "5d4940cbccdfe0eb59bf928abbbf32bd5e994c46",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_channel_test.cc",
            "status": "modified",
            "additions": 30,
            "deletions": 30,
            "changes": 60,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/114681a76c9723496bb7b7530ebcdf910cd528a3/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel_test.cc?ref=114681a76c9723496bb7b7530ebcdf910cd528a3",
            "patch": "@@ -95,29 +95,29 @@ TEST(GrpcChannelTest, HostPorts) {\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkers(&workers);\n     EXPECT_EQ(\n-        std::vector<string>(\n+        std::vector<std::string>(\n             {\"/job:mnist/replica:0/task:0\", \"/job:mnist/replica:0/task:1\",\n              \"/job:mnist/replica:0/task:2\", \"/job:mnist/replica:0/task:3\",\n              \"/job:mnist/replica:0/task:4\", \"/job:mnist/replica:0/task:5\"}),\n         workers);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"mnist\", &workers);\n     EXPECT_EQ(\n-        std::vector<string>(\n+        std::vector<std::string>(\n             {\"/job:mnist/replica:0/task:0\", \"/job:mnist/replica:0/task:1\",\n              \"/job:mnist/replica:0/task:2\", \"/job:mnist/replica:0/task:3\",\n              \"/job:mnist/replica:0/task:4\", \"/job:mnist/replica:0/task:5\"}),\n         workers);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"other\", &workers);\n     EXPECT_TRUE(workers.empty());\n   }\n@@ -179,25 +179,25 @@ TEST(GrpcChannelTest, HostPortsMultiChannelPerTarget) {\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkers(&workers);\n-    EXPECT_EQ(std::vector<string>({\"/job:mnist/replica:0/task:0\",\n-                                   \"/job:mnist/replica:0/task:1\",\n-                                   \"/job:mnist/replica:0/task:2\"}),\n+    EXPECT_EQ(std::vector<std::string>({\"/job:mnist/replica:0/task:0\",\n+                                        \"/job:mnist/replica:0/task:1\",\n+                                        \"/job:mnist/replica:0/task:2\"}),\n               workers);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"mnist\", &workers);\n-    EXPECT_EQ(std::vector<string>({\"/job:mnist/replica:0/task:0\",\n-                                   \"/job:mnist/replica:0/task:1\",\n-                                   \"/job:mnist/replica:0/task:2\"}),\n+    EXPECT_EQ(std::vector<std::string>({\"/job:mnist/replica:0/task:0\",\n+                                        \"/job:mnist/replica:0/task:1\",\n+                                        \"/job:mnist/replica:0/task:2\"}),\n               workers);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"other\", &workers);\n     EXPECT_TRUE(workers.empty());\n   }\n@@ -262,32 +262,32 @@ TEST(GrpcChannelTest, HostPortsMultiGrpcMultiChannelPerTarget) {\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkers(&workers);\n     EXPECT_EQ(\n-        std::vector<string>(\n+        std::vector<std::string>(\n             {\"/job:mnist/replica:0/task:0\", \"/job:mnist/replica:0/task:1\",\n              \"/job:mnist/replica:0/task:2\", \"/job:mnist2/replica:0/task:0\",\n              \"/job:mnist2/replica:0/task:1\", \"/job:mnist2/replica:0/task:2\"}),\n         workers);\n   }\n \n   {\n-    std::vector<string> workers, workers2;\n+    std::vector<std::string> workers, workers2;\n     cc->ListWorkersInJob(\"mnist\", &workers);\n-    EXPECT_EQ(std::vector<string>({\"/job:mnist/replica:0/task:0\",\n-                                   \"/job:mnist/replica:0/task:1\",\n-                                   \"/job:mnist/replica:0/task:2\"}),\n+    EXPECT_EQ(std::vector<std::string>({\"/job:mnist/replica:0/task:0\",\n+                                        \"/job:mnist/replica:0/task:1\",\n+                                        \"/job:mnist/replica:0/task:2\"}),\n               workers);\n     cc->ListWorkersInJob(\"mnist2\", &workers2);\n-    EXPECT_EQ(std::vector<string>({\"/job:mnist2/replica:0/task:0\",\n-                                   \"/job:mnist2/replica:0/task:1\",\n-                                   \"/job:mnist2/replica:0/task:2\"}),\n+    EXPECT_EQ(std::vector<std::string>({\"/job:mnist2/replica:0/task:0\",\n+                                        \"/job:mnist2/replica:0/task:1\",\n+                                        \"/job:mnist2/replica:0/task:2\"}),\n               workers2);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"other\", &workers);\n     EXPECT_TRUE(workers.empty());\n   }\n@@ -332,17 +332,17 @@ TEST(GrpcChannelTest, SparseHostPorts) {\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkers(&workers);\n     std::sort(workers.begin(), workers.end());\n-    EXPECT_EQ(std::vector<string>({\"/job:mnist/replica:0/task:0\",\n-                                   \"/job:mnist/replica:0/task:3\",\n-                                   \"/job:mnist/replica:0/task:4\"}),\n+    EXPECT_EQ(std::vector<std::string>({\"/job:mnist/replica:0/task:0\",\n+                                        \"/job:mnist/replica:0/task:3\",\n+                                        \"/job:mnist/replica:0/task:4\"}),\n               workers);\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"mnist\", &workers);\n     EXPECT_EQ(std::vector<std::string>({\"/job:mnist/replica:0/task:0\",\n                                         \"/job:mnist/replica:0/task:3\",\n@@ -351,7 +351,7 @@ TEST(GrpcChannelTest, SparseHostPorts) {\n   }\n \n   {\n-    std::vector<string> workers;\n+    std::vector<std::string> workers;\n     cc->ListWorkersInJob(\"other\", &workers);\n     EXPECT_TRUE(workers.empty());\n   }"
        }
    ],
    "stats": {
        "total": 162,
        "additions": 83,
        "deletions": 79
    }
}