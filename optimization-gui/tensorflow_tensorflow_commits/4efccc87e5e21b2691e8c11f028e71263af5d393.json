{
    "author": "tensorflower-gardener",
    "message": "[TFRT]Update batch size rounding to consider batch priority.\n\n- The two places where call the `RoundToLowestAllowedBatchSize` function now include a call to `IsLowPriorityBatch`, ensuring the processed batch size is consistent with the batch size generated in ConcatInputTensors and SplitOutputTensors.\n\nPiperOrigin-RevId: 817389197",
    "sha": "4efccc87e5e21b2691e8c11f028e71263af5d393",
    "files": [
        {
            "sha": "ae4d32598ef73b6b9ce2f45b2747acf45658d54c",
            "filename": "tensorflow/core/kernels/batching_util/batch_resource_base.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4efccc87e5e21b2691e8c11f028e71263af5d393/tensorflow%2Fcore%2Fkernels%2Fbatching_util%2Fbatch_resource_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4efccc87e5e21b2691e8c11f028e71263af5d393/tensorflow%2Fcore%2Fkernels%2Fbatching_util%2Fbatch_resource_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fbatching_util%2Fbatch_resource_base.cc?ref=4efccc87e5e21b2691e8c11f028e71263af5d393",
            "patch": "@@ -1053,7 +1053,8 @@ void BatchResourceBase::ProcessFuncBatch(\n   std::vector<Tensor> concatenated_tensors;\n   status = ConcatInputTensors(*batch, unbatched_tasks, last_task_context,\n                               &concatenated_tensors);\n-  processed_size = RoundToLowestAllowedBatchSize(batch->size());\n+  processed_size =\n+      RoundToLowestAllowedBatchSize(batch->size(), IsLowPriorityBatch(*batch));\n   if (!status.ok()) {\n     return;\n   }\n@@ -1136,7 +1137,8 @@ void BatchResourceBase::ProcessBatch(std::unique_ptr<BatchT> batch) const {\n   std::vector<Tensor> concatenated_tensors;\n   const absl::Status concat_status =\n       ConcatInputTensors(*batch, {}, last_task_context, &concatenated_tensors);\n-  processed_size = RoundToLowestAllowedBatchSize(batch->size());\n+  processed_size =\n+      RoundToLowestAllowedBatchSize(batch->size(), IsLowPriorityBatch(*batch));\n   OP_REQUIRES_OK_ASYNC(last_task_context, concat_status, last_task_callback);\n \n   // Process each input edge one at a time (the typical case has just one)."
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}