{
    "author": "ermilovmaxim",
    "message": "switch from deprecated TF_CHECK_OK\n\nPiperOrigin-RevId: 848237348",
    "sha": "4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
    "files": [
        {
            "sha": "1ed658d73f1a4a5a13b7b2f8421784b22d44e454",
            "filename": "tensorflow/compiler/jit/BUILD",
            "status": "modified",
            "additions": 62,
            "deletions": 16,
            "changes": 78,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2FBUILD?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -256,22 +256,36 @@ cc_library(\n     hdrs = [\"xla_device_context.h\"],\n     visibility = [\"//visibility:public\"],\n     deps = [\n-        \":xla_launch_util\",\n         \":xla_tensor\",\n         \"//tensorflow/compiler/tf2xla:common\",\n         \"//tensorflow/compiler/tf2xla:layout_util\",\n         \"//tensorflow/compiler/tf2xla:xla_compiler\",\n         \"//tensorflow/compiler/tf2xla:xla_helpers\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:framework_internal\",\n+        \"//tensorflow/core:lib\",\n         \"//tensorflow/core:lib_proto_parsing\",\n-        \"//tensorflow/core/common_runtime:device\",\n         \"//tensorflow/core/common_runtime:dma_helper\",\n         \"//tensorflow/core/framework:allocator\",\n+        \"//tensorflow/core/platform:errors\",\n+        \"//tensorflow/core/platform:status\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:statusor\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@com_google_absl//absl/synchronization\",\n-        \"@local_tsl//tsl/platform:statusor\",\n-        \"@local_xla//xla:util\",\n+        \"@local_xla//xla:literal\",\n+        \"@local_xla//xla:shape_util\",\n+        \"@local_xla//xla:status_macros\",\n         \"@local_xla//xla/client:local_client\",\n+        \"@local_xla//xla/service:stream_pool\",\n+        \"@local_xla//xla/stream_executor:allocator_stats\",\n+        \"@local_xla//xla/stream_executor:event\",\n+        \"@local_xla//xla/stream_executor:stream\",\n+        \"@local_xla//xla/stream_executor:stream_executor_h\",\n+        \"@local_xla//xla/tsl/platform:errors\",\n+        \"@local_xla//xla/tsl/platform:statusor\",\n     ],\n )\n \n@@ -685,7 +699,9 @@ tf_cc_test(\n     name = \"xla_launch_util_test\",\n     srcs = [\"xla_launch_util_test.cc\"],\n     deps = [\n+        \":device_compilation_profiler\",\n         \":device_compiler\",\n+        \":device_executable_persistor\",\n         \":flags_headers\",\n         \":pjrt_device_compiler_client\",\n         \":variable_info\",\n@@ -694,25 +710,35 @@ tf_cc_test(\n         \":xla_cpu_jit\",\n         \":xla_device_no_jit_rewrite_registration\",\n         \":xla_launch_util\",\n+        \"//tensorflow/compiler/tf2xla:xla_compiler\",\n         \"//tensorflow/compiler/tf2xla:xla_op_registry\",\n         \"//tensorflow/core:framework\",\n+        \"//tensorflow/core:lib\",\n+        \"//tensorflow/core:portable_gif_internal\",\n+        \"//tensorflow/core:session_options\",\n         \"//tensorflow/core/framework:fake_input\",\n         \"//tensorflow/core/framework:tensor_testutil\",\n         \"//tensorflow/core/kernels:ops_testutil\",\n         \"//tensorflow/core/platform:refcount\",\n         \"//tensorflow/core/tfrt/common:create_pjrt_client_util\",\n         \"//tensorflow/core/tfrt/common:pjrt_util\",\n+        \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status:statusor\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@com_google_googletest//:gtest_main\",\n-        \"@local_tsl//tsl/platform:status\",\n-        \"@local_tsl//tsl/platform:statusor\",\n+        \"@local_xla//xla:literal\",\n+        \"@local_xla//xla:literal_util\",\n         \"@local_xla//xla/pjrt:pjrt_client\",\n         \"@local_xla//xla/pjrt:pjrt_common\",\n+        \"@local_xla//xla/pjrt:pjrt_executable\",\n         \"@local_xla//xla/pjrt/plugin/xla_cpu:cpu_client_options\",\n         \"@local_xla//xla/pjrt/plugin/xla_cpu:xla_cpu_pjrt_client\",\n         \"@local_xla//xla/tests:literal_test_util\",\n         \"@local_xla//xla/tsl/framework:device_id_utils\",\n         \"@local_xla//xla/tsl/lib/core:status_test_util\",\n+        \"@local_xla//xla/tsl/platform:statusor\",\n     ],\n )\n \n@@ -979,8 +1005,7 @@ tf_cc_test(\n         \"//tensorflow/core:session_options\",\n         \"//tensorflow/core:test\",\n         \"//tensorflow/core:test_main\",\n-        \"//tensorflow/core:testlib\",\n-        \"@com_google_absl//absl/memory\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n     ],\n )\n@@ -1060,6 +1085,9 @@ cc_library(\n         \"//tensorflow/core:core_cpu_base\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:lib\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@local_xla//xla:status_macros\",\n     ],\n )\n@@ -1078,11 +1106,10 @@ tf_cc_test(\n         \"//tensorflow/core:core_cpu_base\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:ops\",\n-        \"//tensorflow/core:portable_gif_internal\",\n         \"//tensorflow/core:test\",\n         \"//tensorflow/core:test_main\",\n         \"//tensorflow/core/kernels:constant_op\",\n-        \"@local_tsl//tsl/platform:status\",\n+        \"@com_google_absl//absl/log:check\",\n     ],\n )\n \n@@ -1109,12 +1136,15 @@ tf_cc_test(\n     deps = [\n         \":encapsulate_util\",\n         \"//tensorflow/cc:cc_ops\",\n+        \"//tensorflow/cc:ops\",\n         \"//tensorflow/cc:scope\",\n+        \"//tensorflow/core:core_cpu_base\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:ops\",\n         \"//tensorflow/core:protos_all_cc\",\n         \"//tensorflow/core:test\",\n         \"//tensorflow/core:test_main\",\n+        \"@com_google_absl//absl/log:check\",\n     ],\n )\n \n@@ -1219,11 +1249,16 @@ cc_library(\n         \"//tensorflow/core:graph\",\n         \"//tensorflow/core:lib\",\n         \"//tensorflow/core:protos_all_cc\",\n+        \"//tensorflow/core/common_runtime:function_body\",\n         \"//tensorflow/core/framework:bounds_check\",\n+        \"//tensorflow/core/platform:hash\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n         \"@com_google_absl//absl/container:inlined_vector\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:optional\",\n@@ -1366,6 +1401,9 @@ tf_cc_test(\n         \"//tensorflow/core:testlib\",\n         \"//tensorflow/core/common_runtime:device_set\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n+        \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/memory\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n@@ -1417,6 +1455,8 @@ cc_library(\n         \"//tensorflow/core:graph\",\n         \"//tensorflow/core:protos_all_cc\",\n         \"@com_google_absl//absl/algorithm:container\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:optional\",\n         \"@com_google_absl//absl/types:span\",\n@@ -1453,20 +1493,25 @@ cc_library(\n         \":xla_activity_proto_cc\",\n         \":xla_cluster_util\",\n         \"//tensorflow/compiler/tf2xla:resource_operation_table\",\n-        \"//tensorflow/compiler/tf2xla:tf2xla_util\",\n+        \"//tensorflow/compiler/tf2xla:tf2xla_defs\",\n         \"//tensorflow/compiler/tf2xla:xla_compiler\",\n         \"//tensorflow/compiler/tf2xla:xla_op_registry\",\n         \"//tensorflow/core:core_cpu\",\n         \"//tensorflow/core:framework\",\n         \"//tensorflow/core:graph\",\n         \"//tensorflow/core:lib\",\n         \"//tensorflow/core:protos_all_cc\",\n+        \"//tensorflow/core/common_runtime:function_body\",\n+        \"//tensorflow/core/common_runtime:function_utils\",\n         \"@com_google_absl//absl/algorithm:container\",\n-        \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/container:flat_hash_set\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:optional\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@local_xla//xla:union_find\",\n         \"@local_xla//xla:util\",\n         \"@local_xla//xla/service/graphcycles\",\n@@ -1477,6 +1522,7 @@ tf_cc_test(\n     name = \"compilability_check_util_test\",\n     srcs = [\"compilability_check_util_test.cc\"],\n     deps = [\n+        \":common\",\n         \":compilability_check_util\",\n         \":xla_cpu_device\",\n         \":xla_cpu_jit\",\n@@ -1485,17 +1531,17 @@ tf_cc_test(\n         \"//tensorflow/cc:functional_ops\",\n         \"//tensorflow/cc:ops\",\n         \"//tensorflow/cc:scope\",\n-        \"//tensorflow/compiler/tf2xla:test_util\",\n         \"//tensorflow/compiler/tf2xla:xla_compiler\",\n-        \"//tensorflow/compiler/tf2xla/cc:xla_jit_ops\",\n-        \"//tensorflow/compiler/tf2xla/cc:xla_ops\",\n         \"//tensorflow/core:core_cpu\",\n         \"//tensorflow/core:framework\",\n+        \"//tensorflow/core:lib\",\n         \"//tensorflow/core:ops\",\n         \"//tensorflow/core:protos_all_cc\",\n         \"//tensorflow/core:test\",\n         \"//tensorflow/core:test_main\",\n-        \"@com_google_absl//absl/memory\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/types:span\",\n     ],\n )\n "
        },
        {
            "sha": "8da8b2055c6c2bab634fd61d47b03ad6cc975645",
            "filename": "tensorflow/compiler/jit/compilability_check_util.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 26,
            "changes": 40,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,52 +15,40 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/compilability_check_util.h\"\n \n-#include <algorithm>\n-#include <atomic>\n-#include <deque>\n+#include <cstddef>\n #include <iterator>\n-#include <limits>\n #include <string>\n-#include <unordered_map>\n-#include <unordered_set>\n #include <utility>\n+#include <vector>\n \n #include \"absl/algorithm/container.h\"\n-#include \"absl/container/flat_hash_map.h\"\n #include \"absl/container/flat_hash_set.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_cat.h\"\n-#include \"absl/strings/str_join.h\"\n #include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n #include \"tensorflow/compiler/jit/defs.h\"\n-#include \"tensorflow/compiler/jit/device_util.h\"\n-#include \"tensorflow/compiler/jit/flags.h\"\n-#include \"tensorflow/compiler/jit/resource_operation_safety_analysis.h\"\n #include \"tensorflow/compiler/jit/xla_activity.pb.h\"\n #include \"tensorflow/compiler/jit/xla_activity_listener.h\"\n #include \"tensorflow/compiler/jit/xla_cluster_util.h\"\n #include \"tensorflow/compiler/tf2xla/const_analysis.h\"\n-#include \"tensorflow/compiler/tf2xla/resource_operation_table.h\"\n-#include \"tensorflow/compiler/tf2xla/tf2xla_util.h\"\n+#include \"tensorflow/compiler/tf2xla/tf2xla_defs.h\"\n #include \"tensorflow/compiler/tf2xla/xla_op_registry.h\"\n-#include \"xla/service/graphcycles/graphcycles.h\"\n-#include \"xla/union_find.h\"\n-#include \"xla/util.h\"\n-#include \"tensorflow/core/common_runtime/function.h\"\n-#include \"tensorflow/core/common_runtime/graph_constructor.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"tensorflow/core/common_runtime/function_body.h\"\n+#include \"tensorflow/core/common_runtime/function_utils.h\"\n #include \"tensorflow/core/framework/attr_value.pb.h\"\n-#include \"tensorflow/core/framework/bounds_check.h\"\n #include \"tensorflow/core/framework/graph_def_util.h\"\n #include \"tensorflow/core/framework/memory_types.h\"\n #include \"tensorflow/core/framework/node_def.pb.h\"\n+#include \"tensorflow/core/framework/node_def_util.h\"\n #include \"tensorflow/core/framework/op_kernel.h\"\n #include \"tensorflow/core/framework/types.h\"\n-#include \"tensorflow/core/graph/algorithm.h\"\n-#include \"tensorflow/core/graph/control_flow.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/lib/gtl/cleanup.h\"\n-#include \"tensorflow/core/lib/strings/stringprintf.h\"\n-#include \"tensorflow/core/public/version.h\"\n-#include \"tensorflow/core/util/dump_graph.h\"\n \n namespace tensorflow {\n \n@@ -341,8 +329,8 @@ bool RecursiveCompilabilityChecker::IsCompilableCall(\n     return false;\n   }\n \n-  auto release_handle_on_return = gtl::MakeCleanup(\n-      [&] { TF_CHECK_OK(lib_runtime->ReleaseHandle(handle)); });\n+  auto release_handle_on_return =\n+      gtl::MakeCleanup([&] { CHECK_OK(lib_runtime->ReleaseHandle(handle)); });\n   const FunctionBody* fbody = lib_runtime->GetFunctionBody(handle);\n   bool is_compilable = true;\n   for (const Node* node : fbody->graph->op_nodes()) {"
        },
        {
            "sha": "185afab797ee1e6111b6eb25559982c7d5f58b04",
            "filename": "tensorflow/compiler/jit/compilability_check_util_test.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fcompilability_check_util_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,21 +15,32 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/compilability_check_util.h\"\n \n-#include \"absl/memory/memory.h\"\n+#include <algorithm>\n+#include <memory>\n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/strings/match.h\"\n+#include \"absl/types/span.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/cc/framework/scope.h\"\n-#include \"tensorflow/cc/ops/function_ops.h\"\n+#include \"tensorflow/cc/ops/array_ops.h\"\n #include \"tensorflow/cc/ops/functional_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n+#include \"tensorflow/compiler/jit/defs.h\"\n #include \"tensorflow/compiler/tf2xla/xla_op_kernel.h\"\n #include \"tensorflow/compiler/tf2xla/xla_op_registry.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"tensorflow/core/common_runtime/graph_def_builder_util.h\"\n #include \"tensorflow/core/framework/attr_value.pb.h\"\n #include \"tensorflow/core/framework/function.h\"\n-#include \"tensorflow/core/framework/graph_to_functiondef.h\"\n #include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/op_kernel.h\"\n+#include \"tensorflow/core/framework/types.h\"\n #include \"tensorflow/core/graph/graph_def_builder.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n+#include \"tensorflow/core/platform/env.h\"\n #include \"tensorflow/core/platform/test.h\"\n+#include \"tensorflow/core/public/version.h\"\n \n namespace tensorflow {\n namespace {\n@@ -260,7 +271,7 @@ TEST_F(CompilabilityCheckUtilTest, CheckFunctionalWhileNode) {\n   GraphDef graph_def;\n   TF_EXPECT_OK(builder.ToGraphDef(&graph_def));\n   std::unique_ptr<Graph> graph(new Graph(flib_def_.get()));\n-  TF_CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n+  CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n \n   auto while_node_it = std::find_if(\n       graph->nodes().begin(), graph->nodes().end(),"
        },
        {
            "sha": "776ec3915e2f7355eee4df95bba846ca61494f56",
            "filename": "tensorflow/compiler/jit/encapsulate_subgraphs_pass_test.cc",
            "status": "modified",
            "additions": 31,
            "deletions": 5,
            "changes": 36,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_subgraphs_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_subgraphs_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_subgraphs_pass_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,26 +15,52 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/encapsulate_subgraphs_pass.h\"\n \n+#include <algorithm>\n+#include <functional>\n+#include <map>\n #include <memory>\n+#include <string>\n+#include <unordered_map>\n+#include <unordered_set>\n #include <utility>\n+#include <vector>\n \n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/strings/match.h\"\n #include \"absl/strings/str_cat.h\"\n+#include \"absl/types/span.h\"\n #include \"tensorflow/cc/framework/ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n+#include \"tensorflow/cc/framework/scope.h\"\n+#include \"tensorflow/cc/ops/array_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n+#include \"tensorflow/cc/ops/math_ops.h\"\n+#include \"tensorflow/cc/ops/state_ops.h\"\n #include \"tensorflow/compiler/jit/encapsulate_util.h\"\n #include \"tensorflow/compiler/jit/extract_outside_compilation_pass.h\"\n #include \"tensorflow/compiler/jit/test_util.h\"\n #include \"tensorflow/compiler/tf2xla/side_effect_util.h\"\n-#include \"tensorflow/core/common_runtime/device_factory.h\"\n-#include \"tensorflow/core/common_runtime/function.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"tensorflow/core/common_runtime/device_mgr.h\"\n #include \"tensorflow/core/common_runtime/graph_constructor.h\"\n+#include \"tensorflow/core/common_runtime/optimization_registry.h\"\n+#include \"tensorflow/core/framework/common_shape_fns.h\"\n+#include \"tensorflow/core/framework/device.h\"\n+#include \"tensorflow/core/framework/device_factory.h\"\n+#include \"tensorflow/core/framework/function.h\"\n #include \"tensorflow/core/framework/function_testlib.h\"\n #include \"tensorflow/core/framework/graph_to_functiondef.h\"\n+#include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/shape_inference.h\"\n+#include \"tensorflow/core/framework/tensor_shape.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/graph/graph_def_builder.h\"\n+#include \"tensorflow/core/graph/node_builder.h\"\n #include \"tensorflow/core/lib/core/errors.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n #include \"tensorflow/core/platform/test.h\"\n+#include \"tensorflow/core/platform/types.h\"\n #include \"tensorflow/core/public/session_options.h\"\n #include \"tensorflow/core/public/version.h\"\n #include \"tensorflow/core/util/equal_graph_def.h\"\n@@ -499,7 +525,7 @@ absl::Status Encapsulate(\n   // Create FunctionLibraryRuntime.\n   SessionOptions session_options;\n   std::vector<std::unique_ptr<Device>> devices;\n-  TF_CHECK_OK(DeviceFactory::AddDevices(\n+  CHECK_OK(DeviceFactory::AddDevices(\n       session_options, \"/job:localhost/replica:0/task:0\", &devices));\n   OptimizerOptions opts;\n   auto device_mgr = std::make_unique<StaticDeviceMgr>(std::move(devices));"
        },
        {
            "sha": "4d2b71327b3250e00cfb4ba95d31bcc44ab443d6",
            "filename": "tensorflow/compiler/jit/encapsulate_util_test.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_util_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,12 +15,19 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/encapsulate_util.h\"\n \n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/cc/framework/scope.h\"\n #include \"tensorflow/cc/ops/array_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n+#include \"tensorflow/cc/ops/math_ops.h\"\n #include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/framework/tensor_shape.pb.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/platform/test.h\"\n \n namespace tensorflow {\n@@ -35,16 +42,16 @@ TEST(PerformStaticShapeInferenceBeforeEncapsulationTest, Basic) {\n   Output add = ops::Add(s.WithOpName(\"add\"), const_0, const_1);\n   Output identity = ops::Identity(s.WithOpName(\"identity\"), add);\n   Graph g(OpRegistry::Global());\n-  TF_CHECK_OK(s.ToGraph(&g));\n+  CHECK_OK(s.ToGraph(&g));\n \n-  TF_CHECK_OK(PerformStaticShapeInferenceBeforeEncapsulation(&g));\n+  CHECK_OK(PerformStaticShapeInferenceBeforeEncapsulation(&g));\n \n   // Check that \"add\" node now has _xla_inferred_shapes attr.\n   auto node_index = g.BuildNodeNameIndex();\n   Node *add_node = node_index[\"add\"];\n   std::vector<PartialTensorShape> output_shapes;\n-  TF_CHECK_OK(GetNodeAttr(add_node->attrs(), kXlaInferredShapesAttrName,\n-                          &output_shapes));\n+  CHECK_OK(GetNodeAttr(add_node->attrs(), kXlaInferredShapesAttrName,\n+                       &output_shapes));\n   EXPECT_EQ(output_shapes.size(), 1);\n   TensorShapeProto shape_proto;\n   output_shapes[0].AsProto(&shape_proto);"
        },
        {
            "sha": "6b0570b704e2d724f829967dac6bfbbaaeae220b",
            "filename": "tensorflow/compiler/jit/encapsulate_xla_computations_pass_test.cc",
            "status": "modified",
            "additions": 35,
            "deletions": 23,
            "changes": 58,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_xla_computations_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_xla_computations_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fencapsulate_xla_computations_pass_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,19 +15,31 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/encapsulate_xla_computations_pass.h\"\n \n+#include <initializer_list>\n+#include <memory>\n+#include <string>\n+#include <unordered_map>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n+#include \"tensorflow/cc/framework/scope.h\"\n+#include \"tensorflow/cc/ops/array_ops.h\"\n #include \"tensorflow/cc/ops/function_ops.h\"\n+#include \"tensorflow/cc/ops/math_ops.h\"\n #include \"tensorflow/cc/ops/resource_variable_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n #include \"tensorflow/compiler/jit/defs.h\"\n-#include \"tensorflow/compiler/jit/encapsulate_subgraphs_pass.h\"\n #include \"tensorflow/compiler/jit/xla_cluster_util.h\"\n #include \"tensorflow/compiler/tf2xla/cc/ops/xla_jit_ops.h\"\n #include \"tensorflow/compiler/tf2xla/test_util.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"tensorflow/core/common_runtime/graph_constructor.h\"\n+#include \"tensorflow/core/framework/function.h\"\n #include \"tensorflow/core/framework/graph_to_functiondef.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n-#include \"tensorflow/core/lib/hash/hash.h\"\n-#include \"tensorflow/core/lib/strings/proto_serialization.h\"\n+#include \"tensorflow/core/framework/node_def_builder.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/types.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/platform/test.h\"\n #include \"tensorflow/core/util/equal_graph_def.h\"\n \n@@ -47,23 +59,23 @@ static std::unique_ptr<Graph> MakeOuterGraph(\n   auto w = ops::Placeholder(scope.WithOpName(\"W\"), DT_RESOURCE);\n \n   NodeDef def;\n-  TF_CHECK_OK(NodeDefBuilder(\"launch0\", function, &flib_def)\n-                  .Input(a.node()->name(), 0, DT_INT32)\n-                  .Input(b.node()->name(), 0, DT_FLOAT)\n-                  .Input(c.node()->name(), 0, DT_INT32)\n-                  .Input(d.node()->name(), 0, DT_FLOAT)\n-                  .Input(u.node()->name(), 0, DT_RESOURCE)\n-                  .Input(v.node()->name(), 0, DT_RESOURCE)\n-                  .Input(w.node()->name(), 0, DT_RESOURCE)\n-                  .Device(\"/gpu:0\")\n-                  .Attr(kXlaClusterIdAttr, \"launch0\")\n-                  .Attr(\"_variable_start_index\", 4)\n-                  .Finalize(&def));\n+  CHECK_OK(NodeDefBuilder(\"launch0\", function, &flib_def)\n+               .Input(a.node()->name(), 0, DT_INT32)\n+               .Input(b.node()->name(), 0, DT_FLOAT)\n+               .Input(c.node()->name(), 0, DT_INT32)\n+               .Input(d.node()->name(), 0, DT_FLOAT)\n+               .Input(u.node()->name(), 0, DT_RESOURCE)\n+               .Input(v.node()->name(), 0, DT_RESOURCE)\n+               .Input(w.node()->name(), 0, DT_RESOURCE)\n+               .Device(\"/gpu:0\")\n+               .Attr(kXlaClusterIdAttr, \"launch0\")\n+               .Attr(\"_variable_start_index\", 4)\n+               .Finalize(&def));\n \n   absl::Status status;\n   Node* launch = scope.graph()->AddNode(def, &status);\n-  TF_CHECK_OK(status);\n-  TF_CHECK_OK(scope.DoShapeInference(launch));\n+  CHECK_OK(status);\n+  CHECK_OK(scope.DoShapeInference(launch));\n   scope.graph()->AddEdge(a.node(), 0, launch, 0);\n   scope.graph()->AddEdge(b.node(), 0, launch, 1);\n   scope.graph()->AddEdge(c.node(), 0, launch, 2);\n@@ -89,7 +101,7 @@ static std::unique_ptr<Graph> MakeOuterGraph(\n   auto consumer3 = ops::Identity(scope.WithOpName(\"consumer3\"), out3);\n \n   std::unique_ptr<Graph> graph(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(scope.ToGraph(graph.get()));\n+  CHECK_OK(scope.ToGraph(graph.get()));\n   return graph;\n }\n \n@@ -135,7 +147,7 @@ static std::unique_ptr<Graph> MakeBodyGraph() {\n       ops::_Retval(scope.WithOpName(\"readu_0_retval_RetVal\"), read_u, 3);\n \n   std::unique_ptr<Graph> graph(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(scope.ToGraph(graph.get()));\n+  CHECK_OK(scope.ToGraph(graph.get()));\n   return graph;\n }\n \n@@ -160,7 +172,7 @@ TEST(EncapsulateXlaComputations, DeterministicEncapsulate) {\n       };\n       add_attrs(e.node());\n \n-      TF_CHECK_OK(scope.ToGraph(graph.get()));\n+      CHECK_OK(scope.ToGraph(graph.get()));\n       auto get_node_in_graph = [&graph](Node* node) {\n         return graph->FindNodeId(node->id());\n       };\n@@ -178,7 +190,7 @@ TEST(EncapsulateXlaComputations, DeterministicEncapsulate) {\n                               get_node_in_graph(e.node()), true);\n       }\n     }\n-    TF_CHECK_OK(EncapsulateXlaComputationsPass::Encapsulate(&graph, &flib_def));\n+    CHECK_OK(EncapsulateXlaComputationsPass::Encapsulate(&graph, &flib_def));\n     return SerializeGraphDeterministic(*graph).value();\n   };\n "
        },
        {
            "sha": "aa6ad2e4eeed8c7b6b5a2989ff5b7e4bac644e2e",
            "filename": "tensorflow/compiler/jit/extract_outside_compilation_pass_test.cc",
            "status": "modified",
            "additions": 126,
            "deletions": 109,
            "changes": 235,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fextract_outside_compilation_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fextract_outside_compilation_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fextract_outside_compilation_pass_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,22 +15,39 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/extract_outside_compilation_pass.h\"\n \n+#include <initializer_list>\n+#include <iostream>\n+#include <map>\n+#include <memory>\n+#include <ostream>\n+#include <string>\n+#include <utility>\n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/strings/match.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/cc/framework/scope.h\"\n #include \"tensorflow/cc/ops/array_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n #include \"tensorflow/cc/ops/function_ops.h\"\n #include \"tensorflow/cc/ops/functional_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n+#include \"tensorflow/cc/ops/math_ops.h\"\n #include \"tensorflow/compiler/jit/encapsulate_util.h\"\n #include \"xla/hlo/testlib/test.h\"\n-#include \"tensorflow/core/common_runtime/device_factory.h\"\n+#include \"tensorflow/core/common_runtime/device_mgr.h\"\n #include \"tensorflow/core/common_runtime/function.h\"\n-#include \"tensorflow/core/framework/common_shape_fns.h\"\n+#include \"tensorflow/core/framework/device_factory.h\"\n #include \"tensorflow/core/framework/function.h\"\n #include \"tensorflow/core/framework/graph_to_functiondef.h\"\n+#include \"tensorflow/core/framework/node_def_builder.h\"\n #include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/framework/tensor_shape.pb.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n+#include \"tensorflow/core/platform/env.h\"\n #include \"tensorflow/core/platform/test.h\"\n #include \"tensorflow/core/public/session_options.h\"\n #include \"tensorflow/core/public/version.h\"\n@@ -50,7 +67,7 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, Basic) {\n   auto ret0 = ops::_Retval(s.WithOpName(\"ret0\"), add, 0);\n   auto ret1 = ops::_Retval(s.WithOpName(\"ret1\"), arg1, 1);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n   auto node_name_image = g->BuildNodeNameIndex();\n   Node *add_node = node_name_image[\"add\"];\n   EXPECT_NE(add_node, nullptr);\n@@ -61,7 +78,7 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, Basic) {\n   std::vector<OutputTensor> arg_source_tensors;\n   NodeDef call_node_def;\n   call_node_def.set_op(\"0\");\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       rewrite_fn(arg_source_tensors, &g, nullptr, nullptr, &call_node_def));\n   node_name_image = g->BuildNodeNameIndex();\n \n@@ -75,7 +92,7 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, Basic) {\n   Node *recv_at_host = node_name_image[\"outside_compilation_cluster__0_recv\"];\n   EXPECT_NE(recv_at_host, nullptr);\n   std::vector<DataType> recv_at_host_dtypes;\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       GetNodeAttr(recv_at_host->attrs(), \"Toutputs\", &recv_at_host_dtypes));\n   EXPECT_EQ(recv_at_host_dtypes.size(), 3);\n   EXPECT_EQ(recv_at_host_dtypes[0], DT_INT32);\n@@ -88,7 +105,7 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, Basic) {\n   Node *send_from_host = node_name_image[\"outside_compilation_cluster__0_send\"];\n   EXPECT_NE(send_from_host, nullptr);\n   std::vector<DataType> send_from_host_dtypes;\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       GetNodeAttr(send_from_host->attrs(), \"Tinputs\", &send_from_host_dtypes));\n   EXPECT_EQ(send_from_host_dtypes.size(), 2);\n   EXPECT_EQ(send_from_host_dtypes[0], DT_INT32);\n@@ -115,8 +132,8 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, Basic) {\n   EXPECT_TRUE(has_control_edge_to_send_from_host);\n   // Verify step 7: necessary attrs added to call_node_def.\n   NameAttrList shape_inference_graph;\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(&call_node_def.attr()),\n-                          \"shape_inference_graph\", &shape_inference_graph));\n+  CHECK_OK(GetNodeAttr(AttrSlice(&call_node_def.attr()),\n+                       \"shape_inference_graph\", &shape_inference_graph));\n   EXPECT_EQ(shape_inference_graph.name(),\n             \"_outside_compilation_shape_inference_cluster__0\");\n }\n@@ -126,13 +143,13 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, NoSendFromHost) {\n   tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n   Output arg0 = ops::_Arg(s.WithOpName(\"arg0\"), DT_INT32, 0);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n \n   RewriteOutsideCompilationSubgraphFn rewrite_fn(\"_xla\", \"_oc\", \"cluster\", \"\");\n   std::vector<OutputTensor> arg_source_tensors;\n   NodeDef call_node_def;\n   call_node_def.set_op(\"0\");\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       rewrite_fn(arg_source_tensors, &g, nullptr, nullptr, &call_node_def));\n   auto node_name_image = g->BuildNodeNameIndex();\n \n@@ -152,13 +169,13 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, NoRecvAtHost) {\n   Output const0 = ops::Const(s.WithOpName(\"const0\"), 1, {2});\n   auto ret = ops::_Retval(s.WithOpName(\"ret\"), const0, 0);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n \n   RewriteOutsideCompilationSubgraphFn rewrite_fn(\"_xla\", \"_oc\", \"cluster\", \"\");\n   std::vector<OutputTensor> arg_source_tensors;\n   NodeDef call_node_def;\n   call_node_def.set_op(\"0\");\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       rewrite_fn(arg_source_tensors, &g, nullptr, nullptr, &call_node_def));\n   auto node_name_image = g->BuildNodeNameIndex();\n \n@@ -176,13 +193,13 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, NoKeyPlaceholder) {\n   tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n   Output const0 = ops::Const(s.WithOpName(\"const0\"), 1, {2});\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n \n   RewriteOutsideCompilationSubgraphFn rewrite_fn(\"_xla\", \"_oc\", \"cluster\", \"\");\n   std::vector<OutputTensor> arg_source_tensors;\n   NodeDef call_node_def;\n   call_node_def.set_op(\"0\");\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       rewrite_fn(arg_source_tensors, &g, nullptr, nullptr, &call_node_def));\n   auto node_name_image = g->BuildNodeNameIndex();\n \n@@ -202,7 +219,7 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, ShapesInferred) {\n   Output const0 = ops::Const(s.WithOpName(\"const0\"), 1, {2});\n   auto ret = ops::_Retval(s.WithOpName(\"ret\"), const0, 0);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n   auto node_name_image = g->BuildNodeNameIndex();\n   Node *const0_node = node_name_image[\"const0\"];\n   EXPECT_NE(const0_node, nullptr);\n@@ -214,13 +231,13 @@ TEST(RewriteOutsideCompilationSubgraphFnTest, ShapesInferred) {\n   std::vector<OutputTensor> arg_source_tensors;\n   NodeDef call_node_def;\n   call_node_def.set_op(\"0\");\n-  TF_CHECK_OK(\n+  CHECK_OK(\n       rewrite_fn(arg_source_tensors, &g, nullptr, nullptr, &call_node_def));\n   node_name_image = g->BuildNodeNameIndex();\n \n   // Check \"shape\" attr is available in call_node_def.\n   std::vector<TensorShapeProto> shapes;\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(&call_node_def.attr()), \"shapes\", &shapes));\n+  CHECK_OK(GetNodeAttr(AttrSlice(&call_node_def.attr()), \"shapes\", &shapes));\n   EXPECT_EQ(shapes.size(), 1);\n   EXPECT_EQ(shapes[0].dim_size(), 1);\n }\n@@ -230,7 +247,7 @@ class ExtractOutsideCompilationForFunctionTest : public ::testing::Test {\n   void SetUp() override {\n     SessionOptions session_options;\n     std::vector<std::unique_ptr<Device>> devices;\n-    TF_CHECK_OK(DeviceFactory::AddDevices(\n+    CHECK_OK(DeviceFactory::AddDevices(\n         session_options, \"/job:localhost/replica:0/task:0\", &devices));\n     device_mgr_ = std::make_unique<StaticDeviceMgr>(std::move(devices));\n   }\n@@ -275,7 +292,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n     Output identity1 = ops::Identity(s.WithOpName(\"identity1\"), identity0);\n     Output identity2 = ops::Identity(s.WithOpName(\"identity2\"), identity1);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity0\"]->AddAttr(\"_oc\", \"0\");\n     node_name_image[\"identity1\"]->AddAttr(\"_oc\", \"1\");\n@@ -284,7 +301,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -295,15 +312,15 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n \n   // Get rewritten XLA computation function.\n   std::unique_ptr<FunctionBody> xla_fbody;\n-  TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n-                                      AttrSlice(), &fld, &xla_fbody));\n+  CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"), AttrSlice(),\n+                                   &fld, &xla_fbody));\n   auto node_name_index = xla_fbody->graph->BuildNodeNameIndex();\n \n   // Check XlaHostCompute nodes.\n@@ -313,26 +330,26 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n   EXPECT_NE(host_compute_1, nullptr);\n   // Check XlaHostCompute nodes' \"tpu_core\" attr.\n   int tpu_core;\n-  TF_CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"tpu_core\", &tpu_core));\n+  CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"tpu_core\", &tpu_core));\n   EXPECT_EQ(tpu_core, 1);\n-  TF_CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"tpu_core\", &tpu_core));\n+  CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"tpu_core\", &tpu_core));\n   EXPECT_EQ(tpu_core, 0);\n   // Check XlaHostCompute nodes' \"shapes\" attr. \"0\" should not have shapes, and\n   // \"1\" should have shapes.\n   std::vector<TensorShapeProto> shapes;\n-  TF_CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"shapes\", &shapes));\n+  CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"shapes\", &shapes));\n   EXPECT_EQ(shapes.size(), 0);\n-  TF_CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"shapes\", &shapes));\n+  CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"shapes\", &shapes));\n   EXPECT_EQ(shapes.size(), 1);\n   EXPECT_EQ(shapes[0].dim_size(), 1);\n   // Check XlaHostCompute nodes' \"shape_inference_graph\" attr. Both should have\n   // empty values.\n   NameAttrList shape_inference_graph;\n-  TF_CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"shape_inference_graph\",\n-                          &shape_inference_graph));\n+  CHECK_OK(GetNodeAttr(host_compute_0->attrs(), \"shape_inference_graph\",\n+                       &shape_inference_graph));\n   EXPECT_EQ(shape_inference_graph.name(), \"\");\n-  TF_CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"shape_inference_graph\",\n-                          &shape_inference_graph));\n+  CHECK_OK(GetNodeAttr(host_compute_1->attrs(), \"shape_inference_graph\",\n+                       &shape_inference_graph));\n   EXPECT_EQ(shape_inference_graph.name(), \"\");\n \n   // Check `shape_inference_graphs`.\n@@ -344,7 +361,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n   device_ordinal_temp_value.set_i(0);\n   protobuf::Map<std::string, AttrValue> host_func_attrs;\n   host_func_attrs[\"_device_ordinal\"] = device_ordinal_temp_value;\n-  TF_CHECK_OK(FunctionDefToBodyHelper(\n+  CHECK_OK(FunctionDefToBodyHelper(\n       *fld.Find(\"host_graph\"), AttrSlice(&host_func_attrs), &fld, &host_fbody));\n   Graph *host_graph = host_fbody->graph;\n   Node *key_placeholder = nullptr, *sequencer = nullptr;\n@@ -377,7 +394,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, Basic) {\n   EXPECT_EQ(num_recv_at_host, 1);\n   for (Node *n : send_recv_nodes) {\n     Node *input_node;\n-    TF_CHECK_OK(n->input_node(n->num_inputs() - 1, &input_node));\n+    CHECK_OK(n->input_node(n->num_inputs() - 1, &input_node));\n     EXPECT_EQ(input_node, key_placeholder);\n \n     bool has_control_edge_to_sequencer = false;\n@@ -399,10 +416,10 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, NoHostGraph) {\n     tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n     Output const0 = ops::Const(s.WithOpName(\"const0\"), 1, {2});\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -413,7 +430,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, NoHostGraph) {\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n@@ -435,31 +452,31 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n     Output identity = ops::Identity(s.WithOpName(\"identity_true_fn\"), arg);\n     ops::_Retval retval(s.WithOpName(\"retval\"), identity, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity_true_fn\"]->AddAttr(\"_oc\", \"0\");\n     PartialTensorShape shape({2});\n     node_name_image[\"identity_true_fn\"]->AddAttr(\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *true_fn_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"true_fn\", true_fn_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"true_fn\", true_fn_fdef));\n   }\n   {\n     tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n     Output arg = ops::_Arg(s.WithOpName(\"arg\"), DT_INT32, 0);\n     Output identity = ops::Identity(s.WithOpName(\"identity_false_fn\"), arg);\n     ops::_Retval retval(s.WithOpName(\"retval\"), identity, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity_false_fn\"]->AddAttr(\"_oc\", \"0\");\n     PartialTensorShape shape({2});\n     node_name_image[\"identity_false_fn\"]->AddAttr(\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *false_fn_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"false_fn\", false_fn_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"false_fn\", false_fn_fdef));\n   }\n   {\n     tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n@@ -474,10 +491,10 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n                          true_fn, false_fn);\n     ops::_Retval retval(s.WithOpName(\"retval\"), if_op.output[0], 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -488,7 +505,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n@@ -500,9 +517,9 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n     device_ordinal_temp_value.set_i(0);\n     protobuf::Map<std::string, AttrValue> host_func_attrs;\n     host_func_attrs[\"_device_ordinal\"] = device_ordinal_temp_value;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n-                                        AttrSlice(&host_func_attrs), &fld,\n-                                        &host_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n+                                     AttrSlice(&host_func_attrs), &fld,\n+                                     &host_fbody));\n     Graph *host_graph = host_fbody->graph;\n     auto node_name_index = host_graph->BuildNodeNameIndex();\n \n@@ -515,7 +532,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n     Node *if_oc_node = node_name_index[\"oc_if_if\"];\n     EXPECT_NE(if_oc_node, nullptr);\n     Node *if_oc_node_cond_input;\n-    TF_CHECK_OK(if_oc_node->input_node(0, &if_oc_node_cond_input));\n+    CHECK_OK(if_oc_node->input_node(0, &if_oc_node_cond_input));\n     EXPECT_EQ(if_oc_node_cond_input, recv_if_pred_node);\n \n     // Check that then_branch outside compilation has node \"identity_true_fn\".\n@@ -546,8 +563,8 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n   // Check XLA graph.\n   {\n     std::unique_ptr<FunctionBody> xla_fbody;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n-                                        AttrSlice(), &fld, &xla_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n+                                     AttrSlice(), &fld, &xla_fbody));\n     Graph *xla_graph = xla_fbody->graph;\n     auto node_name_index = xla_graph->BuildNodeNameIndex();\n \n@@ -569,7 +586,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInIf) {\n     Node *if_node = node_name_index[\"if\"];\n     EXPECT_NE(if_node, nullptr);\n     std::vector<std::string> token_inputs;\n-    TF_CHECK_OK(\n+    CHECK_OK(\n         GetNodeAttr(if_node->def(), \"_xla_token_input_nodes\", &token_inputs));\n     EXPECT_THAT(token_inputs, ::testing::ElementsAre(\"send_oc_if_pred_if\"));\n   }\n@@ -586,31 +603,31 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInWhile) {\n     Output identity = ops::Identity(s.WithOpName(\"identity_cond_fn\"), arg);\n     ops::_Retval retval(s.WithOpName(\"retval\"), identity, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity_cond_fn\"]->AddAttr(\"_oc\", \"0\");\n     PartialTensorShape shape({2});\n     node_name_image[\"identity_cond_fn\"]->AddAttr(\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *cond_fn_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cond_fn\", cond_fn_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cond_fn\", cond_fn_fdef));\n   }\n   {\n     tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n     Output arg = ops::_Arg(s.WithOpName(\"arg\"), DT_BOOL, 0);\n     Output identity = ops::Identity(s.WithOpName(\"identity_body_fn\"), arg);\n     ops::_Retval retval(s.WithOpName(\"retval\"), identity, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity_body_fn\"]->AddAttr(\"_oc\", \"0\");\n     PartialTensorShape shape({2});\n     node_name_image[\"identity_body_fn\"]->AddAttr(\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *body_fn_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"body_fn\", body_fn_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"body_fn\", body_fn_fdef));\n   }\n   {\n     tensorflow::Scope s = tensorflow::Scope::NewRootScope();\n@@ -624,10 +641,10 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInWhile) {\n                    cond_fn, body_fn);\n     ops::_Retval retval(s.WithOpName(\"retval\"), while_op.output[0], 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -638,7 +655,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInWhile) {\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n@@ -650,9 +667,9 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInWhile) {\n     device_ordinal_temp_value.set_i(0);\n     protobuf::Map<std::string, AttrValue> host_func_attrs;\n     host_func_attrs[\"_device_ordinal\"] = device_ordinal_temp_value;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n-                                        AttrSlice(&host_func_attrs), &fld,\n-                                        &host_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n+                                     AttrSlice(&host_func_attrs), &fld,\n+                                     &host_fbody));\n     Graph *host_graph = host_fbody->graph;\n     auto node_name_index = host_graph->BuildNodeNameIndex();\n \n@@ -713,15 +730,15 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n     Output identity = ops::Identity(s.WithOpName(\"identity\"), arg);\n     ops::_Retval retval(s.WithOpName(\"retval\"), identity, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     auto node_name_image = g->BuildNodeNameIndex();\n     node_name_image[\"identity\"]->AddAttr(\"_oc\", \"0\");\n     PartialTensorShape shape({2});\n     node_name_image[\"identity\"]->AddAttr(\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *true_fn_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"fn\", true_fn_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"fn\", true_fn_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n   {\n@@ -736,35 +753,35 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n       tensor_proto.add_int_val(1);\n     }\n     NodeDef const_def;\n-    TF_CHECK_OK(NodeDefBuilder(\"const\", \"Const\")\n-                    .Attr(\"dtype\", DT_INT32)\n-                    .Attr(\"value\", tensor_proto)\n-                    .Finalize(&const_def));\n+    CHECK_OK(NodeDefBuilder(\"const\", \"Const\")\n+                 .Attr(\"dtype\", DT_INT32)\n+                 .Attr(\"value\", tensor_proto)\n+                 .Finalize(&const_def));\n     absl::Status s;\n     Node *const_node = g->AddNode(const_def, &s);\n-    TF_CHECK_OK(s);\n+    CHECK_OK(s);\n \n     NodeDef fn_def;\n-    TF_CHECK_OK(NodeDefBuilder(\"fn\", \"fn\", &fld)\n-                    .Input(\"const\", 0, DT_INT32)\n-                    .Finalize(&fn_def));\n+    CHECK_OK(NodeDefBuilder(\"fn\", \"fn\", &fld)\n+                 .Input(\"const\", 0, DT_INT32)\n+                 .Finalize(&fn_def));\n     Node *fn_node = g->AddNode(fn_def, &s);\n-    TF_CHECK_OK(s);\n+    CHECK_OK(s);\n     g->AddEdge(const_node, 0, fn_node, 0);\n \n     NodeDef ret_def;\n-    TF_CHECK_OK(NodeDefBuilder(\"ret\", \"_Retval\")\n-                    .Attr(\"index\", 0)\n-                    .Attr(\"T\", DT_INT32)\n-                    .Input(\"fn\", 0, DT_INT32)\n-                    .Finalize(&ret_def));\n+    CHECK_OK(NodeDefBuilder(\"ret\", \"_Retval\")\n+                 .Attr(\"index\", 0)\n+                 .Attr(\"T\", DT_INT32)\n+                 .Input(\"fn\", 0, DT_INT32)\n+                 .Finalize(&ret_def));\n     Node *ret_node = g->AddNode(ret_def, &s);\n-    TF_CHECK_OK(s);\n+    CHECK_OK(s);\n     g->AddEdge(fn_node, 0, ret_node, 0);\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n-    TF_CHECK_OK(fld.AddFunctionDef(*xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(fld.AddFunctionDef(*xla_fdef));\n   }\n \n   protobuf::Map<std::string, tensorflow::AttrValue> attrs;\n@@ -774,7 +791,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n@@ -786,9 +803,9 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n     device_ordinal_temp_value.set_i(0);\n     protobuf::Map<std::string, AttrValue> host_func_attrs;\n     host_func_attrs[\"_device_ordinal\"] = device_ordinal_temp_value;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n-                                        AttrSlice(&host_func_attrs), &fld,\n-                                        &host_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"host_graph\"),\n+                                     AttrSlice(&host_func_attrs), &fld,\n+                                     &host_fbody));\n     Graph *host_graph = host_fbody->graph;\n     auto node_name_index = host_graph->BuildNodeNameIndex();\n \n@@ -797,9 +814,9 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n     EXPECT_NE(call_node, nullptr);\n \n     std::unique_ptr<FunctionBody> call_fbody;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"oc_func_call_host_fn\"),\n-                                        AttrSlice(&host_func_attrs), &fld,\n-                                        &call_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"oc_func_call_host_fn\"),\n+                                     AttrSlice(&host_func_attrs), &fld,\n+                                     &call_fbody));\n \n     // Verify we have _XlaRecvAtHost and _XlaSendFromHost nodes.\n     bool has_recv = false, has_send = false;\n@@ -817,8 +834,8 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n   // Check XLA graph.\n   {\n     std::unique_ptr<FunctionBody> xla_fbody;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n-                                        AttrSlice(), &fld, &xla_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n+                                     AttrSlice(), &fld, &xla_fbody));\n     Graph *xla_graph = xla_fbody->graph;\n     auto node_name_index = xla_graph->BuildNodeNameIndex();\n \n@@ -828,8 +845,8 @@ TEST_F(ExtractOutsideCompilationForFunctionTest, OutsideCompilationInFunction) {\n     EXPECT_EQ(fn_node->type_string(), \"fn_oc\");\n \n     std::unique_ptr<FunctionBody> call_fbody;\n-    TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"fn_oc\"), AttrSlice(), &fld,\n-                                        &call_fbody));\n+    CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"fn_oc\"), AttrSlice(), &fld,\n+                                     &call_fbody));\n \n     // Verify we have XlaHostCompute nodes.\n     bool has_hc = false;\n@@ -857,7 +874,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n     Output identity1 = ops::Identity(s.WithOpName(\"identity1\"), identity0);\n     Output identity2 = ops::Identity(s.WithOpName(\"identity2\"), identity1);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     std::cout << \"Graph is \" << (*g).ToGraphDefDebug().DebugString()\n               << std::endl;\n     auto node_name_image = g->BuildNodeNameIndex();\n@@ -869,7 +886,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -880,15 +897,15 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n \n   // Get rewritten XLA computation function.\n   std::unique_ptr<FunctionBody> xla_fbody;\n-  TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n-                                      AttrSlice(), &fld, &xla_fbody));\n+  CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"), AttrSlice(),\n+                                   &fld, &xla_fbody));\n   auto node_name_index = xla_fbody->graph->BuildNodeNameIndex();\n \n   // Check XlaHostCompute nodes.\n@@ -899,17 +916,17 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n \n   // Check XlaHostCompute nodes' \"_xla_token_input_nodes\" attr.\n   std::vector<std::string> token_input_nodes;\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(host_compute_0->attrs()),\n-                          \"_xla_token_input_nodes\", &token_input_nodes));\n+  CHECK_OK(GetNodeAttr(AttrSlice(host_compute_0->attrs()),\n+                       \"_xla_token_input_nodes\", &token_input_nodes));\n \n   std::vector<std::string> expected_token_input_nodes_0(\n       {\"_xla_token_arg_node\"});\n   EXPECT_EQ(token_input_nodes, expected_token_input_nodes_0);\n   token_input_nodes.clear();\n   std::vector<std::string> expected_token_input_nodes_1(\n       {\"_xla_token_arg_node\", \"outside_compilation_0_host_compute\"});\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(host_compute_1->attrs()),\n-                          \"_xla_token_input_nodes\", &token_input_nodes));\n+  CHECK_OK(GetNodeAttr(AttrSlice(host_compute_1->attrs()),\n+                       \"_xla_token_input_nodes\", &token_input_nodes));\n   EXPECT_EQ(token_input_nodes, expected_token_input_nodes_1);\n \n   // Check there is a control edge from host_compute_0 to host_compute_1.\n@@ -940,7 +957,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n         s.WithOpName(\"identity1\").WithControlDependencies(identity0), const0);\n     Output identity2 = ops::Identity(s.WithOpName(\"identity2\"), identity1);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     std::cout << \"Graph is \" << (*g).ToGraphDefDebug().DebugString()\n               << std::endl;\n     auto node_name_image = g->BuildNodeNameIndex();\n@@ -952,7 +969,7 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n         kXlaInferredShapesAttrName, std::vector<PartialTensorShape>{shape});\n \n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"cluster\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -963,15 +980,15 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n   NameAttrList name_attrs;\n   name_attrs.set_name(\"cluster\");\n   *name_attrs.mutable_attr() = attrs;\n-  TF_CHECK_OK(ExtractOutsideCompilationTest(\n+  CHECK_OK(ExtractOutsideCompilationTest(\n       \"_xla\", \"_oc\", \"cluster\", name_attrs, \"cluster_rewritten\", \"host_graph\",\n       host_compute_core, &fld, &shape_inference_graphs,\n       &has_outside_compilation));\n \n   // Get rewritten XLA computation function.\n   std::unique_ptr<FunctionBody> xla_fbody;\n-  TF_CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"),\n-                                      AttrSlice(), &fld, &xla_fbody));\n+  CHECK_OK(FunctionDefToBodyHelper(*fld.Find(\"cluster_rewritten\"), AttrSlice(),\n+                                   &fld, &xla_fbody));\n   auto node_name_index = xla_fbody->graph->BuildNodeNameIndex();\n \n   // Check XlaHostCompute nodes.\n@@ -982,17 +999,17 @@ TEST_F(ExtractOutsideCompilationForFunctionTest,\n \n   // Check XlaHostCompute nodes' \"_xla_token_input_nodes\" attr.\n   std::vector<std::string> token_input_nodes;\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(host_compute_0->attrs()),\n-                          \"_xla_token_input_nodes\", &token_input_nodes));\n+  CHECK_OK(GetNodeAttr(AttrSlice(host_compute_0->attrs()),\n+                       \"_xla_token_input_nodes\", &token_input_nodes));\n \n   std::vector<std::string> expected_token_input_nodes_0(\n       {\"_xla_token_arg_node\"});\n   EXPECT_EQ(token_input_nodes, expected_token_input_nodes_0);\n   token_input_nodes.clear();\n   std::vector<std::string> expected_token_input_nodes_1(\n       {\"_xla_token_arg_node\", \"outside_compilation_0_host_compute\"});\n-  TF_CHECK_OK(GetNodeAttr(AttrSlice(host_compute_1->attrs()),\n-                          \"_xla_token_input_nodes\", &token_input_nodes));\n+  CHECK_OK(GetNodeAttr(AttrSlice(host_compute_1->attrs()),\n+                       \"_xla_token_input_nodes\", &token_input_nodes));\n   EXPECT_EQ(token_input_nodes, expected_token_input_nodes_1);\n \n   // Check there is a control edge from host_compute_0 to host_compute_1."
        },
        {
            "sha": "89d5ea8863151b79c3c5bf16ecb6db6f97dd9da6",
            "filename": "tensorflow/compiler/jit/mark_for_compilation_pass_test.cc",
            "status": "modified",
            "additions": 31,
            "deletions": 12,
            "changes": 43,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fmark_for_compilation_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fmark_for_compilation_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fmark_for_compilation_pass_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -16,6 +16,8 @@ limitations under the License.\n #include \"tensorflow/compiler/jit/mark_for_compilation_pass.h\"\n \n #include <algorithm>\n+#include <cstdint>\n+#include <initializer_list>\n #include <memory>\n #include <set>\n #include <string>\n@@ -24,33 +26,50 @@ limitations under the License.\n #include <vector>\n \n #include \"absl/container/flat_hash_map.h\"\n-#include \"absl/memory/memory.h\"\n+#include \"absl/container/flat_hash_set.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/strings/match.h\"\n-#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_join.h\"\n #include \"absl/strings/str_split.h\"\n #include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n #include \"tensorflow/cc/framework/ops.h\"\n+#include \"tensorflow/cc/framework/scope.h\"\n #include \"tensorflow/cc/ops/array_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n+#include \"tensorflow/cc/ops/control_flow_ops.h\"\n #include \"tensorflow/cc/ops/control_flow_ops_internal.h\"\n+#include \"tensorflow/cc/ops/data_flow_ops.h\"\n #include \"tensorflow/cc/ops/function_ops.h\"\n #include \"tensorflow/cc/ops/functional_ops.h\"\n #include \"tensorflow/cc/ops/list_ops.h\"\n+#include \"tensorflow/cc/ops/logging_ops.h\"\n+#include \"tensorflow/cc/ops/math_ops.h\"\n+#include \"tensorflow/cc/ops/no_op.h\"\n+#include \"tensorflow/cc/ops/random_ops.h\"\n #include \"tensorflow/cc/ops/resource_variable_ops.h\"\n #include \"tensorflow/cc/ops/sendrecv_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n+#include \"tensorflow/cc/ops/state_ops.h\"\n #include \"tensorflow/compiler/jit/defs.h\"\n+#include \"tensorflow/compiler/jit/flags.h\"\n #include \"tensorflow/compiler/jit/mark_for_compilation_pass_test_helper.h\"\n #include \"tensorflow/compiler/jit/node_matchers.h\"\n #include \"tensorflow/compiler/jit/xla_cluster_util.h\"\n-#include \"tensorflow/compiler/tf2xla/xla_op_kernel.h\"\n #include \"tensorflow/compiler/tf2xla/xla_op_registry.h\"\n-#include \"tensorflow/core/common_runtime/graph_constructor.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"tensorflow/core/common_runtime/graph_def_builder_util.h\"\n+#include \"tensorflow/core/framework/function.h\"\n+#include \"tensorflow/core/framework/node_def_builder.h\"\n #include \"tensorflow/core/framework/node_def_util.h\"\n #include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/tensor.h\"\n+#include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/graph/algorithm.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/graph/graph_def_builder.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n+#include \"tensorflow/core/graph/node_builder.h\"\n #include \"tensorflow/core/platform/errors.h\"\n #include \"tensorflow/core/platform/test.h\"\n \n@@ -503,7 +522,7 @@ TEST(XlaCompilationTest, CyclesWithAllDifferentScopesGlobalJitOverridden) {\n     ops::BinaryOp(\n         \"MatMul\", a, b,\n         builder.opts().WithName(\"C\").WithAttr(kXlaScopeAttr, \"ScopeC\"));\n-    TF_CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n+    CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n   }\n \n   FunctionDefLibrary flib;\n@@ -536,7 +555,7 @@ TEST(XlaCompilationTest, CyclesWithAllDifferentScopes) {\n     ops::BinaryOp(\n         \"MatMul\", a, b,\n         builder.opts().WithName(\"C\").WithAttr(kXlaScopeAttr, \"ScopeC\"));\n-    TF_CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n+    CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n   }\n \n   TF_ASSERT_OK(MarkForCompilationPassTestHelper::MarkForCompilation(\n@@ -574,7 +593,7 @@ TEST(XlaCompilationTest, CyclesWithSplittingScopes) {\n                       .WithName(\"D\")\n                       .WithAttr(kXlaCompileAttr, true)\n                       .WithAttr(kXlaScopeAttr, \"Scope2\"));\n-    TF_CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n+    CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n   }\n \n   TF_ASSERT_OK(MarkForCompilationPassTestHelper::MarkForCompilation(\n@@ -607,7 +626,7 @@ TEST(XlaCompilationTest, CyclesWithDifferentScopesAndBridge) {\n                                .WithAttr(kXlaCompileAttr, true)\n                                .WithAttr(kXlaScopeAttr, \"ScopeB\"));\n     ops::BinaryOp(\"MatMul\", a, b, builder.opts().WithName(\"C\"));\n-    TF_CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n+    CHECK_OK(GraphDefBuilderToGraph(builder, graph.get()));\n   }\n \n   TF_ASSERT_OK(MarkForCompilationPassTestHelper::MarkForCompilation(\n@@ -797,11 +816,11 @@ TEST(XlaCompilationTest, IllegalCycle_UsefulErrorMessage) {\n     auto BuildNoopNode = [](absl::string_view name, Graph* graph) {\n       NodeDefBuilder builder(name, \"NoOp\");\n       NodeDef def;\n-      TF_CHECK_OK(builder.Finalize(&def));\n+      CHECK_OK(builder.Finalize(&def));\n \n       absl::Status status;\n       Node* node = graph->AddNode(def, &status);\n-      TF_CHECK_OK(status);\n+      CHECK_OK(status);\n       return node;\n     };\n "
        },
        {
            "sha": "93c07d5539ccc2d708ecb87147b535babe1253f5",
            "filename": "tensorflow/compiler/jit/node_matchers.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fnode_matchers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fnode_matchers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fnode_matchers.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,16 +15,31 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/node_matchers.h\"\n \n+#include <cstdint>\n+#include <iterator>\n+#include <map>\n+#include <optional>\n+#include <ostream>\n+#include <sstream>\n+#include <string>\n #include <utility>\n+#include <vector>\n \n #include \"absl/algorithm/container.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n-#include \"absl/strings/str_replace.h\"\n #include \"absl/strings/str_split.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/types/span.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/core/framework/attr_value_util.h\"\n #include \"tensorflow/core/framework/node_def.pb.h\"\n+#include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/tensor.h\"\n #include \"tensorflow/core/framework/tensor.pb.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/graph/graph_node_util.h\"\n \n namespace tensorflow {\n@@ -515,7 +530,7 @@ impl::NodeMatcherProperties impl::Attr(std::string name) {\n \n NodeMatcherProperties ConstantValue(\n     const ::tensorflow::Input::Initializer& val) {\n-  TF_CHECK_OK(val.status);\n+  CHECK_OK(val.status);\n   NodeMatcherProperties props;\n   props.set_constant_value(val.tensor);\n   return props;"
        },
        {
            "sha": "6f3450f67e0e38962fb32e835cee0e9b90d24cee",
            "filename": "tensorflow/compiler/jit/rearrange_function_argument_pass_test.cc",
            "status": "modified",
            "additions": 33,
            "deletions": 30,
            "changes": 63,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Frearrange_function_argument_pass_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Frearrange_function_argument_pass_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Frearrange_function_argument_pass_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -13,25 +13,28 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"absl/strings/match.h\"\n+#include <initializer_list>\n+#include <memory>\n+#include <utility>\n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/cc/framework/scope.h\"\n-#include \"tensorflow/cc/ops/array_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n #include \"tensorflow/cc/ops/function_ops.h\"\n #include \"tensorflow/cc/ops/functional_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n-#include \"tensorflow/compiler/jit/encapsulate_util.h\"\n #include \"tensorflow/compiler/tf2xla/rearrange_function_argument.h\"\n-#include \"tensorflow/core/common_runtime/device_factory.h\"\n+#include \"xla/tsl/platform/errors.h\"\n #include \"tensorflow/core/common_runtime/function.h\"\n-#include \"tensorflow/core/framework/common_shape_fns.h\"\n #include \"tensorflow/core/framework/function.h\"\n #include \"tensorflow/core/framework/graph_to_functiondef.h\"\n #include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/platform/test.h\"\n #include \"tensorflow/core/protobuf/error_codes.pb.h\"\n-#include \"tensorflow/core/public/session_options.h\"\n-#include \"tensorflow/core/public/version.h\"\n \n namespace tensorflow {\n \n@@ -49,9 +52,9 @@ TEST(RearrangeFunctionArgumentForFunctionTest, Basic) {\n     auto ret0 = ops::_Retval(s.WithOpName(\"ret0\"), arg1, 0);\n     auto ret1 = ops::_Retval(s.WithOpName(\"ret1\"), arg0, 1);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"f1\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"f1\", xla_fdef));\n   }\n   {\n     // Function for While's \"body\".\n@@ -64,9 +67,9 @@ TEST(RearrangeFunctionArgumentForFunctionTest, Basic) {\n     auto ret0 = ops::_Retval(s.WithOpName(\"ret0\"), arg0, 0);\n     auto ret1 = ops::_Retval(s.WithOpName(\"ret1\"), arg1, 1);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"f2\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"f2\", xla_fdef));\n   }\n   {\n     // Function for While's \"cond\".\n@@ -77,9 +80,9 @@ TEST(RearrangeFunctionArgumentForFunctionTest, Basic) {\n     Output arg1 = ops::_Arg(s.WithOpName(\"arg1\"), DT_BOOL, 1);\n     auto ret0 = ops::_Retval(s.WithOpName(\"ret0\"), arg1, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"f3\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"f3\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -106,11 +109,11 @@ TEST(RearrangeFunctionArgumentForFunctionTest, Basic) {\n   auto ret2 = ops::_Retval(s.WithOpName(\"ret2\"), while_op.output[0], 2);\n   auto ret3 = ops::_Retval(s.WithOpName(\"ret3\"), while_op.output[1], 3);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n \n   std::vector<std::unique_ptr<FunctionBody>> fbodies;\n-  TF_CHECK_OK(RearrangeFunctionArguments(\n-      [&](const NameAttrList &function, const FunctionBody **fbody) {\n+  CHECK_OK(RearrangeFunctionArguments(\n+      [&](const NameAttrList& function, const FunctionBody** fbody) {\n         std::unique_ptr<FunctionBody> new_fbody;\n         TF_RETURN_IF_ERROR(FunctionDefToBodyHelper(*fld.Find(function.name()),\n                                                    AttrSlice(&function.attr()),\n@@ -136,33 +139,33 @@ TEST(RearrangeFunctionArgumentForFunctionTest, Basic) {\n   const Node *if_node = node_name_index.at(\"if\");\n   ASSERT_NE(if_node, nullptr);\n   const Node *input_node;\n-  TF_CHECK_OK(if_node->input_node(1, &input_node));\n+  CHECK_OK(if_node->input_node(1, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg1\");\n-  TF_CHECK_OK(if_node->input_node(2, &input_node));\n+  CHECK_OK(if_node->input_node(2, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg0\");\n   const Node *ret0_node = node_name_index.at(\"ret0\");\n   ASSERT_NE(ret0_node, nullptr);\n-  TF_CHECK_OK(ret0_node->input_node(0, &input_node));\n+  CHECK_OK(ret0_node->input_node(0, &input_node));\n   EXPECT_EQ(input_node->name(), \"if\");\n   const Node *ret1_node = node_name_index.at(\"ret1\");\n   ASSERT_NE(ret1_node, nullptr);\n-  TF_CHECK_OK(ret1_node->input_node(0, &input_node));\n+  CHECK_OK(ret1_node->input_node(0, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg0\");\n \n   // Check node \"while\" input and output edges.\n   const Node *while_node = node_name_index.at(\"while\");\n   ASSERT_NE(while_node, nullptr);\n-  TF_CHECK_OK(while_node->input_node(0, &input_node));\n+  CHECK_OK(while_node->input_node(0, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg1\");\n-  TF_CHECK_OK(while_node->input_node(1, &input_node));\n+  CHECK_OK(while_node->input_node(1, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg0\");\n   const Node *ret2_node = node_name_index.at(\"ret2\");\n   ASSERT_NE(ret2_node, nullptr);\n-  TF_CHECK_OK(ret2_node->input_node(0, &input_node));\n+  CHECK_OK(ret2_node->input_node(0, &input_node));\n   EXPECT_EQ(input_node->name(), \"arg0\");\n   const Node *ret3_node = node_name_index.at(\"ret3\");\n   ASSERT_NE(ret3_node, nullptr);\n-  TF_CHECK_OK(ret3_node->input_node(0, &input_node));\n+  CHECK_OK(ret3_node->input_node(0, &input_node));\n   EXPECT_EQ(input_node->name(), \"while\");\n }\n \n@@ -182,9 +185,9 @@ TEST(RearrangeFunctionArgumentForFunctionTest,\n     auto ret1 = ops::_Retval(s.WithOpName(\"ret1\"), arg0, 1);\n     auto ret2 = ops::_Retval(s.WithOpName(\"ret2\"), arg2, 2);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"f2\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"f2\", xla_fdef));\n   }\n   {\n     // Function for While's \"cond\".\n@@ -197,9 +200,9 @@ TEST(RearrangeFunctionArgumentForFunctionTest,\n     Output cond = ops::Const(s.WithOpName(\"const\"), true, TensorShape({}));\n     auto ret0 = ops::_Retval(s.WithOpName(\"ret0\"), cond, 0);\n     std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-    TF_CHECK_OK(s.ToGraph(g.get()));\n+    CHECK_OK(s.ToGraph(g.get()));\n     FunctionDef *xla_fdef = fdl.add_function();\n-    TF_CHECK_OK(GraphToFunctionDef(*g, \"f1\", xla_fdef));\n+    CHECK_OK(GraphToFunctionDef(*g, \"f1\", xla_fdef));\n   }\n   FunctionLibraryDefinition fld(OpRegistry::Global(), fdl);\n \n@@ -217,7 +220,7 @@ TEST(RearrangeFunctionArgumentForFunctionTest,\n                              std::initializer_list<Input>{arg0, arg1, arg2},\n                              cond_fn, body_fn);\n   std::unique_ptr<Graph> g(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(s.ToGraph(g.get()));\n+  CHECK_OK(s.ToGraph(g.get()));\n \n   std::vector<std::unique_ptr<FunctionBody>> fbodies;\n   absl::Status status = RearrangeFunctionArguments("
        },
        {
            "sha": "807505672357cb719fafee6558d4a6491b09480b",
            "filename": "tensorflow/compiler/jit/shape_inference_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fshape_inference_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fshape_inference_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fshape_inference_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -17,27 +17,28 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/shape_inference.h\"\n \n+#include <cstdint>\n+#include <initializer_list>\n #include <map>\n #include <memory>\n+#include <string>\n #include <vector>\n \n+#include \"absl/log/check.h\"\n #include \"tensorflow/cc/framework/ops.h\"\n #include \"tensorflow/cc/framework/scope.h\"\n #include \"tensorflow/cc/ops/array_ops.h\"\n+#include \"tensorflow/cc/ops/const_op.h\"\n+#include \"tensorflow/cc/ops/control_flow_ops.h\"\n #include \"tensorflow/cc/ops/control_flow_ops_internal.h\"\n #include \"tensorflow/cc/ops/math_ops.h\"\n #include \"tensorflow/cc/ops/resource_variable_ops.h\"\n-#include \"tensorflow/cc/ops/standard_ops.h\"\n #include \"tensorflow/compiler/jit/test_util.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"tensorflow/core/framework/op.h\"\n-#include \"tensorflow/core/framework/partial_tensor_shape.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/graph/graph.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n #include \"tensorflow/core/platform/test.h\"\n-#include \"tensorflow/core/platform/types.h\"\n-#include \"tsl/platform/status.h\"\n \n namespace tensorflow {\n namespace {\n@@ -55,7 +56,7 @@ TEST(ShapeInferenceTest, Basics) {\n   auto g = ops::AddN(root.WithOpName(\"G\"), std::initializer_list<Output>{e, f});\n \n   std::unique_ptr<Graph> graph(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(root.ToGraph(graph.get()));\n+  CHECK_OK(root.ToGraph(graph.get()));\n \n   GraphShapeInfo shape_info;\n   TF_ASSERT_OK(InferShapes(graph.get(), /*arg_shapes=*/{},\n@@ -84,7 +85,7 @@ TEST(ShapeInferenceTest, UseArgShapesForVariableBatchSize) {\n   b.node()->AddAttr(\"_index\", 1);\n \n   std::unique_ptr<Graph> graph(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(root.ToGraph(graph.get()));\n+  CHECK_OK(root.ToGraph(graph.get()));\n \n   std::map<int, InferredShape> arg_shapes;\n   arg_shapes[0].shape = TensorShape({2, 3});\n@@ -118,7 +119,7 @@ TEST(ShapeInferenceTest, UseArgShapesForVariableBatchSizeIncompleteUserArgs) {\n   b.node()->AddAttr(\"_index\", 0);\n \n   std::unique_ptr<Graph> graph(new Graph(OpRegistry::Global()));\n-  TF_CHECK_OK(root.ToGraph(graph.get()));\n+  CHECK_OK(root.ToGraph(graph.get()));\n \n   std::map<int, InferredShape> arg_shapes;\n   arg_shapes[0].shape = TensorShape({2, 3});"
        },
        {
            "sha": "b72fd6e7aaa6eb9e88121f78cc8e5e34817614b5",
            "filename": "tensorflow/compiler/jit/test_util.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftest_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftest_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Ftest_util.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,14 +15,28 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/test_util.h\"\n \n+#include <map>\n #include <memory>\n #include <optional>\n #include <string>\n #include <utility>\n+#include <vector>\n \n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_join.h\"\n #include \"tensorflow/compiler/jit/shape_inference.h\"\n #include \"xla/status_macros.h\"\n+#include \"tensorflow/core/common_runtime/device_mgr.h\"\n+#include \"tensorflow/core/common_runtime/graph_runner.h\"\n+#include \"tensorflow/core/common_runtime/process_function_library_runtime.h\"\n #include \"tensorflow/core/framework/device_factory.h\"\n+#include \"tensorflow/core/framework/function.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/tensor_shape.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n+#include \"tensorflow/core/platform/errors.h\"\n #include \"tensorflow/core/public/version.h\"\n \n namespace tensorflow {\n@@ -71,15 +85,15 @@ void DeviceSetup::AddDevicesAndSetUp(\n   }\n \n   std::vector<std::unique_ptr<Device>> devices;\n-  TF_CHECK_OK(DeviceFactory::AddDevices(\n-      options, \"/job:localhost/replica:0/task:0\", &devices));\n+  CHECK_OK(DeviceFactory::AddDevices(options, \"/job:localhost/replica:0/task:0\",\n+                                     &devices));\n   device_mgr_ = std::make_unique<StaticDeviceMgr>(std::move(devices));\n \n   OptimizerOptions opts;\n   lib_def_ = std::make_unique<FunctionLibraryDefinition>(OpRegistry::Global(),\n                                                          FunctionDefLibrary());\n   if (fdef.has_value()) {\n-    TF_CHECK_OK(lib_def_->AddFunctionDef(*fdef));\n+    CHECK_OK(lib_def_->AddFunctionDef(*fdef));\n   }\n   pflr_ = std::make_unique<ProcessFunctionLibraryRuntime>(\n       device_mgr_.get(), Env::Default(), /*config=*/nullptr,\n@@ -96,7 +110,7 @@ Device* DeviceSetup::GetDevice(const std::string& device_name) {\n   std::string full_device_name = absl::StrCat(\n       \"/job:localhost/replica:0/task:0/device:\", device_name, \":0\");\n   Device* device;\n-  TF_CHECK_OK(device_mgr_->LookupDevice(full_device_name, &device));\n+  CHECK_OK(device_mgr_->LookupDevice(full_device_name, &device));\n   return device;\n }\n "
        },
        {
            "sha": "4c6a59e3f682fca26504a6273a9a8a0840587362",
            "filename": "tensorflow/compiler/jit/tests/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Ftests%2FBUILD?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -49,6 +49,8 @@ tf_cc_test(\n     deps = [\n         \":auto_clustering_test_helper\",\n         \"//tensorflow/core:test\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n     ],\n )"
        },
        {
            "sha": "806abbeb8e6d6ab6f8b0987696e489282de98d0b",
            "filename": "tensorflow/compiler/jit/tests/auto_clustering_test.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftests%2Fauto_clustering_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Ftests%2Fauto_clustering_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Ftests%2Fauto_clustering_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -13,9 +13,15 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include <string>\n+\n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"tensorflow/compiler/jit/tests/auto_clustering_test_helper.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"tensorflow/core/platform/test.h\"\n \n namespace tensorflow {\n namespace {\n@@ -85,7 +91,7 @@ absl::Status BenchmarkHelper(absl::string_view key, benchmark::State& state) {\n }\n \n void BM_MarkForCompilationPass_KerasImagenetMain(benchmark::State& state) {\n-  TF_CHECK_OK(BenchmarkHelper(\"keras_imagenet_main\", state));\n+  CHECK_OK(BenchmarkHelper(\"keras_imagenet_main\", state));\n }\n \n BENCHMARK(BM_MarkForCompilationPass_KerasImagenetMain);"
        },
        {
            "sha": "1d51d4d1ca2b90d8d6a80d19b0f68ed03e22b297",
            "filename": "tensorflow/compiler/jit/xla_cluster_util.cc",
            "status": "modified",
            "additions": 31,
            "deletions": 6,
            "changes": 37,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_cluster_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_cluster_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_cluster_util.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,25 +15,50 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/xla_cluster_util.h\"\n \n+#include <algorithm>\n+#include <cstddef>\n+#include <cstdint>\n+#include <optional>\n #include <string>\n #include <unordered_map>\n+#include <utility>\n+#include <vector>\n \n #include \"absl/algorithm/container.h\"\n+#include \"absl/container/flat_hash_map.h\"\n+#include \"absl/container/flat_hash_set.h\"\n #include \"absl/container/inlined_vector.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/status/statusor.h\"\n #include \"absl/strings/match.h\"\n-#include \"absl/strings/numbers.h\"\n #include \"absl/strings/str_cat.h\"\n-#include \"absl/strings/str_join.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"tensorflow/compiler/jit/flags.h\"\n+#include \"xla/service/graphcycles/graphcycles.h\"\n #include \"xla/status_macros.h\"\n-#include \"tensorflow/core/common_runtime/function.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n+#include \"tensorflow/core/common_runtime/function_body.h\"\n+#include \"tensorflow/core/common_runtime/optimization_registry.h\"\n+#include \"tensorflow/core/framework/attr_value_util.h\"\n #include \"tensorflow/core/framework/bounds_check.h\"\n+#include \"tensorflow/core/framework/function.h\"\n #include \"tensorflow/core/framework/node_def.pb.h\"\n+#include \"tensorflow/core/framework/node_def_util.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/op_def_builder.h\"\n+#include \"tensorflow/core/framework/types.h\"\n+#include \"tensorflow/core/graph/algorithm.h\"\n #include \"tensorflow/core/graph/control_flow.h\"\n+#include \"tensorflow/core/graph/edgeset.h\"\n+#include \"tensorflow/core/graph/graph.h\"\n #include \"tensorflow/core/lib/gtl/cleanup.h\"\n #include \"tensorflow/core/lib/strings/proto_serialization.h\"\n #include \"tensorflow/core/platform/errors.h\"\n-#include \"tensorflow/core/platform/fingerprint.h\"\n+#include \"tensorflow/core/platform/hash.h\"\n+#include \"tensorflow/core/platform/types.h\"\n #include \"tensorflow/core/public/session_options.h\"\n #include \"tensorflow/core/util/device_name_utils.h\"\n #include \"tensorflow/core/util/xla_config_registry.h\"\n@@ -460,8 +485,8 @@ absl::StatusOr<bool> DoesAnyCalleeHaveRefNodes(\n       return true;\n     }\n \n-    auto release_handle_on_return = gtl::MakeCleanup(\n-        [&] { TF_CHECK_OK(lib_runtime->ReleaseHandle(handle)); });\n+    auto release_handle_on_return =\n+        gtl::MakeCleanup([&] { CHECK_OK(lib_runtime->ReleaseHandle(handle)); });\n \n     const FunctionBody* fbody = lib_runtime->GetFunctionBody(handle);\n     TF_RETURN_IF_ERROR(GetNodesRelatedToRefVariablesInDirection("
        },
        {
            "sha": "027fd494ed8af5649ec3d0f4e657eabd30dfb235",
            "filename": "tensorflow/compiler/jit/xla_device_context.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 6,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_device_context.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_device_context.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_device_context.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,22 +15,45 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/xla_device_context.h\"\n \n+#include <cstddef>\n #include <functional>\n #include <memory>\n #include <optional>\n #include <string>\n #include <utility>\n #include <vector>\n \n-#include \"tensorflow/compiler/jit/xla_launch_util.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/status/statusor.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/synchronization/mutex.h\"\n+#include \"tensorflow/compiler/jit/xla_tensor.h\"\n+#include \"tensorflow/compiler/tf2xla/layout_util.h\"\n #include \"tensorflow/compiler/tf2xla/literal_util.h\"\n-#include \"tensorflow/compiler/tf2xla/shape_util.h\"\n #include \"tensorflow/compiler/tf2xla/xla_helpers.h\"\n-#include \"xla/util.h\"\n-#include \"tensorflow/core/common_runtime/device.h\"\n+#include \"xla/client/local_client.h\"\n+#include \"xla/layout_util.h\"\n+#include \"xla/literal.h\"\n+#include \"xla/service/stream_pool.h\"\n+#include \"xla/shape.h\"\n+#include \"xla/shape_util.h\"\n+#include \"xla/status_macros.h\"\n+#include \"xla/stream_executor/allocator_stats.h\"\n+#include \"xla/stream_executor/event.h\"\n+#include \"xla/stream_executor/stream.h\"\n+#include \"xla/stream_executor/stream_executor.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"tensorflow/core/common_runtime/dma_helper.h\"\n+#include \"tensorflow/core/framework/allocator.h\"\n+#include \"tensorflow/core/framework/device.h\"\n+#include \"tensorflow/core/framework/tensor.h\"\n #include \"tensorflow/core/framework/tensor_reference.h\"\n-#include \"tsl/platform/statusor.h\"\n+#include \"tensorflow/core/platform/errors.h\"\n+#include \"tensorflow/core/platform/status.h\"\n+#include \"tensorflow/core/platform/threadpool.h\"\n \n namespace tensorflow {\n \n@@ -249,7 +272,7 @@ void XlaDeviceContext::CopyDeviceTensorToCPU(const Tensor* device_tensor,\n   // shape as it is derived from the cpu_tensor's shape using\n   // shape_representation_fn_.\n   xla::MutableBorrowingLiteral literal;\n-  TF_CHECK_OK(HostTensorToMutableBorrowingLiteral(\n+  CHECK_OK(HostTensorToMutableBorrowingLiteral(\n       xla::LayoutUtil::GetWithDefaultLayout(\n           xla_tensor->shaped_buffer().on_host_shape()),\n       cpu_tensor, &literal));"
        },
        {
            "sha": "1804b1728c8c7fef920b6f1779b0ab6b975430d0",
            "filename": "tensorflow/compiler/jit/xla_kernel_creator_test.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 9,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_kernel_creator_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_kernel_creator_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_kernel_creator_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -15,16 +15,23 @@ limitations under the License.\n \n #include \"tensorflow/compiler/jit/xla_kernel_creator.h\"\n \n-#include \"absl/memory/memory.h\"\n+#include <memory>\n+#include <utility>\n+#include <vector>\n+\n+#include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n-#include \"tensorflow/core/common_runtime/device_factory.h\"\n-#include \"tensorflow/core/common_runtime/function.h\"\n-#include \"tensorflow/core/framework/function_testlib.h\"\n-#include \"tensorflow/core/framework/node_def_builder.h\"\n-#include \"tensorflow/core/framework/tensor_testutil.h\"\n-#include \"tensorflow/core/lib/core/errors.h\"\n-#include \"tensorflow/core/lib/core/status.h\"\n+#include \"tensorflow/core/common_runtime/device_mgr.h\"\n+#include \"tensorflow/core/common_runtime/process_function_library_runtime.h\"\n+#include \"tensorflow/core/framework/device.h\"\n+#include \"tensorflow/core/framework/device_factory.h\"\n+#include \"tensorflow/core/framework/function.h\"\n+#include \"tensorflow/core/framework/node_properties.h\"\n+#include \"tensorflow/core/framework/op.h\"\n+#include \"tensorflow/core/framework/types.h\"\n+#include \"tensorflow/core/platform/env.h\"\n #include \"tensorflow/core/platform/test.h\"\n+#include \"tensorflow/core/platform/types.h\"\n #include \"tensorflow/core/public/session_options.h\"\n #include \"tensorflow/core/public/version.h\"\n \n@@ -63,7 +70,7 @@ class XlaKernelCreatorTest : public ::testing::Test {\n     auto* device_count = options.config.mutable_device_count();\n     device_count->insert({\"CPU\", 1});\n     std::vector<std::unique_ptr<Device>> devices;\n-    TF_CHECK_OK(DeviceFactory::AddDevices(\n+    CHECK_OK(DeviceFactory::AddDevices(\n         options, \"/job:localhost/replica:0/task:0\", &devices));\n \n     FunctionDefLibrary proto;"
        },
        {
            "sha": "c35a7d0457c6ff24c308c0d5da29444cfa5fd95f",
            "filename": "tensorflow/compiler/jit/xla_launch_util.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -66,7 +66,6 @@ limitations under the License.\n #include \"xla/tsl/framework/device_id_utils.h\"\n #include \"xla/tsl/framework/serving_device_selector_policies.h\"\n #include \"xla/tsl/platform/errors.h\"\n-#include \"xla/tsl/platform/status.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/util.h\"\n #include \"tensorflow/core/common_runtime/dma_helper.h\"\n@@ -85,6 +84,7 @@ limitations under the License.\n #include \"tensorflow/core/platform/errors.h\"\n #include \"tensorflow/core/platform/status.h\"\n #include \"tensorflow/core/tfrt/common/async_value_tensor.h\"\n+#include \"tsl/platform/casts.h\"\n \n namespace tensorflow {\n namespace {\n@@ -323,7 +323,7 @@ absl::Status SetOutputForConstant(\n     }\n     ctx->op_device_context()->CopyCPUTensorToDevice(\n         &const_tensor, device, output_tensor,\n-        [&](absl::Status status) { TF_CHECK_OK(status); });\n+        [&](absl::Status status) { CHECK_OK(status); });\n \n     if (device->device_type() == DEVICE_GPU) {\n       // The GPUDeviceContext enqueues the host->device transfer in a\n@@ -562,7 +562,7 @@ XlaComputationLaunchContext::BuildXlaCompilerArguments(\n   }\n \n   absl::flat_hash_map<int, const VariableInfo*> variable_info_lookup;\n-  TF_CHECK_OK(CreateVariableInfoLookup(variable_args, variable_info_lookup));\n+  CHECK_OK(CreateVariableInfoLookup(variable_args, variable_info_lookup));\n   for (int64_t input_num = 0; input_num < inputs.size(); ++input_num) {\n     const Tensor* input = inputs[input_num];\n     XlaCompiler::Argument& arg = out.emplace_back();"
        },
        {
            "sha": "e3f32f8403379aafdac77d57f078e28deb1d3dc8",
            "filename": "tensorflow/compiler/jit/xla_launch_util_gpu_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_gpu_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_gpu_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_gpu_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -112,7 +112,7 @@ class PjRtExecutionUtilGpuTest : public OpsTestBase {\n \n     // Create the DeviceCompiler to help with compiling executables.\n     auto pjrt_client_or = GetOrCreatePjRtClient(device_type_);\n-    TF_CHECK_OK(pjrt_client_or.status());\n+    CHECK_OK(pjrt_client_or.status());\n     pjrt_client_ = pjrt_client_or.value();\n     device_compiler_ = new PjRtDeviceCompiler(\n         std::make_unique<PjRtDeviceExecutablePersistor>("
        },
        {
            "sha": "a2eb031da6c38c1ed07171142856fedf738844d8",
            "filename": "tensorflow/compiler/jit/xla_launch_util_test.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 5,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_launch_util_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -21,33 +21,50 @@ limitations under the License.\n #include <vector>\n \n #include <gtest/gtest.h>\n+#include \"absl/container/flat_hash_map.h\"\n #include \"absl/container/flat_hash_set.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/status/statusor.h\"\n+#include \"absl/types/span.h\"\n+#include \"tensorflow/compiler/jit/device_compilation_profiler.h\"\n #include \"tensorflow/compiler/jit/device_compiler.h\"\n+#include \"tensorflow/compiler/jit/device_executable_persistor.h\"\n #include \"tensorflow/compiler/jit/flags.h\"\n #include \"tensorflow/compiler/jit/pjrt_device_compiler_client.h\"\n #include \"tensorflow/compiler/jit/variable_info.h\"\n #include \"tensorflow/compiler/jit/variable_info_util.h\"\n+#include \"tensorflow/compiler/tf2xla/xla_compiler.h\"\n #include \"tensorflow/compiler/tf2xla/xla_op_registry.h\"\n+#include \"xla/literal.h\"\n+#include \"xla/literal_util.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n+#include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_client_options.h\"\n #include \"xla/pjrt/plugin/xla_cpu/xla_cpu_pjrt_client.h\"\n #include \"xla/tests/literal_test_util.h\"\n #include \"xla/tsl/framework/device_id_utils.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"tensorflow/core/framework/allocator.h\"\n #include \"tensorflow/core/framework/device.h\"\n+#include \"tensorflow/core/framework/device_base.h\"\n+#include \"tensorflow/core/framework/device_factory.h\"\n #include \"tensorflow/core/framework/fake_input.h\"\n #include \"tensorflow/core/framework/node_def_builder.h\"\n+#include \"tensorflow/core/framework/resource_handle.h\"\n+#include \"tensorflow/core/framework/resource_mgr.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/framework/tensor_testutil.h\"\n+#include \"tensorflow/core/framework/type_index.h\"\n #include \"tensorflow/core/framework/types.h\"\n #include \"tensorflow/core/kernels/ops_testutil.h\"\n+#include \"tensorflow/core/lib/gtl/array_slice.h\"\n #include \"tensorflow/core/platform/refcount.h\"\n+#include \"tensorflow/core/platform/types.h\"\n+#include \"tensorflow/core/public/session_options.h\"\n #include \"tensorflow/core/tfrt/common/create_pjrt_client_util.h\"\n #include \"tensorflow/core/tfrt/common/pjrt_util.h\"\n-#include \"tsl/platform/status.h\"\n-#include \"tsl/platform/statusor.h\"\n \n namespace tensorflow {\n namespace {\n@@ -93,11 +110,11 @@ class PjRtExecutionUtilTest : public OpsTestBase {\n     xla::CpuClientOptions options;\n     options.asynchronous = true;\n     options.cpu_device_count = 1;\n-    TF_CHECK_OK(SetPjRtClientInTFGlobalResourceManager(\n+    CHECK_OK(SetPjRtClientInTFGlobalResourceManager(\n         device_type, xla::GetXlaPjrtCpuClient(options).value()));\n \n     // device_context_ should be a PjRtDeviceContext.\n-    TF_CHECK_OK(device_->TryGetDeviceContext(&device_context_));\n+    CHECK_OK(device_->TryGetDeviceContext(&device_context_));\n \n     // Get the host allocator.\n     AllocatorAttributes host_alloc_attr;\n@@ -111,7 +128,7 @@ class PjRtExecutionUtilTest : public OpsTestBase {\n \n     // Create the DeviceCompiler to help with compiling executables.\n     auto pjrt_client_or = GetOrCreatePjRtClient(device_type_);\n-    TF_CHECK_OK(pjrt_client_or.status());\n+    CHECK_OK(pjrt_client_or.status());\n     pjrt_client_ = pjrt_client_or.value();\n     device_compiler_ = new PjRtDeviceCompiler(\n         std::make_unique<PjRtDeviceExecutablePersistor>("
        },
        {
            "sha": "7b45521daf2827b22a2cfd25f7513d4d15820ddb",
            "filename": "tensorflow/compiler/jit/xla_platform_info_test.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 8,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_platform_info_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f/tensorflow%2Fcompiler%2Fjit%2Fxla_platform_info_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fjit%2Fxla_platform_info_test.cc?ref=4e413608beef6a5b0c80ccea3ef6b60c6e3d0d2f",
            "patch": "@@ -18,17 +18,21 @@ limitations under the License.\n #include <memory>\n \n #include <gtest/gtest.h>\n+#include \"absl/log/check.h\"\n+#include \"tensorflow/compiler/jit/device_compilation_profiler.h\"\n+#include \"tensorflow/compiler/jit/device_compiler.h\"\n #include \"tensorflow/compiler/jit/flags.h\"\n #include \"tensorflow/compiler/jit/test_util.h\"\n+#include \"tensorflow/compiler/tf2xla/xla_op_registry.h\"\n+#include \"xla/client/local_client.h\"\n+#include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/plugin/xla_cpu/cpu_client_options.h\"\n #include \"xla/pjrt/plugin/xla_cpu/xla_cpu_pjrt_client.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"tensorflow/core/framework/device_base.h\"\n #include \"tensorflow/core/framework/types.h\"\n-#include \"tensorflow/core/lib/core/status.h\"\n-#include \"tensorflow/core/lib/core/status_test_util.h\"\n #include \"tensorflow/core/platform/refcount.h\"\n-#include \"tensorflow/core/platform/status_matchers.h\"\n-#include \"tensorflow/core/platform/statusor.h\"\n #include \"tensorflow/core/protobuf/error_codes.pb.h\"\n #include \"tensorflow/core/tfrt/common/create_pjrt_client_util.h\"\n #include \"tensorflow/core/tfrt/common/pjrt_util.h\"\n@@ -65,7 +69,7 @@ TEST_F(XlaPlatformInfoTest, BuildXlaDeviceCompilerXlaDeviceMetadata) {\n \n   Device* device = device_setup_.GetDevice(DEVICE_XLA_GPU);\n   const XlaDevice::Metadata* metadata = nullptr;\n-  TF_CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n+  CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n   XlaPlatformInfo platform_info = XlaPlatformInfoFromDevice(device);\n \n   TF_ASSERT_OK_AND_ASSIGN(\n@@ -91,7 +95,7 @@ TEST_F(XlaPlatformInfoTest, BuildXlaDeviceCompilerXlaDeviceCacheEnabled) {\n \n   Device* device = device_setup_.GetDevice(DEVICE_XLA_GPU);\n   const XlaDevice::Metadata* metadata = nullptr;\n-  TF_CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n+  CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n   XlaPlatformInfo platform_info = XlaPlatformInfoFromDevice(device);\n \n   TF_ASSERT_OK_AND_ASSIGN(\n@@ -134,7 +138,7 @@ TEST_F(XlaPlatformInfoTest, GetOrCreatePjRtDeviceCompilerAndProfilerXlaDevice) {\n \n   Device* device = device_setup_.GetDevice(device_type.type());\n   const XlaDevice::Metadata* metadata = nullptr;\n-  TF_CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n+  CHECK_OK(XlaDevice::GetMetadataFromDevice(device, &metadata));\n   XlaPlatformInfo platform_info = XlaPlatformInfoFromDevice(device);\n \n   ResourceMgr resource_mgr(\"\");\n@@ -254,7 +258,7 @@ TEST_F(XlaPlatformInfoTest,\n   xla::CpuClientOptions options;\n   options.asynchronous = true;\n   options.cpu_device_count = 1;\n-  TF_CHECK_OK(SetPjRtClientInTFGlobalResourceManager(\n+  CHECK_OK(SetPjRtClientInTFGlobalResourceManager(\n       device_type, xla::GetXlaPjrtCpuClient(options).value()));\n   TF_ASSERT_OK_AND_ASSIGN(auto pjrt_client, GetOrCreatePjRtClient(device_type));\n "
        }
    ],
    "stats": {
        "total": 815,
        "additions": 529,
        "deletions": 286
    }
}