{
    "author": "tensorflower-gardener",
    "message": "[SymbolicExpr] Refactor `SimplifyFloorDivAddOperand` for clarity\n\nPiperOrigin-RevId: 799027867",
    "sha": "3789841612a8fb22cdb1e7a75cac216122880d1d",
    "files": [
        {
            "sha": "e6e92849d49ea2a19e6e0d7c9c29c074ff834f89",
            "filename": "third_party/xla/xla/service/gpu/model/experimental/symbolic_expr.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3789841612a8fb22cdb1e7a75cac216122880d1d/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3789841612a8fb22cdb1e7a75cac216122880d1d/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fexperimental%2Fsymbolic_expr.cc?ref=3789841612a8fb22cdb1e7a75cac216122880d1d",
            "patch": "@@ -369,28 +369,28 @@ SymbolicExpr TrySimplifyDivModByGCD(SymbolicExprType op_type, SymbolicExpr lhs,\n   }\n }\n \n-// Helper function to simplify (A + B) floordiv div if A is multiple of div.\n+// Simplifies (A + B) floordiv C = (A / C) + (B floordiv C) if A is a multiple\n+// of C.\n SymbolicExpr SimplifyFloorDivAddOperand(SymbolicExpr a, SymbolicExpr b,\n                                         int64_t div) {\n-  if (a.GetType() == SymbolicExprType::kMul) {\n-    SymbolicExpr a_lhs = a.GetLHS();\n-    SymbolicExpr a_rhs = a.GetRHS();\n+  int64_t a_coeff;\n+  SymbolicExpr remaining_expr;\n \n-    // a_lhs can't be a constant because lhs is already canonicalized.\n-    if (a_rhs.GetType() != SymbolicExprType::kConstant) {\n-      return SymbolicExpr();\n-    }\n-\n-    int64_t a_rhs_val = a_rhs.GetValue();\n-    if (a_rhs_val != 0 && (a_rhs_val % div == 0)) {\n-      return ((a_lhs * (a_rhs_val / div)) + b.floorDiv(div)).Canonicalize();\n-    }\n+  if (a.GetType() == SymbolicExprType::kMul &&\n+      a.GetRHS().GetType() == SymbolicExprType::kConstant) {\n+    a_coeff = a.GetRHS().GetValue();\n+    remaining_expr = a.GetLHS();\n   } else if (a.GetType() == SymbolicExprType::kConstant) {\n-    if (a.GetValue() % div == 0) {\n-      return ((b.floorDiv(div)) + (a.GetValue() / div)).Canonicalize();\n-    }\n+    a_coeff = a.GetValue();\n+    remaining_expr = a.GetContext()->CreateConstant(1);\n+  } else {\n+    return SymbolicExpr();  // Cannot simplify\n+  }\n+\n+  if (a_coeff % div != 0) {\n+    return SymbolicExpr();  // Cannot simplify\n   }\n-  return SymbolicExpr();  // Cannot simplify\n+  return (remaining_expr * (a_coeff / div) + b / div).Canonicalize();\n }\n \n SymbolicExpr CanonicalizeFloorDiv(SymbolicExpr lhs, SymbolicExpr rhs) {"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 17,
        "deletions": 17
    }
}