{
    "author": "junwhanahn",
    "message": "Return an error from `xla::ifrt::HloSharding::IndexDomains()` on unreduced sharding\n\nUnreduced sharding does not have tile assignments, so there is no reasonable way to define index domains.\n\nPiperOrigin-RevId: 840831146",
    "sha": "d9f951930b57872df2d3263a62ad28d9576734a9",
    "files": [
        {
            "sha": "ae84901c89c956c08cbbd72a308254b08ec21de5",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/xla_sharding.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d9f951930b57872df2d3263a62ad28d9576734a9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d9f951930b57872df2d3263a62ad28d9576734a9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding.cc?ref=d9f951930b57872df2d3263a62ad28d9576734a9",
            "patch": "@@ -290,6 +290,10 @@ absl::StatusOr<std::vector<IndexDomain>> HloSharding::IndexDomains(\n     return absl::InvalidArgumentError(\n         \"Manual sharding does not support IndexDomains\");\n   }\n+  if (xla_hlo_sharding_.IsUnreduced()) {\n+    return absl::InvalidArgumentError(\n+        \"Unreduced sharding does not support IndexDomains\");\n+  }\n   if (xla_hlo_sharding_.IsReplicated() || xla_hlo_sharding_.IsTileMaximal()) {\n     // Fast path for a fully replicated or maximal sharding.\n     IndexDomain element(shape);"
        },
        {
            "sha": "ced4e53bff97eae73c1d5c59eeafc0ef4544d8fa",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/xla_sharding_test.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d9f951930b57872df2d3263a62ad28d9576734a9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d9f951930b57872df2d3263a62ad28d9576734a9/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fxla_sharding_test.cc?ref=d9f951930b57872df2d3263a62ad28d9576734a9",
            "patch": "@@ -858,6 +858,20 @@ TEST_P(HloShardingTest, IndexDomainsWithTileTranspose) {\n   }\n }\n \n+TEST_P(HloShardingTest, IndexDomainsWithUnreduced) {\n+  auto device_list = GetDevices({0, 1, 2, 3, 4, 5});\n+  auto xla_hlo_sharding = xla::HloSharding::Unreduced();\n+  std::shared_ptr<const HloSharding> sharding =\n+      HloSharding::Create(device_list, MemoryKind(), xla_hlo_sharding);\n+\n+  Shape shape({10, 20});\n+  EXPECT_THAT(\n+      sharding->IndexDomains(shape).status(),\n+      absl_testing::StatusIs(\n+          tsl::error::INVALID_ARGUMENT,\n+          HasSubstr(\"Unreduced sharding does not support IndexDomains\")));\n+}\n+\n TEST_P(HloShardingTest, IndexDomainsWithManual) {\n   auto device_list = GetDevices({0, 1, 2, 3, 4, 5});\n   auto xla_hlo_sharding = xla::HloSharding::Manual();"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 18,
        "deletions": 0
    }
}