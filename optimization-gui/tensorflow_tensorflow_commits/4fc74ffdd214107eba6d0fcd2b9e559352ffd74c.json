{
    "author": "jaro-sevcik",
    "message": "PR #32846: Allow mixed precision operands for collective permute\n\nImported from GitHub PR https://github.com/openxla/xla/pull/32846\n\nüìù Summary of Changes\nAllow mixed precision collective-permute in the verifier.\n\nüéØ Justification\nPartially addresses https://github.com/openxla/xla/issues/32845\n\nüöÄ Kind of Contribution\nüêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nN/A\n\nüß™ Unit Tests:\nTests that verifier passes on mixed precision collective-permute.\n\nüß™ Execution Tests:\nN/A\nCopybara import of the project:\n\n--\n666c38a19005a609d4a7aa8e5e9b9842b1c87175 by Jaroslav Sevcik <jsevcik@nvidia.com>:\n\nAllow mixed precision for collective permute\n\nMerging this change closes #32846\n\nPiperOrigin-RevId: 822179840",
    "sha": "4fc74ffdd214107eba6d0fcd2b9e559352ffd74c",
    "files": [
        {
            "sha": "4e03a7f4246c3893f12efa21590f195ce5999e80",
            "filename": "third_party/xla/xla/service/hlo_verifier.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4fc74ffdd214107eba6d0fcd2b9e559352ffd74c/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4fc74ffdd214107eba6d0fcd2b9e559352ffd74c/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier.cc?ref=4fc74ffdd214107eba6d0fcd2b9e559352ffd74c",
            "patch": "@@ -1897,6 +1897,7 @@ absl::Status CheckMixedPrecisionOperands(const HloInstruction* instruction) {\n     case HloOpcode::kAsyncDone:\n     case HloOpcode::kAsyncUpdate:\n     case HloOpcode::kAsyncStart:\n+    case HloOpcode::kCollectivePermute:\n     case HloOpcode::kCollectivePermuteStart:\n     case HloOpcode::kCollectivePermuteDone:\n     case HloOpcode::kCopyDone:"
        },
        {
            "sha": "1e9dad4b8f3ee5b3e6c18b67dbd90e3ef33a7d76",
            "filename": "third_party/xla/xla/service/hlo_verifier_test.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4fc74ffdd214107eba6d0fcd2b9e559352ffd74c/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4fc74ffdd214107eba6d0fcd2b9e559352ffd74c/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_verifier_test.cc?ref=4fc74ffdd214107eba6d0fcd2b9e559352ffd74c",
            "patch": "@@ -2261,6 +2261,24 @@ TEST_F(HloVerifierTest, CollectivePermuteAsyncMixedPrecisionOperandsAllowed) {\n   ASSERT_TRUE(status.ok());\n }\n \n+TEST_F(HloVerifierTest, CollectivePermuteMixedPrecisionOperandsAllowed) {\n+  const char* const kModuleStr = R\"(\n+    HloModule test\n+    ENTRY entry {\n+      p0 = f32[128] parameter(0)\n+      p1 = bf16[128] parameter(1)\n+      ROOT permute = (f32[128], bf16[128]) collective-permute(p0, p1),\n+        source_target_pairs={{0,1}, {1,0}}, channel_id=1\n+    }\n+    )\";\n+  HloModuleConfig config;\n+  config.set_num_partitions(2);\n+  TF_ASSERT_OK_AND_ASSIGN(auto module,\n+                          ParseAndReturnUnverifiedModule(kModuleStr, config));\n+  auto status = verifier().Run(module.get()).status();\n+  ASSERT_TRUE(status.ok());\n+}\n+\n TEST_F(HloVerifierTest, FusionMoreOperandsThanParameters) {\n   const char* const kModuleStr = R\"(\n   HloModule test"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 19,
        "deletions": 0
    }
}