{
    "author": "nvgrw",
    "message": "Migrate multioutput_fusion_test to use PjRt.\n\nPiperOrigin-RevId: 826203532",
    "sha": "31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb",
    "files": [
        {
            "sha": "d9ddb9307a4d8f638ae294e451c08d66abc28869",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb",
            "patch": "@@ -3188,11 +3188,12 @@ xla_test(\n     name = \"multioutput_fusion_test\",\n     srcs = [\"multioutput_fusion_test.cc\"],\n     backends = [\"gpu\"],\n+    tags = [\"test_migrated_to_hlo_runner_pjrt\"],\n     deps = [\n-        \":client_library_test_base\",\n-        \":hlo_test_base\",\n+        \":hlo_pjrt_interpreter_reference_mixin\",\n+        \":hlo_pjrt_test_base\",\n         \":literal_test_util\",\n-        \":xla_internal_test_main\",\n+        \":xla_internal_test_main\",  # fixdeps: keep\n         \"//xla:error_spec\",\n         \"//xla:literal\",\n         \"//xla:literal_util\","
        },
        {
            "sha": "0514b0bd4f1629d9ee1c423e385bc44b64bc5318",
            "filename": "third_party/xla/xla/tests/multioutput_fusion_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc?ref=31bb7c01ff5d36dfb3248e6c8adc2b54d241d7cb",
            "patch": "@@ -30,7 +30,8 @@ limitations under the License.\n #include \"xla/literal_util.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n-#include \"xla/tests/hlo_test_base.h\"\n+#include \"xla/tests/hlo_pjrt_interpreter_reference_mixin.h\"\n+#include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n #include \"xla/tsl/platform/status.h\"\n #include \"xla/tsl/platform/statusor.h\"\n@@ -40,15 +41,16 @@ limitations under the License.\n namespace xla {\n namespace {\n \n-class MultiOutputFusionTest : public HloTestBase {\n- protected:\n-  MultiOutputFusionTest() { error_spec_ = ErrorSpec{0.0001, 1e-2}; }\n+constexpr ErrorSpec kErrorSpec{0.0001, 1e-2};\n \n+class MultiOutputFusionTest\n+    : public HloPjRtInterpreterReferenceMixin<HloPjRtTestBase> {\n+ protected:\n   // Layout assignment assumes that there are no fusions in the input graph.\n   // Since the purpose of this test is to send pre-fused graphs to XLA, we have\n   // to do layout assignment ourselves.\n   DebugOptions GetDebugOptionsForTest() const override {\n-    auto opts = HloTestBase::GetDebugOptionsForTest();\n+    auto opts = HloPjRtTestBase::GetDebugOptionsForTest();\n     opts.add_xla_disable_hlo_passes(\"layout-assignment\");\n     return opts;\n   }\n@@ -110,7 +112,7 @@ class MultiOutputFusionTest : public HloTestBase {\n     Literal literal_r0 = LiteralUtil::CreateR0<float>(-9.0f);\n     TF_ASSERT_OK_AND_ASSIGN(\n         Literal actual, Execute(std::move(hlo_module), {&literal_r0, &arg1}));\n-    EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, error_spec_));\n+    EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, kErrorSpec));\n   }\n \n   void RunTest1D(bool manual_fusion, int size) {\n@@ -174,7 +176,7 @@ class MultiOutputFusionTest : public HloTestBase {\n     Literal expect = LiteralUtil::CreateR1<float>({size * 1.5f * 3.5f});\n     TF_ASSERT_OK_AND_ASSIGN(Literal actual,\n                             Execute(std::move(hlo_module), {&input0, &input1}));\n-    EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, error_spec_));\n+    EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, kErrorSpec));\n   }\n };\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 13,
        "deletions": 10
    }
}