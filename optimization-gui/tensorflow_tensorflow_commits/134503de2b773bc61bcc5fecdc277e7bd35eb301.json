{
    "author": "meteorcloudy",
    "message": "Support building XLA with Bzlmod\n\n- Added MODULE.bazel and module extensions to introduce external dependencies with Bzlmod.\n- Added a CI config for Linux CPU build with Bzlmod (enabled by `--config=bzlmod`)\n\nTODOs:\n- Support overriding Python runtime\n- Support build with more configs and platforms\nPiperOrigin-RevId: 817711851",
    "sha": "134503de2b773bc61bcc5fecdc277e7bd35eb301",
    "files": [
        {
            "sha": "1fd3ae0a337ee2177cba802db04af46a8c6f282d",
            "filename": "third_party/py/python_configure.bzl",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fpy%2Fpython_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fpy%2Fpython_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fpy%2Fpython_configure.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -7,12 +7,19 @@ load(\n     \"PYTHON_BIN_PATH\",\n     \"PYTHON_LIB_PATH\",\n )\n-load(\"//third_party/py:python_init_toolchains.bzl\", \"get_toolchain_name_per_python_version\")\n+load(\"@python_version_repo//:py_version.bzl\", \"HERMETIC_PYTHON_VERSION\")\n+load(\"@pythons_hub//:interpreters.bzl\", \"INTERPRETER_LABELS\")\n+\n+def _is_bzlmod_enabled():\n+    return str(Label(\"@//:BUILD.bazel\")).startswith(\"@@\")\n \n def _get_python_interpreter():\n-    return \"@{}_host//:python\".format(\n-        get_toolchain_name_per_python_version(\"python\"),\n+    python_toolchain_name = \"python_{version}_host\".format(\n+        version = HERMETIC_PYTHON_VERSION.replace(\".\", \"_\"),\n     )\n+    if _is_bzlmod_enabled():\n+        return str(INTERPRETER_LABELS[python_toolchain_name])\n+    return \"@{}_host//:python\".format(python_toolchain_name)\n \n def _create_local_python_repository(repository_ctx):\n     \"\"\"Creates the repository containing files set up to build with Python.\"\"\""
        },
        {
            "sha": "6667d9b9986503e95ee3922eaaf7308509cbc6fa",
            "filename": "third_party/xla/.bazelrc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2F.bazelrc?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -1,5 +1,6 @@\n # Disable Bzlmod for now\n common --noenable_bzlmod\n+common:bzlmod --enable_bzlmod --noenable_workspace\n \n common --incompatible_enable_cc_toolchain_resolution\n common --repo_env USE_HERMETIC_CC_TOOLCHAIN=1"
        },
        {
            "sha": "a8a835467f9a60fb14a39236d232ca09027c15ba",
            "filename": "third_party/xla/.github/workflows/ci.yml",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2F.github%2Fworkflows%2Fci.yml?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -48,6 +48,12 @@ jobs:\n             name: \"XLA Linux x86 CPU\",\n             repo: \"openxla/xla\",\n           },\n+          {\n+            pool: \"linux-x86-n2-16\",\n+            container: \"us-docker.pkg.dev/ml-oss-artifacts-published/ml-public-container/ml-build:latest\",\n+            name: \"XLA Linux x86 CPU Bzlmod\",\n+            repo: \"openxla/xla\",\n+          },\n           {\n             pool: \"linux-x86-n2-16\",\n             container: \"us-docker.pkg.dev/ml-oss-artifacts-published/ml-public-container/ml-build:latest\","
        },
        {
            "sha": "619ec239a7809ce8e55413cc23f630fbd0f931d0",
            "filename": "third_party/xla/.gitignore",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.gitignore",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2F.gitignore",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2F.gitignore?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -8,6 +8,9 @@ bazel-bin\n bazel-out\n bazel-testlogs\n \n+# Ignore Bazel lock file\n+MODULE.bazel.lock\n+\n # Ignore files produced by `configure`\n .tf_configure.bazelrc\n xla_configure.bazelrc"
        },
        {
            "sha": "c201a68db1f19c968a611ee5faf0a973ba94f0d7",
            "filename": "third_party/xla/MODULE.bazel",
            "status": "added",
            "additions": 203,
            "deletions": 0,
            "changes": 203,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2FMODULE.bazel?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,203 @@\n+module(name = \"xla\")\n+\n+##############################################################\n+# Bazel module dependencies\n+\n+bazel_dep(name = \"abseil-cpp\", version = \"20250814.0\", repo_name = \"com_google_absl\")\n+bazel_dep(name = \"abseil-py\", version = \"2.1.0\", repo_name = \"absl_py\")\n+bazel_dep(name = \"bazel_features\", version = \"1.36.0\")\n+bazel_dep(name = \"bazel_skylib\", version = \"1.8.1\")\n+bazel_dep(name = \"boringssl\", version = \"0.20250818.0\")\n+bazel_dep(name = \"curl\", version = \"8.11.0\")\n+bazel_dep(name = \"google_benchmark\", version = \"1.8.5\", repo_name = \"com_google_benchmark\")\n+bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest\")\n+bazel_dep(name = \"grpc\", version = \"1.74.1\", repo_name = \"com_github_grpc_grpc\")\n+bazel_dep(name = \"jsoncpp\", version = \"1.9.6\", repo_name = \"jsoncpp_git\")\n+bazel_dep(name = \"or-tools\", version = \"9.12\", repo_name = \"com_google_ortools\")\n+bazel_dep(name = \"platforms\", version = \"1.0.0\")\n+bazel_dep(name = \"protobuf\", version = \"32.1\", repo_name = \"com_google_protobuf\")\n+bazel_dep(name = \"pybind11_abseil\", version = \"202402.0\")\n+bazel_dep(name = \"pybind11_bazel\", version = \"2.13.6\")\n+bazel_dep(name = \"pybind11_protobuf\", version = \"0.0.0-20250210-f02a2b7\")\n+bazel_dep(name = \"re2\", version = \"2024-07-02.bcr.1\", repo_name = \"com_googlesource_code_re2\")\n+bazel_dep(name = \"rules_cc\", version = \"0.2.0\")\n+bazel_dep(name = \"rules_license\", version = \"1.0.0\")\n+bazel_dep(name = \"rules_python\", version = \"1.6.0\")\n+bazel_dep(name = \"rules_shell\", version = \"0.6.1\")\n+bazel_dep(name = \"snappy\", version = \"1.2.1\")\n+bazel_dep(name = \"zlib\", version = \"1.3.1.bcr.5\")\n+\n+# Only for compatibility, not directly used, change repo_name to None after upgrading Bazel to latest 7.x\n+bazel_dep(name = \"eigen\", version = \"4.0.0-20241125.bcr.3\", repo_name = \"DO_NOT_USE_eigen\")\n+bazel_dep(name = \"grpc-java\", version = \"1.75.0\", repo_name = \"DO_NOT_USE_grpc_java\")\n+\n+# TODO: publish an official version of rules_ml_toolchain to BCR\n+bazel_dep(name = \"rules_ml_toolchain\")\n+archive_override(\n+  module_name = \"rules_ml_toolchain\",\n+  integrity = \"sha256-1a7xQJbzZ7rm8t61lGoxiSsGut1mD4ww9lZaD5qZGF8=\",\n+  urls = [\"https://github.com/google-ml-infra/rules_ml_toolchain/archive/18ba88facf7f0d7203adbaccb982315936b1ac7a.tar.gz\"],\n+  strip_prefix = \"rules_ml_toolchain-18ba88facf7f0d7203adbaccb982315936b1ac7a\",\n+)\n+\n+# TODO: Upstream the patch?\n+single_version_override(\n+  module_name = \"grpc\",\n+  patches = [\"//third_party/grpc:grpc.patch\"],\n+  patch_strip = 1,\n+)\n+\n+# TODO: Upstream those patch?\n+single_version_override(\n+  module_name = \"abseil-cpp\",\n+  patches = [\n+      \"//third_party/absl:btree.patch\",\n+      \"//third_party/absl:build_dll.patch\",\n+      \"//third_party/absl:endian.patch\",\n+      \"//third_party/absl:rules_cc.patch\",\n+      \"//third_party/absl:check_op.patch\",\n+      \"//third_party/absl:check_op_2.patch\",\n+  ],\n+  patch_strip = 1,\n+)\n+\n+# Use an unreleased version of googletest\n+archive_override(\n+  module_name = \"googletest\",\n+  urls = [\"https://github.com/google/googletest/archive/28e9d1f26771c6517c3b4be10254887673c94018.zip\"],\n+  strip_prefix = \"googletest-28e9d1f26771c6517c3b4be10254887673c94018\",\n+)\n+\n+##############################################################\n+# C++ dependencies\n+\n+# TODO: most of them can be Bazel modules, but we need a release strategy for them\n+third_party = use_extension(\"//third_party/extensions:third_party.bzl\", \"third_party_ext\")\n+use_repo(third_party,\n+    \"cpuinfo\",\n+    \"cudnn_frontend_archive\",\n+    \"ducc\",\n+    \"eigen_archive\",\n+    \"farmhash_archive\",\n+    \"farmhash_gpu_archive\",\n+    \"FXdiv\",\n+    \"gloo\",\n+    \"highwayhash\",\n+    \"hwloc\",\n+    \"implib_so\",\n+    \"llvm_openmp\",\n+    \"llvm-raw\",\n+    \"ml_dtypes_py\",\n+    \"mpitrampoline\",\n+    \"nanobind\",\n+    \"nvshmem\",\n+    \"onednn\",\n+    \"pthreadpool\",\n+    \"rocm_device_libs\",\n+    \"shardy\",\n+    \"stablehlo\",\n+    \"triton\",\n+    \"XNNPACK\",\n+)\n+\n+##############################################################\n+# Python toolchain and pypi dependencies\n+\n+python = use_extension(\"@rules_python//python/extensions:python.bzl\", \"python\")\n+python.defaults(python_version = \"3.11\")\n+python.toolchain(python_version = \"3.11\")\n+use_repo(python, \"pythons_hub\")\n+\n+pip = use_extension(\"@rules_python//python/extensions:pip.bzl\", \"pip\")\n+\n+pip.whl_mods(\n+    hub_name = \"pypi_mods\",\n+    whl_name = \"numpy\",\n+    additive_build_content = \"\"\"\n+load(\"@rules_cc//cc:cc_library.bzl\", \"cc_library\")\n+cc_library(\n+    name = \"numpy_headers_2\",\n+    hdrs = glob([\"site-packages/numpy/_core/include/**/*.h\"]),\n+    strip_include_prefix=\"site-packages/numpy/_core/include/\",\n+)\n+cc_library(\n+    name = \"numpy_headers_1\",\n+    hdrs = glob([\"site-packages/numpy/core/include/**/*.h\"]),\n+    strip_include_prefix=\"site-packages/numpy/core/include/\",\n+)\n+cc_library(\n+    name = \"numpy_headers\",\n+    deps = [\":numpy_headers_2\", \":numpy_headers_1\"],\n+)\n+\"\"\",\n+)\n+\n+pip.parse(\n+    hub_name = \"xla_pypi\",\n+    python_version = \"3.11\",\n+    requirements_lock = \"//:requirements_lock_3_11.txt\",\n+    whl_modifications = {\n+        \"@pypi_mods//:numpy.json\": \"numpy\",\n+    },\n+    extra_hub_aliases = {\n+        \"numpy\": [\"numpy_headers\"],\n+    }\n+)\n+\n+use_repo(pip, \"pypi_mods\", \"xla_pypi_311_numpy\", pypi = \"xla_pypi\")\n+\n+python_version_ext = use_extension(\"//third_party/extensions:python_version.bzl\", \"python_version_ext\")\n+use_repo(python_version_ext, \"python_version_repo\")\n+\n+##############################################################\n+# Other dependencies via module extensions\n+\n+### TSL\n+tsl_extension = use_extension(\"//third_party/extensions:tsl.bzl\", \"tsl_extension\")\n+use_repo(tsl_extension, \"tsl\")\n+\n+### LLVM\n+llvm = use_extension(\"//third_party/extensions:llvm.bzl\", \"llvm_extension\")\n+use_repo(llvm, \"llvm-project\")\n+\n+### pybind\n+pybind11_internal_configure = use_extension(\n+    \"@pybind11_bazel//:internal_configure.bzl\",\n+    \"internal_configure_extension\",\n+)\n+use_repo(pybind11_internal_configure, \"pybind11\")\n+\n+### RBE\n+rbe_config = use_extension(\"//third_party/extensions:rbe_config.bzl\", \"rbe_config_ext\")\n+use_repo(rbe_config, \"ml_build_config_platform\")\n+\n+remote_execution_configure = use_extension(\"//third_party/extensions:remote_execution_configure.bzl\", \"remote_execution_configure_ext\")\n+use_repo(remote_execution_configure, \"local_config_remote_execution\")\n+\n+### From @rules_ml_toolchain\n+cuda_configure = use_extension(\"@rules_ml_toolchain//third_party/extensions:cuda_configure.bzl\", \"cuda_configure_ext\")\n+use_repo(cuda_configure, \"local_config_cuda\")\n+\n+nccl_configure = use_extension(\"@rules_ml_toolchain//third_party/extensions:nccl_configure.bzl\", \"nccl_configure_ext\")\n+use_repo(nccl_configure, \"local_config_nccl\")\n+\n+sycl_configure = use_extension(\"@rules_ml_toolchain//third_party/extensions:sycl_configure.bzl\", \"sycl_configure_ext\")\n+use_repo(sycl_configure, \"local_config_sycl\")\n+\n+cuda_redist_init_ext = use_extension(\"@rules_ml_toolchain//third_party/extensions:cuda_redist_init.bzl\", \"cuda_redist_init_ext\")\n+use_repo(cuda_redist_init_ext, \"cuda_cudart\")\n+\n+register_toolchains(\"@rules_ml_toolchain//cc:linux_x86_64_linux_x86_64\")\n+\n+register_toolchains(\"@rules_ml_toolchain//cc:linux_x86_64_linux_x86_64_cuda\")\n+\n+register_toolchains(\"@rules_ml_toolchain//cc:linux_aarch64_linux_aarch64\")\n+\n+register_toolchains(\"@rules_ml_toolchain//cc:linux_aarch64_linux_aarch64_cuda\")\n+\n+### Other local config repos\n+rocm_configure = use_extension(\"//third_party/extensions:rocm_configure.bzl\", \"rocm_configure_ext\")\n+use_repo(rocm_configure, \"local_config_rocm\")\n+\n+tensorrt_configure = use_extension(\"//third_party/extensions:tensorrt_configure.bzl\", \"tensorrt_configure_ext\")\n+use_repo(tensorrt_configure, \"local_config_tensorrt\")"
        },
        {
            "sha": "8b25ec8e1486620f70d5262f05946517e2bd69f6",
            "filename": "third_party/xla/build_tools/ci/build.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fci%2Fbuild.py?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -107,6 +107,7 @@ class BuildType(enum.Enum):\n   \"\"\"\n \n   XLA_LINUX_X86_CPU_GITHUB_ACTIONS = enum.auto()\n+  XLA_LINUX_X86_CPU_BZLMOD_GITHUB_ACTIONS = enum.auto()\n   XLA_LINUX_ARM64_CPU_GITHUB_ACTIONS = enum.auto()\n   XLA_LINUX_X86_GPU_L4_GITHUB_ACTIONS = enum.auto()\n   XLA_LINUX_X86_GPU_ONEAPI_GITHUB_ACTIONS = enum.auto()\n@@ -311,6 +312,16 @@ def nvidia_gpu_build_with_compute_capability(\n     options={**_DEFAULT_BAZEL_OPTIONS, \"//xla/tsl:ci_build\": True},\n )\n \n+Build(\n+    type_=BuildType.XLA_LINUX_X86_CPU_BZLMOD_GITHUB_ACTIONS,\n+    repo=\"openxla/xla\",\n+    configs=(\"warnings\", \"nonccl\", \"rbe_linux_cpu\", \"bzlmod\"),\n+    target_patterns=_XLA_DEFAULT_TARGET_PATTERNS,\n+    build_tag_filters=cpu_x86_tag_filter,\n+    test_tag_filters=cpu_x86_tag_filter,\n+    options={**_DEFAULT_BAZEL_OPTIONS, \"//xla/tsl:ci_build\": True},\n+)\n+\n cpu_arm_tag_filter = (\n     \"-no_oss\",\n     \"-gpu\","
        },
        {
            "sha": "f5a5cf7312c552d035d85b6960a642adf9c6add7",
            "filename": "third_party/xla/build_tools/ci/golden_commands.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Fci%2Fgolden_commands.txt?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -39,6 +39,11 @@ parallel --ungroup --retries 3 --delay 15 --nonall -- bazel build --build_tag_fi\n bazel build --build_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --test_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --config=warnings --config=nonccl --config=rbe_linux_cpu --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --//xla/tsl:ci_build -- //xla/tools/multihost_hlo_runner:hlo_runner_main //xla/tools:compute_xspace_stats_main\n bazel analyze-profile profile.json.gz\n # END BuildType.XLA_LINUX_X86_CPU_128_VCPU_PRESUBMIT_GITHUB_ACTIONS\n+# BEGIN BuildType.XLA_LINUX_X86_CPU_BZLMOD_GITHUB_ACTIONS\n+parallel --ungroup --retries 3 --delay 15 --nonall -- bazel build --build_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --test_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --config=warnings --config=nonccl --config=rbe_linux_cpu --config=bzlmod --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --//xla/tsl:ci_build --nobuild -- //xla/... //build_tools/... @local_tsl//tsl/...\n+bazel test --build_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --test_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --config=warnings --config=nonccl --config=rbe_linux_cpu --config=bzlmod --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --//xla/tsl:ci_build -- //xla/... //build_tools/... @local_tsl//tsl/...\n+bazel analyze-profile profile.json.gz\n+# END BuildType.XLA_LINUX_X86_CPU_BZLMOD_GITHUB_ACTIONS\n # BEGIN BuildType.XLA_LINUX_X86_CPU_GITHUB_ACTIONS\n parallel --ungroup --retries 3 --delay 15 --nonall -- bazel build --build_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --test_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --config=warnings --config=nonccl --config=rbe_linux_cpu --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --//xla/tsl:ci_build --nobuild -- //xla/... //build_tools/... @local_tsl//tsl/...\n bazel test --build_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --test_tag_filters=-no_oss,-gpu,-requires-gpu-nvidia,-requires-gpu-amd,-requires-gpu-intel --config=warnings --config=nonccl --config=rbe_linux_cpu --color=yes --test_output=errors --verbose_failures --keep_going --nobuild_tests_only --profile=profile.json.gz --flaky_test_attempts=3 --jobs=150 --bes_upload_mode=fully_async --//xla/tsl:ci_build -- //xla/... //build_tools/... @local_tsl//tsl/..."
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "third_party/xla/third_party/extensions/BUILD.bazel",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2FBUILD.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2FBUILD.bazel?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301"
        },
        {
            "sha": "8027ee4d52de1dd7e7ebf1c69ee151de89da3b44",
            "filename": "third_party/xla/third_party/extensions/llvm.bzl",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fllvm.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fllvm.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Fllvm.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,22 @@\n+\"\"\"Module extension for llvm.\"\"\"\n+\n+load(\"@llvm-raw//utils/bazel:configure.bzl\", \"llvm_configure\")\n+\n+def _llvm_extension_impl(mctx):  # @unused\n+    llvm_configure(\n+        name = \"llvm-project\",\n+        targets = [\n+            \"AArch64\",\n+            \"AMDGPU\",\n+            \"ARM\",\n+            \"NVPTX\",\n+            \"PowerPC\",\n+            \"RISCV\",\n+            \"SystemZ\",\n+            \"X86\",\n+        ],\n+    )\n+\n+llvm_extension = module_extension(\n+    implementation = _llvm_extension_impl,\n+)"
        },
        {
            "sha": "a8c6ac5556b296a3fcd418fe4d7258e0aafef576",
            "filename": "third_party/xla/third_party/extensions/python_version.bzl",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fpython_version.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fpython_version.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Fpython_version.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,36 @@\n+\"\"\"\n+A much simplified version of third_party/py/python_repo.bzl, which generates the \"python_version_repo\" repo.\n+\n+This is just to keep the current build compatible with both WORKSPACE and Bzlmod, we may not need this in future.\n+\"\"\"\n+\n+_PY_VERSION_BZL = \"\"\"\n+HERMETIC_PYTHON_VERSION = \"{version}\"\n+USE_PYWRAP_RULES = {use_pywrap_rules}\n+\"\"\"\n+\n+def _python_version_repo_impl(repository_ctx):\n+    version = repository_ctx.os.environ.get(\"HERMETIC_PYTHON_VERSION\", \"3.11\")\n+    use_pywrap_rules = bool(\n+        repository_ctx.os.environ.get(\"USE_PYWRAP_RULES\", False),\n+    )\n+    repository_ctx.file(\"BUILD.bazel\", \"\")\n+    repository_ctx.file(\n+        \"py_version.bzl\",\n+        _PY_VERSION_BZL.format(\n+            version = version,\n+            use_pywrap_rules = use_pywrap_rules,\n+        ),\n+    )\n+\n+python_version_repo = repository_rule(\n+    implementation = _python_version_repo_impl,\n+    environ = [\n+        \"HERMETIC_PYTHON_VERSION\",\n+        \"USE_PYWRAP_RULES\",\n+    ],\n+)\n+\n+python_version_ext = module_extension(\n+    implementation = lambda mctx: python_version_repo(name = \"python_version_repo\"),\n+)"
        },
        {
            "sha": "6ae2950995fad1e687f854c58eb337b2414fcd78",
            "filename": "third_party/xla/third_party/extensions/rbe_config.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Frbe_config.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Frbe_config.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Frbe_config.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Module extension to initialize RBE configs.\"\"\"\n+\n+load(\"//tools/toolchains/remote_config:configs.bzl\", \"initialize_rbe_configs\")\n+\n+rbe_config_ext = module_extension(\n+    implementation = lambda mctx: initialize_rbe_configs(),  # Generates `@ml_build_config_platform`\n+)"
        },
        {
            "sha": "bc9f9e0efb521ae905a8ca9c06db13edd4a319c6",
            "filename": "third_party/xla/third_party/extensions/remote_execution_configure.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fremote_execution_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fremote_execution_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Fremote_execution_configure.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Module extension for remote_execution.\"\"\"\n+\n+load(\"@local_xla//tools/toolchains/remote:configure.bzl\", \"remote_execution_configure\")\n+\n+remote_execution_configure_ext = module_extension(\n+    implementation = lambda mctx: remote_execution_configure(name = \"local_config_remote_execution\"),\n+)"
        },
        {
            "sha": "b08948085caf345e2c02e631e1d2d16401248b0c",
            "filename": "third_party/xla/third_party/extensions/rocm_configure.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Frocm_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Frocm_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Frocm_configure.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Module extension for rocm.\"\"\"\n+\n+load(\"@local_xla//third_party/gpus:rocm_configure.bzl\", \"rocm_configure\")\n+\n+rocm_configure_ext = module_extension(\n+    implementation = lambda mctx: rocm_configure(name = \"local_config_rocm\"),\n+)"
        },
        {
            "sha": "6e795e3a0226e477aa79a39e59118c4d4ad5fe33",
            "filename": "third_party/xla/third_party/extensions/tensorrt_configure.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftensorrt_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftensorrt_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftensorrt_configure.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Module extension for tensorrt.\"\"\"\n+\n+load(\"@local_xla//third_party/tensorrt:tensorrt_configure.bzl\", \"tensorrt_configure\")\n+\n+tensorrt_configure_ext = module_extension(\n+    implementation = lambda mctx: tensorrt_configure(name = \"local_config_tensorrt\"),\n+)"
        },
        {
            "sha": "a76e676fa11147afb0c4ce3c9fe0b3d9e0117638",
            "filename": "third_party/xla/third_party/extensions/third_party.bzl",
            "status": "added",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fthird_party.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Fthird_party.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Fthird_party.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,80 @@\n+\"\"\"Module extension for third party dependencies.\"\"\"\n+\n+load(\"//third_party/benchmark:workspace.bzl\", benchmark = \"repo\")\n+load(\"//third_party/cpuinfo:workspace.bzl\", cpuinfo = \"repo\")\n+load(\"//third_party/cudnn_frontend:workspace.bzl\", cudnn_frontend = \"repo\")\n+load(\"//third_party/dlpack:workspace.bzl\", dlpack = \"repo\")\n+load(\"//third_party/ducc:workspace.bzl\", ducc = \"repo\")\n+load(\"//third_party/eigen3:workspace.bzl\", eigen3 = \"repo\")\n+load(\"//third_party/farmhash:workspace.bzl\", farmhash = \"repo\")\n+load(\"//third_party/fmt:workspace.bzl\", fmt = \"repo\")\n+load(\"//third_party/FP16:workspace.bzl\", FP16 = \"repo\")\n+load(\"//third_party/fxdiv:workspace.bzl\", fxdiv = \"repo\")\n+load(\"//third_party/gemmlowp:workspace.bzl\", gemmlowp = \"repo\")\n+load(\"//third_party/gloo:workspace.bzl\", gloo = \"repo\")\n+load(\"//third_party/highwayhash:workspace.bzl\", highwayhash = \"repo\")\n+load(\"//third_party/hwloc:workspace.bzl\", hwloc = \"repo\")\n+load(\"//third_party/implib_so:workspace.bzl\", implib_so = \"repo\")\n+load(\"//third_party/llvm:workspace.bzl\", llvm = \"repo\")\n+load(\"//third_party/llvm_openmp:workspace.bzl\", llvm_openmp = \"repo\")\n+load(\"//third_party/mkl_dnn:workspace.bzl\", onednn = \"repo\")\n+load(\"//third_party/mpitrampoline:workspace.bzl\", mpitrampoline = \"repo\")\n+load(\"//third_party/nanobind:workspace.bzl\", nanobind = \"repo\")\n+load(\"//third_party/nasm:workspace.bzl\", nasm = \"repo\")\n+load(\"//third_party/nvshmem:workspace.bzl\", nvshmem = \"repo\")\n+load(\"//third_party/pthreadpool:workspace.bzl\", pthreadpool = \"repo\")\n+load(\"//third_party/py/ml_dtypes:workspace.bzl\", ml_dtypes = \"repo\")\n+load(\"//third_party/raft:workspace.bzl\", raft = \"repo\")\n+load(\"//third_party/rapids_logger:workspace.bzl\", rapids_logger = \"repo\")\n+load(\"//third_party/rmm:workspace.bzl\", rmm = \"repo\")\n+load(\"//third_party/robin_map:workspace.bzl\", robin_map = \"repo\")\n+load(\"//third_party/rocm_device_libs:workspace.bzl\", rocm_device_libs = \"repo\")\n+load(\"//third_party/shardy:workspace.bzl\", shardy = \"repo\")\n+load(\"//third_party/spdlog:workspace.bzl\", spdlog = \"repo\")\n+load(\"//third_party/stablehlo:workspace.bzl\", stablehlo = \"repo\")\n+load(\"//third_party/tensorrt:workspace.bzl\", tensorrt = \"repo\")\n+load(\"//third_party/triton:workspace.bzl\", triton = \"repo\")\n+load(\"//third_party/uv:workspace.bzl\", uv = \"repo\")\n+load(\"//third_party/xnnpack:workspace.bzl\", xnnpack = \"repo\")\n+\n+def _third_party_ext_impl(mctx):  # @unused\n+    benchmark()\n+    cpuinfo()\n+    cudnn_frontend()\n+    dlpack()\n+    ducc()\n+    eigen3()\n+    farmhash()\n+    fmt()\n+    FP16()\n+    fxdiv()\n+    gemmlowp()\n+    gloo()\n+    highwayhash()\n+    hwloc()\n+    implib_so()\n+    llvm_openmp()\n+    llvm(name = \"llvm-raw\")\n+    ml_dtypes()\n+    mpitrampoline()\n+    nanobind()\n+    nasm()\n+    nvshmem()\n+    onednn()\n+    pthreadpool()\n+    raft()\n+    rapids_logger()\n+    rmm()\n+    robin_map()\n+    rocm_device_libs()\n+    shardy()\n+    spdlog()\n+    stablehlo()\n+    tensorrt()\n+    triton()\n+    uv()\n+    xnnpack()\n+\n+third_party_ext = module_extension(\n+    implementation = _third_party_ext_impl,\n+)"
        },
        {
            "sha": "e3e7b8982180e2d08db105759cc524ef4861447d",
            "filename": "third_party/xla/third_party/extensions/tsl.bzl",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftsl.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftsl.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fextensions%2Ftsl.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -0,0 +1,7 @@\n+\"\"\"Module extension for tsl\"\"\"\n+\n+load(\"//third_party:repo.bzl\", \"tf_vendored\")\n+\n+tsl_extension = module_extension(\n+    implementation = lambda mctx: tf_vendored(name = \"tsl\", path = \"third_party/tsl\"),\n+)"
        },
        {
            "sha": "1fd3ae0a337ee2177cba802db04af46a8c6f282d",
            "filename": "third_party/xla/third_party/py/python_configure.bzl",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fpy%2Fpython_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fpy%2Fpython_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fpy%2Fpython_configure.bzl?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -7,12 +7,19 @@ load(\n     \"PYTHON_BIN_PATH\",\n     \"PYTHON_LIB_PATH\",\n )\n-load(\"//third_party/py:python_init_toolchains.bzl\", \"get_toolchain_name_per_python_version\")\n+load(\"@python_version_repo//:py_version.bzl\", \"HERMETIC_PYTHON_VERSION\")\n+load(\"@pythons_hub//:interpreters.bzl\", \"INTERPRETER_LABELS\")\n+\n+def _is_bzlmod_enabled():\n+    return str(Label(\"@//:BUILD.bazel\")).startswith(\"@@\")\n \n def _get_python_interpreter():\n-    return \"@{}_host//:python\".format(\n-        get_toolchain_name_per_python_version(\"python\"),\n+    python_toolchain_name = \"python_{version}_host\".format(\n+        version = HERMETIC_PYTHON_VERSION.replace(\".\", \"_\"),\n     )\n+    if _is_bzlmod_enabled():\n+        return str(INTERPRETER_LABELS[python_toolchain_name])\n+    return \"@{}_host//:python\".format(python_toolchain_name)\n \n def _create_local_python_repository(repository_ctx):\n     \"\"\"Creates the repository containing files set up to build with Python.\"\"\""
        },
        {
            "sha": "55fb4a4e8b06229959b86a71b809a5e80d595053",
            "filename": "third_party/xla/third_party/python_runtime/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fpython_runtime%2FBUILD.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/134503de2b773bc61bcc5fecdc277e7bd35eb301/third_party%2Fxla%2Fthird_party%2Fpython_runtime%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fpython_runtime%2FBUILD.bazel?ref=134503de2b773bc61bcc5fecdc277e7bd35eb301",
            "patch": "@@ -4,5 +4,5 @@ package(default_visibility = [\"//visibility:public\"])\n \n alias(\n     name = \"headers\",\n-    actual = \"@local_config_python//:python_headers\",\n+    actual = \"@rules_python//python/cc:current_py_cc_headers\",\n )"
        }
    ],
    "stats": {
        "total": 430,
        "additions": 423,
        "deletions": 7
    }
}