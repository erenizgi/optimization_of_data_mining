{
    "author": "Matt-Hurd",
    "message": "[xprof] Add support for tracemark_lower and tracemark_upper profiler options\n\nPiperOrigin-RevId: 840501838",
    "sha": "31742e37eae0b59cfed8936edcae07a3d0b8d39a",
    "files": [
        {
            "sha": "b4177f89c87dbfb7dd03ef0a51f7512eeb2c0a29",
            "filename": "third_party/xla/xla/tsl/profiler/utils/session_manager.cc",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/31742e37eae0b59cfed8936edcae07a3d0b8d39a/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/31742e37eae0b59cfed8936edcae07a3d0b8d39a/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc?ref=31742e37eae0b59cfed8936edcae07a3d0b8d39a",
            "patch": "@@ -16,6 +16,7 @@ limitations under the License.\n #include \"xla/tsl/profiler/utils/session_manager.h\"\n \n #include <algorithm>\n+#include <climits>\n #include <string>\n #include <variant>\n #include <vector>\n@@ -161,6 +162,32 @@ RemoteProfilerSessionManagerOptions GetRemoteSessionManagerOptionsLocked(\n                 .set_string_value(value);\n           },\n           nullptr);\n+    } else if (key == \"tracemark_lower\") {\n+      SetOption<int>(\n+          key, kw.second,\n+          [](tensorflow::ProfileOptions* options, int value) {\n+            if (value > INT_MAX) {\n+              LOG(WARNING) << \"tracemark_lower value is too large: \" << value\n+                           << \", setting to INT_MAX\";\n+              value = INT_MAX;\n+            }\n+            (*options->mutable_advanced_configuration())[\"tracemark_lower\"]\n+                .set_int64_value(value);\n+          },\n+          options.mutable_profiler_options());\n+    } else if (key == \"tracemark_upper\") {\n+      SetOption<int>(\n+          key, kw.second,\n+          [](tensorflow::ProfileOptions* options, int value) {\n+            if (value > INT_MAX) {\n+              LOG(WARNING) << \"tracemark_upper value is too large: \" << value\n+                           << \", setting to INT_MAX\";\n+              value = INT_MAX;\n+            }\n+            (*options->mutable_advanced_configuration())[\"tracemark_upper\"]\n+                .set_int64_value(value);\n+          },\n+          options.mutable_profiler_options());\n     } else {\n       LOG(WARNING) << \"Unrecognised key: \" << key;\n     }"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 27,
        "deletions": 0
    }
}