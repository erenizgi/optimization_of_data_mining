{
    "author": "tensorflower-gardener",
    "message": "Do not propagate user-guided fusion attr if an inserted transpose is not an intervening must-fuse instruction.\n\nPiperOrigin-RevId: 816454604",
    "sha": "4ca47edb9d97ca1fcbdb3953354b5704eec72f88",
    "files": [
        {
            "sha": "b0099ab1c14b87bcb3c76352fcb5cbd3aa00e296",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/algebraic_simplifier.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4ca47edb9d97ca1fcbdb3953354b5704eec72f88/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4ca47edb9d97ca1fcbdb3953354b5704eec72f88/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc?ref=4ca47edb9d97ca1fcbdb3953354b5704eec72f88",
            "patch": "@@ -2721,6 +2721,12 @@ absl::StatusOr<bool> AlgebraicSimplifierVisitor::MoveDotParamToRhs(\n   dot->SetupDerivedInstruction(new_dot);\n   dot->SetupDerivedInstruction(new_transpose);\n   TF_RETURN_IF_ERROR(ReplaceInstruction(dot, new_transpose));\n+  // Don't propagate the user-guided fusion attribute to the new auto-generated\n+  // transpose if it is not an intervening instruction before another must-fuse\n+  // instruction.\n+  // Note: This is used for backend-specific optimization. In the future, we\n+  // should find a better way that does not expose it to the third-party.\n+  AmendUserGuidedFusionAttr(new_transpose);\n   return true;\n }\n "
        },
        {
            "sha": "9461a1a1dd7de65520fb3927933d30964745438f",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/algebraic_simplifier.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4ca47edb9d97ca1fcbdb3953354b5704eec72f88/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4ca47edb9d97ca1fcbdb3953354b5704eec72f88/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.h?ref=4ca47edb9d97ca1fcbdb3953354b5704eec72f88",
            "patch": "@@ -599,6 +599,11 @@ class AlgebraicSimplifierVisitor : public DfsHloRewriteVisitor {\n     return true;\n   }\n \n+ protected:\n+  // Allow backend targets to amend user-guided fusion attributes based on\n+  // various criteria.\n+  virtual void AmendUserGuidedFusionAttr(HloInstruction* inst) {}\n+\n  protected:\n   // The backend-specific options selected for the algebraic simplifier.\n   const AlgebraicSimplifierOptions& options_;"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}