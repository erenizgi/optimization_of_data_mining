{
    "author": "tensorflower-gardener",
    "message": "[XLA:TPU:partitioner] Add handling unreduced in HloSharding canonicalization.\n\nIf unreduced is the only type in the subgroup and there is no tiling on data\n dimensions, it can be canonicalized to a simple unreduced sharding.\n\nPiperOrigin-RevId: 797976970",
    "sha": "7cecfeead9814eb714b22f51e1f8fb2d88e2565b",
    "files": [
        {
            "sha": "ff33260455bb8293b6ce6ef8c54ff98f19d0e717",
            "filename": "third_party/xla/xla/hlo/ir/hlo_sharding.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7cecfeead9814eb714b22f51e1f8fb2d88e2565b/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7cecfeead9814eb714b22f51e1f8fb2d88e2565b/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.cc?ref=7cecfeead9814eb714b22f51e1f8fb2d88e2565b",
            "patch": "@@ -214,7 +214,8 @@ HloSharding HloSharding::Subgroup(\n                        /*replicate_on_last_tile_dim=*/false, metadata);\n   }\n   // If there is only one type of subgrouping and there is no tiling on data\n-  // dimensions, it can be canonicalized to a simple manual/replicated sharding.\n+  // dimensions, it can be canonicalized to a simple manual/replicated/unreduced\n+  // sharding.\n   if (absl::c_all_of(\n           subgroup_types,\n           [&](const OpSharding::Type t) { return t == subgroup_types[0]; }) &&\n@@ -226,6 +227,9 @@ HloSharding HloSharding::Subgroup(\n     if (subgroup_types[0] == OpSharding::REPLICATED) {\n       return Replicate(metadata);\n     }\n+    if (subgroup_types[0] == OpSharding::UNREDUCED) {\n+      return Unreduced(metadata);\n+    }\n   }\n   // Normalize the subgroups to simplify two cases:\n   //   - Remove trivial dims of size 1."
        }
    ],
    "stats": {
        "total": 6,
        "additions": 5,
        "deletions": 1
    }
}