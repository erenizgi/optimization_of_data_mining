{
    "author": "beckerhe",
    "message": "Fix run_hlo_module_bin_test\n\nThis test has been failing when ran from a workspace due to the addition of CL numbers to HLO dump filenames.\n\nPiperOrigin-RevId: 800435262",
    "sha": "0f35e760f33c02da40c01508edbe422d553bc10c",
    "files": [
        {
            "sha": "b98d5d8877477c9db8dc5d24c08da685ca0a620d",
            "filename": "third_party/xla/xla/tools/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0f35e760f33c02da40c01508edbe422d553bc10c/third_party%2Fxla%2Fxla%2Ftools%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0f35e760f33c02da40c01508edbe422d553bc10c/third_party%2Fxla%2Fxla%2Ftools%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2FBUILD?ref=0f35e760f33c02da40c01508edbe422d553bc10c",
            "patch": "@@ -569,14 +569,14 @@ xla_cc_test(\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/hlo/parser:hlo_parser\",\n         \"//xla/tsl/lib/core:status_test_util\",\n+        \"//xla/tsl/platform:env\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:subprocess\",\n+        \"//xla/tsl/platform:test\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest_main\",\n-        \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:path\",\n-        \"@local_tsl//tsl/platform:statusor\",\n-        \"@local_tsl//tsl/platform:test\",\n     ],\n )\n "
        },
        {
            "sha": "04980a66c8974283aa42fcfdccc4de68121f1343",
            "filename": "third_party/xla/xla/tools/run_hlo_module_bin_test.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0f35e760f33c02da40c01508edbe422d553bc10c/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_bin_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0f35e760f33c02da40c01508edbe422d553bc10c/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_bin_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Frun_hlo_module_bin_test.cc?ref=0f35e760f33c02da40c01508edbe422d553bc10c",
            "patch": "@@ -18,18 +18,20 @@ limitations under the License.\n #include <string>\n #include <vector>\n \n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n #include \"absl/log/log.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/hlo/parser/hlo_parser.h\"\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/env.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/subprocess.h\"\n-#include \"tsl/platform/env.h\"\n+#include \"xla/tsl/platform/test.h\"\n #include \"tsl/platform/path.h\"\n-#include \"tsl/platform/statusor.h\"\n-#include \"tsl/platform/test.h\"\n \n namespace xla {\n namespace {\n@@ -244,10 +246,13 @@ TEST_F(RunHloModuleTest, DumpAndParseDebugOptions) {\n   EXPECT_THAT(data, testing::Not(testing::HasSubstr(\n                         \"xla_gpu_dot_merger_threshold_mb: 1234\")));\n   // Read the dumped module and we should see large constant.\n-  TF_ASSERT_OK(tsl::ReadFileToString(\n-      env,\n-      tsl::io::JoinPath(tmp_dir2, \"module_0000.f.cpu_after_optimizations.txt\"),\n-      &data));\n+  std::vector<std::string> cpu_after_optimizations_files;\n+  TF_ASSERT_OK(tsl::Env::Default()->GetMatchingPaths(\n+      absl::StrCat(tmp_dir2, \"/module_0000.f.*cpu_after_optimizations.txt\"),\n+      &cpu_after_optimizations_files));\n+  ASSERT_THAT(cpu_after_optimizations_files, testing::SizeIs(1));\n+  TF_ASSERT_OK(\n+      tsl::ReadFileToString(env, cpu_after_optimizations_files[0], &data));\n   EXPECT_THAT(data, testing::HasSubstr(\n                         \"constant({10, 6, 3, 2, 5, 3, 7, 4, 2, 3, 1, 0})\"));\n }"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 15,
        "deletions": 10
    }
}