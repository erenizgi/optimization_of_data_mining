{
    "author": "penpornk",
    "message": "[xla:cpu:onednn] Fix header includes.\n\n+ Some internal-only changes.\n\nPiperOrigin-RevId: 808538406",
    "sha": "8069960aef54798e318105f83407ffd38ee07d8f",
    "files": [
        {
            "sha": "43641cc2cf119a114aad158d4e0fbf688092439b",
            "filename": "third_party/xla/xla/backends/cpu/onednn_emitter.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fonednn_emitter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fonednn_emitter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fonednn_emitter.cc?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -17,14 +17,15 @@ limitations under the License.\n \n #include <cstddef>\n #include <cstdint>\n+#include <vector>\n \n-#include \"oneapi/dnnl/dnnl_common.hpp\"\n-#include \"oneapi/dnnl/dnnl_graph.hpp\"\n #include \"absl/container/flat_hash_map.h\"\n #include \"absl/functional/any_invocable.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_format.h\"\n+#include \"oneapi/dnnl/dnnl_common.hpp\"\n+#include \"oneapi/dnnl/dnnl_graph.hpp\"  // NOLINT\n #include \"xla/backends/cpu/onednn_fusion.h\"\n #include \"xla/backends/cpu/onednn_support.h\"\n #include \"xla/backends/cpu/runtime/dot_lib.h\""
        },
        {
            "sha": "4b608cc4c6c8eed8fa544086d459cabe6520f7cc",
            "filename": "third_party/xla/xla/backends/cpu/runtime/onednn/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2FBUILD?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -31,6 +31,7 @@ onednn_graph_cc_library(\n         \"//xla/tsl/platform:logging\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n     ],\n )\n \n@@ -83,8 +84,8 @@ cc_library(\n     hdrs = [\"onednn_threadpool.h\"],\n     # copybara:uncomment compatible_with = [\"//buildenv/target:non_prod\"],\n     deps = [\n-        \":onednn_interop\",\n         \"//xla/backends/cpu/runtime:work_queue\",\n+        \"//xla/tsl/concurrency:async_value\",\n         \"//xla/tsl/mkl:onednn\",\n         \"@eigen_archive//:eigen3\",\n     ],"
        },
        {
            "sha": "889f1d774bab34ac14172b1297652fc055e218dc",
            "filename": "third_party/xla/xla/backends/cpu/runtime/onednn/onednn_fusion_thunk.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_fusion_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_fusion_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_fusion_thunk.cc?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -18,18 +18,16 @@ limitations under the License.\n #include <cstddef>\n #include <memory>\n #include <utility>\n-#include <vector>\n \n-#include \"oneapi/dnnl/dnnl_common.hpp\"\n-#include \"oneapi/dnnl/dnnl_graph.hpp\"\n-#include \"oneapi/dnnl/dnnl_threadpool.hpp\"\n-#include \"absl/container/inlined_vector.h\"\n #include \"absl/functional/function_ref.h\"\n #include \"absl/log/check.h\"\n #include \"absl/memory/memory.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_format.h\"\n #include \"absl/types/span.h\"\n+#include \"oneapi/dnnl/dnnl_common.hpp\"\n+#include \"oneapi/dnnl/dnnl_graph.hpp\"\n+#include \"oneapi/dnnl/dnnl_threadpool.hpp\"\n #include \"xla/backends/cpu/onednn_fusion.h\"\n #include \"xla/backends/cpu/runtime/onednn/onednn_threadpool.h\"\n #include \"xla/backends/cpu/runtime/thunk.h\""
        },
        {
            "sha": "50b321be6b6acbf40bf0949602969d3c9bc43878",
            "filename": "third_party/xla/xla/backends/cpu/runtime/onednn/onednn_interop.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_interop.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_interop.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_interop.h?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -16,11 +16,11 @@ limitations under the License.\n #ifndef XLA_BACKENDS_CPU_RUNTIME_ONEDNN_ONEDNN_INTEROP_H_\n #define XLA_BACKENDS_CPU_RUNTIME_ONEDNN_ONEDNN_INTEROP_H_\n \n-#include \"oneapi/dnnl/dnnl_graph.hpp\"\n #include \"absl/base/optimization.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"oneapi/dnnl/dnnl_graph.hpp\"\n #include \"xla/tsl/platform/logging.h\"\n-#include \"xla/util.h\"\n \n namespace xla::cpu {\n \n@@ -76,7 +76,8 @@ inline absl::Status OneDnnStatusToStatus(dnnl::graph::status status) {\n     }\n   };\n \n-  return Internal(\"DNNL operation failed: %s\", error_message(status));\n+  return absl::InternalError(\n+      absl::StrCat(\"DNNL operation failed: \", error_message(status)));\n }\n \n }  // namespace xla::cpu"
        },
        {
            "sha": "b47c858456237a55ec9f61ea278704093904a4a6",
            "filename": "third_party/xla/xla/backends/cpu/runtime/onednn/onednn_threadpool.h",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool.h?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -20,9 +20,12 @@ limitations under the License.\n #include <cstdint>\n #include <functional>\n \n-#include \"dnnl_threadpool.hpp\"\n+#include \"Eigen/ThreadPool\"\n+#include \"oneapi/dnnl/dnnl_threadpool.h\"  // IWYU pragma: keep\n #include \"oneapi/dnnl/dnnl_threadpool_iface.hpp\"\n #include \"xla/backends/cpu/runtime/work_queue.h\"\n+#include \"xla/tsl/concurrency/async_value_ref.h\"\n+#include \"xla/tsl/concurrency/chain.h\"\n \n #define EIGEN_USE_THREADS\n #include \"unsupported/Eigen/CXX11/Tensor\""
        },
        {
            "sha": "f963f3155f784f66e8fc5b175a00d8c246d45ddf",
            "filename": "third_party/xla/xla/backends/cpu/runtime/onednn/onednn_threadpool_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fruntime%2Fonednn%2Fonednn_threadpool_test.cc?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -19,11 +19,11 @@ limitations under the License.\n #include <cstdint>\n #include <vector>\n \n+#include \"absl/status/statusor.h\"\n #include \"oneapi/dnnl/dnnl.hpp\"\n #include \"oneapi/dnnl/dnnl_common.hpp\"\n #include \"oneapi/dnnl/dnnl_graph.hpp\"\n #include \"oneapi/dnnl/dnnl_threadpool.hpp\"\n-#include \"absl/status/statusor.h\"\n #include \"xla/backends/cpu/runtime/onednn/onednn_interop.h\"\n #include \"xla/tsl/concurrency/async_value_ref.h\"\n #include \"xla/tsl/platform/env.h\""
        },
        {
            "sha": "e13e58da8f1ce0eebb956b76825fead4684e320b",
            "filename": "third_party/xla/xla/tsl/util/onednn_threadpool.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fonednn_threadpool.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8069960aef54798e318105f83407ffd38ee07d8f/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fonednn_threadpool.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fonednn_threadpool.h?ref=8069960aef54798e318105f83407ffd38ee07d8f",
            "patch": "@@ -27,9 +27,9 @@ limitations under the License.\n \n #define EIGEN_USE_THREADS\n \n-#include \"dnnl_threadpool.hpp\"\n #include \"absl/synchronization/blocking_counter.h\"\n #include \"dnnl.hpp\"\n+#include \"oneapi/dnnl/dnnl_threadpool.hpp\"\n #include \"xla/tsl/platform/threadpool.h\"\n #include \"tsl/platform/cpu_info.h\"\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 18,
        "deletions": 14
    }
}