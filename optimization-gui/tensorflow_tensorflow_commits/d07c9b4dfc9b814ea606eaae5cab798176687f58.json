{
    "author": "nishair",
    "message": "fix-command-injection-grpc-tpu-worker",
    "sha": "d07c9b4dfc9b814ea606eaae5cab798176687f58",
    "files": [
        {
            "sha": "a9b0e694d1f9ee6be0a66dbb1f42c7b1a35df437",
            "filename": "tensorflow/python/tools/grpc_tpu_worker_service.py",
            "status": "modified",
            "additions": 17,
            "deletions": 12,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d07c9b4dfc9b814ea606eaae5cab798176687f58/tensorflow%2Fpython%2Ftools%2Fgrpc_tpu_worker_service.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d07c9b4dfc9b814ea606eaae5cab798176687f58/tensorflow%2Fpython%2Ftools%2Fgrpc_tpu_worker_service.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Ftools%2Fgrpc_tpu_worker_service.py?ref=d07c9b4dfc9b814ea606eaae5cab798176687f58",
            "patch": "@@ -20,8 +20,10 @@\n \"\"\"\n \n import os\n+import shutil\n import subprocess\n import sys\n+from pathlib import Path\n \n \n def get_sys_path():\n@@ -63,29 +65,32 @@ def create_systemd_service_file(service_content, service_name):\n \n \n def move_file_to_systemd(service_name):\n-  if not os.path.exists(\"~/.config/systemd/user/\"):\n-    mkdir_command = \"mkdir -p ~/.config/systemd/user\"\n-    subprocess.run(mkdir_command, shell=True, check=True)\n+  user_systemd_dir = Path.home() / \".config\" / \"systemd\" / \"user\"\n+  if not user_systemd_dir.exists():\n+    user_systemd_dir.mkdir(parents=True, exist_ok=True)\n     print(\"Created directory ~/.config/systemd/user/\")\n-  command = f\"mv {service_name} ~/.config/systemd/user/{service_name}\"\n-  subprocess.run(command, shell=True, check=True)\n+\n+  source_file = Path(service_name)\n+  dest_file = user_systemd_dir / service_name\n+  shutil.move(str(source_file), str(dest_file))\n   print(f\"Service file moved to ~/.config/systemd/user/{service_name}\")\n \n \n def enable_start_service(service_name):\n   commands = [\n-      \"systemctl --user import-environment\",\n-      \"systemctl --user daemon-reload\",\n-      f\"systemctl --user enable {service_name}\",\n-      f\"systemctl --user start {service_name}\",\n+      [\"systemctl\", \"--user\", \"import-environment\"],\n+      [\"systemctl\", \"--user\", \"daemon-reload\"],\n+      [\"systemctl\", \"--user\", \"enable\", service_name],\n+      [\"systemctl\", \"--user\", \"start\", service_name],\n   ]\n   for command in commands:\n-    subprocess.run(command, shell=True, check=True)\n-    print(f\"Executed: {command}\")\n+    subprocess.run(command, check=True)\n+    print(f\"Executed: {' '.join(command)}\")\n \n \n def run():\n-  if os.path.exists(f\"~/.config/systemd/user/{SERVICE_NAME}\"):\n+  service_file_path = Path.home() / \".config\" / \"systemd\" / \"user\" / SERVICE_NAME\n+  if service_file_path.exists():\n     print(f\"Service file ~/.config/systemd/user/{SERVICE_NAME} already exists\")\n     sys.exit(1)\n   else:"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 17,
        "deletions": 12
    }
}