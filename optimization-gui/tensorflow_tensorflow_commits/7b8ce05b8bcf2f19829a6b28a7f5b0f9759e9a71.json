{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@32de3b9ef9e7\n\nUpdates LLVM usage to match\n[32de3b9ef9e7](https://github.com/llvm/llvm-project/commit/32de3b9ef9e7)\n\nPiperOrigin-RevId: 821892561",
    "sha": "7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71",
    "files": [
        {
            "sha": "2856e5f03f103c5ee8bec3b8d18ba6bf73392ca1",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71",
            "patch": "@@ -1 +1,34 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n+diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n+--- a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n++++ b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n+@@ -0,0 +1,20 @@\n++// REQUIRES: asserts\n++// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n++\n++spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n++    spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {\n++        %uchar_0 = spirv.Constant 0 : i8\n++        %ushort_1 = spirv.Constant 1 : i16\n++        %uint_0 = spirv.Constant 0 : i32\n++        spirv.FunctionCall @outside.func.with.linkage(%uchar_0):(i8) -> ()\n++        spirv.Return\n++    }\n++    // CHECK: linkage_attributes = #spirv.linkage_attributes<linkage_name = \"outside.func\", linkage_type = <Import>>\n++    spirv.func @outside.func.with.linkage(%arg0 : i8) -> () \"Pure\" attributes {\n++      linkage_attributes=#spirv.linkage_attributes<\n++        linkage_name=\"outside.func\",\n++        linkage_type=<Import>\n++      >\n++    }\n++    spirv.func @inside.func() -> () \"Pure\" attributes {} {spirv.Return}\n++}\n+diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations.mlir b/mlir/test/Target/SPIRV/function-decorations.mlir\n+--- a/mlir/test/Target/SPIRV/function-decorations.mlir\n++++ b/mlir/test/Target/SPIRV/function-decorations.mlir\n+@@ -1,5 +1,4 @@\n+ // RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file %s | FileCheck %s\n+-// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n+ \n+ spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n+     spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {"
        },
        {
            "sha": "b1675f1afbd4d9d2cd1d9db5e6db69bafbb12466",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"d5ce81dc8143eed18a7342093b991a63b025e2d9\"\n-    LLVM_SHA256 = \"07efbd552b4539a0b52201cfe73767a4265720789facdfa0d73bfeeb78ea19d3\"\n+    LLVM_COMMIT = \"32de3b9ef9e7e8debc14416e968456ca13b48bea\"\n+    LLVM_SHA256 = \"e048b05e1fb9366e224ea3c06f8473714114039bfad00e81db4ecb6409f23efa\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "51f728653a2f2a3757b3b9bab60f4d8f72825a00",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 101,
            "deletions": 42,
            "changes": 143,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71",
            "patch": "@@ -1,55 +1,114 @@\n+diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch\n+index 509398d..2856e5f 100644\n+--- a/third_party/llvm/generated.patch\n++++ b/third_party/llvm/generated.patch\n+@@ -1 +1,34 @@\n+ Auto generated patch. Do not edit or delete it, even if empty.\n++diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n++--- a/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n+++++ b/mlir/test/Target/SPIRV/function-decorations-asserts.mlir\n++@@ -0,0 +1,20 @@\n+++// REQUIRES: asserts\n+++// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n+++\n+++spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n+++    spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {\n+++        %uchar_0 = spirv.Constant 0 : i8\n+++        %ushort_1 = spirv.Constant 1 : i16\n+++        %uint_0 = spirv.Constant 0 : i32\n+++        spirv.FunctionCall @outside.func.with.linkage(%uchar_0):(i8) -> ()\n+++        spirv.Return\n+++    }\n+++    // CHECK: linkage_attributes = #spirv.linkage_attributes<linkage_name = \"outside.func\", linkage_type = <Import>>\n+++    spirv.func @outside.func.with.linkage(%arg0 : i8) -> () \"Pure\" attributes {\n+++      linkage_attributes=#spirv.linkage_attributes<\n+++        linkage_name=\"outside.func\",\n+++        linkage_type=<Import>\n+++      >\n+++    }\n+++    spirv.func @inside.func() -> () \"Pure\" attributes {} {spirv.Return}\n+++}\n++diff -ruN --strip-trailing-cr a/mlir/test/Target/SPIRV/function-decorations.mlir b/mlir/test/Target/SPIRV/function-decorations.mlir\n++--- a/mlir/test/Target/SPIRV/function-decorations.mlir\n+++++ b/mlir/test/Target/SPIRV/function-decorations.mlir\n++@@ -1,5 +1,4 @@\n++ // RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file %s | FileCheck %s\n++-// RUN: mlir-translate --no-implicit-module --test-spirv-roundtrip --split-input-file --debug %s | FileCheck %s\n++ \n++ spirv.module Logical GLSL450 requires #spirv.vce<v1.0, [Shader, Linkage], []> {\n++     spirv.func @linkage_attr_test_kernel()  \"DontInline\"  attributes {}  {\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index ba4c1a2..622428b 100644\n+index 622428b..b1675f1 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"bfee9db7857757e63b64fb4d411a264690ff711a\"\n--    LLVM_SHA256 = \"b14cb659a35562d1fccee470d0bba41cf96363e1b576e113a3a795db9ad78e3e\"\n-+    LLVM_COMMIT = \"d5ce81dc8143eed18a7342093b991a63b025e2d9\"\n-+    LLVM_SHA256 = \"07efbd552b4539a0b52201cfe73767a4265720789facdfa0d73bfeeb78ea19d3\"\n+-    LLVM_COMMIT = \"d5ce81dc8143eed18a7342093b991a63b025e2d9\"\n+-    LLVM_SHA256 = \"07efbd552b4539a0b52201cfe73767a4265720789facdfa0d73bfeeb78ea19d3\"\n++    LLVM_COMMIT = \"32de3b9ef9e7e8debc14416e968456ca13b48bea\"\n++    LLVM_SHA256 = \"e048b05e1fb9366e224ea3c06f8473714114039bfad00e81db4ecb6409f23efa\"\n  \n      tf_http_archive(\n          name = name,\n diff --git a/third_party/stablehlo/temporary.patch b/third_party/stablehlo/temporary.patch\n-index 8949936..473baf0 100755\n+index f2e3e59..473baf0 100755\n --- a/third_party/stablehlo/temporary.patch\n +++ b/third_party/stablehlo/temporary.patch\n-@@ -537,6 +537,17 @@ diff --ruN a/stablehlo/stablehlo/conversions/tosa/transforms/StablehloQuantLegal\n-    // unary ops\n-    patterns->addWithLabel<QuantizedStablehloOpConversion<stablehlo::AbsOp>>(\n-        {\"StablehloQuantAbsOp\"}, context);\n-+diff --ruN a/stablehlo/stablehlo/dialect/StablehloOps.cpp b/stablehlo/stablehlo/dialect/StablehloOps.cpp\n-+--- stablehlo/stablehlo/dialect/StablehloOps.cpp\n-++++ stablehlo/stablehlo/dialect/StablehloOps.cpp\n-+@@ -3164,6 +3164,7 @@\n-+ using mlir::hlo::printVariadicOperandWithAttribute;\n-+ using mlir::hlo::printVariadicSameOperandsAndResultType;\n-+ \n-++using mlir::stablehlo::TokenType;\n-+ #define GET_OP_CLASSES\n-+ #include \"stablehlo/dialect/StablehloOps.cpp.inc\"\n-+ \n- diff --ruN a/stablehlo/stablehlo/integrations/c/VhloDialect.h b/stablehlo/stablehlo/integrations/c/VhloDialect.h\n- --- stablehlo/stablehlo/integrations/c/VhloDialect.h\n- +++ stablehlo/stablehlo/integrations/c/VhloDialect.h\n-@@ -787,6 +798,17 @@ diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/StablehloBuilderTest.c\n- +\n-  }  // namespace stablehlo\n-  }  // namespace mlir\n-+diff --ruN a/stablehlo/stablehlo/reference/InterpreterOps.cpp b/stablehlo/stablehlo/reference/InterpreterOps.cpp\n-+--- stablehlo/stablehlo/reference/InterpreterOps.cpp\n-++++ stablehlo/stablehlo/reference/InterpreterOps.cpp\n-+@@ -46,6 +46,7 @@\n-+ #include \"stablehlo/reference/ProcessGrid.h\"\n-+ #include \"stablehlo/reference/Value.h\"\n-+ \n-++using mlir::stablehlo::TokenType;\n-+ #define GET_OP_CLASSES\n-+ #include \"stablehlo/reference/InterpreterOps.cpp.inc\"\n-+ \n- diff --ruN a/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir b/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n- --- stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n- +++ stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_folder.mlir\n+@@ -904,36 +904,6 @@ diff --ruN a/stablehlo/stablehlo/tests/transforms/stablehlo_aggressive_simplific\n+  // -----\n+  \n+  ////////\n+-diff --ruN a/stablehlo/stablehlo/tests/transforms/stablehlo_refine_shapes.mlir b/stablehlo/stablehlo/tests/transforms/stablehlo_refine_shapes.mlir\n+---- stablehlo/stablehlo/tests/transforms/stablehlo_refine_shapes.mlir\n+-+++ stablehlo/stablehlo/tests/transforms/stablehlo_refine_shapes.mlir\n+-@@ -752,7 +752,7 @@\n+-     %2 = call @refine_call_callee(%arg0_different_i32, %1) : (tensor<i32>, tensor<?xf32>) -> tensor<?xf32>\n+-     return %2 : tensor<?xf32>\n+-   }\n+--  // expected-error@+1{{'func.func' op refined with invompatible refinement keys}}\n+-+  // expected-error@+1{{'func.func' op refined with incompatible refinement keys}}\n+-   func.func @refine_call_callee(%arg0: tensor<i32>, %arg1: tensor<?xf32>) -> tensor<?xf32> {\n+-     return %arg1 : tensor<?xf32>\n+-   }\n+-@@ -770,7 +770,7 @@\n+-     %2 = call @refine_call_callee(%arg0_different, %1) : (tensor<i32>, tensor<?xf32>) -> tensor<?xf32>\n+-     return %2 : tensor<?xf32>\n+-   }\n+--  // expected-error@+1{{'func.func' op refined with invompatible refinement keys}}\n+-+  // expected-error@+1{{'func.func' op refined with incompatible refinement keys}}\n+-   func.func @refine_call_callee(%arg0: tensor<i32>, %arg1: tensor<?xf32>) -> tensor<?xf32> {\n+-     return %arg1 : tensor<?xf32>\n+-   }\n+-@@ -789,7 +789,7 @@\n+-     %4 = call @refine_call_callee(%arg0_new, %3) : (tensor<i32>, tensor<?xf32>) -> tensor<?xf32>\n+-     return %4 : tensor<?xf32>\n+-   }\n+--  // expected-error@+1{{'func.func' op refined with invompatible refinement keys}}\n+-+  // expected-error@+1{{'func.func' op refined with incompatible refinement keys}}\n+-   func.func @refine_call_callee(%arg0: tensor<i32>, %arg1: tensor<?xf32>) -> tensor<?xf32> {\n+-     return %arg1 : tensor<?xf32>\n+-   }\n+ diff --ruN a/stablehlo/stablehlo/transforms/ChloLegalizeToStablehlo.cpp b/stablehlo/stablehlo/transforms/ChloLegalizeToStablehlo.cpp\n+ --- stablehlo/stablehlo/transforms/ChloLegalizeToStablehlo.cpp\n+ +++ stablehlo/stablehlo/transforms/ChloLegalizeToStablehlo.cpp\n+@@ -1461,18 +1431,6 @@ diff --ruN a/stablehlo/stablehlo/transforms/ChloLegalizeToStablehlo.cpp b/stable\n+    populateChloBroadcastingPatterns(context, patterns);\n+    populateChloDecompositionPatterns(context, patterns);\n+  }\n+-diff --ruN a/stablehlo/stablehlo/transforms/StablehloRefineShapes.cpp b/stablehlo/stablehlo/transforms/StablehloRefineShapes.cpp\n+---- stablehlo/stablehlo/transforms/StablehloRefineShapes.cpp\n+-+++ stablehlo/stablehlo/transforms/StablehloRefineShapes.cpp\n+-@@ -461,7 +461,7 @@\n+-   LogicalResult emitDifferentRefinementContextError(func::FuncOp func,\n+-                                                     RefinementKey key,\n+-                                                     RefinementKey prevKey) {\n+--    return func.emitOpError() << \"refined with invompatible refinement keys:\"\n+-+    return func.emitOpError() << \"refined with incompatible refinement keys:\"\n+-                               << \"\\n  curr=\" << key.toString()\n+-                               << \"\\n  prev=\" << prevKey.toString();\n+-   }\n+ diff --ruN a/stablehlo/stablehlo/transforms/optimization/Passes.td b/stablehlo/stablehlo/transforms/optimization/Passes.td\n+ --- stablehlo/stablehlo/transforms/optimization/Passes.td\n+ +++ stablehlo/stablehlo/transforms/optimization/Passes.td"
        },
        {
            "sha": "83966483b0795edc1dc8176735f8c850bfdcffe5",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=7b8ce05b8bcf2f19829a6b28a7f5b0f9759e9a71",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"979d3d27750f9dc3d7596823f30a10511f73f25a\"\n-    SHARDY_SHA256 = \"aee2b07f6925a71ac582c44e758b63b7ea53c30c8324ee5e917ab18e090a8f42\"\n+    SHARDY_COMMIT = \"7fed8c5400d6ffd7e46e9ae318b7f55a5f67b91a\"\n+    SHARDY_SHA256 = \"eb1ce21c6302403d4d215c6f5be24a8790475c861e7303ead2728ab66edeef6d\"\n \n     tf_http_archive(\n         name = \"shardy\","
        }
    ],
    "stats": {
        "total": 184,
        "additions": 138,
        "deletions": 46
    }
}