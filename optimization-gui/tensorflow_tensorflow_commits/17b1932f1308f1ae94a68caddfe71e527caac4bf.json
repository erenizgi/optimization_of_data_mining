{
    "author": "WillFroom",
    "message": "[XLA:GPU][XTile] Don't cast to intermediate i64 when extracting the program id.\n\nPiperOrigin-RevId: 824573427",
    "sha": "17b1932f1308f1ae94a68caddfe71e527caac4bf",
    "files": [
        {
            "sha": "d58e11ed04920450ffd06bfaf56008768e2f5d76",
            "filename": "third_party/xla/xla/backends/gpu/codegen/triton/transforms/tests/triton_xla_lower_xtile.mlir",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/17b1932f1308f1ae94a68caddfe71e527caac4bf/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftests%2Ftriton_xla_lower_xtile.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/17b1932f1308f1ae94a68caddfe71e527caac4bf/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftests%2Ftriton_xla_lower_xtile.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftests%2Ftriton_xla_lower_xtile.mlir?ref=17b1932f1308f1ae94a68caddfe71e527caac4bf",
            "patch": "@@ -10,8 +10,7 @@ xtile.entry_func @extract_insert_no_layout(%input: memref<1024xf32, #nvvm.memory\n \n // CHECK: func.func @extract_insert_no_layout(%[[ARG0:.*]]: !tt.ptr<f32>, %[[ARG1:.*]]: !tt.ptr<f32>) {\n // CHECK:   %[[PID:.*]] = tt.get_program_id x : i32\n-// CHECK:   %[[PID_I64:.*]] = arith.extsi %[[PID]] : i32 to i64\n-// CHECK:   %[[PID_IDX:.*]] = arith.index_cast %[[PID_I64]] : i64 to index\n+// CHECK:   %[[PID_IDX:.*]] = arith.index_cast %[[PID]] : i32 to index\n // CHECK:   %[[TILE:.*]] = triton_xla.extract from %[[ARG0]] as memref<1024xf32, #triton_xla.layout<[0]>> [%[[PID_IDX]]] [1] [1] : tensor<1xf32>\n // CHECK:   triton_xla.insert %[[TILE]] into %[[ARG1]] as memref<32xf32, #triton_xla.layout<[0]>> [%[[PID_IDX]]] [1] [1] : tensor<1xf32>\n // CHECK:   return\n@@ -29,8 +28,7 @@ xtile.entry_func @layout_preserved(%input: !arg_type,\n \n // CHECK: func.func @layout_preserved(%[[ARG0:.*]]: !tt.ptr<bf16>) {\n // CHECK:   %[[PID:.*]] = tt.get_program_id x : i32\n-// CHECK:   %[[PID_I64:.*]] = arith.extsi %[[PID]] : i32 to i64\n-// CHECK:   %[[PID_IDX:.*]] = arith.index_cast %[[PID_I64]] : i64 to index\n+// CHECK:   %[[PID_IDX:.*]] = arith.index_cast %[[PID]] : i32 to index\n // CHECK:   %[[TILE:.*]] = triton_xla.extract from %[[ARG0]]\n // CHECK-SAME: as memref<1024x32x1x1xbf16, #triton_xla.layout<[3, 2, 0, 1]>>\n // CHECK-SAME: [%[[PID_IDX]], 0, 0, 0]"
        },
        {
            "sha": "66d342ef1da9fb76f3647eff1eea011022139512",
            "filename": "third_party/xla/xla/backends/gpu/codegen/triton/transforms/triton_xla_lower_xtile_pass.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/17b1932f1308f1ae94a68caddfe71e527caac4bf/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftriton_xla_lower_xtile_pass.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/17b1932f1308f1ae94a68caddfe71e527caac4bf/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftriton_xla_lower_xtile_pass.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Ftriton%2Ftransforms%2Ftriton_xla_lower_xtile_pass.cc?ref=17b1932f1308f1ae94a68caddfe71e527caac4bf",
            "patch": "@@ -163,13 +163,9 @@ class XTileEntryToTriton\n \n     BlockArgument tile_id_arg = old_args.back();\n \n-    // TODO(b/389955087): we can decide whether to sign extend by\n-    // understanding if we need 64 bits to encode indices or if 32 bits are\n-    // enough. For now, just use 64 bits to avoid issues.\n     auto pid = builder.create<ttir::GetProgramIdOp>(ttir::ProgramIDDim::X);\n-    Value pid_i64 = builder.create<ma::ExtSIOp>(builder.getI64Type(), pid);\n     Value pid_idx =\n-        builder.create<ma::IndexCastOp>(builder.getIndexType(), pid_i64);\n+        builder.create<ma::IndexCastOp>(builder.getIndexType(), pid);\n     rewriter.replaceAllUsesWith(tile_id_arg, pid_idx);\n \n     // Handle memeref arguments."
        }
    ],
    "stats": {
        "total": 12,
        "additions": 3,
        "deletions": 9
    }
}