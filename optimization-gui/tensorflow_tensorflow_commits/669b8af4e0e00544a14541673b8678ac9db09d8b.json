{
    "author": "ermilovmaxim",
    "message": "avoid arithmetics with nullptr(UB)\n\nPiperOrigin-RevId: 836705259",
    "sha": "669b8af4e0e00544a14541673b8678ac9db09d8b",
    "files": [
        {
            "sha": "4891503a0314bebab43dace6a16135f5ee9def10",
            "filename": "third_party/xla/xla/tsl/framework/bfc_allocator.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/669b8af4e0e00544a14541673b8678ac9db09d8b/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fbfc_allocator.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/669b8af4e0e00544a14541673b8678ac9db09d8b/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fbfc_allocator.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fbfc_allocator.cc?ref=669b8af4e0e00544a14541673b8678ac9db09d8b",
            "patch": "@@ -25,6 +25,7 @@ limitations under the License.\n #include <map>\n #include <memory>\n #include <optional>\n+#include <string>\n #include <utility>\n #include <vector>\n \n@@ -999,10 +1000,9 @@ void RenderRegion(char* rendered, const size_t resolution,\n \n }  // namespace\n \n-string BFCAllocator::RenderOccupancy() {\n+std::string BFCAllocator::RenderOccupancy() {\n   // Make a buffer for the ASCII-art representation.\n   const size_t resolution = 100;\n-  char rendered[resolution];\n \n   // Compute the total region size to render over\n   size_t total_region_size = 0;\n@@ -1015,8 +1015,7 @@ string BFCAllocator::RenderOccupancy() {\n   }\n \n   // Start out with everything empty\n-  RenderRegion(rendered, resolution, total_region_size, 0, nullptr, nullptr,\n-               total_region_size, '_');\n+  std::string rendered(resolution, '_');\n \n   size_t region_offset = 0;\n   for (const auto& region : region_manager_.regions()) {\n@@ -1028,20 +1027,21 @@ string BFCAllocator::RenderOccupancy() {\n         // Render the wasted space\n         size_t wasted = c->size - c->requested_size;\n         if (wasted > 0) {\n-          RenderRegion(rendered, resolution, total_region_size,\n+          RenderRegion(rendered.data(), resolution, total_region_size,\n                        region_offset + c->requested_size, region.ptr(), c->ptr,\n                        wasted, 'x');\n         }\n         // Then the occupied space\n-        RenderRegion(rendered, resolution, total_region_size, region_offset,\n-                     region.ptr(), c->ptr, c->requested_size, '*');\n+        RenderRegion(rendered.data(), resolution, total_region_size,\n+                     region_offset, region.ptr(), c->ptr, c->requested_size,\n+                     '*');\n       }\n       h = c->next;\n     }\n     region_offset += region.memory_size();\n   }\n \n-  return string(rendered, resolution);\n+  return rendered;\n }\n \n void BFCAllocator::DumpMemoryLog(size_t num_bytes) {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}