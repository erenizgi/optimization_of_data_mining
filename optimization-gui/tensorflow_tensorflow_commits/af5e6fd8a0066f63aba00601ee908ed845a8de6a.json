{
    "author": "wsmoses",
    "message": "Preserve tmpdir for rocm. Fixes build for certain docker setups that don't have standard tmpdir locations\n\nPiperOrigin-RevId: 828657428",
    "sha": "af5e6fd8a0066f63aba00601ee908ed845a8de6a",
    "files": [
        {
            "sha": "9a1fa830d14c8a7940344f0c4a3c07b72b758ea1",
            "filename": "third_party/xla/third_party/gpus/crosstool/clang/bin/crosstool_wrapper_driver_rocm.tpl",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/af5e6fd8a0066f63aba00601ee908ed845a8de6a/third_party%2Fxla%2Fthird_party%2Fgpus%2Fcrosstool%2Fclang%2Fbin%2Fcrosstool_wrapper_driver_rocm.tpl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/af5e6fd8a0066f63aba00601ee908ed845a8de6a/third_party%2Fxla%2Fthird_party%2Fgpus%2Fcrosstool%2Fclang%2Fbin%2Fcrosstool_wrapper_driver_rocm.tpl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Fcrosstool%2Fclang%2Fbin%2Fcrosstool_wrapper_driver_rocm.tpl?ref=af5e6fd8a0066f63aba00601ee908ed845a8de6a",
            "patch": "@@ -32,6 +32,7 @@ HIP_RUNTIME_PATH = '%{rocm_root}/lib'\n HIP_RUNTIME_LIBRARY = '%{rocm_root}/lib'\n ROCR_RUNTIME_PATH = '%{rocm_root}/lib'\n ROCR_RUNTIME_LIBRARY = '%{rocr_runtime_library}'\n+TMPDIR= '%{tmpdir}'\n VERBOSE = '%{crosstool_verbose}'=='1'\n \n def Log(s):\n@@ -232,6 +233,8 @@ def InvokeHipcc(argv, log=False):\n \n \n def main():\n+  if TMPDIR:\n+    os.environ['TMPDIR'] = TMPDIR\n   # ignore PWD env var\n   os.environ['PWD']=''\n "
        },
        {
            "sha": "25197a3dc500b07944e682740bd7eab3265532d8",
            "filename": "third_party/xla/third_party/gpus/rocm_configure.bzl",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/af5e6fd8a0066f63aba00601ee908ed845a8de6a/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/af5e6fd8a0066f63aba00601ee908ed845a8de6a/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl?ref=af5e6fd8a0066f63aba00601ee908ed845a8de6a",
            "patch": "@@ -51,6 +51,7 @@ _TF_ROCM_CONFIG_REPO = \"TF_ROCM_CONFIG_REPO\"\n _DISTRIBUTION_PATH = \"rocm/rocm_dist\"\n _OS = \"OS\"\n _ROCM_VERSION = \"ROCM_VERSION\"\n+_TMPDIR = \"TMPDIR\"\n \n _DEFAULT_ROCM_TOOLKIT_PATH = \"/opt/rocm\"\n _TF_ROCM_MULTIPLE_PATHS = \"TF_ROCM_MULTIPLE_PATHS\"\n@@ -715,6 +716,11 @@ def _create_local_rocm_repository(repository_ctx):\n             \"%{rocm_amdgpu_targets}\": \",\".join(\n                 [\"\\\"%s\\\"\" % c for c in rocm_config.amdgpu_targets],\n             ),\n+            \"%{tmpdir}\": get_host_environ(\n+                repository_ctx,\n+                _TMPDIR,\n+                \"\",\n+            ),\n         },\n     )\n "
        }
    ],
    "stats": {
        "total": 9,
        "additions": 9,
        "deletions": 0
    }
}