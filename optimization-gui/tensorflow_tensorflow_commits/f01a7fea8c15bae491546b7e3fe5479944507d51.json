{
    "author": "quoctruong",
    "message": "Update ML Build Docker container to use hermetic C++\n\nPiperOrigin-RevId: 826147864",
    "sha": "f01a7fea8c15bae491546b7e3fe5479944507d51",
    "files": [
        {
            "sha": "a4fb0cd9b1640a4558e9ad4d8026ce614fac22a6",
            "filename": "ci/official/containers/ml_build/Dockerfile",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile?ref=f01a7fea8c15bae491546b7e3fe5479944507d51",
            "patch": "@@ -12,14 +12,6 @@ COPY builder.packages.txt /builder.packages.txt\n \n RUN /setup.sources.sh && /setup.packages.sh /builder.packages.txt\n \n-# Install devtoolset-9 in /dt9 with glibc 2.17 and libstdc++ 4.8, for building\n-# manylinux2014-compatible packages.\n-COPY builder.devtoolset/fixlinks.sh /fixlinks.sh\n-COPY builder.devtoolset/rpm-patch.sh /rpm-patch.sh\n-COPY builder.devtoolset/build_devtoolset.sh /build_devtoolset.sh\n-COPY builder.devtoolset/glibc2.17-inline.patch /glibc2.17-inline.patch\n-RUN /build_devtoolset.sh devtoolset-9 /dt9\n-\n # Setup Python\n COPY setup.python.sh /setup.python.sh\n COPY builder.requirements.txt /builder.requirements.txt\n@@ -56,9 +48,6 @@ RUN ln -sf /usr/bin/python3.12 /usr/bin/python3\n RUN ln -sf /usr/bin/python3.12 /usr/bin/python\n RUN ln -sf /usr/lib/python3.12 /usr/lib/tf_python\n \n-# Make sure clang is on the path\n-RUN ln -s /usr/lib/llvm-18/bin/clang /usr/bin/clang\n-\n # Link the compat driver to the location if available.\n RUN if [ -e \"/usr/local/cuda/compat/libcuda.so.1\" ]; then ln -s /usr/local/cuda/compat/libcuda.so.1 /usr/lib/x86_64-linux-gnu/libcuda.so.1; fi\n "
        },
        {
            "sha": "1dce9764cd395e222b7994a9c12573be1750ad8d",
            "filename": "ci/official/containers/ml_build/builder.packages.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 19,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt?ref=f01a7fea8c15bae491546b7e3fe5479944507d51",
            "patch": "@@ -1,28 +1,9 @@\n-# Packages to be installed for the new Docker image.\n-\n-# Packages needed to build devtoolset\n-file\n-flex\n-g++\n-make\n-patch\n-rpm2cpio\n-unar\n-wget\n-xz-utils\n-cpio\n-\n # Other build-related tools\n apt-transport-https\n autoconf\n automake\n build-essential\n ca-certificates\n-llvm-18\n-clang-18\n-clang-tidy-18\n-lld-18\n-clang-format-12\n curl\n git\n parallel\n@@ -32,4 +13,5 @@ unzip\n zip\n openjdk-21-jdk\n vim\n+wget\n jq"
        },
        {
            "sha": "ae113c68c2f03c2cf6efcb54846129bf96cd4655",
            "filename": "ci/official/containers/ml_build/builder.requirements.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.requirements.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.requirements.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.requirements.txt?ref=f01a7fea8c15bae491546b7e3fe5479944507d51",
            "patch": "@@ -5,6 +5,9 @@ id\n urllib3\n requests\n \n+# For XLA\n+pyyaml\n+\n # For JAX\n build ~= 1.2.2\n # uv is faster than pip for installing Python packages."
        },
        {
            "sha": "b849457420f52261069cbc3dd154ea70ff65ec67",
            "filename": "ci/official/containers/ml_build/setup.python.sh",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f01a7fea8c15bae491546b7e3fe5479944507d51/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh?ref=f01a7fea8c15bae491546b7e3fe5479944507d51",
            "patch": "@@ -45,16 +45,6 @@ fi\n \n /setup.packages.sh pythons.txt\n \n-# Re-link pyconfig.h from x86_64-linux-gnu into the devtoolset directory\n-# for any Python version present\n-pushd /usr/include/x86_64-linux-gnu\n-for f in $(ls | grep python); do\n-  # set up symlink for devtoolset-9\n-  rm -f /dt9/usr/include/x86_64-linux-gnu/$f\n-  ln -s /usr/include/x86_64-linux-gnu/$f /dt9/usr/include/x86_64-linux-gnu/$f\n-done\n-popd\n-\n # Python 3.10 include headers fix:\n # sysconfig.get_path('include') incorrectly points to /usr/local/include/python\n # map /usr/include/python3.10 to /usr/local/include/python3.10"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 4,
        "deletions": 40
    }
}