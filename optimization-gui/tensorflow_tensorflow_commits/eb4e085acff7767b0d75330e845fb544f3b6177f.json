{
    "author": "tensorflower-gardener",
    "message": "[XLA:GPU] Add device number to logs\n\nPiperOrigin-RevId: 811742488",
    "sha": "eb4e085acff7767b0d75330e845fb544f3b6177f",
    "files": [
        {
            "sha": "1d6a6856c5d115f9271ad8bbea7964675d5689d7",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/eb4e085acff7767b0d75330e845fb544f3b6177f/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/eb4e085acff7767b0d75330e845fb544f3b6177f/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc?ref=eb4e085acff7767b0d75330e845fb544f3b6177f",
            "patch": "@@ -1844,7 +1844,8 @@ StreamExecutorGpuClient::RunAsync(\n                                  : executor->device_ordinal();\n \n   XLA_SCOPED_LOGGING_TIMER(absl::StrCat(\n-      \"GpuExecutable::ExecuteAsyncOnStreamImpl(\", gpu_exec->name(), \")\"));\n+      \"[\", device_ordinal, \"] GpuExecutable::ExecuteAsyncOnStreamImpl(\",\n+      gpu_exec->name(), \")\"));\n \n   // GpuExecutable always bound to a single GpuContext during its execution, so\n   // we activate it once to skip expensive context activations later.\n@@ -1925,7 +1926,7 @@ StreamExecutorGpuClient::RunAsync(\n   }\n   xla::gpu::BufferAllocations buffer_allocations(buffers, device_ordinal,\n                                                  memory_allocator);\n-  VLOG(3) << buffer_allocations.ToString();\n+  VLOG(3) << \"[\" << device_ordinal << \"] \" << buffer_allocations.ToString();\n \n   std::set<se::DeviceMemoryBase> buffers_in_result;\n \n@@ -1943,8 +1944,8 @@ StreamExecutorGpuClient::RunAsync(\n         &allocations[output_info.allocation_index];\n     se::DeviceMemoryBase result_buffer;\n \n-    VLOG(4) << \"Looking at: allocation \" << output_info.allocation_index\n-            << \" @ index: \" << index.ToString();\n+    VLOG(4) << \"[\" << device_ordinal << \"] Looking at: allocation \"\n+            << output_info.allocation_index << \" @ index: \" << index.ToString();\n \n     if (output_info.alias_config) {\n       PjRtStreamExecutorExecutionInput& input =\n@@ -1971,7 +1972,8 @@ StreamExecutorGpuClient::RunAsync(\n         // The guard is above is not to insert copy-protection when aliasing\n         // pass-through params, as we do not need to write into the output\n         // buffer.\n-        VLOG(3) << \"Using copy-protection: aliasing is specified, but the \"\n+        VLOG(3) << \"[\" << device_ordinal\n+                << \"] Using copy-protection: aliasing is specified, but the \"\n                    \"buffer is not donated; allocating a fresh buffer\";\n         int64_t allocation_size = ShapeUtil::ByteSizeOf(\n             ShapeUtil::GetSubshape(gpu_exec->result_shape(), index));"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 7,
        "deletions": 5
    }
}