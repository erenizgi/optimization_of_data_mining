{
    "author": "pifon2a",
    "message": "[XLA:GPU][NFC] Fix linking of MapLogicalToLinearizedPhysicalShape.\n\nPiperOrigin-RevId: 810003990",
    "sha": "2cad0051637babcc821523df2caf06dff3df119e",
    "files": [
        {
            "sha": "703a5d584dc9e175d74521a4b763a30647357983",
            "filename": "third_party/xla/xla/service/gpu/model/coalescing_analysis.cc",
            "status": "modified",
            "additions": 24,
            "deletions": 24,
            "changes": 48,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2cad0051637babcc821523df2caf06dff3df119e/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2cad0051637babcc821523df2caf06dff3df119e/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fmodel%2Fcoalescing_analysis.cc?ref=2cad0051637babcc821523df2caf06dff3df119e",
            "patch": "@@ -230,30 +230,6 @@ Shape GetLinearizedShape(const Shape& shape) {\n   return result;\n }\n \n-llvm::SmallVector<IndexingMap, 4> MapLogicalToLinearizedPhysicalShape(\n-    absl::Span<const HloInstruction* const> operands,\n-    MLIRContext* mlir_context) {\n-  llvm::SmallVector<IndexingMap, 4> indexing_maps;\n-  // For every operand compute thread ID -> physical layout of operand\n-  // indexing map.\n-  for (const HloInstruction* operand : operands) {\n-    const Shape& operand_shape = operand->shape();\n-\n-    IndexingMap operand_logical_to_physical_map =\n-        GetIndexingMapFromLogicalToPhysicalLayout(operand_shape, mlir_context);\n-    IndexingMap operand_physical_to_linearized_shape = GetBitcastMap(\n-        ShapeUtil::MakeShapeWithDescendingLayoutAndSamePhysicalLayout(\n-            operand_shape),\n-        GetLinearizedShape(operand_shape), mlir_context);\n-    IndexingMap operand_logical_to_linearized_physical_shape =\n-        operand_logical_to_physical_map * operand_physical_to_linearized_shape;\n-    operand_logical_to_linearized_physical_shape.Simplify();\n-    indexing_maps.push_back(\n-        std::move(operand_logical_to_linearized_physical_shape));\n-  }\n-  return indexing_maps;\n-}\n-\n // Returns thread ID to linearized physical layout indexing map for each operand\n // of the fusion.\n std::optional<GroupedByOpIndexingMap> GetThreadIdToInputMemoryLayoutsMaps(\n@@ -678,6 +654,30 @@ std::optional<CoalescingMap> ComputeCoalescingForAllOperands(\n \n }  // namespace\n \n+llvm::SmallVector<IndexingMap, 4> MapLogicalToLinearizedPhysicalShape(\n+    absl::Span<const HloInstruction* const> operands,\n+    MLIRContext* mlir_context) {\n+  llvm::SmallVector<IndexingMap, 4> indexing_maps;\n+  // For every operand compute thread ID -> physical layout of operand\n+  // indexing map.\n+  for (const HloInstruction* operand : operands) {\n+    const Shape& operand_shape = operand->shape();\n+\n+    IndexingMap operand_logical_to_physical_map =\n+        GetIndexingMapFromLogicalToPhysicalLayout(operand_shape, mlir_context);\n+    IndexingMap operand_physical_to_linearized_shape = GetBitcastMap(\n+        ShapeUtil::MakeShapeWithDescendingLayoutAndSamePhysicalLayout(\n+            operand_shape),\n+        GetLinearizedShape(operand_shape), mlir_context);\n+    IndexingMap operand_logical_to_linearized_physical_shape =\n+        operand_logical_to_physical_map * operand_physical_to_linearized_shape;\n+    operand_logical_to_linearized_physical_shape.Simplify();\n+    indexing_maps.push_back(\n+        std::move(operand_logical_to_linearized_physical_shape));\n+  }\n+  return indexing_maps;\n+}\n+\n /*static*/\n CoalescingAnalysis CoalescingAnalysis::Create(\n     const HloInstruction* instr,"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 24,
        "deletions": 24
    }
}