{
    "author": "shawnwang18",
    "message": "PR #33149: [XLA:GPU] add VLOG dump option that only prints out primary command buffer graph.\n\nImported from GitHub PR https://github.com/openxla/xla/pull/33149\n\nüìù Summary of Changes\n add cuda graph dump option that only prints out primary graph, so not to flush the screen log with nested cuda graph.\n\nüéØ Justification\nEasy debug read\n\nüöÄ Kind of Contribution\nPlease remove what does not applyüìö Documentation\n\nCopybara import of the project:\n\n--\n18d6939170fd5bf4fa9228d4f74ca3ff4e83ec17 by Shawn Wang <shawnw@nvidia.com>:\n\nadd cuda graph dump option that only prints out primary graph\n\nMerging this change closes #33149\n\nPiperOrigin-RevId: 825049186",
    "sha": "d1ca03b626678df858d3ebe41fa65d22b702603f",
    "files": [
        {
            "sha": "24264c64850c22e26cb1a031b821febe371cd0f7",
            "filename": "third_party/xla/xla/stream_executor/gpu/gpu_command_buffer.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d1ca03b626678df858d3ebe41fa65d22b702603f/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fgpu_command_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d1ca03b626678df858d3ebe41fa65d22b702603f/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fgpu_command_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fgpu%2Fgpu_command_buffer.cc?ref=d1ca03b626678df858d3ebe41fa65d22b702603f",
            "patch": "@@ -569,14 +569,15 @@ absl::Status GpuCommandBuffer::Finalize() {\n   TF_RETURN_IF_ERROR(PrepareFinalization());\n \n   // Maybe dump created GPU graph to a dot file for debugging.\n-  if (state_ == State::kCreate && VLOG_IS_ON(10)) {\n+  if (state_ == State::kCreate &&\n+      (VLOG_IS_ON(10) || (VLOG_IS_ON(9) && mode_ == Mode::kPrimary))) {\n     std::string path = tsl::io::GetTempFilename(/*extension=*/\"dot\");\n     TF_RETURN_IF_ERROR(WriteGraphToDotFile(path));\n-    if (VLOG_IS_ON(100)) {\n+    if (VLOG_IS_ON(100) || (VLOG_IS_ON(90) && mode_ == Mode::kPrimary)) {\n       std::string dot_file_contents;\n       TF_RETURN_IF_ERROR(\n           tsl::ReadFileToString(tsl::Env::Default(), path, &dot_file_contents));\n-      VLOG(100) << \"Contents of \" << path << \" is:\\n\" << dot_file_contents;\n+      VLOG(90) << \"Contents of \" << path << \" is:\\n\" << dot_file_contents;\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 7,
        "additions": 4,
        "deletions": 3
    }
}