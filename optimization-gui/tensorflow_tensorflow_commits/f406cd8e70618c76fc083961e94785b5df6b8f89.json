{
    "author": "sergachev",
    "message": "PR #30682: Disable float normalization for bitcasts.\n\nImported from GitHub PR https://github.com/openxla/xla/pull/30682\n\nBitcasts can be used to express no-op data type conversions.\n\nCopybara import of the project:\n\n--\n2ff73deebdbcc3e65cdcb56d6fa9c43e5f8a3ae9 by Ilia Sergachev <isergachev@nvidia.com>:\n\nDisable float normalization for bitcasts.\n\nBitcasts can be used to express no-op data type conversions.\n\n--\nb08f709f076b8f0bacf602cc3b10a5e2e14e6240 by Ilia Sergachev <isergachev@nvidia.com>:\n\nMake the test more specific regarding int4 packing.\n\nMerging this change closes #30682\n\nPiperOrigin-RevId: 800336872",
    "sha": "f406cd8e70618c76fc083961e94785b5df6b8f89",
    "files": [
        {
            "sha": "f0f9e09f90a561d5d213d181bc42f4a087dc4165",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/float_normalization.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f406cd8e70618c76fc083961e94785b5df6b8f89/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f406cd8e70618c76fc083961e94785b5df6b8f89/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization.cc?ref=f406cd8e70618c76fc083961e94785b5df6b8f89",
            "patch": "@@ -595,6 +595,7 @@ absl::Status FloatNormalizationVisitor::DefaultAction(HloInstruction* hlo) {\n       hlo->opcode() == HloOpcode::kWhile ||            //\n       hlo->opcode() == HloOpcode::kConditional ||      //\n       hlo->opcode() == HloOpcode::kBitcastConvert ||   //\n+      hlo->opcode() == HloOpcode::kBitcast ||          //\n       hlo->opcode() == HloOpcode::kAsyncStart ||       //\n       hlo->opcode() == HloOpcode::kAsyncDone ||        //\n       hlo->HasSideEffectNoRecurse()) {"
        },
        {
            "sha": "dcd8cd6a4f9b41eb33e804a063d02205d8f704e2",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/float_normalization_test.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f406cd8e70618c76fc083961e94785b5df6b8f89/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f406cd8e70618c76fc083961e94785b5df6b8f89/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Ffloat_normalization_test.cc?ref=f406cd8e70618c76fc083961e94785b5df6b8f89",
            "patch": "@@ -583,6 +583,16 @@ TEST_F(FloatNormalizationTest, DoNotChangeBitcastConvert) {\n   EXPECT_EQ(root->operand(0)->shape().element_type(), U16);\n }\n \n+TEST_F(FloatNormalizationTest, DoNotChangeBitcast) {\n+  TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<HloModule> module,\n+                          ParseAndReturnVerifiedModule(R\"(\n+m {\n+  a = s4[4,2]{1,0:E(4)} parameter(0)\n+  b = s8[4] bitcast(a)\n+})\"));\n+  EXPECT_FALSE(Normalize(module.get(), S4));\n+}\n+\n TEST_P(FloatNormalizationF8Test, ResolveIfUnsupportedF8) {\n   PrimitiveType f8_type = GetParam();\n   auto builder = HloComputation::Builder(TestName());"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}