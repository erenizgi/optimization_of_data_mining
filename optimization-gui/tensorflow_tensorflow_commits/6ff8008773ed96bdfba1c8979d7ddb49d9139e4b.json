{
    "author": "tensorflower-gardener",
    "message": "Automated Code Change\n\nPiperOrigin-RevId: 809586886",
    "sha": "6ff8008773ed96bdfba1c8979d7ddb49d9139e4b",
    "files": [
        {
            "sha": "f590ab87e46532facc257a6eaf6d24e45fc12e9a",
            "filename": "third_party/xla/xla/python/ifrt_proxy/server/ifrt_backend_test.cc",
            "status": "modified",
            "additions": 36,
            "deletions": 39,
            "changes": 75,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6ff8008773ed96bdfba1c8979d7ddb49d9139e4b/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6ff8008773ed96bdfba1c8979d7ddb49d9139e4b/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fserver%2Fifrt_backend_test.cc?ref=6ff8008773ed96bdfba1c8979d7ddb49d9139e4b",
            "patch": "@@ -283,13 +283,13 @@ class IfrtBackendHandlerTest : public IfrtBackendTest {\n         .WillByDefault(Return(raw_device_ptrs));\n     ON_CALL(*mock_client, LookupDevice(_))\n         .WillByDefault(\n-            Invoke([this](DeviceId id) -> absl::StatusOr<xla::ifrt::Device*> {\n+            [this](DeviceId id) -> absl::StatusOr<xla::ifrt::Device*> {\n               if (id.value() < 0 || id.value() >= mock_devices_.size()) {\n                 return absl::NotFoundError(\n                     absl::StrCat(\"Unknown device id: \", id.value()));\n               }\n               return mock_devices_[id.value()].get();\n-            }));\n+            });\n     ON_CALL(*mock_client, MakeDeviceList(_))\n         .WillByDefault([](absl::Span<xla::ifrt::Device* const> devices) {\n           return xla::ifrt::BasicDeviceList::Create(devices);\n@@ -806,16 +806,16 @@ TEST_P(IfrtBackendHandlerTest, CopyToHostSuccessWithStringArray) {\n   ON_CALL(*mock_array, dtype()).WillByDefault(Return(expected_dtype));\n \n   ON_CALL(*mock_array, CopyToHostBuffer(_, _, _))\n-      .WillByDefault(Invoke(\n-          [input_strings = input_strings](\n-              void* data, std::optional<absl::Span<const int64_t>> byte_strides,\n-              xla::ifrt::ArrayCopySemantics semantics) {\n-            auto dst = static_cast<absl::Cord*>(data);\n-            for (int i = 0; i < input_strings.size(); ++i) {\n-              dst[i] = input_strings[i];\n-            }\n-            return Future<>(absl::OkStatus());\n-          }));\n+      .WillByDefault([input_strings = input_strings](\n+                         void* data,\n+                         std::optional<absl::Span<const int64_t>> byte_strides,\n+                         xla::ifrt::ArrayCopySemantics semantics) {\n+        auto dst = static_cast<absl::Cord*>(data);\n+        for (int i = 0; i < input_strings.size(); ++i) {\n+          dst[i] = input_strings[i];\n+        }\n+        return Future<>(absl::OkStatus());\n+      });\n \n   EXPECT_CALL(*mock_client_,\n               MakeArrayFromHostBuffer(_, expected_dtype, expected_shape,\n@@ -1326,16 +1326,15 @@ TEST_P(IfrtBackendHandlerTest, LoadedExecutableExecute) {\n   }\n \n   EXPECT_CALL(*executable, Execute(SizeIs(kNumArgs), _, _))\n-      .WillOnce(\n-          Invoke([&](absl::Span<ArrayRef> args,\n-                     const xla::ifrt::LoadedExecutable::ExecuteOptions& options,\n-                     std::optional<DeviceListRef> devices)\n-                     -> absl::StatusOr<LoadedExecutable::ExecuteResult> {\n-            return LoadedExecutable::ExecuteResult{\n-                .status = Future<>(absl::InternalError(\"injected error\")),\n-                .outputs = outputs,\n-            };\n-          }));\n+      .WillOnce([&](absl::Span<ArrayRef> args,\n+                    const xla::ifrt::LoadedExecutable::ExecuteOptions& options,\n+                    std::optional<DeviceListRef> devices)\n+                    -> absl::StatusOr<LoadedExecutable::ExecuteResult> {\n+        return LoadedExecutable::ExecuteResult{\n+            .status = Future<>(absl::InternalError(\"injected error\")),\n+            .outputs = outputs,\n+        };\n+      });\n \n   auto request = NewIfrtRequest(NewOpId());\n   LoadedExecutableExecuteRequest* execute_request =\n@@ -1417,13 +1416,12 @@ TEST_P(IfrtBackendHandlerTest, LoadedExecutableExecuteErrorWithClientHandles) {\n   };\n \n   EXPECT_CALL(*executable, Execute(SizeIs(kNumArgs), _, _))\n-      .WillOnce(\n-          Invoke([&](absl::Span<ArrayRef> args,\n-                     const xla::ifrt::LoadedExecutable::ExecuteOptions& options,\n-                     std::optional<DeviceListRef> devices)\n-                     -> absl::StatusOr<LoadedExecutable::ExecuteResult> {\n-            return absl::InternalError(\"injected error\");\n-          }));\n+      .WillOnce([&](absl::Span<ArrayRef> args,\n+                    const xla::ifrt::LoadedExecutable::ExecuteOptions& options,\n+                    std::optional<DeviceListRef> devices)\n+                    -> absl::StatusOr<LoadedExecutable::ExecuteResult> {\n+        return absl::InternalError(\"injected error\");\n+      });\n \n   auto request = NewIfrtRequest(NewOpId());\n   LoadedExecutableExecuteRequest* execute_request =\n@@ -1546,16 +1544,15 @@ TEST_P(IfrtBackendHandlerTest, LoadedHostCallbackExecute) {\n \n     EXPECT_CALL(mock_compiler_, CompileAndLoad(_, _))\n         .WillOnce(DoAll(\n-            Invoke(\n-                [&](const std::unique_ptr<xla::ifrt::Program>& program,\n-                    const std::unique_ptr<xla::ifrt::CompileOptions>& options) {\n-                  auto* xla_compile_options =\n-                      llvm::cast<xla::ifrt::XlaCompileOptions>(options.get());\n-                  auto& loaded_host_callbacks =\n-                      xla_compile_options->loaded_host_callbacks;\n-                  ASSERT_EQ(loaded_host_callbacks.size(), 1);\n-                  loaded_host_callback = loaded_host_callbacks.front();\n-                }),\n+            [&](const std::unique_ptr<xla::ifrt::Program>& program,\n+                const std::unique_ptr<xla::ifrt::CompileOptions>& options) {\n+              auto* xla_compile_options =\n+                  llvm::cast<xla::ifrt::XlaCompileOptions>(options.get());\n+              auto& loaded_host_callbacks =\n+                  xla_compile_options->loaded_host_callbacks;\n+              ASSERT_EQ(loaded_host_callbacks.size(), 1);\n+              loaded_host_callback = loaded_host_callbacks.front();\n+            },\n             Return(ByMove(std::move(e)))));\n \n     TF_ASSERT_OK_AND_ASSIGN(std::shared_ptr<IfrtResponse> response,"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 36,
        "deletions": 39
    }
}