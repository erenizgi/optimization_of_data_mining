{
    "author": "ezhulenev",
    "message": "[xla:ffi] Migrate to xla::ffi::MakeTypeInfo() API\n\nPiperOrigin-RevId: 826667736",
    "sha": "0b5bc94a8326064b7441c8757aea2586c74f7eb1",
    "files": [
        {
            "sha": "4de19fa10513ecd52035ab191131f42bfa571681",
            "filename": "third_party/xla/xla/ffi/api/ffi.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi.h?ref=0b5bc94a8326064b7441c8757aea2586c74f7eb1",
            "patch": "@@ -1512,7 +1512,7 @@ inline constexpr XLA_FFI_TypeInfo MakeTypeInfo() {\n   };\n }\n \n-// TODO(ezhulenev): Remove this once everyone migrates to MakeTypeInfo.\n+// // TODO(ezhulenev): Remove this once everyone migrates to MakeTypeInfo.\n template <typename T>\n inline constexpr XLA_FFI_TypeInfo TypeInfo() {\n   return MakeTypeInfo<T>();"
        },
        {
            "sha": "85f21e44e118e78faf95161cc0814e3b1cc8308e",
            "filename": "third_party/xla/xla/ffi/api/ffi_test.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fapi%2Fffi_test.cc?ref=0b5bc94a8326064b7441c8757aea2586c74f7eb1",
            "patch": "@@ -1290,14 +1290,20 @@ struct MyDataWithExplicitTypeId {\n \n // Rely on XLA to assign unique type id for the type.\n TypeId MyDataWithAutoTypeId::id = XLA_FFI_UNKNOWN_TYPE_ID;\n+static constexpr auto kMyDataWithAutoTypeIdTypeInfo =\n+    MakeTypeInfo<MyDataWithAutoTypeId>();\n+\n XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"my_data_auto\", &MyDataWithAutoTypeId::id,\n-                      TypeInfo<MyDataWithAutoTypeId>());\n+                      &kMyDataWithAutoTypeIdTypeInfo);\n \n // Provide explicit type id and rely on XLA to check that it's unique.\n TypeId MyDataWithExplicitTypeId::id = {42};\n+static constexpr auto kMyDataWithExplicitTypeIdTypeInfo =\n+    MakeTypeInfo<MyDataWithExplicitTypeId>();\n+\n XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"my_data_explicit\",\n                       &MyDataWithExplicitTypeId::id,\n-                      TypeInfo<MyDataWithExplicitTypeId>());\n+                      &kMyDataWithExplicitTypeIdTypeInfo);\n \n TEST(FfiTest, UserData) {\n   MyDataWithAutoTypeId data0{\"foo\"};\n@@ -1342,8 +1348,9 @@ struct MyState {\n };\n \n TypeId MyState::id = {};  // zero-initialize type id\n-XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"state\", &MyState::id,\n-                      TypeInfo<MyState>());\n+static constexpr auto kMyStateTypeInfo = MakeTypeInfo<MyState>();\n+\n+XLA_FFI_REGISTER_TYPE(GetXlaFfiApi(), \"state\", &MyState::id, &kMyStateTypeInfo);\n \n TEST(FfiTest, StatefulHandler) {\n   ExecutionState execution_state;"
        },
        {
            "sha": "b30d4b33ea2e9e7c60891ec6209a407408043f00",
            "filename": "third_party/xla/xla/pjrt/host_callback.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0b5bc94a8326064b7441c8757aea2586c74f7eb1/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.cc?ref=0b5bc94a8326064b7441c8757aea2586c74f7eb1",
            "patch": "@@ -180,8 +180,11 @@ CreateHostCallbackStateAndAppendSendRecvCallbacks(\n \n // First 64 bits of SHA-512 of \"xla::FfiLoadedHostCallbacks\".\n ffi::TypeId FfiLoadedHostCallbacks::id = {7357244197867843242};\n+static constexpr auto kFfiLoadedHostCallbacksTypeInfo =\n+    ffi::MakeTypeInfo<FfiLoadedHostCallbacks>();\n+\n XLA_FFI_REGISTER_TYPE(ffi::GetXlaFfiApi(), \"FfiLoadedHostCallbacks\",\n                       &FfiLoadedHostCallbacks::id,\n-                      ffi::TypeInfo<FfiLoadedHostCallbacks>());\n+                      &kFfiLoadedHostCallbacksTypeInfo);\n \n }  // namespace xla"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
    }
}