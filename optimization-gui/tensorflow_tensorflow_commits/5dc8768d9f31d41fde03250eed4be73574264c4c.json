{
    "author": "ezhulenev",
    "message": "[xla] Migrate to PjRtFuture<>::MakePromise() API\n\nPiperOrigin-RevId: 806514461",
    "sha": "5dc8768d9f31d41fde03250eed4be73574264c4c",
    "files": [
        {
            "sha": "de78e0a7205a2ef00c75ef4099b5b3c06e5bc185",
            "filename": "third_party/xla/xla/pjrt/host_callback.h",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5dc8768d9f31d41fde03250eed4be73574264c4c/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5dc8768d9f31d41fde03250eed4be73574264c4c/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fhost_callback.h?ref=5dc8768d9f31d41fde03250eed4be73574264c4c",
            "patch": "@@ -61,7 +61,7 @@ class ThreadSafePjRtChunkQueue {\n       queue_.push_back(std::move(chunk));\n       return;\n     }\n-    auto pop_promise = promises_.front();\n+    auto& pop_promise = promises_.front();\n     pop_promise.Set(std::move(chunk));\n     promises_.pop_front();\n   }\n@@ -70,9 +70,9 @@ class ThreadSafePjRtChunkQueue {\n   PjRtFuture<PjRtChunk> Pop() {\n     absl::MutexLock lock(&mu_);\n     if (queue_.empty()) {\n-      auto promise = PjRtFuture<PjRtChunk>::CreatePromise();\n-      promises_.push_back(promise);\n-      return PjRtFuture<PjRtChunk>(std::move(promise));\n+      auto [promise, future] = PjRtFuture<PjRtChunk>::MakePromise();\n+      promises_.push_back(std::move(promise));\n+      return std::move(future);\n     }\n \n     auto chunk = PjRtFuture<PjRtChunk>(std::move(queue_.front()));\n@@ -84,7 +84,8 @@ class ThreadSafePjRtChunkQueue {\n   absl::Mutex mu_;\n   std::deque<PjRtChunk> queue_ ABSL_GUARDED_BY(mu_);\n   // Contains unfulfilled pop promises.\n-  std::deque<PjRtFuture<PjRtChunk>::Promise> promises_ ABSL_GUARDED_BY(mu_);\n+  std::deque<PjRtFuture<PjRtChunk>::MoveOnlyPromise> promises_\n+      ABSL_GUARDED_BY(mu_);\n };\n \n struct HostCallbackArgInfo {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}