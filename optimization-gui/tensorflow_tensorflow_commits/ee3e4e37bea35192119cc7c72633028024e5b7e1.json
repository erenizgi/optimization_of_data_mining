{
    "author": "pschuh",
    "message": "Make c-api topology and PjRtClient versions produce identical platform_verison\nstrings to improve cache reuse between aot and actual runtime uses.\n\nRemove runtime_type as a cache key (compilation shouldn't depend on the runtime).\n\nPiperOrigin-RevId: 845541086",
    "sha": "ee3e4e37bea35192119cc7c72633028024e5b7e1",
    "files": [
        {
            "sha": "00b653824a16547f08f5d7e6b1673dbc0e1cd100",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_helpers.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc?ref=ee3e4e37bea35192119cc7c72633028024e5b7e1",
            "patch": "@@ -707,6 +707,17 @@ absl::string_view GetPlatformVersion(PJRT_Client* client, const PJRT_Api* api) {\n   return platform_version;\n }\n \n+absl::string_view GetPlatformVersion(PJRT_TopologyDescription* c_topology,\n+                                     const PJRT_Api* api) {\n+  PJRT_TopologyDescription_PlatformVersion_Args args;\n+  args.struct_size = PJRT_TopologyDescription_PlatformVersion_Args_STRUCT_SIZE;\n+  args.extension_start = nullptr;\n+  args.topology = c_topology;\n+  pjrt::LogFatalIfPjrtError(\n+      api->PJRT_TopologyDescription_PlatformVersion(&args), api);\n+  return absl::string_view(args.platform_version, args.platform_version_size);\n+}\n+\n absl::string_view GetPlatformName(PJRT_Client* client, const PJRT_Api* api) {\n   PJRT_Client_PlatformName_Args args;\n   args.client = client;"
        },
        {
            "sha": "5c0ae4a1ac2d7b3b88ba0d9b6e5edf1dd05a66a7",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_helpers.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h?ref=ee3e4e37bea35192119cc7c72633028024e5b7e1",
            "patch": "@@ -199,6 +199,8 @@ absl::Status ActualStructSizeIsGreaterOrEqual(absl::string_view struct_name,\n                                               size_t actual_size);\n \n absl::string_view GetPlatformVersion(PJRT_Client* client, const PJRT_Api* api);\n+absl::string_view GetPlatformVersion(PJRT_TopologyDescription* c_topology,\n+                                     const PJRT_Api* api);\n absl::string_view GetPlatformName(PJRT_Client* client, const PJRT_Api* api);\n \n absl::StatusOr<PJRT_TopologyDescription*> GetTopologyDescription("
        },
        {
            "sha": "b0f25add8a9ff36d87ea40498a659ba335594711",
            "filename": "third_party/xla/xla/pjrt/c_api_client/pjrt_c_api_client.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.cc?ref=ee3e4e37bea35192119cc7c72633028024e5b7e1",
            "patch": "@@ -3352,6 +3352,8 @@ PjRtCApiTopologyDescription::PjRtCApiTopologyDescription(\n       tpu_topology_extension_(pjrt::FindExtension<PJRT_TpuTopology_Extension>(\n           c_api, PJRT_Extension_Type::PJRT_Extension_Type_TpuTopology)),\n       c_topology_(c_topology),\n+      platform_version_(absl::StrCat(\n+          \"PJRT C API\\n\", ::pjrt::GetPlatformVersion(c_topology, c_api))),\n       platform_name_(::pjrt::PlatformName(c_api, c_topology)),\n       platform_id_(tsl::Fingerprint64(platform_name_)) {\n   if (owned) {\n@@ -3363,13 +3365,7 @@ PjRtCApiTopologyDescription::PjRtCApiTopologyDescription(\n }\n \n absl::string_view PjRtCApiTopologyDescription::platform_version() const {\n-  PJRT_TopologyDescription_PlatformVersion_Args args;\n-  args.struct_size = PJRT_TopologyDescription_PlatformVersion_Args_STRUCT_SIZE;\n-  args.extension_start = nullptr;\n-  args.topology = c_topology_;\n-  pjrt::LogFatalIfPjrtError(\n-      c_api_->PJRT_TopologyDescription_PlatformVersion(&args), c_api_);\n-  return absl::string_view(args.platform_version, args.platform_version_size);\n+  return platform_version_;\n }\n \n std::vector<std::unique_ptr<const PjRtDeviceDescription>>"
        },
        {
            "sha": "24e781396cefbee152b1e337155de307b072ab1c",
            "filename": "third_party/xla/xla/pjrt/c_api_client/pjrt_c_api_client.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ee3e4e37bea35192119cc7c72633028024e5b7e1/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc_api_client%2Fpjrt_c_api_client.h?ref=ee3e4e37bea35192119cc7c72633028024e5b7e1",
            "patch": "@@ -313,6 +313,7 @@ class PjRtCApiTopologyDescription : public PjRtTopologyDescription {\n   // Device specific attributes with corresponding values.\n   absl::flat_hash_map<std::string, xla::PjRtDeviceAttribute> attributes_;\n \n+  const std::string platform_version_;\n   const std::string platform_name_;\n   const PjRtPlatformId platform_id_;\n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 17,
        "deletions": 7
    }
}