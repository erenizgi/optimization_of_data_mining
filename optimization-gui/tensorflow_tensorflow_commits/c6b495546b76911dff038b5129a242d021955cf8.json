{
    "author": "mwhittaker",
    "message": "Adds some VLOGs to help debug.\n\nPiperOrigin-RevId: 815957122",
    "sha": "c6b495546b76911dff038b5129a242d021955cf8",
    "files": [
        {
            "sha": "3a075e3e8dc70368a7ceb4f7b2673946ea023603",
            "filename": "third_party/xla/xla/backends/gpu/collectives/gpu_cliques.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/c6b495546b76911dff038b5129a242d021955cf8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2Fgpu_cliques.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/c6b495546b76911dff038b5129a242d021955cf8/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2Fgpu_cliques.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcollectives%2Fgpu_cliques.cc?ref=c6b495546b76911dff038b5129a242d021955cf8",
            "patch": "@@ -342,11 +342,15 @@ InitializeGpuClique(GpuCollectives* collectives, se::StreamExecutor* device,\n \n     ProcessGpuCliques& cliques = GetProcessGpuCliques();\n     {\n+      VLOG(5) << \"Locking cliques.mu\";\n       absl::MutexLock lock(cliques.mu);\n+      VLOG(5) << \"Checking clique key \" << clique_key.ToString()\n+              << \" for staleness\";\n       TF_RETURN_IF_ERROR(\n           CheckCliqueKeyIsntStale(cliques.task_state_infos, clique_key));\n     }\n \n+    VLOG(5) << \"Creating communicators\";\n     TF_ASSIGN_OR_RETURN(\n         std::vector<std::unique_ptr<Communicator>> created_comms,\n         collectives->CreateCommunicators(clique_key, clique_ids, ranks,\n@@ -363,6 +367,7 @@ InitializeGpuClique(GpuCollectives* collectives, se::StreamExecutor* device,\n         clique_key.ToString(), DeviceRanksToString(ranks), nroots,\n         clique_ids.fingerprint(), peer_access_enabled);\n \n+    VLOG(5) << \"Locking cliques.mu\";\n     absl::MutexLock lock(cliques.mu);\n     if (absl::Status s =\n             CheckCliqueKeyIsntStale(cliques.task_state_infos, clique_key);\n@@ -531,11 +536,15 @@ InitializeGpuClique(GpuCollectives* collectives, se::StreamExecutor* device,\n \n     ProcessGpuCliques& cliques = GetProcessGpuCliques();\n     {\n+      VLOG(5) << \"Locking cliques.mu\";\n       absl::MutexLock lock(cliques.mu);\n+      VLOG(5) << \"Checking clique key \" << clique_key.ToString()\n+              << \" for staleness\";\n       TF_RETURN_IF_ERROR(\n           CheckCliqueKeyIsntStale(cliques.task_state_infos, clique_key));\n     }\n \n+    VLOG(5) << \"Splitting communicators\";\n     TF_ASSIGN_OR_RETURN(\n         auto splitted_comms,\n         collectives->SplitCommunicators(parent_comms, color, keys, config));\n@@ -553,6 +562,7 @@ InitializeGpuClique(GpuCollectives* collectives, se::StreamExecutor* device,\n         peer_access_enabled,\n         absl::StrJoin(rank_mapping, \",\", rank_mapping_formatter));\n \n+    VLOG(5) << \"Locking cliques.mu\";\n     absl::MutexLock lock(cliques.mu);\n     if (absl::Status s =\n             CheckCliqueKeyIsntStale(cliques.task_state_infos, clique_key);"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 10,
        "deletions": 0
    }
}