{
    "author": "tensorflower-gardener",
    "message": "Merge pull request #99904 from Ma-gi-cian:fix-int16-argmax\n\nPiperOrigin-RevId: 810047001",
    "sha": "2584b2c4daf7d1b58c6e8925eaf447ecbe59f175",
    "files": [
        {
            "sha": "ecbfa11ae9ee09e7b1f5506b945320c8ac5e09d9",
            "filename": "tensorflow/python/ops/math_ops.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2584b2c4daf7d1b58c6e8925eaf447ecbe59f175/tensorflow%2Fpython%2Fops%2Fmath_ops.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2584b2c4daf7d1b58c6e8925eaf447ecbe59f175/tensorflow%2Fpython%2Fops%2Fmath_ops.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fops%2Fmath_ops.py?ref=2584b2c4daf7d1b58c6e8925eaf447ecbe59f175",
            "patch": "@@ -298,6 +298,22 @@ def argmax_v2(input, axis=None, output_type=dtypes.int64, name=None):\n   \"\"\"\n   if axis is None:\n     axis = 0\n+\n+  if hasattr(axis, \"dtype\"):\n+    if axis.dtype not in (\n+        dtypes.int8,\n+        dtypes.uint8,\n+        dtypes.int16,\n+        dtypes.uint16,\n+        dtypes.int32,\n+        dtypes.int64,\n+    ):\n+      raise TypeError(f\"axis tensor dtypes {axis.dtype} is not supported\")\n+    if axis.dtype in (dtypes.int8, dtypes.int16, dtypes.uint8, dtypes.uint16):\n+      axis = cast(axis, dtypes.int32)\n+  elif not isinstance(axis, int):\n+    raise TypeError(f\"axis must be int or Tensor with integer datatype\")\n+\n   return gen_math_ops.arg_max(input, axis, name=name, output_type=output_type)\n \n "
        },
        {
            "sha": "4395ec5e8f87a1b86f7b93089425c3948ec2384e",
            "filename": "tensorflow/python/ops/math_ops_test.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2584b2c4daf7d1b58c6e8925eaf447ecbe59f175/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2584b2c4daf7d1b58c6e8925eaf447ecbe59f175/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2Fops%2Fmath_ops_test.py?ref=2584b2c4daf7d1b58c6e8925eaf447ecbe59f175",
            "patch": "@@ -1427,6 +1427,19 @@ def testArgMaxUint16(self):\n             tf_values, axis=axis, output_type=dtypes.uint16)\n         self.assertAllEqual(tf_max, np_max)\n \n+  def testArgMaxInt16(self):\n+    shape = (24, 8)\n+    tf_values = self._generateRandomTensor(dtypes.int16, shape)\n+    np_values = self.evaluate(tf_values)\n+    for axis in range(0, len(shape)):\n+      np_max = np.argmax(np_values, axis=axis)\n+      tf_max = math_ops.argmax(\n+          tf_values,\n+          axis=constant_op.constant(axis, dtype=dtypes.int16),\n+          output_type=dtypes.int32,\n+      )\n+      self.assertAllEqual(tf_max, np_max)\n+\n   def testArgMin(self):\n     shape = (24, 8)\n     for dtype in self._getValidDtypes():"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 29,
        "deletions": 0
    }
}