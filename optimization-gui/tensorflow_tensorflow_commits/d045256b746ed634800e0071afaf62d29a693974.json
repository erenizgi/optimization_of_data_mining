{
    "author": "akuegel",
    "message": "[XLA:GPU] Simplify kernel registration.\n\nWe don't need the lambda, and we can directly return KernelLoaderSpec instead\nof StatusOr<KernelLoaderSpec>.\n\nPiperOrigin-RevId: 828911176",
    "sha": "d045256b746ed634800e0071afaf62d29a693974",
    "files": [
        {
            "sha": "d1f94f1dec0111b6871d699ff76d3dfddb9114ff",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_nan_count_kernel_cuda.cu.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d045256b746ed634800e0071afaf62d29a693974/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_nan_count_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d045256b746ed634800e0071afaf62d29a693974/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_nan_count_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_nan_count_kernel_cuda.cu.cc?ref=d045256b746ed634800e0071afaf62d29a693974",
            "patch": "@@ -195,28 +195,24 @@ __global__ void AppendNanCount(xla::gpu::BufferDebugLogEntryId entry_id,\n   }\n }\n \n-absl::StatusOr<se::KernelLoaderSpec> GetNanCountF32KernelSpec() {\n+se::KernelLoaderSpec GetNanCountF32KernelSpec(int arity) {\n   return se::KernelLoaderSpec::CreateInProcessSymbolSpec(\n       absl::bit_cast<void*>(&AppendNanCount<float>),\n-      \"BufferDebugNanCountF32Kernel\",\n-      /*arity=*/5);\n+      \"BufferDebugNanCountF32Kernel\", arity);\n }\n \n-absl::StatusOr<se::KernelLoaderSpec> GetNanCountBf16KernelSpec() {\n+se::KernelLoaderSpec GetNanCountBf16KernelSpec(int arity) {\n   return se::KernelLoaderSpec::CreateInProcessSymbolSpec(\n       absl::bit_cast<void*>(&AppendNanCount<__nv_bfloat16>),\n-      \"BufferDebugNanCountBf16Kernel\",\n-      /*arity=*/5);\n+      \"BufferDebugNanCountBf16Kernel\", arity);\n }\n \n }  // namespace\n \n GPU_KERNEL_REGISTRY_REGISTER_KERNEL_STATICALLY(\n     BufferDebugNanCountF32Kernel, se::gpu::BufferDebugNanCountF32Kernel,\n-    se::cuda::kCudaPlatformId,\n-    ([](size_t _arity) { return GetNanCountF32KernelSpec().value(); }));\n+    se::cuda::kCudaPlatformId, GetNanCountF32KernelSpec);\n \n GPU_KERNEL_REGISTRY_REGISTER_KERNEL_STATICALLY(\n     BufferDebugNanCountBf16Kernel, se::gpu::BufferDebugNanCountBf16Kernel,\n-    se::cuda::kCudaPlatformId,\n-    ([](size_t _arity) { return GetNanCountBf16KernelSpec().value(); }));\n+    se::cuda::kCudaPlatformId, GetNanCountBf16KernelSpec);"
        },
        {
            "sha": "d72ce4ffdc92a986bf00b17f15c2428a17d5edf3",
            "filename": "third_party/xla/xla/stream_executor/cuda/buffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d045256b746ed634800e0071afaf62d29a693974/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d045256b746ed634800e0071afaf62d29a693974/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fcuda%2Fbuffer_debug_xor_checksum_kernel_cuda.cu.cc?ref=d045256b746ed634800e0071afaf62d29a693974",
            "patch": "@@ -195,15 +195,14 @@ __global__ void AppendChecksum(xla::gpu::BufferDebugLogEntryId entry_id,\n   }\n }\n \n-absl::StatusOr<se::KernelLoaderSpec> GetChecksumKernelSpec() {\n+se::KernelLoaderSpec GetChecksumKernelSpec(int arity) {\n   return se::KernelLoaderSpec::CreateInProcessSymbolSpec(\n       absl::bit_cast<void*>(&AppendChecksum), \"BufferDebugXorChecksumKernel\",\n-      /*arity=*/5);\n+      arity);\n }\n \n }  // namespace\n \n GPU_KERNEL_REGISTRY_REGISTER_KERNEL_STATICALLY(\n     BufferDebugXorChecksumKernel, se::gpu::BufferDebugXorChecksumKernel,\n-    se::cuda::kCudaPlatformId,\n-    ([](size_t _arity) { return GetChecksumKernelSpec().value(); }));\n+    se::cuda::kCudaPlatformId, GetChecksumKernelSpec);"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 9,
        "deletions": 14
    }
}