{
    "author": "tensorflower-gardener",
    "message": "Introduce `xla::ifrt::LoadedExecutable::GetHumanReadableProgramText()`.\n\n`jax._src.stages.Executable.as_text()` currently asks `LoadedExecutable` for HLO modules, and returns their text representation to the user. An upcoming change will switch `as_text()` to call `GetHumanReadableProgramText()` instead, allowing IFRT implementations to customize the text returned.\n\nPiperOrigin-RevId: 815986149",
    "sha": "3abd0a918876fd94004322cdc86a49f34db92068",
    "files": [
        {
            "sha": "e816203685cd554a5729fb8856666fbf6710a0f3",
            "filename": "third_party/xla/xla/backends/cpu/nanort/ifrt_client.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fnanort%2Fifrt_client.cc?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -916,6 +916,13 @@ class NanoExecutable final\n     return absl::UnimplementedError(\"Serialize is not implemented.\");\n   }\n \n+  absl::StatusOr<std::string> GetHumanReadableProgramText() const override {\n+    TF_ASSIGN_OR_RETURN(\n+        auto hlo_module,\n+        HloModule::CreateFromProto(program_.proto(), HloModuleConfig()));\n+    return hlo_module->ToString();\n+  }\n+\n   ifrt::UserContextRef user_context() const override { return user_context_; }\n \n   tsl::Future<> GetReadyFuture() const override { return Ready(); }"
        },
        {
            "sha": "53b12fd279b92a100d4d2b13faabc0157697631d",
            "filename": "third_party/xla/xla/python/ifrt/executable.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fexecutable.h?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -177,6 +177,11 @@ class LoadedExecutable\n   // serialized executable is implementation-specific.\n   virtual absl::StatusOr<std::string> Serialize() const = 0;\n \n+  // Returns the program text in a format that can be used for easy debugging.\n+  // The return value is meant to be consumed only by humans (not automated\n+  // parsing), since there are no guarantees on how the value is formatted.\n+  virtual absl::StatusOr<std::string> GetHumanReadableProgramText() const = 0;\n+\n   // Returns the user context associated with the creation of this executable.\n   // May be `nullptr` if the user context is unset or the runtime does not\n   // support it."
        },
        {
            "sha": "e4c12253de94eea6c7767b4ed1a72f629d3ba074",
            "filename": "third_party/xla/xla/python/ifrt/mock.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Fmock.h?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -331,6 +331,8 @@ class MockLoadedExecutable\n   MOCK_METHOD(absl::StatusOr<std::unique_ptr<xla::ifrt::ExecutableVersion>>,\n               executable_version, (), (const, final));\n   MOCK_METHOD(absl::StatusOr<std::string>, Serialize, (), (const, final));\n+  MOCK_METHOD(absl::StatusOr<std::string>, GetHumanReadableProgramText, (),\n+              (const, final));\n   MOCK_METHOD(UserContextRef, user_context, (), (const, final));\n   MOCK_METHOD(tsl::Future<>, GetReadyFuture, (), (const, override));\n   MOCK_METHOD(int, num_devices, (), (const, final));"
        },
        {
            "sha": "52de938c0e86380fb1b675dc4eff1c74ff78012c",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -530,6 +530,12 @@ absl::StatusOr<std::string> LoadedExecutable::Serialize() const {\n       \"underlying serialization format is not stable\");\n }\n \n+absl::StatusOr<std::string> LoadedExecutable::GetHumanReadableProgramText()\n+    const {\n+  return absl::UnimplementedError(\n+      \"GetHumanReadableProgramText() is unimplemented.\");\n+}\n+\n tsl::Future<> LoadedExecutable::GetReadyFuture() const { return ready_future_; }\n \n int LoadedExecutable::num_devices() const { return num_devices_; }"
        },
        {
            "sha": "5fee0e75362fa8c2beb848d3291821a0a115e00f",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -77,6 +77,7 @@ class LoadedExecutable final\n     return absl::UnimplementedError(\"Not implemented\");\n   }\n   absl::StatusOr<std::string> Serialize() const override;\n+  absl::StatusOr<std::string> GetHumanReadableProgramText() const override;\n   xla::ifrt::UserContextRef user_context() const override {\n     return user_context_;\n   }"
        },
        {
            "sha": "4f8be95fa40473817832167f0c985653f98ab222",
            "filename": "third_party/xla/xla/python/pjrt_ifrt/pjrt_executable.h",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_executable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3abd0a918876fd94004322cdc86a49f34db92068/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_executable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fpjrt_ifrt%2Fpjrt_executable.h?ref=3abd0a918876fd94004322cdc86a49f34db92068",
            "patch": "@@ -26,6 +26,7 @@ limitations under the License.\n #include \"absl/container/flat_hash_map.h\"\n #include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_join.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n #include \"llvm/Support/ExtensibleRTTI.h\"\n@@ -268,6 +269,15 @@ class PjRtLoadedExecutable final\n \n   absl::StatusOr<std::string> Serialize() const override;\n \n+  absl::StatusOr<std::string> GetHumanReadableProgramText() const override {\n+    TF_ASSIGN_OR_RETURN(auto hlo_modules,\n+                        pjrt_loaded_executable_->GetHloModules());\n+    return absl::StrJoin(hlo_modules, \"\\n\\n\",\n+                         [](std::string* out, const auto& hlo_module) {\n+                           absl::StrAppend(out, hlo_module->ToString());\n+                         });\n+  }\n+\n   int num_devices() const override {\n     DCHECK(this);\n     return pjrt_loaded_executable_->num_replicas() *"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 31,
        "deletions": 0
    }
}