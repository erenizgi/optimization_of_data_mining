{
    "author": "beckerhe",
    "message": "Sort dumped execution files before checking.\n\nThe order of files returned by `GetMatchingPaths` is not guaranteed, so sorting ensures deterministic test behavior and should get rid of the flakyness of the test.\n\nAlso a tiny assertion cleanup for better error messages.\n\nPiperOrigin-RevId: 817564449",
    "sha": "fb63bc5217e74b69211ae897c3d9a84fdf8f7566",
    "files": [
        {
            "sha": "482973ee5cef99e9b5be7ad5f255dafc4aeff1c2",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fb63bc5217e74b69211ae897c3d9a84fdf8f7566/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fb63bc5217e74b69211ae897c3d9a84fdf8f7566/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=fb63bc5217e74b69211ae897c3d9a84fdf8f7566",
            "patch": "@@ -572,6 +572,7 @@ xla_cc_test(\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/testing:temporary_directory\",\n         \"//xla/tsl/util/proto:proto_matchers\",\n+        \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest\",\n         \"@com_google_protobuf//:protobuf\","
        },
        {
            "sha": "2950453ea4f8079ff4284d7ff6139539ccd4d979",
            "filename": "third_party/xla/xla/service/dump_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fb63bc5217e74b69211ae897c3d9a84fdf8f7566/third_party%2Fxla%2Fxla%2Fservice%2Fdump_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fb63bc5217e74b69211ae897c3d9a84fdf8f7566/third_party%2Fxla%2Fxla%2Fservice%2Fdump_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fdump_test.cc?ref=fb63bc5217e74b69211ae897c3d9a84fdf8f7566",
            "patch": "@@ -23,6 +23,7 @@ limitations under the License.\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/algorithm/container.h\"\n #include \"absl/strings/match.h\"\n #include \"absl/strings/numbers.h\"\n #include \"google/protobuf/text_format.h\"\n@@ -48,9 +49,9 @@ limitations under the License.\n namespace xla {\n namespace {\n \n+using ::testing::ElementsAre;\n using ::testing::HasSubstr;\n using ::testing::IsEmpty;\n-using ::testing::SizeIs;\n using ::tsl::proto_testing::EqualsProto;\n \n TEST(DumpHloIfEnabled, LargeConstantElided) {\n@@ -521,9 +522,10 @@ TEST(DumpTest, DumpPerExecutionProtoToFile) {\n   TF_ASSERT_OK(tsl::Env::Default()->GetMatchingPaths(\n       tsl::io::JoinPath(dump_folder.path(), \"*test_name*execution_*\"),\n       &matches));\n-  ASSERT_THAT(matches, SizeIs(2));\n-  EXPECT_THAT(matches[0], HasSubstr(\"execution_0000\"));\n-  EXPECT_THAT(matches[1], HasSubstr(\"execution_0001\"));\n+  // The output of GetMatchingPaths is not stable, therefore we sort the vector.\n+  absl::c_sort(matches);\n+  ASSERT_THAT(matches, ElementsAre(HasSubstr(\"execution_0000\"),\n+                                   HasSubstr(\"execution_0001\")));\n \n   HloModuleProto loaded_proto1;\n   HloModuleProto loaded_proto2;"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}