{
    "author": "GleasonK",
    "message": "[MHLO] Add StableHLO passes to mlir-hlo-opt\n\nPiperOrigin-RevId: 811500263",
    "sha": "43c459986bd48cf9482e8274edbce6e192e3757b",
    "files": [
        {
            "sha": "10363f6714738b2df4d1b9ea883fdca92fb4d161",
            "filename": "third_party/xla/xla/mlir_hlo/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2FBUILD?ref=43c459986bd48cf9482e8274edbce6e192e3757b",
            "patch": "@@ -930,7 +930,10 @@ cc_binary(\n         \"@llvm-project//mlir:RegisterAllPasses\",\n         \"@llvm-project//mlir:Support\",\n         \"@shardy//shardy/dialect/sdy/ir:dialect\",\n+        \"@stablehlo//:linalg_passes\",\n         \"@stablehlo//:register\",\n+        \"@stablehlo//:stablehlo_passes\",\n+        \"@stablehlo//:stablehlo_passes_optimization\",\n     ],\n )\n "
        },
        {
            "sha": "f45333380bd972800c4ad580034441c3e055a354",
            "filename": "third_party/xla/xla/mlir_hlo/tools/mlir-hlo-opt/CMakeLists.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2FCMakeLists.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2FCMakeLists.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2FCMakeLists.txt?ref=43c459986bd48cf9482e8274edbce6e192e3757b",
            "patch": "@@ -27,6 +27,8 @@ set(LIBS\n         MLIRBufferTransforms\n         MLIRHLOGPUTransforms\n         MhloRegisterDialects\n+        StablehloLinalgTransforms\n+        StablehloPasses\n         )\n add_llvm_executable(mlir-hlo-opt mlir-hlo-opt.cc\n   DEPENDS"
        },
        {
            "sha": "f75442c8a5c3381c4ee628684a57ae12d190c074",
            "filename": "third_party/xla/xla/mlir_hlo/tools/mlir-hlo-opt/mlir-hlo-opt.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2Fmlir-hlo-opt.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/43c459986bd48cf9482e8274edbce6e192e3757b/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2Fmlir-hlo-opt.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fmlir_hlo%2Ftools%2Fmlir-hlo-opt%2Fmlir-hlo-opt.cc?ref=43c459986bd48cf9482e8274edbce6e192e3757b",
            "patch": "@@ -21,7 +21,10 @@ limitations under the License.\n #include \"mlir/InitAllPasses.h\"\n #include \"mlir/Tools/mlir-opt/MlirOptMain.h\"\n #include \"shardy/dialect/sdy/ir/dialect.h\"\n+#include \"stablehlo/conversions/linalg/transforms/Passes.h\"\n #include \"stablehlo/dialect/Register.h\"\n+#include \"stablehlo/transforms/Passes.h\"\n+#include \"stablehlo/transforms/optimization/Passes.h\"\n #include \"stablehlo_ext/transforms/passes.h\"\n #include \"transforms/gpu_passes.h\"\n #include \"transforms/passes.h\"\n@@ -40,7 +43,14 @@ int main(int argc, char** argv) {\n   registerAllDialects(registry);\n   registerAllExtensions(registry);\n   mhlo::registerAllMhloDialects(registry);\n+\n+  // Register StableHLO & Passes\n   stablehlo::registerAllDialects(registry);\n+  mlir::stablehlo::registerPassPipelines();\n+  mlir::stablehlo::registerPasses();\n+  mlir::stablehlo::registerOptimizationPasses();\n+  mlir::stablehlo::registerStablehloLinalgTransformsPasses();\n+\n   registry.insert<mlir::sdy::SdyDialect>();\n   return failed(MlirOptMain(argc, argv, \"MLIR HLO pass driver\\n\", registry));\n }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
    }
}