{
    "author": "beckerhe",
    "message": "Introduce KernelArgsPackedVector\n\n`KernelArgsPackedVector` implements `KernelArgsPackedArrayBase` and represents a set of parameters that can be used to launch a GPU kernel.\n\nIn contrast to `KernelArgsPackedArray`, `KernelArgsPackedVector` models storage in a `std::vector` and therefore the number of arguments is dynamic.\n\nPiperOrigin-RevId: 828977455",
    "sha": "b6f3e978cadac982b58087e8ee6adb3db9f58aaa",
    "files": [
        {
            "sha": "c3739a41c3a3fbad26c90aef2467878a7bc11bdc",
            "filename": "third_party/xla/xla/stream_executor/BUILD",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2FBUILD?ref=b6f3e978cadac982b58087e8ee6adb3db9f58aaa",
            "patch": "@@ -614,6 +614,26 @@ cc_library(\n     ],\n )\n \n+cc_library(\n+    name = \"kernel_args_packed_vector\",\n+    hdrs = [\"kernel_args_packed_vector.h\"],\n+    deps = [\n+        \":kernel\",\n+        \"@com_google_absl//absl/types:span\",\n+    ],\n+)\n+\n+xla_cc_test(\n+    name = \"kernel_args_packed_vector_test\",\n+    srcs = [\"kernel_args_packed_vector_test.cc\"],\n+    deps = [\n+        \":kernel_args_packed_vector\",\n+        \"@com_google_absl//absl/base\",\n+        \"@com_google_absl//absl/types:span\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)\n+\n cc_library(\n     name = \"semantic_version\",\n     srcs = [\"semantic_version.cc\"],"
        },
        {
            "sha": "2c2075d8c532d1e77777fef03c8fc3fe17f7a0b8",
            "filename": "third_party/xla/xla/stream_executor/kernel_args_packed_vector.h",
            "status": "added",
            "additions": 63,
            "deletions": 0,
            "changes": 63,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector.h?ref=b6f3e978cadac982b58087e8ee6adb3db9f58aaa",
            "patch": "@@ -0,0 +1,63 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef XLA_STREAM_EXECUTOR_KERNEL_ARGS_PACKED_VECTOR_H_\n+#define XLA_STREAM_EXECUTOR_KERNEL_ARGS_PACKED_VECTOR_H_\n+\n+#include <cstddef>\n+#include <cstdint>\n+#include <utility>\n+#include <vector>\n+\n+#include \"absl/types/span.h\"\n+#include \"xla/stream_executor/kernel.h\"\n+\n+namespace stream_executor {\n+\n+// An array of arguments for a kernel call, where each argument is stored in a\n+// separate vector. The storage is owned by the KernelArgsPackedVector.\n+class KernelArgsPackedVector : public KernelArgsPackedArrayBase {\n+ public:\n+  KernelArgsPackedVector(std::vector<std::vector<char>> arguments,\n+                         size_t shared_memory_bytes)\n+      : argument_storage_(std::move(arguments)),\n+        shared_memory_bytes_(shared_memory_bytes) {\n+    argument_addresses_.reserve(argument_storage_.size());\n+    for (std::vector<char>& argument : argument_storage_) {\n+      argument_addresses_.push_back(argument.data());\n+    }\n+  }\n+\n+  size_t number_of_arguments() const final { return argument_storage_.size(); }\n+\n+  // Returns the number of bytes that need to be allocated in shared memory for\n+  // this kernel. This value is treated like an additional argument in the CUDA\n+  // kernel launch API, therefore we pass it alongside the real kernel arguments\n+  // here.\n+  uint64_t number_of_shared_bytes() const final { return shared_memory_bytes_; }\n+\n+  absl::Span<const void* const> argument_addresses() const final {\n+    return argument_addresses_;\n+  }\n+\n+ private:\n+  std::vector<std::vector<char>> argument_storage_;\n+  size_t shared_memory_bytes_ = 0;\n+  std::vector<const void*> argument_addresses_;\n+};\n+\n+}  // namespace stream_executor\n+\n+#endif  // XLA_STREAM_EXECUTOR_KERNEL_ARGS_PACKED_VECTOR_H_"
        },
        {
            "sha": "d790affee7bb61bb4cb671d8535950615751e434",
            "filename": "third_party/xla/xla/stream_executor/kernel_args_packed_vector_test.cc",
            "status": "added",
            "additions": 68,
            "deletions": 0,
            "changes": 68,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b6f3e978cadac982b58087e8ee6adb3db9f58aaa/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fkernel_args_packed_vector_test.cc?ref=b6f3e978cadac982b58087e8ee6adb3db9f58aaa",
            "patch": "@@ -0,0 +1,68 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/stream_executor/kernel_args_packed_vector.h\"\n+\n+#include <utility>\n+#include <vector>\n+\n+#include <gmock/gmock.h>\n+#include <gtest/gtest.h>\n+#include \"absl/base/casts.h\"\n+#include \"absl/types/span.h\"\n+\n+namespace stream_executor {\n+namespace {\n+using ::testing::Each;\n+using ::testing::ElementsAre;\n+using ::testing::Ne;\n+using ::testing::SizeIs;\n+\n+TEST(KernelArgsPackedVectorTest, StoresSharedMemoryBytes) {\n+  KernelArgsPackedVector args(std::vector<std::vector<char>>(),\n+                              /*shared_memory_bytes=*/42);\n+  EXPECT_EQ(args.number_of_shared_bytes(), 42);\n+}\n+\n+TEST(KernelArgsPackedVectorTest, StoresArgumentAddresses) {\n+  KernelArgsPackedVector args = []() {\n+    std::vector<std::vector<char>> storage;\n+    storage.push_back(std::vector<char>({10}));\n+    storage.push_back(std::vector<char>({20, 21}));\n+    storage.push_back(std::vector<char>({30, 31, 32}));\n+    return KernelArgsPackedVector(std::move(storage),\n+                                  /*shared_memory_bytes=*/0);\n+  }();\n+\n+  EXPECT_EQ(args.number_of_arguments(), 3);\n+  ASSERT_THAT(args.argument_addresses(), SizeIs(3));\n+  ASSERT_THAT(args.argument_addresses(), Each(Ne(nullptr)));\n+\n+  EXPECT_THAT(\n+      absl::Span<const char>(\n+          absl::bit_cast<const char*>(args.argument_addresses().at(0)), 1),\n+      ElementsAre(10));\n+  EXPECT_THAT(\n+      absl::Span<const char>(\n+          absl::bit_cast<const char*>(args.argument_addresses().at(1)), 2),\n+      ElementsAre(20, 21));\n+  EXPECT_THAT(\n+      absl::Span<const char>(\n+          absl::bit_cast<const char*>(args.argument_addresses().at(2)), 3),\n+      ElementsAre(30, 31, 32));\n+}\n+\n+}  // namespace\n+}  // namespace stream_executor"
        }
    ],
    "stats": {
        "total": 151,
        "additions": 151,
        "deletions": 0
    }
}