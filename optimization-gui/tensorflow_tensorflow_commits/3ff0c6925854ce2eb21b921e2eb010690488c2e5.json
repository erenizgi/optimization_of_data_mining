{
    "author": "ghpvnist",
    "message": "Add utility methods for `mlir::ElementType`.\n\nOften times we have to check whether dtype is of a certain kind (bool, integral, float, complex), and we've been hard-coding the dtypes which is error prone. This change adds utility methods for checking and comparing dtypes.\n\nPiperOrigin-RevId: 816505052",
    "sha": "3ff0c6925854ce2eb21b921e2eb010690488c2e5",
    "files": [
        {
            "sha": "e2b05501fd81a3f58043a4ceec1ae805229472f8",
            "filename": "third_party/xla/third_party/stablehlo/temporary.patch",
            "status": "modified",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/3ff0c6925854ce2eb21b921e2eb010690488c2e5/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/3ff0c6925854ce2eb21b921e2eb010690488c2e5/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fstablehlo%2Ftemporary.patch?ref=3ff0c6925854ce2eb21b921e2eb010690488c2e5",
            "patch": "@@ -537,6 +537,86 @@ diff --ruN a/stablehlo/stablehlo/conversions/tosa/transforms/StablehloQuantLegal\n    // unary ops\n    patterns->addWithLabel<QuantizedStablehloOpConversion<stablehlo::AbsOp>>(\n        {\"StablehloQuantAbsOp\"}, context);\n+diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.cpp b/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.cpp\n+--- stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.cpp\n++++ stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.cpp\n+@@ -110,6 +110,44 @@\n+   }\n+ }\n+ \n++bool IsBoolean(ElementType elementType) {\n++  MLIRContext ctx;\n++  return getElementType(ctx, elementType).isInteger(1);\n++}\n++\n++bool IsComplex(ElementType elementType) {\n++  MLIRContext ctx;\n++  auto type = dyn_cast<ComplexType>(getElementType(ctx, elementType));\n++  return !!type;\n++}\n++\n++bool IsFloat(ElementType elementType) {\n++  MLIRContext ctx;\n++  return getElementType(ctx, elementType).isFloat();\n++}\n++\n++bool IsInteger(ElementType elementType, bool includeBool = false) {\n++  MLIRContext ctx;\n++  Type type = getElementType(ctx, elementType);\n++  return type.isInteger() && includeBool ? IsBoolean(elementType)\n++                                         : !IsBoolean(elementType);\n++}\n++\n++bool IsSignedInteger(ElementType elementType) {\n++  MLIRContext ctx;\n++  Type type = getElementType(ctx, elementType);\n++\n++  // Note that this is not the same as `type.isSignedInteger()`. Signed integers\n++  // are not used in StableHLO.\n++  return type.isSignlessInteger() && !IsBoolean(elementType);\n++}\n++\n++bool IsUnsignedInteger(ElementType elementType) {\n++  MLIRContext ctx;\n++  return getElementType(ctx, elementType).isUnsignedInteger() &&\n++         !IsBoolean(elementType);\n++}\n++\n+ RankedTensorType makeTensorType(MLIRContext& ctx, ArrayRef<int64_t> shape,\n+                                 ElementType elementType) {\n+   return makeTensorType(ctx, shape, getElementType(ctx, elementType));\n+diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.h b/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.h\n+--- stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.h\n++++ stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtil.h\n+@@ -18,7 +18,6 @@\n+ \n+ #include <complex>\n+ #include <cstdint>\n+-#include <source_location>\n+ #include <type_traits>\n+ #include <vector>\n+ \n+@@ -68,6 +67,20 @@\n+   // clang-format on\n+ };\n+ \n++bool IsBoolean(ElementType elementType);\n++\n++bool IsComplex(ElementType elementType);\n++\n++bool IsFloat(ElementType elementType);\n++\n++bool IsInteger(ElementType elementType, bool includeBool);\n++\n++// In StableHLO, we refer to signed integer as the MLIR's equvalent signless\n++// integer. StableHLO does not have a notion of signless integers like MLIR.\n++bool IsSignedInteger(ElementType elementType);\n++\n++bool IsUnsignedInteger(ElementType elementType);\n++\n+ Type getElementType(MLIRContext& ctx, ElementType elementType);\n+ \n+ // Build a ranked tensor type with an element type of ElementType.\n diff --ruN a/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtilTest.cpp b/stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtilTest.cpp\n --- stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtilTest.cpp\n +++ stablehlo/stablehlo/integrations/cpp/builder/AttrTypeBuilderUtilTest.cpp"
        }
    ],
    "stats": {
        "total": 80,
        "additions": 80,
        "deletions": 0
    }
}