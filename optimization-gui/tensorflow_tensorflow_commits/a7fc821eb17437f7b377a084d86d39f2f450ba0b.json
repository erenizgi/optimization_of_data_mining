{
    "author": "quoctruong",
    "message": "Reverts 39e05ea1fb0f6dfc978abd33859b25572b802a2a\n\nPiperOrigin-RevId: 815778083",
    "sha": "a7fc821eb17437f7b377a084d86d39f2f450ba0b",
    "files": [
        {
            "sha": "d12c886cc6d57a87da4880949cb688a9592e82db",
            "filename": "ci/official/containers/ml_build/Dockerfile",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2FDockerfile?ref=a7fc821eb17437f7b377a084d86d39f2f450ba0b",
            "patch": "@@ -12,6 +12,14 @@ COPY builder.packages.txt /builder.packages.txt\n \n RUN /setup.sources.sh && /setup.packages.sh /builder.packages.txt\n \n+# Install devtoolset-9 in /dt9 with glibc 2.17 and libstdc++ 4.8, for building\n+# manylinux2014-compatible packages.\n+COPY builder.devtoolset/fixlinks.sh /fixlinks.sh\n+COPY builder.devtoolset/rpm-patch.sh /rpm-patch.sh\n+COPY builder.devtoolset/build_devtoolset.sh /build_devtoolset.sh\n+COPY builder.devtoolset/glibc2.17-inline.patch /glibc2.17-inline.patch\n+RUN /build_devtoolset.sh devtoolset-9 /dt9\n+\n # Setup Python\n COPY setup.python.sh /setup.python.sh\n COPY builder.requirements.txt /builder.requirements.txt"
        },
        {
            "sha": "8dbbf4196440dacafc656c39e5f61b001c6e8e9f",
            "filename": "ci/official/containers/ml_build/builder.packages.txt",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2Fbuilder.packages.txt?ref=a7fc821eb17437f7b377a084d86d39f2f450ba0b",
            "patch": "@@ -1,9 +1,28 @@\n+# Packages to be installed for the new Docker image.\n+\n+# Packages needed to build devtoolset\n+file\n+flex\n+g++\n+make\n+patch\n+rpm2cpio\n+unar\n+wget\n+xz-utils\n+cpio\n+\n # Other build-related tools\n apt-transport-https\n autoconf\n automake\n build-essential\n ca-certificates\n+llvm-18\n+clang-18\n+clang-tidy-18\n+lld-18\n+clang-format-12\n curl\n git\n parallel\n@@ -13,5 +32,4 @@ unzip\n zip\n openjdk-21-jdk\n vim\n-wget\n jq"
        },
        {
            "sha": "cd56f3ca552d0f7e5c1b34c6c715585926d5b7a6",
            "filename": "ci/official/containers/ml_build/setup.python.sh",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a7fc821eb17437f7b377a084d86d39f2f450ba0b/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/ci%2Fofficial%2Fcontainers%2Fml_build%2Fsetup.python.sh?ref=a7fc821eb17437f7b377a084d86d39f2f450ba0b",
            "patch": "@@ -45,6 +45,16 @@ fi\n \n /setup.packages.sh pythons.txt\n \n+# Re-link pyconfig.h from x86_64-linux-gnu into the devtoolset directory\n+# for any Python version present\n+pushd /usr/include/x86_64-linux-gnu\n+for f in $(ls | grep python); do\n+  # set up symlink for devtoolset-9\n+  rm -f /dt9/usr/include/x86_64-linux-gnu/$f\n+  ln -s /usr/include/x86_64-linux-gnu/$f /dt9/usr/include/x86_64-linux-gnu/$f\n+done\n+popd\n+\n # Python 3.10 include headers fix:\n # sysconfig.get_path('include') incorrectly points to /usr/local/include/python\n # map /usr/include/python3.10 to /usr/local/include/python3.10"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 37,
        "deletions": 1
    }
}