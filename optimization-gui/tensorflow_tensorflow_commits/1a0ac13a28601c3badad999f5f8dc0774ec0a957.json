{
    "author": "allanrenucci",
    "message": "Remove duplicate patch file.\n\nPiperOrigin-RevId: 800001216",
    "sha": "1a0ac13a28601c3badad999f5f8dc0774ec0a957",
    "files": [
        {
            "sha": "c30ce9be39e9009f19e4a328b76fb192dc80e723",
            "filename": "tensorflow/workspace2.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a0ac13a28601c3badad999f5f8dc0774ec0a957/tensorflow%2Fworkspace2.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a0ac13a28601c3badad999f5f8dc0774ec0a957/tensorflow%2Fworkspace2.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fworkspace2.bzl?ref=1a0ac13a28601c3badad999f5f8dc0774ec0a957",
            "patch": "@@ -391,7 +391,7 @@ def _tf_repositories():\n \n     tf_http_archive(\n         name = \"com_google_protobuf\",\n-        patch_file = [\"@local_xla//third_party/protobuf:protobuf-6.31.1.patch\"],\n+        patch_file = [\"@local_xla//third_party/protobuf:protobuf.patch\"],\n         sha256 = \"6e09bbc950ba60c3a7b30280210cd285af8d7d8ed5e0a6ed101c72aff22e8d88\",\n         strip_prefix = \"protobuf-6.31.1\",\n         urls = tf_mirror_urls(\"https://github.com/protocolbuffers/protobuf/archive/refs/tags/v6.31.1.zip\"),"
        },
        {
            "sha": "5100d91c25ad164a583cf508e11d7e784e650114",
            "filename": "third_party/xla/third_party/protobuf/protobuf-6.31.1.patch",
            "status": "removed",
            "additions": 0,
            "deletions": 201,
            "changes": 201,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5dd49b147a0173cf853c3d76a17b6014f4f55567/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf-6.31.1.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5dd49b147a0173cf853c3d76a17b6014f4f55567/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf-6.31.1.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf-6.31.1.patch?ref=5dd49b147a0173cf853c3d76a17b6014f4f55567",
            "patch": "@@ -1,201 +0,0 @@\n-diff --git a/BUILD.bazel b/BUILD.bazel\n---- a/BUILD.bazel\n-+++ b/BUILD.bazel\n-@@ -555,7 +555,8 @@ proto_lang_toolchain(\n-         \"//:cpp_features_proto\",\n-         \"//:descriptor_proto\",\n-     ],\n--    command_line = \"--cpp_out=$(OUT)\",\n-+    command_line = \"--cpp_out=dllexport_decl=PROTOBUF_EXPORT:$(OUT)\",\n-+#    command_line = \"--cpp_out=$(OUT)\",\n-     runtime = \"//src/google/protobuf\",\n-     visibility = [\"//visibility:public\"],\n- )\n-diff --git a/build_defs/BUILD.bazel b/build_defs/BUILD.bazel\n---- a/build_defs/BUILD.bazel\n-+++ b/build_defs/BUILD.bazel\n-@@ -1,6 +1,7 @@\n- # Internal Starlark definitions for Protobuf.\n- \n- load(\"@bazel_skylib//lib:selects.bzl\", \"selects\")\n-+load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n- load(\"@rules_pkg//pkg:mappings.bzl\", \"pkg_files\", \"strip_prefix\")\n- load(\"//bazel:cc_proto_library.bzl\", starlark_cc_proto_library = \"cc_proto_library\")\n- load(\":cc_proto_blacklist_test.bzl\", \"cc_proto_blacklist_test\")\n-@@ -13,6 +14,20 @@ package(\n-     ],\n- )\n- \n-+bool_flag(\n-+    name = \"use_dlls\",\n-+    build_setting_default = False,\n-+    visibility = [\"//visibility:public\"],\n-+)\n-+\n-+config_setting(\n-+    name = \"config_use_dlls\",\n-+    flag_values = {\n-+        \":use_dlls\": \"True\",\n-+    },\n-+    visibility = [\"//visibility:public\"],\n-+)\n-+\n- create_compiler_config_setting(\n-     name = \"config_msvc_cl\",\n-     value = \"msvc-cl\",\n-diff --git a/python/dist/system_python.bzl b/python/dist/system_python.bzl\n---- a/python/dist/system_python.bzl\n-+++ b/python/dist/system_python.bzl\n-@@ -73,11 +73,10 @@ load(\"@bazel_skylib//lib:selects.bzl\", \"selects\")\n- load(\"@bazel_skylib//rules:common_settings.bzl\", \"string_flag\")\n- load(\"@bazel_tools//tools/python:toolchain.bzl\", \"py_runtime_pair\")\n- \n--cc_library(\n--   name = \"python_headers\",\n--   hdrs = glob([\"python/**/*.h\"], allow_empty = True),\n--   includes = [\"python\"],\n--   visibility = [\"//visibility:public\"],\n-+alias(\n-+    name = \"python_headers\",\n-+    actual = \"@python//:python_headers\",\n-+    visibility = [\"//visibility:public\"],\n- )\n- \n- string_flag(\n-@@ -219,7 +218,7 @@ def _system_python_impl(repository_ctx):\n-     python3 = repository_ctx.which(\"python3\")\n-     python_version = _get_python_version(repository_ctx)\n- \n--    if path and python_version[0] == \"3\":\n-+    if False:\n-         _populate_package(repository_ctx, path, python3, python_version)\n-     else:\n-         # buildifier: disable=print\n-diff --git a/python/google/protobuf/__init__.py b/python/google/protobuf/__init__.py\n---- a/python/google/protobuf/__init__.py\n-+++ b/python/google/protobuf/__init__.py\n-@@ -8,3 +8,9 @@\n- # Copyright 2007 Google Inc. All Rights Reserved.\n- \n- __version__ = '6.31.1'\n-+\n-+if __name__ != '__main__':\n-+  try:\n-+    __import__('pkg_resources').declare_namespace(__name__)\n-+  except ImportError:\n-+    __path__ = __import__('pkgutil').extend_path(__path__, __name__)\n-diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel\n---- a/src/google/protobuf/BUILD.bazel\n-+++ b/src/google/protobuf/BUILD.bazel\n-@@ -525,6 +525,13 @@ cc_library(\n-         \"serial_arena.h\",\n-         \"thread_safe_arena.h\",\n-     ],\n-+    local_defines = select({\n-+        \"//build_defs:config_use_dlls\": [\n-+            \"PROTOBUF_USE_DLLS\",\n-+            \"LIBPROTOBUF_EXPORTS\",\n-+        ],\n-+        \"//conditions:default\": [],\n-+    }),\n-     strip_include_prefix = \"/src\",\n-     visibility = [\n-         \"//:__subpackages__\",\n-@@ -657,7 +664,15 @@ cc_library(\n-         \"serial_arena.h\",\n-         \"thread_safe_arena.h\",\n-         \"wire_format_lite.h\",\n-+        \"port.h\",\n-     ],\n-+    local_defines = select({\n-+        \"//build_defs:config_use_dlls\": [\n-+            \"PROTOBUF_USE_DLLS\",\n-+            \"LIBPROTOBUF_EXPORTS\",\n-+        ],\n-+        \"//conditions:default\": [],\n-+    }),\n-     copts = COPTS + select({\n-         \"//build_defs:config_msvc\": [],\n-         \"//conditions:default\": [\n-@@ -767,6 +782,13 @@ cc_library(\n-     ],\n-     hdrs = PROTOBUF_HEADERS,\n-     copts = COPTS,\n-+    local_defines = select({\n-+        \"//build_defs:config_use_dlls\": [\n-+            \"PROTOBUF_USE_DLLS\",\n-+            \"LIBPROTOBUF_EXPORTS\",\n-+        ],\n-+        \"//conditions:default\": [],\n-+    }),\n-     linkopts = LINK_OPTS,\n-     strip_include_prefix = \"/src\",\n-     visibility = [\n-diff --git a/src/google/protobuf/arena.cc b/src/google/protobuf/arena.cc\n---- a/src/google/protobuf/arena.cc\n-+++ b/src/google/protobuf/arena.cc\n-@@ -547,7 +547,7 @@ ThreadSafeArena::ThreadCache& ThreadSafeArena::thread_cache() {\n-       new internal::ThreadLocalStorage<ThreadCache>();\n-   return *thread_cache_->Get();\n- }\n--#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n-+#elif defined(_WIN32)\n- ThreadSafeArena::ThreadCache& ThreadSafeArena::thread_cache() {\n-   static PROTOBUF_THREAD_LOCAL ThreadCache thread_cache;\n-   return thread_cache;\n-diff --git a/src/google/protobuf/io/BUILD.bazel b/src/google/protobuf/io/BUILD.bazel\n---- a/src/google/protobuf/io/BUILD.bazel\n-+++ b/src/google/protobuf/io/BUILD.bazel\n-@@ -22,6 +22,13 @@ cc_library(\n-         \"zero_copy_stream_impl.h\",\n-         \"zero_copy_stream_impl_lite.h\",\n-     ],\n-+    local_defines = select({\n-+        \"//build_defs:config_use_dlls\": [\n-+            \"PROTOBUF_USE_DLLS\",\n-+            \"LIBPROTOBUF_EXPORTS\",\n-+        ],\n-+        \"//conditions:default\": [],\n-+    }),\n-     copts = COPTS,\n-     strip_include_prefix = \"/src\",\n-     deps = [\n-diff --git a/src/google/protobuf/message_lite.h b/src/google/protobuf/message_lite.h\n---- a/src/google/protobuf/message_lite.h\n-+++ b/src/google/protobuf/message_lite.h\n-@@ -282,7 +282,11 @@ template <typename T>\n- using MessageTraits = decltype(MessageTraitsImpl::value<T>);\n- \n- struct EnumTraitsImpl {\n-+#ifdef __CUDACC__\n-+  struct Undefined{};\n-+#else\n-   struct Undefined;\n-+#endif\n-   template <typename T>\n-   static Undefined value;\n- };\n-diff --git a/src/google/protobuf/port_def.inc b/src/google/protobuf/port_def.inc\n---- a/src/google/protobuf/port_def.inc\n-+++ b/src/google/protobuf/port_def.inc\n-@@ -421,7 +421,7 @@ static_assert(PROTOBUF_ABSL_MIN(20230125, 3),\n- #endif\n- \n- // Lexan sets both MSV_VER and clang, so handle it with the clang path.\n--#if defined(_MSC_VER) && !defined(__clang__)\n-+#if defined(_MSC_VER)\n- // MSVC 17 currently seems to raise an error about constant-initialized pointers.\n- # if PROTOBUF_MSC_VER_MIN(1930)\n- #  define PROTOBUF_CONSTINIT\n-diff --git a/src/google/protobuf/thread_safe_arena.h b/src/google/protobuf/thread_safe_arena.h\n---- a/src/google/protobuf/thread_safe_arena.h\n-+++ b/src/google/protobuf/thread_safe_arena.h\n-@@ -249,7 +249,7 @@ class PROTOBUF_EXPORT ThreadSafeArena {\n-   // iOS does not support __thread keyword so we use a custom thread local\n-   // storage class we implemented.\n-   static ThreadCache& thread_cache();\n--#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n-+#elif defined(_WIN32)\n-   // Thread local variables cannot be exposed through MSVC DLL interface but we\n-   // can wrap them in static functions.\n-   static ThreadCache& thread_cache();"
        },
        {
            "sha": "d02ba25380563601a1511bf80fd9ae69cc3f36cc",
            "filename": "third_party/xla/third_party/protobuf/protobuf.patch",
            "status": "modified",
            "additions": 104,
            "deletions": 101,
            "changes": 205,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a0ac13a28601c3badad999f5f8dc0774ec0a957/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a0ac13a28601c3badad999f5f8dc0774ec0a957/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fprotobuf%2Fprotobuf.patch?ref=1a0ac13a28601c3badad999f5f8dc0774ec0a957",
            "patch": "@@ -1,18 +1,19 @@\n-diff --git a/src/google/protobuf/map_field.h b/src/google/protobuf/map_field.h\n---- a/src/google/protobuf/map_field.h\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/map_field.h\t(date 1748033655723)\n-@@ -710,7 +710,7 @@\n-   typedef MapField<T, Key, Value, kKeyFieldType, kValueFieldType> MapFieldType;\n- };\n-\n--class PROTOBUF_EXPORT DynamicMapField final\n-+class DynamicMapField final\n-     : public TypeDefinedMapFieldBase<MapKey, MapValueRef> {\n-  public:\n-   explicit DynamicMapField(const Message* default_entry);\n+diff --git a/BUILD.bazel b/BUILD.bazel\n+--- a/BUILD.bazel\n++++ b/BUILD.bazel\n+@@ -555,7 +555,8 @@ proto_lang_toolchain(\n+         \"//:cpp_features_proto\",\n+         \"//:descriptor_proto\",\n+     ],\n+-    command_line = \"--cpp_out=$(OUT)\",\n++    command_line = \"--cpp_out=dllexport_decl=PROTOBUF_EXPORT:$(OUT)\",\n++#    command_line = \"--cpp_out=$(OUT)\",\n+     runtime = \"//src/google/protobuf\",\n+     visibility = [\"//visibility:public\"],\n+ )\n diff --git a/build_defs/BUILD.bazel b/build_defs/BUILD.bazel\n---- a/build_defs/BUILD.bazel\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/build_defs/BUILD.bazel\t(date 1748034990268)\n+--- a/build_defs/BUILD.bazel\n++++ b/build_defs/BUILD.bazel\n @@ -1,6 +1,7 @@\n  # Internal Starlark definitions for Protobuf.\n \n@@ -21,7 +22,7 @@ diff --git a/build_defs/BUILD.bazel b/build_defs/BUILD.bazel\n  load(\"@rules_pkg//pkg:mappings.bzl\", \"pkg_files\", \"strip_prefix\")\n  load(\"//bazel:cc_proto_library.bzl\", starlark_cc_proto_library = \"cc_proto_library\")\n  load(\":cc_proto_blacklist_test.bzl\", \"cc_proto_blacklist_test\")\n-@@ -13,6 +14,20 @@\n+@@ -13,6 +14,20 @@ package(\n      ],\n  )\n \n@@ -43,9 +44,9 @@ diff --git a/build_defs/BUILD.bazel b/build_defs/BUILD.bazel\n      name = \"config_msvc_cl\",\n      value = \"msvc-cl\",\n diff --git a/python/dist/system_python.bzl b/python/dist/system_python.bzl\n---- a/python/dist/system_python.bzl\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/python/dist/system_python.bzl\t(date 1746939979885)\n-@@ -73,11 +73,10 @@\n+--- a/python/dist/system_python.bzl\n++++ b/python/dist/system_python.bzl\n+@@ -73,11 +73,10 @@ load(\"@bazel_skylib//lib:selects.bzl\", \"selects\")\n  load(\"@bazel_skylib//rules:common_settings.bzl\", \"string_flag\")\n  load(\"@bazel_tools//tools/python:toolchain.bzl\", \"py_runtime_pair\")\n \n@@ -61,7 +62,7 @@ diff --git a/python/dist/system_python.bzl b/python/dist/system_python.bzl\n  )\n \n  string_flag(\n-@@ -219,7 +218,7 @@\n+@@ -219,7 +218,7 @@ def _system_python_impl(repository_ctx):\n      python3 = repository_ctx.which(\"python3\")\n      python_version = _get_python_version(repository_ctx)\n \n@@ -70,76 +71,23 @@ diff --git a/python/dist/system_python.bzl b/python/dist/system_python.bzl\n          _populate_package(repository_ctx, path, python3, python_version)\n      else:\n          # buildifier: disable=print\n-diff --git a/src/google/protobuf/arena.cc b/src/google/protobuf/arena.cc\n---- a/src/google/protobuf/arena.cc\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/arena.cc\t(date 1748042877047)\n-@@ -554,7 +554,7 @@\n-       new internal::ThreadLocalStorage<ThreadCache>();\n-   return *thread_cache_->Get();\n- }\n--#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n-+#elif defined(_WIN32)\n- ThreadSafeArena::ThreadCache& ThreadSafeArena::thread_cache() {\n-   static PROTOBUF_THREAD_LOCAL ThreadCache thread_cache;\n-   return thread_cache;\n-diff --git a/BUILD.bazel b/BUILD.bazel\n---- a/BUILD.bazel\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/BUILD.bazel\t(date 1746940994484)\n-@@ -424,7 +424,8 @@\n-         \"//:cpp_features_proto\",\n-         \"//:descriptor_proto\",\n-     ],\n--    command_line = \"--cpp_out=$(OUT)\",\n-+    command_line = \"--cpp_out=dllexport_decl=PROTOBUF_EXPORT:$(OUT)\",\n-+#    command_line = \"--cpp_out=$(OUT)\",\n-     runtime = \"//src/google/protobuf\",\n-     visibility = [\"//visibility:public\"],\n- )\n-diff --git a/src/google/protobuf/io/BUILD.bazel b/src/google/protobuf/io/BUILD.bazel\n---- a/src/google/protobuf/io/BUILD.bazel\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/io/BUILD.bazel\t(date 1748038681727)\n-@@ -22,6 +22,13 @@\n-         \"zero_copy_stream_impl.h\",\n-         \"zero_copy_stream_impl_lite.h\",\n-     ],\n-+    local_defines = select({\n-+        \"//build_defs:config_use_dlls\": [\n-+            \"PROTOBUF_USE_DLLS\",\n-+            \"LIBPROTOBUF_EXPORTS\",\n-+        ],\n-+        \"//conditions:default\": [],\n-+    }),\n-     copts = COPTS,\n-     strip_include_prefix = \"/src\",\n-     deps = [\n-diff --git a/src/google/protobuf/port_def.inc b/src/google/protobuf/port_def.inc\n---- a/src/google/protobuf/port_def.inc\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/port_def.inc\t(date 1748019340115)\n-@@ -456,7 +456,7 @@\n- #endif\n+diff --git a/python/google/protobuf/__init__.py b/python/google/protobuf/__init__.py\n+--- a/python/google/protobuf/__init__.py\n++++ b/python/google/protobuf/__init__.py\n+@@ -8,3 +8,9 @@\n+ # Copyright 2007 Google Inc. All Rights Reserved.\n \n- // Lexan sets both MSV_VER and clang, so handle it with the clang path.\n--#if defined(_MSC_VER) && !defined(__clang__)\n-+#if defined(_MSC_VER)\n- // MSVC 17 currently seems to raise an error about constant-initialized pointers.\n- # if PROTOBUF_MSC_VER_MIN(1930)\n- #  define PROTOBUF_CONSTINIT\n-diff --git a/src/google/protobuf/thread_safe_arena.h b/src/google/protobuf/thread_safe_arena.h\n---- a/src/google/protobuf/thread_safe_arena.h\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/thread_safe_arena.h\t(date 1748042886641)\n-@@ -248,7 +248,7 @@\n-   // iOS does not support __thread keyword so we use a custom thread local\n-   // storage class we implemented.\n-   static ThreadCache& thread_cache();\n--#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n-+#elif defined(_WIN32)\n-   // Thread local variables cannot be exposed through MSVC DLL interface but we\n-   // can wrap them in static functions.\n-   static ThreadCache& thread_cache();\n+ __version__ = '6.31.1'\n++\n++if __name__ != '__main__':\n++  try:\n++    __import__('pkg_resources').declare_namespace(__name__)\n++  except ImportError:\n++    __path__ = __import__('pkgutil').extend_path(__path__, __name__)\n diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel\n---- a/src/google/protobuf/BUILD.bazel\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/src/google/protobuf/BUILD.bazel\t(date 1748038617126)\n-@@ -411,6 +411,13 @@\n+--- a/src/google/protobuf/BUILD.bazel\n++++ b/src/google/protobuf/BUILD.bazel\n+@@ -525,6 +525,13 @@ cc_library(\n          \"serial_arena.h\",\n          \"thread_safe_arena.h\",\n      ],\n@@ -153,7 +101,7 @@ diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel\n      strip_include_prefix = \"/src\",\n      visibility = [\n          \"//:__subpackages__\",\n-@@ -509,7 +516,15 @@\n+@@ -657,7 +664,15 @@ cc_library(\n          \"serial_arena.h\",\n          \"thread_safe_arena.h\",\n          \"wire_format_lite.h\",\n@@ -169,7 +117,7 @@ diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel\n      copts = COPTS + select({\n          \"//build_defs:config_msvc\": [],\n          \"//conditions:default\": [\n-@@ -615,6 +630,13 @@\n+@@ -767,6 +782,13 @@ cc_library(\n      ],\n      hdrs = PROTOBUF_HEADERS,\n      copts = COPTS,\n@@ -183,16 +131,71 @@ diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel\n      linkopts = LINK_OPTS,\n      strip_include_prefix = \"/src\",\n      visibility = [\n-diff --git a/python/google/protobuf/__init__.py b/python/google/protobuf/__init__.py\n---- a/python/google/protobuf/__init__.py\t(revision 5fda5abda3dee5f7a102c85860594bff8d8610bd)\n-+++ b/python/google/protobuf/__init__.py\t(date 1746939979902)\n-@@ -8,3 +8,9 @@\n- # Copyright 2007 Google Inc. All Rights Reserved.\n+diff --git a/src/google/protobuf/arena.cc b/src/google/protobuf/arena.cc\n+--- a/src/google/protobuf/arena.cc\n++++ b/src/google/protobuf/arena.cc\n+@@ -547,7 +547,7 @@ ThreadSafeArena::ThreadCache& ThreadSafeArena::thread_cache() {\n+       new internal::ThreadLocalStorage<ThreadCache>();\n+   return *thread_cache_->Get();\n+ }\n+-#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n++#elif defined(_WIN32)\n+ ThreadSafeArena::ThreadCache& ThreadSafeArena::thread_cache() {\n+   static PROTOBUF_THREAD_LOCAL ThreadCache thread_cache;\n+   return thread_cache;\n+diff --git a/src/google/protobuf/io/BUILD.bazel b/src/google/protobuf/io/BUILD.bazel\n+--- a/src/google/protobuf/io/BUILD.bazel\n++++ b/src/google/protobuf/io/BUILD.bazel\n+@@ -22,6 +22,13 @@ cc_library(\n+         \"zero_copy_stream_impl.h\",\n+         \"zero_copy_stream_impl_lite.h\",\n+     ],\n++    local_defines = select({\n++        \"//build_defs:config_use_dlls\": [\n++            \"PROTOBUF_USE_DLLS\",\n++            \"LIBPROTOBUF_EXPORTS\",\n++        ],\n++        \"//conditions:default\": [],\n++    }),\n+     copts = COPTS,\n+     strip_include_prefix = \"/src\",\n+     deps = [\n+diff --git a/src/google/protobuf/message_lite.h b/src/google/protobuf/message_lite.h\n+--- a/src/google/protobuf/message_lite.h\n++++ b/src/google/protobuf/message_lite.h\n+@@ -282,7 +282,11 @@ template <typename T>\n+ using MessageTraits = decltype(MessageTraitsImpl::value<T>);\n \n- __version__ = '5.28.3'\n-+\n-+if __name__ != '__main__':\n-+  try:\n-+    __import__('pkg_resources').declare_namespace(__name__)\n-+  except ImportError:\n-+    __path__ = __import__('pkgutil').extend_path(__path__, __name__)\n+ struct EnumTraitsImpl {\n++#ifdef __CUDACC__\n++  struct Undefined{};\n++#else\n+   struct Undefined;\n++#endif\n+   template <typename T>\n+   static Undefined value;\n+ };\n+diff --git a/src/google/protobuf/port_def.inc b/src/google/protobuf/port_def.inc\n+--- a/src/google/protobuf/port_def.inc\n++++ b/src/google/protobuf/port_def.inc\n+@@ -421,7 +421,7 @@ static_assert(PROTOBUF_ABSL_MIN(20230125, 3),\n+ #endif\n+\n+ // Lexan sets both MSV_VER and clang, so handle it with the clang path.\n+-#if defined(_MSC_VER) && !defined(__clang__)\n++#if defined(_MSC_VER)\n+ // MSVC 17 currently seems to raise an error about constant-initialized pointers.\n+ # if PROTOBUF_MSC_VER_MIN(1930)\n+ #  define PROTOBUF_CONSTINIT\n+diff --git a/src/google/protobuf/thread_safe_arena.h b/src/google/protobuf/thread_safe_arena.h\n+--- a/src/google/protobuf/thread_safe_arena.h\n++++ b/src/google/protobuf/thread_safe_arena.h\n+@@ -249,7 +249,7 @@ class PROTOBUF_EXPORT ThreadSafeArena {\n+   // iOS does not support __thread keyword so we use a custom thread local\n+   // storage class we implemented.\n+   static ThreadCache& thread_cache();\n+-#elif defined(PROTOBUF_USE_DLLS) && defined(_WIN32)\n++#elif defined(_WIN32)\n+   // Thread local variables cannot be exposed through MSVC DLL interface but we\n+   // can wrap them in static functions.\n+   static ThreadCache& thread_cache();"
        },
        {
            "sha": "5897e325e4ed737e2ab866da454f382914d76dca",
            "filename": "third_party/xla/workspace2.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a0ac13a28601c3badad999f5f8dc0774ec0a957/third_party%2Fxla%2Fworkspace2.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a0ac13a28601c3badad999f5f8dc0774ec0a957/third_party%2Fxla%2Fworkspace2.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fworkspace2.bzl?ref=1a0ac13a28601c3badad999f5f8dc0774ec0a957",
            "patch": "@@ -317,7 +317,7 @@ def _tf_repositories():\n \n     tf_http_archive(\n         name = \"com_google_protobuf\",\n-        patch_file = [\"//third_party/protobuf:protobuf-6.31.1.patch\"],\n+        patch_file = [\"//third_party/protobuf:protobuf.patch\"],\n         sha256 = \"6e09bbc950ba60c3a7b30280210cd285af8d7d8ed5e0a6ed101c72aff22e8d88\",\n         strip_prefix = \"protobuf-6.31.1\",\n         urls = tf_mirror_urls(\"https://github.com/protocolbuffers/protobuf/archive/refs/tags/v6.31.1.zip\"),"
        }
    ],
    "stats": {
        "total": 410,
        "additions": 106,
        "deletions": 304
    }
}