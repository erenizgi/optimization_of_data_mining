{
    "author": "beckerhe",
    "message": "Reverts 6185a6b9ab9f84b95a9a94e55d6d16afa433b91a\n\nPiperOrigin-RevId: 837157492",
    "sha": "2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
    "files": [
        {
            "sha": "e67e267c4ac175fd2c45a57eebadc63c25aa71e9",
            "filename": "third_party/xla/xla/tsl/framework/device_id_manager.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -55,17 +55,16 @@ class TfToPlatformDeviceIdMap {\n           {tf_device_id.value(), platform_device_id.value()});\n     }\n     if (!result.second && platform_device_id.value() != result.first->second) {\n-      return absl::AlreadyExistsError(absl::StrCat(\n-          \"TensorFlow device (\", type.type_string(), \":\", tf_device_id.value(),\n+      return errors::AlreadyExists(\n+          \"TensorFlow device (\", type, \":\", tf_device_id.value(),\n           \") is being mapped to multiple devices (\", platform_device_id.value(),\n           \" now, and \", result.first->second,\n           \" previously), which is not supported. \"\n           \"This may be the result of providing different \",\n-          type.type_string(),\n-          \" configurations (ConfigProto.gpu_options, for example \",\n+          type, \" configurations (ConfigProto.gpu_options, for example \",\n           \"different visible_device_list) when creating multiple Sessions in \",\n           \"the same process. This is not currently supported, see \",\n-          \"https://github.com/tensorflow/tensorflow/issues/19083\"));\n+          \"https://github.com/tensorflow/tensorflow/issues/19083\");\n     }\n     return absl::OkStatus();\n   }"
        },
        {
            "sha": "f3034b1b79e588a950bfb5f58680989f07b3acad",
            "filename": "third_party/xla/xla/tsl/platform/cloud/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -130,13 +130,10 @@ cc_library(\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/base:core_headers\",\n-        \"@com_google_absl//absl/log\",\n-        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n-        \"@com_google_absl//absl/types:span\",\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\",\n@@ -179,13 +176,10 @@ cc_library(\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/base:core_headers\",\n-        \"@com_google_absl//absl/log\",\n-        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n-        \"@com_google_absl//absl/types:span\",\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\","
        },
        {
            "sha": "6ddb24fda8476262f5b54741768d6b3b725a20b1",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 28,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -17,40 +17,13 @@ limitations under the License.\n \n #include <stdio.h>\n \n-#include <cstdint>\n-#include <iosfwd>\n-#include <limits>\n #include <memory>\n-#include <set>\n-#include <unordered_set>\n \n-#include \"absl/base/attributes.h\"\n-#include \"absl/log/check.h\"\n-#include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n-#include \"absl/strings/ascii.h\"\n-#include \"absl/strings/match.h\"\n-#include \"absl/strings/numbers.h\"\n #include \"absl/strings/str_cat.h\"\n-#include \"absl/strings/str_join.h\"\n-#include \"absl/strings/str_split.h\"\n-#include \"absl/strings/string_view.h\"\n-#include \"absl/strings/strip.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n-#include \"absl/types/span.h\"\n-#include \"xla/tsl/platform/cloud/auth_provider.h\"\n-#include \"xla/tsl/platform/cloud/compute_engine_metadata_client.h\"\n-#include \"xla/tsl/platform/cloud/compute_engine_zone_provider.h\"\n-#include \"xla/tsl/platform/cloud/expiring_lru_cache.h\"\n-#include \"xla/tsl/platform/cloud/gcs_dns_cache.h\"\n-#include \"xla/tsl/platform/cloud/gcs_throttle.h\"\n-#include \"xla/tsl/platform/cloud/http_request.h\"\n-#include \"xla/tsl/platform/cloud/zone_provider.h\"\n-#include \"xla/tsl/platform/file_system.h\"\n-#include \"xla/tsl/platform/status.h\"\n-#include \"xla/tsl/platform/types.h\"\n #include \"tsl/platform/retrying_file_system.h\"\n \n #ifndef _WIN32\n@@ -2013,7 +1986,7 @@ absl::Status GcsFileSystem::CreateDir(const string& dirname,\n   if (FileExists(dirname_with_slash, token).ok()) {\n     // Use the original name for a correct error here.\n     VLOG(3) << \"CreateDir: directory already exists, not uploading \" << dirname;\n-    return absl::AlreadyExistsError(dirname);\n+    return errors::AlreadyExists(dirname);\n   }\n \n   std::unique_ptr<HttpRequest> request;"
        },
        {
            "sha": "2d3cdfaf70009057e69345541812764f9b5fbe8d",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -3622,11 +3622,11 @@ TEST(GcsFileSystemTest, CreateDir_Folder) {\n   TF_EXPECT_OK(fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n   // Check that when GCS returns the object already exists return that the\n   // directory already exists.\n-  EXPECT_EQ(absl::AlreadyExistsError(\"gs://bucket/subpath\"),\n+  EXPECT_EQ(errors::AlreadyExists(\"gs://bucket/subpath\"),\n             fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n   // Check that when GCS returns the object already has a version (failed\n   // precondition) return directory already exists.\n-  EXPECT_EQ(absl::AlreadyExistsError(\"gs://bucket/subpath\"),\n+  EXPECT_EQ(errors::AlreadyExists(\"gs://bucket/subpath\"),\n             fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n }\n "
        },
        {
            "sha": "acefddd92d385b6212718599824a54729984e0ff",
            "filename": "third_party/xla/xla/tsl/platform/default/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -164,15 +164,12 @@ cc_library(\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/functional:any_invocable\",\n-        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:cord\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@com_google_protobuf//:protobuf\",\n-        \"@com_google_protobuf//:protobuf_lite\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:blocking_counter\",\n@@ -188,6 +185,7 @@ cc_library(\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n         \"@local_tsl//tsl/platform:stringpiece\",\n+        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n         \"@local_tsl//tsl/platform:tracing\",\n     ],"
        },
        {
            "sha": "b6d309648deea12fb0f7cc6b5d0870717723d7aa",
            "filename": "third_party/xla/xla/tsl/platform/default/posix_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -349,7 +349,7 @@ absl::Status PosixFileSystem::CreateDir(const std::string& name,\n                                         TransactionToken* token) {\n   std::string translated = TranslateName(name);\n   if (translated.empty()) {\n-    return absl::AlreadyExistsError(name);\n+    return errors::AlreadyExists(name);\n   }\n   if (mkdir(translated.c_str(), 0755) != 0) {\n     return IOError(name, errno);"
        },
        {
            "sha": "e62a49d223b7a11ae9d5a713e3bda0718bb95e85",
            "filename": "third_party/xla/xla/tsl/platform/env.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 20,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -18,30 +18,19 @@ limitations under the License.\n #include <sys/stat.h>\n \n #include <cstdint>\n-#include <cstdio>\n-#include <memory>\n-#include <string>\n-#include <unordered_map>\n+#include <deque>\n #include <utility>\n #include <vector>\n \n-#include \"absl/log/check.h\"\n-#include \"absl/status/status.h\"\n-#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_format.h\"\n-#include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n-#include \"absl/types/span.h\"\n-#include \"google/protobuf/io/coded_stream.h\"\n-#include \"google/protobuf/io/zero_copy_stream.h\"\n-#include \"google/protobuf/message.h\"\n-#include \"google/protobuf/message_lite.h\"\n-#include \"google/protobuf/text_format.h\"\n+#include \"xla/tsl/platform/env_time.h\"\n #include \"xla/tsl/platform/errors.h\"\n-#include \"xla/tsl/platform/file_statistics.h\"\n-#include \"xla/tsl/platform/file_system.h\"\n #include \"tsl/platform/host_info.h\"\n #include \"tsl/platform/path.h\"\n+#include \"tsl/platform/platform.h\"\n+#include \"tsl/platform/protobuf.h\"\n+#include \"tsl/platform/stringprintf.h\"\n #include \"tsl/platform/thread_annotations.h\"\n \n #if defined(__APPLE__)\n@@ -88,8 +77,8 @@ absl::Status FileSystemRegistryImpl::Register(\n   absl::MutexLock lock(mu_);\n   if (!registry_.emplace(scheme, std::unique_ptr<FileSystem>(factory()))\n            .second) {\n-    return absl::AlreadyExistsError(\n-        absl::StrCat(\"File factory for \", scheme, \" already registered\"));\n+    return errors::AlreadyExists(\"File factory for \", scheme,\n+                                 \" already registered\");\n   }\n   return absl::OkStatus();\n }\n@@ -98,8 +87,8 @@ absl::Status FileSystemRegistryImpl::Register(\n     const std::string& scheme, std::unique_ptr<FileSystem> filesystem) {\n   absl::MutexLock lock(mu_);\n   if (!registry_.emplace(scheme, std::move(filesystem)).second) {\n-    return absl::AlreadyExistsError(\n-        absl::StrCat(\"File system for \", scheme, \" already registered\"));\n+    return errors::AlreadyExists(\"File system for \", scheme,\n+                                 \" already registered\");\n   }\n   return absl::OkStatus();\n }"
        },
        {
            "sha": "b7bbc84c67df7aa3e365583daf3655240e37b06a",
            "filename": "third_party/xla/xla/tsl/platform/ram_file_system.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -263,7 +263,7 @@ class RamFileSystem : public FileSystem {\n \n     auto it = fs_.find(dirname);\n     if (it != fs_.end() && it->second != nullptr) {\n-      return absl::AlreadyExistsError(\n+      return errors::AlreadyExists(\n           \"cannot create directory with same name as an existing file\");\n     }\n "
        },
        {
            "sha": "219166c8b17697b4cfd88d50e1d23583dcc0f0d5",
            "filename": "third_party/xla/xla/tsl/platform/windows/windows_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2fc3b480f5e51a69bc7a7015576892bb4b33ad3f/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc?ref=2fc3b480f5e51a69bc7a7015576892bb4b33ad3f",
            "patch": "@@ -594,7 +594,7 @@ Status WindowsFileSystem::CreateDir(const string& name,\n   Status result;\n   std::wstring ws_name = Utf8ToWideChar(name);\n   if (ws_name.empty()) {\n-    return absl::AlreadyExistsError(name);\n+    return errors::AlreadyExists(name);\n   }\n   if (_wmkdir(ws_name.c_str()) != 0) {\n     result = IOError(\"Failed to create a directory: \" + name, errno);"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 20,
        "deletions": 67
    }
}