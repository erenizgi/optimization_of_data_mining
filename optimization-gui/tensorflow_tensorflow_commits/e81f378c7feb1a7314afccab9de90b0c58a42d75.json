{
    "author": "basioli-k",
    "message": "[XLA][host offloading] We shouldn't use the hlo module in aot_compilation_result if the aot result is not set.\n\nPiperOrigin-RevId: 813745219",
    "sha": "e81f378c7feb1a7314afccab9de90b0c58a42d75",
    "files": [
        {
            "sha": "71270a01e9f935a3aac34dd75e52ffdcde2489a9",
            "filename": "third_party/xla/xla/core/host_offloading/host_offloading_nanort_executable.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 13,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e81f378c7feb1a7314afccab9de90b0c58a42d75/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fhost_offloading_nanort_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e81f378c7feb1a7314afccab9de90b0c58a42d75/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fhost_offloading_nanort_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcore%2Fhost_offloading%2Fhost_offloading_nanort_executable.cc?ref=e81f378c7feb1a7314afccab9de90b0c58a42d75",
            "patch": "@@ -142,7 +142,10 @@ HostOffloadingNanoRtExecutable::LoadFromProto(\n   TF_RET_CHECK(proto.executable_type() ==\n                HostOffloadingExecutableProto::EXECUTABLE_TYPE_NANORT);\n \n-  auto& hlo_module_proto = proto.hlo_module();\n+  auto& hlo_module_proto =\n+      proto.has_aot_compilation_result()\n+          ? proto.aot_compilation_result().hlo_module().hlo_module()\n+          : proto.hlo_module();\n \n   VLOG(3) << \"Load NanoRt host offloading executable: name=\"\n           << hlo_module_proto.name();\n@@ -154,18 +157,14 @@ HostOffloadingNanoRtExecutable::LoadFromProto(\n \n   // We keep program shape and alias config of the original HLO module and not\n   // the destination-passing-style module with extra output parameters.\n-  TF_ASSIGN_OR_RETURN(ProgramShape program_shape,\n-                      ProgramShape::FromProto(proto.aot_compilation_result()\n-                                                  .hlo_module()\n-                                                  .hlo_module()\n-                                                  .host_program_shape()));\n-\n-  TF_ASSIGN_OR_RETURN(auto alias_config,\n-                      HloInputOutputAliasConfig::CreateFromProto(\n-                          program_shape.result(), proto.aot_compilation_result()\n-                                                      .hlo_module()\n-                                                      .hlo_module()\n-                                                      .input_output_alias()));\n+  TF_ASSIGN_OR_RETURN(\n+      ProgramShape program_shape,\n+      ProgramShape::FromProto(hlo_module_proto.host_program_shape()));\n+\n+  TF_ASSIGN_OR_RETURN(\n+      auto alias_config,\n+      HloInputOutputAliasConfig::CreateFromProto(\n+          program_shape.result(), hlo_module_proto.input_output_alias()));\n \n   std::unique_ptr<xla::cpu::NanoRtExecutable> executable;\n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 12,
        "deletions": 13
    }
}