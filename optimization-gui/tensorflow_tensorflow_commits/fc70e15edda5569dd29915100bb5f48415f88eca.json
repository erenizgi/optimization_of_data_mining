{
    "author": "tensorflower-gardener",
    "message": "Reverts 45373f20145c134f734aabefa71bc9a898bd26c6\n\nPiperOrigin-RevId: 800576061",
    "sha": "fc70e15edda5569dd29915100bb5f48415f88eca",
    "files": [
        {
            "sha": "f080aed44c33dfb763294b9ef7c5bbd161de57a2",
            "filename": "tensorflow/compiler/mlir/quantization/stablehlo/cc/io_test.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fc70e15edda5569dd29915100bb5f48415f88eca/tensorflow%2Fcompiler%2Fmlir%2Fquantization%2Fstablehlo%2Fcc%2Fio_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fc70e15edda5569dd29915100bb5f48415f88eca/tensorflow%2Fcompiler%2Fmlir%2Fquantization%2Fstablehlo%2Fcc%2Fio_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcompiler%2Fmlir%2Fquantization%2Fstablehlo%2Fcc%2Fio_test.cc?ref=fc70e15edda5569dd29915100bb5f48415f88eca",
            "patch": "@@ -66,10 +66,6 @@ class TestEnvBrokenFileSystem : public tsl::Env {\n     return nullptr;\n   }\n \n-  void StartDetachedThread(const tsl::ThreadOptions& thread_options,\n-                           const tsl::string& name,\n-                           absl::AnyInvocable<void()> fn) override {}\n-\n   bool GetCurrentThreadName(tsl::string* name) override { return false; }\n \n   void SchedClosure(absl::AnyInvocable<void()> closure) override {}"
        },
        {
            "sha": "f030405f0b709c823f46211d361f7b1924f0c716",
            "filename": "third_party/xla/xla/tsl/platform/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD?ref=fc70e15edda5569dd29915100bb5f48415f88eca",
            "patch": "@@ -381,18 +381,6 @@ cc_library(\n     deps = tf_windows_aware_platform_deps(\"env_impl\"),\n )\n \n-tsl_cc_test(\n-    name = \"env_test\",\n-    srcs = [\"env_test.cc\"],\n-    deps = [\n-        \":env\",\n-        \":test\",\n-        \"@com_google_absl//absl/synchronization\",\n-        \"@com_google_absl//absl/time\",\n-        \"@com_google_googletest//:gtest_main\",\n-    ],\n-)\n-\n cc_library(\n     name = \"env_time\",\n     compatible_with = get_compatible_with_portable(),"
        },
        {
            "sha": "7a2c743883affa294ef54351dbf4ece4db40009c",
            "filename": "third_party/xla/xla/tsl/platform/default/env.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 16,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fenv.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fenv.cc?ref=fc70e15edda5569dd29915100bb5f48415f88eca",
            "patch": "@@ -66,8 +66,7 @@ std::map<std::thread::id, string>& GetThreadNameRegistry()\n class PThread : public Thread {\n  public:\n   PThread(const ThreadOptions& thread_options, const std::string& name,\n-          absl::AnyInvocable<void()> fn, bool detached = false)\n-      : detached_(detached) {\n+          absl::AnyInvocable<void()> fn) {\n     ThreadParams* params = new ThreadParams;\n     params->name = name;\n     params->fn = std::move(fn);\n@@ -76,21 +75,14 @@ class PThread : public Thread {\n     if (thread_options.stack_size != 0) {\n       pthread_attr_setstacksize(&attributes, thread_options.stack_size);\n     }\n-    if (detached) {\n-      pthread_attr_setdetachstate(&attributes, PTHREAD_CREATE_DETACHED);\n-    }\n     int ret = pthread_create(&thread_, &attributes, &ThreadFn, params);\n     // There is no mechanism for the thread creation API to fail, so we CHECK.\n     CHECK_EQ(ret, 0) << \"Thread \" << name\n                      << \" creation via pthread_create() failed.\";\n     pthread_attr_destroy(&attributes);\n   }\n \n-  ~PThread() override {\n-    if (!detached_) {\n-      pthread_join(thread_, nullptr);\n-    }\n-  }\n+  ~PThread() override { pthread_join(thread_, nullptr); }\n \n  private:\n   struct ThreadParams {\n@@ -113,7 +105,6 @@ class PThread : public Thread {\n   }\n \n   pthread_t thread_;\n-  bool detached_;\n };\n \n class PosixEnv : public Env {\n@@ -151,11 +142,6 @@ class PosixEnv : public Env {\n                       absl::AnyInvocable<void()> fn) override {\n     return new PThread(thread_options, name, std::move(fn));\n   }\n-  void StartDetachedThread(const ThreadOptions& thread_options,\n-                           const string& name,\n-                           absl::AnyInvocable<void()> fn) override {\n-    PThread detached(thread_options, name, std::move(fn), /*detached=*/true);\n-  }\n \n   int64_t GetCurrentThreadId() override {\n     static thread_local int64_t current_thread_id ="
        },
        {
            "sha": "e53643a341b0148cefe8599a620ccb5f24c96f4d",
            "filename": "third_party/xla/xla/tsl/platform/env.h",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.h?ref=fc70e15edda5569dd29915100bb5f48415f88eca",
            "patch": "@@ -449,13 +449,6 @@ class Env {\n       const ThreadOptions& thread_options, const std::string& name,\n       absl::AnyInvocable<void()> fn) TF_MUST_USE_RESULT = 0;\n \n-  /// \\brief Starts a new detached thread that runs fn() and is identified\n-  /// (for debugging/performance-analysis) by \"name\".\n-  ///\n-  virtual void StartDetachedThread(const ThreadOptions& thread_options,\n-                                   const std::string& name,\n-                                   absl::AnyInvocable<void()> fn) = 0;\n-\n   // Returns the thread id of calling thread.\n   // Posix: Returns pthread id which is only guaranteed to be unique within a\n   //        process.\n@@ -558,12 +551,6 @@ class EnvWrapper : public Env {\n                       absl::AnyInvocable<void()> fn) override {\n     return target_->StartThread(thread_options, name, std::move(fn));\n   }\n-  void StartDetachedThread(const ThreadOptions& thread_options,\n-                           const std::string& name,\n-                           absl::AnyInvocable<void()> fn) override {\n-    target_->StartDetachedThread(thread_options, name, std::move(fn));\n-  }\n-\n   int64_t GetCurrentThreadId() override {\n     return target_->GetCurrentThreadId();\n   }"
        },
        {
            "sha": "fe3f28bb71201d1d55282b0c0d090fbf845acf91",
            "filename": "third_party/xla/xla/tsl/platform/env_test.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/328551db6e55b042b1bcf6df1392c94907708166/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/328551db6e55b042b1bcf6df1392c94907708166/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv_test.cc?ref=328551db6e55b042b1bcf6df1392c94907708166",
            "patch": "@@ -1,43 +0,0 @@\n-/* Copyright 2025 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#include \"xla/tsl/platform/env.h\"\n-\n-#include <gtest/gtest.h>\n-#include \"absl/synchronization/blocking_counter.h\"\n-#include \"absl/time/clock.h\"\n-#include \"absl/time/time.h\"\n-\n-namespace tsl {\n-namespace {\n-\n-TEST(EnvTest, StartDetachedThread) {\n-  Env* env = Env::Default();\n-  const int num_threads = 10;\n-  absl::BlockingCounter counter(num_threads);\n-\n-  ThreadOptions thread_options;\n-  for (int i = 0; i < num_threads; ++i) {\n-    env->StartDetachedThread(thread_options, \"MyDetachedThread\", [&]() {\n-      absl::SleepFor(absl::Milliseconds(50));\n-      counter.DecrementCount();\n-    });\n-  }\n-\n-  counter.Wait();\n-}\n-\n-}  // namespace\n-}  // namespace tsl"
        },
        {
            "sha": "3c46f372569736879ff58da1e639f8cc7bef16c0",
            "filename": "third_party/xla/xla/tsl/platform/windows/env.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 16,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fenv.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/fc70e15edda5569dd29915100bb5f48415f88eca/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fenv.cc?ref=fc70e15edda5569dd29915100bb5f48415f88eca",
            "patch": "@@ -57,26 +57,20 @@ class StdThread : public Thread {\n  public:\n   // thread_options is ignored.\n   StdThread(const ThreadOptions& thread_options, const string& name,\n-            absl::AnyInvocable<void()> fn, bool detached = false)\n-      : detached_(detached), thread_(std::move(fn)) {\n-    if (detached) {\n-      thread_.detach();\n-    }\n+            absl::AnyInvocable<void()> fn)\n+      : thread_(std::move(fn)) {\n     mutex_lock l(name_mutex);\n     GetThreadNameRegistry().emplace(thread_.get_id(), name);\n   }\n \n   ~StdThread() override {\n     std::thread::id thread_id = thread_.get_id();\n-    if (!detached_) {\n-      thread_.join();\n-    }\n+    thread_.join();\n     mutex_lock l(name_mutex);\n     GetThreadNameRegistry().erase(thread_id);\n   }\n \n  private:\n-  bool detached_;\n   std::thread thread_;\n };\n \n@@ -112,13 +106,6 @@ class WindowsEnv : public Env {\n     return new StdThread(thread_options, name, std::move(fn));\n   }\n \n-  void StartDetachedThread(const ThreadOptions& thread_options,\n-                           const string& name,\n-                           absl::AnyInvocable<void()> fn) override {\n-    StdThread detached_thread(thread_options, name, std::move(fn),\n-                              /*detached=*/true);\n-  }\n-\n   int64_t GetCurrentThreadId() override {\n     return static_cast<int64_t>(::GetCurrentThreadId());\n   }"
        }
    ],
    "stats": {
        "total": 109,
        "additions": 5,
        "deletions": 104
    }
}