{
    "author": "junwhanahn",
    "message": "Replace IFRT futures/promises with TSL futures/promises\n\nIFRT futures/promises have been deprecated in favor of TSL futures/promises.\n\nPiperOrigin-RevId: 812523887",
    "sha": "dffac0970256d9e3e3e45fb44f910ece9340040d",
    "files": [
        {
            "sha": "f7da8a8c8d695a64fe9c58962d65456bb746b531",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/BUILD",
            "status": "modified",
            "additions": 17,
            "deletions": 8,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2FBUILD?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -30,11 +30,11 @@ cc_library(\n     deps = [\n         \":client_session\",\n         \"//xla/pjrt/distributed:util\",\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt_proxy/common:grpc_credentials_possibly_insecure_wrapper\",\n         \"//xla/python/ifrt_proxy/common:grpc_ifrt_service_cc_grpc_proto\",\n         \"//xla/python/ifrt_proxy/common:grpc_ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_github_grpc_grpc//:grpc\",\n         \"@com_github_grpc_grpc//:grpc++\",\n         \"@com_google_absl//absl/base\",\n@@ -106,6 +106,7 @@ cc_library(\n         \"//xla/python/ifrt_proxy/common:prof_util\",\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n         \"//xla/python/ifrt_proxy/common:types\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:status_to_from_proto\",\n         \"//xla/tsl/profiler/utils:xplane_schema\",\n@@ -136,12 +137,12 @@ ifrt_proxy_cc_test(\n         \":mock_client_session\",\n         \":rpc_helper\",\n         \":version\",\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt:serdes_version\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/python/ifrt_proxy/common:types_proto_cc\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/synchronization\",\n@@ -173,6 +174,7 @@ cc_library(\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/python/ifrt_proxy/common:versions\",\n         \"//xla/python/pjrt_ifrt:pjrt_attribute_map_util\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/base:core_headers\",\n@@ -213,6 +215,7 @@ ifrt_proxy_cc_test(\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/service:computation_placer_hdr\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/util/proto:proto_matchers\",\n@@ -263,6 +266,7 @@ cc_library(\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/python/ifrt_proxy/common:types_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:versions\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status_to_from_proto\",\n@@ -305,6 +309,7 @@ ifrt_proxy_cc_test(\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/python/ifrt_proxy/common:types_proto_cc\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:status_matchers\",\n@@ -323,8 +328,8 @@ cc_library(\n     name = \"client_session\",\n     hdrs = [\"client_session.h\"],\n     deps = [\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_google_absl//absl/status\",\n     ],\n )\n@@ -335,9 +340,9 @@ cc_library(\n     hdrs = [\"mock_client_session.h\"],\n     deps = [\n         \":client_session\",\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_for_library\",\n     ],\n@@ -359,6 +364,7 @@ cc_library(\n         \"//xla/python/ifrt_proxy/server:host_callback\",\n         \"//xla/python/pjrt_ifrt\",\n         \"//xla/python/pjrt_ifrt:xla_ifrt\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status_to_from_proto\",\n@@ -389,6 +395,7 @@ ifrt_proxy_cc_test(\n         \"//xla/python/ifrt:serdes_version\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n@@ -430,6 +437,7 @@ cc_library(\n         \"//xla/python/ifrt_proxy/common:types\",\n         \"//xla/python/ifrt_proxy/common:versions\",\n         \"//xla/python/pjrt_ifrt\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n@@ -460,7 +468,7 @@ cc_library(\n     name = \"host_buffer\",\n     hdrs = [\"host_buffer.h\"],\n     deps = [\n-        \"//xla/python/ifrt\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:cord\",\n@@ -473,7 +481,7 @@ cc_library(\n     hdrs = [\"mock_host_buffer.h\"],\n     deps = [\n         \":host_buffer\",\n-        \"//xla/python/ifrt\",\n+        \"//xla/tsl/concurrency:future\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:cord\",\n         \"@com_google_googletest//:gtest_for_library\",\n@@ -489,13 +497,13 @@ cc_library(\n         \":host_buffer\",\n         \"//xla/pjrt:semaphore\",\n         \"//xla/pjrt/distributed:util\",\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt_proxy/common:grpc_ifrt_service_cc_grpc_proto\",\n         \"//xla/python/ifrt_proxy/common:grpc_ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:prof_util\",\n         \"//xla/python/ifrt_proxy/common:transfer_util\",\n         \"//xla/python/ifrt_proxy/common:versions\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/protobuf:status_proto_cc\",\n         \"@com_github_grpc_grpc//:grpc++\",\n@@ -524,12 +532,12 @@ cc_library(\n         \":rpc_helper\",\n         \":version\",\n         \"//xla/pjrt/distributed:util\",\n-        \"//xla/python/ifrt\",\n         \"//xla/python/ifrt:attribute_map\",\n         \"//xla/python/ifrt:serdes_any_version_accessor\",\n         \"//xla/python/ifrt:serdes_version\",\n         \"//xla/python/ifrt_proxy/common:grpc_ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_github_grpc_grpc//:grpc++\",\n@@ -609,6 +617,7 @@ ifrt_proxy_cc_test(\n         \"//xla/python/ifrt_proxy/common:ifrt_service_proto_cc\",\n         \"//xla/python/ifrt_proxy/common:test_utils\",\n         \"//xla/python/ifrt_proxy/common:types\",\n+        \"//xla/tsl/concurrency:future\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/util/proto:proto_matchers\","
        },
        {
            "sha": "83ab0b9d69f2c0f53adea0b84c9159962192b17d",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/array.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -45,7 +45,6 @@\n #include \"xla/python/ifrt/client.h\"\n #include \"xla/python/ifrt/client_impl_util.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/remap_plan.h\"\n #include \"xla/python/ifrt/shape.h\"\n #include \"xla/python/ifrt/sharding.h\"\n@@ -57,6 +56,7 @@\n #include \"xla/python/ifrt_proxy/common/types.pb.h\"\n #include \"xla/python/ifrt_proxy/common/versions.h\"\n #include \"xla/status_macros.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/status_to_from_proto.h\"\n@@ -70,7 +70,7 @@ namespace proxy {\n namespace {\n \n template <typename T>\n-void CheckResponseAfterAsyncCall(const Future<std::shared_ptr<T>>& f,\n+void CheckResponseAfterAsyncCall(const tsl::Future<std::shared_ptr<T>>& f,\n                                  ArrayHandle handle) {\n   f.OnReady([handle](absl::StatusOr<std::shared_ptr<T>> r) {\n     if (r.ok()) {\n@@ -84,7 +84,7 @@ void CheckResponseAfterAsyncCall(const Future<std::shared_ptr<T>>& f,\n }\n \n template <typename T>\n-void CheckResponseAfterAsyncCall(const Future<std::shared_ptr<T>>& f,\n+void CheckResponseAfterAsyncCall(const tsl::Future<std::shared_ptr<T>>& f,\n                                  const std::vector<ArrayHandle>& handles) {\n   f.OnReady([handles = handles](absl::StatusOr<std::shared_ptr<T>> r) {\n     if (r.ok()) {\n@@ -435,11 +435,11 @@ void Array::Destruct(RpcHelper* rpc_helper, ArrayHandle handle) {\n           });\n }\n \n-Future<> Array::GetReadyFuture() const {\n+tsl::Future<> Array::GetReadyFuture() const {\n   tsl::profiler::TraceMe traceme_ifrt_entrypoint(\n       \"IfrtProxyEntrypointArrayGetReadyFuture\");\n   if (IsDeleted()) {\n-    return Future<>(absl::InvalidArgumentError(\"Already deleted array.\"));\n+    return tsl::Future<>(absl::InvalidArgumentError(\"Already deleted array.\"));\n   }\n \n   absl::MutexLock lock(mu_);\n@@ -451,7 +451,7 @@ Future<> Array::GetReadyFuture() const {\n   auto req = std::make_unique<CheckValueReadyRequest>();\n   req->add_value_handles(handle_.handle);\n \n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n   rpc_helper_->CheckValueReady(std::move(req))\n       .OnReady([promise = std::move(promise)](\n                    absl::StatusOr<std::shared_ptr<CheckValueReadyResponse>>\n@@ -460,14 +460,14 @@ Future<> Array::GetReadyFuture() const {\n   return ready_future_;\n }\n \n-Future<> Array::Delete() {\n+tsl::Future<> Array::Delete() {\n   {\n     absl::MutexLock lock(mu_);\n     deleted_ = DeletionState::kDeleted;\n   }\n   if (rpc_helper_->protocol_version() >= 5) {\n     rpc_helper_->Batch(RpcHelper::kDeleteArray, handle_);\n-    return Future<>(absl::OkStatus());\n+    return tsl::Future<>(absl::OkStatus());\n   }\n \n   auto req = std::make_unique<DeleteArrayRequest>();\n@@ -476,7 +476,7 @@ Future<> Array::Delete() {\n   absl::StatusOr<std::shared_ptr<DeleteArrayResponse>> response =\n       rpc_helper_->DeleteArray(std::move(req)).Await();\n   if (!response.ok()) {\n-    return Future<>(response.status());\n+    return tsl::Future<>(response.status());\n   }\n \n   // TODO(b/266635130): So that the caller is not blocked until the server\n@@ -795,29 +795,29 @@ absl::StatusOr<xla::ifrt::ArrayRef> Array::FullyReplicatedShard(\n       result_handle, this->custom_layout()));\n }\n \n-Future<> Array::CopyToStringHostBuffer(\n+tsl::Future<> Array::CopyToStringHostBuffer(\n     void* data, std::optional<absl::Span<const int64_t>> byte_strides,\n     ArrayCopySemantics semantics) {\n   tsl::profiler::TraceMe traceme_ifrt_entrypoint(\n       \"IfrtProxyEntrypointCopyToStringHostBuffer\");\n   if (rpc_helper_->protocol_version() < 9) {\n-    return Future<>(absl::UnimplementedError(\n+    return tsl::Future<>(absl::UnimplementedError(\n         \"String arrays are not supported in ifrt-proxy version < 9\"));\n   }\n   auto req = std::make_unique<CopyToHostBufferRequest>();\n   absl::StatusOr<ArrayHandle> handle = GetHandle(semantics);\n   if (!handle.ok()) {\n-    return Future<>(handle.status());\n+    return tsl::Future<>(handle.status());\n   }\n   req->set_array_handle(handle->handle);\n   if (byte_strides.has_value()) {\n-    return Future<>(absl::InvalidArgumentError(\n+    return tsl::Future<>(absl::InvalidArgumentError(\n         \"Byte strides are not supported for string arrays.\"));\n   }\n \n   const uint64_t host_buffer_handle = rpc_helper_->NextHandle();\n   req->set_host_buffer_handle(host_buffer_handle);\n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n   auto on_ready = [promise = std::move(promise),\n                    host_buffer_store = rpc_helper_->host_buffer_store(),\n                    host_buffer_handle,\n@@ -858,7 +858,7 @@ Future<> Array::CopyToStringHostBuffer(\n   return std::move(future);\n }\n \n-Future<> Array::CopyToHostBuffer(\n+tsl::Future<> Array::CopyToHostBuffer(\n     void* data, std::optional<absl::Span<const int64_t>> byte_strides,\n     ArrayCopySemantics semantics) {\n   if (dtype_.kind() == DType::kString) {\n@@ -868,13 +868,13 @@ Future<> Array::CopyToHostBuffer(\n   const auto mem_region = ArrayMemRegion::FromZerothElementPointer(\n       /*zeroth_element=*/data, dtype_, shape_, byte_strides);\n   if (!mem_region.ok()) {\n-    return Future<>(mem_region.status());\n+    return tsl::Future<>(mem_region.status());\n   }\n \n   auto req = std::make_unique<CopyToHostBufferRequest>();\n   absl::StatusOr<ArrayHandle> handle = GetHandle(semantics);\n   if (!handle.ok()) {\n-    return Future<>(handle.status());\n+    return tsl::Future<>(handle.status());\n   }\n   req->set_array_handle(handle->handle);\n   if (byte_strides.has_value()) {\n@@ -883,7 +883,7 @@ Future<> Array::CopyToHostBuffer(\n   const uint64_t host_buffer_handle = rpc_helper_->NextHandle();\n   req->set_host_buffer_handle(host_buffer_handle);\n \n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n   auto on_ready = [host_buffer_store = rpc_helper_->host_buffer_store(),\n                    promise = std::move(promise), host_buffer_handle,\n                    mem_region = mem_region->mem_region()]("
        },
        {
            "sha": "722cc360a5b1ffafc423afa815f28c975528de38",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/array.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -37,7 +37,6 @@\n #include \"xla/python/ifrt/array_spec.h\"\n #include \"xla/python/ifrt/client.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/remap_plan.h\"\n #include \"xla/python/ifrt/shape.h\"\n #include \"xla/python/ifrt/sharding.h\"\n@@ -46,6 +45,7 @@\n #include \"xla/python/ifrt/value.h\"\n #include \"xla/python/ifrt_proxy/client/rpc_helper.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n \n namespace xla {\n@@ -145,8 +145,8 @@ class Array final : public llvm::RTTIExtends<Array, xla::ifrt::Array> {\n   }\n \n   xla::ifrt::Client* client() const override;\n-  Future<> GetReadyFuture() const override;\n-  Future<> Delete() override;\n+  tsl::Future<> GetReadyFuture() const override;\n+  tsl::Future<> Delete() override;\n   bool IsDeleted() const override;\n   std::string DebugString() const override;\n \n@@ -167,7 +167,7 @@ class Array final : public llvm::RTTIExtends<Array, xla::ifrt::Array> {\n       xla::ifrt::ArrayCopySemantics semantics) override;\n \n   ABSL_MUST_USE_RESULT\n-  Future<> CopyToHostBuffer(\n+  tsl::Future<> CopyToHostBuffer(\n       void* data, std::optional<absl::Span<const int64_t>> byte_strides,\n       ArrayCopySemantics semantics) override;\n \n@@ -177,7 +177,7 @@ class Array final : public llvm::RTTIExtends<Array, xla::ifrt::Array> {\n   template <typename T, typename... Args>\n   friend tsl::RCReference<T> tsl::MakeRef(Args&&... args);\n \n-  Future<> CopyToStringHostBuffer(\n+  tsl::Future<> CopyToStringHostBuffer(\n       void* data, std::optional<absl::Span<const int64_t>> byte_strides,\n       ArrayCopySemantics semantics);\n \n@@ -210,7 +210,7 @@ class Array final : public llvm::RTTIExtends<Array, xla::ifrt::Array> {\n   };\n   mutable DeletionState deleted_ ABSL_GUARDED_BY(mu_) = DeletionState::kAlive;\n \n-  mutable Future<> ready_future_ ABSL_GUARDED_BY(mu_);\n+  mutable tsl::Future<> ready_future_ ABSL_GUARDED_BY(mu_);\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "012e2931f6546f18b6523949356b1c7b7d16e935",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/array_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -31,7 +31,6 @@\n #include \"xla/python/ifrt/basic_device_list.h\"\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/memory.h\"\n #include \"xla/python/ifrt/mock.h\"\n #include \"xla/python/ifrt/remap_plan.h\"\n@@ -48,6 +47,7 @@\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n #include \"xla/python/ifrt_proxy/common/types.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"xla/tsl/platform/status_matchers.h\"\n@@ -92,10 +92,10 @@ class ArrayTest : public ::testing::Test {\n     // Default handler that ignores all uninteresting requests, but still\n     // invokes the callback in order to avoid hanging the caller forever.\n     EXPECT_CALL(*session_, Enqueue(_))\n-        .WillRepeatedly(Return(Future<ClientSession::Response>(\n+        .WillRepeatedly(Return(tsl::Future<ClientSession::Response>(\n             absl::InternalError(\"Request has no mock handlers\"))));\n     EXPECT_CALL(*host_buffer_store_, Store(_, testing::An<absl::string_view>()))\n-        .WillRepeatedly(Return(Future<>(absl::OkStatus())));\n+        .WillRepeatedly(Return(tsl::Future<>(absl::OkStatus())));\n \n     ON_CALL(*mock_client_, MakeDeviceList(_))\n         .WillByDefault([](absl::Span<xla::ifrt::Device* const> devices) {"
        },
        {
            "sha": "4e70dcce93f73365bdde2a40c374512f56e34d8d",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -45,7 +45,6 @@\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/memory.h\"\n #include \"xla/python/ifrt/remap_plan.h\"\n #include \"xla/python/ifrt/shape.h\"\n@@ -59,6 +58,7 @@\n #include \"xla/python/ifrt_proxy/common/types.h\"\n #include \"xla/python/ifrt_proxy/common/versions.h\"\n #include \"xla/python/pjrt_ifrt/pjrt_attribute_map_util.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/xla_data.pb.h\"\n@@ -375,13 +375,13 @@ absl::StatusOr<std::vector<xla::ifrt::ArrayRef>> Client::RemapArrays(\n   return Array::RemapArrays(this, rpc_helper_, plan, arrays, semantics);\n }\n \n-xla::ifrt::Future<> Client::GetReadyFuture(\n+tsl::Future<> Client::GetReadyFuture(\n     absl::Span<const xla::ifrt::ValueRef> values) {\n   tsl::profiler::TraceMe traceme_ifrt_entrypoint([n_values = values.size()]() {\n     return tsl::profiler::TraceMeEncode(\"IfrtProxyEntrypointGetReadyFuture\",\n                                         {{\"n_values\", n_values}});\n   });\n-  absl::InlinedVector<Future<>, 1> futures;\n+  absl::InlinedVector<tsl::Future<>, 1> futures;\n \n   auto req = std::make_unique<CheckValueReadyRequest>();\n   for (const auto& value : values) {\n@@ -392,7 +392,7 @@ xla::ifrt::Future<> Client::GetReadyFuture(\n       absl::StatusOr<ArrayHandle> handle =\n           proxy_array->GetHandle(ArrayCopySemantics::kAlwaysCopy);\n       if (!handle.ok()) {\n-        futures.push_back(Future<>(handle.status()));\n+        futures.push_back(tsl::Future<>(handle.status()));\n       } else {\n         req->add_value_handles(handle->handle);\n       }\n@@ -401,7 +401,7 @@ xla::ifrt::Future<> Client::GetReadyFuture(\n     }\n   }\n \n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n   rpc_helper_->CheckValueReady(std::move(req))\n       .OnReady([promise = std::move(promise)](\n                    absl::StatusOr<std::shared_ptr<CheckValueReadyResponse>>"
        },
        {
            "sha": "052e13bee2ecde4f072cbffc0fd00faf4912439f",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client.h",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -41,7 +41,6 @@\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/memory.h\"\n #include \"xla/python/ifrt/remap_plan.h\"\n #include \"xla/python/ifrt/shape.h\"\n@@ -55,6 +54,7 @@\n #include \"xla/python/ifrt_proxy/client/memory.h\"\n #include \"xla/python/ifrt_proxy/client/rpc_helper.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n \n namespace xla {\n@@ -103,8 +103,7 @@ class Client final : public llvm::RTTIExtends<Client, xla::ifrt::Client> {\n         \"ReshardArrays is not supported for the IFRT proxy client.\");\n   }\n \n-  xla::ifrt::Future<> GetReadyFuture(\n-      absl::Span<const ValueRef> values) override;\n+  tsl::Future<> GetReadyFuture(absl::Span<const ValueRef> values) override;\n \n   absl::StatusOr<tsl::RCReference<Tuple>> MakeTuple(\n       absl::Span<ValueRef> values) override {"
        },
        {
            "sha": "254087ae43f4a8add6a1932ba200c80e2d964b97",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client_session.h",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_session.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_session.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_session.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -20,8 +20,8 @@\n #include <memory>\n \n #include \"absl/status/status.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n \n namespace xla {\n namespace ifrt {\n@@ -42,7 +42,8 @@ class ClientSession {\n   // FIFO order. The caller must ensure that `request->op_id()` is unique\n   // throughout the stream's lifetime. The returned future becomes ready when a\n   // response for the given op id becomes ready.\n-  virtual Future<Response> Enqueue(std::unique_ptr<IfrtRequest> request) = 0;\n+  virtual tsl::Future<Response> Enqueue(\n+      std::unique_ptr<IfrtRequest> request) = 0;\n \n   // Terminates the `ClientSession` if it has not already been terminated.\n   virtual void Finish(const absl::Status& s) {}"
        },
        {
            "sha": "fdeacb6221a535b7e5421e3401c1bf545b404677",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/client_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fclient_test.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -34,7 +34,6 @@\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/dtype.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/memory.h\"\n #include \"xla/python/ifrt/serdes_version.h\"\n #include \"xla/python/ifrt/shape.h\"\n@@ -49,6 +48,7 @@\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n #include \"xla/service/computation_placer.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/util/proto/proto_matchers.h\"\n@@ -344,7 +344,7 @@ TEST_P(ClientTest, GetCachedDefaultLayoutSuccess) {\n TEST_P(ClientTest, GetDefaultLayoutFailure) {\n   EXPECT_CALL(*session_,\n               Enqueue(IfrtRequestOfType(IfrtRequest::kGetDefaultLayoutRequest)))\n-      .WillOnce(Return(Future<ClientSession::Response>(\n+      .WillOnce(Return(tsl::Future<ClientSession::Response>(\n           absl::InternalError(\"injected from test\"))));\n \n   EXPECT_THAT(client_->GetDefaultPjRtLayout(DType(DType::kF64), {1, 2, 3},\n@@ -456,7 +456,7 @@ TEST_P(ClientTest, GetDefaultDeviceAssignmentFailure) {\n                                  num_partitions: 3\n                                }\n                              )pb\")))))\n-      .WillOnce(Return(Future<ClientSession::Response>(\n+      .WillOnce(Return(tsl::Future<ClientSession::Response>(\n           absl::InternalError(\"injected from test\"))));\n \n   EXPECT_THAT(client_->GetDefaultDeviceAssignment(1, 3),"
        },
        {
            "sha": "9d11e6f31d1fe39929b1a457c1177121eb16cc8a",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/compiler.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -32,7 +32,6 @@\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/executable.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/host_callback.h\"\n #include \"xla/python/ifrt/program.h\"\n #include \"xla/python/ifrt/serdes.h\"\n@@ -44,6 +43,7 @@\n #include \"xla/python/ifrt_proxy/server/host_callback.h\"\n #include \"xla/python/pjrt_ifrt/pjrt_host_callback.h\"\n #include \"xla/python/pjrt_ifrt/xla_compiler.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/status_to_from_proto.h\"\n@@ -152,7 +152,7 @@ absl::StatusOr<xla::ifrt::LoadedExecutableRef> Compiler::CompileAndLoad(\n       break;\n   }\n \n-  Future<> ready_future =\n+  tsl::Future<> ready_future =\n       rpc_helper_->CheckFuture(response->ready_future_handle());\n \n   std::vector<uint64_t> loaded_host_callback_handles("
        },
        {
            "sha": "aa08a56f1672b381b0d07365a775d57a91658025",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/compiler_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fcompiler_test.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -30,7 +30,6 @@\n #include \"xla/python/ifrt/basic_device_list.h\"\n #include \"xla/python/ifrt/compiler.h\"\n #include \"xla/python/ifrt/device.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/mock.h\"\n #include \"xla/python/ifrt/program.h\"\n #include \"xla/python/ifrt/serdes.h\"\n@@ -43,6 +42,7 @@\n #include \"xla/python/ifrt_proxy/client/version.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"tsl/platform/protobuf.h\"  // IWYU pragma: keep\n #include \"tsl/platform/status_matchers.h\"\n@@ -151,7 +151,7 @@ class CompilerTest : public testing::Test {\n     // Default handler that ignores all uninteresting requests but still\n     // invokes the callback in order to avoid hanging the caller forever.\n     EXPECT_CALL(*session_, Enqueue(_))\n-        .WillRepeatedly(Return(Future<ClientSession::Response>(\n+        .WillRepeatedly(Return(tsl::Future<ClientSession::Response>(\n             absl::InternalError(\"Request has no mock handlers\"))));\n   }\n "
        },
        {
            "sha": "1d209b7727f0353e9c07142f28bfe1e362923fa2",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -50,7 +50,6 @@\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/dtype.h\"\n #include \"xla/python/ifrt/executable.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/host_callback.h\"\n #include \"xla/python/ifrt/shape.h\"\n #include \"xla/python/ifrt/sharding.h\"\n@@ -63,6 +62,7 @@\n #include \"xla/python/ifrt_proxy/common/versions.h\"\n #include \"xla/python/pjrt_ifrt/pjrt_host_callback.h\"\n #include \"xla/shape_util.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n@@ -339,7 +339,7 @@ LoadedExecutable::LoadedExecutable(\n     uint64_t handle, std::string name, int num_devices, DeviceListRef devices,\n     std::vector<xla::ifrt::Device*> addressable_devices,\n     absl::StatusOr<std::optional<std::string>> fingerprint,\n-    Future<> ready_future,\n+    tsl::Future<> ready_future,\n     std::vector<tsl::RCReference<xla::ifrt::LoadedHostCallback>>\n         loaded_host_callbacks,\n     std::vector<uint64_t> loaded_host_callback_handles)\n@@ -376,7 +376,8 @@ LoadedExecutable::LoadedExecutable(\n   // eagerly schedule this fetch since, in some implementations, it may take a\n   // long time for sharding information to be available.\n \n-  auto [promise, future] = Future<std::shared_ptr<Metadata>>::MakePromise();\n+  auto [promise, future] =\n+      tsl::Future<std::shared_ptr<Metadata>>::MakePromise();\n   metadata_future_ = std::move(future);\n \n   auto req = std::make_unique<LoadedExecutableMetadataRequest>();\n@@ -530,7 +531,7 @@ absl::StatusOr<std::string> LoadedExecutable::Serialize() const {\n       \"underlying serialization format is not stable\");\n }\n \n-Future<> LoadedExecutable::GetReadyFuture() const { return ready_future_; }\n+tsl::Future<> LoadedExecutable::GetReadyFuture() const { return ready_future_; }\n \n int LoadedExecutable::num_devices() const { return num_devices_; }\n "
        },
        {
            "sha": "9eda82f290498ea524900bdc1840ce1d499f594f",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -43,10 +43,10 @@\n #include \"xla/python/ifrt/device.h\"\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/executable.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/host_callback.h\"\n #include \"xla/python/ifrt/user_context.h\"\n #include \"xla/python/ifrt_proxy/client/rpc_helper.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/xla_data.pb.h\"\n \n@@ -62,7 +62,7 @@ class LoadedExecutable final\n                    std::string name, int num_devices, DeviceListRef devices,\n                    std::vector<xla::ifrt::Device*> addressable_devices,\n                    absl::StatusOr<std::optional<std::string>> fingerprint,\n-                   Future<> ready_future,\n+                   tsl::Future<> ready_future,\n                    std::vector<tsl::RCReference<xla::ifrt::LoadedHostCallback>>\n                        loaded_host_callbacks,\n                    std::vector<uint64_t> loaded_host_callback_handles);\n@@ -80,7 +80,7 @@ class LoadedExecutable final\n   xla::ifrt::UserContextRef user_context() const override {\n     return user_context_;\n   }\n-  Future<> GetReadyFuture() const override;\n+  tsl::Future<> GetReadyFuture() const override;\n \n   int num_devices() const override;\n   int64_t SizeOfGeneratedCodeInBytes() const override;\n@@ -150,15 +150,15 @@ class LoadedExecutable final\n   const DeviceListRef devices_;\n   const std::vector<xla::ifrt::Device*> addressable_devices_;\n   const absl::StatusOr<std::optional<std::string>> fingerprint_;\n-  const Future<> ready_future_;\n+  const tsl::Future<> ready_future_;\n   const xla::ifrt::UserContextRef user_context_;\n \n   class OutputSpecCache;\n   const std::unique_ptr<OutputSpecCache> output_spec_cache_;\n \n   // Metadata queried when the executable is created. Declared as `mutable`\n-  // since `Future::Await()` is not const.\n-  mutable Future<std::shared_ptr<Metadata>> metadata_future_;\n+  // since `tsl::Future::Await()` is not const.\n+  mutable tsl::Future<std::shared_ptr<Metadata>> metadata_future_;\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "9f0a7ac5f0f6bba644a60f271ca1a6ba17ecef61",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/executable_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fexecutable_test.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -33,7 +33,6 @@\n #include \"xla/python/ifrt/device_list.h\"\n #include \"xla/python/ifrt/dtype.h\"\n #include \"xla/python/ifrt/executable.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/memory.h\"\n #include \"xla/python/ifrt/mock.h\"\n #include \"xla/python/ifrt/serdes_version.h\"\n@@ -49,6 +48,7 @@\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/util/proto/proto_matchers.h\"\n@@ -89,7 +89,7 @@ class LoadedExecutableTest : public ::testing::Test {\n     // Default handler that ignores all uninteresting requests, but still\n     // invokes the callback in order to avoid hanging the caller forever.\n     EXPECT_CALL(*session_, Enqueue(_))\n-        .WillRepeatedly(Return(Future<ClientSession::Response>(\n+        .WillRepeatedly(Return(tsl::Future<ClientSession::Response>(\n             absl::InternalError(\"Request has no mock handlers\"))));\n   }\n \n@@ -141,7 +141,7 @@ TEST_F(LoadedExecutableTest, Metadata) {\n       /*num_devices=*/2, /*devices=*/{},\n       /*addressable_devices=*/{},\n       /*fingerprint=*/\"fingerprint\",\n-      /*ready_future=*/Future<>(absl::OkStatus()),\n+      /*ready_future=*/tsl::Future<>(absl::OkStatus()),\n       /*loaded_host_callbacks=*/{}, /*loaded_host_callback_handles=*/{});\n \n   EXPECT_EQ(requests_queue.Pop()\n@@ -223,7 +223,7 @@ TEST_F(LoadedExecutableTest, Execute) {\n       &client, rpc_helper_, /*handle=*/1234, /*name=*/\"foo\",\n       /*num_devices=*/2, /*devices=*/{}, /*addressable_devices=*/{},\n       /*fingerprint=*/\"fingerprint\",\n-      /*ready_future=*/Future<>(absl::OkStatus()),\n+      /*ready_future=*/tsl::Future<>(absl::OkStatus()),\n       /*loaded_host_callbacks=*/{}, /*loaded_host_callback_handles=*/{});\n \n   xla::ifrt::LoadedExecutable::ExecuteOptions exec_options;"
        },
        {
            "sha": "59a4bbea772ebc441245e49611a8b34bb902d921",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/grpc_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -28,7 +28,6 @@\n #include \"grpcpp/grpcpp.h\"\n #include \"xla/pjrt/distributed/util.h\"\n #include \"xla/python/ifrt/attribute_map.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/serdes_any_version_accessor.h\"\n #include \"xla/python/ifrt/serdes_version.h\"\n #include \"xla/python/ifrt_proxy/client/client.h\"\n@@ -40,6 +39,7 @@\n #include \"xla/python/ifrt_proxy/client/version.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\"\n #include \"tsl/platform/stacktrace.h\"\n@@ -67,7 +67,7 @@ absl::StatusOr<std::unique_ptr<Client>> AttemptConnection(\n     const ClientConnectionOptions& options) {\n   std::unique_ptr<RpcHelper> rpc_helper;\n   auto [init_response_promise, init_response_future] =\n-      Future<std::shared_ptr<InitResponse>>::MakePromise();\n+      tsl::Future<std::shared_ptr<InitResponse>>::MakePromise();\n \n   // TODO(b/266635130): Move gRPC stub creation to be outside of `Client` so\n   // that we can pass mock `ClientSession` to the client."
        },
        {
            "sha": "01ddd070ccf3bbbf2a6ec8c748978630dd940fbe",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/grpc_client_session.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -38,11 +38,11 @@\n #include \"grpcpp/security/credentials.h\"\n #include \"grpcpp/support/channel_arguments.h\"\n #include \"xla/pjrt/distributed/util.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_credentials_possibly_insecure_wrapper.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.grpc.pb.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"tsl/platform/env.h\"\n #include \"tsl/platform/errors.h\"\n #include \"tsl/platform/logging.h\"\n@@ -122,9 +122,10 @@ GrpcClientSession::GrpcClientSession(\n       absl::bind_front(&GrpcClientSession::ReadLoop, this));\n }\n \n-Future<std::shared_ptr<IfrtResponse>> GrpcClientSession::Enqueue(\n+tsl::Future<std::shared_ptr<IfrtResponse>> GrpcClientSession::Enqueue(\n     std::unique_ptr<IfrtRequest> request) {\n-  auto [promise, future] = Future<std::shared_ptr<IfrtResponse>>::MakePromise();\n+  auto [promise, future] =\n+      tsl::Future<std::shared_ptr<IfrtResponse>>::MakePromise();\n   auto shared_promise = std::move(promise).ToShared();\n   absl::Status status = Enqueue(\n       std::move(request),"
        },
        {
            "sha": "44197aa40352493ebbb6690301d178ca2b82ce69",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/grpc_client_session.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_client_session.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -31,11 +31,11 @@\n #include \"grpcpp/client_context.h\"\n #include \"grpcpp/support/client_callback.h\"\n #include \"grpcpp/support/sync_stream.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/client_session.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.grpc.pb.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"tsl/platform/threadpool.h\"\n #include \"tsl/platform/unbounded_work_queue.h\"\n \n@@ -64,7 +64,7 @@ class GrpcClientSession : public ClientSession {\n       GrpcIfrtSessionMetadata metadata,\n       StreamTerminatedCallback stream_terminated_cb);\n \n-  Future<std::shared_ptr<IfrtResponse>> Enqueue(\n+  tsl::Future<std::shared_ptr<IfrtResponse>> Enqueue(\n       std::unique_ptr<IfrtRequest> request) override;\n \n   // `ResponseCallback` represents a function that can be invoked when\n@@ -133,10 +133,10 @@ class GrpcClientSession : public ClientSession {\n \n   const StreamTerminatedCallback stream_terminated_cb_;\n \n-  // Threadpool used to perform `Future<>::Promise::Set()` for Futures returned\n-  // to callers of `Enqueue(std::unique_ptr<IfrtRequest> request)`. We do this\n-  // because `Set()` may block on arbitrary `OnReady` callbacks set by those\n-  // callers.\n+  // Threadpool used to perform `tsl::Future<>::Promise::Set()` for Futures\n+  // returned to callers of `Enqueue(std::unique_ptr<IfrtRequest> request)`. We\n+  // do this because `Set()` may block on arbitrary `OnReady` callbacks set by\n+  // those callers.\n   std::unique_ptr<tsl::UnboundedWorkQueue> user_futures_work_queue_;\n };\n "
        },
        {
            "sha": "1ba01133cdc102536ad6229d933c57cf6aef4f1a",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/grpc_host_buffer.cc",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -32,13 +32,13 @@\n #include \"grpcpp/support/sync_stream.h\"\n #include \"xla/pjrt/distributed/util.h\"\n #include \"xla/pjrt/semaphore.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/global_flags.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.grpc.pb.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/prof_util.h\"\n #include \"xla/python/ifrt_proxy/common/transfer_util.h\"\n #include \"xla/python/ifrt_proxy/common/versions.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/protobuf/status.pb.h\"\n #include \"tsl/platform/unbounded_work_queue.h\"\n@@ -94,9 +94,9 @@ GrpcClientHostBufferStore::~GrpcClientHostBufferStore() {\n   LOG(INFO) << \"Destructed HostBufferStoreLookupsWorkQueue.\";\n }\n \n-Future<> GrpcClientHostBufferStore::StoreToDisk(uint64_t handle,\n-                                                absl::string_view data) {\n-  auto [promise, future] = Future<>::MakePromise();\n+tsl::Future<> GrpcClientHostBufferStore::StoreToDisk(uint64_t handle,\n+                                                     absl::string_view data) {\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n \n   XFlowHelper flow(\"GrpcClientHostBufferStore::StoreToDisk\");\n   flow.InstantActivity<XFlowHelper::kSend>();\n@@ -135,8 +135,8 @@ Future<> GrpcClientHostBufferStore::StoreToDisk(uint64_t handle,\n   return std::move(future);\n }\n \n-Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n-                                          absl::string_view data) {\n+tsl::Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n+                                               absl::string_view data) {\n   if (version_.protocol_version() >=\n       protocol_version::kGrpcAllowLargeTransferOptimizationViaSharedDirectory) {\n     int64_t threshold = GetGlobalClientFlags()\n@@ -146,7 +146,7 @@ Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n     }\n   }\n \n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n \n   XFlowHelper flow(\"GrpcClientHostBufferStore::StoreAsync\");\n   flow.InstantActivity<XFlowHelper::kSend>();\n@@ -199,8 +199,8 @@ Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n   return std::move(future);\n }\n \n-Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n-                                          const absl::Cord& data) {\n+tsl::Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n+                                               const absl::Cord& data) {\n   // The current implementation synchronously sends host buffer chunks. We may\n   // consider making it asynchronous if the caller can leverage such asynchrony.\n   tsl::profiler::TraceMe traceme(\"GrpcClientHostBufferStore::StoreSync\");\n@@ -235,19 +235,19 @@ Future<> GrpcClientHostBufferStore::Store(uint64_t handle,\n     }\n     if (!writer->WritesDone()) {\n       absl::Status s = xla::FromGrpcStatus(writer->Finish());\n-      return Future<>(absl::InternalError(absl::StrCat(\n+      return tsl::Future<>(absl::InternalError(absl::StrCat(\n           \"Failed to write all host buffer chunks, Finish() returned: \",\n           s.ToString())));\n     }\n   }\n   VLOG(3) << \"GrpcClientHostBufferStore::Store done \"\n           << metadata.ShortDebugString();\n \n-  return Future<>(xla::FromGrpcStatus(writer->Finish()));\n+  return tsl::Future<>(xla::FromGrpcStatus(writer->Finish()));\n }\n \n-Future<absl::Cord> GrpcClientHostBufferStore::Lookup(uint64_t handle) {\n-  auto [promise, future] = Future<absl::Cord>::MakePromise();\n+tsl::Future<absl::Cord> GrpcClientHostBufferStore::Lookup(uint64_t handle) {\n+  auto [promise, future] = tsl::Future<absl::Cord>::MakePromise();\n \n   XFlowHelper flow(\"GrpcClientHostBufferStore::Lookup\");\n   flow.InstantActivity<XFlowHelper::kSend>();\n@@ -287,7 +287,7 @@ Future<absl::Cord> GrpcClientHostBufferStore::Lookup(uint64_t handle) {\n   return std::move(future);\n }\n \n-Future<> GrpcClientHostBufferStore::Delete(uint64_t handle) {\n+tsl::Future<> GrpcClientHostBufferStore::Delete(uint64_t handle) {\n   GrpcHostBufferDeleteRequest request;\n   request.set_session_id(session_id_);\n   request.set_handle(handle);\n@@ -300,7 +300,7 @@ Future<> GrpcClientHostBufferStore::Delete(uint64_t handle) {\n       stub_->HostBufferDelete(&context, request, &response));\n   VLOG(3) << \"GrpcClientHostBufferStore::Delete done \"\n           << request.ShortDebugString();\n-  return Future<>(result);\n+  return tsl::Future<>(result);\n }\n \n }  // namespace proxy"
        },
        {
            "sha": "ae9465a28ac2008db7089526a78da32770cc641e",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/grpc_host_buffer.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fgrpc_host_buffer.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -24,10 +24,10 @@\n #include \"absl/strings/cord.h\"\n #include \"absl/strings/string_view.h\"\n #include \"xla/pjrt/semaphore.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/host_buffer.h\"\n #include \"xla/python/ifrt_proxy/common/grpc_ifrt_service.grpc.pb.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"tsl/platform/unbounded_work_queue.h\"\n \n namespace xla {\n@@ -44,13 +44,13 @@ class GrpcClientHostBufferStore : public ClientHostBufferStore {\n \n   // Implements ClientHostBufferStore.\n \n-  Future<> Store(uint64_t handle, absl::string_view data) override;\n-  Future<> Store(uint64_t handle, const absl::Cord& data) override;\n-  Future<absl::Cord> Lookup(uint64_t handle) override;\n-  Future<> Delete(uint64_t handle) override;\n+  tsl::Future<> Store(uint64_t handle, absl::string_view data) override;\n+  tsl::Future<> Store(uint64_t handle, const absl::Cord& data) override;\n+  tsl::Future<absl::Cord> Lookup(uint64_t handle) override;\n+  tsl::Future<> Delete(uint64_t handle) override;\n \n  private:\n-  Future<> StoreToDisk(uint64_t handle, absl::string_view data);\n+  tsl::Future<> StoreToDisk(uint64_t handle, absl::string_view data);\n \n   const std::shared_ptr<grpc::GrpcIfrtService::StubInterface> stub_;\n   const IfrtProxyVersion version_;"
        },
        {
            "sha": "41addffea92ff9d031d73798b81838ca5d4dd67d",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/host_buffer.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fhost_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fhost_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fhost_buffer.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -22,7 +22,7 @@\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/cord.h\"\n #include \"absl/strings/string_view.h\"\n-#include \"xla/python/ifrt/future.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n \n namespace xla {\n namespace ifrt {\n@@ -34,20 +34,20 @@ class ClientHostBufferStore {\n \n   // Stores the data associated with the given handle. Returns an error if the\n   // handle already exists.\n-  virtual Future<> Store(uint64_t handle, absl::string_view data) = 0;\n+  virtual tsl::Future<> Store(uint64_t handle, absl::string_view data) = 0;\n \n   // Stores the data associated with the given handle. Returns an error if the\n   // handle already exists.\n   // TODO(b/315023499) Find a way to increase the chunk size\n-  virtual Future<> Store(uint64_t handle, const absl::Cord& data) = 0;\n+  virtual tsl::Future<> Store(uint64_t handle, const absl::Cord& data) = 0;\n \n   // Retrieves the data associated with the handle. Returns an error if the\n   // handle does not exist.\n-  virtual Future<absl::Cord> Lookup(uint64_t handle) = 0;\n+  virtual tsl::Future<absl::Cord> Lookup(uint64_t handle) = 0;\n \n   // Deletes the host buffer associated with the handle. Returns an error if the\n   // handle does not exist.\n-  virtual Future<> Delete(uint64_t handle) = 0;\n+  virtual tsl::Future<> Delete(uint64_t handle) = 0;\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "03a48358ba377ce0ad0b5bb34976514baee5c4ba",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/mock_client_session.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_client_session.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_client_session.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_client_session.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -21,19 +21,19 @@\n \n #include <gmock/gmock.h>\n #include \"absl/status/status.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/client_session.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n \n namespace xla {\n namespace ifrt {\n namespace proxy {\n \n class MockClientSession final : public ClientSession {\n  public:\n-  MOCK_METHOD(Future<Response>, Enqueue, (std::unique_ptr<IfrtRequest> req),\n-              (override));\n+  MOCK_METHOD(tsl::Future<Response>, Enqueue,\n+              (std::unique_ptr<IfrtRequest> req), (override));\n   MOCK_METHOD(void, Finish, (const absl::Status& s), (override));\n };\n \n@@ -51,14 +51,14 @@ ACTION_P(MockClientCaptureAndReturn, requests_queue_param,\n   requests_queue->Push(*req);\n   response->mutable_response_metadata()->set_op_id(\n       arg0->request_metadata().op_id());\n-  return Future<ClientSession::Response>(std::move(response));\n+  return tsl::Future<ClientSession::Response>(std::move(response));\n }\n \n ACTION_P(MockClientSessionReturnResponse, response_proto) {\n   auto response = std::make_unique<IfrtResponse>(response_proto);\n   response->mutable_response_metadata()->set_op_id(\n       arg0->request_metadata().op_id());\n-  return Future<ClientSession::Response>(std::move(response));\n+  return tsl::Future<ClientSession::Response>(std::move(response));\n }\n \n }  // namespace proxy"
        },
        {
            "sha": "016894843f6f437d86a38e0575a03cdc1e620281",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/mock_host_buffer.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_host_buffer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_host_buffer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Fmock_host_buffer.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -22,21 +22,21 @@\n #include <gmock/gmock.h>\n #include \"absl/strings/cord.h\"\n #include \"absl/strings/string_view.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/host_buffer.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n \n namespace xla {\n namespace ifrt {\n namespace proxy {\n \n class MockClientHostBufferStore final : public ClientHostBufferStore {\n  public:\n-  MOCK_METHOD(Future<>, Store, (uint64_t handle, absl::string_view data),\n+  MOCK_METHOD(tsl::Future<>, Store, (uint64_t handle, absl::string_view data),\n               (override));\n-  MOCK_METHOD(Future<>, Store, (uint64_t handle, const absl::Cord& data),\n+  MOCK_METHOD(tsl::Future<>, Store, (uint64_t handle, const absl::Cord& data),\n               (override));\n-  MOCK_METHOD(Future<absl::Cord>, Lookup, (uint64_t handle), (override));\n-  MOCK_METHOD(Future<>, Delete, (uint64_t handle), (override));\n+  MOCK_METHOD(tsl::Future<absl::Cord>, Lookup, (uint64_t handle), (override));\n+  MOCK_METHOD(tsl::Future<>, Delete, (uint64_t handle), (override));\n };\n \n }  // namespace proxy"
        },
        {
            "sha": "9b7d92755eaf79e2f1f20bc0ad4b828217aa3f6b",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -33,12 +33,12 @@\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt_proxy/client/client_session.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/prof_util.h\"\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/status_to_from_proto.h\"\n #include \"xla/tsl/platform/threadpool.h\"\n@@ -112,12 +112,12 @@ class RpcHelper::Batcher {\n \n   // Sends the given request immediately after sending any batched operations\n   // that have been previously enqueued.\n-  Future<ClientSession::Response> Immediate(\n+  tsl::Future<ClientSession::Response> Immediate(\n       std::unique_ptr<IfrtRequest> request) {\n     absl::MutexLock l(mu_);\n     if (finished_) {\n       LOG(WARNING) << \"After RpcHelper::Finish(): \" << request->DebugString();\n-      return Future<ClientSession::Response>(\n+      return tsl::Future<ClientSession::Response>(\n           absl::FailedPreconditionError(\"RpcHelper::Finish() already called.\"));\n     }\n     Flush();\n@@ -239,19 +239,19 @@ class RpcHelper::Batcher {\n //\n // `profiling_name` needs to be a string literal.\n template <typename Req, typename Resp>\n-Future<std::shared_ptr<Resp>> DoRpc(RpcHelper::Batcher* batcher,\n-                                    void (IfrtRequest::*set_req)(Req*),\n-                                    Resp* (IfrtResponse::*get_resp)(),\n-                                    bool (IfrtResponse::*has_resp)() const,\n-                                    std::unique_ptr<Req> req,\n-                                    absl::string_view profiling_name) {\n+tsl::Future<std::shared_ptr<Resp>> DoRpc(RpcHelper::Batcher* batcher,\n+                                         void (IfrtRequest::*set_req)(Req*),\n+                                         Resp* (IfrtResponse::*get_resp)(),\n+                                         bool (IfrtResponse::*has_resp)() const,\n+                                         std::unique_ptr<Req> req,\n+                                         absl::string_view profiling_name) {\n   auto ifrt_req = std::make_unique<IfrtRequest>();\n   (ifrt_req.get()->*set_req)(req.release());\n \n   XFlowHelper x_flow_helper(profiling_name);\n   auto traceme = x_flow_helper.Span<XFlowHelper::kSend>();\n \n-  auto [promise, future] = Future<std::shared_ptr<Resp>>::MakePromise();\n+  auto [promise, future] = tsl::Future<std::shared_ptr<Resp>>::MakePromise();\n   auto on_ready = [promise = std::move(promise), has_resp, get_resp,\n                    profiling_name, x_flow_helper](\n                       absl::StatusOr<std::shared_ptr<IfrtResponse>> r) mutable {\n@@ -349,11 +349,11 @@ RPC(LoadedHostCallbackPoll, loaded_host_callback_poll);\n RPC(LoadedHostCallbackReturn, loaded_host_callback_return);\n RPC(GetDefaultLayout, get_default_layout);\n \n-Future<> RpcHelper::CheckFuture(uint64_t handle) {\n+tsl::Future<> RpcHelper::CheckFuture(uint64_t handle) {\n   auto req = std::make_unique<CheckFutureRequest>();\n   req->set_future_handle(handle);\n \n-  auto [promise, future] = Future<>::MakePromise();\n+  auto [promise, future] = tsl::Future<>::MakePromise();\n   CheckFuture(std::move(req))\n       .OnReady([promise = std::move(promise)](\n                    absl::StatusOr<std::shared_ptr<CheckFutureResponse>>"
        },
        {
            "sha": "8c5cc5f4d6706972cb877f9a69fbeec939026ba6",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper.h?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -25,13 +25,13 @@\n #include \"absl/base/thread_annotations.h\"\n #include \"absl/log/check.h\"\n #include \"absl/synchronization/mutex.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/serdes_any_version_accessor.h\"\n #include \"xla/python/ifrt/serdes_version.h\"\n #include \"xla/python/ifrt_proxy/client/client_session.h\"\n #include \"xla/python/ifrt_proxy/client/host_buffer.h\"\n #include \"xla/python/ifrt_proxy/common/ifrt_service.pb.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n \n namespace xla {\n namespace ifrt {\n@@ -76,7 +76,7 @@ class RpcHelper {\n   }\n \n   template <typename T>\n-  using ResponseFuture = Future<std::shared_ptr<T>>;\n+  using ResponseFuture = tsl::Future<std::shared_ptr<T>>;\n \n   class Batcher;\n   enum BatchOperation { kDeleteArray, kDestructArray, kSentinelDoNotUse };\n@@ -162,7 +162,7 @@ class RpcHelper {\n   // generated at the server side by IfrtBackend.\n   uint64_t NextHandle();\n \n-  Future<> CheckFuture(uint64_t handle);\n+  tsl::Future<> CheckFuture(uint64_t handle);\n \n  private:\n   const std::unique_ptr<Batcher> batcher_;"
        },
        {
            "sha": "9cc3c02ab56d8e5b478a06707d3bb2f1ce9e3278",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/rpc_helper_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dffac0970256d9e3e3e45fb44f910ece9340040d/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Frpc_helper_test.cc?ref=dffac0970256d9e3e3e45fb44f910ece9340040d",
            "patch": "@@ -23,7 +23,6 @@\n #include \"absl/status/status.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/time/time.h\"\n-#include \"xla/python/ifrt/future.h\"\n #include \"xla/python/ifrt/serdes_version.h\"\n #include \"xla/python/ifrt_proxy/client/client_session.h\"\n #include \"xla/python/ifrt_proxy/client/mock_client_session.h\"\n@@ -32,6 +31,7 @@\n #include \"xla/python/ifrt_proxy/common/test_utils.h\"\n #include \"xla/python/ifrt_proxy/common/types.h\"\n #include \"xla/python/ifrt_proxy/common/types.pb.h\"\n+#include \"xla/tsl/concurrency/future.h\"\n #include \"tsl/platform/test.h\"\n \n using ::testing::_;\n@@ -85,7 +85,7 @@ class RpcHelperTest : public ::testing::Test {\n     ON_CALL(*session_, Enqueue)\n         .WillByDefault([this](std::unique_ptr<IfrtRequest> req) {\n           requests_.Push(std::move(req));\n-          return Future<ClientSession::Response>(\n+          return tsl::Future<ClientSession::Response>(\n               absl::InternalError(\"Fake error response\"));\n         });\n   }"
        }
    ],
    "stats": {
        "total": 271,
        "additions": 141,
        "deletions": 130
    }
}