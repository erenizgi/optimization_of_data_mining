{
    "author": "GleasonK",
    "message": "[MHLO Sunset] Remove mlir_hlo deps from xla/tools\n\nPiperOrigin-RevId: 840367296",
    "sha": "2e6787c30d3c4e3cf49d12fb458dd117ce46c61f",
    "files": [
        {
            "sha": "fc069b2c9c75a53d43e292c1f16a2bea55f085c6",
            "filename": "third_party/xla/xla/tools/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2FBUILD?ref=2e6787c30d3c4e3cf49d12fb458dd117ce46c61f",
            "patch": "@@ -991,7 +991,6 @@ tsl_gpu_library(\n         \"//xla/hlo/builder:xla_computation\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/hlo/ir:hlo_module_group\",\n-        \"//xla/mlir_hlo\",\n         \"//xla/pjrt:mlir_to_hlo\",\n         \"//xla/service:compiler\",\n         \"//xla/service:executable\","
        },
        {
            "sha": "2d5d86eb434b59af49ff53586e569d3cc3844a70",
            "filename": "third_party/xla/xla/tools/hlo_opt/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2FBUILD?ref=2e6787c30d3c4e3cf49d12fb458dd117ce46c61f",
            "patch": "@@ -171,7 +171,6 @@ cc_library(\n         \"//xla/hlo/tools/hlo_opt:opt_lib\",\n         \"//xla/hlo/transforms:host_offloader\",\n         \"//xla/hlo/transforms/simplifiers:hlo_memory_scheduler\",\n-        \"//xla/hlo/translate/hlo_to_mhlo:hlo_to_mlir_hlo\",\n         \"//xla/service:batchnorm_expander\",\n         \"//xla/service:buffer_value\",\n         \"//xla/service:change_op_data_type\","
        },
        {
            "sha": "299836b8cd9d4da935e694bb93ee9c97eff9cdcd",
            "filename": "third_party/xla/xla/tools/hlo_opt/cpu_opt.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2Fcpu_opt.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2Fcpu_opt.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fhlo_opt%2Fcpu_opt.cc?ref=2e6787c30d3c4e3cf49d12fb458dd117ce46c61f",
            "patch": "@@ -39,7 +39,6 @@ limitations under the License.\n #include \"xla/hlo/tools/hlo_opt/opt_lib.h\"\n #include \"xla/hlo/transforms/host_offloader.h\"\n #include \"xla/hlo/transforms/simplifiers/hlo_memory_scheduler.h\"\n-#include \"xla/hlo/translate/hlo_to_mhlo/hlo_to_mlir_hlo.h\"\n #include \"xla/service/batchnorm_expander.h\"\n #include \"xla/service/buffer_value.h\"\n #include \"xla/service/change_op_data_type.h\""
        },
        {
            "sha": "01f7feac6b8f80e5a8b4af4b0d462bd36a368d68",
            "filename": "third_party/xla/xla/tools/xla_compile_lib.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 18,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fxla_compile_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2e6787c30d3c4e3cf49d12fb458dd117ce46c61f/third_party%2Fxla%2Fxla%2Ftools%2Fxla_compile_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftools%2Fxla_compile_lib.cc?ref=2e6787c30d3c4e3cf49d12fb458dd117ce46c61f",
            "patch": "@@ -30,20 +30,13 @@ limitations under the License.\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n-#include \"mlir/Dialect/Arith/IR/Arith.h\"\n-#include \"mlir/Dialect/Func/IR/FuncOps.h\"\n #include \"mlir/IR/BuiltinOps.h\"\n-#include \"mlir/IR/DialectRegistry.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"mlir/IR/OwningOpRef.h\"\n-#include \"mlir/Parser/Parser.h\"\n #include \"google/protobuf/text_format.h\"\n-#include \"stablehlo/dialect/Register.h\"\n #include \"xla/debug_options_flags.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n-#include \"xla/hlo/ir/hlo_module_group.h\"\n-#include \"xla/mlir_hlo/mhlo/IR/hlo_ops.h\"\n #include \"xla/pjrt/mlir_to_hlo.h\"\n #include \"xla/service/compiler.h\"\n #include \"xla/service/cpu/cpu_compiler.h\"\n@@ -71,7 +64,6 @@ limitations under the License.\n #include \"xla/util.h\"\n #include \"xla/xla.pb.h\"\n #include \"tsl/platform/path.h\"\n-#include \"tsl/platform/protobuf.h\"\n \n namespace xla {\n \n@@ -177,18 +169,12 @@ absl::StatusOr<std::unique_ptr<HloModule>> LoadModule(\n   TF_RETURN_IF_ERROR(tsl::ReadFileToString(\n       tsl::Env::Default(), std::string(module_path), &module_string));\n \n-  mlir::DialectRegistry dialects;\n-  // TODO(b/248362914): Register all required dialects.\n-  dialects.insert<mlir::arith::ArithDialect>();\n-  dialects.insert<mlir::mhlo::MhloDialect>();\n-  dialects.insert<mlir::func::FuncDialect>();\n-  mlir::stablehlo::registerAllDialects(dialects);\n-\n   // Parse MHLO module.\n   auto threading = mlir::MLIRContext::Threading::DISABLED;\n-  auto ctx = std::make_unique<mlir::MLIRContext>(dialects, threading);\n-  mlir::OwningOpRef<mlir::ModuleOp> module =\n-      mlir::parseSourceString<mlir::ModuleOp>(module_string, ctx.get());\n+  auto ctx = std::make_unique<mlir::MLIRContext>(threading);\n+\n+  TF_ASSIGN_OR_RETURN(mlir::OwningOpRef<mlir::ModuleOp> module,\n+                      ParseMlirModuleString(module_string, *ctx));\n \n   // Convert Mhlo to Hlo Module.\n   XlaComputation xla_computation;"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 4,
        "deletions": 21
    }
}