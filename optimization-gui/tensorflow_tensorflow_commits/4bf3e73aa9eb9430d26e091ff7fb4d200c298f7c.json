{
    "author": "hyeontaek",
    "message": "[IFRT] Migrate `Array::pjrt_layout()` callers to interpret `nullptr` as a default layout\n\n`Array::pjrt_layout()` will be changed to return `nullptr` to indicate a default layout, where the callers can obtain the corresponding concrete default layout by using `Client::GetDefaultPjRtLayout()`.\n\nThis change adds `nullptr` handling preemptively before the new `Array::pjrt_layout()` semantics becomes effective so that the existing code works as before.\n\nTests using `Array::pjrt_layout()` method calls are minimally updated to add a non-nullness check. They will be updated as `Array::pjrt_layout()` actually returns `nullptr`.\n\nPiperOrigin-RevId: 817516042",
    "sha": "4bf3e73aa9eb9430d26e091ff7fb4d200c298f7c",
    "files": [
        {
            "sha": "1c97620f61e63b9fa862944a8d982c045467dc15",
            "filename": "third_party/xla/xla/python/ifrt_proxy/client/array_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4bf3e73aa9eb9430d26e091ff7fb4d200c298f7c/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4bf3e73aa9eb9430d26e091ff7fb4d200c298f7c/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt_proxy%2Fclient%2Farray_test.cc?ref=4bf3e73aa9eb9430d26e091ff7fb4d200c298f7c",
            "patch": "@@ -167,6 +167,7 @@ TEST_F(ArrayTest, GetDefaultPjRtLayoutSuccess) {\n       mock_client_.get(), rpc_helper_, DType(DType::Kind::kBF16), Shape({}),\n       sharding_, ArrayHandle{1234}, /*layout=*/nullptr);\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_1, array->pjrt_layout());\n+  ASSERT_NE(layout_1, nullptr);\n   EXPECT_EQ(*layout_1, *kLayout1);\n }\n \n@@ -175,6 +176,7 @@ TEST_F(ArrayTest, GetCustomLayoutSuccess) {\n                                    DType(DType::Kind::kBF16), Shape({}),\n                                    sharding_, ArrayHandle{1234}, kLayout1);\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_1, array->pjrt_layout());\n+  ASSERT_NE(layout_1, nullptr);\n   EXPECT_EQ(*layout_1, *kLayout1);\n }\n \n@@ -218,8 +220,10 @@ TEST_F(ArrayTest, MakeArraysFromHostBufferShardsSuccess) {\n       xla::ifrt::Client::HostBufferSemantics::kImmutableOnlyDuringCall);\n   TF_ASSERT_OK(result.status());\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_1, result.value().at(0)->pjrt_layout());\n+  ASSERT_NE(layout_1, nullptr);\n   EXPECT_EQ(*layout_1, *kLayout1);\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_2, result.value().at(1)->pjrt_layout());\n+  ASSERT_NE(layout_2, nullptr);\n   EXPECT_EQ(*layout_2, *kLayout2);\n }\n \n@@ -241,6 +245,7 @@ TEST_F(ArrayTest, MakeErrorArraysSuccess) {\n                                        absl::MakeSpan(specs));\n   TF_ASSERT_OK(result.status());\n   TF_ASSERT_OK_AND_ASSIGN(auto layout, result.value().at(0)->pjrt_layout());\n+  ASSERT_NE(layout, nullptr);\n   EXPECT_EQ(*layout, *kLayout1);\n }\n \n@@ -270,6 +275,7 @@ TEST_F(ArrayTest, AssembleArrayFromSingleDeviceArraysSuccess) {\n       SingleDeviceShardSemantics::kAllShards);\n   TF_ASSERT_OK(result.status());\n   TF_ASSERT_OK_AND_ASSIGN(auto layout, result.value()->pjrt_layout());\n+  ASSERT_NE(layout, nullptr);\n   EXPECT_EQ(*layout, *kLayout1);\n }\n \n@@ -300,6 +306,7 @@ TEST_F(ArrayTest, AssembleArrayFromSingleDeviceArraysDefaultPjRtLayoutSuccess) {\n       SingleDeviceShardSemantics::kAllShards);\n   TF_ASSERT_OK(result.status());\n   TF_ASSERT_OK_AND_ASSIGN(auto layout, result.value()->pjrt_layout());\n+  ASSERT_NE(layout, nullptr);\n   EXPECT_EQ(*layout, *kLayout1);\n }\n \n@@ -345,8 +352,10 @@ TEST_F(ArrayTest, RemapArraysSuccess) {\n \n   TF_ASSERT_OK(result.status());\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_1, result.value().at(0)->pjrt_layout());\n+  ASSERT_NE(layout_1, nullptr);\n   EXPECT_EQ(*layout_1, *kLayout2);\n   TF_ASSERT_OK_AND_ASSIGN(auto layout_2, result.value().at(1)->pjrt_layout());\n+  ASSERT_NE(layout_2, nullptr);\n   EXPECT_EQ(*layout_2, *kLayout1);\n }\n "
        }
    ],
    "stats": {
        "total": 9,
        "additions": 9,
        "deletions": 0
    }
}