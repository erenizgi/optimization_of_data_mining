{
    "author": "tensorflower-gardener",
    "message": "[XLA:TPU] Fix regression by cl/797974240\n\nThe old implementation of ShapeTree ignores the shape in `operator==`. The refactoring incorrectly compared shape.\n\nThis CL fixes the regression by undo the unintended change.\n\nPiperOrigin-RevId: 799411563",
    "sha": "f02f68be7b8b3b18dc6dcff016d3498306a859fe",
    "files": [
        {
            "sha": "cbc481d9db85b7b7e5d4d0ea0b2644a88da12303",
            "filename": "third_party/xla/xla/shape_tree.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f02f68be7b8b3b18dc6dcff016d3498306a859fe/third_party%2Fxla%2Fxla%2Fshape_tree.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f02f68be7b8b3b18dc6dcff016d3498306a859fe/third_party%2Fxla%2Fxla%2Fshape_tree.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fshape_tree.h?ref=f02f68be7b8b3b18dc6dcff016d3498306a859fe",
            "patch": "@@ -293,7 +293,7 @@ class ShapeTree {\n   }\n \n   bool operator==(const ShapeTree<T>& other) const {\n-    return *shape_ == *other.shape_ && tuple_tree_ == other.tuple_tree_;\n+    return tuple_tree_ == other.tuple_tree_;\n   }\n   bool operator!=(const ShapeTree<T>& other) const { return !(*this == other); }\n "
        },
        {
            "sha": "dac7d4a491811aeb162d19cf933134b7ed6d3320",
            "filename": "third_party/xla/xla/shape_tree_test.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f02f68be7b8b3b18dc6dcff016d3498306a859fe/third_party%2Fxla%2Fxla%2Fshape_tree_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f02f68be7b8b3b18dc6dcff016d3498306a859fe/third_party%2Fxla%2Fxla%2Fshape_tree_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fshape_tree_test.cc?ref=f02f68be7b8b3b18dc6dcff016d3498306a859fe",
            "patch": "@@ -385,6 +385,22 @@ TEST_F(ShapeTreeTest, OperatorEquals) {\n     EXPECT_TRUE(b == c);\n     EXPECT_FALSE(b != c);\n   }\n+  {\n+    Shape array_shape1 = ShapeUtil::MakeShape(F32, {1});\n+    Shape array_shape2 = ShapeUtil::MakeShape(F32, {2});\n+    Shape array_shape3 = ShapeUtil::MakeShape(S32, {1});\n+    ShapeTree<int> a(array_shape1, 7);\n+    ShapeTree<int> b(array_shape2, 7);\n+    ShapeTree<int> c(array_shape3, 7);\n+    EXPECT_TRUE(a == b);\n+    EXPECT_TRUE(a == c);\n+\n+    Shape tuple1 = ShapeUtil::MakeTupleShape({array_shape1, array_shape3});\n+    Shape tuple2 = ShapeUtil::MakeTupleShape({array_shape2, array_shape1});\n+    ShapeTree<int> d(tuple1, 8);\n+    ShapeTree<int> e(tuple2, 8);\n+    EXPECT_TRUE(d == e);\n+  }\n }\n \n TEST_F(ShapeTreeTest, ConstructWithPointerToShape) {"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
    }
}