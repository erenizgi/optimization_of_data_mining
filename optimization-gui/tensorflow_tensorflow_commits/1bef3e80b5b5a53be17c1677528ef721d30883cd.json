{
    "author": "KanishAnand",
    "message": "Reuse tuple elements field from existing `HloSharding`\n\nPiperOrigin-RevId: 826058519",
    "sha": "1bef3e80b5b5a53be17c1677528ef721d30883cd",
    "files": [
        {
            "sha": "50805507cee74b07bb7021d754fe4437238570ff",
            "filename": "third_party/xla/xla/hlo/ir/hlo_sharding.h",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fhlo_sharding.h?ref=1bef3e80b5b5a53be17c1677528ef721d30883cd",
            "patch": "@@ -774,6 +774,13 @@ class HloSharding {\n   // or else are ignored. This is to facilitate migration from the old sharding\n   // format.\n   //\n+  // Note that for tuple NamedShardings, we reuse HloSharding's tuple_elements_\n+  // field. If named sharding format is enabled each element in tuple_elements_\n+  // will be an HloSharding, which itself can be a tuple or should only have\n+  // named_sharding_ populated. This approach is taken to maintain backward\n+  // compatibility with the existing `tuple_elements()` method, which provides a\n+  // modifiable reference to a `std::vector<HloSharding>`.\n+  //\n   // Note that instead of reusing HloSharding's fields like metadata, we have\n   // separate fields in NamedSharding to treat it as a standalone message which\n   // is more clear and will help in future cleanup."
        },
        {
            "sha": "b20e2d2f44a9b226baa69cfbc9f36da4235d9e2e",
            "filename": "third_party/xla/xla/hlo/ir/named_sharding.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fnamed_sharding.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fnamed_sharding.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fir%2Fnamed_sharding.h?ref=1bef3e80b5b5a53be17c1677528ef721d30883cd",
            "patch": "@@ -31,8 +31,6 @@ class NamedSharding {\n     bool is_closed;\n   };\n \n-  std::vector<NamedSharding> tuple_shardings_;\n-\n   Mesh mesh_;\n   std::vector<DimensionSharding> dim_shardings_;\n   std::vector<AxisRef> replicated_axes_;"
        },
        {
            "sha": "42fba88b23ecc64f2d1bc78afb048584822b7a1c",
            "filename": "third_party/xla/xla/xla_data.proto",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fxla_data.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1bef3e80b5b5a53be17c1677528ef721d30883cd/third_party%2Fxla%2Fxla%2Fxla_data.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fxla_data.proto?ref=1bef3e80b5b5a53be17c1677528ef721d30883cd",
            "patch": "@@ -1058,10 +1058,6 @@ message NamedShardingProto {\n     bool is_closed = 2;\n   }\n \n-  // If this is non-empty, then all the other fields are ignored and this\n-  // represents a tuple sharding.\n-  repeated NamedShardingProto tuple_shardings = 1;\n-\n   MeshProto mesh = 2;\n   // The dimension shardings tell us for each dimension of the tensor, along\n   // which axes it is sharded from major to minor.\n@@ -1077,6 +1073,8 @@ message NamedShardingProto {\n   // combined with other shardings. Metadata should be set on individual tuple\n   // elements and not tuple_sharding.\n   repeated OpMetadata metadata = 6;\n+\n+  reserved 1;\n }\n \n // LINT.IfChange\n@@ -1172,6 +1170,13 @@ message OpSharding {\n   // or else are ignored. This is to facilitate migration from the old sharding\n   // format.\n   //\n+  // Note that for tuple NamedShardings, we reuse HloSharding's tuple_elements_\n+  // field. If named sharding format is enabled each element in tuple_elements_\n+  // will be an HloSharding, which itself can be a tuple or should only have\n+  // named_sharding_ populated. This approach is taken to maintain backward\n+  // compatibility with the existing `tuple_elements()` method, which provides a\n+  // modifiable reference to a `std::vector<HloSharding>`.\n+  //\n   // Note that instead of reusing OpSharding's fields like metadata, we have\n   // separate fields in NamedSharding to treat it as a standalone message which\n   // is more clear and will help in future cleanup."
        }
    ],
    "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
    }
}