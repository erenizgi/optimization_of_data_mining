{
    "author": "alekstheod",
    "message": "PR #32782: [ROCm] Fix hermetic build for rocm\n\nImported from GitHub PR https://github.com/openxla/xla/pull/32782\n\nüìù Summary of Changes\nFix hermetic build for rocm.\n\nüéØ Justification\nIntroduce missing hipblaslt dependency.\nFix invalid libs linking and align with the data directories.\n\nüöÄ Kind of Contribution\nPlease remove what does not apply: üêõ Bug Fix\n\nüìä Benchmark (for Performance Improvements)\nCI, not relevant\n\nüß™ Unit Tests:\nNot relevant\n\nüß™ Execution Tests:\nNot relevant\n\nCopybara import of the project:\n\n--\nf5cb68b0df2265b7048d0068eedd07cccf67e228 by Alexandros Theodoridis <atheodor@amd.com>:\n\nAdd missing hermetic lib dependency\n\n--\nfe0c9a7fdd36180fea5cf63e20d864355ed98a6c by Alexandros Theodoridis <atheodor@amd.com>:\n\nAdd missing hipblaslt deps, fix the targets\n\n--\n540d79dd4287a013a3f178ef34a5b96fb8a8a92f by Alexandros Theodoridis <atheodor@amd.com>:\n\nMake hipblaslt mandatory\n\n--\n3a6f2282669a1ece4518cc69a01ad76275b603a1 by Alexandros Theodoridis <atheodor@amd.com>:\n\nFix test\n\n--\neb21b60d34978191315a0c9775d2cb53309dc72d by Alexandros Theodoridis <atheodor@amd.com>:\n\nIgnore asnsigaltstack\n\n--\n54c8af2abd7dd682a8494caa05854d574209aa20 by Harsha Havanur Shamsundara <harsha.havanurshamsundara@amd.com>:\n\n[ROCm] Use working sha256 for latest ROCm 7.0 docker image\n\n--\n9629a9fc9201a80dba7a0beecb8ee0797960ff6f by Harsha HS <Harsha.HavanurShamsundara@amd.com>:\n\n[ROCm] Add ROCM_PATH repo_env to test scripts\n\n--\n1ef6772c6df6aeffcbcc2f27a0ede558fbc6270f by Alexandros Theodoridis <atheodor@amd.com>:\n\nFix buildifier warning\n\nMerging this change closes #32782\n\nPiperOrigin-RevId: 821614030",
    "sha": "8245a623aa5be049e0632d9b1824b546e7ca7c39",
    "files": [
        {
            "sha": "a63387a41193949608f1de40b01cacb2d761dd00",
            "filename": "third_party/xla/build_tools/rocm/rocm_xla.bazelrc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fbuild_tools%2Frocm%2Frocm_xla.bazelrc?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -27,6 +27,6 @@ build:tsan --linkopt -fsanitize=thread\n build:tsan --linkopt -g\n build:tsan --//build_tools/rocm:sanitizer=tsan\n \n-build:asan --test_env=ASAN_OPTIONS=suppressions=build_tools/rocm/asan_ignore_list.txt\n-build:asan --test_env=LSAN_OPTIONS=suppressions=build_tools/rocm/lsan_ignore_list.txt\n+build:asan --test_env=ASAN_OPTIONS=suppressions=build_tools/rocm/asan_ignore_list.txt:use_sigaltstack=0\n+build:asan --test_env=LSAN_OPTIONS=suppressions=build_tools/rocm/lsan_ignore_list.txt:use_sigaltstack=0\n build:asan --//build_tools/rocm:sanitizer=asan"
        },
        {
            "sha": "794f338dd38951da4290d1b19c778e27f4d40057",
            "filename": "third_party/xla/third_party/gpus/rocm/BUILD.tpl",
            "status": "modified",
            "additions": 29,
            "deletions": 9,
            "changes": 38,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2FBUILD.tpl?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -163,7 +163,11 @@ cc_library(\n \n cc_library(\n     name = \"rocm_hip\",\n-    srcs = glob([\"%{rocm_root}/lib/libamdhip*.so\"]),\n+    srcs = glob([\n+        \"%{rocm_root}/lib/libamdhip*.so\",\n+        \"%{rocm_root}/lib/libhiprtc.so*\",\n+        \"%{rocm_root}/lib/libhiprtc-builtins.so*\",\n+    ]),\n     hdrs = glob([\"%{rocm_root}/include/hip/**\"]),\n     include_prefix = \"rocm\",\n     includes = [\n@@ -184,7 +188,11 @@ cc_library(\n # Used by jax_rocm_plugin to minimally link to hip runtime.\n cc_library(\n     name = \"hip_runtime\",\n-    srcs = glob([\"%{rocm_root}/lib/libamdhip*.so\"]),\n+    srcs = glob([\n+        \"%{rocm_root}/lib/libamdhip*.so\",\n+        \"%{rocm_root}/lib/libhiprtc.so*\",\n+        \"%{rocm_root}/lib/libhiprtc-builtins.so*\",\n+    ]),\n     hdrs = glob([\"%{rocm_root}/include/hip/**\"]),\n     include_prefix = \"rocm\",\n     includes = [\n@@ -259,7 +267,6 @@ cc_library(\n \n cc_library(\n     name = \"miopen\",\n-    srcs = glob([\"%{rocm_root}/lib/libMIOpen*.so*\"]),\n     hdrs = glob([\"%{rocm_root}/include/miopen/**\"]),\n     data = glob([\n         \"%{rocm_root}/lib/libMIOpen*.so*\",\n@@ -274,7 +281,10 @@ cc_library(\n     linkopts = [\"-Wl,-rpath,local_config_rocm/rocm/rocm_dis/lib\"],\n     strip_include_prefix = \"%{rocm_root}\",\n     visibility = [\"//visibility:public\"],\n-    deps = [\":rocm_config\"],\n+    deps = [\n+        \":rocm_config\",\n+        \":rocm-core\",\n+    ],\n )\n \n cc_library(\n@@ -353,12 +363,13 @@ cc_library(\n \n cc_library(\n     name = \"rocsolver\",\n-    srcs = glob([\"%{rocm_root}/lib/librocsolver*.so*\"]),\n     hdrs = glob([\"%{rocm_root}/include/rocsolver/**\"]),\n+    data = glob([\"%{rocm_root}/lib/librocsolver*.so*\"]),\n     include_prefix = \"rocm\",\n     includes = [\n         \"%{rocm_root}/include/\",\n     ],\n+    linkopts = [\"-Wl,-rpath,local_config_rocm/rocm/rocm_dis/lib\"],\n     strip_include_prefix = \"%{rocm_root}\",\n     visibility = [\"//visibility:public\"],\n     deps = [\":rocm_config\"],\n@@ -378,7 +389,6 @@ cc_library(\n \n cc_library(\n     name = \"hipsolver\",\n-    srcs = glob([\"%{rocm_root}/lib/libhipsolver*.so*\"]),\n     hdrs = glob([\"%{rocm_root}/include/hipsolver/**\"]),\n     data = glob([\"%{rocm_root}/lib/libhipsolver*.so*\"]),\n     include_prefix = \"rocm\",\n@@ -392,7 +402,6 @@ cc_library(\n \n cc_library(\n     name = \"hipblas\",\n-    srcs = glob([\"%{rocm_root}/lib/libhipblas.so*\"]),\n     hdrs = glob([\"%{rocm_root}/include/hipblas/**\"]),\n     data = glob([\"%{rocm_root}/lib/libhipblas.so*\"]),\n     include_prefix = \"rocm\",\n@@ -401,6 +410,7 @@ cc_library(\n     ],\n     strip_include_prefix = \"%{rocm_root}\",\n     visibility = [\"//visibility:public\"],\n+    linkopts = [\"-Wl,-rpath,local_config_rocm/rocm/rocm_dis/lib\"],\n     deps = [\n         \":hipblas-common\",\n         \":rocm_config\",\n@@ -419,6 +429,16 @@ cc_library(\n     deps = [\":rocm_config\"],\n )\n \n+\n+cc_library(\n+    name = \"rocm-core\",\n+    srcs = glob([\n+        \"%{rocm_root}/lib/librocm-core.so*\",\n+    ]),\n+    visibility = [\"//visibility:public\"],\n+    deps = [\":rocm_config\"],\n+)\n+\n cc_library(\n     name = \"hipblaslt\",\n     hdrs = glob([\"%{rocm_root}/include/hipblaslt/**\"]),\n@@ -428,10 +448,10 @@ cc_library(\n     ]),\n     include_prefix = \"rocm\",\n     includes = [\n-        \"%{rocm_root}/include/\",\n+        \"%{rocm_root}/include/hipblaslt\",\n     ],\n     # workaround to  bring tensile files to the same fs layout as expected in the lib\n-    # hibplatslt assumes that tensile files are located in ../hipblaslt/libraries directory\n+    # hibplatslt assumes that tensile files are located in ../hipblaslt/library directory\n     linkopts = [\"-Wl,-rpath,local_config_rocm/rocm/rocm_dis/lib\"],\n     strip_include_prefix = \"%{rocm_root}\",\n     visibility = [\"//visibility:public\"],"
        },
        {
            "sha": "a17b21435510a2f66dce4fc726007a430c4d7985",
            "filename": "third_party/xla/third_party/gpus/rocm/rocm_redist_ubuntu_22_04.bzl",
            "status": "modified",
            "additions": 16,
            "deletions": 181,
            "changes": 197,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_22_04.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_22_04.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_22_04.bzl?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -17,6 +17,14 @@ rocm_redist_ubuntu_22_04 = {\n                 url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblas/hipblas_2.4.0.60401-83~22.04_amd64.deb\",\n                 sha256 = \"9d1bb3a5006a5b69655abbd890efaad1d347b3cd66b5d0a7fe60a6885494b19b\",\n             ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblaslt6.4.1/hipblaslt6.4.1_0.12.1.60401-83~22.04_amd64.deb\",\n+                sha256 = \"b53019fa5e46dc1ec4725960da9c30c6564db7adc10eb176f00d6dc99f565f3a\",\n+            ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblaslt-dev6.4.1/hipblaslt-dev6.4.1_0.12.1.60401-83~22.04_amd64.deb\",\n+                sha256 = \"23a8ed2da0d56cf79336eef3d502c57daf06934e8ca7225b4e6b449e59de3dab\",\n+            ),\n             struct(\n                 url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblas-dev/hipblas-dev_2.4.0.60401-83~22.04_amd64.deb\",\n                 sha256 = \"df5dd894a6840693f060fcdd1e96c0e8cf9eed16b2763643f17a5a9c4baa69a5\",\n@@ -210,6 +218,14 @@ rocm_redist_ubuntu_22_04 = {\n                 url = \"https://repo.radeon.com/rocm/apt/6.2/pool/main/h/hipblas-dev6.2.0/hipblas-dev6.2.0_2.2.0.60200-66~22.04_amd64.deb\",\n                 sha256 = \"885cf3f3a52ebde9caadf6348a6cda28fd15e3bc52bab0c90b587d72b29ff7ef\",\n             ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.2/pool/main/h/hipblaslt6.2.0/hipblaslt6.2.0_0.8.0.60200-66~22.04_amd64.deb\",\n+                sha256 = \"af3bea7cda7c1af147c3baae1cb3a8846ff571fe713c3a83d0924810bee734fe\",\n+            ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.2/pool/main/h/hipblaslt-dev6.2.0/hipblaslt-dev6.2.0_0.8.0.60200-66~22.04_amd64.deb\",\n+                sha256 = \"d9d2c80228ebfe74ebb98fc74fda57be498ab84ca40358355c616dfd38efded2\",\n+            ),\n             struct(\n                 url = \"https://repo.radeon.com/rocm/apt/6.2/pool/main/h/hipcc6.2.0/hipcc6.2.0_1.1.1.60200-66~22.04_amd64.deb\",\n                 sha256 = \"468026fa8eb70121f0c545557a926ddc41228cef9457b4a00d8fc3a36b04310f\",\n@@ -373,185 +389,4 @@ rocm_redist_ubuntu_22_04 = {\n         ],\n         \"rocm_root\": \"opt/rocm-6.2.0\",\n     },\n-    \"6.1.0\": {\n-        \"archives\": [\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/c/comgr6.1.0/comgr6.1.0_2.7.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"49967e2e98b96a95c618a1db7eacf8892b2700e0cf88960b3b0097da081ec1c8\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hip-runtime-amd/hip-runtime-amd_6.1.40091.60100-82~22.04_amd64.deb\",\n-                sha256 = \"8cb31ffd9d313e19a6e9b7bed8a106d0ed59fe92f479fa042405217f787cae16\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hip-dev6.1.0/hip-dev6.1.0_6.1.40091.60100-82~22.04_amd64.deb\",\n-                sha256 = \"7ca5568b754948576555b07924abbb35e24b7448b6f612738a5fdde6ae7020c9\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipblas6.1.0/hipblas6.1.0_2.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"4703e568dd8d6314b81508260b9d799c577ee38ae59655ce6a4782c0f6d3e3ef\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipblas-dev6.1.0/hipblas-dev6.1.0_2.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"3b6ddd2df992002afd0684de4ace6a6e86e497c4db95813febd7c0da851f8da5\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipcc6.1.0/hipcc6.1.0_1.0.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"e11db2414fec41b45f605616a10793956611850b42406bdf5c4f067e195e502a\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipcub-dev6.1.0/hipcub-dev6.1.0_3.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"888d7643506f00023b617beb8446d09608216dae075e978c7862a41adb7e94c2\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipfft6.1.0/hipfft6.1.0_1.0.14.60100-82~22.04_amd64.deb\",\n-                sha256 = \"e8de4cd7a377a718e8c4392e02fafbe3f43f38a2397aaf5cd2136eb03c43a5c3\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipfft-dev6.1.0/hipfft-dev6.1.0_1.0.14.60100-82~22.04_amd64.deb\",\n-                sha256 = \"afaf929e06c43310b5325a735169e73af85cf5e764d43ef319038d25484201b5\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipsolver6.1.0/hipsolver6.1.0_2.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"6bb779344bd39e9da75ee8474d7de5d10e6993d627e6cbd9ac7a3fcf260b1a6a\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipsolver-dev6.1.0/hipsolver-dev6.1.0_2.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"450c0849203b69da15d593fde712555328715626027df980823df9458f9b4631\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipsparse6.1.0/hipsparse6.1.0_3.0.1.60100-82~22.04_amd64.deb\",\n-                sha256 = \"b3806a85a483da4fa06f8e4edf917c5ceb1a4c00af6426ec61fbec23828291b3\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hipsparse-dev6.1.0/hipsparse-dev6.1.0_3.0.1.60100-82~22.04_amd64.deb\",\n-                sha256 = \"7003d85e42e988d9e5b80da0d5b81aa34a393ded1d9d567b0edf06e3ba2fc9b4\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hiprand6.1.0/hiprand6.1.0_2.10.16.60100-82~22.04_amd64.deb\",\n-                sha256 = \"bf6678ba14b9baebe6fe39a0aeaeeb2c10b8154a5e9c6d0223d8b01f36d1a7b9\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hiprand-dev6.1.0/hiprand-dev6.1.0_2.10.16.60100-82~22.04_amd64.deb\",\n-                sha256 = \"3f2069097efc8a9bbf1cb9be60f7240dcd17a5380614b2b6faf29c7b53b657c4\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hsa-rocr6.1.0/hsa-rocr6.1.0_1.13.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"562904659abd5e905a806b4ffc30af5c25442e3d6143e6a99b4660badced2b86\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/m/miopen-hip6.1.0/miopen-hip6.1.0_3.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"2f26448b8ef551383bf16f0e066dd6f4b7539b51f382b7028b377de5164f8b63\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/m/miopen-hip-dev6.1.0/miopen-hip-dev6.1.0_3.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"df6d5a8151f216dc02cd96e45d0ca8133cca51d272ede25eb30898f07d0f3e82\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rccl6.1.0/rccl6.1.0_2.18.6.60100-82~22.04_amd64.deb\",\n-                sha256 = \"2d367697957bba93c79e8da1d1bc7c8bbd8d07fb7f013de7c83824f9047372f1\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rccl-dev6.1.0/rccl-dev6.1.0_2.18.6.60100-82~22.04_amd64.deb\",\n-                sha256 = \"1c4927aa49e4dcb441608c3fa6ec86c9d078aaa767214be2b213c1a8421a3929\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocblas6.1.0/rocblas6.1.0_4.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"43cb1dd308f08a9d766ed846bd4d345b74fcc3a87e6e7ee727c7e5cf49629416\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocblas-dev/rocblas-dev_4.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"fc8bef370666fad72c01fc131749ccb835b8bfcb1639ed43dda26b9e64702b3b\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocfft6.1.0/rocfft6.1.0_1.0.27.60100-82~22.04_amd64.deb\",\n-                sha256 = \"50d0ad3cb37a69285b6132a17fdefbdea2e18ab6faf8265ead44ef3d7a4d16cb\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocfft-dev6.1.0/rocfft-dev6.1.0_1.0.27.60100-82~22.04_amd64.deb\",\n-                sha256 = \"2e091de9499e493c03a79ca7673b9c8640f896051542ff3c4f635efccc97d10f\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-core6.1.0/rocm-core6.1.0_6.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"685993f25f9da6e17cf69bc7dc9cdde0ca33b9955474a11bb903cae0d4a25d66\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-hip-libraries/rocm-hip-libraries_6.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"57c4212475dd5a8fe2bdab92eeff71332a0d408615dc2a4254482eb46d13e212\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/h/hip-dev6.1.0/hip-dev6.1.0_6.1.40091.60100-82~22.04_amd64.deb\",\n-                sha256 = \"7ca5568b754948576555b07924abbb35e24b7448b6f612738a5fdde6ae7020c9\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-device-libs/rocm-device-libs_1.0.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"7e155798e1027dd4fc0d49a89865245f3017090e44ea057584b8b86d5ea931cd\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocminfo/rocminfo_1.0.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"b7cf95b3b20e3accba23de34265ac408603176279412fda116dce47047a36e7b\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-llvm/rocm-llvm_17.0.0.24103.60100-82~22.04_amd64.deb\",\n-                sha256 = \"4c245a83e48517d627f34f52c0e7020434dcf4ef4ef073c736afc60e69f8b6f2\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-llvm-dev6.1.0/rocm-llvm-dev6.1.0_17.0.0.24103.60100-82~22.04_amd64.deb\",\n-                sha256 = \"c99854c0b92ea9c530be6c656157d26587b74c4ea1e9e12522570438a189d5b9\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocm-smi-lib6.1.0/rocm-smi-lib6.1.0_7.0.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"4b02aa9e5e09a36303e185def69ae67702a7177a5e6793e00565c8c6fdd32f88\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocprim-dev6.1.0/rocprim-dev6.1.0_3.1.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"ce3ce32ed9692c58d1a6ba089a7c07b27d2935b0f126a1c84b214cd2433ebe48\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocprofiler-register6.1.0/rocprofiler-register6.1.0_0.3.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"73b877f13ba65c6ba01197452c3b538f50f687d54ae0b3428c85c07bff20dcb7\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocrand-dev6.1.0/rocrand-dev6.1.0_3.0.1.60100-82~22.04_amd64.deb\",\n-                sha256 = \"afcdfa0cbc71363ccd9bb71f421343b12263bc88d42fa9a4c78c60bbc3fa17d3\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/roctracer6.1.0/roctracer6.1.0_4.1.60100.60100-82~22.04_amd64.deb\",\n-                sha256 = \"c98aedc99d252bf40b8069f497d24d60e2eaca25d001471e42ceb4df531ecba7\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/roctracer-dev6.1.0/roctracer-dev6.1.0_4.1.60100.60100-82~22.04_amd64.deb\",\n-                sha256 = \"9c2967d988e7a1408a3e4b2c83177eb7c88af939619a9d0d5ab7af2db9489884\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocsolver6.1.0/rocsolver6.1.0_3.25.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"65a6270f66194e033af1dc4b238bf7ecdfa439933b9c330bcb307caf516e8b3b\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocsolver-dev6.1.0/rocsolver-dev6.1.0_3.25.0.60100-82~22.04_amd64.deb\",\n-                sha256 = \"ca40789c82d3e46f2951cb0b1a7d5e8026daf5af6d597693746d95b8a49cd9a1\",\n-            ),\n-            struct(\n-                url = \"https://repo.radeon.com/rocm/apt/6.1/pool/main/r/rocsparse6.1.0/rocsparse6.1.0_3.1.2.60100-82~22.04_amd64.deb\",\n-                sha256 = \"ede46a9ccd505543425c5f75c6e8180c05c3b865dd638edbe297237664b3fe31\",\n-            ),\n-            struct(\n-                url = \"https://mirror.bazel.build/github.com/alekstheod/rocm-deps/releases/download/rocm-6.2.0/libdrm2_2.4.101-2_amd64.deb\",\n-                sha256 = \"4cd2e10f9486456a2782487f8bfd39f330f35a4d5bd6d693412b9e4ca2a6acbd\",\n-            ),\n-            struct(\n-                url = \"https://mirror.bazel.build/github.com/alekstheod/rocm-deps/releases/download/rocm-6.2.0/libdrm-amdgpu1_2.4.101-2_amd64.deb\",\n-                sha256 = \"d4567a30f7d68b4dcf794f8677b96e89083693c94e88279fecf577ceba8b9774\",\n-            ),\n-            struct(\n-                url = \"https://mirror.bazel.build/github.com/alekstheod/rocm-deps/releases/download/rocm-6.2.0/libelf1_0.176-1.1build1_amd64.deb\",\n-                sha256 = \"78a8761227efc04a1e37527f2f33ba608c6fb5d6c911616346ada5d7b9b72ee3\",\n-            ),\n-            struct(\n-                url = \"https://mirror.bazel.build/github.com/alekstheod/rocm-deps/releases/download/rocm-6.2.0/libnuma1_2.0.12-1_amd64.deb\",\n-                sha256 = \"0b1edf08cf9befecd21fe94e298ac25e476f87fd876ddd4adf42ef713449e637\",\n-            ),\n-        ],\n-        \"rocm_root\": \"opt/rocm-6.1.0\",\n-    },\n }"
        },
        {
            "sha": "7efd5e88c357a029f81410ae756e6488636dbf61",
            "filename": "third_party/xla/third_party/gpus/rocm/rocm_redist_ubuntu_24_04.bzl",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_24_04.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_24_04.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm%2Frocm_redist_ubuntu_24_04.bzl?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -17,6 +17,14 @@ rocm_redist_ubuntu_24_04 = {\n                 url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblas/hipblas_2.4.0.60401-83~24.04_amd64.deb\",\n                 sha256 = \"feaf51ba1b97d59d525a7317f6940dce01de85b18ab1356e198aae6287c9f25a\",\n             ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblaslt6.4.1/hipblaslt6.4.1_0.12.1.60401-83~24.04_amd64.deb\",\n+                sha256 = \"f3b3b5456f0b69b82c7ab1ccc9762a3a09e2ddc42b73cfa38a4c060755d5fb91\",\n+            ),\n+            struct(\n+                url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblaslt-dev6.4.1/hipblaslt-dev6.4.1_0.12.1.60401-83~22.04_amd64.deb\",\n+                sha256 = \"23a8ed2da0d56cf79336eef3d502c57daf06934e8ca7225b4e6b449e59de3dab\",\n+            ),\n             struct(\n                 url = \"https://repo.radeon.com/rocm/apt/6.4.1/pool/main/h/hipblas-dev/hipblas-dev_2.4.0.60401-83~24.04_amd64.deb\",\n                 sha256 = \"4503107e2979b014870781067e2ad7976b9981e0a84fdde288a6247187e36725\","
        },
        {
            "sha": "7941a095a5b82e59d53070cc342adcfb793f9cf9",
            "filename": "third_party/xla/third_party/gpus/rocm_configure.bzl",
            "status": "modified",
            "additions": 17,
            "deletions": 22,
            "changes": 39,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgpus%2Frocm_configure.bzl?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -235,6 +235,7 @@ def _rocm_lib_paths(repository_ctx, lib, basedir):\n         repository_ctx.path(\"%s/lib64/stubs/%s\" % (basedir, file_name)),\n         repository_ctx.path(\"%s/lib/x86_64-linux-gnu/%s\" % (basedir, file_name)),\n         repository_ctx.path(\"%s/lib/%s\" % (basedir, file_name)),\n+        repository_ctx.path(\"%s/lib/%s.0\" % (basedir, file_name)),  # hipblaslt has this pattern\n         repository_ctx.path(\"%s/%s\" % (basedir, file_name)),\n     ]\n \n@@ -305,7 +306,7 @@ def _select_rocm_lib_paths(repository_ctx, libs_paths, bash_bin):\n \n     return libs\n \n-def _find_libs(repository_ctx, rocm_config, miopen_path, rccl_path, bash_bin):\n+def _find_libs(repository_ctx, rocm_config, bash_bin):\n     \"\"\"Returns the ROCm libraries on the system.\n \n     Args:\n@@ -316,28 +317,26 @@ def _find_libs(repository_ctx, rocm_config, miopen_path, rccl_path, bash_bin):\n     Returns:\n       Map of library names to structs of filename and path\n     \"\"\"\n+    repo_path = str(repository_ctx.path(rocm_config.rocm_toolkit_path))\n     libs_paths = [\n         (name, _rocm_lib_paths(repository_ctx, name, path))\n         for name, path in [\n-            (\"amdhip64\", rocm_config.rocm_toolkit_path),\n-            (\"rocblas\", rocm_config.rocm_toolkit_path),\n-            (\"hiprand\", rocm_config.rocm_toolkit_path),\n-            (\"MIOpen\", miopen_path),\n-            (\"rccl\", rccl_path),\n-            (\"hipsparse\", rocm_config.rocm_toolkit_path),\n-            (\"roctracer64\", rocm_config.rocm_toolkit_path),\n-            (\"rocsolver\", rocm_config.rocm_toolkit_path),\n-            (\"hipfft\", rocm_config.rocm_toolkit_path),\n-            (\"rocrand\", rocm_config.rocm_toolkit_path),\n+            (\"amdhip64\", repo_path),\n+            (\"rocblas\", repo_path),\n+            (\"hiprand\", repo_path),\n+            (\"MIOpen\", repo_path),\n+            (\"rccl\", repo_path),\n+            (\"hipsparse\", repo_path),\n+            (\"roctracer64\", repo_path),\n+            (\"rocsolver\", repo_path),\n+            (\"hipfft\", repo_path),\n+            (\"rocrand\", repo_path),\n+            (\"hipsolver\", repo_path),\n+            (\"hipblas\", repo_path),\n+            (\"hipblaslt\", repo_path),\n         ]\n     ]\n-    if int(rocm_config.rocm_version_number) >= 40500:\n-        libs_paths.append((\"hipsolver\", _rocm_lib_paths(repository_ctx, \"hipsolver\", rocm_config.rocm_toolkit_path)))\n-        libs_paths.append((\"hipblas\", _rocm_lib_paths(repository_ctx, \"hipblas\", rocm_config.rocm_toolkit_path)))\n \n-    # hipblaslt may be absent even in versions of ROCm where it exists\n-    # (it is not installed by default in some containers). Autodetect.\n-    libs_paths.append((\"hipblaslt\", _rocm_lib_paths(repository_ctx, \"hipblaslt\", rocm_config.rocm_toolkit_path), True))\n     return _select_rocm_lib_paths(repository_ctx, libs_paths, bash_bin)\n \n def find_rocm_config(repository_ctx, rocm_path):\n@@ -596,16 +595,12 @@ def _create_local_rocm_repository(repository_ctx):\n     rocm_config = _setup_rocm_distro_dir(repository_ctx)\n     rocm_version_number = int(rocm_config.rocm_version_number)\n \n-    # For ROCm 5.2 and above, find MIOpen and RCCL in the main rocm lib path\n-    miopen_path = rocm_config.rocm_toolkit_path + \"/miopen\" if rocm_version_number < 50200 else rocm_config.rocm_toolkit_path\n-    rccl_path = rocm_config.rocm_toolkit_path + \"/rccl\" if rocm_version_number < 50200 else rocm_config.rocm_toolkit_path\n-\n     # Copy header and library files to execroot.\n     # rocm_toolkit_path\n     rocm_toolkit_path = _remove_root_dir(rocm_config.rocm_toolkit_path, \"rocm\")\n \n     bash_bin = get_bash_bin(repository_ctx)\n-    rocm_libs = _find_libs(repository_ctx, rocm_config, miopen_path, rccl_path, bash_bin)\n+    rocm_libs = _find_libs(repository_ctx, rocm_config, bash_bin)\n     rocm_lib_srcs = []\n     rocm_lib_outs = []\n     for lib in rocm_libs.values():"
        },
        {
            "sha": "e3aa3d687de78f35e0fc849339a0a5fe20a1994c",
            "filename": "third_party/xla/xla/stream_executor/rocm/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8245a623aa5be049e0632d9b1824b546e7ca7c39/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Frocm%2FBUILD?ref=8245a623aa5be049e0632d9b1824b546e7ca7c39",
            "patch": "@@ -2,7 +2,6 @@\n \n load(\n     \"@local_config_rocm//rocm:build_defs.bzl\",\n-    \"if_rocm_hipblaslt\",\n     \"rocm_library\",\n )\n load(\"//xla:xla.default.bzl\", \"xla_cc_test\")\n@@ -645,7 +644,7 @@ cc_library(\n         \"gpu\",\n         \"rocm-only\",\n     ],\n-    deps = if_rocm_hipblaslt([\n+    deps = if_static([\n         \"@local_config_rocm//rocm:hipblaslt\",\n     ]),\n )\n@@ -696,9 +695,9 @@ cc_library(\n         \"@local_config_rocm//rocm:rocm_headers\",\n         \"@local_tsl//tsl/platform:dso_loader\",\n         \"@local_tsl//tsl/platform:ml_dtypes\",\n-    ] + if_static([\n+    ] + [\n         \":hipblaslt_if_static\",\n-    ]),\n+    ],\n     alwayslink = True,\n )\n "
        }
    ],
    "stats": {
        "total": 293,
        "additions": 75,
        "deletions": 218
    }
}