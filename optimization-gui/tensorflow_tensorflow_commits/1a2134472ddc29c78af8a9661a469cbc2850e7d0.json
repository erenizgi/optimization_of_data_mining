{
    "author": "pifon2a",
    "message": "[XLA:GPU] Implement comparator for GpuTargetConfig\n\nPiperOrigin-RevId: 849268079",
    "sha": "1a2134472ddc29c78af8a9661a469cbc2850e7d0",
    "files": [
        {
            "sha": "4cc37e120022b1dcb3576323714e10934125213b",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -1657,6 +1657,7 @@ xla_test(\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_googletest//:gtest\",\n+        \"@com_google_protobuf//:protobuf\",\n     ],\n )\n "
        },
        {
            "sha": "411ef95cc6e1cb7a438c6abe9885a96da8aa074b",
            "filename": "third_party/xla/xla/service/compiler.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.cc?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -90,6 +90,13 @@ se::GpuTargetConfigProto Compiler::GpuTargetConfig::ToProto() const {\n   return proto;\n }\n \n+bool Compiler::GpuTargetConfig::operator==(const GpuTargetConfig& other) const {\n+  return platform_name == other.platform_name &&\n+         dnn_version_info == other.dnn_version_info &&\n+         device_description_str == other.device_description_str &&\n+         device_description == other.device_description;\n+}\n+\n std::vector<std::unique_ptr<tsl::protobuf::Message>>\n Compiler::ComputeBackendConfigs(const HloInstruction& hlo,\n                                 se::StreamExecutor* executor) const {"
        },
        {
            "sha": "91dd10c259087a2be20bb1e78358f2d80887a98c",
            "filename": "third_party/xla/xla/service/compiler.h",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler.h?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -111,12 +111,7 @@ class Compiler {\n \n     se::GpuTargetConfigProto ToProto() const;\n \n-    bool operator==(const GpuTargetConfig& other) const {\n-      // TODO(cheshire): More efficient comparator, this is currently just for\n-      // tests.\n-      return ToProto().SerializeAsString() ==\n-             other.ToProto().SerializeAsString();\n-    }\n+    bool operator==(const GpuTargetConfig& other) const;\n \n     std::string ToString() { return ToProto().DebugString(); }\n "
        },
        {
            "sha": "dc1dc2ca77269716f44ff469f9fe4f8819e14026",
            "filename": "third_party/xla/xla/service/compiler_test.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcompiler_test.cc?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -16,7 +16,9 @@ limitations under the License.\n #include \"xla/service/compiler.h\"\n \n #include \"xla/tests/xla_test_backend_predicates.h\"\n+#include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/autotune_results.pb.h\"\n #include \"xla/stream_executor/device_description.pb.h\"\n #include \"xla/stream_executor/gpu/gpu_init.h\"\n@@ -84,5 +86,25 @@ TEST(TargetConfigTest, ProtoConstructorFillsAllFields) {\n          \"validated!\";\n }\n \n+TEST(TargetConfigTest, CompareEqualFromSameProto) {\n+  stream_executor::GpuTargetConfigProto config_proto;\n+  ASSERT_TRUE(tsl::protobuf::TextFormat::ParseFromString(\n+      R\"pb(\n+        platform_name: \"platform\"\n+        dnn_version_info { major: 2 }\n+        runtime_version { major: 12 }\n+        gpu_device_info { threads_per_block_limit: 5 }\n+        device_description_str: \"foo\"\n+      )pb\",\n+      &config_proto));\n+\n+  ASSERT_OK_AND_ASSIGN(auto config1,\n+                       Compiler::GpuTargetConfig::FromProto(config_proto));\n+  ASSERT_OK_AND_ASSIGN(auto config2,\n+                       Compiler::GpuTargetConfig::FromProto(config_proto));\n+\n+  EXPECT_THAT(config1, ::testing::Eq(config2));\n+}\n+\n }  // namespace\n }  // namespace xla"
        },
        {
            "sha": "3fe36b947c9d1678720bd52448dcdeccfbdc893d",
            "filename": "third_party/xla/xla/stream_executor/device_description.cc",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.cc?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -100,6 +100,38 @@ std::string DeviceDescription::ToString() const {\n   return ToGpuProto().DebugString();\n }\n \n+bool DeviceDescription::operator==(const DeviceDescription& other) const {\n+  return name_ == other.name_ && device_vendor_ == other.device_vendor_ &&\n+         platform_version_ == other.platform_version_ &&\n+         driver_version_ == other.driver_version_ &&\n+         runtime_version_ == other.runtime_version_ &&\n+         compile_time_toolkit_version_ == other.compile_time_toolkit_version_ &&\n+         dnn_version_ == other.dnn_version_ && model_str_ == other.model_str_ &&\n+         pci_bus_id_ == other.pci_bus_id_ && numa_node_ == other.numa_node_ &&\n+         core_count_ == other.core_count_ &&\n+         fpus_per_core_ == other.fpus_per_core_ &&\n+         thread_dim_limit_ == other.thread_dim_limit_ &&\n+         block_dim_limit_ == other.block_dim_limit_ &&\n+         threads_per_block_limit_ == other.threads_per_block_limit_ &&\n+         threads_per_core_limit_ == other.threads_per_core_limit_ &&\n+         threads_per_warp_ == other.threads_per_warp_ &&\n+         registers_per_core_limit_ == other.registers_per_core_limit_ &&\n+         registers_per_block_limit_ == other.registers_per_block_limit_ &&\n+         device_address_bits_ == other.device_address_bits_ &&\n+         device_memory_size_ == other.device_memory_size_ &&\n+         l2_cache_size_ == other.l2_cache_size_ &&\n+         memory_bandwidth_ == other.memory_bandwidth_ &&\n+         pcie_bandwidth_ == other.pcie_bandwidth_ &&\n+         clock_rate_ghz_ == other.clock_rate_ghz_ &&\n+         ecc_enabled_ == other.ecc_enabled_ &&\n+         gpu_compute_capability_ == other.gpu_compute_capability_ &&\n+         shared_memory_per_core_ == other.shared_memory_per_core_ &&\n+         shared_memory_per_block_ == other.shared_memory_per_block_ &&\n+         shared_memory_per_block_optin_ ==\n+             other.shared_memory_per_block_optin_ &&\n+         interconnect_info_ == other.interconnect_info_;\n+}\n+\n const GpuComputeCapability &DeviceDescription::gpu_compute_capability() const {\n   return gpu_compute_capability_;\n }"
        },
        {
            "sha": "e0decd1b3a03049b25d19ee9fdba6b5a295c3de8",
            "filename": "third_party/xla/xla/stream_executor/device_description.h",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1a2134472ddc29c78af8a9661a469cbc2850e7d0/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fstream_executor%2Fdevice_description.h?ref=1a2134472ddc29c78af8a9661a469cbc2850e7d0",
            "patch": "@@ -106,6 +106,11 @@ struct DeviceInterconnectInfo {\n   std::string cluster_uuid;\n   // ID of the fabric clique to which this GPU belongs.\n   std::string clique_id;\n+\n+  bool operator==(const DeviceInterconnectInfo& other) const {\n+    return active_links == other.active_links &&\n+           cluster_uuid == other.cluster_uuid && clique_id == other.clique_id;\n+  }\n };\n \n // Data that describes the execution target of the StreamExecutor, in terms of\n@@ -313,6 +318,11 @@ class DeviceDescription {\n   static absl::StatusOr<DeviceDescription> FromProto(\n       const GpuDeviceInfoProto& proto);\n \n+  bool operator==(const DeviceDescription& other) const;\n+  bool operator!=(const DeviceDescription& other) const {\n+    return !(*this == other);\n+  }\n+\n   // For string values that are not available via the underlying platform, this\n   // value will be provided.\n   static inline const char* const kUndefinedString = \"<undefined>\";"
        }
    ],
    "stats": {
        "total": 79,
        "additions": 73,
        "deletions": 6
    }
}