{
    "author": "seherellis",
    "message": "[XLA:LHS] Adjust VLOG(2) printing for node comparison. `MaybeUpdate` already writes the chosen node into `ready_chosen` using `memcpy`, so we don't need the conditionals in the print statement. Also, we need to save the \"unchosen\" node's information for printing purposes.\n\nPiperOrigin-RevId: 837321312",
    "sha": "43267a7293aaa717dc3e10a5175f89aff1cd7689",
    "files": [
        {
            "sha": "62995d048976f9f4e46a2a369b04911456fe342a",
            "filename": "third_party/xla/xla/service/latency_hiding_scheduler.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/43267a7293aaa717dc3e10a5175f89aff1cd7689/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/43267a7293aaa717dc3e10a5175f89aff1cd7689/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Flatency_hiding_scheduler.cc?ref=43267a7293aaa717dc3e10a5175f89aff1cd7689",
            "patch": "@@ -1480,7 +1480,13 @@ class ReadySetLt {\n       static_assert(\n           std::is_trivially_copyable_v<DefaultSchedulerCore::ScheduleCandidate>,\n           \"ScheduleCandidate should be is_trivially_copyable\");\n-      memcpy(&b, &a, sizeof(DefaultSchedulerCore::ScheduleCandidate));\n+      if (VLOG_IS_ON(2)) {\n+        DefaultSchedulerCore::ScheduleCandidate tmp = b;\n+        memcpy(&b, &a, sizeof(DefaultSchedulerCore::ScheduleCandidate));\n+        memcpy(&a, &tmp, sizeof(DefaultSchedulerCore::ScheduleCandidate));\n+      } else {\n+        memcpy(&b, &a, sizeof(DefaultSchedulerCore::ScheduleCandidate));\n+      }\n     }\n     return result;\n   }\n@@ -1753,19 +1759,11 @@ DefaultSchedulerCore::FindAndExtractBestNodeAvailable(\n               return std::string(\"N/A\");\n             };\n         VLOG(2) << \"Choosing from ready (\"\n-                << (new_candidate_selected\n-                        ? ready_candidate.node->GetInstr().name()\n-                        : ready_chosen.node->GetInstr().name())\n-                << \") vs (\"\n-                << (new_candidate_selected\n-                        ? ready_chosen.node->GetInstr().name()\n-                        : ready_candidate.node->GetInstr().name())\n+                << ready_chosen.node->GetInstr().name() << \") vs (\"\n+                << ready_candidate.node->GetInstr().name()\n                 << \") Reason: \" << reason << \" mem pressure chosen \"\n-                << print_pressure_change(\n-                       new_candidate_selected ? ready_candidate : ready_chosen)\n-                << \" mem pressure other \"\n-                << print_pressure_change(\n-                       new_candidate_selected ? ready_chosen : ready_candidate);\n+                << print_pressure_change(ready_chosen) << \" mem pressure other \"\n+                << print_pressure_change(ready_candidate);\n       }\n \n       if (new_candidate_selected) {"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 11,
        "deletions": 13
    }
}