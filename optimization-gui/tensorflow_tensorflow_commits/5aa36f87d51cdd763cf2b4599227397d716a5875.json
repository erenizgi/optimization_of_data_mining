{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::DataLoss and tsl::errors::InvalidArgument in xla\n\nThis change replaces usages of tsl::errors::DataLoss with absl::DataLossError and tsl::errors::InvalidArgument with absl::InvalidArgumentError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nPiperOrigin-RevId: 837916202",
    "sha": "5aa36f87d51cdd763cf2b4599227397d716a5875",
    "files": [
        {
            "sha": "997525cec41e5b5da55f93c51db0ef841a21c1b4",
            "filename": "third_party/xla/xla/hlo/builder/lib/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -128,11 +128,10 @@ cc_library(\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/hlo/builder:xla_builder\",\n         \"@com_google_absl//absl/algorithm:container\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@local_tsl//tsl/platform:errors\",\n-        \"@local_tsl//tsl/platform:statusor\",\n     ],\n )\n \n@@ -157,7 +156,9 @@ cc_library(\n     deps = [\n         \"//xla/hlo/builder:padding\",\n         \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n+        \"@com_google_absl//absl/strings\",\n         \"@local_tsl//tsl/platform:errors\",\n         \"@local_tsl//tsl/platform:statusor\",\n     ],"
        },
        {
            "sha": "2dc0f7c1cc185600bfe9bf1a4da4082a63a86b99",
            "filename": "third_party/xla/xla/hlo/builder/lib/broadcast.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fbroadcast.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fbroadcast.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fbroadcast.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -19,15 +19,15 @@ limitations under the License.\n #include <vector>\n \n #include \"absl/algorithm/container.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n #include \"absl/types/span.h\"\n #include \"xla/hlo/builder/xla_builder.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/status_macros.h\"\n-#include \"tsl/platform/errors.h\"\n-#include \"tsl/platform/statusor.h\"\n \n namespace xla {\n \n@@ -42,10 +42,10 @@ absl::StatusOr<XlaOp> BroadcastTo(XlaOp input,\n   }\n \n   if (input_dims.size() > output_dims.size()) {\n-    return tsl::errors::InvalidArgument(\n+    return absl::InvalidArgumentError(absl::StrCat(\n         \"Input shape (\", ShapeUtil::HumanString(input_shape),\n         \") must have rank less than or equal to the output shape [\",\n-        absl::StrJoin(output_dims, \",\"), \"]\");\n+        absl::StrJoin(output_dims, \",\"), \"]\"));\n   }\n \n   std::vector<int64_t> broadcast_dims;\n@@ -56,10 +56,10 @@ absl::StatusOr<XlaOp> BroadcastTo(XlaOp input,\n     if (input_it != input_dims.rend()) {\n       if (!(*output_it == 0 && *input_it == 0) &&\n           !(*input_it != 0 && *output_it % *input_it == 0)) {\n-        return tsl::errors::InvalidArgument(\n-            \"Invalid shape broadcast from \",\n-            ShapeUtil::HumanString(input_shape), \" to [\",\n-            absl::StrJoin(output_dims, \",\"), \"]\");\n+        return absl::InvalidArgumentError(\n+            absl::StrCat(\"Invalid shape broadcast from \",\n+                         ShapeUtil::HumanString(input_shape), \" to [\",\n+                         absl::StrJoin(output_dims, \",\"), \"]\"));\n       }\n \n       broadcast_dims.push_back(broadcast_shape.size());"
        },
        {
            "sha": "9f75562c1c5ed0b25986f529a76e0fce6d65549d",
            "filename": "third_party/xla/xla/hlo/builder/lib/conv_grad_size_util.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fconv_grad_size_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fconv_grad_size_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Fbuilder%2Flib%2Fconv_grad_size_util.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -19,7 +19,9 @@ limitations under the License.\n #include <cstdint>\n \n #include \"absl/log/log.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/hlo/builder/padding.h\"\n #include \"tsl/platform/errors.h\"\n #include \"tsl/platform/statusor.h\"\n@@ -32,11 +34,12 @@ absl::StatusOr<SpatialDimensionOutputSizeAndPadding> GetWindowedOutputSize(\n     int64_t input_size, int64_t filter_size, int64_t dilation_rate,\n     int64_t stride, Padding padding_type) {\n   if (stride <= 0) {\n-    return tsl::errors::InvalidArgument(\"Stride must be > 0, but got \", stride);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Stride must be > 0, but got \", stride));\n   }\n   if (dilation_rate < 1) {\n-    return tsl::errors::InvalidArgument(\"Dilation rate must be >= 1, but got \",\n-                                        dilation_rate);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Dilation rate must be >= 1, but got \", dilation_rate));\n   }\n \n   int64_t effective_filter_size = (filter_size - 1) * dilation_rate + 1;\n@@ -58,11 +61,10 @@ absl::StatusOr<SpatialDimensionOutputSizeAndPadding> GetWindowedOutputSize(\n       break;\n   }\n   if (dim.output_size < 0) {\n-    return tsl::errors::InvalidArgument(\n+    return absl::InvalidArgumentError(absl::StrCat(\n         \"Computed output size would be negative: \", dim.output_size,\n-        \" [input_size: \", input_size,\n-        \", effective_filter_size: \", effective_filter_size,\n-        \", stride: \", stride, \"]\");\n+        \" [input_size: \", input_size, \", effective_filter_size: \",\n+        effective_filter_size, \", stride: \", stride, \"]\"));\n   }\n   return dim;\n }\n@@ -77,11 +79,11 @@ ConvGradExtractAndVerifyDimension(int64_t input_size, int64_t filter_size,\n                       GetWindowedOutputSize(input_size, filter_size, dilation,\n                                             stride, padding));\n   if (output_size != output_dim.output_size) {\n-    return tsl::errors::InvalidArgument(\n+    return absl::InvalidArgumentError(absl::StrCat(\n         \"Size of out_backprop doesn't match computed: \", \"actual = \",\n-        output_size, \", computed = \", output_dim.output_size,\n-        \" input: \", input_size, \" filter: \", filter_size,\n-        \" output: \", output_size, \" stride: \", stride, \" dilation: \", dilation);\n+        output_size, \", computed = \", output_dim.output_size, \" input: \",\n+        input_size, \" filter: \", filter_size, \" output: \", output_size,\n+        \" stride: \", stride, \" dilation: \", dilation));\n   }\n \n   SpatialDimensionOutputSizeAndPadding dim;"
        },
        {
            "sha": "b307d14bb37d7c55e128e4f6533f9dc3f76b7c4f",
            "filename": "third_party/xla/xla/service/compilation_environments.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fservice%2Fcompilation_environments.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Fservice%2Fcompilation_environments.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcompilation_environments.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -135,16 +135,16 @@ CompilationEnvironments::CreateFromProto(\n     std::string fullname;\n     if (!google::protobuf::Any::ParseAnyTypeUrl(env_proto.type_url(),\n                                                 &fullname)) {\n-      return tsl::errors::DataLoss(\n-          \"Invalid CompilationEnvironment message type url: %s\",\n-          env_proto.type_url());\n+      return absl::DataLossError(\n+          absl::StrCat(\"Invalid CompilationEnvironment message type url: \",\n+                       env_proto.type_url()));\n     }\n \n     const tsl::protobuf::Descriptor* const descriptor =\n         pool->FindMessageTypeByName(fullname);\n     if (descriptor == nullptr) {\n-      return tsl::errors::DataLoss(\n-          \"Unknown CompilationEnvironment message type: %s\", fullname);\n+      return absl::DataLossError(absl::StrCat(\n+          \"Unknown CompilationEnvironment message type: \", fullname));\n     }\n \n     const tsl::protobuf::Message* const prototype =\n@@ -157,9 +157,9 @@ CompilationEnvironments::CreateFromProto(\n \n     std::unique_ptr<tsl::protobuf::Message> env(prototype->New());\n     if (!env_proto.UnpackTo(env.get())) {\n-      return tsl::errors::DataLoss(\n-          \"Unable to unpack CompilationEnvironment message of type '%s'\",\n-          fullname);\n+      return absl::DataLossError(absl::StrCat(\n+          \"Unable to unpack CompilationEnvironment message of type '\", fullname,\n+          \"'\"));\n     }\n \n     TF_RETURN_IF_ERROR(envs->AddEnv(std::move(env)));"
        },
        {
            "sha": "08aabda91d5fb11acec095e0aa750369572576ef",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -66,6 +66,7 @@ tsl_cc_test(\n         \"//xla/tsl/platform:test_main\",\n         \"//xla/tsl/util/proto:proto_matchers\",\n         \"@com_github_grpc_grpc//:grpc++\",\n+        \"@com_google_absl//absl/status\",\n     ],\n )\n \n@@ -97,6 +98,7 @@ cc_library(\n         \"//xla/tsl/protobuf:rpc_options_proto_cc\",\n         \"//xla/tsl/util:device_name_utils\",\n         \"@com_github_grpc_grpc//:grpc++\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@local_tsl//tsl/platform:numbers\","
        },
        {
            "sha": "b373d0a4a9bf0b35d8774aa89dba88807eac67d7",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_channel.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_channel.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -21,8 +21,10 @@ limitations under the License.\n #include <string>\n #include <unordered_map>\n \n+#include \"absl/status/status.h\"\n #include \"absl/strings/escaping.h\"\n #include \"absl/strings/match.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_split.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"grpcpp/create_channel.h\"\n@@ -58,8 +60,8 @@ absl::Status ValidateHostPortPair(const string& host_port) {\n   auto colon_index = host_port.find_last_of(':');\n   if (!absl::SimpleAtoi(host_port.substr(colon_index + 1), &port) ||\n       host_port.substr(0, colon_index).find('/') != string::npos) {\n-    return errors::InvalidArgument(\"Could not interpret \\\"\", host_port,\n-                                   \"\\\" as a host-port pair.\");\n+    return absl::InvalidArgumentError(absl::StrCat(\n+        \"Could not interpret \\\"\", host_port, \"\\\" as a host-port pair.\"));\n   }\n   return absl::OkStatus();\n }\n@@ -170,8 +172,8 @@ ChannelCreationFunction ConvertToChannelCreationFunction(\n absl::Status GrpcChannelSpec::AddHostPortsJob(\n     const string& job_id, const std::map<int, string>& host_ports) {\n   if (!job_ids_.insert(job_id).second) {\n-    return errors::InvalidArgument(\n-        \"Duplicate job ID in cluster specification: \", job_id);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Duplicate job ID in cluster specification: \", job_id));\n   }\n   for (const auto& id_host_port : host_ports) {\n     TF_RETURN_IF_ERROR(ValidateHostPortPair(id_host_port.second));"
        },
        {
            "sha": "a0a416ce4dcc1a0915528fbdd9077adf9ab514fa",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_state.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_state.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_state.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_state.h?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -84,7 +84,7 @@ class RPCState : public GrpcClientCQTag {\n                 std::string error_message = absl::StrCat(\n                     \"Invalid GRPC_FAIL_FAST config: \", fail_fast_env);\n                 LOG(WARNING) << error_message;\n-                done(errors::InvalidArgument(error_message));\n+                done(absl::InvalidArgumentError(error_message));\n                 return false;\n               }\n             }(),\n@@ -155,9 +155,9 @@ class RPCState : public GrpcClientCQTag {\n     if (s.ok() && !ok) {\n       // Since this function is only being used for processing the response\n       // to Finish for client-side unary calls, ok should never be false\n-      s.Update(\n-          errors::Internal(\"GRPC status is okay but CompletionQueueStatus is \"\n-                           \"not.  This should never happen.\"));\n+      s.Update(absl::InternalError(\n+          \"GRPC status is okay but CompletionQueueStatus is \"\n+          \"not.  This should never happen.\"));\n     }\n \n     if (s.ok()) {\n@@ -210,7 +210,7 @@ class RPCState : public GrpcClientCQTag {\n   void ParseAndCallDone() {\n     absl::Status s;\n     if (!parse_proto_fn_(&response_buf_, response_)) {\n-      s.Update(errors::Internal(\"could not parse rpc response\"));\n+      s.Update(absl::InternalError(\"could not parse rpc response\"));\n     }\n     done_(s);\n     delete this;"
        },
        {
            "sha": "904cd563cc8f5988d5ee3edcaa200549a3a2aabc",
            "filename": "third_party/xla/xla/tsl/distributed_runtime/rpc/grpc_util_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fdistributed_runtime%2Frpc%2Fgrpc_util_test.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -19,6 +19,7 @@ limitations under the License.\n #include <cmath>\n #include <vector>\n \n+#include \"absl/status/status.h\"\n #include \"grpcpp/grpcpp.h\"\n #include \"xla/tsl/distributed_runtime/rpc/test_request.pb.h\"\n #include \"xla/tsl/platform/errors.h\"\n@@ -73,7 +74,7 @@ TestRequest MakeProto(int size) {\n }\n \n TEST(PayloadSerialization, PayloadsAreTransmitted) {\n-  absl::Status status = errors::InvalidArgument(\"invalid arg message\");\n+  absl::Status status = absl::InvalidArgumentError(\"invalid arg message\");\n   status.SetPayload(\"a\", absl::Cord(\"\\\\xFF\\\\x02\\\\x03\"));\n   absl::Status status_recovered = FromGrpcStatus(ToGrpcStatus(status));\n "
        },
        {
            "sha": "9712644302951499ea2a36bda2cbf325214d7620",
            "filename": "third_party/xla/xla/tsl/framework/device_id_utils.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_utils.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -25,6 +25,7 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/numbers.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/string_view.h\"\n #include \"xla/tsl/framework/device_id.h\"\n #include \"xla/tsl/framework/device_id_manager.h\"\n@@ -44,9 +45,9 @@ absl::StatusOr<int> ParsePlatformDeviceIdString(\n         tsl::str_util::Split(platform_device_id_str, ':');  // non-absl ok\n     if (device_type_and_id.size() != 2 ||\n         !absl::SimpleAtoi(device_type_and_id[1], &platform_device_id)) {\n-      return tsl::errors::InvalidArgument(\n-          \"Could not parse entry in 'visible_device_list': '\",\n-          platform_device_id_str, \"'.\");\n+      return absl::InvalidArgumentError(\n+          absl::StrCat(\"Could not parse entry in 'visible_device_list': '\",\n+                       platform_device_id_str, \"'.\"));\n     }\n     if (!device_type.empty() && device_type_and_id[0] != device_type) {\n       return -1;  // Return -1 to indicate that the device type doesn't match.\n@@ -95,10 +96,10 @@ absl::Status ParseVisibleDeviceList(\n       }\n       if (platform_device_id < 0 ||\n           platform_device_id >= visible_device_count) {\n-        return tsl::errors::InvalidArgument(\n-            \"'visible_device_list' listed an invalid Device id '\",\n-            platform_device_id, \"' but visible device count is \",\n-            visible_device_count);\n+        return absl::InvalidArgumentError(\n+            absl::StrCat(\"'visible_device_list' listed an invalid Device id '\",\n+                         platform_device_id, \"' but visible device count is \",\n+                         visible_device_count));\n       }\n       visible_device_order->push_back(\n           tsl::PlatformDeviceId(platform_device_id));\n@@ -109,9 +110,9 @@ absl::Status ParseVisibleDeviceList(\n   std::set<PlatformDeviceId> visible_device_set(visible_device_order->begin(),\n                                                 visible_device_order->end());\n   if (visible_device_set.size() != visible_device_order->size()) {\n-    return tsl::errors::InvalidArgument(\n-        \"visible_device_list contained a duplicate entry: \",\n-        visible_device_list);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"visible_device_list contained a duplicate entry: \",\n+                     visible_device_list));\n   }\n   return absl::OkStatus();\n }"
        },
        {
            "sha": "81e8404fbff8489e553e6688f657b250705d9d59",
            "filename": "third_party/xla/xla/tsl/lib/io/BUILD",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -50,6 +50,7 @@ cc_library(\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings:string_view\",\n         \"@local_tsl//tsl/platform:coding\",\n         \"@local_tsl//tsl/platform:platform_port\",\n@@ -67,7 +68,9 @@ cc_library(\n         \":inputstream_interface\",\n         \":random_inputstream\",\n         \"//xla/tsl/platform:env\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n     ],\n     alwayslink = True,\n )\n@@ -108,6 +111,7 @@ cc_library(\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/status\",\n         \"@local_tsl//tsl/platform:cord\",\n     ],\n     alwayslink = True,\n@@ -143,6 +147,7 @@ cc_library(\n     deps = [\n         \":inputstream_interface\",\n         \"//xla/tsl/platform:env\",\n+        \"@com_google_absl//absl/status\",\n         \"@local_tsl//tsl/platform:cord\",\n     ],\n     alwayslink = True,\n@@ -169,6 +174,7 @@ cc_library(\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@local_tsl//tsl/platform:raw_coding\",\n         \"@local_tsl//tsl/platform:stringpiece\",\n         \"@local_tsl//tsl/platform:tstring\",\n@@ -251,6 +257,7 @@ cc_library(\n         \":table_options\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings:string_view\",\n         \"@local_tsl//tsl/platform:coding\",\n     ],\n@@ -285,6 +292,7 @@ tsl_cc_test(\n         \"//xla/tsl/platform:env_impl\",\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/platform:test_benchmark\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n@@ -312,6 +320,7 @@ cc_library(\n         \"//xla/tsl/platform:macros\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/status\",\n         \"@local_tsl//tsl/platform:strcat\",\n         \"@zlib\",\n     ],\n@@ -468,10 +477,11 @@ tsl_cc_test(\n         \":random_inputstream\",\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:env_impl\",\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/platform:test_benchmark\",\n         \"//xla/tsl/platform:test_main\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n     ],\n )\n \n@@ -502,6 +512,7 @@ tsl_cc_test(\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@local_tsl//tsl/platform:coding\",\n         \"@local_tsl//tsl/platform:str_util\",\n@@ -518,6 +529,7 @@ tsl_cc_test(\n         \"//xla/tsl/lib/core:status_test_util\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n@@ -532,6 +544,7 @@ tsl_cc_test(\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:env_impl\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n@@ -550,6 +563,7 @@ tsl_cc_test(\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@local_tsl//tsl/platform:strcat\",\n         \"@zlib\",\n@@ -587,9 +601,9 @@ tsl_cc_test(\n         \":table\",\n         \"//xla/tsl/lib/random:philox\",\n         \"//xla/tsl/platform:env\",\n-        \"//xla/tsl/platform:env_impl\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@local_tsl//tsl/platform:platform_port\","
        },
        {
            "sha": "d4706bed3e1eb8a14c400ceaa9ae16ee6dfb4155",
            "filename": "third_party/xla/xla/tsl/lib/io/block.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fblock.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fblock.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fblock.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -19,6 +19,7 @@ limitations under the License.\n \n #include <algorithm>\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/lib/io/format.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/logging.h\"\n@@ -200,7 +201,7 @@ class Block::Iter : public Iterator {\n   void CorruptionError() {\n     current_ = restarts_;\n     restart_index_ = num_restarts_;\n-    status_ = errors::DataLoss(\"bad entry in block\");\n+    status_ = absl::DataLossError(\"bad entry in block\");\n     key_.clear();\n     value_ = absl::string_view();\n   }\n@@ -237,7 +238,7 @@ class Block::Iter : public Iterator {\n \n Iterator* Block::NewIterator() {\n   if (size_ < sizeof(uint32_t)) {\n-    return NewErrorIterator(errors::DataLoss(\"bad block contents\"));\n+    return NewErrorIterator(absl::DataLossError(\"bad block contents\"));\n   }\n   const uint32_t num_restarts = NumRestarts();\n   if (num_restarts == 0) {"
        },
        {
            "sha": "3db6b279d69b4f80239e72bd8428082681cc30ae",
            "filename": "third_party/xla/xla/tsl/lib/io/buffered_inputstream.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -15,7 +15,9 @@ limitations under the License.\n \n #include \"xla/tsl/lib/io/buffered_inputstream.h\"\n \n+#include \"absl/log/check.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/tsl/lib/io/random_inputstream.h\"\n \n namespace tsl {\n@@ -97,8 +99,8 @@ absl::Status BufferedInputStream::ReadLineHelper(StringType* result,\n absl::Status BufferedInputStream::ReadNBytes(int64_t bytes_to_read,\n                                              tstring* result) {\n   if (bytes_to_read < 0) {\n-    return errors::InvalidArgument(\"Can't read a negative number of bytes: \",\n-                                   bytes_to_read);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Can't read a negative number of bytes: \", bytes_to_read));\n   }\n   result->clear();\n   if (pos_ == limit_ && !file_status_.ok() && bytes_to_read > 0) {\n@@ -135,8 +137,8 @@ absl::Status BufferedInputStream::ReadNBytes(int64_t bytes_to_read,\n \n absl::Status BufferedInputStream::SkipNBytes(int64_t bytes_to_skip) {\n   if (bytes_to_skip < 0) {\n-    return errors::InvalidArgument(\"Can only skip forward, not \",\n-                                   bytes_to_skip);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Can only skip forward, not \", bytes_to_skip));\n   }\n   if (pos_ + bytes_to_skip < limit_) {\n     // If we aren't skipping too much, then we can just move pos_;\n@@ -162,8 +164,8 @@ int64_t BufferedInputStream::Tell() const {\n \n absl::Status BufferedInputStream::Seek(int64_t position) {\n   if (position < 0) {\n-    return errors::InvalidArgument(\"Seeking to a negative position: \",\n-                                   position);\n+    return absl::InvalidArgumentError(\n+        absl::StrCat(\"Seeking to a negative position: \", position));\n   }\n \n   // Position of the buffer's lower limit within file."
        },
        {
            "sha": "9b8c90b6b0ff88fd29364db63cedb9a02cf9fe77",
            "filename": "third_party/xla/xla/tsl/lib/io/buffered_inputstream_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fbuffered_inputstream_test.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -15,6 +15,8 @@ limitations under the License.\n \n #include \"xla/tsl/lib/io/buffered_inputstream.h\"\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n #include \"xla/tsl/lib/io/random_inputstream.h\"\n #include \"xla/tsl/platform/env.h\"\n@@ -38,14 +40,15 @@ class ReadOnceInputStream : public InputStreamInterface {\n \n   virtual absl::Status ReadNBytes(int64_t bytes_to_read, tstring* result) {\n     if (bytes_to_read < 11) {\n-      return errors::InvalidArgument(\"Not reading all bytes: \", bytes_to_read);\n+      return absl::InvalidArgumentError(\n+          absl::StrCat(\"Not reading all bytes: \", bytes_to_read));\n     }\n     if (start_) {\n       *result = \"0123456789\";\n       start_ = false;\n-      return errors::OutOfRange(\"Out of range.\");\n+      return absl::OutOfRangeError(\"Out of range.\");\n     }\n-    return errors::InvalidArgument(\n+    return absl::InvalidArgumentError(\n         \"Redudant call to ReadNBytes after an OutOfRange error.\");\n   }\n "
        },
        {
            "sha": "300ff021798b2eaf9d20ad77694e18662741fa61",
            "filename": "third_party/xla/xla/tsl/lib/io/format.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fformat.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fformat.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fformat.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n \n #include <limits>\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/lib/hash/crc32c.h\"\n #include \"xla/tsl/lib/io/block.h\"\n #include \"xla/tsl/platform/env.h\"\n@@ -40,7 +41,7 @@ absl::Status BlockHandle::DecodeFrom(absl::string_view* input) {\n   if (core::GetVarint64(input, &offset_) && core::GetVarint64(input, &size_)) {\n     return absl::OkStatus();\n   } else {\n-    return errors::DataLoss(\"bad block handle\");\n+    return absl::DataLossError(\"bad block handle\");\n   }\n }\n \n@@ -63,7 +64,7 @@ absl::Status Footer::DecodeFrom(absl::string_view* input) {\n   const uint64_t magic = ((static_cast<uint64_t>(magic_hi) << 32) |\n                           (static_cast<uint64_t>(magic_lo)));\n   if (magic != kTableMagicNumber) {\n-    return errors::DataLoss(\"not an sstable (bad magic number)\");\n+    return absl::DataLossError(\"not an sstable (bad magic number)\");\n   }\n \n   absl::Status result = metaindex_handle_.DecodeFrom(input);\n@@ -89,7 +90,7 @@ absl::Status ReadBlock(RandomAccessFile* file, const BlockHandle& handle,\n   size_t n = static_cast<size_t>(handle.size());\n \n   if (kBlockTrailerSize > std::numeric_limits<size_t>::max() - n) {\n-    return errors::DataLoss(\"handle.size() too big\");\n+    return absl::DataLossError(\"handle.size() too big\");\n   }\n \n   char* buf = new char[n + kBlockTrailerSize];\n@@ -102,7 +103,7 @@ absl::Status ReadBlock(RandomAccessFile* file, const BlockHandle& handle,\n   }\n   if (contents.size() != n + kBlockTrailerSize) {\n     delete[] buf;\n-    return errors::DataLoss(\"truncated block read\");\n+    return absl::DataLossError(\"truncated block read\");\n   }\n \n   // Check the crc of the type and the block contents\n@@ -114,7 +115,7 @@ absl::Status ReadBlock(RandomAccessFile* file, const BlockHandle& handle,\n     const uint32_t actual = crc32c::Value(data, n + 1);\n     if (actual != crc) {\n       delete[] buf;\n-      s = errors::DataLoss(\"block checksum mismatch\");\n+      s = absl::DataLossError(\"block checksum mismatch\");\n       return s;\n     }\n   }\n@@ -141,13 +142,13 @@ absl::Status ReadBlock(RandomAccessFile* file, const BlockHandle& handle,\n       size_t ulength = 0;\n       if (!port::Snappy_GetUncompressedLength(data, n, &ulength)) {\n         delete[] buf;\n-        return errors::DataLoss(\"corrupted compressed block contents\");\n+        return absl::DataLossError(\"corrupted compressed block contents\");\n       }\n       char* ubuf = new char[ulength];\n       if (!port::Snappy_Uncompress(data, n, ubuf)) {\n         delete[] buf;\n         delete[] ubuf;\n-        return errors::DataLoss(\"corrupted compressed block contents\");\n+        return absl::DataLossError(\"corrupted compressed block contents\");\n       }\n       delete[] buf;\n       result->data = absl::string_view(ubuf, ulength);\n@@ -157,7 +158,7 @@ absl::Status ReadBlock(RandomAccessFile* file, const BlockHandle& handle,\n     }\n     default:\n       delete[] buf;\n-      return errors::DataLoss(\"bad block type\");\n+      return absl::DataLossError(\"bad block type\");\n   }\n \n   return absl::OkStatus();"
        },
        {
            "sha": "4ae46eb0687e5d98332b3ab87bb66714953782f7",
            "filename": "third_party/xla/xla/tsl/lib/io/inputbuffer.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputbuffer.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -138,15 +138,15 @@ absl::Status InputBuffer::ReadNBytes(int64_t bytes_to_read, char* result,\n absl::Status InputBuffer::ReadVarint32Fallback(uint32_t* result) {\n   absl::Status s = ReadVarintFallback(result, core::kMaxVarint32Bytes);\n   if (absl::IsDataLoss(s)) {\n-    return errors::DataLoss(\"Stored data is too large to be a varint32.\");\n+    return absl::DataLossError(\"Stored data is too large to be a varint32.\");\n   }\n   return s;\n }\n \n absl::Status InputBuffer::ReadVarint64Fallback(uint64_t* result) {\n   absl::Status s = ReadVarintFallback(result, core::kMaxVarint64Bytes);\n   if (absl::IsDataLoss(s)) {\n-    return errors::DataLoss(\"Stored data is too large to be a varint64.\");\n+    return absl::DataLossError(\"Stored data is too large to be a varint64.\");\n   }\n   return s;\n }\n@@ -164,7 +164,8 @@ absl::Status InputBuffer::ReadVarintFallback(T* result, int max_bytes) {\n     *result |= (static_cast<T>(scratch) & 127) << shift;\n     if (!(scratch & 128)) return absl::OkStatus();\n   }\n-  return errors::DataLoss(\"Stored data longer than \", max_bytes, \" bytes.\");\n+  return absl::DataLossError(\n+      absl::StrCat(\"Stored data longer than \", max_bytes, \" bytes.\"));\n }\n \n absl::Status InputBuffer::SkipNBytes(int64_t bytes_to_skip) {"
        },
        {
            "sha": "97caa00ba2e4f888159fe16243d2dbab6f4629f4",
            "filename": "third_party/xla/xla/tsl/lib/io/inputstream_interface.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Finputstream_interface.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -15,6 +15,7 @@ limitations under the License.\n \n #include \"xla/tsl/lib/io/inputstream_interface.h\"\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/platform/errors.h\"\n \n namespace tsl {\n@@ -26,7 +27,7 @@ static constexpr int64_t kMaxSkipSize = 8 * 1024 * 1024;\n \n absl::Status InputStreamInterface::SkipNBytes(int64_t bytes_to_skip) {\n   if (bytes_to_skip < 0) {\n-    return errors::InvalidArgument(\"Can't skip a negative number of bytes\");\n+    return absl::InvalidArgumentError(\"Can't skip a negative number of bytes\");\n   }\n   tstring unused;\n   // Read kDefaultSkipSize at a time till bytes_to_skip."
        },
        {
            "sha": "ffed3945e6c990e38d699aaa52bc667e3b3b1767",
            "filename": "third_party/xla/xla/tsl/lib/io/random_inputstream.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frandom_inputstream.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n \n #include <memory>\n \n+#include \"absl/status/status.h\"\n namespace tsl {\n namespace io {\n \n@@ -33,7 +34,7 @@ RandomAccessInputStream::~RandomAccessInputStream() {\n absl::Status RandomAccessInputStream::ReadNBytes(int64_t bytes_to_read,\n                                                  tstring* result) {\n   if (bytes_to_read < 0) {\n-    return errors::InvalidArgument(\"Cannot read negative number of bytes\");\n+    return absl::InvalidArgumentError(\"Cannot read negative number of bytes\");\n   }\n   result->clear();\n   result->resize_uninitialized(bytes_to_read);\n@@ -55,7 +56,7 @@ absl::Status RandomAccessInputStream::ReadNBytes(int64_t bytes_to_read,\n absl::Status RandomAccessInputStream::ReadNBytes(int64_t bytes_to_read,\n                                                  absl::Cord* result) {\n   if (bytes_to_read < 0) {\n-    return errors::InvalidArgument(\"Cannot read negative number of bytes\");\n+    return absl::InvalidArgumentError(\"Cannot read negative number of bytes\");\n   }\n   int64_t current_size = result->size();\n   absl::Status s = file_->Read(pos_, bytes_to_read, result);\n@@ -72,7 +73,7 @@ static constexpr int64_t kMaxSkipSize = 8 * 1024 * 1024;\n \n absl::Status RandomAccessInputStream::SkipNBytes(int64_t bytes_to_skip) {\n   if (bytes_to_skip < 0) {\n-    return errors::InvalidArgument(\"Can't skip a negative number of bytes\");\n+    return absl::InvalidArgumentError(\"Can't skip a negative number of bytes\");\n   }\n   std::unique_ptr<char[]> scratch(new char[kMaxSkipSize]);\n   // Try to read 1 bytes first, if we could complete the read then EOF is\n@@ -98,7 +99,7 @@ absl::Status RandomAccessInputStream::SkipNBytes(int64_t bytes_to_skip) {\n       return s;\n     }\n     if (data.size() < static_cast<size_t>(bytes_to_read)) {\n-      return errors::OutOfRange(\"reached end of file\");\n+      return absl::OutOfRangeError(\"reached end of file\");\n     }\n     bytes_to_skip -= bytes_to_read;\n   }"
        },
        {
            "sha": "10d9c376ff550718d160a11b4319c92a5f70dfa1",
            "filename": "third_party/xla/xla/tsl/lib/io/record_reader.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecord_reader.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecord_reader.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecord_reader.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -24,6 +24,7 @@ limitations under the License.\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/tsl/lib/hash/crc32c.h\"\n #include \"xla/tsl/lib/io/buffered_inputstream.h\"\n #include \"xla/tsl/lib/io/compression.h\"\n@@ -115,26 +116,27 @@ inline const char* GetChecksumErrorSuffix(uint64_t offset) {\n absl::Status RecordReader::ReadChecksummed(uint64_t offset, size_t n,\n                                            tstring* result) {\n   if (n >= SIZE_MAX - sizeof(uint32_t)) {\n-    return errors::DataLoss(\"record size too large\",\n-                            GetChecksumErrorSuffix(offset));\n+    return absl::DataLossError(\n+        absl::StrCat(\"record size too large\", GetChecksumErrorSuffix(offset)));\n   }\n \n   const size_t expected = n + sizeof(uint32_t);\n   TF_RETURN_IF_ERROR(input_stream_->ReadNBytes(expected, result));\n \n   if (result->size() != expected) {\n     if (result->empty()) {\n-      return errors::OutOfRange(\"eof\", GetChecksumErrorSuffix(offset));\n+      return absl::OutOfRangeError(\n+          absl::StrCat(\"eof\", GetChecksumErrorSuffix(offset)));\n     } else {\n-      return errors::DataLoss(\"truncated record at \", offset,\n-                              GetChecksumErrorSuffix(offset));\n+      return absl::DataLossError(absl::StrCat(\"truncated record at \", offset,\n+                                              GetChecksumErrorSuffix(offset)));\n     }\n   }\n \n   const uint32_t masked_crc = core::DecodeFixed32(result->data() + n);\n   if (crc32c::Unmask(masked_crc) != crc32c::Value(result->data(), n)) {\n-    return errors::DataLoss(\"corrupted record at \", offset,\n-                            GetChecksumErrorSuffix(offset));\n+    return absl::DataLossError(absl::StrCat(\"corrupted record at \", offset,\n+                                            GetChecksumErrorSuffix(offset)));\n   }\n   result->resize(n);\n   return absl::OkStatus();\n@@ -224,8 +226,8 @@ absl::Status RecordReader::ReadRecord(uint64_t* offset, tstring* record) {\n   if (!s.ok()) {\n     last_read_failed_ = true;\n     if (absl::IsOutOfRange(s)) {\n-      s = errors::DataLoss(\"truncated record at \", *offset, \"' failed with \",\n-                           s.message());\n+      s = absl::DataLossError(absl::StrCat(\"truncated record at \", *offset,\n+                                           \"' failed with \", s.message()));\n     }\n     return s;\n   }\n@@ -255,8 +257,8 @@ absl::Status RecordReader::SkipRecords(uint64_t* offset, int num_to_skip,\n     if (!s.ok()) {\n       last_read_failed_ = true;\n       if (absl::IsOutOfRange(s)) {\n-        s = errors::DataLoss(\"truncated record at \", *offset, \"' failed with \",\n-                             s.message());\n+        s = absl::DataLossError(absl::StrCat(\"truncated record at \", *offset,\n+                                             \"' failed with \", s.message()));\n       }\n       return s;\n     }"
        },
        {
            "sha": "4ee87c13a9fdebdea2c97fe64e26adbd4534a44f",
            "filename": "third_party/xla/xla/tsl/lib/io/recordio_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecordio_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecordio_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Frecordio_test.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -87,7 +87,7 @@ class StringSource : public RandomAccessFile {\n                     char* scratch) const override {\n     if (force_error_) {\n       force_error_ = false;\n-      return errors::DataLoss(\"read error\");\n+      return absl::DataLossError(\"read error\");\n     }\n \n     if (offset >= contents_->size()) {"
        },
        {
            "sha": "3d4e7f1161bdabd02435246ac68e4c5ecc468fb6",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -56,10 +56,17 @@ cc_library(\n     srcs = [\"snappy_outputbuffer.cc\"],\n     hdrs = [\"snappy_outputbuffer.h\"],\n     deps = [\n+        \"//xla/tsl/lib/io:zlib_compression_options\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:macros\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:cord\",\n+        \"@com_google_absl//absl/strings:string_view\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:platform_port\",\n     ],"
        },
        {
            "sha": "c1b222fe72d4a89a5e85451310640729c3b6316a",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_inputbuffer.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputbuffer.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -110,7 +110,7 @@ absl::Status SnappyInputBuffer::Inflate() {\n                          \" bytes) too small. Should be larger than \",\n                          compressed_block_length, \" bytes.\"));\n       } else {\n-        return errors::DataLoss(\n+        return absl::DataLossError(\n             absl::StrCat(\"Failed to read \", compressed_block_length,\n                          \" bytes from file. Possible data corruption.\"));\n       }\n@@ -120,7 +120,7 @@ absl::Status SnappyInputBuffer::Inflate() {\n   size_t uncompressed_length;\n   if (!port::Snappy_GetUncompressedLength(next_in_, compressed_block_length,\n                                           &uncompressed_length)) {\n-    return errors::DataLoss(\"Parsing error in Snappy_GetUncompressedLength\");\n+    return absl::DataLossError(\"Parsing error in Snappy_GetUncompressedLength\");\n   }\n \n   // Output buffer must have been cleared before uncompressing more input.\n@@ -133,7 +133,7 @@ absl::Status SnappyInputBuffer::Inflate() {\n   bool status = port::Snappy_Uncompress(next_in_, compressed_block_length,\n                                         output_buffer_.get());\n   if (!status) {\n-    return errors::DataLoss(\"Snappy_Uncompress failed\");\n+    return absl::DataLossError(\"Snappy_Uncompress failed\");\n   }\n   next_in_ += compressed_block_length;\n   avail_in_ -= compressed_block_length;\n@@ -207,7 +207,7 @@ absl::Status SnappyInputBuffer::ReadFromFile() {\n   // fill up the buffer in which case file_->ReadNBytes would return an\n   // OutOfRange error.\n   if (data.empty()) {\n-    return errors::OutOfRange(\"EOF reached\");\n+    return absl::OutOfRangeError(\"EOF reached\");\n   }\n   if (absl::IsOutOfRange(s)) {\n     return absl::OkStatus();"
        },
        {
            "sha": "f9865d7e7ca1f03f296c933363484b3e7070cf35",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_inputstream.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_inputstream.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -109,16 +109,17 @@ absl::Status SnappyInputStream::Inflate() {\n   absl::Status s =\n       input_stream_->ReadNBytes(compressed_block_length, &compressed_block);\n   if (absl::IsOutOfRange(s)) {\n-    return errors::DataLoss(\"Failed to read \", compressed_block_length,\n-                            \" bytes from file. Possible data corruption.\");\n+    return absl::DataLossError(\n+        absl::StrCat(\"Failed to read \", compressed_block_length,\n+                     \" bytes from file. Possible data corruption.\"));\n   }\n   TF_RETURN_IF_ERROR(s);\n \n   size_t uncompressed_length;\n   if (!port::Snappy_GetUncompressedLength(compressed_block.data(),\n                                           compressed_block_length,\n                                           &uncompressed_length)) {\n-    return errors::DataLoss(\"Parsing error in Snappy_GetUncompressedLength\");\n+    return absl::DataLossError(\"Parsing error in Snappy_GetUncompressedLength\");\n   }\n \n   DCHECK_EQ(avail_out_, 0);\n@@ -132,7 +133,7 @@ absl::Status SnappyInputStream::Inflate() {\n   next_out_ = output_buffer_.get();\n   if (!port::Snappy_Uncompress(compressed_block.data(), compressed_block_length,\n                                output_buffer_.get())) {\n-    return errors::DataLoss(\"Snappy_Uncompress failed.\");\n+    return absl::DataLossError(\"Snappy_Uncompress failed.\");\n   }\n   avail_out_ += uncompressed_length;\n "
        },
        {
            "sha": "41fde85ca7f7b9000de77d6305b49f70ed45932b",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_outputbuffer.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_outputbuffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_outputbuffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_outputbuffer.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -199,7 +199,7 @@ absl::Status SnappyOutputBuffer::Deflate() {\n   }\n   std::string output;\n   if (!port::Snappy_Compress(next_in_, avail_in_, &output)) {\n-    return errors::DataLoss(\"Snappy_Compress failed\");\n+    return absl::DataLossError(\"Snappy_Compress failed\");\n   }\n \n   // Write length of compressed block to output buffer."
        },
        {
            "sha": "b4e52a7924674cbcfe2e0208c17558ee2a7921e0",
            "filename": "third_party/xla/xla/tsl/lib/io/snappy/snappy_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fsnappy%2Fsnappy_test.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -172,7 +172,7 @@ absl::Status TestMultipleWrites(size_t compress_input_buf_size,\n     }\n \n     if (actual_result != expected_result) {\n-      return errors::DataLoss(\"Actual and expected results don't match.\");\n+      return absl::DataLossError(\"Actual and expected results don't match.\");\n     }\n     TF_RETURN_IF_ERROR(in.Reset());\n   }\n@@ -211,7 +211,7 @@ absl::Status TestMultipleWritesInputStream(\n     }\n \n     if (actual_result != expected_result) {\n-      return errors::DataLoss(\"Actual and expected results don't match.\");\n+      return absl::DataLossError(\"Actual and expected results don't match.\");\n     }\n     TF_RETURN_IF_ERROR(snappy_input_stream.Reset());\n   }\n@@ -389,7 +389,7 @@ TEST(SnappyBuffers, CorruptBlockLargeInputBuffer) {\n     return;\n   }\n   CHECK_EQ(TestMultipleWrites(10000, 10000, 2000, 10000, 2, true, 1, true),\n-           errors::OutOfRange(\"EOF reached\"));\n+           absl::OutOfRangeError(\"EOF reached\"));\n }\n \n TEST(SnappyBuffers, CorruptBlockLargeInputStream) {"
        },
        {
            "sha": "354fcb9076da2218d9a8a6333917c441dbc825cb",
            "filename": "third_party/xla/xla/tsl/lib/io/table.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -15,6 +15,7 @@ limitations under the License.\n \n #include \"xla/tsl/lib/io/table.h\"\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/lib/io/block.h\"\n #include \"xla/tsl/lib/io/cache.h\"\n #include \"xla/tsl/lib/io/format.h\"\n@@ -44,7 +45,7 @@ absl::Status Table::Open(const Options& options, RandomAccessFile* file,\n                          uint64_t size, Table** table) {\n   *table = nullptr;\n   if (size < Footer::kEncodedLength) {\n-    return errors::DataLoss(\"file is too short to be an sstable\");\n+    return absl::DataLossError(\"file is too short to be an sstable\");\n   }\n \n   char footer_space[Footer::kEncodedLength];"
        },
        {
            "sha": "aae6a988141fe36ad3cb8dc81e2376c625eab2b9",
            "filename": "third_party/xla/xla/tsl/lib/io/table_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Ftable_test.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -20,6 +20,7 @@ limitations under the License.\n #include <string>\n #include <vector>\n \n+#include \"absl/status/status.h\"\n #include \"absl/strings/escaping.h\"\n #include \"xla/tsl/lib/io/block.h\"\n #include \"xla/tsl/lib/io/block_builder.h\"\n@@ -98,7 +99,7 @@ class StringSink : public WritableFile {\n   absl::Status Close() override { return absl::OkStatus(); }\n   absl::Status Flush() override { return absl::OkStatus(); }\n   absl::Status Name(absl::string_view* result) const override {\n-    return errors::Unimplemented(\"StringSink does not support Name()\");\n+    return absl::UnimplementedError(\"StringSink does not support Name()\");\n   }\n   absl::Status Sync() override { return absl::OkStatus(); }\n   absl::Status Tell(int64_t* pos) override {\n@@ -125,13 +126,13 @@ class StringSource : public RandomAccessFile {\n   uint64_t Size() const { return contents_.size(); }\n \n   absl::Status Name(absl::string_view* result) const override {\n-    return errors::Unimplemented(\"StringSource does not support Name()\");\n+    return absl::UnimplementedError(\"StringSource does not support Name()\");\n   }\n \n   absl::Status Read(uint64_t offset, size_t n, absl::string_view* result,\n                     char* scratch) const override {\n     if (offset > contents_.size()) {\n-      return errors::InvalidArgument(\"invalid Read offset\");\n+      return absl::InvalidArgumentError(\"invalid Read offset\");\n     }\n     if (offset + n > contents_.size()) {\n       n = contents_.size() - offset;"
        },
        {
            "sha": "e78d59ddaf0b585ee04a3fe4569d55b32b64249c",
            "filename": "third_party/xla/xla/tsl/lib/io/zlib_inputstream.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_inputstream.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_inputstream.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_inputstream.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n \n #include <zlib.h>\n \n+#include \"absl/status/status.h\"\n #include \"xla/tsl/platform/logging.h\"\n #include \"tsl/platform/strcat.h\"\n \n@@ -86,7 +87,7 @@ ZlibInputStream::~ZlibInputStream() {\n \n absl::Status ZlibInputStream::Reset() {\n   if (init_error_) {\n-    return errors::DataLoss(\"unable to reset stream, cannot decompress.\");\n+    return absl::DataLossError(\"unable to reset stream, cannot decompress.\");\n   }\n   TF_RETURN_IF_ERROR(input_stream_->Reset());\n   inflateEnd(z_stream_def_->stream.get());\n@@ -163,7 +164,7 @@ absl::Status ZlibInputStream::ReadFromStream() {\n   // fill up the buffer in which case input_stream_->ReadNBytes would return an\n   // OutOfRange error.\n   if (data.empty()) {\n-    return errors::OutOfRange(\"EOF reached\");\n+    return absl::OutOfRangeError(\"EOF reached\");\n   }\n   if (absl::IsOutOfRange(s)) {\n     return absl::OkStatus();\n@@ -196,7 +197,7 @@ size_t ZlibInputStream::NumUnreadBytes() const {\n absl::Status ZlibInputStream::ReadNBytes(int64_t bytes_to_read,\n                                          tstring* result) {\n   if (init_error_) {\n-    return errors::DataLoss(\"Unable to decompress Zlib file.\");\n+    return absl::DataLossError(\"Unable to decompress Zlib file.\");\n   }\n \n   result->clear();\n@@ -255,7 +256,7 @@ absl::Status ZlibInputStream::Inflate() {\n     if (z_stream_def_->stream->msg != nullptr) {\n       absl::StrAppend(&error_string, \": \", z_stream_def_->stream->msg);\n     }\n-    return errors::DataLoss(error_string);\n+    return absl::DataLossError(error_string);\n   }\n   if (error == Z_STREAM_END && zlib_options_.window_bits == MAX_WBITS + 16) {\n     inflateReset(z_stream_def_->stream.get());"
        },
        {
            "sha": "3c0a1b73de8036827584d84a934c8f96a83df68a",
            "filename": "third_party/xla/xla/tsl/lib/io/zlib_outputbuffer.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_outputbuffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_outputbuffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fio%2Fzlib_outputbuffer.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -249,7 +249,7 @@ absl::Status ZlibOutputBuffer::Deflate(int flush) {\n   if (z_stream_->msg != nullptr) {\n     absl::StrAppend(&error_string, \": \", z_stream_->msg);\n   }\n-  return errors::DataLoss(error_string);\n+  return absl::DataLossError(error_string);\n }\n \n absl::Status ZlibOutputBuffer::Tell(int64_t* position) {"
        },
        {
            "sha": "9d43c884b61cbcfa2e340fac79b94c0fbebbd060",
            "filename": "third_party/xla/xla/tsl/lib/monitoring/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -256,6 +256,7 @@ cc_library(\n         \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/protobuf:histogram_proto_cc\",\n         \"@com_google_absl//absl/algorithm:container\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n     ],"
        },
        {
            "sha": "da857c381e0c05350a239d25e3889f9fd53e564c",
            "filename": "third_party/xla/xla/tsl/lib/monitoring/test_utils.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Ftest_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Ftest_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Flib%2Fmonitoring%2Ftest_utils.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -18,7 +18,9 @@ limitations under the License.\n #include <cstdint>\n \n #include \"absl/algorithm/container.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_join.h\"\n #include \"xla/tsl/lib/monitoring/types.h\"\n #include \"xla/tsl/platform/errors.h\"\n@@ -49,10 +51,10 @@ absl::StatusOr<Histogram> Histogram::Subtract(const Histogram& other) const {\n \n   if (!absl::c_equal(histogram_proto.bucket_limit(),\n                      other.histogram_proto_.bucket_limit())) {\n-    return errors::InvalidArgument(\n+    return absl::InvalidArgumentError(absl::StrCat(\n         \"Subtracting a histogram with different buckets. Left: [\",\n         absl::StrJoin(histogram_proto.bucket_limit(), \", \"), \"], right: [\",\n-        absl::StrJoin(other.histogram_proto_.bucket_limit(), \", \"), \"].\");\n+        absl::StrJoin(other.histogram_proto_.bucket_limit(), \", \"), \"].\"));\n   }\n \n   histogram_proto.set_num(histogram_proto.num() - other.histogram_proto_.num());\n@@ -69,10 +71,10 @@ absl::StatusOr<Histogram> Histogram::Subtract(const Histogram& other) const {\n       absl::c_all_of(histogram_proto.bucket(),\n                      [](const double num) { return num >= 0; });\n   if (!histogram_is_valid) {\n-    return errors::InvalidArgument(\n+    return absl::InvalidArgumentError(absl::StrCat(\n         \"Failed to subtract a histogram by a larger histogram. Left operand: \",\n         histogram_proto.ShortDebugString(),\n-        \", right operand: \", other.histogram_proto_.ShortDebugString());\n+        \", right operand: \", other.histogram_proto_.ShortDebugString()));\n   }\n   return Histogram(histogram_proto);\n }"
        },
        {
            "sha": "a341ffad3a63557a49f4691664b1ff6cdd5d7c9b",
            "filename": "third_party/xla/xla/tsl/platform/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -374,6 +374,8 @@ cc_library(\n         \"threadpool.h\",\n     ],\n     deps = tf_windows_aware_platform_deps(\"env\") + if_static([\":env_impl\"]) + [\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:string_view\",\n     ],\n )"
        },
        {
            "sha": "59a6831f1afc8e98d6d4be9cc40d46b78abe0390",
            "filename": "third_party/xla/xla/tsl/platform/env.cc",
            "status": "modified",
            "additions": 19,
            "deletions": 16,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -132,8 +132,9 @@ absl::Status Env::GetFileSystemForFile(const std::string& fname,\n       scheme = \"[local]\";\n     }\n \n-    return errors::Unimplemented(\"File system scheme '\", scheme,\n-                                 \"' not implemented (file: '\", fname, \"')\");\n+    return absl::UnimplementedError(absl::StrCat(\"File system scheme '\", scheme,\n+                                                 \"' not implemented (file: '\",\n+                                                 fname, \"')\"));\n   }\n   *result = file_system;\n   return absl::OkStatus();\n@@ -158,8 +159,8 @@ absl::Status Env::SetOption(const std::string& scheme, const std::string& key,\n                             const std::string& value) {\n   FileSystem* file_system = file_system_registry_->Lookup(scheme);\n   if (!file_system) {\n-    return errors::Unimplemented(\"File system scheme '\", scheme,\n-                                 \"' not found to set configuration\");\n+    return absl::UnimplementedError(absl::StrCat(\n+        \"File system scheme '\", scheme, \"' not found to set configuration\"));\n   }\n   return file_system->SetOption(key, value);\n }\n@@ -168,8 +169,8 @@ absl::Status Env::SetOption(const std::string& scheme, const std::string& key,\n                             const std::vector<std::string>& values) {\n   FileSystem* file_system = file_system_registry_->Lookup(scheme);\n   if (!file_system) {\n-    return errors::Unimplemented(\"File system scheme '\", scheme,\n-                                 \"' not found to set configuration\");\n+    return absl::UnimplementedError(absl::StrCat(\n+        \"File system scheme '\", scheme, \"' not found to set configuration\"));\n   }\n   return file_system->SetOption(key, values);\n }\n@@ -178,8 +179,8 @@ absl::Status Env::SetOption(const std::string& scheme, const std::string& key,\n                             const std::vector<int64_t>& values) {\n   FileSystem* file_system = file_system_registry_->Lookup(scheme);\n   if (!file_system) {\n-    return errors::Unimplemented(\"File system scheme '\", scheme,\n-                                 \"' not found to set configuration\");\n+    return absl::UnimplementedError(absl::StrCat(\n+        \"File system scheme '\", scheme, \"' not found to set configuration\"));\n   }\n   return file_system->SetOption(key, values);\n }\n@@ -188,8 +189,8 @@ absl::Status Env::SetOption(const std::string& scheme, const std::string& key,\n                             const std::vector<double>& values) {\n   FileSystem* file_system = file_system_registry_->Lookup(scheme);\n   if (!file_system) {\n-    return errors::Unimplemented(\"File system scheme '\", scheme,\n-                                 \"' not found to set configuration\");\n+    return absl::UnimplementedError(absl::StrCat(\n+        \"File system scheme '\", scheme, \"' not found to set configuration\"));\n   }\n   return file_system->SetOption(key, values);\n }\n@@ -259,8 +260,8 @@ bool Env::FilesExist(const std::vector<std::string>& files,\n     if (!file_system) {\n       fs_result = false;\n       if (fs_status) {\n-        absl::Status s = errors::Unimplemented(\"File system scheme '\",\n-                                               itr.first, \"' not implemented\");\n+        absl::Status s = absl::UnimplementedError(absl::StrCat(\n+            \"File system scheme '\", itr.first, \"' not implemented\"));\n         local_status.resize(itr.second.size(), s);\n       }\n     } else {\n@@ -364,8 +365,8 @@ absl::Status Env::RenameFile(const std::string& src,\n   TF_RETURN_IF_ERROR(GetFileSystemForFile(src, &src_fs));\n   TF_RETURN_IF_ERROR(GetFileSystemForFile(target, &target_fs));\n   if (src_fs != target_fs) {\n-    return errors::Unimplemented(\"Renaming \", src, \" to \", target,\n-                                 \" not implemented\");\n+    return absl::UnimplementedError(\n+        absl::StrCat(\"Renaming \", src, \" to \", target, \" not implemented\"));\n   }\n   return src_fs->RenameFile(src, target);\n }\n@@ -617,7 +618,8 @@ absl::Status ReadBinaryProto(Env* env, const std::string& fname,\n   if (!proto->ParseFromCodedStream(&coded_stream) ||\n       !coded_stream.ConsumedEntireMessage()) {\n     TF_RETURN_IF_ERROR(stream->status());\n-    return errors::DataLoss(\"Can't parse \", fname, \" as binary proto\");\n+    return absl::DataLossError(\n+        absl::StrCat(\"Can't parse \", fname, \" as binary proto\"));\n   }\n   return absl::OkStatus();\n }\n@@ -639,7 +641,8 @@ absl::Status ReadTextProto(Env* env, const std::string& fname,\n \n   if (!protobuf::TextFormat::Parse(stream.get(), proto)) {\n     TF_RETURN_IF_ERROR(stream->status());\n-    return errors::DataLoss(\"Can't parse \", fname, \" as text proto\");\n+    return absl::DataLossError(\n+        absl::StrCat(\"Can't parse \", fname, \" as text proto\"));\n   }\n   return absl::OkStatus();\n }"
        },
        {
            "sha": "3a2313dbc7d3eafbf27806a17ec662199a6e1c9b",
            "filename": "third_party/xla/xla/tsl/util/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2FBUILD?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -219,6 +219,8 @@ cc_library(\n         \"//xla/tsl/platform:logging\",\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\","
        },
        {
            "sha": "a92cc27d3365eaf9a8ec7d510771c0c4bdbf9bbf",
            "filename": "third_party/xla/xla/tsl/util/env_var.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fenv_var.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/5aa36f87d51cdd763cf2b4599227397d716a5875/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fenv_var.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Futil%2Fenv_var.cc?ref=5aa36f87d51cdd763cf2b4599227397d716a5875",
            "patch": "@@ -17,6 +17,8 @@ limitations under the License.\n \n #include <stdlib.h>\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/logging.h\"\n #include \"tsl/platform/numbers.h\"\n@@ -41,7 +43,7 @@ absl::Status ReadBoolFromEnvVar(absl::string_view env_var_name,\n     *value = true;\n     return absl::OkStatus();\n   }\n-  return errors::InvalidArgument(strings::StrCat(\n+  return absl::InvalidArgumentError(absl::StrCat(\n       \"Failed to parse the env-var ${\", env_var_name, \"} into bool: \",\n       tf_env_var_val, \". Use the default value: \", default_val));\n }\n@@ -56,7 +58,7 @@ absl::Status ReadInt64FromEnvVar(absl::string_view env_var_name,\n   if (absl::SimpleAtoi(tf_env_var_val, value)) {\n     return absl::OkStatus();\n   }\n-  return errors::InvalidArgument(strings::StrCat(\n+  return absl::InvalidArgumentError(absl::StrCat(\n       \"Failed to parse the env-var ${\", env_var_name, \"} into int64: \",\n       tf_env_var_val, \". Use the default value: \", default_val));\n }\n@@ -71,7 +73,7 @@ absl::Status ReadFloatFromEnvVar(absl::string_view env_var_name,\n   if (absl::SimpleAtof(tf_env_var_val, value)) {\n     return absl::OkStatus();\n   }\n-  return errors::InvalidArgument(strings::StrCat(\n+  return absl::InvalidArgumentError(absl::StrCat(\n       \"Failed to parse the env-var ${\", env_var_name, \"} into float: \",\n       tf_env_var_val, \". Use the default value: \", default_val));\n }"
        }
    ],
    "stats": {
        "total": 326,
        "additions": 192,
        "deletions": 134
    }
}