{
    "author": "tensorflower-gardener",
    "message": "Automated Code Change\n\nPiperOrigin-RevId: 809587102",
    "sha": "7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
    "files": [
        {
            "sha": "5d3c8bb585c418724e978cf57ef6d67204670534",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_buffer_events.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_buffer_events.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_buffer_events.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_buffer_events.h?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -331,13 +331,13 @@ class CuptiActivityBufferManager {\n   void ReclaimBuffer(uint8_t* p) { buffer_pool_.ReclaimBuffer(p); }\n \n   void CacheCuptiFilledActivityBuffer(uint8_t* p, size_t sz) {\n-    absl::MutexLock lock(&buffer_mutex_);\n+    absl::MutexLock lock(buffer_mutex_);\n     cached_buffers_.emplace_back(p, sz);\n   }\n \n   std::list<ActivityBufferAndSize> PopCachedBuffers() {\n     std::list<ActivityBufferAndSize> result;\n-    absl::MutexLock lock(&buffer_mutex_);\n+    absl::MutexLock lock(buffer_mutex_);\n     std::swap(result, cached_buffers_);\n     return result;\n   }"
        },
        {
            "sha": "abd78721861a0a8e547e7c16b4c550b98530ccad",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_collector.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_collector.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_collector.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_collector.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -470,14 +470,14 @@ class PerDeviceCollector {\n   }\n \n   void AddEvent(CuptiTracerEvent&& event) {\n-    absl::MutexLock l(&m_);\n+    absl::MutexLock l(m_);\n     events_.emplace_back(std::move(event));\n   }\n \n   size_t Flush(uint64_t start_gpu_ns, uint64_t end_gpu_ns,\n                XPlaneBuilder* device_plane, XPlaneBuilder* host_plane,\n                XPlaneBuilder* nvtx_plane) {\n-    absl::MutexLock l(&m_);\n+    absl::MutexLock l(m_);\n     // Tracking event types per line.\n     absl::flat_hash_map<int64_t, absl::flat_hash_set<CuptiTracerEventType>>\n         events_types_per_line;"
        },
        {
            "sha": "ac45ba8e5f5683792068d7e96070b950b512d1c9",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_error_manager.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_error_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_error_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_error_manager.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -58,7 +58,7 @@ CuptiErrorManager::CuptiErrorManager(std::unique_ptr<CuptiInterface> interface)\n \n void CuptiErrorManager::RegisterUndoFunction(\n     const CuptiErrorManager::UndoFunction& func) {\n-  absl::MutexLock lock(&undo_stack_mu_);\n+  absl::MutexLock lock(undo_stack_mu_);\n   undo_stack_.push_back(func);\n }\n \n@@ -234,7 +234,7 @@ void CuptiErrorManager::UndoAndDisable() {\n     return;\n   }\n   // Iterates undo log and call undo APIs one by one.\n-  absl::MutexLock lock(&undo_stack_mu_);\n+  absl::MutexLock lock(undo_stack_mu_);\n   undo_disabled_ = true;\n   while (!undo_stack_.empty()) {\n     LOG(ERROR) << \"CuptiErrorManager is disabling profiling automatically.\";\n@@ -679,7 +679,7 @@ void CuptiErrorManager::CleanUp() {\n   if (undo_disabled_) {  // prevent deadlock\n     return;\n   }\n-  absl::MutexLock lock(&undo_stack_mu_);\n+  absl::MutexLock lock(undo_stack_mu_);\n   undo_disabled_ = true;\n   while (!undo_stack_.empty()) {\n     undo_stack_.pop_back();"
        },
        {
            "sha": "42346a71d720b79cecfd7401b6fa70b1cefbbb66",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_pm_sampler_impl.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -775,7 +775,7 @@ void CuptiPmSamplerDecodeThread::DecodeUntilDisabled() {\n // Entry function for decode thread\n void CuptiPmSamplerDecodeThread::MainFunc() {\n   // RAII lock to ensure mutex is released when thread exits\n-  absl::MutexLock lock(&state_mutex_);\n+  absl::MutexLock lock(state_mutex_);\n \n   // Control loop for decode thread\n   do {\n@@ -798,9 +798,9 @@ void CuptiPmSamplerDecodeThread::MainFunc() {\n         {\n           // Release lock for expensive decode call, but regain before returning\n           // to control loop\n-          state_mutex_.Unlock();\n+          state_mutex_.unlock();\n           DecodeUntilDisabled();\n-          state_mutex_.Lock();\n+          state_mutex_.lock();\n         }\n         // Returns when Disabled has been requested\n         StateIs(ThreadState::kDisabled);"
        },
        {
            "sha": "ff0a813fe05c5598984cb1ff6b7ba7e5a8310b3d",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_pm_sampler_impl.h",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_pm_sampler_impl.h?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -242,7 +242,7 @@ class CuptiPmSamplerDecodeThread {\n \n   // Tell thread to change state\n   void ChangeState(ThreadState state) ABSL_LOCKS_EXCLUDED(state_mutex_) {\n-    absl::WriterMutexLock lock(&state_mutex_);\n+    absl::WriterMutexLock lock(state_mutex_);\n     next_state_ = state;\n     state_change_notifier_.SignalAll();\n   }\n@@ -255,17 +255,17 @@ class CuptiPmSamplerDecodeThread {\n \n   // Compare state\n   bool CurrentStateIs(ThreadState state) ABSL_LOCKS_EXCLUDED(state_mutex_) {\n-    absl::ReaderMutexLock lock(&state_mutex_);\n+    absl::ReaderMutexLock lock(state_mutex_);\n     return current_state_ == state;\n   }\n \n   bool NextStateIs(ThreadState state) ABSL_LOCKS_EXCLUDED(state_mutex_) {\n-    absl::ReaderMutexLock lock(&state_mutex_);\n+    absl::ReaderMutexLock lock(state_mutex_);\n     return next_state_ == state;\n   }\n \n   void AwaitState(ThreadState state) ABSL_LOCKS_EXCLUDED(state_mutex_) {\n-    absl::ReaderMutexLock lock(&state_mutex_);\n+    absl::ReaderMutexLock lock(state_mutex_);\n     auto equals = [this, state] {\n       state_mutex_.AssertReaderHeld();\n       return current_state_ == state;"
        },
        {
            "sha": "f1f144b25764778e0352f82b428642a783bebfeb",
            "filename": "third_party/xla/xla/backends/profiler/gpu/cupti_tracer.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fcupti_tracer.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -634,24 +634,24 @@ static GraphResourceCreationInfo& GetGraphResourceCreationInfo() {\n class GuardedCallbackAnnotationsAndEvents {\n  public:\n   CallbackAnnotationsAndEvents Consume() {\n-    absl::MutexLock lock(&mu_);\n+    absl::MutexLock lock(mu_);\n     CallbackAnnotationsAndEvents grabbed;\n     std::swap(grabbed, annotations_and_events_);\n     return grabbed;\n   }\n \n   void Clear() {\n-    absl::MutexLock lock(&mu_);\n+    absl::MutexLock lock(mu_);\n     annotations_and_events_.Clear();\n   }\n \n   void IncNumDroppedEvents() {\n-    absl::MutexLock lock(&mu_);\n+    absl::MutexLock lock(mu_);\n     annotations_and_events_.IncNumDroppedEvents();\n   }\n \n   void Push(const CuptiTracer& tracer, CuptiTracerEvent&& event) {\n-    absl::MutexLock lock(&mu_);\n+    absl::MutexLock lock(mu_);\n     // Some logic change as no cross thread string comparison should be\n     // made here. The max_annotation_string is used to limit per-thread\n     // annotation string count. And annotation string is not collected\n@@ -670,7 +670,7 @@ class GuardedCallbackAnnotationsAndEvents {\n       const int64_t* head = sequence.data();\n       const int64_t* curr = &sequence.back();\n \n-      absl::MutexLock lock(&mu_);\n+      absl::MutexLock lock(mu_);\n       ScopeRangeIdTree& tree = annotations_and_events_.scope_range_id_tree();\n       for (; curr > head && !tree.contains(*curr); --curr) {\n         tree.emplace(*curr, *(curr - 1));\n@@ -996,7 +996,7 @@ class CuptiDriverApiHookWithActivityApi : public CuptiDriverApiHook {\n   absl::Status SyncAndFlush() override {\n     if (option_.sync_devices_before_stop) {\n       CuptiApiTracingDisabler disabler;\n-      absl::MutexLock lock(&mutex_);\n+      absl::MutexLock lock(mutex_);\n       for (auto& ctx : contexts_) {\n         cuCtxPushCurrent(ctx);\n         cuCtxSynchronize();  // Ignore error here for best effort.\n@@ -1011,7 +1011,7 @@ class CuptiDriverApiHookWithActivityApi : public CuptiDriverApiHook {\n   void TrackContext(CUpti_CallbackId cbid, CUcontext ctx) {\n     if (!option_.sync_devices_before_stop) return;\n     if (ctx == nullptr) return;\n-    absl::MutexLock lock(&mutex_);\n+    absl::MutexLock lock(mutex_);\n     if (cbid == CUPTI_DRIVER_TRACE_CBID_cuCtxDestroy_v2 ||\n         cbid == CUPTI_DRIVER_TRACE_CBID_cuCtxDestroy) {\n       contexts_.erase(ctx);"
        },
        {
            "sha": "6b9da0c26bbae64abd28e4ce4860ce1a178ee8a7",
            "filename": "third_party/xla/xla/backends/profiler/gpu/rocm_collector.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_collector.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_collector.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_collector.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -68,7 +68,7 @@ void AnnotationMap::Add(uint32_t correlation_id,\n   VLOG(3) << \"Add annotation: \"\n           << \" correlation_id=\" << correlation_id\n           << \", annotation: \" << annotation;\n-  absl::MutexLock lock(&map_.mutex);\n+  absl::MutexLock lock(map_.mutex);\n   if (map_.annotations.size() < max_size_) {\n     absl::string_view annotation_str =\n         *map_.annotations.insert(annotation).first;\n@@ -77,7 +77,7 @@ void AnnotationMap::Add(uint32_t correlation_id,\n }\n \n absl::string_view AnnotationMap::LookUp(uint32_t correlation_id) {\n-  absl::MutexLock lock(&map_.mutex);\n+  absl::MutexLock lock(map_.mutex);\n   auto it = map_.correlation_map.find(correlation_id);\n   return it != map_.correlation_map.end() ? it->second : absl::string_view();\n }\n@@ -391,7 +391,7 @@ class PerDeviceCollector {\n   }\n \n   void SortByStartTime() {\n-    absl::MutexLock lock(&events_mutex);\n+    absl::MutexLock lock(events_mutex);\n     std::sort(events.begin(), events.end(),\n               [](const RocmTracerEvent& event1, const RocmTracerEvent& event2) {\n                 return event1.start_time_ns < event2.start_time_ns;\n@@ -436,7 +436,7 @@ class PerDeviceCollector {\n               uint64_t end_gputime_ns, XPlaneBuilder* device_plane,\n               XPlaneBuilder* host_plane) {\n     int host_ev_cnt = 0, dev_ev_cnt = 0;\n-    absl::MutexLock l(&events_mutex);\n+    absl::MutexLock l(events_mutex);\n     // Tracking event types per line.\n     absl::flat_hash_map<tsl::int64, absl::flat_hash_set<RocmTracerEventType>>\n         events_types_per_line;\n@@ -479,7 +479,7 @@ class PerDeviceCollector {\n   PerDeviceCollector() = default;\n \n   void AddEvent(const RocmTracerEvent& event) {\n-    absl::MutexLock l(&events_mutex);\n+    absl::MutexLock l(events_mutex);\n     if (event.source == RocmTracerEventSource::ApiCallback) {\n       // Cupti api callback events were used to populate launch times etc.\n       if (event.correlation_id != RocmTracerEvent::kInvalidCorrelationId) {\n@@ -621,7 +621,7 @@ class RocmTraceCollectorImpl : public profiler::RocmTraceCollector {\n \n void RocmTraceCollectorImpl::AddEvent(RocmTracerEvent&& event,\n                                       bool is_auxiliary) {\n-  absl::MutexLock lock(&event_maps_mutex_);\n+  absl::MutexLock lock(event_maps_mutex_);\n \n   if (event.source == RocmTracerEventSource::ApiCallback && !is_auxiliary) {\n     if (num_callback_events_ > options_.max_callback_api_events) {\n@@ -663,7 +663,7 @@ void RocmTraceCollectorImpl::AddEvent(RocmTracerEvent&& event,\n }\n \n void RocmTraceCollectorImpl::Flush() {\n-  absl::MutexLock lock(&event_maps_mutex_);\n+  absl::MutexLock lock(event_maps_mutex_);\n   auto& aggregated_events_ = ApiActivityInfoExchange();\n \n   VLOG(3) << \"RocmTraceCollector collected \" << num_callback_events_"
        },
        {
            "sha": "f5283708ef9f6073482fa8d13c5b9570fa16274c",
            "filename": "third_party/xla/xla/backends/profiler/gpu/rocm_tracer.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.cc?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -303,7 +303,7 @@ absl::Status RocmApiCallbackImpl::operator()(uint32_t domain, uint32_t cbid,\n   if (data->phase == ACTIVITY_API_PHASE_ENTER) {\n     if (options_.api_tracking_set.find(cbid) !=\n         options_.api_tracking_set.end()) {\n-      absl::MutexLock lock(&api_call_start_mutex_);\n+      absl::MutexLock lock(api_call_start_mutex_);\n       api_call_start_time_.emplace(data->correlation_id,\n                                    RocmTracer::GetTimestamp());\n     }\n@@ -316,7 +316,7 @@ absl::Status RocmApiCallbackImpl::operator()(uint32_t domain, uint32_t cbid,\n \n     if (options_.api_tracking_set.find(cbid) !=\n         options_.api_tracking_set.end()) {\n-      absl::MutexLock lock(&api_call_start_mutex_);\n+      absl::MutexLock lock(api_call_start_mutex_);\n       if (api_call_start_time_.find(data->correlation_id) !=\n           api_call_start_time_.end()) {\n         enter_time = api_call_start_time_.at(data->correlation_id);"
        },
        {
            "sha": "ebe099e3839c5c6c51c12f1ef6e073da0a25cf0b",
            "filename": "third_party/xla/xla/backends/profiler/gpu/rocm_tracer.h",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/7b6a7c142e8244b5d23d643a48e85bfb7a34f74a/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Frocm_tracer.h?ref=7b6a7c142e8244b5d23d643a48e85bfb7a34f74a",
            "patch": "@@ -176,22 +176,22 @@ class RocmTracer {\n    public:\n     // add a correlation id to the pending set\n     void Add(uint32_t correlation_id) {\n-      absl::MutexLock lock(&mutex);\n+      absl::MutexLock lock(mutex);\n       pending_set.insert(correlation_id);\n     }\n     // remove a correlation id from the pending set\n     void Remove(uint32_t correlation_id) {\n-      absl::MutexLock lock(&mutex);\n+      absl::MutexLock lock(mutex);\n       pending_set.erase(correlation_id);\n     }\n     // clear the pending set\n     void Clear() {\n-      absl::MutexLock lock(&mutex);\n+      absl::MutexLock lock(mutex);\n       pending_set.clear();\n     }\n     // count the number of correlation ids in the pending set\n     size_t Count() {\n-      absl::MutexLock lock(&mutex);\n+      absl::MutexLock lock(mutex);\n       return pending_set.size();\n     }\n "
        }
    ],
    "stats": {
        "total": 68,
        "additions": 34,
        "deletions": 34
    }
}