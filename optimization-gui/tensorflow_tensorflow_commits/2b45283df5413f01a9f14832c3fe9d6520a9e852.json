{
    "author": "olupton",
    "message": "PR #35331: Make autotuner annotation more consistent\n\nImported from GitHub PR https://github.com/openxla/xla/pull/35331\n\nüìù Summary of Changes\nConsistent annotations are now emitted in `autotuner.cc` and `gemm_fusion_autotuner.cc`:\nhttps://github.com/openxla/xla/blob/a9e717e30ab1d7d87ce5aa9f04424af41da8c56c/xla/service/gpu/autotuning/gemm_fusion_autotuner.cc#L1050-L1052\n\nüéØ Justification\nThis makes it easier to see autotuner compilation in the main thread timeline, as otherwise the compilation is hidden in worker threads.\n\nüöÄ Kind of Contribution\n‚ôªÔ∏è Cleanup\n\nüìä Benchmark (for Performance Improvements)\nn/a\n\nüß™ Unit Tests:\nn/a\n\nüß™ Execution Tests:\nn/a\nCopybara import of the project:\n\n--\n4a05ad0df73cfc1da1219a511df2c2b93b5a0380 by Olli Lupton <olupton@nvidia.com>:\n\nMake autotuner annotation more consistent\n\nautotuner.cc now emits the same annotations as gemm_fusion_autotuner.cc.\nThis makes it easier to see autotuner compilation in the main thread\ntimeline, as otherwise the compilation is hidden in worker threads.\n\nMerging this change closes #35331\n\nPiperOrigin-RevId: 845155316",
    "sha": "2b45283df5413f01a9f14832c3fe9d6520a9e852",
    "files": [
        {
            "sha": "eedb86819b4f3b35e261d39122ba4a595ef12df1",
            "filename": "third_party/xla/xla/backends/autotuner/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2b45283df5413f01a9f14832c3fe9d6520a9e852/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2b45283df5413f01a9f14832c3fe9d6520a9e852/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2FBUILD?ref=2b45283df5413f01a9f14832c3fe9d6520a9e852",
            "patch": "@@ -63,6 +63,8 @@ cc_library(\n         \"@local_tsl//tsl/platform:blocking_counter\",\n         \"@local_tsl//tsl/platform:fingerprint\",\n         \"@local_tsl//tsl/platform:path\",\n+        \"@local_tsl//tsl/profiler/lib:scoped_annotation\",\n+        \"@local_tsl//tsl/profiler/lib:traceme\",\n     ],\n )\n "
        },
        {
            "sha": "40a0f43608e097a9ec37d2980e08bbe4f746b91a",
            "filename": "third_party/xla/xla/backends/autotuner/autotuner.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2b45283df5413f01a9f14832c3fe9d6520a9e852/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2Fautotuner.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2b45283df5413f01a9f14832c3fe9d6520a9e852/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2Fautotuner.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fautotuner%2Fautotuner.cc?ref=2b45283df5413f01a9f14832c3fe9d6520a9e852",
            "patch": "@@ -57,6 +57,8 @@ limitations under the License.\n #include \"xla/tsl/util/proto/proto_utils.h\"\n #include \"tsl/platform/blocking_counter.h\"\n #include \"tsl/platform/fingerprint.h\"\n+#include \"tsl/profiler/lib/scoped_annotation.h\"\n+#include \"tsl/profiler/lib/traceme.h\"\n \n namespace xla {\n \n@@ -439,6 +441,9 @@ absl::StatusOr<std::vector<Autotuner::Config>> Autotuner::GetSupportedConfigs(\n \n std::vector<absl::StatusOr<std::unique_ptr<Executable>>> Autotuner::CompileAll(\n     HloInstruction* instr, std::vector<Config>& configs) {\n+  XLA_SCOPED_LOGGING_TIMER_LEVEL(\"CompileAll\", 5);\n+  tsl::profiler::TraceMe traceme(\"CompileAll\");\n+  tsl::profiler::ScopedAnnotation annotation(\"XlaAutotunerCompilation\");\n   if (thread_pool_ == nullptr) {\n     std::vector<absl::StatusOr<std::unique_ptr<Executable>>> executables;\n     executables.reserve(configs.size());"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}