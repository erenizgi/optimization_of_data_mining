{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::Internal in xla\n\nThis change replaces usages of tsl::errors::Internal with absl::InternalError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nPiperOrigin-RevId: 837836286",
    "sha": "feb9e37991586c9011c8d176c1fa5989107bfa48",
    "files": [
        {
            "sha": "5ef18f7a8bd8ce3d8a5510ece68034a8c19a5201",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 41,
            "deletions": 38,
            "changes": 79,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=feb9e37991586c9011c8d176c1fa5989107bfa48",
            "patch": "@@ -249,7 +249,7 @@ std::set<string> AddAllSubpaths(const std::vector<string>& paths) {\n absl::Status ParseJson(absl::string_view json, Json::Value* result) {\n   Json::Reader reader;\n   if (!reader.parse(json.data(), json.data() + json.size(), *result)) {\n-    return errors::Internal(\"Couldn't parse JSON response from GCS.\");\n+    return absl::InternalError(\"Couldn't parse JSON response from GCS.\");\n   }\n   return absl::OkStatus();\n }\n@@ -263,8 +263,8 @@ absl::Status GetValue(const Json::Value& parent, const char* name,\n                       Json::Value* result) {\n   *result = parent.get(name, Json::Value::null);\n   if (result->isNull()) {\n-    return errors::Internal(\"The field '\", name,\n-                            \"' was expected in the JSON response.\");\n+    return absl::InternalError(absl::StrCat(\n+        \"The field '\", name, \"' was expected in the JSON response.\"));\n   }\n   return absl::OkStatus();\n }\n@@ -275,9 +275,9 @@ absl::Status GetStringValue(const Json::Value& parent, const char* name,\n   Json::Value result_value;\n   TF_RETURN_IF_ERROR(GetValue(parent, name, &result_value));\n   if (!result_value.isString()) {\n-    return errors::Internal(\n-        \"The field '\", name,\n-        \"' in the JSON response was expected to be a string.\");\n+    return absl::InternalError(\n+        absl::StrCat(\"The field '\", name,\n+                     \"' in the JSON response was expected to be a string.\"));\n   }\n   *result = result_value.asString();\n   return absl::OkStatus();\n@@ -296,9 +296,9 @@ absl::Status GetInt64Value(const Json::Value& parent, const char* name,\n       absl::SimpleAtoi(result_value.asCString(), result)) {\n     return absl::OkStatus();\n   }\n-  return errors::Internal(\n-      \"The field '\", name,\n-      \"' in the JSON response was expected to be a number.\");\n+  return absl::InternalError(\n+      absl::StrCat(\"The field '\", name,\n+                   \"' in the JSON response was expected to be a number.\"));\n }\n \n /// Reads a boolean JSON value with the given name from a parent JSON value.\n@@ -307,9 +307,9 @@ absl::Status GetBoolValue(const Json::Value& parent, const char* name,\n   Json::Value result_value;\n   TF_RETURN_IF_ERROR(GetValue(parent, name, &result_value));\n   if (!result_value.isBool()) {\n-    return errors::Internal(\n-        \"The field '\", name,\n-        \"' in the JSON response was expected to be a boolean.\");\n+    return absl::InternalError(\n+        absl::StrCat(\"The field '\", name,\n+                     \"' in the JSON response was expected to be a boolean.\"));\n   }\n   *result = result_value.asBool();\n   return absl::OkStatus();\n@@ -576,7 +576,7 @@ class GcsWritableFile : public WritableFile {\n     sync_needed_ = true;\n     outfile_ << data;\n     if (!outfile_.good()) {\n-      return errors::Internal(\n+      return absl::InternalError(\n           \"Could not append to the internal temporary file.\");\n     }\n     return absl::OkStatus();\n@@ -621,7 +621,7 @@ class GcsWritableFile : public WritableFile {\n   absl::Status Tell(int64_t* position) override {\n     *position = outfile_.tellp();\n     if (*position == -1) {\n-      return errors::Internal(\"tellp on the internal temporary file failed\");\n+      return absl::InternalError(\"tellp on the internal temporary file failed\");\n     }\n     return absl::OkStatus();\n   }\n@@ -636,7 +636,7 @@ class GcsWritableFile : public WritableFile {\n   absl::Status SyncImpl() {\n     outfile_.flush();\n     if (!outfile_.good()) {\n-      return errors::Internal(\n+      return absl::InternalError(\n           \"Could not write to the internal temporary file.\");\n     }\n     UploadSessionHandle session_handle;\n@@ -709,7 +709,7 @@ class GcsWritableFile : public WritableFile {\n   absl::Status GetCurrentFileSize(uint64* size) {\n     const auto tellp = outfile_.tellp();\n     if (tellp == static_cast<std::streampos>(-1)) {\n-      return errors::Internal(\n+      return absl::InternalError(\n           \"Could not get the size of the internal temporary file.\");\n     }\n     *size = tellp;\n@@ -1183,7 +1183,7 @@ absl::Status GcsFileSystem::LoadBufferFromGCS(const string& fname,\n     GcsFileStat stat;\n     if (stat_cache_->Lookup(fname, &stat)) {\n       if (offset + bytes_read < stat.base.length) {\n-        return errors::Internal(strings::Printf(\n+        return absl::InternalError(strings::Printf(\n             \"File contents are inconsistent for file: %s @ %lu.\", fname.c_str(),\n             offset));\n       }\n@@ -1219,8 +1219,9 @@ absl::Status GcsFileSystem::CreateNewUploadSession(\n     session_handle->resumable = true;\n     session_handle->session_uri = request->GetResponseHeader(\"Location\");\n     if (session_handle->session_uri.empty()) {\n-      return errors::Internal(\"Unexpected response from GCS when writing to \",\n-                              gcs_path, \": 'Location' header not returned.\");\n+      return absl::InternalError(\n+          absl::StrCat(\"Unexpected response from GCS when writing to \",\n+                       gcs_path, \": 'Location' header not returned.\"));\n     }\n   }\n   return absl::OkStatus();\n@@ -1281,8 +1282,9 @@ absl::Status GcsFileSystem::RequestUploadSessionStatus(\n \n     auto return_error = [](const std::string& gcs_path,\n                            const std::string& error_message) {\n-      return errors::Internal(\"Unexpected response from GCS when writing \",\n-                              gcs_path, \": \", error_message);\n+      return absl::InternalError(\n+          absl::StrCat(\"Unexpected response from GCS when writing \", gcs_path,\n+                       \": \", error_message));\n     };\n \n     std::vector<string> range_strs = str_util::Split(range_piece, '-');\n@@ -1870,13 +1872,13 @@ absl::Status GcsFileSystem::GetChildrenBounded(\n     const auto items = root.get(\"items\", Json::Value::null);\n     if (!items.isNull()) {\n       if (!items.isArray()) {\n-        return errors::Internal(\n+        return absl::InternalError(\n             \"Expected an array 'items' in the GCS response.\");\n       }\n       for (size_t i = 0; i < items.size(); i++) {\n         const auto item = items.get(i, Json::Value::null);\n         if (!item.isObject()) {\n-          return errors::Internal(\n+          return absl::InternalError(\n               \"Unexpected JSON format: 'items' should be a list of objects.\");\n         }\n         string name;\n@@ -1886,7 +1888,7 @@ absl::Status GcsFileSystem::GetChildrenBounded(\n         // the beginning of 'name'.\n         absl::string_view relative_path(name);\n         if (!absl::ConsumePrefix(&relative_path, object_prefix)) {\n-          return errors::Internal(\n+          return absl::InternalError(\n               absl::StrCat(\"Unexpected response: the returned file name \", name,\n                            \" doesn't match the prefix \", object_prefix));\n         }\n@@ -1902,22 +1904,22 @@ absl::Status GcsFileSystem::GetChildrenBounded(\n     if (!prefixes.isNull()) {\n       // Subfolders are returned for the non-recursive mode.\n       if (!prefixes.isArray()) {\n-        return errors::Internal(\n+        return absl::InternalError(\n             \"'prefixes' was expected to be an array in the GCS response.\");\n       }\n       for (size_t i = 0; i < prefixes.size(); i++) {\n         const auto prefix = prefixes.get(i, Json::Value::null);\n         if (prefix.isNull() || !prefix.isString()) {\n-          return errors::Internal(\n+          return absl::InternalError(\n               \"'prefixes' was expected to be an array of strings in the GCS \"\n               \"response.\");\n         }\n         const string& prefix_str = prefix.asString();\n         absl::string_view relative_path(prefix_str);\n         if (!absl::ConsumePrefix(&relative_path, object_prefix)) {\n-          return errors::Internal(\n+          return absl::InternalError(absl::StrCat(\n               \"Unexpected response: the returned folder name \", prefix_str,\n-              \" doesn't match the prefix \", object_prefix);\n+              \" doesn't match the prefix \", object_prefix));\n         }\n         result->emplace_back(relative_path);\n         if (++retrieved_results >= max_results) {\n@@ -1930,7 +1932,7 @@ absl::Status GcsFileSystem::GetChildrenBounded(\n       return absl::OkStatus();\n     }\n     if (!token.isString()) {\n-      return errors::Internal(\n+      return absl::InternalError(\n           \"Unexpected response: nextPageToken is not a string\");\n     }\n     nextPageToken = token.asString();\n@@ -1940,7 +1942,7 @@ absl::Status GcsFileSystem::GetChildrenBounded(\n absl::Status GcsFileSystem::Stat(const string& fname, TransactionToken* token,\n                                  FileStatistics* stat) {\n   if (!stat) {\n-    return errors::Internal(\"'stat' cannot be nullptr.\");\n+    return absl::InternalError(\"'stat' cannot be nullptr.\");\n   }\n   string bucket, object;\n   TF_RETURN_IF_ERROR(ParseGcsPath(fname, true, &bucket, &object));\n@@ -2067,7 +2069,7 @@ absl::Status GcsFileSystem::GetFileSize(const string& fname,\n                                         TransactionToken* token,\n                                         uint64* file_size) {\n   if (!file_size) {\n-    return errors::Internal(\"'file_size' cannot be nullptr.\");\n+    return absl::InternalError(\"'file_size' cannot be nullptr.\");\n   }\n \n   // Only validate the name.\n@@ -2199,7 +2201,7 @@ absl::Status GcsFileSystem::DeleteRecursively(const string& dirname,\n                                               int64_t* undeleted_files,\n                                               int64_t* undeleted_dirs) {\n   if (!undeleted_files || !undeleted_dirs) {\n-    return errors::Internal(\n+    return absl::InternalError(\n         \"'undeleted_files' and 'undeleted_dirs' cannot be nullptr.\");\n   }\n   *undeleted_files = 0;\n@@ -2274,9 +2276,10 @@ absl::Status GcsFileSystem::RenameFolderHns(const string& src,\n     TF_RETURN_IF_ERROR(GetBoolValue(operation_response, \"done\", &done));\n     if (done) {\n       if (operation_response.isMember(\"error\")) {\n-        return errors::Internal(\"RenameFolderHns for '\", src,\n-                                \"' failed immediately with an error: \",\n-                                operation_response[\"error\"].toStyledString());\n+        return absl::InternalError(\n+            absl::StrCat(\"RenameFolderHns for '\", src,\n+                         \"' failed immediately with an error: \",\n+                         operation_response[\"error\"].toStyledString()));\n       }\n       VLOG(1) << \"RenameFolderHns finished immediately for \" << src;\n       return absl::OkStatus();\n@@ -2311,9 +2314,9 @@ absl::Status GcsFileSystem::RenameFolderHns(const string& src,\n     TF_RETURN_IF_ERROR(ParseJson(poll_output_buffer, &operation_response));\n \n     if (operation_response.isMember(\"error\")) {\n-      return errors::Internal(\"RenameFolderHns for '\", src,\n-                              \"' failed with an error: \",\n-                              operation_response[\"error\"].toStyledString());\n+      return absl::InternalError(\n+          absl::StrCat(\"RenameFolderHns for '\", src, \"' failed with an error: \",\n+                       operation_response[\"error\"].toStyledString()));\n     }\n \n     if (operation_response.isMember(\"done\")) {"
        },
        {
            "sha": "a7ba4de1866025e7401b44db9ff1e274ba729953",
            "filename": "third_party/xla/xla/tsl/profiler/rpc/client/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2FBUILD?ref=feb9e37991586c9011c8d176c1fa5989107bfa48",
            "patch": "@@ -135,6 +135,7 @@ cc_library(\n         \"//xla/tsl/protobuf:error_codes_proto_impl_cc\",\n         \"@com_github_grpc_grpc//:grpc++\",\n         \"@com_google_absl//absl/memory\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/time\",\n         \"@local_tsl//tsl/profiler/protobuf:profiler_analysis_cc_grpc_proto\","
        },
        {
            "sha": "3b4ce65d31137d0728a33e484ff4eb10432adc7f",
            "filename": "third_party/xla/xla/tsl/profiler/rpc/client/profiler_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fprofiler_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/feb9e37991586c9011c8d176c1fa5989107bfa48/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fprofiler_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fprofiler_client.cc?ref=feb9e37991586c9011c8d176c1fa5989107bfa48",
            "patch": "@@ -18,13 +18,13 @@ limitations under the License.\n #include <memory>\n \n #include \"absl/memory/memory.h\"\n+#include \"absl/status/status.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n #include \"grpcpp/grpcpp.h\"  // IWYU pragma: keep\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/logging.h\"\n #include \"xla/tsl/platform/status.h\"\n-#include \"xla/tsl/platform/types.h\"\n #include \"xla/tsl/protobuf/error_codes.pb.h\"\n \n namespace tsl {\n@@ -149,7 +149,7 @@ std::unique_ptr<ProfileResponse> RemoteProfilerSession::WaitForCompletion(\n   bool success = cq_.Next(&got_tag, &ok);\n   if (!success || !ok || got_tag == nullptr) {\n     out_status =\n-        errors::Internal(\"Missing or invalid event from completion queue.\");\n+        absl::InternalError(\"Missing or invalid event from completion queue.\");\n     return nullptr;\n   }\n "
        }
    ],
    "stats": {
        "total": 84,
        "additions": 44,
        "deletions": 40
    }
}