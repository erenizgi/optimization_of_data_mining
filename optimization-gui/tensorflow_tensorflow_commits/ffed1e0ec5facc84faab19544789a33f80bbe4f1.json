{
    "author": "ezhulenev",
    "message": "[xla:cpu] Remove unused runtime_single_threaded_matmul for f32\n\nPiperOrigin-RevId: 839754165",
    "sha": "ffed1e0ec5facc84faab19544789a33f80bbe4f1",
    "files": [
        {
            "sha": "66cee21b9ca00045f9d54007f902b70b0462eccc",
            "filename": "third_party/xla/xla/service/cpu/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 24,
            "changes": 26,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ffed1e0ec5facc84faab19544789a33f80bbe4f1/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ffed1e0ec5facc84faab19544789a33f80bbe4f1/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD?ref=ffed1e0ec5facc84faab19544789a33f80bbe4f1",
            "patch": "@@ -50,24 +50,13 @@ cc_library(\n \n filegroup(\n     name = \"runtime_srcs\",\n-    srcs = [\n-        # Single-threaded support.\n-        \"runtime_single_threaded_matmul_common.h\",\n-        \"runtime_single_threaded_matmul_f32.cc\",\n-        # Multi-threaded support.\n-        \"//xla/backends/cpu/runtime:runtime_srcs\",\n-    ],\n+    srcs = [\"//xla/backends/cpu/runtime:runtime_srcs\"],\n     visibility = internal_visibility([\":friends\"]),\n )\n \n filegroup(\n     name = \"runtime_hdrs\",\n-    srcs = [\n-        # Single-threaded support.\n-        \"runtime_single_threaded_matmul.h\",\n-        # Multi-threaded support.\n-        \"//xla/backends/cpu/runtime:runtime_hdrs\",\n-    ],\n+    srcs = [\"//xla/backends/cpu/runtime:runtime_hdrs\"],\n     visibility = internal_visibility([\":friends\"]),\n )\n \n@@ -1044,20 +1033,9 @@ cc_library(\n \n cc_library(\n     name = \"runtime_single_threaded_matmul_nomkl\",\n-    srcs = [\n-        \"runtime_single_threaded_matmul_common.h\",\n-        \"runtime_single_threaded_matmul_f32.cc\",\n-    ],\n-    hdrs = [\"runtime_single_threaded_matmul.h\"],\n     compatible_with = get_compatible_with_portable(),\n     copts = runtime_copts(),\n     visibility = [\"//visibility:public\"],\n-    deps = [\n-        \"//xla/tsl/framework/contraction:eigen_contraction_kernel_no_mkl\",\n-        \"@com_google_absl//absl/base:core_headers\",\n-        \"@eigen_archive//:eigen3\",\n-        \"@local_tsl//tsl/platform:ml_dtypes\",\n-    ],\n )\n \n cc_library("
        },
        {
            "sha": "ba09bbd056c7668784d555c99cab63a4045c92a5",
            "filename": "third_party/xla/xla/service/cpu/runtime_single_threaded_matmul.h",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul.h?ref=16f017d5d0ba27796ac423827d3a4be8c3522da4",
            "patch": "@@ -1,35 +0,0 @@\n-/* Copyright 2017 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_H_\n-#define XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_H_\n-\n-#include <cstdint>\n-\n-extern \"C\" {\n-\n-// Performs a single-threaded matrix multiplication using Eigen. 'lhs' and 'rhs'\n-// are pointers to buffers containing input matrices in column-major order.\n-// 'out' is a pointer to a buffer sufficiently large to hold the result of the\n-// operation. Following standard nomenclature: lhs is m x k, rhs is k x n, and\n-// out is m x n.\n-extern void __xla_cpu_runtime_EigenSingleThreadedMatMulF32(\n-    const void* /* xla::ExecutableRunOptions* */ run_options_ptr, float* out,\n-    float* lhs, float* rhs, int64_t m, int64_t n, int64_t k,\n-    int32_t transpose_lhs, int32_t transpose_rhs);\n-\n-}  // extern \"C\"\n-\n-#endif  // XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_H_"
        },
        {
            "sha": "295fb14e9a1629538b83c62ecd349cdab70ce117",
            "filename": "third_party/xla/xla/service/cpu/runtime_single_threaded_matmul_common.h",
            "status": "removed",
            "additions": 0,
            "deletions": 88,
            "changes": 88,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_common.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_common.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_common.h?ref=16f017d5d0ba27796ac423827d3a4be8c3522da4",
            "patch": "@@ -1,88 +0,0 @@\n-/* Copyright 2017 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_COMMON_H_\n-#define XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_COMMON_H_\n-\n-#include <cstdint>\n-\n-#include \"absl/base/attributes.h\"\n-#include \"Eigen/Core\"\n-#include \"unsupported/Eigen/CXX11/Tensor\"\n-\n-#if defined(TENSORFLOW_USE_CUSTOM_CONTRACTION_KERNEL)\n-#include \"xla/tsl/framework/contraction/eigen_contraction_kernel.h\"\n-#endif\n-\n-namespace xla {\n-\n-static inline bool Is16BytesAligned(void* ptr) {\n-  return reinterpret_cast<uintptr_t>(ptr) % 16 == 0;\n-}\n-\n-template <typename T, Eigen::AlignmentType Alignment>\n-void SingleThreadedMatMul(const void* run_options_ptr, T* out, T* lhs, T* rhs,\n-                          int64_t m, int64_t n, int64_t k,\n-                          int32_t transpose_lhs, int32_t transpose_rhs) {\n-  int64_t lhs_rows = m;\n-  int64_t lhs_cols = k;\n-  if (transpose_lhs) {\n-    std::swap(lhs_rows, lhs_cols);\n-  }\n-\n-  int64_t rhs_rows = k;\n-  int64_t rhs_cols = n;\n-  if (transpose_rhs) {\n-    std::swap(rhs_rows, rhs_cols);\n-  }\n-\n-  const Eigen::TensorMap<Eigen::Tensor<const T, 2>, Alignment> A(lhs, lhs_rows,\n-                                                                 lhs_cols);\n-  const Eigen::TensorMap<Eigen::Tensor<const T, 2>, Alignment> B(rhs, rhs_rows,\n-                                                                 rhs_cols);\n-  Eigen::TensorMap<Eigen::Tensor<T, 2>, Alignment> C(out, m, n);\n-\n-  typedef typename Eigen::Tensor<T, 2>::DimensionPair DimPair;\n-  int lhs_contract_dim = transpose_lhs ? 0 : 1;\n-  int rhs_contract_dim = transpose_rhs ? 1 : 0;\n-  const Eigen::array<DimPair, 1> dims(\n-      {DimPair(lhs_contract_dim, rhs_contract_dim)});\n-\n-  // Matrix multiply is a special case of the \"contract\" operation where\n-  // the contraction is performed along dimension 1 of the lhs and dimension\n-  // 0 of the rhs.\n-  C = A.contract(B, dims);\n-}\n-\n-template <typename T>\n-void SingleThreadedMatMulDispatch(const void* run_options_ptr, T* out, T* lhs,\n-                                  T* rhs, int64_t m, int64_t n, int64_t k,\n-                                  int32_t transpose_lhs,\n-                                  int32_t transpose_rhs) {\n-  bool all_buffers_16b_aligned =\n-      Is16BytesAligned(out) && Is16BytesAligned(lhs) && Is16BytesAligned(rhs);\n-\n-  if (!all_buffers_16b_aligned) {\n-    SingleThreadedMatMul<T, Eigen::Unaligned>(\n-        run_options_ptr, out, lhs, rhs, m, n, k, transpose_lhs, transpose_rhs);\n-  }\n-\n-  SingleThreadedMatMul<T, Eigen::Aligned16>(run_options_ptr, out, lhs, rhs, m,\n-                                            n, k, transpose_lhs, transpose_rhs);\n-}\n-\n-}  // namespace xla\n-\n-#endif  // XLA_SERVICE_CPU_RUNTIME_SINGLE_THREADED_MATMUL_COMMON_H_"
        },
        {
            "sha": "23b552e470c6981d19c47aa82b997e5e8423d71f",
            "filename": "third_party/xla/xla/service/cpu/runtime_single_threaded_matmul_f32.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 31,
            "changes": 31,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_f32.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/16f017d5d0ba27796ac423827d3a4be8c3522da4/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_f32.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Fruntime_single_threaded_matmul_f32.cc?ref=16f017d5d0ba27796ac423827d3a4be8c3522da4",
            "patch": "@@ -1,31 +0,0 @@\n-/* Copyright 2017 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#include \"xla/service/cpu/runtime_single_threaded_matmul.h\"\n-\n-#include <cstdint>\n-\n-#include \"absl/base/attributes.h\"\n-#include \"xla/service/cpu/runtime_single_threaded_matmul_common.h\"\n-\n-ABSL_ATTRIBUTE_NO_SANITIZE_MEMORY void\n-__xla_cpu_runtime_EigenSingleThreadedMatMulF32(const void* run_options_ptr,\n-                                               float* out, float* lhs,\n-                                               float* rhs, int64_t m, int64_t n,\n-                                               int64_t k, int32_t transpose_lhs,\n-                                               int32_t transpose_rhs) {\n-  xla::SingleThreadedMatMulDispatch<float>(run_options_ptr, out, lhs, rhs, m, n,\n-                                           k, transpose_lhs, transpose_rhs);\n-}"
        }
    ],
    "stats": {
        "total": 180,
        "additions": 2,
        "deletions": 178
    }
}