{
    "author": "tensorflower-gardener",
    "message": "hlo_runner_pjrt should keep hlo module config's seed() in optimized hlo module\n\nPiperOrigin-RevId: 837185528",
    "sha": "1ab53c2a0438e88694e01930578e42dfc548df95",
    "files": [
        {
            "sha": "eebcdc0e0401f3e5c18d1d4932ed0f02694a8cef",
            "filename": "third_party/xla/xla/service/hlo_runner_pjrt.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1ab53c2a0438e88694e01930578e42dfc548df95/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1ab53c2a0438e88694e01930578e42dfc548df95/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_runner_pjrt.cc?ref=1ab53c2a0438e88694e01930578e42dfc548df95",
            "patch": "@@ -491,6 +491,12 @@ HloRunnerPjRt::CreateExecutable(std::unique_ptr<HloModule> module,\n   absl::StatusOr<std::unique_ptr<PjRtExecutable>> pjrt_executable =\n       pjrt_client_->Compile(computation, compile_options);\n   if (pjrt_executable.ok()) {\n+    absl::StatusOr<std::vector<std::shared_ptr<HloModule>>> hlo_modules =\n+        pjrt_executable->get()->GetHloModules();\n+    if (hlo_modules.ok() && !hlo_modules->empty()) {\n+      std::shared_ptr<HloModule> exe_module = (*hlo_modules)[0];\n+      exe_module->mutable_config().set_seed(module->config().seed());\n+    }\n     return std::make_unique<HloRunnerPjRtExecutable>(\n         this, *std::move(pjrt_executable));\n   }\n@@ -502,6 +508,14 @@ HloRunnerPjRt::CreateExecutable(std::unique_ptr<HloModule> module,\n   TF_ASSIGN_OR_RETURN(\n       std::unique_ptr<PjRtLoadedExecutable> pjrt_loaded_executable,\n       pjrt_client_->CompileAndLoad(computation, std::move(compile_options)));\n+  if (pjrt_loaded_executable != nullptr) {\n+    absl::StatusOr<std::vector<std::shared_ptr<HloModule>>> hlo_modules =\n+        pjrt_loaded_executable->GetHloModules();\n+    if (hlo_modules.ok() && !hlo_modules->empty()) {\n+      std::shared_ptr<HloModule> exe_module = (*hlo_modules)[0];\n+      exe_module->mutable_config().set_seed(module->config().seed());\n+    }\n+  }\n   return std::make_unique<HloRunnerPjRtExecutable>(\n       this, std::move(pjrt_loaded_executable));\n }"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 14,
        "deletions": 0
    }
}