{
    "author": "ezhulenev",
    "message": "[xla:ffi] Do not depend on GPU backend from default FFI implementation\n\nDo not re-export GPU FFI header from the default one and instead explicitly add GPU dependency to all targets that use GPU FFI features.\n\nPiperOrigin-RevId: 839736708",
    "sha": "4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
    "files": [
        {
            "sha": "ac3e89a705782631e4496d09aed3fce7d0044e26",
            "filename": "third_party/xla/xla/backends/gpu/codegen/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2FBUILD?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -200,6 +200,7 @@ xla_test(\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla:xla_proto_cc\",\n+        \"//xla/backends/gpu:ffi\",\n         \"//xla/backends/gpu/runtime:dynamic_slice_thunk\",\n         \"//xla/backends/gpu/runtime:sequential_thunk\",\n         \"//xla/backends/gpu/runtime:thunk\","
        },
        {
            "sha": "f78d96fd6492fe74b7e2997e9ef3c4d7e7576e92",
            "filename": "third_party/xla/xla/backends/gpu/codegen/dynamic_slice_fusion_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Fdynamic_slice_fusion_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Fdynamic_slice_fusion_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fcodegen%2Fdynamic_slice_fusion_test.cc?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -25,6 +25,7 @@ limitations under the License.\n #include \"absl/algorithm/container.h\"\n #include \"absl/status/status.h\"\n #include \"absl/strings/ascii.h\"\n+#include \"xla/backends/gpu/ffi.h\"\n #include \"xla/backends/gpu/runtime/dynamic_slice_thunk.h\"\n #include \"xla/backends/gpu/runtime/sequential_thunk.h\"\n #include \"xla/backends/gpu/runtime/thunk.h\""
        },
        {
            "sha": "4c5f5335527d8d986a9f9bd6f374e9c22e87870f",
            "filename": "third_party/xla/xla/backends/gpu/runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2FBUILD?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -286,6 +286,7 @@ xla_test(\n         \":thunk_proto_deserialization\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n+        \"//xla/backends/gpu:ffi\",\n         \"//xla/ffi\",\n         \"//xla/ffi:attribute_map\",\n         \"//xla/ffi:ffi_api\","
        },
        {
            "sha": "09de14924344a5061a73ec66874536fd2f3d75d1",
            "filename": "third_party/xla/xla/backends/gpu/runtime/dynamic_slice_thunk_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk_test.cc?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -30,6 +30,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/ascii.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/backends/gpu/ffi.h\"\n #include \"xla/backends/gpu/runtime/custom_call_thunk.h\"\n #include \"xla/backends/gpu/runtime/dynamic_slice_thunk.pb.h\"\n #include \"xla/backends/gpu/runtime/gemm_thunk.h\""
        },
        {
            "sha": "5e6c544c3a1ac75aec8daec2ab9210703d3c5bcb",
            "filename": "third_party/xla/xla/ffi/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fffi%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fffi%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2FBUILD?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -143,7 +143,6 @@ cc_library(\n         \"//xla:types\",\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n-        \"//xla/backends/gpu:ffi\",\n         \"//xla/ffi/api:c_api\",\n         \"//xla/ffi/api:c_api_internal\",\n         \"//xla/hlo/ir:hlo\","
        },
        {
            "sha": "f03a7d5da6196a36c6f12e4442c6c8937f613039",
            "filename": "third_party/xla/xla/ffi/ffi.h",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fffi%2Fffi.h?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -57,9 +57,6 @@ limitations under the License.\n #include \"xla/util.h\"\n #include \"xla/xla_data.pb.h\"\n \n-// TODO(ezhulenev): Remove this once JAX is migrated to the new header.\n-#include \"xla/backends/gpu/ffi.h\"\n-\n namespace xla::ffi {\n \n // Type tags to bind parameters passed via execution context to FFI handler."
        },
        {
            "sha": "b3ed1dd208a74f2fe95da41ecb8aaa84ba578072",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -198,6 +198,7 @@ xla_test(\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla:xla_proto_cc\",\n+        \"//xla/backends/gpu:ffi\",\n         \"//xla/ffi\",\n         \"//xla/ffi:ffi_api\",\n         \"//xla/hlo/builder:xla_computation\","
        },
        {
            "sha": "d77bc50153a26333917900d8a579e4f25d0a364e",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_client_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/4d9869c8da86ea4fa362b0a99fca6e6b57b77317/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc?ref=4d9869c8da86ea4fa362b0a99fca6e6b57b77317",
            "patch": "@@ -46,6 +46,7 @@ limitations under the License.\n #include \"absl/types/span.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"google/protobuf/text_format.h\"\n+#include \"xla/backends/gpu/ffi.h\"\n #include \"xla/ffi/ffi.h\"\n #include \"xla/ffi/ffi_api.h\"\n #include \"xla/future.h\""
        }
    ],
    "stats": {
        "total": 10,
        "additions": 6,
        "deletions": 4
    }
}