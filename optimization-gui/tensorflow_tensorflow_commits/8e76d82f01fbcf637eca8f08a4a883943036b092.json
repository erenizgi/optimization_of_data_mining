{
    "author": "ezhulenev",
    "message": "[xla:codegen] Remove LlvmKernelEmitter alias\n\nPiperOrigin-RevId: 825312592",
    "sha": "8e76d82f01fbcf637eca8f08a4a883943036b092",
    "files": [
        {
            "sha": "0984ed6668be4f9c5b3afda8a2e639cc53699945",
            "filename": "third_party/xla/xla/backends/cpu/codegen/computation_kernel_emitter.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fcomputation_kernel_emitter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fcomputation_kernel_emitter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fcomputation_kernel_emitter.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -26,7 +26,7 @@ limitations under the License.\n #include \"llvm/IR/IRBuilder.h\"\n #include \"llvm/IR/Module.h\"\n #include \"xla/backends/cpu/codegen/target_machine_features.h\"\n-#include \"xla/codegen/kernel_definition.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/service/buffer_assignment.h\"\n@@ -44,7 +44,7 @@ namespace xla::cpu {\n // producing a synthetic buffer_table for all arguments and results (including\n // intermediate instructions), though this may change in the future to use stack\n // allocations for small buffers.\n-class ComputationKernelEmitter final : public LlvmKernelEmitter {\n+class ComputationKernelEmitter final : public KernelEmitter<LlvmKernelSource> {\n  public:\n   ComputationKernelEmitter(const HloInstruction* instr,\n                            const BufferAssignment* buffer_assignment,"
        },
        {
            "sha": "01fdb98e237c3fa5d7acc3a12213118078c67b49",
            "filename": "third_party/xla/xla/backends/cpu/codegen/dot/dot_kernel_emitter.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fdot%2Fdot_kernel_emitter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fdot%2Fdot_kernel_emitter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Fdot%2Fdot_kernel_emitter.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -19,14 +19,14 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"xla/backends/cpu/codegen/target_machine_features.h\"\n-#include \"xla/codegen/kernel_definition.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/service/buffer_assignment.h\"\n \n namespace xla::cpu {\n \n-class DotKernelEmitter final : public LlvmKernelEmitter {\n+class DotKernelEmitter final : public KernelEmitter<LlvmKernelSource> {\n  public:\n   DotKernelEmitter(const HloInstruction* instr,\n                    const BufferAssignment* buffer_assignment,"
        },
        {
            "sha": "bdce35a2907d7ec09625a0c370855812f49019df",
            "filename": "third_party/xla/xla/backends/cpu/codegen/elemental/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2FBUILD?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -26,6 +26,7 @@ cc_library(\n         \"//xla/backends/cpu/codegen:kernel_api_ir_builder\",\n         \"//xla/backends/cpu/codegen:target_machine_features\",\n         \"//xla/codegen:kernel_definition\",\n+        \"//xla/codegen:kernel_emitter\",\n         \"//xla/codegen:kernel_spec\",\n         \"//xla/codegen:llvm_kernel_source\",\n         \"//xla/hlo/ir:hlo\",\n@@ -70,6 +71,7 @@ cc_library(\n         \"//xla/backends/cpu/codegen:kernel_api_ir_builder\",\n         \"//xla/backends/cpu/codegen:target_machine_features\",\n         \"//xla/codegen:kernel_definition\",\n+        \"//xla/codegen:kernel_emitter\",\n         \"//xla/codegen:kernel_spec\",\n         \"//xla/codegen:llvm_kernel_source\",\n         \"//xla/hlo/ir:hlo\",\n@@ -102,6 +104,7 @@ xla_cc_test(\n         \":elemental_kernel_emitter\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/codegen:kernel_definition\",\n+        \"//xla/codegen:kernel_emitter\",\n         \"//xla/codegen:llvm_kernel_source\",\n         \"//xla/hlo/analysis:alias_info\",\n         \"//xla/hlo/analysis:hlo_ordering\","
        },
        {
            "sha": "dfe5c46a93f3369b5c24293aaf6da236e36ab209",
            "filename": "third_party/xla/xla/backends/cpu/codegen/elemental/concatenate_kernel_emitter.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Fconcatenate_kernel_emitter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Fconcatenate_kernel_emitter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Fconcatenate_kernel_emitter.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -19,14 +19,14 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"xla/backends/cpu/codegen/target_machine_features.h\"\n-#include \"xla/codegen/kernel_definition.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/service/buffer_assignment.h\"\n \n namespace xla::cpu {\n \n-class ConcatenateKernelEmitter final : public LlvmKernelEmitter {\n+class ConcatenateKernelEmitter final : public KernelEmitter<LlvmKernelSource> {\n  public:\n   ConcatenateKernelEmitter(const HloInstruction* instr,\n                            const BufferAssignment* buffer_assignment,"
        },
        {
            "sha": "74a65c4f457aeb79ec6771fe81caf92172df848e",
            "filename": "third_party/xla/xla/backends/cpu/codegen/elemental/elemental_kernel_emitter.h",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Felemental_kernel_emitter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Felemental_kernel_emitter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Fcodegen%2Felemental%2Felemental_kernel_emitter.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -16,15 +16,13 @@ limitations under the License.\n #ifndef XLA_BACKENDS_CPU_CODEGEN_ELEMENTAL_ELEMENTAL_KERNEL_EMITTER_H_\n #define XLA_BACKENDS_CPU_CODEGEN_ELEMENTAL_ELEMENTAL_KERNEL_EMITTER_H_\n \n-#include <string>\n-\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"llvm/IR/IRBuilder.h\"\n #include \"llvm/IR/Module.h\"\n #include \"xla/backends/cpu/codegen/kernel_api_ir_builder.h\"\n #include \"xla/backends/cpu/codegen/target_machine_features.h\"\n-#include \"xla/codegen/kernel_definition.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/runtime/work_group.h\"\n@@ -34,7 +32,7 @@ limitations under the License.\n \n namespace xla::cpu {\n \n-class ElementalKernelEmitter final : public LlvmKernelEmitter {\n+class ElementalKernelEmitter final : public KernelEmitter<LlvmKernelSource> {\n  public:\n   ElementalKernelEmitter(const HloInstruction* instr,\n                          const BufferAssignment* buffer_assignment,"
        },
        {
            "sha": "f79c5e7e175c3e2494cc9326dac4abc0fac5d28b",
            "filename": "third_party/xla/xla/backends/cpu/testlib/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2FBUILD?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -89,6 +89,7 @@ cc_library(\n     deps = [\n         \"//xla:util\",\n         \"//xla/codegen:kernel_definition\",\n+        \"//xla/codegen:kernel_emitter\",\n         \"//xla/codegen:kernel_spec\",\n         \"//xla/codegen:llvm_kernel_source\",\n         \"//xla/runtime:buffer_use\",\n@@ -150,6 +151,7 @@ tsl_pybind_extension(\n         \"//xla/backends/cpu/codegen/elemental:elemental_kernel_emitter\",\n         \"//xla/backends/cpu/codegen/emitters:cpu_fusion_emitters\",\n         \"//xla/codegen:kernel_definition\",\n+        \"//xla/codegen:kernel_emitter\",\n         \"//xla/codegen:llvm_kernel_source\",\n         \"//xla/codegen:mlir_kernel_source\",\n         \"//xla/codegen/testlib:kernel_runner\","
        },
        {
            "sha": "cbed4a63ed9c7f3214e55d9a37ab7632c6888d61",
            "filename": "third_party/xla/xla/backends/cpu/testlib/kernel_runner_extension.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fkernel_runner_extension.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fkernel_runner_extension.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fkernel_runner_extension.cc?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -42,6 +42,7 @@ limitations under the License.\n #include \"xla/backends/cpu/testlib/llvm_ir_kernel_emitter.h\"\n #include \"xla/backends/cpu/testlib/mlir_kernel_emitter.h\"\n #include \"xla/codegen/kernel_definition.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/codegen/mlir_kernel_source.h\"\n #include \"xla/codegen/testlib/kernel_runner.h\"\n@@ -86,10 +87,10 @@ NB_MODULE(_extension, kernel_runner_module) {\n   // Use a tuple and cast to NumWorkGroups to take advantage of built in\n   // bindings.\n   using NbNumWorkGroups = std::tuple<uint64_t, uint64_t, uint64_t>;\n-  nb::class_<LlvmTestKernelEmitter, LlvmKernelEmitter>(kernel_runner_module,\n-                                                       \"LlvmTestKernelEmitter\")\n-      .def(\"__init__\", [](LlvmKernelEmitter* self, absl::string_view ir,\n-                          absl::string_view kernel_name,\n+  nb::class_<LlvmTestKernelEmitter, KernelEmitter<LlvmKernelSource>>(\n+      kernel_runner_module, \"LlvmTestKernelEmitter\")\n+      .def(\"__init__\", [](KernelEmitter<LlvmKernelSource>* self,\n+                          absl::string_view ir, absl::string_view kernel_name,\n                           NbNumWorkGroups num_workgroups) {\n         new (self)\n             LlvmTestKernelEmitter(ir, kernel_name,\n@@ -160,28 +161,28 @@ NB_MODULE(_extension, kernel_runner_module) {\n                                     \"TargetMachineFeatures\")\n       .def(\"__str__\", &TargetMachineFeatures::get_target_feature_string);\n \n-  nb::class_<ElementalKernelEmitter, LlvmKernelEmitter>(\n+  nb::class_<ElementalKernelEmitter, KernelEmitter<LlvmKernelSource>>(\n       kernel_runner_module, \"ElementalKernelEmitter\")\n       .def(nb::init<const HloInstruction*, const BufferAssignment*,\n                     const TargetMachineFeatures*>(),\n            nb::keep_alive<1, 2>(), nb::keep_alive<1, 3>(),\n            nb::keep_alive<1, 4>());\n \n-  nb::class_<DotKernelEmitter, LlvmKernelEmitter>(kernel_runner_module,\n-                                                  \"DotKernelEmitter\")\n+  nb::class_<DotKernelEmitter, KernelEmitter<LlvmKernelSource>>(\n+      kernel_runner_module, \"DotKernelEmitter\")\n       .def(nb::init<const HloInstruction*, const BufferAssignment*,\n                     const TargetMachineFeatures*>(),\n            nb::keep_alive<1, 2>(), nb::keep_alive<1, 3>(),\n            nb::keep_alive<1, 4>());\n \n-  nb::class_<ConcatenateKernelEmitter, LlvmKernelEmitter>(\n+  nb::class_<ConcatenateKernelEmitter, KernelEmitter<LlvmKernelSource>>(\n       kernel_runner_module, \"ConcatenateKernelEmitter\")\n       .def(nb::init<const HloInstruction*, const BufferAssignment*,\n                     const TargetMachineFeatures*>(),\n            nb::keep_alive<1, 2>(), nb::keep_alive<1, 3>(),\n            nb::keep_alive<1, 4>());\n \n-  nb::class_<ComputationKernelEmitter, LlvmKernelEmitter>(\n+  nb::class_<ComputationKernelEmitter, KernelEmitter<LlvmKernelSource>>(\n       kernel_runner_module, \"ComputationKernelEmitter\")\n       .def(nb::init<const HloInstruction*, const BufferAssignment*,\n                     const TargetMachineFeatures*>(),"
        },
        {
            "sha": "afeccd36af313a7c2ca6c9200139df1e633cfa78",
            "filename": "third_party/xla/xla/backends/cpu/testlib/llvm_ir_kernel_emitter.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fllvm_ir_kernel_emitter.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fllvm_ir_kernel_emitter.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fcpu%2Ftestlib%2Fllvm_ir_kernel_emitter.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -23,6 +23,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/llvm_kernel_source.h\"\n #include \"xla/runtime/buffer_use.h\"\n #include \"xla/runtime/work_group.h\"\n@@ -34,7 +35,7 @@ namespace xla::cpu {\n // into the dedicated LLVM context and module instance. This kernel emitter is\n // intended to be used for testing purposes only: (1) load pre-compiled LLVM IR\n // into the XLA kernel spec; (2) Execute it with user provided input buffers.\n-class LlvmTestKernelEmitter : public LlvmKernelEmitter {\n+class LlvmTestKernelEmitter : public KernelEmitter<LlvmKernelSource> {\n  public:\n   // When loading kernel IR into the KernelSpec we create a separate buffer\n   // allocation for every kernel argument. We don't use buffer assignment in"
        },
        {
            "sha": "68dd2093d1176e71a9a60ad17b51e9ca64a43258",
            "filename": "third_party/xla/xla/codegen/llvm_kernel_source.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fcodegen%2Fllvm_kernel_source.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fcodegen%2Fllvm_kernel_source.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fllvm_kernel_source.h?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -24,7 +24,6 @@ limitations under the License.\n #include \"llvm/IR/LLVMContext.h\"\n #include \"llvm/IR/Module.h\"\n #include \"xla/codegen/kernel_definition.h\"\n-#include \"xla/codegen/kernel_emitter.h\"\n #include \"xla/codegen/kernel_source.h\"\n \n namespace xla {\n@@ -53,7 +52,6 @@ class LlvmKernelSource final : public KernelSource {\n };\n \n using LlvmKernelDefinition = KernelDefinition<LlvmKernelSource>;  // NOLINT\n-using LlvmKernelEmitter = KernelEmitter<LlvmKernelSource>;        // NOLINT\n \n }  // namespace xla\n "
        },
        {
            "sha": "220b59b0235a7fe395d2a0266929fd8b285b2542",
            "filename": "third_party/xla/xla/codegen/testlib/kernel_runner_extension.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fcodegen%2Ftestlib%2Fkernel_runner_extension.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e76d82f01fbcf637eca8f08a4a883943036b092/third_party%2Fxla%2Fxla%2Fcodegen%2Ftestlib%2Fkernel_runner_extension.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Ftestlib%2Fkernel_runner_extension.cc?ref=8e76d82f01fbcf637eca8f08a4a883943036b092",
            "patch": "@@ -220,10 +220,10 @@ NB_MODULE(_extension, kernel_runner_module) {\n         }\n         return std::move(definition).value();\n       });\n-  nb::class_<MlirKernelEmitter, KernelEmitterBase>(kernel_runner_module,\n-                                                   \"MlirKernelEmitter\");\n-  nb::class_<LlvmKernelEmitter, KernelEmitterBase>(kernel_runner_module,\n-                                                   \"LlvmKernelEmitter\");\n+  nb::class_<KernelEmitter<MlirKernelSource>, KernelEmitterBase>(\n+      kernel_runner_module, \"MlirKernelEmitter\");\n+  nb::class_<KernelEmitter<LlvmKernelSource>, KernelEmitterBase>(\n+      kernel_runner_module, \"LlvmKernelEmitter\");\n \n   nb::class_<KernelRunner>(kernel_runner_module, \"KernelRunner\")\n       .def(\"call\", &KernelRunnerCall);"
        }
    ],
    "stats": {
        "total": 55,
        "additions": 29,
        "deletions": 26
    }
}