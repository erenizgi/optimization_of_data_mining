{
    "author": "majnemer",
    "message": "[TF] Delete TF_Log, migrate stringprintf to ABSL.\n\nNo functional change is intended.\n\nPiperOrigin-RevId: 827673582",
    "sha": "6719a7895aaab6fcd6d7731083b666c567dd0fc8",
    "files": [
        {
            "sha": "a5c68f08687430fb14ecf2c97edb8b6d6c9e239a",
            "filename": "tensorflow/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -1187,7 +1187,6 @@ tf_cc_shared_library(\n                 \"//tensorflow/c:env\",\n                 \"//tensorflow/c:kernels\",\n                 \"//tensorflow/c:kernels_experimental\",\n-                \"//tensorflow/c:logging\",\n                 \"//tensorflow/c:ops\",\n                 \"//tensorflow/cc/saved_model:fingerprinting_impl\",\n                 \"//tensorflow/cc/saved_model:loader_lite_impl\","
        },
        {
            "sha": "3f4ec98028e8c300f67471fc612e6cd34e9ac6a7",
            "filename": "tensorflow/c/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -298,7 +298,6 @@ tf_cuda_library(\n         ],\n         \"//conditions:default\": [\n             \":env\",\n-            \":logging\",\n             \":tf_status\",\n             \":tf_tensor\",\n             \"//tensorflow/c/experimental/filesystem:modular_filesystem\",\n@@ -325,18 +324,6 @@ tf_cuda_library(\n     alwayslink = 1,\n )\n \n-cc_library(\n-    name = \"logging\",\n-    srcs = [\"logging.cc\"],\n-    hdrs = [\"logging.h\"],\n-    visibility = [\"//visibility:public\"],\n-    deps = [\n-        \":c_api_macros\",\n-        \"//tensorflow/core/platform:logging\",\n-        \"//tensorflow/core/platform:stringprintf\",\n-    ],\n-)\n-\n tf_cuda_library(\n     name = \"tf_status_internal\",\n     hdrs = ["
        },
        {
            "sha": "e2a7932d9156ebbb5ef17f78da72b3e8d0a9802c",
            "filename": "tensorflow/c/experimental/filesystem/plugins/gcs/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -31,10 +31,10 @@ cc_library(\n         \":gcs_helper\",\n         \":ram_file_block_cache\",\n         \"//tensorflow/c:env\",\n-        \"//tensorflow/c:logging\",\n         \"//tensorflow/c:tf_status\",\n         \"//tensorflow/c/experimental/filesystem:filesystem_interface\",\n         \"@com_github_googlecloudplatform_google_cloud_cpp//:storage_client\",\n+        \"@com_github_googlecloudplatform_google_cloud_cpp//google/cloud:google_cloud_cpp_common\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/strings\",\n@@ -65,7 +65,6 @@ cc_library(\n     deps = [\n         \":cleanup\",\n         \"//tensorflow/c:env\",\n-        \"//tensorflow/c:logging\",\n         \"//tensorflow/c:tf_status\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/log\","
        },
        {
            "sha": "f61208c7b4a17444842e58d2242f0ce745b8f044",
            "filename": "tensorflow/c/experimental/filesystem/plugins/gcs/gcs_filesystem.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fgcs_filesystem.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fgcs_filesystem.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fgcs_filesystem.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -40,7 +40,6 @@ limitations under the License.\n #include \"google/cloud/storage/client.h\"\n #include \"tensorflow/c/env.h\"\n #include \"tensorflow/c/experimental/filesystem/plugins/gcs/gcs_helper.h\"\n-#include \"tensorflow/c/logging.h\"\n #include \"tensorflow/c/tf_status.h\"\n \n // Implementation of a filesystem for GCS environments."
        },
        {
            "sha": "3e972fa6292995e9657303290c93c7586b020f34",
            "filename": "tensorflow/c/experimental/filesystem/plugins/gcs/ram_file_block_cache.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fram_file_block_cache.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fram_file_block_cache.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2Fexperimental%2Ffilesystem%2Fplugins%2Fgcs%2Fram_file_block_cache.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -33,7 +33,6 @@ limitations under the License.\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/synchronization/notification.h\"\n #include \"tensorflow/c/env.h\"\n-#include \"tensorflow/c/logging.h\"\n #include \"tensorflow/c/tf_status.h\"\n \n namespace tf_gcs_filesystem {"
        },
        {
            "sha": "13c9e6ac208a1496f658a813ba185debc220fc9d",
            "filename": "tensorflow/c/logging.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 62,
            "changes": 62,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a00e2ee37a59adeee791837011e0bac0e04638b1/tensorflow%2Fc%2Flogging.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a00e2ee37a59adeee791837011e0bac0e04638b1/tensorflow%2Fc%2Flogging.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2Flogging.cc?ref=a00e2ee37a59adeee791837011e0bac0e04638b1",
            "patch": "@@ -1,62 +0,0 @@\n-/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-#include \"tensorflow/c/logging.h\"\n-\n-#include \"tensorflow/core/platform/logging.h\"\n-#include \"tensorflow/core/platform/stringprintf.h\"\n-\n-static ::tensorflow::string BuildMessage(const char* fmt, va_list args) {\n-  ::tensorflow::string message;\n-  ::tensorflow::strings::Appendv(&message, fmt, args);\n-  return message;\n-}\n-\n-void TF_Log(TF_LogLevel level, const char* fmt, ...) {\n-  if (level < TF_INFO || level > TF_FATAL) return;\n-  va_list args;\n-  va_start(args, fmt);\n-  auto message = BuildMessage(fmt, args);\n-  va_end(args);\n-  switch (level) {\n-    case TF_INFO:\n-      LOG(INFO) << message;\n-      break;\n-    case TF_WARNING:\n-      LOG(WARNING) << message;\n-      break;\n-    case TF_ERROR:\n-      LOG(ERROR) << message;\n-      break;\n-    case TF_FATAL:\n-      LOG(FATAL) << message;\n-      break;\n-  }\n-}\n-\n-void TF_VLog(int level, const char* fmt, ...) {\n-  va_list args;\n-  va_start(args, fmt);\n-  auto message = BuildMessage(fmt, args);\n-  va_end(args);\n-  VLOG(level) << message;\n-}\n-\n-void TF_DVLog(int level, const char* fmt, ...) {\n-  va_list args;\n-  va_start(args, fmt);\n-  auto message = BuildMessage(fmt, args);\n-  va_end(args);\n-  DVLOG(level) << message;\n-}"
        },
        {
            "sha": "9583777b66112240daa9842350871cae29bb3faf",
            "filename": "tensorflow/c/logging.h",
            "status": "removed",
            "additions": 0,
            "deletions": 42,
            "changes": 42,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a00e2ee37a59adeee791837011e0bac0e04638b1/tensorflow%2Fc%2Flogging.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a00e2ee37a59adeee791837011e0bac0e04638b1/tensorflow%2Fc%2Flogging.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fc%2Flogging.h?ref=a00e2ee37a59adeee791837011e0bac0e04638b1",
            "patch": "@@ -1,42 +0,0 @@\n-/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-#ifndef TENSORFLOW_C_LOGGING_H_\n-#define TENSORFLOW_C_LOGGING_H_\n-\n-#include \"tensorflow/c/c_api_macros.h\"\n-\n-// --------------------------------------------------------------------------\n-// C API for tensorflow::Logging.\n-\n-#ifdef __cplusplus\n-extern \"C\" {\n-#endif\n-\n-typedef enum TF_LogLevel {\n-  TF_INFO = 0,\n-  TF_WARNING = 1,\n-  TF_ERROR = 2,\n-  TF_FATAL = 3,\n-} TF_LogLevel;\n-\n-TF_CAPI_EXPORT extern void TF_Log(TF_LogLevel level, const char* fmt, ...);\n-TF_CAPI_EXPORT extern void TF_VLog(int level, const char* fmt, ...);\n-TF_CAPI_EXPORT extern void TF_DVLog(int level, const char* fmt, ...);\n-\n-#ifdef __cplusplus\n-}\n-#endif\n-\n-#endif  // TENSORFLOW_C_LOGGING_H_"
        },
        {
            "sha": "caf20c11b9356633336cbf8256dc6bf17b4b05cb",
            "filename": "tensorflow/core/api_def/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fapi_def%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fapi_def%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fapi_def%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -65,6 +65,7 @@ cc_library(\n         \"//tensorflow/core:op_gen_lib\",\n         \"//tensorflow/core:ops\",\n         \"//tensorflow/core:protos_all_cc\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ],\n )\n "
        },
        {
            "sha": "194f3f610143460f1e791bce662cb694e5a3679a",
            "filename": "tensorflow/core/api_def/update_api_def.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fapi_def%2Fupdate_api_def.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fapi_def%2Fupdate_api_def.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fapi_def%2Fupdate_api_def.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -20,6 +20,7 @@ limitations under the License.\n #include <string>\n #include <vector>\n \n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/api_def/excluded_ops.h\"\n #include \"tensorflow/core/framework/api_def.pb.h\"\n #include \"tensorflow/core/framework/op.h\"\n@@ -252,9 +253,8 @@ void CreateApiDefs(const OpList& ops, const std::string& api_def_dir,\n       continue;\n     }\n     // Form the expected ApiDef path.\n-    std::string file_path =\n-        io::JoinPath(std::string(api_def_dir), kApiDefFileFormat);\n-    file_path = strings::Printf(file_path.c_str(), op.name().c_str());\n+    std::string file_name = absl::StrFormat(kApiDefFileFormat, op.name());\n+    std::string file_path = io::JoinPath(api_def_dir, file_name);\n \n     // Create ApiDef if it doesn't exist.\n     if (!Env::Default()->FileExists(file_path).ok()) {"
        },
        {
            "sha": "253f21b69451fe293626d133bf4d586b342964b6",
            "filename": "tensorflow/core/kernels/as_string_op.cc",
            "status": "modified",
            "additions": 156,
            "deletions": 121,
            "changes": 277,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fas_string_op.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fas_string_op.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fas_string_op.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -15,19 +15,27 @@ limitations under the License.\n \n // See docs in ../ops/string_ops.cc.\n \n+#include <cstdint>\n #include <string>\n \n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/framework/kernel_def_builder.h\"\n+#include \"tensorflow/core/framework/numeric_types.h\"\n #include \"tensorflow/core/framework/op_kernel.h\"\n+#include \"tensorflow/core/framework/op_requires.h\"\n #include \"tensorflow/core/framework/tensor.h\"\n+#include \"tensorflow/core/framework/types.h\"\n #include \"tensorflow/core/framework/types.pb.h\"\n #include \"tensorflow/core/framework/variant.h\"\n #include \"tensorflow/core/framework/variant_encode_decode.h\"\n #include \"tensorflow/core/framework/variant_tensor_data.h\"\n #include \"tensorflow/core/lib/core/errors.h\"\n #include \"tensorflow/core/lib/core/status.h\"\n-#include \"tensorflow/core/lib/strings/stringprintf.h\"\n+#include \"tensorflow/core/platform/bfloat16.h\"\n #include \"tensorflow/core/platform/stringpiece.h\"\n+#include \"tensorflow/core/platform/tstring.h\"\n \n namespace tensorflow {\n \n@@ -36,36 +44,28 @@ class AsStringOp : public OpKernel {\n   using OpKernel::OpKernel;\n \n   explicit AsStringOp(OpKernelConstruction* ctx) : OpKernel(ctx) {\n-    int32_t precision;\n     bool scientific;\n     bool shortest;\n-    int32_t width;\n-    string fill_string;\n+    std::string fill_string;\n     DataType dtype;\n     OP_REQUIRES_OK(ctx, ctx->GetAttr(\"T\", &dtype));\n-    OP_REQUIRES_OK(ctx, ctx->GetAttr(\"precision\", &precision));\n+    OP_REQUIRES_OK(ctx, ctx->GetAttr(\"precision\", &precision_));\n     OP_REQUIRES_OK(ctx, ctx->GetAttr(\"scientific\", &scientific));\n     OP_REQUIRES_OK(ctx, ctx->GetAttr(\"shortest\", &shortest));\n-    OP_REQUIRES_OK(ctx, ctx->GetAttr(\"width\", &width));\n+    OP_REQUIRES_OK(ctx, ctx->GetAttr(\"width\", &width_));\n     OP_REQUIRES_OK(ctx, ctx->GetAttr(\"fill\", &fill_string));\n-    switch (dtype) {\n-      case DT_STRING:\n-      case DT_HALF:\n-      case DT_BFLOAT16:\n-      case DT_FLOAT:\n-      case DT_DOUBLE:\n-      case DT_COMPLEX64:\n-      case DT_COMPLEX128:\n-        break;\n-      default:\n-        OP_REQUIRES(ctx, !(scientific || shortest),\n-                    errors::InvalidArgument(\"scientific and shortest format \"\n-                                            \"not supported for datatype \",\n-                                            DataTypeString(dtype)));\n-        OP_REQUIRES(ctx, precision < 0,\n-                    errors::InvalidArgument(\"precision not supported \"\n-                                            \"for datatype \",\n-                                            DataTypeString(dtype)));\n+    if (dtype != DT_STRING && !DataTypeIsFloating(dtype) &&\n+        !DataTypeIsComplex(dtype)) {\n+      OP_REQUIRES(ctx, !(scientific || shortest),\n+                  absl::InvalidArgumentError(\n+                      absl::StrCat(\"scientific and shortest format \"\n+                                   \"not supported for datatype \",\n+                                   DataTypeString(dtype))));\n+      OP_REQUIRES(\n+          ctx, precision_ < 0,\n+          absl::InvalidArgumentError(absl::StrCat(\"precision not supported \"\n+                                                  \"for datatype \",\n+                                                  DataTypeString(dtype))));\n     }\n     OP_REQUIRES(\n         ctx, fill_string.size() <= 1,\n@@ -74,15 +74,13 @@ class AsStringOp : public OpKernel {\n                 errors::InvalidArgument(\n                     \"Cannot select both scientific and shortest notation\"));\n \n-    format_ = \"%\";\n     if (!fill_string.empty()) {\n       switch (fill_string[0]) {\n         case ' ':\n         case '+':\n         case '-':\n         case '0':\n         case '#':\n-          strings::Appendf(&format_, \"%s\", fill_string.c_str());\n           break;\n         default:\n           bool fill_not_supported = true;\n@@ -91,64 +89,55 @@ class AsStringOp : public OpKernel {\n                                               fill_string, \"\\\"\"));\n       }\n     }\n-    if (width > -1) {\n-      strings::Appendf(&format_, \"%d\", width);\n+    if (width_ <= -1) {\n+      width_ = 0;\n     }\n-    if (precision > -1) {\n-      strings::Appendf(&format_, \".%d\", precision);\n+    // If input is string and width unspecified, simply forward to output.\n+    if (dtype == DT_STRING && width_ <= 0) {\n+      return;\n     }\n-    switch (dtype) {\n-      case DT_STRING:\n-        // Clear format to signal pass-through.\n-        if (width <= 0) {\n-          format_ = \"\";\n-        } else {\n-          strings::Appendf(&format_, \"s\");\n-        }\n-        break;\n-      case DT_UINT8:\n-      case DT_UINT16:\n-      case DT_UINT32:\n-        strings::Appendf(&format_, \"u\");\n-        break;\n-      case DT_UINT64:\n-        strings::Appendf(&format_, \"llu\");\n-        break;\n-      case DT_INT8:\n-      case DT_INT16:\n-      case DT_INT32:\n-        strings::Appendf(&format_, \"d\");\n-        break;\n-      case DT_INT64:\n-        strings::Appendf(&format_, \"lld\");\n-        break;\n-      case DT_HALF:\n-      case DT_BFLOAT16:\n-      case DT_FLOAT:\n-      case DT_DOUBLE:\n-      case DT_COMPLEX64:\n-      case DT_COMPLEX128:\n-        if (shortest) {\n-          strings::Appendf(&format_, \"g\");\n-        } else if (scientific) {\n-          strings::Appendf(&format_, \"e\");\n-        } else {\n-          strings::Appendf(&format_, \"f\");\n-        }\n-        break;\n-      case DT_BOOL:\n-        break;\n-      case DT_VARIANT:\n-        break;\n-      default:\n-        bool type_not_supported = true;\n-        OP_REQUIRES(ctx, !type_not_supported,\n-                    errors::InvalidArgument(\"Type not supported: \",\n-                                            DataTypeString(dtype)));\n+    char format_char;\n+    if (dtype == DT_STRING) {\n+      format_char = 's';\n+    } else if (DataTypeIsUnsigned(dtype)) {\n+      format_char = 'u';\n+    } else if (DataTypeIsSigned(dtype)) {\n+      format_char = 'd';\n+    } else if (DataTypeIsFloating(dtype) || DataTypeIsComplex(dtype)) {\n+      if (shortest) {\n+        format_char = 'g';\n+      } else if (scientific) {\n+        format_char = 'e';\n+      } else {\n+        format_char = 'f';\n+      }\n+    } else if (dtype == DT_BOOL) {\n+      return;\n+    } else if (dtype == DT_VARIANT) {\n+      return;\n+    } else {\n+      bool type_not_supported = true;\n+      OP_REQUIRES(ctx, !type_not_supported,\n+                  absl::InvalidArgumentError(absl::StrCat(\n+                      \"Type not supported: \", DataTypeString(dtype))));\n     }\n-\n-    if (dtype == DT_COMPLEX64 || dtype == DT_COMPLEX128) {\n-      format_ = strings::Printf(\"(%s,%s)\", format_.c_str(), format_.c_str());\n+    format_ = absl::StrCat(\"%\", fill_string, \"*.*\",\n+                           absl::string_view(&format_char, 1));\n+    if (format_char == 's') {\n+      string_format_ = StringFormat::New(format_);\n+      OP_REQUIRES(ctx, string_format_ != nullptr,\n+                  absl::InvalidArgumentError(\n+                      absl::StrCat(\"Invalid format: \", format_)));\n+    } else if (format_char == 'u' || format_char == 'd') {\n+      integral_format_ = IntegralFormat::New(format_);\n+      OP_REQUIRES(ctx, integral_format_ != nullptr,\n+                  absl::InvalidArgumentError(\n+                      absl::StrCat(\"Invalid format: \", format_)));\n+    } else {\n+      floating_format_ = FloatingFormat::New(format_);\n+      OP_REQUIRES(ctx, floating_format_ != nullptr,\n+                  absl::InvalidArgumentError(\n+                      absl::StrCat(\"Invalid format: \", format_)));\n     }\n   }\n \n@@ -158,7 +147,7 @@ class AsStringOp : public OpKernel {\n     const DataType& dtype = input_tensor->dtype();\n \n     // If input is string and width unspecified, simply forward to output.\n-    if (dtype == DT_STRING && format_.empty()) {\n+    if (dtype == DT_STRING && width_ <= 0) {\n       context->set_output(0, context->input(0));\n       return;\n     }\n@@ -169,70 +158,91 @@ class AsStringOp : public OpKernel {\n                                             &output_tensor));\n     auto output_flat = output_tensor->flat<tstring>();\n \n-#define ENCODE_TYPE(type, T, enc_str)                                     \\\n-  case (type): {                                                          \\\n-    const auto& input_flat = input_tensor->flat<T>();                     \\\n-    for (int i = 0; i < input_flat.size(); ++i) {                         \\\n-      output_flat(i) = strings::Printf((enc_str.c_str()), input_flat(i)); \\\n-    }                                                                     \\\n+    if (dtype == DT_BOOL) {\n+      const auto& input_flat = input_tensor->flat<bool>();\n+      for (int i = 0; i < input_flat.size(); ++i) {\n+        output_flat(i) = (input_flat(i)) ? \"true\" : \"false\";\n+      }\n+      return;\n+    }\n+\n+    if (dtype == DT_VARIANT) {\n+      const auto& input_flat = input_tensor->flat<Variant>();\n+      for (int i = 0; i < input_flat.size(); ++i) {\n+        output_flat(i) = input_flat(i).DebugString();\n+      }\n+      return;\n+    }\n+\n+    // All other cases use the format string.\n+\n+#define ENCODE_TYPE(type, T, enc_fmt)                                   \\\n+  case (type): {                                                        \\\n+    const auto& input_flat = input_tensor->flat<T>();                   \\\n+    for (int i = 0; i < input_flat.size(); ++i) {                       \\\n+      output_flat(i) =                                                  \\\n+          absl::StrFormat(*enc_fmt, width_, precision_, input_flat(i)); \\\n+    }                                                                   \\\n   } break\n \n     switch (dtype) {\n-      ENCODE_TYPE(DT_UINT8, uint8, format_);\n-      ENCODE_TYPE(DT_UINT16, uint16, format_);\n-      ENCODE_TYPE(DT_UINT32, uint32, format_);\n-      ENCODE_TYPE(DT_UINT64, uint64, format_);\n-      ENCODE_TYPE(DT_INT8, int8, format_);\n-      ENCODE_TYPE(DT_INT16, int16, format_);\n-      ENCODE_TYPE(DT_INT32, int32, format_);\n-      ENCODE_TYPE(DT_INT64, int64_t, format_);\n-      ENCODE_TYPE(DT_FLOAT, float, format_);\n-      ENCODE_TYPE(DT_DOUBLE, double, format_);\n-      case (DT_BOOL): {\n-        const auto& input_flat = input_tensor->flat<bool>();\n-        for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = (input_flat(i)) ? \"true\" : \"false\";\n-        }\n-      } break;\n+      ENCODE_TYPE(DT_UINT8, uint8_t, integral_format_);\n+      ENCODE_TYPE(DT_UINT16, uint16_t, integral_format_);\n+      ENCODE_TYPE(DT_UINT32, uint32_t, integral_format_);\n+      ENCODE_TYPE(DT_UINT64, uint64_t, integral_format_);\n+      ENCODE_TYPE(DT_INT8, int8_t, integral_format_);\n+      ENCODE_TYPE(DT_INT16, int16_t, integral_format_);\n+      ENCODE_TYPE(DT_INT32, int32_t, integral_format_);\n+      ENCODE_TYPE(DT_INT64, int64_t, integral_format_);\n+      ENCODE_TYPE(DT_FLOAT, float, floating_format_);\n+      ENCODE_TYPE(DT_DOUBLE, double, floating_format_);\n       case (DT_STRING): {\n         const auto& input_flat = input_tensor->flat<tstring>();\n         for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = strings::Printf(\n-              format_.c_str(), absl::string_view(input_flat(i)).data());\n-        }\n-      } break;\n-      case (DT_VARIANT): {\n-        const auto& input_flat = input_tensor->flat<Variant>();\n-        for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = input_flat(i).DebugString();\n+          output_flat(i) = absl::StrFormat(*string_format_, width_, precision_,\n+                                           absl::string_view(input_flat(i)));\n         }\n       } break;\n       case (DT_HALF): {\n         const auto& input_flat = input_tensor->flat<Eigen::half>();\n         for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = strings::Printf(format_.c_str(),\n-                                           static_cast<float>(input_flat(i)));\n+          output_flat(i) =\n+              absl::StrFormat(*floating_format_, width_, precision_,\n+                              static_cast<float>(input_flat(i)));\n         }\n       } break;\n       case (DT_BFLOAT16): {\n         const auto& input_flat = input_tensor->flat<bfloat16>();\n         for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = strings::Printf(format_.c_str(),\n-                                           static_cast<float>(input_flat(i)));\n+          output_flat(i) =\n+              absl::StrFormat(*floating_format_, width_, precision_,\n+                              static_cast<float>(input_flat(i)));\n         }\n       } break;\n       case (DT_COMPLEX64): {\n         const auto& input_flat = input_tensor->flat<complex64>();\n         for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = strings::Printf(\n-              format_.c_str(), input_flat(i).real(), input_flat(i).imag());\n+          output_flat(i) =\n+              absl::StrCat(\"(\",\n+                           absl::StrFormat(*floating_format_, width_,\n+                                           precision_, input_flat(i).real()),\n+                           \",\",\n+                           absl::StrFormat(*floating_format_, width_,\n+                                           precision_, input_flat(i).imag()),\n+                           \")\");\n         }\n       } break;\n       case (DT_COMPLEX128): {\n         const auto& input_flat = input_tensor->flat<complex128>();\n         for (int i = 0; i < input_flat.size(); ++i) {\n-          output_flat(i) = strings::Printf(\n-              format_.c_str(), input_flat(i).real(), input_flat(i).imag());\n+          output_flat(i) =\n+              absl::StrCat(\"(\",\n+                           absl::StrFormat(*floating_format_, width_,\n+                                           precision_, input_flat(i).real()),\n+                           \",\",\n+                           absl::StrFormat(*floating_format_, width_,\n+                                           precision_, input_flat(i).imag()),\n+                           \")\");\n         }\n       } break;\n       default:\n@@ -246,7 +256,32 @@ class AsStringOp : public OpKernel {\n   }\n \n  private:\n-  string format_;\n+  // Used to parse \"%*.*g\", etc.\n+  using FloatingFormat =\n+      absl::ParsedFormat<absl::FormatConversionCharSet::kStar,\n+                         absl::FormatConversionCharSet::kStar,\n+                         absl::FormatConversionCharSet::g |\n+                             absl::FormatConversionCharSet::e |\n+                             absl::FormatConversionCharSet::f>;\n+\n+  // Used to parse \"%*.*u\", etc.\n+  using IntegralFormat =\n+      absl::ParsedFormat<absl::FormatConversionCharSet::kStar,\n+                         absl::FormatConversionCharSet::kStar,\n+                         absl::FormatConversionCharSet::u |\n+                             absl::FormatConversionCharSet::d>;\n+\n+  // Used to parse \"%*.*s\", etc.\n+  using StringFormat = absl::ParsedFormat<absl::FormatConversionCharSet::kStar,\n+                                          absl::FormatConversionCharSet::kStar,\n+                                          absl::FormatConversionCharSet::s>;\n+\n+  int precision_ = -1;\n+  int width_ = -1;\n+  decltype(StringFormat::New(\"%*.*s\")) string_format_;\n+  decltype(IntegralFormat::New(\"%*.*u\")) integral_format_;\n+  decltype(FloatingFormat::New(\"%*.*g\")) floating_format_;\n+  std::string format_;\n };\n \n REGISTER_KERNEL_BUILDER(Name(\"AsString\").Device(DEVICE_CPU), AsStringOp);"
        },
        {
            "sha": "f08f977d1fe631c8a2fe8daceb9c7a7b5352e7c1",
            "filename": "tensorflow/core/kernels/data/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fdata%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fdata%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fdata%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -73,6 +73,7 @@ tf_kernel_library(\n         \"//tensorflow/core/util/tensor_bundle\",\n         \"//tensorflow/core/util/tensor_bundle:naming\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ],\n )\n "
        },
        {
            "sha": "1cc826e8c17b3d6e37628a2500a230ebda1e55eb",
            "filename": "tensorflow/core/kernels/data/cache_dataset_ops.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fdata%2Fcache_dataset_ops.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Fdata%2Fcache_dataset_ops.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Fdata%2Fcache_dataset_ops.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -23,6 +23,7 @@ limitations under the License.\n #include <vector>\n \n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/data/global_shuffle_utils.h\"\n #include \"tensorflow/core/data/name_utils.h\"\n #include \"tensorflow/core/data/serialization_utils.h\"\n@@ -175,10 +176,7 @@ class CacheDatasetOp::FileDatasetBase : public DatasetBase {\n         env_(env),\n         num_tensors_(input->output_dtypes().size()),\n         tensor_index_padding_size_(StringPaddingSize(num_tensors_)),\n-        item_index_padding_size_(StringPaddingSize(kMaxItems)),\n-        tensor_format_string_(strings::Printf(kKeyStrFormat,\n-                                              item_index_padding_size_,\n-                                              tensor_index_padding_size_)) {\n+        item_index_padding_size_(StringPaddingSize(kMaxItems)) {\n     input_->Ref();\n     DCHECK_EQ(item_index_padding_size_, 7);\n   }\n@@ -230,9 +228,9 @@ class CacheDatasetOp::FileDatasetBase : public DatasetBase {\n     return strings::Printf(kPaddingSizeStrFormat, num_tensors - 1).size();\n   }\n \n-  string FormatName(size_t item_index, size_t tensor_index) const {\n-    return strings::Printf(tensor_format_string_.c_str(), item_index,\n-                           tensor_index);\n+  std::string FormatName(size_t item_index, size_t tensor_index) const {\n+    return absl::StrFormat(\"%*zu_%*zu\", item_index_padding_size_, item_index,\n+                           tensor_index_padding_size_, tensor_index);\n   }\n \n   class FileIterator : public DatasetIterator<FileDatasetBase> {\n@@ -710,7 +708,6 @@ class CacheDatasetOp::FileDatasetBase : public DatasetBase {\n   const size_t tensor_index_padding_size_;\n   static constexpr size_t kMaxItems = 10000000;  // 10 million\n   const size_t item_index_padding_size_;\n-  const string tensor_format_string_;\n };  // FileDatasetBase\n \n class CacheDatasetOp::FileDataset : public CacheDatasetOp::FileDatasetBase {"
        },
        {
            "sha": "ca43aa9c8da329d3b7099a5cb5234e50a2fd11c7",
            "filename": "tensorflow/core/kernels/tensor_to_hash_bucket_op.h",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Ftensor_to_hash_bucket_op.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fkernels%2Ftensor_to_hash_bucket_op.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fkernels%2Ftensor_to_hash_bucket_op.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -36,15 +36,11 @@ template <typename Device, typename T>\n struct LaunchTensorToHashBucket {\n   void operator()(OpKernelContext* c, const int64_t num_buckets, const T* input,\n                   const int num_elems, int64_t* output) {\n-    std::string format = \"%\";\n     switch (DataTypeToEnum<T>::value) {\n       case DT_INT8:\n       case DT_INT16:\n       case DT_INT32:\n-        strings::Appendf(&format, \"d\");\n-        break;\n       case DT_INT64:\n-        strings::Appendf(&format, \"lld\");\n         break;\n       default:\n         bool type_not_supported = true;\n@@ -55,7 +51,7 @@ struct LaunchTensorToHashBucket {\n     }\n \n     for (int i = 0; i < num_elems; ++i) {\n-      std::string input_str = strings::Printf(format.c_str(), input[i]);\n+      std::string input_str = absl::StrFormat(\"%d\", input[i]);\n       const uint64_t input_hash = Fingerprint64(input_str);\n       const uint64_t bucket_id = input_hash % num_buckets;\n       // The number of buckets is always in the positive range of int64 so is"
        },
        {
            "sha": "003488c6ecf666ba5cc013399ea3853af70d87af",
            "filename": "tensorflow/core/lib/db/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fdb%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -25,6 +25,7 @@ cc_library(\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings:str_format\",\n         \"@org_sqlite\",\n     ],\n )"
        },
        {
            "sha": "8f29dc51d7575ad600b2bd03e9fe6d61cc3a2e40",
            "filename": "tensorflow/core/lib/db/sqlite.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fdb%2Fsqlite.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -19,6 +19,7 @@ limitations under the License.\n #include \"absl/log/check.h\"\n #include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/lib/core/errors.h\"\n #include \"tensorflow/core/platform/status.h\"\n #include \"tensorflow/core/platform/strcat.h\"\n@@ -81,7 +82,8 @@ absl::StatusCode GetTfErrorCode(int code) {\n }\n \n template <typename... Args>\n-absl::Status PrintfStatus(int rc, const char* fmt, Args&&... args) {\n+absl::Status PrintfStatus(int rc, const absl::FormatSpec<Args...>& fmt,\n+                          Args&&... args) {\n   return {GetTfErrorCode(rc),\n           strings::Printf(fmt, std::forward<Args>(args)...)};\n }"
        },
        {
            "sha": "442fcbf8daea7926990d3cb4a77c38a026841346",
            "filename": "tensorflow/core/lib/io/path.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fio%2Fpath.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Flib%2Fio%2Fpath.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Flib%2Fio%2Fpath.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -16,6 +16,6 @@ limitations under the License.\n #ifndef TENSORFLOW_CORE_LIB_IO_PATH_H_\n #define TENSORFLOW_CORE_LIB_IO_PATH_H_\n \n-#include \"tensorflow/core/platform/path.h\"\n+#include \"tensorflow/core/platform/path.h\"  // IWYU pragma: export\n \n #endif  // TENSORFLOW_CORE_LIB_IO_PATH_H_"
        },
        {
            "sha": "b40057a9edf4974e12fef035c5328062af129651",
            "filename": "tensorflow/core/platform/stringprintf.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fplatform%2Fstringprintf.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fcore%2Fplatform%2Fstringprintf.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fplatform%2Fstringprintf.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -34,7 +34,6 @@ namespace tensorflow {\n namespace strings {\n // NOLINTBEGIN(misc-unused-using-decls)\n using tsl::strings::Appendf;\n-using tsl::strings::Appendv;\n using tsl::strings::Printf;\n // NOLINTEND(misc-unused-using-decls)\n }  // namespace strings"
        },
        {
            "sha": "6f0139eeea922907224a9122ea4102904be665d8",
            "filename": "tensorflow/lite/toco/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftoco%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -174,6 +174,7 @@ cc_library(\n         \"//tensorflow/core:lib\",\n         \"//tensorflow/core:lib_internal\",\n         \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_protobuf//:protobuf_headers\",\n     ],\n )\n@@ -307,6 +308,7 @@ cc_library(\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ],\n )\n "
        },
        {
            "sha": "2c0516021fc1cc347b6343aea98fa69ef6109260",
            "filename": "tensorflow/lite/toco/format_port.h",
            "status": "modified",
            "additions": 8,
            "deletions": 40,
            "changes": 48,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fformat_port.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fformat_port.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftoco%2Fformat_port.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -12,59 +12,27 @@ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n-// This file is used to provide equivalents of internal absl::FormatF\n-// and absl::StrAppendFormat. Unfortunately, type safety is not as good as a\n-// a full C++ example.\n-// TODO(aselle): When absl adds support for StrFormat, use that instead.\n+\n #ifndef TENSORFLOW_LITE_TOCO_FORMAT_PORT_H_\n #define TENSORFLOW_LITE_TOCO_FORMAT_PORT_H_\n \n #include <string>\n \n-#include \"tensorflow/core/lib/strings/stringprintf.h\"\n-#include \"tensorflow/lite/toco/toco_types.h\"\n+#include \"absl/strings/str_format.h\"\n \n namespace toco {\n namespace port {\n \n-/// Identity (default case)\n-template <class T>\n-T IdentityOrConvertStringToRaw(T foo) {\n-  return foo;\n-}\n-\n-// Overloaded case where we return std::string.\n-inline const char* IdentityOrConvertStringToRaw(const std::string& foo) {\n-  return foo.c_str();\n-}\n-\n-// Delegate to TensorFlow Appendf function until absl has an equivalent.\n-template <typename... Args>\n-inline void AppendFHelper(std::string* destination, const char* fmt,\n-                          Args&&... args) {\n-  tensorflow::strings::Appendf(destination, fmt, args...);\n-}\n-\n-// Specialization for no argument format string (avoid security bug).\n-inline void AppendFHelper(std::string* destination, const char* fmt) {\n-  tensorflow::strings::Appendf(destination, \"%s\", fmt);\n-}\n-\n-// Append formatted string (with format fmt and args args) to the string\n-// pointed to by destination. fmt follows C printf semantics.\n-// One departure is that %s can be driven by a std::string or string.\n template <typename... Args>\n-inline void AppendF(std::string* destination, const char* fmt, Args&&... args) {\n-  AppendFHelper(destination, fmt, IdentityOrConvertStringToRaw(args)...);\n+inline void AppendF(std::string* destination,\n+                    const absl::FormatSpec<Args...>& fmt, Args&&... args) {\n+  absl::StrAppendFormat(destination, fmt, args...);\n }\n \n-// Return formatted string (with format fmt and args args). fmt follows C printf\n-// semantics. One departure is that %s can be driven by a std::string or string.\n template <typename... Args>\n-inline std::string StringF(const char* fmt, Args&&... args) {\n-  std::string result;\n-  AppendFHelper(&result, fmt, IdentityOrConvertStringToRaw(args)...);\n-  return result;\n+inline std::string StringF(const absl::FormatSpec<Args...>& fmt,\n+                           Args&&... args) {\n+  return absl::StrFormat(fmt, args...);\n }\n \n }  // namespace port"
        },
        {
            "sha": "a6e00c588af7fc1c57d5c85fef7ecb145fe8281d",
            "filename": "tensorflow/lite/toco/graph_transformations/fuse_activation_functions.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Ffuse_activation_functions.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Ffuse_activation_functions.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Ffuse_activation_functions.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -48,7 +48,7 @@ absl::Status FuseActivationFunctions::Run(Model* model, std::size_t op_index,\n   if (CountTrueOutputs(*model, *op) > 1) {\n     AddMessageF(\n         \"Not fusing activation function %s into %s because it has more than \"\n-        \"one  consumed output\",\n+        \"one consumed output\",\n         LogName(*ac_op), LogName(*op));\n     return absl::OkStatus();\n   }\n@@ -59,8 +59,8 @@ absl::Status FuseActivationFunctions::Run(Model* model, std::size_t op_index,\n   DCHECK_GE(count_ops_consuming_output, 1);\n   if (count_ops_consuming_output > 1) {\n     AddMessageF(\n-        \"Not fusing activation function into %s because it is consumed by more \"\n-        \"than 1 other operator\",\n+        \"Not fusing activation function %s into %s because it is consumed by \"\n+        \"more than 1 other operator\",\n         LogName(*ac_op), LogName(*op));\n     return absl::OkStatus();\n   }"
        },
        {
            "sha": "a87449cd9d00de198df00b3935325e1bd005a0b8",
            "filename": "tensorflow/lite/toco/graph_transformations/graph_transformations.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Fgraph_transformations.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Fgraph_transformations.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftoco%2Fgraph_transformations%2Fgraph_transformations.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -22,6 +22,7 @@ limitations under the License.\n #include <vector>\n \n #include \"absl/log/check.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/platform/status.h\"\n #include \"tensorflow/lite/toco/model.h\"\n #include \"tensorflow/lite/toco/toco_port.h\"\n@@ -43,7 +44,8 @@ class GraphTransformation {\n   // Adds a message; normally only called by the graph transformation\n   // itself during its run (this function could be protected).\n   template <typename... Args>\n-  void AddMessageF(const char* format, const Args&... args) {\n+  void AddMessageF(const absl::FormatSpec<Args...>& format,\n+                   const Args&... args) {\n     return messages_.push_back(toco::port::StringF(format, args...));\n   }\n "
        },
        {
            "sha": "4a41cd3565e1dfecc4fa5721c5d3d96d2b5d850b",
            "filename": "tensorflow/lite/toco/toco_port.h",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Ftoco_port.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Flite%2Ftoco%2Ftoco_port.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Flite%2Ftoco%2Ftoco_port.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -18,12 +18,14 @@ limitations under the License.\n // Portability layer for toco tool. Mainly, abstract filesystem access so we\n // can build and use on google internal environments and on OSX.\n \n+#include <cstdint>\n #include <string>\n+\n #include \"google/protobuf/text_format.h\"\n-#include \"tensorflow/lite/toco/format_port.h\"\n #include \"tensorflow/core/lib/core/status.h\"\n #include \"tensorflow/core/platform/logging.h\"\n #include \"tensorflow/core/platform/platform.h\"\n+#include \"tensorflow/lite/toco/format_port.h\"\n #if defined(PLATFORM_GOOGLE)\n #include \"absl/strings/cord.h\"\n #endif  // PLATFORM_GOOGLE\n@@ -39,17 +41,16 @@ limitations under the License.\n namespace std {\n \n template <typename T>\n-std::string to_string(T value)\n-{\n-    std::ostringstream os ;\n-    os << value ;\n-    return os.str() ;\n+std::string to_string(T value) {\n+  std::ostringstream os;\n+  os << value;\n+  return os.str();\n }\n \n #ifdef __ARM_ARCH_7A__\n double round(double x);\n #endif\n-}\n+}  // namespace std\n #endif\n \n namespace toco {\n@@ -84,7 +85,7 @@ void CopyToBuffer(const ::absl::Cord& src, char* dest);\n #endif  // PLATFORM_GOOGLE\n void CopyToBuffer(const std::string& src, char* dest);\n \n-inline uint32 ReverseBits32(uint32 n) {\n+inline uint32_t ReverseBits32(uint32_t n) {\n   n = ((n >> 1) & 0x55555555) | ((n & 0x55555555) << 1);\n   n = ((n >> 2) & 0x33333333) | ((n & 0x33333333) << 2);\n   n = ((n >> 4) & 0x0F0F0F0F) | ((n & 0x0F0F0F0F) << 4);"
        },
        {
            "sha": "e8e80a18fc3c7b63b9ed70603b498517dbca5a22",
            "filename": "tensorflow/python/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fpython%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fpython%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -767,7 +767,6 @@ pywrap_tensorflow_macro(\n         \"//tensorflow/c:env\",\n         \"//tensorflow/c:kernels\",\n         \"//tensorflow/c:kernels_experimental\",\n-        \"//tensorflow/c:logging\",\n         \"//tensorflow/c:ops\",\n         \"//tensorflow/c:python_api\",\n         \"//tensorflow/c:safe_ptr\","
        },
        {
            "sha": "047ae07ef81f2c3cd65f3d48cda4c63e2968eb1e",
            "filename": "tensorflow/python/_pywrap_tensorflow.def",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fpython%2F_pywrap_tensorflow.def",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fpython%2F_pywrap_tensorflow.def?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -217,6 +217,7 @@ EXPORTS\n   ?BatchShardedOnMesh@Layout@dtensor@tensorflow@@SA?AV123@AEBVMesh@23@HAEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@H@Z\n   ?BoundPort@GrpcDataServerBase@data@tensorflow@@QEAAHXZ\n   ?Build@KernelDefBuilder@tensorflow@@QEAAPEBVKernelDef@2@XZ\n+  ?ByteSwapTensor@tensorflow@@YA?AVStatus@lts_20250814@absl@@PEAVTensor@1@@Z\n   ?Canonicalize@FunctionParameterCanonicalizer@tensorflow@@QEAA_NPEAU_object@@0V?$Span@PEAU_object@@@lts_20250814@absl@@@Z\n   ?Capture@StackTrace@tensorflow@@SA?AV?$shared_ptr@VStackTrace@tensorflow@@@std@@H@Z\n   ?CatPieces@strings_internal@lts_20250814@absl@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$initializer_list@V?$basic_string_view@DU?$char_traits@D@std@@@std@@@5@@Z\n@@ -554,7 +555,6 @@ EXPORTS\n   ?PrintModelAnalysis@tfprof@tensorflow@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@PEBV34@0000@Z\n   ?PrintResult@MetaOptimizer@grappler@tensorflow@@QEAAXXZ\n   ?PrintStepStats@StatSummarizer@tensorflow@@QEBAXXZ\n-  ?Printf@strings@tsl@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@PEBDZZ\n   ?ProcessStepStats@StatSummarizer@tensorflow@@QEAAXAEBVStepStats@2@@Z\n   ?Profile@tfprof@tensorflow@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@PEBV34@0@Z\n   ?ProfilerFromFile@tfprof@tensorflow@@YAXPEBV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@@Z"
        },
        {
            "sha": "b54217af650064f1e6c68aac9496dee93b16e372",
            "filename": "tensorflow/security/fuzzing/cc/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -144,6 +144,7 @@ tf_cc_fuzz_test(\n     tags = [\"no_oss\"],\n     deps = [\n         \"//tensorflow/core/platform:stringprintf\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ],\n )\n "
        },
        {
            "sha": "724c4ef164d89062d4d7fb021a88f374908b4afc",
            "filename": "tensorflow/security/fuzzing/cc/stringprintf_fuzz.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Fstringprintf_fuzz.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Fstringprintf_fuzz.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fsecurity%2Ffuzzing%2Fcc%2Fstringprintf_fuzz.cc?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n #include <vector>\n \n #include \"fuzztest/fuzztest.h\"\n+#include \"absl/strings/str_format.h\"\n #include \"tensorflow/core/platform/stringprintf.h\"\n \n // This is a fuzzer for tensorflow::strings::Printf\n@@ -27,9 +28,11 @@ void FuzzTest(const std::vector<std::string> ss) {\n   const std::string all = ss[0] + ss[1] + ss[2];\n \n   int n[4] = {-1, -1, -1, -1};\n-  const std::string ret =\n-      tensorflow::strings::Printf(\"%n%s%n%s%n%s%n\", &n[0], ss[0].c_str(), &n[1],\n-                                  ss[1].c_str(), &n[2], ss[2].c_str(), &n[3]);\n+  const std::string ret = tensorflow::strings::Printf(\n+      \"%n%s%n%s%n%s%n\", absl::FormatCountCapture(&n[0]), ss[0].c_str(),\n+      absl::FormatCountCapture(&n[1]), ss[1].c_str(),\n+      absl::FormatCountCapture(&n[2]), ss[2].c_str(),\n+      absl::FormatCountCapture(&n[3]));\n \n   int size_so_far = 0;\n   for (int i = 0; i < 3; i++) {"
        },
        {
            "sha": "bb878532e0e6a0e056220b25355d9e72aef10cd2",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2FBUILD?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -453,7 +453,6 @@ filegroup(\n         \"str_util.h\",\n         \"strcat.h\",\n         \"stringpiece.h\",\n-        \"stringprintf.cc\",\n         \"stringprintf.h\",\n         \"thread_annotations.h\",\n         \"threadpool.h\",\n@@ -791,11 +790,10 @@ cc_library(\n \n cc_library(\n     name = \"stringprintf\",\n-    srcs = [\"stringprintf.cc\"],\n     hdrs = [\"stringprintf.h\"],\n     deps = [\n-        \"@local_xla//xla/tsl/platform:macros\",\n-        \"@local_xla//xla/tsl/platform:types\",\n+        \"@com_google_absl//absl/base:core_headers\",\n+        \"@com_google_absl//absl/strings:str_format\",\n     ],\n )\n "
        },
        {
            "sha": "2e33fb7107c13658e84de482ebaab91ba4b75289",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/stringprintf.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 93,
            "changes": 93,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a00e2ee37a59adeee791837011e0bac0e04638b1/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a00e2ee37a59adeee791837011e0bac0e04638b1/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.cc?ref=a00e2ee37a59adeee791837011e0bac0e04638b1",
            "patch": "@@ -1,93 +0,0 @@\n-/* Copyright 2015 The TensorFlow Authors. All Rights Reserved.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#include \"tsl/platform/stringprintf.h\"\n-\n-#include <errno.h>\n-#include <stdarg.h>  // For va_list and related operations\n-#include <stdio.h>   // MSVC requires this for _vsnprintf\n-\n-namespace tsl {\n-namespace strings {\n-\n-void Appendv(string* dst, const char* format, va_list ap) {\n-  // First try with a small fixed size buffer\n-  static const int kSpaceLength = 1024;\n-  char space[kSpaceLength];\n-\n-  // It's possible for methods that use a va_list to invalidate\n-  // the data in it upon use.  The fix is to make a copy\n-  // of the structure before using it and use that copy instead.\n-  va_list backup_ap;\n-  va_copy(backup_ap, ap);\n-  int result = vsnprintf(space, kSpaceLength, format, backup_ap);\n-  va_end(backup_ap);\n-\n-  if (result < kSpaceLength) {\n-    if (result >= 0) {\n-      // Normal case -- everything fit.\n-      dst->append(space, result);\n-      return;\n-    }\n-\n-#ifdef _MSC_VER\n-      // Error or MSVC running out of space.  MSVC 8.0 and higher\n-      // can be asked about space needed with the special idiom below:\n-      va_copy(backup_ap, ap);\n-      result = vsnprintf(nullptr, 0, format, backup_ap);\n-      va_end(backup_ap);\n-#endif\n-\n-    if (result < 0) {\n-      // Just an error.\n-      return;\n-    }\n-  }\n-\n-  // Increase the buffer size to the size requested by vsnprintf,\n-  // plus one for the closing \\0.\n-  int length = result + 1;\n-  char* buf = new char[length];\n-\n-  // Restore the va_list before we use it again\n-  va_copy(backup_ap, ap);\n-  result = vsnprintf(buf, length, format, backup_ap);\n-  va_end(backup_ap);\n-\n-  if (result >= 0 && result < length) {\n-    // It fit\n-    dst->append(buf, result);\n-  }\n-  delete[] buf;\n-}\n-\n-string Printf(const char* format, ...) {\n-  va_list ap;\n-  va_start(ap, format);\n-  string result;\n-  Appendv(&result, format, ap);\n-  va_end(ap);\n-  return result;\n-}\n-\n-void Appendf(string* dst, const char* format, ...) {\n-  va_list ap;\n-  va_start(ap, format);\n-  Appendv(dst, format, ap);\n-  va_end(ap);\n-}\n-\n-}  // namespace strings\n-}  // namespace tsl"
        },
        {
            "sha": "837f117bd6950f39d7fc968f288b21dd959e32be",
            "filename": "third_party/xla/third_party/tsl/tsl/platform/stringprintf.h",
            "status": "modified",
            "additions": 104,
            "deletions": 11,
            "changes": 115,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftsl%2Ftsl%2Fplatform%2Fstringprintf.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -26,25 +26,118 @@ limitations under the License.\n \n #include <string>\n \n-#include \"xla/tsl/platform/macros.h\"\n-#include \"xla/tsl/platform/types.h\"\n+#include \"absl/base/attributes.h\"\n+#include \"absl/base/macros.h\"\n+#include \"absl/strings/str_format.h\"\n \n namespace tsl {\n namespace strings {\n \n // Return a C++ string\n-std::string Printf(const char* format, ...)\n-    // Tell the compiler to do printf format string checking.\n-    TF_PRINTF_ATTRIBUTE(1, 2);\n+ABSL_DEPRECATE_AND_INLINE()\n+inline std::string Printf(const absl::FormatSpec<>& format) {\n+  return absl::StrFormat(format);\n+}\n+\n+template <typename Arg1>\n+ABSL_DEPRECATE_AND_INLINE()\n+std::string Printf(const absl::FormatSpec<Arg1>& format, Arg1 arg1) {\n+  return absl::StrFormat(format, arg1);\n+}\n+\n+template <typename Arg1, typename Arg2>\n+ABSL_DEPRECATE_AND_INLINE()\n+std::string\n+    Printf(const absl::FormatSpec<Arg1, Arg2>& format, Arg1 arg1, Arg2 arg2) {\n+  return absl::StrFormat(format, arg1, arg2);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3>\n+ABSL_DEPRECATE_AND_INLINE()\n+std::string Printf(const absl::FormatSpec<Arg1, Arg2, Arg3>& format, Arg1 arg1,\n+                   Arg2 arg2, Arg3 arg3) {\n+  return absl::StrFormat(format, arg1, arg2, arg3);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4>\n+ABSL_DEPRECATE_AND_INLINE()\n+std::string Printf(const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4>& format,\n+                   Arg1 arg1, Arg2 arg2, Arg3 arg3, Arg4 arg4) {\n+  return absl::StrFormat(format, arg1, arg2, arg3, arg4);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4,\n+          typename Arg5>\n+ABSL_DEPRECATE_AND_INLINE()\n+std::string Printf(const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4, Arg5>& format,\n+                   Arg1 arg1, Arg2 arg2, Arg3 arg3, Arg4 arg4, Arg5 arg5) {\n+  return absl::StrFormat(format, arg1, arg2, arg3, arg4, arg5);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4,\n+          typename Arg5, typename... AV>\n+ABSL_DEPRECATED(\"Use absl::StrFormat instead.\")\n+std::string\n+    Printf(const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4, Arg5, AV...>& format,\n+           Arg1 arg1, Arg2 arg2, Arg3 arg3, Arg4 arg4, Arg5 arg5, AV... args) {\n+  return absl::StrFormat(format, arg1, arg2, arg3, arg4, arg5,\n+                         std::forward<AV>(args)...);\n+}\n \n // Append result to a supplied string\n-void Appendf(std::string* dst, const char* format, ...)\n-    // Tell the compiler to do printf format string checking.\n-    TF_PRINTF_ATTRIBUTE(2, 3);\n+ABSL_DEPRECATE_AND_INLINE()\n+inline void Appendf(std::string* dst, const absl::FormatSpec<>& format) {\n+  absl::StrAppendFormat(dst, format);\n+}\n+\n+template <typename Arg1>\n+ABSL_DEPRECATE_AND_INLINE()\n+void Appendf(std::string* dst, const absl::FormatSpec<Arg1>& format,\n+             Arg1 arg1) {\n+  absl::StrAppendFormat(dst, format, arg1);\n+}\n+\n+template <typename Arg1, typename Arg2>\n+ABSL_DEPRECATE_AND_INLINE()\n+void Appendf(std::string* dst, const absl::FormatSpec<Arg1, Arg2>& format,\n+             Arg1 arg1, Arg2 arg2) {\n+  absl::StrAppendFormat(dst, format, arg1, arg2);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3>\n+ABSL_DEPRECATE_AND_INLINE()\n+void Appendf(std::string* dst, const absl::FormatSpec<Arg1, Arg2, Arg3>& format,\n+             Arg1 arg1, Arg2 arg2, Arg3 arg3) {\n+  absl::StrAppendFormat(dst, format, arg1, arg2, arg3);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4>\n+ABSL_DEPRECATE_AND_INLINE()\n+void Appendf(std::string* dst,\n+             const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4>& format, Arg1 arg1,\n+             Arg2 arg2, Arg3 arg3, Arg4 arg4) {\n+  absl::StrAppendFormat(dst, format, arg1, arg2, arg3, arg4);\n+}\n+\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4,\n+          typename Arg5>\n+ABSL_DEPRECATE_AND_INLINE()\n+void Appendf(std::string* dst,\n+             const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4, Arg5>& format,\n+             Arg1 arg1, Arg2 arg2, Arg3 arg3, Arg4 arg4, Arg5 arg5) {\n+  absl::StrAppendFormat(dst, format, arg1, arg2, arg3, arg4, arg5);\n+}\n \n-// Lower-level routine that takes a va_list and appends to a specified\n-// string.  All other routines are just convenience wrappers around it.\n-void Appendv(std::string* dst, const char* format, va_list ap);\n+template <typename Arg1, typename Arg2, typename Arg3, typename Arg4,\n+          typename Arg5, typename... AV>\n+ABSL_DEPRECATED(\"Use absl::StrAppendFormat instead.\")\n+void Appendf(\n+    std::string* dst,\n+    const absl::FormatSpec<Arg1, Arg2, Arg3, Arg4, Arg5, AV...>& format,\n+    Arg1 arg1, Arg2 arg2, Arg3 arg3, Arg4 arg4, Arg5 arg5, AV... args) {\n+  absl::StrAppendFormat(dst, format, arg1, arg2, arg3, arg4, arg5,\n+                        std::forward<AV>(args)...);\n+}\n \n }  // namespace strings\n }  // namespace tsl"
        },
        {
            "sha": "f3e04156f11342682ef686699cb70157082944c0",
            "filename": "third_party/xla/xla/tsl/platform/macros.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fmacros.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6719a7895aaab6fcd6d7731083b666c567dd0fc8/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fmacros.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fmacros.h?ref=6719a7895aaab6fcd6d7731083b666c567dd0fc8",
            "patch": "@@ -26,7 +26,6 @@ limitations under the License.\n #define TF_ATTRIBUTE_UNUSED ABSL_ATTRIBUTE_UNUSED\n #define TF_PACKED ABSL_ATTRIBUTE_PACKED\n #define TF_MUST_USE_RESULT ABSL_MUST_USE_RESULT\n-#define TF_PRINTF_ATTRIBUTE ABSL_PRINTF_ATTRIBUTE\n \n // Control visibility outside .so\n #if defined(_WIN32)"
        }
    ],
    "stats": {
        "total": 740,
        "additions": 312,
        "deletions": 428
    }
}