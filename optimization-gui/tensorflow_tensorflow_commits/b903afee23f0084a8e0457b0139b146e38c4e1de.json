{
    "author": "loislo",
    "message": "[XLA:GPU] Fix usages of deprecated tsl::errors::AlreadyExists in xla\n\nThis change replaces usages of tsl::errors::AlreadyExists with absl::AlreadyExistsError,\nwrapping arguments in absl::StrCat where necessary. This addresses deprecation\nwarnings and moves towards standard Abseil error handling.\n\nChanges:\n- Replaced errors::AlreadyExists with absl::AlreadyExistsError.\n- Used absl::StrCat to construct error messages where necessary.\n\nReverts 2fc3b480f5e51a69bc7a7015576892bb4b33ad3f\n\nPiperOrigin-RevId: 837473556",
    "sha": "b903afee23f0084a8e0457b0139b146e38c4e1de",
    "files": [
        {
            "sha": "fb3f86dd267f976b0bdced591b57e8376b015613",
            "filename": "third_party/xla/xla/tsl/framework/device_id_manager.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fframework%2Fdevice_id_manager.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -55,16 +55,17 @@ class TfToPlatformDeviceIdMap {\n           {tf_device_id.value(), platform_device_id.value()});\n     }\n     if (!result.second && platform_device_id.value() != result.first->second) {\n-      return errors::AlreadyExists(\n-          \"TensorFlow device (\", type, \":\", tf_device_id.value(),\n+      return absl::AlreadyExistsError(absl::StrCat(\n+          \"TensorFlow device (\", type.type_string(), \":\", tf_device_id.value(),\n           \") is being mapped to multiple devices (\", platform_device_id.value(),\n           \" now, and \", result.first->second,\n           \" previously), which is not supported. \"\n           \"This may be the result of providing different \",\n-          type, \" configurations (ConfigProto.gpu_options, for example \",\n+          type.type_string(),\n+          \" configurations (ConfigProto.gpu_options, for example \",\n           \"different visible_device_list) when creating multiple Sessions in \",\n           \"the same process. This is not currently supported, see \",\n-          \"https://github.com/tensorflow/tensorflow/issues/19083\");\n+          \"https://github.com/tensorflow/tensorflow/issues/19083\"));\n     }\n     return absl::OkStatus();\n   }"
        },
        {
            "sha": "d5de477b3aaf5032947ae4361aae0c69e4df39cc",
            "filename": "third_party/xla/xla/tsl/platform/cloud/BUILD",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2FBUILD?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -130,10 +130,13 @@ cc_library(\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/base:core_headers\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\",\n@@ -176,10 +179,13 @@ cc_library(\n         \"//xla/tsl/platform:status\",\n         \"//xla/tsl/platform:types\",\n         \"@com_google_absl//absl/base:core_headers\",\n+        \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/time\",\n+        \"@com_google_absl//absl/types:span\",\n         \"@jsoncpp_git//:jsoncpp\",\n         \"@local_tsl//tsl/platform:numbers\",\n         \"@local_tsl//tsl/platform:path\","
        },
        {
            "sha": "b9ee517a0a710cc92e99a37441c915809e0360f2",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system.cc",
            "status": "modified",
            "additions": 28,
            "deletions": 1,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -17,13 +17,40 @@ limitations under the License.\n \n #include <stdio.h>\n \n+#include <cstdint>\n+#include <iosfwd>\n+#include <limits>\n #include <memory>\n+#include <set>\n+#include <unordered_set>\n \n+#include \"absl/base/attributes.h\"\n+#include \"absl/log/check.h\"\n+#include \"absl/log/log.h\"\n #include \"absl/status/status.h\"\n+#include \"absl/strings/ascii.h\"\n+#include \"absl/strings/match.h\"\n+#include \"absl/strings/numbers.h\"\n #include \"absl/strings/str_cat.h\"\n+#include \"absl/strings/str_join.h\"\n+#include \"absl/strings/str_split.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"absl/strings/strip.h\"\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/time/clock.h\"\n #include \"absl/time/time.h\"\n+#include \"absl/types/span.h\"\n+#include \"xla/tsl/platform/cloud/auth_provider.h\"\n+#include \"xla/tsl/platform/cloud/compute_engine_metadata_client.h\"\n+#include \"xla/tsl/platform/cloud/compute_engine_zone_provider.h\"\n+#include \"xla/tsl/platform/cloud/expiring_lru_cache.h\"\n+#include \"xla/tsl/platform/cloud/gcs_dns_cache.h\"\n+#include \"xla/tsl/platform/cloud/gcs_throttle.h\"\n+#include \"xla/tsl/platform/cloud/http_request.h\"\n+#include \"xla/tsl/platform/cloud/zone_provider.h\"\n+#include \"xla/tsl/platform/file_system.h\"\n+#include \"xla/tsl/platform/status.h\"\n+#include \"xla/tsl/platform/types.h\"\n #include \"tsl/platform/retrying_file_system.h\"\n \n #ifndef _WIN32\n@@ -1986,7 +2013,7 @@ absl::Status GcsFileSystem::CreateDir(const string& dirname,\n   if (FileExists(dirname_with_slash, token).ok()) {\n     // Use the original name for a correct error here.\n     VLOG(3) << \"CreateDir: directory already exists, not uploading \" << dirname;\n-    return errors::AlreadyExists(dirname);\n+    return absl::AlreadyExistsError(dirname);\n   }\n \n   std::unique_ptr<HttpRequest> request;"
        },
        {
            "sha": "24cf00f79a6dc8cdad9eec6f0d7e86a291b90da5",
            "filename": "third_party/xla/xla/tsl/platform/cloud/gcs_file_system_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fcloud%2Fgcs_file_system_test.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -3622,11 +3622,11 @@ TEST(GcsFileSystemTest, CreateDir_Folder) {\n   TF_EXPECT_OK(fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n   // Check that when GCS returns the object already exists return that the\n   // directory already exists.\n-  EXPECT_EQ(errors::AlreadyExists(\"gs://bucket/subpath\"),\n+  EXPECT_EQ(absl::AlreadyExistsError(\"gs://bucket/subpath\"),\n             fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n   // Check that when GCS returns the object already has a version (failed\n   // precondition) return directory already exists.\n-  EXPECT_EQ(errors::AlreadyExists(\"gs://bucket/subpath\"),\n+  EXPECT_EQ(absl::AlreadyExistsError(\"gs://bucket/subpath\"),\n             fs.CreateDir(\"gs://bucket/subpath\", nullptr));\n }\n "
        },
        {
            "sha": "b5aceb89e063f1183da88b0b050c7122e5950fa2",
            "filename": "third_party/xla/xla/tsl/platform/default/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2FBUILD?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -164,12 +164,15 @@ cc_library(\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:nullability\",\n         \"@com_google_absl//absl/functional:any_invocable\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/strings:cord\",\n         \"@com_google_absl//absl/strings:str_format\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@com_google_absl//absl/types:span\",\n+        \"@com_google_protobuf//:protobuf\",\n+        \"@com_google_protobuf//:protobuf_lite\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform\",\n         \"@local_tsl//tsl/platform:blocking_counter\",\n@@ -185,7 +188,6 @@ cc_library(\n         \"@local_tsl//tsl/platform:str_util\",\n         \"@local_tsl//tsl/platform:strcat\",\n         \"@local_tsl//tsl/platform:stringpiece\",\n-        \"@local_tsl//tsl/platform:stringprintf\",\n         \"@local_tsl//tsl/platform:thread_annotations\",\n         \"@local_tsl//tsl/platform:tracing\",\n     ],"
        },
        {
            "sha": "292fb7fe968996e02c530df1eab21838dff404a0",
            "filename": "third_party/xla/xla/tsl/platform/default/posix_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fdefault%2Fposix_file_system.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -349,7 +349,7 @@ absl::Status PosixFileSystem::CreateDir(const std::string& name,\n                                         TransactionToken* token) {\n   std::string translated = TranslateName(name);\n   if (translated.empty()) {\n-    return errors::AlreadyExists(name);\n+    return absl::AlreadyExistsError(name);\n   }\n   if (mkdir(translated.c_str(), 0755) != 0) {\n     return IOError(name, errno);"
        },
        {
            "sha": "b104d90b8bf2e2ab98866c111c3b1db17813c154",
            "filename": "third_party/xla/xla/tsl/platform/env.cc",
            "status": "modified",
            "additions": 18,
            "deletions": 9,
            "changes": 27,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fenv.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -18,19 +18,28 @@ limitations under the License.\n #include <sys/stat.h>\n \n #include <cstdint>\n-#include <deque>\n+#include <cstdio>\n+#include <memory>\n+#include <string>\n+#include <unordered_map>\n #include <utility>\n #include <vector>\n \n+#include \"absl/log/check.h\"\n+#include \"absl/status/status.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"absl/strings/str_format.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n-#include \"xla/tsl/platform/env_time.h\"\n+#include \"absl/types/span.h\"\n+#include \"google/protobuf/message.h\"\n+#include \"google/protobuf/message_lite.h\"\n+#include \"google/protobuf/text_format.h\"\n #include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/file_statistics.h\"\n+#include \"xla/tsl/platform/file_system.h\"\n #include \"tsl/platform/host_info.h\"\n #include \"tsl/platform/path.h\"\n-#include \"tsl/platform/platform.h\"\n-#include \"tsl/platform/protobuf.h\"\n-#include \"tsl/platform/stringprintf.h\"\n #include \"tsl/platform/thread_annotations.h\"\n \n #if defined(__APPLE__)\n@@ -77,8 +86,8 @@ absl::Status FileSystemRegistryImpl::Register(\n   absl::MutexLock lock(mu_);\n   if (!registry_.emplace(scheme, std::unique_ptr<FileSystem>(factory()))\n            .second) {\n-    return errors::AlreadyExists(\"File factory for \", scheme,\n-                                 \" already registered\");\n+    return absl::AlreadyExistsError(\n+        absl::StrCat(\"File factory for \", scheme, \" already registered\"));\n   }\n   return absl::OkStatus();\n }\n@@ -87,8 +96,8 @@ absl::Status FileSystemRegistryImpl::Register(\n     const std::string& scheme, std::unique_ptr<FileSystem> filesystem) {\n   absl::MutexLock lock(mu_);\n   if (!registry_.emplace(scheme, std::move(filesystem)).second) {\n-    return errors::AlreadyExists(\"File system for \", scheme,\n-                                 \" already registered\");\n+    return absl::AlreadyExistsError(\n+        absl::StrCat(\"File system for \", scheme, \" already registered\"));\n   }\n   return absl::OkStatus();\n }"
        },
        {
            "sha": "f1b2528701e7261b4335175e80ee0268328bcae1",
            "filename": "third_party/xla/xla/tsl/platform/ram_file_system.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fram_file_system.h?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -263,7 +263,7 @@ class RamFileSystem : public FileSystem {\n \n     auto it = fs_.find(dirname);\n     if (it != fs_.end() && it->second != nullptr) {\n-      return errors::AlreadyExists(\n+      return absl::AlreadyExistsError(\n           \"cannot create directory with same name as an existing file\");\n     }\n "
        },
        {
            "sha": "50892fd5c7bad7d8957e5e2abd15b0155f415fbc",
            "filename": "third_party/xla/xla/tsl/platform/windows/windows_file_system.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/b903afee23f0084a8e0457b0139b146e38c4e1de/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fplatform%2Fwindows%2Fwindows_file_system.cc?ref=b903afee23f0084a8e0457b0139b146e38c4e1de",
            "patch": "@@ -594,7 +594,7 @@ Status WindowsFileSystem::CreateDir(const string& name,\n   Status result;\n   std::wstring ws_name = Utf8ToWideChar(name);\n   if (ws_name.empty()) {\n-    return errors::AlreadyExists(name);\n+    return absl::AlreadyExistsError(name);\n   }\n   if (_wmkdir(ws_name.c_str()) != 0) {\n     result = IOError(\"Failed to create a directory: \" + name, errno);"
        }
    ],
    "stats": {
        "total": 85,
        "additions": 65,
        "deletions": 20
    }
}