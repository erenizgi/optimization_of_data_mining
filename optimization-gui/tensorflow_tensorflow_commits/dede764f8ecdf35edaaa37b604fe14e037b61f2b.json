{
    "author": "hanrach9",
    "message": "Remove stride functions from xla/types\n\nPiperOrigin-RevId: 831594918",
    "sha": "dede764f8ecdf35edaaa37b604fe14e037b61f2b",
    "files": [
        {
            "sha": "95261231334095da35d6c14e0b8a942ce870cfbe",
            "filename": "third_party/xla/xla/python/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2FBUILD?ref=dede764f8ecdf35edaaa37b604fe14e037b61f2b",
            "patch": "@@ -124,6 +124,7 @@ cc_library(\n     deps = [\n         \":nb_numpy\",\n         \":safe_static_init\",\n+        \":strides\",\n         \"//xla:literal\",\n         \"//xla:shape_util\",\n         \"//xla:status_macros\","
        },
        {
            "sha": "ade8653364883651135d4ba283b0bc545720d0a1",
            "filename": "third_party/xla/xla/python/types.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 38,
            "changes": 39,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.cc?ref=dede764f8ecdf35edaaa37b604fe14e037b61f2b",
            "patch": "@@ -42,6 +42,7 @@ limitations under the License.\n #include \"xla/python/nb_numpy.h\"\n #include \"xla/python/pjrt_ifrt/pjrt_dtype.h\"\n #include \"xla/python/safe_static_init.h\"\n+#include \"xla/python/strides.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/status_macros.h\"\n@@ -470,44 +471,6 @@ absl::StatusOr<nb::str> TypeDescriptorForPrimitiveType(PrimitiveType type) {\n   }\n }\n \n-// Returns the strides for `shape`.\n-std::vector<int64_t> ByteStridesForShape(const Shape& shape) {\n-  std::vector<int64_t> strides;\n-  CHECK(shape.IsArray());\n-  CHECK(shape.has_layout());\n-  return ByteStridesForShape(shape.element_type(), shape.dimensions(),\n-                             shape.layout());\n-}\n-\n-static std::vector<int64_t> StridesForShapeHelper(\n-    PrimitiveType element_type, absl::Span<const int64_t> dimensions,\n-    const xla::Layout& layout, int64_t innermost_stride_size) {\n-  CHECK_EQ(dimensions.size(), layout.minor_to_major().size());\n-  std::vector<int64_t> strides;\n-  strides.resize(dimensions.size());\n-  int64_t stride = innermost_stride_size;\n-  for (int i : layout.minor_to_major()) {\n-    strides[i] = stride;\n-    stride *= dimensions[i];\n-  }\n-  return strides;\n-}\n-\n-std::vector<int64_t> ByteStridesForShape(PrimitiveType element_type,\n-                                         absl::Span<const int64_t> dimensions,\n-                                         const xla::Layout& layout) {\n-  return StridesForShapeHelper(\n-      element_type, dimensions, layout,\n-      ShapeUtil::ByteSizeOfPrimitiveType(element_type));\n-}\n-\n-std::vector<int64_t> StridesForShape(PrimitiveType element_type,\n-                                     absl::Span<const int64_t> dimensions,\n-                                     const xla::Layout& layout) {\n-  return StridesForShapeHelper(element_type, dimensions, layout,\n-                               /*innermost_stride_size=*/1);\n-}\n-\n absl::StatusOr<nb::object> LiteralToPython(\n     std::shared_ptr<xla::Literal> literal) {\n   xla::Literal& m = *literal;"
        },
        {
            "sha": "095db6ba1e07d7cb53c3962eeafed06288976a27",
            "filename": "third_party/xla/xla/python/types.h",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/dede764f8ecdf35edaaa37b604fe14e037b61f2b/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Ftypes.h?ref=dede764f8ecdf35edaaa37b604fe14e037b61f2b",
            "patch": "@@ -30,6 +30,7 @@ limitations under the License.\n #include \"xla/literal.h\"\n #include \"xla/python/ifrt/dtype.h\"\n #include \"xla/python/nb_numpy.h\"\n+#include \"xla/python/strides.h\"  // IWYU pragma: keep\n #include \"xla/python/version.h\"\n #include \"xla/shape.h\"\n #include \"xla/xla_data.pb.h\"\n@@ -96,15 +97,6 @@ struct NumpyScalarTypes {\n };\n const NumpyScalarTypes& GetNumpyScalarTypes();\n \n-// Returns the strides for `shape`.\n-std::vector<int64_t> ByteStridesForShape(const Shape& shape);\n-std::vector<int64_t> ByteStridesForShape(PrimitiveType element_type,\n-                                         absl::Span<const int64_t> dimensions,\n-                                         const xla::Layout& layout);\n-std::vector<int64_t> StridesForShape(PrimitiveType element_type,\n-                                     absl::Span<const int64_t> dimensions,\n-                                     const xla::Layout& layout);\n-\n // Converts a literal to (possibly-nested tuples of) NumPy arrays.\n // The literal's leaf arrays are not copied; instead the NumPy arrays share\n // buffers with the literals. Takes ownership of `literal` and keeps the"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 3,
        "deletions": 47
    }
}