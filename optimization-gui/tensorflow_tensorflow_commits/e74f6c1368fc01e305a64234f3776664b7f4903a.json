{
    "author": "hyeontaek",
    "message": "[IFRT] Migrate `Array::pjrt_layout()` callers to interpret `nullptr` as a default layout\n\n`Array::pjrt_layout()` will be changed to return `nullptr` to indicate a default layout, where the callers can obtain the corresponding concrete default layout by using `Client::GetDefaultPjRtLayout()`.\n\nThis change adds `nullptr` handling preemptively before the new `Array::pjrt_layout()` semantics becomes effective so that the existing code works as before.\n\nTests using `Array::pjrt_layout()` method calls are minimally updated to add a non-nullness check. They will be updated as `Array::pjrt_layout()` actually returns `nullptr`.\n\nPiperOrigin-RevId: 817600994",
    "sha": "e74f6c1368fc01e305a64234f3776664b7f4903a",
    "files": [
        {
            "sha": "be6017ca399df7b98c4251f95fbea7427b676595",
            "filename": "third_party/xla/xla/python/ifrt/array_impl_test_lib.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e74f6c1368fc01e305a64234f3776664b7f4903a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e74f6c1368fc01e305a64234f3776664b7f4903a/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpython%2Fifrt%2Farray_impl_test_lib.cc?ref=e74f6c1368fc01e305a64234f3776664b7f4903a",
            "patch": "@@ -316,6 +316,7 @@ TEST(ArrayImplTest, MakeArrayFromHostBufferDefaultLayout) {\n     TF_ASSERT_OK(array->GetReadyFuture().Await());\n \n     TF_ASSERT_OK_AND_ASSIGN(auto layout, array->pjrt_layout());\n+    ASSERT_NE(layout, nullptr);\n     EXPECT_EQ(*layout, *default_layout);\n   }\n }\n@@ -711,6 +712,7 @@ TEST(ArrayImplTest, MakeArraysFromHostBufferShardsWithLayout) {\n \n   TF_ASSERT_OK(array->GetReadyFuture().Await());\n   TF_ASSERT_OK_AND_ASSIGN(auto result_layout, array->pjrt_layout());\n+  ASSERT_NE(result_layout, nullptr);\n   EXPECT_EQ(*result_layout, *layout);\n }\n \n@@ -1449,6 +1451,7 @@ TEST(ArrayImplTest, CopyPreservesDefaultLayouts) {\n       TF_ASSERT_OK(array->GetReadyFuture().Await());\n \n       TF_ASSERT_OK_AND_ASSIGN(auto src_layout, array->pjrt_layout());\n+      ASSERT_NE(src_layout, nullptr);\n       TF_ASSERT_OK_AND_ASSIGN(\n           auto src_default_layout,\n           client->GetDefaultPjRtLayout(dtype, shape.dims(), device,\n@@ -1461,6 +1464,7 @@ TEST(ArrayImplTest, CopyPreservesDefaultLayouts) {\n                                               ArrayCopySemantics::kAlwaysCopy));\n       ASSERT_THAT(new_arrays, SizeIs(1));\n       TF_ASSERT_OK_AND_ASSIGN(auto dst_layout, new_arrays[0]->pjrt_layout());\n+      ASSERT_NE(dst_layout, nullptr);\n       TF_ASSERT_OK_AND_ASSIGN(\n           auto dst_default_layout,\n           client->GetDefaultPjRtLayout(dtype, shape.dims(), device,"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}