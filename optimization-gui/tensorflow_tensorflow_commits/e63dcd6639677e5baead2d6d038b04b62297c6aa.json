{
    "author": "beckerhe",
    "message": "Make TSAN work with non instrumented code (CUDA libraries)\n\nCommandBufferTest fails with a false positive data race since\nit can't see the synchronization happening in CUDA streams.\n\nBy setting the `ignore_noninstrumented_modules` flag we avoid\nthis false positive, but note that this might also come\nwith false negatives. That's why I'm only setting this for\nthis one test which currently experience the false positive.\n\nhttps://github.com/google/sanitizers/wiki/threadsanitizercppmanual#non-instrumented-code\nhas more details about this flag.\n\nPiperOrigin-RevId: 804849135",
    "sha": "e63dcd6639677e5baead2d6d038b04b62297c6aa",
    "files": [
        {
            "sha": "51fb69c24e43a591a14bf8262fe1970b0e3f84ec",
            "filename": "third_party/xla/xla/service/gpu/tests/BUILD",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e63dcd6639677e5baead2d6d038b04b62297c6aa/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e63dcd6639677e5baead2d6d038b04b62297c6aa/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD?ref=e63dcd6639677e5baead2d6d038b04b62297c6aa",
            "patch": "@@ -153,6 +153,8 @@ xla_test(\n     name = \"command_buffer_test\",\n     srcs = [\"command_buffer_test.cc\"],\n     backends = [\"gpu\"],\n+    # TSAN reports a false positive for the test due to noninstrumented CUDA library code.\n+    env = {\"TSAN_OPTIONS\": \"ignore_noninstrumented_modules=1\"},\n     tags = [\"test_migrated_to_hlo_runner_pjrt\"],\n     deps = [\n         \"//xla:literal\","
        }
    ],
    "stats": {
        "total": 2,
        "additions": 2,
        "deletions": 0
    }
}