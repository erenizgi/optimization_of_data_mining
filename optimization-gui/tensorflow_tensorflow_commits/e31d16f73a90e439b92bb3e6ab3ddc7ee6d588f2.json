{
    "author": "derdrdirk",
    "message": "[Autotuner] Add expected mock calls to MockStreamExecutor. Remove Cublas and CublasLt distinction.\nThese changes are needed for the new Autotuner, which does not distinguish between Cublas and CublasLt and autotunes for both backends.\n\nPiperOrigin-RevId: 842658982",
    "sha": "e31d16f73a90e439b92bb3e6ab3ddc7ee6d588f2",
    "files": [
        {
            "sha": "2dc6cb2e0fcdb3c90395ba976d52f12d76f8f809",
            "filename": "third_party/xla/xla/service/gpu/determinism_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e31d16f73a90e439b92bb3e6ab3ddc7ee6d588f2/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fdeterminism_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e31d16f73a90e439b92bb3e6ab3ddc7ee6d588f2/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fdeterminism_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fdeterminism_test.cc?ref=e31d16f73a90e439b92bb3e6ab3ddc7ee6d588f2",
            "patch": "@@ -16,7 +16,6 @@ limitations under the License.\n #include <memory>\n #include <optional>\n #include <utility>\n-#include <variant>\n #include <vector>\n \n #include <gmock/gmock.h>\n@@ -134,6 +133,12 @@ class DeterminismTest : public GpuCodegenTest {\n     EXPECT_CALL(executor, SynchronizeAllActivity).WillRepeatedly([&]() -> bool {\n       return true;\n     });\n+    EXPECT_CALL(executor, CreateStream).WillRepeatedly([&] {\n+      return backend().default_stream_executor()->CreateStream();\n+    });\n+    EXPECT_CALL(executor, AsBlas).WillRepeatedly([&] {\n+      return backend().default_stream_executor()->AsBlas();\n+    });\n \n     TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<HloModule> module,\n                             ParseAndReturnVerifiedModule(hlo_string));\n@@ -183,12 +188,6 @@ ENTRY e {\n   MatchOptimizedHlo(kHloText, R\"(; CHECK: custom_call_target=\"__cublas$gemm\")\",\n                     TimerCreation::kForbidden);\n   AssertDeterminism(kHloText);\n-\n-  debug_options_.set_xla_gpu_enable_cublaslt(true);\n-  MatchOptimizedHlo(kHloText,\n-                    R\"(; CHECK: custom_call_target=\"__cublas$lt$matmul\")\",\n-                    TimerCreation::kForbidden);\n-  AssertDeterminism(kHloText);\n }\n \n TEST_F(DeterminismTest, DeterministicTritonGemmUsesDefaultConfig) {"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 6,
        "deletions": 7
    }
}