{
    "author": "nvgrw",
    "message": "Remove uses of ExecuteAndTransfer and ExecuteNoHloPasses.\n\nPiperOrigin-RevId: 797114038",
    "sha": "ff6910277bfcdd4ef610ac34d1258785048b8440",
    "files": [
        {
            "sha": "d2115038ed0c187a8612826f5ef18f5cea8729ac",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -3130,16 +3130,16 @@ xla_test(\n         \"//xla/tests:xla_internal_test_main\",\n         \"//xla/tests:xla_test_backend_predicates\",\n         \"//xla/tsl/lib/core:status_test_util\",\n+        \"//xla/tsl/platform:errors\",\n+        \"//xla/tsl/platform:status\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/protobuf:error_codes_proto_impl_cc\",\n         \"@com_google_absl//absl/log\",\n         \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/status:statusor\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@local_tsl//tsl/platform:errors\",\n-        \"@local_tsl//tsl/platform:status\",\n-        \"@local_tsl//tsl/platform:statusor\",\n     ],\n )\n \n@@ -4012,6 +4012,7 @@ xla_cc_test(\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/log\",\n+        \"@com_google_absl//absl/status:status_matchers\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest\",\n     ],\n@@ -5066,6 +5067,7 @@ xla_cc_test(\n         \"//xla/tests:hlo_test_base\",\n         \"//xla/tests:literal_test_util\",\n         \"//xla/tests:xla_internal_test_main\",  # fixdeps: keep\n+        \"//xla/tsl/platform:statusor\",\n         \"@com_google_googletest//:gtest\",\n     ],\n )"
        },
        {
            "sha": "e10774afdeab0c55b5e41540cc502255de43d056",
            "filename": "third_party/xla/xla/service/cpu/tests/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2FBUILD?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -79,6 +79,7 @@ xla_cc_test(\n         \"//xla/service/cpu:cpu_instruction_fusion\",\n         \"//xla/tests:hlo_test_base\",\n         \"//xla/tests:literal_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/platform:test_main\",\n     ],"
        },
        {
            "sha": "be39c6a647f1c0de89a96e32807d92f260b4c111",
            "filename": "third_party/xla/xla/service/cpu/tests/cpu_fusion_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_fusion_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_fusion_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_fusion_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -27,6 +27,7 @@ limitations under the License.\n #include \"xla/shape_util.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/xla.pb.h\"\n #include \"xla/xla_data.pb.h\"\n@@ -83,7 +84,7 @@ TEST_F(CpuFusionTest, FuseTwoElementwiseOps) {\n   EXPECT_EQ(4, fusion_instruction->fused_instruction_count());\n \n   // Compile and execute the computation.\n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result, Execute(std::move(module), {}));\n \n   // Check the output correctness.\n   LiteralTestUtil::ExpectR1Near<float>({1.0, 40.0, -5.0}, result, error_spec_);\n@@ -130,7 +131,7 @@ TEST_F(CpuFusionTest, FuseElementwiseOpChain) {\n   EXPECT_EQ(8, fusion_instruction->fused_instruction_count());\n \n   // Compile and execute the computation.\n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result, Execute(std::move(module), {}));\n \n   // Check the output correctness.\n   LiteralTestUtil::ExpectR1Near<float>({14.0, 40.0, 40.0}, result, error_spec_);\n@@ -220,7 +221,7 @@ TEST_F(CpuFusionTest, ElementwiseOpChainWithNonfusibleInstruction) {\n       << fusion_instruction2->fused_instructions_computation()->ToString();\n \n   // Compile and execute the computation.\n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result, Execute(std::move(module), {}));\n \n   // Check the output correctness.\n   LiteralTestUtil::ExpectR1Near<float>({14.0, 40.0, 40.0, 14.0, 40.0, 40.0},"
        },
        {
            "sha": "684c5c789b1d0502d223f6eaba7f4a525df24c91",
            "filename": "third_party/xla/xla/service/cpu/tests/cpu_while_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_while_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_while_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2Ftests%2Fcpu_while_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -15,6 +15,7 @@ limitations under the License.\n \n #include <memory>\n #include <string>\n+#include <utility>\n \n #include <gtest/gtest.h>\n #include \"absl/strings/string_view.h\"\n@@ -68,7 +69,7 @@ ENTRY entry {\n   TF_ASSERT_OK_AND_ASSIGN(auto module, ParseAndReturnVerifiedModule(hlo_text));\n \n   // Compile and execute the computation.\n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result, Execute(std::move(module), {}));\n \n   // Check the output correctness.\n   LiteralTestUtil::ExpectR0Equal(3, result);\n@@ -123,7 +124,8 @@ TEST_F(CpuCodegenTest, WhileSort) {\n   Literal input = LiteralUtil::CreateR1<float>({3, 1, 4, 2});\n \n   // Compile and execute the computation.\n-  auto result = ExecuteAndTransfer(module->Clone(), {&input});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(module), {&input}));\n \n   // Check the output correctness.\n   LiteralTestUtil::ExpectR1Equal(absl::MakeConstSpan({4.0f, 3.0f, 2.0f, 1.0f}),"
        },
        {
            "sha": "6f44db231967477ab1224c78185845138fd4dacf",
            "filename": "third_party/xla/xla/service/dynamic_padder_test.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fdynamic_padder_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fdynamic_padder_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fdynamic_padder_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -26,6 +26,7 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/str_replace.h\"\n+#include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n #include \"xla/error_spec.h\"\n #include \"xla/hlo/builder/xla_builder.h\"\n@@ -51,12 +52,12 @@ limitations under the License.\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/llvm_irgen_test_base.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/errors.h\"\n+#include \"xla/tsl/platform/status.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/protobuf/error_codes.pb.h\"\n #include \"xla/util.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/errors.h\"\n-#include \"tsl/platform/status.h\"\n-#include \"tsl/platform/statusor.h\"\n \n namespace xla {\n namespace {\n@@ -810,9 +811,10 @@ ENTRY main {\n       LiteralUtil::CreateR2<int32_t>({{10, 20, 30}, {70, 80, 90}});\n   Literal dynamic_size = LiteralUtil::CreateR0<int32_t>(2);\n \n-  Literal not_padded =\n-      ExecuteAndTransfer(std::move(module_not_padded),\n-                         {&operand, &scatter_indices, &updates, &dynamic_size});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal not_padded,\n+      Execute(std::move(module_not_padded),\n+              {&operand, &scatter_indices, &updates, &dynamic_size}));\n \n   // Pad input to 4.\n   const std::string hlo_text_padded =\n@@ -1011,8 +1013,9 @@ ENTRY main {\n   Literal operand = LiteralUtil::CreateR2<int32_t>({{1, 2}, {4, 5}});\n   Literal dynamic_size = LiteralUtil::CreateR0<int32_t>(2);\n \n-  Literal not_padded = ExecuteAndTransfer(std::move(module_not_padded),\n-                                          {&operand, &dynamic_size});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal not_padded,\n+      Execute(std::move(module_not_padded), {&operand, &dynamic_size}));\n \n   // Pad input to 4.\n   const std::string hlo_text_padded ="
        },
        {
            "sha": "2e1d82c5cf92a6a2345be3dc7ed0b88370879e82",
            "filename": "third_party/xla/xla/service/gpu/tests/BUILD",
            "status": "modified",
            "additions": 7,
            "deletions": 10,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2FBUILD?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -140,6 +140,7 @@ xla_test(\n         \"//xla/tests:hlo_pjrt_interpreter_reference_mixin\",\n         \"//xla/tests:hlo_pjrt_test_base\",\n         \"//xla/tests:literal_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n@@ -172,6 +173,7 @@ xla_cc_test(\n         \"//xla/service:hlo_module_config\",\n         \"//xla/tests:hlo_test_base\",\n         \"//xla/tests:literal_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n         \"@com_google_googletest//:gtest_main\",\n     ],\n )\n@@ -778,34 +780,28 @@ xla_test(\n     shard_count = 2,\n     deps = [\n         \":gpu_codegen_test\",\n-        \"//xla:array3d\",\n         \"//xla:array4d\",\n         \"//xla:error_spec\",\n         \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n         \"//xla:types\",\n         \"//xla:xla_data_proto_cc\",\n-        \"//xla/hlo/builder:xla_builder\",\n-        \"//xla/hlo/builder:xla_computation\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/hlo/testlib:test_helpers\",\n-        \"//xla/service:hlo_module_config\",\n         \"//xla/service/gpu:stream_executor_util\",\n         \"//xla/stream_executor:device_description\",\n         \"//xla/stream_executor:dnn\",\n         \"//xla/stream_executor:semantic_version\",\n         \"//xla/stream_executor:stream_executor_h\",\n+        \"//xla/stream_executor/cuda:cuda_compute_capability\",\n         \"//xla/stream_executor/cuda:cuda_platform_id\",\n         \"//xla/tests:hlo_test_base\",\n-        \"//xla/tests:literal_test_util\",\n         \"//xla/tests:xla_internal_test_main\",\n-        \"@com_google_absl//absl/algorithm:container\",\n-        \"@com_google_absl//absl/status:statusor\",\n-        \"@com_google_absl//absl/strings\",\n+        \"//xla/tsl/lib/core:status_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"//xla/tsl/platform:test\",\n         \"@com_google_absl//absl/strings:string_view\",\n-        \"@local_tsl//tsl/platform:statusor\",\n-        \"@local_tsl//tsl/platform:test\",\n     ],\n )\n \n@@ -916,6 +912,7 @@ xla_test(\n         \"//xla:literal_util\",\n         \"//xla/tests:hlo_pjrt_test_base\",\n         \"//xla/tests:literal_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"@com_google_googletest//:gtest_main\",\n     ],"
        },
        {
            "sha": "00f7f413b68e8eab459b1aa5d050095abea8d722",
            "filename": "third_party/xla/xla/service/gpu/tests/async_command_buffer_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_command_buffer_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_command_buffer_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_command_buffer_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -22,6 +22,7 @@ limitations under the License.\n #include \"xla/service/hlo_module_config.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n \n namespace xla::gpu {\n namespace {\n@@ -83,7 +84,9 @@ TEST_F(AsyncCommandBufferTest, CommandBuffer) {\n   Literal argument = LiteralUtil::CreateR2<float>({{1.0, 2.0}, {3.0, 4.0}});\n   Literal expected = LiteralUtil::CreateR2<float>({{4.0, 8.0}, {12.0, 16.0}});\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {&argument});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result,\n+      Execute(std::move(module), {&argument}, /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }\n "
        },
        {
            "sha": "c144ad7386553c8138ccb2aad3ab9e25d960e65c",
            "filename": "third_party/xla/xla/service/gpu/tests/async_kernel_launch_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_kernel_launch_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_kernel_launch_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fasync_kernel_launch_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -24,6 +24,7 @@ limitations under the License.\n #include \"xla/tests/hlo_pjrt_interpreter_reference_mixin.h\"\n #include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/xla.pb.h\"\n \n namespace xla::gpu {\n@@ -75,7 +76,9 @@ TEST_F(AsyncKernelLaunchTest, BasicFusion) {\n   Literal argument = LiteralUtil::CreateR2<float>({{1.0, 2.0}, {3.0, 4.0}});\n   Literal expected = LiteralUtil::CreateR2<float>({{4.0, 8.0}, {12.0, 16.0}});\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {&argument});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result,\n+      Execute(std::move(module), {&argument}, /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }\n "
        },
        {
            "sha": "a89a622cde7ca493c09a46e9616792f8b9c1888d",
            "filename": "third_party/xla/xla/service/gpu/tests/command_buffer_test.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fcommand_buffer_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fcommand_buffer_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fcommand_buffer_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -74,7 +74,9 @@ TEST_P(CommandBufferTest, Fusions) {\n   Literal argument = LiteralUtil::CreateR2<float>({{1.0, 2.0}, {3.0, 4.0}});\n   Literal expected = LiteralUtil::CreateR2<float>({{3.0, 8.0}, {15.0, 24.0}});\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {&argument});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result,\n+      Execute(std::move(module), {&argument}, /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }\n \n@@ -123,7 +125,8 @@ TEST_P(CommandBufferTest, TrueFalseConditional) {\n \n     Literal pred = LiteralUtil::CreateR0<bool>(true);\n     Literal expected = LiteralUtil::CreateR2<float>({{2.0, 4.0}, {6.0, 8.0}});\n-    Literal result = ExecuteNoHloPasses(std::move(m), {&pred, &p1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(m), {&pred, &p1},\n+                                                    /*run_hlo_passes=*/false));\n     EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n   }\n \n@@ -132,7 +135,8 @@ TEST_P(CommandBufferTest, TrueFalseConditional) {\n \n     Literal pred = LiteralUtil::CreateR0<bool>(false);\n     Literal expected = LiteralUtil::CreateR2<float>({{1.0, 4.0}, {9.0, 16.0}});\n-    Literal result = ExecuteNoHloPasses(std::move(m), {&pred, &p1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(m), {&pred, &p1},\n+                                                    /*run_hlo_passes=*/false));\n     EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n   }\n }\n@@ -181,7 +185,8 @@ TEST_P(CommandBufferTest, IndexConditional) {\n \n     Literal index = LiteralUtil::CreateR0<int32_t>(0);\n     Literal expected = LiteralUtil::CreateR2<float>({{2.0, 4.0}, {6.0, 8.0}});\n-    Literal result = ExecuteNoHloPasses(std::move(m), {&index, &p1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(m), {&index, &p1},\n+                                                    /*run_hlo_passes=*/false));\n     EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n   }\n \n@@ -190,7 +195,8 @@ TEST_P(CommandBufferTest, IndexConditional) {\n \n     Literal index = LiteralUtil::CreateR0<int32_t>(1);\n     Literal expected = LiteralUtil::CreateR2<float>({{1.0, 4.0}, {9.0, 16.0}});\n-    Literal result = ExecuteNoHloPasses(std::move(m), {&index, &p1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(m), {&index, &p1},\n+                                                    /*run_hlo_passes=*/false));\n     EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n   }\n \n@@ -199,7 +205,8 @@ TEST_P(CommandBufferTest, IndexConditional) {\n \n     Literal index = LiteralUtil::CreateR0<int32_t>(1024);\n     Literal expected = LiteralUtil::CreateR2<float>({{1.0, 4.0}, {9.0, 16.0}});\n-    Literal result = ExecuteNoHloPasses(std::move(m), {&index, &p1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(m), {&index, &p1},\n+                                                    /*run_hlo_passes=*/false));\n     EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n   }\n }\n@@ -261,7 +268,9 @@ TEST_P(CommandBufferTest, WhileLoop) {\n   Literal expected_value = LiteralUtil::CreateR0<float>(20.0);\n   Literal expected = LiteralUtil::MakeTuple({&expected_cnt, &expected_value});\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {&argument});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result,\n+      Execute(std::move(module), {&argument}, /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }\n "
        },
        {
            "sha": "be4b14e40e988e215c87435265fbee34c88f5376",
            "filename": "third_party/xla/xla/service/gpu/tests/gpu_fused_mha_test.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 13,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fgpu_fused_mha_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fgpu_fused_mha_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fgpu_fused_mha_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -20,36 +20,29 @@ limitations under the License.\n #include <utility>\n #include <vector>\n \n-#include \"absl/algorithm/container.h\"\n-#include \"absl/status/statusor.h\"\n-#include \"absl/strings/match.h\"\n #include \"absl/strings/string_view.h\"\n-#include \"xla/array3d.h\"\n #include \"xla/array4d.h\"\n #include \"xla/error_spec.h\"\n-#include \"xla/hlo/builder/xla_builder.h\"\n-#include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n-#include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/hlo/testlib/test_helpers.h\"\n #include \"xla/layout_util.h\"\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/service/gpu/stream_executor_util.h\"\n #include \"xla/service/gpu/tests/gpu_codegen_test.h\"\n-#include \"xla/service/hlo_module_config.h\"\n+#include \"xla/stream_executor/cuda/cuda_compute_capability.h\"\n #include \"xla/stream_executor/cuda/cuda_platform_id.h\"\n #include \"xla/stream_executor/device_description.h\"\n #include \"xla/stream_executor/dnn.h\"\n #include \"xla/stream_executor/semantic_version.h\"\n #include \"xla/stream_executor/stream_executor.h\"\n #include \"xla/tests/hlo_test_base.h\"\n-#include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n+#include \"xla/tsl/platform/test.h\"\n #include \"xla/types.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/statusor.h\"\n-#include \"tsl/platform/test.h\"\n \n namespace xla {\n namespace gpu {\n@@ -1543,8 +1536,9 @@ class FlashAttentionBMMScaleSoftmaxDropoutBMM\n         std::unique_ptr<HloModule> module,\n         ParseAndReturnVerifiedModule(\n             kModuleFlashAttentionTrainingBMM1SoftmaxDropoutBMM2HloStringBF16));\n-    ExecuteAndTransfer(std::move(module), {&lhs_bmm1_literal, &rhs_bmm1_literal,\n-                                           &rhs_bmm2_literal, &do_literal});\n+    TF_EXPECT_OK(\n+        Execute(std::move(module), {&lhs_bmm1_literal, &rhs_bmm1_literal,\n+                                    &rhs_bmm2_literal, &do_literal}));\n   }\n };\n "
        },
        {
            "sha": "2a3c1ca979be87e367e5461b0ab3d6a97c8b4fd3",
            "filename": "third_party/xla/xla/service/gpu/tests/nop_custom_call_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fnop_custom_call_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fnop_custom_call_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fnop_custom_call_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -20,6 +20,7 @@ limitations under the License.\n #include \"xla/literal_util.h\"\n #include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n \n namespace xla {\n@@ -48,7 +49,8 @@ TEST_F(NopCustomCallTest, RunAllocateBufferAndUpdate) {\n   })\";\n   auto module = ParseAndReturnVerifiedModule(hlo_text).value();\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result, Execute(std::move(module), {}, /*run_hlo_passes=*/false));\n   Literal expected = LiteralUtil::CreateR1<int32_t>({1});\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }"
        },
        {
            "sha": "20f51dfbd55b232dba5794f5f6a9d6e73f074c1e",
            "filename": "third_party/xla/xla/service/gpu/tests/sorting_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fsorting_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fsorting_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftests%2Fsorting_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -215,7 +215,7 @@ ENTRY %main {\n \n   TF_ASSERT_OK_AND_ASSIGN(auto module, ParseAndReturnVerifiedModule(hlo));\n   std::vector<Literal*> literals = {std::get<0>(GetParam()).get()};\n-  auto result = ExecuteAndTransfer(std::move(module), literals);\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), literals));\n \n   bool has_diff = false;\n   for (int i = 1; i < kRadixSortTestSize; ++i) {\n@@ -265,8 +265,9 @@ ENTRY %main {\n \n   TF_ASSERT_OK_AND_ASSIGN(auto module, ParseAndReturnVerifiedModule(hlo));\n   std::vector<Literal*> literals = {std::get<0>(GetParam()).get()};\n-  auto result_tuple = ExecuteAndTransfer(std::move(module), literals);\n-  std::vector<Literal> result = result_tuple.DecomposeTuple();\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_tuple,\n+                          Execute(std::move(module), literals));\n+  std::vector<Literal> result = std::move(result_tuple).DecomposeTuple();\n \n   bool has_diff = false;\n   for (int i = 1; i < kRadixSortTestSize; ++i) {"
        },
        {
            "sha": "c6ba3708140781cda7c894bc6f352fa9e23a5de2",
            "filename": "third_party/xla/xla/service/gpu/transforms/BUILD",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2FBUILD?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -179,9 +179,10 @@ xla_cc_test(\n         \"//xla/hlo/utils:hlo_query\",\n         \"//xla/tests:hlo_test_base\",\n         \"//xla/tests:literal_test_util\",\n+        \"//xla/tsl/platform:status_matchers\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"@com_google_absl//absl/status:status_matchers\",\n         \"@com_google_googletest//:gtest_main\",\n-        \"@local_tsl//tsl/platform:status_matchers\",\n-        \"@local_tsl//tsl/platform:statusor\",\n     ],\n )\n "
        },
        {
            "sha": "871f1878c478f14685b44f1e59fcba5504969b5a",
            "filename": "third_party/xla/xla/service/gpu/transforms/async_wrapper_test.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fasync_wrapper_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fasync_wrapper_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Ftransforms%2Fasync_wrapper_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -20,6 +20,7 @@ limitations under the License.\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/status/status_matchers.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n@@ -30,8 +31,8 @@ limitations under the License.\n #include \"xla/literal_util.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n-#include \"tsl/platform/status_matchers.h\"\n-#include \"tsl/platform/statusor.h\"\n+#include \"xla/tsl/platform/status_matchers.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n \n namespace xla::gpu {\n namespace {\n@@ -80,7 +81,9 @@ TEST_F(AsyncWrapperTest, BasicFusion) {\n   Literal argument = LiteralUtil::CreateR1<float>({1.0});\n   Literal expected = LiteralUtil::CreateR1<float>({4.0});\n \n-  Literal result = ExecuteNoHloPasses(std::move(module), {&argument});\n+  TF_ASSERT_OK_AND_ASSIGN(\n+      Literal result,\n+      Execute(std::move(module), {&argument}, /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, result));\n }\n "
        },
        {
            "sha": "3828d9cbd75a612830b9eeb2fc5029539a78073f",
            "filename": "third_party/xla/xla/service/hlo_cse_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_cse_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_cse_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fhlo_cse_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -17,7 +17,6 @@ limitations under the License.\n \n #include <cstdint>\n #include <memory>\n-#include <optional>\n #include <string>\n #include <tuple>\n #include <vector>\n@@ -26,6 +25,7 @@ limitations under the License.\n #include <gtest/gtest.h>\n #include \"absl/algorithm/container.h\"\n #include \"absl/log/log.h\"\n+#include \"absl/status/status_matchers.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/strings/substitute.h\"\n@@ -84,7 +84,7 @@ TEST_F(HloCseTest, CombineTwoConstants) {\n   HloInstruction* constant = *computation->instructions().begin();\n   EXPECT_EQ(42.0f, constant->literal().Get<float>({}));\n \n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(module->Clone(), {}));\n   auto expected = LiteralUtil::CreateR0<float>(84.0);\n   EXPECT_TRUE(LiteralTestUtil::Near(expected, result, ErrorSpec(1e-4)));\n }\n@@ -114,7 +114,7 @@ TEST_F(HloCseTest, CombineTwoConstantsDifferentLayouts) {\n   EXPECT_EQ(3, computation->instruction_count());\n   EXPECT_THAT(add, op::Add(constant1, constant2));\n \n-  auto result = ExecuteAndTransfer(module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(module->Clone(), {}));\n   auto expected = LiteralUtil::CreateR2<float>({{2.0, 4.0}, {6.0, 8.0}});\n   EXPECT_TRUE(LiteralTestUtil::Near(expected, result, ErrorSpec(1e-4)));\n }"
        },
        {
            "sha": "a60a4957baa6a93bc47d193727092d2d7dcad1ef",
            "filename": "third_party/xla/xla/service/map_inliner_test.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fmap_inliner_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fmap_inliner_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fmap_inliner_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -30,6 +30,7 @@ limitations under the License.\n #include \"xla/shape_util.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/xla_data.pb.h\"\n \n namespace op = xla::testing::opcode_matchers;\n@@ -71,7 +72,8 @@ TEST_F(MapInlinerTest, MapMax) {\n               op::Maximum(lhs, rhs));\n \n   // Verify execution on CPU.\n-  auto result = ExecuteAndTransfer(hlo_module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   auto expected = LiteralUtil::CreateR1<float>({4, 3, 3, 4});\n   EXPECT_TRUE(LiteralTestUtil::Equal(result, expected));\n }\n@@ -105,7 +107,8 @@ TEST_F(MapInlinerTest, MapConstant) {\n   EXPECT_THAT(root, op::Broadcast(op::Constant()));\n \n   // Verify execution on CPU.\n-  auto result = ExecuteAndTransfer(hlo_module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   auto expected = LiteralUtil::CreateR2<float>({{2, 2, 2, 2}, {2, 2, 2, 2}});\n   EXPECT_TRUE(LiteralTestUtil::Equal(result, expected));\n }\n@@ -143,7 +146,8 @@ TEST_F(MapInlinerTest, MapSubtractOppositeOrder) {\n           op::Subtract(rhs, lhs));\n \n   // Verify execution on CPU.\n-  auto result = ExecuteAndTransfer(hlo_module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   auto expected = LiteralUtil::CreateR1<float>({3, 1, -1, -3});\n   EXPECT_TRUE(LiteralTestUtil::Equal(result, expected));\n }\n@@ -174,7 +178,8 @@ TEST_F(MapInlinerTest, MapParameter) {\n   EXPECT_THAT(hlo_module->entry_computation()->root_instruction(), rhs);\n \n   // Verify execution on CPU.\n-  auto result = ExecuteAndTransfer(hlo_module->Clone(), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   auto expected = LiteralUtil::CreateR0<float>(4);\n   EXPECT_TRUE(LiteralTestUtil::Equal(result, expected));\n }"
        },
        {
            "sha": "52035885640589fef9c607b7fd0846c70023c35d",
            "filename": "third_party/xla/xla/service/scatter_determinism_expander_test.cc",
            "status": "modified",
            "additions": 64,
            "deletions": 34,
            "changes": 98,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fscatter_determinism_expander_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fscatter_determinism_expander_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fscatter_determinism_expander_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -201,7 +201,8 @@ TEST_F(ScatterDeterminismExpanderTest, ScalarScatterAddCorrectnessTest) {\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -210,7 +211,8 @@ TEST_F(ScatterDeterminismExpanderTest, ScalarScatterAddCorrectnessTest) {\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -242,7 +244,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -251,7 +254,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -283,7 +287,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -292,7 +297,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -324,15 +330,17 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n   ScatterDeterminismExpander scatter_determinism_expander;\n   TF_ASSERT_OK_AND_ASSIGN(\n       bool result, RunHloPass(&scatter_determinism_expander, module.get()));\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -364,15 +372,17 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n   ScatterDeterminismExpander scatter_determinism_expander;\n   TF_ASSERT_OK_AND_ASSIGN(\n       bool result, RunHloPass(&scatter_determinism_expander, module.get()));\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -404,15 +414,17 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n   ScatterDeterminismExpander scatter_determinism_expander;\n   TF_ASSERT_OK_AND_ASSIGN(\n       bool result, RunHloPass(&scatter_determinism_expander, module.get()));\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -444,7 +456,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -453,7 +466,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -485,7 +499,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -494,7 +509,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -526,7 +542,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -535,7 +552,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -567,7 +585,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n   TF_ASSERT_OK_AND_ASSIGN(auto module,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -576,7 +595,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -617,7 +637,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n \n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -626,7 +647,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -667,7 +689,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n \n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -676,7 +699,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -717,7 +741,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n \n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -726,7 +751,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -767,7 +793,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n                           ParseAndReturnVerifiedModule(kModuleStr));\n \n   auto cloned_module = module->Clone();\n-  Literal expected_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal expected_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto expected_result = expected_literal.data<float>();\n \n   ScatterDeterminismExpander scatter_determinism_expander;\n@@ -776,7 +803,8 @@ TEST_F(ScatterDeterminismExpanderTest,\n \n   EXPECT_TRUE(result);\n \n-  Literal result_literal = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                          Execute(std::move(module), {}));\n \n   auto result_data = result_literal.data<float>();\n   std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -931,8 +959,8 @@ TEST_F(ScatterDeterminismExpanderTest, ScalarScatterAddReproducibilityTest) {\n   EXPECT_TRUE(result);\n \n   auto cloned_module = module->Clone();\n-  Literal first_result_literal =\n-      ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal first_result_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto first_result_span = first_result_literal.data<float>();\n   std::vector<float> first_result(first_result_span.begin(),\n                                   first_result_span.end());\n@@ -943,7 +971,8 @@ TEST_F(ScatterDeterminismExpanderTest, ScalarScatterAddReproducibilityTest) {\n   for (int i = 0; i < num_trials; ++i) {\n     auto cloned_module = module->Clone();\n \n-    Literal result_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                            Execute(std::move(cloned_module), {}));\n \n     auto result_data = result_literal.data<float>();\n     std::vector<float> actual_result(result_data.begin(), result_data.end());\n@@ -1003,8 +1032,8 @@ TEST_F(ScatterDeterminismExpanderTest, NonScalarScatterAddReproducibilityTest) {\n   EXPECT_TRUE(result);\n \n   auto cloned_module = module->Clone();\n-  Literal first_result_literal =\n-      ExecuteAndTransfer(std::move(cloned_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal first_result_literal,\n+                          Execute(std::move(cloned_module), {}));\n   auto first_result_span = first_result_literal.data<float>();\n   std::vector<float> first_result(first_result_span.begin(),\n                                   first_result_span.end());\n@@ -1015,7 +1044,8 @@ TEST_F(ScatterDeterminismExpanderTest, NonScalarScatterAddReproducibilityTest) {\n   for (int i = 0; i < num_trials; ++i) {\n     auto cloned_module = module->Clone();\n \n-    Literal result_literal = ExecuteAndTransfer(std::move(cloned_module), {});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result_literal,\n+                            Execute(std::move(cloned_module), {}));\n \n     auto result_data = result_literal.data<float>();\n     std::vector<float> actual_result(result_data.begin(), result_data.end());"
        },
        {
            "sha": "18a9cd106d25aa6bda33958d576cd00fcc187bfa",
            "filename": "third_party/xla/xla/service/while_loop_unroller_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fwhile_loop_unroller_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Fservice%2Fwhile_loop_unroller_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fwhile_loop_unroller_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -72,12 +72,14 @@ class WhileLoopUnrollerTest : public HloTestBase {\n   void UnrollAndCompare(std::unique_ptr<HloModule> module,\n                         absl::Span<Literal* const> arguments,\n                         int64_t unroll_factor = -1, bool wrap_in_loop = false) {\n-    Literal before_unroll = ExecuteAndTransfer(module->Clone(), arguments);\n+    TF_ASSERT_OK_AND_ASSIGN(Literal before_unroll,\n+                            Execute(module->Clone(), arguments));\n     VLOG(2) << \"before unroll value: \" << before_unroll.ToString();\n     EXPECT_TRUE(WhileLoopUnroller(unroll_factor, wrap_in_loop)\n                     .Run(module.get())\n                     .value());\n-    Literal after_unroll = ExecuteAndTransfer(std::move(module), arguments);\n+    TF_ASSERT_OK_AND_ASSIGN(Literal after_unroll,\n+                            Execute(std::move(module), arguments));\n     VLOG(2) << \"after unroll value: \" << after_unroll.ToString();\n \n     ASSERT_TRUE(LiteralTestUtil::NearOrEqual(/*expected=*/before_unroll,"
        },
        {
            "sha": "0501a9a6d4bf71742456e17386d1a05bb45e3360",
            "filename": "third_party/xla/xla/tests/BUILD",
            "status": "modified",
            "additions": 17,
            "deletions": 11,
            "changes": 28,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2FBUILD?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -1321,6 +1321,7 @@ xla_test(\n         \"//xla/hlo/builder/lib:constants\",\n         \"//xla/tests:xla_test_backend_predicates\",\n         \"//xla/tsl/lib/core:status_test_util\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"@com_google_googletest//:gtest\",\n         \"@local_tsl//tsl/platform:ml_dtypes\",\n@@ -2157,14 +2158,13 @@ xla_test(\n     deps = [\n         \":hlo_test_base\",\n         \":literal_test_util\",\n-        \":test_utils\",\n         \":xla_internal_test_main\",\n         \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:hlo_module_util\",\n-        \"@local_tsl//tsl/platform:statusor\",\n-        \"@local_tsl//tsl/platform:test\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"//xla/tsl/platform:test\",\n     ],\n )\n \n@@ -2610,8 +2610,10 @@ xla_test(\n     deps = [\n         \":hlo_pjrt_test_base\",\n         \":xla_internal_test_main\",\n+        \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla/hlo/testlib:test\",\n+        \"@com_google_absl//absl/status:status_matchers\",\n     ],\n )\n \n@@ -2985,13 +2987,17 @@ xla_test(\n         \":hlo_pjrt_test_base\",\n         \":literal_test_util\",\n         \":xla_internal_test_main\",\n+        \"//xla:array2d\",\n         \"//xla:array3d\",\n         \"//xla:array4d\",\n+        \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/hlo/ir:hlo\",\n-        \"@local_tsl//tsl/platform:test\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/log\",\n     ],\n )\n \n@@ -3072,6 +3078,7 @@ xla_test(\n         \"//xla/stream_executor:stream_executor_memory_allocator\",\n         \"//xla/tests:xla_test_backend_predicates\",\n         \"//xla/tsl/platform:env\",\n+        \"//xla/tsl/platform:statusor\",\n         \"//xla/tsl/platform:test\",\n         \"//xla/tsl/platform:test_benchmark\",\n         \"@com_google_absl//absl/log\",\n@@ -3090,21 +3097,20 @@ xla_test(\n         \":client_library_test_base\",\n         \":hlo_test_base\",\n         \":literal_test_util\",\n-        \":test_utils\",\n         \":xla_internal_test_main\",\n+        \"//xla:error_spec\",\n         \"//xla:literal\",\n+        \"//xla:literal_util\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n-        \"//xla/client:local_client\",\n         \"//xla/hlo/ir:hlo\",\n-        \"//xla/service:hlo_runner\",\n         \"//xla/tests:xla_test_backend_predicates\",\n-        \"//xla/tsl/lib/core:status_test_util\",\n+        \"//xla/tsl/platform:status\",\n+        \"//xla/tsl/platform:statusor\",\n+        \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/log:check\",\n         \"@com_google_absl//absl/strings\",\n         \"@com_google_absl//absl/types:span\",\n-        \"@local_tsl//tsl/platform:protobuf\",\n-        \"@local_tsl//tsl/platform:test\",\n-        \"@local_tsl//tsl/platform:test_benchmark\",\n     ],\n )\n "
        },
        {
            "sha": "a11f9df239f3d6539e4d373ecf9996e4e5b7b545",
            "filename": "third_party/xla/xla/tests/all_reduce_test.cc",
            "status": "modified",
            "additions": 21,
            "deletions": 10,
            "changes": 31,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fall_reduce_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fall_reduce_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fall_reduce_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -14,15 +14,21 @@ limitations under the License.\n ==============================================================================*/\n \n #include <cstdint>\n+#include <functional>\n #include <utility>\n \n+#include \"absl/status/status_matchers.h\"\n #include \"xla/hlo/testlib/test.h\"\n+#include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/tests/hlo_pjrt_test_base.h\"\n \n namespace xla {\n namespace {\n \n+using ::absl_testing::IsOkAndHolds;\n+using ::testing::Eq;\n+\n using TrivialAllReduceTest = HloPjRtTestBase;\n \n // Currently the CPU and GPU backends only support AllReduce with one\n@@ -45,8 +51,9 @@ TEST_F(TrivialAllReduceTest, OneOperand) {\n   auto module =\n       ParseAndReturnVerifiedModule(module_str, GetModuleConfigForTest())\n           .value();\n-  auto literal = LiteralUtil::CreateR1<float>({1, 2, 3});\n-  EXPECT_EQ(literal, ExecuteAndTransfer(std::move(module), {&literal}));\n+  const Literal literal = LiteralUtil::CreateR1<float>({1, 2, 3});\n+  EXPECT_THAT(Execute(std::move(module), {&literal}),\n+              IsOkAndHolds(Eq(std::ref(literal))));\n }\n \n TEST_F(TrivialAllReduceTest, MultipleOperands) {\n@@ -69,8 +76,9 @@ TEST_F(TrivialAllReduceTest, MultipleOperands) {\n           .value();\n   auto literal0 = LiteralUtil::CreateR1<float>({1, 2, 3});\n   auto literal1 = LiteralUtil::CreateR1<float>({10, 20});\n-  EXPECT_EQ(LiteralUtil::MakeTuple({&literal0, &literal1}),\n-            ExecuteAndTransfer(std::move(module), {&literal0, &literal1}));\n+  const Literal expected = LiteralUtil::MakeTuple({&literal0, &literal1});\n+  EXPECT_THAT(Execute(std::move(module), {&literal0, &literal1}),\n+              IsOkAndHolds(Eq(std::ref(expected))));\n }\n \n // On the GPU backend, constants get special handling.  Someone might pass a\n@@ -96,8 +104,9 @@ TEST_F(TrivialAllReduceTest, ConstantOperand) {\n           .value();\n   auto literal0 = LiteralUtil::CreateR1<float>({1, 2, 3});\n   auto literal1 = LiteralUtil::CreateR1<float>({10, 20});\n-  EXPECT_EQ(LiteralUtil::MakeTuple({&literal0, &literal1}),\n-            ExecuteAndTransfer(std::move(module), {&literal0}));\n+  const Literal expected = LiteralUtil::MakeTuple({&literal0, &literal1});\n+  EXPECT_THAT(Execute(std::move(module), {&literal0}),\n+              IsOkAndHolds(Eq(std::ref(expected))));\n }\n \n TEST_F(TrivialAllReduceTest, AllReduceU8) {\n@@ -137,8 +146,9 @@ ENTRY %test_computation {\n           .value();\n   auto literal_in = LiteralUtil::CreateR0<float>(0);\n   auto literal0 = LiteralUtil::CreateR1<uint8_t>({1, 0, 0, 0, 0, 0, 0, 0});\n-  EXPECT_EQ(LiteralUtil::MakeTuple({&literal0}),\n-            ExecuteAndTransfer(std::move(module), {&literal_in}));\n+  const Literal expected = LiteralUtil::MakeTuple({&literal0});\n+  EXPECT_THAT(Execute(std::move(module), {&literal_in}),\n+              IsOkAndHolds(Eq(std::ref(expected))));\n }\n \n TEST_F(TrivialAllReduceTest, AllReduceS32) {\n@@ -179,8 +189,9 @@ ENTRY %test_computation {\n           .value();\n   auto literal_in = LiteralUtil::CreateR0<float>(0);\n   auto literal0 = LiteralUtil::CreateR1<int32_t>({1, 0, 0, 0, 0, 0, 0, 0});\n-  EXPECT_EQ(LiteralUtil::MakeTuple({&literal0}),\n-            ExecuteAndTransfer(std::move(module), {&literal_in}));\n+  const Literal expected = LiteralUtil::MakeTuple({&literal0});\n+  EXPECT_THAT(Execute(std::move(module), {&literal_in}),\n+              IsOkAndHolds(Eq(std::ref(expected))));\n }\n \n }  // namespace"
        },
        {
            "sha": "f5a948aa50f5dd61c4d4ec5d97a698a527c69e0a",
            "filename": "third_party/xla/xla/tests/broadcast_test.cc",
            "status": "modified",
            "additions": 20,
            "deletions": 13,
            "changes": 33,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fbroadcast_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fbroadcast_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fbroadcast_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -13,19 +13,26 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n+#include <cstdint>\n #include <memory>\n+#include <numeric>\n #include <utility>\n+#include <vector>\n \n+#include \"absl/log/log.h\"\n+#include \"xla/array2d.h\"\n #include \"xla/array3d.h\"\n #include \"xla/array4d.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n+#include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n+#include \"xla/tsl/platform/test.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/test.h\"\n \n namespace xla {\n namespace {\n@@ -43,7 +50,7 @@ TEST_F(BroadcastTest, BroadcastScalarToScalar) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(LiteralUtil::CreateR0<float>(42.0), result,\n                                     kDefaultErrorSpec));\n@@ -59,7 +66,7 @@ TEST_F(BroadcastTest, BroadcastScalarTo2D) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR2<float>({{42.0, 42.0}, {42.0, 42.0}}), result,\n@@ -82,7 +89,7 @@ TEST_F(BroadcastTest, BroadcastVectorTo2D) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR2<float>({{1.0, 1.0}, {2.0, 2.0}, {3.0, 3.0}}),\n@@ -103,7 +110,7 @@ TEST_F(BroadcastTest, Broadcast2DTo2D) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR2<float>({{1.0, 2.0}, {3.0, 4.0}}), result,\n@@ -122,7 +129,7 @@ TEST_F(BroadcastTest, Broadcast2DTo2DTranspose) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR2<float>({{1.0, 3.0}, {2.0, 4.0}}), result,\n@@ -139,7 +146,7 @@ TEST_F(BroadcastTest, Broadcast2DTo3D) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR3<float>({{{1.0, 2.0}, {1.0, 2.0}, {1.0, 2.0}},\n@@ -159,7 +166,7 @@ TEST_F(BroadcastTest, Broadcast_R1_2_To_R4_2x2x3x3) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   Array4D<float> expected(2, 2, 3, 3);\n   Array2D<float> pz({{1, 2}, {1, 2}});\n@@ -185,7 +192,7 @@ TEST_F(BroadcastTest, Broadcast_R1_1025_To_R4_3x3x3x1025) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   Array4D<float> expected(3, 3, 3, 1025);\n   Array2D<float> yx(3, r1_size);\n@@ -217,7 +224,7 @@ TEST_F(BroadcastTest, Broadcast_R1_64_To_R4_32x64x7x7) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(LiteralTestUtil::Near(LiteralUtil::CreateR4FromArray4D(r4_array),\n                                     result, kDefaultErrorSpec));\n@@ -234,7 +241,7 @@ TEST_F(BroadcastTest, Broadcast_R0_to_R4_64x64x3x3) {\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n   LOG(INFO) << hlo_module->ToString();\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   Array4D<float> expected(64, 64, 3, 3);\n   expected.Fill(1.0f);\n@@ -257,7 +264,7 @@ TEST_F(BroadcastTest, Broadcast_R2_2x2_To_R4_3x3x2x2) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   Array4D<float> expected(3, 3, 2, 2);\n   expected.FillWithYX(to_broadcast);\n@@ -292,7 +299,7 @@ TEST_F(BroadcastTest, Broadcast_R3_2x3x4_to_R4_2x3x4x5) {\n   // Create HLO module, compile, and execute.\n   auto hlo_module = CreateNewVerifiedModule();\n   hlo_module->AddEntryComputation(builder.Build());\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(hlo_module), {}));\n \n   EXPECT_TRUE(\n       LiteralTestUtil::Near(LiteralUtil::CreateR4FromArray4D<float>(expected),"
        },
        {
            "sha": "c08a4bdf2b8f7cf7052aab1fdc7be741fd928487",
            "filename": "third_party/xla/xla/tests/constants_test.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fconstants_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fconstants_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fconstants_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -36,6 +36,7 @@ limitations under the License.\n #include \"xla/tests/hlo_pjrt_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n #include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/types.h\"\n #include \"tsl/platform/ml_dtypes.h\"\n@@ -289,7 +290,8 @@ TEST_F(ConstantsHloTest, BitcastOfConstant) {\n   )\";\n   auto module = ParseAndReturnVerifiedModule(testcase).value();\n   auto param = LiteralUtil::CreateR0<int32_t>(1);\n-  auto result = ExecuteNoHloPasses(std::move(module), {&param});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&param},\n+                                                  /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(param, result));\n }\n "
        },
        {
            "sha": "1be55ed680655b7d2cdc7b5ce0dff57377a38236",
            "filename": "third_party/xla/xla/tests/copy_test.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fcopy_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fcopy_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fcopy_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -58,7 +58,7 @@ class CopyOpTest : public HloPjRtTestBase {\n     auto module = CreateNewVerifiedModule();\n     module->AddEntryComputation(std::move(computation));\n \n-    Literal result = ExecuteAndTransfer(std::move(module), {});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {}));\n     EXPECT_TRUE(LiteralTestUtil::Equal(literal, result));\n   }\n \n@@ -76,7 +76,7 @@ class CopyOpTest : public HloPjRtTestBase {\n     module->AddEntryComputation(std::move(computation));\n \n     std::vector<Literal*> args = {&dynamic_literal};\n-    Literal result = ExecuteAndTransfer(std::move(module), args);\n+    TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), args));\n     Literal dynamic_result = result.ToBoundedDynamic(bounded_shape);\n     EXPECT_TRUE(LiteralTestUtil::Equal(dynamic_literal, dynamic_result));\n   }\n@@ -183,7 +183,8 @@ TEST_F(CopyOpTest, CopyParameterScalar) {\n   auto module = CreateNewVerifiedModule();\n   module->AddEntryComputation(std::move(computation));\n \n-  Literal result = ExecuteAndTransfer(std::move(module), {&literal});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result,\n+                          Execute(std::move(module), {&literal}));\n   LiteralTestUtil::ExpectR0Near<float>(42.0f, result, ErrorSpec{0.0001});\n }\n \n@@ -203,7 +204,7 @@ TEST_F(CopyOpTest, CopyConstantR2Twice) {\n \n   auto module = CreateNewVerifiedModule();\n   module->AddEntryComputation(std::move(computation));\n-  Literal result = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {}));\n   LiteralTestUtil::ExpectR2Near<float>({{1.0, 2.0}, {3.0, 4.0}}, result,\n                                        ErrorSpec{0.0001});\n }\n@@ -229,7 +230,7 @@ TEST_F(CopyOpTest, CopyConstantR2DifferentLayouts) {\n \n   auto module = CreateNewVerifiedModule();\n   module->AddEntryComputation(std::move(computation));\n-  Literal result = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {}));\n \n   // The result of the computation has the default layout, which is the inverse\n   // of the layout of the source literal.\n@@ -262,7 +263,7 @@ void CopyOpTest::TestCopyConstantLayout021(size_t n1, size_t n2, size_t n3) {\n   auto module = CreateNewVerifiedModule();\n   module->AddEntryComputation(std::move(computation));\n   ForceResultLayout(module.get(), LayoutUtil::MakeLayout({1, 2, 0}));\n-  Literal result = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {}));\n \n   LiteralTestUtil::ExpectR3EqualArray3D(a, result);\n }\n@@ -296,7 +297,7 @@ void CopyOpTest::TestCopyConstantLayoutR4(\n   auto module = CreateNewVerifiedModule();\n   module->AddEntryComputation(std::move(computation));\n   ForceResultLayout(module.get(), LayoutUtil::MakeLayout(permutation));\n-  Literal result = ExecuteAndTransfer(std::move(module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {}));\n \n   LiteralTestUtil::ExpectR4EqualArray4D(a, result);\n }"
        },
        {
            "sha": "5e41066abf30cd01201eaafec2b778e40e0d27ac",
            "filename": "third_party/xla/xla/tests/cpu_gpu_fusion_test.cc",
            "status": "modified",
            "additions": 77,
            "deletions": 48,
            "changes": 125,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fcpu_gpu_fusion_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fcpu_gpu_fusion_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fcpu_gpu_fusion_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -55,6 +55,7 @@ limitations under the License.\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n #include \"xla/tsl/platform/env.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n #include \"xla/tsl/platform/test.h\"\n #include \"xla/tsl/platform/test_benchmark.h\"\n #include \"xla/tsl/platform/threadpool.h\"\n@@ -140,7 +141,7 @@ class CpuGpuFusionTest : public HloTestBase {\n             HloInstruction::FusionKind::kLoop);\n \n     auto expected = LiteralUtil::CreateR2FromArray2D(answer_data);\n-    auto actual = ExecuteAndTransfer(std::move(hlo_module), {});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal actual, Execute(std::move(hlo_module), {}));\n     if (primitive_util::IsFloatingPointType(prim_type)) {\n       EXPECT_TRUE(LiteralTestUtil::Near(expected, actual, ErrorSpec(1e-4)));\n     } else {\n@@ -249,9 +250,10 @@ TEST_F(CpuGpuFusionTest, Test) {\n            const4, reshape3, add2, const1, const0},\n           HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Near(\n-      LiteralUtil::CreateR2<float>({{0.5}, {2.72}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {}), ErrorSpec(1e-4)));\n+      LiteralUtil::CreateR2<float>({{0.5}, {2.72}}), result, ErrorSpec(1e-4)));\n }\n \n // Test whether we emit appropriate code for parameters of fusion instructions.\n@@ -275,9 +277,11 @@ TEST_F(CpuGpuFusionTest, Parameter) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{add3, const2},\n                                 HloInstruction::FusionKind::kLoop);\n \n-  EXPECT_TRUE(LiteralTestUtil::Near(\n-      LiteralUtil::CreateR2<float>({{-1.0, 0.0, 1.0}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {}), ErrorSpec(1e-4)));\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n+  EXPECT_TRUE(\n+      LiteralTestUtil::Near(LiteralUtil::CreateR2<float>({{-1.0, 0.0, 1.0}}),\n+                            result, ErrorSpec(1e-4)));\n }\n \n TEST_F(CpuGpuFusionTest, RandomizedParallelPartition) {\n@@ -307,7 +311,8 @@ TEST_F(CpuGpuFusionTest, RandomizedParallelPartition) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{y, x, two},\n                                 HloInstruction::FusionKind::kLoop);\n   // Compute result.\n-  auto result = ExecuteAndTransfer(std::move(hlo_module), {});\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   // Every element of result should be y = x^2 = 4.0.\n   for (int i = 0; i < rand_dim0_size; ++i) {\n     for (int j = 0; j < dim1_size; ++j) {\n@@ -335,9 +340,11 @@ TEST_F(CpuGpuFusionTest, BroadcastIntoBinaryOp) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{add2, broadcast},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Near(\n       LiteralUtil::CreateR2<float>({{0.0, 0.0, -1.0}, {11.0, 22.0, 33.0}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {}), ErrorSpec(1e-4)));\n+      result, ErrorSpec(1e-4)));\n }\n \n TEST_F(CpuGpuFusionTest, ReshapeToScalar) {\n@@ -350,9 +357,10 @@ TEST_F(CpuGpuFusionTest, ReshapeToScalar) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(5),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(5), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape_3by2_1by2by3) {\n@@ -365,9 +373,10 @@ TEST_F(CpuGpuFusionTest, Reshape_3by2_1by2by3) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR3<int32_t>({{{1, 2, 3}, {4, 5, 6}}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR3<int32_t>({{{1, 2, 3}, {4, 5, 6}}}), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape_1by2by3_3by2) {\n@@ -380,9 +389,10 @@ TEST_F(CpuGpuFusionTest, Reshape_1by2by3_3by2) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR2<int32_t>({{1, 2}, {3, 4}, {5, 6}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR2<int32_t>({{1, 2}, {3, 4}, {5, 6}}), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape_1by1by1_) {\n@@ -395,9 +405,10 @@ TEST_F(CpuGpuFusionTest, Reshape_1by1by1_) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(7),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(7), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape__1by1by1) {\n@@ -410,9 +421,10 @@ TEST_F(CpuGpuFusionTest, Reshape__1by1by1) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR3<int32_t>({{{7}}}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR3<int32_t>({{{7}}}), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape__) {\n@@ -425,9 +437,10 @@ TEST_F(CpuGpuFusionTest, Reshape__) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(7),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(7), result));\n }\n \n TEST_F(CpuGpuFusionTest, Reshape_3by3_3by3) {\n@@ -440,9 +453,11 @@ TEST_F(CpuGpuFusionTest, Reshape_3by3_3by3) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n       LiteralUtil::CreateR2<int32_t>({{1, 2, 3}, {4, 5, 6}, {7, 8, 9}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      result));\n }\n \n TEST_F(CpuGpuFusionTest, Transpose_2by3) {\n@@ -455,9 +470,10 @@ TEST_F(CpuGpuFusionTest, Transpose_2by3) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR2<int32_t>({{1, 4}, {2, 5}, {3, 6}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR2<int32_t>({{1, 4}, {2, 5}, {3, 6}}), result));\n }\n \n TEST_F(CpuGpuFusionTest, Transpose_3by3) {\n@@ -470,9 +486,11 @@ TEST_F(CpuGpuFusionTest, Transpose_3by3) {\n   hlo_module->AddEntryComputation(builder.Build())\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n       LiteralUtil::CreateR2<int32_t>({{1, 4, 7}, {2, 5, 8}, {3, 6, 9}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      result));\n }\n \n TEST_F(CpuGpuFusionTest, Reverse) {\n@@ -486,9 +504,10 @@ TEST_F(CpuGpuFusionTest, Reverse) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reverse1},\n                                 HloInstruction::FusionKind::kLoop);\n \n-  EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({3, 2, 1}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n+  EXPECT_TRUE(LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({3, 2, 1}),\n+                                     result));\n }\n \n TEST_F(CpuGpuFusionTest, ReverseNegate) {\n@@ -504,9 +523,10 @@ TEST_F(CpuGpuFusionTest, ReverseNegate) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate2, reverse1},\n                                 HloInstruction::FusionKind::kLoop);\n \n-  EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-3, -2, -1}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n+  EXPECT_TRUE(LiteralTestUtil::Equal(\n+      LiteralUtil::CreateR1<int32_t>({-3, -2, -1}), result));\n }\n \n TEST_F(CpuGpuFusionTest, BroadcastNegate) {\n@@ -522,9 +542,10 @@ TEST_F(CpuGpuFusionTest, BroadcastNegate) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate2, broadcast1},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-1, -1}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-1, -1}), result));\n }\n \n TEST_F(CpuGpuFusionTest, SliceNegate) {\n@@ -540,9 +561,10 @@ TEST_F(CpuGpuFusionTest, SliceNegate) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate2, slice1},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-1, -3}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-1, -3}), result));\n }\n \n TEST_F(CpuGpuFusionTest, DynamicSliceNegate) {\n@@ -562,9 +584,10 @@ TEST_F(CpuGpuFusionTest, DynamicSliceNegate) {\n           /*instructions_to_fuse=*/{negate3, dynamic_slice2},\n           HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-2, -3}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({-2, -3}), result));\n }\n \n TEST_F(CpuGpuFusionTest, ReshapeNegate) {\n@@ -580,9 +603,10 @@ TEST_F(CpuGpuFusionTest, ReshapeNegate) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate2, reshape1},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR2<int32_t>({{-1, -2}, {-3, -4}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR2<int32_t>({{-1, -2}, {-3, -4}}), result));\n }\n \n TEST_F(CpuGpuFusionTest, TransposeNegate) {\n@@ -598,9 +622,10 @@ TEST_F(CpuGpuFusionTest, TransposeNegate) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate2, transpose1},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR2<int32_t>({{-1, -3}, {-2, -4}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR2<int32_t>({{-1, -3}, {-2, -4}}), result));\n }\n \n std::unique_ptr<HloComputation> MakeReduceTestComputation() {\n@@ -631,9 +656,10 @@ TEST_F(CpuGpuFusionTest, Reduce) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reduce2},\n                                 HloInstruction::FusionKind::kInput);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(496),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(496), result));\n }\n \n TEST_F(CpuGpuFusionTest, ReduceImplicitBroadcast) {\n@@ -653,9 +679,10 @@ TEST_F(CpuGpuFusionTest, ReduceImplicitBroadcast) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{negate3, reduce2},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(-15),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR0<int32_t>(-15), result));\n }\n \n TEST_F(CpuGpuFusionTest, ReduceWindow) {\n@@ -706,9 +733,10 @@ TEST_F(CpuGpuFusionTest, ReduceWindow) {\n       ->CreateFusionInstruction(/*instructions_to_fuse=*/{reduce_window2},\n                                 HloInstruction::FusionKind::kLoop);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n-      LiteralUtil::CreateR2<int32_t>({{462, 2145}, {24871, 62491}}),\n-      ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralUtil::CreateR2<int32_t>({{462, 2145}, {24871, 62491}}), result));\n }\n \n // When a constant (or other op) which has multiple users is imported\n@@ -742,9 +770,10 @@ TEST_F(CpuGpuFusionTest, SharedConstant) {\n   // fused instruction contains the constant(2), the parameter, and 4 adds\n   EXPECT_EQ(entry_comp->root_instruction()->fused_instruction_count(), 6);\n \n+  TF_ASSERT_OK_AND_ASSIGN(const Literal result,\n+                          Execute(std::move(hlo_module), {}));\n   EXPECT_TRUE(\n-      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({8}),\n-                             ExecuteAndTransfer(std::move(hlo_module), {})));\n+      LiteralTestUtil::Equal(LiteralUtil::CreateR1<int32_t>({8}), result));\n }\n \n // Test that fusion can handle elementwise ops with more than one user. This"
        },
        {
            "sha": "7b04315cc624a49198e4bba0b6976e78b84e28f9",
            "filename": "third_party/xla/xla/tests/multioutput_fusion_test.cc",
            "status": "modified",
            "additions": 19,
            "deletions": 20,
            "changes": 39,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fmultioutput_fusion_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -13,34 +13,29 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include <math.h>\n-\n-#include <algorithm>\n+#include <cstdint>\n #include <memory>\n-#include <new>\n+#include <string>\n #include <utility>\n \n #include \"xla/tests/xla_test_backend_predicates.h\"\n+#include \"absl/log/check.h\"\n #include \"absl/strings/str_cat.h\"\n #include \"absl/types/span.h\"\n-#include \"xla/client/local_client.h\"\n+#include \"xla/error_spec.h\"\n #include \"xla/hlo/ir/hlo_computation.h\"\n #include \"xla/hlo/ir/hlo_instruction.h\"\n-#include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/hlo/ir/hlo_opcode.h\"\n #include \"xla/literal.h\"\n-#include \"xla/primitive_util.h\"\n-#include \"xla/service/hlo_runner.h\"\n+#include \"xla/literal_util.h\"\n+#include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n-#include \"xla/tests/client_library_test_base.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n-#include \"xla/tests/test_utils.h\"\n-#include \"xla/tsl/lib/core/status_test_util.h\"\n+#include \"xla/tsl/platform/status.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n+#include \"xla/tsl/platform/test.h\"\n #include \"xla/xla_data.pb.h\"\n-#include \"tsl/platform/protobuf.h\"\n-#include \"tsl/platform/test.h\"\n-#include \"tsl/platform/test_benchmark.h\"\n \n namespace xla {\n namespace {\n@@ -113,8 +108,8 @@ class MultiOutputFusionTest : public HloTestBase {\n     Literal expect(ShapeUtil::MakeShapeWithDescendingLayout(F32, {size, size}));\n     expect.PopulateWithValue<float>(size * 1.5f * 3.5f);\n     Literal literal_r0 = LiteralUtil::CreateR0<float>(-9.0f);\n-    auto actual =\n-        ExecuteAndTransfer(std::move(hlo_module), {&literal_r0, &arg1});\n+    TF_ASSERT_OK_AND_ASSIGN(\n+        Literal actual, Execute(std::move(hlo_module), {&literal_r0, &arg1}));\n     EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, error_spec_));\n   }\n \n@@ -177,7 +172,8 @@ class MultiOutputFusionTest : public HloTestBase {\n     input1.PopulateWithValue(1.);\n \n     Literal expect = LiteralUtil::CreateR1<float>({size * 1.5f * 3.5f});\n-    auto actual = ExecuteAndTransfer(std::move(hlo_module), {&input0, &input1});\n+    TF_ASSERT_OK_AND_ASSIGN(Literal actual,\n+                            Execute(std::move(hlo_module), {&input0, &input1}));\n     EXPECT_TRUE(LiteralTestUtil::Near(expect, actual, error_spec_));\n   }\n };\n@@ -209,7 +205,8 @@ TEST_F(MultiOutputFusionTest, MultiOutputLoopFusion) {\n     })\";\n   auto module = ParseAndReturnVerifiedModule(testcase).value();\n   auto param = LiteralUtil::CreateR1<float>({1.0, 2.0, 3.0, -1.0});\n-  Literal result = ExecuteNoHloPasses(std::move(module), {&param});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&param},\n+                                                  /*run_hlo_passes=*/false));\n   LiteralTestUtil::ExpectR1Equal<float>({0.0, 4.0, 9.0, 1.0}, result);\n }\n \n@@ -236,7 +233,8 @@ TEST_F(MultiOutputFusionTest, MultiOutputLoopFusionBitcastCompatibleShapes) {\n     })\";\n   auto module = ParseAndReturnVerifiedModule(testcase).value();\n   auto param = LiteralUtil::CreateR1<float>({1.0, 2.0, 3.0, -1.0});\n-  Literal result = ExecuteNoHloPasses(std::move(module), {&param});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&param},\n+                                                  /*run_hlo_passes=*/false));\n   LiteralTestUtil::ExpectR1Equal<float>({0.0, 4.0, 9.0, 1.0}, result);\n }\n \n@@ -269,7 +267,8 @@ TEST_F(MultiOutputFusionTest, MultiOutputLoopFeedingMap) {\n     })\";\n   auto module = ParseAndReturnVerifiedModule(testcase).value();\n   auto param = LiteralUtil::CreateR1<float>({1.0, 2.0, 3.0});\n-  Literal result = ExecuteNoHloPasses(std::move(module), {&param});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&param},\n+                                                  /*run_hlo_passes=*/false));\n   LiteralTestUtil::ExpectR1Equal<float>({0.0, 4.0, 9.0}, result);\n }\n "
        },
        {
            "sha": "c67521f2349e0247d28441e4f72378bc9d1d57cd",
            "filename": "third_party/xla/xla/tests/scatter_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Fscatter_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -179,7 +179,8 @@ ENTRY main {\n   config.set_debug_options(GetDebugOptionsForTest());\n   TF_ASSERT_OK_AND_ASSIGN(std::unique_ptr<HloModule> module,\n                           ParseAndReturnVerifiedModule(hlo_text, config));\n-  auto actual = ExecuteAndTransfer(std::move(module), {&permutation});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal actual,\n+                          Execute(std::move(module), {&permutation}));\n   Literal expected = LiteralUtil::CreateR2<int32_t>(\n       {{3, 0, 2, 1}, {1, 3, 2, 0}, {3, 2, 0, 1}});\n   EXPECT_TRUE(LiteralTestUtil::Equal(expected, actual));"
        },
        {
            "sha": "b9736b6cf20a0556185231e94856ee7c38cd206f",
            "filename": "third_party/xla/xla/tests/token_hlo_test.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 8,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Ftoken_hlo_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Ftoken_hlo_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Ftoken_hlo_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -26,9 +26,8 @@ limitations under the License.\n #include \"xla/service/hlo_module_util.h\"\n #include \"xla/tests/hlo_test_base.h\"\n #include \"xla/tests/literal_test_util.h\"\n-#include \"xla/tests/test_utils.h\"\n-#include \"tsl/platform/statusor.h\"\n-#include \"tsl/platform/test.h\"\n+#include \"xla/tsl/platform/statusor.h\"\n+#include \"xla/tsl/platform/test.h\"\n \n namespace xla {\n namespace {\n@@ -191,7 +190,9 @@ ENTRY %AddDependency (p0: f32[], p1: f32[]) -> f32[] {\n   auto p0 = LiteralUtil::CreateR0<float>(10.0);\n   auto p1 = LiteralUtil::CreateR0<float>(3.0);\n   auto expected = LiteralUtil::CreateR0<float>(-156.0);\n-  EXPECT_EQ(expected, ExecuteNoHloPasses(std::move(module), {&p0, &p1}));\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&p0, &p1},\n+                                                  /*run_hlo_passes=*/false));\n+  EXPECT_EQ(result, expected);\n }\n \n TEST_F(TokenHloTest, AddDependencyOfOperation) {\n@@ -221,7 +222,9 @@ ENTRY %AddDependency (p0: f32[], p1: f32[]) -> f32[] {\n   auto p0 = LiteralUtil::CreateR0<float>(10.0);\n   auto p1 = LiteralUtil::CreateR0<float>(3.0);\n   auto expected = LiteralUtil::CreateR0<float>(2184.0);\n-  EXPECT_EQ(expected, ExecuteNoHloPasses(std::move(module), {&p0, &p1}));\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&p0, &p1},\n+                                                  /*run_hlo_passes=*/false));\n+  EXPECT_EQ(result, expected);\n }\n \n TEST_F(TokenHloTest, AddDependencyOfConstant) {\n@@ -241,7 +244,9 @@ ENTRY %AddDependency (p0: f32[]) -> f32[] {\n       ParseAndReturnVerifiedModule(module_string, GetModuleConfigForTest()));\n   auto p0 = LiteralUtil::CreateR0<float>(10.0);\n   auto expected = LiteralUtil::CreateR0<float>(420.0);\n-  EXPECT_EQ(expected, ExecuteNoHloPasses(std::move(module), {&p0}));\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&p0},\n+                                                  /*run_hlo_passes=*/false));\n+  EXPECT_EQ(result, expected);\n }\n \n TEST_F(TokenHloTest, AddDependencyAsRoot) {\n@@ -259,7 +264,9 @@ ENTRY %AddDependency (p: f32[3]) -> f32[3] {\n       ParseAndReturnVerifiedModule(module_string, GetModuleConfigForTest()));\n   auto input = LiteralUtil::CreateR1<float>({1.0, 3.0, 7.0});\n   auto expected = LiteralUtil::CreateR1<float>({-1.0, -3.0, -7.0});\n-  EXPECT_EQ(expected, ExecuteNoHloPasses(std::move(module), {&input}));\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&input},\n+                                                  /*run_hlo_passes=*/false));\n+  EXPECT_EQ(result, expected);\n }\n \n TEST_F(TokenHloTest, TupleShapedAddDependency) {\n@@ -283,7 +290,9 @@ ENTRY %TupleShapedAddDependency (p0: f32[3], p1: f32[3]) -> f32[3] {\n   auto p0 = LiteralUtil::CreateR1<float>({3.0, 3.0, 47.0});\n   auto p1 = LiteralUtil::CreateR1<float>({1.0, -2.0, 2.0});\n   auto expected = LiteralUtil::CreateR1<float>({2.0, 5.0, 45.0});\n-  EXPECT_EQ(expected, ExecuteNoHloPasses(std::move(module), {&p0, &p1}));\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&p0, &p1},\n+                                                  /*run_hlo_passes=*/false));\n+  EXPECT_EQ(result, expected);\n }\n \n }  // namespace"
        },
        {
            "sha": "10065aecfd242f67e0c491114a2f014f30985797",
            "filename": "third_party/xla/xla/tests/tuple_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Ftuple_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff6910277bfcdd4ef610ac34d1258785048b8440/third_party%2Fxla%2Fxla%2Ftests%2Ftuple_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftests%2Ftuple_test.cc?ref=ff6910277bfcdd4ef610ac34d1258785048b8440",
            "patch": "@@ -379,7 +379,8 @@ TEST_F(TupleHloTest, BitcastAfterGTE) {\n   auto module = ParseAndReturnVerifiedModule(testcase).value();\n   auto param =\n       LiteralUtil::MakeTupleOwned(LiteralUtil::CreateR1<float>({1, 2, 3}));\n-  auto result = ExecuteNoHloPasses(std::move(module), {&param});\n+  TF_ASSERT_OK_AND_ASSIGN(Literal result, Execute(std::move(module), {&param},\n+                                                  /*run_hlo_passes=*/false));\n   EXPECT_TRUE(LiteralTestUtil::Equal(\n       LiteralUtil::MakeTupleOwned(LiteralUtil::CreateR2<float>({{1, 2, 3}})),\n       result));"
        }
    ],
    "stats": {
        "total": 565,
        "additions": 345,
        "deletions": 220
    }
}