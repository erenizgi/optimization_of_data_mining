{
    "author": "pifon2a",
    "message": "[XLA] Move xla.GpuTopology proto out of PJRT to XLA.\n\nIt has to become a part of Compiler::CompilerOptions, but CompilerOptions should not depend on PJRT. So, moving it here.\n\nPiperOrigin-RevId: 848523186",
    "sha": "8e84202c4e53eb575077d5726c6c42c099999391",
    "files": [
        {
            "sha": "ed5ab0149ecbeecde18e5598d7acba5cbfd81e86",
            "filename": "tensorflow/core/common_runtime/eager/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -272,7 +272,7 @@ tf_cuda_library(\n                 \"//tensorflow/core/framework:resource_base\",\n                 \"@local_xla//xla/pjrt/distributed:key_value_store_interface\",\n                 \"@local_xla//xla/pjrt:local_device_state\",\n-                \"@local_xla//xla/pjrt/gpu:gpu_topology\",\n+                \"@local_xla//xla/service:gpu_topology\",\n                 \"@local_xla//xla/pjrt:pjrt_client\",\n                 \"@local_xla//xla/pjrt:pjrt_compiler\",\n                 \"@local_xla//xla/service/gpu:gpu_executable_run_options\","
        },
        {
            "sha": "8725479fb891da333c788cc05a92c3215d0991f0",
            "filename": "tensorflow/core/common_runtime/eager/context_distributed_manager.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2Fcontext_distributed_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2Fcontext_distributed_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fcommon_runtime%2Feager%2Fcontext_distributed_manager.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -80,11 +80,11 @@ limitations under the License.\n #if (defined(PLATFORM_GOOGLE) && defined(TF_PLATFORM_LINUX_X86_64))\n #define TF_GPU_USE_PJRT\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/gpu/se_gpu_pjrt_client.h\"\n #include \"xla/pjrt/local_device_state.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"tensorflow/core/framework/resource_base.h\"\n #include \"tensorflow/core/framework/resource_mgr.h\"\n #include \"tensorflow/core/tfrt/common/global_state.h\""
        },
        {
            "sha": "a799192970ef2523013a0cfb1786b2468efa42c8",
            "filename": "third_party/xla/xla/pjrt/c/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -454,7 +454,6 @@ cc_library(\n         \"//xla/pjrt:pjrt_executable\",\n         \"//xla/pjrt/extensions/cross_host_transfers:pjrt_c_api_cross_host_transfer_extension\",\n         \"//xla/pjrt/gpu:gpu_helpers\",\n-        \"//xla/pjrt/gpu:gpu_topology\",\n         \"//xla/pjrt/gpu:se_gpu_pjrt_client\",\n         \"//xla/pjrt/gpu:se_gpu_pjrt_compiler\",  # buildcleaner: keep to register GPU AOT compiler\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_pjrt_client\",\n@@ -464,6 +463,7 @@ cc_library(\n         \"//xla/python:inspect_sharding\",  # To register \"InspectSharding\" custom partitioning handler.\n         \"//xla/service:compiler\",\n         \"//xla/service:custom_call_target_registry\",\n+        \"//xla/service:gpu_topology\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n         \"@com_google_absl//absl/status\",\n         \"@com_google_absl//absl/strings:str_format\","
        },
        {
            "sha": "3575515a78fa6c1ffe2eceee7fa5770091e3472f",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_gpu_internal.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_internal.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_internal.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_internal.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -46,7 +46,6 @@ limitations under the License.\n #include \"xla/pjrt/c/pjrt_c_api_wrapper_impl.h\"\n #include \"xla/pjrt/extensions/cross_host_transfers/pjrt_c_api_cross_host_transfers_extension.h\"\n #include \"xla/pjrt/gpu/gpu_helpers.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/gpu/se_gpu_pjrt_client.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n@@ -58,6 +57,7 @@ limitations under the License.\n #include \"xla/python/custom_partition_callback.h\"\n #include \"xla/service/compiler.h\"\n #include \"xla/service/custom_call_target_registry.h\"\n+#include \"xla/service/gpu_topology.h\"\n \n #if GOOGLE_CUDA\n #include \"third_party/gpus/cuda/include/cuda_runtime_api.h\""
        },
        {
            "sha": "0795d46b0e4bd6a2f5d4372250b3b30c2cb9f800",
            "filename": "third_party/xla/xla/pjrt/distributed/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -115,7 +115,7 @@ cc_library(\n         \":protocol_proto_cc\",\n         \"//xla:util\",\n         \"//xla/pjrt:utils\",\n-        \"//xla/pjrt/gpu:gpu_topology_proto_cc\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\","
        },
        {
            "sha": "16b3b3f9605643d3cc26cd63ebfd374a496a3b31",
            "filename": "third_party/xla/xla/pjrt/distributed/topology_util.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -38,8 +38,8 @@ limitations under the License.\n #include \"absl/types/span.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/utils.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/tsl/platform/env.h\"\n #include \"xla/tsl/platform/errors.h\"\n #include \"xla/tsl/platform/statusor.h\""
        },
        {
            "sha": "d586137712cad1d4c5d97aed10b6478468ec1e6a",
            "filename": "third_party/xla/xla/pjrt/distributed/topology_util.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fdistributed%2Ftopology_util.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -25,7 +25,7 @@ limitations under the License.\n #include \"absl/types/span.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n \n namespace xla {\n "
        },
        {
            "sha": "61a60fe1070437891ccb25d2ab14a163eb89b4ee",
            "filename": "third_party/xla/xla/pjrt/gpu/BUILD",
            "status": "modified",
            "additions": 9,
            "deletions": 30,
            "changes": 39,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -5,7 +5,6 @@ load(\"//xla/pjrt/gpu:package_groups.bzl\", \"xla_gpu_internal_packages\")\n load(\"//xla/stream_executor:build_defs.bzl\", \"if_cuda_or_rocm\")\n load(\"//xla/tests:build_defs.bzl\", \"xla_test\")\n load(\"//xla/tsl:tsl.bzl\", \"if_google\", \"internal_visibility\")\n-load(\"//xla/tsl/platform:build_config.bzl\", \"tf_proto_library\")\n load(\"//xla/tsl/platform:rules_cc.bzl\", \"cc_library\")\n \n # Integrate with PJRT rather than the GPU client directly.\n@@ -56,8 +55,6 @@ cc_library(\n     deps = [\n         \":gpu_helpers\",\n         \":gpu_metrics\",\n-        \":gpu_topology\",\n-        \":gpu_topology_proto_cc\",\n         \":se_gpu_topology_description\",\n         \"//xla:executable_run_options\",\n         \"//xla:future\",\n@@ -112,6 +109,8 @@ cc_library(\n         \"//xla/service:compiler\",\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/service:executable\",\n+        \"//xla/service:gpu_topology\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/service:platform_util\",\n         \"//xla/service:shaped_buffer\",\n         \"//xla/service:transfer_manager\",\n@@ -204,8 +203,6 @@ xla_test(\n     backends = [\"gpu\"],\n     tags = [\"nofixdeps\"],\n     deps = [\n-        \":gpu_topology\",\n-        \":gpu_topology_proto_cc\",\n         \":se_gpu_pjrt_client\",\n         \":se_gpu_topology_description\",\n         \"//xla:debug_options_flags\",\n@@ -243,6 +240,8 @@ xla_test(\n         \"//xla/pjrt/profiling:device_time_measurement\",\n         \"//xla/pjrt/profiling/test_util:mock_device_time_measurement\",\n         \"//xla/pjrt/proto:compile_options_proto_cc\",\n+        \"//xla/service:gpu_topology\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/service:platform_util\",\n         \"//xla/service/gpu:gpu_memory_space_assignment\",\n         \"//xla/stream_executor:device_address\",\n@@ -377,7 +376,6 @@ xla_test(\n         \"XLA_FLAGS\": \"--xla_gpu_experimental_enable_nvshmem=true\",\n     },\n     deps = [\n-        \":gpu_topology_proto_cc\",\n         \":se_gpu_pjrt_client\",\n         \"//xla:shape_util\",\n         \"//xla:util\",\n@@ -399,6 +397,7 @@ xla_test(\n         \"//xla/pjrt/distributed:in_memory_key_value_store\",\n         \"//xla/pjrt/distributed:service\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_client_options\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/service:platform_util\",\n         \"//xla/tests:literal_test_util\",\n         \"//xla/tsl/lib/core:status_test_util\",\n@@ -431,26 +430,6 @@ xla_test(\n     ],\n )\n \n-tf_proto_library(\n-    name = \"gpu_topology_proto\",\n-    srcs = [\"gpu_topology.proto\"],\n-    visibility = [\"//visibility:public\"],\n-)\n-\n-cc_library(\n-    name = \"gpu_topology\",\n-    srcs = [\"gpu_topology.cc\"],\n-    hdrs = [\"gpu_topology.h\"],\n-    visibility = internal_visibility([\n-        \"//xla/pjrt/gpu:legacy_gpu_topology_users\",\n-        \":__subpackages__\",\n-    ]),\n-    deps = [\n-        \":gpu_topology_proto_cc\",\n-        \"@com_google_absl//absl/strings:string_view\",\n-    ],\n-)\n-\n cc_library(\n     name = \"se_gpu_pjrt_compiler_impl\",\n     srcs = [\"se_gpu_pjrt_compiler.cc\"],\n@@ -566,7 +545,6 @@ xla_test(\n     srcs = [\"se_gpu_pjrt_compiler_test.cc\"],\n     backends = [\"gpu\"],\n     deps = [\n-        \":gpu_topology\",\n         \":se_gpu_pjrt_client\",\n         \":se_gpu_pjrt_compiler_impl\",\n         \":se_gpu_topology_description\",\n@@ -580,6 +558,7 @@ xla_test(\n         \"//xla/pjrt:pjrt_compiler\",\n         \"//xla/pjrt:pjrt_executable\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_client_options\",\n+        \"//xla/service:gpu_topology\",\n         \"//xla/tests:literal_test_util\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_absl//absl/status\",\n@@ -636,8 +615,6 @@ cc_library(\n         \":__subpackages__\",\n     ]),\n     deps = [\n-        \":gpu_topology\",\n-        \":gpu_topology_proto_cc\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/pjrt:pjrt_common\",\n@@ -646,6 +623,8 @@ cc_library(\n         \"//xla/pjrt:pjrt_device_dimensions\",\n         \"//xla/pjrt:pjrt_stream_executor_device_description\",\n         \"//xla/pjrt/proto:topology_description_proto_cc\",\n+        \"//xla/service:gpu_topology\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/stream_executor:device_description_proto_cc\",\n         \"//xla/tsl/lib/strings:proto_serialization\",\n         \"@com_google_absl//absl/container:flat_hash_map\",\n@@ -664,13 +643,13 @@ xla_cc_test(\n     name = \"se_gpu_topology_description_test\",\n     srcs = [\"se_gpu_topology_description_test.cc\"],\n     deps = [\n-        \":gpu_topology\",\n         \":se_gpu_topology_description\",\n         \"//xla/pjrt:pjrt_common\",\n         \"//xla/pjrt:pjrt_compiler\",\n         \"//xla/pjrt:pjrt_device_description\",\n         \"//xla/pjrt:pjrt_device_dimensions\",\n         \"//xla/pjrt:pjrt_stream_executor_device_description\",\n+        \"//xla/service:gpu_topology\",\n         \"//xla/tsl/platform:statusor\",\n         \"@com_google_googletest//:gtest_main\",\n     ],"
        },
        {
            "sha": "b97b44146533e88de3cb8419e5d328a79cef97a5",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -73,8 +73,6 @@ limitations under the License.\n #include \"xla/pjrt/distributed/topology_util.h\"\n #include \"xla/pjrt/event_pool.h\"\n #include \"xla/pjrt/gpu/gpu_helpers.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/host_memory_allocator.h\"\n #include \"xla/pjrt/host_memory_spaces.h\"\n@@ -96,6 +94,8 @@ limitations under the License.\n #include \"xla/service/compiler.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/gpu/gpu_memory_space_assignment.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\"\n #include \"xla/shape.h\""
        },
        {
            "sha": "2e36a66365d7e760c14ddf2d4f343beab94dd963",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -42,8 +42,6 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/pjrt/distributed/client.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/host_memory_allocator.h\"\n #include \"xla/pjrt/local_device_state.h\"\n@@ -57,6 +55,8 @@ limitations under the License.\n #include \"xla/runtime/device_id.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_tree.h\"\n #include \"xla/stream_executor/device_address_allocator.h\""
        },
        {
            "sha": "1c171fc070861f8f2b1b2a1fe560cfd99e19893e",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client_nvshmem_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_nvshmem_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_nvshmem_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_nvshmem_test.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -39,13 +39,13 @@ limitations under the License.\n #include \"xla/pjrt/distributed/distributed.h\"\n #include \"xla/pjrt/distributed/in_memory_key_value_store.h\"\n #include \"xla/pjrt/distributed/service.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/se_gpu_pjrt_client.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/plugin/xla_gpu/xla_gpu_client_options.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/platform_util.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\""
        },
        {
            "sha": "f995e57d579cd67c493f1771955b58c6e4025c2e",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_client_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_client_test.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -69,8 +69,6 @@ limitations under the License.\n #include \"xla/pjrt/distributed/distributed.h\"\n #include \"xla/pjrt/distributed/in_memory_key_value_store.h\"\n #include \"xla/pjrt/distributed/service.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/host_memory_spaces.h\"\n #include \"xla/pjrt/local_device_state.h\"\n@@ -87,6 +85,8 @@ limitations under the License.\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/service/gpu/gpu_memory_space_assignment.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/platform_util.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\""
        },
        {
            "sha": "ba467b0c8be09f624bff52f3a1f837a91ac313af",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_pjrt_compiler_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_compiler_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_compiler_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_pjrt_compiler_test.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -36,13 +36,13 @@ limitations under the License.\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/mlir_hlo/mhlo/IR/hlo_ops.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/gpu/se_gpu_pjrt_client.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/plugin/xla_gpu/xla_gpu_client_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"xla/tests/literal_test_util.h\"\n #include \"xla/tsl/platform/statusor.h\"\n "
        },
        {
            "sha": "a966082b434edcd0e7395763e884e0ea356eec51",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_topology_description.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -27,15 +27,15 @@ limitations under the License.\n #include \"absl/types/span.h\"\n #include \"xla/layout.h\"\n #include \"xla/layout_util.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_device_dimensions.h\"\n #include \"xla/pjrt/pjrt_stream_executor_device_description.h\"\n #include \"xla/pjrt/proto/topology_description.pb.h\"\n #include \"xla/primitive_util.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/tsl/lib/strings/proto_serialization.h\""
        },
        {
            "sha": "7e8a340ff4ad31a99f9eef8a4b2313d492d61d81",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_topology_description.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -24,13 +24,13 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_device_dimensions.h\"\n #include \"xla/pjrt/pjrt_stream_executor_device_description.h\"\n #include \"xla/pjrt/proto/topology_description.pb.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"xla/stream_executor/device_description.pb.h\"\n #include \"xla/xla_data.pb.h\"\n "
        },
        {
            "sha": "3e6b300947fc737b6d2ff66ff3733e5e2c84e87f",
            "filename": "third_party/xla/xla/pjrt/gpu/se_gpu_topology_description_test.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Fse_gpu_topology_description_test.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -21,12 +21,12 @@ limitations under the License.\n \n #include <gmock/gmock.h>\n #include <gtest/gtest.h>\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_device_dimensions.h\"\n #include \"xla/pjrt/pjrt_stream_executor_device_description.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"xla/tsl/platform/statusor.h\"\n \n namespace xla {"
        },
        {
            "sha": "8f7af9cb74b53cee6799f73b09d50d6002dadc2d",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/BUILD",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -85,8 +85,6 @@ cc_library(\n         \"//xla/pjrt/distributed:topology_util\",\n         \"//xla/pjrt/dump\",\n         \"//xla/pjrt/gpu:gpu_helpers\",\n-        \"//xla/pjrt/gpu:gpu_topology\",\n-        \"//xla/pjrt/gpu:gpu_topology_proto_cc\",\n         \"//xla/pjrt/gpu:se_gpu_topology_description\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_allocator_config\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_client_options\",\n@@ -98,6 +96,8 @@ cc_library(\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/service:executable\",\n         \"//xla/service:generic_transfer_manager\",\n+        \"//xla/service:gpu_topology\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/service:hlo_cost_analysis\",\n         \"//xla/service:hlo_proto_cc\",\n         \"//xla/service:maybe_owning_device_address\",\n@@ -212,10 +212,10 @@ xla_test(\n         \"//xla/pjrt:pjrt_executable\",\n         \"//xla/pjrt:raw_buffer\",\n         \"//xla/pjrt/distributed:in_memory_key_value_store\",\n-        \"//xla/pjrt/gpu:gpu_topology\",\n-        \"//xla/pjrt/gpu:gpu_topology_proto_cc\",\n         \"//xla/pjrt/plugin/xla_gpu:xla_gpu_client_options\",\n         \"//xla/pjrt/proto:compile_options_proto_cc\",\n+        \"//xla/service:gpu_topology\",\n+        \"//xla/service:gpu_topology_proto_cc\",\n         \"//xla/service:platform_util\",\n         \"//xla/stream_executor:device_address\",\n         \"//xla/stream_executor:device_description\","
        },
        {
            "sha": "c15aa659676f74d8a6317b94c752ee9d87c60f19",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_async_host_to_device_transfer_manager.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -38,7 +38,6 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/literal.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_client.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_device.h\"\n@@ -49,6 +48,7 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\""
        },
        {
            "sha": "2f5cac56f62c933ed76f41fbabd1f959265b83b4",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_async_host_to_device_transfer_manager.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_async_host_to_device_transfer_manager.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -38,14 +38,14 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/literal.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_device.h\"\n #include \"xla/pjrt/gpu/tfrt/tracked_gpu_device_buffer.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/shape.h\"\n #include \"xla/stream_executor/device_description.pb.h\""
        },
        {
            "sha": "6bfc7a4f27967ffb708bb452478ff2edd0547e97",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_buffer.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_buffer.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_buffer.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_buffer.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -39,7 +39,6 @@ limitations under the License.\n #include \"xla/layout_util.h\"\n #include \"xla/literal.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_client.h\"\n #include \"xla/pjrt/gpu/tfrt/tracked_gpu_device_buffer.h\"\n@@ -52,6 +51,7 @@ limitations under the License.\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/primitive_util.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/shaped_buffer.h\"\n #include \"xla/service/transfer_manager.h\""
        },
        {
            "sha": "a80e288238ac2f7c443a5f1a90f367613849bb90",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_client.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -60,8 +60,6 @@ limitations under the License.\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n #include \"xla/pjrt/dump/dump.h\"\n #include \"xla/pjrt/gpu/gpu_helpers.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_async_host_to_device_transfer_manager.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_device.h\"\n@@ -87,6 +85,8 @@ limitations under the License.\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/executable.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/hlo_cost_analysis.h\"\n #include \"xla/service/shaped_buffer.h\""
        },
        {
            "sha": "55469f351f373b217b888e68ac390fbad2d7ca9b",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_client.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -46,7 +46,6 @@ limitations under the License.\n #include \"xla/literal.h\"\n #include \"xla/maybe_owning.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_buffer.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_device.h\"\n@@ -60,6 +59,7 @@ limitations under the License.\n #include \"xla/pjrt/transpose.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/hlo_cost_analysis.h\"\n #include \"xla/shape.h\""
        },
        {
            "sha": "ceeb56ce27b7ba5a873db02c4c3c54ec8ebb46d0",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_client_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_client_test.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -57,8 +57,6 @@ limitations under the License.\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/pjrt/distributed/in_memory_key_value_store.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_device.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_executable.h\"\n@@ -72,6 +70,8 @@ limitations under the License.\n #include \"xla/pjrt/plugin/xla_gpu/xla_gpu_client_options.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/platform_util.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\""
        },
        {
            "sha": "c915187600b2d999f6bbbdd6ba096c3e7a1e8466",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_device.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_device.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_device.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_device.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -41,7 +41,6 @@ limitations under the License.\n #include \"xla/executable_run_options.h\"\n #include \"xla/literal.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_client.h\"\n #include \"xla/pjrt/gpu/tfrt/utils.h\"\n@@ -52,6 +51,7 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_executable.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/pjrt/utils.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/transfer_manager.h\"\n #include \"xla/status_macros.h\""
        },
        {
            "sha": "839c1fe31ded3f75c419e5705b26e1f46f40c9d8",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/tfrt_gpu_executable.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Ftfrt_gpu_executable.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -48,7 +48,6 @@ limitations under the License.\n #include \"xla/hlo/ir/hlo_print_options.h\"\n #include \"xla/layout.h\"\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_client.h\"\n #include \"xla/pjrt/gpu/tfrt/tracked_gpu_device_buffer.h\"\n@@ -68,6 +67,7 @@ limitations under the License.\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/executable.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/maybe_owning_device_address.h\"\n #include \"xla/service/shaped_buffer.h\""
        },
        {
            "sha": "7c011e83558428f99fa23c20a759157f26cefd9a",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/utils.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -60,8 +60,6 @@ limitations under the License.\n #include \"xla/pjrt/distributed/protocol.pb.h\"\n #include \"xla/pjrt/distributed/topology_util.h\"\n #include \"xla/pjrt/gpu/gpu_helpers.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_client.h\"\n@@ -77,6 +75,8 @@ limitations under the License.\n #include \"xla/runtime/device_id.h\"\n #include \"xla/service/compiler.h\"\n #include \"xla/service/computation_placer.h\"\n+#include \"xla/service/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/service/transfer_manager.h\"\n #include \"xla/shape.h\""
        },
        {
            "sha": "21b1bdf4110fcdedd1864aea70494128d5466a6d",
            "filename": "third_party/xla/xla/pjrt/gpu/tfrt/utils.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fgpu%2Ftfrt%2Futils.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -38,7 +38,6 @@ limitations under the License.\n #include \"xla/layout.h\"\n #include \"xla/maybe_owning.h\"\n #include \"xla/pjrt/distributed/key_value_store_interface.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n #include \"xla/pjrt/gpu/se_gpu_topology_description.h\"\n #include \"xla/pjrt/gpu/tfrt/gpu_event.h\"\n #include \"xla/pjrt/gpu/tfrt/tfrt_gpu_buffer.h\"\n@@ -51,6 +50,7 @@ limitations under the License.\n #include \"xla/pjrt/plugin/xla_gpu/xla_gpu_client_options.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/gpu/gpu_executable_run_options.h\"\n+#include \"xla/service/gpu_topology.h\"\n #include \"xla/service/hlo.pb.h\"\n #include \"xla/shape.h\"\n #include \"xla/stream_executor/device_address_allocator.h\""
        },
        {
            "sha": "1fd795ebfb143aac7859a109e84a6d2e91fbdd1f",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -6257,6 +6257,31 @@ xla_cc_test(\n     ],\n )\n \n+tf_proto_library(\n+    name = \"gpu_topology_proto\",\n+    srcs = [\"gpu_topology.proto\"],\n+    visibility = [\"//visibility:public\"],\n+)\n+\n+cc_library(\n+    name = \"gpu_topology\",\n+    srcs = [\"gpu_topology.cc\"],\n+    hdrs = [\"gpu_topology.h\"],\n+    visibility = internal_visibility([\n+        \"//xla/pjrt:__subpackages__\",\n+        \"//third_party/pathways:__subpackages__\",\n+        \"//learning/brain/research/pjrt:__subpackages__\",\n+        \"//learning/brain/research/jax:__subpackages__\",\n+        \"//learning/pathways/compilation_service:__subpackages__\",\n+        \"//tensorflow/core/common_runtime/eager:__subpackages__\",\n+        \":__subpackages__\",\n+    ]),\n+    deps = [\n+        \":gpu_topology_proto_cc\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+    ],\n+)\n+\n cc_library(\n     name = \"matmul_indexing_utils\",\n     srcs = [\"matmul_indexing_utils.cc\"],"
        },
        {
            "sha": "fd3304126ffd4c5e08f042049e1ebf17b5ee53b9",
            "filename": "third_party/xla/xla/service/gpu_topology.cc",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.cc?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -13,11 +13,11 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#include \"xla/pjrt/gpu/gpu_topology.h\"\n+#include \"xla/service/gpu_topology.h\"\n \n #include <memory>\n \n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n \n namespace xla {\n ",
            "previous_filename": "third_party/xla/xla/pjrt/gpu/gpu_topology.cc"
        },
        {
            "sha": "9d5137e6b99f640a6088424187aa1c21fc589e54",
            "filename": "third_party/xla/xla/service/gpu_topology.h",
            "status": "renamed",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.h?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -13,17 +13,18 @@ See the License for the specific language governing permissions and\n limitations under the License.\n ==============================================================================*/\n \n-#ifndef XLA_PJRT_GPU_GPU_TOPOLOGY_H_\n-#define XLA_PJRT_GPU_GPU_TOPOLOGY_H_\n+#ifndef XLA_SERVICE_GPU_TOPOLOGY_H_\n+#define XLA_SERVICE_GPU_TOPOLOGY_H_\n \n #include <cstdint>\n #include <memory>\n #include <string>\n \n #include \"absl/strings/string_view.h\"\n-#include \"xla/pjrt/gpu/gpu_topology.pb.h\"\n+#include \"xla/service/gpu_topology.pb.h\"\n \n namespace xla {\n+\n class GpuTopology {\n  public:\n   explicit GpuTopology(absl::string_view platform_version,\n@@ -77,4 +78,4 @@ class GpuTopology {\n \n }  // namespace xla\n \n-#endif  // XLA_PJRT_GPU_GPU_TOPOLOGY_H_\n+#endif  // XLA_SERVICE_GPU_TOPOLOGY_H_",
            "previous_filename": "third_party/xla/xla/pjrt/gpu/gpu_topology.h"
        },
        {
            "sha": "7f12d68fb71b815417d2b93ecef5d7fddfb8a44e",
            "filename": "third_party/xla/xla/service/gpu_topology.proto",
            "status": "renamed",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.proto",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/8e84202c4e53eb575077d5726c6c42c099999391/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.proto",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu_topology.proto?ref=8e84202c4e53eb575077d5726c6c42c099999391",
            "patch": "@@ -2,6 +2,9 @@ syntax = \"proto3\";\n \n package xla;\n \n+option java_multiple_files = true;\n+option java_outer_classname = \"GpuTopologyProto\";\n+\n // A proto used to serialize GpuTopology instances.\n message GpuTopologyProto {\n   reserved 1;  // Was: device_ids",
            "previous_filename": "third_party/xla/xla/pjrt/gpu/gpu_topology.proto"
        }
    ],
    "stats": {
        "total": 152,
        "additions": 80,
        "deletions": 72
    }
}