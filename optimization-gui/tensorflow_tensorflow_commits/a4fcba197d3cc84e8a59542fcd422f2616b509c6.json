{
    "author": "basioli-k",
    "message": "[XLA:GPU] Add `ForAllThunksMutable` API.\n\nPiperOrigin-RevId: 813675261",
    "sha": "a4fcba197d3cc84e8a59542fcd422f2616b509c6",
    "files": [
        {
            "sha": "60aab86bfbaa83aa1556f1b413c5078ae01e30cc",
            "filename": "third_party/xla/xla/backends/gpu/runtime/collective_group_thunk.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -131,5 +131,13 @@ void CollectiveGroupThunk::ForAllThunks(\n   }\n }\n \n+void CollectiveGroupThunk::ForAllThunksMutable(\n+    absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  for (const std::unique_ptr<Thunk>& thunk : thunks_) {\n+    thunk->ForAllThunksMutable(fn);\n+  }\n+}\n+\n }  // namespace gpu\n }  // namespace xla"
        },
        {
            "sha": "27e8dd3ebfe1f5d382b4bb20235ac21d93dc9691",
            "filename": "third_party/xla/xla/backends/gpu/runtime/collective_group_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcollective_group_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -44,6 +44,7 @@ class CollectiveGroupThunk : public Thunk {\n   absl::Status ExecuteOnStream(const Thunk::ExecuteParams& params) override;\n   absl::Status Initialize(const InitializeParams& params) override;\n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n   std::shared_ptr<CollectiveThunk::AsyncEvents> async_events() const {\n     return async_events_;\n   }"
        },
        {
            "sha": "660a3e9fc2e5afc7b69dcae2d512ca637403389e",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_thunk.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -372,6 +372,14 @@ void CommandBufferThunk::ForAllThunks(\n   }\n }\n \n+void CommandBufferThunk::ForAllThunksMutable(\n+    absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  if (thunks_ != nullptr) {\n+    thunks_->ForAllThunksMutable(fn);\n+  }\n+}\n+\n std::string CommandBufferThunk::ToString(int indent) const {\n   std::string result = \"\\n\";\n   absl::StrAppend(&result, thunks_->ToString(indent + 1));"
        },
        {
            "sha": "6930106f758f4d0f5a9a5da2e652bdb0ffc5cc21",
            "filename": "third_party/xla/xla/backends/gpu/runtime/command_buffer_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fcommand_buffer_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -57,6 +57,7 @@ class CommandBufferThunk : public Thunk {\n       const ExecuteParams& params, int64_t index);\n \n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n \n   std::string ToString(int indent) const override;\n "
        },
        {
            "sha": "d693a343f13229011edc0b59dd0c35692e8933c0",
            "filename": "third_party/xla/xla/backends/gpu/runtime/conditional_thunk.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -158,6 +158,13 @@ void ConditionalThunk::ForAllThunks(\n   }\n }\n \n+void ConditionalThunk::ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  for (const std::unique_ptr<SequentialThunk>& branch_thunk : branch_thunks_) {\n+    branch_thunk->ForAllThunksMutable(fn);\n+  }\n+}\n+\n absl::StatusOr<ThunkProto> ConditionalThunk::ToProto() const {\n   ThunkProto proto;\n   *proto.mutable_thunk_info() = thunk_info().ToProto();"
        },
        {
            "sha": "be43d4d6755c5658fda86135eed315ada1dc8b15",
            "filename": "third_party/xla/xla/backends/gpu/runtime/conditional_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fconditional_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -71,6 +71,7 @@ class ConditionalThunk : public Thunk {\n   }\n \n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n   bool branch_index_is_bool() const { return branch_index_is_bool_; }\n \n   absl::StatusOr<ThunkProto> ToProto() const override;"
        },
        {
            "sha": "9e07092cb9f1cdb2b55e9ce6fee7ff9570e70085",
            "filename": "third_party/xla/xla/backends/gpu/runtime/dynamic_slice_thunk.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -323,5 +323,11 @@ void DynamicSliceThunk::ForAllThunks(\n   fn(this);\n   embedded_thunk_->ForAllThunks(fn);\n }\n+\n+void DynamicSliceThunk::ForAllThunksMutable(\n+    absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  embedded_thunk_->ForAllThunksMutable(fn);\n+}\n }  // namespace gpu\n }  // namespace xla"
        },
        {
            "sha": "cfb3ae3e4b1c2fbfad5b157b2c16060636d53413",
            "filename": "third_party/xla/xla/backends/gpu/runtime/dynamic_slice_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fdynamic_slice_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -163,6 +163,7 @@ class DynamicSliceThunk : public Thunk {\n   }\n \n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n \n  private:\n   std::unique_ptr<SequentialThunk> embedded_thunk_;"
        },
        {
            "sha": "a8df1eb635c041e6575febecb29a24b5212b9250",
            "filename": "third_party/xla/xla/backends/gpu/runtime/sequential_thunk.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -118,6 +118,13 @@ void SequentialThunk::ForAllThunks(\n   }\n }\n \n+void SequentialThunk::ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  for (const std::unique_ptr<Thunk>& thunk : thunks_) {\n+    thunk->ForAllThunksMutable(fn);\n+  }\n+}\n+\n absl::StatusOr<ThunkProto> SequentialThunk::ToProto() const {\n   ThunkProto proto;\n   *proto.mutable_thunk_info() = thunk_info().ToProto();"
        },
        {
            "sha": "3aee984c7d9ba1a3452734b65a5b002ed8950424",
            "filename": "third_party/xla/xla/backends/gpu/runtime/sequential_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fsequential_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -47,6 +47,7 @@ class SequentialThunk : public Thunk {\n   absl::Status ExecuteOnStream(const ExecuteParams& params) override;\n \n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n \n   absl::StatusOr<ThunkProto> ToProto() const override;\n "
        },
        {
            "sha": "7f2922f1ce572681a029379780f400baf214b3e9",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -416,6 +416,10 @@ void Thunk::ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const {\n   fn(this);\n }\n \n+void Thunk::ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+}\n+\n absl::StatusOr<ThunkProto> Thunk::ToProto() const {\n   return absl::UnimplementedError(absl::StrFormat(\n       \"Proto serialization for thunk of type %s is not implemented\","
        },
        {
            "sha": "dfde7a3f7816cefa408b3edb3ed17f1fbeeb20ca",
            "filename": "third_party/xla/xla/backends/gpu/runtime/thunk.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fthunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -523,6 +523,9 @@ class Thunk {\n   // Invokes `fn` with this thunk and all nested thunks.\n   virtual void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const;\n \n+  // Invokes `fn` with this thunk and all nested thunks.\n+  virtual void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn);\n+\n   // A helper function to get the `GpuCollectives*` pointer from the\n   // CollectiveExecuteParams.\n   static absl::StatusOr<GpuCollectives* absl_nonnull> GetGpuCollectives("
        },
        {
            "sha": "c2518e4b6aeff8b197a642105784bbd96b329a99",
            "filename": "third_party/xla/xla/backends/gpu/runtime/while_thunk.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.cc?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -191,6 +191,12 @@ void WhileThunk::ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const {\n   body_thunk_sequence_->ForAllThunks(fn);\n }\n \n+void WhileThunk::ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) {\n+  fn(this);\n+  condition_thunk_sequence_->ForAllThunksMutable(fn);\n+  body_thunk_sequence_->ForAllThunksMutable(fn);\n+}\n+\n std::string WhileThunk::ToString(int indent) const {\n   std::string indent_str(indent * 2, ' ');\n   std::string result;"
        },
        {
            "sha": "48788f30f4bd140649a1398178831faa988d254b",
            "filename": "third_party/xla/xla/backends/gpu/runtime/while_thunk.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a4fcba197d3cc84e8a59542fcd422f2616b509c6/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fgpu%2Fruntime%2Fwhile_thunk.h?ref=a4fcba197d3cc84e8a59542fcd422f2616b509c6",
            "patch": "@@ -92,6 +92,7 @@ class WhileThunk : public Thunk {\n       const HloInstruction* while_instr);\n \n   void ForAllThunks(absl::FunctionRef<void(const Thunk*)> fn) const override;\n+  void ForAllThunksMutable(absl::FunctionRef<void(Thunk*)> fn) override;\n \n   std::string ToString(int indent) const override;\n "
        }
    ],
    "stats": {
        "total": 55,
        "additions": 55,
        "deletions": 0
    }
}