{
    "author": "ZixuanJiang",
    "message": "Refactor `AlgebraicSimplifierVisitor::HandleOptimizationBarrier`.\n\nRemove redundant boolean `has_non_gte_use`.\n\nPiperOrigin-RevId: 808440531",
    "sha": "f9d2ef4f5e95656ff40ffc6d91b7e01fccfef3b7",
    "files": [
        {
            "sha": "9249ac595f5792e8458156d40bd39cd85ad79678",
            "filename": "third_party/xla/xla/hlo/transforms/simplifiers/algebraic_simplifier.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/f9d2ef4f5e95656ff40ffc6d91b7e01fccfef3b7/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/f9d2ef4f5e95656ff40ffc6d91b7e01fccfef3b7/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fhlo%2Ftransforms%2Fsimplifiers%2Falgebraic_simplifier.cc?ref=f9d2ef4f5e95656ff40ffc6d91b7e01fccfef3b7",
            "patch": "@@ -5118,12 +5118,11 @@ absl::Status AlgebraicSimplifierVisitor::HandleOptimizationBarrier(\n   // optimization barrier. Additionally if the operand is a tuple producing\n   // instruction it should also be safe to create a sub tuple of only the used\n   // components to enable module level dce.\n-  std::vector<bool> used_elements(barrier->shape().tuple_shapes().size());\n-  bool has_non_gte_use = false;\n+  std::vector<bool> used_elements(barrier->shape().tuple_shapes().size(),\n+                                  false);\n   for (auto use : barrier->users()) {\n     if (use->opcode() != HloOpcode::kGetTupleElement) {\n-      has_non_gte_use = true;\n-      break;\n+      return absl::OkStatus();\n     }\n     used_elements[use->tuple_index()] = true;\n   }\n@@ -5142,7 +5141,7 @@ absl::Status AlgebraicSimplifierVisitor::HandleOptimizationBarrier(\n     }\n   }\n \n-  if (has_non_gte_use || !absl::c_linear_search(used_elements, false)) {\n+  if (absl::c_all_of(used_elements, [](bool v) { return v; })) {\n     return absl::OkStatus();\n   }\n "
        }
    ],
    "stats": {
        "total": 9,
        "additions": 4,
        "deletions": 5
    }
}