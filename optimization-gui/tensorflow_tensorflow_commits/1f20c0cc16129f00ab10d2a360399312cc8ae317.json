{
    "author": "unknown",
    "message": "[XLA] Add AbslStringify for BufferUse\n\nConvenience method to make it easier to figure why when tests fail when they\ndo. Without this, assertion failures print BufferUse as a memory hex dump.\n\nPiperOrigin-RevId: 815704425",
    "sha": "1f20c0cc16129f00ab10d2a360399312cc8ae317",
    "files": [
        {
            "sha": "1e4e829d47630a6cd87c75b4fc025fc5c194e570",
            "filename": "third_party/xla/xla/runtime/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fruntime%2FBUILD?ref=1f20c0cc16129f00ab10d2a360399312cc8ae317",
            "patch": "@@ -32,9 +32,9 @@ xla_cc_test(\n     deps = [\n         \":buffer_use\",\n         \"//xla/service:buffer_assignment\",\n+        \"@com_google_absl//absl/strings\",\n         \"@com_google_googletest//:gtest\",\n         \"@com_google_googletest//:gtest_main\",\n-        \"@local_tsl//tsl/platform:test\",\n     ],\n )\n "
        },
        {
            "sha": "5c85b16afb75e7a29622c5a4fbbbe62a79094d56",
            "filename": "third_party/xla/xla/runtime/buffer_use.h",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use.h?ref=1f20c0cc16129f00ab10d2a360399312cc8ae317",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n #define XLA_RUNTIME_BUFFER_USE_H_\n \n #include <cstdint>\n+#include <string>\n \n #include \"absl/container/flat_hash_set.h\"\n #include \"absl/types/span.h\"\n@@ -100,6 +101,13 @@ class BufferUse {\n     return H::combine(std::move(h), use.slice_, use.access_);\n   }\n \n+  template <typename Sink>\n+  friend void AbslStringify(Sink& sink, const BufferUse& use) {\n+    absl::Format(&sink, \"slice: %v, access: %s%s\", use.slice_,\n+                 use.HasReadAccess() ? \"R\" : \"\",\n+                 use.HasWriteAccess() ? \"W\" : \"\");\n+  }\n+\n  private:\n   BufferAllocation::Slice slice_;\n   MemoryAccess access_;"
        },
        {
            "sha": "6032ec067e352860d768c380834985b7583595c6",
            "filename": "third_party/xla/xla/runtime/buffer_use_test.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/1f20c0cc16129f00ab10d2a360399312cc8ae317/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fruntime%2Fbuffer_use_test.cc?ref=1f20c0cc16129f00ab10d2a360399312cc8ae317",
            "patch": "@@ -16,8 +16,8 @@ limitations under the License.\n #include \"xla/runtime/buffer_use.h\"\n \n #include <gtest/gtest.h>\n+#include \"absl/strings/str_cat.h\"\n #include \"xla/service/buffer_assignment.h\"\n-#include \"tsl/platform/test.h\"\n \n namespace xla {\n namespace {\n@@ -51,6 +51,18 @@ TEST(BufferUseTest, HasReadWriteAccess) {\n   EXPECT_TRUE(read_write.HasWriteAccess());\n }\n \n+TEST(BufferUseTest, AbslStringify) {\n+  BufferAllocation alloc(/*index=*/0, /*size=*/1024, /*color=*/0);\n+  BufferAllocation::Slice slice(&alloc, 0, 10);\n+\n+  EXPECT_EQ(absl::StrCat(BufferUse::Read(slice)),\n+            \"slice: {index:0, offset:0, size:10}, access: R\");\n+  EXPECT_EQ(absl::StrCat(BufferUse::Write(slice)),\n+            \"slice: {index:0, offset:0, size:10}, access: W\");\n+  EXPECT_EQ(absl::StrCat(BufferUse::ReadWrite(slice)),\n+            \"slice: {index:0, offset:0, size:10}, access: RW\");\n+}\n+\n TEST(BufferUseTest, ReadWriteSet) {\n   BufferUse::ReadWriteSet rwset;\n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
    }
}