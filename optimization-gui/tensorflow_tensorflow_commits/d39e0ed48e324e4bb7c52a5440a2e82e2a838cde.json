{
    "author": "basioli-k",
    "message": "[XLA:CPU][AOT] Make sure stablehlo test doesn't fail if executable loading fails due to different compilation machines\n\nPiperOrigin-RevId: 837195627",
    "sha": "d39e0ed48e324e4bb7c52a5440a2e82e2a838cde",
    "files": [
        {
            "sha": "179be0ccbd2a1907305277058359768303de55cb",
            "filename": "third_party/xla/xla/service/BUILD",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d39e0ed48e324e4bb7c52a5440a2e82e2a838cde/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d39e0ed48e324e4bb7c52a5440a2e82e2a838cde/third_party%2Fxla%2Fxla%2Fservice%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2FBUILD?ref=d39e0ed48e324e4bb7c52a5440a2e82e2a838cde",
            "patch": "@@ -5867,6 +5867,7 @@ xla_cc_test(\n         \"//xla/service/cpu:cpu_compiler\",\n         \"//xla/tests:literal_test_util\",\n         \"//xla/tsl/lib/core:status_test_util\",\n+        \"@com_google_absl//absl/status\",\n         \"@com_google_googletest//:gtest_main\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:path\","
        },
        {
            "sha": "8f338d16b94f1ba20fa52d66b1227d104de541e3",
            "filename": "third_party/xla/xla/service/xla_aot_compile_stablehlo_cpu_test.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 3,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/d39e0ed48e324e4bb7c52a5440a2e82e2a838cde/third_party%2Fxla%2Fxla%2Fservice%2Fxla_aot_compile_stablehlo_cpu_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/d39e0ed48e324e4bb7c52a5440a2e82e2a838cde/third_party%2Fxla%2Fxla%2Fservice%2Fxla_aot_compile_stablehlo_cpu_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fxla_aot_compile_stablehlo_cpu_test.cc?ref=d39e0ed48e324e4bb7c52a5440a2e82e2a838cde",
            "patch": "@@ -15,8 +15,11 @@ limitations under the License.\n \n #include <memory>\n #include <string>\n+#include <utility>\n \n+#include <gmock/gmock.h>\n #include <gtest/gtest.h>\n+#include \"absl/status/status.h\"\n #include \"xla/client/client_library.h\"\n #include \"xla/client/executable_build_options.h\"\n #include \"xla/client/local_client.h\"\n@@ -59,9 +62,20 @@ TEST(XlaCompileTest, LoadCpuExecutable) {\n \n   // Load from AOT result.\n   ExecutableBuildOptions executable_build_options;\n-  TF_ASSERT_OK_AND_ASSIGN(\n-      std::unique_ptr<LocalExecutable> local_executable,\n-      client->Load(serialized_aot_result, executable_build_options));\n+\n+  auto local_executable_or_status =\n+      client->Load(serialized_aot_result, executable_build_options);\n+  if (!local_executable_or_status.ok()) {\n+    EXPECT_EQ(local_executable_or_status.status().code(),\n+              absl::StatusCode::kInvalidArgument);\n+\n+    EXPECT_THAT(local_executable_or_status.status().message(),\n+                ::testing::HasSubstr(\"Failed to load XLA:CPU AOT result.\"));\n+    return;\n+  }\n+\n+  std::unique_ptr<LocalExecutable> local_executable =\n+      std::move(local_executable_or_status.value());\n \n   // Run loaded excutable.\n   auto alpha_literal = xla::LiteralUtil::CreateR0<float>(3.14f);"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}