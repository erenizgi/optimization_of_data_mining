{
    "author": "tensorflower-gardener",
    "message": "Integrate LLVM at llvm/llvm-project@0bd2f1275360\n\nUpdates LLVM usage to match\n[0bd2f1275360](https://github.com/llvm/llvm-project/commit/0bd2f1275360)\n\nPiperOrigin-RevId: 839423851",
    "sha": "2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
    "files": [
        {
            "sha": "f8d638a485ca0c27fd872cd6bc6d977d8840ac06",
            "filename": "third_party/xla/third_party/llvm/generated.patch",
            "status": "modified",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fgenerated.patch?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -1 +1,35 @@\n Auto generated patch. Do not edit or delete it, even if empty.\n+diff -ruN --strip-trailing-cr a/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp b/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n+--- a/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n++++ b/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n+@@ -1163,6 +1163,7 @@\n+   // (X >= Y) ? INT_MAX : (X + C) --> sadd.sat(X, C)\n+   // where Y is INT_MAX - C or INT_MAX - C - 1, and C > 0\n+   if ((Pred == ICmpInst::ICMP_SGT || Pred == ICmpInst::ICMP_SGE) &&\n++      isa<Constant>(Cmp1) &&\n+       match(FVal, m_Add(m_Specific(Cmp0), m_StrictlyPositive(C)))) {\n+     APInt IntMax =\n+         APInt::getSignedMaxValue(Cmp1->getType()->getScalarSizeInBits());\n+diff -ruN --strip-trailing-cr a/llvm/test/Transforms/InstCombine/saturating-add-sub.ll b/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n+--- a/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n++++ b/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n+@@ -2671,3 +2671,19 @@\n+   %s = select i1 %cmp, i8 127, i8 %d\n+   ret i8 %s\n+ }\n++\n++; Make sure we don't crash in this case.\n++define i32 @pr153053_strict_pred_with_nonconstant_rhs(i32 %x, i32 %y) {\n++; CHECK-LABEL: @pr153053_strict_pred_with_nonconstant_rhs(\n++; CHECK-NEXT:  entry:\n++; CHECK-NEXT:    [[CMP:%.*]] = icmp slt i32 [[X:%.*]], [[Y:%.*]]\n++; CHECK-NEXT:    [[ADD:%.*]] = add i32 [[X]], 1\n++; CHECK-NEXT:    [[RES:%.*]] = select i1 [[CMP]], i32 [[ADD]], i32 2147483647\n++; CHECK-NEXT:    ret i32 [[RES]]\n++;\n++entry:\n++  %cmp = icmp slt i32 %x, %y\n++  %add = add i32 %x, 1\n++  %res = select i1 %cmp, i32 %add, i32 2147483647\n++  ret i32 %res\n++}"
        },
        {
            "sha": "9e0bf3dfe6772b01658a23b52bb2e6ac9d706de1",
            "filename": "third_party/xla/third_party/llvm/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fllvm%2Fworkspace.bzl?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n \n def repo(name):\n     \"\"\"Imports LLVM.\"\"\"\n-    LLVM_COMMIT = \"0c2701fe7fa002e1befc5f86c268a7964f96d286\"\n-    LLVM_SHA256 = \"50b0cb64adf161b4441ee32453f2eb9a015263e4eb3c036548f0207cbe3d0707\"\n+    LLVM_COMMIT = \"0bd2f12753604cd072ae0935820ba9a23bb17ccc\"\n+    LLVM_SHA256 = \"e60e866c649331e41907124f8b3537ecea10acf49da7c5a344d78089df492f0e\"\n \n     tf_http_archive(\n         name = name,"
        },
        {
            "sha": "574c57241c4be6aab426c9d619b9558c765b66ba",
            "filename": "third_party/xla/third_party/shardy/temporary.patch",
            "status": "modified",
            "additions": 41,
            "deletions": 58,
            "changes": 99,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Ftemporary.patch?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -1,72 +1,55 @@\n diff --git a/third_party/llvm/generated.patch b/third_party/llvm/generated.patch\n-index 37a7256..509398d 100644\n+index 509398d..f8d638a 100644\n --- a/third_party/llvm/generated.patch\n +++ b/third_party/llvm/generated.patch\n-@@ -1,29 +1 @@\n+@@ -1 +1,35 @@\n  Auto generated patch. Do not edit or delete it, even if empty.\n--diff -ruN --strip-trailing-cr a/clang/lib/Analysis/ThreadSafety.cpp b/clang/lib/Analysis/ThreadSafety.cpp\n----- a/clang/lib/Analysis/ThreadSafety.cpp\n--+++ b/clang/lib/Analysis/ThreadSafety.cpp\n--@@ -2820,7 +2820,7 @@\n--         case CFGElement::AutomaticObjectDtor: {\n--           CFGAutomaticObjDtor AD = BI.castAs<CFGAutomaticObjDtor>();\n--           const auto *DD = AD.getDestructorDecl(AC.getASTContext());\n---          if (!DD->hasAttrs())\n--+          if (!DD || !DD->hasAttrs())\n--             break;\n-- \n--           LocksetBuilder.handleCall(\n--diff -ruN --strip-trailing-cr a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n----- a/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n--+++ b/clang/test/SemaCXX/no-warn-thread-safety-analysis.cpp\n--@@ -0,0 +1,12 @@\n--+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n--+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++11 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n--+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=0 %s\n--+// RUN: %clang_cc1 -fsyntax-only -verify -std=c++17 -Wthread-safety -Wthread-safety-pointer -Wthread-safety-beta -Wno-thread-safety-negative -fcxx-exceptions -DUSE_CAPABILITY=1 %s\n--+// expected-no-diagnostics\n--+\n--+struct foo {\n--+  ~foo();\n--+};\n--+struct bar : foo {};\n--+struct baz : bar {};\n--+baz foobar(baz a) { return a; }\n++diff -ruN --strip-trailing-cr a/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp b/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n++--- a/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n+++++ b/llvm/lib/Transforms/InstCombine/InstCombineSelect.cpp\n++@@ -1163,6 +1163,7 @@\n++   // (X >= Y) ? INT_MAX : (X + C) --> sadd.sat(X, C)\n++   // where Y is INT_MAX - C or INT_MAX - C - 1, and C > 0\n++   if ((Pred == ICmpInst::ICMP_SGT || Pred == ICmpInst::ICMP_SGE) &&\n+++      isa<Constant>(Cmp1) &&\n++       match(FVal, m_Add(m_Specific(Cmp0), m_StrictlyPositive(C)))) {\n++     APInt IntMax =\n++         APInt::getSignedMaxValue(Cmp1->getType()->getScalarSizeInBits());\n++diff -ruN --strip-trailing-cr a/llvm/test/Transforms/InstCombine/saturating-add-sub.ll b/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n++--- a/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n+++++ b/llvm/test/Transforms/InstCombine/saturating-add-sub.ll\n++@@ -2671,3 +2671,19 @@\n++   %s = select i1 %cmp, i8 127, i8 %d\n++   ret i8 %s\n++ }\n+++\n+++; Make sure we don't crash in this case.\n+++define i32 @pr153053_strict_pred_with_nonconstant_rhs(i32 %x, i32 %y) {\n+++; CHECK-LABEL: @pr153053_strict_pred_with_nonconstant_rhs(\n+++; CHECK-NEXT:  entry:\n+++; CHECK-NEXT:    [[CMP:%.*]] = icmp slt i32 [[X:%.*]], [[Y:%.*]]\n+++; CHECK-NEXT:    [[ADD:%.*]] = add i32 [[X]], 1\n+++; CHECK-NEXT:    [[RES:%.*]] = select i1 [[CMP]], i32 [[ADD]], i32 2147483647\n+++; CHECK-NEXT:    ret i32 [[RES]]\n+++;\n+++entry:\n+++  %cmp = icmp slt i32 %x, %y\n+++  %add = add i32 %x, 1\n+++  %res = select i1 %cmp, i32 %add, i32 2147483647\n+++  ret i32 %res\n+++}\n diff --git a/third_party/llvm/workspace.bzl b/third_party/llvm/workspace.bzl\n-index 3b35979..daf3e74 100644\n+index daf3e74..807db4f 100644\n --- a/third_party/llvm/workspace.bzl\n +++ b/third_party/llvm/workspace.bzl\n @@ -4,8 +4,8 @@ load(\"//third_party:repo.bzl\", \"tf_http_archive\")\n  \n  def repo(name):\n      \"\"\"Imports LLVM.\"\"\"\n--    LLVM_COMMIT = \"4f39a4ff0ada92870ca1c2dccad382ea04947da8\"\n--    LLVM_SHA256 = \"264c7cc3e166b840911494a2e94cff2ae8730b56239bd91dc8f65c8dc9468262\"\n-+    LLVM_COMMIT = \"0c2701fe7fa002e1befc5f86c268a7964f96d286\"\n-+    LLVM_SHA256 = \"50b0cb64adf161b4441ee32453f2eb9a015263e4eb3c036548f0207cbe3d0707\"\n+-    LLVM_COMMIT = \"0c2701fe7fa002e1befc5f86c268a7964f96d286\"\n+-    LLVM_SHA256 = \"50b0cb64adf161b4441ee32453f2eb9a015263e4eb3c036548f0207cbe3d0707\"\n++    LLVM_COMMIT = \"0bd2f12753604cd072ae0935820ba9a23bb17ccc\"\n++    LLVM_SHA256 = \"e60e866c649331e41907124f8b3537ecea10acf49da7c5a344d78089df492f0e\"\n  \n      tf_http_archive(\n          name = name,\n-diff --git a/third_party/llvm/zstd.patch b/third_party/llvm/zstd.patch\n-index 2d6f45a..39e69eb 100644\n---- a/third_party/llvm/zstd.patch\n-+++ b/third_party/llvm/zstd.patch\n-@@ -9,7 +9,7 @@ index 37e79db376b4..058788948f94 100644\n- -        # We unconditionally depend on the custom LLVM zlib wrapper. This will\n- -        # be an empty library unless zlib is enabled, in which case it will\n- -        # both provide the necessary dependencies and configuration defines.\n---        \"//third-party:zlib\",\n-+-        \"@llvm_zlib//:zlib\",\n- -        # We unconditionally depend on the custom LLVM zstd wrapper. This will\n- -        # be an empty library unless zstd is enabled, in which case it will\n- -        # both provide the necessary dependencies and configuration defines.\n-@@ -24,8 +24,8 @@ diff -u a/utils/bazel/llvm-project-overlay/lld/BUILD.bazel  b/utils/bazel/llvm-p\n-          \"//llvm:TargetParser\",\n-          \"//llvm:TransformUtils\",\n-          \"//llvm:config\",\n---        \"//third-party:zlib\",\n- -        \"//third-party:zstd\",\n-+-        \"@llvm_zlib//:zlib\",\n-      ],\n-  )\n- "
        },
        {
            "sha": "6a0c493897612e60be052827de693dd9cef5061e",
            "filename": "third_party/xla/third_party/shardy/workspace.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fshardy%2Fworkspace.bzl?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -3,8 +3,8 @@\n load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n \n def repo():\n-    SHARDY_COMMIT = \"97ce26f0493d3aa720d1d6c18bde48d38c2e3866\"\n-    SHARDY_SHA256 = \"22e964d3a228f0613c3663eb743d0b726ce271247652e5710b7d63bd6703e2a4\"\n+    SHARDY_COMMIT = \"23359578eec0292a45958f560b19ea574d98e669\"\n+    SHARDY_SHA256 = \"47d53e6f02f6b752ec237237978144ab8ccd291c8b84e97cb349198bec4153b2\"\n \n     tf_http_archive(\n         name = \"shardy\","
        },
        {
            "sha": "b01ba87b6e981e38cbe9adf9cdc67d4c84619be8",
            "filename": "third_party/xla/third_party/triton/llvm_integration/cl838780160.patch",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl838780160.patch",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl838780160.patch",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fcl838780160.patch?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -0,0 +1,17 @@\n+\n+--- a/lib/Conversion/TritonToTritonGPU/RelayoutTritonGPU.cpp\t2025-11-12 02:33:41.000000000 -0800\n++++ b/lib/Conversion/TritonToTritonGPU/RelayoutTritonGPU.cpp\t2025-12-01 08:23:05.000000000 -0800\n+@@ -115,7 +115,12 @@\n+         // clang-format on\n+         >(typeConverter, context);\n+ \n+-    if (failed(applyPartialConversion(mod, target, std::move(patterns))))\n++    // config\n++    ConversionConfig config;\n++    config.allowPatternRollback = false;  // not needed and not supported\n++\n++    if (failed(\n++            applyPartialConversion(mod, target, std::move(patterns), config)))\n+       return signalPassFailure();\n+   }\n+ };"
        },
        {
            "sha": "15b35c93bc457c430e8dbf7b36982542211c9d7d",
            "filename": "third_party/xla/third_party/triton/llvm_integration/series.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/2df1d96602d09a9139fdc8edb4ace33ba7e80eca/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Ftriton%2Fllvm_integration%2Fseries.bzl?ref=2df1d96602d09a9139fdc8edb4ace33ba7e80eca",
            "patch": "@@ -11,5 +11,6 @@ llvm_patch_list = [\n     \"//third_party/triton:llvm_integration/cl831451347.patch\",\n     \"//third_party/triton:llvm_integration/cl833447018.patch\",\n     \"//third_party/triton:llvm_integration/cl835942347.patch\",\n+    \"//third_party/triton:llvm_integration/cl838780160.patch\",\n     # Add new patches just above this line\n ]"
        }
    ],
    "stats": {
        "total": 159,
        "additions": 97,
        "deletions": 62
    }
}