{
    "author": "ezhulenev",
    "message": "[xla:pjrt] Migtate PjRt C api to xla::Future and xla::Promise\n\nPiperOrigin-RevId: 812108303",
    "sha": "613ba1785629e275319e1dd9e7066b5872f8fdc5",
    "files": [
        {
            "sha": "2025c8392cf1b97d8305c524ad96441781e24fed",
            "filename": "third_party/xla/xla/pjrt/c/BUILD",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2FBUILD?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -55,7 +55,6 @@ cc_library(\n     deps = [\n         \"//xla:shape_util\",\n         \"//xla/pjrt:pjrt_client\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt/c:pjrt_c_api_hdrs\",\n         \"//xla/pjrt/c:pjrt_c_api_helpers\",\n         \"//xla/pjrt/c:pjrt_c_api_wrapper_impl\",\n@@ -210,8 +209,8 @@ cc_library(\n         \":pjrt_c_api_hdrs\",\n         \":pjrt_c_api_helpers\",\n         \":pjrt_c_api_raw_buffer_extension_hdrs\",\n+        \"//xla:future\",\n         \"//xla/pjrt:pjrt_c_api_client\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt:raw_buffer\",\n         \"//xla/tsl/concurrency:ref_count\",\n         \"//xla/tsl/platform:statusor\",\n@@ -258,6 +257,7 @@ cc_library(\n         \":pjrt_c_api_helpers\",\n         \":pjrt_c_api_layouts_extension_hdrs\",\n         \":pjrt_c_api_memory_descriptions_extension_hdrs\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla:shape_util\",\n         \"//xla:util\",\n@@ -271,7 +271,6 @@ cc_library(\n         \"//xla/pjrt:pjrt_compiler\",\n         \"//xla/pjrt:pjrt_device_description\",\n         \"//xla/pjrt:pjrt_executable\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt:pjrt_layout\",\n         \"//xla/pjrt:pjrt_stream_executor_client\",\n         \"//xla/pjrt:raw_buffer\",\n@@ -315,14 +314,14 @@ cc_library(\n         \":pjrt_c_api_layouts_extension_hdrs\",\n         \":pjrt_c_api_memory_descriptions_extension_hdrs\",\n         \":pjrt_c_api_profiler_extension_hdrs\",\n+        \"//xla:future\",\n         \"//xla:shape_util\",\n         \"//xla:util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/pjrt:pjrt_client\",\n         \"//xla/pjrt:pjrt_common\",\n         \"//xla/pjrt:pjrt_device_description\",\n         \"//xla/pjrt:pjrt_executable\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt/distributed:key_value_store_interface\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:logging\",\n@@ -516,14 +515,14 @@ cc_library(\n         \":pjrt_c_api_hdrs\",\n         \":pjrt_c_api_helpers\",\n         \":pjrt_c_api_wrapper_impl\",\n+        \"//xla:future\",\n         \"//xla:shape_util\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/client:executable_build_options\",\n         \"//xla/hlo/builder:xla_builder\",\n         \"//xla/hlo/builder:xla_computation\",\n         \"//xla/pjrt:pjrt_client\",\n         \"//xla/pjrt:pjrt_executable\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt/proto:compile_options_proto_cc\",\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/tsl/platform:status\",\n@@ -555,6 +554,7 @@ xla_test(\n         \":pjrt_c_api_test_common\",\n         \":pjrt_c_api_triton_extension_hdrs\",\n         \":pjrt_c_api_wrapper_impl\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n@@ -564,10 +564,8 @@ xla_test(\n         \"//xla/ffi:ffi_api\",\n         \"//xla/ffi:type_id_registry\",\n         \"//xla/ffi/api:ffi\",\n-        \"//xla/pjrt:pjrt_c_api_client\",\n         \"//xla/pjrt:pjrt_common\",\n         \"//xla/pjrt:pjrt_compiler\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt/distributed:in_memory_key_value_store\",\n         \"//xla/pjrt/gpu:se_gpu_pjrt_client\",\n         \"//xla/service:custom_call_target_registry\",\n@@ -634,6 +632,7 @@ cc_library(\n         \":pjrt_c_api_helpers\",\n         \":pjrt_c_api_memory_descriptions_extension_hdrs\",\n         \":pjrt_c_api_test_base\",\n+        \"//xla:future\",\n         \"//xla:literal\",\n         \"//xla:literal_util\",\n         \"//xla:shape_util\",\n@@ -644,7 +643,6 @@ cc_library(\n         \"//xla/hlo/parser:hlo_parser\",\n         \"//xla/pjrt:pjrt_client\",\n         \"//xla/pjrt:pjrt_device_description\",\n-        \"//xla/pjrt:pjrt_future\",\n         \"//xla/pjrt/proto:compile_options_proto_cc\",\n         \"//xla/service:computation_placer_hdr\",\n         \"//xla/service:hlo_proto_cc\","
        },
        {
            "sha": "0fab59e6e322ee8d474044cb9fde65dd25b28a8d",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_gpu_test.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_gpu_test.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -44,6 +44,7 @@ limitations under the License.\n #include \"xla/ffi/execution_context.h\"\n #include \"xla/ffi/ffi_api.h\"\n #include \"xla/ffi/type_id_registry.h\"\n+#include \"xla/future.h\"\n #include \"xla/literal.h\"\n #include \"xla/literal_util.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n@@ -60,7 +61,6 @@ limitations under the License.\n #include \"xla/pjrt/gpu/se_gpu_pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_compiler.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/service/custom_call_target_registry.h\"\n #include \"xla/shape.h\"\n #include \"xla/shape_util.h\"\n@@ -167,7 +167,7 @@ TEST_F(PjrtCApiGpuTest, CreateViewOfDeviceBuffer) {\n   PJRT_Error* to_host_error = api_->PJRT_Buffer_ToHostBuffer(&to_host_args);\n \n   ASSERT_EQ(to_host_error, nullptr);\n-  xla::PjRtFuture<> transfer_to_host =\n+  xla::Future<> transfer_to_host =\n       ::pjrt::ConvertCEventToCppFuture(to_host_args.event, api_);\n   TF_CHECK_OK(transfer_to_host.Await());\n   ASSERT_EQ(literal->data<float>().size(), 4);\n@@ -219,8 +219,7 @@ TEST_F(PjrtCApiGpuBufferTest, CopyRawToHost) {\n   args.transfer_size = size;\n   PJRT_Error* error = api_->PJRT_Buffer_CopyRawToHost(&args);\n   ASSERT_THAT(error, IsNull());\n-  xla::PjRtFuture<> copy_to_host_event =\n-      ConvertCEventToCppFuture(args.event, api_);\n+  xla::Future<> copy_to_host_event = ConvertCEventToCppFuture(args.event, api_);\n   TF_EXPECT_OK(copy_to_host_event.Await());\n   EXPECT_EQ(*(static_cast<float*>(args.dst)), 41);\n   tsl::port::AlignedSizedFree(args.dst, tsl::Allocator::kAllocatorAlignment,\n@@ -239,8 +238,7 @@ TEST_F(PjrtCApiGpuBufferTest, CopyRawToHostWithInvalidOffset) {\n   args.transfer_size = size;\n   PJRT_Error* error = api_->PJRT_Buffer_CopyRawToHost(&args);\n   ASSERT_EQ(error, nullptr);\n-  xla::PjRtFuture<> copy_to_host_event =\n-      ConvertCEventToCppFuture(args.event, api_);\n+  xla::Future<> copy_to_host_event = ConvertCEventToCppFuture(args.event, api_);\n   absl::Status status = copy_to_host_event.Await();\n   std::string expected_message = absl::StrFormat(\n       \"Copy raw buffer called on buffer size %lld with \""
        },
        {
            "sha": "a9050f3d2b50b1be4362b1e6a07f4e6031a96c24",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_helpers.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -37,6 +37,7 @@ limitations under the License.\n #include \"absl/time/time.h\"\n #include \"absl/types/span.h\"\n #include \"stablehlo/dialect/Version.h\"\n+#include \"xla/future.h\"\n #include \"xla/layout.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_layouts_extension.h\"\n@@ -47,7 +48,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/primitive_util.h\"\n #include \"xla/shape_util.h\"\n #include \"xla/tsl/platform/errors.h\"\n@@ -460,18 +460,17 @@ xla::PjRtClient::HostBufferSemantics ConvertFromPjRtHostBufferSemantics(\n   }\n }\n \n-xla::PjRtFuture<> ConvertCEventToCppFuture(PJRT_Event* c_event,\n-                                           const PJRT_Api* c_api) {\n-  using xla::PjRtFuture;\n+xla::Future<> ConvertCEventToCppFuture(PJRT_Event* c_event,\n+                                       const PJRT_Api* c_api) {\n   PJRT_Event_OnReady_Args event_onready_args;\n   event_onready_args.struct_size = PJRT_Event_OnReady_Args_STRUCT_SIZE;\n   event_onready_args.extension_start = nullptr;\n   event_onready_args.event = c_event;\n \n-  auto [promise, future] = PjRtFuture<>::MakePromise();\n+  auto [promise, future] = xla::Future<>::MakePromise();\n   event_onready_args.user_arg = new std::function<void(PJRT_Error*)>(\n-      [promise = std::make_shared<PjRtFuture<>::Promise>(std::move(promise)),\n-       c_event, c_api](PJRT_Error* error) mutable {\n+      [promise = std::move(promise).ToShared(), c_event,\n+       c_api](PJRT_Error* error) mutable {\n         if (error != nullptr) {\n           promise->Set(::pjrt::PjrtErrorToStatus(error, c_api));\n           ::pjrt::MakeErrorDeleter(c_api)(error);\n@@ -489,7 +488,7 @@ xla::PjRtFuture<> ConvertCEventToCppFuture(PJRT_Event* c_event,\n \n   PJRT_Error* error = c_api->PJRT_Event_OnReady(&event_onready_args);\n   if (error != nullptr) {\n-    return PjRtFuture<>(::pjrt::PjrtErrorToStatus(error, c_api));\n+    return xla::Future<>(::pjrt::PjrtErrorToStatus(error, c_api));\n   }\n   return std::move(future);\n }"
        },
        {
            "sha": "a585e00719694b53d0ab5709d39993d1b003d017",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_helpers.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_helpers.h?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -30,6 +30,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/future.h\"\n #include \"xla/layout.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_layouts_extension.h\"\n@@ -38,7 +39,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_common.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/shape.h\"\n #include \"xla/xla_data.pb.h\"\n \n@@ -160,10 +160,10 @@ PJRT_HostBufferSemantics ConvertToPjRtHostBufferSemantics(\n xla::PjRtClient::HostBufferSemantics ConvertFromPjRtHostBufferSemantics(\n     PJRT_HostBufferSemantics buffer_semantics);\n \n-// Create and return a `PjRtFuture`  which will be set when `c_event` is ready.\n-// This also deletes `c_event` when the `PjRtFuture` is set.\n-xla::PjRtFuture<> ConvertCEventToCppFuture(PJRT_Event* c_event,\n-                                           const PJRT_Api* c_api);\n+// Create and return a `Future`  which will be set when `c_event` is ready.\n+// This also deletes `c_event` when the `Future` is set.\n+xla::Future<> ConvertCEventToCppFuture(PJRT_Event* c_event,\n+                                       const PJRT_Api* c_api);\n \n // The data of returned variable-length PJRT_NamedValue list is backed by\n // `cpp_value_map`, so `cpp_value_map` must outlive the returned list. It will"
        },
        {
            "sha": "f6babb523c03a82d66ec53acb25929463aaeaef3",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_raw_buffer_external.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -23,11 +23,11 @@ limitations under the License.\n \n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"xla/future.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_helpers.h\"\n #include \"xla/pjrt/c/pjrt_c_api_raw_buffer_extension.h\"\n #include \"xla/pjrt/pjrt_c_api_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/raw_buffer.h\"\n #include \"xla/tsl/concurrency/ref_count.h\"\n #include \"xla/tsl/platform/statusor.h\"\n@@ -40,7 +40,7 @@ limitations under the License.\n         error, pjrt::MakeErrorDeleter(c_api));                           \\\n     absl::Status _status = pjrt::PjrtErrorToStatus(_error.get(), c_api); \\\n     if (!_status.ok()) {                                                 \\\n-      return xla::PjRtFuture<>(_status);                                 \\\n+      return xla::Future<>(_status);                                     \\\n     }                                                                    \\\n   } while (false)\n \n@@ -93,7 +93,7 @@ size_t PjRtCApiRawBuffer_GetOnDeviceSizeInBytes(\n   return args.on_device_size_in_bytes;\n }\n \n-xla::PjRtFuture<> PjRtCApiRawBuffer_CopyRawHostToDevice(\n+xla::Future<> PjRtCApiRawBuffer_CopyRawHostToDevice(\n     const PJRT_Api* c_api, const PJRT_RawBuffer_Extension* extension,\n     PJRT_RawBuffer* buffer, const void* src, int64_t offset,\n     int64_t transfer_size) {\n@@ -110,7 +110,7 @@ xla::PjRtFuture<> PjRtCApiRawBuffer_CopyRawHostToDevice(\n   return pjrt::ConvertCEventToCppFuture(args.event, c_api);\n }\n \n-xla::PjRtFuture<> PjRtCApiRawBuffer_CopyRawDeviceToHost(\n+xla::Future<> PjRtCApiRawBuffer_CopyRawDeviceToHost(\n     const PJRT_Api* c_api, const PJRT_RawBuffer_Extension* extension,\n     PJRT_RawBuffer* buffer, void* dst, int64_t offset, int64_t transfer_size) {\n   PJRT_RawBuffer_CopyRawDeviceToHost_Args args;\n@@ -162,15 +162,14 @@ size_t PjRtCApiRawBuffer::GetOnDeviceSizeInBytes() const {\n                                                         c_buffer_);\n }\n \n-PjRtFuture<> PjRtCApiRawBuffer::CopyRawHostToDevice(const void* src,\n-                                                    int64_t offset,\n-                                                    int64_t transfer_size) {\n+Future<> PjRtCApiRawBuffer::CopyRawHostToDevice(const void* src, int64_t offset,\n+                                                int64_t transfer_size) {\n   return pjrt::PjRtCApiRawBuffer_CopyRawHostToDevice(\n       c_api_, c_extension_, c_buffer_, src, offset, transfer_size);\n }\n \n-PjRtFuture<> PjRtCApiRawBuffer::CopyRawDeviceToHost(void* dst, int64_t offset,\n-                                                    int64_t transfer_size) {\n+Future<> PjRtCApiRawBuffer::CopyRawDeviceToHost(void* dst, int64_t offset,\n+                                                int64_t transfer_size) {\n   return pjrt::PjRtCApiRawBuffer_CopyRawDeviceToHost(\n       c_api_, c_extension_, c_buffer_, dst, offset, transfer_size);\n }"
        },
        {
            "sha": "39fba457f4b689e7da1940f7bc51d6fbe05ead68",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_raw_buffer_external.h",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_raw_buffer_external.h?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -17,6 +17,7 @@ limitations under the License.\n #define XLA_PJRT_C_PJRT_C_API_RAW_BUFFER_EXTERNAL_H_\n \n #include \"absl/status/statusor.h\"\n+#include \"xla/future.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_raw_buffer_extension.h\"\n #include \"xla/pjrt/pjrt_c_api_client.h\"\n@@ -39,12 +40,12 @@ size_t PjRtCApiRawBuffer_GetOnDeviceSizeInBytes(\n     const PJRT_Api* c_api, const PJRT_RawBuffer_Extension* extension,\n     PJRT_RawBuffer* buffer);\n \n-xla::PjRtFuture<> PjRtCApiRawBuffer_CopyRawHostToDevice(\n+xla::Future<> PjRtCApiRawBuffer_CopyRawHostToDevice(\n     const PJRT_Api* c_api, const PJRT_RawBuffer_Extension* extension,\n     PJRT_RawBuffer* buffer, const void* src, int64_t offset,\n     int64_t transfer_size);\n \n-xla::PjRtFuture<> PjRtCApiRawBuffer_CopyRawDeviceToHost(\n+xla::Future<> PjRtCApiRawBuffer_CopyRawDeviceToHost(\n     const PJRT_Api* c_api, const PJRT_RawBuffer_Extension* extension,\n     PJRT_RawBuffer* buffer, void* dst, int64_t offset, int64_t transfer_size);\n \n@@ -70,10 +71,10 @@ class PjRtCApiRawBuffer : public PjRtRawBuffer {\n   PjRtMemorySpace* memory_space() const override;\n   void* GetHostPointer() const override;\n   size_t GetOnDeviceSizeInBytes() const override;\n-  PjRtFuture<> CopyRawHostToDevice(const void* src, int64_t offset,\n-                                   int64_t transfer_size) override;\n-  PjRtFuture<> CopyRawDeviceToHost(void* dst, int64_t offset,\n-                                   int64_t transfer_size) override;\n+  Future<> CopyRawHostToDevice(const void* src, int64_t offset,\n+                               int64_t transfer_size) override;\n+  Future<> CopyRawDeviceToHost(void* dst, int64_t offset,\n+                               int64_t transfer_size) override;\n \n  private:\n   PJRT_RawBuffer* c_buffer_;"
        },
        {
            "sha": "1f9fac4437b528c110317acddeca5742914d3bac",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_test.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -38,6 +38,7 @@ limitations under the License.\n #include \"absl/synchronization/mutex.h\"\n #include \"absl/types/span.h\"\n #include \"xla/client/executable_build_options.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/hlo/parser/hlo_parser.h\"\n #include \"xla/literal.h\"\n@@ -48,7 +49,6 @@ limitations under the License.\n #include \"xla/pjrt/c/pjrt_c_api_test_base.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/service/hlo.pb.h\"\n@@ -678,7 +678,7 @@ TEST_F(PjrtCApiBufferTest, ToHostBufferNoHostLayout) {\n   args.event = nullptr;\n \n   PJRT_Error* error = api_->PJRT_Buffer_ToHostBuffer(&args);\n-  xla::PjRtFuture<> transfer_to_host =\n+  xla::Future<> transfer_to_host =\n       ::pjrt::ConvertCEventToCppFuture(args.event, api_);\n   TF_CHECK_OK(transfer_to_host.Await());\n "
        },
        {
            "sha": "1adba750e24c541be1907f1a4363fba02294b1e5",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_test_base.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -27,14 +27,14 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/types/span.h\"\n #include \"xla/client/executable_build_options.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/builder/xla_builder.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_helpers.h\"\n #include \"xla/pjrt/c/pjrt_c_api_wrapper_impl.h\"  // IWYU pragma: keep\n #include \"xla/pjrt/pjrt_client.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/service/computation_placer.h\"\n #include \"xla/shape.h\"\n@@ -186,7 +186,7 @@ PjrtCApiTestBase::create_buffer(PJRT_Device* device) {\n }\n \n std::pair<std::unique_ptr<PJRT_Buffer, ::pjrt::PJRT_BufferDeleter>,\n-          xla::PjRtFuture<>>\n+          xla::Future<>>\n PjrtCApiTestBase::create_iota_buffer(PJRT_Device* device) {\n   xla::Shape shape = xla::ShapeUtil::MakeShapeWithType<float>({4});\n   std::vector<float> float_data(4);\n@@ -195,7 +195,7 @@ PjrtCApiTestBase::create_iota_buffer(PJRT_Device* device) {\n }\n \n std::pair<std::unique_ptr<PJRT_Buffer, ::pjrt::PJRT_BufferDeleter>,\n-          xla::PjRtFuture<>>\n+          xla::Future<>>\n PjrtCApiTestBase::create_buffer_from_data(const std::vector<float>& float_data,\n                                           const xla::Shape& shape,\n                                           PJRT_Device* device) {\n@@ -221,7 +221,7 @@ PjrtCApiTestBase::create_buffer_from_data(const std::vector<float>& float_data,\n   auto ready_event_error =\n       ToUniquePtr(api_->PJRT_Buffer_ReadyEvent(&get_event_args));\n   EXPECT_EQ(ready_event_error, nullptr);\n-  xla::PjRtFuture<> buffer_ready_event =\n+  xla::Future<> buffer_ready_event =\n       ::pjrt::ConvertCEventToCppFuture(get_event_args.event, api_);\n \n   return std::make_pair(std::move(buffer), buffer_ready_event);"
        },
        {
            "sha": "238e8709fb87b99a84ed0a8a59643e136c5043a2",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_test_base.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_test_base.h?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -22,11 +22,11 @@ limitations under the License.\n #include \"absl/status/status.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/types/span.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_helpers.h\"\n #include \"xla/pjrt/pjrt_client.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/shape.h\"\n \n #ifndef XLA_PJRT_C_PJRT_C_API_TEST_BASE_H_\n@@ -86,14 +86,14 @@ class PjrtCApiTestBase : public ::testing::Test {\n       PJRT_Device* device = nullptr);\n \n   std::pair<std::unique_ptr<PJRT_Buffer, ::pjrt::PJRT_BufferDeleter>,\n-            xla::PjRtFuture<>>\n+            xla::Future<>>\n   create_buffer_from_data(const std::vector<float>& float_data,\n                           const xla::Shape& shape,\n                           PJRT_Device* device = nullptr);\n \n   // Create a buffer with shape 4xf32 and with values {41, 42, 43, 44}.\n   std::pair<std::unique_ptr<PJRT_Buffer, ::pjrt::PJRT_BufferDeleter>,\n-            xla::PjRtFuture<>>\n+            xla::Future<>>\n   create_iota_buffer(PJRT_Device* device = nullptr);\n \n   // Create an uninitialized buffer with shape 4xf32."
        },
        {
            "sha": "b9d10da4c049dd524aa6a2906545be68da918d32",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_wrapper_impl.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.cc?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -43,6 +43,7 @@ limitations under the License.\n #include \"mlir/IR/BuiltinOps.h\"\n #include \"mlir/IR/MLIRContext.h\"\n #include \"mlir/IR/OwningOpRef.h\"\n+#include \"xla/future.h\"\n #include \"xla/hlo/builder/xla_computation.h\"\n #include \"xla/hlo/ir/hlo_module.h\"\n #include \"xla/layout.h\"\n@@ -58,7 +59,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/pjrt_layout.h\"\n #include \"xla/pjrt/proto/compile_options.pb.h\"\n #include \"xla/pjrt/proto/topology_description.pb.h\"\n@@ -696,7 +696,7 @@ PJRT_Error* PJRT_AsyncHostToDeviceTransferManager_TransferData(\n       \"PJRT_AsyncHostToDeviceTransferManager_TransferData_Args\",\n       PJRT_AsyncHostToDeviceTransferManager_TransferData_Args_STRUCT_SIZE,\n       args->struct_size));\n-  auto [promise, future] = xla::PjRtFuture<>::MakePromise();\n+  auto [promise, future] = xla::Future<>::MakePromise();\n   absl::AnyInvocable<void() &&> on_done_with_d2h_transfer =\n       [promise = std::move(promise)]() mutable { promise.Set(); };\n   PJRT_RETURN_IF_ERROR(\n@@ -1040,7 +1040,7 @@ PJRT_Error* PJRT_Client_BufferFromHostBuffer(\n     }\n   }\n \n-  auto [promise, future] = xla::PjRtFuture<>::MakePromise();\n+  auto [promise, future] = xla::Future<>::MakePromise();\n \n   absl::AnyInvocable<void() &&> on_done_with_host_buffer =\n       [promise = std::move(promise)]() mutable { promise.Set(); };\n@@ -1849,7 +1849,7 @@ PJRT_Error* PJRT_LoadedExecutable_Execute(\n     std::vector<std::vector<std::unique_ptr<xla::PjRtBuffer>>> cpp_buffer_lists;\n     if (args->device_complete_events != nullptr ||\n         !cpp_send_callbacks->empty() || !cpp_recv_callbacks->empty()) {\n-      std::optional<std::vector<xla::PjRtFuture<>>> returned_futures;\n+      std::optional<std::vector<xla::Future<>>> returned_futures;\n       returned_futures.emplace();\n       PJRT_ASSIGN_OR_RETURN(cpp_buffer_lists,\n                             args->executable->get()->Execute(\n@@ -1858,7 +1858,7 @@ PJRT_Error* PJRT_LoadedExecutable_Execute(\n \n       // We assume that these OnReady callbacks will fire even if\n       // returned_futures is destroyed first. This is true for the\n-      // AsyncValue-based implementation of PjRtFuture.\n+      // AsyncValue-based implementation of Future.\n       if (!cpp_send_callbacks->empty() || !cpp_recv_callbacks->empty()) {\n         for (int i = 0; i < returned_futures->size(); ++i) {\n           (*returned_futures)[i].OnReady(\n@@ -1903,7 +1903,7 @@ PJRT_Error* PJRT_LoadedExecutable_Execute(\n     }\n \n     std::vector<std::unique_ptr<xla::PjRtBuffer>> cpp_buffer_list;\n-    std::optional<xla::PjRtFuture<>> returned_future;\n+    std::optional<xla::Future<>> returned_future;\n     bool fill_future = args->device_complete_events != nullptr;\n     PJRT_ASSIGN_OR_RETURN(\n         xla::CompileOptions compile_options,\n@@ -2175,7 +2175,7 @@ PJRT_Error* PJRT_Buffer_CopyRawToHost(PJRT_Buffer_CopyRawToHost_Args* args) {\n   PJRT_RETURN_IF_ERROR(ActualStructSizeIsGreaterOrEqual(\n       \"PJRT_Buffer_CopyRawToHost_Args\",\n       PJRT_Buffer_CopyRawToHost_Args_STRUCT_SIZE, args->struct_size));\n-  xla::PjRtFuture<> wrapped_promise = args->buffer->buffer->CopyRawToHost(\n+  xla::Future<> wrapped_promise = args->buffer->buffer->CopyRawToHost(\n       args->dst, args->offset, args->transfer_size);\n   args->event = new PJRT_Event{std::move(wrapped_promise)};\n   return nullptr;\n@@ -2252,7 +2252,7 @@ PJRT_Error* PJRT_Buffer_ToHostBuffer(PJRT_Buffer_ToHostBuffer_Args* args) {\n \n   auto literal = std::make_unique<xla::MutableBorrowingLiteral>(\n       static_cast<char*>(args->dst), host_shape);\n-  xla::PjRtFuture<> future = args->src->buffer->ToLiteral(literal.get());\n+  xla::Future<> future = args->src->buffer->ToLiteral(literal.get());\n \n   args->event = new PJRT_Event{std::move(future)};\n   args->event->future.OnReady(\n@@ -2275,7 +2275,7 @@ PJRT_Error* PJRT_Buffer_ReadyEvent(PJRT_Buffer_ReadyEvent_Args* args) {\n   PJRT_RETURN_IF_ERROR(ActualStructSizeIsGreaterOrEqual(\n       \"PJRT_Buffer_ReadyEvent_Args\", PJRT_Buffer_ReadyEvent_Args_STRUCT_SIZE,\n       args->struct_size));\n-  xla::PjRtFuture<> wrapped_promise = args->buffer->buffer->GetReadyFuture();\n+  xla::Future<> wrapped_promise = args->buffer->buffer->GetReadyFuture();\n   args->event = new PJRT_Event{std::move(wrapped_promise)};\n   return nullptr;\n }\n@@ -2353,7 +2353,7 @@ PJRT_Error* PJRT_CopyToDeviceStream_AddChunk(\n       \"PJRT_CopyToDeviceStream_AddChunk_Args\",\n       PJRT_CopyToDeviceStream_AddChunk_Args_STRUCT_SIZE, args->struct_size));\n \n-  xla::PjRtFuture<> future =\n+  xla::Future<> future =\n       args->stream->stream->AddChunk(ConvertToCppChunk(*args->chunk));\n   args->transfer_complete = new PJRT_Event{std::move(future)};\n   return nullptr;"
        },
        {
            "sha": "244e6d7f1c26bcf4a92fa7371cc04fc0e8acfa0d",
            "filename": "third_party/xla/xla/pjrt/c/pjrt_c_api_wrapper_impl.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/613ba1785629e275319e1dd9e7066b5872f8fdc5/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fpjrt%2Fc%2Fpjrt_c_api_wrapper_impl.h?ref=613ba1785629e275319e1dd9e7066b5872f8fdc5",
            "patch": "@@ -31,6 +31,7 @@ limitations under the License.\n #include \"absl/status/statusor.h\"\n #include \"absl/strings/string_view.h\"\n #include \"absl/synchronization/mutex.h\"\n+#include \"xla/future.h\"\n #include \"xla/pjrt/c/pjrt_c_api.h\"\n #include \"xla/pjrt/c/pjrt_c_api_helpers.h\"\n #include \"xla/pjrt/c/pjrt_c_api_layouts_extension.h\"\n@@ -40,7 +41,6 @@ limitations under the License.\n #include \"xla/pjrt/pjrt_compiler.h\"\n #include \"xla/pjrt/pjrt_device_description.h\"\n #include \"xla/pjrt/pjrt_executable.h\"\n-#include \"xla/pjrt/pjrt_future.h\"\n #include \"xla/pjrt/pjrt_layout.h\"\n #include \"xla/shape.h\"\n \n@@ -203,7 +203,7 @@ struct PJRT_FulfillAliasBufferCallback {\n };\n \n struct PJRT_Event {\n-  xla::PjRtFuture<> future;\n+  xla::Future<> future;\n };\n \n struct PJRT_SerializedExecutable {"
        }
    ],
    "stats": {
        "total": 121,
        "additions": 58,
        "deletions": 63
    }
}