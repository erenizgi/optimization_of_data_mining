{
    "author": "chsigg",
    "message": "NFC: Simplify padding logic in Split-K GEMM rewriter.\n\nRemove checks for `padded_k_size.has_value()` as `padded_k_size` is always expected to be present after its initialization. This simplifies the conditions for needing padding and the calculation of the padding amount.\n\nPiperOrigin-RevId: 820148929",
    "sha": "e17b7829f7c16e66388674df2ccf3c497b2a5fbb",
    "files": [
        {
            "sha": "9aea360ec38032e1582f57bae1052f8ee442f417",
            "filename": "third_party/xla/xla/service/gpu/split_k_gemm_rewriter.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/e17b7829f7c16e66388674df2ccf3c497b2a5fbb/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fsplit_k_gemm_rewriter.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/e17b7829f7c16e66388674df2ccf3c497b2a5fbb/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fsplit_k_gemm_rewriter.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fgpu%2Fsplit_k_gemm_rewriter.cc?ref=e17b7829f7c16e66388674df2ccf3c497b2a5fbb",
            "patch": "@@ -132,8 +132,7 @@ absl::StatusOr<HloInstruction*> MakeSplitKOperand(\n   const int64_t k = operand->shape().dimensions(contracting_dim_idx);\n   padded_k_size =\n       std::max(GetPaddedK(dot, k, config.split_k), padded_k_size.value_or(0));\n-  const bool need_padding =\n-      padded_k_size.has_value() ? k < *padded_k_size : k % config.split_k != 0;\n+  const bool need_padding = k < *padded_k_size;\n \n   auto check_if_supported = [&](const HloInstruction& hlo,\n                                 bool check_divisibility) {\n@@ -186,9 +185,7 @@ absl::StatusOr<HloInstruction*> MakeSplitKOperand(\n         dot.parent()->AddInstruction(HloInstruction::CreateConstant(\n             LiteralUtil::Zero(operand->shape().element_type())));\n \n-    int64_t padding = padded_k_size.has_value()\n-                          ? *padded_k_size - k\n-                          : config.split_k - k % config.split_k;\n+    int64_t padding = *padded_k_size - k;\n     PaddingConfig padding_config =\n         MakeNoPaddingConfig(operand->shape().dimensions().size());\n     padding_config.mutable_dimensions(contracting_dim_idx)"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 2,
        "deletions": 5
    }
}