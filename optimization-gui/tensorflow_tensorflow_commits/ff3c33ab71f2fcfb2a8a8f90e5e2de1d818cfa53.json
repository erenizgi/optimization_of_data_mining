{
    "author": "beckerhe",
    "message": "Remove unused nvtx_utils target\n\nThe code is not in use anymore and hasn't been for quite a while. Let's remove it.\n\nPiperOrigin-RevId: 818506241",
    "sha": "ff3c33ab71f2fcfb2a8a8f90e5e2de1d818cfa53",
    "files": [
        {
            "sha": "709feed81404f9addfd72ad1086ce8dcc12d2258",
            "filename": "third_party/xla/xla/backends/profiler/gpu/BUILD",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/ff3c33ab71f2fcfb2a8a8f90e5e2de1d818cfa53/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/ff3c33ab71f2fcfb2a8a8f90e5e2de1d818cfa53/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2FBUILD?ref=ff3c33ab71f2fcfb2a8a8f90e5e2de1d818cfa53",
            "patch": "@@ -216,7 +216,6 @@ cc_library(\n         \":cupti_interface\",\n         \":cupti_pm_sampler_factory\",\n         \":cupti_utils\",\n-        \":nvtx_utils\",\n         \"//xla/tsl/platform:env\",\n         \"//xla/tsl/platform:errors\",\n         \"//xla/tsl/platform:statusor\",\n@@ -436,23 +435,6 @@ cc_library(\n     ],\n )\n \n-cc_library(\n-    name = \"nvtx_utils\",\n-    srcs = [\"nvtx_utils.cc\"],\n-    hdrs = [\"nvtx_utils.h\"],\n-    # copybara:uncomment compatible_with = [\"//buildenv/target:non_prod\"],\n-    tags = [\n-        \"cuda-only\",\n-        \"gpu\",\n-    ],\n-    deps = [\n-        \"@com_google_absl//absl/strings\",\n-        \"@local_config_cuda//cuda:cuda_headers\",\n-        \"@local_tsl//tsl/platform\",\n-        \"@local_tsl//tsl/platform:macros\",\n-    ],\n-)\n-\n cc_library(\n     name = \"cupti_collector\",\n     srcs = [\"cupti_collector.cc\"],"
        },
        {
            "sha": "c4b38d899b08125af6f4de109cedcf0cb807eee6",
            "filename": "third_party/xla/xla/backends/profiler/gpu/nvtx_utils.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/993e1f75ad67d38951f0fda2c53b611a255816fa/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/993e1f75ad67d38951f0fda2c53b611a255816fa/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.cc?ref=993e1f75ad67d38951f0fda2c53b611a255816fa",
            "patch": "@@ -1,30 +0,0 @@\n-/* Copyright 2020 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#include \"xla/backends/profiler/gpu/nvtx_utils.h\"\n-\n-#include \"third_party/gpus/cuda/include/nvtx3/nvToolsExt.h\"\n-#include \"tsl/platform/platform.h\"\n-\n-namespace xla {\n-namespace profiler {\n-\n-/*static*/ std::stack<std::string> &NVTXRangeTracker::GetRangeStack() {\n-  static thread_local std::stack<std::string> range_stack;\n-  return range_stack;\n-}\n-\n-}  // namespace profiler\n-}  // namespace xla"
        },
        {
            "sha": "9f253659957cf2da45990185e98f9ca1d05c812c",
            "filename": "third_party/xla/xla/backends/profiler/gpu/nvtx_utils.h",
            "status": "removed",
            "additions": 0,
            "deletions": 61,
            "changes": 61,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/993e1f75ad67d38951f0fda2c53b611a255816fa/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/993e1f75ad67d38951f0fda2c53b611a255816fa/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fbackends%2Fprofiler%2Fgpu%2Fnvtx_utils.h?ref=993e1f75ad67d38951f0fda2c53b611a255816fa",
            "patch": "@@ -1,61 +0,0 @@\n-/* Copyright 2020 The OpenXLA Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-    http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-==============================================================================*/\n-\n-#ifndef XLA_BACKENDS_PROFILER_GPU_NVTX_UTILS_H_\n-#define XLA_BACKENDS_PROFILER_GPU_NVTX_UTILS_H_\n-\n-#include <stack>\n-\n-#include \"absl/strings/string_view.h\"\n-#include \"tsl/platform/macros.h\"\n-\n-namespace xla {\n-namespace profiler {\n-\n-/***\n- * TODO: After using CUPTI activity marker, remove NVTXRangeTracker related\n- * code.\n- * We have no intention to use NVTX in tensorflow right now, we use this class\n- * to track NVTX instrumentation inside NVIDIA libraries (such as TensorRT).\n- * This bears a lot of resemblance to ScopedAnnotation for now.  In the future,\n- * we will use TraceMe to keep track trace context within a thread.\n- */\n-class NVTXRangeTracker {\n- public:\n-  static void EnterRange(const std::string& range) {\n-    auto& range_stack = GetRangeStack();\n-    range_stack.push(range);\n-  }\n-  static void ExitRange() {\n-    auto& range_stack = GetRangeStack();\n-    if (!range_stack.empty()) range_stack.pop();\n-  }\n-  static const absl::string_view CurrentRange() {\n-    auto& range_stack = GetRangeStack();\n-    if (!range_stack.empty()) return range_stack.top();\n-    return \"\";\n-  }\n-\n- private:\n-  static std::stack<std::string>& GetRangeStack();\n-\n-  NVTXRangeTracker(const NVTXRangeTracker&) = delete;\n-  void operator=(const NVTXRangeTracker&) = delete;\n-};\n-\n-}  // namespace profiler\n-}  // namespace xla\n-\n-#endif  // XLA_BACKENDS_PROFILER_GPU_NVTX_UTILS_H_"
        }
    ],
    "stats": {
        "total": 109,
        "additions": 0,
        "deletions": 109
    }
}