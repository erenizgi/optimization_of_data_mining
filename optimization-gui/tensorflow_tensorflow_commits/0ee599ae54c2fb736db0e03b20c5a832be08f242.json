{
    "author": "penpornk",
    "message": "[xla:cpu] Avoid using `mkl_deps()` macro in XLA\n\nPiperOrigin-RevId: 805496433",
    "sha": "0ee599ae54c2fb736db0e03b20c5a832be08f242",
    "files": [
        {
            "sha": "82c9d57b746aaf9bac4a0eadf41f92652d14c511",
            "filename": "third_party/xla/xla/service/cpu/BUILD",
            "status": "modified",
            "additions": 19,
            "deletions": 10,
            "changes": 29,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/0ee599ae54c2fb736db0e03b20c5a832be08f242/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/0ee599ae54c2fb736db0e03b20c5a832be08f242/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fcpu%2FBUILD?ref=0ee599ae54c2fb736db0e03b20c5a832be08f242",
            "patch": "@@ -13,7 +13,7 @@ load(\n load(\"//xla/tests:build_defs.bzl\", \"xla_test\")\n load(\"//xla/tsl:tsl.bzl\", \"internal_visibility\", \"tsl_copts\")\n load(\"//xla/tsl:tsl.default.bzl\", \"filegroup\", \"get_compatible_with_portable\")\n-load(\"//xla/tsl/mkl:build_defs.bzl\", \"if_graph_api\", \"mkl_deps\")\n+load(\"//xla/tsl/mkl:build_defs.bzl\", \"if_graph_api\")\n load(\"//xla/tsl/platform:build_config.bzl\", \"tf_proto_library\")\n load(\n     \"//xla/tsl/platform:build_config_root.bzl\",\n@@ -1709,12 +1709,13 @@ cc_library(\n         \":onednn_config_proto_cc\",\n         \"//xla:xla_data_proto_cc\",\n         \"//xla/hlo/ir:hlo\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"//xla/tsl/platform:env\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1735,6 +1736,7 @@ cc_library(\n         \"//xla/service/llvm_ir:ir_array\",\n         \"//xla/service/llvm_ir:ir_builder_mixin\",\n         \"//xla/service/llvm_ir:llvm_util\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:dynamic_annotations\",\n         \"@com_google_absl//absl/status:statusor\",\n@@ -1744,7 +1746,7 @@ cc_library(\n         \"@llvm-project//mlir:IR\",\n         \"@local_tsl//tsl/platform:errors\",\n         \"@local_tsl//tsl/platform:logging\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1762,14 +1764,15 @@ cc_library(\n         \"//xla:executable_run_options\",\n         \"//xla:shape_util\",\n         \"//xla/hlo/ir:hlo\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:dynamic_annotations\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:logging\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1787,14 +1790,15 @@ cc_library(\n         \"//xla:executable_run_options\",\n         \"//xla:shape_util\",\n         \"//xla/hlo/ir:hlo\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:dynamic_annotations\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:logging\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1812,14 +1816,15 @@ cc_library(\n         \":onednn_memory_util\",\n         \":runtime_lightweight_check\",\n         \"//xla:executable_run_options\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"//xla/tsl/platform:env\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:dynamic_annotations\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1837,14 +1842,15 @@ cc_library(\n         \":onednn_memory_util\",\n         \":runtime_lightweight_check\",\n         \"//xla:executable_run_options\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"//xla/tsl/platform:env\",\n         \"@com_google_absl//absl/base:core_headers\",\n         \"@com_google_absl//absl/base:dynamic_annotations\",\n         \"@com_google_absl//absl/synchronization\",\n         \"@eigen_archive//:eigen3\",\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1855,7 +1861,8 @@ cc_library(\n         \":onednn_util\",\n         \"//xla/hlo/ir:hlo\",\n         \"//xla/service:pattern_matcher\",\n-    ] + mkl_deps(),\n+        \"//xla/tsl/mkl:onednn\",\n+    ],\n )\n \n cc_library(\n@@ -1886,6 +1893,7 @@ cc_library(\n         \"//xla/service:hlo_cost_analysis\",\n         \"//xla/service:hlo_creation_utils\",\n         \"//xla/service:pattern_matcher\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"//xla/tsl/platform:env\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@com_google_absl//absl/status:statusor\",\n@@ -1894,7 +1902,7 @@ cc_library(\n         \"@local_tsl//tsl/platform:env\",\n         \"@local_tsl//tsl/platform:logging\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library(\n@@ -1916,9 +1924,10 @@ cc_library(\n         \"//xla/hlo/pass:hlo_pass\",\n         \"//xla/service:hlo_creation_utils\",\n         \"//xla/service:pattern_matcher\",\n+        \"//xla/tsl/mkl:onednn\",\n         \"@com_google_absl//absl/algorithm:container\",\n         \"@local_tsl//tsl/platform:platform_port\",\n-    ] + mkl_deps(),\n+    ],\n )\n \n cc_library("
        }
    ],
    "stats": {
        "total": 29,
        "additions": 19,
        "deletions": 10
    }
}