{
    "author": "Matt-Hurd",
    "message": "Allow specifying a custom session id instead of always using timestamp.\n\nThis change introduces a `session_id` option in `ProfileOptions` and `RemoteProfilerSessionManagerOptions`. When provided, this id will be used as the subdirectory for storing profile data, instead of the default timestamp.\n\nPiperOrigin-RevId: 825216123",
    "sha": "803a513588af01e17b02ab2fe8fc9771c3cce8a5",
    "files": [
        {
            "sha": "1ec0c5d2a473ec78aaf63e35c123d147d7d48799",
            "filename": "third_party/xla/xla/tsl/profiler/rpc/client/capture_profile.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Frpc%2Fclient%2Fcapture_profile.cc?ref=803a513588af01e17b02ab2fe8fc9771c3cce8a5",
            "patch": "@@ -199,8 +199,10 @@ absl::Status CaptureRemoteTrace(const std::string& logdir,\n   DCHECK_GT(opts.profiler_options().duration_ms(), 0);\n   DCHECK(!opts.service_addresses().empty());\n \n-  // Use the current timestamp as the run name.\n-  std::string session_id = GetCurrentTimeStampAsString();\n+  // Sets the session ID if provided, otherwise uses the current timestamp.\n+  std::string session_id = opts.profiler_options().session_id().empty()\n+                               ? GetCurrentTimeStampAsString()\n+                               : opts.profiler_options().session_id();\n   std::string repository_root = GetTensorBoardProfilePluginDir(logdir);\n   auto duration_ms = opts.profiler_options().duration_ms();\n "
        },
        {
            "sha": "864452e7a93aeed19f3450a8fab88ef198a04cd5",
            "filename": "third_party/xla/xla/tsl/profiler/utils/BUILD",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2FBUILD",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2FBUILD",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2FBUILD?ref=803a513588af01e17b02ab2fe8fc9771c3cce8a5",
            "patch": "@@ -486,6 +486,18 @@ cc_library(\n     ],\n )\n \n+tsl_cc_test(\n+    name = \"session_manager_test\",\n+    srcs = [\"session_manager_test.cc\"],\n+    deps = [\n+        \":session_manager\",\n+        \"//xla/tsl/platform:test\",\n+        \"@com_google_absl//absl/container:flat_hash_map\",\n+        \"@com_google_absl//absl/strings:string_view\",\n+        \"@com_google_googletest//:gtest_main\",\n+    ],\n+)\n+\n cc_library(\n     name = \"timestamp_utils\",\n     srcs = [\"timestamp_utils.cc\"],"
        },
        {
            "sha": "9126cb214e4a83aa46c3f436e99fdfa8aea78e55",
            "filename": "third_party/xla/xla/tsl/profiler/utils/session_manager.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager.cc?ref=803a513588af01e17b02ab2fe8fc9771c3cce8a5",
            "patch": "@@ -136,6 +136,13 @@ RemoteProfilerSessionManagerOptions GetRemoteSessionManagerOptionsLocked(\n             options.set_delay_ms(value);\n           },\n           nullptr);\n+    } else if (key == \"session_id\") {\n+      SetOption<std::string>(\n+          key, kw.second,\n+          [&options](tensorflow::ProfileOptions*, std::string value) {\n+            options.mutable_profiler_options()->set_session_id(value);\n+          },\n+          nullptr);\n     } else {\n       LOG(WARNING) << \"Unrecognised key: \" << key;\n     }"
        },
        {
            "sha": "2bd018d684c91ce14385c7063aa8668a75ef239f",
            "filename": "third_party/xla/xla/tsl/profiler/utils/session_manager_test.cc",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager_test.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/803a513588af01e17b02ab2fe8fc9771c3cce8a5/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager_test.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Ftsl%2Fprofiler%2Futils%2Fsession_manager_test.cc?ref=803a513588af01e17b02ab2fe8fc9771c3cce8a5",
            "patch": "@@ -0,0 +1,50 @@\n+/* Copyright 2025 The OpenXLA Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#include \"xla/tsl/profiler/utils/session_manager.h\"\n+\n+#include <string>\n+#include <variant>\n+\n+#include \"absl/container/flat_hash_map.h\"\n+#include \"absl/strings/string_view.h\"\n+#include \"xla/tsl/platform/test.h\"\n+\n+namespace tsl {\n+namespace profiler {\n+namespace {\n+\n+using tensorflow::RemoteProfilerSessionManagerOptions;\n+\n+TEST(SessionManagerTest, OptionsWithSessionIdTest) {\n+  absl::string_view logdir = \"/tmp/logdir\";\n+  absl::flat_hash_map<std::string, std::variant<bool, int, std::string>> opts;\n+  opts[\"session_id\"] = std::string(\"test_session_id\");\n+  RemoteProfilerSessionManagerOptions options =\n+      GetRemoteSessionManagerOptionsLocked(logdir, opts);\n+  EXPECT_EQ(options.profiler_options().session_id(), \"test_session_id\");\n+}\n+\n+TEST(SessionManagerTest, OptionsWithoutSessionIdTest) {\n+  absl::string_view logdir = \"/tmp/logdir\";\n+  absl::flat_hash_map<std::string, std::variant<bool, int, std::string>> opts;\n+  RemoteProfilerSessionManagerOptions options =\n+      GetRemoteSessionManagerOptionsLocked(logdir, opts);\n+  EXPECT_EQ(options.profiler_options().session_id().empty(), true);\n+}\n+\n+}  // namespace\n+}  // namespace profiler\n+}  // namespace tsl"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 73,
        "deletions": 2
    }
}