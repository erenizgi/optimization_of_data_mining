{
    "author": "WillFroom",
    "message": "[XTile] Modify Stable HLO check on iota to restrict it to the 1D case.\n\nPiperOrigin-RevId: 826085272",
    "sha": "6dd75c4e8bb20ac9a8023971b591c0a500ae6a85",
    "files": [
        {
            "sha": "9a45785b541c16cca124b2d68e68bb1f24a65a2a",
            "filename": "third_party/xla/xla/codegen/xtile/ir/transforms/tests/verify_legal_xtile_ops.mlir",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6dd75c4e8bb20ac9a8023971b591c0a500ae6a85/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Ftests%2Fverify_legal_xtile_ops.mlir",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6dd75c4e8bb20ac9a8023971b591c0a500ae6a85/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Ftests%2Fverify_legal_xtile_ops.mlir",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Ftests%2Fverify_legal_xtile_ops.mlir?ref=6dd75c4e8bb20ac9a8023971b591c0a500ae6a85",
            "patch": "@@ -10,3 +10,9 @@ xtile.entry_func @fails_illegal_op(%arg0: memref<2xf32>, %arg1: index) {\n }\n \n // -----\n+\n+func.func @iota_2d_fails() -> tensor<2x2xi32> {\n+  // expected-error @+1 {{Only 1D iota is supported}}\n+  %0 = stablehlo.iota dim = 0 :  tensor<2x2xi32>\n+  return %0 : tensor<2x2xi32>\n+}"
        },
        {
            "sha": "a24553b8cfa96f15e931c047fde9e4ac896e27f5",
            "filename": "third_party/xla/xla/codegen/xtile/ir/transforms/verify_legal_xtile_ops.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/6dd75c4e8bb20ac9a8023971b591c0a500ae6a85/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Fverify_legal_xtile_ops.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/6dd75c4e8bb20ac9a8023971b591c0a500ae6a85/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Fverify_legal_xtile_ops.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fcodegen%2Fxtile%2Fir%2Ftransforms%2Fverify_legal_xtile_ops.cc?ref=6dd75c4e8bb20ac9a8023971b591c0a500ae6a85",
            "patch": "@@ -83,8 +83,16 @@ std::optional<absl::string_view> IsLegalTensorOp(mlir::Operation* op) {\n std::optional<absl::string_view> IsLegalStablehloOp(mlir::Operation* op) {\n   if (mlir::isa<mlir::stablehlo::BroadcastInDimOp, mlir::stablehlo::ReduceOp,\n                 mlir::stablehlo::ReturnOp, mlir::stablehlo::TransposeOp,\n-                mlir::stablehlo::IotaOp, mlir::stablehlo::DotGeneralOp,\n-                mlir::stablehlo::ReshapeOp>(op)) {\n+                mlir::stablehlo::DotGeneralOp, mlir::stablehlo::ReshapeOp>(\n+          op)) {\n+    return std::nullopt;\n+  }\n+\n+  if (auto iota = mlir::dyn_cast<mlir::stablehlo::IotaOp>(op)) {\n+    if (iota.getType().getRank() != 1) {\n+      return \"Only 1D iota is supported\";\n+    }\n+\n     return std::nullopt;\n   }\n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 16,
        "deletions": 2
    }
}