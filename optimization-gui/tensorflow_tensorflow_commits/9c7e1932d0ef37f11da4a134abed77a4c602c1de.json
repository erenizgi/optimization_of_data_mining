{
    "author": "unknown",
    "message": "[XLA] Add googletest wrapper that adds status asserts to gmock.h\n\nAnd replace @com_google_googletest for internal uses. The only\nexceptions that still need to rely on upstream googletest (renamed to\n@com_google_googletest_upstream) is the wrapper itself.\n\nThis makes it possible to use the same assert macros internally and in\nOSS.\n\nPiperOrigin-RevId: 838838925",
    "sha": "9c7e1932d0ef37f11da4a134abed77a4c602c1de",
    "files": [
        {
            "sha": "a5fd9f6109bb58266e296f591db2af071ba12e8c",
            "filename": "third_party/xla/MODULE.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2FMODULE.bazel?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -10,7 +10,8 @@ bazel_dep(name = \"bazel_skylib\", version = \"1.8.1\")\n bazel_dep(name = \"boringssl\", version = \"0.20250818.0\")\n bazel_dep(name = \"curl\", version = \"8.11.0\")\n bazel_dep(name = \"google_benchmark\", version = \"1.8.5\", repo_name = \"com_google_benchmark\")\n-bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest\")\n+bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest_upstream\")\n+bazel_dep(name = \"xla_googletest_wrapper\", version = \"1.0\", repo_name = \"com_google_googletest\")\n bazel_dep(name = \"grpc\", version = \"1.74.1\", repo_name = \"com_github_grpc_grpc\")\n bazel_dep(name = \"gutil\", version = \"20250502.0\", repo_name = \"com_google_gutil\");\n bazel_dep(name = \"jsoncpp\", version = \"1.9.6\", repo_name = \"jsoncpp_git\")\n@@ -74,6 +75,11 @@ archive_override(\n     urls = [\"https://github.com/google/googletest/archive/28e9d1f26771c6517c3b4be10254887673c94018.zip\"],\n )\n \n+local_path_override(\n+    module_name = \"xla_googletest_wrapper\",\n+    path = \"third_party/xla_googletest_wrapper\",\n+)\n+\n ##############################################################\n # C++ dependencies\n "
        },
        {
            "sha": "4a78380bc9dd7dc1bd3ceef41939c7aeb76349b5",
            "filename": "third_party/xla/opensource_only.files",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fopensource_only.files",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fopensource_only.files",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fopensource_only.files?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -155,4 +155,6 @@ xla/third_party/tensorrt/tensorrt/include/tensorrt_config.h.tpl:\n xla/third_party/tensorrt/tensorrt/tensorrt_config.py.tpl:\n xla/third_party/tensorrt/tensorrt_configure.bzl:\n xla/third_party/tensorrt/workspace.bzl:\n+xla/third_party/xla_googletest_wrapper/include/gmock/gmock.h:\n+xla/third_party/xla_googletest_wrapper/include/gtest/gtest.h:\n xla/third_party/zlib.BUILD:"
        },
        {
            "sha": "c333ce54a8cbaa721d10f47d7694b97f7c0d6179",
            "filename": "third_party/xla/third_party/gutil/workspace.bzl",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fgutil%2Fworkspace.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fgutil%2Fworkspace.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fgutil%2Fworkspace.bzl?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -14,9 +14,4 @@ def repo():\n         sha256 = GUTIL_SHA256,\n         strip_prefix = \"gutil-{commit}\".format(commit = GUTIL_COMMIT),\n         urls = tf_mirror_urls(\"https://github.com/google/gutil/archive/{commit}.tar.gz\".format(commit = GUTIL_COMMIT)),\n-        repo_mapping = {\n-            \"@absl-cpp\": \"@com_google_absl\",\n-            \"@google_benchmark\": \"@com_google_benchmark\",\n-            \"@googletest\": \"@com_google_googletest\",\n-        },\n     )"
        },
        {
            "sha": "09ae2f3c729c6eb6969484353fd307ca4fcb6198",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/BUILD.bazel",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FBUILD.bazel?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,38 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+cc_library(\n+    name = \"gtest\",\n+    # Upstream gtest is *not* marked testonly for some reason, but\n+    # gutil:status_matchers is, and non-testonly targets can't depend on\n+    # testonly ones.\n+    #\n+    # XLA doesn't use gtest in non-testonly targets though so making this\n+    # testonly should (TM) be fine.\n+    testonly = True,\n+    hdrs = [\n+        \"include/gmock/gmock.h\",\n+        \"include/gtest/gtest.h\",\n+    ],\n+    includes = [\n+        \"include\",\n+    ],\n+    deps = [\n+        \"@com_google_absl//absl/status\",\n+        \"@com_google_absl//absl/status:statusor\",\n+        \"@com_google_googletest_upstream//:gtest\",\n+    ],\n+)\n+\n+cc_library(\n+    name = \"gtest_main\",\n+    testonly = True,\n+    deps = [\n+        \":gtest\",\n+        \"@com_google_googletest_upstream//:gtest_main\",\n+    ],\n+)\n+\n+alias(\n+    name = \"gtest_for_library\",\n+    actual = \":gtest\",\n+)"
        },
        {
            "sha": "24583fb0d3406aaddc7b16d68c381c82414f5405",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/MODULE.bazel",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FMODULE.bazel?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,4 @@\n+module(name = \"xla_googletest_wrapper\", version = \"1.0\")\n+\n+bazel_dep(name = \"abseil-cpp\", version = \"20250814.0\", repo_name = \"com_google_absl\")\n+bazel_dep(name = \"googletest\", version = \"1.17.0\", repo_name = \"com_google_googletest_upstream\")"
        },
        {
            "sha": "f2065e18995bd403b06e4efa3526f8201590f73c",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/README.md",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREADME.md?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,5 @@\n+A gtest wrapper that adds ASSERT_OK, EXPECT_OK, ASSERT_OK_AND_ASSIGN to gmock.h\n+so that the header's provided functionality matches internal gmock.\n+\n+The repo contains a minimal set of reexports necessary to build XLA with this as\n+a drop-in replacement for googletest.\n\\ No newline at end of file"
        },
        {
            "sha": "1bab3de8da46377d55733de45ea18055628d2089",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/REPO.bazel",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2FREPO.bazel?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1 @@\n+# Mark the repo as a bazel repo."
        },
        {
            "sha": "0f980ef53dd946f9423484e02c3d7b720073d8c2",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/googletest_deps.bzl",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Fgoogletest_deps.bzl?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,8 @@\n+\"\"\"Reexports googletest_deps from upstream googletest.\"\"\"\n+\n+# protobuf loads for @com_google_googletest//:googletest_deps.bzl so we need to\n+# provide one in the wrapper.\n+load(\"@com_google_googletest_upstream//:googletest_deps.bzl\", upstream_deps = \"googletest_deps\")\n+\n+def googletest_deps():\n+    upstream_deps()"
        },
        {
            "sha": "1d8aa31e110661365c1ad8001a587c82f0b40fd8",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/include/gmock/gmock.h",
            "status": "added",
            "additions": 129,
            "deletions": 0,
            "changes": 129,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgmock%2Fgmock.h?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,129 @@\n+/* Copyright 2025 The Abseil Authors & TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n+#define GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_\n+\n+// gmock/gmock.h wrapper that also provides assert macros.\n+//\n+// These already exist in internal version of gmock, but upstream version\n+// doesn't have them. We use this wrapper to make dependency translation when\n+// exporting to OSS easier.\n+//\n+// - We want to use standard internal header and ASSERT_OK, EXPECT_OK macros\n+//   when developing internally.\n+// - We want the same macros to work externally, rather than having to add or\n+//   strip TF_ prefix.\n+// - We want the OSS export to still work after the export and header\n+//   translation.\n+// - We want to minimize the amount of patching third party projects to reduce\n+//   maintenance overhead.\n+// - To ensure the OSS patches cleanly apply onto internal repo, we need the\n+//   header translation to be reversible, which requires 1:1 header mapping.\n+//\n+// To achieve this, we swap out gmock.h for this wrapper in all XLA code, which\n+// should (TM) make ASSERT_OK/EXPECT_OK \"just work\" in all XLA tests.\n+//\n+// The only way to make this work without patching googletest and/or absl is to\n+// make XLA *always* use this wrapper, and *never* directly depend on upstream\n+// googletest.\n+//\n+// absl/status/status_matchers.h depends on gmock.h, so we can't simply add it\n+// here. This causes either:\n+//\n+// - A circular dependency between this and absl - which bazel doesn't allow,\n+// - absl dependency on the upstream gmock - which depending on the dependency\n+//   graph structure may introduce upstream gmock include path *before* one\n+//   defined in here, so we end up with *sometimes* including the wrong one and\n+//   the entire idea of drop-in replacing gmock.h goes out of the window.\n+\n+#include_next \"gmock/gmock.h\"\n+\n+#include \"absl/status/status.h\"\n+#include \"absl/status/statusor.h\"\n+\n+// Macros for testing the results of functions that return absl::Status or\n+// absl::StatusOr<T> (for any type T).\n+#define EXPECT_OK(expression) \\\n+  EXPECT_THAT(expression, ::xla_testing::internal::IsOk())\n+#define ASSERT_OK(expression) \\\n+  ASSERT_THAT(expression, ::xla_testing::internal::IsOk())\n+\n+#define ASSERT_OK_AND_ASSIGN(lhs, rexpr)                            \\\n+  TF_ASSERT_OK_AND_ASSIGN_IMPL(                                     \\\n+      XLA_STATUS_MACROS_CONCAT_NAME(_status_or_value, __COUNTER__), \\\n+      lhs, rexpr);\n+\n+#define ASSERT_OK_AND_ASSIGN_IMPL(statusor, lhs, rexpr) \\\n+  auto statusor = (rexpr);                              \\\n+  ASSERT_OK(statusor.status());                         \\\n+  lhs = std::move(statusor).value()\n+\n+#define XLA_STATUS_MACROS_CONCAT_NAME(x, y) XLA_STATUS_MACROS_CONCAT_IMPL(x, y)\n+#define XLA_STATUS_MACROS_CONCAT_IMPL(x, y) x##y\n+\n+namespace xla_testing {\n+namespace internal {\n+\n+// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+inline const absl::Status& GetStatus(const absl::Status& status) {\n+  return status;\n+}\n+\n+// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+template <typename T>\n+inline const absl::Status& GetStatus(const absl::StatusOr<T>& status) {\n+  return status.status();\n+}\n+\n+// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+//\n+// Monomorphic implementation of matcher IsOk() for a given type T.\n+// T can be Status, StatusOr<>, or a reference to either of them.\n+template <typename T>\n+class MonoIsOkMatcherImpl : public ::testing::MatcherInterface<T> {\n+ public:\n+  void DescribeTo(std::ostream* os) const override { *os << \"is OK\"; }\n+  void DescribeNegationTo(std::ostream* os) const override {\n+    *os << \"is not OK\";\n+  }\n+  bool MatchAndExplain(T actual_value,\n+                       ::testing::MatchResultListener*) const override {\n+    return GetStatus(actual_value).ok();\n+  }\n+};\n+\n+// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+//\n+// Implements IsOk() as a polymorphic matcher.\n+class IsOkMatcher {\n+ public:\n+  template <typename T>\n+  /*implicit*/ operator ::testing::Matcher<T>() const {  // NOLINT\n+    return ::testing::Matcher<T>(new MonoIsOkMatcherImpl<const T&>());\n+  }\n+};\n+\n+// DO NOT USE DIRECTLY. Use absl/status/status_matchers.h instead.\n+//\n+// Returns a gMock matcher that matches a Status or StatusOr<> which is OK.\n+inline ::xla_testing::internal::IsOkMatcher IsOk() {\n+  return ::xla_testing::internal::IsOkMatcher();\n+}\n+\n+}  // namespace internal\n+}  // namespace xla_testing\n+\n+#endif  // GOOGLETEST_WRAPPER_GMOCK_GMOCK_H_"
        },
        {
            "sha": "c903698baf0922053c67fec84c8c566b7e8624b1",
            "filename": "third_party/xla/third_party/xla_googletest_wrapper/include/gtest/gtest.h",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fthird_party%2Fxla_googletest_wrapper%2Finclude%2Fgtest%2Fgtest.h?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -0,0 +1,21 @@\n+/* Copyright 2025 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+==============================================================================*/\n+\n+#ifndef GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_\n+#define GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_\n+\n+#include_next \"gtest/gtest.h\"\n+\n+#endif  // GOOGLETEST_WRAPPER_INCLUDE_GTEST_GTEST_H_"
        },
        {
            "sha": "43d5f037bc7fb0dfde943520e10839712e4b195f",
            "filename": "third_party/xla/workspace2.bzl",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fworkspace2.bzl",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/9c7e1932d0ef37f11da4a134abed77a4c602c1de/third_party%2Fxla%2Fworkspace2.bzl",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fworkspace2.bzl?ref=9c7e1932d0ef37f11da4a134abed77a4c602c1de",
            "patch": "@@ -7,7 +7,7 @@ load(\"@bazel_tools//tools/build_defs/repo:utils.bzl\", \"maybe\")\n load(\"@io_bazel_rules_closure//closure:defs.bzl\", \"filegroup_external\")\n load(\"@rules_ml_toolchain//gpu/sycl:sycl_configure.bzl\", \"sycl_configure\")\n load(\"@rules_ml_toolchain//gpu/sycl:sycl_init_repository.bzl\", \"sycl_init_repository\")\n-load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\")\n+load(\"//third_party:repo.bzl\", \"tf_http_archive\", \"tf_mirror_urls\", \"tf_vendored\")\n load(\"//third_party/absl:workspace.bzl\", absl = \"repo\")\n load(\"//third_party/benchmark:workspace.bzl\", benchmark = \"repo\")\n load(\"//third_party/clang_toolchain:cc_configure_clang.bzl\", \"cc_download_clang_toolchain\")\n@@ -305,8 +305,25 @@ def _tf_repositories():\n         },\n     )\n \n-    tf_http_archive(\n+    # We use a vendored wrapper over googletest to provide\n+    # ASSERT_OK/EXPECT_OK/ASSERT_OK_AND_ASSIGN macros through gmock/gmock.h.\n+    #\n+    # Internal gmock includes those macros, but the external one doesn't. This\n+    # caused issues where internal builds succeed, but the copybara export to\n+    # github doesn't compile because those macros are not defined. The\n+    # workaround was to use custom TF_-prefixed variants of those macros.\n+    #\n+    # This wrapper lets us have the same code work in both by just swapping the\n+    # internal header with gmock/gmock.h. This applies to XLA only, not to TF,\n+    # so the TF_ macros that are still in use there must stay, and can't just\n+    # expand to non-TF_ variants as.\n+    tf_vendored(\n         name = \"com_google_googletest\",\n+        path = \"third_party/xla_googletest_wrapper\",\n+    )\n+\n+    tf_http_archive(\n+        name = \"com_google_googletest_upstream\",\n         # Use the commit on 2025/6/09:\n         # https://github.com/google/googletest/commit/28e9d1f26771c6517c3b4be10254887673c94018\n         sha256 = \"f253ca1a07262f8efde8328e4b2c68979e40ddfcfc001f70d1d5f612c7de2974\","
        }
    ],
    "stats": {
        "total": 242,
        "additions": 234,
        "deletions": 8
    }
}