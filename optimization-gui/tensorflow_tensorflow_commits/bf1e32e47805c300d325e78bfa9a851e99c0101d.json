{
    "author": "ZixuanJiang",
    "message": "Refactor `sdy_round_trip/shard_map_import`.\n\nPure refactoring.\n\nPiperOrigin-RevId: 810193987",
    "sha": "bf1e32e47805c300d325e78bfa9a851e99c0101d",
    "files": [
        {
            "sha": "2cdb1d7abc0ef7e06e49f0c15dba806ad6cd7416",
            "filename": "third_party/xla/xla/service/spmd/shardy/sdy_round_trip/shard_map_import.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/bf1e32e47805c300d325e78bfa9a851e99c0101d/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fshard_map_import.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/bf1e32e47805c300d325e78bfa9a851e99c0101d/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fshard_map_import.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/third_party%2Fxla%2Fxla%2Fservice%2Fspmd%2Fshardy%2Fsdy_round_trip%2Fshard_map_import.cc?ref=bf1e32e47805c300d325e78bfa9a851e99c0101d",
            "patch": "@@ -17,7 +17,6 @@ limitations under the License.\n \n #include <cassert>\n #include <memory>\n-#include <utility>\n \n #include \"absl/log/check.h\"\n #include \"llvm/ADT/DenseSet.h\"\n@@ -44,6 +43,7 @@ limitations under the License.\n #include \"mlir/Pass/PassRegistry.h\"\n #include \"mlir/Support/LLVM.h\"\n #include \"mlir/Support/TypeID.h\"\n+#include \"mlir/Support/WalkResult.h\"\n #include \"mlir/Transforms/DialectConversion.h\"\n #include \"shardy/dialect/sdy/ir/dialect.h\"\n #include \"shardy/dialect/sdy/ir/utils.h\"\n@@ -58,7 +58,6 @@ namespace {\n \n using ::mlir::MLIRContext;\n using ::mlir::ModuleOp;\n-using ::mlir::OpConversionPattern;\n using ::mlir::StringRef;\n using ::mlir::SymbolTable;\n using ::mlir::func::CallOp;\n@@ -112,8 +111,8 @@ mlir::LogicalResult rewriteManualComputation(\n              << kGlobalToLocalShapeCallTargetName << \" CustomCallOp\";\n     }\n     globalToLocalShape = (*customCallResIt).getDefiningOp<CustomCallOp>();\n-    CHECK(globalToLocalShape.getCallTargetName() ==\n-          kGlobalToLocalShapeCallTargetName);\n+    CHECK_EQ(globalToLocalShape.getCallTargetName(),\n+             kGlobalToLocalShapeCallTargetName);\n     operands = globalToLocalShape->getOperands();\n   }\n \n@@ -131,8 +130,8 @@ mlir::LogicalResult rewriteManualComputation(\n              << callOp.getCalleeAttr() << \" to be a \"\n              << kLocalToGlobalShapeCallTargetName << \" CustomCallOp\";\n     }\n-    CHECK(localToGlobalShape.getCallTargetName() ==\n-          kLocalToGlobalShapeCallTargetName);\n+    CHECK_EQ(localToGlobalShape.getCallTargetName(),\n+             kLocalToGlobalShapeCallTargetName);\n     resultTypes = localToGlobalShape->getResultTypes();\n   }\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 5,
        "deletions": 6
    }
}