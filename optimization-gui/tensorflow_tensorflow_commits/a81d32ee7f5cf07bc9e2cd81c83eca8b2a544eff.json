{
    "author": "ezhulenev",
    "message": "[tensorflow] Move small and hot RefCount function to header file\n\nPiperOrigin-RevId: 806338911",
    "sha": "a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff",
    "files": [
        {
            "sha": "1b03732fabfcf695d50f816a440b36f4efd84a0b",
            "filename": "tensorflow/core/framework/tensor.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff/tensorflow%2Fcore%2Fframework%2Ftensor.cc",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff/tensorflow%2Fcore%2Fframework%2Ftensor.cc",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2Ftensor.cc?ref=a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff",
            "patch": "@@ -927,22 +927,6 @@ absl::Status Tensor::BitcastFrom(const Tensor& other, DataType dtype,\n   return absl::OkStatus();\n }\n \n-// Notice that buf_ either points to a regular TensorBuffer or a SubBuffer.\n-// For the latter case, we have to make sure that the refcount is\n-// one both for the SubBuffer _and_ the underlying TensorBuffer.\n-bool Tensor::RefCountIsOne() const {\n-  return buf_ != nullptr && buf_->RefCountIsOne() &&\n-         buf_->root_buffer()->RefCountIsOne() && buf_->OwnsMemory();\n-}\n-\n-int Tensor::RefCount() const {\n-  if (buf_->root_buffer() != buf_) {\n-    LOG(ERROR) << \"Tensor RefCount not reliable if buf_ points to a SubBuffer.\";\n-    return -1;\n-  }\n-  return buf_->RefCount();\n-}\n-\n // The macro CASES() expands to a switch statement conditioned on\n // TYPE_ENUM. Each case expands the STMTS after a typedef for T.\n #define SINGLE_ARG(...) __VA_ARGS__"
        },
        {
            "sha": "c66f206c471d91b3377495962843abf9512ce1d6",
            "filename": "tensorflow/core/framework/tensor.h",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/tensorflow/tensorflow/blob/a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff/tensorflow%2Fcore%2Fframework%2Ftensor.h",
            "raw_url": "https://github.com/tensorflow/tensorflow/raw/a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff/tensorflow%2Fcore%2Fframework%2Ftensor.h",
            "contents_url": "https://api.github.com/repos/tensorflow/tensorflow/contents/tensorflow%2Fcore%2Fframework%2Ftensor.h?ref=a81d32ee7f5cf07bc9e2cd81c83eca8b2a544eff",
            "patch": "@@ -677,11 +677,24 @@ class Tensor {\n \n   // Returns true if the refcount on buf_ and any possible underlying root\n   // buffer is one.\n-  bool RefCountIsOne() const;\n+  bool RefCountIsOne() const {\n+    // Notice that buf_ either points to a regular TensorBuffer or a SubBuffer.\n+    // For the latter case, we have to make sure that the refcount is\n+    // one both for the SubBuffer _and_ the underlying TensorBuffer.\n+    return buf_ != nullptr && buf_->RefCountIsOne() &&\n+           buf_->root_buffer()->RefCountIsOne() && buf_->OwnsMemory();\n+  }\n \n   // Experimental. Returns the refcount on buf_ if it points to a regular\n   // TensorBuffer. If buf_ points to a SubBuffer, returns -1.\n-  int RefCount() const;\n+  int RefCount() const {\n+    if (buf_->root_buffer() != buf_) {\n+      LOG(ERROR)\n+          << \"Tensor RefCount not reliable if buf_ points to a SubBuffer.\";\n+      return -1;\n+    }\n+    return buf_->RefCount();\n+  }\n \n   // Returns the type of the underlying memory.\n   AllocatorMemoryType GetMemoryType() const { return buf_->GetMemoryType(); }"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 15,
        "deletions": 18
    }
}