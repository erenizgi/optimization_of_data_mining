{
    "author": "josephperrott",
    "message": "ci: separate the windows CI tests into build and test (#39289)\n\nBecause the compiler-cli tests modify node_modules, this can cause\nfailures on windows CI specifically as node_modules are symlinked\nto rather than copied.  By running the test and build actions in\nseparate commands, all of the tests are built to be executed before\nand tests are executed and modify the node_modules content.\n\nPR Close #39289",
    "sha": "b5ec5a7fcae68f03823238aeed7e4a7ead38962b",
    "files": [
        {
            "sha": "309b1cba132144b9c4b37de9688b1a0f1824f192",
            "filename": ".circleci/bazel.windows.rc",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/.circleci%2Fbazel.windows.rc",
            "raw_url": "https://github.com/angular/angular/raw/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/.circleci%2Fbazel.windows.rc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fbazel.windows.rc?ref=b5ec5a7fcae68f03823238aeed7e4a7ead38962b",
            "patch": "@@ -6,10 +6,6 @@\n # https://docs.bazel.build/versions/master/guide.html#bazelrc-syntax-and-semantics\n try-import %workspace%/.circleci/bazel.common.rc\n \n-# Save downloaded repositories in a location that can be cached by CircleCI. This helps us\n-# speeding up the analysis time significantly with Bazel managed node dependencies on the CI.\n-build --repository_cache=C:/Users/circleci/bazel_repository_cache\n-\n # Manually set the local resources used in windows CI runs\n build --local_ram_resources=120000\n build --local_cpu_resources=32"
        },
        {
            "sha": "24b56f788dc457fd88aadb5c91fbd57da48097c7",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=b5ec5a7fcae68f03823238aeed7e4a7ead38962b",
            "patch": "@@ -748,19 +748,26 @@ jobs:\n     steps:\n       - setup_win\n       - run:\n-          # Ran into a command parsing problem where `-browser:chromium-local` was converted to\n-          # `-browser: chromium-local` (a space was added) in https://circleci.com/gh/angular/angular/357511.\n-          # Probably a powershell command parsing thing. There's no problem using a yarn script though.\n-          command: yarn circleci-win-ve\n-          no_output_timeout: 45m\n+          name: Build all windows CI targets\n+          command: yarn bazel build --build_tag_filters=-ivy-only //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          no_output_timeout: 15m\n+      - run:\n+          name: Test all windows CI targets\n+          command: yarn bazel test --test_tag_filters=\"-ivy-only,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          no_output_timeout: 15m\n \n   test_ivy_aot_win:\n     executor: windows-executor\n     steps:\n       - setup_win\n       - run:\n-          command: yarn circleci-win-ivy\n-          no_output_timeout: 45m\n+          name: Build all windows CI targets\n+          command: yarn bazel build --config=ivy --build_tag_filters=-no-ivy-aot,-fixme-ivy-aot //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          no_output_timeout: 15m\n+      - run:\n+          name: Test all windows CI targets\n+          command: yarn bazel test --config=ivy --test_tag_filters=\"-no-ivy-aot,-fixme-ivy-aot,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          no_output_timeout: 15m\n \n \n workflows:"
        },
        {
            "sha": "493d416792850164b411d938809da531b2b5dd74",
            "filename": "package.json",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/package.json",
            "raw_url": "https://github.com/angular/angular/raw/b5ec5a7fcae68f03823238aeed7e4a7ead38962b/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=b5ec5a7fcae68f03823238aeed7e4a7ead38962b",
            "patch": "@@ -28,9 +28,6 @@\n     \"test-non-ivy\": \"bazelisk test --build_tag_filters=-ivy-only --test_tag_filters=-ivy-only\",\n     \"test-fixme-ivy-aot\": \"bazelisk test --config=ivy --build_tag_filters=-no-ivy-aot --test_tag_filters=-no-ivy-aot\",\n     \"list-fixme-ivy-targets\": \"bazelisk query --output=label 'attr(\\\"tags\\\", \\\"\\\\[.*fixme-ivy.*\\\\]\\\", //...) except kind(\\\"sh_binary\\\", //...) except kind(\\\"devmode_js_sources\\\", //...)' | sort\",\n-    \"//circleci-win-comment\": \"See the test-win circleci job for why these are needed. If they are not needed anymore, remove them.\",\n-    \"circleci-win-ve\": \"bazelisk test --build_tag_filters=-ivy-only --test_tag_filters=-ivy-only,-browser:chromium-local //packages/compiler-cli/... //tools/ts-api-guardian/...\",\n-    \"circleci-win-ivy\": \"bazelisk test --config=ivy --build_tag_filters=-no-ivy-aot,-fixme-ivy-aot --test_tag_filters=-no-ivy-aot,-fixme-ivy-aot,-browser:chromium-local //packages/compiler-cli/... //tools/ts-api-guardian/...\",\n     \"lint\": \"yarn -s tslint && yarn -s ng-dev format changed --check\",\n     \"tslint\": \"tsc -p tools/tsconfig.json && tslint -c tslint.json \\\"+(dev-infra|packages|modules|scripts|tools)/**/*.+(js|ts)\\\"\",\n     \"public-api:check\": \"node goldens/public-api/manage.js test\","
        }
    ],
    "stats": {
        "total": 28,
        "additions": 14,
        "deletions": 14
    }
}