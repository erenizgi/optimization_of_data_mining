{
    "author": "gkalpak",
    "message": "test(docs-infra): update `firebase-test-utils` to support regex-based redirects (#41842)\n\nThis commit updates the utilities in `firebase-test-utils/` to also\nsupport testing Firebase redirects that are configured using regular\nexpressions (via the `regex` property).\nSee the [Firebase docs][1] for more details.\n\n[1]: https://firebase.google.com/docs/hosting/full-config#redirects\n\nPR Close #41842",
    "sha": "d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
    "files": [
        {
            "sha": "c8aecc376cb6b25acc70df15d9ddfd86dd8ec4a3",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirect.spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.spec.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -3,18 +3,28 @@ import { FirebaseRedirect } from './FirebaseRedirect';\n describe('FirebaseRedirect', () => {\n   describe('replace', () => {\n     it('should return undefined if the redirect does not match the url', () => {\n-      const redirect = new FirebaseRedirect({source: '/a/b/c', destination: '/x/y/z'});\n-      expect(redirect.replace('/1/2/3')).toBe(undefined);\n+      const globRedirect = new FirebaseRedirect({source: '/a/b/c', destination: '/x/y/z'});\n+      expect(globRedirect.replace('/1/2/3')).toBe(undefined);\n+\n+      const regexRedirect = new FirebaseRedirect({regex: '^/a/b/c$', destination: '/x/y/z'});\n+      expect(regexRedirect.replace('/1/2/3')).toBe(undefined);\n     });\n \n     it('should return the destination if there is a match', () => {\n-      const redirect = new FirebaseRedirect({source: '/a/b/c', destination: '/x/y/z'});\n-      expect(redirect.replace('/a/b/c')).toBe('/x/y/z');\n+      const globRedirect = new FirebaseRedirect({source: '/a/b/c', destination: '/x/y/z'});\n+      expect(globRedirect.replace('/a/b/c')).toBe('/x/y/z');\n+\n+      const regexRedirect = new FirebaseRedirect({regex: '^/a/b/c$', destination: '/x/y/z'});\n+      expect(regexRedirect.replace('/a/b/c')).toBe('/x/y/z');\n     });\n \n     it('should inject name params into the destination', () => {\n-      const redirect = new FirebaseRedirect({source: '/api/:package/:api-*', destination: '<:package><:api>'});\n-      expect(redirect.replace('/api/common/NgClass-directive')).toEqual('<common><NgClass>');\n+      const globRedirect = new FirebaseRedirect({source: '/api/:package/:api-*', destination: '<:package><:api>'});\n+      expect(globRedirect.replace('/api/common/NgClass-directive')).toBe('<common><NgClass>');\n+\n+      const regexRedirect = new FirebaseRedirect(\n+          {regex: '^/api/(?P<package>[^/]+)/(?P<api>[^/]+)-.*$', destination: '<:package><:api>'});\n+      expect(regexRedirect.replace('/api/common/NgClass-directive')).toBe('<common><NgClass>');\n     });\n \n     it('should inject rest params into the destination', () => {"
        },
        {
            "sha": "3183dcd4b5f4cfe2a8e6c62de8bef95b9d4940d0",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirect.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirect.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -6,8 +6,10 @@ export class FirebaseRedirect {\n   source: FirebaseRedirectSource;\n   destination: string;\n \n-  constructor({source, destination}: FirebaseRedirectConfig) {\n-    this.source = FirebaseRedirectSource.fromGlobPattern(source);\n+  constructor({source, regex, destination}: FirebaseRedirectConfig) {\n+    this.source = (typeof source === 'string') ?\n+      FirebaseRedirectSource.fromGlobPattern(source) :\n+      FirebaseRedirectSource.fromRegexPattern(regex!);\n     this.destination = destination;\n   }\n "
        },
        {
            "sha": "1c0fe71ec60a83cc23ea19eb3d767d413a07548f",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirectSource.spec.ts",
            "status": "modified",
            "additions": 285,
            "deletions": 153,
            "changes": 438,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.spec.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -2,188 +2,320 @@ import { FirebaseRedirectSource } from './FirebaseRedirectSource';\n \n describe('FirebaseRedirectSource', () => {\n   describe('test', () => {\n-    it('should match * parts', () => {\n-      testGlob('asdf/*.jpg',\n-        ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n-        ['asdf/asdf/asdf.jpg', 'xxxasdf/asdf.jpgxxx']);\n-    });\n+    describe('(using glob)', () => {\n+      it('should match * parts', () => {\n+        testGlob('asdf/*.jpg',\n+          ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n+          ['asdf/asdf/asdf.jpg', 'xxxasdf/asdf.jpgxxx']);\n+      });\n \n-    it('should match ** parts', () => {\n-      testGlob('asdf/**.jpg', // treated like two consecutive single `*`s\n-        ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n-        ['asdf/a/.jpg', 'asdf/a/b.jpg', '/asdf/asdf.jpg', 'asdff/asdf.jpg', 'xxxasdf/asdf.jpg', 'asdf/asdf.jpgxxx']);\n-    });\n+      it('should match ** parts', () => {\n+        testGlob('asdf/**.jpg', // treated like two consecutive single `*`s\n+          ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n+          ['asdf/a/.jpg', 'asdf/a/b.jpg', '/asdf/asdf.jpg', 'asdff/asdf.jpg', 'xxxasdf/asdf.jpg', 'asdf/asdf.jpgxxx']);\n+      });\n \n-    it('should match **/ and /**/', () => {\n-      testGlob('**/*.js',\n-        ['asdf.js', 'asdf/asdf.js', 'asdf/asdf/asdfasdf_asdf.js', '/asdf/asdf.js', '/asdf/aasdf-asdf.2.1.4.js'],\n-        ['asdf/asdf.jpg', '/asdf/asdf.jpg']);\n-      testGlob('aaa/**/bbb',\n-        ['aaa/xxx/bbb', 'aaa/xxx/yyy/bbb', 'aaa/bbb'],\n-        ['/aaa/xxx/bbb', 'aaa/x/bbb/', 'aaa/bbb/ccc']);\n-    });\n+      it('should match **/ and /**/', () => {\n+        testGlob('**/*.js',\n+          ['asdf.js', 'asdf/asdf.js', 'asdf/asdf/asdfasdf_asdf.js', '/asdf/asdf.js', '/asdf/aasdf-asdf.2.1.4.js'],\n+          ['asdf/asdf.jpg', '/asdf/asdf.jpg']);\n+        testGlob('aaa/**/bbb',\n+          ['aaa/xxx/bbb', 'aaa/xxx/yyy/bbb', 'aaa/bbb'],\n+          ['/aaa/xxx/bbb', 'aaa/x/bbb/', 'aaa/bbb/ccc']);\n+      });\n \n-    it('should match choice groups', () => {\n-      testGlob('aaa/*.@(bbb|ccc)',\n-        ['aaa/aaa.bbb', 'aaa/aaa_aaa.ccc'],\n-        ['/aaa/aaa.bbb', 'aaaf/aaa.bbb', 'aaa/aaa.ddd']);\n+      it('should match choice groups', () => {\n+        testGlob('aaa/*.@(bbb|ccc)',\n+          ['aaa/aaa.bbb', 'aaa/aaa_aaa.ccc'],\n+          ['/aaa/aaa.bbb', 'aaaf/aaa.bbb', 'aaa/aaa.ddd']);\n \n-      testGlob('aaa/*(bbb|ccc)',\n-        ['aaa/', 'aaa/bbb', 'aaa/ccc', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb'],\n-        ['aaa/aaa', 'aaa/bbbb']);\n+        testGlob('aaa/*(bbb|ccc)',\n+          ['aaa/', 'aaa/bbb', 'aaa/ccc', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb'],\n+          ['aaa/aaa', 'aaa/bbbb']);\n \n-      testGlob('aaa/+(bbb|ccc)',\n-        ['aaa/bbb', 'aaa/ccc', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb'],\n-        ['aaa/', 'aaa/aaa', 'aaa/bbbb']);\n+        testGlob('aaa/+(bbb|ccc)',\n+          ['aaa/bbb', 'aaa/ccc', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb'],\n+          ['aaa/', 'aaa/aaa', 'aaa/bbbb']);\n \n-      testGlob('aaa/?(bbb|ccc)',\n-        ['aaa/', 'aaa/bbb', 'aaa/ccc'],\n-        ['aaa/aaa', 'aaa/bbbb', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb']);\n-    });\n+        testGlob('aaa/?(bbb|ccc)',\n+          ['aaa/', 'aaa/bbb', 'aaa/ccc'],\n+          ['aaa/aaa', 'aaa/bbbb', 'aaa/bbbbbb', 'aaa/bbbccc', 'aaa/cccbbb', 'aaa/bbbcccbbb']);\n+      });\n+\n+      it('should error on non-supported choice groups', () => {\n+        expect(() => FirebaseRedirectSource.fromGlobPattern('/!(a|b)/c'))\n+          .toThrowError('Error in FirebaseRedirectSource: \"/!(a|b)/c\" - \"not\" expansions are not supported: \"!(a|b)\"');\n+        expect(() => FirebaseRedirectSource.fromGlobPattern('/(a|b)/c'))\n+        .toThrowError('Error in FirebaseRedirectSource: \"/(a|b)/c\" - unknown expansion type: \"/\" in \"/(a|b)\"');\n+        expect(() => FirebaseRedirectSource.fromGlobPattern('/&(a|b)/c'))\n+          .toThrowError('Error in FirebaseRedirectSource: \"/&(a|b)/c\" - unknown expansion type: \"&\" in \"&(a|b)\"');\n+      });\n \n-    it('should error on non-supported choice groups', () => {\n-      expect(() => FirebaseRedirectSource.fromGlobPattern('/!(a|b)/c'))\n-        .toThrowError('Error in FirebaseRedirectSource: \"/!(a|b)/c\" - \"not\" expansions are not supported: \"!(a|b)\"');\n-      expect(() => FirebaseRedirectSource.fromGlobPattern('/(a|b)/c'))\n-      .toThrowError('Error in FirebaseRedirectSource: \"/(a|b)/c\" - unknown expansion type: \"/\" in \"/(a|b)\"');\n-      expect(() => FirebaseRedirectSource.fromGlobPattern('/&(a|b)/c'))\n-        .toThrowError('Error in FirebaseRedirectSource: \"/&(a|b)/c\" - unknown expansion type: \"&\" in \"&(a|b)\"');\n+      // Globs that contain params are tested via the match tests below\n     });\n \n-    // Globs that contain params tested via the match tests below\n+    describe('(using regex)', () => {\n+      it('should match simple regexes', () => {\n+        testRegex('^asdf/[^/]*\\\\.jpg$',\n+          ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n+          ['asdf/asdf/asdf.jpg', 'xxxasdf/asdf.jpgxxx', 'asdf/asdf_jpg']);\n+      });\n+\n+      it('should match regexes with capture groups', () => {\n+        testRegex('asdf/([^/]+)\\\\.jpg$',\n+          ['asdf/asdf.jpg', 'asdf/asdf_asdf.jpg', 'asdf/asdf/asdf.jpg'],\n+          ['asdf/.jpg', 'xxxasdf/asdf.jpgxxx', 'asdf/asdf_jpg']);\n+      });\n+\n+      it('should match regexes with named capture groups', () => {\n+        testRegex('^asdf/(?P<name>[^/]*)\\\\.jpg$',\n+          ['asdf/.jpg', 'asdf/asdf.jpg', 'asdf/asdf_asdf.jpg'],\n+          ['asdf/asdf/asdf.jpg', 'xxxasdf/asdf.jpgxxx', 'asdf/asdf_jpg']);\n+      });\n+\n+      it('should error on non-supported named capture group syntax', () => {\n+        expect(() => FirebaseRedirectSource.fromRegexPattern('/(?<foo>.*)')).toThrowError(\n+            'Error in FirebaseRedirectSource: \"/(?<foo>.*)\" - The regular expression pattern ' +\n+            'contains a named capture group of the format `(?<name>...)`, which is not ' +\n+            'compatible with the RE2 library. Use `(?P<name>...)` instead.');\n+      });\n+    });\n   });\n \n   describe('match', () => {\n-    it('should match patterns with no parameters', () => {\n-      testMatch('/abc/def/*', {\n-      }, {\n-        '/abc/def/': {},\n-        '/abc/def/ghi': {},\n-        '/': undefined,\n-        '/abc': undefined,\n-        '/abc/def/ghi/jk;': undefined,\n+    describe('(using glob)', () => {\n+      it('should match patterns with no parameters', () => {\n+        testGlobMatch('/abc/def/*', {\n+        }, {\n+          '/abc/def/': {},\n+          '/abc/def/ghi': {},\n+          '/': undefined,\n+          '/abc': undefined,\n+          '/abc/def/ghi/jk;': undefined,\n+        });\n       });\n-    });\n \n-    it('should capture a simple named param', () => {\n-      testMatch('/:abc', {\n-        named: ['abc']\n-      }, {\n-        '/a': {abc: 'a'},\n-        '/abc': {abc: 'abc'},\n-        '/': undefined,\n-        '/a/': undefined,\n-        '/a/b/': undefined,\n-        '/a/a/b': undefined,\n-        '/a/a/b/': undefined,\n-      });\n-      testMatch('/a/:b', {\n-        named: ['b']\n-      }, {\n-        '/a/b': {b: 'b'},\n-        '/a/bcd': {b: 'bcd'},\n-        '/a/': undefined,\n-        '/a/b/': undefined,\n-        '/a': undefined,\n-        '/a//': undefined,\n-        '/a/a/b': undefined,\n-        '/a/a/b/': undefined,\n+      it('should capture a simple named param', () => {\n+        testGlobMatch('/:abc', {\n+          named: ['abc']\n+        }, {\n+          '/a': {abc: 'a'},\n+          '/abc': {abc: 'abc'},\n+          '/': undefined,\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/a/b': undefined,\n+          '/a/a/b/': undefined,\n+        });\n+        testGlobMatch('/a/:b', {\n+          named: ['b']\n+        }, {\n+          '/a/b': {b: 'b'},\n+          '/a/bcd': {b: 'bcd'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a': undefined,\n+          '/a//': undefined,\n+          '/a/a/b': undefined,\n+          '/a/a/b/': undefined,\n+        });\n       });\n-    });\n \n-    it('should capture a named param followed by non-word chars', () => {\n-      testMatch('/a/:x-', {\n-        named: ['x']\n-      }, {\n-        '/a/b-': {x: 'b'},\n-        '/a/bcd-': {x: 'bcd'},\n-        '/a/--': {x: '-'},\n-        '/a': undefined,\n-        '/a/-': undefined,\n-        '/a/-/': undefined,\n-        '/a/': undefined,\n-        '/a/b/-': undefined,\n-        '/a/b-c': undefined,\n+      it('should capture a named param followed by non-word chars', () => {\n+        testGlobMatch('/a/:x-', {\n+          named: ['x']\n+        }, {\n+          '/a/b-': {x: 'b'},\n+          '/a/bcd-': {x: 'bcd'},\n+          '/a/--': {x: '-'},\n+          '/a': undefined,\n+          '/a/-': undefined,\n+          '/a/-/': undefined,\n+          '/a/': undefined,\n+          '/a/b/-': undefined,\n+          '/a/b-c': undefined,\n+        });\n       });\n-    });\n \n-    it('should capture multiple named params', () => {\n-      testMatch('/a/:b/:c', {\n-        named: ['b', 'c']\n-      }, {\n-        '/a/b/c': {b: 'b', c: 'c'},\n-        '/a/bcd/efg': {b: 'bcd', c: 'efg'},\n-        '/a/b/c-': {b: 'b', c: 'c-'},\n-        '/a/': undefined,\n-        '/a/b/': undefined,\n-        '/a/b/c/': undefined,\n-      });\n-      testMatch('/:a/b/:c', {\n-        named: ['a', 'c']\n-      }, {\n-        '/a/b/c': {a: 'a', c: 'c'},\n-        '/abc/b/efg': {a: 'abc', c: 'efg'},\n-        '/a/b/c-': {a: 'a', c: 'c-'},\n-        '/a/': undefined,\n-        '/a/b/': undefined,\n-        '/a/b/c/': undefined,\n+      it('should capture multiple named params', () => {\n+        testGlobMatch('/a/:b/:c', {\n+          named: ['b', 'c']\n+        }, {\n+          '/a/b/c': {b: 'b', c: 'c'},\n+          '/a/bcd/efg': {b: 'bcd', c: 'efg'},\n+          '/a/b/c-': {b: 'b', c: 'c-'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/b/c/': undefined,\n+        });\n+        testGlobMatch('/:a/b/:c', {\n+          named: ['a', 'c']\n+        }, {\n+          '/a/b/c': {a: 'a', c: 'c'},\n+          '/abc/b/efg': {a: 'abc', c: 'efg'},\n+          '/a/b/c-': {a: 'a', c: 'c-'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/b/c/': undefined,\n+        });\n+      });\n+\n+      it('should capture a simple rest param', () => {\n+        testGlobMatch('/:abc*', {\n+          rest: ['abc']\n+        }, {\n+          '/a': {abc: 'a'},\n+          '/a/b': {abc: 'a/b'},\n+          '/a/bcd': {abc: 'a/bcd'},\n+          '/a/': {abc: 'a/'},\n+          '/a/b/': {abc: 'a/b/'},\n+          '/a//': {abc: 'a//'},\n+          '/a/b/c': {abc: 'a/b/c'},\n+          '/a/b/c/': {abc: 'a/b/c/'},\n+        });\n+        testGlobMatch('/a/:b*', {\n+          rest: ['b']\n+        }, {\n+          '/a/b': {b: 'b'},\n+          '/a/bcd': {b: 'bcd'},\n+          '/a/': {b: ''},\n+          '/a/b/': {b: 'b/'},\n+          '/a': {b: undefined},\n+          '/a//': {b: '/'},\n+          '/a/a/b': {b: 'a/b'},\n+          '/a/a/b/': {b: 'a/b/'},\n+        });\n       });\n-    });\n \n-    it('should capture a simple rest param', () => {\n-      testMatch('/:abc*', {\n-        rest: ['abc']\n-      }, {\n-        '/a': {abc: 'a'},\n-        '/a/b': {abc: 'a/b'},\n-        '/a/bcd': {abc: 'a/bcd'},\n-        '/a/': {abc: 'a/'},\n-        '/a/b/': {abc: 'a/b/'},\n-        '/a//': {abc: 'a//'},\n-        '/a/b/c': {abc: 'a/b/c'},\n-        '/a/b/c/': {abc: 'a/b/c/'},\n-      });\n-      testMatch('/a/:b*', {\n-        rest: ['b']\n-      }, {\n-        '/a/b': {b: 'b'},\n-        '/a/bcd': {b: 'bcd'},\n-        '/a/': {b: ''},\n-        '/a/b/': {b: 'b/'},\n-        '/a': {b: undefined},\n-        '/a//': {b: '/'},\n-        '/a/a/b': {b: 'a/b'},\n-        '/a/a/b/': {b: 'a/b/'},\n+      it('should capture a rest param mixed with a named param', () => {\n+        testGlobMatch('/:abc/:rest*', {\n+          named: ['abc'],\n+          rest: ['rest']\n+        }, {\n+          '/a': {abc: 'a', rest: undefined},\n+          '/a/b': {abc: 'a', rest: 'b'},\n+          '/a/bcd': {abc: 'a', rest: 'bcd'},\n+          '/a/': {abc: 'a', rest: ''},\n+          '/a/b/': {abc: 'a', rest: 'b/'},\n+          '/a//': {abc: 'a', rest: '/'},\n+          '/a/b/c': {abc: 'a', rest: 'b/c'},\n+          '/a/b/c/': {abc: 'a', rest: 'b/c/'},\n+        });\n       });\n     });\n \n-    it('should capture a rest param mixed with a named param', () => {\n-      testMatch('/:abc/:rest*', {\n-        named: ['abc'],\n-        rest: ['rest']\n-      }, {\n-        '/a': {abc: 'a', rest: undefined},\n-        '/a/b': {abc: 'a', rest: 'b'},\n-        '/a/bcd': {abc: 'a', rest: 'bcd'},\n-        '/a/': {abc: 'a', rest: ''},\n-        '/a/b/': {abc: 'a', rest: 'b/'},\n-        '/a//': {abc: 'a', rest: '/'},\n-        '/a/b/c': {abc: 'a', rest: 'b/c'},\n-        '/a/b/c/': {abc: 'a', rest: 'b/c/'},\n+    describe('(using regex)', () => {\n+      it('should match patterns with no parameters', () => {\n+        testRegexMatch('^/abc/def/[^/]*$', {\n+        }, {\n+          '/abc/def/': {},\n+          '/abc/def/ghi': {},\n+          '/': undefined,\n+          '/abc': undefined,\n+          '/abc/def/ghi/jk;': undefined,\n+        });\n+      });\n+\n+      it('should capture a simple named group', () => {\n+        testRegexMatch('^/(?P<abc>[^/]+)$', {\n+          named: ['abc'],\n+        }, {\n+          '/a': {abc: 'a'},\n+          '/abc': {abc: 'abc'},\n+          '/': undefined,\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/a/b': undefined,\n+          '/a/a/b/': undefined,\n+        });\n+        testRegexMatch('^/a/(?P<b>[^/]+)$', {\n+          named: ['b'],\n+        }, {\n+          '/a/b': {b: 'b'},\n+          '/a/bcd': {b: 'bcd'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a': undefined,\n+          '/a//': undefined,\n+          '/a/a/b': undefined,\n+          '/a/a/b/': undefined,\n+        });\n+      });\n+\n+      it('should capture a named group followed by non-word chars', () => {\n+        testRegexMatch('^/a/(?P<x>[^/]+)-$', {\n+          named: ['x']\n+        }, {\n+          '/a/b-': {x: 'b'},\n+          '/a/bcd-': {x: 'bcd'},\n+          '/a/--': {x: '-'},\n+          '/a': undefined,\n+          '/a/-': undefined,\n+          '/a/-/': undefined,\n+          '/a/': undefined,\n+          '/a/b/-': undefined,\n+          '/a/b-c': undefined,\n+        });\n+      });\n+\n+      it('should capture multiple named capture groups', () => {\n+        testRegexMatch('^/a/(?P<b>[^/]+)/(?P<c>[^/]+)$', {\n+          named: ['b', 'c']\n+        }, {\n+          '/a/b/c': {b: 'b', c: 'c'},\n+          '/a/bcd/efg': {b: 'bcd', c: 'efg'},\n+          '/a/b/c-': {b: 'b', c: 'c-'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/b/c/': undefined,\n+        });\n+        testRegexMatch('^/(?P<a>[^/]+)/b/(?P<c>[^/]+)$', {\n+          named: ['a', 'c']\n+        }, {\n+          '/a/b/c': {a: 'a', c: 'c'},\n+          '/abc/b/efg': {a: 'abc', c: 'efg'},\n+          '/a/b/c-': {a: 'a', c: 'c-'},\n+          '/a/': undefined,\n+          '/a/b/': undefined,\n+          '/a/b/c/': undefined,\n+        });\n       });\n     });\n   });\n });\n \n function testGlob(pattern: string, matches: string[], nonMatches: string[]) {\n-  const redirectSource = FirebaseRedirectSource.fromGlobPattern(pattern);\n-  matches.forEach(url => expect(redirectSource.test(url)).toBe(true, url));\n-  nonMatches.forEach(url => expect(redirectSource.test(url)).toBe(false, url));\n+  return testSource(FirebaseRedirectSource.fromGlobPattern(pattern), matches, nonMatches);\n+}\n+\n+function testRegex(pattern: string, matches: string[], nonMatches: string[]) {\n+  return testSource(FirebaseRedirectSource.fromRegexPattern(pattern), matches, nonMatches);\n+}\n+\n+function testSource(source: FirebaseRedirectSource, matches: string[], nonMatches: string[]) {\n+  matches.forEach(url => expect(source.test(url)).toBe(true, url));\n+  nonMatches.forEach(url => expect(source.test(url)).toBe(false, url));\n+}\n+\n+function testGlobMatch(\n+    pattern: string,\n+    captures: { named?: string[], rest?: string[] },\n+    matches: { [url: string]: object|undefined }) {\n+  return testSourceMatch(FirebaseRedirectSource.fromGlobPattern(pattern), captures, matches);\n+}\n+\n+function testRegexMatch(\n+    pattern: string,\n+    captures: { named?: string[], rest?: string[] },\n+    matches: { [url: string]: object|undefined }) {\n+  return testSourceMatch(FirebaseRedirectSource.fromRegexPattern(pattern), captures, matches);\n }\n \n-function testMatch(pattern: string, captures: { named?: string[], rest?: string[] }, matches: { [url: string]: object|undefined }) {\n-  const redirectSource = FirebaseRedirectSource.fromGlobPattern(pattern);\n-  expect(redirectSource.namedGroups).toEqual(captures.named || []);\n-  expect(redirectSource.restNamedGroups).toEqual(captures.rest || []);\n-  Object.keys(matches).forEach(url => expect(redirectSource.match(url)).toEqual(matches[url]));\n+function testSourceMatch(\n+    source: FirebaseRedirectSource,\n+    captures: { named?: string[], rest?: string[] },\n+    matches: { [url: string]: object|undefined }) {\n+  expect(source.namedGroups).toEqual(captures.named || []);\n+  expect(source.restNamedGroups).toEqual(captures.rest || []);\n+  Object.keys(matches).forEach(url => expect(source.match(url)).toEqual(matches[url]));\n }"
        },
        {
            "sha": "2eff990929a01180dcbd7752f46e71800fffde61",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirectSource.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirectSource.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -53,6 +53,29 @@ export class FirebaseRedirectSource {\n     }\n   }\n \n+  static fromRegexPattern(regex: string): FirebaseRedirectSource {\n+    try {\n+      // NOTE:\n+      // Firebase redirect regexes use the [RE2 library](https://github.com/google/re2/wiki/Syntax),\n+      // which requires named capture groups to begin with `?P`. See\n+      // https://firebase.google.com/docs/hosting/full-config#capture-url-segments-for-redirects.\n+\n+      if (/\\(\\?<[^>]+>/.test(regex)) {\n+        // Throw if the regex contains a non-RE2 named capture group.\n+        throw new Error(\n+            'The regular expression pattern contains a named capture group of the format ' +\n+            '`(?<name>...)`, which is not compatible with the RE2 library. Use `(?P<name>...)` ' +\n+            'instead.');\n+      }\n+\n+      // Replace `(?P<...>` with just `(?<...>` to convert to `XRegExp`-compatible syntax for named\n+      // capture groups.\n+      return new FirebaseRedirectSource(regex.replace(/(\\(\\?)P(<[^>]+>)/g, '$1$2'));\n+    } catch (err) {\n+      throw new Error(`Error in FirebaseRedirectSource: \"${regex}\" - ${err.message}`);\n+    }\n+  }\n+\n   test(url: string): boolean {\n     return XRegExp.test(url, this.regex);\n   }"
        },
        {
            "sha": "931f9b49333cdcef733cc60565f4d80fa979663b",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirector.spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.spec.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -4,7 +4,7 @@ describe('FirebaseRedirector', () => {\n   it('should replace with the first matching redirect', () => {\n     const redirector = new FirebaseRedirector([\n       { source: '/a/b/c', destination: '/X/Y/Z' },\n-      { source: '/a/:foo/c', destination: '/X/:foo/Z' },\n+      { regex: '^/a/(?P<foo>[^/]+)/c$', destination: '/X/:foo/Z' },\n       { source: '/**/:foo/c', destination: '/A/:foo/zzz' },\n     ]);\n     expect(redirector.redirect('/a/b/c')).toEqual('/X/Y/Z');\n@@ -15,27 +15,27 @@ describe('FirebaseRedirector', () => {\n \n   it('should return the original url if no redirect matches', () => {\n     const redirector = new FirebaseRedirector([\n-      { source: 'x', destination: 'X' },\n+      { regex: '^x$', destination: 'X' },\n       { source: 'y', destination: 'Y' },\n-      { source: 'z', destination: 'Z' },\n+      { regex: '^z$', destination: 'Z' },\n     ]);\n     expect(redirector.redirect('a')).toEqual('a');\n   });\n \n   it('should recursively redirect', () => {\n     const redirector = new FirebaseRedirector([\n       { source: 'a', destination: 'b' },\n-      { source: 'b', destination: 'c' },\n+      { regex: '^b$', destination: 'c' },\n       { source: 'c', destination: 'd' },\n     ]);\n     expect(redirector.redirect('a')).toEqual('d');\n   });\n \n   it('should throw if stuck in an infinite loop', () => {\n     const redirector = new FirebaseRedirector([\n-      { source: 'a', destination: 'b' },\n+      { regex: '^a$', destination: 'b' },\n       { source: 'b', destination: 'c' },\n-      { source: 'c', destination: 'a' },\n+      { regex: '^c$', destination: 'a' },\n     ]);\n     expect(() => redirector.redirect('a')).toThrowError('infinite redirect loop');\n   });"
        },
        {
            "sha": "a525f789e950d43d1a94d87a147a62dfcb9cef4e",
            "filename": "aio/tools/firebase-test-utils/FirebaseRedirector.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ffirebase-test-utils%2FFirebaseRedirector.ts?ref=d1f5a9e44b902e2adfb9aefedd46bb59e1ec6ab7",
            "patch": "@@ -1,9 +1,8 @@\n import { FirebaseRedirect } from './FirebaseRedirect';\n \n-export interface FirebaseRedirectConfig {\n-  source: string;\n-  destination: string;\n-}\n+export type FirebaseRedirectConfig =\n+  { source: string, regex?: undefined, destination: string } |\n+  { source?: undefined, regex: string, destination: string };\n \n export class FirebaseRedirector {\n   private redirects: FirebaseRedirect[];"
        }
    ],
    "stats": {
        "total": 508,
        "additions": 337,
        "deletions": 171
    }
}