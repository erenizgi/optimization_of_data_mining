{
    "author": "josephperrott",
    "message": "feat(dev-infra): include release notes in Github release entries when publishing (#41964)\n\nInclude the release notes entry for the release in the release created on Github.\n\nPR Close #41964",
    "sha": "4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
    "files": [
        {
            "sha": "1c5024290d8c251715b29becb3a3bca37c87c32b",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -6261,13 +6261,13 @@ class ReleaseAction {\n      * Creates a Github release for the specified version in the configured project.\n      * The release is created by tagging the specified commit SHA.\n      */\n-    _createGithubReleaseForVersion(newVersion, versionBumpCommitSha, prerelease) {\n+    _createGithubReleaseForVersion(releaseNotes, versionBumpCommitSha, prerelease) {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n-            const tagName = newVersion.format();\n+            const tagName = releaseNotes.version.format();\n             yield this.git.github.git.createRef(Object.assign(Object.assign({}, this.git.remoteParams), { ref: `refs/tags/${tagName}`, sha: versionBumpCommitSha }));\n-            info(green(`  ✓   Tagged v${newVersion} release upstream.`));\n-            yield this.git.github.repos.createRelease(Object.assign(Object.assign({}, this.git.remoteParams), { name: `v${newVersion}`, tag_name: tagName, prerelease }));\n-            info(green(`  ✓   Created v${newVersion} release in Github.`));\n+            info(green(`  ✓   Tagged v${releaseNotes.version} release upstream.`));\n+            yield this.git.github.repos.createRelease(Object.assign(Object.assign({}, this.git.remoteParams), { name: `v${releaseNotes.version}`, tag_name: tagName, prerelease, body: yield releaseNotes.getGithubReleaseEntry() }));\n+            info(green(`  ✓   Created v${releaseNotes.version} release in Github.`));\n         });\n     }\n     /**\n@@ -6276,10 +6276,10 @@ class ReleaseAction {\n      * @param publishBranch Name of the branch that contains the new version.\n      * @param npmDistTag NPM dist tag where the version should be published to.\n      */\n-    buildAndPublish(newVersion, publishBranch, npmDistTag) {\n+    buildAndPublish(releaseNotes, publishBranch, npmDistTag) {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             const versionBumpCommitSha = yield this._getCommitOfBranch(publishBranch);\n-            if (!(yield this._isCommitForVersionStaging(newVersion, versionBumpCommitSha))) {\n+            if (!(yield this._isCommitForVersionStaging(releaseNotes.version, versionBumpCommitSha))) {\n                 error(red(`  ✘   Latest commit in \"${publishBranch}\" branch is not a staging commit.`));\n                 error(red('      Please make sure the staging pull request has been merged.'));\n                 throw new FatalReleaseActionError();\n@@ -6296,9 +6296,9 @@ class ReleaseAction {\n             yield invokeBazelCleanCommand(this.projectDir);\n             const builtPackages = yield invokeReleaseBuildCommand();\n             // Verify the packages built are the correct version.\n-            yield this._verifyPackageVersions(newVersion, builtPackages);\n+            yield this._verifyPackageVersions(releaseNotes.version, builtPackages);\n             // Create a Github release for the new version.\n-            yield this._createGithubReleaseForVersion(newVersion, versionBumpCommitSha, npmDistTag === 'next');\n+            yield this._createGithubReleaseForVersion(releaseNotes, versionBumpCommitSha, npmDistTag === 'next');\n             // Walk through all built packages and publish them to NPM.\n             for (const builtPackage of builtPackages) {\n                 yield this._publishBuiltPackageToNpm(builtPackage, npmDistTag);\n@@ -6377,7 +6377,7 @@ class CutLongTermSupportPatchAction extends ReleaseAction {\n             const newVersion = semverInc(ltsBranch.version, 'patch');\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, ltsBranch.name, ltsBranch.npmDistTag);\n+            yield this.buildAndPublish(releaseNotes, ltsBranch.name, ltsBranch.npmDistTag);\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, ltsBranch.name);\n         });\n     }\n@@ -6454,7 +6454,7 @@ class CutNewPatchAction extends ReleaseAction {\n             const newVersion = this._newVersion;\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, branchName, 'latest');\n+            yield this.buildAndPublish(releaseNotes, branchName, 'latest');\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n         });\n     }\n@@ -6524,7 +6524,7 @@ class CutNextPrereleaseAction extends ReleaseAction {\n             const newVersion = yield this._newVersion;\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, branchName, 'next');\n+            yield this.buildAndPublish(releaseNotes, branchName, 'next');\n             // If the pre-release has been cut from a branch that is not corresponding\n             // to the next release-train, cherry-pick the changelog into the primary\n             // development branch. i.e. the `next` branch that is usually `master`.\n@@ -6591,7 +6591,7 @@ class CutReleaseCandidateAction extends ReleaseAction {\n             const newVersion = this._newVersion;\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, branchName, 'next');\n+            yield this.buildAndPublish(releaseNotes, branchName, 'next');\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n         });\n     }\n@@ -6635,7 +6635,7 @@ class CutStableAction extends ReleaseAction {\n             const isNewMajor = (_a = this.active.releaseCandidate) === null || _a === void 0 ? void 0 : _a.isMajor;\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, branchName, 'latest');\n+            yield this.buildAndPublish(releaseNotes, branchName, 'latest');\n             // If a new major version is published and becomes the \"latest\" release-train, we need\n             // to set the LTS npm dist tag for the previous latest release-train (the current patch).\n             if (isNewMajor) {\n@@ -6708,7 +6708,7 @@ class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n             // pre-release. Finally, cherry-pick the release notes into the next branch in combination\n             // with bumping the version to the next minor too.\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(newVersion, newBranch, 'next');\n+            yield this.buildAndPublish(releaseNotes, newBranch, 'next');\n             yield this._createNextBranchUpdatePullRequest(releaseNotes, newVersion);\n         });\n     }"
        },
        {
            "sha": "5be6919a19de3ce7bf49886273815622b427ff68",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -418,23 +418,23 @@ export abstract class ReleaseAction {\n    * The release is created by tagging the specified commit SHA.\n    */\n   private async _createGithubReleaseForVersion(\n-      newVersion: semver.SemVer, versionBumpCommitSha: string, prerelease: boolean) {\n-    const tagName = newVersion.format();\n+      releaseNotes: ReleaseNotes, versionBumpCommitSha: string, prerelease: boolean) {\n+    const tagName = releaseNotes.version.format();\n     await this.git.github.git.createRef({\n       ...this.git.remoteParams,\n       ref: `refs/tags/${tagName}`,\n       sha: versionBumpCommitSha,\n     });\n-    info(green(`  ✓   Tagged v${newVersion} release upstream.`));\n+    info(green(`  ✓   Tagged v${releaseNotes.version} release upstream.`));\n \n     await this.git.github.repos.createRelease({\n       ...this.git.remoteParams,\n-      name: `v${newVersion}`,\n+      name: `v${releaseNotes.version}`,\n       tag_name: tagName,\n       prerelease,\n-\n+      body: await releaseNotes.getGithubReleaseEntry(),\n     });\n-    info(green(`  ✓   Created v${newVersion} release in Github.`));\n+    info(green(`  ✓   Created v${releaseNotes.version} release in Github.`));\n   }\n \n   /**\n@@ -444,10 +444,10 @@ export abstract class ReleaseAction {\n    * @param npmDistTag NPM dist tag where the version should be published to.\n    */\n   protected async buildAndPublish(\n-      newVersion: semver.SemVer, publishBranch: string, npmDistTag: string) {\n+      releaseNotes: ReleaseNotes, publishBranch: string, npmDistTag: string) {\n     const versionBumpCommitSha = await this._getCommitOfBranch(publishBranch);\n \n-    if (!await this._isCommitForVersionStaging(newVersion, versionBumpCommitSha)) {\n+    if (!await this._isCommitForVersionStaging(releaseNotes.version, versionBumpCommitSha)) {\n       error(red(`  ✘   Latest commit in \"${publishBranch}\" branch is not a staging commit.`));\n       error(red('      Please make sure the staging pull request has been merged.'));\n       throw new FatalReleaseActionError();\n@@ -467,11 +467,11 @@ export abstract class ReleaseAction {\n     const builtPackages = await invokeReleaseBuildCommand();\n \n     // Verify the packages built are the correct version.\n-    await this._verifyPackageVersions(newVersion, builtPackages);\n+    await this._verifyPackageVersions(releaseNotes.version, builtPackages);\n \n     // Create a Github release for the new version.\n     await this._createGithubReleaseForVersion(\n-        newVersion, versionBumpCommitSha, npmDistTag === 'next');\n+        releaseNotes, versionBumpCommitSha, npmDistTag === 'next');\n \n     // Walk through all built packages and publish them to NPM.\n     for (const builtPackage of builtPackages) {"
        },
        {
            "sha": "a58668141f1006633aafbfc0fd8e0055dd1ddb64",
            "filename": "dev-infra/release/publish/actions/cut-lts-patch.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -45,7 +45,7 @@ export class CutLongTermSupportPatchAction extends ReleaseAction {\n         await this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, ltsBranch.name, ltsBranch.npmDistTag);\n+    await this.buildAndPublish(releaseNotes, ltsBranch.name, ltsBranch.npmDistTag);\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, ltsBranch.name);\n   }\n "
        },
        {
            "sha": "6498dc997c9072efa57f7701da04e37d812506ae",
            "filename": "dev-infra/release/publish/actions/cut-new-patch.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -32,7 +32,7 @@ export class CutNewPatchAction extends ReleaseAction {\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, branchName, 'latest');\n+    await this.buildAndPublish(releaseNotes, branchName, 'latest');\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n   }\n "
        },
        {
            "sha": "60c97dac11a6cb6d9772fa766e8c97cd570fa233",
            "filename": "dev-infra/release/publish/actions/cut-next-prerelease.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -36,7 +36,7 @@ export class CutNextPrereleaseAction extends ReleaseAction {\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, branchName, 'next');\n+    await this.buildAndPublish(releaseNotes, branchName, 'next');\n \n     // If the pre-release has been cut from a branch that is not corresponding\n     // to the next release-train, cherry-pick the changelog into the primary"
        },
        {
            "sha": "8f31bc3f3cf341ad994af450fe60ff0aba91947d",
            "filename": "dev-infra/release/publish/actions/cut-release-candidate.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -30,7 +30,7 @@ export class CutReleaseCandidateAction extends ReleaseAction {\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, branchName, 'next');\n+    await this.buildAndPublish(releaseNotes, branchName, 'next');\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n   }\n "
        },
        {
            "sha": "523b0b522200a7cfbf3d0b2597c03fd06721a086",
            "filename": "dev-infra/release/publish/actions/cut-stable.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -35,7 +35,7 @@ export class CutStableAction extends ReleaseAction {\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, branchName, 'latest');\n+    await this.buildAndPublish(releaseNotes, branchName, 'latest');\n \n     // If a new major version is published and becomes the \"latest\" release-train, we need\n     // to set the LTS npm dist tag for the previous latest release-train (the current patch)."
        },
        {
            "sha": "a0c4d6e5236f382bb9107eb1699a6e6eb76865a5",
            "filename": "dev-infra/release/publish/actions/move-next-into-feature-freeze.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -47,7 +47,7 @@ export class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n     // pre-release. Finally, cherry-pick the release notes into the next branch in combination\n     // with bumping the version to the next minor too.\n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(newVersion, newBranch, 'next');\n+    await this.buildAndPublish(releaseNotes, newBranch, 'next');\n     await this._createNextBranchUpdatePullRequest(releaseNotes, newVersion);\n   }\n "
        },
        {
            "sha": "8ceefcd8513bfefce20f0f65f5cb2097259a85d2",
            "filename": "dev-infra/release/publish/test/common.spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts?ref=4d7294d9f73a44b3f9c87dbdb7e1c6dd92ab25bc",
            "patch": "@@ -154,8 +154,9 @@ class TestAction extends ReleaseAction {\n     throw Error('Not implemented.');\n   }\n \n-  async testBuildAndPublish(newVersion: semver.SemVer, publishBranch: string, distTag: string) {\n-    await this.buildAndPublish(newVersion, publishBranch, distTag);\n+  async testBuildAndPublish(version: semver.SemVer, publishBranch: string, distTag: string) {\n+    const releaseNotes = await ReleaseNotes.fromLatestTagToHead(version, this.config);\n+    await this.buildAndPublish(releaseNotes, publishBranch, distTag);\n   }\n \n   async testCherryPickWithPullRequest(version: semver.SemVer, branch: string) {"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 34,
        "deletions": 33
    }
}