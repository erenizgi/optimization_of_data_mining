{
    "author": "unknown",
    "message": "fix(compiler): Metadata should not include methods on Object.prototype (#38292)\n\nThis commit fixes a bug in View Engine whereby the compiler errorneously\nthinks that a method of a component has decorator metadata when that\nmethod is one of those in `Object.prototype`, for example `toString`.\n\nThis bug is discovered in v10.0.4 of `@angular/language-service` after\nthe default bundle format was switched from ES5 to ES2015.\n\nES5 output:\n```js\nif (propMetadata[propName]) {\n    decorators.push.apply(decorators, __spread(propMetadata[propName]));\n}\n```\n\nES2015 output:\n```js\nif (propMetadata[propName]) {\n    decorators.push(...propMetadata[propName]);\n}\n```\n\nThe bug was not discovered in ES5 because the polyfill for the spread\noperator happily accepts parameters that do not have the `iterable`\nsymbol:\n\n```js\nfunction __spread() {\n    for (var ar = [], i = 0; i < arguments.length; i++)\n        ar = ar.concat(__read(arguments[i]));\n    return ar;\n}\n```\n\nwhereas in es2015 itâ€™ll fail since the iterable symbol is not present in\n`propMetadata['toString']` which evaluates to a function.\n\nFixes https://github.com/angular/vscode-ng-language-service/issues/859\n\nPR Close #38292",
    "sha": "fd51e01335337d95d684458a3d78283cbe014f19",
    "files": [
        {
            "sha": "9964474086748aecb25fb880a3c11dd9cc203a68",
            "filename": "packages/compiler/src/aot/static_reflector.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/fd51e01335337d95d684458a3d78283cbe014f19/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts",
            "raw_url": "https://github.com/angular/angular/raw/fd51e01335337d95d684458a3d78283cbe014f19/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts?ref=fd51e01335337d95d684458a3d78283cbe014f19",
            "patch": "@@ -235,7 +235,9 @@ export class StaticReflector implements CompileReflector {\n         const prop = (<any[]>propData)\n                          .find(a => a['__symbolic'] == 'property' || a['__symbolic'] == 'method');\n         const decorators: any[] = [];\n-        if (propMetadata![propName]) {\n+        // hasOwnProperty() is used here to make sure we do not look up methods\n+        // on `Object.prototype`.\n+        if (propMetadata?.hasOwnProperty(propName)) {\n           decorators.push(...propMetadata![propName]);\n         }\n         propMetadata![propName] = decorators;"
        },
        {
            "sha": "cf56450fbe4f23acc39df41bbbe6aeee3355dce5",
            "filename": "packages/compiler/test/aot/static_reflector_spec.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/fd51e01335337d95d684458a3d78283cbe014f19/packages%2Fcompiler%2Ftest%2Faot%2Fstatic_reflector_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fd51e01335337d95d684458a3d78283cbe014f19/packages%2Fcompiler%2Ftest%2Faot%2Fstatic_reflector_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Faot%2Fstatic_reflector_spec.ts?ref=fd51e01335337d95d684458a3d78283cbe014f19",
            "patch": "@@ -777,6 +777,35 @@ describe('StaticReflector', () => {\n           .toEqual({});\n     });\n \n+    it('should not inherit methods from Object.prototype', () => {\n+      const filePath = '/tmp/test.ts';\n+      init({\n+        ...DEFAULT_TEST_DATA,\n+        [filePath]: `\n+          import {Component} from '@angular/core';\n+\n+          @Component({\n+            selector: 'test-component',\n+          })\n+          export class TestComponent {\n+            title = 'Hello World';\n+\n+            toString() {\n+              return 'Test Component';\n+            }\n+          }\n+        `,\n+      });\n+      const declaration = reflector.getStaticSymbol(filePath, 'TestComponent');\n+      expect(declaration.filePath).toBe(filePath);\n+      expect(declaration.name).toBe('TestComponent');\n+      const propMetadata = reflector.propMetadata(declaration);\n+      // 'toString' is a member of TestComponent so it should be part of the metadata.\n+      expect(propMetadata.hasOwnProperty('toString')).toBe(true);\n+      // There are no decorators on 'toString' so it should be an empty array.\n+      expect(propMetadata['toString']).toEqual([]);\n+    });\n+\n     it('should inherit lifecycle hooks', () => {\n       initWithDecorator({\n         '/tmp/src/main.ts': `"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 32,
        "deletions": 1
    }
}