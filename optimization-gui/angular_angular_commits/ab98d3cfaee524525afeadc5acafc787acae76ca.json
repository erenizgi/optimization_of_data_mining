{
    "author": "AleksanderBodurri",
    "message": "build(devtools): port over bazel tooling from angular/components\n\nPreviously the ts_library bazel rule was used to build angular devtools. This commit migrates to ts project and brings in some bazel tooling from angular/components to run bundle spec files for karma tests.",
    "sha": "ab98d3cfaee524525afeadc5acafc787acae76ca",
    "files": [
        {
            "sha": "81af7d63e6b540f536a083d484abf7c57adeac2b",
            "filename": ".bazelrc",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelrc?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -90,3 +90,6 @@ try-import %workspace%/.bazelrc.user\n # Use the Angular Ivy compiler\n # See https://github.com/angular/angular/blob/master/docs/BAZEL.md#various-flags-used-for-tests\n build --define=angular_ivy_enabled=True\n+\n+build --nobuild_runfile_links\n+"
        },
        {
            "sha": "0c89fc927e327c0a9913d8300a205efbd30cedbf",
            "filename": ".bazelversion",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/.bazelversion",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/.bazelversion",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelversion?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1 +1 @@\n-4.0.0\n+4.0.0\n\\ No newline at end of file"
        },
        {
            "sha": "c3d024fa7325c20ddae22ef313a338156f0c6609",
            "filename": "BUILD.bazel",
            "status": "modified",
            "additions": 21,
            "deletions": 6,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/BUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/BUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/BUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,11 +1,26 @@\n load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"custom_browser\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n \n-package(default_visibility = [\"//:__subpackages__\"])\n+package(default_visibility = [\"//visibility:public\"])\n \n-exports_files([\"tsconfig.json\", \"cypress.json\",])\n+exports_files([\"tsconfig.json\", \"cypress.json\"])\n \n-custom_browser(\n-    name = \"no-sandbox-chrome\",\n-    browser = \"@io_bazel_rules_webtesting//browsers:chromium-local\",\n-    metadata = \"//:nosandbox.json\",\n+ts_test_project(\n+    name = \"initialize_testbed\",\n+    srcs = [\n+        \"initialize_testbed.ts\",\n+    ],\n+    deps = [\n+        \"@npm//@angular/core\",\n+        \"@npm//@angular/platform-browser-dynamic\",\n+    ],\n+)\n+\n+ts_config(\n+    name =\"tsconfig-spec\",\n+    src = \"tsconfig.spec.json\",\n+    deps = [\n+        \"//:tsconfig.json\"\n+    ]\n )\n\\ No newline at end of file"
        },
        {
            "sha": "920717de1e08cb86f11102ef9cfb3acbc97f4ca4",
            "filename": "WORKSPACE",
            "status": "modified",
            "additions": 25,
            "deletions": 7,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/WORKSPACE",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/WORKSPACE",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/WORKSPACE?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -28,11 +28,11 @@ bazel_skylib_workspace()\n # Fetch rules_nodejs so we can install our npm dependencies\n http_archive(\n     name = \"build_bazel_rules_nodejs\",\n-    sha256 = \"8f5f192ba02319254aaf2cdcca00ec12eaafeb979a80a1e946773c520ae0a2c9\",\n-    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/3.7.0/rules_nodejs-3.7.0.tar.gz\"],\n+    sha256 = \"3635797a96c7bfcd0d265dacd722a07335e64d6ded9834af8d3f1b7ba5a25bba\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/4.3.0/rules_nodejs-4.3.0.tar.gz\"],\n )\n \n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"node_repositories\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"node_repositories\", \"yarn_install\")\n \n # Setup the Node.js toolchain\n node_repositories(\n@@ -43,11 +43,16 @@ node_repositories(\n # Fetch sass rules for compiling sass files\n http_archive(\n     name = \"io_bazel_rules_sass\",\n-    sha256 = \"dcead3cbe749d8e9467d28e326ea8ea3a126bc6095a0e1665222c94ff9db6fcc\",\n-    strip_prefix = \"rules_sass-1.36.0\",\n+    sha256 = \"5313032124ff191eed68efcfbdc6ee9b5198093b2b80a8e640ea34feabbffc69\",\n+    patch_args = [\"-p1\"],\n+    patches = [\n+        # Updates @bazel/work dep to 4.0.0 inside rules_sass so it is compatible\n+        \"//:io_bazel_rules_sass.patch\",\n+    ],\n+    strip_prefix = \"rules_sass-1.34.0\",\n     urls = [\n-        \"https://github.com/bazelbuild/rules_sass/archive/1.36.0.zip\",\n-        \"https://mirror.bazel.build/github.com/bazelbuild/rules_sass/archive/1.36.0.zip\",\n+        \"https://github.com/bazelbuild/rules_sass/archive/1.34.0.zip\",\n+        \"https://mirror.bazel.build/github.com/bazelbuild/rules_sass/archive/1.34.0.zip\",\n     ],\n )\n \n@@ -84,3 +89,16 @@ browser_repositories(\n load(\"@io_bazel_rules_sass//sass:sass_repositories.bzl\", \"sass_repositories\")\n \n sass_repositories()\n+\n+# Setup esbuild repositories\n+load(\"@build_bazel_rules_nodejs//toolchains/esbuild:esbuild_repositories.bzl\", \"esbuild_repositories\")\n+\n+esbuild_repositories()\n+\n+# Setup repositories for browsers provided by the shared dev-infra package.\n+load(\n+    \"@npm//@angular/dev-infra-private/bazel/browsers:browser_repositories.bzl\",\n+    _dev_infra_browser_repositories = \"browser_repositories\",\n+)\n+\n+_dev_infra_browser_repositories()"
        },
        {
            "sha": "2718799fda7dbff88c460dd66b5b78de91d9efe0",
            "filename": "common.bazelrc",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/common.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/common.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/common.bazelrc?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,87 +0,0 @@\n-# Common Bazel settings for JavaScript/NodeJS workspaces\n-# This rc file is automatically discovered when Bazel is run in this workspace,\n-# see https://docs.bazel.build/versions/master/guide.html#bazelrc\n-#\n-# The full list of Bazel options: https://docs.bazel.build/versions/master/command-line-reference.html\n-\n-# Cache action outputs on disk so they persist across output_base and bazel shutdown (eg. changing branches)\n-build --disk_cache=~/.cache/bazel-disk-cache\n-\n-# Bazel picks up host-OS-specific config lines from bazelrc files\n-build --enable_platform_specific_config\n-\n-# Bazel will create symlinks from the workspace directory to output artifacts.\n-# Build results will be placed in a directory called \"dist/bin\"\n-# Other directories will be created like \"dist/testlogs\"\n-# Be aware that this will still create a bazel-out symlink in\n-# your project directory, which you must exclude from version control and your\n-# editor's search path.\n-build --symlink_prefix=dist/\n-# To disable the symlinks altogether (including bazel-out) you can use\n-# build --symlink_prefix=/\n-# however this makes it harder to find outputs.\n-\n-# Specifies desired output mode for running tests.\n-# Valid values are\n-#   'summary' to output only test status summary\n-#   'errors' to also print test logs for failed tests\n-#   'all' to print logs for all tests\n-#   'streamed' to output logs for all tests in real time\n-#     (this will force tests to be executed locally one at a time regardless of --test_strategy value).\n-test --test_output=errors\n-\n-# Support for debugging NodeJS tests\n-# Add the Bazel option `--config=debug` to enable this\n-# --test_output=streamed\n-#     Stream stdout/stderr output from each test in real-time.\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_output for more details.\n-# --test_strategy=exclusive\n-#     Run one test at a time.\n-# --test_timeout=9999\n-#     Prevent long running tests from timing out\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_timeout for more details.\n-# --nocache_test_results\n-#     Always run tests\n-# --node_options=--inspect-brk\n-#     Pass the --inspect-brk option to all tests which enables the node inspector agent.\n-#     See https://nodejs.org/de/docs/guides/debugging-getting-started/#command-line-options for more details.\n-# --define=VERBOSE_LOGS=1\n-#     Rules will output verbose logs if the VERBOSE_LOGS environment variable is set. `VERBOSE_LOGS` will be passed to\n-#     `nodejs_binary` and `nodejs_test` via the default value of the `default_env_vars` attribute of those rules.\n-# --compilation_mode=dbg\n-#     Rules may change their build outputs if the compilation mode is set to dbg. For example,\n-#     mininfiers such as terser may make their output more human readable when this is set. Rules will pass `COMPILATION_MODE`\n-#     to `nodejs_binary` executables via the actions.run env attribute.\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--compilation_mode for more details.\n-test:debug --test_output=streamed --test_strategy=exclusive --test_timeout=9999 --nocache_test_results --define=VERBOSE_LOGS=1\n-# Use bazel run with `--config=debug` to turn on the NodeJS inspector agent.\n-# The node process will break before user code starts and wait for the debugger to connect.\n-run:debug --define=VERBOSE_LOGS=1 -- --node_options=--inspect-brk\n-# The following option will change the build output of certain rules such as terser and may not be desirable in all cases\n-build:debug --compilation_mode=dbg\n-\n-# Turn off legacy external runfiles\n-# This prevents accidentally depending on this feature, which Bazel will remove.\n-build --nolegacy_external_runfiles\n-\n-# Turn on --incompatible_strict_action_env which was on by default\n-# in Bazel 0.21.0 but turned off again in 0.22.0. Follow\n-# https://github.com/bazelbuild/bazel/issues/7026 for more details.\n-# This flag is needed to so that the bazel cache is not invalidated\n-# when running bazel via `yarn bazel`.\n-# See https://github.com/angular/angular/issues/27514.\n-build --incompatible_strict_action_env\n-run --incompatible_strict_action_env\n-\n-# When running `bazel coverage` --instrument_test_targets needs to be set in order to \n-# collect coverage information from test targets\n-coverage --instrument_test_targets\n-\n-# Load any settings specific to the current user.\n-# .bazelrc.user should appear in .gitignore so that settings are not shared with team members\n-# This needs to be last statement in this\n-# config, as the user configuration should be able to overwrite flags from this file.\n-# See https://docs.bazel.build/versions/master/best-practices.html#bazelrc\n-# (Note that we use .bazelrc.user so the file appears next to .bazelrc in directory listing,\n-# rather than user.bazelrc as suggested in the Bazel docs)\n-try-import %workspace%/.bazelrc.user"
        },
        {
            "sha": "5c535e577980ab97a892d77e3322160d5e1f2907",
            "filename": "initialize_testbed.ts",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/initialize_testbed.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/initialize_testbed.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/initialize_testbed.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @fileoverview Provides a script to initialize TestBed before tests are run.\n+ * This file should be included in the \"runtime_deps\" of a \"karma_web_test_suite\"\n+ * rule.\n+ */\n+ import {TestBed} from '@angular/core/testing';\n+ import {BrowserDynamicTestingModule, platformBrowserDynamicTesting} from '@angular/platform-browser-dynamic/testing';\n+ \n+ TestBed.initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());\n+ \n\\ No newline at end of file"
        },
        {
            "sha": "dd50a1eb783ea467c944c3f41b55506dc9b03c75",
            "filename": "io_bazel_rules_sass.patch",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/io_bazel_rules_sass.patch",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/io_bazel_rules_sass.patch",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/io_bazel_rules_sass.patch?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,20 @@\n+index 314d400b..bbdfbf87 100755\n+--- a/sass/package.json\n++++ b/sass/package.json\n+@@ -1,6 +1,6 @@\n+ {\n+   \"devDependencies\": {\n+-    \"@bazel/worker\": \"3.0.0\",\n++    \"@bazel/worker\": \"4.0.0-beta.0\",\n+     \"sass\": \"1.34.0\"\n+   }\n+ }\n+index 9cb20561..dbcc7880 100755\n+--- a/sass/sass_repositories.bzl\n++++ b/sass/sass_repositories.bzl\n+@@ -32,4 +32,5 @@ def sass_repositories():\n+         # node_modules folders in the @io_bazel_rules_sass external repository. This is\n+         # not supported by managed_directories.\n+         symlink_node_modules = False,\n++        frozen_lockfile = False,\n+     )"
        },
        {
            "sha": "447e7feda7e987347a18aa0f82fe7b5ad45667f1",
            "filename": "nosandbox.json",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/nosandbox.json",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/nosandbox.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/nosandbox.json?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,7 +0,0 @@\n-{\n-  \"capabilities\": {\n-    \"goog:chromeOptions\": {\n-      \"args\": [\"--no-sandbox\"]\n-    }\n-  }\n-}"
        },
        {
            "sha": "8ec3585c15652b12281cfde3e2b506fb53225456",
            "filename": "package.json",
            "status": "modified",
            "additions": 21,
            "deletions": 16,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/package.json",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -2,15 +2,15 @@\n   \"name\": \"angular-devtools\",\n   \"version\": \"0.0.0\",\n   \"scripts\": {\n-    \"postinstall\": \"ngcc\",\n+    \"postinstall\": \"node_modules/.bin/ngcc --async --properties fesm2015\",\n     \"ng\": \"ng\",\n     \"cypress:verify\": \"cypress verify\",\n     \"start\": \"ibazel run src:devserver\",\n     \"start-no-animations\": \"bazel run src:devserver-e2e\",\n     \"build:chrome\": \"bazel build projects/shell-chrome/src:prodapp\",\n     \"build:chrome:watch\": \"ibazel build projects/shell-chrome/src:prodapp\",\n     \"release\": \"node projects/shell-chrome/set-version.js && cross-env LATEST_SHA=`git rev-parse --short HEAD` build:chrome\",\n-    \"test\": \"ng test\",\n+    \"test\": \"bazel test ...\",\n     \"lint\": \"tslint -p tsconfig.json -c tslint.json\",\n     \"lint:fix\": \"tslint -p tsconfig.json -c tslint.json --fix\",\n     \"e2e\": \"yarn cy:run\",\n@@ -20,7 +20,7 @@\n     \"cy:open\": \"$(yarn bin)/cypress open\",\n     \"cy:ci\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:run\",\n     \"cy:watch\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:open\",\n-    \"test:ci\": \"bazel test projects/...\",\n+    \"test:ci\": \"bazel test ...\",\n     \"prettier\": \"prettier --write \\\"{,!(node_modules|dist|build|coverage)/**/}*.{js,jsx,ts,tsx,json}\\\"\",\n     \"prettier:fix\": \"pretty-quick --staged\"\n   },\n@@ -32,14 +32,17 @@\n   \"private\": true,\n   \"dependencies\": {\n     \"@angular/animations\": \"github:angular/animations-builds#e814a6149fd654e265a465837f17bdebdc976a9d\",\n-    \"@angular/cdk\": \"~12.2.0\",\n+    \"@angular/cdk\": \"~13.0.1\",\n     \"@angular/common\": \"github:angular/common-builds#f1e665ee23545ee54adf517450083125aea33357\",\n     \"@angular/compiler\": \"github:angular/compiler-builds#11a9d99b5540a189c393686b078b0ef4692573cf\",\n     \"@angular/core\": \"github:angular/core-builds#7cda5ccc3ab33ca2230b67b38a0cea0d43035531\",\n     \"@angular/forms\": \"github:angular/forms-builds#380d3f7831ae2b40390dbc2ed0f457740e3b310f\",\n-    \"@angular/material\": \"~12.2.0\",\n+    \"@angular/material\": \"~13.0.1\",\n     \"@angular/platform-browser\": \"github:angular/platform-browser-builds#7f38db5e7693cd7a1e76c0f21978eb44b89b799f\",\n     \"@angular/platform-browser-dynamic\": \"github:angular/platform-browser-dynamic-builds#9e478221d7065200684a1eece31b99d287674da8\",\n+    \"@angular/platform-server\": \"13.0.1\",\n+    \"@babel/cli\": \"^7.16.0\",\n+    \"@babel/core\": \"^7.16.0\",\n     \"@types/node\": \"^16.7.1\",\n     \"ajv-formats\": \"^2.1.1\",\n     \"d3\": \"^5.7.0\",\n@@ -55,23 +58,25 @@\n   \"devDependencies\": {\n     \"@angular-devkit/build-angular\": \"github:angular/angular-devkit-build-angular-builds#7c4c781be8e3666f14360d3fe5dac0d35a851227\",\n     \"@angular-devkit/build-ng-packagr\": \"~0.1002.0\",\n+    \"@angular/bazel\": \"13.0.1\",\n+    \"@angular/dev-infra-private\": \"https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\",\n+    \"@angular/localize\": \"13.0.1\",\n     \"@angular/cli\": \"github:angular/cli-builds#858ee211470523d39a9ff16b57b676be740f77cc\",\n     \"@angular/compiler-cli\": \"github:angular/compiler-cli-builds#89c6b3464f3f46a9f46334825bbff3d784af4136\",\n     \"@angular/elements\": \"github:angular/elements-builds#55c36f9d5381ffc06649a03bff3c2934b18ddd02\",\n     \"@angular/language-service\": \"github:angular/language-service-builds#e16ca91c029934dde01557efcf860e2465629655\",\n     \"@angular/router\": \"github:angular/router-builds#5485647d9f68a01041285dfa0b92d841d7fa8c0f\",\n-    \"@bahmutov/add-typescript-to-cypress\": \"^2.1.2\",\n-    \"@types/chrome\": \"^0.0.159\",\n-    \"@bazel/angular\": \"^3.7.0\",\n+    \"@bazel/angular\": \"^4.4.2\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/concatjs\": \"^3.7.0\",\n+    \"@bazel/esbuild\": \"^4.4.2\",\n     \"@bazel/ibazel\": \"^0.15.10\",\n-    \"@bazel/rollup\": \"^3.7.0\",\n-    \"@bazel/terser\": \"^3.7.0\",\n-    \"@bazel/typescript\": \"^3.7.0\",\n-    \"@rollup/plugin-commonjs\": \"18.0.0\",\n-    \"@rollup/plugin-json\": \"4.1.0\",\n-    \"@rollup/plugin-node-resolve\": \"8.4.0\",\n+    \"@bazel/rollup\": \"^4.4.2\",\n+    \"@bazel/terser\": \"^4.4.2\",\n+    \"@bazel/typescript\": \"~4.4.2\",\n+    \"@rollup/plugin-commonjs\": \"^14.0.0\",\n+    \"@rollup/plugin-node-resolve\": \"^8.4.0\",\n+    \"@types/chrome\": \"^0.0.159\",\n     \"@types/clone-deep\": \"^4.0.1\",\n     \"@types/filesystem\": \"^0.0.32\",\n     \"@types/jasmine\": \"~3.9.0\",\n@@ -81,9 +86,9 @@\n     \"codelyzer\": \"^6.0.0\",\n     \"cross-env\": \"^7.0.2\",\n     \"cypress\": \"^8.0.0\",\n-    \"cypress-browser-extension-plugin\": \"^0.1.0\",\n     \"cypress-iframe\": \"^1.0.1\",\n     \"document-register-element\": \"^1.7.2\",\n+    \"history-server\": \"^1.3.1\",\n     \"html-insert-assets\": \"^0.14.2\",\n     \"husky\": \"^4.3.8\",\n     \"jasmine-core\": \"~3.10.0\",\n@@ -107,7 +112,7 @@\n     \"todomvc-app-css\": \"^2.3.0\",\n     \"todomvc-common\": \"^1.0.5\",\n     \"ts-node\": \"~10.3.0\",\n-    \"tsickle\": \"^0.43.0\",\n+    \"tsickle\": \"0.40.0\",\n     \"tslint\": \"~5.20.0\",\n     \"typescript\": \"~4.4.3\",\n     \"wait-on\": \"^6.0.0\","
        },
        {
            "sha": "329e7ff572455050554c53dd711e042d1fe56133",
            "filename": "packages.bzl",
            "status": "added",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/packages.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/packages.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,88 @@\n+# Each individual package uses a placeholder for the version of Angular to ensure they're\n+# all in-sync. This map is passed to each ng_package rule to stamp out the appropriate\n+# version for the placeholders.\n+ANGULAR_PACKAGE_VERSION = \"^13.0.0 || ^14.0.0-0\"\n+MDC_PACKAGE_VERSION = \"14.0.0-canary.1af7c1c4a.0\"\n+TSLIB_PACKAGE_VERSION = \"^2.3.0\"\n+RXJS_PACKAGE_VERSION = \"^6.5.3 || ^7.4.0\"\n+\n+# Each placeholder is used to stamp versions during the build process, replacing the key with it's\n+# value pair. These replacements occur during building of `npm_package` and `ng_package` stamping in\n+# the peer dependencies and versions, primarily in `package.json`s.\n+NPM_PACKAGE_SUBSTITUTIONS = {\n+    # Version of `material-components-web`\n+    \"0.0.0-MDC\": MDC_PACKAGE_VERSION,\n+    # Version of `@angular/core`\n+    \"0.0.0-NG\": ANGULAR_PACKAGE_VERSION,\n+    # Version of `tslib`\n+    \"0.0.0-TSLIB\": TSLIB_PACKAGE_VERSION,\n+    # Version of the local package being built, generated via the `--workspace_status_command` flag.\n+    \"0.0.0-PLACEHOLDER\": \"{BUILD_SCM_VERSION}\",\n+    # Version of `rxjs`\n+    \"0.0.0-RXJS\": RXJS_PACKAGE_VERSION,\n+}\n+\n+NO_STAMP_NPM_PACKAGE_SUBSTITUTIONS = dict(NPM_PACKAGE_SUBSTITUTIONS, **{\n+    # When building NPM packages for tests (where stamping is disabled),\n+    # we use `0.0.0` for the version placeholder.\n+    \"0.0.0-PLACEHOLDER\": \"0.0.0\",\n+})\n+\n+# List of MDC packages.\n+MDC_PACKAGES = [\n+    \"@material/animation\",\n+    \"@material/auto-init\",\n+    \"@material/base\",\n+    \"@material/checkbox\",\n+    \"@material/chips\",\n+    \"@material/circular-progress\",\n+    \"@material/data-table\",\n+    \"@material/dialog\",\n+    \"@material/dom\",\n+    \"@material/drawer\",\n+    \"@material/floating-label\",\n+    \"@material/form-field\",\n+    \"@material/icon-button\",\n+    \"@material/line-ripple\",\n+    \"@material/linear-progress\",\n+    \"@material/list\",\n+    \"@material/menu-surface\",\n+    \"@material/menu\",\n+    \"@material/notched-outline\",\n+    \"@material/radio\",\n+    \"@material/ripple\",\n+    \"@material/select\",\n+    \"@material/slider\",\n+    \"@material/snackbar\",\n+    \"@material/switch\",\n+    \"@material/tab-bar\",\n+    \"@material/tab-indicator\",\n+    \"@material/tab-scroller\",\n+    \"@material/tab\",\n+    \"@material/textfield\",\n+    \"@material/tooltip\",\n+    \"@material/top-app-bar\",\n+]\n+\n+ANGULAR_PACKAGES_CONFIG = [\n+    (\"@angular/animations\", struct(entry_points = [\"browser\"])),\n+    (\"@angular/common\", struct(entry_points = [\"http/testing\", \"http\", \"testing\"])),\n+    (\"@angular/compiler\", struct(entry_points = [\"testing\"])),\n+    (\"@angular/core\", struct(entry_points = [\"testing\"])),\n+    (\"@angular/forms\", struct(entry_points = [])),\n+    (\"@angular/platform-browser\", struct(entry_points = [\"testing\", \"animations\"])),\n+    (\"@angular/platform-server\", struct(entry_points = [], platform = \"node\")),\n+    (\"@angular/platform-browser-dynamic\", struct(entry_points = [\"testing\"])),\n+    (\"@angular/router\", struct(entry_points = [])),\n+    (\"@angular/localize\", struct(entry_points = [\"init\"])),\n+]\n+\n+ANGULAR_PACKAGES = [\n+    struct(\n+        name = name[len(\"@angular/\"):],\n+        entry_points = config.entry_points,\n+        platform = config.platform if hasattr(config, \"platform\") else \"browser\",\n+        module_name = name,\n+    )\n+    for name, config in ANGULAR_PACKAGES_CONFIG\n+]"
        },
        {
            "sha": "6341e1f4f1c0a7d7da64db402cb8b5fe3af202d7",
            "filename": "projects/demo-no-zone/.bazelrc",
            "status": "removed",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fdemo-no-zone%2F.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fdemo-no-zone%2F.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2F.bazelrc?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,4 +0,0 @@\n-import %workspace%/../../common.bazelrc\n-# Use the Angular Ivy compiler\n-# See https://github.com/angular/angular/blob/master/docs/BAZEL.md#various-flags-used-for-tests\n-build --define=angular_ivy_enabled=True"
        },
        {
            "sha": "0b432a31aed66e95c61c480dd3206d04b4a07b7d",
            "filename": "projects/demo-no-zone/BUILD.bazel",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,9 @@\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+ts_config(\n+    name = \"tsconfig-app\",\n+    src = \"tsconfig.app.json\",\n+    deps = [\"//:tsconfig.json\"],\n+)\n\\ No newline at end of file"
        },
        {
            "sha": "50117d638606975966fae1362254768250cfa2dc",
            "filename": "projects/demo-no-zone/src/BUILD.bazel",
            "status": "modified",
            "additions": 33,
            "deletions": 23,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2Fsrc%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,6 +1,8 @@\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"concatjs_devserver\")\n load(\"@npm//html-insert-assets:index.bzl\", \"html_insert_assets\")\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n+load(\"@npm//history-server:index.bzl\", \"history_server\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"pkg_web\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n \n@@ -18,13 +20,15 @@ html_insert_assets(\n         \"--roots=. $(RULEDIR)\",\n         \"--assets\",\n     ] + [\"$(execpath %s)\" % s for s in _ASSETS] + [\n-        # This file doesn't exist during the build, but will be served by concatjs_devserver\n-        \"./_/ts_scripts.js\",\n+        \"--scripts --module $(execpath :bundle-es2015)/index.js\",\n     ],\n-    data = [\"//projects/demo-no-zone/src:_index.html\"] + _ASSETS,\n+    data = [\n+        \"//projects/demo-no-zone/src:_index.html\",\n+        \":bundle-es2015\",\n+    ] + _ASSETS,\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"src\",\n     srcs = [\"main.ts\"],\n     deps = [\n@@ -36,28 +40,34 @@ ng_ts_library(\n         \"@npm//rxjs\",\n         \"@npm//@types\",\n     ],\n-    module_name = \"demo-no-zone\",\n+    tsconfig = \"//projects/demo-no-zone:tsconfig-app\"\n )\n \n-filegroup(\n-    name = \"rxjs_umd_modules\",\n-    srcs = [\n-        \":rxjs_shims.js\",\n-        \"@npm//:node_modules/rxjs/bundles/rxjs.umd.js\",\n+rollup_bundle(\n+    name = \"bundle-es2015\",\n+    config_file = \"rollup.config.js\",\n+    entry_points = {\n+        \":main.ts\": \"index\",\n+    },\n+    output_dir = True,\n+    deps = [\n+        \":src\",\n+        \"@npm//@rollup/plugin-commonjs\",\n+        \"@npm//@rollup/plugin-node-resolve\",\n     ],\n )\n \n-concatjs_devserver(\n-    name = \"devserver\",\n-    entry_module = \"demo-no-zone/main\",\n-    scripts = [\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-        \":rxjs_umd_modules\",\n-    ],\n-    static_files = _ASSETS + [\n-        \"//projects/demo-no-zone/src:src\",\n+pkg_web(\n+    name = \"devapp\",\n+    srcs = _ASSETS + [\n+        \":bundle-es2015\",\n         \":inject_scripts_for_dev\",\n     ],\n-    deps = [\"//projects/demo-no-zone/src\"],\n-    port = 4200\n+    additional_root_paths = [],\n )\n+\n+history_server(\n+    name = \"devserver\",\n+    data = [\":devapp\"],\n+    templated_args = [\"-a $$(rlocation $(rootpath :devapp))\", \"--port 4200\"],\n+)\n\\ No newline at end of file"
        },
        {
            "sha": "460b9b2691eee6387864ce5992142348eae611c2",
            "filename": "projects/demo-no-zone/src/app/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2Fapp%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2Fapp%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2Fsrc%2Fapp%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"app\",\n     srcs = glob(\n         include = [\"*.ts\"],\n@@ -14,4 +14,5 @@ ng_ts_library(\n         \"@npm//@angular/platform-browser\",\n         \"@npm//rxjs\",\n     ],\n+    tsconfig = \"//projects/demo-no-zone:tsconfig-app\"\n )"
        },
        {
            "sha": "87158723b337e2937c24c3c01ddd4be54fffa46a",
            "filename": "projects/demo-no-zone/src/rollup.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2Frollup.config.js",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Fsrc%2Frollup.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2Fsrc%2Frollup.config.js?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,11 @@\n+const { nodeResolve } = require('@rollup/plugin-node-resolve');\n+const commonjs = require('@rollup/plugin-commonjs');\n+\n+module.exports = {\n+  plugins: [\n+    nodeResolve({\n+      mainFields: ['browser', 'es2015', 'module', 'jsnext:main', 'main'],\n+    }),\n+    commonjs(),\n+  ],\n+};"
        },
        {
            "sha": "37af4d578c647d311246cf3f9d7468667a4e7c09",
            "filename": "projects/demo-no-zone/src/rxjs_shims.js",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fdemo-no-zone%2Fsrc%2Frxjs_shims.js",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fdemo-no-zone%2Fsrc%2Frxjs_shims.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2Fsrc%2Frxjs_shims.js?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,44 +0,0 @@\n-/**\n- * @license\n- * Copyright Google Inc. All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * @fileoverview these provide named UMD modules so that we can bundle\n- * the application along with rxjs using the concatjs bundler.\n- */\n-\n-// rxjs/operators\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('rxjs/operators', ['exports', 'rxjs'], factory);\n-  }\n-})(function (exports, rxjs) {\n-  'use strict';\n-  Object.keys(rxjs.operators).forEach(function (key) {\n-    exports[key] = rxjs.operators[key];\n-  });\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});\n-\n-// rxjs/testing\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('rxjs/testing', ['exports', 'rxjs'], factory);\n-  }\n-})(function (exports, rxjs) {\n-  'use strict';\n-  Object.keys(rxjs.testing).forEach(function (key) {\n-    exports[key] = rxjs.testing[key];\n-  });\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});"
        },
        {
            "sha": "a7dc3157fddb1e883534a9fc4bd9cf4e95d530af",
            "filename": "projects/demo-no-zone/tsconfig.app.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Ftsconfig.app.json",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fdemo-no-zone%2Ftsconfig.app.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fdemo-no-zone%2Ftsconfig.app.json?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -2,6 +2,7 @@\n   \"extends\": \"../../tsconfig.json\",\n   \"compilerOptions\": {\n     \"outDir\": \"../../out-tsc/app\",\n+    \"declaration\": true,\n     \"types\": []\n   },\n   \"include\": [\"src/**/*.ts\"],"
        },
        {
            "sha": "2faba82f1ac70eee2ddf577a068415f922338cbf",
            "filename": "projects/ng-devtools-backend/BUILD.bazel",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,6 +1,7 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -10,12 +11,17 @@ ts_config(\n     deps = [\"//:tsconfig.json\"],\n )\n \n-ng_ts_library(\n-    name = \"ng-devtools-backend\",\n+ts_project(\n+    name = \"ng-devtools-backend-ts\",\n     srcs = [\"index.ts\"],\n     deps = [\n         \"//projects/ng-devtools-backend/src\",\n     ],\n-    module_name = \"ng-devtools-backend\",\n     tsconfig = \":tsconfig-lib\"\n )\n+\n+js_library(\n+    name = \"ng-devtools-backend\",\n+    package_name = \"ng-devtools-backend\",\n+    deps = [\":ng-devtools-backend-ts\"],\n+)\n\\ No newline at end of file"
        },
        {
            "sha": "9c49d2608ad98bae055f6dc50ae0ba688ef679c4",
            "filename": "projects/ng-devtools-backend/src/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"src\",\n     srcs = [\"public-api.ts\"],\n     deps = ["
        },
        {
            "sha": "649f4bc00c196e663c75314fc7efc0d1a1585f70",
            "filename": "projects/ng-devtools-backend/src/lib/BUILD.bazel",
            "status": "modified",
            "additions": 17,
            "deletions": 38,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"lib\",\n     srcs = [\"index.ts\"],\n     deps = [\n@@ -20,18 +20,13 @@ ng_ts_library(\n \n karma_web_test_suite(\n     name = \"highlighter-test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":highlighter-test-lib\",\n     ],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"highlighter-test-lib\",\n-    testonly = True,\n     srcs = [\n         \"highlighter.spec.ts\"\n     ],\n@@ -40,20 +35,16 @@ ts_library(\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"highlighter\",\n     srcs = [\"highlighter.ts\"],\n-    deps = [\n-        \"@npm//@angular/core\"\n-    ],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"interfaces\",\n     srcs = [\"interfaces.ts\"],\n     deps = [\n@@ -64,16 +55,12 @@ ng_ts_library(\n \n karma_web_test_suite(\n     name = \"router-tree-test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":router-tree-test-lib\",\n     ],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"router-tree-test-lib\",\n     srcs = [\n         \"router-tree.spec.ts\"\n@@ -85,21 +72,19 @@ ts_library(\n         \"@npm//@angular/router\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"router-tree\",\n     srcs = [\"router-tree.ts\"],\n     deps = [\n         \"//projects/protocol\",\n-        \"@npm//@angular/router\",\n     ],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"set-console-reference\",\n     srcs = [\"set-console-reference.ts\"],\n     deps = [\n@@ -110,19 +95,20 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"utils\",\n     srcs = [\"utils.ts\"],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+\n+ts_project(\n     name = \"version\",\n     srcs = [\"version.ts\"],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"client-event-subscribers\",\n     srcs = [\"client-event-subscribers.ts\"],\n     deps = [\n@@ -141,44 +127,37 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"component-tree\",\n     srcs = [\"component-tree.ts\"],\n     deps = [\n         \"//projects/protocol\",\n         \"//projects/ng-devtools-backend/src/lib/state-serializer\",\n         \"//projects/ng-devtools-backend/src/lib/directive-forest\",\n-        \"@npm//@angular/core\",\n         \":interfaces\"\n     ],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n karma_web_test_suite(\n     name = \"angular-check-test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":angular-check-test-lib\",\n     ],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"angular-check-test-lib\",\n-    testonly = True,\n     srcs = [\n         \"angular-check.spec.ts\"\n     ],\n     deps = [\n         \":angular-check\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n )\n \n-ng_ts_library(\n+ts_project(\n     name = \"angular-check\",\n     srcs = [\"angular-check.ts\"],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\""
        },
        {
            "sha": "f4e250e81dc52a92e57cea7b2f98b793ffcf9205",
            "filename": "projects/ng-devtools-backend/src/lib/component-inspector/BUILD.bazel",
            "status": "modified",
            "additions": 6,
            "deletions": 19,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"component-inspector\",\n     srcs = [\"component-inspector.ts\"],\n     deps = [\n@@ -13,29 +13,17 @@ ng_ts_library(\n         \"//projects/ng-devtools-backend/src/lib:component-tree\",\n         \"//projects/ng-devtools-backend/src/lib:interfaces\",\n         \"//projects/ng-devtools-backend/src/lib/hooks\",\n-        \"@npm//rxjs\",\n-        \"@npm//@angular/core\"\n     ],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n-    deps = [\n-        \":test-lib\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-        \"//src:rxjs_umd_modules\",\n-        \"//src:semver-dsl_umd_modules\",\n-    ],\n+    deps = [\":test-lib\"],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"component-inspector.spec.ts\",\n     ],\n@@ -47,7 +35,6 @@ ts_library(\n         \"//projects/ng-devtools-backend/src/lib:highlighter\",\n         \"@npm//@angular/core\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n         \"//projects/ng-devtools-backend/src/lib:interfaces\",\n         \"//projects/ng-devtools-backend/src/lib:utils\",\n     ],"
        },
        {
            "sha": "5876003a1b52b2a43ba13851e12624fb508c5d3e",
            "filename": "projects/ng-devtools-backend/src/lib/component-inspector/component-inspector.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2Fcomponent-inspector.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2Fcomponent-inspector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-inspector%2Fcomponent-inspector.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,12 @@\n import { unHighlight, highlight, findComponentAndHost } from '../highlighter';\n-import { Type } from '@angular/core';\n import { findNodeInForest } from '../component-tree';\n import { ComponentTreeNode } from '../interfaces';\n import { ElementPosition } from 'protocol';\n import { initializeOrGetDirectiveForestHooks } from '../hooks';\n \n+interface Type<T> extends Function {\n+  new (...args: any[]): T;\n+}\n export interface ComponentInspectorOptions {\n   onComponentEnter: (id: number) => void;\n   onComponentSelect: (id: number) => void;"
        },
        {
            "sha": "9012ac6629e4756a8c149493c65be5be118d8c71",
            "filename": "projects/ng-devtools-backend/src/lib/directive-forest/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"directive-forest\",\n     srcs = glob(\n         include = [\"*.ts\"],\n@@ -22,25 +22,19 @@ ng_ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":test-lib\",\n     ],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"render-tree.spec.ts\",\n     ],\n     deps = [\n         \":directive-forest\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n         \"//projects/ng-devtools-backend/src/lib:interfaces\",\n         \"//projects/ng-devtools-backend/src/lib:utils\",\n     ],"
        },
        {
            "sha": "f1648106987009cf81cbbcc587d875bee2cf5718",
            "filename": "projects/ng-devtools-backend/src/lib/highlighter.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhighlighter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhighlighter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhighlighter.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,12 @@\n-import { Type } from '@angular/core';\n-\n let overlay: any;\n let overlayContent: HTMLElement;\n \n declare const ng: any;\n \n+interface Type<T> extends Function {\n+  new (...args: any[]): T;\n+}\n+\n export const DEV_TOOLS_HIGHLIGHT_NODE_ID = '____ngDevToolsHighlight';\n \n function init(): void {"
        },
        {
            "sha": "64c00b4d508514f33a79abfe4a7a04d7f564bcf8",
            "filename": "projects/ng-devtools-backend/src/lib/hooks/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"hooks\",\n     srcs = glob(\n         include = [\"*.ts\"],\n@@ -20,14 +20,13 @@ ng_ts_library(\n )\n \n \n-ng_ts_library(\n+ts_project(\n     name = \"identity-tracker\",\n     srcs = [\"identity-tracker.ts\"],\n     deps = [\n         \"//projects/protocol\",\n         \"//projects/ng-devtools-backend/src/lib:component-tree\",\n         \"//projects/ng-devtools-backend/src/lib:interfaces\",\n-        \"@npm//@angular/core\"\n     ],\n     tsconfig = \"//projects/ng-devtools-backend:tsconfig-lib\"\n )"
        },
        {
            "sha": "08a13a0637e81db4809c82c54ff41c6b544ad003",
            "filename": "projects/ng-devtools-backend/src/lib/hooks/identity-tracker.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fidentity-tracker.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fidentity-tracker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fidentity-tracker.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,7 +1,10 @@\n import { ComponentTreeNode, DirectiveInstanceType, ComponentInstanceType } from '../interfaces';\n import { ElementPosition, DevToolsNode } from 'protocol';\n import { buildDirectiveForest } from '../component-tree';\n-import { Type } from '@angular/core';\n+\n+export declare interface Type<T> extends Function {\n+  new (...args: any[]): T;\n+}\n \n interface TreeNode {\n   parent: TreeNode;"
        },
        {
            "sha": "c268515fbf605b5edb7f7d22e12adf0451fd9222",
            "filename": "projects/ng-devtools-backend/src/lib/hooks/profiler/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fprofiler%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fprofiler%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fhooks%2Fprofiler%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"profiler\",\n     srcs = glob(\n         include = [\"*.ts\"],"
        },
        {
            "sha": "4cbcb7a497a9e139e9380f8fabd5929038a2e158",
            "filename": "projects/ng-devtools-backend/src/lib/router-tree.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Frouter-tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Frouter-tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Frouter-tree.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,9 @@\n import { Route } from 'protocol';\n-import { Router, Routes, Route as AngularRoute } from '@angular/router';\n+\n+// todo(aleksanderbodurri): type these properly\n+type AngularRoute = any;\n+type Routes = any;\n+type Router = any;\n \n export function parseRoutes(router: Router): Route {\n   const rootName = (router as any).rootComponentType?.name || 'no-name';"
        },
        {
            "sha": "0af0220f6fd86e22268acaae5dc998f3790416c8",
            "filename": "projects/ng-devtools-backend/src/lib/state-serializer/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 12,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"state-serializer\",\n     srcs = glob(\n         include = [\"*.ts\"],\n@@ -19,26 +19,19 @@ ng_ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n-        \"@npm//:node_modules/tslib/tslib.js\",\n         \":test-lib\"\n     ],\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"state-serializer.spec.ts\",\n     ],\n     deps = [\n         \":state-serializer\",\n         \"//projects/protocol\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n )\n\\ No newline at end of file"
        },
        {
            "sha": "f883c50038454889307417527bbf63494cbb5acc",
            "filename": "projects/ng-devtools-backend/tsconfig.lib.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Ftsconfig.lib.json",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools-backend%2Ftsconfig.lib.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Ftsconfig.lib.json?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -9,7 +9,7 @@\n     \"lib\": [\"dom\", \"es2018\"]\n   },\n   \"angularCompilerOptions\": {\n-    \"annotateForClosureCompiler\": true,\n+    \"annotateForClosureCompiler\": false,\n     \"skipTemplateCodegen\": true,\n     \"strictMetadataEmit\": true,\n     \"fullTemplateTypeCheck\": true,"
        },
        {
            "sha": "c42747caa08b1586ecf859632c0819dd98547d2f",
            "filename": "projects/ng-devtools/BUILD.bazel",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,6 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\", \"ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -11,8 +12,8 @@ ts_config(\n     deps = [\"//:tsconfig.json\"],\n )\n \n-ng_ts_library(\n-    name = \"ng-devtools\",\n+ng_ts_project(\n+    name = \"ng-devtools-ts\",\n     srcs = [\"index.ts\"],\n     deps = [\n         \"//projects/ng-devtools/src\",\n@@ -21,7 +22,6 @@ ng_ts_library(\n         \"@npm//@angular/core\",\n         \"@npm//memo-decorator\",\n         \"@npm//webtreemap\",\n-        \"@npm//@types/d3\",\n         \"@npm//d3\",\n         \"@npm//@angular/material\",\n         \"@npm//@angular/forms\",\n@@ -33,5 +33,10 @@ ng_ts_library(\n         \"@npm//@types\",\n     ],\n     tsconfig = \":tsconfig-lib\",\n-    module_name = \"ng-devtools\",\n+)\n+\n+js_library(\n+    name = \"ng-devtools\",\n+    package_name = \"ng-devtools\",\n+    deps = [\":ng-devtools-ts\"]\n )\n\\ No newline at end of file"
        },
        {
            "sha": "5358f0d80befc8c56d67020d8113076f493052c9",
            "filename": "projects/ng-devtools/src/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"src\",\n     srcs = [\"public-api.ts\"],\n     deps = ["
        },
        {
            "sha": "811a6473048f1786625db49b1c0480acd03de5d8",
            "filename": "projects/ng-devtools/src/lib/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"devtools.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"lib\",\n     srcs = glob(\n         include = [\"*.ts\"],\n@@ -35,7 +35,7 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"theme\",\n     srcs = glob(\n         include = [\"theme-service.ts\"],"
        },
        {
            "sha": "a176d0c55316a3f66b6cac02b72b432ad4a08a0f",
            "filename": "projects/ng-devtools/src/lib/application-environment/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-environment%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-environment%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-environment%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,9 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"application-environment\",\n     srcs = [\"index.ts\"],\n     deps = ["
        },
        {
            "sha": "d52d2816df63a3b2fa4184e2ba264f6cd315b2e5",
            "filename": "projects/ng-devtools/src/lib/application-operations/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-operations%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-operations%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fapplication-operations%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,9 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"application-operations\",\n     srcs = [\"index.ts\"],\n     deps = ["
        },
        {
            "sha": "e3a39883c5ea63d659009995765470b4371be60e",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 14,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,7 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\", \"ts_library\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -10,7 +11,7 @@ sass_binary(\n     src = \"devtools-tabs.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"devtools-tabs\",\n     srcs = [\n         \"devtools-tabs.component.ts\",\n@@ -37,9 +38,8 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"devtools-tabs-test\",\n-    testonly = True,\n     srcs = [\"devtools-tabs.spec.ts\"],\n     deps = [\n         \":devtools-tabs\",\n@@ -51,14 +51,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n-        \"//projects/ng-devtools/src/lib/devtools-tabs:devtools-tabs-test\",\n-        \"//src:rxjs_umd_modules\",\n-        \"//src:d3_umd_modules\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n+        \":devtools-tabs-test\",\n     ],\n )"
        },
        {
            "sha": "62d0dc36038c9d33b4c1a7a4d6c15ef0a0742e5e",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/diffing/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdiffing%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdiffing%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdiffing%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,9 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"diffing\",\n     srcs = glob(\n         include = ["
        },
        {
            "sha": "2f207287d71aa092f65deb07d7f4c8fd6cddf383",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,7 +1,9 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\", \"ts_library\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n+\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -10,7 +12,7 @@ sass_binary(\n     src = \"directive-explorer.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"directive-explorer\",\n     srcs = [\n         \"directive-explorer.component.ts\",\n@@ -40,9 +42,8 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"directive-explorer-test\",\n-    testonly = True,\n     srcs = [\"directive-explorer.spec.ts\"],\n     deps = [\n         \":directive-explorer\",\n@@ -55,13 +56,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":directive-explorer-test\",\n-        \"//src:rxjs_umd_modules\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n     ],\n )"
        },
        {
            "sha": "01d66554bfa84895f3a155f461226e33c69585bc",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/BUILD.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,6 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -8,7 +9,7 @@ sass_binary(\n     src = \"directive-forest.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"directive-forest\",\n     srcs = [\n         \"directive-forest-utils.ts\",\n@@ -35,4 +36,4 @@ ng_ts_library(\n         \"@npm//@types\",\n     ],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n-)\n\\ No newline at end of file\n+)"
        },
        {
            "sha": "a74c617f257b19fb76e5969bcf3cc22c438d05a7",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/breadcrumbs/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fbreadcrumbs%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fbreadcrumbs%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fbreadcrumbs%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"breadcrumbs.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"breadcrumbs\",\n     srcs = [\n         \"breadcrumbs.component.ts\",\n@@ -27,4 +27,4 @@ ng_ts_library(\n         \"@npm//@types\",\n     ],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n-)\n\\ No newline at end of file\n+)"
        },
        {
            "sha": "4e0063cc9cde497545c249b3f77713655eb9d17d",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/component-data-source/BUILD.bazel",
            "status": "modified",
            "additions": 9,
            "deletions": 18,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,17 +1,15 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n+\n+\n+\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"component-data-source\",\n-    srcs = glob(\n-        include = [\n-            \"index.ts\",\n-        ],\n-    ),\n+    srcs = [\"index.ts\"],\n     deps = [\n         \"//projects/protocol\",\n         \"//projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/index-forest\",\n@@ -26,9 +24,8 @@ ng_ts_library(\n )\n \n \n-ts_library(\n+ts_test_project(\n     name = \"component-data-source-test\",\n-    testonly = True,\n     srcs = glob([\"**/*.spec.ts\"]),\n     deps = [\n         \":component-data-source\",\n@@ -39,13 +36,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":component-data-source-test\",\n-        \"//src:rxjs_umd_modules\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n     ],\n )"
        },
        {
            "sha": "0d7b1cef3843a24754a407261820033b90bb093e",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/filter/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Ffilter%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Ffilter%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Ffilter%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"filter.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"filter\",\n     srcs = [\n         \"filter.component.ts\",\n@@ -26,4 +26,4 @@ ng_ts_library(\n         \"@npm//@types\",\n     ],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n-)\n\\ No newline at end of file\n+)"
        },
        {
            "sha": "79f4a0634821315d12927c519cb110352d645f14",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/index-forest/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 20,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Findex-forest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Findex-forest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Findex-forest%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,30 +1,21 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"index-forest\",\n-    srcs = glob(\n-        include = [\n-            \"index.ts\",\n-        ],\n-    ),\n+    srcs = [\"index.ts\"],\n     deps = [\n         \"//projects/protocol\",\n-        \"@npm//@angular/core\",\n-        \"@npm//@angular/cdk\",\n-        \"@npm//@angular/material\",\n-        \"@npm//rxjs\",\n-        \"@npm//@types\",\n+        \"@npm//@angular/material\"\n     ],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"index-forest-test\",\n-    testonly = True,\n     srcs = glob([\"**/*.spec.ts\"]),\n     deps = [\n         \":index-forest\",\n@@ -33,10 +24,6 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":index-forest-test\",\n     ],"
        },
        {
            "sha": "0ae8c7e75febdbcfede408de14ca6b439f02305d",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-resolver/BUILD.bazel",
            "status": "modified",
            "additions": 14,
            "deletions": 14,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"property-resolver\",\n     srcs = [\n         \"flatten.ts\",\n@@ -27,26 +27,26 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"property-resolver-test\",\n-    testonly = True,\n-    srcs = glob([\"**/*.spec.ts\"]),\n+    srcs = [\n+        \"arrayify-props.spec.ts\",\n+        \"directive-property-resolver.spec.ts\",\n+        \"element-property-resolver.spec.ts\",\n+        \"property-data-source.spec.ts\",\n+    ],\n     deps = [\n         \":property-resolver\",\n-        \"@npm//@angular/cdk\",\n         \"//projects/protocol\",\n+        \"@npm//@angular/cdk\",\n+        \"@npm//@angular/material\",\n     ],\n )\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":property-resolver-test\",\n-        \"//src:rxjs_umd_modules\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n+        \"@npm//@angular/material\",\n     ],\n )"
        },
        {
            "sha": "c6d536d95caab6f8ee95893407a896016857c11f",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -12,7 +12,7 @@ multi_sass_binary(\n     ],\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"property-tab\",\n     srcs = [\n         \"property-tab.component.ts\","
        },
        {
            "sha": "af2514a8a9ac179270bc45e74fa9150467f15716",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-tab/property-view/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2Fproperty-view%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2Fproperty-view%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-tab%2Fproperty-view%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -16,8 +16,7 @@ multi_sass_binary(\n     ],\n )\n \n-\n-ng_ts_library(\n+ng_ts_project(\n     name = \"property-view\",\n     srcs = [\n         \"property-view.component.ts\","
        },
        {
            "sha": "6de8b69282407cb9646ab4a4eccac9804e9a29e4",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -11,7 +11,7 @@ multi_sass_binary(\n     ],\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"profiler\",\n     srcs = [\n         \"profiler.component.ts\","
        },
        {
            "sha": "08264a7e1065c1a043e00e187fd2e5aa40c5d8c4",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,9 +1,11 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_library\", \"sass_binary\", \"multi_sass_binary\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n+\n package(default_visibility = [\"//visibility:public\"])\n \n+\n multi_sass_binary(\n     name = \"timeline-styles\",\n     srcs = [\n@@ -20,7 +22,7 @@ sass_binary(\n     src = \"recording-modal.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"timeline\",\n     srcs = [\n         \"timeline.component.ts\",\n@@ -57,9 +59,8 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"filter.spec.ts\",\n         \"timeline.component.spec.ts\"\n@@ -71,13 +72,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \":test-lib\",\n-        \"//src:rxjs_umd_modules\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n     ],\n )"
        },
        {
            "sha": "73f07e7d62c48c6f3b9e9876a5410882c8098dc0",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"record-formatter\",\n     srcs = glob(\n         include = [\n@@ -25,7 +25,7 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_project(\n     name = \"record-formatter-spec-constants\",\n     srcs = [\"record-formatter-spec-constants.ts\"],\n     deps = [\n@@ -38,9 +38,8 @@ ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"record-formatter.spec.ts\",\n         \"frame-merger.spec.ts\",\n@@ -55,12 +54,8 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n-        \"//projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter:test-lib\",\n+        \":test-lib\",\n     ],\n )\n "
        },
        {
            "sha": "d5890e1557b0c925a06560bb677e22b46a7e9ddf",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/bargraph-formatter/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fbargraph-formatter%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fbargraph-formatter%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fbargraph-formatter%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"bargraph-formatter\",\n     srcs = glob(\n         include = ["
        },
        {
            "sha": "0b14db1a24a4b5e853aa51cee6e7c299fb09b165",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/flamegraph-formatter/BUILD.bazel",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fflamegraph-formatter%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fflamegraph-formatter%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Fflamegraph-formatter%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,10 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"flamegraph-formatter\",\n     srcs = glob(\n         include = [\n@@ -24,9 +24,8 @@ ng_ts_library(\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"flamegraph-formatter.spec.ts\"\n     ],\n@@ -40,12 +39,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n-        \"//projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/flamegraph-formatter:test-lib\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n+        \":test-lib\",\n     ],\n )"
        },
        {
            "sha": "5ea6abdcab2d694e0421a0b8984e252fad57e99c",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/tree-map-formatter/BUILD.bazel",
            "status": "modified",
            "additions": 7,
            "deletions": 16,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Ftree-map-formatter%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Ftree-map-formatter%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecord-formatter%2Ftree-map-formatter%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,11 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n+\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"tree-map-formatter\",\n     srcs = glob(\n         include = [\n@@ -16,19 +17,14 @@ ng_ts_library(\n     ),\n     deps = [\n         \"//projects/protocol\",\n-        \"//projects/ng-devtools/src/lib:theme\",\n         \"//projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter\",\n         \"//projects/ng-devtools/src/lib/vendor/memo-decorator\",\n-        \"@npm//@angular/core\",\n-        \"@npm//rxjs\",\n-        \"@npm//@types\",\n     ],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n \n-ts_library(\n+ts_test_project(\n     name = \"test-lib\",\n-    testonly = True,\n     srcs = [\n         \"tree-map-formatter.spec.ts\"\n     ],\n@@ -42,12 +38,7 @@ ts_library(\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n-        \"//projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/record-formatter/tree-map-formatter:test-lib\",\n-        \"@npm//:node_modules/tslib/tslib.js\",\n+        \":test-lib\",\n     ],\n )\n\\ No newline at end of file"
        },
        {
            "sha": "1ec153509f472bfabb9d98c1f565c46ec703d400",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/recording-visualizer/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecording-visualizer%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecording-visualizer%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Frecording-visualizer%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -15,7 +15,7 @@ multi_sass_binary(\n     ],\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"recording-visualizer\",\n     srcs = [\n         \"recording-visualizer.module.ts\","
        },
        {
            "sha": "ca2f35ff5b855604965ef6e8bfdea9ace9faf3cf",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/timeline/visualization-mode/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Fvisualization-mode%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Fvisualization-mode%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Ftimeline%2Fvisualization-mode%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,9 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"visualization-mode\",\n     srcs = [\"index.ts\"],\n-    deps = [],\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n\\ No newline at end of file"
        },
        {
            "sha": "944b315796b85ba5f7717124cbe3bc8a96fab1b7",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/router-tree/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Frouter-tree%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Frouter-tree%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Frouter-tree%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,6 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n \n@@ -9,7 +8,7 @@ sass_binary(\n     src = \"router-tree.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"router-tree\",\n     srcs = [\n         \"router-tree.component.ts\","
        },
        {
            "sha": "394fc4e589c33fb74e765235893bf1743787584c",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/tab-update/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Ftab-update%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Ftab-update%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Ftab-update%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ts_project(\n     name = \"tab-update\",\n     srcs = glob(\n         include = ["
        },
        {
            "sha": "1762b7903e953936838248bd1522bf41d59ae5a8",
            "filename": "projects/ng-devtools/src/lib/vendor/angular-split/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"angular-split\",\n     srcs = [\"public_api.ts\"],\n     deps = [\n@@ -12,7 +12,6 @@ ng_ts_library(\n         \"@npm//rxjs\",\n         \"@npm//@types\",\n     ],\n-    module_name = \"public_api\",\n     tsconfig = \"//projects/ng-devtools:tsconfig-lib\"\n )\n "
        },
        {
            "sha": "c5cbc92a66d11350eab57f5b98c6b99a31aaaa8c",
            "filename": "projects/ng-devtools/src/lib/vendor/angular-split/lib/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"//projects/ng-devtools/src/lib/vendor/angular-split/lib/component:split.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"lib\",\n     srcs = glob(\n         include = ["
        },
        {
            "sha": "7219daabe57ce041051f23f768df986f3b433559",
            "filename": "projects/ng-devtools/src/lib/vendor/angular-split/lib/component/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2Fcomponent%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2Fcomponent%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fangular-split%2Flib%2Fcomponent%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"split.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"split\",\n     srcs = [\n         \"split.component.ts\","
        },
        {
            "sha": "fbacafabfcbad70f4632f0b198348df17190348e",
            "filename": "projects/ng-devtools/src/lib/vendor/chromium/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fchromium%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fchromium%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fchromium%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,9 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n \n-ts_library(\n+ts_project(\n     name = \"chromium\",\n     srcs = [\"date-utilities.ts\"],\n-    module_name = \"chromium\"\n )\n\\ No newline at end of file"
        },
        {
            "sha": "a076bc646401221a71544a79e0560180e33f16cc",
            "filename": "projects/ng-devtools/src/lib/vendor/memo-decorator/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fmemo-decorator%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fmemo-decorator%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fmemo-decorator%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n \n-ts_library(\n+ts_project(\n     name = \"memo-decorator\",\n     srcs = [\"index.ts\"],\n )\n\\ No newline at end of file"
        },
        {
            "sha": "4fa15078796297d5a934bd29d354a4ce55676c8f",
            "filename": "projects/ng-devtools/src/lib/vendor/webtreemap/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,9 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//:__subpackages__\"])\n \n-ts_library(\n+ts_project(\n     name = \"webtreemap\",\n     srcs = [\"tree.ts\", \"treemap.ts\"],\n-    tsconfig = \":tsconfig.json\",\n )\n\\ No newline at end of file"
        },
        {
            "sha": "f0209594071189d1e3225e81525e7561cddce522",
            "filename": "projects/ng-devtools/src/lib/vendor/webtreemap/tsconfig.json",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fvendor%2Fwebtreemap%2Ftsconfig.json?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,11 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"rootDir\": \"./\",\n-    \"types\": [],\n-    \"lib\": [\"dom\", \"es2018\"],\n-    \"module\": \"es6\",\n-    \"target\": \"es5\"\n-  },\n-  \"include\": [\"./dist\"],\n-  \"files\": [\"dist/webtreemap.js\"]\n-}"
        },
        {
            "sha": "62b6412e55eb29b91b2339e0b9b7b2dc20e18774",
            "filename": "projects/protocol/BUILD.bazel",
            "status": "modified",
            "additions": 14,
            "deletions": 13,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fprotocol%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fprotocol%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fprotocol%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\", \"ts_config\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -17,38 +20,36 @@ ts_config(\n     deps = [\"//:tsconfig.json\"],\n )\n \n-ts_library(\n-    name = \"protocol\",\n+ts_project(\n+    name = \"protocol-ts\",\n     srcs = glob([\"**/*.ts\"], exclude = [\"**/*.spec.ts\", \"src/test.ts\"]),\n     deps = [\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n     ],\n-    module_name = \"protocol\",\n     tsconfig = \":tsconfig-lib\",\n )\n \n-ts_library(\n+js_library(\n+    name = \"protocol\",\n+    package_name = \"protocol\",\n+    deps = [\":protocol-ts\"],\n+)\n+\n+ts_test_project(\n     name = \"protocol_test\",\n-    testonly = True,\n     srcs = glob([\"**/*.spec.ts\"]),\n     deps = [\n         \":protocol\",\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n-    tsconfig = \":tsconfig-spec\",\n )\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \"//projects/protocol:protocol_test\",\n     ],"
        },
        {
            "sha": "7eef5b3b51ae1d21ec01e9880aee089651a5b26f",
            "filename": "projects/shared-utils/BUILD.bazel",
            "status": "modified",
            "additions": 14,
            "deletions": 15,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshared-utils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshared-utils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fshared-utils%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,5 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\", \"ts_config\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_config\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_test_project\")\n+load(\"//tools:defaults.bzl\", \"karma_web_test_suite\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -9,47 +12,43 @@ ts_config(\n     deps = [\"//:tsconfig.json\"],\n )\n \n-\n ts_config(\n     name = \"tsconfig-spec\",\n     src = \"tsconfig.spec.json\",\n     deps = [\"//:tsconfig.json\"],\n )\n \n-ts_library(\n-    name = \"shared-utils\",\n+ts_project(\n+    name = \"shared-utils-ts\",\n     srcs = glob([\"**/*.ts\"], exclude = [\"**/*.spec.ts\", \"src/test.ts\"]),\n     deps = [\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n     ],\n-    module_name = \"shared-utils\",\n     tsconfig = \":tsconfig-lib\"\n )\n \n-ts_library(\n+js_library(\n+    name = \"shared-utils\",\n+    package_name = \"shared-utils\",\n+    deps = [\":shared-utils-ts\"],\n+)\n+\n+ts_test_project(\n     name = \"shared-utils-test\",\n-    testonly = True,\n     srcs = glob([\"**/*.spec.ts\"]),\n     deps = [\n         \":shared-utils\",\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser-dynamic\",\n         \"@npm//@types\",\n-        \"@npm//@types/jasmine\",\n     ],\n-    tsconfig = \":tsconfig-spec\",\n )\n \n karma_web_test_suite(\n     name = \"test\",\n-    browsers = [\n-        \"//:no-sandbox-chrome\",\n-    ],\n-    tags = [\"native\"],\n     deps = [\n         \"//projects/shared-utils:shared-utils-test\",\n-         \"@npm//:node_modules/tslib/tslib.js\",\n     ],\n )\n\\ No newline at end of file"
        },
        {
            "sha": "e36e2ae6c603fdd706ebad195f7b2fdd11275685",
            "filename": "projects/shell-chrome/src/BUILD.bazel",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fshell-chrome%2Fsrc%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,10 +1,11 @@\n load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n load(\"@npm//@bazel/terser:index.bzl\", \"terser_minified\")\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_library\", \"sass_binary\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"pkg_web\")\n load(\"@npm//html-insert-assets:index.bzl\", \"html_insert_assets\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -20,18 +21,22 @@ sass_binary(\n     sourcemap = False,\n )\n \n-ts_library(\n-    name = \"devtools\",\n+ts_project(\n+    name = \"devtools-ts\",\n     srcs = [\n         \"devtools.ts\"\n     ],\n     deps = [\n         \"@npm//@types/chrome\",\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ng_ts_library(\n+js_library(\n+    name = \"devtools\",\n+    deps = [\":devtools-ts\"]\n+)\n+\n+ng_ts_project(\n     name = \"src\",\n     srcs = [\n       \"main.ts\",\n@@ -44,8 +49,6 @@ ng_ts_library(\n       \"@npm//@angular/core\",\n       \"@npm//@angular/platform-browser-dynamic\",\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n-    module_name = \"shell-chrome\",\n )\n \n "
        },
        {
            "sha": "0581eeaa44b4ac276199f98cbe8d247a388b24ca",
            "filename": "projects/shell-chrome/src/app/BUILD.bazel",
            "status": "modified",
            "additions": 26,
            "deletions": 31,
            "changes": 57,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2Fapp%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2Fapp%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fshell-chrome%2Fsrc%2Fapp%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n load(\"@npm//@bazel/terser:index.bzl\", \"terser_minified\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -11,7 +11,7 @@ sass_binary(\n     src = \"app.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"app\",\n     srcs = [\n         \"app.component.ts\",\n@@ -36,70 +36,67 @@ ng_ts_library(\n         \"@npm//@angular/core\",\n         \"@npm//@angular/platform-browser\",\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"ng-validate\",\n     srcs = [\n         \"ng-validate.ts\"\n     ],\n     deps = [\n         \"@npm//@types/chrome\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"chrome-window-extensions\",\n     srcs = [\n         \"chrome-window-extensions.ts\"\n     ],\n     deps = [\n         \"//projects/ng-devtools-backend\",\n-        \"//projects/ng-devtools-backend/src/lib:component-tree\"\n+        \"//projects/ng-devtools-backend/src/lib:component-tree\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"chrome-application-environment\",\n     srcs = [\n         \"chrome-application-environment.ts\"\n     ],\n     deps = [\n         \"//projects/shell-chrome/src/environments:environment\",\n-        \"//projects/ng-devtools\"\n+        \"//projects/ng-devtools\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"chrome-application-operations\",\n     srcs = [\n         \"chrome-application-operations.ts\"\n     ],\n     deps = [\n         \"//projects/protocol\",\n         \"//projects/ng-devtools\",\n-        \"@npm//@types/chrome\"\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"same-page-message-bus\",\n     srcs = [\n         \"same-page-message-bus.ts\",\n     ],\n     deps = [\n         \"//projects/protocol\",\n-        \"@npm//@angular/core\"\n+        \"@npm//@angular/core\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"zone-aware-chrome-message-bus\",\n     srcs = [\n         \"zone-aware-chrome-message-bus.ts\",\n@@ -108,32 +105,31 @@ ts_library(\n         \":chrome-message-bus\",\n         \"//projects/protocol\",\n         \"@npm//@angular/core\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"chrome-message-bus\",\n     srcs = [\n         \"chrome-message-bus.ts\"\n     ],\n     deps = [\n         \"//projects/protocol\",\n-        \"@npm//@angular/core\"\n+        \"@npm//@angular/core\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"background\",\n     srcs = [\n         \"background.ts\"\n     ],\n     deps = [\"//projects/shell-chrome/src/app:ng-validate\"],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"backend\",\n     srcs = [\n         \"backend.ts\"\n@@ -142,23 +138,22 @@ ts_library(\n         \":same-page-message-bus\",\n         \"//projects/shell-chrome/src/app:chrome-window-extensions\",\n         \"//projects/ng-devtools-backend\",\n-        \"//projects/ng-devtools-backend/src/lib:highlighter\"\n+        \"//projects/ng-devtools-backend/src/lib:highlighter\",\n+        \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n-ts_library(\n+ts_project(\n     name = \"content-script\",\n     srcs = [\n         \"content-script.ts\"\n     ],\n     deps = [\n-        \"@npm//@types/chrome\",\n+        \"@npm//@types\",\n         \":chrome-message-bus\",\n         \":same-page-message-bus\",\n          \"//projects/protocol\",\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n \n rollup_bundle("
        },
        {
            "sha": "c3176ab65917e3fbf5420896815b5a316429f91b",
            "filename": "projects/shell-chrome/src/environments/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2Fenvironments%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/projects%2Fshell-chrome%2Fsrc%2Fenvironments%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fshell-chrome%2Fsrc%2Fenvironments%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,15 +1,15 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\", \"ts_config\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n \n-ts_library(\n+ts_project(\n     name = \"environment\",\n     srcs = [\n       \"environment.ts\",\n     ],\n     deps = [\n       \"//projects/ng-devtools\",\n+      \"@npm//@types\"\n     ],\n-    tsconfig = \"//projects/shell-chrome:tsconfig-app\",\n )\n\\ No newline at end of file"
        },
        {
            "sha": "35951c635760efbd82c0c7931697c32c43dcb383",
            "filename": "src/.bazelrc",
            "status": "removed",
            "additions": 0,
            "deletions": 92,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2F.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2F.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2F.bazelrc?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,92 +0,0 @@\n-# Common Bazel settings for JavaScript/NodeJS workspaces\n-# This rc file is automatically discovered when Bazel is run in this workspace,\n-# see https://docs.bazel.build/versions/master/guide.html#bazelrc\n-#\n-# The full list of Bazel options: https://docs.bazel.build/versions/master/command-line-reference.html\n-\n-# Cache action outputs on disk so they persist across output_base and bazel shutdown (eg. changing branches)\n-build --disk_cache=~/.cache/bazel-disk-cache\n-\n-# Bazel picks up host-OS-specific config lines from bazelrc files\n-build --enable_platform_specific_config\n-\n-# Bazel will create symlinks from the workspace directory to output artifacts.\n-# Build results will be placed in a directory called \"dist/bin\"\n-# Other directories will be created like \"dist/testlogs\"\n-# Be aware that this will still create a bazel-out symlink in\n-# your project directory, which you must exclude from version control and your\n-# editor's search path.\n-build --symlink_prefix=dist/\n-# To disable the symlinks altogether (including bazel-out) you can use\n-# build --symlink_prefix=/\n-# however this makes it harder to find outputs.\n-\n-# Specifies desired output mode for running tests.\n-# Valid values are\n-#   'summary' to output only test status summary\n-#   'errors' to also print test logs for failed tests\n-#   'all' to print logs for all tests\n-#   'streamed' to output logs for all tests in real time\n-#     (this will force tests to be executed locally one at a time regardless of --test_strategy value).\n-test --test_output=errors\n-\n-# Support for debugging NodeJS tests\n-# Add the Bazel option `--config=debug` to enable this\n-# --test_output=streamed\n-#     Stream stdout/stderr output from each test in real-time.\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_output for more details.\n-# --test_strategy=exclusive\n-#     Run one test at a time.\n-# --test_timeout=9999\n-#     Prevent long running tests from timing out\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_timeout for more details.\n-# --nocache_test_results\n-#     Always run tests\n-# --node_options=--inspect-brk\n-#     Pass the --inspect-brk option to all tests which enables the node inspector agent.\n-#     See https://nodejs.org/de/docs/guides/debugging-getting-started/#command-line-options for more details.\n-# --define=VERBOSE_LOGS=1\n-#     Rules will output verbose logs if the VERBOSE_LOGS environment variable is set. `VERBOSE_LOGS` will be passed to\n-#     `nodejs_binary` and `nodejs_test` via the default value of the `default_env_vars` attribute of those rules.\n-# --compilation_mode=dbg\n-#     Rules may change their build outputs if the compilation mode is set to dbg. For example,\n-#     mininfiers such as terser may make their output more human readable when this is set. Rules will pass `COMPILATION_MODE`\n-#     to `nodejs_binary` executables via the actions.run env attribute.\n-#     See https://docs.bazel.build/versions/master/user-manual.html#flag--compilation_mode for more details.\n-test:debug --test_output=streamed --test_strategy=exclusive --test_timeout=9999 --nocache_test_results --define=VERBOSE_LOGS=1\n-# Use bazel run with `--config=debug` to turn on the NodeJS inspector agent.\n-# The node process will break before user code starts and wait for the debugger to connect.\n-run:debug --define=VERBOSE_LOGS=1 -- --node_options=--inspect-brk\n-# The following option will change the build output of certain rules such as terser and may not be desirable in all cases\n-build:debug --compilation_mode=dbg\n-\n-# Turn off legacy external runfiles\n-# This prevents accidentally depending on this feature, which Bazel will remove.\n-build --nolegacy_external_runfiles\n-\n-# Turn on --incompatible_strict_action_env which was on by default\n-# in Bazel 0.21.0 but turned off again in 0.22.0. Follow\n-# https://github.com/bazelbuild/bazel/issues/7026 for more details.\n-# This flag is needed to so that the bazel cache is not invalidated\n-# when running bazel via `yarn bazel`.\n-# See https://github.com/angular/angular/issues/27514.\n-build --incompatible_strict_action_env\n-run --incompatible_strict_action_env\n-\n-# When running `bazel coverage` --instrument_test_targets needs to be set in order to \n-# collect coverage information from test targets\n-coverage --instrument_test_targets\n-\n-# Load any settings specific to the current user.\n-# .bazelrc.user should appear in .gitignore so that settings are not shared with team members\n-# This needs to be last statement in this\n-# config, as the user configuration should be able to overwrite flags from this file.\n-# See https://docs.bazel.build/versions/master/best-practices.html#bazelrc\n-# (Note that we use .bazelrc.user so the file appears next to .bazelrc in directory listing,\n-# rather than user.bazelrc as suggested in the Bazel docs)\n-try-import %workspace%/.bazelrc.user\n-\n-\n-# Use the Angular Ivy compiler\n-# See https://github.com/angular/angular/blob/master/docs/BAZEL.md#various-flags-used-for-tests\n-build --define=angular_ivy_enabled=True"
        },
        {
            "sha": "7e95610851bb4aa54845da646cbae1584188d2fe",
            "filename": "src/BUILD.bazel",
            "status": "modified",
            "additions": 43,
            "deletions": 116,
            "changes": 159,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,11 +1,10 @@\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"concatjs_devserver\")\n load(\"@npm//html-insert-assets:index.bzl\", \"html_insert_assets\")\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_library\", \"sass_binary\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n-load(\"@npm//@bazel/terser:index.bzl\", \"terser_minified\")\n-load(\"@build_bazel_rules_nodejs//internal/npm_install:npm_umd_bundle.bzl\", \"npm_umd_bundle\")\n+load(\"@npm//history-server:index.bzl\", \"history_server\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"pkg_web\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -35,13 +34,15 @@ html_insert_assets(\n         \"--roots=. $(RULEDIR)\",\n         \"--assets\",\n     ] + [\"$(execpath %s)\" % s for s in _ASSETS] + [\n-        # This file doesn't exist during the build, but will be served by concatjs_devserver\n-        \"./_/ts_scripts.js\",\n+        \"--scripts --module $(execpath :bundle-es2015)/index.dev.js\",\n     ],\n-    data = [\"//src:_index.html\"] + _ASSETS,\n+    data = [\n+        \"//src:_index.html\",\n+        \":bundle-es2015\",\n+    ] + _ASSETS,\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"demo\",\n     srcs = [\"main.ts\"],\n     deps = [\n@@ -54,113 +55,10 @@ ng_ts_library(\n         \"@npm//rxjs\",\n         \"@npm//@types\",\n     ],\n-    devmode_target = \"es2018\",\n     tsconfig = \"//:tsconfig.json\",\n-    module_name = \"demo\",\n )\n \n-ng_ts_library(\n-    name = \"demo-e2e\",\n-    srcs = [\"main.e2e.ts\"],\n-    deps = [\n-        \"//src/environments\",\n-        \"//src/app:app-e2e\",\n-        \"@npm//@angular/core\",\n-        \"@npm//@angular/common\",\n-        \"@npm//@angular/platform-browser-dynamic\",\n-        \"@npm//@angular/platform-browser\",\n-        \"@npm//rxjs\",\n-        \"@npm//@types\",\n-    ],\n-    tsconfig = \"//:tsconfig.json\",\n-    module_name = \"demo\",\n-)\n-\n-filegroup(\n-    name = \"rxjs_umd_modules\",\n-    srcs = [\n-        \":rxjs_shims.js\",\n-        \"@npm//:node_modules/rxjs/bundles/rxjs.umd.js\",\n-    ],\n-)\n-\n-filegroup(\n-    name = \"d3_umd_modules\",\n-    srcs = [\n-        \":d3_shims.js\",\n-        \":d3_umd\",\n-    ],\n-)\n-\n-filegroup(\n-    name = \"semver-dsl_umd_modules\",\n-    srcs = [\n-        \":semver_dsl_shims.js\",\n-        \":semver-dsl_umd\",\n-    ],\n-)\n-\n-npm_umd_bundle(\n-    name = \"d3_umd\",\n-    package_name = \"d3\",\n-    entry_point = \"@npm//:node_modules/d3/dist/d3.min.js\",\n-    package = \"@npm//d3\",\n-)\n-\n-npm_umd_bundle(\n-    name = \"semver-dsl_umd\",\n-    package_name = \"semver-dsl\",\n-    entry_point = \"@npm//:node_modules/semver-dsl/index.js\",\n-    package = \"@npm//semver-dsl\",\n-)\n-\n-concatjs_devserver(\n-    name = \"devserver\",\n-    entry_module = \"demo/main\",\n-    scripts = [\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-        \":rxjs_umd_modules\",\n-        \":d3_umd_modules\",\n-        \":semver-dsl_umd_modules\"\n-    ],\n-    static_files = _ASSETS + [\n-        \"//src:demo\",\n-        \":inject_scripts_for_dev\",\n-        \"//projects/ng-devtools/src/lib/images\",\n-        \"//projects/shell-chrome/src/assets\"\n-    ],\n-    additional_root_paths = [\n-        \"projects/ng-devtools/src/lib\",\n-        \"projects/shell-chrome/src\"\n-    ],\n-    deps = [\"//src:demo\"],\n-    port = 4200\n-)\n-\n-concatjs_devserver(\n-    name = \"devserver-e2e\",\n-    entry_module = \"demo/main.e2e\",\n-    scripts = [\n-        \"@npm//:node_modules/tslib/tslib.js\",\n-        \":rxjs_umd_modules\",\n-        \":d3_umd_modules\",\n-        \":semver-dsl_umd_modules\"\n-    ],\n-    static_files = _ASSETS + [\n-        \"//src:demo-e2e\",\n-        \":inject_scripts_for_dev\",\n-        \"//projects/ng-devtools/src/lib/images\",\n-        \"//projects/shell-chrome/src/assets\"\n-    ],\n-    additional_root_paths = [\n-        \"projects/ng-devtools/src/lib\",\n-        \"projects/shell-chrome/src\"\n-    ],\n-    deps = [\"//src:demo-e2e\"],\n-    port = 4200\n-)\n-\n-ts_library(\n+ng_ts_project(\n     name = \"demo-application-environment\",\n     srcs = [\"demo-application-environment.ts\"],\n     deps = [\n@@ -169,7 +67,7 @@ ts_library(\n     ],\n )\n \n-ts_library(\n+ng_ts_project(\n     name = \"demo-application-operations\",\n     srcs = [\"demo-application-operations.ts\"],\n     deps = [\n@@ -178,19 +76,48 @@ ts_library(\n     ],\n )\n \n-ts_library(\n+ng_ts_project(\n     name = \"iframe-message-bus\",\n     srcs = [\"iframe-message-bus.ts\"],\n     deps = [\n         '//projects/protocol'\n     ]\n )\n \n-ts_library(\n+ng_ts_project(\n     name = \"zone-unaware-iframe-message-bus\",\n     srcs = [\"zone-unaware-iframe-message-bus.ts\"],\n     deps = [\n         \":iframe-message-bus\",\n         \"//projects/protocol\"\n     ]\n )\n+\n+rollup_bundle(\n+    name = \"bundle-es2015\",\n+    config_file = \"rollup.config.js\",\n+    entry_points = {\n+        \":main.ts\": \"index.dev\",\n+    },\n+    output_dir = True,\n+    deps = [\n+        \":demo\",\n+        \"@npm//@rollup/plugin-commonjs\",\n+        \"@npm//@rollup/plugin-node-resolve\",\n+    ],\n+    format = 'esm'\n+)\n+\n+pkg_web(\n+    name = \"devapp\",\n+    srcs = _ASSETS + [\n+        \":bundle-es2015\",\n+        \":inject_scripts_for_dev\",\n+    ],\n+)\n+\n+history_server(\n+    name = \"devserver\",\n+    data = [\":devapp\"],\n+    templated_args = [\"-a $$(rlocation $(rootpath :devapp))\", \"--port 4200\"],\n+)\n\\ No newline at end of file"
        },
        {
            "sha": "75694408024207823fe56c581f0f997e80c0cbf9",
            "filename": "src/_index.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2F_index.html",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2F_index.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2F_index.html?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -8,7 +8,7 @@\n     <link rel=\"icon\" type=\"image/x-icon\" href=\"assets/icon16.png\" />\n     <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\" />\n \n-    <script src=\"https://unpkg.com/@webcomponents/webcomponentsjs@2.0.3/custom-elements-es5-adapter.js\"></script>\n+    <!-- <script src=\"https://unpkg.com/@webcomponents/webcomponentsjs@2.0.3/custom-elements-es5-adapter.js\"></script> -->\n   </head>\n   <body>\n     <div>"
        },
        {
            "sha": "312b7ced0035cceba0909cfa04a46272d55abce1",
            "filename": "src/app/BUILD.bazel",
            "status": "modified",
            "additions": 24,
            "deletions": 25,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,6 +1,5 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -9,7 +8,7 @@ sass_binary(\n     src = \"app.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"app\",\n     srcs = [\n         \"app.component.ts\",\n@@ -32,25 +31,25 @@ ng_ts_library(\n     tsconfig = \"//:tsconfig.json\",\n )\n \n-ng_ts_library(\n-    name = \"app-e2e\",\n-    srcs = [\n-        \"app.component.ts\",\n-        \"app.e2e.module.ts\",\n-    ],\n-    angular_assets = [\n-        \"app.component.html\",\n-        \":app-component-styles\"\n-    ],\n-    deps = [\n-        \"//src/app/devtools-app\",\n-        \"//src/app/demo-app\",\n-        \"//src:demo-application-operations\",\n-        \"//src:demo-application-environment\",\n-        \"//projects/ng-devtools\",\n-        \"@npm//@angular/core\",\n-        \"@npm//@angular/router\",\n-        \"@npm//@angular/platform-browser\",\n-    ],\n-    tsconfig = \"//:tsconfig.json\",\n-)\n+# ng_ts_project(\n+#     name = \"app-e2e\",\n+#     srcs = [\n+#         \"app.component.ts\",\n+#         \"app.e2e.module.ts\",\n+#     ],\n+#     angular_assets = [\n+#         \"app.component.html\",\n+#         \":app-component-styles\"\n+#     ],\n+#     deps = [\n+#         \"//src/app/devtools-app\",\n+#         \"//src/app/demo-app\",\n+#         \"//src:demo-application-operations\",\n+#         \"//src:demo-application-environment\",\n+#         \"//projects/ng-devtools\",\n+#         \"@npm//@angular/core\",\n+#         \"@npm//@angular/router\",\n+#         \"@npm//@angular/platform-browser\",\n+#     ],\n+#     tsconfig = \"//:tsconfig.json\",\n+# )"
        },
        {
            "sha": "91b0a8c7dc462bff8546145ec2101001d455c440",
            "filename": "src/app/app.module.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fapp.module.ts",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fapp.module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fapp.module.ts?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -6,6 +6,7 @@ import { DemoApplicationOperations } from '../demo-application-operations';\n import { ApplicationEnvironment, ApplicationOperations } from 'ng-devtools';\n import { DemoApplicationEnvironment } from '../demo-application-environment';\n import { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n+\n @NgModule({\n   declarations: [AppComponent],\n   imports: ["
        },
        {
            "sha": "da109f47cc5a17be18b33beb015ae519b217942b",
            "filename": "src/app/demo-app/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdemo-app%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\", \"sass_binary\", \"sass_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -27,7 +27,7 @@ multi_sass_binary(\n     ],\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"demo-app\",\n     srcs = [\n         \"demo-app.component.ts\","
        },
        {
            "sha": "182b1e8a83b4a56734de0eebd74be82cfb97dfb8",
            "filename": "src/app/demo-app/todo/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdemo-app%2Ftodo%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"app-todo.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"todo\",\n     srcs = [\n         \"app-todo.component.ts\","
        },
        {
            "sha": "b533c0e5595ce784c80dcfb962f0400d41b3c2eb",
            "filename": "src/app/demo-app/todo/about/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2Fabout%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2Fabout%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdemo-app%2Ftodo%2Fabout%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"about\",\n     srcs = [\n         \"about.component.ts\","
        },
        {
            "sha": "9d393dc0bf49ee01c6acf10dc98e5bc6af062437",
            "filename": "src/app/demo-app/todo/home/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2Fhome%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdemo-app%2Ftodo%2Fhome%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdemo-app%2Ftodo%2Fhome%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"multi_sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -8,7 +8,7 @@ multi_sass_binary(\n     srcs = [\"todo.component.scss\"],\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"home\",\n     srcs = [\n         \"home.module.ts\","
        },
        {
            "sha": "30a222429483f3e77e8814ce6de6bdac1df5e728",
            "filename": "src/app/devtools-app/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdevtools-app%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fapp%2Fdevtools-app%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdevtools-app%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,4 +1,4 @@\n-load(\"//tools:angular_ts_library.bzl\", \"ng_ts_library\")\n+load(\"//tools:angular_ts_project.bzl\", \"ng_ts_project\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -8,7 +8,7 @@ sass_binary(\n     src = \"devtools-app.component.scss\",\n )\n \n-ng_ts_library(\n+ng_ts_project(\n     name = \"devtools-app\",\n     srcs = [\n         \"devtools-app.component.ts\","
        },
        {
            "sha": "f299ad0b36639b9c3a25bfff93e6e5be25f06542",
            "filename": "src/d3_shims.js",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Fd3_shims.js",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Fd3_shims.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fd3_shims.js?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,17 +0,0 @@\n-// d3\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('d3/dist/d3.js', ['exports', 'd3'], factory);\n-  }\n-})(function (exports, d3) {\n-  'use strict';\n-\n-  Object.keys(d3).forEach(function (key) {\n-    exports[key] = d3[key];\n-  });\n-\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});"
        },
        {
            "sha": "8ac3124d381b4b81e4ea8a4b37fe9ab1f3080c39",
            "filename": "src/environments/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fenvironments%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/src%2Fenvironments%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fenvironments%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,8 +1,8 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+load(\"//tools:typescript.bzl\", \"ts_project\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-ts_library(\n+ts_project(\n     name = \"environments\",\n     srcs = [\n         \"environment.ts\",\n@@ -11,7 +11,6 @@ ts_library(\n     ],\n     deps = [\n         \"@npm//@angular/platform-browser\",\n-        \"//projects/ng-devtools\"\n     ],\n     tsconfig = \"//:tsconfig.json\",\n )"
        },
        {
            "sha": "37af4d578c647d311246cf3f9d7468667a4e7c09",
            "filename": "src/rxjs_shims.js",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Frxjs_shims.js",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Frxjs_shims.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Frxjs_shims.js?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,44 +0,0 @@\n-/**\n- * @license\n- * Copyright Google Inc. All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * @fileoverview these provide named UMD modules so that we can bundle\n- * the application along with rxjs using the concatjs bundler.\n- */\n-\n-// rxjs/operators\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('rxjs/operators', ['exports', 'rxjs'], factory);\n-  }\n-})(function (exports, rxjs) {\n-  'use strict';\n-  Object.keys(rxjs.operators).forEach(function (key) {\n-    exports[key] = rxjs.operators[key];\n-  });\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});\n-\n-// rxjs/testing\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('rxjs/testing', ['exports', 'rxjs'], factory);\n-  }\n-})(function (exports, rxjs) {\n-  'use strict';\n-  Object.keys(rxjs.testing).forEach(function (key) {\n-    exports[key] = rxjs.testing[key];\n-  });\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});"
        },
        {
            "sha": "cb40e308ca0e87a2d4efcf7da1f8f80ea3eca728",
            "filename": "src/semver_dsl_shims.js",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Fsemver_dsl_shims.js",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/src%2Fsemver_dsl_shims.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fsemver_dsl_shims.js?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,17 +0,0 @@\n-// semver-dsl\n-(function (factory) {\n-  if (typeof module === 'object' && typeof module.exports === 'object') {\n-    var v = factory(require, exports);\n-    if (v !== undefined) module.exports = v;\n-  } else if (typeof define === 'function' && define.amd) {\n-    define('semver-dsl/index.js', ['exports', 'semver-dsl'], factory);\n-  }\n-})(function (exports, semverDsl) {\n-  'use strict';\n-\n-  Object.keys(semverDsl).forEach(function (key) {\n-    exports[key] = semverDsl[key];\n-  });\n-\n-  Object.defineProperty(exports, '__esModule', { value: true });\n-});"
        },
        {
            "sha": "8ca5b2aba8b1fdaa6d754ddc3ffd83442a0c590a",
            "filename": "tools/BUILD.bazel",
            "status": "modified",
            "additions": 29,
            "deletions": 15,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,17 +1,31 @@\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n+load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n \n-# Custom ts_library compiler that runs tsc_wrapped with angular/compiler-cli statically linked\n-# This can be used with worker mode because we don't need the linker at runtime to make\n-# the angular plugin loadable\n-# Just a clone of @npm//@bazel/typescript/bin:tsc_wrapped with added deps\n-nodejs_binary(\n-    name = \"tsc_wrapped_with_angular\",\n-    data = [\n-        \"@npm//@angular/compiler-cli\",\n-        \"@npm//@bazel/typescript\",\n-    ],\n-    entry_point = \"@npm//:node_modules/@bazel/typescript/internal/tsc_wrapped/tsc_wrapped.js\",\n-    # TODO: turn on --worker_sandboxing and remove this flag to see failure to load the plugin\n-    templated_args = [\"--bazel_patch_module_resolver\"],\n-    visibility = [\"//:__subpackages__\"],\n+exports_files([\n+    \"karma.conf.js\",\n+])\n+\n+\n+# Dupe from angular/components\n+#\n+# todo(aleksanderbodurri): Remove this when when spec-bundling bazel logic is moved to\n+# dev-infra repo\n+\n+config_setting(\n+    name = \"partial_compilation_enabled\",\n+    flag_values = {\n+        \"@npm//@angular/bazel/src:partial_compilation\": \"True\",\n+    },\n+)\n+\n+bool_flag(\n+    name = \"force_partial_jit_compilation\",\n+    build_setting_default = False,\n+)\n+\n+config_setting(\n+    name = \"force_partial_jit_compilation_enabled\",\n+    flag_values = {\n+        \"@npm//@angular/bazel/src:partial_compilation\": \"True\",\n+        \":force_partial_jit_compilation\": \"True\",\n+    },\n )"
        },
        {
            "sha": "911c0599a176e713b999b4ad76c4cdee41ef5609",
            "filename": "tools/angular/BUILD.bazel",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,24 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"//tools/esbuild:index.bzl\", \"esbuild_config\")\n+load(\":index.bzl\", \"create_angular_bundle_targets\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+js_library(\n+    name = \"create_linker_esbuild_plugin\",\n+    srcs = [\"create_linker_esbuild_plugin.mjs\"],\n+    deps = [\n+        \"@npm//@angular/compiler-cli\",\n+        \"@npm//@babel/core\",\n+    ],\n+)\n+\n+esbuild_config(\n+    name = \"esbuild_config\",\n+    config_file = \"esbuild.config.mjs\",\n+    deps = [\n+        \":create_linker_esbuild_plugin\",\n+    ],\n+)\n+\n+create_angular_bundle_targets()"
        },
        {
            "sha": "6b0a315d90f288cf311963cf35f8834b84c706e1",
            "filename": "tools/angular/create_linker_esbuild_plugin.mjs",
            "status": "added",
            "additions": 85,
            "deletions": 0,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,85 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import fs from 'fs';\n+\n+/** Naively checks whether this node path resolves to an Angular declare invocation. */\n+function isNgDeclareCallExpression(nodePath) {\n+  if (!nodePath.node.name.startsWith('ngDeclare')) {\n+    return false;\n+  }\n+\n+  // Expect the `ngDeclare` identifier to be used as part of a property access that\n+  // is invoked within a call expression. e.g. `i0.ngDeclare<>`.\n+  return (\n+    nodePath.parentPath?.type === 'MemberExpression' &&\n+    nodePath.parentPath.parentPath?.type === 'CallExpression'\n+  );\n+}\n+\n+/** Asserts that the given AST does not contain any Angular partial declaration. */\n+async function assertNoPartialDeclaration(filePath, ast, traverseFn) {\n+  // Naively check if there are any Angular declarations left that haven't been linked.\n+  traverseFn(ast, {\n+    Identifier: astPath => {\n+      if (isNgDeclareCallExpression(astPath)) {\n+        throw astPath.buildCodeFrameError(\n+          `Found Angular declaration that has not been linked. ${filePath}`,\n+          Error,\n+        );\n+      }\n+    },\n+  });\n+}\n+\n+/**\n+ * Creates an ESBuild plugin for running the Angular linker resolved sources.\n+ *\n+ * @param filter Mandatory file path filter for the ESBuild plugin to apply to. Read\n+ *   more here: https://esbuild.github.io/plugins/#filters.\n+ * @param ensureNoPartialDeclaration Whether an additional check ensuring there are\n+ *   no partial declarations should run.\n+ */\n+export async function createLinkerEsbuildPlugin(filter, ensureNoPartialDeclaration) {\n+  // Note: We load all dependencies asynchronously so that these large dependencies\n+  // do not slow-down bundling when the linker plugin is not actually created.\n+  const {NodeJSFileSystem, ConsoleLogger, LogLevel} = await import('@angular/compiler-cli');\n+  const {createEs2015LinkerPlugin} = await import('@angular/compiler-cli/linker/babel');\n+  const {default: babel} = await import('@babel/core');\n+\n+  const linkerBabelPlugin = createEs2015LinkerPlugin({\n+    fileSystem: new NodeJSFileSystem(),\n+    logger: new ConsoleLogger(LogLevel.warn),\n+    // We enable JIT mode as unit tests also will rely on the linked ESM files.\n+    linkerJitMode: true,\n+  });\n+\n+  return {\n+    name: 'ng-linker-esbuild',\n+    setup: build => {\n+      build.onLoad({filter}, async args => {\n+        const filePath = args.path;\n+        const content = await fs.promises.readFile(filePath, 'utf8');\n+        const {ast, code} = await babel.transformAsync(content, {\n+          filename: filePath,\n+          filenameRelative: filePath,\n+          plugins: [linkerBabelPlugin],\n+          sourceMaps: 'inline',\n+          ast: true,\n+          compact: false,\n+        });\n+\n+        if (ensureNoPartialDeclaration) {\n+          await assertNoPartialDeclaration(filePath, ast, babel.traverse);\n+        }\n+\n+        return {contents: code};\n+      });\n+    },\n+  };\n+}"
        },
        {
            "sha": "d61e8deb4c35efb14017c3c398953f568b628495",
            "filename": "tools/angular/esbuild.config.mjs",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Fesbuild.config.mjs",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Fesbuild.config.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular%2Fesbuild.config.mjs?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,20 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {createLinkerEsbuildPlugin} from './create_linker_esbuild_plugin.mjs';\n+\n+export default {\n+  // Note: We support `.mjs` here as this is the extension used by Angular APF packages.\n+  resolveExtensions: ['.mjs', '.js'],\n+  format: 'esm',\n+  plugins: [\n+    // Only run the linker on `fesm2020/` bundles. This should not have an effect on\n+    // the bundle output, but helps speeding up ESBuild when it visits other modules.\n+    await createLinkerEsbuildPlugin(/fesm2020/),\n+  ],\n+};"
        },
        {
            "sha": "edf0fd66fda7bd399e12bb0948d52e7512fd7d1e",
            "filename": "tools/angular/index.bzl",
            "status": "added",
            "additions": 78,
            "deletions": 0,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular%2Findex.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,78 @@\n+load(\"//:packages.bzl\", \"ANGULAR_PACKAGES\")\n+load(\"//tools/esbuild:index.bzl\", \"esbuild\")\n+load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\")\n+load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSModuleInfo\")\n+\n+\"\"\"\n+  Starlark file exposing a definition for generating Angular linker-processed ESM bundles\n+  for all entry-points the Angular framework packages expose.\n+\n+  These linker-processed ESM bundles are useful as they can be integrated into the\n+  spec bundling, or dev-app to avoid unnecessary re-linking of framework entry-points\n+  every time the bundler executes. This helps with the overall development turnaround and\n+  is more idiomatic as it allows caching of the Angular framework packages.\n+\"\"\"\n+\n+def _linker_mapping_impl(ctx):\n+    return [\n+        # Pass through the `ExternalNpmPackageInfo` which is needed for the linker\n+        # resolving dependencies which might be external. e.g. `rxjs` for `@angular/core`.\n+        ctx.attr.package[ExternalNpmPackageInfo],\n+        JSModuleInfo(\n+            direct_sources = depset(ctx.files.srcs),\n+            sources = depset(ctx.files.srcs),\n+        ),\n+        LinkerPackageMappingInfo(\n+            mappings = {\n+                ctx.attr.module_name: \"%s/%s\" % (ctx.label.package, ctx.attr.subpath),\n+            },\n+        ),\n+    ]\n+\n+_linker_mapping = rule(\n+    implementation = _linker_mapping_impl,\n+    attrs = {\n+        \"package\": attr.label(),\n+        \"srcs\": attr.label_list(allow_files = False),\n+        \"subpath\": attr.string(),\n+        \"module_name\": attr.string(),\n+    },\n+)\n+\n+def _get_target_name_base(pkg, entry_point):\n+    return \"%s%s\" % (pkg.name, \"_%s\" % entry_point if entry_point else \"\")\n+\n+def _create_bundle_targets(pkg, entry_point, module_name):\n+    target_name_base = _get_target_name_base(pkg, entry_point)\n+    fesm_bundle_path = \"fesm2020/%s.mjs\" % (entry_point if entry_point else pkg.name)\n+\n+    esbuild(\n+        name = \"%s_linked_bundle\" % target_name_base,\n+        output = \"%s/index.mjs\" % target_name_base,\n+        platform = pkg.platform,\n+        entry_point = \"@npm//:node_modules/@angular/%s/%s\" % (pkg.name, fesm_bundle_path),\n+        config = \"//tools/angular:esbuild_config\",\n+        # List of dependencies which should never be bundled into these linker-processed bundles.\n+        external = [\"rxjs\", \"@angular\", \"domino\", \"xhr2\"],\n+    )\n+\n+    _linker_mapping(\n+        name = \"%s_linked\" % target_name_base,\n+        srcs = [\":%s_linked_bundle\" % target_name_base],\n+        package = \"@npm//@angular/%s\" % pkg.name,\n+        module_name = module_name,\n+        subpath = target_name_base,\n+    )\n+\n+def create_angular_bundle_targets():\n+    for pkg in ANGULAR_PACKAGES:\n+        _create_bundle_targets(pkg, None, pkg.module_name)\n+\n+        for entry_point in pkg.entry_points:\n+            _create_bundle_targets(pkg, entry_point, \"%s/%s\" % (pkg.module_name, entry_point))\n+\n+LINKER_PROCESSED_FW_PACKAGES = [\n+    \"//tools/angular:%s_linked\" % _get_target_name_base(pkg, entry_point)\n+    for pkg in ANGULAR_PACKAGES\n+    for entry_point in [None] + pkg.entry_points\n+]"
        },
        {
            "sha": "080758fc951bc45363271ff8bf976f0ab0d7b53f",
            "filename": "tools/angular_prerender.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 117,
            "changes": 117,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fangular_prerender.bzl",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fangular_prerender.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular_prerender.bzl?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,117 +0,0 @@\n-\"\"\"Helper macros for rendering parts of an Angular application at build time\"\"\"\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", _nodejs_binary = \"nodejs_binary\", _nodejs_test = \"nodejs_test\")\n-load(\"@npm//@bazel/typescript:index.bzl\", _ts_library = \"ts_library\")\n-\n-def _get_output_path(route, root_at):\n-    return root_at + \"/\" + route + \"/index.html\"\n-\n-def ng_prerender(name, index, prerender_roots = [], **kwargs):\n-    \"\"\"\n-    Helper macro for prerendering Angular routes to index files as part of the build\n-\n-    The outputs of this macro are:\n-        %name% - all the rendered roots, plus the root route /\n-        %name%.root - an alias referencing just the root index file\n-        %name%.%route% - an alias referencing each rendered route, with / replaced by underscores\n-\n-    Args:\n-        name: Rule name for the main output genrule\n-        index: Label for the production index.html file with which to render into\n-        prerender_roots: A list of roots that will be prerendered as part of this macro, the root route / is always rendered\n-    \"\"\"\n-\n-    renderer_lib = \"%s_renderer_lib\" % name\n-    _ts_library(\n-        name = renderer_lib,\n-        srcs = [\"//src:prerender.ts\"],\n-        deps = [\n-            \"//src/app:app_server\",\n-            \"@npm//@angular/platform-server\",\n-            \"@npm//zone.js\",\n-            \"@npm//domino\",\n-            \"@npm//reflect-metadata\",\n-            \"@npm//@types/node\",\n-        ],\n-    )\n-\n-    bin = \"%s_bin\" % renderer_lib\n-    _nodejs_binary(\n-        name = bin,\n-        data = [\n-            \":%s\" % renderer_lib,\n-            \"@npm//@angular/platform-server\",\n-            \"@npm//zone.js\",\n-            \"@npm//domino\",\n-            \"@npm//reflect-metadata\",\n-        ],\n-        entry_point = \"//src:prerender.ts\",\n-        templated_args = [\"--nobazel_run_linker\"],\n-    )\n-\n-    root_at = \"_prerender/\" + native.package_name()\n-\n-    # we can't output \"foo/index.html\" since that collides with source files and will likely cross a package boundary\n-    # so we output \"_prerender/pkg_name/route/index.html\"\n-    prerender_root_outs = [_get_output_path(route, root_at) for route in prerender_roots]\n-    root_index = \"%s/index.html\" % root_at\n-\n-    visibility = kwargs.pop(\"visibility\", [])\n-\n-    native.genrule(\n-        name = name,\n-        srcs = [index],\n-        outs = [root_index] + prerender_root_outs,\n-        cmd = \"$(location :%s) --index $(location %s) --outs $(OUTS) --routes / %s\" % (bin, index, \" \".join(prerender_roots)),\n-        tools = [\":%s\" % bin],\n-        message = \"Prerendering Angular\",\n-        visibility = visibility,\n-        tags = kwargs.pop(\"tags\", []),\n-    )\n-\n-    # convenience \"output groups\" from macro\n-    native.alias(\n-        name = \"%s.root\" % name,\n-        actual = root_index,\n-        visibility = visibility,\n-    )\n-\n-    [\n-        native.alias(\n-            name = \"%s.%s\" % (name, route.replace(\"/\", \"_\")),\n-            actual = _get_output_path(route, root_at),\n-            visibility = visibility,\n-        )\n-        for route in prerender_roots\n-    ]\n-\n-def ng_prerender_test(name, index, route, expected_elements = [], **kwargs):\n-    \"\"\"\n-    Simple smoke test for a prerendered index file, as generated by ng_prerender\n-\n-    Args:\n-        name: Rule name for the test\n-        index: Label of the index file under test\n-        route: The route that this index file belongs to\n-        expected_elements: An optional array of expected elements that should appear in the index file\n-    \"\"\"\n-\n-    _ts_library(\n-        name = \"%s_render_spec\" % name,\n-        srcs = [\"//src:prerender-spec.ts\"],\n-        deps = [\n-            \"@npm//@types/node\",\n-        ],\n-        testonly = 1,\n-    )\n-\n-    _nodejs_test(\n-        name = name,\n-        data = [\n-            \":%s_render_spec\" % name,\n-            index,\n-        ],\n-        templated_args = [\"--index $(location %s)\" % index, \"--route %s\" % route, \"--expected %s\" % (\" \".join(expected_elements))],\n-        entry_point = \"//src:prerender-spec.ts\",\n-        tags = kwargs.pop(\"tags\", []),\n-    )"
        },
        {
            "sha": "c17dc40c0d50ed5f695d4309abecbb1e6662b4e4",
            "filename": "tools/angular_ts_library.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fangular_ts_library.bzl",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fangular_ts_library.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular_ts_library.bzl?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,11 +0,0 @@\n-\"Shows how to enable both worker mode and use_angular_plugin to make a drop-in replacement for ng_module\"\n-\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-\n-def ng_ts_library(**kwargs):\n-    ts_library(\n-        compiler = \"//tools:tsc_wrapped_with_angular\",\n-        supports_workers = True,\n-        use_angular_plugin = True,\n-        **kwargs\n-    )"
        },
        {
            "sha": "bf0312d4c6028b529e7bcc6154ddad888499fcbb",
            "filename": "tools/angular_ts_project.bzl",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular_ts_project.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fangular_ts_project.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular_ts_project.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,10 @@\n+load(\"//tools:typescript.bzl\", _ts_project = \"ts_project\", _ts_test_project = \"ts_test_project\")\n+\n+def ng_ts_project(name, tsconfig = \"//:tsconfig.json\", srcs = [], angular_assets = [], **kwargs):\n+    _ts_project(\n+        name = name,\n+        tsconfig = tsconfig,\n+        tsc = \"@npm//@angular/compiler-cli/bin:ngc\",\n+        srcs = srcs + angular_assets,\n+        **kwargs\n+    )"
        },
        {
            "sha": "0244913c7a0d87eef02f1fa6a484ec5d0bad6b34",
            "filename": "tools/defaults.bzl",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fdefaults.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fdefaults.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fdefaults.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,56 @@\n+# Re-export of Bazel rules with repository-wide defaults\n+\n+load(\"@npm//@bazel/concatjs:index.bzl\", _karma_web_test = \"karma_web_test\", _karma_web_test_suite = \"karma_web_test_suite\")\n+load(\"//tools/spec-bundling:index.bzl\", \"spec_bundle\")\n+\n+def karma_web_test_suite(name, **kwargs):\n+    web_test_args = {}\n+    test_deps = kwargs.get(\"deps\", [])\n+\n+    kwargs[\"tags\"] = [\"partial-compilation-integration\"] + kwargs.get(\"tags\", [])\n+    kwargs[\"deps\"] = [\"%s_bundle\" % name]\n+\n+    spec_bundle(\n+        name = \"%s_bundle\" % name,\n+        deps = test_deps,\n+        platform = \"browser\",\n+    )\n+\n+    # Set up default browsers if no explicit `browsers` have been specified.\n+    if not hasattr(kwargs, \"browsers\"):\n+        kwargs[\"tags\"] = [\"native\"] + kwargs.get(\"tags\", [])\n+        kwargs[\"browsers\"] = [\n+            # Note: when changing the browser names here, also update the \"yarn test\"\n+            # script to reflect the new browser names.\n+            \"@npm//@angular/dev-infra-private/bazel/browsers/chromium:chromium\",\n+            # \"@npm//@angular/dev-infra-private/bazel/browsers/firefox:firefox\",\n+        ]\n+\n+    for opt_name in kwargs.keys():\n+        # Filter out options which are specific to \"karma_web_test\" targets. We cannot\n+        # pass options like \"browsers\" to the local web test target.\n+        if not opt_name in [\"wrapped_test_tags\", \"browsers\", \"wrapped_test_tags\", \"tags\"]:\n+            web_test_args[opt_name] = kwargs[opt_name]\n+\n+    # Custom standalone web test that can be run to test against any browser\n+    # that is manually connected to.\n+    _karma_web_test(\n+        name = \"%s_local_bin\" % name,\n+        config_file = \"//test:bazel-karma-local-config.js\",\n+        tags = [\"manual\"],\n+        **web_test_args\n+    )\n+\n+    # Workaround for: https://github.com/bazelbuild/rules_nodejs/issues/1429\n+    native.sh_test(\n+        name = \"%s_local\" % name,\n+        srcs = [\"%s_local_bin\" % name],\n+        tags = [\"manual\", \"local\", \"ibazel_notify_changes\"],\n+        testonly = True,\n+    )\n+\n+    # Default test suite with all configured browsers.\n+    _karma_web_test_suite(\n+        name = name,\n+        **kwargs\n+    )"
        },
        {
            "sha": "7fcefca5ef55a0b5b2bc74221cc9f68890c5273c",
            "filename": "tools/esbuild/BUILD.bazel",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fesbuild%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1 @@\n+exports_files([\"esbuild-amd-config.mjs\"])"
        },
        {
            "sha": "17b5deaf51cc7aee8e2591fd825d8c934e21954a",
            "filename": "tools/esbuild/devmode-output.bzl",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Fdevmode-output.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Fdevmode-output.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fesbuild%2Fdevmode-output.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,43 @@\n+load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\", \"module_mappings_aspect\")\n+load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSModuleInfo\", \"node_modules_aspect\")\n+\n+def _extract_devmode_sources_impl(ctx):\n+    \"\"\"Private rule that extracts devmode sources for all direct dependencies and re-exposes\n+      them as part of a single target. External node modules are passed-through as well.\"\"\"\n+\n+    mappings = {}\n+    js_sources = []\n+\n+    for dep in ctx.attr.deps:\n+        if JSModuleInfo in dep:\n+            js_sources.append(dep[JSModuleInfo].sources)\n+        if ExternalNpmPackageInfo in dep:\n+            js_sources.append(dep[ExternalNpmPackageInfo].sources)\n+        if LinkerPackageMappingInfo in dep:\n+            mappings.update(dep[LinkerPackageMappingInfo].mappings)\n+\n+    return [\n+        LinkerPackageMappingInfo(mappings = mappings),\n+        JSModuleInfo(\n+            direct_sources = depset(transitive = js_sources),\n+            sources = depset(transitive = js_sources),\n+        ),\n+    ]\n+\n+extract_devmode_sources = rule(\n+    implementation = _extract_devmode_sources_impl,\n+    attrs = {\n+        \"deps\": attr.label_list(mandatory = True, aspects = [module_mappings_aspect, node_modules_aspect]),\n+    },\n+)\n+\n+def extract_devmode_output_with_mappings(name, deps, testonly):\n+    \"\"\"Macro that extracts devmode ESM2020 sources from the given dependencies.\"\"\"\n+\n+    extract_devmode_sources(\n+        name = \"%s_sources\" % name,\n+        testonly = testonly,\n+        deps = deps,\n+    )\n+\n+    return [\"%s_sources\" % name]"
        },
        {
            "sha": "2650b211e33835a938ebbe5e3b818a2be4afce62",
            "filename": "tools/esbuild/esbuild-amd-config.mjs",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Fesbuild-amd-config.mjs",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Fesbuild-amd-config.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fesbuild%2Fesbuild-amd-config.mjs?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,24 @@\n+import url from 'url';\n+import path from 'path';\n+\n+/** Path to the ESBuild configuration maintained by the user. */\n+const userConfigExecPath = 'TMPL_CONFIG_PATH';\n+\n+/** User ESBuild config. Empty if none is loaded. */\n+let userConfig = {};\n+\n+if (userConfigExecPath !== '') {\n+  const userConfigPath = path.join(process.cwd(), userConfigExecPath);\n+  const userConfigUrl = url.pathToFileURL(userConfigPath);\n+\n+  // Load the user config, assuming it is set as `default` export.\n+  userConfig = (await import(userConfigUrl)).default;\n+}\n+\n+export default {\n+  ...userConfig,\n+  globalName: '__exports',\n+  format: 'iife',\n+  banner: {js: 'define(\"TMPL_MODULE_NAME\", [], function() {'},\n+  footer: {js: 'return __exports;})'},\n+};"
        },
        {
            "sha": "2f96bd02cbb08072359a49e82d9e629633989811",
            "filename": "tools/esbuild/index.bzl",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fesbuild%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fesbuild%2Findex.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,52 @@\n+load(\"@npm//@bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n+load(\"@npm//@angular/dev-infra-private/bazel:expand_template.bzl\", \"expand_template\")\n+load(\"//tools/esbuild:devmode-output.bzl\", \"extract_devmode_output_with_mappings\")\n+\n+# Re-export of the actual esbuild definitions.\n+esbuild_config = _esbuild_config\n+\n+def esbuild(name, deps = [], mapping_targets = [], testonly = False, **kwargs):\n+    # Extract all JS module sources before passing to ESBuild. The ESBuild rule requests\n+    # both the devmode and prodmode unfortunately and this would slow-down the development\n+    # turnaround significantly. We only request the devmode sources which are ESM as well.\n+    devmode_targets = extract_devmode_output_with_mappings(name, deps, testonly)\n+\n+    _esbuild(\n+        name = name,\n+        deps = devmode_targets,\n+        testonly = testonly,\n+        **kwargs\n+    )\n+\n+\"\"\"Generates an AMD bundle for the specified entry-point with the given AMD module name.\"\"\"\n+\n+def esbuild_amd(name, entry_point, module_name, testonly = False, config = None, deps = [], **kwargs):\n+    expand_template(\n+        name = \"%s_config\" % name,\n+        testonly = testonly,\n+        template = \"//tools/esbuild:esbuild-amd-config.mjs\",\n+        output_name = \"%s_config.mjs\" % name,\n+        substitutions = {\n+            \"TMPL_MODULE_NAME\": module_name,\n+            \"TMPL_CONFIG_PATH\": \"$(execpath %s)\" % config if config else \"\",\n+        },\n+        data = [config] if config else None,\n+    )\n+\n+    _esbuild_config(\n+        name = \"%s_config_lib\" % name,\n+        testonly = testonly,\n+        config_file = \"%s_config\" % name,\n+        # Adds the user configuration and its deps as dependency of the AMD ESBuild config.\n+        # https://github.com/bazelbuild/rules_nodejs/blob/a892caf5a040bae5eeec174a3cf6250f02caf364/packages/esbuild/esbuild_config.bzl#L23.\n+        deps = [config, \"%s_deps\" % config] if config else None,\n+    )\n+\n+    esbuild(\n+        name = name,\n+        testonly = testonly,\n+        deps = deps,\n+        entry_point = entry_point,\n+        config = \"%s_config_lib\" % name,\n+        **kwargs\n+    )"
        },
        {
            "sha": "ddd45763ec03c0bf629782b2c7014d738f82bb4c",
            "filename": "tools/karma.bzl",
            "status": "added",
            "additions": 163,
            "deletions": 0,
            "changes": 163,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fkarma.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fkarma.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fkarma.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,163 @@\n+\"\"\"Helper macros for running jasmine specs via karma\"\"\"\n+\n+# Inspired by:\n+#   rules_nodejs concatjs: https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma.conf.js\n+#   esbuild: https://gist.github.com/mattem/f6e85437b0dbcca661013a19247889a9\n+\n+load(\"@io_bazel_rules_webtesting//web:web.bzl\", _web_test_suite = \"web_test_suite\")\n+load(\"@npm//@bazel/esbuild:index.bzl\", _esbuild = \"esbuild\")\n+load(\"@npm//karma:index.bzl\", _karma = \"karma\")\n+\n+KARMA_PEER_DEPS = [\n+    \"@npm//karma-chrome-launcher\",\n+    \"@npm//karma-firefox-launcher\",\n+    \"@npm//karma-jasmine\",\n+    \"@npm//karma-sourcemap-loader\",\n+    \"@npm//karma-junit-reporter\",\n+]\n+\n+# https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L94-L99\n+# Avoid using non-normalized paths (workspace/../other_workspace/path)\n+def _to_manifest_path(ctx, file):\n+    if file.short_path.startswith(\"../\"):\n+        return file.short_path[3:]\n+    else:\n+        return ctx.workspace_name + \"/\" + file.short_path.replace(\".ts\", \".js\")\n+\n+# Generate a karma.config.js file to:\n+# - run the given bundle containing specs\n+# - serve the given assets via http\n+# - bootstrap a set of js files before the bundle\n+def _generate_karma_config_impl(ctx):\n+    configuration = ctx.outputs.configuration\n+\n+    # root-relative (runfiles) path to the directory containing karma.conf\n+    config_segments = len(configuration.short_path.split(\"/\"))\n+\n+    # Extract the bundle directory out of the bundle target files\n+    bundle_dir = [f for f in ctx.attr.bundle[DefaultInfo].files.to_list() if f.is_directory][0]\n+\n+    ctx.actions.expand_template(\n+        template = ctx.file._conf_tmpl,\n+        output = configuration,\n+        substitutions = {\n+            \"TMPL_bootstrap_files\": \"\\n  \".join([\"'%s',\" % _to_manifest_path(ctx, e) for e in ctx.files.bootstrap]),\n+            \"TMPL_runfiles_path\": \"/\".join([\"..\"] * config_segments),\n+            \"TMPL_static_files\": \"\\n  \".join([\"'%s',\" % _to_manifest_path(ctx, e) for e in ctx.files.static_files]),\n+            \"TMPL_test_bundle_dir\": _to_manifest_path(ctx, bundle_dir),\n+        },\n+    )\n+\n+_generate_karma_config = rule(\n+    implementation = _generate_karma_config_impl,\n+    attrs = {\n+        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L34-L39\n+        \"bootstrap\": attr.label_list(\n+            doc = \"\"\"JavaScript files to load via <script> *before* the specs\"\"\",\n+            allow_files = [\".js\", \".mjs\"],\n+        ),\n+        \"bundle\": attr.label(\n+            doc = \"\"\"The label producing the bundle directory containing the specs\"\"\",\n+            mandatory = True,\n+        ),\n+\n+        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L81-L87\n+        \"static_files\": attr.label_list(\n+            doc = \"\"\"Arbitrary files which are available to be served on request\"\"\",\n+            allow_files = True,\n+        ),\n+\n+        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L88-L91\n+        \"_conf_tmpl\": attr.label(\n+            doc = \"\"\"the karma config template\"\"\",\n+            cfg = \"host\",\n+            allow_single_file = True,\n+            default = Label(\"//tools:karma.conf.js\"),\n+        ),\n+    },\n+    outputs = {\n+        \"configuration\": \"%{name}.js\",\n+    },\n+)\n+\n+# Macro to convert a set of files into a web_test_suite\n+def karma_web_test_suite(name, browsers, specs, deps = [], bootstrap = [], static_files = []):\n+    \"\"\"Run the given specs.\n+\n+    Args:\n+        name: primary karma target rule name\n+        browsers: browsers to test\n+        specs: spec files containing tests\n+        deps: dependencies of the specs\n+        bootstrap: files loaded in <script> tags up front\n+        static_files: files available to download\n+    \"\"\"\n+    bundle_name = \"%s.bundle\" % name\n+    suite_name = \"%s.suite\" % name\n+    karma_config_name = \"%s.conf\" % name\n+    karma_name = name\n+\n+    # Bundle the spec files\n+    _esbuild(\n+        name = bundle_name,\n+        entry_points = [spec.replace(\".ts\", \".js\") for spec in specs],\n+        output_dir = True,\n+        splitting = True,\n+        deps = deps,\n+        testonly = 1,\n+    )\n+\n+    _generate_karma_config(\n+        name = karma_config_name,\n+        bundle = \":%s\" % bundle_name,\n+        bootstrap = bootstrap,\n+        static_files = static_files,\n+        testonly = 1,\n+    )\n+\n+    _karma(\n+        name = karma_name,\n+        testonly = 1,\n+        data = KARMA_PEER_DEPS + bootstrap + static_files + [\n+            # generated config + specs-bundle\n+            \":%s\" % karma_config_name,\n+            \":%s\" % bundle_name,\n+        ],\n+        templated_args = [\n+            \"start\",\n+            \"$(rootpath %s)\" % karma_config_name,\n+        ],\n+    )\n+\n+    # Create a rules_webtesting web_test_suite wrapping the karma runner\n+    _web_test_suite(\n+        name = suite_name,\n+        test = \":\" + karma_name,\n+        launcher = \":\" + karma_name,\n+        testonly = 1,\n+        tags = [\"native\"],\n+        browsers = browsers,\n+    )\n+\n+def ng_karma_web_test_suite(name, browsers, specs, deps = [], bootstrap = [], static_files = []):\n+    default_bootstrap = [\n+        \"@npm//:node_modules/zone.js/dist/zone-testing-bundle.js\",\n+        \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n+    ]\n+    default_specs = [\n+        \"//:initialize_testbed.js\",\n+    ]\n+    default_deps = [\n+        \"@npm//@angular/compiler\",\n+        \"@npm//@angular/platform-browser-dynamic\",\n+        \"//:initialize_testbed\",\n+    ]\n+\n+    karma_web_test_suite(\n+        name,\n+        browsers,\n+        specs=specs + default_specs,\n+        deps=deps + default_deps,\n+        bootstrap=bootstrap + default_bootstrap,\n+        static_files=static_files\n+    )\n\\ No newline at end of file"
        },
        {
            "sha": "5ba31b9d1b28b9e6a85989195cc467fc3d70f029",
            "filename": "tools/karma.conf.js",
            "status": "added",
            "additions": 414,
            "deletions": 0,
            "changes": 414,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fkarma.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fkarma.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fkarma.conf.js?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,414 @@\n+// Karma configuration GENERATED BY Bazel\n+\n+const path = require('path');\n+const fs = require('fs');\n+const child_process = require('child_process');\n+const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']);\n+\n+// Static files are added to the files array but configured to not be included,\n+// so karma does not included them. Note that we need.\n+const STATIC_FILES = [\n+  // BEGIN STATIC FILES\n+  TMPL_static_files\n+  // END STATIC FILES\n+];\n+\n+const BOOTSTRAP_FILES = [\n+  // BEGIN BOOTSTRAP FILES\n+  TMPL_bootstrap_files\n+  // END BOOTSTRAP FILES\n+];\n+\n+// Test + runtime entry point files\n+const BUNDLE_FILES = findAllFiles('TMPL_test_bundle_dir');\n+\n+// process.env.BUILD_WORKSPACE_DIRECTORY is set to the the absolute path of\n+// the bazel workspace when doing `bazel run ...`\n+// See https://docs.bazel.build/versions/master/user-manual.html#run\n+const isBazelRun = !!process.env.BUILD_WORKSPACE_DIRECTORY;\n+\n+// Setup ibazel livereload when run with ibazel\n+const ibazelNotifyChanges = isBazelRun && !!process.env.IBAZEL_NOTIFY_CHANGES;\n+\n+const VERBOSE_LOGS = !!process.env['VERBOSE_LOGS'];\n+\n+function log_verbose(...m) {\n+  // This is a template file so we use __filename to output the actual filename\n+  if (VERBOSE_LOGS) console.error(`[${path.basename(__filename)}]`, ...m);\n+}\n+\n+function findAllFiles(dir, subdir, found) {\n+  subdir = subdir || '.';\n+  found = found || [];\n+\n+  const fullPath = runfiles.resolve(dir);\n+\n+  for (const file of fs.readdirSync(fullPath)) {\n+    const filePath = dir + '/' + file;\n+\n+    if (fs.statSync(runfiles.resolve(filePath)).isDirectory()) {\n+      findAllFiles(filePath, subdir, found);\n+    } else {\n+      found.push(filePath);\n+    }\n+  }\n+\n+  return found;\n+}\n+\n+/**\n+ * Helper function to merge base karma config values that are arrays.\n+ */\n+function mergeConfigArray(conf, name, values) {\n+  if (!conf[name]) {\n+    conf[name] = [];\n+  }\n+  values.forEach(v => {\n+    if (!conf[name].includes(v)) {\n+      conf[name].push(v);\n+    }\n+  })\n+}\n+\n+/**\n+ * Helper function to find a particular namedFile\n+ * within the webTestMetadata webTestFiles\n+ */\n+function findNamedFile(webTestMetadata, key) {\n+  let result;\n+  webTestMetadata['webTestFiles'].forEach(entry => {\n+    const webTestNamedFiles = entry['namedFiles'];\n+    if (webTestNamedFiles && webTestNamedFiles[key]) {\n+      result = webTestNamedFiles[key];\n+    }\n+  });\n+  return result;\n+}\n+\n+/**\n+ * Helper function to extract a browser archive\n+ * and return the path to extract executable\n+ */\n+function extractWebArchive(extractExe, archiveFile, executablePath) {\n+  try {\n+    // Paths are relative to the root runfiles folder\n+    extractExe = extractExe ? path.join('..', extractExe) : extractExe;\n+    archiveFile = path.join('..', archiveFile);\n+    const extractedExecutablePath = path.join(process.cwd(), executablePath);\n+    if (!extractExe) {\n+      throw new Error('No EXTRACT_EXE found');\n+    }\n+    child_process.execFileSync(\n+        extractExe, [archiveFile, '.'], {stdio: [process.stdin, process.stdout, process.stderr]});\n+    log_verbose(\n+        `Extracting web archive ${archiveFile} with ${extractExe} to ${extractedExecutablePath}`);\n+    return extractedExecutablePath;\n+  } catch (e) {\n+    console.error(`Failed to extract ${archiveFile}`);\n+    throw e;\n+  }\n+}\n+\n+/**\n+ * Check if Chrome sandboxing is supported on the current platform.\n+ */\n+function supportChromeSandboxing() {\n+  if (process.platform === 'darwin') {\n+    // Chrome 73+ fails to initialize the sandbox on OSX when running under Bazel.\n+    // ```\n+    // ERROR [launcher]: Cannot start ChromeHeadless\n+    // ERROR:crash_report_database_mac.mm(96)] mkdir\n+    // /private/var/tmp/_bazel_greg/62ef096b0da251c6d093468a1efbfbd3/execroot/angular/bazel-out/darwin-fastbuild/bin/external/io_bazel_rules_webtesting/third_party/chromium/chromium.out/chrome-mac/Chromium.app/Contents/Versions/73.0.3683.0/Chromium\n+    // Framework.framework/Versions/A/new: Permission denied (13) ERROR:file_io.cc(89)]\n+    // ReadExactly: expected 8, observed 0 ERROR:crash_report_database_mac.mm(96)] mkdir\n+    // /private/var/tmp/_bazel_greg/62ef096b0da251c6d093468a1efbfbd3/execroot/angular/bazel-out/darwin-fastbuild/bin/external/io_bazel_rules_webtesting/third_party/chromium/chromium.out/chrome-mac/Chromium.app/Contents/Versions/73.0.3683.0/Chromium\n+    // Framework.framework/Versions/A/new: Permission denied (13) Chromium Helper[94642] <Error>:\n+    // SeatbeltExecServer: Failed to initialize sandbox: -1 Operation not permitted Failed to\n+    // initialize sandbox. [0213/201206.137114:FATAL:content_main_delegate.cc(54)] Check failed:\n+    // false. 0   Chromium Framework                  0x000000010c078bc9 ChromeMain + 43788137 1\n+    // Chromium Framework                  0x000000010bfc0f43 ChromeMain + 43035363\n+    // ...\n+    // ```\n+    return false;\n+  }\n+\n+  if (process.platform === 'linux') {\n+    // Chrome on Linux uses sandboxing, which needs user namespaces to be enabled.\n+    // This is not available on all kernels and it might be turned off even if it is available.\n+    // Notable examples where user namespaces are not available include:\n+    // - In Debian it is compiled-in but disabled by default.\n+    // - The Docker daemon for Windows or OSX does not support user namespaces.\n+    // We can detect if user namespaces are supported via\n+    // /proc/sys/kernel/unprivileged_userns_clone. For more information see:\n+    // https://github.com/Googlechrome/puppeteer/issues/290\n+    // https://superuser.com/questions/1094597/enable-user-namespaces-in-debian-kernel#1122977\n+    // https://github.com/karma-runner/karma-chrome-launcher/issues/158\n+    // https://github.com/angular/angular/pull/24906\n+    try {\n+      const res = child_process.execSync('cat /proc/sys/kernel/unprivileged_userns_clone')\n+                      .toString()\n+                      .trim();\n+      return res === '1';\n+    } catch (error) {\n+    }\n+    return false;\n+  }\n+\n+  return true;\n+}\n+\n+/**\n+ * Helper function to override nested karma config values.\n+ */\n+function overrideNestedConfigValue(conf, name, value) {\n+  const nameParts = name.split('.');\n+  const finalName = nameParts.pop();\n+  for (const property of nameParts) {\n+    if (!(property in conf)) {\n+      conf[property] = {};\n+    }\n+    conf = conf[property];\n+  }\n+  if (conf.hasOwnProperty(name)) {\n+    console.warn(`Your karma configuration specifies '${name}' which will be overwritten by Bazel`);\n+  }\n+  conf[finalName] = value;\n+}\n+\n+/**\n+ * Configuration settings for karma under Bazel common to karma_web_test\n+ * and karma_web_test_suite.\n+ */\n+function configureTestReporters(conf) {\n+  // Configure the junit reporter if the XML_OUTPUT_FILE environment is defined.\n+  const testOutputFile = process.env.XML_OUTPUT_FILE;\n+  if (testOutputFile) {\n+    mergeConfigArray(conf, 'plugins', []);\n+\n+    mergeConfigArray(conf, 'reporters', ['junit']);\n+\n+\n+    overrideNestedConfigValue(conf, 'junitReporter.outputDir', path.dirname(testOutputFile));\n+    overrideNestedConfigValue(conf, 'junitReporter.outputFile', path.basename(testOutputFile));\n+    overrideNestedConfigValue(conf, 'junitReporter.useBrowserName', false);\n+  }\n+}\n+\n+/**\n+ * Configure the 'files' and 'proxies' configuration attributes based on the\n+ * injected STATIC_FILES, BOOTSTRAP_FILES and BUNDLE_FILES.\n+ */\n+function configureFiles(conf) {\n+  // Static files available but not included\n+  STATIC_FILES.forEach(f => conf.files.push({pattern: f, included: false}));\n+\n+  // Bootstrap files included before spec files\n+  BOOTSTRAP_FILES.forEach(f => conf.files.push(f));\n+\n+  // Bundle files available to downloaded, included if non-chunk js files\n+  BUNDLE_FILES.forEach(f => {\n+    const isJs = f.endsWith('.js') || f.endsWith('.mjs');\n+    const isChunk = isJs && f.includes('chunk-');\n+\n+    conf.files.push({\n+      pattern: f,\n+      type: isJs ? 'module' : undefined,\n+      included: isJs && !isChunk,\n+    });\n+  });\n+\n+  // Proxy simple URLs to the bazel resolved files\n+  [...STATIC_FILES, ...BOOTSTRAP_FILES, ...BUNDLE_FILES].forEach(f => {\n+    // In Windows, the runfile will probably not be symlinked. Se we need to\n+    // serve the real file through karma, and proxy calls to the expected file\n+    // location in the runfiles to the real file.\n+    const resolvedFile = runfiles.resolve(f);\n+\n+    // Prefixing the proxy path with '/absolute' allows karma to load local\n+    // files. This doesn't see to be an official API.\n+    // https://github.com/karma-runner/karma/issues/2703\n+    conf.proxies['/base/' + f] = '/absolute' + resolvedFile;\n+  })\n+}\n+\n+/**\n+ * Configure karma when run under web_test_suite to use the test suite provided\n+ * browsers.\n+ */\n+function configureWebTestSuiteBrowsers(conf) {\n+  // If this is NOT invoked via a web_test_suite rule exist and assume configured elsewhere\n+  if (!process.env['WEB_TEST_METADATA']) {\n+    return;\n+  }\n+\n+  const webTestMetadata = require(runfiles.resolve(process.env['WEB_TEST_METADATA']));\n+\n+  log_verbose(`WEB_TEST_METADATA: ${JSON.stringify(webTestMetadata, null, 2)}`);\n+\n+  if (webTestMetadata['environment'] === 'local') {\n+    // When a local chrome or firefox browser is chosen such as\n+    // \"@io_bazel_rules_webtesting//browsers:chromium-local\" or\n+    // \"@io_bazel_rules_webtesting//browsers:firefox-local\"\n+    // then the 'environment' will equal 'local' and\n+    // 'webTestFiles' will contain the path to the binary to use\n+    const extractExe = findNamedFile(webTestMetadata, 'EXTRACT_EXE');\n+    webTestMetadata['webTestFiles'].forEach(webTestFiles => {\n+      const webTestNamedFiles = webTestFiles['namedFiles'];\n+      const archiveFile = webTestFiles['archiveFile'];\n+\n+      if (webTestNamedFiles['CHROMIUM']) {\n+        // When karma is configured to use Chrome it will look for a CHROME_BIN\n+        // environment variable.\n+        if (archiveFile) {\n+          process.env.CHROME_BIN =\n+              extractWebArchive(extractExe, archiveFile, webTestNamedFiles['CHROMIUM']);\n+        } else {\n+          try {\n+            process.env.CHROME_BIN = runfiles.resolve(webTestNamedFiles['CHROMIUM']);\n+          } catch {\n+            // Fail as this file is expected to be in runfiles\n+            throw new Error(`Failed to resolve rules_webtesting Chromium binary '${\n+                webTestNamedFiles['CHROMIUM']}' in runfiles`);\n+          }\n+        }\n+        // Read any additional chrome options (as specified by the\n+        // rules_webtesting manifest).\n+        const chromeOptions = (webTestMetadata['capabilities'] || {})['goog:chromeOptions'];\n+        const additionalArgs = (chromeOptions ? chromeOptions['args'] : []).filter(arg => {\n+          // We never want to 'run' Chrome in headless mode.\n+          return arg != '--headless';\n+        });\n+        const browser = process.env['DISPLAY'] ? 'Chrome' : 'ChromeHeadless';\n+        if (!supportChromeSandboxing()) {\n+          const launcher = 'CustomChromeWithoutSandbox';\n+          conf.customLaunchers =\n+              {[launcher]: {base: browser, flags: ['--no-sandbox', ...additionalArgs]}};\n+          conf.browsers.push(launcher);\n+        } else {\n+          const launcher = 'CustomChrome';\n+          conf.customLaunchers = {[launcher]: {base: browser, flags: additionalArgs}};\n+          conf.browsers.push(launcher);\n+        }\n+      }\n+      if (webTestNamedFiles['FIREFOX']) {\n+        // When karma is configured to use Firefox it will look for a\n+        // FIREFOX_BIN environment variable.\n+        if (archiveFile) {\n+          process.env.FIREFOX_BIN =\n+              extractWebArchive(extractExe, archiveFile, webTestNamedFiles['FIREFOX']);\n+        } else {\n+          try {\n+            process.env.FIREFOX_BIN = runfiles.resolve(webTestNamedFiles['FIREFOX']);\n+          } catch {\n+            // Fail as this file is expected to be in runfiles\n+            throw new Error(`Failed to resolve rules_webtesting Firefox binary '${\n+                webTestNamedFiles['FIREFOX']}' in runfiles`);\n+          }\n+        }\n+        conf.browsers.push(process.env['DISPLAY'] ? 'Firefox' : 'FirefoxHeadless');\n+      }\n+    });\n+  } else {\n+    throw new Error(`Unknown WEB_TEST_METADATA environment '${webTestMetadata['environment']}'`);\n+  }\n+\n+  if (!conf.browsers.length) {\n+    throw new Error('No browsers configured in web test suite');\n+  }\n+}\n+\n+function configureBazelTestBrowsers(conf) {\n+  // If this is invoked via a web_test_suite rule exist and assume configured elsewhere\n+  if (process.env['WEB_TEST_METADATA']) {\n+    return;\n+  }\n+\n+  // Fallback to using the system local chrome if no valid browsers have been\n+  // configured above\n+  if (!conf.browsers || !conf.browsers.length) {\n+    console.warn('No browsers configured. Configuring Karma to use system Chrome.');\n+    conf.browsers = [process.env['DISPLAY'] ? 'Chrome' : 'ChromeHeadless'];\n+  }\n+}\n+\n+function configureFormatError(conf) {\n+  conf.formatError = (msg) => {\n+    // This is a bazel specific formatError that removes the workspace\n+    // name from stack traces.\n+    // Look for filenames of the format \"(<filename>:<row>:<column>\"\n+    const FILENAME_REGEX = /\\(([^:\\n\\r]+)(:\\d+:\\d+)/gm;\n+    msg = msg.replace(FILENAME_REGEX, (_, p1, p2) => {\n+      if (p1.startsWith('../')) {\n+        // Remove all leading \"../\"\n+        while (p1.startsWith('../')) {\n+          p1 = p1.substr(3);\n+        }\n+      } else {\n+        // Remove workspace name(angular, ngdeps etc.) from the beginning.\n+        const index = p1.indexOf('/');\n+        if (index >= 0) {\n+          p1 = p1.substr(index + 1);\n+        }\n+      }\n+      return '(' + p1 + p2;\n+    });\n+    return msg + '\\n\\n';\n+  };\n+}\n+\n+module.exports = function(config) {\n+  const conf = {\n+    basePath: 'TMPL_runfiles_path',\n+\n+    colors: true,\n+    logLevel: VERBOSE_LOGS ? config.LOG_DEBUG : config.LOG_INFO,\n+\n+    frameworks: ['jasmine'],\n+    reporters: isBazelRun ? [] : ['progress'],\n+    plugins: [\n+      require('karma-chrome-launcher'), require('karma-firefox-launcher'), require('karma-jasmine'),\n+      require('karma-sourcemap-loader'), require('karma-junit-reporter')\n+    ],\n+\n+    preprocessors: {\n+      '**/*.js': ['sourcemap'],\n+    },\n+\n+    concurrency: Infinity,\n+\n+    // When doing `bazel run ...` we want karma to continue running, where when\n+    // doing `bazel test ...` it can run once and close right away.\n+    singleRun: !isBazelRun,\n+\n+    // watch the files when using ibazel\n+    autoWatch: ibazelNotifyChanges,\n+\n+    // Disable 'strict-origin-when-cross-origin' to allow external scripts for livereload\n+    crossOriginAttribute: !ibazelNotifyChanges,\n+\n+    // Configured based on bazel web/testing setup\n+    browsers: [],\n+\n+    // Configured based on bazel file inputs\n+    // Include the ibazel livereload script at the start when available\n+    files: process.env.IBAZEL_LIVERELOAD_URL ? [process.env.IBAZEL_LIVERELOAD_URL] : [],\n+\n+    // configured based on bazel file inputs\n+    proxies: [],\n+  };\n+\n+  configureTestReporters(conf);\n+  configureFiles(conf);\n+  configureFormatError(conf);\n+\n+  // Do not configure browsers for a `bazel run` and allow manually opening the browser\n+  // for debugging.\n+  if (!isBazelRun) {\n+    configureWebTestSuiteBrowsers(conf);\n+    configureBazelTestBrowsers(conf);\n+  }\n+\n+  log_verbose(`karma configuration: ${JSON.stringify(conf, null, 2)}`);\n+\n+  config.set(conf);\n+}"
        },
        {
            "sha": "d63569b0de2f071590e1cffb475d4a14ee70dd8e",
            "filename": "tools/ngsw_config.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fngsw_config.bzl",
            "raw_url": "https://github.com/angular/angular/raw/88d52c0ac89c57b5a7bb196b2450c3f424f678fa/tools%2Fngsw_config.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fngsw_config.bzl?ref=88d52c0ac89c57b5a7bb196b2450c3f424f678fa",
            "patch": "@@ -1,38 +0,0 @@\n-\"Angular service worker support (credits: https://github.com/marcus-sa)\"\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n-\n-def ngsw_config(name, config, index_html, src, out = None, **kwargs):\n-    \"Creates ngsw.json with service worker configuration and hashes for all source files\"\n-    if not out:\n-        out = name\n-\n-    ngsw_config_name = \"%s_bin\" % name\n-\n-    nodejs_binary(\n-        name = ngsw_config_name,\n-        data = [\"@npm//@angular/service-worker\", index_html, config, src],\n-        visibility = [\"//visibility:private\"],\n-        entry_point = \"@npm//:node_modules/@angular/service-worker/ngsw-config.js\",\n-    )\n-\n-    cmd = \"\"\"\n-mkdir -p $@\n-cp -R $(locations {TMPL_src})/. $@/\n-cp $(location {TMPL_index}) $@/index.html\n-$(location :{TMPL_bin}) $@ $(location {TMPL_conf})\n-    \"\"\".format(\n-        TMPL_src = src,\n-        TMPL_bin = ngsw_config_name,\n-        TMPL_index = index_html,\n-        TMPL_conf = config,\n-    )\n-\n-    native.genrule(\n-        name = name,\n-        outs = [out],\n-        srcs = [src, config, index_html],\n-        tools = [\":\" + ngsw_config_name],\n-        cmd = cmd,\n-        **kwargs\n-    )"
        },
        {
            "sha": "3db5a9f20ed0dafae014515a7b375a4f3ac99914",
            "filename": "tools/spec-bundling/BUILD.bazel",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fspec-bundling%2FBUILD.bazel?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,3 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+exports_files([\"esbuild.config-tmpl.mjs\"])"
        },
        {
            "sha": "e0ded3d7efe9cc55760fa36ac6916fab76474b43",
            "filename": "tools/spec-bundling/esbuild.config-tmpl.mjs",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,27 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// Note: This needs to be a workspace manifest path as this ESBuild config\n+// is generated and can end up in arbitrary Bazel packages.\n+import {createLinkerEsbuildPlugin} from 'angular_devtools/tools/angular/create_linker_esbuild_plugin.mjs';\n+\n+// Based on the Bazel action and its substitutions, we run the linker for all inputs.\n+const plugins = TMPL_RUN_LINKER\n+  ? [await createLinkerEsbuildPlugin(/.*/, /* ensureNoPartialDeclaration */ true)]\n+  : [];\n+\n+export default {\n+  // `tslib` sets the `module` condition to resolve to ESM.\n+  conditions: ['es2020', 'es2015', 'module'],\n+  // This ensures that we prioritize ES2020. RxJS would otherwise use the ESM5 output.\n+  mainFields: ['es2020', 'es2015', 'module', 'main'],\n+  // Use the `iife` format for the test entry-point as tests should run immediately.\n+  // For browser tests which are wrapped in an AMD header and footer, this works as well.\n+  format: 'iife',\n+  plugins,\n+};"
        },
        {
            "sha": "79bd30cfa21942901e14591bb3be6e3027c0435f",
            "filename": "tools/spec-bundling/index.bzl",
            "status": "added",
            "additions": 151,
            "deletions": 0,
            "changes": 151,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Fspec-bundling%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fspec-bundling%2Findex.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,151 @@\n+load(\"@npm//@angular/dev-infra-private/bazel:expand_template.bzl\", \"expand_template\")\n+load(\"//tools/esbuild:index.bzl\", \"esbuild\", \"esbuild_amd\", \"esbuild_config\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"JSModuleInfo\")\n+load(\"//tools/angular:index.bzl\", \"LINKER_PROCESSED_FW_PACKAGES\")\n+\n+\"\"\"\n+  Starlark file exposing a macro for bundling Bazel targets with spec files into\n+  a single spec ESM/AMD file. Bundling is helpful as it avoids unnecessary complexity\n+  with module resolution at runtime with loaders such as SystemJS or RequireJS.\n+\n+  Additionally, given that Angular framework packages do no longer ship UMD bundles,\n+  bundling simplifies the integration of those FW packages significantly. It also helps\n+  with incorporating the Angular linker-processed output of FW ESM bundles.\n+\"\"\"\n+\n+def _is_spec_file(file):\n+    \"\"\"Gets whether the given file is a spec file.\"\"\"\n+    basename = file.basename\n+\n+    # External files (from other workspaces) should never run as specs.\n+    if (file.short_path.startswith(\"../\")):\n+        return False\n+\n+    # `spec.js` or `spec.mjs` files will be imported in the entry-point.\n+    return basename.endswith(\"spec.js\") or basename.endswith(\"spec.mjs\")\n+\n+def _filter_spec_files(files):\n+    \"\"\"Filters the given list of files to only contain spec files.\"\"\"\n+    result = []\n+    for file in files:\n+        if _is_spec_file(file):\n+            result.append(file)\n+    return result\n+\n+def _create_entrypoint_file(base_package, spec_files):\n+    \"\"\"Creates the contents of the spec entry-point ESM file which imports\n+    all individual spec files so that these are bundled and loaded by Node/Karma.\"\"\"\n+    output = \"\"\n+    for file in spec_files:\n+        base_dir_segments = \"/\".join([\"..\"] * len(base_package.split(\"/\")))\n+        output += \"\"\"import \"%s/%s\";\\n\"\"\" % (base_dir_segments, file.short_path)\n+    return output\n+\n+def _spec_entrypoint_impl(ctx):\n+    output = ctx.actions.declare_file(\"%s.mjs\" % ctx.attr.name)\n+    spec_depsets = []\n+\n+    for dep in ctx.attr.deps:\n+        if JSModuleInfo in dep:\n+            spec_depsets.append(dep[JSModuleInfo].sources)\n+        else:\n+            spec_depsets.append(dep[DefaultInfo].files)\n+\n+    spec_files = []\n+\n+    for spec_depset in spec_depsets:\n+        # Note: `to_list()` is an expensive operation but we need to do this for every\n+        # dependency here in order to be able to filter out spec files from depsets.\n+        spec_files.extend(_filter_spec_files(spec_depset.to_list()))\n+\n+    ctx.actions.write(\n+        output = output,\n+        content = _create_entrypoint_file(ctx.label.package, spec_files),\n+    )\n+\n+    out_depset = depset([output])\n+\n+    return [\n+        DefaultInfo(files = out_depset),\n+        JSModuleInfo(\n+            direct_sources = out_depset,\n+            sources = depset(transitive = [out_depset] + spec_depsets),\n+        ),\n+    ]\n+\n+_spec_entrypoint = rule(\n+    implementation = _spec_entrypoint_impl,\n+    attrs = {\n+        \"deps\": attr.label_list(allow_files = False, mandatory = True),\n+    },\n+)\n+\n+def spec_bundle(name, platform, deps, **kwargs):\n+    \"\"\"\n+      Macro that will bundle all test files, with their respective transitive dependencies,\n+      into a single bundle file that can be loaded within Karma or NodeJS directly. Test files\n+      are bundled as Angular framework packages do not ship UMD files and to avoid overall\n+      complexity with maintaining a runtime loader such as RequireJS or SystemJS.\n+    \"\"\"\n+\n+    is_browser_test = platform == \"browser\"\n+    package_name = native.package_name()\n+    workspace = \"angular_devtools\"\n+\n+    _spec_entrypoint(\n+        name = \"%s_spec_entrypoint\" % name,\n+        deps = deps,\n+        testonly = True,\n+    )\n+\n+    expand_template(\n+        name = \"%s_config_file\" % name,\n+        testonly = True,\n+        template = \"//tools/spec-bundling:esbuild.config-tmpl.mjs\",\n+        output_name = \"%s_config.mjs\" % name,\n+        substitutions = select({\n+            # Depending on whether partial compilation is enabled, we may want to run the linker\n+            # to test the Angular compiler linker AOT processing. Additionally, a config setting\n+            # can forcibly disable the linker to ensure tests rely on JIT linking at runtime.\n+            \"//tools:force_partial_jit_compilation_enabled\": {\"TMPL_RUN_LINKER\": \"false\"},\n+            \"//tools:partial_compilation_enabled\": {\"TMPL_RUN_LINKER\": \"true\"},\n+            \"//conditions:default\": {\"TMPL_RUN_LINKER\": \"true\"},\n+        }),\n+    )\n+\n+    esbuild_config(\n+        name = \"%s_config\" % name,\n+        config_file = \":%s_config_file\" % name,\n+        testonly = True,\n+        deps = [\"//tools/angular:create_linker_esbuild_plugin\"],\n+    )\n+\n+    # Browser tests (Karma) need named AMD modules to load.\n+    # TODO(devversion): consider updating `@bazel/concatjs` to support loading JS files directly.\n+    esbuild_rule = esbuild_amd if is_browser_test else esbuild\n+    amd_name = \"%s/%s/%s\" % (workspace, package_name, name + \"_spec\") if is_browser_test else None\n+\n+    esbuild_rule(\n+        name = \"%s_bundle\" % name,\n+        testonly = True,\n+        config = \":%s_config\" % name,\n+        entry_point = \":%s_spec_entrypoint\" % name,\n+        module_name = amd_name,\n+        output = \"%s_spec.js\" % name,\n+        # We cannot use `ES2017` or higher as that would result in `async/await` not being downleveled.\n+        # ZoneJS needs to be able to intercept these as otherwise change detection would not work properly.\n+        target = \"es2016\",\n+        platform = platform,\n+        # Note: We add all linker-processed FW packages as dependencies here so that ESBuild will\n+        # map all framework packages to their linker-processed bundles from `tools/angular`.\n+        deps = deps + LINKER_PROCESSED_FW_PACKAGES + [\":%s_spec_entrypoint\" % name],\n+        link_workspace_root = True,\n+        **kwargs\n+    )\n+\n+    js_library(\n+        name = name,\n+        testonly = True,\n+        named_module_srcs = [\":%s_bundle\" % name],\n+    )"
        },
        {
            "sha": "5564950896de8a526706d95d75edd09ad5fae19c",
            "filename": "tools/typescript.bzl",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Ftypescript.bzl",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tools%2Ftypescript.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Ftypescript.bzl?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -0,0 +1,24 @@\n+\"\"\"Helper macros for compiling typescript with consistent config\"\"\"\n+\n+load(\"@npm//@bazel/typescript:index.bzl\", _ts_project = \"ts_project\")\n+\n+def ts_project(name, tsconfig = \"//:tsconfig.json\", **kwargs):\n+    _ts_project(\n+        name = name,\n+        tsconfig = tsconfig,\n+        declaration = True,\n+        declaration_map = True,\n+        source_map = True,\n+        **kwargs\n+    )\n+\n+def ts_test_project(name, tsconfig = \"//:tsconfig-spec\", deps = [], **kwargs):\n+    _ts_project(\n+        name = name,\n+        testonly = 1,\n+        tsconfig = tsconfig,\n+        deps = deps + [\"@npm//@types/node\", \"@npm//@types/jasmine\"],\n+        declaration = True,\n+        declaration_map = True,\n+        **kwargs\n+    )"
        },
        {
            "sha": "831139b5d1a9c1ce2ee227e348c2e313280c1322",
            "filename": "tsconfig.json",
            "status": "modified",
            "additions": 42,
            "deletions": 12,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tsconfig.json?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -4,33 +4,63 @@\n     \"plugins\": [\n       {\n         \"name\": \"@bazel/tsetse\",\n-        \"disabledRules\": [\"must-type-assert-json-parse\"]\n+        \"disabledRules\": [\n+          \"must-type-assert-json-parse\"\n+        ]\n       }\n     ],\n     \"baseUrl\": \"./\",\n-    \"outDir\": \"./dist\",\n+    \"outDir\": \"bazel-out/darwin-fastbuild/bin\",\n     \"sourceMap\": true,\n-    \"declaration\": false,\n+    \"declaration\": true,\n+    \"declarationMap\": true,\n     \"strictNullChecks\": true,\n     \"downlevelIteration\": true,\n     \"experimentalDecorators\": true,\n     \"allowSyntheticDefaultImports\": true,\n     \"module\": \"esnext\",\n     \"moduleResolution\": \"node\",\n     \"importHelpers\": true,\n-    \"target\": \"es2015\",\n-    \"typeRoots\": [\"node_modules/@types\"],\n-    \"lib\": [\"es2018\", \"dom\"],\n+    \"target\": \"es2020\",\n+    \"typeRoots\": [\n+      \"node_modules/@types\"\n+    ],\n+    \"lib\": [\n+      \"es2018\",\n+      \"dom\"\n+    ],\n     \"paths\": {\n-      \"ng-devtools\": [\"projects/ng-devtools/src/public-api.ts\", \"dist/ng-devtools\"],\n-      \"ng-devtools-backend\": [\"projects/ng-devtools-backend/src/public-api.ts\", \"dist/ng-devtools-backend\"],\n-      \"protocol\": [\"projects/protocol/src/public-api.ts\", \"dist/protocol\"],\n-      \"shared-utils\": [\"projects/shared-utils/src/public-api.ts\", \"dist/shared-utils\"]\n-    }\n+      \"ng-devtools\": [\n+        \"projects/ng-devtools/src/public-api.ts\",\n+        \"dist/ng-devtools\"\n+      ],\n+      \"ng-devtools-backend\": [\n+        \"projects/ng-devtools-backend/src/public-api.ts\",\n+        \"dist/ng-devtools-backend\"\n+      ],\n+      \"protocol\": [\n+        \"projects/protocol/src/public-api.ts\",\n+        \"dist/protocol\"\n+      ],\n+      \"shared-utils\": [\n+        \"projects/shared-utils/src/public-api.ts\",\n+        \"dist/shared-utils\"\n+      ]\n+    },\n+    \"rootDirs\": [\n+      \".\",\n+      \"./bazel-out/host\",\n+      \"./bazel-out/darwin-fastbuild/bin\",\n+      \"./bazel-out/k8-fastbuild/bin\",\n+      \"./bazel-out/x64_windows-fastbuild/bin\",\n+      \"./bazel-out/darwin-dbg/bin\",\n+      \"./bazel-out/k8-dbg/bin\",\n+      \"./bazel-out/x64_windows-dbg/bin\",\n+    ]\n   },\n   \"angularCompilerOptions\": {\n     \"fullTemplateTypeCheck\": true,\n     \"strictInjectionParameters\": true,\n     \"enableIvy\": true\n   }\n-}\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "1a7b5523ee2b2b9adca78a66277aedce293fe34e",
            "filename": "tsconfig.spec.json",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/tsconfig.spec.json",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/tsconfig.spec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tsconfig.spec.json?ref=ab98d3cfaee524525afeadc5acafc787acae76ca",
            "patch": "@@ -1,9 +1,7 @@\n {\n   \"extends\": \"./tsconfig.json\",\n   \"compilerOptions\": {\n-    \"outDir\": \"./out-tsc/spec\",\n-    \"types\": [\"jasmine\", \"node\"]\n-  },\n-  \"files\": [\"src/test.ts\", \"src/polyfills.ts\"],\n-  \"include\": [\"src/**/*.spec.ts\", \"src/**/*.d.ts\"]\n-}\n+    \"sourceMap\": false,\n+    \"types\": [\"jasmine\", \"node\"],\n+  }\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "3964261799b6eeb5d01456d4bb0d65d40d7fb752",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 1588,
            "deletions": 2146,
            "changes": 3734,
            "blob_url": "https://github.com/angular/angular/blob/ab98d3cfaee524525afeadc5acafc787acae76ca/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/ab98d3cfaee524525afeadc5acafc787acae76ca/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=ab98d3cfaee524525afeadc5acafc787acae76ca"
        }
    ],
    "stats": {
        "total": 6674,
        "additions": 3435,
        "deletions": 3239
    }
}