{
    "author": "petebacondarwin",
    "message": "build(docs-infra): improve docs-watch example matching (#40479)\n\nIn the `docs-watch` job we attempt to guess what additional files need\nto be processed given a change to a single file. Previously we were not\nfinding links to examples that were defined over multiple lines. E.g.\n\n```\n<code-pane\n  header=\"src/app/app.component.html\"\n  region=\"hero-birthday-template\"\n  path=\"pipes/src/app/app.component.html\">\n</code-pane>\n```\n\nThis commit improves the regular expression to handle these cases.\n\nPR Close #40479",
    "sha": "5dd604a15d434229d7cb936554b5266bcbf9b92d",
    "files": [
        {
            "sha": "eb2e0110ffe3f46bdf77262b73e53058ec8485f5",
            "filename": "aio/tools/transforms/authors-package/getting-started-package.js",
            "status": "modified",
            "additions": 16,
            "deletions": 20,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fgetting-started-package.js",
            "raw_url": "https://github.com/angular/angular/raw/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fgetting-started-package.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fgetting-started-package.js?ref=5dd604a15d434229d7cb936554b5266bcbf9b92d",
            "patch": "@@ -6,42 +6,38 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+const {resolve} = require('canonical-path');\n const Package = require('dgeni').Package;\n+const {readFileSync} = require('fs');\n+\n const contentPackage = require('../angular-content-package');\n-const { readFileSync } = require('fs');\n-const { resolve } = require('canonical-path');\n-const { CONTENTS_PATH } = require('../config');\n+const {CONTENTS_PATH} = require('../config');\n+const {codeExampleMatcher} = require('./utils');\n \n /* eslint no-console: \"off\" */\n \n function createPackage(tutorialName) {\n-\n   const tutorialFilePath = `${CONTENTS_PATH}/start/${tutorialName}.md`;\n   const tutorialFile = readFileSync(tutorialFilePath, 'utf8');\n   const examples = [];\n-  tutorialFile.replace(/<code-(?:pane|example) [^>]*path=\"([^\"]+)\"/g, (_, path) => examples.push('examples/' + path));\n+  tutorialFile.replace(codeExampleMatcher, (_, path) => examples.push('examples/' + path));\n \n   if (examples.length) {\n     console.log('The following example files are referenced in this getting-started:');\n     console.log(examples.map(example => ' - ' + example).join('\\n'));\n   }\n \n   return new Package('author-getting-started', [contentPackage])\n-    .config(function(readFilesProcessor) {\n-      readFilesProcessor.sourceFiles = [\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: tutorialFilePath,\n-          fileReader: 'contentFileReader'\n-        },\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: examples.map(example => resolve(CONTENTS_PATH, example)),\n-          fileReader: 'exampleFileReader'\n-        }\n-      ];\n-    });\n+      .config(function(readFilesProcessor) {\n+        readFilesProcessor.sourceFiles = [\n+          {basePath: CONTENTS_PATH, include: tutorialFilePath, fileReader: 'contentFileReader'}, {\n+            basePath: CONTENTS_PATH,\n+            include: examples.map(example => resolve(CONTENTS_PATH, example)),\n+            fileReader: 'exampleFileReader'\n+          }\n+        ];\n+      });\n }\n \n \n-module.exports = { createPackage };\n+module.exports = {createPackage};"
        },
        {
            "sha": "4ba82e950d79eba6ab96c154bf67fb6cfa602e99",
            "filename": "aio/tools/transforms/authors-package/guide-package.js",
            "status": "modified",
            "additions": 16,
            "deletions": 21,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fguide-package.js",
            "raw_url": "https://github.com/angular/angular/raw/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fguide-package.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fguide-package.js?ref=5dd604a15d434229d7cb936554b5266bcbf9b92d",
            "patch": "@@ -8,39 +8,34 @@\n \n /* eslint no-console: \"off\" */\n \n+const {resolve} = require('canonical-path');\n const Package = require('dgeni').Package;\n+const {readFileSync} = require('fs');\n+\n const contentPackage = require('../angular-content-package');\n-const { readFileSync } = require('fs');\n-const { resolve } = require('canonical-path');\n-const { CONTENTS_PATH } = require('../config');\n+const {CONTENTS_PATH} = require('../config');\n+const {codeExampleMatcher} = require('./utils');\n \n function createPackage(guideName) {\n-\n   const guideFilePath = `${CONTENTS_PATH}/guide/${guideName}.md`;\n   const guideFile = readFileSync(guideFilePath, 'utf8');\n   const examples = [];\n-  guideFile.replace(/<code-(?:pane|example) [^>]*path=\"([^\"]+)\"/g, (_, path) => examples.push('examples/' + path));\n+  guideFile.replace(codeExampleMatcher, (_, path) => examples.push('examples/' + path));\n \n   if (examples.length) {\n     console.log('The following example files are referenced in this guide:');\n     console.log(examples.map(example => ' - ' + example).join('\\n'));\n   }\n \n-  return new Package('author-guide', [contentPackage])\n-    .config(function(readFilesProcessor) {\n-      readFilesProcessor.sourceFiles = [\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: guideFilePath,\n-          fileReader: 'contentFileReader'\n-        },\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: examples.map(example => resolve(CONTENTS_PATH, example)),\n-          fileReader: 'exampleFileReader'\n-        }\n-      ];\n-    });\n+  return new Package('author-guide', [contentPackage]).config(function(readFilesProcessor) {\n+    readFilesProcessor.sourceFiles = [\n+      {basePath: CONTENTS_PATH, include: guideFilePath, fileReader: 'contentFileReader'}, {\n+        basePath: CONTENTS_PATH,\n+        include: examples.map(example => resolve(CONTENTS_PATH, example)),\n+        fileReader: 'exampleFileReader'\n+      }\n+    ];\n+  });\n }\n \n-module.exports = { createPackage };\n+module.exports = {createPackage};"
        },
        {
            "sha": "3fd0fbda160747b3ea07641cc0419c95feb80e47",
            "filename": "aio/tools/transforms/authors-package/tutorial-package.js",
            "status": "modified",
            "additions": 16,
            "deletions": 21,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Ftutorial-package.js",
            "raw_url": "https://github.com/angular/angular/raw/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Ftutorial-package.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fauthors-package%2Ftutorial-package.js?ref=5dd604a15d434229d7cb936554b5266bcbf9b92d",
            "patch": "@@ -6,42 +6,37 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+const {resolve} = require('canonical-path');\n const Package = require('dgeni').Package;\n+const {readFileSync} = require('fs');\n+\n const contentPackage = require('../angular-content-package');\n-const { readFileSync } = require('fs');\n-const { resolve } = require('canonical-path');\n-const { CONTENTS_PATH } = require('../config');\n+const {CONTENTS_PATH} = require('../config');\n+const {codeExampleMatcher} = require('./utils');\n \n /* eslint no-console: \"off\" */\n \n function createPackage(tutorialName) {\n-\n   const tutorialFilePath = `${CONTENTS_PATH}/tutorial/${tutorialName}.md`;\n   const tutorialFile = readFileSync(tutorialFilePath, 'utf8');\n   const examples = [];\n-  tutorialFile.replace(/<code-(?:pane|example) [^>]*path=\"([^\"]+)\"/g, (_, path) => examples.push('examples/' + path));\n+  tutorialFile.replace(codeExampleMatcher, (_, path) => examples.push('examples/' + path));\n \n   if (examples.length) {\n     console.log('The following example files are referenced in this tutorial:');\n     console.log(examples.map(example => ' - ' + example).join('\\n'));\n   }\n \n-  return new Package('author-tutorial', [contentPackage])\n-    .config(function(readFilesProcessor) {\n-      readFilesProcessor.sourceFiles = [\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: tutorialFilePath,\n-          fileReader: 'contentFileReader'\n-        },\n-        {\n-          basePath: CONTENTS_PATH,\n-          include: examples.map(example => resolve(CONTENTS_PATH, example)),\n-          fileReader: 'exampleFileReader'\n-        }\n-      ];\n-    });\n+  return new Package('author-tutorial', [contentPackage]).config(function(readFilesProcessor) {\n+    readFilesProcessor.sourceFiles = [\n+      {basePath: CONTENTS_PATH, include: tutorialFilePath, fileReader: 'contentFileReader'}, {\n+        basePath: CONTENTS_PATH,\n+        include: examples.map(example => resolve(CONTENTS_PATH, example)),\n+        fileReader: 'exampleFileReader'\n+      }\n+    ];\n+  });\n }\n \n \n-module.exports = { createPackage };\n+module.exports = {createPackage};"
        },
        {
            "sha": "d36515d92b4c4a2bbe872369c9a3f7e85cca6182",
            "filename": "aio/tools/transforms/authors-package/utils.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Futils.js",
            "raw_url": "https://github.com/angular/angular/raw/5dd604a15d434229d7cb936554b5266bcbf9b92d/aio%2Ftools%2Ftransforms%2Fauthors-package%2Futils.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fauthors-package%2Futils.js?ref=5dd604a15d434229d7cb936554b5266bcbf9b92d",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+module.exports = {\n+  codeExampleMatcher: /<code-(?:pane|example)[^>]*\\bpath=\"([^\"]+)\"/g,\n+};"
        }
    ],
    "stats": {
        "total": 121,
        "additions": 59,
        "deletions": 62
    }
}