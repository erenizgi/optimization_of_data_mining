{
    "author": "atscott",
    "message": "docs(router): clarify how base href is used to construct targets (#38123)\n\nThe documentation is not clear on how the base href and APP_BASE_HREF are used. This commit\nshould help clarify more complicated use-cases beyond the most common one of just a '/'\n\nPR Close #38123",
    "sha": "8effc83b921608dab22eba1076f1eb554e8cf199",
    "files": [
        {
            "sha": "82a711e0a3a0a8e0747ee8660ba201e7ea35772c",
            "filename": "aio/content/guide/router.md",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/8effc83b921608dab22eba1076f1eb554e8cf199/aio%2Fcontent%2Fguide%2Frouter.md",
            "raw_url": "https://github.com/angular/angular/raw/8effc83b921608dab22eba1076f1eb554e8cf199/aio%2Fcontent%2Fguide%2Frouter.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Frouter.md?ref=8effc83b921608dab22eba1076f1eb554e8cf199",
            "patch": "@@ -541,6 +541,15 @@ set the `href` value in `index.html` as shown here.\n \n ### HTML5 URLs and the  `<base href>`\n \n+The guidelines that follow will refer to different parts of a URL. This diagram outlines what those parts refer to:\n+\n+```\n+foo://example.com:8042/over/there?name=ferret#nose\n+\\_/   \\______________/\\_________/ \\_________/ \\__/\n+ |           |            |            |        |\n+scheme    authority      path        query   fragment\n+```\n+\n While the router uses the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/History_API#Adding_and_modifying_history_entries\" title=\"Browser history push-state\">HTML5 pushState</a> style by default, you must configure that strategy with a `<base href>`.\n \n The preferred way to configure the strategy is to add a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base\" title=\"base href\">&lt;base href&gt; element</a> tag in the `<head>` of the `index.html`.\n@@ -554,8 +563,16 @@ Some developers may not be able to add the `<base>` element, perhaps because the\n \n Those developers may still use HTML5 URLs by taking the following two steps:\n \n-1. Provide the router with an appropriate [APP_BASE_HREF][] value.\n-1. Use root URLs for all web resources: CSS, images, scripts, and template HTML files.\n+1. Provide the router with an appropriate `APP_BASE_HREF` value.\n+1. Use root URLs (URLs with an `authority`) for all web resources: CSS, images, scripts, and template HTML files.\n+\n+* The `<base href>` `path` should end with a \"/\", as browsers ignore characters in the `path` that follow the right-most \"/\".\n+* If the `<base href>` includes a `query` part, the `query` is only used if the `path` of a link in the page is empty and has no `query`.\n+This means that a `query` in the `<base href>` is only included when using `HashLocationStrategy`.\n+* If a link in the page is a root URL (has an `authority`), the `<base href>` is not used. In this way, an `APP_BASE_HREF` with an authority will cause all links created by Angular to ignore the `<base href>` value.\n+* A fragment in the `<base href>` is _never_ persisted.\n+\n+For more complete information on how `<base href>` is used to construct target URIs, see the [RFC](https://tools.ietf.org/html/rfc3986#section-5.2.2) section on transforming references.\n \n {@a hashlocationstrategy}\n "
        },
        {
            "sha": "3d9bc0e05f46e29cc6aff22132bdad78b4396b4e",
            "filename": "packages/common/src/location/location_strategy.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/8effc83b921608dab22eba1076f1eb554e8cf199/packages%2Fcommon%2Fsrc%2Flocation%2Flocation_strategy.ts",
            "raw_url": "https://github.com/angular/angular/raw/8effc83b921608dab22eba1076f1eb554e8cf199/packages%2Fcommon%2Fsrc%2Flocation%2Flocation_strategy.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Flocation%2Flocation_strategy.ts?ref=8effc83b921608dab22eba1076f1eb554e8cf199",
            "patch": "@@ -81,17 +81,21 @@ export const APP_BASE_HREF = new InjectionToken<string>('appBaseHref');\n  * browser's URL.\n  *\n  * If you're using `PathLocationStrategy`, you must provide a {@link APP_BASE_HREF}\n- * or add a base element to the document. This URL prefix that will be preserved\n- * when generating and recognizing URLs.\n+ * or add a `<base href>` element to the document.\n  *\n- * For instance, if you provide an `APP_BASE_HREF` of `'/my/app'` and call\n+ * For instance, if you provide an `APP_BASE_HREF` of `'/my/app/'` and call\n  * `location.go('/foo')`, the browser's URL will become\n- * `example.com/my/app/foo`.\n+ * `example.com/my/app/foo`. To ensure all relative URIs resolve correctly,\n+ * the `<base href>` and/or `APP_BASE_HREF` should end with a `/`.\n  *\n- * Similarly, if you add `<base href='/my/app'/>` to the document and call\n+ * Similarly, if you add `<base href='/my/app/'/>` to the document and call\n  * `location.go('/foo')`, the browser's URL will become\n  * `example.com/my/app/foo`.\n  *\n+ * Note that when using `PathLocationStrategy`, neither the query nor\n+ * the fragment in the `<base href>` will be preserved, as outlined\n+ * by the [RFC](https://tools.ietf.org/html/rfc3986#section-5.2.2).\n+ *\n  * @usageNotes\n  *\n  * ### Example"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 28,
        "deletions": 7
    }
}