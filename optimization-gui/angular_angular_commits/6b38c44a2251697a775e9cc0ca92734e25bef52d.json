{
    "author": "petebacondarwin",
    "message": "test(compiler-cli): add source-mapping test helper (#39717)\n\nThis helper improves the message given when an expectation\nfails in a source-mapping test.\n\nPR Close #39717",
    "sha": "6b38c44a2251697a775e9cc0ca92734e25bef52d",
    "files": [
        {
            "sha": "506f58f0199de0d1fec1e70319ae9181bf935cf1",
            "filename": "packages/compiler-cli/test/ngtsc/template_mapping_spec.ts",
            "status": "modified",
            "additions": 179,
            "deletions": 112,
            "changes": 291,
            "blob_url": "https://github.com/angular/angular/blob/6b38c44a2251697a775e9cc0ca92734e25bef52d/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/6b38c44a2251697a775e9cc0ca92734e25bef52d/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts?ref=6b38c44a2251697a775e9cc0ca92734e25bef52d",
            "patch": "@@ -31,59 +31,63 @@ runInEachFileSystem((os) => {\n       describe('(element creation)', () => {\n         it('should map simple element with content', () => {\n           const mappings = compileAndMap('<h1>Heading 1</h1>');\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<h1>', generated: 'i0.ɵɵelementStart(0, \"h1\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'Heading 1',\n             generated: 'i0.ɵɵtext(1, \"Heading 1\")',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n-              {source: '</h1>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n+          expectMapping(\n+              mappings, {source: '</h1>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map void element', () => {\n           const mappings = compileAndMap('<hr>');\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<hr>', generated: 'i0.ɵɵelement(0, \"hr\")', sourceUrl: '../test.ts'});\n         });\n       });\n \n       describe('(interpolations)', () => {\n         it('should map a mix of interpolated and static content', () => {\n           const mappings = compileAndMap('<h3>Hello {{ name }}</h3>');\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<h3>', generated: 'i0.ɵɵelementStart(0, \"h3\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'Hello {{ name }}',\n             generated: 'i0.ɵɵtextInterpolate1(\"Hello \", ctx.name, \"\")',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n-              {source: '</h3>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n+          expectMapping(\n+              mappings, {source: '</h3>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map a complex interpolated expression', () => {\n           const mappings = compileAndMap('<h2>{{ greeting + \" \" + name }}</h2>');\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<h2>', generated: 'i0.ɵɵelementStart(0, \"h2\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '{{ greeting + \" \" + name }}',\n             generated: 'i0.ɵɵtextInterpolate(ctx.greeting + \" \" + ctx.name)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n-              {source: '</h2>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n+          expectMapping(\n+              mappings, {source: '</h2>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map interpolated properties', () => {\n           const mappings = compileAndMap('<div id=\"{{name}}\"></div>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div id=\"{{name}}\"></div>',\n             generated: 'i0.ɵɵelement(0, \"div\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'id=\"{{name}}\"',\n             generated: 'i0.ɵɵpropertyInterpolate(\"id\", ctx.name)',\n             sourceUrl: '../test.ts'\n@@ -92,27 +96,29 @@ runInEachFileSystem((os) => {\n \n         it('should map interpolation with pipe', () => {\n           const mappings = compileAndMap('<div>{{200.3 | percent : 2 }}</div>');\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<div>', generated: 'i0.ɵɵelementStart(0, \"div\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '{{200.3 | percent : 2 }}',\n             generated: 'i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, 200.3, 2))',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n       });\n \n       describe('(property bindings)', () => {\n         it('should map a simple input binding expression', () => {\n           const mappings = compileAndMap('<div [attr]=\"name\"></div>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div [attr]=\"name\"></div>',\n             generated: 'i0.ɵɵelement(0, \"div\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '[attr]=\"name\"',\n             generated: 'i0.ɵɵproperty(\"attr\", ctx.name)',\n             sourceUrl: '../test.ts'\n@@ -122,12 +128,12 @@ runInEachFileSystem((os) => {\n         it('should map a complex input binding expression', () => {\n           const mappings = compileAndMap('<div [attr]=\"greeting + name\"></div>');\n \n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div [attr]=\"greeting + name\"></div>',\n             generated: 'i0.ɵɵelement(0, \"div\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '[attr]=\"greeting + name\"',\n             generated: 'i0.ɵɵproperty(\"attr\", ctx.greeting + ctx.name)',\n             sourceUrl: '../test.ts'\n@@ -136,12 +142,12 @@ runInEachFileSystem((os) => {\n \n         it('should map a longhand input binding expression', () => {\n           const mappings = compileAndMap('<div bind-attr=\"name\"></div>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div bind-attr=\"name\"></div>',\n             generated: 'i0.ɵɵelement(0, \"div\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'bind-attr=\"name\"',\n             generated: 'i0.ɵɵproperty(\"attr\", ctx.name)',\n             sourceUrl: '../test.ts'\n@@ -150,72 +156,80 @@ runInEachFileSystem((os) => {\n \n         it('should map a simple output binding expression', () => {\n           const mappings = compileAndMap('<button (click)=\"doSomething()\">Do it</button>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<button (click)=\"doSomething()\">',\n             generated: 'i0.ɵɵelementStart(0, \"button\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'Do it', generated: 'i0.ɵɵtext(1, \"Do it\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'doSomething()', generated: 'ctx.doSomething()', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</button>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map a complex output binding expression', () => {\n           const mappings = compileAndMap(\n               `<button (click)=\"items.push('item' + items.length)\">Add Item</button>`);\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: `<button (click)=\"items.push('item' + items.length)\">`,\n             generated: 'i0.ɵɵelementStart(0, \"button\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'Add Item', generated: 'i0.ɵɵtext(1, \"Add Item\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'items.push(', generated: 'ctx.items.push(', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n-              {source: `'item'`, generated: `\"item\"`, sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {source: `'item'`, generated: `\"item\"`, sourceUrl: '../test.ts'});\n+          expectMapping(mappings, {\n             source: ' + items.length)',\n             generated: ' + ctx.items.length)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</button>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map a longhand output binding expression', () => {\n           const mappings = compileAndMap('<button on-click=\"doSomething()\">Do it</button>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<button on-click=\"doSomething()\">',\n             generated: 'i0.ɵɵelementStart(0, \"button\", 0)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'Do it', generated: 'i0.ɵɵtext(1, \"Do it\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'doSomething()', generated: 'ctx.doSomething()', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</button>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n         it('should map a two-way binding expression', () => {\n           const mappings = compileAndMap('Name: <input [(ngModel)]=\"name\">');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<input [(ngModel)]=\"name\">',\n             generated: 'i0.ɵɵelementStart(1, \"input\", 0)',\n             sourceUrl: '../test.ts'\n           });\n           // TODO: improve mappings here\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '[(ngModel)]=\"name\"',\n             generated:\n                 'i0.ɵɵlistener(\"ngModelChange\", function TestCmp_Template_input_ngModelChange_1_listener($event) { return ctx.name = $event; })',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<input [(ngModel)]=\"name\">',\n             generated: 'i0.ɵɵelementEnd()',\n             sourceUrl: '../test.ts'\n@@ -224,19 +238,19 @@ runInEachFileSystem((os) => {\n \n         it('should map a longhand two-way binding expression', () => {\n           const mappings = compileAndMap('Name: <input bindon-ngModel=\"name\">');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<input bindon-ngModel=\"name\">',\n             generated: 'i0.ɵɵelementStart(1, \"input\", 0)',\n             sourceUrl: '../test.ts'\n           });\n           // TODO: improve mappings here\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'bindon-ngModel=\"name\"',\n             generated:\n                 'i0.ɵɵlistener(\"ngModelChange\", function TestCmp_Template_input_ngModelChange_1_listener($event) { return ctx.name = $event; })',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<input bindon-ngModel=\"name\">',\n             generated: 'i0.ɵɵelementEnd()',\n             sourceUrl: '../test.ts'\n@@ -245,18 +259,20 @@ runInEachFileSystem((os) => {\n \n         it('should map a class input binding', () => {\n           const mappings = compileAndMap('<div [class.initial]=\"isInitial\">Message</div>');\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div [class.initial]=\"isInitial\">',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts'\n           });\n \n           // TODO: Add better mappings for binding\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: 'Message', generated: 'i0.ɵɵtext(1, \"Message\")', sourceUrl: '../test.ts'});\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n       });\n@@ -265,20 +281,21 @@ runInEachFileSystem((os) => {\n         it('should map *ngIf scenario', () => {\n           const mappings = compileAndMap('<div *ngIf=\"showMessage()\">{{ name }}</div>');\n \n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div *ngIf=\"showMessage()\">',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts'\n           });\n \n           // TODO - map the bindings better\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n \n           // TODO: the `ctx_r...` appears to be dependent upon previous tests!!!\n \n-          // expect(mappings).toContain({\n+          // expectMapping(mappings, {\n           //   source: '{{ name }}',\n           //   generated: 'i0.ɵɵtextInterpolate(ctx_r0.name)',\n           //   sourceUrl: '../test.ts'\n@@ -292,17 +309,19 @@ runInEachFileSystem((os) => {\n               `  <hr>\\n` +\n               `</ng-template>`);\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<div>', generated: 'i0.ɵɵelementStart(0, \"div\")', sourceUrl: '../test.ts'});\n \n           // TODO - map the bindings better\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n \n           // TODO: the `ctx_r...` appears to be dependent upon previous tests!!!\n \n-          // expect(mappings).toContain({\n+          // expectMapping(mappings, {\n           //   source: '{{ name }}',\n           //   generated: 'i0.ɵɵtextInterpolate(ctx_r0.name)',\n           //   sourceUrl: '../test.ts'\n@@ -313,15 +332,16 @@ runInEachFileSystem((os) => {\n           const mappings = compileAndMap(\n               '<div *ngFor=\"let item of items; index as i; trackBy: trackByFn\">{{ item }}</div>');\n \n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div *ngFor=\"let item of items; index as i; trackBy: trackByFn\">',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts'\n           });\n \n           // TODO - map the bindings better\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n \n@@ -339,36 +359,39 @@ runInEachFileSystem((os) => {\n               `<h3><ng-content select=\"title\"></ng-content></h3>\\n` +\n               `<div><ng-content></ng-content></div>`);\n \n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '<h3>', generated: 'i0.ɵɵelementStart(0, \"h3\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<ng-content select=\"title\"></ng-content>',\n             generated: 'i0.ɵɵprojection(1)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n-              {source: '</h3>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings, {source: '</h3>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n+          expectMapping(\n+              mappings,\n               {source: '<div>', generated: 'i0.ɵɵelementStart(2, \"div\")', sourceUrl: '../test.ts'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<ng-content></ng-content>',\n             generated: 'i0.ɵɵprojection(3, 1)',\n             sourceUrl: '../test.ts'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {source: '</div>', generated: 'i0.ɵɵelementEnd()', sourceUrl: '../test.ts'});\n         });\n       });\n \n       describe('$localize', () => {\n         it('should create simple i18n message source-mapping', () => {\n           const mappings = compileAndMap(`<div i18n>Hello, World!</div>`);\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div i18n>',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'Hello, World!',\n             generated: '`Hello, World!`',\n             sourceUrl: '../test.ts',\n@@ -377,27 +400,27 @@ runInEachFileSystem((os) => {\n \n         it('should create placeholder source-mappings', () => {\n           const mappings = compileAndMap(`<div i18n>Hello, {{name}}!</div>`);\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div i18n>',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '</div>',\n             generated: 'i0.ɵɵelementEnd()',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'Hello, ',\n             generated: '`Hello, ${',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '{{name}}',\n             generated: '\"\\\\uFFFD0\\\\uFFFD\"',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '!',\n             generated: '}:INTERPOLATION:!`',\n             sourceUrl: '../test.ts',\n@@ -406,37 +429,37 @@ runInEachFileSystem((os) => {\n \n         it('should create tag (container) placeholder source-mappings', () => {\n           const mappings = compileAndMap(`<div i18n>Hello, <b>World</b>!</div>`);\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<div i18n>',\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '</div>',\n             generated: 'i0.ɵɵelementEnd()',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'Hello, ',\n             generated: '`Hello, ${',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '<b>',\n             generated: '\"\\\\uFFFD#2\\\\uFFFD\"',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: 'World',\n             generated: '}:START_BOLD_TEXT:World${',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '</b>',\n             generated: '\"\\\\uFFFD/#2\\\\uFFFD\"',\n             sourceUrl: '../test.ts',\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             source: '!',\n             generated: '}:CLOSE_BOLD_TEXT:!`',\n             sourceUrl: '../test.ts',\n@@ -448,24 +471,26 @@ runInEachFileSystem((os) => {\n         const mappings = compileAndMap('<div>this is a test</div><div>{{ 1 + 2 }}</div>');\n \n         // Creation mode\n-        expect(mappings).toContain(\n+        expectMapping(\n+            mappings,\n             {generated: 'i0.ɵɵelementStart(0, \"div\")', source: '<div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain({\n+        expectMapping(mappings, {\n           generated: 'i0.ɵɵtext(1, \"this is a test\")',\n           source: 'this is a test',\n           sourceUrl: '../test.ts'\n         });\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings,\n             {generated: 'i0.ɵɵelementStart(2, \"div\")', source: '<div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵtext(3)', source: '{{ 1 + 2 }}', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵtext(3)', source: '{{ 1 + 2 }}', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n \n         // Update mode\n-        expect(mappings).toContain({\n+        expectMapping(mappings, {\n           generated: 'i0.ɵɵtextInterpolate(1 + 2)',\n           source: '{{ 1 + 2 }}',\n           sourceUrl: '../test.ts'\n@@ -476,25 +501,27 @@ runInEachFileSystem((os) => {\n         const mappings = compileAndMap('<div>this is a test</div><div>{{ 1 + 2 }}</div>');\n \n         // Creation mode\n-        expect(mappings).toContain(\n+        expectMapping(\n+            mappings,\n             {generated: 'i0.ɵɵelementStart(0, \"div\")', source: '<div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain({\n+        expectMapping(mappings, {\n           generated: 'i0.ɵɵtext(1, \"this is a test\")',\n           source: 'this is a test',\n           sourceUrl: '../test.ts'\n         });\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings,\n             {generated: 'i0.ɵɵelementStart(2, \"div\")', source: '<div>', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵtext(3)', source: '{{ 1 + 2 }}', sourceUrl: '../test.ts'});\n-        expect(mappings).toContain(\n-            {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵtext(3)', source: '{{ 1 + 2 }}', sourceUrl: '../test.ts'});\n+        expectMapping(\n+            mappings, {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../test.ts'});\n \n         // TODO(benlesh): We need to circle back and prevent the extra parens from being generated.\n         // Update mode\n-        expect(mappings).toContain({\n+        expectMapping(mappings, {\n           generated: 'i0.ɵɵtextInterpolate(1 + 2)',\n           source: '{{ 1 + 2 }}',\n           sourceUrl: '../test.ts'\n@@ -506,7 +533,7 @@ runInEachFileSystem((os) => {\n            // Note that the escaped double quotes, which need un-escaping to be parsed correctly.\n            const mappings = compileAndMap('<div class=\\\\\"some-class\\\\\">this is a test</div>');\n \n-           expect(mappings).toContain({\n+           expectMapping(mappings, {\n              generated: 'i0.ɵɵelementStart(0, \"div\", 0)',\n              source: '<div class=\\\\\"some-class\\\\\">',\n              sourceUrl: '../test.ts'\n@@ -525,30 +552,33 @@ runInEachFileSystem((os) => {\n               compileAndMap('<div>this is a test</div><div>{{ 1 + 2 }}</div>', './dir/test.html');\n \n           // Creation mode\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             source: '<div>',\n             sourceUrl: '../dir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵtext(1, \"this is a test\")',\n             source: 'this is a test',\n             sourceUrl: '../dir/test.html'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../dir/test.html'});\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementStart(2, \"div\")',\n             source: '<div>',\n             sourceUrl: '../dir/test.html'\n           });\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {generated: 'i0.ɵɵtext(3)', source: '{{ 1 + 2 }}', sourceUrl: '../dir/test.html'});\n-          expect(mappings).toContain(\n+          expectMapping(\n+              mappings,\n               {generated: 'i0.ɵɵelementEnd()', source: '</div>', sourceUrl: '../dir/test.html'});\n \n           // Update mode\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵtextInterpolate(1 + 2)',\n             source: '{{ 1 + 2 }}',\n             sourceUrl: '../dir/test.html'\n@@ -560,39 +590,39 @@ runInEachFileSystem((os) => {\n               '<div>this is a test</div><div>{{ 1 + 2 }}</div>', 'extraRootDir/test.html');\n \n           // Creation mode\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementStart(0, \"div\")',\n             source: '<div>',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵtext(1, \"this is a test\")',\n             source: 'this is a test',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementEnd()',\n             source: '</div>',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementStart(2, \"div\")',\n             source: '<div>',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵtext(3)',\n             source: '{{ 1 + 2 }}',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵelementEnd()',\n             source: '</div>',\n             sourceUrl: '../extraRootDir/test.html'\n           });\n \n           // Update mode\n-          expect(mappings).toContain({\n+          expectMapping(mappings, {\n             generated: 'i0.ɵɵtextInterpolate(1 + 2)',\n             source: '{{ 1 + 2 }}',\n             sourceUrl: '../extraRootDir/test.html'\n@@ -638,5 +668,42 @@ runInEachFileSystem((os) => {\n         return value + padding;\n       }\n     }\n+\n+    function expectMapping(mappings: SegmentMapping[], expected: SegmentMapping): void {\n+      if (mappings.some(\n+              m => m.generated === expected.generated && m.source === expected.source &&\n+                  m.sourceUrl === expected.sourceUrl)) {\n+        return;\n+      }\n+      const matchingGenerated = mappings.filter(m => m.generated === expected.generated);\n+      const matchingSource = mappings.filter(m => m.source === expected.source);\n+\n+      const message = [\n+        'Expected mappings to contain the following mapping',\n+        prettyPrintMapping(expected),\n+      ];\n+      if (matchingGenerated.length > 0) {\n+        message.push('');\n+        message.push('There are the following mappings that match the generated text:');\n+        matchingGenerated.forEach(m => message.push(prettyPrintMapping(m)));\n+      }\n+      if (matchingSource.length > 0) {\n+        message.push('');\n+        message.push('There are the following mappings that match the source text:');\n+        matchingSource.forEach(m => message.push(prettyPrintMapping(m)));\n+      }\n+\n+      fail(message.join('\\n'));\n+    }\n+\n+    function prettyPrintMapping(mapping: SegmentMapping): string {\n+      return [\n+        '{',\n+        `  generated: ${JSON.stringify(mapping.generated)}`,\n+        `  source:    ${JSON.stringify(mapping.source)}`,\n+        `  sourceUrl: ${JSON.stringify(mapping.sourceUrl)}`,\n+        '}',\n+      ].join('\\n');\n+    }\n   });\n });"
        }
    ],
    "stats": {
        "total": 291,
        "additions": 179,
        "deletions": 112
    }
}