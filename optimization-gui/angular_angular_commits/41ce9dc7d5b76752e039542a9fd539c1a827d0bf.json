{
    "author": "AleksanderBodurri",
    "message": "build(devtools): set up bazel and bazel tooling\n\nMarks the beginning of a migration over to building Angular devtools with Bazel. This commit brings in tooling from the canonical angular bazel example repository and includes the necessary dependencies in the package.json",
    "sha": "41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
    "files": [
        {
            "sha": "25ad38ec1cc808004eb0871bc76b1c120029091a",
            "filename": ".bazelignore",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelignore",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelignore",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelignore?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,16 @@\n+# NB: sematics here are not the same as .gitignore\n+# see https://github.com/bazelbuild/bazel/issues/8106\n+.git\n+bazel-out\n+\n+# **/symlinked_node_modules_yarn\n+node_modules\n+e2e/symlinked_node_modules_yarn/node_modules\n+e2e/symlinked_node_modules_npm/node_modules\n+packages/angular/node_modules\n+examples/angular/node_modules\n+examples/user_managed_deps/node_modules\n+\n+# **/dist\n+dist\n+examples/user_managed_deps/dist"
        },
        {
            "sha": "35951c635760efbd82c0c7931697c32c43dcb383",
            "filename": ".bazelrc",
            "status": "added",
            "additions": 92,
            "deletions": 0,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelrc?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,92 @@\n+# Common Bazel settings for JavaScript/NodeJS workspaces\n+# This rc file is automatically discovered when Bazel is run in this workspace,\n+# see https://docs.bazel.build/versions/master/guide.html#bazelrc\n+#\n+# The full list of Bazel options: https://docs.bazel.build/versions/master/command-line-reference.html\n+\n+# Cache action outputs on disk so they persist across output_base and bazel shutdown (eg. changing branches)\n+build --disk_cache=~/.cache/bazel-disk-cache\n+\n+# Bazel picks up host-OS-specific config lines from bazelrc files\n+build --enable_platform_specific_config\n+\n+# Bazel will create symlinks from the workspace directory to output artifacts.\n+# Build results will be placed in a directory called \"dist/bin\"\n+# Other directories will be created like \"dist/testlogs\"\n+# Be aware that this will still create a bazel-out symlink in\n+# your project directory, which you must exclude from version control and your\n+# editor's search path.\n+build --symlink_prefix=dist/\n+# To disable the symlinks altogether (including bazel-out) you can use\n+# build --symlink_prefix=/\n+# however this makes it harder to find outputs.\n+\n+# Specifies desired output mode for running tests.\n+# Valid values are\n+#   'summary' to output only test status summary\n+#   'errors' to also print test logs for failed tests\n+#   'all' to print logs for all tests\n+#   'streamed' to output logs for all tests in real time\n+#     (this will force tests to be executed locally one at a time regardless of --test_strategy value).\n+test --test_output=errors\n+\n+# Support for debugging NodeJS tests\n+# Add the Bazel option `--config=debug` to enable this\n+# --test_output=streamed\n+#     Stream stdout/stderr output from each test in real-time.\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_output for more details.\n+# --test_strategy=exclusive\n+#     Run one test at a time.\n+# --test_timeout=9999\n+#     Prevent long running tests from timing out\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_timeout for more details.\n+# --nocache_test_results\n+#     Always run tests\n+# --node_options=--inspect-brk\n+#     Pass the --inspect-brk option to all tests which enables the node inspector agent.\n+#     See https://nodejs.org/de/docs/guides/debugging-getting-started/#command-line-options for more details.\n+# --define=VERBOSE_LOGS=1\n+#     Rules will output verbose logs if the VERBOSE_LOGS environment variable is set. `VERBOSE_LOGS` will be passed to\n+#     `nodejs_binary` and `nodejs_test` via the default value of the `default_env_vars` attribute of those rules.\n+# --compilation_mode=dbg\n+#     Rules may change their build outputs if the compilation mode is set to dbg. For example,\n+#     mininfiers such as terser may make their output more human readable when this is set. Rules will pass `COMPILATION_MODE`\n+#     to `nodejs_binary` executables via the actions.run env attribute.\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--compilation_mode for more details.\n+test:debug --test_output=streamed --test_strategy=exclusive --test_timeout=9999 --nocache_test_results --define=VERBOSE_LOGS=1\n+# Use bazel run with `--config=debug` to turn on the NodeJS inspector agent.\n+# The node process will break before user code starts and wait for the debugger to connect.\n+run:debug --define=VERBOSE_LOGS=1 -- --node_options=--inspect-brk\n+# The following option will change the build output of certain rules such as terser and may not be desirable in all cases\n+build:debug --compilation_mode=dbg\n+\n+# Turn off legacy external runfiles\n+# This prevents accidentally depending on this feature, which Bazel will remove.\n+build --nolegacy_external_runfiles\n+\n+# Turn on --incompatible_strict_action_env which was on by default\n+# in Bazel 0.21.0 but turned off again in 0.22.0. Follow\n+# https://github.com/bazelbuild/bazel/issues/7026 for more details.\n+# This flag is needed to so that the bazel cache is not invalidated\n+# when running bazel via `yarn bazel`.\n+# See https://github.com/angular/angular/issues/27514.\n+build --incompatible_strict_action_env\n+run --incompatible_strict_action_env\n+\n+# When running `bazel coverage` --instrument_test_targets needs to be set in order to \n+# collect coverage information from test targets\n+coverage --instrument_test_targets\n+\n+# Load any settings specific to the current user.\n+# .bazelrc.user should appear in .gitignore so that settings are not shared with team members\n+# This needs to be last statement in this\n+# config, as the user configuration should be able to overwrite flags from this file.\n+# See https://docs.bazel.build/versions/master/best-practices.html#bazelrc\n+# (Note that we use .bazelrc.user so the file appears next to .bazelrc in directory listing,\n+# rather than user.bazelrc as suggested in the Bazel docs)\n+try-import %workspace%/.bazelrc.user\n+\n+\n+# Use the Angular Ivy compiler\n+# See https://github.com/angular/angular/blob/master/docs/BAZEL.md#various-flags-used-for-tests\n+build --define=angular_ivy_enabled=True"
        },
        {
            "sha": "fcdb2e109f68cff5600955a73908885fe8599bb4",
            "filename": ".bazelversion",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelversion",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.bazelversion",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelversion?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1 @@\n+4.0.0"
        },
        {
            "sha": "dafc7f9c2eb8e07c5acba5eb5e73bc062e44f2cb",
            "filename": ".gitignore",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.gitignore",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/.gitignore",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.gitignore?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -48,3 +48,8 @@ Thumbs.db\n **/coverage/*\n \n .angular\n+\n+bazel-angular-devtools\n+bazel-bin\n+bazel-out/*\n+bazel-testlogs"
        },
        {
            "sha": "bffcb3f2191853a7027e677941853b36de192430",
            "filename": "BUILD.bazel",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/BUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/BUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/BUILD.bazel?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,3 @@\n+package(default_visibility = [\"//:__subpackages__\"])\n+\n+exports_files([\"tsconfig.json\", \"cypress.json\"])"
        },
        {
            "sha": "7794375486b4b4a526e1631be91006fad351185f",
            "filename": "WORKSPACE",
            "status": "added",
            "additions": 86,
            "deletions": 0,
            "changes": 86,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/WORKSPACE",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/WORKSPACE",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/WORKSPACE?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,86 @@\n+# The WORKSPACE file tells Bazel that this directory is a \"workspace\", which is like a project root.\n+# The content of this file specifies all the external dependencies Bazel needs to perform a build.\n+\n+####################################\n+# ESModule imports (and TypeScript imports) can be absolute starting with the workspace name.\n+# The name of the workspace should match the npm package where we publish, so that these\n+# imports also make sense when referencing the published package.\n+workspace(\n+    name = \"angular_devtools\",\n+    managed_directories = {\"@npm\": [\"node_modules\"]},\n+)\n+# These rules are built-into Bazel but we need to load them first to download more rules\n+load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\")\n+\n+http_archive(\n+    name = \"bazel_skylib\",\n+    sha256 = \"1c531376ac7e5a180e0237938a2536de0c54d93f5c278634818e0efc952dd56c\",\n+    urls = [\n+        \"https://github.com/bazelbuild/bazel-skylib/releases/download/1.0.3/bazel-skylib-1.0.3.tar.gz\",\n+        \"https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/1.0.3/bazel-skylib-1.0.3.tar.gz\",\n+    ],\n+)\n+\n+load(\"@bazel_skylib//:workspace.bzl\", \"bazel_skylib_workspace\")\n+\n+bazel_skylib_workspace()\n+\n+# Fetch rules_nodejs so we can install our npm dependencies\n+http_archive(\n+    name = \"build_bazel_rules_nodejs\",\n+    sha256 = \"8f5f192ba02319254aaf2cdcca00ec12eaafeb979a80a1e946773c520ae0a2c9\",\n+    urls = [\"https://github.com/bazelbuild/rules_nodejs/releases/download/3.7.0/rules_nodejs-3.7.0.tar.gz\"],\n+)\n+\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"node_repositories\")\n+\n+# Setup the Node.js toolchain\n+node_repositories(\n+    node_version = \"14.16.1\",\n+    package_json = [\"//:package.json\"],\n+)\n+\n+# Fetch sass rules for compiling sass files\n+http_archive(\n+    name = \"io_bazel_rules_sass\",\n+    sha256 = \"dcead3cbe749d8e9467d28e326ea8ea3a126bc6095a0e1665222c94ff9db6fcc\",\n+    strip_prefix = \"rules_sass-1.36.0\",\n+    urls = [\n+        \"https://github.com/bazelbuild/rules_sass/archive/1.36.0.zip\",\n+        \"https://mirror.bazel.build/github.com/bazelbuild/rules_sass/archive/1.36.0.zip\",\n+    ],\n+)\n+\n+# Check the bazel version and download npm dependencies\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"yarn_install\")\n+\n+# Setup the Node.js toolchain & install our npm dependencies into @npm\n+yarn_install(\n+    name = \"npm\",\n+    package_json = \"//:package.json\",\n+    yarn_lock = \"//:yarn.lock\",\n+)\n+\n+# Load karma_web_test dependencies\n+http_archive(\n+    name = \"io_bazel_rules_webtesting\",\n+    sha256 = \"9bb461d5ef08e850025480bab185fd269242d4e533bca75bfb748001ceb343c3\",\n+    urls = [\"https://github.com/bazelbuild/rules_webtesting/releases/download/0.3.3/rules_webtesting.tar.gz\"],\n+)\n+\n+# Setup the rules_webtesting toolchain\n+load(\"@io_bazel_rules_webtesting//web:repositories.bzl\", \"web_test_repositories\")\n+\n+web_test_repositories()\n+\n+load(\"@io_bazel_rules_webtesting//web/versioned:browsers-0.3.2.bzl\", \"browser_repositories\")\n+\n+browser_repositories(\n+    chromium = True,\n+    firefox = True,\n+)\n+\n+# Setup the rules_sass toolchain\n+load(\"@io_bazel_rules_sass//sass:sass_repositories.bzl\", \"sass_repositories\")\n+\n+sass_repositories()"
        },
        {
            "sha": "79bacca266354ec39d0c859be048aefa15987b45",
            "filename": "angular.json",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/angular.json",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/angular.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/angular.json?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -18,7 +18,7 @@\n           \"builder\": \"ngx-build-plus:browser\",\n           \"options\": {\n             \"outputPath\": \"dist/shell-dev\",\n-            \"index\": \"src/index.html\",\n+            \"index\": \"src/_index.html\",\n             \"main\": \"src/main.ts\",\n             \"polyfills\": \"src/polyfills.ts\",\n             \"tsConfig\": \"tsconfig.app.json\",\n@@ -73,6 +73,10 @@\n                 {\n                   \"replace\": \"src/environments/environment.ts\",\n                   \"with\": \"src/environments/environment.e2e.ts\"\n+                },\n+                {\n+                  \"replace\": \"src/app/app.module.ts\",\n+                  \"with\": \"src/app/app.e2e.module.ts\"\n                 }\n               ]\n             }\n@@ -414,7 +418,7 @@\n           \"builder\": \"@angular-devkit/build-angular:browser\",\n           \"options\": {\n             \"outputPath\": \"dist/demo-no-zone\",\n-            \"index\": \"projects/demo-no-zone/src/index.html\",\n+            \"index\": \"projects/demo-no-zone/src/_index.html\",\n             \"main\": \"projects/demo-no-zone/src/main.ts\",\n             \"polyfills\": \"projects/demo-no-zone/src/polyfills.ts\",\n             \"tsConfig\": \"projects/demo-no-zone/tsconfig.app.json\","
        },
        {
            "sha": "2718799fda7dbff88c460dd66b5b78de91d9efe0",
            "filename": "common.bazelrc",
            "status": "added",
            "additions": 87,
            "deletions": 0,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/common.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/common.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/common.bazelrc?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,87 @@\n+# Common Bazel settings for JavaScript/NodeJS workspaces\n+# This rc file is automatically discovered when Bazel is run in this workspace,\n+# see https://docs.bazel.build/versions/master/guide.html#bazelrc\n+#\n+# The full list of Bazel options: https://docs.bazel.build/versions/master/command-line-reference.html\n+\n+# Cache action outputs on disk so they persist across output_base and bazel shutdown (eg. changing branches)\n+build --disk_cache=~/.cache/bazel-disk-cache\n+\n+# Bazel picks up host-OS-specific config lines from bazelrc files\n+build --enable_platform_specific_config\n+\n+# Bazel will create symlinks from the workspace directory to output artifacts.\n+# Build results will be placed in a directory called \"dist/bin\"\n+# Other directories will be created like \"dist/testlogs\"\n+# Be aware that this will still create a bazel-out symlink in\n+# your project directory, which you must exclude from version control and your\n+# editor's search path.\n+build --symlink_prefix=dist/\n+# To disable the symlinks altogether (including bazel-out) you can use\n+# build --symlink_prefix=/\n+# however this makes it harder to find outputs.\n+\n+# Specifies desired output mode for running tests.\n+# Valid values are\n+#   'summary' to output only test status summary\n+#   'errors' to also print test logs for failed tests\n+#   'all' to print logs for all tests\n+#   'streamed' to output logs for all tests in real time\n+#     (this will force tests to be executed locally one at a time regardless of --test_strategy value).\n+test --test_output=errors\n+\n+# Support for debugging NodeJS tests\n+# Add the Bazel option `--config=debug` to enable this\n+# --test_output=streamed\n+#     Stream stdout/stderr output from each test in real-time.\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_output for more details.\n+# --test_strategy=exclusive\n+#     Run one test at a time.\n+# --test_timeout=9999\n+#     Prevent long running tests from timing out\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--test_timeout for more details.\n+# --nocache_test_results\n+#     Always run tests\n+# --node_options=--inspect-brk\n+#     Pass the --inspect-brk option to all tests which enables the node inspector agent.\n+#     See https://nodejs.org/de/docs/guides/debugging-getting-started/#command-line-options for more details.\n+# --define=VERBOSE_LOGS=1\n+#     Rules will output verbose logs if the VERBOSE_LOGS environment variable is set. `VERBOSE_LOGS` will be passed to\n+#     `nodejs_binary` and `nodejs_test` via the default value of the `default_env_vars` attribute of those rules.\n+# --compilation_mode=dbg\n+#     Rules may change their build outputs if the compilation mode is set to dbg. For example,\n+#     mininfiers such as terser may make their output more human readable when this is set. Rules will pass `COMPILATION_MODE`\n+#     to `nodejs_binary` executables via the actions.run env attribute.\n+#     See https://docs.bazel.build/versions/master/user-manual.html#flag--compilation_mode for more details.\n+test:debug --test_output=streamed --test_strategy=exclusive --test_timeout=9999 --nocache_test_results --define=VERBOSE_LOGS=1\n+# Use bazel run with `--config=debug` to turn on the NodeJS inspector agent.\n+# The node process will break before user code starts and wait for the debugger to connect.\n+run:debug --define=VERBOSE_LOGS=1 -- --node_options=--inspect-brk\n+# The following option will change the build output of certain rules such as terser and may not be desirable in all cases\n+build:debug --compilation_mode=dbg\n+\n+# Turn off legacy external runfiles\n+# This prevents accidentally depending on this feature, which Bazel will remove.\n+build --nolegacy_external_runfiles\n+\n+# Turn on --incompatible_strict_action_env which was on by default\n+# in Bazel 0.21.0 but turned off again in 0.22.0. Follow\n+# https://github.com/bazelbuild/bazel/issues/7026 for more details.\n+# This flag is needed to so that the bazel cache is not invalidated\n+# when running bazel via `yarn bazel`.\n+# See https://github.com/angular/angular/issues/27514.\n+build --incompatible_strict_action_env\n+run --incompatible_strict_action_env\n+\n+# When running `bazel coverage` --instrument_test_targets needs to be set in order to \n+# collect coverage information from test targets\n+coverage --instrument_test_targets\n+\n+# Load any settings specific to the current user.\n+# .bazelrc.user should appear in .gitignore so that settings are not shared with team members\n+# This needs to be last statement in this\n+# config, as the user configuration should be able to overwrite flags from this file.\n+# See https://docs.bazel.build/versions/master/best-practices.html#bazelrc\n+# (Note that we use .bazelrc.user so the file appears next to .bazelrc in directory listing,\n+# rather than user.bazelrc as suggested in the Bazel docs)\n+try-import %workspace%/.bazelrc.user"
        },
        {
            "sha": "6a677c22b2a24a11ab8535849e3acd04f6d54d25",
            "filename": "package.json",
            "status": "modified",
            "additions": 33,
            "deletions": 16,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/package.json",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -2,13 +2,14 @@\n   \"name\": \"angular-devtools\",\n   \"version\": \"0.0.0\",\n   \"scripts\": {\n-    \"postinstall\": \"ngcc --async false --properties es2015 browser module main --first-only --create-ivy-entry-points\",\n+    \"postinstall\": \"ngcc\",\n     \"ng\": \"ng\",\n     \"cypress:verify\": \"cypress verify\",\n-    \"start\": \"cross-env LATEST_SHA=`git rev-parse --short HEAD` ng serve\",\n-    \"start-no-animations\": \"yarn start --configuration=e2e\",\n+    \"start\": \"ibazel run src:devserver\",\n+    \"start-no-animations\": \"bazel run src:devserver-e2e\",\n     \"build\": \"ng build\",\n-    \"build:chrome\": \"cross-env LATEST_SHA=`git rev-parse --short HEAD` ng build shell-chrome\",\n+    \"build:chrome\": \"bazel build projects/shell-chrome/src:prodapp\",\n+    \"build:chrome:watch\": \"ibazel build projects/shell-chrome/src:prodapp\",\n     \"release\": \"node projects/shell-chrome/set-version.js && cross-env LATEST_SHA=`git rev-parse --short HEAD` ng build shell-chrome --configuration production\",\n     \"test\": \"ng test\",\n     \"lint\": \"tslint -p tsconfig.json -c tslint.json\",\n@@ -20,13 +21,10 @@\n     \"cy:open\": \"$(yarn bin)/cypress open\",\n     \"cy:ci\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:run\",\n     \"cy:watch\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:open\",\n-    \"test:backend\": \"ng test ng-devtools-backend --watch=false\",\n-    \"test:devtools\": \"ng test ng-devtools --watch=false\",\n-    \"test:shared-utils\": \"ng test shared-utils --watch=false\",\n-    \"test:protocol\": \"ng test protocol --watch=false\",\n-    \"test:ci\": \"npm run test:backend && npm run test:devtools && npm run test:shared-utils && npm run test:protocol\",\n+    \"test:ci\": \"bazel test projects/shared-utils/... projects/protocol/... projects/ng-devtools/... projects/ng-devtools-backend/...\",\n     \"prettier\": \"prettier --write \\\"{,!(node_modules|dist|build|coverage)/**/}*.{js,jsx,ts,tsx,json}\\\"\",\n-    \"prettier:fix\": \"pretty-quick --staged\"\n+    \"prettier:fix\": \"pretty-quick --staged\",\n+    \"bazel:build\": \"yarn bazel:build:protocol && yarn bazel:build:ng-devtools-backend && yarn bazel:build:shared-utils && yarn bazel:build:ng-devtools\"\n   },\n   \"husky\": {\n     \"hooks\": {\n@@ -44,12 +42,15 @@\n     \"@angular/material\": \"~12.2.0\",\n     \"@angular/platform-browser\": \"github:angular/platform-browser-builds#7f38db5e7693cd7a1e76c0f21978eb44b89b799f\",\n     \"@angular/platform-browser-dynamic\": \"github:angular/platform-browser-dynamic-builds#9e478221d7065200684a1eece31b99d287674da8\",\n+    \"@types/node\": \"^16.7.1\",\n+    \"ajv-formats\": \"^2.1.1\",\n     \"d3\": \"^5.7.0\",\n     \"memo-decorator\": \"^2.0.1\",\n     \"ngx-flamegraph\": \"0.0.10\",\n+    \"puppeteer\": \"^10.2.0\",\n     \"rxjs\": \"~6.6.0\",\n     \"semver-dsl\": \"^1.0.1\",\n-    \"tslib\": \"^2.0.0\",\n+    \"tslib\": \"^2.3.0\",\n     \"webtreemap\": \"^2.0.1\",\n     \"zone.js\": \"~0.11.0\"\n   },\n@@ -63,6 +64,16 @@\n     \"@angular/router\": \"github:angular/router-builds#5485647d9f68a01041285dfa0b92d841d7fa8c0f\",\n     \"@bahmutov/add-typescript-to-cypress\": \"^2.1.2\",\n     \"@types/chrome\": \"^0.0.159\",\n+    \"@bazel/angular\": \"^3.7.0\",\n+    \"@bazel/bazelisk\": \"^1.7.5\",\n+    \"@bazel/concatjs\": \"^3.7.0\",\n+    \"@bazel/ibazel\": \"^0.15.10\",\n+    \"@bazel/rollup\": \"^3.7.0\",\n+    \"@bazel/terser\": \"^3.7.0\",\n+    \"@bazel/typescript\": \"^3.7.0\",\n+    \"@rollup/plugin-commonjs\": \"18.0.0\",\n+    \"@rollup/plugin-json\": \"4.1.0\",\n+    \"@rollup/plugin-node-resolve\": \"8.4.0\",\n     \"@types/clone-deep\": \"^4.0.1\",\n     \"@types/filesystem\": \"^0.0.32\",\n     \"@types/jasmine\": \"~3.9.0\",\n@@ -75,19 +86,25 @@\n     \"cypress-browser-extension-plugin\": \"^0.1.0\",\n     \"cypress-iframe\": \"^1.0.1\",\n     \"document-register-element\": \"^1.7.2\",\n+    \"html-insert-assets\": \"^0.14.2\",\n     \"husky\": \"^4.3.8\",\n     \"jasmine-core\": \"~3.10.0\",\n     \"jasmine-spec-reporter\": \"~7.0.0\",\n-    \"karma\": \"~6.3.2\",\n-    \"karma-chrome-launcher\": \"~3.1.0\",\n-    \"karma-coverage\": \"~2.0.3\",\n-    \"karma-jasmine\": \"~4.0.0\",\n-    \"karma-jasmine-html-reporter\": \"^1.4.2\",\n+    \"karma\": \"~4.1.0\",\n+    \"karma-chrome-launcher\": \"2.2.0\",\n+    \"karma-firefox-launcher\": \"1.1.0\",\n+    \"karma-jasmine\": \"2.0.1\",\n+    \"karma-junit-reporter\": \"2.0.1\",\n+    \"karma-requirejs\": \"1.1.0\",\n+    \"karma-sourcemap-loader\": \"0.3.7\",\n     \"ng-packagr\": \"^12.0.0\",\n     \"ngx-build-plus\": \"^11.0.0\",\n     \"prettier\": \"^2.0.0\",\n     \"pretty-quick\": \"^3.0.0\",\n     \"protractor\": \"~7.0.0\",\n+    \"requirejs\": \"2.3.6\",\n+    \"rollup\": \"2.44.0\",\n+    \"rollup-plugin-amd\": \"4.0.0\",\n     \"start-server-and-test\": \"^1.10.11\",\n     \"todomvc-app-css\": \"^2.3.0\",\n     \"todomvc-common\": \"^1.0.5\","
        },
        {
            "sha": "43fc2cdc90ab0b5156d1cf9746398b917d9d3b2e",
            "filename": "tools/BUILD.bazel",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2FBUILD.bazel?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,17 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n+\n+# Custom ts_library compiler that runs tsc_wrapped with angular/compiler-cli statically linked\n+# This can be used with worker mode because we don't need the linker at runtime to make\n+# the angular plugin loadable\n+# Just a clone of @npm//@bazel/typescript/bin:tsc_wrapped with added deps\n+nodejs_binary(\n+    name = \"tsc_wrapped_with_angular\",\n+    data = [\n+        \"@npm//@angular/compiler-cli\",\n+        \"@npm//@bazel/typescript\",\n+    ],\n+    entry_point = \"@npm//:node_modules/@bazel/typescript/internal/tsc_wrapped/tsc_wrapped.js\",\n+    # TODO: turn on --worker_sandboxing and remove this flag to see failure to load the plugin\n+    templated_args = [\"--bazel_patch_module_resolver\"],\n+    visibility = [\"//:__subpackages__\"],\n+)"
        },
        {
            "sha": "080758fc951bc45363271ff8bf976f0ab0d7b53f",
            "filename": "tools/angular_prerender.bzl",
            "status": "added",
            "additions": 117,
            "deletions": 0,
            "changes": 117,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fangular_prerender.bzl",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fangular_prerender.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular_prerender.bzl?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,117 @@\n+\"\"\"Helper macros for rendering parts of an Angular application at build time\"\"\"\n+\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", _nodejs_binary = \"nodejs_binary\", _nodejs_test = \"nodejs_test\")\n+load(\"@npm//@bazel/typescript:index.bzl\", _ts_library = \"ts_library\")\n+\n+def _get_output_path(route, root_at):\n+    return root_at + \"/\" + route + \"/index.html\"\n+\n+def ng_prerender(name, index, prerender_roots = [], **kwargs):\n+    \"\"\"\n+    Helper macro for prerendering Angular routes to index files as part of the build\n+\n+    The outputs of this macro are:\n+        %name% - all the rendered roots, plus the root route /\n+        %name%.root - an alias referencing just the root index file\n+        %name%.%route% - an alias referencing each rendered route, with / replaced by underscores\n+\n+    Args:\n+        name: Rule name for the main output genrule\n+        index: Label for the production index.html file with which to render into\n+        prerender_roots: A list of roots that will be prerendered as part of this macro, the root route / is always rendered\n+    \"\"\"\n+\n+    renderer_lib = \"%s_renderer_lib\" % name\n+    _ts_library(\n+        name = renderer_lib,\n+        srcs = [\"//src:prerender.ts\"],\n+        deps = [\n+            \"//src/app:app_server\",\n+            \"@npm//@angular/platform-server\",\n+            \"@npm//zone.js\",\n+            \"@npm//domino\",\n+            \"@npm//reflect-metadata\",\n+            \"@npm//@types/node\",\n+        ],\n+    )\n+\n+    bin = \"%s_bin\" % renderer_lib\n+    _nodejs_binary(\n+        name = bin,\n+        data = [\n+            \":%s\" % renderer_lib,\n+            \"@npm//@angular/platform-server\",\n+            \"@npm//zone.js\",\n+            \"@npm//domino\",\n+            \"@npm//reflect-metadata\",\n+        ],\n+        entry_point = \"//src:prerender.ts\",\n+        templated_args = [\"--nobazel_run_linker\"],\n+    )\n+\n+    root_at = \"_prerender/\" + native.package_name()\n+\n+    # we can't output \"foo/index.html\" since that collides with source files and will likely cross a package boundary\n+    # so we output \"_prerender/pkg_name/route/index.html\"\n+    prerender_root_outs = [_get_output_path(route, root_at) for route in prerender_roots]\n+    root_index = \"%s/index.html\" % root_at\n+\n+    visibility = kwargs.pop(\"visibility\", [])\n+\n+    native.genrule(\n+        name = name,\n+        srcs = [index],\n+        outs = [root_index] + prerender_root_outs,\n+        cmd = \"$(location :%s) --index $(location %s) --outs $(OUTS) --routes / %s\" % (bin, index, \" \".join(prerender_roots)),\n+        tools = [\":%s\" % bin],\n+        message = \"Prerendering Angular\",\n+        visibility = visibility,\n+        tags = kwargs.pop(\"tags\", []),\n+    )\n+\n+    # convenience \"output groups\" from macro\n+    native.alias(\n+        name = \"%s.root\" % name,\n+        actual = root_index,\n+        visibility = visibility,\n+    )\n+\n+    [\n+        native.alias(\n+            name = \"%s.%s\" % (name, route.replace(\"/\", \"_\")),\n+            actual = _get_output_path(route, root_at),\n+            visibility = visibility,\n+        )\n+        for route in prerender_roots\n+    ]\n+\n+def ng_prerender_test(name, index, route, expected_elements = [], **kwargs):\n+    \"\"\"\n+    Simple smoke test for a prerendered index file, as generated by ng_prerender\n+\n+    Args:\n+        name: Rule name for the test\n+        index: Label of the index file under test\n+        route: The route that this index file belongs to\n+        expected_elements: An optional array of expected elements that should appear in the index file\n+    \"\"\"\n+\n+    _ts_library(\n+        name = \"%s_render_spec\" % name,\n+        srcs = [\"//src:prerender-spec.ts\"],\n+        deps = [\n+            \"@npm//@types/node\",\n+        ],\n+        testonly = 1,\n+    )\n+\n+    _nodejs_test(\n+        name = name,\n+        data = [\n+            \":%s_render_spec\" % name,\n+            index,\n+        ],\n+        templated_args = [\"--index $(location %s)\" % index, \"--route %s\" % route, \"--expected %s\" % (\" \".join(expected_elements))],\n+        entry_point = \"//src:prerender-spec.ts\",\n+        tags = kwargs.pop(\"tags\", []),\n+    )"
        },
        {
            "sha": "c17dc40c0d50ed5f695d4309abecbb1e6662b4e4",
            "filename": "tools/angular_ts_library.bzl",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fangular_ts_library.bzl",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fangular_ts_library.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fangular_ts_library.bzl?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,11 @@\n+\"Shows how to enable both worker mode and use_angular_plugin to make a drop-in replacement for ng_module\"\n+\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+\n+def ng_ts_library(**kwargs):\n+    ts_library(\n+        compiler = \"//tools:tsc_wrapped_with_angular\",\n+        supports_workers = True,\n+        use_angular_plugin = True,\n+        **kwargs\n+    )"
        },
        {
            "sha": "d63569b0de2f071590e1cffb475d4a14ee70dd8e",
            "filename": "tools/ngsw_config.bzl",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fngsw_config.bzl",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tools%2Fngsw_config.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fngsw_config.bzl?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -0,0 +1,38 @@\n+\"Angular service worker support (credits: https://github.com/marcus-sa)\"\n+\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n+\n+def ngsw_config(name, config, index_html, src, out = None, **kwargs):\n+    \"Creates ngsw.json with service worker configuration and hashes for all source files\"\n+    if not out:\n+        out = name\n+\n+    ngsw_config_name = \"%s_bin\" % name\n+\n+    nodejs_binary(\n+        name = ngsw_config_name,\n+        data = [\"@npm//@angular/service-worker\", index_html, config, src],\n+        visibility = [\"//visibility:private\"],\n+        entry_point = \"@npm//:node_modules/@angular/service-worker/ngsw-config.js\",\n+    )\n+\n+    cmd = \"\"\"\n+mkdir -p $@\n+cp -R $(locations {TMPL_src})/. $@/\n+cp $(location {TMPL_index}) $@/index.html\n+$(location :{TMPL_bin}) $@ $(location {TMPL_conf})\n+    \"\"\".format(\n+        TMPL_src = src,\n+        TMPL_bin = ngsw_config_name,\n+        TMPL_index = index_html,\n+        TMPL_conf = config,\n+    )\n+\n+    native.genrule(\n+        name = name,\n+        outs = [out],\n+        srcs = [src, config, index_html],\n+        tools = [\":\" + ngsw_config_name],\n+        cmd = cmd,\n+        **kwargs\n+    )"
        },
        {
            "sha": "46255173cb71105d2e4ac4ec175d1acb6b54faef",
            "filename": "tsconfig.json",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/tsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tsconfig.json?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf",
            "patch": "@@ -1,6 +1,12 @@\n {\n   \"compileOnSave\": false,\n   \"compilerOptions\": {\n+    \"plugins\": [\n+      {\n+        \"name\": \"@bazel/tsetse\",\n+        \"disabledRules\": [\"must-type-assert-json-parse\"]\n+      }\n+    ],\n     \"baseUrl\": \"./\",\n     \"outDir\": \"./dist\",\n     \"sourceMap\": true,\n@@ -16,14 +22,15 @@\n     \"typeRoots\": [\"node_modules/@types\"],\n     \"lib\": [\"es2018\", \"dom\"],\n     \"paths\": {\n-      \"ng-devtools\": [\"projects/ng-devtools/src/public-api.ts\"],\n-      \"ng-devtools-backend\": [\"projects/ng-devtools-backend/src/public-api.ts\"],\n-      \"protocol\": [\"projects/protocol/src/public-api.ts\"],\n-      \"shared-utils\": [\"projects/shared-utils/src/public-api.ts\"]\n+      \"ng-devtools\": [\"projects/ng-devtools/src/public-api.ts\", \"dist/ng-devtools\"],\n+      \"ng-devtools-backend\": [\"projects/ng-devtools-backend/src/public-api.ts\", \"dist/ng-devtools-backend\"],\n+      \"protocol\": [\"projects/protocol/src/public-api.ts\", \"dist/protocol\"],\n+      \"shared-utils\": [\"projects/shared-utils/src/public-api.ts\", \"dist/shared-utils\"]\n     }\n   },\n   \"angularCompilerOptions\": {\n     \"fullTemplateTypeCheck\": true,\n-    \"strictInjectionParameters\": true\n+    \"strictInjectionParameters\": true,\n+    \"enableIvy\": true\n   }\n }"
        },
        {
            "sha": "700b3d47a4cdccf16024b74a03d3b2489976e5c7",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 2088,
            "deletions": 2169,
            "changes": 4257,
            "blob_url": "https://github.com/angular/angular/blob/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/41ce9dc7d5b76752e039542a9fd539c1a827d0bf/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=41ce9dc7d5b76752e039542a9fd539c1a827d0bf"
        }
    ],
    "stats": {
        "total": 4804,
        "additions": 2612,
        "deletions": 2192
    }
}