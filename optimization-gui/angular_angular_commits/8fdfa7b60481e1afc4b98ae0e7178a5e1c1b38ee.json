{
    "author": "AndrewKushnir",
    "message": "refactor(compiler): allow strings with certain length to be included into `ConstantPool` (#38213)\n\nPrior to this commit, the `ConstantPool` ignored all primitive values. It turned out that it's\nbeneficial to include strings above certain length to the pool as well. This commit updates the\n`ConstantPool` logic to allow such strings to be shared across multiple instances if needed.\nFor instance, this is helpful for component styles that might be reused across multiple components\nin the same file.\n\nPR Close #38213",
    "sha": "8fdfa7b60481e1afc4b98ae0e7178a5e1c1b38ee",
    "files": [
        {
            "sha": "24e800c95d15edc9e15ff368f05c3882eff3c357",
            "filename": "packages/compiler/src/constant_pool.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/8fdfa7b60481e1afc4b98ae0e7178a5e1c1b38ee/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts",
            "raw_url": "https://github.com/angular/angular/raw/8fdfa7b60481e1afc4b98ae0e7178a5e1c1b38ee/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts?ref=8fdfa7b60481e1afc4b98ae0e7178a5e1c1b38ee",
            "patch": "@@ -36,6 +36,13 @@ export const enum DefinitionKind {\n  */\n const KEY_CONTEXT = {};\n \n+/**\n+ * Generally all primitive values are excluded from the `ConstantPool`, but there is an exclusion\n+ * for strings that reach a certain length threshold. This constant defines the length threshold for\n+ * strings.\n+ */\n+const POOL_INCLUSION_LENGTH_THRESHOLD_FOR_STRINGS = 50;\n+\n /**\n  * A node that is a place-holder that allows the node to be replaced when the actual\n  * node is known.\n@@ -96,7 +103,8 @@ export class ConstantPool {\n   private nextNameIndex = 0;\n \n   getConstLiteral(literal: o.Expression, forceShared?: boolean): o.Expression {\n-    if (literal instanceof o.LiteralExpr || literal instanceof FixupExpression) {\n+    if ((literal instanceof o.LiteralExpr && !isLongStringExpr(literal)) ||\n+        literal instanceof FixupExpression) {\n       // Do no put simple literals into the constant pool or try to produce a constant for a\n       // reference to a constant.\n       return literal;\n@@ -305,3 +313,8 @@ function invalid<T>(this: o.ExpressionVisitor, arg: o.Expression|o.Statement): n\n function isVariable(e: o.Expression): e is o.ReadVarExpr {\n   return e instanceof o.ReadVarExpr;\n }\n+\n+function isLongStringExpr(expr: o.LiteralExpr): boolean {\n+  return typeof expr.value === 'string' &&\n+      expr.value.length > POOL_INCLUSION_LENGTH_THRESHOLD_FOR_STRINGS;\n+}\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
    }
}