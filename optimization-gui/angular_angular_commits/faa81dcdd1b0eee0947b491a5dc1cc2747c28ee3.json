{
    "author": "atscott",
    "message": "refactor(language-service): Extract common methods from VE and Ivy to new package (#39098)\n\nRather than having the Ivy implementation add the VE code to the deps\nlist, create a new common package that both Ivy and VE depend on. This\nwill make it more straightforward in the future to remove the VE code\ncompletely.\n\nPR Close #39098",
    "sha": "faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
    "files": [
        {
            "sha": "7869219b68fbaea9e50206f690d732e96902892c",
            "filename": "packages/language-service/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2FBUILD.bazel?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -19,6 +19,7 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/compiler-cli\",\n         \"//packages/core\",\n+        \"//packages/language-service/common\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "afe8f39b56e876792dc91e9b4aee1223d02d728e",
            "filename": "packages/language-service/common/BUILD.bazel",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -0,0 +1,11 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+package(default_visibility = [\"//packages/language-service:__subpackages__\"])\n+\n+ts_library(\n+    name = \"common\",\n+    srcs = glob([\"*.ts\"]),\n+    deps = [\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "9f1076e98a1a9ceff769e2675692774bacf72774",
            "filename": "packages/language-service/common/quick_info.ts",
            "status": "added",
            "additions": 60,
            "deletions": 0,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -0,0 +1,60 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+\n+// Reverse mappings of enum would generate strings\n+export const ALIAS_NAME = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.aliasName];\n+export const SYMBOL_INTERFACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.interfaceName];\n+export const SYMBOL_PUNC = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.punctuation];\n+export const SYMBOL_SPACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.space];\n+export const SYMBOL_TEXT = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.text];\n+\n+/**\n+ * Construct a QuickInfo object taking into account its container and type.\n+ * @param name Name of the QuickInfo target\n+ * @param kind component, directive, pipe, etc.\n+ * @param textSpan span of the target\n+ * @param containerName either the Symbol's container or the NgModule that contains the directive\n+ * @param type user-friendly name of the type\n+ * @param documentation docstring or comment\n+ */\n+export function createQuickInfo(\n+    name: string, kind: string, textSpan: ts.TextSpan, containerName?: string, type?: string,\n+    documentation?: ts.SymbolDisplayPart[]): ts.QuickInfo {\n+  const containerDisplayParts = containerName ?\n+      [\n+        {text: containerName, kind: SYMBOL_INTERFACE},\n+        {text: '.', kind: SYMBOL_PUNC},\n+      ] :\n+      [];\n+\n+  const typeDisplayParts = type ?\n+      [\n+        {text: ':', kind: SYMBOL_PUNC},\n+        {text: ' ', kind: SYMBOL_SPACE},\n+        {text: type, kind: SYMBOL_INTERFACE},\n+      ] :\n+      [];\n+\n+  return {\n+    kind: kind as ts.ScriptElementKind,\n+    kindModifiers: ts.ScriptElementKindModifier.none,\n+    textSpan: textSpan,\n+    displayParts: [\n+      {text: '(', kind: SYMBOL_PUNC},\n+      {text: kind, kind: SYMBOL_TEXT},\n+      {text: ')', kind: SYMBOL_PUNC},\n+      {text: ' ', kind: SYMBOL_SPACE},\n+      ...containerDisplayParts,\n+      {text: name, kind: SYMBOL_INTERFACE},\n+      ...typeDisplayParts,\n+    ],\n+    documentation,\n+  };\n+}"
        },
        {
            "sha": "e5886aacd96d95c3c3b407ae2146ea4c30a07ff0",
            "filename": "packages/language-service/ivy/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2FBUILD.bazel?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -15,8 +15,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/shims\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n-        # TODO(atscott): Pull functions/variables common to VE and Ivy into a new package\n-        \"//packages/language-service\",\n+        \"//packages/language-service/common\",\n         \"@npm//typescript\",\n     ],\n )"
        },
        {
            "sha": "cab76ba08e3de744a343d7393c3e747a9a0d4eaa",
            "filename": "packages/language-service/ivy/quick_info.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fquick_info.ts?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -10,7 +10,7 @@ import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {DirectiveSymbol, DomBindingSymbol, ElementSymbol, ExpressionSymbol, InputBindingSymbol, OutputBindingSymbol, ReferenceSymbol, ShimLocation, Symbol, SymbolKind, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript';\n \n-import {createQuickInfo, SYMBOL_PUNC, SYMBOL_SPACE, SYMBOL_TEXT} from '../src/hover';\n+import {createQuickInfo, SYMBOL_PUNC, SYMBOL_SPACE, SYMBOL_TEXT} from '../common/quick_info';\n \n import {findNodeAtPosition} from './hybrid_visitor';\n import {filterAliasImports, getDirectiveMatches, getDirectiveMatchesForAttribute, getTemplateInfoAtPosition, getTextSpanOfNode} from './utils';"
        },
        {
            "sha": "a900eb970ce7ab0eace07835495e41cdd4925b28",
            "filename": "packages/language-service/ivy/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Futils.ts?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -12,7 +12,7 @@ import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expr\n import * as t from '@angular/compiler/src/render3/r3_ast';         // t for template AST\n import * as ts from 'typescript';\n \n-import {ALIAS_NAME, SYMBOL_PUNC} from '../src/hover';\n+import {ALIAS_NAME, SYMBOL_PUNC} from '../common/quick_info';\n \n /**\n  * Given a list of directives and a text to use as a selector, returns the directives which match"
        },
        {
            "sha": "9bc98a3f86f6f2f445005b9e92b3ad8d1a163cb1",
            "filename": "packages/language-service/src/hover.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 51,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fsrc%2Fhover.ts",
            "raw_url": "https://github.com/angular/angular/raw/faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3/packages%2Flanguage-service%2Fsrc%2Fhover.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fhover.ts?ref=faa81dcdd1b0eee0947b491a5dc1cc2747c28ee3",
            "patch": "@@ -8,17 +8,13 @@\n \n import {NgAnalyzedModules} from '@angular/compiler';\n import * as ts from 'typescript';\n+\n+import {createQuickInfo} from '../common/quick_info';\n+\n import {locateSymbols} from './locate_symbol';\n import * as ng from './types';\n import {inSpan} from './utils';\n \n-// Reverse mappings of enum would generate strings\n-export const SYMBOL_SPACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.space];\n-export const SYMBOL_PUNC = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.punctuation];\n-export const SYMBOL_TEXT = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.text];\n-export const SYMBOL_INTERFACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.interfaceName];\n-export const ALIAS_NAME = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.aliasName];\n-\n /**\n  * Traverse the template AST and look for the symbol located at `position`, then\n  * return the corresponding quick info.\n@@ -71,47 +67,3 @@ export function getTsHover(\n     }\n   }\n }\n-\n-/**\n- * Construct a QuickInfo object taking into account its container and type.\n- * @param name Name of the QuickInfo target\n- * @param kind component, directive, pipe, etc.\n- * @param textSpan span of the target\n- * @param containerName either the Symbol's container or the NgModule that contains the directive\n- * @param type user-friendly name of the type\n- * @param documentation docstring or comment\n- */\n-export function createQuickInfo(\n-    name: string, kind: string, textSpan: ts.TextSpan, containerName?: string, type?: string,\n-    documentation?: ts.SymbolDisplayPart[]): ts.QuickInfo {\n-  const containerDisplayParts = containerName ?\n-      [\n-        {text: containerName, kind: SYMBOL_INTERFACE},\n-        {text: '.', kind: SYMBOL_PUNC},\n-      ] :\n-      [];\n-\n-  const typeDisplayParts = type ?\n-      [\n-        {text: ':', kind: SYMBOL_PUNC},\n-        {text: ' ', kind: SYMBOL_SPACE},\n-        {text: type, kind: SYMBOL_INTERFACE},\n-      ] :\n-      [];\n-\n-  return {\n-    kind: kind as ts.ScriptElementKind,\n-    kindModifiers: ts.ScriptElementKindModifier.none,\n-    textSpan: textSpan,\n-    displayParts: [\n-      {text: '(', kind: SYMBOL_PUNC},\n-      {text: kind, kind: SYMBOL_TEXT},\n-      {text: ')', kind: SYMBOL_PUNC},\n-      {text: ' ', kind: SYMBOL_SPACE},\n-      ...containerDisplayParts,\n-      {text: name, kind: SYMBOL_INTERFACE},\n-      ...typeDisplayParts,\n-    ],\n-    documentation,\n-  };\n-}"
        }
    ],
    "stats": {
        "total": 133,
        "additions": 78,
        "deletions": 55
    }
}