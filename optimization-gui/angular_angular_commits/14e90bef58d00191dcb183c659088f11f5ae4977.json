{
    "author": "petebacondarwin",
    "message": "fix(localize): render text of extracted placeholders (#38536)\n\nFormats like XLIFF allow the text of the original source to\nbe included as metadata. This commit fixes the message\nextractor to also render this text when available.\n\nPR Close #38536",
    "sha": "14e90bef58d00191dcb183c659088f11f5ae4977",
    "files": [
        {
            "sha": "b86875e5696aab740a2cb59bf2de792efa73056f",
            "filename": "packages/localize/src/tools/src/extract/extraction.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -77,6 +77,20 @@ export class MessageExtractor {\n     for (const message of messages) {\n       if (message.location !== undefined) {\n         message.location = this.getOriginalLocation(sourceFile, message.location);\n+\n+        if (message.messagePartLocations) {\n+          message.messagePartLocations = message.messagePartLocations.map(\n+              location => location && this.getOriginalLocation(sourceFile, location));\n+        }\n+\n+        if (message.substitutionLocations) {\n+          const placeholderNames = Object.keys(message.substitutionLocations);\n+          for (const placeholderName of placeholderNames) {\n+            const location = message.substitutionLocations[placeholderName];\n+            message.substitutionLocations[placeholderName] =\n+                location && this.getOriginalLocation(sourceFile, location);\n+          }\n+        }\n       }\n     }\n   }"
        },
        {
            "sha": "8dd6f2085b0fb314f01a74802a42c15c682bc08e",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -67,7 +67,8 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     const length = message.messageParts.length - 1;\n     for (let i = 0; i < length; i++) {\n       this.serializeTextPart(xml, message.messageParts[i]);\n-      xml.startTag('x', {id: message.placeholderNames[i]}, {selfClosing: true});\n+      const location = message.substitutionLocations?.[message.placeholderNames[i]];\n+      this.serializePlaceholder(xml, message.placeholderNames[i], location?.text);\n     }\n     this.serializeTextPart(xml, message.messageParts[length]);\n   }\n@@ -77,11 +78,19 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     const length = pieces.length - 1;\n     for (let i = 0; i < length; i += 2) {\n       xml.text(pieces[i]);\n-      xml.startTag('x', {id: pieces[i + 1]}, {selfClosing: true});\n+      this.serializePlaceholder(xml, pieces[i + 1], undefined);\n     }\n     xml.text(pieces[length]);\n   }\n \n+  private serializePlaceholder(xml: XmlFile, id: string, text: string|undefined): void {\n+    const attrs: Record<string, string> = {id};\n+    if (text !== undefined) {\n+      attrs['equiv-text'] = text;\n+    }\n+    xml.startTag('x', attrs, {selfClosing: true});\n+  }\n+\n   private serializeNote(xml: XmlFile, name: string, value: string): void {\n     xml.startTag('note', {priority: '1', from: name}, {preserveWhitespace: true});\n     xml.text(value);"
        },
        {
            "sha": "234ceaf45eb37e557d6e3a844beffecabbc596b7",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 10,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {AbsoluteFsPath, relative} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {ɵParsedMessage} from '@angular/localize';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {extractIcuPlaceholders} from './icu_parsing';\n import {TranslationSerializer} from './translation_serializer';\n@@ -80,7 +80,7 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n     const length = message.messageParts.length - 1;\n     for (let i = 0; i < length; i++) {\n       this.serializeTextPart(xml, message.messageParts[i]);\n-      this.serializePlaceholder(xml, message.placeholderNames[i]);\n+      this.serializePlaceholder(xml, message.placeholderNames[i], message.substitutionLocations);\n     }\n     this.serializeTextPart(xml, message.messageParts[length]);\n   }\n@@ -90,24 +90,40 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n     const length = pieces.length - 1;\n     for (let i = 0; i < length; i += 2) {\n       xml.text(pieces[i]);\n-      this.serializePlaceholder(xml, pieces[i + 1]);\n+      this.serializePlaceholder(xml, pieces[i + 1], undefined);\n     }\n     xml.text(pieces[length]);\n   }\n \n-  private serializePlaceholder(xml: XmlFile, placeholderName: string): void {\n+  private serializePlaceholder(\n+      xml: XmlFile, placeholderName: string,\n+      substitutionLocations: Record<string, ɵSourceLocation|undefined>|undefined): void {\n+    const text = substitutionLocations?.[placeholderName]?.text;\n+\n     if (placeholderName.startsWith('START_')) {\n-      xml.startTag('pc', {\n+      const closingPlaceholderName = placeholderName.replace(/^START/, 'CLOSE');\n+      const closingText = substitutionLocations?.[closingPlaceholderName]?.text;\n+      const attrs: Record<string, string> = {\n         id: `${this.currentPlaceholderId++}`,\n         equivStart: placeholderName,\n-        equivEnd: placeholderName.replace(/^START/, 'CLOSE')\n-      });\n+        equivEnd: closingPlaceholderName,\n+      };\n+      if (text !== undefined) {\n+        attrs.dispStart = text;\n+      }\n+      if (closingText !== undefined) {\n+        attrs.dispEnd = closingText;\n+      }\n+      xml.startTag('pc', attrs);\n     } else if (placeholderName.startsWith('CLOSE_')) {\n       xml.endTag('pc');\n     } else {\n-      xml.startTag(\n-          'ph', {id: `${this.currentPlaceholderId++}`, equiv: placeholderName},\n-          {selfClosing: true});\n+      const attrs:\n+          Record<string, string> = {id: `${this.currentPlaceholderId++}`, equiv: placeholderName};\n+      if (text !== undefined) {\n+        attrs.disp = text;\n+      }\n+      xml.startTag('ph', attrs, {selfClosing: true});\n     }\n   }\n "
        },
        {
            "sha": "72b9d1aa5f8568ef6355161be96e0bb2eeb8829d",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 7,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -77,7 +77,8 @@ runInEachFileSystem(() => {\n             `    \"8669027859022295761\": \"try{$PH}me\",`,\n             `    \"custom-id\": \"Custom id message\",`,\n             `    \"273296103957933077\": \"Legacy id message\",`,\n-            `    \"custom-id-2\": \"Custom and legacy message\"`,\n+            `    \"custom-id-2\": \"Custom and legacy message\",`,\n+            `    \"2932901491976224757\": \"pre{$START_TAG_SPAN}inner-pre{$START_BOLD_TEXT}bold{$CLOSE_BOLD_TEXT}inner-post{$CLOSE_TAG_SPAN}post\"`,\n             `  }`,\n             `}`,\n           ].join('\\n'));\n@@ -127,6 +128,8 @@ runInEachFileSystem(() => {\n                     '12345678901234567890' :\n                     '273296103957933077'}\"><source>test_files/test.js:5</source>Legacy id message</msg>`,\n             `  <msg id=\"custom-id-2\"><source>test_files/test.js:7</source>Custom and legacy message</msg>`,\n+            `  <msg id=\"2932901491976224757\"><source>test_files/test.js:8,10</source>pre<ph name=\"START_TAG_SPAN\"/>` +\n+                `inner-pre<ph name=\"START_BOLD_TEXT\"/>bold<ph name=\"CLOSE_BOLD_TEXT\"/>inner-post<ph name=\"CLOSE_TAG_SPAN\"/>post</msg>`,\n             `</messagebundle>\\n`,\n           ].join('\\n'));\n         });\n@@ -149,14 +152,14 @@ runInEachFileSystem(() => {\n             `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n             `    <body>`,\n             `      <trans-unit id=\"3291030485717846467\" datatype=\"html\">`,\n-            `        <source>Hello, <x id=\"PH\"/>!</source>`,\n+            `        <source>Hello, <x id=\"PH\" equiv-text=\"name\"/>!</source>`,\n             `        <context-group purpose=\"location\">`,\n             `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n             `          <context context-type=\"linenumber\">2</context>`,\n             `        </context-group>`,\n             `      </trans-unit>`,\n             `      <trans-unit id=\"8669027859022295761\" datatype=\"html\">`,\n-            `        <source>try<x id=\"PH\"/>me</source>`,\n+            `        <source>try<x id=\"PH\" equiv-text=\"40 + 2\"/>me</source>`,\n             `        <context-group purpose=\"location\">`,\n             `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n             `          <context context-type=\"linenumber\">3</context>`,\n@@ -185,6 +188,15 @@ runInEachFileSystem(() => {\n             `          <context context-type=\"linenumber\">8</context>`,\n             `        </context-group>`,\n             `      </trans-unit>`,\n+            `      <trans-unit id=\"2932901491976224757\" datatype=\"html\">`,\n+            `        <source>pre<x id=\"START_TAG_SPAN\" equiv-text=\"&apos;&lt;span&gt;&apos;\"/>` +\n+                `inner-pre<x id=\"START_BOLD_TEXT\" equiv-text=\"&apos;&lt;b&gt;&apos;\"/>bold<x id=\"CLOSE_BOLD_TEXT\" equiv-text=\"&apos;&lt;/b&gt;&apos;\"/>` +\n+                `inner-post<x id=\"CLOSE_TAG_SPAN\" equiv-text=\"&apos;&lt;/span&gt;&apos;\"/>post</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">9,10</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n             `    </body>`,\n             `  </file>`,\n             `</xliff>\\n`,\n@@ -209,12 +221,12 @@ runInEachFileSystem(() => {\n             `  <file>`,\n             `    <unit id=\"3291030485717846467\">`,\n             `      <segment>`,\n-            `        <source>Hello, <ph id=\"0\" equiv=\"PH\"/>!</source>`,\n+            `        <source>Hello, <ph id=\"0\" equiv=\"PH\" disp=\"name\"/>!</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"8669027859022295761\">`,\n             `      <segment>`,\n-            `        <source>try<ph id=\"0\" equiv=\"PH\"/>me</source>`,\n+            `        <source>try<ph id=\"0\" equiv=\"PH\" disp=\"40 + 2\"/>me</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"custom-id\">`,\n@@ -232,6 +244,13 @@ runInEachFileSystem(() => {\n             `        <source>Custom and legacy message</source>`,\n             `      </segment>`,\n             `    </unit>`,\n+            `    <unit id=\"2932901491976224757\">`,\n+            `      <segment>`,\n+            `        <source>pre<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" dispStart=\"&apos;&lt;span&gt;&apos;\" dispEnd=\"&apos;&lt;/span&gt;&apos;\">` +\n+                `inner-pre<pc id=\"1\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" dispStart=\"&apos;&lt;b&gt;&apos;\" dispEnd=\"&apos;&lt;/b&gt;&apos;\">bold</pc>` +\n+                `inner-post</pc>post</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n             `  </file>`,\n             `</xliff>\\n`,\n           ].join('\\n'));\n@@ -260,15 +279,15 @@ runInEachFileSystem(() => {\n              `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n              `    <body>`,\n              `      <trans-unit id=\"157258427077572998\" datatype=\"html\">`,\n-             `        <source>Message in <x id=\"a-file\"/>!</source>`,\n+             `        <source>Message in <x id=\"a-file\" equiv-text=\"file\"/>!</source>`,\n              `        <context-group purpose=\"location\">`,\n              // These source file paths are due to how Bazel TypeScript compilation source-maps work\n              `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/a.ts</context>`,\n              `          <context context-type=\"linenumber\">3</context>`,\n              `        </context-group>`,\n              `      </trans-unit>`,\n              `      <trans-unit id=\"7829869508202074508\" datatype=\"html\">`,\n-             `        <source>Message in <x id=\"b-file\"/>!</source>`,\n+             `        <source>Message in <x id=\"b-file\" equiv-text=\"file\"/>!</source>`,\n              `        <context-group purpose=\"location\">`,\n              `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/b.ts</context>`,\n              `          <context context-type=\"linenumber\">3</context>`,"
        },
        {
            "sha": "66d58b0ee277624b11eedecf114cb03110928749",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/test.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -6,3 +6,5 @@ var legacyMessage =\n     $localize`:␟1234567890123456789012345678901234567890␟12345678901234567890:Legacy id message`;\n var customAndLegacyMessage =\n     $localize`:@@custom-id-2␟1234567890123456789012345678901234567890␟12345678901234567890:Custom and legacy message`;\n+var containers = $localize`pre${'<span>'}:START_TAG_SPAN:inner-pre${'<b>'}:START_BOLD_TEXT:bold${\n+                          '</b>'}:CLOSE_BOLD_TEXT:inner-post${'</span>'}:CLOSE_TAG_SPAN:post`;"
        },
        {
            "sha": "b05b16e51078d5998113b20023fc66dbac524e62",
            "filename": "packages/localize/src/tools/test/extract/translation_files/mock_message.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -6,38 +6,35 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {ɵParsedMessage} from '@angular/localize';\n-import {SourceLocation} from '@angular/localize/src/utils';\n+import {MessageId, SourceLocation} from '@angular/localize/src/utils';\n \n export interface MockMessageOptions {\n   customId?: string;\n   meaning?: string;\n   description?: string;\n   location?: SourceLocation;\n   legacyIds?: string[];\n+  messagePartLocations?: (SourceLocation|undefined)[];\n+  substitutionLocations?: Record<string, SourceLocation|undefined>;\n }\n \n /**\n  * This helper is used to create `ParsedMessage` objects to be rendered in the\n  * `TranslationSerializer` tests.\n  */\n export function mockMessage(\n-    id: string, messageParts: string[], placeholderNames: string[],\n-    {customId, meaning = '', description = '', location, legacyIds = []}: MockMessageOptions):\n-    ɵParsedMessage {\n+    id: MessageId, messageParts: string[], placeholderNames: string[],\n+    options: MockMessageOptions): ɵParsedMessage {\n   let text = messageParts[0];\n   for (let i = 1; i < messageParts.length; i++) {\n     text += `{$${placeholderNames[i - 1]}}${messageParts[i]}`;\n   }\n   return {\n-    id: customId || id,  // customId trumps id\n+    substitutions: [],\n+    ...options,\n+    id: options.customId || id,  // customId trumps id\n     text,\n     messageParts,\n     placeholderNames,\n-    customId,\n-    description,\n-    meaning,\n-    substitutions: [],\n-    legacyIds,\n-    location,\n   };\n }"
        },
        {
            "sha": "31ff2d99c2f0c04c6a3a7123426257ded20b04ff",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n-import {ɵParsedMessage} from '@angular/localize';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {Xliff1TranslationSerializer} from '../../../src/extract/translation_files/xliff1_translation_serializer';\n \n@@ -18,6 +18,18 @@ runInEachFileSystem(() => {\n     [false, true].forEach(useLegacyIds => {\n       describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n         it('should convert a set of parsed messages into an XML string', () => {\n+          const phLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 10},\n+            end: {line: 1, column: 15},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'placeholder + 1'\n+          };\n+          const messagePartLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 5},\n+            end: {line: 0, column: 10},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'message part'\n+          };\n           const messages: ɵParsedMessage[] = [\n             mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               meaning: 'some meaning',\n@@ -31,6 +43,8 @@ runInEachFileSystem(() => {\n             mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               customId: 'someId',\n               legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+              messagePartLocations: [undefined, messagePartLocation, undefined],\n+              substitutionLocations: {'PH': phLocation, 'PH_1': undefined},\n             }),\n             mockMessage(\n                 '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n@@ -71,7 +85,7 @@ runInEachFileSystem(() => {\n             `        <note priority=\"1\" from=\"meaning\">some meaning</note>`,\n             `      </trans-unit>`,\n             `      <trans-unit id=\"someId\" datatype=\"html\">`,\n-            `        <source>a<x id=\"PH\"/>b<x id=\"PH_1\"/>c</source>`,\n+            `        <source>a<x id=\"PH\" equiv-text=\"placeholder + 1\"/>b<x id=\"PH_1\"/>c</source>`,\n             `      </trans-unit>`,\n             `      <trans-unit id=\"67890\" datatype=\"html\">`,\n             `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,"
        },
        {
            "sha": "cf11c8d199b9040cf3396838ff26326ffb569a50",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -5,10 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {computeMsgId} from '@angular/compiler';\n import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n-import {ɵParsedMessage} from '@angular/localize';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {Xliff2TranslationSerializer} from '../../../src/extract/translation_files/xliff2_translation_serializer';\n \n@@ -19,6 +18,18 @@ runInEachFileSystem(() => {\n     [false, true].forEach(useLegacyIds => {\n       describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n         it('should convert a set of parsed messages into an XML string', () => {\n+          const phLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 10},\n+            end: {line: 1, column: 15},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'placeholder + 1'\n+          };\n+          const messagePartLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 5},\n+            end: {line: 0, column: 10},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'message part'\n+          };\n           const messages: ɵParsedMessage[] = [\n             mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               meaning: 'some meaning',\n@@ -32,6 +43,8 @@ runInEachFileSystem(() => {\n             mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               customId: 'someId',\n               legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+              messagePartLocations: [undefined, messagePartLocation, undefined],\n+              substitutionLocations: {'PH': phLocation, 'PH_1': undefined},\n             }),\n             mockMessage('67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n               description: 'some description',\n@@ -76,7 +89,7 @@ runInEachFileSystem(() => {\n             `    </unit>`,\n             `    <unit id=\"someId\">`,\n             `      <segment>`,\n-            `        <source>a<ph id=\"0\" equiv=\"PH\"/>b<ph id=\"1\" equiv=\"PH_1\"/>c</source>`,\n+            `        <source>a<ph id=\"0\" equiv=\"PH\" disp=\"placeholder + 1\"/>b<ph id=\"1\" equiv=\"PH_1\"/>c</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"67890\">`,"
        },
        {
            "sha": "f7cf83e9cc11adb5a3c6037a348740a623849010",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xmb_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/14e90bef58d00191dcb183c659088f11f5ae4977/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts?ref=14e90bef58d00191dcb183c659088f11f5ae4977",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n-import {ɵParsedMessage} from '@angular/localize';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {XmbTranslationSerializer} from '../../../src/extract/translation_files/xmb_translation_serializer';\n \n@@ -18,6 +18,18 @@ runInEachFileSystem(() => {\n     [false, true].forEach(useLegacyIds => {\n       describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n         it('should convert a set of parsed messages into an XML string', () => {\n+          const phLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 10},\n+            end: {line: 1, column: 15},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'placeholder + 1'\n+          };\n+          const messagePartLocation: ɵSourceLocation = {\n+            start: {line: 0, column: 5},\n+            end: {line: 0, column: 10},\n+            file: absoluteFrom('/project/file.ts'),\n+            text: 'message part'\n+          };\n           const messages: ɵParsedMessage[] = [\n             mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               meaning: 'some meaning',\n@@ -26,6 +38,8 @@ runInEachFileSystem(() => {\n             mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n               customId: 'someId',\n               legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+              messagePartLocations: [undefined, messagePartLocation, undefined],\n+              substitutionLocations: {'PH': phLocation, 'PH_1': undefined},\n             }),\n             mockMessage(\n                 '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],"
        }
    ],
    "stats": {
        "total": 170,
        "additions": 134,
        "deletions": 36
    }
}