{
    "author": "devversion",
    "message": "feat(dev-infra): publish major versions to \"next\" NPM dist tag (#42133)\n\nPreviously, the dev-infra release tool would publish major versions\ndirectly to the NPM `@latest` dist tag. This is correct in theory, but\nrather unpractical given that we want to publish packages first as\n`@next` so that other dependent Angular packages can update too,\nallowing us to publish all main Angular packages (from FW, COMP\nand TOOL) at the same time to `@latest` on NPM.\n\nThis involves creating a new release action for re-tagging the\npreviously released major as `@latest` on NPM.\n\nPR Close #42133",
    "sha": "9d75687f62526616f4abf1096c231d4a246e06e4",
    "files": [
        {
            "sha": "f200d96d1062ba3091c7be47a143556bf2292975",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 62,
            "deletions": 3,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -5954,7 +5954,7 @@ class ReleaseAction {\n         this._cachedForkRepo = null;\n     }\n     /** Whether the release action is currently active. */\n-    static isActive(_trains) {\n+    static isActive(_trains, _config) {\n         throw Error('Not implemented.');\n     }\n     /** Updates the version in the project top-level `package.json` file. */\n@@ -6635,7 +6635,17 @@ class CutStableAction extends ReleaseAction {\n             const isNewMajor = (_a = this.active.releaseCandidate) === null || _a === void 0 ? void 0 : _a.isMajor;\n             const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n             yield this.waitForPullRequestToBeMerged(id);\n-            yield this.buildAndPublish(releaseNotes, branchName, 'latest');\n+            // If a new major version is published, we publish to the `next` NPM dist tag temporarily.\n+            // We do this because for major versions, we want all main Angular projects to have their\n+            // new major become available at the same time. Publishing immediately to the `latest` NPM\n+            // dist tag could cause inconsistent versions when users install packages with `@latest`.\n+            // For example: Consider Angular Framework releases v12. CLI and Components would need to\n+            // wait for that release to complete. Once done, they can update their dependencies to point\n+            // to v12. Afterwards they could start the release process. In the meanwhile though, the FW\n+            // dependencies were already available as `@latest`, so users could end up installing v12 while\n+            // still having the older (but currently still latest) CLI version that is incompatible.\n+            // The major release can be re-tagged to `latest` through a separate release action.\n+            yield this.buildAndPublish(releaseNotes, branchName, isNewMajor ? 'next' : 'latest');\n             // If a new major version is published and becomes the \"latest\" release-train, we need\n             // to set the LTS npm dist tag for the previous latest release-train (the current patch).\n             if (isNewMajor) {\n@@ -6760,6 +6770,54 @@ class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n     }\n }\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Release action that tags the recently published major as latest within the NPM\n+ * registry. Major versions are published to the `next` NPM dist tag initially and\n+ * can be re-tagged to the `latest` NPM dist tag. This allows caretakers to make major\n+ * releases available at the same time. e.g. Framework, Tooling and Components\n+ * are able to publish v12 to `@latest` at the same time. This wouldn't be possible if\n+ * we directly publish to `@latest` because Tooling and Components needs to wait\n+ * for the major framework release to be available on NPM.\n+ * @see {CutStableAction#perform} for more details.\n+ */\n+class TagRecentMajorAsLatest extends ReleaseAction {\n+    getDescription() {\n+        return tslib.__awaiter(this, void 0, void 0, function* () {\n+            return `Tag recently published major v${this.active.latest.version} as \"next\" in NPM.`;\n+        });\n+    }\n+    perform() {\n+        return tslib.__awaiter(this, void 0, void 0, function* () {\n+            yield this.checkoutUpstreamBranch(this.active.latest.branchName);\n+            yield invokeYarnInstallCommand(this.projectDir);\n+            yield invokeSetNpmDistCommand('latest', this.active.latest.version);\n+        });\n+    }\n+    static isActive({ latest }, config) {\n+        return tslib.__awaiter(this, void 0, void 0, function* () {\n+            // If the latest release-train does currently not have a major version as version. e.g.\n+            // the latest branch is `10.0.x` with the version being `10.0.2`. In such cases, a major\n+            // has not been released recently, and this action should never become active.\n+            if (latest.version.minor !== 0 || latest.version.patch !== 0) {\n+                return false;\n+            }\n+            const packageInfo = yield fetchProjectNpmPackageInfo(config);\n+            const npmLatestVersion = semver.parse(packageInfo['dist-tags']['latest']);\n+            // This action only becomes active if a major just has been released recently, but is\n+            // not set to the `latest` NPM dist tag in the NPM registry. Note that we only allow\n+            // re-tagging if the current `@latest` in NPM is the previous major version.\n+            return npmLatestVersion !== null && npmLatestVersion.major === latest.version.major - 1;\n+        });\n+    }\n+}\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -6772,6 +6830,7 @@ class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n  * by priority. Actions which are selectable are sorted based on this declaration order.\n  */\n const actions = [\n+    TagRecentMajorAsLatest,\n     CutStableAction,\n     CutReleaseCandidateAction,\n     CutNewPatchAction,\n@@ -6860,7 +6919,7 @@ class ReleaseTool {\n             const choices = [];\n             // Find and instantiate all release actions which are currently valid.\n             for (let actionType of actions) {\n-                if (yield actionType.isActive(activeTrains)) {\n+                if (yield actionType.isActive(activeTrains, this._config)) {\n                     const action = new actionType(activeTrains, this._git, this._config, this._projectRoot);\n                     choices.push({ name: yield action.getDescription(), value: action });\n                 }"
        },
        {
            "sha": "39358a4092477c9aa4d43fdc6554e0659372fc50",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -48,7 +48,7 @@ export interface PullRequest {\n /** Constructor type for instantiating a release action */\n export interface ReleaseActionConstructor<T extends ReleaseAction = ReleaseAction> {\n   /** Whether the release action is currently active. */\n-  isActive(active: ActiveReleaseTrains): Promise<boolean>;\n+  isActive(active: ActiveReleaseTrains, config: ReleaseConfig): Promise<boolean>;\n   /** Constructs a release action. */\n   new(...args: [ActiveReleaseTrains, GitClient<true>, ReleaseConfig, string]): T;\n }\n@@ -60,7 +60,7 @@ export interface ReleaseActionConstructor<T extends ReleaseAction = ReleaseActio\n  */\n export abstract class ReleaseAction {\n   /** Whether the release action is currently active. */\n-  static isActive(_trains: ActiveReleaseTrains): Promise<boolean> {\n+  static isActive(_trains: ActiveReleaseTrains, _config: ReleaseConfig): Promise<boolean> {\n     throw Error('Not implemented.');\n   }\n "
        },
        {
            "sha": "d6905f28b6fa5060cf220eb229ac2ad1b6b7bd92",
            "filename": "dev-infra/release/publish/actions/cut-stable.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -30,12 +30,22 @@ export class CutStableAction extends ReleaseAction {\n     const newVersion = this._newVersion;\n     const isNewMajor = this.active.releaseCandidate?.isMajor;\n \n-\n     const {pullRequest: {id}, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n     await this.waitForPullRequestToBeMerged(id);\n-    await this.buildAndPublish(releaseNotes, branchName, 'latest');\n+\n+    // If a new major version is published, we publish to the `next` NPM dist tag temporarily.\n+    // We do this because for major versions, we want all main Angular projects to have their\n+    // new major become available at the same time. Publishing immediately to the `latest` NPM\n+    // dist tag could cause inconsistent versions when users install packages with `@latest`.\n+    // For example: Consider Angular Framework releases v12. CLI and Components would need to\n+    // wait for that release to complete. Once done, they can update their dependencies to point\n+    // to v12. Afterwards they could start the release process. In the meanwhile though, the FW\n+    // dependencies were already available as `@latest`, so users could end up installing v12 while\n+    // still having the older (but currently still latest) CLI version that is incompatible.\n+    // The major release can be re-tagged to `latest` through a separate release action.\n+    await this.buildAndPublish(releaseNotes, branchName, isNewMajor ? 'next' : 'latest');\n \n     // If a new major version is published and becomes the \"latest\" release-train, we need\n     // to set the LTS npm dist tag for the previous latest release-train (the current patch)."
        },
        {
            "sha": "67352466a7006c5d8b6f4a6faca026d7ccbe04d7",
            "filename": "dev-infra/release/publish/actions/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -14,12 +14,14 @@ import {CutNextPrereleaseAction} from './cut-next-prerelease';\n import {CutReleaseCandidateAction} from './cut-release-candidate';\n import {CutStableAction} from './cut-stable';\n import {MoveNextIntoFeatureFreezeAction} from './move-next-into-feature-freeze';\n+import {TagRecentMajorAsLatest} from './tag-recent-major-as-latest';\n \n /**\n  * List of release actions supported by the release staging tool. These are sorted\n  * by priority. Actions which are selectable are sorted based on this declaration order.\n  */\n export const actions: ReleaseActionConstructor[] = [\n+  TagRecentMajorAsLatest,\n   CutStableAction,\n   CutReleaseCandidateAction,\n   CutNewPatchAction,"
        },
        {
            "sha": "742cd8170bc1f2671ada6cb5cc5285054360e8a1",
            "filename": "dev-infra/release/publish/actions/tag-recent-major-as-latest.ts",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -0,0 +1,53 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as semver from 'semver';\n+\n+import {ReleaseConfig} from '../../config';\n+import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n+import {fetchProjectNpmPackageInfo} from '../../versioning/npm-registry';\n+import {ReleaseAction} from '../actions';\n+import {invokeSetNpmDistCommand, invokeYarnInstallCommand} from '../external-commands';\n+\n+/**\n+ * Release action that tags the recently published major as latest within the NPM\n+ * registry. Major versions are published to the `next` NPM dist tag initially and\n+ * can be re-tagged to the `latest` NPM dist tag. This allows caretakers to make major\n+ * releases available at the same time. e.g. Framework, Tooling and Components\n+ * are able to publish v12 to `@latest` at the same time. This wouldn't be possible if\n+ * we directly publish to `@latest` because Tooling and Components needs to wait\n+ * for the major framework release to be available on NPM.\n+ * @see {CutStableAction#perform} for more details.\n+ */\n+export class TagRecentMajorAsLatest extends ReleaseAction {\n+  async getDescription() {\n+    return `Tag recently published major v${this.active.latest.version} as \"next\" in NPM.`;\n+  }\n+\n+  async perform() {\n+    await this.checkoutUpstreamBranch(this.active.latest.branchName);\n+    await invokeYarnInstallCommand(this.projectDir);\n+    await invokeSetNpmDistCommand('latest', this.active.latest.version);\n+  }\n+\n+  static async isActive({latest}: ActiveReleaseTrains, config: ReleaseConfig) {\n+    // If the latest release-train does currently not have a major version as version. e.g.\n+    // the latest branch is `10.0.x` with the version being `10.0.2`. In such cases, a major\n+    // has not been released recently, and this action should never become active.\n+    if (latest.version.minor !== 0 || latest.version.patch !== 0) {\n+      return false;\n+    }\n+\n+    const packageInfo = await fetchProjectNpmPackageInfo(config);\n+    const npmLatestVersion = semver.parse(packageInfo['dist-tags']['latest']);\n+    // This action only becomes active if a major just has been released recently, but is\n+    // not set to the `latest` NPM dist tag in the NPM registry. Note that we only allow\n+    // re-tagging if the current `@latest` in NPM is the previous major version.\n+    return npmLatestVersion !== null && npmLatestVersion.major === latest.version.major - 1;\n+  }\n+}"
        },
        {
            "sha": "e4ad00de2e4e545a6454deeca2ec15d6bb34c4e8",
            "filename": "dev-infra/release/publish/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Findex.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -98,7 +98,7 @@ export class ReleaseTool {\n \n     // Find and instantiate all release actions which are currently valid.\n     for (let actionType of actions) {\n-      if (await actionType.isActive(activeTrains)) {\n+      if (await actionType.isActive(activeTrains, this._config)) {\n         const action: ReleaseAction =\n             new actionType(activeTrains, this._git, this._config, this._projectRoot);\n         choices.push({name: await action.getDescription(), value: action});"
        },
        {
            "sha": "850a57b5a3fbb4a792cd3953dbf157ad82942d6c",
            "filename": "dev-infra/release/publish/test/cut-stable.spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -77,7 +77,9 @@ describe('cut stable action', () => {\n       return Promise.resolve();\n     });\n \n-    await expectStagingAndPublishWithCherryPick(action, '11.0.x', '11.0.0', 'latest');\n+    // Major is released to the `next` NPM dist tag initially. Can be re-tagged with\n+    // a separate release action. See `CutStableAction` for more details.\n+    await expectStagingAndPublishWithCherryPick(action, '11.0.x', '11.0.0', 'next');\n     expect(externalCommands.invokeSetNpmDistCommand).toHaveBeenCalledTimes(1);\n     expect(externalCommands.invokeSetNpmDistCommand)\n         .toHaveBeenCalledWith('v10-lts', matchesVersion('10.0.3'));"
        },
        {
            "sha": "0bd42463c2cfcd26992104b8e4c49f5425ef6e8a",
            "filename": "dev-infra/release/publish/test/tag-recent-major-as-latest.spec.ts",
            "status": "added",
            "additions": 116,
            "deletions": 0,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9d75687f62526616f4abf1096c231d4a246e06e4/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts?ref=9d75687f62526616f4abf1096c231d4a246e06e4",
            "patch": "@@ -0,0 +1,116 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {matchesVersion} from '../../../utils/testing';\n+import {ReleaseTrain} from '../../versioning/release-trains';\n+import {TagRecentMajorAsLatest} from '../actions/tag-recent-major-as-latest';\n+import * as externalCommands from '../external-commands';\n+\n+import {fakeNpmPackageQueryRequest, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting} from './test-utils';\n+\n+describe('tag recent major as latest action', () => {\n+  it('should not be active if a patch has been published after major release', async () => {\n+    const {releaseConfig} = getTestingMocksForReleaseAction();\n+    expect(await TagRecentMajorAsLatest.isActive(\n+               {\n+                 releaseCandidate: null,\n+                 next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n+                 latest: new ReleaseTrain('10.0.x', parse('10.0.1')),\n+               },\n+               releaseConfig))\n+        .toBe(false);\n+  });\n+\n+  it('should not be active if a major has been released recently but \"@latest\" on NPM points to ' +\n+         'a more recent major',\n+     async () => {\n+       const {releaseConfig} = getTestingMocksForReleaseAction();\n+\n+       // NPM `@latest` will point to a patch release of a more recent major. This is unlikely\n+       // to happen (only with manual changes outside of the release tool), but should\n+       // prevent accidental overrides from the release action.\n+       fakeNpmPackageQueryRequest(\n+           releaseConfig.npmPackages[0], {'dist-tags': {'latest': '11.0.3'}});\n+\n+       expect(await TagRecentMajorAsLatest.isActive(\n+                  {\n+                    releaseCandidate: null,\n+                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n+                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n+                  },\n+                  releaseConfig))\n+           .toBe(false);\n+     });\n+\n+  it('should not be active if a major has been released recently but \"@latest\" on NPM points to ' +\n+         'an older major',\n+     async () => {\n+       const {releaseConfig} = getTestingMocksForReleaseAction();\n+\n+       // NPM `@latest` will point to a patch release of an older major. This is unlikely to happen\n+       // (only with manual changes outside of the release tool), but should prevent accidental\n+       // changes from the release action that indicate mismatched version branches, or an\n+       // out-of-sync NPM registry.\n+       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '8.4.7'}});\n+\n+       expect(await TagRecentMajorAsLatest.isActive(\n+                  {\n+                    releaseCandidate: null,\n+                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n+                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n+                  },\n+                  releaseConfig))\n+           .toBe(false);\n+     });\n+\n+\n+  it('should be active if a major has been released recently but is not published as ' +\n+         '\"@latest\" to NPM',\n+     async () => {\n+       const {releaseConfig} = getTestingMocksForReleaseAction();\n+\n+       // NPM `@latest` will point to a patch release of the previous major.\n+       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '9.2.3'}});\n+\n+       expect(await TagRecentMajorAsLatest.isActive(\n+                  {\n+                    releaseCandidate: null,\n+                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n+                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n+                  },\n+                  releaseConfig))\n+           .toBe(true);\n+     });\n+\n+  it('should be active if a major has been released recently but is not published as ' +\n+         '\"@latest\" to NPM',\n+     async () => {\n+       const {instance, gitClient, releaseConfig} =\n+           setupReleaseActionForTesting(TagRecentMajorAsLatest, {\n+             releaseCandidate: null,\n+             next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n+             latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n+           });\n+\n+       // NPM `@latest` will point to a patch release of the previous major.\n+       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '9.2.3'}});\n+\n+       await instance.perform();\n+\n+       // Ensure that the NPM dist tag is set only for packages that were available in the previous\n+       // major version. A spy has already been installed on the function.\n+       (externalCommands.invokeSetNpmDistCommand as jasmine.Spy).and.callFake(() => {\n+         expect(gitClient.head.ref?.name).toBe('10.0.x');\n+         return Promise.resolve();\n+       });\n+\n+       expect(externalCommands.invokeSetNpmDistCommand).toHaveBeenCalledTimes(1);\n+       expect(externalCommands.invokeSetNpmDistCommand)\n+           .toHaveBeenCalledWith('latest', matchesVersion('10.0.0'));\n+     });\n+});"
        }
    ],
    "stats": {
        "total": 260,
        "additions": 251,
        "deletions": 9
    }
}