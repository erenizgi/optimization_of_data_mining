{
    "author": "petebacondarwin",
    "message": "build(docs-infra): ensure that deployment works on CI (#39535)\n\nThe actual \"main\" part of the script that is executed was using\nan uninitialized variable. This is fixed and a test is added to\ncheck.\n\nPR Close #39535",
    "sha": "5f1e9758f57ce38f96dc5287c86e3ca1ce416176",
    "files": [
        {
            "sha": "a381a7a592f42e6252820f8909cd0d51bcf77bce",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/5f1e9758f57ce38f96dc5287c86e3ca1ce416176/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/5f1e9758f57ce38f96dc5287c86e3ca1ce416176/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=5f1e9758f57ce38f96dc5287c86e3ca1ce416176",
            "patch": "@@ -30,7 +30,7 @@ if (require.main === module) {\n     console.log(deploymentInfo.reason);\n   } else {\n     console.log(\n-        `Git branch        : ${currentBranch}\\n` +\n+        `Git branch        : ${inputVars.currentBranch}\\n` +\n         `Build/deploy mode : ${deploymentInfo.deployEnv}\\n` +\n         `Firebase project  : ${deploymentInfo.projectId}\\n` +\n         `Firebase site     : ${deploymentInfo.siteId}\\n` +"
        },
        {
            "sha": "02a09a3aed13c9fef129f6ec5dbcd5b85ce202a3",
            "filename": "aio/scripts/deploy-to-firebase.spec.js",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/5f1e9758f57ce38f96dc5287c86e3ca1ce416176/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/5f1e9758f57ce38f96dc5287c86e3ca1ce416176/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.spec.js?ref=5f1e9758f57ce38f96dc5287c86e3ca1ce416176",
            "patch": "@@ -1,6 +1,7 @@\n #!/usr/bin/env node\n 'use strict';\n \n+const {execSync} = require('child_process');\n const {computeDeploymentInfo, computeInputVars, getLatestCommit} = require('./deploy-to-firebase');\n \n \n@@ -259,4 +260,23 @@ describe('deploy-to-firebase:', () => {\n           'There is a more recent branch with the same major version: \"4.4.x\"',\n     });\n   });\n+\n+  it('integration - should run the main script without error', () => {\n+    const cmd = `\"${process.execPath}\" \"${__dirname}/deploy-to-firebase\" --dry-run`;\n+    const env = {\n+      CI_REPO_OWNER: 'angular',\n+      CI_REPO_NAME: 'angular',\n+      CI_PULL_REQUEST: 'false',\n+      CI_BRANCH: 'master',\n+      CI_COMMIT: getLatestCommit('master')\n+    };\n+    const result = execSync(cmd, {encoding: 'utf8', env}).trim();\n+    expect(result).toBe(\n+        'Git branch        : master\\n' +\n+        'Build/deploy mode : next\\n' +\n+        'Firebase project  : angular-io\\n' +\n+        'Firebase site     : next-angular-io-site\\n' +\n+        'Deployment URLs   : https://next.angular.io/\\n' +\n+        '                    https://next-angular-io-site.web.app/');\n+  });\n });"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 21,
        "deletions": 1
    }
}