{
    "author": "petebacondarwin",
    "message": "fix(core): ensure the type `T` of `EventEmitter<T>` can be inferred (#40644)\n\nThe `AsyncPipe.transform<T>(emitter)` method must infer the `T`\ntype from the `emitter` parameter. Since we changed the `AsyncPipe`\nto expect a `Subscribable<T>` rather than `Observable<T>` the\n`EventEmitter.subscribe()` method needs to have a tighter signature.\nOtherwise TypeScript struggles to infer the type and ends up making\nit `unknown`.\n\nFixes #40637\n\nPR Close #40644",
    "sha": "1579df243d34f95be1744453329f7e4f1bf287f2",
    "files": [
        {
            "sha": "56dfa25b8c8f9852c88c4e5ee859bbf8f11a9675",
            "filename": "goldens/public-api/core/core.d.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1579df243d34f95be1744453329f7e4f1bf287f2/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/1579df243d34f95be1744453329f7e4f1bf287f2/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts?ref=1579df243d34f95be1744453329f7e4f1bf287f2",
            "patch": "@@ -314,7 +314,8 @@ export declare class ErrorHandler {\n export declare interface EventEmitter<T> extends Subject<T> {\n     new (isAsync?: boolean): EventEmitter<T>;\n     emit(value?: T): void;\n-    subscribe(generatorOrNext?: any, error?: any, complete?: any): Subscription;\n+    subscribe(next?: (value: T) => void, error?: (error: any) => void, complete?: () => void): Subscription;\n+    subscribe(observerOrNext?: any, error?: any, complete?: any): Subscription;\n }\n \n export declare const EventEmitter: {"
        },
        {
            "sha": "19cf051ed80a11fe5a35a49b697386c0a1d28423",
            "filename": "packages/common/test/pipes/async_pipe_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcommon%2Ftest%2Fpipes%2Fasync_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcommon%2Ftest%2Fpipes%2Fasync_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fasync_pipe_spec.ts?ref=1579df243d34f95be1744453329f7e4f1bf287f2",
            "patch": "@@ -129,6 +129,16 @@ import {SpyChangeDetectorRef} from '../spies';\n       });\n     });\n \n+    describe('Subscribable', () => {\n+      it('should infer the type from the subscribable', () => {\n+        const ref = new SpyChangeDetectorRef() as any;\n+        const pipe = new AsyncPipe(ref);\n+        const emitter = new EventEmitter<{name: 'T'}>();\n+        // The following line will fail to compile if the type cannot be inferred.\n+        const name = pipe.transform(emitter)?.name;\n+      });\n+    });\n+\n     describe('Promise', () => {\n       const message = {};\n       let pipe: AsyncPipe;"
        },
        {
            "sha": "f7a7b43eaaf953429f3541bcfbf13612c235ffdb",
            "filename": "packages/compiler-cli/src/ngtsc/testing/fake_core/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_core%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_core%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_core%2Findex.ts?ref=1579df243d34f95be1744453329f7e4f1bf287f2",
            "patch": "@@ -90,7 +90,10 @@ export const CUSTOM_ELEMENTS_SCHEMA: any = false;\n export const NO_ERRORS_SCHEMA: any = false;\n \n export class EventEmitter<T> {\n-  subscribe(generatorOrNext?: any, error?: any, complete?: any): unknown {\n+  subscribe(next?: (value: T) => void, error?: (error: any) => void, complete?: () => void):\n+      unknown;\n+  subscribe(observerOrNext?: any, error?: any, complete?: any): unknown;\n+  subscribe(observerOrNext?: any, error?: any, complete?: any): unknown {\n     return null;\n   }\n }"
        },
        {
            "sha": "8b24dc4f38a7d57a30c63d1ace4ff8b47a7d5346",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/test_utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts?ref=1579df243d34f95be1744453329f7e4f1bf287f2",
            "patch": "@@ -97,7 +97,8 @@ export function angularCoreDts(): TestFile {\n     }\n \n     export declare class EventEmitter<T> {\n-      subscribe(generatorOrNext?: any, error?: any, complete?: any): unknown;\n+      subscribe(next?: (value: T) => void, error?: (error: any) => void, complete?: () => void): unknown;\n+      subscribe(observerOrNext?: any, error?: any, complete?: any): unknown;\n     }\n \n     export declare type NgIterable<T> = Array<T> | Iterable<T>;"
        },
        {
            "sha": "b7a2bd22172aa7f1e5ae0fc20e6ef70f5520b3fc",
            "filename": "packages/core/src/event_emitter.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 20,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcore%2Fsrc%2Fevent_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/1579df243d34f95be1744453329f7e4f1bf287f2/packages%2Fcore%2Fsrc%2Fevent_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fevent_emitter.ts?ref=1579df243d34f95be1744453329f7e4f1bf287f2",
            "patch": "@@ -81,15 +81,25 @@ export interface EventEmitter<T> extends Subject<T> {\n    * @param value The value to emit.\n    */\n   emit(value?: T): void;\n+\n+  /**\n+   * Registers handlers for events emitted by this instance.\n+   * @param next When supplied, a custom handler for emitted events.\n+   * @param error When supplied, a custom handler for an error notification from this emitter.\n+   * @param complete When supplied, a custom handler for a completion notification from this\n+   *     emitter.\n+   */\n+  subscribe(next?: (value: T) => void, error?: (error: any) => void, complete?: () => void):\n+      Subscription;\n   /**\n    * Registers handlers for events emitted by this instance.\n-   * @param generatorOrNext When supplied, a custom handler for emitted events.\n-   * @param error When supplied, a custom handler for an error notification\n-   * from this emitter.\n-   * @param complete When supplied, a custom handler for a completion\n-   * notification from this emitter.\n+   * @param observerOrNext When supplied, a custom handler for emitted events, or an observer\n+   *     object.\n+   * @param error When supplied, a custom handler for an error notification from this emitter.\n+   * @param complete When supplied, a custom handler for a completion notification from this\n+   *     emitter.\n    */\n-  subscribe(generatorOrNext?: any, error?: any, complete?: any): Subscription;\n+  subscribe(observerOrNext?: any, error?: any, complete?: any): Subscription;\n }\n \n class EventEmitter_ extends Subject<any> {\n@@ -104,38 +114,38 @@ class EventEmitter_ extends Subject<any> {\n     super.next(value);\n   }\n \n-  subscribe(generatorOrNext?: any, error?: any, complete?: any): Subscription {\n+  subscribe(observerOrNext?: any, error?: any, complete?: any): Subscription {\n     let schedulerFn: (t: any) => any;\n     let errorFn = (err: any): any => null;\n     let completeFn = (): any => null;\n \n-    if (generatorOrNext && typeof generatorOrNext === 'object') {\n+    if (observerOrNext && typeof observerOrNext === 'object') {\n       schedulerFn = this.__isAsync ? (value: any) => {\n-        setTimeout(() => generatorOrNext.next(value));\n+        setTimeout(() => observerOrNext.next(value));\n       } : (value: any) => {\n-        generatorOrNext.next(value);\n+        observerOrNext.next(value);\n       };\n \n-      if (generatorOrNext.error) {\n+      if (observerOrNext.error) {\n         errorFn = this.__isAsync ? (err) => {\n-          setTimeout(() => generatorOrNext.error(err));\n+          setTimeout(() => observerOrNext.error(err));\n         } : (err) => {\n-          generatorOrNext.error(err);\n+          observerOrNext.error(err);\n         };\n       }\n \n-      if (generatorOrNext.complete) {\n+      if (observerOrNext.complete) {\n         completeFn = this.__isAsync ? () => {\n-          setTimeout(() => generatorOrNext.complete());\n+          setTimeout(() => observerOrNext.complete());\n         } : () => {\n-          generatorOrNext.complete();\n+          observerOrNext.complete();\n         };\n       }\n     } else {\n       schedulerFn = this.__isAsync ? (value: any) => {\n-        setTimeout(() => generatorOrNext(value));\n+        setTimeout(() => observerOrNext(value));\n       } : (value: any) => {\n-        generatorOrNext(value);\n+        observerOrNext(value);\n       };\n \n       if (error) {\n@@ -157,8 +167,8 @@ class EventEmitter_ extends Subject<any> {\n \n     const sink = super.subscribe(schedulerFn, errorFn, completeFn);\n \n-    if (generatorOrNext instanceof Subscription) {\n-      generatorOrNext.add(sink);\n+    if (observerOrNext instanceof Subscription) {\n+      observerOrNext.add(sink);\n     }\n \n     return sink;"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 48,
        "deletions": 23
    }
}