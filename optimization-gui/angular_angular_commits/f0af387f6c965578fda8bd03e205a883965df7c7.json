{
    "author": "petebacondarwin",
    "message": "fix(localize): ensure required XLIFF parameters are serialized (#38575)\n\nWhen extracting i18n messages from source code, the XLIFF\nserializers were missing some required attributes on the `<file>`\nelement.\n\nThis commit re-introduces the `original` property to each of XLIFF 1.2\nand 2.0 serializers. Also it adds in the required `id` property for the\nXLIFF 2.0 seralizer.\n\nFixes #38570\n\nPR Close #38575",
    "sha": "f0af387f6c965578fda8bd03e205a883965df7c7",
    "files": [
        {
            "sha": "c44f8f9d21315e46f59bdd8ca10e68f27a32ba48",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=f0af387f6c965578fda8bd03e205a883965df7c7",
            "patch": "@@ -32,7 +32,18 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     const ids = new Set<string>();\n     const xml = new XmlFile();\n     xml.startTag('xliff', {'version': '1.2', 'xmlns': 'urn:oasis:names:tc:xliff:document:1.2'});\n-    xml.startTag('file', {'source-language': this.sourceLocale, 'datatype': 'plaintext'});\n+    // NOTE: the `original` property is set to the legacy `ng2.template` value for backward\n+    // compatibility.\n+    // We could compute the file from the `message.location` property, but there could\n+    // be multiple values for this in the collection of `messages`. In that case we would probably\n+    // need to change the serializer to output a new `<file>` element for each collection of\n+    // messages that come from a particular original file, and the translation file parsers may not\n+    // be able to cope with this.\n+    xml.startTag('file', {\n+      'source-language': this.sourceLocale,\n+      'datatype': 'plaintext',\n+      'original': 'ng2.template',\n+    });\n     xml.startTag('body');\n     for (const message of messages) {\n       const id = this.getMessageId(message);"
        },
        {
            "sha": "4dd7e4f4a2824606bd479b96134c290cd9336ad7",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=f0af387f6c965578fda8bd03e205a883965df7c7",
            "patch": "@@ -36,7 +36,13 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n       'xmlns': 'urn:oasis:names:tc:xliff:document:2.0',\n       'srcLang': this.sourceLocale\n     });\n-    xml.startTag('file');\n+    // NOTE: the `original` property is set to the legacy `ng.template` value for backward\n+    // compatibility.\n+    // We could compute the file from the `message.location` property, but there could\n+    // be multiple values for this in the collection of `messages`. In that case we would probably\n+    // need to change the serializer to output a new `<file>` element for each collection of\n+    // messages that come from a particular original file, and the translation file parsers may not\n+    xml.startTag('file', {'id': 'ngi18n', 'original': 'ng.template'});\n     for (const message of messages) {\n       const id = this.getMessageId(message);\n       if (ids.has(id)) {"
        },
        {
            "sha": "3f69a2d22f215cce024b7264989a8d9e4288ff17",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=f0af387f6c965578fda8bd03e205a883965df7c7",
            "patch": "@@ -149,7 +149,7 @@ runInEachFileSystem(() => {\n           expect(fs.readFile(outputPath)).toEqual([\n             `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n             `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n-            `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n+            `  <file source-language=\"en-CA\" datatype=\"plaintext\" original=\"ng2.template\">`,\n             `    <body>`,\n             `      <trans-unit id=\"3291030485717846467\" datatype=\"html\">`,\n             `        <source>Hello, <x id=\"PH\" equiv-text=\"name\"/>!</source>`,\n@@ -218,7 +218,7 @@ runInEachFileSystem(() => {\n           expect(fs.readFile(outputPath)).toEqual([\n             `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n             `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"en-AU\">`,\n-            `  <file>`,\n+            `  <file id=\"ngi18n\" original=\"ng.template\">`,\n             `    <unit id=\"3291030485717846467\">`,\n             `      <segment>`,\n             `        <source>Hello, <ph id=\"0\" equiv=\"PH\" disp=\"name\"/>!</source>`,\n@@ -276,7 +276,7 @@ runInEachFileSystem(() => {\n            expect(fs.readFile(outputPath)).toEqual([\n              `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n              `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n-             `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n+             `  <file source-language=\"en-CA\" datatype=\"plaintext\" original=\"ng2.template\">`,\n              `    <body>`,\n              `      <trans-unit id=\"157258427077572998\" datatype=\"html\">`,\n              `        <source>Message in <x id=\"a-file\" equiv-text=\"file\"/>!</source>`,"
        },
        {
            "sha": "f421850a3270e57f70c612d02a11cbc39553c2d6",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=f0af387f6c965578fda8bd03e205a883965df7c7",
            "patch": "@@ -72,7 +72,7 @@ runInEachFileSystem(() => {\n           expect(output).toEqual([\n             `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n             `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n-            `  <file source-language=\"xx\" datatype=\"plaintext\">`,\n+            `  <file source-language=\"xx\" datatype=\"plaintext\" original=\"ng2.template\">`,\n             `    <body>`,\n             `      <trans-unit id=\"${\n                 useLegacyIds ? '1234567890ABCDEF1234567890ABCDEF12345678' :"
        },
        {
            "sha": "d783e0ce9f914b6ba45ef93ce5e84b915d0df329",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0af387f6c965578fda8bd03e205a883965df7c7/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=f0af387f6c965578fda8bd03e205a883965df7c7",
            "patch": "@@ -77,7 +77,7 @@ runInEachFileSystem(() => {\n           expect(output).toEqual([\n             `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n             `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"xx\">`,\n-            `  <file>`,\n+            `  <file id=\"ngi18n\" original=\"ng.template\">`,\n             `    <unit id=\"${useLegacyIds ? '615790887472569365' : '12345'}\">`,\n             `      <notes>`,\n             `        <note category=\"location\">file.ts:6</note>`,"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 24,
        "deletions": 7
    }
}