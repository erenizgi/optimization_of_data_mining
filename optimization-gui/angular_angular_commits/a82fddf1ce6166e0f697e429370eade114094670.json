{
    "author": "atscott",
    "message": "feat(router): Allow for custom router outlet implementations (#40827)\n\nThis PR formalizes, documents, and makes public the router outlet contract.\n\nThe set of `RouterOutlet` methods used by the `Router` has not changed\nin over 4 years, since the introduction of route reuse strategies.\n\nCreation of custom router outlets is already possible and is used by the\nIonic framework\n(https://github.com/ionic-team/ionic-framework/blob/master/angular/src/directives/navigation/ion-router-outlet.ts).\nThere is a small \"hack\" that is needed to make this work, which is that\noutlets must register with `ChildrenOutletContexts`, but it currently\nonly accepts our `RouterOutlet`.\n\nBy exposing the interface the `Router` uses to activate and deactivate\nroutes through outlets, we allow for developers to more easily and safely\nextend the `Router` and have fine-tuned control over navigation and component\nactivation that fits project requirements.\n\nPR Close #40827",
    "sha": "a82fddf1ce6166e0f697e429370eade114094670",
    "files": [
        {
            "sha": "f0ac9d190fae0562fb88c0eb870216b02d2108fb",
            "filename": "goldens/public-api/router/router.d.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/a82fddf1ce6166e0f697e429370eade114094670/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/a82fddf1ce6166e0f697e429370eade114094670/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts?ref=a82fddf1ce6166e0f697e429370eade114094670",
            "patch": "@@ -92,7 +92,7 @@ export declare class ChildActivationStart {\n export declare class ChildrenOutletContexts {\n     getContext(childName: string): OutletContext | null;\n     getOrCreateContext(childName: string): OutletContext;\n-    onChildOutletCreated(childName: string, outlet: RouterOutlet): void;\n+    onChildOutletCreated(childName: string, outlet: RouterOutletContract): void;\n     onChildOutletDestroyed(childName: string): void;\n     onOutletDeactivated(): Map<string, OutletContext>;\n     onOutletReAttached(contexts: Map<string, OutletContext>): void;\n@@ -234,7 +234,7 @@ export declare class NoPreloading implements PreloadingStrategy {\n export declare class OutletContext {\n     attachRef: ComponentRef<any> | null;\n     children: ChildrenOutletContexts;\n-    outlet: RouterOutlet | null;\n+    outlet: RouterOutletContract | null;\n     resolver: ComponentFactoryResolver | null;\n     route: ActivatedRoute | null;\n }\n@@ -434,7 +434,7 @@ export declare class RouterModule {\n     static forRoot(routes: Routes, config?: ExtraOptions): ModuleWithProviders<RouterModule>;\n }\n \n-export declare class RouterOutlet implements OnDestroy, OnInit {\n+export declare class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     activateEvents: EventEmitter<any>;\n     get activatedRoute(): ActivatedRoute;\n     get activatedRouteData(): Data;\n@@ -450,6 +450,17 @@ export declare class RouterOutlet implements OnDestroy, OnInit {\n     ngOnInit(): void;\n }\n \n+export declare interface RouterOutletContract {\n+    activatedRoute: ActivatedRoute | null;\n+    activatedRouteData: Data;\n+    component: Object | null;\n+    isActivated: boolean;\n+    activateWith(activatedRoute: ActivatedRoute, resolver: ComponentFactoryResolver | null): void;\n+    attach(ref: ComponentRef<unknown>, activatedRoute: ActivatedRoute): void;\n+    deactivate(): void;\n+    detach(): ComponentRef<unknown>;\n+}\n+\n export declare class RouterPreloader implements OnDestroy {\n     constructor(router: Router, moduleLoader: NgModuleFactoryLoader, compiler: Compiler, injector: Injector, preloadingStrategy: PreloadingStrategy);\n     ngOnDestroy(): void;"
        },
        {
            "sha": "34c158262e163e78e10d04e50dea67c87818a15d",
            "filename": "packages/router/src/directives/router_outlet.ts",
            "status": "modified",
            "additions": 66,
            "deletions": 1,
            "changes": 67,
            "blob_url": "https://github.com/angular/angular/blob/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts",
            "raw_url": "https://github.com/angular/angular/raw/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts?ref=a82fddf1ce6166e0f697e429370eade114094670",
            "patch": "@@ -13,6 +13,67 @@ import {ChildrenOutletContexts} from '../router_outlet_context';\n import {ActivatedRoute} from '../router_state';\n import {PRIMARY_OUTLET} from '../shared';\n \n+/**\n+ * An interface that defines the contract for developing a component outlet for the `Router`.\n+ *\n+ * An outlet acts as a placeholder that Angular dynamically fills based on the current router state.\n+ *\n+ * A router outlet should register itself with the `Router` via\n+ * `ChildrenOutletContexts#onChildOutletCreated` and unregister with\n+ * `ChildrenOutletContexts#onChildOutletDestroyed`. When the `Router` identifies a matched `Route`,\n+ * it looks for a registered outlet in the `ChildrenOutletContexts` and activates it.\n+ *\n+ * @see `ChildrenOutletContexts`\n+ * @publicApi\n+ */\n+export interface RouterOutletContract {\n+  /**\n+   * Whether the given outlet is activated.\n+   *\n+   * An outlet is considered \"activated\" if it has an active component.\n+   */\n+  isActivated: boolean;\n+\n+  /** The instance of the activated component or `null` if the outlet is not activated. */\n+  component: Object|null;\n+\n+  /**\n+   * The `Data` of the `ActivatedRoute` snapshot.\n+   */\n+  activatedRouteData: Data;\n+\n+  /**\n+   * The `ActivatedRoute` for the outlet or `null` if the outlet is not activated.\n+   */\n+  activatedRoute: ActivatedRoute|null;\n+\n+  /**\n+   * Called by the `Router` when the outlet should activate (create a component).\n+   */\n+  activateWith(activatedRoute: ActivatedRoute, resolver: ComponentFactoryResolver|null): void;\n+\n+  /**\n+   * A request to destroy the currently activated component.\n+   *\n+   * When a `RouteReuseStrategy` indicates that an `ActivatedRoute` should be removed but stored for\n+   * later re-use rather than destroyed, the `Router` will call `detach` instead.\n+   */\n+  deactivate(): void;\n+\n+  /**\n+   * Called when the `RouteReuseStrategy` instructs to detach the subtree.\n+   *\n+   * This is similar to `deactivate`, but the activated component should _not_ be destroyed.\n+   * Instead, it is returned so that it can be reattached later via the `attach` method.\n+   */\n+  detach(): ComponentRef<unknown>;\n+\n+  /**\n+   * Called when the `RouteReuseStrategy` instructs to re-attach a previously detached subtree.\n+   */\n+  attach(ref: ComponentRef<unknown>, activatedRoute: ActivatedRoute): void;\n+}\n+\n /**\n  * @description\n  *\n@@ -60,7 +121,7 @@ import {PRIMARY_OUTLET} from '../shared';\n  * @publicApi\n  */\n @Directive({selector: 'router-outlet', exportAs: 'outlet'})\n-export class RouterOutlet implements OnDestroy, OnInit {\n+export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n   private activated: ComponentRef<any>|null = null;\n   private _activatedRoute: ActivatedRoute|null = null;\n   private name: string;\n@@ -103,6 +164,10 @@ export class RouterOutlet implements OnDestroy, OnInit {\n     return !!this.activated;\n   }\n \n+  /**\n+   * @returns The currently activated component instance.\n+   * @throws An error if the outlet is not activated.\n+   */\n   get component(): Object {\n     if (!this.activated) throw new Error('Outlet is not activated');\n     return this.activated.instance;"
        },
        {
            "sha": "688323fecedc424e4bcb575b14e6b48324edfc70",
            "filename": "packages/router/src/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Findex.ts?ref=a82fddf1ce6166e0f697e429370eade114094670",
            "patch": "@@ -10,7 +10,7 @@\n export {Data, DeprecatedLoadChildren, LoadChildren, LoadChildrenCallback, QueryParamsHandling, ResolveData, Route, Routes, RunGuardsAndResolvers, UrlMatcher, UrlMatchResult} from './config';\n export {RouterLink, RouterLinkWithHref} from './directives/router_link';\n export {RouterLinkActive} from './directives/router_link_active';\n-export {RouterOutlet} from './directives/router_outlet';\n+export {RouterOutlet, RouterOutletContract} from './directives/router_outlet';\n export {ActivationEnd, ActivationStart, ChildActivationEnd, ChildActivationStart, Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationEnd, NavigationError, NavigationStart, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RouterEvent, RoutesRecognized, Scroll} from './events';\n export {CanActivate, CanActivateChild, CanDeactivate, CanLoad, Resolve} from './interfaces';\n export {BaseRouteReuseStrategy, DetachedRouteHandle, RouteReuseStrategy} from './route_reuse_strategy';"
        },
        {
            "sha": "d0485f4d01835c495345017b89662b2c6a96df24",
            "filename": "packages/router/src/router_outlet_context.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Frouter_outlet_context.ts",
            "raw_url": "https://github.com/angular/angular/raw/a82fddf1ce6166e0f697e429370eade114094670/packages%2Frouter%2Fsrc%2Frouter_outlet_context.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter_outlet_context.ts?ref=a82fddf1ce6166e0f697e429370eade114094670",
            "patch": "@@ -8,7 +8,7 @@\n \n import {ComponentFactoryResolver, ComponentRef} from '@angular/core';\n \n-import {RouterOutlet} from './directives/router_outlet';\n+import {RouterOutletContract} from './directives/router_outlet';\n import {ActivatedRoute} from './router_state';\n \n \n@@ -18,7 +18,7 @@ import {ActivatedRoute} from './router_state';\n  * @publicApi\n  */\n export class OutletContext {\n-  outlet: RouterOutlet|null = null;\n+  outlet: RouterOutletContract|null = null;\n   route: ActivatedRoute|null = null;\n   resolver: ComponentFactoryResolver|null = null;\n   children = new ChildrenOutletContexts();\n@@ -35,7 +35,7 @@ export class ChildrenOutletContexts {\n   private contexts = new Map<string, OutletContext>();\n \n   /** Called when a `RouterOutlet` directive is instantiated */\n-  onChildOutletCreated(childName: string, outlet: RouterOutlet): void {\n+  onChildOutletCreated(childName: string, outlet: RouterOutletContract): void {\n     const context = this.getOrCreateContext(childName);\n     context.outlet = outlet;\n     this.contexts.set(childName, context);"
        }
    ],
    "stats": {
        "total": 92,
        "additions": 84,
        "deletions": 8
    }
}