{
    "author": "atscott",
    "message": "fix(common): Allow scrolling when browser supports scrollTo (#38468)\n\nThis commit fixes a regression from \"fix(common): ensure\nscrollRestoration is writable (#30630)\" that caused scrolling to not\nhappen at all in browsers that do not support scroll restoration. The\nissue was that `supportScrollRestoration` was updated to return `false`\nif a browser did not have a writable `scrollRestoration`. However, the\nprevious behavior was that the function would return `true` if\n`window.scrollTo` was defined. Every scrolling function in the\n`ViewportScroller` used `supportScrollRestoration` and, with the update\nin bb88c9fa3daac80086efbda951d81c159e3840f4, no scrolling would be\nperformed if a browser did not have writable `scrollRestoration` but\n_did_ have `window.scrollTo`.\n\nNote, that this failure was detected in the saucelabs tests. IE does not\nsupport scroll restoration so IE tests were failing.\n\nPR Close #38468",
    "sha": "71079ce47e974df4139fb7f93cca5cc4da237a9d",
    "files": [
        {
            "sha": "a7c9093426938bb0151819e96d7b6b8a0b6d0c97",
            "filename": "packages/common/src/viewport_scroller.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/71079ce47e974df4139fb7f93cca5cc4da237a9d/packages%2Fcommon%2Fsrc%2Fviewport_scroller.ts",
            "raw_url": "https://github.com/angular/angular/raw/71079ce47e974df4139fb7f93cca5cc4da237a9d/packages%2Fcommon%2Fsrc%2Fviewport_scroller.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fviewport_scroller.ts?ref=71079ce47e974df4139fb7f93cca5cc4da237a9d",
            "patch": "@@ -88,7 +88,7 @@ export class BrowserViewportScroller implements ViewportScroller {\n    * @returns The position in screen coordinates.\n    */\n   getScrollPosition(): [number, number] {\n-    if (this.supportScrollRestoration()) {\n+    if (this.supportsScrolling()) {\n       return [this.window.scrollX, this.window.scrollY];\n     } else {\n       return [0, 0];\n@@ -100,7 +100,7 @@ export class BrowserViewportScroller implements ViewportScroller {\n    * @param position The new position in screen coordinates.\n    */\n   scrollToPosition(position: [number, number]): void {\n-    if (this.supportScrollRestoration()) {\n+    if (this.supportsScrolling()) {\n       this.window.scrollTo(position[0], position[1]);\n     }\n   }\n@@ -110,7 +110,7 @@ export class BrowserViewportScroller implements ViewportScroller {\n    * @param anchor The ID of the anchor element.\n    */\n   scrollToAnchor(anchor: string): void {\n-    if (this.supportScrollRestoration()) {\n+    if (this.supportsScrolling()) {\n       const elSelected =\n           this.document.getElementById(anchor) || this.document.getElementsByName(anchor)[0];\n       if (elSelected) {\n@@ -163,6 +163,14 @@ export class BrowserViewportScroller implements ViewportScroller {\n       return false;\n     }\n   }\n+\n+  private supportsScrolling(): boolean {\n+    try {\n+      return !!this.window.scrollTo;\n+    } catch {\n+      return false;\n+    }\n+  }\n }\n \n function getScrollRestorationProperty(obj: any): PropertyDescriptor|undefined {"
        },
        {
            "sha": "006702e985038d71e261deb49471470149f3ad9c",
            "filename": "packages/common/test/viewport_scroller_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/71079ce47e974df4139fb7f93cca5cc4da237a9d/packages%2Fcommon%2Ftest%2Fviewport_scroller_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/71079ce47e974df4139fb7f93cca5cc4da237a9d/packages%2Fcommon%2Ftest%2Fviewport_scroller_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fviewport_scroller_spec.ts?ref=71079ce47e974df4139fb7f93cca5cc4da237a9d",
            "patch": "@@ -15,21 +15,30 @@ describe('BrowserViewportScroller', () => {\n   let windowSpy: any;\n \n   beforeEach(() => {\n-    windowSpy = jasmine.createSpyObj('window', ['history']);\n-    windowSpy.scrollTo = 1;\n+    windowSpy = jasmine.createSpyObj('window', ['history', 'scrollTo']);\n     windowSpy.history.scrollRestoration = 'auto';\n     documentSpy = jasmine.createSpyObj('document', ['getElementById', 'getElementsByName']);\n     scroller = new BrowserViewportScroller(documentSpy, windowSpy, null!);\n   });\n \n   describe('setHistoryScrollRestoration', () => {\n-    it('should not crash when scrollRestoration is not writable', () => {\n+    function createNonWritableScrollRestoration() {\n       Object.defineProperty(windowSpy.history, 'scrollRestoration', {\n         value: 'auto',\n         configurable: true,\n       });\n+    }\n+\n+    it('should not crash when scrollRestoration is not writable', () => {\n+      createNonWritableScrollRestoration();\n       expect(() => scroller.setHistoryScrollRestoration('manual')).not.toThrow();\n     });\n+\n+    it('should still allow scrolling if scrollRestoration is not writable', () => {\n+      createNonWritableScrollRestoration();\n+      scroller.scrollToPosition([10, 10]);\n+      expect(windowSpy.scrollTo as jasmine.Spy).toHaveBeenCalledWith(10, 10);\n+    });\n   });\n \n   describe('scrollToAnchor', () => {"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 23,
        "deletions": 6
    }
}