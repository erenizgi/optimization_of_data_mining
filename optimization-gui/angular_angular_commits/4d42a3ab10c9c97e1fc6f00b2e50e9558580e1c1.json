{
    "author": "danieltre23",
    "message": "test(compiler-cli): add extended template diagnostics end-to-end tests (#43107)\n\nThis commit adds extended template diagnostics end-to-end tests, to make\nsure the diagnostics are generated correctly. Template checks are\nalready tested with unit tests.\n\nRefs #42966\n\nPR Close #43107",
    "sha": "4d42a3ab10c9c97e1fc6f00b2e50e9558580e1c1",
    "files": [
        {
            "sha": "74c413169b709472785e34584c3375295ebe61a2",
            "filename": "packages/compiler-cli/test/ngtsc/extended_template_diagnostics_spec.ts",
            "status": "added",
            "additions": 107,
            "deletions": 0,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/4d42a3ab10c9c97e1fc6f00b2e50e9558580e1c1/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d42a3ab10c9c97e1fc6f00b2e50e9558580e1c1/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts?ref=4d42a3ab10c9c97e1fc6f00b2e50e9558580e1c1",
            "patch": "@@ -0,0 +1,107 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+import {ErrorCode} from '../../src/ngtsc/diagnostics';\n+import {runInEachFileSystem} from '../../src/ngtsc/file_system/testing';\n+import {getSourceCodeForDiagnostic, loadStandardTestFiles} from '../../src/ngtsc/testing';\n+\n+import {NgtscTestEnvironment} from './env';\n+\n+const testFiles = loadStandardTestFiles({fakeCore: true, fakeCommon: true});\n+\n+runInEachFileSystem(() => {\n+  describe('ngtsc extended template checks', () => {\n+    let env!: NgtscTestEnvironment;\n+\n+    beforeEach(() => {\n+      env = NgtscTestEnvironment.setup(testFiles);\n+      env.tsconfig({_extendedTemplateDiagnostics: true, strictTemplates: true});\n+    });\n+\n+    it('should produce invalid banana in box warning', () => {\n+      env.write('test.ts', `\n+              import {Component} from '@angular/core';\n+              @Component({\n+                selector: 'test',\n+                template: '<div ([notARealThing])=\"bar\"></div>',\n+              })\n+              class TestCmp { \n+                bar: string = \"text\"; \n+              }\n+            `);\n+\n+      const diags = env.driveDiagnostics();\n+      expect(diags.length).toBe(1);\n+      expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n+      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"bar\"');\n+    });\n+\n+    it('should produce invalid banana in box warning with external html file', () => {\n+      env.write('test.ts', `\n+              import {Component} from '@angular/core';\n+              @Component({\n+                selector: 'test',\n+                templateUrl: './test.html',\n+              })\n+              class TestCmp { \n+                bar: string = \"text\"; \n+              }\n+            `);\n+\n+      env.write('test.html', `\n+              <div ([notARealThing])=\"bar\"></div>\n+            `);\n+\n+      const diags = env.driveDiagnostics();\n+      expect(diags.length).toBe(1);\n+      expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n+      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"bar\"');\n+    });\n+\n+    it('should not produce extended diagnostics if flag is disabled', () => {\n+      env.tsconfig({_extendedTemplateDiagnostics: false});\n+      env.write('test.ts', `\n+              import {Component} from '@angular/core';\n+              @Component({\n+                selector: 'test',\n+                template: '<div ([notARealThing])=\"bar\"></div>',\n+              })\n+              class TestCmp { \n+                bar: string = \"text\"; \n+              }\n+            `);\n+\n+      const diags = env.driveDiagnostics();\n+      expect(diags.length).toBe(0);\n+    });\n+\n+    it('should throw error if _extendedTemplateDiagnostics option is enabled and strictTemplates disabled',\n+       () => {\n+         env.tsconfig({_extendedTemplateDiagnostics: true, strictTemplates: false});\n+         env.write('test.ts', `\n+              import {Component} from '@angular/core';\n+              @Component({\n+                selector: 'test',\n+                template: '<div ([notARealThing])=\"bar\"></div>',\n+              })\n+              class TestCmp { \n+                bar: string = \"text\"; \n+              }\n+            `);\n+\n+         const diags = env.driveDiagnostics();\n+         expect(diags.length).toBe(1);\n+         expect(diags[0].messageText)\n+             .toMatch(\n+                 /Error: The '_extendedTemplateDiagnostics' option requires 'strictTemplates' to also be enabled./);\n+       });\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 107,
        "additions": 107,
        "deletions": 0
    }
}