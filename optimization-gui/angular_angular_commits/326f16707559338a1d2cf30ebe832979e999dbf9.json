{
    "author": "petebacondarwin",
    "message": "refactor(core): remove `getFactoryOf` from `angularCoreDiEnv` (#41040)\n\nThis function is never actually generated directly so it can be removed\nfrom the context passed to the JIT compiler.\n\nPR Close #41040",
    "sha": "326f16707559338a1d2cf30ebe832979e999dbf9",
    "files": [
        {
            "sha": "ef075ebf78363a92d8b4d9280da6d839916be3d0",
            "filename": "packages/compiler/src/render3/r3_factory.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 24,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts?ref=326f16707559338a1d2cf30ebe832979e999dbf9",
            "patch": "@@ -71,12 +71,6 @@ export interface R3ConstructorFactoryMetadata {\n export enum R3FactoryDelegateType {\n   Class,\n   Function,\n-  Factory,\n-}\n-\n-export interface R3DelegatedFactoryMetadata extends R3ConstructorFactoryMetadata {\n-  delegate: o.Expression;\n-  delegateType: R3FactoryDelegateType.Factory;\n }\n \n export interface R3DelegatedFnOrClassMetadata extends R3ConstructorFactoryMetadata {\n@@ -89,8 +83,8 @@ export interface R3ExpressionFactoryMetadata extends R3ConstructorFactoryMetadat\n   expression: o.Expression;\n }\n \n-export type R3FactoryMetadata = R3ConstructorFactoryMetadata|R3DelegatedFactoryMetadata|\n-    R3DelegatedFnOrClassMetadata|R3ExpressionFactoryMetadata;\n+export type R3FactoryMetadata =\n+    R3ConstructorFactoryMetadata|R3DelegatedFnOrClassMetadata|R3ExpressionFactoryMetadata;\n \n export enum R3FactoryTarget {\n   Directive = 0,\n@@ -239,20 +233,7 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3FactoryFn {\n     return r;\n   }\n \n-  if (isDelegatedMetadata(meta) && meta.delegateType === R3FactoryDelegateType.Factory) {\n-    const delegateFactory = o.variable(`ɵ${meta.name}_BaseFactory`);\n-    const getFactoryOf = o.importExpr(R3.getFactoryOf);\n-    if (meta.delegate.isEquivalent(meta.internalType)) {\n-      throw new Error(`Illegal state: compiling factory that delegates to itself`);\n-    }\n-    const delegateFactoryStmt =\n-        delegateFactory.set(getFactoryOf.callFn([meta.delegate])).toDeclStmt(o.INFERRED_TYPE, [\n-          o.StmtModifier.Exported, o.StmtModifier.Final\n-        ]);\n-\n-    statements.push(delegateFactoryStmt);\n-    retExpr = makeConditionalFactory(delegateFactory.callFn([]));\n-  } else if (isDelegatedMetadata(meta)) {\n+  if (isDelegatedMetadata(meta)) {\n     // This type is created with a delegated factory. If a type parameter is not specified, call\n     // the factory instead.\n     const delegateArgs =\n@@ -418,8 +399,7 @@ export function dependenciesFromGlobalMetadata(\n   return deps;\n }\n \n-function isDelegatedMetadata(meta: R3FactoryMetadata): meta is R3DelegatedFactoryMetadata|\n-    R3DelegatedFnOrClassMetadata {\n+function isDelegatedMetadata(meta: R3FactoryMetadata): meta is R3DelegatedFnOrClassMetadata {\n   return (meta as any).delegateType !== undefined;\n }\n "
        },
        {
            "sha": "5362f17979ddd228165b20b9639df9df9be0dc25",
            "filename": "packages/compiler/src/render3/r3_identifiers.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "raw_url": "https://github.com/angular/angular/raw/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts?ref=326f16707559338a1d2cf30ebe832979e999dbf9",
            "patch": "@@ -313,11 +313,6 @@ export class Identifiers {\n \n   static listener: o.ExternalReference = {name: 'ɵɵlistener', moduleName: CORE};\n \n-  static getFactoryOf: o.ExternalReference = {\n-    name: 'ɵɵgetFactoryOf',\n-    moduleName: CORE,\n-  };\n-\n   static getInheritedFactory: o.ExternalReference = {\n     name: 'ɵɵgetInheritedFactory',\n     moduleName: CORE,"
        },
        {
            "sha": "c77c0e1f1a5f87d773019706424ebabd4b37edf3",
            "filename": "packages/core/src/di/jit/environment.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 24,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Fenvironment.ts",
            "raw_url": "https://github.com/angular/angular/raw/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Fenvironment.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Fenvironment.ts?ref=326f16707559338a1d2cf30ebe832979e999dbf9",
            "patch": "@@ -5,13 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-\n-import {Type} from '../../interface/type';\n-import {isForwardRef, resolveForwardRef} from '../forward_ref';\n import {ɵɵinject, ɵɵinvalidFactoryDep} from '../injector_compatibility';\n-import {getInjectableDef, getInjectorDef, ɵɵdefineInjectable, ɵɵdefineInjector} from '../interface/defs';\n-\n-\n+import {ɵɵdefineInjectable, ɵɵdefineInjector} from '../interface/defs';\n \n /**\n  * A mapping of the @angular/core API surface used in generated expressions to the actual symbols.\n@@ -22,23 +17,5 @@ export const angularCoreDiEnv: {[name: string]: Function} = {\n   'ɵɵdefineInjectable': ɵɵdefineInjectable,\n   'ɵɵdefineInjector': ɵɵdefineInjector,\n   'ɵɵinject': ɵɵinject,\n-  'ɵɵgetFactoryOf': getFactoryOf,\n   'ɵɵinvalidFactoryDep': ɵɵinvalidFactoryDep,\n };\n-\n-function getFactoryOf<T>(type: Type<any>): ((type?: Type<T>) => T)|null {\n-  const typeAny = type as any;\n-\n-  if (isForwardRef(type)) {\n-    return (() => {\n-             const factory = getFactoryOf<T>(resolveForwardRef(typeAny));\n-             return factory ? factory() : null;\n-           }) as any;\n-  }\n-\n-  const def = getInjectableDef<T>(typeAny) || getInjectorDef<T>(typeAny);\n-  if (!def || def.factory === undefined) {\n-    return null;\n-  }\n-  return def.factory;\n-}"
        },
        {
            "sha": "8486e4065534c67ea0f4f1fe7ad055346a0314b9",
            "filename": "packages/core/src/render3/jit/environment.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "raw_url": "https://github.com/angular/angular/raw/326f16707559338a1d2cf30ebe832979e999dbf9/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts?ref=326f16707559338a1d2cf30ebe832979e999dbf9",
            "patch": "@@ -37,7 +37,6 @@ export const angularCoreEnv: {[name: string]: Function} =\n        'ɵɵdefineNgModule': r3.ɵɵdefineNgModule,\n        'ɵɵdefinePipe': r3.ɵɵdefinePipe,\n        'ɵɵdirectiveInject': r3.ɵɵdirectiveInject,\n-       'ɵɵgetFactoryOf': r3.ɵɵgetFactoryOf,\n        'ɵɵgetInheritedFactory': r3.ɵɵgetInheritedFactory,\n        'ɵɵinject': ɵɵinject,\n        'ɵɵinjectAttribute': r3.ɵɵinjectAttribute,"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 5,
        "deletions": 54
    }
}