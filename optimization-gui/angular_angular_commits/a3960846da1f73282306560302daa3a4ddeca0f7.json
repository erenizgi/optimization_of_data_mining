{
    "author": "AndrewKushnir",
    "message": "feat(core): add `createNgModuleRef` function to create `NgModuleRef` based on NgModule class (#43580)\n\nNgModule factories are obsolete with Ivy and most of the operations can already be performed with NgModule classes without retreieving corresponding factories. NgModule factories were useful to generate an `NgModuleRef` (via `NgModuleFactory.create` method). This commit adds a new function to create an instance of the `NgModuleRef` class without having the need to create a factory first.\n\nPR Close #43580",
    "sha": "a3960846da1f73282306560302daa3a4ddeca0f7",
    "files": [
        {
            "sha": "fd51ba98bf3d84068dce905e8c65126b751545fd",
            "filename": "goldens/public-api/core/core.md",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/a3960846da1f73282306560302daa3a4ddeca0f7/goldens%2Fpublic-api%2Fcore%2Fcore.md",
            "raw_url": "https://github.com/angular/angular/raw/a3960846da1f73282306560302daa3a4ddeca0f7/goldens%2Fpublic-api%2Fcore%2Fcore.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcore%2Fcore.md?ref=a3960846da1f73282306560302daa3a4ddeca0f7",
            "patch": "@@ -280,6 +280,9 @@ export interface ContentChildrenDecorator {\n     }): Query;\n }\n \n+// @public\n+export const createNgModuleRef: <T>(ngModule: Type<T>, parentInjector?: Injector) => NgModuleRef<T>;\n+\n // @public\n export function createPlatform(injector: Injector): PlatformRef;\n "
        },
        {
            "sha": "1a4ef3cf1a766a8b94d7189ce684a5ceb489097f",
            "filename": "packages/core/src/core.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Fsrc%2Fcore.ts",
            "raw_url": "https://github.com/angular/angular/raw/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Fsrc%2Fcore.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore.ts?ref=a3960846da1f73282306560302daa3a4ddeca0f7",
            "patch": "@@ -37,6 +37,7 @@ export * from './core_render3_private_export';\n export {SecurityContext} from './sanitization/security';\n export {Sanitizer} from './sanitization/sanitizer';\n export * from './codegen_private_exports';\n+export {createNgModuleRef} from './render3/ng_module_ref';\n \n import {global} from './util/global';\n if (typeof ngDevMode !== 'undefined' && ngDevMode) {"
        },
        {
            "sha": "cdf6a8778f20cc149330b45af31d7c0c41c753f6",
            "filename": "packages/core/src/render3/ng_module_ref.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Fsrc%2Frender3%2Fng_module_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Fsrc%2Frender3%2Fng_module_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fng_module_ref.ts?ref=a3960846da1f73282306560302daa3a4ddeca0f7",
            "patch": "@@ -23,6 +23,27 @@ import {getNgLocaleIdDef, getNgModuleDef} from './definition';\n import {setLocaleId} from './i18n/i18n_locale_id';\n import {maybeUnwrapFn} from './util/misc_utils';\n \n+\n+export function createNgModuleRef__PRE_R3__<T>(\n+    ngModule: Type<T>, parentInjector?: Injector): NgModuleRef<T> {\n+  throw new Error(`This API is Ivy-only and is not supported in ViewEngine`);\n+}\n+\n+export function createNgModuleRef__POST_R3__<T>(\n+    ngModule: Type<T>, parentInjector?: Injector): NgModuleRef<T> {\n+  return new NgModuleRef<T>(ngModule, parentInjector ?? null);\n+}\n+\n+/**\n+ * Returns a new NgModuleRef instance based on the NgModule class and parent injector provided.\n+ * @param ngModule NgModule class.\n+ * @param parentInjector Optional injector instance to use as a parent for the module injector. If\n+ *     not provided, `NullInjector` will be used instead.\n+ * @publicApi\n+ */\n+export const createNgModuleRef: <T>(ngModule: Type<T>, parentInjector?: Injector) =>\n+    viewEngine_NgModuleRef<T> = createNgModuleRef__PRE_R3__;\n+\n export class NgModuleRef<T> extends viewEngine_NgModuleRef<T> implements InternalNgModuleRef<T> {\n   // tslint:disable-next-line:require-internal-with-underscore\n   _bootstrapComponents: Type<any>[] = [];"
        },
        {
            "sha": "169b243178c562f36eebb48be81256bc422c93e3",
            "filename": "packages/core/test/acceptance/ng_module_spec.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 1,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Ftest%2Facceptance%2Fng_module_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a3960846da1f73282306560302daa3a4ddeca0f7/packages%2Fcore%2Ftest%2Facceptance%2Fng_module_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fng_module_spec.ts?ref=a3960846da1f73282306560302daa3a4ddeca0f7",
            "patch": "@@ -7,7 +7,8 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Component, CUSTOM_ELEMENTS_SCHEMA, destroyPlatform, Injectable, InjectionToken, NgModule, NgModuleRef, NO_ERRORS_SCHEMA, ɵsetClassMetadata as setClassMetadata, ɵɵdefineComponent as defineComponent, ɵɵdefineInjector as defineInjector, ɵɵdefineNgModule as defineNgModule, ɵɵelement as element, ɵɵproperty as property} from '@angular/core';\n+import {Component, createNgModuleRef, CUSTOM_ELEMENTS_SCHEMA, destroyPlatform, Injectable, InjectionToken, NgModule, NgModuleRef, NO_ERRORS_SCHEMA, ɵsetClassMetadata as setClassMetadata, ɵɵdefineComponent as defineComponent, ɵɵdefineInjector as defineInjector, ɵɵdefineNgModule as defineNgModule, ɵɵelement as element, ɵɵproperty as property} from '@angular/core';\n+import {ivyEnabled} from '@angular/core/src/ivy_switch';\n import {TestBed} from '@angular/core/testing';\n import {BrowserModule} from '@angular/platform-browser';\n import {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\n@@ -631,6 +632,47 @@ describe('NgModule', () => {\n         });\n   });\n \n+  describe('createNgModuleRef function', () => {\n+    it('should create an NgModuleRef instance', () => {\n+      const TOKEN_A = new InjectionToken('A');\n+      const TOKEN_B = new InjectionToken('B');\n+      @NgModule({\n+        providers: [\n+          {provide: TOKEN_A, useValue: 'TokenValueA'},\n+        ]\n+      })\n+      class AppModule {\n+      }\n+\n+      @NgModule({\n+        providers: [\n+          {provide: TOKEN_B, useValue: 'TokenValueB'},\n+        ]\n+      })\n+      class ChildModule {\n+      }\n+\n+      if (ivyEnabled) {\n+        // Simple case, just passing NgModule class.\n+        const ngModuleRef = createNgModuleRef(AppModule);\n+        expect(ngModuleRef).toBeAnInstanceOf(NgModuleRef);\n+        expect(ngModuleRef.injector.get(TOKEN_A)).toBe('TokenValueA');\n+        expect(ngModuleRef.injector.get(TOKEN_B, null)).toBe(null);\n+\n+        // Both NgModule and parent Injector are present.\n+        const ngModuleRef2 =\n+            createNgModuleRef(ChildModule, ngModuleRef.injector /* parent injector */);\n+        expect(ngModuleRef2).toBeAnInstanceOf(NgModuleRef);\n+        expect(ngModuleRef2.injector.get(TOKEN_A)).toBe('TokenValueA');\n+        expect(ngModuleRef2.injector.get(TOKEN_B)).toBe('TokenValueB');\n+      } else {\n+        // ViewEngine doesn't support this API, expect it to throw.\n+        expect(() => createNgModuleRef(AppModule))\n+            .toThrowError('This API is Ivy-only and is not supported in ViewEngine');\n+      }\n+    });\n+  });\n+\n   it('should be able to use DI through the NgModuleRef inside the module constructor', () => {\n     const token = new InjectionToken<string>('token');\n     let value: string|undefined;"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 68,
        "deletions": 1
    }
}