{
    "author": "petebacondarwin",
    "message": "refactor(compiler): add source-map spans to localized strings (#32912)\n\nPreviously localized strings were not mapped to their original\nsource location, so it was not possible to back-trace them\nin tools like the i18n message extractor.\n\nPR Close #32912",
    "sha": "dda3f49952b8e12f7ec63fea8ab64fed0bb238c5",
    "files": [
        {
            "sha": "c91a6bdf59b103f18cf37a87b5faabd7f84af40c",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/dda3f49952b8e12f7ec63fea8ab64fed0bb238c5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/dda3f49952b8e12f7ec63fea8ab64fed0bb238c5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=dda3f49952b8e12f7ec63fea8ab64fed0bb238c5",
            "patch": "@@ -274,9 +274,11 @@ class ExpressionTranslatorVisitor implements ExpressionVisitor, StatementVisitor\n   }\n \n   visitLocalizedString(ast: LocalizedString, context: Context): ts.Expression {\n-    return this.scriptTarget >= ts.ScriptTarget.ES2015 ?\n+    const localizedString = this.scriptTarget >= ts.ScriptTarget.ES2015 ?\n         createLocalizedStringTaggedTemplate(ast, context, this) :\n         createLocalizedStringFunctionCall(ast, context, this, this.imports);\n+    this.setSourceMapRange(localizedString, ast);\n+    return localizedString;\n   }\n \n   visitExternalExpr(ast: ExternalExpr, context: Context): ts.PropertyAccessExpression"
        },
        {
            "sha": "127a3f6d94699ab00b0547de21f807d6c1d78b94",
            "filename": "packages/compiler/src/render3/view/i18n/localize_utils.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/dda3f49952b8e12f7ec63fea8ab64fed0bb238c5/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fi18n%2Flocalize_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/dda3f49952b8e12f7ec63fea8ab64fed0bb238c5/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fi18n%2Flocalize_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fi18n%2Flocalize_utils.ts?ref=dda3f49952b8e12f7ec63fea8ab64fed0bb238c5",
            "patch": "@@ -7,20 +7,21 @@\n  */\n import * as i18n from '../../../i18n/i18n_ast';\n import * as o from '../../../output/output_ast';\n+import {ParseSourceSpan} from '../../../parse_util';\n \n import {serializeIcuNode} from './icu_serializer';\n import {formatI18nPlaceholderName} from './util';\n \n export function createLocalizeStatements(\n     variable: o.ReadVarExpr, message: i18n.Message,\n     params: {[name: string]: o.Expression}): o.Statement[] {\n-  const statements = [];\n-\n   const {messageParts, placeHolders} = serializeI18nMessageForLocalize(message);\n-  statements.push(new o.ExpressionStatement(variable.set(\n-      o.localizedString(message, messageParts, placeHolders, placeHolders.map(ph => params[ph])))));\n-\n-  return statements;\n+  const sourceSpan = getSourceSpan(message);\n+  const expressions = placeHolders.map(ph => params[ph]);\n+  const localizedString =\n+      o.localizedString(message, messageParts, placeHolders, expressions, sourceSpan);\n+  const variableInitialization = variable.set(localizedString);\n+  return [new o.ExpressionStatement(variableInitialization)];\n }\n \n class MessagePiece {\n@@ -90,6 +91,13 @@ export function serializeI18nMessageForLocalize(message: i18n.Message):\n   return processMessagePieces(pieces);\n }\n \n+function getSourceSpan(message: i18n.Message): ParseSourceSpan {\n+  const startNode = message.nodes[0];\n+  const endNode = message.nodes[message.nodes.length - 1];\n+  return new ParseSourceSpan(\n+      startNode.sourceSpan.start, endNode.sourceSpan.end, startNode.sourceSpan.details);\n+}\n+\n /**\n  * Convert the list of serialized MessagePieces into two arrays.\n  *"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 17,
        "deletions": 7
    }
}