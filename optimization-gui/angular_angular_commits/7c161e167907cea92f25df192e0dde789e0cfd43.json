{
    "author": "JoostK",
    "message": "refactor(compiler-cli): define type alias for the required delegation pattern (#39604)\n\nThe type alias allows for this pattern to be more easily used in other\nareas of the compiler code. The current usages of this pattern have been\nupdated to use the type alias.\n\nPR Close #39604",
    "sha": "7c161e167907cea92f25df192e0dde789e0cfd43",
    "files": [
        {
            "sha": "24683b131b2e6489bcf67a9aa6c1e29022248a74",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 12,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts",
            "raw_url": "https://github.com/angular/angular/raw/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts?ref=7c161e167907cea92f25df192e0dde789e0cfd43",
            "patch": "@@ -15,23 +15,14 @@ import {FactoryGenerator, isShim, ShimAdapter, ShimReferenceTagger, SummaryGener\n import {FactoryTracker, PerFileShimGenerator, TopLevelShimGenerator} from '../../shims/api';\n import {TypeCheckShimGenerator} from '../../typecheck';\n import {normalizeSeparators} from '../../util/src/path';\n-import {getRootDirs, isDtsPath, isNonDeclarationTsPath} from '../../util/src/typescript';\n+import {getRootDirs, isNonDeclarationTsPath, RequiredDelegations} from '../../util/src/typescript';\n import {ExtendedTsCompilerHost, NgCompilerAdapter, NgCompilerOptions, UnifiedModulesHost} from '../api';\n \n // A persistent source of bugs in CompilerHost delegation has been the addition by TS of new,\n // optional methods on ts.CompilerHost. Since these methods are optional, it's not a type error that\n // the delegating host doesn't implement or delegate them. This causes subtle runtime failures. No\n // more. This infrastructure ensures that failing to delegate a method is a compile-time error.\n \n-/**\n- * Represents the `ExtendedTsCompilerHost` interface, with a transformation applied that turns all\n- * methods (even optional ones) into required fields (which may be `undefined`, if the method was\n- * optional).\n- */\n-export type RequiredCompilerHostDelegations = {\n-  [M in keyof Required<ExtendedTsCompilerHost>]: ExtendedTsCompilerHost[M];\n-};\n-\n /**\n  * Delegates all methods of `ExtendedTsCompilerHost` to a delegate, with the exception of\n  * `getSourceFile` and `fileExists` which are implemented in `NgCompilerHost`.\n@@ -40,7 +31,7 @@ export type RequiredCompilerHostDelegations = {\n  * generated for this class.\n  */\n export class DelegatingCompilerHost implements\n-    Omit<RequiredCompilerHostDelegations, 'getSourceFile'|'fileExists'> {\n+    Omit<RequiredDelegations<ExtendedTsCompilerHost>, 'getSourceFile'|'fileExists'> {\n   constructor(protected delegate: ExtendedTsCompilerHost) {}\n \n   private delegateMethod<M extends keyof ExtendedTsCompilerHost>(name: M):\n@@ -89,7 +80,7 @@ export class DelegatingCompilerHost implements\n  * `ExtendedTsCompilerHost` methods whenever present.\n  */\n export class NgCompilerHost extends DelegatingCompilerHost implements\n-    RequiredCompilerHostDelegations, ExtendedTsCompilerHost, NgCompilerAdapter {\n+    RequiredDelegations<ExtendedTsCompilerHost>, ExtendedTsCompilerHost, NgCompilerAdapter {\n   readonly factoryTracker: FactoryTracker|null = null;\n   readonly entryPoint: AbsoluteFsPath|null = null;\n   readonly constructionDiagnostics: ts.Diagnostic[];"
        },
        {
            "sha": "41b6d9dfdc7fc2c09c6ce76dc9e8166c7f6a5622",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/host.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fhost.ts",
            "raw_url": "https://github.com/angular/angular/raw/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fhost.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fhost.ts?ref=7c161e167907cea92f25df192e0dde789e0cfd43",
            "patch": "@@ -9,15 +9,7 @@\n import * as ts from 'typescript';\n \n import {copyFileShimData, ShimReferenceTagger} from '../../shims';\n-\n-/**\n- * Represents the `ts.CompilerHost` interface, with a transformation applied that turns all\n- * methods (even optional ones) into required fields (which may be `undefined`, if the method was\n- * optional).\n- */\n-export type RequiredCompilerHostDelegations = {\n-  [M in keyof Required<ts.CompilerHost>]: ts.CompilerHost[M];\n-};\n+import {RequiredDelegations} from '../../util/src/typescript';\n \n /**\n  * Delegates all methods of `ts.CompilerHost` to a delegate, with the exception of\n@@ -27,7 +19,7 @@ export type RequiredCompilerHostDelegations = {\n  * generated for this class.\n  */\n export class DelegatingCompilerHost implements\n-    Omit<RequiredCompilerHostDelegations, 'getSourceFile'|'fileExists'|'writeFile'> {\n+    Omit<RequiredDelegations<ts.CompilerHost>, 'getSourceFile'|'fileExists'|'writeFile'> {\n   constructor(protected delegate: ts.CompilerHost) {}\n \n   private delegateMethod<M extends keyof ts.CompilerHost>(name: M): ts.CompilerHost[M] {"
        },
        {
            "sha": "f8ca1fb6196bef3405e2ae1993144c906e13916f",
            "filename": "packages/compiler-cli/src/ngtsc/util/src/typescript.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/7c161e167907cea92f25df192e0dde789e0cfd43/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts?ref=7c161e167907cea92f25df192e0dde789e0cfd43",
            "patch": "@@ -149,3 +149,11 @@ export function isAssignment(node: ts.Node): node is ts.BinaryExpression {\n  * Asserts that the keys `K` form a subset of the keys of `T`.\n  */\n export type SubsetOfKeys<T, K extends keyof T> = K;\n+\n+/**\n+ * Represents the type `T`, with a transformation applied that turns all methods (even optional\n+ * ones) into required fields (which may be `undefined`, if the method was optional).\n+ */\n+export type RequiredDelegations<T> = {\n+  [M in keyof Required<T>]: T[M];\n+};"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 13,
        "deletions": 22
    }
}