{
    "author": "dgp1130",
    "message": "fix(bazel): construct a manifest file even when warnings are emitted (#43582)\n\nRefs #42966.\n\nPreviously if _any_ diagnostics were emitted, regardless of their category, the manifest would not be generated. This means that if a target emits only warnings and no errors, it would still fail to build because it does not generate all the required output files (specifically the `.es5.MF` file). Now the manifest file is generated as long as there are no error diagnostics in the result. This makes `ng_module()` support compiler warnings as a user would expect.\n\nAdded a test which uses extended template diagnostics to trigger the invalid banana in box diagnostic. This generates a warning and uses Skylib's `build_test()` to verify that it builds successfully. Unfortunately there is no easy way to verify that the warning diagnostic is emitted at all. `expected_diagnostics` should be able to do that, but it doesn't seem to have any effect on `ng_module()` and may not be integrated. Instead, testing that a target with warnings builds correctly is the best we can easily do here without a deeper investigation.\n\nPR Close #43582",
    "sha": "e0a72857ccda2b21a91875ee714fef608b54c083",
    "files": [
        {
            "sha": "39a49fe167f8b0c12a268196a344aa835d5ab6c1",
            "filename": "packages/bazel/src/ngc-wrapped/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts?ref=e0a72857ccda2b21a91875ee714fef608b54c083",
            "patch": "@@ -351,7 +351,8 @@ export function compile({\n   });\n   const tsickleEmitResult = emitResult as tsickle.EmitResult;\n   let externs = '/** @externs */\\n';\n-  if (!diagnostics.length) {\n+  const hasError = diagnostics.some((diag) => diag.category === ts.DiagnosticCategory.Error);\n+  if (!hasError) {\n     if (bazelOpts.tsickleGenerateExterns) {\n       externs += tsickle.getGeneratedExterns(tsickleEmitResult.externs);\n     }"
        },
        {
            "sha": "05ddeee7cea326a544d1017cae04aaf885500dba",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/BUILD.bazel",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel?ref=e0a72857ccda2b21a91875ee714fef608b54c083",
            "patch": "@@ -1,3 +1,4 @@\n+load(\"@bazel_skylib//rules:build_test.bzl\", \"build_test\")\n load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ng_module\", \"ts_library\")\n \n ts_library(\n@@ -44,3 +45,18 @@ jasmine_node_test(\n     ],\n     tags = [\"ivy-only\"],\n )\n+\n+ng_module(\n+    name = \"test_module_warnings_lib\",\n+    srcs = [\"test_module_warnings.ts\"],\n+    experimental_extended_template_diagnostics = True,\n+    strict_templates = True,\n+    tags = [\"ivy-only\"],\n+    deps = [\"//packages/core\"],\n+)\n+\n+build_test(\n+    name = \"test_module_warnings\",\n+    tags = [\"ivy-only\"],\n+    targets = [\":test_module_warnings_lib\"],\n+)"
        },
        {
            "sha": "e69988c3cd39e056be5bb9de0ced066701f6fdbf",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_warnings.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_warnings.ts",
            "raw_url": "https://github.com/angular/angular/raw/e0a72857ccda2b21a91875ee714fef608b54c083/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_warnings.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_warnings.ts?ref=e0a72857ccda2b21a91875ee714fef608b54c083",
            "patch": "@@ -0,0 +1,19 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Component} from '@angular/core';\n+\n+/** Test component which contains an invalid banana in box warning. Should build successfully. */\n+@Component({\n+  template: `\n+    <div ([foo])=\"bar\"></div>\n+  `,\n+})\n+export class TestCmp {\n+  bar: string = 'test';\n+}"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 37,
        "deletions": 1
    }
}