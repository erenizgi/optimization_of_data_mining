{
    "author": "mhevery",
    "message": "refactor(core): change `getPreviousOrParentTNode` to return `TNode|null` (#38707)\n\nThis change makes `getPreviousOrParentTNode` return `TNode|null` (rather\nthan just `TNode`) which is more reflective of the reality. The\n`getPreviousOrParentTNode` can be `null` upon entering the `LView`.\n\nPR Close #38707",
    "sha": "7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
    "files": [
        {
            "sha": "96146c8335637f15101be0dedb1751daa070b790",
            "filename": "packages/core/src/render3/component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -229,7 +229,7 @@ export function createRootComponent<T>(\n     componentDef.contentQueries(RenderFlags.Create, component, rootLView.length - 1);\n   }\n \n-  const rootTNode = getPreviousOrParentTNode();\n+  const rootTNode = getPreviousOrParentTNode()!;\n   if (tView.firstCreatePass &&\n       (componentDef.hostBindings !== null || componentDef.hostAttrs !== null)) {\n     const elementIndex = rootTNode.index - HEADER_OFFSET;"
        },
        {
            "sha": "b32d02a1520dac8b5e1813c96f1c80dec1e92873",
            "filename": "packages/core/src/render3/di_setup.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -76,7 +76,7 @@ function resolveProvider(\n     let token: any = isTypeProvider(provider) ? provider : resolveForwardRef(provider.provide);\n     let providerFactory: () => any = providerToFactory(provider);\n \n-    const tNode = getPreviousOrParentTNode();\n+    const tNode = getPreviousOrParentTNode()!;\n     const beginIndex = tNode.providerIndexes & TNodeProviderIndexes.ProvidersStartIndexMask;\n     const endIndex = tNode.directiveStart;\n     const cptViewProvidersCount ="
        },
        {
            "sha": "eae35d484a2dcbaecd27fa5aa931a25cb7d15ab1",
            "filename": "packages/core/src/render3/i18n/i18n_parse.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -70,7 +70,7 @@ export function i18nStartFirstPass(\n     lView: LView, tView: TView, index: number, message: string, subTemplateIndex?: number) {\n   const startIndex = tView.blueprint.length - HEADER_OFFSET;\n   i18nVarsCount = 0;\n-  const previousOrParentTNode = getPreviousOrParentTNode();\n+  const previousOrParentTNode = getPreviousOrParentTNode()!;\n   const parentTNode =\n       getIsParent() ? previousOrParentTNode : previousOrParentTNode && previousOrParentTNode.parent;\n   let parentIndex =\n@@ -212,7 +212,7 @@ export function i18nStartFirstPass(\n  */\n export function i18nAttributesFirstPass(\n     lView: LView, tView: TView, index: number, values: string[]) {\n-  const previousElement = getPreviousOrParentTNode();\n+  const previousElement = getPreviousOrParentTNode()!;\n   const previousElementIndex = previousElement.index - HEADER_OFFSET;\n   const updateOpCodes: I18nUpdateOpCodes = [];\n   if (ngDevMode) {"
        },
        {
            "sha": "739b28f977395957b642259fbc1e9daf00ddef28",
            "filename": "packages/core/src/render3/instructions/di.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -59,7 +59,7 @@ export function ɵɵdirectiveInject<T>(\n  * @codeGenApi\n  */\n export function ɵɵinjectAttribute(attrNameToInject: string): string|null {\n-  return injectAttributeImpl(getPreviousOrParentTNode(), attrNameToInject);\n+  return injectAttributeImpl(getPreviousOrParentTNode()!, attrNameToInject);\n }\n \n /**"
        },
        {
            "sha": "f72ce1155e5ada9bc631cf28cffb4ba43c699252",
            "filename": "packages/core/src/render3/instructions/element.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -128,7 +128,7 @@ export function ɵɵelementStart(\n  * @codeGenApi\n  */\n export function ɵɵelementEnd(): void {\n-  let previousOrParentTNode = getPreviousOrParentTNode();\n+  let previousOrParentTNode = getPreviousOrParentTNode()!;\n   ngDevMode && assertDefined(previousOrParentTNode, 'No parent node to close.');\n   if (getIsParent()) {\n     setIsNotParent();"
        },
        {
            "sha": "ad2c6faf7e0afa080259cb0d97c828ce65eebe7f",
            "filename": "packages/core/src/render3/instructions/element_container.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -98,7 +98,7 @@ export function ɵɵelementContainerStart(\n  * @codeGenApi\n  */\n export function ɵɵelementContainerEnd(): void {\n-  let previousOrParentTNode = getPreviousOrParentTNode();\n+  let previousOrParentTNode = getPreviousOrParentTNode()!;\n   const tView = getTView();\n   if (getIsParent()) {\n     setIsNotParent();"
        },
        {
            "sha": "7cd9d931bce9a37959895a87ba52ed07e5ee13a0",
            "filename": "packages/core/src/render3/instructions/listener.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -41,7 +41,7 @@ export function ɵɵlistener(\n     eventTargetResolver?: GlobalTargetResolver): typeof ɵɵlistener {\n   const lView = getLView();\n   const tView = getTView();\n-  const tNode = getPreviousOrParentTNode();\n+  const tNode = getPreviousOrParentTNode()!;\n   listenerInternal(\n       tView, lView, lView[RENDERER], tNode, eventName, listenerFn, useCapture, eventTargetResolver);\n   return ɵɵlistener;\n@@ -71,7 +71,7 @@ export function ɵɵlistener(\n export function ɵɵsyntheticHostListener(\n     eventName: string, listenerFn: (e?: any) => any, useCapture = false,\n     eventTargetResolver?: GlobalTargetResolver): typeof ɵɵsyntheticHostListener {\n-  const tNode = getPreviousOrParentTNode();\n+  const tNode = getPreviousOrParentTNode()!;\n   const lView = getLView();\n   const tView = getTView();\n   const currentDef = getCurrentDirectiveDef(tView.data);"
        },
        {
            "sha": "1d9d26b507283c5a165ca859a83c1a909b63e174",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -1125,7 +1125,7 @@ function logUnknownPropertyError(propName: string, tNode: TNode): void {\n  * Instantiate a root component.\n  */\n export function instantiateRootComponent<T>(tView: TView, lView: LView, def: ComponentDef<T>): T {\n-  const rootTNode = getPreviousOrParentTNode();\n+  const rootTNode = getPreviousOrParentTNode()!;\n   if (tView.firstCreatePass) {\n     if (def.providersResolver) def.providersResolver(def);\n     generateExpandoInstructionBlock(tView, rootTNode, 1);"
        },
        {
            "sha": "eb28a08744dab56ea7f36d8447a270474a4dfb50",
            "filename": "packages/core/src/render3/query.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -504,7 +504,7 @@ export function ɵɵcontentQuery<T>(\n     directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean,\n     read?: any): void {\n   contentQueryInternal(\n-      getTView(), getLView(), predicate, descend, read, false, getPreviousOrParentTNode(),\n+      getTView(), getLView(), predicate, descend, read, false, getPreviousOrParentTNode()!,\n       directiveIndex);\n }\n \n@@ -524,7 +524,7 @@ export function ɵɵstaticContentQuery<T>(\n     directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean,\n     read?: any): void {\n   contentQueryInternal(\n-      getTView(), getLView(), predicate, descend, read, true, getPreviousOrParentTNode(),\n+      getTView(), getLView(), predicate, descend, read, true, getPreviousOrParentTNode()!,\n       directiveIndex);\n }\n "
        },
        {
            "sha": "23a751831283fd8c94117f74e03f589ce01396cc",
            "filename": "packages/core/src/render3/state.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 17,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -54,8 +54,7 @@ interface LFrame {\n    *\n    * This is used in conjunction with `isParent`.\n    */\n-  // FIXME(misko): should be `TNode|null` (add comment explaining it.)\n-  previousOrParentTNode: TNode;\n+  previousOrParentTNode: TNode|null;\n \n   /**\n    * If `isParent` is:\n@@ -263,7 +262,7 @@ export function ɵɵrestoreView(viewToRestore: OpaqueViewState) {\n   instructionState.lFrame.contextLView = viewToRestore as any as LView;\n }\n \n-export function getPreviousOrParentTNode(): TNode {\n+export function getPreviousOrParentTNode(): TNode|null {\n   return instructionState.lFrame.previousOrParentTNode;\n }\n \n@@ -441,20 +440,20 @@ function allocLFrame() {\n \n function createLFrame(parent: LFrame|null): LFrame {\n   const lFrame: LFrame = {\n-    previousOrParentTNode: null!,  //\n-    isParent: true,                //\n-    lView: null!,                  //\n-    tView: null!,                  //\n-    selectedIndex: 0,              //\n-    contextLView: null!,           //\n-    elementDepthCount: 0,          //\n-    currentNamespace: null,        //\n-    currentDirectiveIndex: -1,     //\n-    bindingRootIndex: -1,          //\n-    bindingIndex: -1,              //\n-    currentQueryIndex: 0,          //\n-    parent: parent!,               //\n-    child: null,                   //\n+    previousOrParentTNode: null,  //\n+    isParent: true,               //\n+    lView: null!,                 //\n+    tView: null!,                 //\n+    selectedIndex: 0,             //\n+    contextLView: null!,          //\n+    elementDepthCount: 0,         //\n+    currentNamespace: null,       //\n+    currentDirectiveIndex: -1,    //\n+    bindingRootIndex: -1,         //\n+    bindingIndex: -1,             //\n+    currentQueryIndex: 0,         //\n+    parent: parent!,              //\n+    child: null,                  //\n   };\n   parent !== null && (parent.child = lFrame);  // link the new LFrame for reuse.\n   return lFrame;"
        },
        {
            "sha": "61058178c7f2b56970628ef7066a383d6c4eb2ff",
            "filename": "packages/core/src/render3/view_engine_compatibility.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "raw_url": "https://github.com/angular/angular/raw/7bd18fca198b7f2701d50cbebafcccf2a117e1f8/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts?ref=7bd18fca198b7f2701d50cbebafcccf2a117e1f8",
            "patch": "@@ -43,7 +43,7 @@ import { ViewRef } from './view_ref';\n  */\n export function injectElementRef(ElementRefToken: typeof ViewEngine_ElementRef):\n     ViewEngine_ElementRef {\n-  return createElementRef(ElementRefToken, getPreviousOrParentTNode(), getLView());\n+  return createElementRef(ElementRefToken, getPreviousOrParentTNode()!, getLView());\n }\n \n let R3ElementRef: {new (native: RElement|RComment): ViewEngine_ElementRef};\n@@ -79,7 +79,7 @@ export function injectTemplateRef<T>(\n     TemplateRefToken: typeof ViewEngine_TemplateRef,\n     ElementRefToken: typeof ViewEngine_ElementRef): ViewEngine_TemplateRef<T>|null {\n   return createTemplateRef<T>(\n-      TemplateRefToken, ElementRefToken, getPreviousOrParentTNode(), getLView());\n+      TemplateRefToken, ElementRefToken, getPreviousOrParentTNode()!, getLView());\n }\n \n /**\n@@ -407,7 +407,7 @@ export function createContainerRef(\n \n /** Returns a ChangeDetectorRef (a.k.a. a ViewRef) */\n export function injectChangeDetectorRef(isPipe = false): ViewEngine_ChangeDetectorRef {\n-  return createViewRef(getPreviousOrParentTNode(), getLView(), isPipe);\n+  return createViewRef(getPreviousOrParentTNode()!, getLView(), isPipe);\n }\n \n /**\n@@ -453,7 +453,7 @@ export function injectRenderer2(): Renderer2 {\n   // We need the Renderer to be based on the component that it's being injected into, however since\n   // DI happens before we've entered its view, `getLView` will return the parent view instead.\n   const lView = getLView();\n-  const tNode = getPreviousOrParentTNode();\n+  const tNode = getPreviousOrParentTNode()!;\n   const nodeAtIndex = getComponentLViewByIndex(tNode.index, lView);\n   return getOrCreateRenderer2(isLView(nodeAtIndex) ? nodeAtIndex : lView);\n }"
        }
    ],
    "stats": {
        "total": 65,
        "additions": 32,
        "deletions": 33
    }
}