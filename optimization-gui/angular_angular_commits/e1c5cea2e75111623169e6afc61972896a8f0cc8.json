{
    "author": "josephperrott",
    "message": "fix(dev-infra): set the default LogLevel of GitClient logging to DEBUG (#41899)\n\nPreviously by default GitClient would log the commands it was executing at the\nINFO level. This change moves the default level of this logging to DEBUG, while\nstill allowing callers of the methods to set the log level back to INFO.\n\nPR Close #41899",
    "sha": "e1c5cea2e75111623169e6afc61972896a8f0cc8",
    "files": [
        {
            "sha": "66a47b1fe5ab58cc398c2395ca5dd834b6d4d8f5",
            "filename": "dev-infra/build-worker.js",
            "status": "modified",
            "additions": 8,
            "deletions": 10,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fbuild-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fbuild-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbuild-worker.js?ref=e1c5cea2e75111623169e6afc61972896a8f0cc8",
            "patch": "@@ -205,8 +205,6 @@ var GitClient = /** @class */ (function () {\n      */\n     function GitClient(githubToken, config, baseDir) {\n         this.githubToken = githubToken;\n-        /** Whether verbose logging of Git actions should be used. */\n-        this.verboseLogging = true;\n         /** The OAuth scopes available for the provided Github token. */\n         this._cachedOauthScopes = null;\n         /**\n@@ -254,10 +252,9 @@ var GitClient = /** @class */ (function () {\n         }\n         GitClient.authenticated = new GitClient(token);\n     };\n-    /** Set the verbose logging state of the GitClient instance. */\n-    GitClient.prototype.setVerboseLoggingState = function (verbose) {\n+    /** Set the verbose logging state of the GitClient class. */\n+    GitClient.setVerboseLoggingState = function (verbose) {\n         this.verboseLogging = verbose;\n-        return this;\n     };\n     /** Executes the given git command. Throws if the command fails. */\n     GitClient.prototype.run = function (args, options) {\n@@ -283,9 +280,10 @@ var GitClient = /** @class */ (function () {\n             throw new DryRunError();\n         }\n         // To improve the debugging experience in case something fails, we print all executed Git\n-        // commands to better understand the git actions occuring. Depending on the command being\n-        // executed, this debugging information should be logged at different logging levels.\n-        var printFn = (!this.verboseLogging || options.stdio === 'ignore') ? debug : info;\n+        // commands at the DEBUG level to better understand the git actions occuring. Verbose logging,\n+        // always logging at the INFO level, can be enabled either by setting the verboseLogging\n+        // property on the GitClient class or the options object provided to the method.\n+        var printFn = (GitClient.verboseLogging || options.verboseLogging) ? info : debug;\n         // Note that we do not want to print the token if it is contained in the command. It's common\n         // to share errors with others if the tool failed, and we do not want to leak tokens.\n         printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n@@ -424,16 +422,16 @@ var GitClient = /** @class */ (function () {\n         });\n     };\n     GitClient.prototype.determineBaseDir = function () {\n-        this.setVerboseLoggingState(false);\n         var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n         if (status !== 0) {\n             throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n                 \"Was the command run from inside of the repo?\\n\\n\" +\n                 (\"ERROR:\\n \" + stderr));\n         }\n-        this.setVerboseLoggingState(true);\n         return stdout.trim();\n     };\n+    /** Whether verbose logging of Git actions should be used. */\n+    GitClient.verboseLogging = false;\n     return GitClient;\n }());\n /**"
        },
        {
            "sha": "d4c4396be18fee6187aa064582950a16fa3f8175",
            "filename": "dev-infra/caretaker/check/check.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "raw_url": "https://github.com/angular/angular/raw/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts?ref=e1c5cea2e75111623169e6afc61972896a8f0cc8",
            "patch": "@@ -6,7 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {GitClient} from '../../utils/git/index';\n import {getCaretakerConfig} from '../config';\n \n import {CiModule} from './ci';\n@@ -24,8 +23,6 @@ const moduleList = [\n \n /** Check the status of services which Angular caretakers need to monitor. */\n export async function checkServiceStatuses() {\n-  // Set the verbose logging state of the GitClient.\n-  GitClient.getAuthenticatedInstance().setVerboseLoggingState(false);\n   /** The configuration for the caretaker commands. */\n   const config = getCaretakerConfig();\n   /** List of instances of Caretaker Check modules */"
        },
        {
            "sha": "9a545206963c35745c17a6f16b8447521efa021d",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 8,
            "deletions": 12,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=e1c5cea2e75111623169e6afc61972896a8f0cc8",
            "patch": "@@ -373,8 +373,6 @@ var GitClient = /** @class */ (function () {\n      */\n     function GitClient(githubToken, config, baseDir) {\n         this.githubToken = githubToken;\n-        /** Whether verbose logging of Git actions should be used. */\n-        this.verboseLogging = true;\n         /** The OAuth scopes available for the provided Github token. */\n         this._cachedOauthScopes = null;\n         /**\n@@ -422,10 +420,9 @@ var GitClient = /** @class */ (function () {\n         }\n         GitClient.authenticated = new GitClient(token);\n     };\n-    /** Set the verbose logging state of the GitClient instance. */\n-    GitClient.prototype.setVerboseLoggingState = function (verbose) {\n+    /** Set the verbose logging state of the GitClient class. */\n+    GitClient.setVerboseLoggingState = function (verbose) {\n         this.verboseLogging = verbose;\n-        return this;\n     };\n     /** Executes the given git command. Throws if the command fails. */\n     GitClient.prototype.run = function (args, options) {\n@@ -451,9 +448,10 @@ var GitClient = /** @class */ (function () {\n             throw new DryRunError();\n         }\n         // To improve the debugging experience in case something fails, we print all executed Git\n-        // commands to better understand the git actions occuring. Depending on the command being\n-        // executed, this debugging information should be logged at different logging levels.\n-        var printFn = (!this.verboseLogging || options.stdio === 'ignore') ? debug : info;\n+        // commands at the DEBUG level to better understand the git actions occuring. Verbose logging,\n+        // always logging at the INFO level, can be enabled either by setting the verboseLogging\n+        // property on the GitClient class or the options object provided to the method.\n+        var printFn = (GitClient.verboseLogging || options.verboseLogging) ? info : debug;\n         // Note that we do not want to print the token if it is contained in the command. It's common\n         // to share errors with others if the tool failed, and we do not want to leak tokens.\n         printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n@@ -592,16 +590,16 @@ var GitClient = /** @class */ (function () {\n         });\n     };\n     GitClient.prototype.determineBaseDir = function () {\n-        this.setVerboseLoggingState(false);\n         var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n         if (status !== 0) {\n             throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n                 \"Was the command run from inside of the repo?\\n\\n\" +\n                 (\"ERROR:\\n \" + stderr));\n         }\n-        this.setVerboseLoggingState(true);\n         return stdout.trim();\n     };\n+    /** Whether verbose logging of Git actions should be used. */\n+    GitClient.verboseLogging = false;\n     return GitClient;\n }());\n /**\n@@ -1541,8 +1539,6 @@ const moduleList = [\n /** Check the status of services which Angular caretakers need to monitor. */\n function checkServiceStatuses() {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n-        // Set the verbose logging state of the GitClient.\n-        GitClient.getAuthenticatedInstance().setVerboseLoggingState(false);\n         /** The configuration for the caretaker commands. */\n         const config = getCaretakerConfig();\n         /** List of instances of Caretaker Check modules */"
        },
        {
            "sha": "6dfb5c1cc695eb0f3afe535a99e79e6998f9c6dd",
            "filename": "dev-infra/utils/git/index.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 15,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Futils%2Fgit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/e1c5cea2e75111623169e6afc61972896a8f0cc8/dev-infra%2Futils%2Fgit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Findex.ts?ref=e1c5cea2e75111623169e6afc61972896a8f0cc8",
            "patch": "@@ -34,6 +34,11 @@ export class GitCommandError extends Error {\n   }\n }\n \n+/** The options available for `GitClient`'s `run` and `runGraceful` methods. */\n+type GitClientRunOptions = SpawnSyncOptions&{\n+  verboseLogging?: boolean;\n+};\n+\n /**\n  * Common client for performing Git interactions with a given remote.\n  *\n@@ -83,10 +88,15 @@ export class GitClient<Authenticated extends boolean> {\n     GitClient.authenticated = new GitClient(token);\n   }\n \n+  /** Set the verbose logging state of the GitClient class. */\n+  static setVerboseLoggingState(verbose: boolean) {\n+    this.verboseLogging = verbose;\n+  }\n+\n+  /** Whether verbose logging of Git actions should be used. */\n+  private static verboseLogging = false;\n   /** The configuration, containing the github specific configuration. */\n   private config: NgDevConfig;\n-  /** Whether verbose logging of Git actions should be used. */\n-  private verboseLogging = true;\n   /** The OAuth scopes available for the provided Github token. */\n   private _cachedOauthScopes: Promise<string[]>|null = null;\n   /**\n@@ -124,14 +134,8 @@ export class GitClient<Authenticated extends boolean> {\n     }\n   }\n \n-  /** Set the verbose logging state of the GitClient instance. */\n-  setVerboseLoggingState(verbose: boolean): this {\n-    this.verboseLogging = verbose;\n-    return this;\n-  }\n-\n   /** Executes the given git command. Throws if the command fails. */\n-  run(args: string[], options?: SpawnSyncOptions): Omit<SpawnSyncReturns<string>, 'status'> {\n+  run(args: string[], options?: GitClientRunOptions): Omit<SpawnSyncReturns<string>, 'status'> {\n     const result = this.runGraceful(args, options);\n     if (result.status !== 0) {\n       throw new GitCommandError(this, args);\n@@ -146,7 +150,7 @@ export class GitClient<Authenticated extends boolean> {\n    * if there is any stderr output, the output will be printed. This makes it easier to\n    * info failed commands.\n    */\n-  runGraceful(args: string[], options: SpawnSyncOptions = {}): SpawnSyncReturns<string> {\n+  runGraceful(args: string[], options: GitClientRunOptions = {}): SpawnSyncReturns<string> {\n     /** The git command to be run. */\n     const gitCommand = args[0];\n \n@@ -156,9 +160,10 @@ export class GitClient<Authenticated extends boolean> {\n     }\n \n     // To improve the debugging experience in case something fails, we print all executed Git\n-    // commands to better understand the git actions occuring. Depending on the command being\n-    // executed, this debugging information should be logged at different logging levels.\n-    const printFn = (!this.verboseLogging || options.stdio === 'ignore') ? debug : info;\n+    // commands at the DEBUG level to better understand the git actions occuring. Verbose logging,\n+    // always logging at the INFO level, can be enabled either by setting the verboseLogging\n+    // property on the GitClient class or the options object provided to the method.\n+    const printFn = (GitClient.verboseLogging || options.verboseLogging) ? info : debug;\n     // Note that we do not want to print the token if it is contained in the command. It's common\n     // to share errors with others if the tool failed, and we do not want to leak tokens.\n     printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n@@ -321,15 +326,13 @@ export class GitClient<Authenticated extends boolean> {\n   }\n \n   private determineBaseDir() {\n-    this.setVerboseLoggingState(false);\n     const {stdout, stderr, status} = this.runGraceful(['rev-parse', '--show-toplevel']);\n     if (status !== 0) {\n       throw Error(\n           `Unable to find the path to the base directory of the repository.\\n` +\n           `Was the command run from inside of the repo?\\n\\n` +\n           `ERROR:\\n ${stderr}`);\n     }\n-    this.setVerboseLoggingState(true);\n     return stdout.trim();\n   }\n }"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 34,
        "deletions": 40
    }
}