{
    "author": "atscott",
    "message": "feat(compiler-cli): Add compiler option to report errors when assigning to restricted input fields (#38249)\n\nThe compiler does not currently report errors when there's an `@Input()`\nfor a `private`, `protected`, or `readonly` directive/component class member.\nThis change adds an option to enable reporting errors when a template\nattempts to bind to one of these restricted input fields.\n\nPR Close #38249",
    "sha": "71138f6004394557896acdfda82013ed7b865a95",
    "files": [
        {
            "sha": "d5612bb76a043d5e76eb428f5601e4cb84cff453",
            "filename": "aio/content/guide/template-typecheck.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/aio%2Fcontent%2Fguide%2Ftemplate-typecheck.md",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/aio%2Fcontent%2Fguide%2Ftemplate-typecheck.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Ftemplate-typecheck.md?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -114,6 +114,7 @@ In case of a false positive like these, there are a few options:\n |Strictness flag|Effect|\n |-|-|\n |`strictInputTypes`|Whether the assignability of a binding expression to the `@Input()` field is checked. Also affects the inference of directive generic types. |\n+|`strictInputAccessModifiers`|Whether access modifiers such as `private`/`protected`/`readonly` are honored when assigning a binding expression to an `@Input()`. If disabled, the access modifiers of the `@Input` are ignored; only the type is checked.|\n |`strictNullInputTypes`|Whether `strictNullChecks` is honored when checking `@Input()` bindings (per `strictInputTypes`). Turning this off can be useful when using a library that was not built with `strictNullChecks` in mind.|\n |`strictAttributeTypes`|Whether to check `@Input()` bindings that are made using text attributes (for example, `<mat-tab label=\"Step 1\">` vs `<mat-tab [label]=\"'Step 1'\">`).\n |`strictSafeNavigationTypes`|Whether the return type of safe navigation operations (for example, `user?.name`) will be correctly inferred based on the type of `user`). If disabled, `user?.name` will be of type `any`."
        },
        {
            "sha": "2c462d513a4ce24b09907ba4fcdd640100ef86e2",
            "filename": "goldens/public-api/compiler-cli/compiler_options.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.d.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -35,6 +35,7 @@ export interface StrictTemplateOptions {\n     strictContextGenerics?: boolean;\n     strictDomEventTypes?: boolean;\n     strictDomLocalRefTypes?: boolean;\n+    strictInputAccessModifiers?: boolean;\n     strictInputTypes?: boolean;\n     strictLiteralTypes?: boolean;\n     strictNullInputTypes?: boolean;"
        },
        {
            "sha": "98b41f8f07a127060307698d0458a29b1a582e63",
            "filename": "packages/compiler-cli/src/ngtsc/core/api/src/public_options.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -147,6 +147,18 @@ export interface StrictTemplateOptions {\n    */\n   strictInputTypes?: boolean;\n \n+  /**\n+   * Whether to check if the input binding attempts to assign to a restricted field (readonly,\n+   * private, or protected) on the directive/component.\n+   *\n+   * Defaults to `false`, even if \"fullTemplateTypeCheck\", \"strictTemplates\" and/or\n+   * \"strictInputTypes\" is set. Note that if `strictInputTypes` is not set, or set to `false`, this\n+   * flag has no effect.\n+   *\n+   * Tracking issue for enabling this by default: https://github.com/angular/angular/issues/38400\n+   */\n+  strictInputAccessModifiers?: boolean;\n+\n   /**\n    * Whether to use strict null types for input bindings for directives.\n    *"
        },
        {
            "sha": "2aed139c01abed2c2b23ebb575a4c1f3db76bfa7",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -415,6 +415,7 @@ export class NgCompiler {\n         checkQueries: false,\n         checkTemplateBodies: true,\n         checkTypeOfInputBindings: strictTemplates,\n+        honorAccessModifiersForInputBindings: false,\n         strictNullInputBindings: strictTemplates,\n         checkTypeOfAttributes: strictTemplates,\n         // Even in full template type-checking mode, DOM binding checks are not quite ready yet.\n@@ -442,6 +443,7 @@ export class NgCompiler {\n         checkTemplateBodies: false,\n         checkTypeOfInputBindings: false,\n         strictNullInputBindings: false,\n+        honorAccessModifiersForInputBindings: false,\n         checkTypeOfAttributes: false,\n         checkTypeOfDomBindings: false,\n         checkTypeOfOutputEvents: false,\n@@ -462,6 +464,10 @@ export class NgCompiler {\n       typeCheckingConfig.checkTypeOfInputBindings = this.options.strictInputTypes;\n       typeCheckingConfig.applyTemplateContextGuards = this.options.strictInputTypes;\n     }\n+    if (this.options.strictInputAccessModifiers !== undefined) {\n+      typeCheckingConfig.honorAccessModifiersForInputBindings =\n+          this.options.strictInputAccessModifiers;\n+    }\n     if (this.options.strictNullInputTypes !== undefined) {\n       typeCheckingConfig.strictNullInputBindings = this.options.strictNullInputTypes;\n     }"
        },
        {
            "sha": "8009207f50aa9ac9edc634ea47ed1605634168da",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/src/api.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Fapi.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -60,6 +60,13 @@ export interface DirectiveTypeCheckMeta {\n    */\n   restrictedInputFields: Set<string>;\n \n+  /**\n+   * The set of input fields which are declared as string literal members in the Directive's class.\n+   * We need to track these separately because these fields may not be valid JS identifiers so\n+   * we cannot use them with property access expressions when assigning inputs.\n+   */\n+  stringLiteralInputFields: Set<string>;\n+\n   /**\n    * The set of input fields which do not have corresponding members in the Directive's class.\n    */"
        },
        {
            "sha": "455d103d7dde9975ea6e91835208730fb4218969",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/src/inheritance.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Finheritance.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Finheritance.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Finheritance.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -27,9 +27,10 @@ export function flattenInheritedDirectiveMetadata(\n \n   let inputs: {[key: string]: string|[string, string]} = {};\n   let outputs: {[key: string]: string} = {};\n-  let coercedInputFields = new Set<string>();\n-  let undeclaredInputFields = new Set<string>();\n-  let restrictedInputFields = new Set<string>();\n+  const coercedInputFields = new Set<string>();\n+  const undeclaredInputFields = new Set<string>();\n+  const restrictedInputFields = new Set<string>();\n+  const stringLiteralInputFields = new Set<string>();\n   let isDynamic = false;\n \n   const addMetadata = (meta: DirectiveMeta): void => {\n@@ -56,6 +57,9 @@ export function flattenInheritedDirectiveMetadata(\n     for (const restrictedInputField of meta.restrictedInputFields) {\n       restrictedInputFields.add(restrictedInputField);\n     }\n+    for (const field of meta.stringLiteralInputFields) {\n+      stringLiteralInputFields.add(field);\n+    }\n   };\n \n   addMetadata(topMeta);\n@@ -67,6 +71,7 @@ export function flattenInheritedDirectiveMetadata(\n     coercedInputFields,\n     undeclaredInputFields,\n     restrictedInputFields,\n+    stringLiteralInputFields,\n     baseClass: isDynamic ? 'dynamic' : null,\n   };\n }"
        },
        {
            "sha": "dbb7e77e94facf4fda1c526a3cf692711f25113d",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/src/util.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Futil.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -98,15 +98,21 @@ export function extractDirectiveTypeCheckMeta(\n                   .filter((inputName): inputName is string => inputName !== null));\n \n   const restrictedInputFields = new Set<string>();\n+  const stringLiteralInputFields = new Set<string>();\n   const undeclaredInputFields = new Set<string>();\n \n   for (const fieldName of Object.keys(inputs)) {\n     const field = members.find(member => member.name === fieldName);\n     if (field === undefined || field.node === null) {\n       undeclaredInputFields.add(fieldName);\n-    } else if (isRestricted(field.node)) {\n+      continue;\n+    }\n+    if (isRestricted(field.node)) {\n       restrictedInputFields.add(fieldName);\n     }\n+    if (field.nameNode !== null && ts.isStringLiteral(field.nameNode)) {\n+      stringLiteralInputFields.add(fieldName);\n+    }\n   }\n \n   const arity = reflector.getGenericArityOfClass(node);\n@@ -116,6 +122,7 @@ export function extractDirectiveTypeCheckMeta(\n     ngTemplateGuards,\n     coercedInputFields,\n     restrictedInputFields,\n+    stringLiteralInputFields,\n     undeclaredInputFields,\n     isGeneric: arity !== null && arity > 0,\n   };"
        },
        {
            "sha": "f8b12d5fc0f35ad2201346dc82f57dff7758408c",
            "filename": "packages/compiler-cli/src/ngtsc/scope/test/local_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Ftest%2Flocal_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Ftest%2Flocal_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Ftest%2Flocal_spec.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -244,6 +244,7 @@ function fakeDirective(ref: Reference<ClassDeclaration>): DirectiveMeta {\n     ngTemplateGuards: [],\n     coercedInputFields: new Set<string>(),\n     restrictedInputFields: new Set<string>(),\n+    stringLiteralInputFields: new Set<string>(),\n     undeclaredInputFields: new Set<string>(),\n     isGeneric: false,\n     baseClass: null,"
        },
        {
            "sha": "658260fbf1c8bcb220e877e3971d37b32fe5e24f",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/api.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -90,6 +90,14 @@ export interface TypeCheckingConfig {\n    */\n   checkTypeOfInputBindings: boolean;\n \n+  /**\n+   * Whether to honor the access modifiers on input bindings for the component/directive.\n+   *\n+   * If a template binding attempts to assign to an input that is private/protected/readonly,\n+   * this will produce errors when enabled but will not when disabled.\n+   */\n+  honorAccessModifiersForInputBindings: boolean;\n+\n   /**\n    * Whether to use strict null types for input bindings for directives.\n    *"
        },
        {
            "sha": "fa46e7f1db8d980457c65f44e2161474f948015a",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -453,8 +453,13 @@ class TcbDirectiveInputsOp extends TcbOp {\n           // declared in a `@Directive` or `@Component` decorator's `inputs` property) there is no\n           // assignment target available, so this field is skipped.\n           continue;\n-        } else if (this.dir.restrictedInputFields.has(fieldName)) {\n-          // To ignore errors, assign to temp variable with type of the field\n+        } else if (\n+            !this.tcb.env.config.honorAccessModifiersForInputBindings &&\n+            this.dir.restrictedInputFields.has(fieldName)) {\n+          // If strict checking of access modifiers is disabled and the field is restricted\n+          // (i.e. private/protected/readonly), generate an assignment into a temporary variable\n+          // that has the type of the field. This achieves type-checking but circumvents the access\n+          // modifiers.\n           const id = this.tcb.allocateId();\n           const dirTypeRef = this.tcb.env.referenceType(this.dir.ref);\n           if (!ts.isTypeReferenceNode(dirTypeRef)) {\n@@ -464,23 +469,16 @@ class TcbDirectiveInputsOp extends TcbOp {\n           const type = ts.createIndexedAccessTypeNode(\n               ts.createTypeQueryNode(dirId as ts.Identifier),\n               ts.createLiteralTypeNode(ts.createStringLiteral(fieldName)));\n-          const temp = tsCreateVariable(id, ts.createNonNullExpression(ts.createNull()), type);\n-          addParseSpanInfo(temp, input.attribute.sourceSpan);\n+          const temp = tsDeclareVariable(id, type);\n           this.scope.addStatement(temp);\n           target = id;\n-\n-          // TODO: To get errors assign directly to the fields on the instance, using dot access\n-          // when possible\n-\n         } else {\n-          // Otherwise, a declaration exists in which case the `dir[\"fieldName\"]` syntax is used\n-          // as assignment target. An element access is used instead of a property access to\n-          // support input names that are not valid JavaScript identifiers. Additionally, using\n-          // element access syntax does not produce\n-          // TS2341 \"Property $prop is private and only accessible within class $class.\" nor\n-          // TS2445 \"Property $prop is protected and only accessible within class $class and its\n-          //         subclasses.\"\n-          target = ts.createElementAccess(dirId, ts.createStringLiteral(fieldName));\n+          // To get errors assign directly to the fields on the instance, using property access\n+          // when possible. String literal fields may not be valid JS identifiers so we use\n+          // literal element access instead for those cases.\n+          target = this.dir.stringLiteralInputFields.has(fieldName) ?\n+              ts.createElementAccess(dirId, ts.createStringLiteral(fieldName)) :\n+              ts.createPropertyAccess(dirId, ts.createIdentifier(fieldName));\n         }\n \n         // Finally the assignment is extended by assigning it into the target expression."
        },
        {
            "sha": "37f66200f1d9a73ab2b181972fa0fc0945469b46",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/test_utils.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -157,6 +157,7 @@ export const ALL_ENABLED_CONFIG: TypeCheckingConfig = {\n   checkQueries: false,\n   checkTemplateBodies: true,\n   checkTypeOfInputBindings: true,\n+  honorAccessModifiersForInputBindings: true,\n   strictNullInputBindings: true,\n   checkTypeOfAttributes: true,\n   // Feature is still in development.\n@@ -178,10 +179,11 @@ export type TestDirective = Partial<Pick<\n     TypeCheckableDirectiveMeta,\n     Exclude<\n         keyof TypeCheckableDirectiveMeta,\n-        'ref'|'coercedInputFields'|'restrictedInputFields'|'undeclaredInputFields'>>>&{\n+        'ref'|'coercedInputFields'|'restrictedInputFields'|'stringLiteralInputFields'|\n+        'undeclaredInputFields'>>>&{\n   selector: string, name: string, file?: AbsoluteFsPath, type: 'directive',\n       coercedInputFields?: string[], restrictedInputFields?: string[],\n-      undeclaredInputFields?: string[], isGeneric?: boolean;\n+      stringLiteralInputFields?: string[], undeclaredInputFields?: string[], isGeneric?: boolean;\n };\n export type TestPipe = {\n   name: string,\n@@ -212,6 +214,7 @@ export function tcb(\n     applyTemplateContextGuards: true,\n     checkQueries: false,\n     checkTypeOfInputBindings: true,\n+    honorAccessModifiersForInputBindings: false,\n     strictNullInputBindings: true,\n     checkTypeOfAttributes: true,\n     checkTypeOfDomBindings: false,\n@@ -420,6 +423,7 @@ function prepareDeclarations(\n       ngTemplateGuards: decl.ngTemplateGuards || [],\n       coercedInputFields: new Set<string>(decl.coercedInputFields || []),\n       restrictedInputFields: new Set<string>(decl.restrictedInputFields || []),\n+      stringLiteralInputFields: new Set<string>(decl.stringLiteralInputFields || []),\n       undeclaredInputFields: new Set<string>(decl.undeclaredInputFields || []),\n       isGeneric: decl.isGeneric ?? false,\n       outputs: decl.outputs || {},"
        },
        {
            "sha": "8a11d6d87cf62b258e722d3f9fc129acf423d9b8",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 82,
            "deletions": 21,
            "changes": 103,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -55,7 +55,7 @@ describe('type check blocks', () => {\n       selector: '[dir]',\n       inputs: {inputA: 'inputA'},\n     }];\n-    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2: DirA = (null!); _t2[\"inputA\"] = (\"value\");');\n+    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2: DirA = (null!); _t2.inputA = (\"value\");');\n   });\n \n   it('should handle multiple bindings to the same property', () => {\n@@ -67,8 +67,8 @@ describe('type check blocks', () => {\n       inputs: {inputA: 'inputA'},\n     }];\n     const block = tcb(TEMPLATE, DIRECTIVES);\n-    expect(block).toContain('_t2[\"inputA\"] = (1);');\n-    expect(block).toContain('_t2[\"inputA\"] = (2);');\n+    expect(block).toContain('_t2.inputA = (1);');\n+    expect(block).toContain('_t2.inputA = (2);');\n   });\n \n   it('should handle empty bindings', () => {\n@@ -79,7 +79,7 @@ describe('type check blocks', () => {\n       selector: '[dir-a]',\n       inputs: {inputA: 'inputA'},\n     }];\n-    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2[\"inputA\"] = (undefined);');\n+    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2.inputA = (undefined);');\n   });\n \n   it('should handle bindings without value', () => {\n@@ -90,7 +90,7 @@ describe('type check blocks', () => {\n       selector: '[dir-a]',\n       inputs: {inputA: 'inputA'},\n     }];\n-    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2[\"inputA\"] = (undefined);');\n+    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t2.inputA = (undefined);');\n   });\n \n   it('should handle implicit vars on ng-template', () => {\n@@ -322,7 +322,7 @@ describe('type check blocks', () => {\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n             'var _t2: Dir = (null!); ' +\n-            '_t2[\"input\"] = (_t2);');\n+            '_t2.input = (_t2);');\n   });\n \n   it('should generate circular references between two directives correctly', () => {\n@@ -350,9 +350,9 @@ describe('type check blocks', () => {\n         .toContain(\n             'var _t2: DirA = (null!); ' +\n             'var _t3: DirB = (null!); ' +\n-            '_t2[\"inputA\"] = (_t3); ' +\n+            '_t2.inputA = (_t3); ' +\n             'var _t4 = document.createElement(\"div\"); ' +\n-            '_t3[\"inputA\"] = (_t2);');\n+            '_t3.inputA = (_t2);');\n   });\n \n   it('should handle undeclared properties', () => {\n@@ -372,7 +372,7 @@ describe('type check blocks', () => {\n             '(((ctx).foo)); ');\n   });\n \n-  it('should handle restricted properties', () => {\n+  it('should assign restricted properties to temp variables by default', () => {\n     const TEMPLATE = `<div dir [inputA]=\"foo\"></div>`;\n     const DIRECTIVES: TestDeclaration[] = [{\n       type: 'directive',\n@@ -390,6 +390,24 @@ describe('type check blocks', () => {\n             '_t3 = (((ctx).foo)); ');\n   });\n \n+  it('should assign properties via element access for field names that are not JS identifiers',\n+     () => {\n+       const TEMPLATE = `<div dir [inputA]=\"foo\"></div>`;\n+       const DIRECTIVES: TestDeclaration[] = [{\n+         type: 'directive',\n+         name: 'Dir',\n+         selector: '[dir]',\n+         inputs: {\n+           'some-input.xs': 'inputA',\n+         },\n+         stringLiteralInputFields: ['some-input.xs'],\n+       }];\n+       const block = tcb(TEMPLATE, DIRECTIVES);\n+       expect(block).toContain(\n+           'var _t2: Dir = (null!); ' +\n+           '_t2[\"some-input.xs\"] = (((ctx).foo)); ');\n+     });\n+\n   it('should handle a single property bound to multiple fields', () => {\n     const TEMPLATE = `<div dir [inputA]=\"foo\"></div>`;\n     const DIRECTIVES: TestDeclaration[] = [{\n@@ -404,7 +422,7 @@ describe('type check blocks', () => {\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n             'var _t2: Dir = (null!); ' +\n-            '_t2[\"field2\"] = _t2[\"field1\"] = (((ctx).foo));');\n+            '_t2.field2 = _t2.field1 = (((ctx).foo));');\n   });\n \n   it('should handle a single property bound to multiple fields, where one of them is coerced',\n@@ -424,7 +442,7 @@ describe('type check blocks', () => {\n            .toContain(\n                'var _t2: Dir = (null!); ' +\n                'var _t3: typeof Dir.ngAcceptInputType_field1 = (null!); ' +\n-               '_t2[\"field2\"] = _t3 = (((ctx).foo));');\n+               '_t2.field2 = _t3 = (((ctx).foo));');\n      });\n \n   it('should handle a single property bound to multiple fields, where one of them is undeclared',\n@@ -443,7 +461,7 @@ describe('type check blocks', () => {\n        expect(tcb(TEMPLATE, DIRECTIVES))\n            .toContain(\n                'var _t2: Dir = (null!); ' +\n-               '_t2[\"field2\"] = (((ctx).foo));');\n+               '_t2.field2 = (((ctx).foo));');\n      });\n \n   it('should use coercion types if declared', () => {\n@@ -590,6 +608,7 @@ describe('type check blocks', () => {\n       checkQueries: false,\n       checkTemplateBodies: true,\n       checkTypeOfInputBindings: true,\n+      honorAccessModifiersForInputBindings: false,\n       strictNullInputBindings: true,\n       checkTypeOfAttributes: true,\n       checkTypeOfDomBindings: false,\n@@ -639,14 +658,14 @@ describe('type check blocks', () => {\n \n       it('should include null and undefined when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain('_t2[\"dirInput\"] = (((ctx).a));');\n+        expect(block).toContain('_t2.dirInput = (((ctx).a));');\n         expect(block).toContain('((ctx).b);');\n       });\n       it('should use the non-null assertion operator when disabled', () => {\n         const DISABLED_CONFIG:\n             TypeCheckingConfig = {...BASE_CONFIG, strictNullInputBindings: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n-        expect(block).toContain('_t2[\"dirInput\"] = (((ctx).a)!);');\n+        expect(block).toContain('_t2.dirInput = (((ctx).a)!);');\n         expect(block).toContain('((ctx).b)!;');\n       });\n     });\n@@ -655,7 +674,7 @@ describe('type check blocks', () => {\n       it('should check types of bindings when enabled', () => {\n         const TEMPLATE = `<div dir [dirInput]=\"a\" [nonDirInput]=\"b\"></div>`;\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain('_t2[\"dirInput\"] = (((ctx).a));');\n+        expect(block).toContain('_t2.dirInput = (((ctx).a));');\n         expect(block).toContain('((ctx).b);');\n       });\n \n@@ -664,7 +683,7 @@ describe('type check blocks', () => {\n         const DISABLED_CONFIG:\n             TypeCheckingConfig = {...BASE_CONFIG, checkTypeOfInputBindings: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n-        expect(block).toContain('_t2[\"dirInput\"] = ((((ctx).a) as any));');\n+        expect(block).toContain('_t2.dirInput = ((((ctx).a) as any));');\n         expect(block).toContain('(((ctx).b) as any);');\n       });\n \n@@ -673,7 +692,7 @@ describe('type check blocks', () => {\n         const DISABLED_CONFIG:\n             TypeCheckingConfig = {...BASE_CONFIG, checkTypeOfInputBindings: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n-        expect(block).toContain('_t2[\"dirInput\"] = ((((((ctx).a)) === (((ctx).b))) as any));');\n+        expect(block).toContain('_t2.dirInput = ((((((ctx).a)) === (((ctx).b))) as any));');\n       });\n     });\n \n@@ -793,17 +812,17 @@ describe('type check blocks', () => {\n \n       it('should assign string value to the input when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain('_t2[\"disabled\"] = (\"\");');\n-        expect(block).toContain('_t2[\"cols\"] = (\"3\");');\n-        expect(block).toContain('_t2[\"rows\"] = (2);');\n+        expect(block).toContain('_t2.disabled = (\"\");');\n+        expect(block).toContain('_t2.cols = (\"3\");');\n+        expect(block).toContain('_t2.rows = (2);');\n       });\n \n       it('should use any for attributes but still check bound attributes when disabled', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, checkTypeOfAttributes: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n         expect(block).not.toContain('\"disabled\"');\n         expect(block).not.toContain('\"cols\"');\n-        expect(block).toContain('_t2[\"rows\"] = (2);');\n+        expect(block).toContain('_t2.rows = (2);');\n       });\n     });\n \n@@ -873,5 +892,47 @@ describe('type check blocks', () => {\n         expect(block).toContain('function Test_TCB(ctx: Test<any>)');\n       });\n     });\n+\n+    describe('config.checkAccessModifiersForInputBindings', () => {\n+      const TEMPLATE = `<div dir [inputA]=\"foo\"></div>`;\n+\n+      it('should assign restricted properties via element access for field names that are not JS identifiers',\n+         () => {\n+           const DIRECTIVES: TestDeclaration[] = [{\n+             type: 'directive',\n+             name: 'Dir',\n+             selector: '[dir]',\n+             inputs: {\n+               'some-input.xs': 'inputA',\n+             },\n+             restrictedInputFields: ['some-input.xs'],\n+             stringLiteralInputFields: ['some-input.xs'],\n+           }];\n+           const enableChecks:\n+               TypeCheckingConfig = {...BASE_CONFIG, honorAccessModifiersForInputBindings: true};\n+           const block = tcb(TEMPLATE, DIRECTIVES, enableChecks);\n+           expect(block).toContain(\n+               'var _t2: Dir = (null!); ' +\n+               '_t2[\"some-input.xs\"] = (((ctx).foo)); ');\n+         });\n+\n+      it('should assign restricted properties via property access', () => {\n+        const DIRECTIVES: TestDeclaration[] = [{\n+          type: 'directive',\n+          name: 'Dir',\n+          selector: '[dir]',\n+          inputs: {\n+            fieldA: 'inputA',\n+          },\n+          restrictedInputFields: ['fieldA']\n+        }];\n+        const enableChecks:\n+            TypeCheckingConfig = {...BASE_CONFIG, honorAccessModifiersForInputBindings: true};\n+        const block = tcb(TEMPLATE, DIRECTIVES, enableChecks);\n+        expect(block).toContain(\n+            'var _t2: Dir = (null!); ' +\n+            '_t2.fieldA = (((ctx).foo)); ');\n+      });\n+    });\n   });\n });"
        },
        {
            "sha": "dc8dd1af02b6bb7d36ceaeb3ef538ac24a045c3b",
            "filename": "packages/compiler-cli/test/ngtsc/template_typecheck_spec.ts",
            "status": "modified",
            "additions": 82,
            "deletions": 16,
            "changes": 98,
            "blob_url": "https://github.com/angular/angular/blob/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_typecheck_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/71138f6004394557896acdfda82013ed7b865a95/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_typecheck_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_typecheck_spec.ts?ref=71138f6004394557896acdfda82013ed7b865a95",
            "patch": "@@ -1577,14 +1577,7 @@ export declare class AnimationEvent {\n             }\n       `;\n \n-      describe('with strict inputs', () => {\n-        beforeEach(() => {\n-          env.tsconfig({fullTemplateTypeCheck: true, strictInputTypes: true});\n-        });\n-\n-        it('should not produce diagnostics for correct inputs which assign to readonly, private, or protected fields',\n-           () => {\n-             env.write('test.ts', `\n+      const correctTypeInputsToRestrictedFields = `\n             import {Component, NgModule, Input, Directive} from '@angular/core';\n \n             @Component({\n@@ -1601,14 +1594,9 @@ export declare class AnimationEvent {\n               declarations: [FooCmp, TestDir],\n             })\n             export class FooModule {}\n-        `);\n-             const diags = env.driveDiagnostics();\n-             expect(diags.length).toBe(0);\n-           });\n+        `;\n \n-        it('should not produce diagnostics for correct inputs which assign to readonly, private, or protected fields inherited from a base class',\n-           () => {\n-             env.write('test.ts', `\n+      const correctInputsToRestrictedFieldsFromBaseClass = `\n             import {Component, NgModule, Input, Directive} from '@angular/core';\n \n             @Component({\n@@ -1629,7 +1617,85 @@ export declare class AnimationEvent {\n               declarations: [FooCmp, ChildDir],\n             })\n             export class FooModule {}\n-        `);\n+        `;\n+      describe('with strictInputAccessModifiers', () => {\n+        beforeEach(() => {\n+          env.tsconfig({\n+            fullTemplateTypeCheck: true,\n+            strictInputTypes: true,\n+            strictInputAccessModifiers: true\n+          });\n+        });\n+\n+        it('should produce diagnostics for inputs which assign to readonly, private, and protected fields',\n+           () => {\n+             env.write('test.ts', correctTypeInputsToRestrictedFields);\n+             expectIllegalAssignmentErrors(env.driveDiagnostics());\n+           });\n+\n+        it('should produce diagnostics for inputs which assign to readonly, private, and protected fields inherited from a base class',\n+           () => {\n+             env.write('test.ts', correctInputsToRestrictedFieldsFromBaseClass);\n+             expectIllegalAssignmentErrors(env.driveDiagnostics());\n+           });\n+\n+        function expectIllegalAssignmentErrors(diags: ReadonlyArray<ts.Diagnostic>) {\n+          expect(diags.length).toBe(3);\n+          const actualMessages = diags.map(d => d.messageText).sort();\n+          const expectedMessages = [\n+            `Property 'protectedField' is protected and only accessible within class 'TestDir' and its subclasses.`,\n+            `Property 'privateField' is private and only accessible within class 'TestDir'.`,\n+            `Cannot assign to 'readonlyField' because it is a read-only property.`,\n+          ].sort();\n+          expect(actualMessages).toEqual(expectedMessages);\n+        }\n+\n+        it('should report invalid type assignment when field name is not a valid JS identifier',\n+           () => {\n+             env.write('test.ts', `\n+            import {Component, NgModule, Input, Directive} from '@angular/core';\n+\n+            @Component({\n+              selector: 'blah',\n+              template: '<div dir [private-input.xs]=\"value\"></div>',\n+            })\n+            export class FooCmp {\n+              value = 5;\n+            }\n+\n+            @Directive({selector: '[dir]'})\n+            export class TestDir {\n+              @Input()\n+              private 'private-input.xs'!: string;\n+            }\n+\n+            @NgModule({\n+              declarations: [FooCmp, TestDir],\n+            })\n+            export class FooModule {}\n+          `);\n+             const diags = env.driveDiagnostics();\n+             expect(diags.length).toBe(1);\n+             expect(diags[0].messageText)\n+                 .toEqual(`Type 'number' is not assignable to type 'string'.`);\n+           });\n+      });\n+\n+      describe('with strict inputs', () => {\n+        beforeEach(() => {\n+          env.tsconfig({fullTemplateTypeCheck: true, strictInputTypes: true});\n+        });\n+\n+        it('should not produce diagnostics for correct inputs which assign to readonly, private, or protected fields',\n+           () => {\n+             env.write('test.ts', correctTypeInputsToRestrictedFields);\n+             const diags = env.driveDiagnostics();\n+             expect(diags.length).toBe(0);\n+           });\n+\n+        it('should not produce diagnostics for correct inputs which assign to readonly, private, or protected fields inherited from a base class',\n+           () => {\n+             env.write('test.ts', correctInputsToRestrictedFieldsFromBaseClass);\n              const diags = env.driveDiagnostics();\n              expect(diags.length).toBe(0);\n            });"
        }
    ],
    "stats": {
        "total": 295,
        "additions": 236,
        "deletions": 59
    }
}