{
    "author": "bjarkler",
    "message": "fix(compiler): only promote Trusted Types to constants when necessary (#39554)\n\nPreviously all constant values of security-sensitive attributes and\nproperties were promoted to Trusted Types. While this is not inherently\nbad, it is also not optimal.\n\nUse the newly added Trusted Types schema to restrict promotion to\nconstants that are in a Trusted Types-relevant context.\n\nPR Close #39554",
    "sha": "4916870dff60e627baba59fcb6d30eb4045324d8",
    "files": [
        {
            "sha": "743e1f5b751c58661309ae4813c95d8b722cac8a",
            "filename": "packages/compiler/src/render3/view/template.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 9,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/4916870dff60e627baba59fcb6d30eb4045324d8/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/4916870dff60e627baba59fcb6d30eb4045324d8/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts?ref=4916870dff60e627baba59fcb6d30eb4045324d8",
            "patch": "@@ -24,6 +24,7 @@ import {mapLiteral} from '../../output/map_util';\n import * as o from '../../output/output_ast';\n import {ParseError, ParseSourceSpan} from '../../parse_util';\n import {DomElementSchemaRegistry} from '../../schema/dom_element_schema_registry';\n+import {isTrustedTypesSink} from '../../schema/trusted_types_sinks';\n import {CssSelector, SelectorMatcher} from '../../selector';\n import {BindingParser} from '../../template_parser/binding_parser';\n import {error, partitionArray} from '../../util';\n@@ -2151,15 +2152,19 @@ export function resolveSanitizationFn(context: core.SecurityContext, isAttribute\n \n function trustedConstAttribute(tagName: string, attr: t.TextAttribute): o.Expression {\n   const value = asLiteral(attr.value);\n-  switch (elementRegistry.securityContext(tagName, attr.name, /* isAttribute */ true)) {\n-    case core.SecurityContext.HTML:\n-      return o.importExpr(R3.trustConstantHtml).callFn([value], attr.valueSpan);\n-    case core.SecurityContext.SCRIPT:\n-      return o.importExpr(R3.trustConstantScript).callFn([value], attr.valueSpan);\n-    case core.SecurityContext.RESOURCE_URL:\n-      return o.importExpr(R3.trustConstantResourceUrl).callFn([value], attr.valueSpan);\n-    default:\n-      return value;\n+  if (isTrustedTypesSink(tagName, attr.name)) {\n+    switch (elementRegistry.securityContext(tagName, attr.name, /* isAttribute */ true)) {\n+      case core.SecurityContext.HTML:\n+        return o.importExpr(R3.trustConstantHtml).callFn([value], attr.valueSpan);\n+      case core.SecurityContext.SCRIPT:\n+        return o.importExpr(R3.trustConstantScript).callFn([value], attr.valueSpan);\n+      case core.SecurityContext.RESOURCE_URL:\n+        return o.importExpr(R3.trustConstantResourceUrl).callFn([value], attr.valueSpan);\n+      default:\n+        return value;\n+    }\n+  } else {\n+    return value;\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 14,
        "deletions": 9
    }
}