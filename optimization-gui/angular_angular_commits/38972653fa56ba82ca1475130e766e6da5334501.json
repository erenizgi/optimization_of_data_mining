{
    "author": "ItNoN",
    "message": "fix(http): emit error on XMLHttpRequest abort event (#40767)\n\nBefore this change, when Google Chrome cancels a XMLHttpRequest, an Observable of the response\nnever finishes. This happens, for example, when you put your computer to sleep or just press\nCtrl+S to save the browser page. After this commit, if request is canceled or aborted an\nappropriate Observable will be completed with an error.\n\nFixes #22324\n\nPR Close #40767",
    "sha": "38972653fa56ba82ca1475130e766e6da5334501",
    "files": [
        {
            "sha": "47e0e4cb45d6ab85077ee64e5275a9a145691601",
            "filename": "packages/common/http/src/xhr.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts",
            "raw_url": "https://github.com/angular/angular/raw/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts?ref=38972653fa56ba82ca1475130e766e6da5334501",
            "patch": "@@ -312,6 +312,7 @@ export class HttpXhrBackend implements HttpBackend {\n       xhr.addEventListener('load', onLoad);\n       xhr.addEventListener('error', onError);\n       xhr.addEventListener('timeout', onError);\n+      xhr.addEventListener('abort', onError);\n \n       // Progress events are only enabled if requested.\n       if (req.reportProgress) {\n@@ -333,6 +334,7 @@ export class HttpXhrBackend implements HttpBackend {\n       return () => {\n         // On a cancellation, remove all registered event listeners.\n         xhr.removeEventListener('error', onError);\n+        xhr.removeEventListener('abort', onError);\n         xhr.removeEventListener('load', onLoad);\n         xhr.removeEventListener('timeout', onError);\n         if (req.reportProgress) {"
        },
        {
            "sha": "1ac2481933bf9483bbfe1d3a09a3ac8d831d56a5",
            "filename": "packages/common/http/test/xhr_mock.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_mock.ts",
            "raw_url": "https://github.com/angular/angular/raw/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_mock.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_mock.ts?ref=38972653fa56ba82ca1475130e766e6da5334501",
            "patch": "@@ -55,6 +55,7 @@ export class MockXMLHttpRequest {\n   listeners: {\n     error?: (event: ErrorEvent) => void,\n     timeout?: (event: ErrorEvent) => void,\n+    abort?: () => void,\n     load?: () => void,\n     progress?: (event: ProgressEvent) => void,\n     uploadProgress?: (event: ProgressEvent) => void,\n@@ -71,12 +72,13 @@ export class MockXMLHttpRequest {\n     this.body = body;\n   }\n \n-  addEventListener(event: 'error'|'timeout'|'load'|'progress'|'uploadProgress', handler: Function):\n-      void {\n+  addEventListener(\n+      event: 'error'|'timeout'|'load'|'progress'|'uploadProgress'|'abort',\n+      handler: Function): void {\n     this.listeners[event] = handler as any;\n   }\n \n-  removeEventListener(event: 'error'|'timeout'|'load'|'progress'|'uploadProgress'): void {\n+  removeEventListener(event: 'error'|'timeout'|'load'|'progress'|'uploadProgress'|'abort'): void {\n     delete this.listeners[event];\n   }\n \n@@ -137,6 +139,12 @@ export class MockXMLHttpRequest {\n     }\n   }\n \n+  mockAbortEvent(): void {\n+    if (this.listeners.abort) {\n+      this.listeners.abort();\n+    }\n+  }\n+\n   abort() {\n     this.mockAborted = true;\n   }"
        },
        {
            "sha": "e8a462a0b1819f74de95f7c873860443bb658398",
            "filename": "packages/common/http/test/xhr_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/38972653fa56ba82ca1475130e766e6da5334501/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts?ref=38972653fa56ba82ca1475130e766e6da5334501",
            "patch": "@@ -173,6 +173,13 @@ const XSSI_PREFIX = ')]}\\'\\n';\n       factory.mock.abort = abort;\n       factory.mock.mockFlush(HttpStatusCode.Ok, 'OK', 'Done');\n     });\n+    it('emits an error when browser cancels a request', done => {\n+      backend.handle(TEST_POST).subscribe(undefined, (err: HttpErrorResponse) => {\n+        expect(err instanceof HttpErrorResponse).toBe(true);\n+        done();\n+      });\n+      factory.mock.mockAbortEvent();\n+    });\n     describe('progress events', () => {\n       it('are emitted for download progress', done => {\n         backend.handle(TEST_POST.clone({reportProgress: true}))"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 20,
        "deletions": 3
    }
}