{
    "author": "atscott",
    "message": "fix(router): correctly handle string command in outlets (#39728)\n\nThere are many places where examples use just a string for the command\nin outlets. When using nested outlets, we do not correctly handle\nthis case, as the types and algorithm always expect an array.\nThis PR updates the `createUrlTree` algorithm to account for the\npossibility of a string literal as the command for an outlet.\n\nFixes #18928\n\nPR Close #39728",
    "sha": "c33a8235d9e2d108c9071295d6364b69905505e9",
    "files": [
        {
            "sha": "2d2a9ae7ea50c09acdae1acb033f03535ccf3f25",
            "filename": "packages/router/src/create_url_tree.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/c33a8235d9e2d108c9071295d6364b69905505e9/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/c33a8235d9e2d108c9071295d6364b69905505e9/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts?ref=c33a8235d9e2d108c9071295d6364b69905505e9",
            "patch": "@@ -186,7 +186,7 @@ function createPositionApplyingDoubleDots(\n   return new Position(g, false, ci - dd);\n }\n \n-function getOutlets(commands: any[]): {[k: string]: any[]} {\n+function getOutlets(commands: unknown[]): {[k: string]: unknown[]|string} {\n   if (isCommandWithOutlets(commands[0])) {\n     return commands[0].outlets;\n   }\n@@ -229,7 +229,10 @@ function updateSegmentGroupChildren(\n     const outlets = getOutlets(commands);\n     const children: {[key: string]: UrlSegmentGroup} = {};\n \n-    forEach(outlets, (commands: any, outlet: string) => {\n+    forEach(outlets, (commands, outlet) => {\n+      if (typeof commands === 'string') {\n+        commands = [commands];\n+      }\n       if (commands !== null) {\n         children[outlet] = updateSegmentGroup(segmentGroup.children[outlet], startIndex, commands);\n       }\n@@ -311,9 +314,13 @@ function createNewSegmentGroup(\n   return new UrlSegmentGroup(paths, {});\n }\n \n-function createNewSegmentChildren(outlets: {[name: string]: any}): any {\n-  const children: {[key: string]: UrlSegmentGroup} = {};\n-  forEach(outlets, (commands: any, outlet: string) => {\n+function createNewSegmentChildren(outlets: {[name: string]: unknown[]|string}):\n+    {[outlet: string]: UrlSegmentGroup} {\n+  const children: {[outlet: string]: UrlSegmentGroup} = {};\n+  forEach(outlets, (commands, outlet) => {\n+    if (typeof commands === 'string') {\n+      commands = [commands];\n+    }\n     if (commands !== null) {\n       children[outlet] = createNewSegmentGroup(new UrlSegmentGroup([], {}), 0, commands);\n     }"
        },
        {
            "sha": "0826b2c6ff96a83aa8350427f691e6966d101022",
            "filename": "packages/router/test/create_url_tree.spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/c33a8235d9e2d108c9071295d6364b69905505e9/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c33a8235d9e2d108c9071295d6364b69905505e9/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts?ref=c33a8235d9e2d108c9071295d6364b69905505e9",
            "patch": "@@ -206,6 +206,13 @@ describe('createUrlTree', () => {\n     });\n   });\n \n+  it('can navigate to nested route where commands is string', () => {\n+    const p = serializer.parse('/');\n+    const t = createRoot(\n+        p, ['/', {outlets: {primary: ['child', {outlets: {primary: 'nested-primary'}}]}}]);\n+    expect(serializer.serialize(t)).toEqual('/child/nested-primary');\n+  });\n+\n   it('should throw when outlets is not the last command', () => {\n     const p = serializer.parse('/a');\n     expect(() => createRoot(p, ['a', {outlets: {right: ['c']}}, 'c']))"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 19,
        "deletions": 5
    }
}