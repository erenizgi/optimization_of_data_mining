{
    "author": "petebacondarwin",
    "message": "refactor(compiler-cli): implement `DeclarationNode` node type (#38959)\n\nPreviously the `ConcreteDeclaration` and `InlineDeclaration` had\ndifferent properties for the underlying node type. And the `InlineDeclaration`\ndid not store a value that represented its declaration.\n\nIt turns out that a natural declaration node for an inline type is the\nexpression. For example in UMD/CommonJS this would be the `exports.<name>`\nproperty access node.\n\nSo this expression is now used for the `node` of `InlineDeclaration` types\nand the `expression` property is dropped.\n\nTo support this the codebase has been refactored to use a new `DeclarationNode`\ntype which is a union of `ts.Declaration|ts.Expression` instead of `ts.Declaration`\nthroughout.\n\nPR Close #38959",
    "sha": "0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
    "files": [
        {
            "sha": "598823faea7a54a275062816b8fbccd31c7c5f7b",
            "filename": "packages/compiler-cli/ngcc/src/analysis/module_with_providers_analyzer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fmodule_with_providers_analyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fmodule_with_providers_analyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fmodule_with_providers_analyzer.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n import {ReferencesRegistry} from '../../../src/ngtsc/annotations';\n import {Reference} from '../../../src/ngtsc/imports';\n import {PartialEvaluator} from '../../../src/ngtsc/partial_evaluator';\n-import {ClassDeclaration, isNamedClassDeclaration, isNamedVariableDeclaration} from '../../../src/ngtsc/reflection';\n+import {ClassDeclaration, DeclarationNode, isNamedClassDeclaration, isNamedVariableDeclaration} from '../../../src/ngtsc/reflection';\n import {NgccReflectionHost} from '../host/ngcc_host';\n import {hasNameIdentifier, isDefined} from '../utils';\n \n@@ -30,7 +30,7 @@ export interface ModuleWithProvidersInfo {\n   /**\n    * Declaration of the containing class (if this is a method)\n    */\n-  container: ts.Declaration|null;\n+  container: DeclarationNode|null;\n   /**\n    * The declaration of the class that the `ngModule` property on the `ModuleWithProviders` object\n    * refers to.\n@@ -125,7 +125,7 @@ export class ModuleWithProvidersAnalyzer {\n    */\n   private parseForModuleWithProviders(\n       name: string, node: ts.Node|null, implementation: ts.Node|null = node,\n-      container: ts.Declaration|null = null): ModuleWithProvidersInfo|null {\n+      container: DeclarationNode|null = null): ModuleWithProvidersInfo|null {\n     if (implementation === null ||\n         (!ts.isFunctionDeclaration(implementation) && !ts.isMethodDeclaration(implementation) &&\n          !ts.isFunctionExpression(implementation))) {"
        },
        {
            "sha": "198e5659b82d0e80f29c01f9ed0f6ce11224dcf4",
            "filename": "packages/compiler-cli/ngcc/src/analysis/ngcc_references_registry.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fngcc_references_registry.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fngcc_references_registry.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fngcc_references_registry.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -9,7 +9,7 @@\n import * as ts from 'typescript';\n import {ReferencesRegistry} from '../../../src/ngtsc/annotations';\n import {Reference} from '../../../src/ngtsc/imports';\n-import {ConcreteDeclaration, ReflectionHost} from '../../../src/ngtsc/reflection';\n+import {Declaration, DeclarationNode, ReflectionHost} from '../../../src/ngtsc/reflection';\n import {hasNameIdentifier} from '../utils';\n \n /**\n@@ -20,7 +20,7 @@ import {hasNameIdentifier} from '../utils';\n  * from libraries that are compiled by ngcc.\n  */\n export class NgccReferencesRegistry implements ReferencesRegistry {\n-  private map = new Map<ts.Identifier, ConcreteDeclaration>();\n+  private map = new Map<ts.Identifier, Declaration>();\n \n   constructor(private host: ReflectionHost) {}\n \n@@ -29,12 +29,12 @@ export class NgccReferencesRegistry implements ReferencesRegistry {\n    * Only `ResolveReference` references are stored. Other types are ignored.\n    * @param references A collection of references to register.\n    */\n-  add(source: ts.Declaration, ...references: Reference<ts.Declaration>[]): void {\n+  add(source: DeclarationNode, ...references: Reference<DeclarationNode>[]): void {\n     references.forEach(ref => {\n       // Only store relative references. We are not interested in literals.\n       if (ref.bestGuessOwningModule === null && hasNameIdentifier(ref.node)) {\n         const declaration = this.host.getDeclarationOfIdentifier(ref.node.name);\n-        if (declaration && declaration.node !== null && hasNameIdentifier(declaration.node)) {\n+        if (declaration && hasNameIdentifier(declaration.node)) {\n           this.map.set(declaration.node.name, declaration);\n         }\n       }\n@@ -45,7 +45,7 @@ export class NgccReferencesRegistry implements ReferencesRegistry {\n    * Create and return a mapping for the registered resolved references.\n    * @returns A map of reference identifiers to reference declarations.\n    */\n-  getDeclarationMap(): Map<ts.Identifier, ConcreteDeclaration> {\n+  getDeclarationMap(): Map<ts.Identifier, Declaration> {\n     return this.map;\n   }\n }"
        },
        {
            "sha": "4dcbf9461cf481bde32d58bbb06948c457b5e313",
            "filename": "packages/compiler-cli/ngcc/src/analysis/private_declarations_analyzer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fprivate_declarations_analyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fprivate_declarations_analyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fprivate_declarations_analyzer.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n import * as ts from 'typescript';\n \n import {absoluteFromSourceFile, AbsoluteFsPath} from '../../../src/ngtsc/file_system';\n-import {ConcreteDeclaration} from '../../../src/ngtsc/reflection';\n+import {Declaration} from '../../../src/ngtsc/reflection';\n import {NgccReflectionHost} from '../host/ngcc_host';\n import {hasNameIdentifier, isDefined} from '../utils';\n \n@@ -40,8 +40,8 @@ export class PrivateDeclarationsAnalyzer {\n \n   private getPrivateDeclarations(\n       rootFiles: ts.SourceFile[],\n-      declarations: Map<ts.Identifier, ConcreteDeclaration>): PrivateDeclarationsAnalyses {\n-    const privateDeclarations: Map<ts.Identifier, ConcreteDeclaration> = new Map(declarations);\n+      declarations: Map<ts.Identifier, Declaration>): PrivateDeclarationsAnalyses {\n+    const privateDeclarations: Map<ts.Identifier, Declaration> = new Map(declarations);\n \n     rootFiles.forEach(f => {\n       const exports = this.host.getExportsOfModule(f);"
        },
        {
            "sha": "bec9985b30df1e03c90b4f60a4e2f651f3f2b81a",
            "filename": "packages/compiler-cli/ngcc/src/host/commonjs_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-import {Declaration, Import} from '../../../src/ngtsc/reflection';\n+import {Declaration, DeclarationKind, Import} from '../../../src/ngtsc/reflection';\n import {BundleProgram} from '../packages/bundle_program';\n import {FactoryMap, isDefined} from '../utils';\n \n@@ -181,7 +181,7 @@ export class CommonJsReflectionHost extends Esm5ReflectionHost {\n     } else {\n       return {\n         name,\n-        declaration: {node: null, known: null, expression, viaModule: null},\n+        declaration: {node: expression, known: null, kind: DeclarationKind.Inline, viaModule: null},\n       };\n     }\n   }\n@@ -204,7 +204,7 @@ export class CommonJsReflectionHost extends Esm5ReflectionHost {\n       return null;\n     }\n     const viaModule = isExternalImport(importPath) ? importPath : null;\n-    return {node: module, known: null, viaModule, identity: null};\n+    return {node: module, known: null, viaModule, identity: null, kind: DeclarationKind.Concrete};\n   }\n \n   private resolveModuleName(moduleName: string, containingFile: ts.SourceFile): ts.SourceFile"
        },
        {
            "sha": "e72a40a94d01a4c0ba02073f664bf09ab50ad20d",
            "filename": "packages/compiler-cli/ngcc/src/host/delegating_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fdelegating_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fdelegating_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fdelegating_host.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n \n import * as ts from 'typescript';\n \n-import {ClassDeclaration, ClassMember, CtorParameter, Declaration, Decorator, FunctionDefinition, Import, ReflectionHost} from '../../../src/ngtsc/reflection';\n+import {ClassDeclaration, ClassMember, CtorParameter, Declaration, DeclarationNode, Decorator, FunctionDefinition, Import, ReflectionHost} from '../../../src/ngtsc/reflection';\n import {isFromDtsFile} from '../../../src/ngtsc/util/src/typescript';\n \n import {NgccClassSymbol, NgccReflectionHost, SwitchableVariableDeclaration} from './ngcc_host';\n@@ -38,7 +38,7 @@ export class DelegatingReflectionHost implements NgccReflectionHost {\n     return this.ngccHost.getDeclarationOfIdentifier(id);\n   }\n \n-  getDecoratorsOfDeclaration(declaration: ts.Declaration): Decorator[]|null {\n+  getDecoratorsOfDeclaration(declaration: DeclarationNode): Decorator[]|null {\n     if (isFromDtsFile(declaration)) {\n       return this.tsHost.getDecoratorsOfDeclaration(declaration);\n     }\n@@ -52,7 +52,7 @@ export class DelegatingReflectionHost implements NgccReflectionHost {\n     return this.ngccHost.getDefinitionOfFunction(fn);\n   }\n \n-  getDtsDeclaration(declaration: ts.Declaration): ts.Declaration|null {\n+  getDtsDeclaration(declaration: DeclarationNode): ts.Declaration|null {\n     if (isFromDtsFile(declaration)) {\n       return this.tsHost.getDtsDeclaration(declaration);\n     }"
        },
        {
            "sha": "ddf995480328344c0166e8c97305743f4ec9c8c3",
            "filename": "packages/compiler-cli/ngcc/src/host/esm2015_host.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 32,
            "changes": 64,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm2015_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm2015_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm2015_host.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n \n import {absoluteFromSourceFile} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-import {ClassDeclaration, ClassMember, ClassMemberKind, CtorParameter, Declaration, Decorator, EnumMember, Import, isDecoratorIdentifier, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, reflectObjectLiteral, SpecialDeclarationKind, TypeScriptReflectionHost, TypeValueReference, TypeValueReferenceKind, ValueUnavailableKind} from '../../../src/ngtsc/reflection';\n+import {ClassDeclaration, ClassMember, ClassMemberKind, CtorParameter, Declaration, DeclarationNode, Decorator, EnumMember, Import, isConcreteDeclaration, isDecoratorIdentifier, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, reflectObjectLiteral, SpecialDeclarationKind, TypeScriptReflectionHost, TypeValueReference, TypeValueReferenceKind, ValueUnavailableKind} from '../../../src/ngtsc/reflection';\n import {isWithinPackage} from '../analysis/util';\n import {BundleProgram} from '../packages/bundle_program';\n import {findAll, getNameText, hasNameIdentifier, isDefined, stripDollarSuffix} from '../utils';\n@@ -58,15 +58,15 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * tree. Note that by definition the key and value declarations will not be in the same TS\n    * program.\n    */\n-  protected publicDtsDeclarationMap: Map<ts.Declaration, ts.Declaration>|null = null;\n+  protected publicDtsDeclarationMap: Map<DeclarationNode, ts.Declaration>|null = null;\n   /**\n    * A mapping from source declarations to typings declarations, which are not publicly exported.\n    *\n    * This mapping is a best guess between declarations that happen to be exported from their file by\n    * the same name in both the source and the dts file. Note that by definition the key and value\n    * declarations will not be in the same TS program.\n    */\n-  protected privateDtsDeclarationMap: Map<ts.Declaration, ts.Declaration>|null = null;\n+  protected privateDtsDeclarationMap: Map<DeclarationNode, ts.Declaration>|null = null;\n \n   /**\n    * The set of source files that have already been preprocessed.\n@@ -88,7 +88,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    *\n    * This map is populated during the preprocessing of each source file.\n    */\n-  protected aliasedClassDeclarations = new Map<ts.Declaration, ts.Identifier>();\n+  protected aliasedClassDeclarations = new Map<DeclarationNode, ts.Identifier>();\n \n   /**\n    * Caches the information of the decorators on a class, as the work involved with extracting\n@@ -140,16 +140,17 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * Examine a declaration (for example, of a class or function) and return metadata about any\n    * decorators present on the declaration.\n    *\n-   * @param declaration a TypeScript `ts.Declaration` node representing the class or function over\n-   * which to reflect. For example, if the intent is to reflect the decorators of a class and the\n-   * source is in ES6 format, this will be a `ts.ClassDeclaration` node. If the source is in ES5\n-   * format, this might be a `ts.VariableDeclaration` as classes in ES5 are represented as the\n-   * result of an IIFE execution.\n+   * @param declaration a TypeScript node representing the class or function over which to reflect.\n+   *     For example, if the intent is to reflect the decorators of a class and the source is in ES6\n+   *     format, this will be a `ts.ClassDeclaration` node. If the source is in ES5 format, this\n+   *     might be a `ts.VariableDeclaration` as classes in ES5 are represented as the result of an\n+   *     IIFE execution.\n    *\n    * @returns an array of `Decorator` metadata if decorators are present on the declaration, or\n-   * `null` if either no decorators were present or if the declaration is not of a decoratable type.\n+   *     `null` if either no decorators were present or if the declaration is not of a decoratable\n+   *     type.\n    */\n-  getDecoratorsOfDeclaration(declaration: ts.Declaration): Decorator[]|null {\n+  getDecoratorsOfDeclaration(declaration: DeclarationNode): Decorator[]|null {\n     const symbol = this.getClassSymbol(declaration);\n     if (!symbol) {\n       return null;\n@@ -280,13 +281,14 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n   getDeclarationOfIdentifier(id: ts.Identifier): Declaration|null {\n     const superDeclaration = super.getDeclarationOfIdentifier(id);\n \n-    // If no declaration was found or it's an inline declaration, return as is.\n-    if (superDeclaration === null || superDeclaration.node === null) {\n+    // If no declaration was found, return.\n+    if (superDeclaration === null) {\n       return superDeclaration;\n     }\n \n     // If the declaration already has traits assigned to it, return as is.\n-    if (superDeclaration.known !== null || superDeclaration.identity !== null) {\n+    if (superDeclaration.known !== null ||\n+        isConcreteDeclaration(superDeclaration) && superDeclaration.identity !== null) {\n       return superDeclaration;\n     }\n \n@@ -302,7 +304,8 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n     const declaration = outerNode !== null && isNamedVariableDeclaration(outerNode) ?\n         this.getDeclarationOfIdentifier(outerNode.name) :\n         superDeclaration;\n-    if (declaration === null || declaration.node === null || declaration.known !== null) {\n+    if (declaration === null || declaration.known !== null ||\n+        isConcreteDeclaration(declaration) && declaration.identity !== null) {\n       return declaration;\n     }\n \n@@ -314,7 +317,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n     }\n \n     // Variable declarations may represent an enum declaration, so attempt to resolve its members.\n-    if (ts.isVariableDeclaration(declaration.node)) {\n+    if (isConcreteDeclaration(declaration) && ts.isVariableDeclaration(declaration.node)) {\n       const enumMembers = this.resolveEnumMembers(declaration.node);\n       if (enumMembers !== null) {\n         declaration.identity = {kind: SpecialDeclarationKind.DownleveledEnum, enumMembers};\n@@ -450,7 +453,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * Note that the `ts.ClassDeclaration` returned from this function may not be from the same\n    * `ts.Program` as the input declaration.\n    */\n-  getDtsDeclaration(declaration: ts.Declaration): ts.Declaration|null {\n+  getDtsDeclaration(declaration: DeclarationNode): ts.Declaration|null {\n     if (this.dts === null) {\n       return null;\n     }\n@@ -777,7 +780,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * @returns The original identifier that the given class declaration resolves to, or `undefined`\n    * if the declaration does not represent an aliased class.\n    */\n-  protected resolveAliasedClassIdentifier(declaration: ts.Declaration): ts.Identifier|null {\n+  protected resolveAliasedClassIdentifier(declaration: DeclarationNode): ts.Identifier|null {\n     this.ensurePreprocessed(declaration.getSourceFile());\n     return this.aliasedClassDeclarations.has(declaration) ?\n         this.aliasedClassDeclarations.get(declaration)! :\n@@ -829,7 +832,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n     const aliasedIdentifier = initializer.left;\n \n     const aliasedDeclaration = this.getDeclarationOfIdentifier(aliasedIdentifier);\n-    if (aliasedDeclaration === null || aliasedDeclaration.node === null) {\n+    if (aliasedDeclaration === null) {\n       throw new Error(\n           `Unable to locate declaration of ${aliasedIdentifier.text} in \"${statement.getText()}\"`);\n     }\n@@ -1628,7 +1631,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n \n     const imp = this.getImportOfExpression(typeExpression);\n     const decl = this.getDeclarationOfExpression(typeExpression);\n-    if (imp === null || decl === null || decl.node === null) {\n+    if (imp === null || decl === null) {\n       return {\n         kind: TypeValueReferenceKind.LOCAL,\n         expression: typeExpression,\n@@ -1788,8 +1791,8 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * @returns a map of source declarations to typings declarations.\n    */\n   protected computePublicDtsDeclarationMap(src: BundleProgram, dts: BundleProgram):\n-      Map<ts.Declaration, ts.Declaration> {\n-    const declarationMap = new Map<ts.Declaration, ts.Declaration>();\n+      Map<DeclarationNode, ts.Declaration> {\n+    const declarationMap = new Map<DeclarationNode, ts.Declaration>();\n     const dtsDeclarationMap = new Map<string, ts.Declaration>();\n     const rootDts = getRootFileOrFail(dts);\n     this.collectDtsExportedDeclarations(dtsDeclarationMap, rootDts, dts.program.getTypeChecker());\n@@ -1812,8 +1815,8 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n    * @returns a map of source declarations to typings declarations.\n    */\n   protected computePrivateDtsDeclarationMap(src: BundleProgram, dts: BundleProgram):\n-      Map<ts.Declaration, ts.Declaration> {\n-    const declarationMap = new Map<ts.Declaration, ts.Declaration>();\n+      Map<DeclarationNode, ts.Declaration> {\n+    const declarationMap = new Map<DeclarationNode, ts.Declaration>();\n     const dtsDeclarationMap = new Map<string, ts.Declaration>();\n     const typeChecker = dts.program.getTypeChecker();\n \n@@ -1855,13 +1858,13 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n \n \n   protected collectSrcExportedDeclarations(\n-      declarationMap: Map<ts.Declaration, ts.Declaration>,\n+      declarationMap: Map<DeclarationNode, ts.Declaration>,\n       dtsDeclarationMap: Map<string, ts.Declaration>, srcFile: ts.SourceFile): void {\n     const fileExports = this.getExportsOfModule(srcFile);\n     if (fileExports !== null) {\n-      for (const [exportName, {node: declaration}] of fileExports) {\n-        if (declaration !== null && dtsDeclarationMap.has(exportName)) {\n-          declarationMap.set(declaration, dtsDeclarationMap.get(exportName)!);\n+      for (const [exportName, {node: declarationNode}] of fileExports) {\n+        if (dtsDeclarationMap.has(exportName)) {\n+          declarationMap.set(declarationNode, dtsDeclarationMap.get(exportName)!);\n         }\n       }\n     }\n@@ -1877,7 +1880,7 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n     }\n \n     const namespaceDecl = this.getDeclarationOfIdentifier(expression.expression);\n-    if (!namespaceDecl || namespaceDecl.node === null || !ts.isSourceFile(namespaceDecl.node)) {\n+    if (!namespaceDecl || !ts.isSourceFile(namespaceDecl.node)) {\n       return null;\n     }\n \n@@ -1896,9 +1899,6 @@ export class Esm2015ReflectionHost extends TypeScriptReflectionHost implements N\n \n   /** Checks if the specified declaration resolves to the known JavaScript global `Object`. */\n   protected isJavaScriptObjectDeclaration(decl: Declaration): boolean {\n-    if (decl.node === null) {\n-      return false;\n-    }\n     const node = decl.node;\n     // The default TypeScript library types the global `Object` variable through\n     // a variable declaration with a type reference resolving to `ObjectConstructor`."
        },
        {
            "sha": "5af9c9f12391b6f6336ef9e9669aaab48c19a21b",
            "filename": "packages/compiler-cli/ngcc/src/host/esm5_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n \n import * as ts from 'typescript';\n \n-import {ClassDeclaration, ClassMember, ClassMemberKind, Declaration, Decorator, FunctionDefinition, isNamedFunctionDeclaration, KnownDeclaration, Parameter, reflectObjectLiteral} from '../../../src/ngtsc/reflection';\n+import {ClassDeclaration, ClassMember, ClassMemberKind, Declaration, DeclarationKind, Decorator, FunctionDefinition, isNamedFunctionDeclaration, KnownDeclaration, Parameter, reflectObjectLiteral} from '../../../src/ngtsc/reflection';\n import {getTsHelperFnFromDeclaration, getTsHelperFnFromIdentifier, hasNameIdentifier} from '../utils';\n \n import {Esm2015ReflectionHost, getOuterNodeFromInnerDeclaration, getPropertyValueFromSymbol, isAssignmentStatement, ParamInfo} from './esm2015_host';\n@@ -82,9 +82,9 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n         // `importHelpers: false` (the default). This is, for example, the case with\n         // `@nativescript/angular@9.0.0-next-2019-11-12-155500-01`.\n         return {\n-          expression: id,\n+          kind: DeclarationKind.Inline,\n+          node: id,\n           known: nonEmittedNorImportedTsHelperDeclaration,\n-          node: null,\n           viaModule: null,\n         };\n       }"
        },
        {
            "sha": "ec934ffaffcc1fa822f3322b0387f9cf91d6ffea",
            "filename": "packages/compiler-cli/ngcc/src/host/umd_host.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 25,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-import {Declaration, Import} from '../../../src/ngtsc/reflection';\n+import {Declaration, DeclarationKind, Import} from '../../../src/ngtsc/reflection';\n import {BundleProgram} from '../packages/bundle_program';\n import {FactoryMap, getTsHelperFnFromIdentifier, stripExtension} from '../utils';\n \n@@ -172,17 +172,8 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n \n     const viaModule = stripExtension(importedFile.fileName);\n     const reexports: ExportDeclaration[] = [];\n-    importedExports.forEach((decl, name) => {\n-      if (decl.node !== null) {\n-        reexports.push({\n-          name,\n-          declaration: {node: decl.node, known: null, viaModule, identity: decl.identity}\n-        });\n-      } else {\n-        reexports.push(\n-            {name, declaration: {node: null, known: null, expression: decl.expression, viaModule}});\n-      }\n-    });\n+    importedExports.forEach(\n+        (decl, name) => reexports.push({name, declaration: {...decl, viaModule}}));\n     return reexports;\n   }\n \n@@ -204,7 +195,7 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n     }\n     return {\n       name,\n-      declaration: {node: null, known: null, expression, viaModule: null},\n+      declaration: {kind: DeclarationKind.Inline, node: expression, known: null, viaModule: null},\n     };\n   }\n \n@@ -255,22 +246,31 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n       return null;\n     }\n \n-    // Sadly, in the case of `exports.foo = bar`, we can't use `this.findUmdImportParameter(id)` to\n-    // check whether this `exports` is from the IIFE body arguments, because\n-    // `this.checker.getSymbolAtLocation(id)` will return the symbol for the `foo` identifier rather\n-    // than the `exports` identifier.\n+    // Sadly, in the case of `exports.foo = bar`, we can't use `this.findUmdImportParameter(id)`\n+    // to check whether this `exports` is from the IIFE body arguments, because\n+    // `this.checker.getSymbolAtLocation(id)` will return the symbol for the `foo` identifier\n+    // rather than the `exports` identifier.\n     //\n     // Instead we search the symbols in the current local scope.\n     const exportsSymbol = this.checker.getSymbolsInScope(id, ts.SymbolFlags.Variable)\n                               .find(symbol => symbol.name === 'exports');\n-    if (exportsSymbol !== undefined &&\n-        !ts.isFunctionExpression(exportsSymbol.valueDeclaration.parent)) {\n-      // There is an `exports` symbol in the local scope that is not a function parameter.\n-      // So this `exports` identifier must be a local variable and does not represent the module.\n-      return {node: exportsSymbol.valueDeclaration, viaModule: null, known: null, identity: null};\n-    }\n \n-    return {node: id.getSourceFile(), viaModule: null, known: null, identity: null};\n+    const node = exportsSymbol !== undefined &&\n+            !ts.isFunctionExpression(exportsSymbol.valueDeclaration.parent) ?\n+        // There is a locally defined `exports` variable that is not a function parameter.\n+        // So this `exports` identifier must be a local variable and does not represent the module.\n+        exportsSymbol.valueDeclaration :\n+        // There is no local symbol or it is a parameter of an IIFE.\n+        // So this `exports` represents the current \"module\".\n+        id.getSourceFile();\n+\n+    return {\n+      kind: DeclarationKind.Concrete,\n+      node,\n+      viaModule: null,\n+      known: null,\n+      identity: null,\n+    };\n   }\n \n   private getUmdModuleDeclaration(id: ts.Identifier): Declaration|null {\n@@ -285,7 +285,7 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n     }\n \n     const viaModule = isExternalImport(importPath) ? importPath : null;\n-    return {node: module, viaModule, known: null, identity: null};\n+    return {kind: DeclarationKind.Concrete, node: module, viaModule, known: null, identity: null};\n   }\n \n   private getImportPathFromParameter(id: ts.Identifier): string|null {"
        },
        {
            "sha": "2ee3a33252ff753054e6ee9758c2d604e0454bac",
            "filename": "packages/compiler-cli/ngcc/src/migrations/missing_injectable_migration.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fmissing_injectable_migration.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fmissing_injectable_migration.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fmissing_injectable_migration.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -151,7 +151,7 @@ function migrateProviderClass(provider: ResolvedValue, host: MigrationHost): voi\n     return;\n   }\n \n-  const clazz = provider.node as ts.Declaration;\n+  const clazz = provider.node;\n   if (isClassDeclaration(clazz) && host.isInScope(clazz) && needsInjectableDecorator(clazz, host)) {\n     host.injectSyntheticDecorator(clazz, createInjectableDecorator(clazz));\n   }"
        },
        {
            "sha": "d1e9edfb969a373c6d9be9f1ab3056356db2d835",
            "filename": "packages/compiler-cli/ngcc/src/migrations/undecorated_parent_migration.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fundecorated_parent_migration.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fundecorated_parent_migration.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Fundecorated_parent_migration.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -101,7 +101,7 @@ function determineBaseClass(\n   }\n \n   const baseClass = host.evaluator.evaluate(baseClassExpr);\n-  if (!(baseClass instanceof Reference) || !isClassDeclaration(baseClass.node as ts.Declaration)) {\n+  if (!(baseClass instanceof Reference) || !isClassDeclaration(baseClass.node)) {\n     return null;\n   }\n "
        },
        {
            "sha": "16a6ccddf73e546d6caa288b7cb05a8e079dac5a",
            "filename": "packages/compiler-cli/ngcc/src/migrations/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmigrations%2Futils.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import {Reference} from '../../../src/ngtsc/imports';\n import {ClassDeclaration, Decorator, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration} from '../../../src/ngtsc/reflection';\n import {MigrationHost} from './migration';\n \n-export function isClassDeclaration(clazz: ts.Declaration): clazz is ClassDeclaration {\n+export function isClassDeclaration(clazz: ts.Node): clazz is ClassDeclaration<ts.Declaration> {\n   return isNamedClassDeclaration(clazz) || isNamedFunctionDeclaration(clazz) ||\n       isNamedVariableDeclaration(clazz);\n }"
        },
        {
            "sha": "de8b4c3193c0115b7cfb612341e2653df2efb458",
            "filename": "packages/compiler-cli/ngcc/src/utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n import * as ts from 'typescript';\n \n import {absoluteFrom, AbsoluteFsPath, FileSystem, isRooted} from '../../src/ngtsc/file_system';\n-import {KnownDeclaration} from '../../src/ngtsc/reflection';\n+import {DeclarationNode, KnownDeclaration} from '../../src/ngtsc/reflection';\n \n /**\n  * A list (`Array`) of partially ordered `T` items.\n@@ -71,7 +71,7 @@ export function findAll<T>(node: ts.Node, test: (node: ts.Node) => node is ts.No\n  * @param declaration The declaration to test.\n  * @returns true if the declaration has an identifier for a name.\n  */\n-export function hasNameIdentifier(declaration: ts.Node): declaration is ts.Declaration&\n+export function hasNameIdentifier(declaration: ts.Node): declaration is DeclarationNode&\n     {name: ts.Identifier} {\n   const namedDeclaration: ts.Node&{name?: ts.Node} = declaration;\n   return namedDeclaration.name !== undefined && ts.isIdentifier(namedDeclaration.name);\n@@ -136,7 +136,7 @@ export function resolveFileWithPostfixes(\n  * Determine whether a function declaration corresponds with a TypeScript helper function, returning\n  * its kind if so or null if the declaration does not seem to correspond with such a helper.\n  */\n-export function getTsHelperFnFromDeclaration(decl: ts.Declaration): KnownDeclaration|null {\n+export function getTsHelperFnFromDeclaration(decl: DeclarationNode): KnownDeclaration|null {\n   if (!ts.isFunctionDeclaration(decl) && !ts.isVariableDeclaration(decl)) {\n     return null;\n   }"
        },
        {
            "sha": "632490941456e87b57a2e526ec025f2c42523708",
            "filename": "packages/compiler-cli/ngcc/test/analysis/decoration_analyzer_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fdecoration_analyzer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fdecoration_analyzer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fdecoration_analyzer_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import {FatalDiagnosticError, makeDiagnostic} from '../../../src/ngtsc/diagnosti\n import {absoluteFrom, getFileSystem, getSourceFileOrError} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {ClassDeclaration, Decorator} from '../../../src/ngtsc/reflection';\n+import {ClassDeclaration, DeclarationNode, Decorator} from '../../../src/ngtsc/reflection';\n import {AnalysisOutput, CompileResult, DecoratorHandler, DetectResult, HandlerPrecedence} from '../../../src/ngtsc/transform';\n import {loadFakeCore, loadTestFiles} from '../../../test/helpers';\n import {DecorationAnalyzer} from '../../src/analysis/decoration_analyzer';\n@@ -52,7 +52,7 @@ runInEachFileSystem(() => {\n         ]);\n         // Only detect the Component and Directive decorators\n         handler.detect.and.callFake(\n-            (node: ts.Declaration, decorators: Decorator[]|null): DetectResult<unknown>|\n+            (node: DeclarationNode, decorators: Decorator[]|null): DetectResult<unknown>|\n             undefined => {\n               const className = (node as any).name.text;\n               if (decorators === null) {\n@@ -76,7 +76,7 @@ runInEachFileSystem(() => {\n               }\n             });\n         // The \"test\" analysis is an object with the name of the decorator being analyzed\n-        handler.analyze.and.callFake((decl: ts.Declaration, dec: Decorator) => {\n+        handler.analyze.and.callFake((decl: DeclarationNode, dec: Decorator) => {\n           logs.push(`analyze: ${(decl as any).name.text}@${dec.name}`);\n           return {\n             analysis: {decoratorName: dec.name},\n@@ -85,7 +85,7 @@ runInEachFileSystem(() => {\n           };\n         });\n         // The \"test\" resolution is just setting `resolved: true` on the analysis\n-        handler.resolve.and.callFake((decl: ts.Declaration, analysis: any) => {\n+        handler.resolve.and.callFake((decl: DeclarationNode, analysis: any) => {\n           logs.push(`resolve: ${(decl as any).name.text}@${analysis.decoratorName}`);\n           analysis.resolved = true;\n           return {\n@@ -95,10 +95,10 @@ runInEachFileSystem(() => {\n         });\n         // The \"test\" compilation result is just the name of the decorator being compiled\n         // (suffixed with `(compiled)`)\n-        (handler.compileFull as any).and.callFake((decl: ts.Declaration, analysis: any) => {\n+        handler.compileFull.and.callFake((decl: DeclarationNode, analysis: any) => {\n           logs.push(`compile: ${(decl as any).name.text}@${analysis.decoratorName} (resolved: ${\n               analysis.resolved})`);\n-          return `@${analysis.decoratorName} (compiled)`;\n+          return `@${analysis.decoratorName} (compiled)` as any;\n         });\n         return handler;\n       };"
        },
        {
            "sha": "8dbbf5007b554e23cc6e793a266c421b4ab248f4",
            "filename": "packages/compiler-cli/ngcc/test/analysis/module_with_providers_analyzer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fmodule_with_providers_analyzer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fmodule_with_providers_analyzer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Fmodule_with_providers_analyzer_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, AbsoluteFsPath, getSourceFileOrError} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {isNamedClassDeclaration, isNamedVariableDeclaration} from '../../../src/ngtsc/reflection';\n+import {DeclarationNode, isNamedClassDeclaration, isNamedVariableDeclaration} from '../../../src/ngtsc/reflection';\n import {getDeclaration} from '../../../src/ngtsc/testing';\n import {loadTestFiles} from '../../../test/helpers';\n import {ModuleWithProvidersAnalyses, ModuleWithProvidersAnalyzer} from '../../src/analysis/module_with_providers_analyzer';\n@@ -660,7 +660,7 @@ runInEachFileSystem(() => {\n                           [];\n       }\n \n-      function getName(node: ts.Declaration|null): string {\n+      function getName(node: DeclarationNode|null): string {\n         return node && (isNamedVariableDeclaration(node) || isNamedClassDeclaration(node)) ?\n             `${node.name.text}.` :\n             '';"
        },
        {
            "sha": "dbd10a017742aa59934a0834798e6af66225a049",
            "filename": "packages/compiler-cli/ngcc/test/analysis/references_registry_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Freferences_registry_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Freferences_registry_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fanalysis%2Freferences_registry_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import {absoluteFrom} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {Reference} from '../../../src/ngtsc/imports';\n import {PartialEvaluator} from '../../../src/ngtsc/partial_evaluator';\n-import {TypeScriptReflectionHost} from '../../../src/ngtsc/reflection';\n+import {DeclarationNode, TypeScriptReflectionHost} from '../../../src/ngtsc/reflection';\n import {getDeclaration} from '../../../src/ngtsc/testing';\n import {loadTestFiles} from '../../../test/helpers';\n import {NgccReferencesRegistry} from '../../src/analysis/ngcc_references_registry';\n@@ -61,7 +61,7 @@ runInEachFileSystem(() => {\n     });\n   });\n \n-  function isReference(ref: any): ref is Reference<ts.Declaration> {\n+  function isReference(ref: any): ref is Reference<DeclarationNode> {\n     return ref instanceof Reference;\n   }\n });"
        },
        {
            "sha": "01e9c3fc9298d316546192091c4c84e715b4ada9",
            "filename": "packages/compiler-cli/ngcc/test/host/commonjs_host_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, getFileSystem, getSourceFileOrError} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {ClassMemberKind, ConcreteDeclaration, CtorParameter, DownleveledEnum, InlineDeclaration, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n+import {ClassMemberKind, ConcreteDeclaration, CtorParameter, DeclarationKind, DownleveledEnum, InlineDeclaration, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n import {getDeclaration} from '../../../src/ngtsc/testing';\n import {loadFakeCore, loadTestFiles} from '../../../test/helpers';\n import {CommonJsReflectionHost} from '../../src/host/commonjs_host';\n@@ -1840,6 +1840,7 @@ exports.MissingClass2 = MissingClass2;\n                   const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n                   expect(helperDeclaration).toEqual({\n+                    kind: DeclarationKind.Concrete,\n                     known: knownAs,\n                     node: getHelperDeclaration(helperName),\n                     viaModule,\n@@ -2163,9 +2164,9 @@ exports.MissingClass2 = MissingClass2;\n                 const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n                 expect(helperDeclaration).toEqual({\n+                  kind: DeclarationKind.Inline,\n                   known: knownAs,\n-                  expression: helperIdentifier,\n-                  node: null,\n+                  node: helperIdentifier,\n                   viaModule: null,\n                 });\n               };\n@@ -2197,9 +2198,9 @@ exports.MissingClass2 = MissingClass2;\n                 const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n                 expect(helperDeclaration).toEqual({\n+                  kind: DeclarationKind.Inline,\n                   known: knownAs,\n-                  expression: helperIdentifier,\n-                  node: null,\n+                  node: helperIdentifier,\n                   viaModule: null,\n                 });\n               };\n@@ -2421,10 +2422,10 @@ exports.MissingClass2 = MissingClass2;\n           const file = getSourceFileOrError(bundle.program, _('/inline_export.js'));\n           const exportDeclarations = host.getExportsOfModule(file);\n           expect(exportDeclarations).not.toBeNull();\n-          const decl = exportDeclarations!.get('directives') as InlineDeclaration;\n-          expect(decl).not.toBeUndefined();\n-          expect(decl.node).toBeNull();\n-          expect(decl.expression).toBeDefined();\n+          const decl = exportDeclarations!.get('directives')!;\n+          expect(decl).toBeDefined();\n+          expect(decl.node).toBeDefined();\n+          expect(decl.kind).toEqual(DeclarationKind.Inline);\n         });\n \n         it('should recognize declarations of known TypeScript helpers', () => {"
        },
        {
            "sha": "a33dda88ae8a7b2de29083c0fa5e8649c859929e",
            "filename": "packages/compiler-cli/ngcc/test/host/esm2015_host_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm2015_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm2015_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm2015_host_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -2076,7 +2076,8 @@ runInEachFileSystem(() => {\n            }\n            expect(classSymbol.name).toEqual('DecoratedWrappedClass');\n            expect(classSymbol.declaration.valueDeclaration).toBe(outerNode);\n-           expect(classSymbol.implementation.valueDeclaration).toBe(innerNodes[0]);\n+           expect(classSymbol.implementation.valueDeclaration)\n+               .toBe(innerNodes[0] as ts.Declaration);\n \n            if (classSymbol.adjacent === undefined ||\n                !isNamedVariableDeclaration(classSymbol.adjacent.valueDeclaration)) {\n@@ -2112,7 +2113,8 @@ runInEachFileSystem(() => {\n            }\n            expect(classSymbol.name).toEqual('DecoratedWrappedClass');\n            expect(classSymbol.declaration.valueDeclaration).toBe(outerNode);\n-           expect(classSymbol.implementation.valueDeclaration).toBe(innerNodes[0]);\n+           expect(classSymbol.implementation.valueDeclaration)\n+               .toBe(innerNodes[0] as ts.Declaration);\n \n            if (classSymbol.adjacent === undefined ||\n                !isNamedVariableDeclaration(classSymbol.adjacent.valueDeclaration)) {"
        },
        {
            "sha": "46d7c5a18fecc655b1873ab70c9968c709618555",
            "filename": "packages/compiler-cli/ngcc/test/host/esm5_host_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, getFileSystem, getSourceFileOrError} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {ClassMemberKind, ConcreteDeclaration, CtorParameter, Decorator, DownleveledEnum, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n+import {ClassMemberKind, ConcreteDeclaration, CtorParameter, DeclarationKind, Decorator, DownleveledEnum, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n import {getDeclaration} from '../../../src/ngtsc/testing';\n import {loadFakeCore, loadTestFiles} from '../../../test/helpers';\n import {DelegatingReflectionHost} from '../../src/host/delegating_host';\n@@ -1858,6 +1858,7 @@ runInEachFileSystem(() => {\n                 const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n                 expect(helperDeclaration).toEqual({\n+                  kind: DeclarationKind.Concrete,\n                   known: knownAs,\n                   node: getHelperDeclaration(helperName),\n                   viaModule,\n@@ -2253,9 +2254,9 @@ runInEachFileSystem(() => {\n           const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n           expect(helperDeclaration).toEqual({\n+            kind: DeclarationKind.Inline,\n             known: knownAs,\n-            expression: helperIdentifier,\n-            node: null,\n+            node: helperIdentifier,\n             viaModule: null,\n           });\n         };\n@@ -2284,9 +2285,9 @@ runInEachFileSystem(() => {\n           const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n           expect(helperDeclaration).toEqual({\n+            kind: DeclarationKind.Inline,\n             known: knownAs,\n-            expression: helperIdentifier,\n-            node: null,\n+            node: helperIdentifier,\n             viaModule: null,\n           });\n         };"
        },
        {
            "sha": "fe06ec14b53fb3a51a2c5a44c4679e4b3bccdbed",
            "filename": "packages/compiler-cli/ngcc/test/host/umd_host_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, getFileSystem, getSourceFileOrError} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {ClassMemberKind, ConcreteDeclaration, CtorParameter, DownleveledEnum, Import, InlineDeclaration, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n+import {ClassMemberKind, ConcreteDeclaration, CtorParameter, DeclarationKind, DownleveledEnum, Import, InlineDeclaration, isNamedClassDeclaration, isNamedFunctionDeclaration, isNamedVariableDeclaration, KnownDeclaration, TypeScriptReflectionHost, TypeValueReferenceKind} from '../../../src/ngtsc/reflection';\n import {getDeclaration} from '../../../src/ngtsc/testing';\n import {loadFakeCore, loadTestFiles} from '../../../test/helpers';\n import {isExportsStatement} from '../../src/host/commonjs_umd_utils';\n@@ -2003,6 +2003,7 @@ runInEachFileSystem(() => {\n                 const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n                 expect(helperDeclaration).toEqual({\n+                  kind: DeclarationKind.Concrete,\n                   known: knownAs,\n                   node: getHelperDeclaration(factoryFn, helperName),\n                   viaModule,\n@@ -2410,9 +2411,9 @@ runInEachFileSystem(() => {\n           const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n           expect(helperDeclaration).toEqual({\n+            kind: DeclarationKind.Inline,\n             known: knownAs,\n-            expression: helperIdentifier,\n-            node: null,\n+            node: helperIdentifier,\n             viaModule: null,\n           });\n         };\n@@ -2449,9 +2450,9 @@ runInEachFileSystem(() => {\n           const helperDeclaration = host.getDeclarationOfIdentifier(helperIdentifier);\n \n           expect(helperDeclaration).toEqual({\n+            kind: DeclarationKind.Inline,\n             known: knownAs,\n-            expression: helperIdentifier,\n-            node: null,\n+            node: helperIdentifier,\n             viaModule: null,\n           });\n         };\n@@ -2697,10 +2698,10 @@ runInEachFileSystem(() => {\n         const file = getSourceFileOrError(bundle.program, INLINE_EXPORT_FILE.name);\n         const exportDeclarations = host.getExportsOfModule(file);\n         expect(exportDeclarations).not.toBe(null);\n-        const decl = exportDeclarations!.get('directives') as InlineDeclaration;\n-        expect(decl).not.toBeUndefined();\n-        expect(decl.node).toBeNull();\n-        expect(decl.expression).toBeDefined();\n+        const decl = exportDeclarations!.get('directives')!;\n+        expect(decl).toBeDefined();\n+        expect(decl.node).toBeDefined();\n+        expect(decl.kind).toEqual(DeclarationKind.Inline);\n       });\n \n       it('should recognize declarations of known TypeScript helpers', () => {\n@@ -2901,7 +2902,7 @@ runInEachFileSystem(() => {\n            const classSymbol = host.getClassSymbol(outerNode);\n \n            expect(classSymbol).toBeDefined();\n-           expect(classSymbol!.declaration.valueDeclaration).toBe(outerNode);\n+           expect(classSymbol!.declaration.valueDeclaration).toBe(outerNode as any);\n            expect(classSymbol!.implementation.valueDeclaration).toBe(innerNode);\n          });\n "
        },
        {
            "sha": "74c5c73b8342009c56798d399e6d92c979fc10ae",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -17,7 +17,7 @@ import {DependencyTracker} from '../../incremental/api';\n import {IndexingContext} from '../../indexer';\n import {ClassPropertyMapping, DirectiveMeta, DirectiveTypeCheckMeta, extractDirectiveTypeCheckMeta, InjectableClassRegistry, MetadataReader, MetadataRegistry, TemplateMapping} from '../../metadata';\n import {EnumValue, PartialEvaluator} from '../../partial_evaluator';\n-import {ClassDeclaration, Decorator, ReflectionHost, reflectObjectLiteral} from '../../reflection';\n+import {ClassDeclaration, DeclarationNode, Decorator, ReflectionHost, reflectObjectLiteral} from '../../reflection';\n import {ComponentScopeReader, LocalModuleScopeRegistry} from '../../scope';\n import {AnalysisOutput, CompileResult, DecoratorHandler, DetectResult, HandlerFlags, HandlerPrecedence, ResolveResult} from '../../transform';\n import {TemplateSourceMapping, TypeCheckContext} from '../../typecheck/api';\n@@ -103,7 +103,7 @@ export class ComponentDecoratorHandler implements\n    * any potential <link> tags which might need to be loaded. This cache ensures that work is not\n    * thrown away, and the parsed template is reused during the analyze phase.\n    */\n-  private preanalyzeTemplateCache = new Map<ts.Declaration, ParsedTemplateWithSource>();\n+  private preanalyzeTemplateCache = new Map<DeclarationNode, ParsedTemplateWithSource>();\n \n   readonly precedence = HandlerPrecedence.PRIMARY;\n   readonly name = ComponentDecoratorHandler.name;"
        },
        {
            "sha": "e0ac434c4bc8d9cfcfe1b04774fa92602055b32d",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/metadata.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,7 +10,7 @@ import {Expression, ExternalExpr, FunctionExpr, Identifiers, InvokeFunctionExpr,\n import * as ts from 'typescript';\n \n import {DefaultImportRecorder} from '../../imports';\n-import {CtorParameter, Decorator, ReflectionHost, TypeValueReferenceKind} from '../../reflection';\n+import {CtorParameter, DeclarationNode, Decorator, ReflectionHost, TypeValueReferenceKind} from '../../reflection';\n \n import {valueReferenceToExpression, wrapFunctionExpressionsInParens} from './util';\n \n@@ -23,8 +23,9 @@ import {valueReferenceToExpression, wrapFunctionExpressionsInParens} from './uti\n  * as a `Statement` for inclusion along with the class.\n  */\n export function generateSetClassMetadataCall(\n-    clazz: ts.Declaration, reflection: ReflectionHost, defaultImportRecorder: DefaultImportRecorder,\n-    isCore: boolean, annotateForClosureCompiler?: boolean): Statement|null {\n+    clazz: DeclarationNode, reflection: ReflectionHost,\n+    defaultImportRecorder: DefaultImportRecorder, isCore: boolean,\n+    annotateForClosureCompiler?: boolean): Statement|null {\n   if (!reflection.isClass(clazz)) {\n     return null;\n   }"
        },
        {
            "sha": "37afa3b8fccfc77d32aa4f3c53ef8e40475ab0d7",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/ng_module.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -13,7 +13,7 @@ import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation}\n import {DefaultImportRecorder, Reference, ReferenceEmitter} from '../../imports';\n import {InjectableClassRegistry, MetadataReader, MetadataRegistry} from '../../metadata';\n import {PartialEvaluator, ResolvedValue} from '../../partial_evaluator';\n-import {ClassDeclaration, Decorator, ReflectionHost, reflectObjectLiteral, typeNodeToValueExpr} from '../../reflection';\n+import {ClassDeclaration, DeclarationNode, Decorator, isNamedClassDeclaration, ReflectionHost, reflectObjectLiteral, typeNodeToValueExpr} from '../../reflection';\n import {NgModuleRouteAnalyzer} from '../../routing';\n import {LocalModuleScopeRegistry, ScopeData} from '../../scope';\n import {FactoryTracker} from '../../shims/api';\n@@ -434,14 +434,14 @@ export class NgModuleDecoratorHandler implements\n   }\n \n   private _toR3Reference(\n-      valueRef: Reference<ts.Declaration>, valueContext: ts.SourceFile,\n+      valueRef: Reference<ClassDeclaration>, valueContext: ts.SourceFile,\n       typeContext: ts.SourceFile): R3Reference {\n     if (valueRef.hasOwningModuleGuess) {\n       return toR3Reference(valueRef, valueRef, valueContext, valueContext, this.refEmitter);\n     } else {\n       let typeRef = valueRef;\n       let typeNode = this.reflector.getDtsDeclaration(typeRef.node);\n-      if (typeNode !== null && ts.isClassDeclaration(typeNode)) {\n+      if (typeNode !== null && isNamedClassDeclaration(typeNode)) {\n         typeRef = new Reference(typeNode);\n       }\n       return toR3Reference(valueRef, typeRef, valueContext, typeContext, this.refEmitter);\n@@ -539,7 +539,7 @@ export class NgModuleDecoratorHandler implements\n     return null;\n   }\n \n-  // Verify that a `ts.Declaration` reference is a `ClassDeclaration` reference.\n+  // Verify that a \"Declaration\" reference is a `ClassDeclaration` reference.\n   private isClassDeclarationReference(ref: Reference): ref is Reference<ClassDeclaration> {\n     return this.reflector.isClass(ref.node);\n   }"
        },
        {
            "sha": "65cf0996086b44061719cec63febe90ce6f172df",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/references_registry.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Freferences_registry.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Freferences_registry.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Freferences_registry.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript';\n import {Reference} from '../../imports';\n+import {DeclarationNode} from '../../reflection';\n \n /**\n  * Implement this interface if you want DecoratorHandlers to register\n@@ -18,7 +18,7 @@ export interface ReferencesRegistry {\n    * Register one or more references in the registry.\n    * @param references A collection of references to register.\n    */\n-  add(source: ts.Declaration, ...references: Reference<ts.Declaration>[]): void;\n+  add(source: DeclarationNode, ...references: Reference<DeclarationNode>[]): void;\n }\n \n /**\n@@ -27,5 +27,5 @@ export interface ReferencesRegistry {\n  * The ngcc tool implements a working version for its purposes.\n  */\n export class NoopReferencesRegistry implements ReferencesRegistry {\n-  add(source: ts.Declaration, ...references: Reference<ts.Declaration>[]): void {}\n+  add(source: DeclarationNode, ...references: Reference<DeclarationNode>[]): void {}\n }"
        },
        {
            "sha": "03505907475485de6c78adac863817b809c29a6c",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -21,7 +21,7 @@ import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, Inj\n import {ModuleWithProvidersScanner} from '../../modulewithproviders';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {NOOP_PERF_RECORDER, PerfRecorder} from '../../perf';\n-import {ClassDeclaration, TypeScriptReflectionHost} from '../../reflection';\n+import {DeclarationNode, TypeScriptReflectionHost} from '../../reflection';\n import {AdapterResourceLoader} from '../../resource';\n import {entryPointKeyFor, NgModuleRouteAnalyzer} from '../../routing';\n import {ComponentScopeReader, LocalModuleScopeRegistry, MetadataDtsModuleScopeResolver} from '../../scope';\n@@ -238,7 +238,7 @@ export class NgCompiler {\n   /**\n    * Retrieves the `ts.Declaration`s for any component(s) which use the given template file.\n    */\n-  getComponentsWithTemplateFile(templateFilePath: string): ReadonlySet<ts.Declaration> {\n+  getComponentsWithTemplateFile(templateFilePath: string): ReadonlySet<DeclarationNode> {\n     const {templateMapping} = this.ensureAnalyzed();\n     return templateMapping.getComponentsWithTemplate(resolve(templateFilePath));\n   }\n@@ -378,7 +378,7 @@ export class NgCompiler {\n    *\n    * See the `indexing` package for more details.\n    */\n-  getIndexedComponents(): Map<ts.Declaration, IndexedComponent> {\n+  getIndexedComponents(): Map<DeclarationNode, IndexedComponent> {\n     const compilation = this.ensureAnalyzed();\n     const context = new IndexingContext();\n     compilation.traitCompiler.index(context);\n@@ -880,7 +880,7 @@ https://v9.angular.io/guide/template-typecheck#template-type-checking`,\n class ReferenceGraphAdapter implements ReferencesRegistry {\n   constructor(private graph: ReferenceGraph) {}\n \n-  add(source: ts.Declaration, ...references: Reference<ts.Declaration>[]): void {\n+  add(source: DeclarationNode, ...references: Reference<DeclarationNode>[]): void {\n     for (const {node} of references) {\n       let sourceFile = node.getSourceFile();\n       if (sourceFile === undefined) {"
        },
        {
            "sha": "6c22d2b902275c4896ce2c67524d20247e798b50",
            "filename": "packages/compiler-cli/src/ngtsc/entry_point/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n     deps = [\n         \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/shims:api\",\n         \"//packages/compiler-cli/src/ngtsc/util\",\n         \"@npm//@types/node\","
        },
        {
            "sha": "3dd66134d623929851cb5fa8f378c897907b02ae",
            "filename": "packages/compiler-cli/src/ngtsc/entry_point/src/private_export_checker.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Fprivate_export_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Fprivate_export_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Fprivate_export_checker.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -9,6 +9,7 @@\n import * as ts from 'typescript';\n \n import {ErrorCode, ngErrorCode} from '../../diagnostics';\n+import {DeclarationNode} from '../../reflection';\n \n import {ReferenceGraph} from './reference_graph';\n \n@@ -39,7 +40,7 @@ export function checkForPrivateExports(\n   const diagnostics: ts.Diagnostic[] = [];\n \n   // Firstly, compute the exports of the entry point. These are all the Exported classes.\n-  const topLevelExports = new Set<ts.Declaration>();\n+  const topLevelExports = new Set<DeclarationNode>();\n \n   // Do this via `ts.TypeChecker.getExportsOfModule`.\n   const moduleSymbol = checker.getSymbolAtLocation(entryPoint);\n@@ -63,7 +64,7 @@ export function checkForPrivateExports(\n   // Next, go through each exported class and expand it to the set of classes it makes Visible,\n   // using the `ReferenceGraph`. For each Visible class, verify that it's also Exported, and queue\n   // an error if it isn't. `checkedSet` ensures only one error is queued per class.\n-  const checkedSet = new Set<ts.Declaration>();\n+  const checkedSet = new Set<DeclarationNode>();\n \n   // Loop through each Exported class.\n   // TODO(alxhub): use proper iteration when the legacy build is removed. (#27762)\n@@ -110,15 +111,15 @@ export function checkForPrivateExports(\n   return diagnostics;\n }\n \n-function getPosOfDeclaration(decl: ts.Declaration): {start: number, length: number} {\n+function getPosOfDeclaration(decl: DeclarationNode): {start: number, length: number} {\n   const node: ts.Node = getIdentifierOfDeclaration(decl) || decl;\n   return {\n     start: node.getStart(),\n     length: node.getEnd() + 1 - node.getStart(),\n   };\n }\n \n-function getIdentifierOfDeclaration(decl: ts.Declaration): ts.Identifier|null {\n+function getIdentifierOfDeclaration(decl: DeclarationNode): ts.Identifier|null {\n   if ((ts.isClassDeclaration(decl) || ts.isVariableDeclaration(decl) ||\n        ts.isFunctionDeclaration(decl)) &&\n       decl.name !== undefined && ts.isIdentifier(decl.name)) {\n@@ -128,12 +129,12 @@ function getIdentifierOfDeclaration(decl: ts.Declaration): ts.Identifier|null {\n   }\n }\n \n-function getNameOfDeclaration(decl: ts.Declaration): string {\n+function getNameOfDeclaration(decl: DeclarationNode): string {\n   const id = getIdentifierOfDeclaration(decl);\n   return id !== null ? id.text : '(unnamed)';\n }\n \n-function getDescriptorOfDeclaration(decl: ts.Declaration): string {\n+function getDescriptorOfDeclaration(decl: DeclarationNode): string {\n   switch (decl.kind) {\n     case ts.SyntaxKind.ClassDeclaration:\n       return 'class';"
        },
        {
            "sha": "168943cf6a98b9e2ae2c1abce458b5c7bd4681dd",
            "filename": "packages/compiler-cli/src/ngtsc/entry_point/src/reference_graph.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Freference_graph.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Freference_graph.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fentry_point%2Fsrc%2Freference_graph.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -6,9 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript';\n+import {DeclarationNode} from '../../reflection';\n \n-export class ReferenceGraph<T = ts.Declaration> {\n+export class ReferenceGraph<T = DeclarationNode> {\n   private references = new Map<T, Set<T>>();\n \n   add(from: T, to: T): void {"
        },
        {
            "sha": "4835935d0c1a35404307fe0db04bc9af62397a29",
            "filename": "packages/compiler-cli/src/ngtsc/imports/src/emitter.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n import {UnifiedModulesHost} from '../../core/api';\n import {absoluteFromSourceFile, dirname, LogicalFileSystem, LogicalProjectPath, relative, toRelativeImport} from '../../file_system';\n import {stripExtension} from '../../file_system/src/util';\n-import {ReflectionHost} from '../../reflection';\n+import {DeclarationNode, isConcreteDeclaration, ReflectionHost} from '../../reflection';\n import {getSourceFile, isDeclaration, isTypeDeclaration, nodeNameForError} from '../../util/src/typescript';\n \n import {findExportedNameOfNode} from './find_export';\n@@ -136,7 +136,7 @@ export class AbsoluteModuleStrategy implements ReferenceEmitStrategy {\n    * A cache of the exports of specific modules, because resolving a module to its exports is a\n    * costly operation.\n    */\n-  private moduleExportsCache = new Map<string, Map<ts.Declaration, string>|null>();\n+  private moduleExportsCache = new Map<string, Map<DeclarationNode, string>|null>();\n \n   constructor(\n       protected program: ts.Program, protected checker: ts.TypeChecker,\n@@ -170,7 +170,7 @@ export class AbsoluteModuleStrategy implements ReferenceEmitStrategy {\n     return new ExternalExpr(new ExternalReference(specifier, symbolName));\n   }\n \n-  private resolveImportName(moduleName: string, target: ts.Declaration, fromFile: string): string\n+  private resolveImportName(moduleName: string, target: DeclarationNode, fromFile: string): string\n       |null {\n     const exports = this.getExportsOfModule(moduleName, fromFile);\n     if (exports !== null && exports.has(target)) {\n@@ -181,15 +181,15 @@ export class AbsoluteModuleStrategy implements ReferenceEmitStrategy {\n   }\n \n   private getExportsOfModule(moduleName: string, fromFile: string):\n-      Map<ts.Declaration, string>|null {\n+      Map<DeclarationNode, string>|null {\n     if (!this.moduleExportsCache.has(moduleName)) {\n       this.moduleExportsCache.set(moduleName, this.enumerateExportsOfModule(moduleName, fromFile));\n     }\n     return this.moduleExportsCache.get(moduleName)!;\n   }\n \n   protected enumerateExportsOfModule(specifier: string, fromFile: string):\n-      Map<ts.Declaration, string>|null {\n+      Map<DeclarationNode, string>|null {\n     // First, resolve the module specifier to its entry point, and get the ts.Symbol for it.\n     const entryPointFile = this.moduleResolver.resolveModule(specifier, fromFile);\n     if (entryPointFile === null) {\n@@ -200,13 +200,9 @@ export class AbsoluteModuleStrategy implements ReferenceEmitStrategy {\n     if (exports === null) {\n       return null;\n     }\n-    const exportMap = new Map<ts.Declaration, string>();\n+    const exportMap = new Map<DeclarationNode, string>();\n     exports.forEach((declaration, name) => {\n-      // It's okay to skip inline declarations, since by definition they're not target-able with a\n-      // ts.Declaration anyway.\n-      if (declaration.node !== null) {\n-        exportMap.set(declaration.node, name);\n-      }\n+      exportMap.set(declaration.node, name);\n     });\n     return exportMap;\n   }"
        },
        {
            "sha": "515b286fe669142cd33ecf407e4fb88c682caefc",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/src/api.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Fapi.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -7,8 +7,7 @@\n  */\n \n import {ParseSourceFile} from '@angular/compiler';\n-import * as ts from 'typescript';\n-import {ClassDeclaration} from '../../reflection';\n+import {ClassDeclaration, DeclarationNode} from '../../reflection';\n \n /**\n  * Describes the kind of identifier found in a template.\n@@ -129,7 +128,7 @@ export interface IndexedComponent {\n   file: ParseSourceFile;\n   template: {\n     identifiers: Set<TopLevelIdentifier>,\n-    usedComponents: Set<ts.Declaration>,\n+    usedComponents: Set<DeclarationNode>,\n     isInline: boolean,\n     file: ParseSourceFile;\n   };"
        },
        {
            "sha": "d96846180082d43ba926496d7bcc69eee6d2db2f",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/src/transform.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftransform.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {ParseSourceFile} from '@angular/compiler';\n-import * as ts from 'typescript';\n+import {DeclarationNode} from '../../reflection';\n import {IndexedComponent} from './api';\n import {IndexingContext} from './context';\n import {getTemplateIdentifiers} from './template';\n@@ -18,13 +18,13 @@ import {getTemplateIdentifiers} from './template';\n  *\n  * The context must be populated before `generateAnalysis` is called.\n  */\n-export function generateAnalysis(context: IndexingContext): Map<ts.Declaration, IndexedComponent> {\n-  const analysis = new Map<ts.Declaration, IndexedComponent>();\n+export function generateAnalysis(context: IndexingContext): Map<DeclarationNode, IndexedComponent> {\n+  const analysis = new Map<DeclarationNode, IndexedComponent>();\n \n   context.components.forEach(({declaration, selector, boundTemplate, templateMeta}) => {\n     const name = declaration.name.getText();\n \n-    const usedComponents = new Set<ts.Declaration>();\n+    const usedComponents = new Set<DeclarationNode>();\n     const usedDirs = boundTemplate.getUsedDirectives();\n     usedDirs.forEach(dir => {\n       if (dir.isComponent) {"
        },
        {
            "sha": "7986cab520b3fe6137edbe2e5c74f601ffa29e48",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/test/util.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Futil.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -29,7 +29,7 @@ export function getComponentDeclaration(componentStr: string, className: string)\n \n   return getDeclaration(\n       program.program, getTestFilePath(), className,\n-      (value: ts.Declaration): value is ClassDeclaration => ts.isClassDeclaration(value));\n+      (value: ts.Node): value is ClassDeclaration => ts.isClassDeclaration(value));\n }\n \n /**"
        },
        {
            "sha": "fa756464070b5673c037d5476741125c2589f7cb",
            "filename": "packages/compiler-cli/src/ngtsc/partial_evaluator/src/interpreter.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 21,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Fsrc%2Finterpreter.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Fsrc%2Finterpreter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Fsrc%2Finterpreter.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n import {Reference} from '../../imports';\n import {OwningModule} from '../../imports/src/references';\n import {DependencyTracker} from '../../incremental/api';\n-import {ConcreteDeclaration, Declaration, EnumMember, FunctionDefinition, InlineDeclaration, ReflectionHost, SpecialDeclarationKind} from '../../reflection';\n+import {Declaration, DeclarationNode, EnumMember, FunctionDefinition, isConcreteDeclaration, ReflectionHost, SpecialDeclarationKind} from '../../reflection';\n import {isDeclaration} from '../../util/src/typescript';\n \n import {ArrayConcatBuiltinFn, ArraySliceBuiltinFn} from './builtin';\n@@ -231,12 +231,7 @@ export class StaticInterpreter {\n       return this.getResolvedEnum(decl.node, decl.identity.enumMembers, context);\n     }\n     const declContext = {...context, ...joinModuleContext(context, node, decl)};\n-    // The identifier's declaration is either concrete (a ts.Declaration exists for it) or inline\n-    // (a direct reference to a ts.Expression).\n-    // TODO(alxhub): remove cast once TS is upgraded in g3.\n-    const result = decl.node !== null ?\n-        this.visitDeclaration(decl.node, declContext) :\n-        this.visitExpression((decl as InlineDeclaration).expression, declContext);\n+    const result = this.visitDeclaration(decl.node, declContext);\n     if (result instanceof Reference) {\n       // Only record identifiers to non-synthetic references. Synthetic references may not have the\n       // same value at runtime as they do at compile time, so it's not legal to refer to them by the\n@@ -250,7 +245,7 @@ export class StaticInterpreter {\n     return result;\n   }\n \n-  private visitDeclaration(node: ts.Declaration, context: Context): ResolvedValue {\n+  private visitDeclaration(node: DeclarationNode, context: Context): ResolvedValue {\n     if (this.dependencyTracker !== null) {\n       this.dependencyTracker.addDependency(context.originatingFile, node.getSourceFile());\n     }\n@@ -342,10 +337,7 @@ export class StaticInterpreter {\n       };\n \n       // Visit both concrete and inline declarations.\n-      // TODO(alxhub): remove cast once TS is upgraded in g3.\n-      return decl.node !== null ?\n-          this.visitDeclaration(decl.node, declContext) :\n-          this.visitExpression((decl as InlineDeclaration).expression, declContext);\n+      return this.visitDeclaration(decl.node, declContext);\n     });\n   }\n \n@@ -667,7 +659,7 @@ export class StaticInterpreter {\n     return map;\n   }\n \n-  private getReference<T extends ts.Declaration>(node: T, context: Context): Reference<T> {\n+  private getReference<T extends DeclarationNode>(node: T, context: Context): Reference<T> {\n     return new Reference(node, owningModule(context));\n   }\n }\n@@ -733,11 +725,3 @@ function owningModule(context: Context, override: OwningModule|null = null): Own\n     return null;\n   }\n }\n-\n-/**\n- * Helper type guard to workaround a narrowing limitation in g3, where testing for\n- * `decl.node !== null` would not narrow `decl` to be of type `ConcreteDeclaration`.\n- */\n-function isConcreteDeclaration(decl: Declaration): decl is ConcreteDeclaration {\n-  return decl.node !== null;\n-}"
        },
        {
            "sha": "0f728bae4413a16b6b974d1cf5fbbbb944db375f",
            "filename": "packages/compiler-cli/src/ngtsc/partial_evaluator/test/evaluator_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fevaluator_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fevaluator_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fevaluator_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,7 +11,7 @@ import {absoluteFrom, getSourceFileOrError} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {Reference} from '../../imports';\n import {DependencyTracker} from '../../incremental/api';\n-import {Declaration, KnownDeclaration, SpecialDeclarationKind, TypeScriptReflectionHost} from '../../reflection';\n+import {Declaration, DeclarationKind, isConcreteDeclaration, KnownDeclaration, SpecialDeclarationKind, TypeScriptReflectionHost} from '../../reflection';\n import {getDeclaration, makeProgram} from '../../testing';\n import {DynamicValue} from '../src/dynamic';\n import {PartialEvaluator} from '../src/interface';\n@@ -920,7 +920,7 @@ runInEachFileSystem(() => {\n   class DownleveledEnumReflectionHost extends TypeScriptReflectionHost {\n     getDeclarationOfIdentifier(id: ts.Identifier): Declaration|null {\n       const declaration = super.getDeclarationOfIdentifier(id);\n-      if (declaration !== null && declaration.node !== null) {\n+      if (declaration !== null && isConcreteDeclaration(declaration)) {\n         const enumMembers = [\n           {name: ts.createStringLiteral('ValueA'), initializer: ts.createStringLiteral('a')},\n           {name: ts.createStringLiteral('ValueB'), initializer: ts.createStringLiteral('b')},\n@@ -961,15 +961,16 @@ runInEachFileSystem(() => {\n           node: id,\n           viaModule: null,\n           identity: null,\n+          kind: DeclarationKind.Concrete,\n         };\n       }\n \n       return superDeclaration;\n     }\n   }\n \n-  function getTsHelperFn(node: ts.Declaration): KnownDeclaration|null {\n-    const id = (node as ts.Declaration & {name?: ts.Identifier}).name || null;\n+  function getTsHelperFn(node: ts.Node): KnownDeclaration|null {\n+    const id = (node as ts.Node & {name?: ts.Identifier}).name || null;\n     const name = id && id.text;\n \n     switch (name) {"
        },
        {
            "sha": "f51e6b0a56a5589e652166850ba278e6a2194a95",
            "filename": "packages/compiler-cli/src/ngtsc/perf/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -10,6 +10,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "a717808324820670a7872d948acdd9421c4972d5",
            "filename": "packages/compiler-cli/src/ngtsc/perf/src/api.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fapi.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -6,13 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import * as ts from 'typescript';\n+import {DeclarationNode} from '../../reflection';\n \n export interface PerfRecorder {\n   readonly enabled: boolean;\n \n-  mark(name: string, node?: ts.SourceFile|ts.Declaration, category?: string, detail?: string): void;\n-  start(name: string, node?: ts.SourceFile|ts.Declaration, category?: string, detail?: string):\n-      number;\n+  mark(name: string, node?: DeclarationNode, category?: string, detail?: string): void;\n+  start(name: string, node?: DeclarationNode, category?: string, detail?: string): number;\n   stop(span: number): void;\n }"
        },
        {
            "sha": "73f4384ddee4168879943228f1a349946bbbd6fe",
            "filename": "packages/compiler-cli/src/ngtsc/perf/src/noop.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fnoop.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fnoop.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Fnoop.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -5,18 +5,15 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-\n-import * as ts from 'typescript';\n+import {DeclarationNode} from '../../reflection';\n \n import {PerfRecorder} from './api';\n \n export const NOOP_PERF_RECORDER: PerfRecorder = {\n   enabled: false,\n-  mark: (name: string, node: ts.SourceFile|ts.Declaration, category?: string, detail?: string):\n-      void => {},\n-  start: (name: string, node: ts.SourceFile|ts.Declaration, category?: string, detail?: string):\n-      number => {\n-        return 0;\n-      },\n+  mark: (name: string, node: DeclarationNode, category?: string, detail?: string): void => {},\n+  start: (name: string, node: DeclarationNode, category?: string, detail?: string): number => {\n+    return 0;\n+  },\n   stop: (span: number|false): void => {},\n };"
        },
        {
            "sha": "732c8f03671e1bd1521de3d214b636c985ef3b23",
            "filename": "packages/compiler-cli/src/ngtsc/perf/src/tracking.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Ftracking.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Ftracking.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fperf%2Fsrc%2Ftracking.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -9,6 +9,7 @@\n import * as fs from 'fs';\n import * as ts from 'typescript';\n import {resolve} from '../../file_system';\n+import {DeclarationNode} from '../../reflection';\n import {PerfRecorder} from './api';\n import {HrTime, mark, timeSinceInMicros} from './clock';\n \n@@ -24,14 +25,12 @@ export class PerfTracker implements PerfRecorder {\n     return new PerfTracker(mark());\n   }\n \n-  mark(name: string, node?: ts.SourceFile|ts.Declaration, category?: string, detail?: string):\n-      void {\n+  mark(name: string, node?: DeclarationNode, category?: string, detail?: string): void {\n     const msg = this.makeLogMessage(PerfLogEventType.MARK, name, node, category, detail, undefined);\n     this.log.push(msg);\n   }\n \n-  start(name: string, node?: ts.SourceFile|ts.Declaration, category?: string, detail?: string):\n-      number {\n+  start(name: string, node?: DeclarationNode, category?: string, detail?: string): number {\n     const span = this.nextSpanId++;\n     const msg = this.makeLogMessage(PerfLogEventType.SPAN_OPEN, name, node, category, detail, span);\n     this.log.push(msg);\n@@ -47,7 +46,7 @@ export class PerfTracker implements PerfRecorder {\n   }\n \n   private makeLogMessage(\n-      type: PerfLogEventType, name: string, node: ts.SourceFile|ts.Declaration|undefined,\n+      type: PerfLogEventType, name: string, node: DeclarationNode|undefined,\n       category: string|undefined, detail: string|undefined, span: number|undefined): PerfLogEvent {\n     const msg: PerfLogEvent = {\n       type,"
        },
        {
            "sha": "13e209fc0ad15df8063ad76820f3a456aafefb9d",
            "filename": "packages/compiler-cli/src/ngtsc/program.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -17,6 +17,7 @@ import {NgCompilerOptions} from './core/api';\n import {TrackedIncrementalBuildStrategy} from './incremental';\n import {IndexedComponent} from './indexer';\n import {NOOP_PERF_RECORDER, PerfRecorder, PerfTracker} from './perf';\n+import {DeclarationNode} from './reflection';\n import {retagAllTsFiles, untagAllTsFiles} from './shims';\n import {ReusedProgramStrategy} from './typecheck';\n \n@@ -276,7 +277,7 @@ export class NgtscProgram implements api.Program {\n     return ((opts && opts.mergeEmitResultsCallback) || mergeEmitResults)(emitResults);\n   }\n \n-  getIndexedComponents(): Map<ts.Declaration, IndexedComponent> {\n+  getIndexedComponents(): Map<DeclarationNode, IndexedComponent> {\n     return this.compiler.getIndexedComponents();\n   }\n "
        },
        {
            "sha": "af979422ff445f5976bb1d63e687c90a789c6d23",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/src/host.ts",
            "status": "modified",
            "additions": 45,
            "deletions": 23,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -113,7 +113,7 @@ export function isDecoratorIdentifier(exp: ts.Expression): exp is DecoratorIdent\n  * For `ReflectionHost` purposes, a class declaration should always have a `name` identifier,\n  * because we need to be able to reference it in other parts of the program.\n  */\n-export type ClassDeclaration<T extends ts.Declaration = ts.Declaration> = T&{name: ts.Identifier};\n+export type ClassDeclaration<T extends DeclarationNode = DeclarationNode> = T&{name: ts.Identifier};\n \n /**\n  * An enumeration of possible kinds of class members.\n@@ -275,7 +275,7 @@ export interface ImportedTypeValueReference {\n    */\n   nestedPath: string[]|null;\n \n-  valueDeclaration: ts.Declaration;\n+  valueDeclaration: DeclarationNode;\n }\n \n /**\n@@ -530,10 +530,38 @@ export interface EnumMember {\n   initializer: ts.Expression;\n }\n \n+/**\n+ * A type that is used to identify a declaration.\n+ *\n+ * Declarations are normally `ts.Declaration` types such as variable declarations, class\n+ * declarations, function declarations etc.\n+ * But in some cases there is no `ts.Declaration` that can be used for a declaration, such\n+ * as when they are declared inline as part of an exported expression. Then we must use a\n+ * `ts.Expression` as the declaration.\n+ * An example of this is `exports.someVar = 42` where the declaration expression would be\n+ * `exports.someVar`.\n+ */\n+export type DeclarationNode = ts.Declaration|ts.Expression;\n+\n+/**\n+ * The type of a Declaration - whether its node is concrete (ts.Declaration) or inline\n+ * (ts.Expression). See `ConcreteDeclaration`, `InlineDeclaration` and `DeclarationNode` for more\n+ * information about this.\n+ */\n+export const enum DeclarationKind {\n+  Concrete,\n+  Inline,\n+}\n+\n /**\n  * Base type for all `Declaration`s.\n  */\n-export interface BaseDeclaration<T extends ts.Declaration = ts.Declaration> {\n+export interface BaseDeclaration<T extends DeclarationNode> {\n+  /**\n+   * The type of the underlying `node`.\n+   */\n+  kind: DeclarationKind;\n+\n   /**\n    * The absolute module path from which the symbol was imported into the application, if the symbol\n    * was imported via an absolute module (even through a chain of re-exports). If the symbol is part\n@@ -544,7 +572,7 @@ export interface BaseDeclaration<T extends ts.Declaration = ts.Declaration> {\n   /**\n    * TypeScript reference to the declaration itself, if one exists.\n    */\n-  node: T|null;\n+  node: T;\n \n   /**\n    * If set, describes the type of the known declaration this declaration resolves to.\n@@ -553,13 +581,16 @@ export interface BaseDeclaration<T extends ts.Declaration = ts.Declaration> {\n }\n \n /**\n- * A declaration that has an associated TypeScript `ts.Declaration`.\n- *\n- * The alternative is an `InlineDeclaration`.\n+ * Returns true if the `decl` is a `ConcreteDeclaration` (ie. that its `node` property is a\n+ * `ts.Declaration`).\n  */\n+export function isConcreteDeclaration(decl: Declaration): decl is ConcreteDeclaration {\n+  return decl.kind === DeclarationKind.Concrete;\n+}\n+\n export interface ConcreteDeclaration<T extends ts.Declaration = ts.Declaration> extends\n     BaseDeclaration<T> {\n-  node: T;\n+  kind: DeclarationKind.Concrete;\n \n   /**\n    * Optionally represents a special identity of the declaration, or `null` if the declaration\n@@ -585,29 +616,20 @@ export interface DownleveledEnum {\n }\n \n /**\n- * A declaration that does not have an associated TypeScript `ts.Declaration`, only a\n- * `ts.Expression`.\n+ * A declaration that does not have an associated TypeScript `ts.Declaration`.\n  *\n  * This can occur in some downlevelings when an `export const VAR = ...;` (a `ts.Declaration`) is\n  * transpiled to an assignment statement (e.g. `exports.VAR = ...;`). There is no `ts.Declaration`\n  * associated with `VAR` in that case, only an expression.\n  */\n-export interface InlineDeclaration extends BaseDeclaration {\n-  node: null;\n-\n-  /**\n-   * The `ts.Expression` which constitutes the value of the declaration.\n-   */\n-  expression: ts.Expression;\n+export interface InlineDeclaration extends\n+    BaseDeclaration<Exclude<DeclarationNode, ts.Declaration>> {\n+  kind: DeclarationKind.Inline;\n }\n \n /**\n  * The declaration of a symbol, along with information about how it was imported into the\n  * application.\n- *\n- * This can either be a `ConcreteDeclaration` if the underlying TypeScript node for the symbol is an\n- * actual `ts.Declaration`, or an `InlineDeclaration` if the declaration was transpiled in certain\n- * downlevelings to a `ts.Expression` instead.\n  */\n export type Declaration<T extends ts.Declaration = ts.Declaration> =\n     ConcreteDeclaration<T>|InlineDeclaration;\n@@ -637,7 +659,7 @@ export interface ReflectionHost {\n    * @returns an array of `Decorator` metadata if decorators are present on the declaration, or\n    * `null` if either no decorators were present or if the declaration is not of a decoratable type.\n    */\n-  getDecoratorsOfDeclaration(declaration: ts.Declaration): Decorator[]|null;\n+  getDecoratorsOfDeclaration(declaration: DeclarationNode): Decorator[]|null;\n \n   /**\n    * Examine a declaration which should be of a class, and return metadata about the members of the\n@@ -802,7 +824,7 @@ export interface ReflectionHost {\n    * Note that the `ts.Declaration` returned from this function may not be from the same\n    * `ts.Program` as the input declaration.\n    */\n-  getDtsDeclaration(declaration: ts.Declaration): ts.Declaration|null;\n+  getDtsDeclaration(declaration: DeclarationNode): ts.Declaration|null;\n \n   /**\n    * Get a `ts.Identifier` for a given `ClassDeclaration` which can be used to refer to the class"
        },
        {
            "sha": "72a8f54139689dfd7c7327e81f69872bd390d557",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/src/typescript.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n \n import * as ts from 'typescript';\n \n-import {ClassDeclaration, ClassMember, ClassMemberKind, CtorParameter, Declaration, Decorator, FunctionDefinition, Import, isDecoratorIdentifier, ReflectionHost} from './host';\n+import {ClassDeclaration, ClassMember, ClassMemberKind, CtorParameter, Declaration, DeclarationKind, DeclarationNode, Decorator, FunctionDefinition, Import, isDecoratorIdentifier, ReflectionHost} from './host';\n import {typeToValue} from './type_to_value';\n import {isNamedClassDeclaration} from './util';\n \n@@ -19,7 +19,7 @@ import {isNamedClassDeclaration} from './util';\n export class TypeScriptReflectionHost implements ReflectionHost {\n   constructor(protected checker: ts.TypeChecker) {}\n \n-  getDecoratorsOfDeclaration(declaration: ts.Declaration): Decorator[]|null {\n+  getDecoratorsOfDeclaration(declaration: DeclarationNode): Decorator[]|null {\n     if (declaration.decorators === undefined || declaration.decorators.length === 0) {\n       return null;\n     }\n@@ -187,7 +187,7 @@ export class TypeScriptReflectionHost implements ReflectionHost {\n     return declaration.initializer || null;\n   }\n \n-  getDtsDeclaration(_: ts.Declaration): ts.Declaration|null {\n+  getDtsDeclaration(_: ClassDeclaration): ts.Declaration|null {\n     return null;\n   }\n \n@@ -207,7 +207,7 @@ export class TypeScriptReflectionHost implements ReflectionHost {\n       return null;\n     }\n \n-    const decl: ts.Declaration = symbol.declarations[0];\n+    const decl = symbol.declarations[0];\n     const importDecl = getContainingImportDeclaration(decl);\n \n     // Ignore declarations that are defined locally (not imported).\n@@ -318,13 +318,15 @@ export class TypeScriptReflectionHost implements ReflectionHost {\n         known: null,\n         viaModule,\n         identity: null,\n+        kind: DeclarationKind.Concrete,\n       };\n     } else if (symbol.declarations !== undefined && symbol.declarations.length > 0) {\n       return {\n         node: symbol.declarations[0],\n         known: null,\n         viaModule,\n         identity: null,\n+        kind: DeclarationKind.Concrete,\n       };\n     } else {\n       return null;"
        },
        {
            "sha": "d298d2441cd3a0a78c4faac9ab8643320df7c9b7",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/test/ts_host_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -9,7 +9,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, getSourceFileOrError} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {getDeclaration, makeProgram} from '../../testing';\n-import {ClassMember, ClassMemberKind, CtorParameter, TypeValueReferenceKind} from '../src/host';\n+import {ClassMember, ClassMemberKind, CtorParameter, DeclarationKind, TypeValueReferenceKind} from '../src/host';\n import {TypeScriptReflectionHost} from '../src/typescript';\n import {isNamedClassDeclaration} from '../src/util';\n \n@@ -360,6 +360,7 @@ runInEachFileSystem(() => {\n         const Target = foo.type.typeName;\n         const decl = host.getDeclarationOfIdentifier(Target);\n         expect(decl).toEqual({\n+          kind: DeclarationKind.Concrete,\n           node: targetDecl,\n           known: null,\n           viaModule: 'absolute',\n@@ -395,6 +396,7 @@ runInEachFileSystem(() => {\n           known: null,\n           viaModule: 'absolute',\n           identity: null,\n+          kind: DeclarationKind.Concrete\n         });\n       });\n     });"
        },
        {
            "sha": "42990227ab81de0e01640d44976966826576ee36",
            "filename": "packages/compiler-cli/src/ngtsc/scope/src/local.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Fsrc%2Flocal.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Fsrc%2Flocal.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fscope%2Fsrc%2Flocal.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -12,7 +12,7 @@ import * as ts from 'typescript';\n import {ErrorCode, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n import {AliasingHost, Reexport, Reference, ReferenceEmitter} from '../../imports';\n import {DirectiveMeta, MetadataReader, MetadataRegistry, NgModuleMeta, PipeMeta} from '../../metadata';\n-import {ClassDeclaration} from '../../reflection';\n+import {ClassDeclaration, DeclarationNode} from '../../reflection';\n import {identifierOfNode, nodeNameForError} from '../../util/src/typescript';\n \n import {ExportScope, ScopeData} from './api';\n@@ -293,14 +293,14 @@ export class LocalModuleScopeRegistry implements MetadataRegistry, ComponentScop\n     // - the directives and pipes which are exported to any NgModules which import this one.\n \n     // Directives and pipes in the compilation scope.\n-    const compilationDirectives = new Map<ts.Declaration, DirectiveMeta>();\n-    const compilationPipes = new Map<ts.Declaration, PipeMeta>();\n+    const compilationDirectives = new Map<DeclarationNode, DirectiveMeta>();\n+    const compilationPipes = new Map<DeclarationNode, PipeMeta>();\n \n-    const declared = new Set<ts.Declaration>();\n+    const declared = new Set<DeclarationNode>();\n \n     // Directives and pipes exported to any importing NgModules.\n-    const exportDirectives = new Map<ts.Declaration, DirectiveMeta>();\n-    const exportPipes = new Map<ts.Declaration, PipeMeta>();\n+    const exportDirectives = new Map<DeclarationNode, DirectiveMeta>();\n+    const exportPipes = new Map<DeclarationNode, PipeMeta>();\n \n     // The algorithm is as follows:\n     // 1) Add all of the directives/pipes from each NgModule imported into the current one to the\n@@ -477,7 +477,7 @@ export class LocalModuleScopeRegistry implements MetadataRegistry, ComponentScop\n    */\n   private getExportedScope(\n       ref: Reference<ClassDeclaration>, diagnostics: ts.Diagnostic[],\n-      ownerForErrors: ts.Declaration, type: 'import'|'export'): ExportScope|null|undefined {\n+      ownerForErrors: DeclarationNode, type: 'import'|'export'): ExportScope|null|undefined {\n     if (ref.node.getSourceFile().isDeclarationFile) {\n       // The NgModule is declared in a .d.ts file. Resolve it with the `DependencyScopeReader`.\n       if (!ts.isClassDeclaration(ref.node)) {\n@@ -499,7 +499,7 @@ export class LocalModuleScopeRegistry implements MetadataRegistry, ComponentScop\n   }\n \n   private getReexports(\n-      ngModule: NgModuleMeta, ref: Reference<ClassDeclaration>, declared: Set<ts.Declaration>,\n+      ngModule: NgModuleMeta, ref: Reference<ClassDeclaration>, declared: Set<DeclarationNode>,\n       exported: {directives: DirectiveMeta[], pipes: PipeMeta[]},\n       diagnostics: ts.Diagnostic[]): Reexport[]|null {\n     let reexports: Reexport[]|null = null;\n@@ -569,7 +569,7 @@ export class LocalModuleScopeRegistry implements MetadataRegistry, ComponentScop\n  * Produce a `ts.Diagnostic` for an invalid import or export from an NgModule.\n  */\n function invalidRef(\n-    clazz: ts.Declaration, decl: Reference<ts.Declaration>,\n+    clazz: DeclarationNode, decl: Reference<DeclarationNode>,\n     type: 'import'|'export'): ts.Diagnostic {\n   const code =\n       type === 'import' ? ErrorCode.NGMODULE_INVALID_IMPORT : ErrorCode.NGMODULE_INVALID_EXPORT;\n@@ -607,7 +607,7 @@ function invalidRef(\n  * Produce a `ts.Diagnostic` for an import or export which itself has errors.\n  */\n function invalidTransitiveNgModuleRef(\n-    clazz: ts.Declaration, decl: Reference<ts.Declaration>,\n+    clazz: DeclarationNode, decl: Reference<DeclarationNode>,\n     type: 'import'|'export'): ts.Diagnostic {\n   const code =\n       type === 'import' ? ErrorCode.NGMODULE_INVALID_IMPORT : ErrorCode.NGMODULE_INVALID_EXPORT;\n@@ -620,7 +620,7 @@ function invalidTransitiveNgModuleRef(\n  * Produce a `ts.Diagnostic` for an exported directive or pipe which was not declared or imported\n  * by the NgModule in question.\n  */\n-function invalidReexport(clazz: ts.Declaration, decl: Reference<ts.Declaration>): ts.Diagnostic {\n+function invalidReexport(clazz: DeclarationNode, decl: Reference<DeclarationNode>): ts.Diagnostic {\n   return makeDiagnostic(\n       ErrorCode.NGMODULE_INVALID_REEXPORT, identifierOfNode(decl.node) || decl.node,\n       `Present in the NgModule.exports of ${"
        },
        {
            "sha": "2fe8466d92a3bbb664ebf5365927f5a1a4634a21",
            "filename": "packages/compiler-cli/src/ngtsc/testing/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"@npm//typescript\",\n     ],\n )"
        },
        {
            "sha": "cfaa5cba8521a2d1f5b40fdb8e1fb3595789aee0",
            "filename": "packages/compiler-cli/src/ngtsc/testing/src/utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Futils.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@\n import * as ts from 'typescript';\n \n import {AbsoluteFsPath, dirname, getFileSystem, getSourceFileOrError, NgtscCompilerHost} from '../../file_system';\n+import {DeclarationNode} from '../../reflection';\n \n export function makeProgram(\n     files: {name: AbsoluteFsPath, contents: string, isRoot?: boolean}[],\n@@ -57,7 +58,7 @@ export function makeProgram(\n  * An error will be thrown if there is not at least one AST node with the given `name` and passes\n  * the `predicate` test.\n  */\n-export function getDeclaration<T extends ts.Declaration>(\n+export function getDeclaration<T extends DeclarationNode>(\n     program: ts.Program, fileName: AbsoluteFsPath, name: string,\n     assert: (value: any) => value is T): T {\n   const sf = getSourceFileOrError(program, fileName);\n@@ -78,8 +79,8 @@ export function getDeclaration<T extends ts.Declaration>(\n /**\n  * Walk the AST tree from the `rootNode` looking for a declaration that has the given `name`.\n  */\n-export function walkForDeclarations(name: string, rootNode: ts.Node): ts.Declaration[] {\n-  const chosenDecls: ts.Declaration[] = [];\n+export function walkForDeclarations(name: string, rootNode: ts.Node): DeclarationNode[] {\n+  const chosenDecls: DeclarationNode[] = [];\n   rootNode.forEachChild(node => {\n     if (ts.isVariableStatement(node)) {\n       node.declarationList.declarations.forEach(decl => {"
        },
        {
            "sha": "01415026c3eb5877fec9778591560113925f5111",
            "filename": "packages/compiler-cli/src/ngtsc/transform/src/compilation.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -13,7 +13,7 @@ import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n import {IncrementalBuild} from '../../incremental/api';\n import {IndexingContext} from '../../indexer';\n import {PerfRecorder} from '../../perf';\n-import {ClassDeclaration, Decorator, ReflectionHost} from '../../reflection';\n+import {ClassDeclaration, DeclarationNode, Decorator, ReflectionHost} from '../../reflection';\n import {ProgramTypeCheckAdapter, TypeCheckContext} from '../../typecheck/api';\n import {getSourceFile, isExported} from '../../util/src/typescript';\n \n@@ -463,7 +463,7 @@ export class TraitCompiler implements ProgramTypeCheckAdapter {\n     }\n   }\n \n-  compile(clazz: ts.Declaration, constantPool: ConstantPool): CompileResult[]|null {\n+  compile(clazz: DeclarationNode, constantPool: ConstantPool): CompileResult[]|null {\n     const original = ts.getOriginalNode(clazz) as typeof clazz;\n     if (!this.reflector.isClass(clazz) || !this.reflector.isClass(original) ||\n         !this.classes.has(original)) {"
        },
        {
            "sha": "535b5a64c88a05b7d0124118e1781fe0e7b84a4c",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/diagnostics/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -9,6 +9,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "22043f73a45a519b49cd51f38e14b0c332a4f2c1",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/id.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fid.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fid.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fid.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import * as ts from 'typescript';\n+import {DeclarationNode} from '../../../reflection';\n \n import {TemplateId} from '../../api';\n \n@@ -22,7 +23,7 @@ interface HasNextTemplateId {\n   [NEXT_TEMPLATE_ID]: number;\n }\n \n-export function getTemplateId(clazz: ts.Declaration): TemplateId {\n+export function getTemplateId(clazz: DeclarationNode): TemplateId {\n   const node = clazz as ts.Declaration & Partial<HasTemplateId>;\n   if (node[TEMPLATE_ID] === undefined) {\n     node[TEMPLATE_ID] = allocateTemplateId(node.getSourceFile());"
        },
        {
            "sha": "c973742ceab3603450db296baedc011dbd155dfb",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_parameter_emitter.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_parameter_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_parameter_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_parameter_emitter.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -8,7 +8,7 @@\n import * as ts from 'typescript';\n \n import {OwningModule, Reference} from '../../imports';\n-import {ReflectionHost} from '../../reflection';\n+import {DeclarationNode, ReflectionHost} from '../../reflection';\n \n import {canEmitType, ResolvedTypeReference, TypeEmitter} from './type_emitter';\n \n@@ -89,7 +89,7 @@ export class TypeParameterEmitter {\n     return new Reference(declaration.node, owningModule);\n   }\n \n-  private isLocalTypeParameter(decl: ts.Declaration): boolean {\n+  private isLocalTypeParameter(decl: DeclarationNode): boolean {\n     // Checking for local type parameters only occurs during resolution of type parameters, so it is\n     // guaranteed that type parameters are present.\n     return this.typeParameters!.some(param => param === decl);"
        },
        {
            "sha": "cb06267fdbaa592d348ac45f7688c3126df1f8ce",
            "filename": "packages/compiler-cli/src/ngtsc/util/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n         \"//packages:types\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/incremental:api\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "c7bf5eed6ba7061c7765bc0c1264350ffebcf80e",
            "filename": "packages/compiler-cli/src/ngtsc/util/src/typescript.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@ const D_TS = /\\.d\\.ts$/i;\n \n import * as ts from 'typescript';\n import {AbsoluteFsPath, absoluteFrom} from '../../file_system';\n+import {DeclarationNode} from '../../reflection';\n \n export function isDtsPath(filePath: string): boolean {\n   return D_TS.test(filePath);\n@@ -82,7 +83,7 @@ export function isTypeDeclaration(node: ts.Node): node is ts.EnumDeclaration|\n       ts.isInterfaceDeclaration(node);\n }\n \n-export function isExported(node: ts.Declaration): boolean {\n+export function isExported(node: DeclarationNode): boolean {\n   let topLevel: ts.Node = node;\n   if (ts.isVariableDeclaration(node) && ts.isVariableDeclarationList(node.parent)) {\n     topLevel = node.parent.parent;"
        },
        {
            "sha": "20359c531ce38ad90e5ab1173e699f60b3078fee",
            "filename": "packages/compiler-cli/test/ngtsc/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/indexer\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/routing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/compiler-cli/src/ngtsc/util\","
        },
        {
            "sha": "9cf9c48dfdfe206965b311ba5ec52b70874c8748",
            "filename": "packages/compiler-cli/test/ngtsc/env.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -16,6 +16,7 @@ import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, NgtscCompilerHo\n import {Folder, MockFileSystem} from '../../src/ngtsc/file_system/testing';\n import {IndexedComponent} from '../../src/ngtsc/indexer';\n import {NgtscProgram} from '../../src/ngtsc/program';\n+import {DeclarationNode} from '../../src/ngtsc/reflection';\n import {LazyRoute} from '../../src/ngtsc/routing';\n import {setWrapHostForTest} from '../../src/transformers/compiler_host';\n import {getCachedSourceFile} from '../helpers';\n@@ -259,7 +260,7 @@ export class NgtscTestEnvironment {\n     return program.listLazyRoutes(entryPoint);\n   }\n \n-  driveIndexer(): Map<ts.Declaration, IndexedComponent> {\n+  driveIndexer(): Map<DeclarationNode, IndexedComponent> {\n     const {rootNames, options} = readNgcCommandLineAndConfiguration(['-p', this.basePath]);\n     const host = createCompilerHost({options});\n     const program = createProgram({rootNames, host, options});"
        },
        {
            "sha": "d9c4434b732b3975d6d7f2bca607f5af2e654263",
            "filename": "packages/language-service/ivy/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2FBUILD.bazel?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -12,6 +12,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/core:api\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/incremental\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/shims\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\","
        },
        {
            "sha": "1e5c4107d6f3207aa22f52ed37caeae432520f19",
            "filename": "packages/language-service/ivy/utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/0accd1e68dc1c5b386a4531bc9c99f18b930ddfd/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Futils.ts?ref=0accd1e68dc1c5b386a4531bc9c99f18b930ddfd",
            "patch": "@@ -7,6 +7,7 @@\n  */\n import {AbsoluteSourceSpan, CssSelector, ParseSourceSpan, SelectorMatcher} from '@angular/compiler';\n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n+import {DeclarationNode} from '@angular/compiler-cli/src/ngtsc/reflection';\n import {DirectiveSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expression AST\n import * as t from '@angular/compiler/src/render3/r3_ast';         // t for template AST\n@@ -81,7 +82,7 @@ export function getTemplateInfoAtPosition(\n  * First, attempt to sort component declarations by file name.\n  * If the files are the same, sort by start location of the declaration.\n  */\n-function tsDeclarationSortComparator(a: ts.Declaration, b: ts.Declaration): number {\n+function tsDeclarationSortComparator(a: DeclarationNode, b: DeclarationNode): number {\n   const aFile = a.getSourceFile().fileName;\n   const bFile = b.getSourceFile().fileName;\n   if (aFile < bFile) {"
        }
    ],
    "stats": {
        "total": 531,
        "additions": 276,
        "deletions": 255
    }
}