{
    "author": "gkalpak",
    "message": "refactor(service-worker): switch to the official TypeScript typings (#42736)\n\nPreviously, we used custom typings for the ServiceWorker environment.\nThis was necessary back when the ServiceWorker package was introduced,\nsince there were no official typings.\n\nSince there are now official typings for Web Workers (including\nServiceWorkers) offered by TypeScript as [lib.webworker.d.ts][1], this\ncommit gets rid of our custom typings in favor of using the official\nones.\n\n[1]: https://github.com/microsoft/TypeScript/blob/v4.3.4/lib/lib.webworker.d.ts\n\nPR Close #42736",
    "sha": "5aa01387264ac9c33f10a6ad23a901e59a8bcb09",
    "files": [
        {
            "sha": "b1881128387bc91db2c31e5b0eb46c2d350109b1",
            "filename": "packages/localize/src/localize/src/global.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Flocalize%2Fsrc%2Flocalize%2Fsrc%2Fglobal.ts",
            "raw_url": "https://github.com/angular/angular/raw/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Flocalize%2Fsrc%2Flocalize%2Fsrc%2Fglobal.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Flocalize%2Fsrc%2Fglobal.ts?ref=5aa01387264ac9c33f10a6ad23a901e59a8bcb09",
            "patch": "@@ -10,7 +10,18 @@\n // This code to access the global object is mostly copied from `packages/core/src/util/global.ts`\n \n declare global {\n-  var WorkerGlobalScope: any;\n+  // The definition of `WorkerGlobalScope` must be compatible with the one in `lib.webworker.d.ts`,\n+  // because all files under `packages/` are compiled together as part of the\n+  // [legacy-unit-tests-saucelabs][1] CI job, including the `lib.webworker.d.ts` typings brought in\n+  // by [service-worker/worker/src/service-worker.d.ts][2].\n+  //\n+  // [1]:\n+  // https://github.com/angular/angular/blob/ffeea63f43e6a7fd46be4a8cd5a5d254c98dea08/.circleci/config.yml#L681\n+  // [2]:\n+  // https://github.com/angular/angular/blob/316dc2f12ce8931f5ff66fa5f8da21c0d251a337/packages/service-worker/worker/src/service-worker.d.ts#L9\n+  interface WorkerGlobalScope extends EventTarget, WindowOrWorkerGlobalScope {}\n+\n+  var WorkerGlobalScope: {prototype: WorkerGlobalScope; new (): WorkerGlobalScope;};\n }\n \n const __globalThis = typeof globalThis !== 'undefined' && globalThis;"
        },
        {
            "sha": "a5521666f70a75c41533f0d178b036fd150824d0",
            "filename": "packages/router/test/bootstrap.spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts?ref=5aa01387264ac9c33f10a6ad23a901e59a8bcb09",
            "patch": "@@ -13,6 +13,16 @@ import {BrowserModule} from '@angular/platform-browser';\n import {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\n import {NavigationEnd, Resolve, Router, RouterModule} from '@angular/router';\n \n+// This is needed, because all files under `packages/` are compiled together as part of the\n+// [legacy-unit-tests-saucelabs][1] CI job, including the `lib.webworker.d.ts` typings brought in by\n+// [service-worker/worker/src/service-worker.d.ts][2].\n+//\n+// [1]:\n+// https://github.com/angular/angular/blob/ffeea63f43e6a7fd46be4a8cd5a5d254c98dea08/.circleci/config.yml#L681\n+// [2]:\n+// https://github.com/angular/angular/blob/316dc2f12ce8931f5ff66fa5f8da21c0d251a337/packages/service-worker/worker/src/service-worker.d.ts#L9\n+declare var window: Window;\n+\n describe('bootstrap', () => {\n   if (isNode) return;\n   let log: any[] = [];"
        },
        {
            "sha": "b4ea4880dedab2b9fcb5164aa1a999d3126a8ed8",
            "filename": "packages/service-worker/worker/src/service-worker.d.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 153,
            "changes": 166,
            "blob_url": "https://github.com/angular/angular/blob/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Fservice-worker%2Fworker%2Fsrc%2Fservice-worker.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/5aa01387264ac9c33f10a6ad23a901e59a8bcb09/packages%2Fservice-worker%2Fworker%2Fsrc%2Fservice-worker.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fservice-worker.d.ts?ref=5aa01387264ac9c33f10a6ad23a901e59a8bcb09",
            "patch": "@@ -1,159 +1,19 @@\n-// tslint:disable:file-header\n /**\n- * Copyright (c) 2016, Tiernan Cridland\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n  *\n- * Permission to use, copy, modify, and/or distribute this software for any purpose with or without\n- * fee is hereby\n- * granted, provided that the above copyright notice and this permission notice appear in all\n- * copies.\n- *\n- * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS\n- * SOFTWARE INCLUDING ALL\n- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY\n- * SPECIAL, DIRECT,\n- * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR\n- * PROFITS, WHETHER\n- * IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION\n- * WITH THE USE OR\n- * PERFORMANCE OF THIS SOFTWARE.\n- *\n- * Typings for Service Worker\n- * @author Tiernan Cridland\n- * @email tiernanc@gmail.com\n- * @license: ISC\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n  */\n-interface ExtendableEvent extends Event {\n-  waitUntil(fn: Promise<any>): void;\n-}\n-\n-// Client API\n-\n-declare class Client {\n-    readonly frameType: FrameType;\n-    readonly id: string;\n-    readonly type: ClientTypes;\n-    readonly url: string;\n-    postMessage(message: any): void;\n-}\n-\n-interface Clients {\n-  claim(): Promise<void>;\n-  get(id: string): Promise<Client | undefined>;\n-  matchAll<T extends ClientMatchOptions>(\n-    options?: T\n-  ): Promise<ReadonlyArray<T['type'] extends 'window' ? WindowClient : Client>>;\n-  openWindow(url: string): Promise<WindowClient | null>;\n-}\n-\n-interface ClientMatchOptions {\n-  includeUncontrolled?: boolean;\n-  type?: ClientTypes;\n-}\n-\n-interface WindowClient extends Client {\n-  readonly focused: boolean;\n-  readonly visibilityState: VisibilityState;\n-  focus(): Promise<WindowClient>;\n-  navigate(url: string): Promise<WindowClient | null>;\n-}\n-\n-type FrameType = 'auxiliary'|'top-level'|'nested'|'none';\n-type ClientTypes = 'window'|'worker'|'sharedworker'|'all';\n-type VisibilityState = 'hidden'|'visible';\n-\n-// Fetch API\n-\n-interface FetchEvent extends ExtendableEvent {\n-  readonly clientId: string;\n-  readonly preloadResponse: Promise<any>;\n-  readonly request: Request;\n-  readonly resultingClientId: string;\n-  respondWith(r: Response|Promise<Response>): void;\n-}\n-\n-// Notification API\n-\n-interface NotificationEvent extends ExtendableEvent {\n-  readonly action: string;\n-  readonly notification: Notification;\n-}\n \n-// Push API\n-\n-interface PushEvent extends ExtendableEvent {\n-  readonly data: PushMessageData|null;\n-}\n-\n-interface PushMessageData {\n-  arrayBuffer(): ArrayBuffer;\n-  blob(): Blob;\n-  json(): any;\n-  text(): string;\n-}\n-\n-// Sync API\n-\n-interface SyncEvent extends ExtendableEvent {\n-  readonly lastChance: boolean;\n-  readonly tag: string;\n-}\n-\n-interface ExtendableMessageEvent extends ExtendableEvent {\n-  readonly data: any;\n-  readonly lastEventId: string;\n-  readonly origin: string;\n-  readonly ports: ReadonlyArray<MessagePort>;\n-  readonly source: Client|ServiceWorker|MessagePort|null;\n-}\n-\n-// WorkerGlobalScope\n-\n-// Explicitly omit the `caches` property to disallow accessing `CacheStorage` APIs directly. All\n-// interactions with `CacheStorage` should go through a `NamedCacheStorage` instance (exposed by the\n-// `Adapter`).\n-interface WorkerGlobalScope extends EventTarget, Omit<WindowOrWorkerGlobalScope, 'caches'> {\n-  readonly location: WorkerLocation;\n-  readonly navigator: WorkerNavigator;\n-  readonly self: WorkerGlobalScope & typeof globalThis;\n-\n-  importScripts(...urls: string[]): void;\n-  addEventListener<K extends keyof WorkerGlobalScopeEventMap>(type: K, listener: (this: WorkerGlobalScope, ev: WorkerGlobalScopeEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\n-  addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void;\n-  removeEventListener<K extends keyof WorkerGlobalScopeEventMap>(type: K, listener: (this: WorkerGlobalScope, ev: WorkerGlobalScopeEventMap[K]) => any, options?: boolean | EventListenerOptions): void;\n-  removeEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void;\n-}\n-\n-interface WorkerGlobalScopeEventMap {\n-  error: ErrorEvent;\n-  languagechange: Event;\n-  offline: Event;\n-  online: Event;\n-  rejectionhandled: PromiseRejectionEvent;\n-  unhandledrejection: PromiseRejectionEvent;\n-}\n-\n-// ServiceWorkerGlobalScope\n-\n-interface ServiceWorkerGlobalScope extends WorkerGlobalScope {\n-  readonly clients: Clients;\n-  readonly registration: ServiceWorkerRegistration;\n-  readonly serviceWorker: ServiceWorker;\n-\n-  skipWaiting(): Promise<void>;\n-  addEventListener<K extends keyof ServiceWorkerGlobalScopeEventMap>(type: K, listener: (this: ServiceWorkerGlobalScope, ev: ServiceWorkerGlobalScopeEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\n-  addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void;\n-  removeEventListener<K extends keyof ServiceWorkerGlobalScopeEventMap>(type: K, listener: (this: ServiceWorkerGlobalScope, ev: ServiceWorkerGlobalScopeEventMap[K]) => any, options?: boolean | EventListenerOptions): void;\n-  removeEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void;\n-}\n+/// <reference lib=\"webworker\" />\n \n-interface ServiceWorkerGlobalScopeEventMap extends WorkerGlobalScopeEventMap {\n-  activate: ExtendableEvent;\n-  fetch: FetchEvent;\n-  install: ExtendableEvent;\n-  message: ExtendableMessageEvent;\n-  messageerror: MessageEvent;\n-  notificationclick: NotificationEvent;\n-  notificationclose: NotificationEvent;\n-  push: PushEvent;\n-  sync: SyncEvent;\n+export declare global {\n+  interface ServiceWorkerGlobalScope {\n+    /**\n+     * Disallow accessing `CacheStorage APIs directly to ensure that all accesses go through a\n+     * `NamedCacheStorage` instance (exposed by the `Adapter`).\n+     */\n+    caches: unknown;\n+  }\n }"
        }
    ],
    "stats": {
        "total": 189,
        "additions": 35,
        "deletions": 154
    }
}