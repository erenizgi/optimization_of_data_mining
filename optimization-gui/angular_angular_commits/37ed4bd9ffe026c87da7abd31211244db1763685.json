{
    "author": "gkalpak",
    "message": "docs(docs-infra): update instructions for updating docs examples dependencies (#38992)\n\nPR Close #38992",
    "sha": "37ed4bd9ffe026c87da7abd31211244db1763685",
    "files": [
        {
            "sha": "efb501a948d988f533595ad3c80282b420b1750e",
            "filename": "aio/README.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2FREADME.md?ref=37ed4bd9ffe026c87da7abd31211244db1763685",
            "patch": "@@ -6,6 +6,7 @@ Everything in this folder is part of the documentation project. This includes\n * the dgeni configuration for converting source files to rendered files that can be viewed in the web site.\n * the tooling for setting up examples for development; and generating live-example and zip files from the examples.\n \n+<a name=\"developer-tasks\"></a>\n ## Developer tasks\n \n We use [Yarn](https://yarnpkg.com) to manage the dependencies and to run build tasks."
        },
        {
            "sha": "2e4ead5182e08606c2f1720ca5fe3c90081ec032",
            "filename": "aio/tools/RELEASE.md",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/efe0e03fe1eb527180661445f6b5fa315a364ca4/aio%2Ftools%2FRELEASE.md",
            "raw_url": "https://github.com/angular/angular/raw/efe0e03fe1eb527180661445f6b5fa315a364ca4/aio%2Ftools%2FRELEASE.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2FRELEASE.md?ref=efe0e03fe1eb527180661445f6b5fa315a364ca4",
            "patch": "@@ -1,17 +0,0 @@\n-# Docs releases\n-\n-This document explains how to update the documentation examples after an Angular release.\n-This is only needed for major and minor versions.\n-\n-All the packages for the docs' examples are specified in `/aio/tools/examples/shared/package.json`\n-\n-**1)** So within the `shared` folder, you need to issue the following command:\n-\n-```\n-$ yarn upgrade-interactive --tilde\n-```\n-\n-There, select all the packages that are updated on the new Angular release.\n-\n-**2)** Changes to the tsconfig.json?\n-  There are several files in `/aio/tools/examples/shared/boilerplate/*/tsconfig.json` (based on the example type)."
        },
        {
            "sha": "896b49a7bb8f2c91b2ab1fe008934a2a01d03700",
            "filename": "aio/tools/examples/README.md",
            "status": "modified",
            "additions": 107,
            "deletions": 56,
            "changes": 163,
            "blob_url": "https://github.com/angular/angular/blob/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2Ftools%2Fexamples%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2Ftools%2Fexamples%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2FREADME.md?ref=37ed4bd9ffe026c87da7abd31211244db1763685",
            "patch": "@@ -1,106 +1,157 @@\n # Overview\n \n Many of the documentation pages contain snippets of code examples.\n-Extract these snippets from real working example applications, which are stored in subfolders of the `/aio/content/examples` folder.\n+These snippets are extracted from real working example applications, which are stored in sub-folders of the [aio/content/examples/](.) folder.\n Each example can be built and run independently.\n-Each example also provides e2e specs, which are run as part of our CircleCI legacy build tasks, to verify that the examples continue to work as expected, as changes are made to the core Angular libraries.\n+Each example also provides tests (mostly e2e and occasionally unit tests), which are run as part of our CircleCI `test_docs_examples*` jobs, to verify that the examples continue to work as expected, as changes are made to the core Angular libraries.\n \n-In order to build, run and test these examples independently you need to install dependencies into their sub-folder.\n-Also there are a number of common boilerplate files that are needed to configure each example's project. Maintain these common boilerplate files centrally to reduce the amount of effort if one of them needs to change.\n+In order to build, run and test these examples independently, you need to install dependencies into their sub-folder.\n+Also there are a number of common boilerplate files that are needed to configure each example's project.\n+These common boilerplate files are maintained centrally to reduce the amount of effort if one of them needs to change.\n \n > **Note for Windows users**\n >\n > Setting up the examples involves creating some [symbolic links](https://en.wikipedia.org/wiki/Symbolic_link) (see [here](#symlinked-node_modules) for details).\n > On Windows, this requires to either have [Developer Mode enabled](https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10) (supported on Windows 10 or newer) or run the setup commands as administrator.\n \n+\n ## Boilerplate overview\n \n-As mentioned, many of the documentation pages contain snippets extracted from real example applications.\n-To achieve that, all those applications needs to contain a basic boilerplate.\n-E.g. a `node_modules` folder, `package.json` with scripts, etc.\n+As mentioned above, many of the documentation pages contain snippets extracted from real example applications.\n+To achieve that, all those applications need to contain some basic boilerplate, such as a `node_modules/` folder, a `package.json` file with scripts and dependencies, etc.\n+\n+There are also different project types, each with its own boilerplate.\n+For example, there are projects based on the Angular CLI, projects that use AngularJS, Custom Elements, i18n, server-side rendering, etc.\n+(See the [example configuration section](#example-config) below for more info on how to specify the project type.)\n+\n+To avoid having to maintain the boilerplate in each example, we use the [example-boilerplate-js](./example-boilerplate.js) script to provide a set of files that works across all the examples of a specific type.\n \n-No one wants to maintain the boilerplate on each example, so the goal of this tool is to provide a set of files that works across all the examples.\n \n ### Boilerplate files\n \n-Inside `/aio/tools/examples/shared/boilerplate` you will find a set of folders representing each project type.\n+Inside [shared/boilerplate/](./shared/boilerplate) there is a sub-folder with boilerplate files for each of the different project types.\n \n-Currently you will find the next project types:\n+Currently, the following project types are supported:\n \n-* cli - For CLI based examples. This is the default one, to be used in the majority of the examples.\n-* getting-started - CLI-based with its own set of styles.\n-* i18n - CLI-based with additional scripts for internationalization.\n-* schematics - CLI-based with additional scripts for building schematics.\n-* service-worker - CLI-based with additional packages and configuration for service workers.\n-* systemjs - Currently in deprecation, only used in a few examples.\n-* testing - CLI-based with additional styles for jasmine testing.\n-* universal - CLI-based with an extra server target.\n-* viewengine - Additional configuration for running CLI-/SystemJS-based examples with `ViewEngine` (the pre-Ivy compiler/renderer).\n+- `cli`: For example apps based on the Angular CLI. This is the default type and is used in the majority of the examples.\n+- `cli-ajs`: For CLI-based examples that also use AngularJS (but not via `@angular/upgrade`).\n+- `elements`: For CLI-based examples that also use `@angular/elements`.\n+- `getting-started`: For the \"Getting started\" tutorial. Essentially the same as `cli` but with custom CSS styles.\n+- `i18n`: For CLI-based examples that also use internationalization.\n+- `schematics`: For CLI-based examples that include a library with schematics.\n+- `service-worker`: For CLI-based examples that also use `@angular/service-worker`.\n+- `systemjs`: For non-CLI legacy examples using SystemJS. This is deprecated and only used in few examples.\n+- `testing`: For CLI-based examples that are related to unit testing.\n+- `universal`: For CLI-based examples that also use `@nguniversal/express-engine` for SSR.\n \n-There is also a `common` folder that contains files used in all different examples.\n+There are also the following special folders:\n+- `common`: Contains files used in many examples.\n+  (See the [next section](#example-config) for info on how to exclude common files in certain examples.)\n+- `viewengine/cli`: Additional configuration for running CLI-based examples with `ViewEngine` (the pre-Ivy compiler/renderer).\n+  This applies to all CLI-based examples, such as `cli-ajs`, `elements`, `getting-started`, etc.\n+- `viewengine/systemjs`: Additional configuration for running SystemJS-based examples with `ViewEngine` (the pre-Ivy compiler/renderer).\n \n-### The example-config.json\n \n-Each example is identified by an **example-config.json** configuration file in its root folder.\n-This configuration file indicates what type of boilerplate this example needs.\n-E.g.\n+<a name=\"example-config\"></a>\n+### The `example-config.json`\n+\n+Each example is identified by an `example-config.json` configuration file in its root folder.\n+This configuration file indicates what type of boilerplate this example needs and how to test it.\n+For example:\n \n ```json\n {\n-  \"projectType\": \"cli\",\n-  \"useCommonBoilerplate\": true\n+  \"projectType\": \"cli\"\n }\n ```\n \n-If the file is empty then the default type of cli is assumed.\n-When the boilerplate tooling runs, it will copy into the example folder all of the appropriate files based on the project type.\n+The file is expected to contain a JSON object with zero or more of the following properties:\n+\n+- `projectType: string`: One of the supported project types (see above).\n+  Default: `\"cli\"`\n+- `useCommonBoilerplate: boolean`: Whether to include common boilerplate from the [common/](./shared/boilerplate/common) folder.\n+  Default: `true`\n+\n+**SystemJS-only properties:**\n+- `build: string`: The npm script to run in order to build the example app.\n+  Default: `\"build\"`\n+- `run: string`: The npm script to run in order to serve the example app (so that e2e test can be run against it).\n+  Default `\"serve:e2e\"`\n+\n+**CLI-only properties:**\n+- `tests: object[]`: An array of objects, each specifying a test command. This can be used to run multiple test commands in series (for example, to run unit and e2e tests).\n+  The commands are specified as `{cmd: string, args: string[]}` and must be in a format that could be passed to Node.js' `child_process.spawn(cmd, args)`. You can use a special `{PORT}` placeholder, that will be replaced with the port on which the app is served during the actual test.\n+  Default:\n+\n+  ```json\n+  [\n+    {\n+      \"cmd\": \"yarn\",\n+      \"args\": [\n+        \"e2e\",\n+        \"--prod\",\n+        \"--protractor-config=e2e/protractor-puppeteer.conf.js\",\n+        \"--no-webdriver-update\",\n+        \"--port={PORT}\"\n+      ]\n+    }\n+  ]\n+  ```\n+\n+An empty `example-config.json` file is equivalent with `{\"projectType\": \"cli\"}`.\n+\n \n <a name=\"symlinked-node_modules\"></a>\n-### A node_modules to share\n+### A `node_modules/` to share\n \n-With all the boilerplate files in place, the only missing piece are the installed packages.\n-For that you have a `/aio/tools/examples/shared/package.json` which contains **all** the packages needed to run all the examples through all different boilerplates.\n+With all the boilerplate files in place, the only missing piece is the installed packages.\n+For that we have [shared/package.json](./shared/package.json), which contains **all** the packages needed to run any example type.\n \n-After installing these dependencies, a `node_modules/` folder will be created at `/aio/tools/examples/shared/node_modules/`.\n+Upon installing these dependencies, a [shared/node_modules/](./shared/node_modules) folder is created.\n This folder will be **symlinked** into each example.\n So it is not a copy like the other boilerplate files.\n \n-### End to end tests\n \n-End to end changes between boilerplates.\n+### End-to-end tests\n \n-For CLI applications, create a `app.e2e-spec.ts` inside the `e2e` folder.\n-The tooling will run `ng e2e` for each CLI based examples.\n+End-to-end infrastructure is slightly different between CLI- and SystemJS-based examples.\n \n-For SystemJS, each example contains an `e2e-spec.ts` file.\n-You can find all the related configuration files in the `/aio/tools/examples/shared` folder.\n+For CLI-based examples, create an `app.e2e-spec.ts` file inside the `e2e/` folder.\n+This will be picked up by the default testing command (see the [example configuration section](#example-config) above).\n+If you are using a custom test command, make sure e2e specs are picked up (if applicable).\n \n-### example-boilerplate.js\n+For SystemJS-based examples, create an `e2e-spec.ts` file inside the example root folder.\n+These apps will be tested with the following command:\n \n-This script installs all the dependencies that are shared among all the examples, creates the `node_modules` symlinks and copy all the boilerplate files where needed.\n-It won't do anything about stackblitz nor e2e tests.\n+```sh\n+yarn protractor aio/tools/examples/shared/protractor.config.js \\\n+  --specs=<example-folder>/e2e-spec.ts \\\n+  --params.appDir=<example-folder>\n+```\n+\n+\n+### `example-boilerplate.js`\n+\n+The [example-boilerplate.js](./example-boilerplate.js) script installs the dependencies for all examples, creates the `node_modules/` symlinks and copies the necessary boilerplate files into example folders.\n \n It also contains a function to remove all the boilerplate.\n-It uses a `git clean -xdf` to do the job.\n-It will remove all files that don't exist in the git repository, **including any new file that you are working on that hasn't been stage yet.**\n-So be sure to save your work before removing the boilerplate.\n+It uses `git clean -xdf` to do the job.\n+It will remove all files that are not tracked by git, **including any new files that you are working on that haven't been stageg yet.**\n+So, be sure to commit your work before removing the boilerplate.\n \n-### run-example-e2e.js\n \n-This script will find all the `e2e-spec.ts` files and run them.\n+### `run-example-e2e.js`\n \n-To not run all tests, you can use the `--filter=name` flag to run the example's e2e that contains that name.\n+The [run-example-e2e.js](./run-example-e2e.js) script will find and run the e2e tests for all examples.\n+Although it only runs e2e tests by default, it can be configured to run any test command (for CLI-based examples) by using the `tests` property of the [example-config.json](#example-config) file.\n+It is named `*-e2e` for historical reasons, but it is not limited to running e2e tests.\n \n-It also has an optional `--setup` flag to run the `example-boilerplate.js` script and install the latest `webdriver`.\n+See [aio/README.md](../../README.md#developer-tasks) for the available command-line options.\n \n-It will create a `/aio/protractor-results.txt` file when it finishes running tests.\n+Running the script will create an `aio/protractor-results.txt` file with the results of the tests.\n \n-### Updating example dependencies\n \n-With every major release, we update the examples to be on the latest version.\n-The following steps to update are:\n+### Updating example dependencies\n \n-* In the `shared/package.json` file, bump all the `@angular/*`, `@angular-devkit/*`, `rxjs`, `typescript`, and `zone.js` package versions to the version that corresponds with the [framework version](../../../package.json).\n-* In the `shared` folder, run `yarn` to update the dependencies for the shared `node_modules` and the `yarn.lock` file.\n-* In the `boilerplate` folder, go through each sub-folder and update the `package.json` dependencies if one is present.\n-* Follow the [update guide](./shared/boilerplate/UPDATING_CLI.md) to update the common files used in the examples based on project type.\n+With every major Angular release, we update the examples to be on the latest version.\n+See [UPDATING.md](./UPDATING.md) for instructions."
        },
        {
            "sha": "2298d9f678b85b9db52b69575eeab34853912697",
            "filename": "aio/tools/examples/UPDATING.md",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2Ftools%2Fexamples%2FUPDATING.md",
            "raw_url": "https://github.com/angular/angular/raw/37ed4bd9ffe026c87da7abd31211244db1763685/aio%2Ftools%2Fexamples%2FUPDATING.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2FUPDATING.md?ref=37ed4bd9ffe026c87da7abd31211244db1763685",
            "patch": "@@ -0,0 +1,55 @@\n+# Update example dependencies\n+\n+Follow these steps to update the examples to the latest versions of Angular (and related dependencies):\n+\n+- In [shared/package.json](./shared/package.json), bump all the `@angular/*` and `@nguniversal/*` package versions to the version you want to update to and update their peer dependencies (such as `@angular-devkit/*`, `rxjs`, `typescript`, `zone.js`) and other dependencies (e.g. `@types/*`) to the latest compatible versions.\n+\n+  > NOTE:\n+  > The [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repo can be a useful resource for discovering what dependency versions are used for a basic CLI app at a specific CLI version.\n+\n+- In the [shared/](./shared) folder, run `yarn` to update the dependencies in the [shared/node_modules/](./shared/node_modules) folder and the [shared/yarn.lock](./shared/yarn.lock) file.\n+\n+- In the [shared/boilerplate/](./shared/boilerplate) folder, go through each sub-folder and update the dependency versions in all `package.json` files to match the ones in [shared/package.json](./shared/package.json).\n+\n+- Follow the steps in the following section to update the rest of the boilerplate files.\n+\n+\n+## Update other boilerplate files\n+\n+The Angular CLI default setup is updated using `ng update`.\n+Any necessary changes to boilerplate files will be done automatically through migration schematics.\n+\n+> NOTE:\n+> Migrations affecting source code files will not happen automatically, because `ng update` does not know about all the examples in `aio/content/examples/`.\n+> You have to make these changes (if any) manually.\n+> Again, the [angular-cli-diff](https://github.com/cexbrayat/angular-cli-diff) repo can be a useful resource for discovering changes between versions.\n+\n+- In the [shared/boilerplate/cli/](./shared/boilerplate/cli) folder, run the following commands to migrate the the project to the current versions of Angular CLI and the Angular framework (updated in previous steps):\n+  ```sh\n+  # Ensure dependencies are installed.\n+  yarn install\n+\n+  # Migrate project to new versions.\n+  yarn ng update @angular/cli --migrate-only --from=<previous-cli-version>\n+  yarn ng update @angular/core --migrate-only --from=<previous-core-version>\n+\n+  # Remove `node_modules/` and `yarn.lock`.\n+  rm -rf node_modules yarn.lock\n+  ```\n+\n+  > NOTE:\n+  > In order for `ng update` to work, there must be a `node_modules/` directory with installed dependencies inside the [shared/boilerplate/cli/](./shared/boilerplate/cli) directory.\n+  > This `node_modules/` directory is only needed during the update operation and must be subsequently removed to avoid its being copied into all CLI-based examples.\n+\n+- The previous command made any necessary changes to boilerplate files inside the `cli/` folder, but the same changes need to be applied to the other CLI-based boilerplate folders.\n+  Inspect the changes in `cli/` and manually apply the necessary ones to other CLI-based boilerplate folders.\n+\n+- Ensure any changes to [cli/tslint.json](./shared/boilerplate/cli/tslint.json) are ported over to [systemjs/tslint.json](./shared/boilerplate/systemjs/tslint.json) and also [aio/content/examples/tslint.json](../../content/examples/tslint.json).\n+  This last part is important, since this file is used to lint example code on CI.\n+\n+- Inspect the changes and determine whether some of them need to be applied to the `systemjs` boilerplate files.\n+\n+- Inspect the changes and determine whether any updates to guides are necessary.\n+  For example, if a file is renamed or moved, any guides mentioning that file may need updating to refer to the new name/location.\n+\n+- Commit all changes to the repository."
        },
        {
            "sha": "9547b2fa1f5c7ff1c1b2d07f762cbf96cf5874be",
            "filename": "aio/tools/examples/shared/boilerplate/UPDATING_CLI.md",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/efe0e03fe1eb527180661445f6b5fa315a364ca4/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2FUPDATING_CLI.md",
            "raw_url": "https://github.com/angular/angular/raw/efe0e03fe1eb527180661445f6b5fa315a364ca4/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2FUPDATING_CLI.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2FUPDATING_CLI.md?ref=efe0e03fe1eb527180661445f6b5fa315a364ca4",
            "patch": "@@ -1,52 +0,0 @@\n-# How to update the CLI project\n-\n-The Angular CLI default setup is updated using `ng update`.\n-Any necessary file changes will be done automatically through migration schematics.\n-\n-In the `cli` folder, update the Angular CLI depedencies to the latest version:\n-\n-```\n-ng update @angular/cli --next\n-```\n-\n-Then update the Angular Framework dependencies to the latest version:\n-\n-```\n-ng update @angular/core --next\n-```\n-\n-Commit any changes to the `cli` folder to the repository.\n-\n-## Updating other CLI-based projects\n-\n-Along with the boilerplate files for the `cli` folder, the other cli-based projects need to be updated also. Each cli-based project has slightly modified files specific to the project type.\n-Make sure any necessary changes to these projects are made also to be in alignment with the `cli` project files.\n-\n-The specific changes to each project type are listed below:\n-\n-* i18n\n-  - angular.json\n-    - Includes additional configurations for `build`, `serve`, and `e2e` for different locales\n-  - package.json\n-    - Includes custom scripts for building and serving different locales\n-* ivy\n-  - cli/tsconfig.app.json\n-    - Includes an `angularCompilerOptions` object with `enableIvy` set to `true`\n-* schematics\n-  - angular.json\n-    - Includes a `my-lib` project that contains a library with example schematics\n-* service-worker\n-  - angular.json\n-    - Has `serviceWorker` set to `true` in the `production` build target\n-  - package.json\n-    - Includes `@angular/service-worker` in `dependencies`\n-* testing\n-  - angular.json\n-    - Includes `src/test.css` in the `styles` for the `test` target\n-* universal\n-  - angular.json\n-    - Includes a `server` target in the `build` architect runners\n-  - package.json\n-    - Includes custom scripts for building the `server`\n-    - Includes additional `dependencies` on `@angular/platform-server`, `@nguniversal/express-engine`, and `express`\n-    - Includes additional `devDependencies` on `@nguniversal/builders` and `@types/express`"
        }
    ],
    "stats": {
        "total": 288,
        "additions": 163,
        "deletions": 125
    }
}