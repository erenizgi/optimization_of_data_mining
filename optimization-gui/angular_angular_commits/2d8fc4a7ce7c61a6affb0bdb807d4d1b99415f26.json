{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): use `TemplateDiagnostic` in `extended` package (#43134)\n\nReturn `TemplateDiagnostic` instead of `ts.Diagnostic` when getting the\nextended template diagnostics. This makes the integration with the\nlanguage service easier. This also fixes the error code and now uses the\n`ngErrorCode` for extended template diagnostics.\n\nRefs #42966\n\nPR Close #43134",
    "sha": "2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
    "files": [
        {
            "sha": "ce7c8778f6c440aa56496fc629b48e1d336d70c6",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/api.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -8,6 +8,7 @@\n \n import {AbsoluteSourceSpan, BoundTarget, DirectiveMeta, ParseSourceSpan, SchemaMetadata} from '@angular/compiler';\n import * as ts from 'typescript';\n+import {ErrorCode} from '../../diagnostics';\n \n import {AbsoluteFsPath} from '../../file_system';\n import {Reference} from '../../imports';\n@@ -28,6 +29,27 @@ export interface TypeCheckableDirectiveMeta extends DirectiveMeta, DirectiveType\n \n export type TemplateId = string&{__brand: 'TemplateId'};\n \n+/**\n+ * A `ts.Diagnostic` with additional information about the diagnostic related to template\n+ * type-checking.\n+ */\n+export interface TemplateDiagnostic extends ts.Diagnostic {\n+  /**\n+   * The component with the template that resulted in this diagnostic.\n+   */\n+  componentFile: ts.SourceFile;\n+\n+  /**\n+   * The template id of the component that resulted in this diagnostic.\n+   */\n+  templateId: TemplateId;\n+}\n+\n+/**\n+ * A `TemplateDiagnostic` with a specific error code.\n+ */\n+export type NgTemplateDiagnostic<T extends ErrorCode> = TemplateDiagnostic&{__ngCode: T};\n+\n /**\n  * Metadata required in addition to a component class in order to generate a type check block (TCB)\n  * for that component."
        },
        {
            "sha": "0bf5f133c534b026c1d402a48dc9f737acb28b0d",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -12,7 +12,7 @@ import {TextAttribute} from '@angular/compiler/src/render3/r3_ast';\n import * as ts from 'typescript';\n import {ErrorCode} from '../../diagnostics';\n \n-import {FullTemplateMapping, TypeCheckableDirectiveMeta} from './api';\n+import {FullTemplateMapping, NgTemplateDiagnostic, TypeCheckableDirectiveMeta} from './api';\n import {GlobalCompletion} from './completion';\n import {DirectiveInScope, PipeInScope} from './scope';\n import {DirectiveSymbol, ElementSymbol, ShimLocation, Symbol, TemplateSymbol} from './symbols';\n@@ -175,7 +175,7 @@ export interface TemplateTypeChecker {\n         start: number,\n         end: number,\n         sourceFile: ts.SourceFile,\n-      }[]): ts.Diagnostic;\n+      }[]): NgTemplateDiagnostic<T>;\n }\n \n /**"
        },
        {
            "sha": "172c966ca8f7d3e589b726fb14010817baf137a4",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/diagnostics/src/diagnostic.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 17,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fdiagnostic.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fdiagnostic.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fdiagnostics%2Fsrc%2Fdiagnostic.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -9,23 +9,7 @@\n import {ParseSourceSpan} from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {ExternalTemplateSourceMapping, TemplateId, TemplateSourceMapping} from '../../api';\n-\n-/**\n- * A `ts.Diagnostic` with additional information about the diagnostic related to template\n- * type-checking.\n- */\n-export interface TemplateDiagnostic extends ts.Diagnostic {\n-  /**\n-   * The component with the template that resulted in this diagnostic.\n-   */\n-  componentFile: ts.SourceFile;\n-\n-  /**\n-   * The template id of the component that resulted in this diagnostic.\n-   */\n-  templateId: TemplateId;\n-}\n+import {ExternalTemplateSourceMapping, TemplateDiagnostic, TemplateId, TemplateSourceMapping} from '../../api';\n \n /**\n  * Constructs a `ts.Diagnostic` for a given `ParseSourceSpan` within a template."
        },
        {
            "sha": "0daee3242f5508969e44817f4eb165a3a34246a6",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/api/api.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -10,12 +10,7 @@ import {TmplAstNode} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {ErrorCode} from '../../../diagnostics';\n-import {TemplateTypeChecker} from '../../api';\n-\n-/**\n- * A `ts.Diangostic` with a specific error code.\n- */\n-export type TemplateDiagnostic<T extends ErrorCode> = ts.Diagnostic&{code: T};\n+import {NgTemplateDiagnostic, TemplateTypeChecker} from '../../api';\n \n /**\n  * A Template Check receives information about the template it's checking and returns\n@@ -26,7 +21,7 @@ export interface TemplateCheck<T extends ErrorCode> {\n   code: T;\n \n   /** Runs check and returns information about the diagnostics to be generated. */\n-  run(ctx: TemplateContext, template: TmplAstNode[]): TemplateDiagnostic<T>[];\n+  run(ctx: TemplateContext, template: TmplAstNode[]): NgTemplateDiagnostic<T>[];\n }\n \n /**"
        },
        {
            "sha": "efc336588ee2a2665e84cde8f88e8fd6e142dcf3",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/api/extended_template_checker.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fextended_template_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fextended_template_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fextended_template_checker.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import * as ts from 'typescript';\n+import {TemplateDiagnostic} from '../../api';\n \n /**\n  * Interface to generate extended template diangostics from the component tempaltes.\n@@ -15,5 +16,5 @@ export interface ExtendedTemplateChecker {\n   /**\n    * Run `TemplateCheck`s for a component and return the generated `ts.Diagnostic`s.\n    */\n-  getExtendedTemplateDiagnosticsForComponent(component: ts.ClassDeclaration): ts.Diagnostic[];\n+  getExtendedTemplateDiagnosticsForComponent(component: ts.ClassDeclaration): TemplateDiagnostic[];\n }"
        },
        {
            "sha": "ae87abbac228ed29a752cd54ea3a9ad776f58641",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/extended_template_checker.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -9,7 +9,7 @@\n import * as ts from 'typescript';\n \n import {ErrorCode} from '../../../diagnostics';\n-import {TemplateTypeChecker} from '../../api';\n+import {TemplateDiagnostic, TemplateTypeChecker} from '../../api';\n import {ExtendedTemplateChecker, TemplateCheck, TemplateContext} from '../api';\n \n export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n@@ -18,15 +18,15 @@ export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n       private readonly typeChecker: ts.TypeChecker,\n       private readonly templateChecks: TemplateCheck<ErrorCode>[]) {}\n \n-  getExtendedTemplateDiagnosticsForComponent(component: ts.ClassDeclaration): ts.Diagnostic[] {\n+  getExtendedTemplateDiagnosticsForComponent(component: ts.ClassDeclaration): TemplateDiagnostic[] {\n     const template = this.templateTypeChecker.getTemplate(component);\n     // Skip checks if component has no template. This can happen if the user writes a\n     // `@Component()` but doesn't add the template, could happen in the language service\n     // when users are in the middle of typing code.\n     if (template === null) {\n       return [];\n     }\n-    const diagnostics: ts.Diagnostic[] = [];\n+    const diagnostics: TemplateDiagnostic[] = [];\n \n     const ctx = {\n       templateTypeChecker: this.templateTypeChecker,\n@@ -78,8 +78,8 @@ export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n // TODO(danieltrevino): handle duplicated diagnostics when they are being generated\n // to avoid extra work (could be directly in the visitor).\n // https://github.com/angular/angular/pull/42984#discussion_r684823926\n-function deduplicateDiagnostics(diagnostics: ts.Diagnostic[]): ts.Diagnostic[] {\n-  const result: ts.Diagnostic[] = [];\n+function deduplicateDiagnostics<T extends ts.Diagnostic>(diagnostics: T[]): T[] {\n+  const result: T[] = [];\n   for (const newDiag of diagnostics) {\n     const isDuplicateDiag = result.some(existingDiag => areDiagnosticsEqual(newDiag, existingDiag));\n     if (!isDuplicateDiag) {"
        },
        {
            "sha": "4a9b4ddecad21ebd74e64b50b31dbea6573342d8",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -7,6 +7,7 @@ ts_library(\n     deps = [\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "60634a4299ec9eddbe603fbb065b6871b2b99760",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box/index.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -8,8 +8,10 @@\n \n import {TmplAstBoundEvent, TmplAstNode, TmplAstRecursiveVisitor} from '@angular/compiler';\n import * as ts from 'typescript';\n+\n import {ErrorCode} from '../../../../../diagnostics';\n-import {TemplateCheck, TemplateContext, TemplateDiagnostic} from '../../../api';\n+import {NgTemplateDiagnostic} from '../../../../api';\n+import {TemplateCheck, TemplateContext} from '../../../api';\n \n /**\n  * Ensures the two-way binding syntax is correct.\n@@ -20,15 +22,15 @@ export class InvalidBananaInBoxCheck implements TemplateCheck<ErrorCode.INVALID_\n   code: ErrorCode.INVALID_BANANA_IN_BOX = 8101;\n \n   run(ctx: TemplateContext,\n-      template: TmplAstNode[]): TemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] {\n+      template: TmplAstNode[]): NgTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] {\n     const visitor = new BananaVisitor(ctx);\n \n     return visitor.getDiagnostics(template);\n   }\n }\n \n class BananaVisitor extends TmplAstRecursiveVisitor {\n-  private diagnostics: ts.Diagnostic[] = [];\n+  private diagnostics: NgTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] = [];\n \n   constructor(public readonly ctx: TemplateContext) {\n     super();\n@@ -45,17 +47,16 @@ class BananaVisitor extends TmplAstRecursiveVisitor {\n     if (name.startsWith('[') && name.endsWith(']')) {\n       const boundSyntax = boundEvent.sourceSpan.toString();\n       const expectedBoundSyntax = boundSyntax.replace(`(${name})`, `[(${name.slice(1, -1)})]`);\n-      this.diagnostics.push(\n-          this.ctx.templateTypeChecker.makeTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>(\n-              this.ctx.component, boundEvent.sourceSpan, ts.DiagnosticCategory.Warning,\n-              ErrorCode.INVALID_BANANA_IN_BOX,\n-              `In the two-way binding syntax the parentheses should be inside the brackets, ex. '${\n-                  expectedBoundSyntax}'. \n+      this.diagnostics.push(this.ctx.templateTypeChecker.makeTemplateDiagnostic(\n+          this.ctx.component, boundEvent.sourceSpan, ts.DiagnosticCategory.Warning,\n+          ErrorCode.INVALID_BANANA_IN_BOX,\n+          `In the two-way binding syntax the parentheses should be inside the brackets, ex. '${\n+              expectedBoundSyntax}'. \n                 Find more at https://angular.io/guide/two-way-binding`));\n     }\n   }\n \n-  getDiagnostics(template: TmplAstNode[]): ts.Diagnostic[] {\n+  getDiagnostics(template: TmplAstNode[]): NgTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] {\n     this.diagnostics = [];\n     for (const node of template) {\n       node.visit(this);"
        },
        {
            "sha": "1098bef6f1bf5d5b988209f0a9bc59e74564815f",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/test/template_checks/invalid_banana_in_box/spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import * as ts from 'typescript';\n-import {ErrorCode} from '../../../../../diagnostics';\n+import {ErrorCode, ngErrorCode} from '../../../../../diagnostics';\n import {absoluteFrom, getSourceFileOrError} from '../../../../../file_system';\n import {runInEachFileSystem} from '../../../../../file_system/testing';\n import {getSourceCodeForDiagnostic} from '../../../../../testing';\n@@ -33,7 +33,7 @@ runInEachFileSystem(() => {\n       const diags = extendedTemplateChecker.getExtendedTemplateDiagnosticsForComponent(component);\n       expect(diags.length).toBe(1);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n-      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(diags[0].code).toBe(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"var1\"');\n     });\n \n@@ -94,10 +94,10 @@ runInEachFileSystem(() => {\n       const diags = extendedTemplateChecker.getExtendedTemplateDiagnosticsForComponent(component);\n       expect(diags.length).toBe(2);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n-      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(diags[0].code).toBe(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"var1\"');\n       expect(diags[1].category).toBe(ts.DiagnosticCategory.Warning);\n-      expect(diags[1].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(diags[1].code).toBe(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n       expect(getSourceCodeForDiagnostic(diags[1])).toBe('([notARealThing2])=\"var1\"');\n     });\n   });"
        },
        {
            "sha": "b908e61e700acab9f981749ba8816df2b22957c5",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -9,7 +9,7 @@\n import {AST, CssSelector, DomElementSchemaRegistry, LiteralPrimitive, MethodCall, ParseError, ParseSourceSpan, parseTemplate, PropertyRead, SafeMethodCall, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstVariable} from '@angular/compiler';\n import {TextAttribute} from '@angular/compiler/src/render3/r3_ast';\n import * as ts from 'typescript';\n-import {ErrorCode} from '../../diagnostics';\n+import {ErrorCode, ngErrorCode} from '../../diagnostics';\n \n import {absoluteFrom, absoluteFromSourceFile, AbsoluteFsPath, getSourceFileOrError} from '../../file_system';\n import {Reference, ReferenceEmitter} from '../../imports';\n@@ -20,8 +20,8 @@ import {ClassDeclaration, isNamedClassDeclaration, ReflectionHost} from '../../r\n import {ComponentScopeReader, TypeCheckScopeRegistry} from '../../scope';\n import {isShim} from '../../shims';\n import {getSourceFileOrNull, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n-import {DirectiveInScope, ElementSymbol, FullTemplateMapping, GlobalCompletion, OptimizeFor, PipeInScope, ProgramTypeCheckAdapter, ShimLocation, Symbol, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n-import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n+import {DirectiveInScope, ElementSymbol, FullTemplateMapping, GlobalCompletion, NgTemplateDiagnostic, OptimizeFor, PipeInScope, ProgramTypeCheckAdapter, ShimLocation, Symbol, TemplateDiagnostic, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n+import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {CompletionEngine} from './completion';\n import {InliningMode, ShimTypeCheckingData, TemplateData, TypeCheckContextImpl, TypeCheckingHost} from './context';\n@@ -316,14 +316,18 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n         start: number,\n         end: number,\n         sourceFile: ts.SourceFile,\n-      }[]): TemplateDiagnostic {\n+      }[]): NgTemplateDiagnostic<T> {\n     const sfPath = absoluteFromSourceFile(clazz.getSourceFile());\n     const fileRecord = this.state.get(sfPath)!;\n     const templateId = fileRecord.sourceManager.getTemplateId(clazz);\n     const mapping = fileRecord.sourceManager.getSourceMapping(templateId);\n \n-    return makeTemplateDiagnostic(\n-        templateId, mapping, sourceSpan, category, errorCode, message, relatedInformation);\n+    return {\n+      ...makeTemplateDiagnostic(\n+          templateId, mapping, sourceSpan, category, ngErrorCode(errorCode), message,\n+          relatedInformation),\n+      __ngCode: errorCode\n+    };\n   }\n \n   private getOrCreateCompletionEngine(component: ts.ClassDeclaration): CompletionEngine|null {"
        },
        {
            "sha": "991d01f4a7d9c81432e6cf245a76f2bac7d6345c",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/context.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -16,8 +16,8 @@ import {PerfEvent, PerfRecorder} from '../../perf';\n import {FileUpdate} from '../../program_driver';\n import {ClassDeclaration, ReflectionHost} from '../../reflection';\n import {ImportManager} from '../../translator';\n-import {TemplateId, TemplateSourceMapping, TypeCheckableDirectiveMeta, TypeCheckBlockMetadata, TypeCheckContext, TypeCheckingConfig, TypeCtorMetadata} from '../api';\n-import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n+import {TemplateDiagnostic, TemplateId, TemplateSourceMapping, TypeCheckableDirectiveMeta, TypeCheckBlockMetadata, TypeCheckContext, TypeCheckingConfig, TypeCtorMetadata} from '../api';\n+import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {DomSchemaChecker, RegistryDomSchemaChecker} from './dom';\n import {Environment} from './environment';"
        },
        {
            "sha": "14b5c321bb76b574c2900634f1134667f7bc1043",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/diagnostics.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdiagnostics.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdiagnostics.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdiagnostics.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -7,8 +7,8 @@\n  */\n import {AbsoluteSourceSpan, ParseSourceSpan} from '@angular/compiler';\n import * as ts from 'typescript';\n-import {TemplateId} from '../api';\n-import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n+import {TemplateDiagnostic, TemplateId} from '../api';\n+import {makeTemplateDiagnostic} from '../diagnostics';\n import {getTemplateMapping, TemplateSourceResolver} from './tcb_util';\n \n "
        },
        {
            "sha": "b32d249748e125ada9b23f5d6cf0de70a3545d0a",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/dom.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -10,8 +10,8 @@ import {DomElementSchemaRegistry, ParseSourceSpan, SchemaMetadata, TmplAstElemen\n import * as ts from 'typescript';\n \n import {ErrorCode, ngErrorCode} from '../../diagnostics';\n-import {TemplateId} from '../api';\n-import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n+import {TemplateDiagnostic, TemplateId} from '../api';\n+import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {TemplateSourceResolver} from './tcb_util';\n "
        },
        {
            "sha": "63199f50c816954da3aec554fa24600f5f08811b",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/oob.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -12,8 +12,8 @@ import * as ts from 'typescript';\n \n import {ErrorCode, makeDiagnostic, makeRelatedInformation, ngErrorCode} from '../../diagnostics';\n import {ClassDeclaration} from '../../reflection';\n-import {TemplateId} from '../api';\n-import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n+import {TemplateDiagnostic, TemplateId} from '../api';\n+import {makeTemplateDiagnostic} from '../diagnostics';\n \n import {TemplateSourceResolver} from './tcb_util';\n "
        },
        {
            "sha": "d9d79890620aa2e253991eba1cac5b0b2990ccf8",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/testing/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2FBUILD.bazel?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -21,7 +21,6 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n-        \"//packages/compiler-cli/src/ngtsc/typecheck/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/util\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "c0bf786a9ba9fd79b69a94aa142d24204629f4e3",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/testing/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftesting%2Findex.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -20,9 +20,8 @@ import {ClassDeclaration, isNamedClassDeclaration, TypeScriptReflectionHost} fro\n import {ComponentScopeReader, LocalModuleScope, ScopeData, TypeCheckScopeRegistry} from '../../scope';\n import {makeProgram} from '../../testing';\n import {getRootDirs} from '../../util/src/typescript';\n-import {ProgramTypeCheckAdapter, TemplateTypeChecker, TypeCheckContext} from '../api';\n+import {ProgramTypeCheckAdapter, TemplateDiagnostic, TemplateTypeChecker, TypeCheckContext} from '../api';\n import {TemplateId, TemplateSourceMapping, TypeCheckableDirectiveMeta, TypeCheckBlockMetadata, TypeCheckingConfig} from '../api/api';\n-import {TemplateDiagnostic} from '../diagnostics';\n import {TemplateTypeCheckerImpl} from '../src/checker';\n import {DomSchemaChecker} from '../src/dom';\n import {Environment} from '../src/environment';"
        },
        {
            "sha": "34681759bdc9b754621e8d952e3cb5a9d0d5a55b",
            "filename": "packages/compiler-cli/test/ngtsc/extended_template_diagnostics_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import * as ts from 'typescript';\n-import {ErrorCode} from '../../src/ngtsc/diagnostics';\n+import {ErrorCode, ngErrorCode} from '../../src/ngtsc/diagnostics';\n import {runInEachFileSystem} from '../../src/ngtsc/file_system/testing';\n import {getSourceCodeForDiagnostic, loadStandardTestFiles} from '../../src/ngtsc/testing';\n \n@@ -39,7 +39,7 @@ runInEachFileSystem(() => {\n       const diags = env.driveDiagnostics();\n       expect(diags.length).toBe(1);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n-      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(diags[0].code).toBe(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"bar\"');\n     });\n \n@@ -62,7 +62,7 @@ runInEachFileSystem(() => {\n       const diags = env.driveDiagnostics();\n       expect(diags.length).toBe(1);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n-      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(diags[0].code).toBe(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"bar\"');\n     });\n "
        },
        {
            "sha": "909558eb760f635c6b0839798d11f4bd9647c317",
            "filename": "packages/language-service/ivy/test/diagnostic_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts?ref=2d8fc4a7ce7c61a6affb0bdb807d4d1b99415f26",
            "patch": "@@ -380,7 +380,7 @@ describe('getSemanticDiagnostics', () => {\n \n     const diags = project.getDiagnosticsForFile('app.ts');\n     expect(diags.length).toEqual(1);\n-    expect(diags[0].code).toEqual(ErrorCode.INVALID_BANANA_IN_BOX);\n+    expect(diags[0].code).toEqual(ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX));\n     expect(diags[0].category).toEqual(ts.DiagnosticCategory.Warning);\n   });\n "
        }
    ],
    "stats": {
        "total": 140,
        "additions": 73,
        "deletions": 67
    }
}