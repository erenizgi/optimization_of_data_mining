{
    "author": "chrisguttandin",
    "message": "fix(service-worker): handle error with ErrorHandler (#39990)\n\nErrors thrown by calling serviceWorker.register() are now passed to the global ErrorHandler.\n\nFixes #39913\n\nPR Close #39990",
    "sha": "74e42cf7d516144b98de65addab11cc23bf73f02",
    "files": [
        {
            "sha": "0bc5e92c0c61d016b283eeae21f436aab5d72ba9",
            "filename": "packages/service-worker/src/module.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/74e42cf7d516144b98de65addab11cc23bf73f02/packages%2Fservice-worker%2Fsrc%2Fmodule.ts",
            "raw_url": "https://github.com/angular/angular/raw/74e42cf7d516144b98de65addab11cc23bf73f02/packages%2Fservice-worker%2Fsrc%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fsrc%2Fmodule.ts?ref=74e42cf7d516144b98de65addab11cc23bf73f02",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {isPlatformBrowser} from '@angular/common';\n-import {APP_INITIALIZER, ApplicationRef, InjectionToken, Injector, ModuleWithProviders, NgModule, NgZone, PLATFORM_ID} from '@angular/core';\n+import {APP_INITIALIZER, ApplicationRef, ErrorHandler, InjectionToken, Injector, ModuleWithProviders, NgModule, NgZone, PLATFORM_ID} from '@angular/core';\n import {merge, Observable, of} from 'rxjs';\n import {delay, filter, take} from 'rxjs/operators';\n \n@@ -128,9 +128,10 @@ export function ngswAppInitializer(\n     const ngZone = injector.get(NgZone);\n     ngZone.runOutsideAngular(\n         () => readyToRegister$.pipe(take(1)).subscribe(\n-            () =>\n-                navigator.serviceWorker.register(script, {scope: options.scope})\n-                    .catch(err => console.error('Service worker registration failed with:', err))));\n+            () => navigator.serviceWorker.register(script, {scope: options.scope}).catch(err => {\n+              const errorHandler = injector.get(ErrorHandler);\n+              errorHandler.handleError(err);\n+            })));\n   };\n   return initializer;\n }"
        },
        {
            "sha": "42c5cb73a07caf35db0adc101ee4e76e97c2e381",
            "filename": "packages/service-worker/test/module_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/74e42cf7d516144b98de65addab11cc23bf73f02/packages%2Fservice-worker%2Ftest%2Fmodule_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/74e42cf7d516144b98de65addab11cc23bf73f02/packages%2Fservice-worker%2Ftest%2Fmodule_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Ftest%2Fmodule_spec.ts?ref=74e42cf7d516144b98de65addab11cc23bf73f02",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {ApplicationRef, PLATFORM_ID} from '@angular/core';\n+import {ApplicationRef, ErrorHandler, PLATFORM_ID} from '@angular/core';\n import {fakeAsync, flushMicrotasks, TestBed, tick} from '@angular/core/testing';\n import {Subject} from 'rxjs';\n import {filter, take} from 'rxjs/operators';\n@@ -21,6 +21,7 @@ describe('ServiceWorkerModule', () => {\n     return;\n   }\n \n+  let errorHandlerSpy: jasmine.Spy;\n   let swRegisterSpy: jasmine.Spy;\n \n   const untilStable = () => {\n@@ -34,9 +35,14 @@ describe('ServiceWorkerModule', () => {\n \n   describe('register()', () => {\n     const configTestBed = async (opts: SwRegistrationOptions) => {\n+      const errorHandler = {handleError: () => {}};\n+      errorHandlerSpy = spyOn(errorHandler, 'handleError');\n       TestBed.configureTestingModule({\n         imports: [ServiceWorkerModule.register('sw.js', opts)],\n-        providers: [{provide: PLATFORM_ID, useValue: 'browser'}],\n+        providers: [\n+          {provide: ErrorHandler, useValue: errorHandler},\n+          {provide: PLATFORM_ID, useValue: 'browser'},\n+        ],\n       });\n \n       await untilStable();\n@@ -71,12 +77,10 @@ describe('ServiceWorkerModule', () => {\n     });\n \n     it('catches and a logs registration errors', async () => {\n-      const consoleErrorSpy = spyOn(console, 'error');\n       swRegisterSpy.and.returnValue(Promise.reject('no reason'));\n \n       await configTestBed({enabled: true, scope: 'foo'});\n-      expect(consoleErrorSpy)\n-          .toHaveBeenCalledWith('Service worker registration failed with:', 'no reason');\n+      expect(errorHandlerSpy).toHaveBeenCalledWith('no reason');\n     });\n   });\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 14,
        "deletions": 9
    }
}