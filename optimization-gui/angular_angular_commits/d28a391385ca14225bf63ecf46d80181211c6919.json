{
    "author": "atscott",
    "message": "fix(router): Remove information about attached component when deactivating route (#41381)\n\nWhen we deactivate a child route, we deactivate its outlet as well as\nits children. We also need to clear the stored information about the\nroute and the associated component.\nIf we do not, the context will keep these references and can result in\nreactivating an outlet that was deactivated by the previous navigation.\n\nFixes #41379\n\nPR Close #41381",
    "sha": "d28a391385ca14225bf63ecf46d80181211c6919",
    "files": [
        {
            "sha": "8abe7300f1759f8718b51ec41f44c214b6f704b8",
            "filename": "packages/router/src/operators/activate_routes.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d28a391385ca14225bf63ecf46d80181211c6919/packages%2Frouter%2Fsrc%2Foperators%2Factivate_routes.ts",
            "raw_url": "https://github.com/angular/angular/raw/d28a391385ca14225bf63ecf46d80181211c6919/packages%2Frouter%2Fsrc%2Foperators%2Factivate_routes.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Foperators%2Factivate_routes.ts?ref=d28a391385ca14225bf63ecf46d80181211c6919",
            "patch": "@@ -123,6 +123,11 @@ export class ActivateRoutes {\n       context.outlet.deactivate();\n       // Destroy the contexts for all the outlets that were in the component\n       context.children.onOutletDeactivated();\n+      // Clear the information about the attached component on the context but keep the reference to\n+      // the outlet.\n+      context.attachRef = null;\n+      context.resolver = null;\n+      context.route = null;\n     }\n   }\n "
        },
        {
            "sha": "84b5117c5e1aca7cb556f3bb13353b6c0102b413",
            "filename": "packages/router/test/regression_integration.spec.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 1,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/d28a391385ca14225bf63ecf46d80181211c6919/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d28a391385ca14225bf63ecf46d80181211c6919/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts?ref=d28a391385ca14225bf63ecf46d80181211c6919",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {ChangeDetectionStrategy, Component, ContentChild, NgModule, TemplateRef, Type, ViewChild, ViewContainerRef} from '@angular/core';\n+import {ChangeDetectionStrategy, ChangeDetectorRef, Component, NgModule, TemplateRef, Type, ViewChild, ViewContainerRef} from '@angular/core';\n import {ComponentFixture, fakeAsync, TestBed, tick} from '@angular/core/testing';\n import {Router} from '@angular/router';\n import {RouterTestingModule} from '@angular/router/testing';\n@@ -187,6 +187,46 @@ describe('Integration', () => {\n          expect(fixture.nativeElement.innerHTML).toContain('isActive: true');\n        }));\n   });\n+\n+  it('should not reactivate a deactivated outlet when destroyed and recreated - #41379',\n+     fakeAsync(() => {\n+       @Component({template: 'simple'})\n+       class SimpleComponent {\n+       }\n+\n+       @Component({template: ` <router-outlet *ngIf=\"outletVisible\" name=\"aux\"></router-outlet> `})\n+       class AppComponent {\n+         outletVisible = true;\n+       }\n+\n+       TestBed.configureTestingModule({\n+         imports: [RouterTestingModule.withRoutes(\n+             [{path: ':id', component: SimpleComponent, outlet: 'aux'}])],\n+         declarations: [SimpleComponent, AppComponent],\n+       });\n+\n+       const router = TestBed.inject(Router);\n+       const fixture = createRoot(router, AppComponent);\n+       const componentCdr = fixture.componentRef.injector.get<ChangeDetectorRef>(ChangeDetectorRef);\n+\n+       router.navigate([{outlets: {aux: ['1234']}}]);\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).toContain('simple');\n+\n+       router.navigate([{outlets: {aux: null}}]);\n+       advance(fixture);\n+       expect(fixture.nativeElement.innerHTML).not.toContain('simple');\n+\n+       fixture.componentInstance.outletVisible = false;\n+       componentCdr.detectChanges();\n+       expect(fixture.nativeElement.innerHTML).not.toContain('simple');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('router-outlet');\n+\n+       fixture.componentInstance.outletVisible = true;\n+       componentCdr.detectChanges();\n+       expect(fixture.nativeElement.innerHTML).toContain('router-outlet');\n+       expect(fixture.nativeElement.innerHTML).not.toContain('simple');\n+     }));\n });\n \n function advance<T>(fixture: ComponentFixture<T>): void {"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 46,
        "deletions": 1
    }
}