{
    "author": "JoostK",
    "message": "refactor(compiler-cli): add script to update all golden partial files (#39989)\n\nThe golden files for the partial compliance tests need to be updated\nwith individual Bazel run invocations, which is not very ergonomic when\na large number of golden files need to updated. This commit adds a\nscript to query the Bazel targets that update the goldens and then runs\nthose targets sequentially.\n\nPR Close #39989",
    "sha": "3ec2807e38912fd875fa110ff51b09ca5fabaff3",
    "files": [
        {
            "sha": "0f63b497ed71994aaab320ac0212f594bc6ddfb8",
            "filename": "packages/compiler-cli/test/compliance/README.md",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/3ec2807e38912fd875fa110ff51b09ca5fabaff3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/3ec2807e38912fd875fa110ff51b09ca5fabaff3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md?ref=3ec2807e38912fd875fa110ff51b09ca5fabaff3",
            "patch": "@@ -185,6 +185,11 @@ bazel run //packages/compiler-cli/test/compliance/test_cases:<path/to/test_case>\n where to replace `<path/to/test_case>` with the path (relative to `test_cases`) of the directory\n that contains the `GOLDEN_PARTIAL.js` to update.\n \n+To update all golden partial files, the following command can be run:\n+\n+```sh\n+node packages/compiler-cli/test/compliance/update_all_goldens.js\n+```\n \n ## Debugging test-cases\n "
        },
        {
            "sha": "be56ef57d579f50d37dc0f9a7ad7c1b2528fb64b",
            "filename": "packages/compiler-cli/test/compliance/update_all_goldens.js",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/3ec2807e38912fd875fa110ff51b09ca5fabaff3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fupdate_all_goldens.js",
            "raw_url": "https://github.com/angular/angular/raw/3ec2807e38912fd875fa110ff51b09ca5fabaff3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fupdate_all_goldens.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fupdate_all_goldens.js?ref=3ec2807e38912fd875fa110ff51b09ca5fabaff3",
            "patch": "@@ -0,0 +1,35 @@\n+#!/usr/bin/env node\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// tslint:disable:no-console\n+const {exec} = require('shelljs');\n+\n+process.stdout.write('Gathering all partial golden update targets');\n+const queryCommand =\n+    `yarn -s bazel query --output label 'filter('golden.update', kind(nodejs_binary, //packages/compiler-cli/test/compliance/test_cases:*))'`;\n+const allUpdateTargets =\n+    exec(queryCommand, {silent: true}).trim().split('\\n').map(test => test.trim());\n+process.stdout.clearLine();\n+process.stdout.cursorTo(0);\n+\n+for (const [index, target] of allUpdateTargets.entries()) {\n+  const progress = `${index + 1} / ${allUpdateTargets.length}`;\n+  process.stdout.write(`[${progress}] Running: ${target}`);\n+  const commandResult = exec(`yarn -s bazel run ${target}`, {silent: true});\n+  process.stdout.clearLine();\n+  process.stdout.cursorTo(0);\n+  if (commandResult.code) {\n+    console.error(`[${progress}] Failed run: ${target}`);\n+    console.group();\n+    console.error(commandResult.stdout || commandResult.stderr);\n+    console.groupEnd();\n+  } else {\n+    console.log(`[${progress}] Successful run: ${target}`);\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 40,
        "deletions": 0
    }
}