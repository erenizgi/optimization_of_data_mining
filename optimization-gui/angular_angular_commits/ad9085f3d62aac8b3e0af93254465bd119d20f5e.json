{
    "author": "gkalpak",
    "message": "refactor(service-worker): move mock client classes to their own file (#42736)\n\nIn the ServiceWorker tests, we use mock implementations of the various\nclient APIs that the ServiceWorker interacts with. Previously, these\nmock implementations were defined in the `testing/scope.ts` file. This\nadded several extra classes to a file that already contains a few,\nmaking it harder to maintain.\n\nTherefore, this commit moves these mock client classes to a separate\n`testing/clients.ts` file.\n\nPR Close #42736",
    "sha": "ad9085f3d62aac8b3e0af93254465bd119d20f5e",
    "files": [
        {
            "sha": "c1bc37ac1f45782e912bac4048e5d5a7a8548baa",
            "filename": "packages/service-worker/worker/test/happy_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts?ref=ad9085f3d62aac8b3e0af93254465bd119d20f5e",
            "patch": "@@ -12,9 +12,10 @@ import {Driver, DriverReadyState} from '../src/driver';\n import {AssetGroupConfig, DataGroupConfig, Manifest} from '../src/manifest';\n import {sha1} from '../src/sha1';\n import {clearAllCaches, MockCache} from '../testing/cache';\n+import {WindowClientImpl} from '../testing/clients';\n import {MockRequest, MockResponse} from '../testing/fetch';\n import {MockFileSystem, MockFileSystemBuilder, MockServerState, MockServerStateBuilder, tmpHashTableForFs} from '../testing/mock';\n-import {MockClient, SwTestHarness, SwTestHarnessBuilder, WindowClientImpl} from '../testing/scope';\n+import {SwTestHarness, SwTestHarnessBuilder} from '../testing/scope';\n import {envIsSupported} from '../testing/utils';\n \n (function() {"
        },
        {
            "sha": "a525972ab7b53dc2fbbc6d8243ac61e02f58ecf2",
            "filename": "packages/service-worker/worker/testing/clients.ts",
            "status": "added",
            "additions": 77,
            "deletions": 0,
            "changes": 77,
            "blob_url": "https://github.com/angular/angular/blob/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftesting%2Fclients.ts",
            "raw_url": "https://github.com/angular/angular/raw/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftesting%2Fclients.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Fclients.ts?ref=ad9085f3d62aac8b3e0af93254465bd119d20f5e",
            "patch": "@@ -0,0 +1,77 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Subject} from 'rxjs';\n+\n+\n+export class MockClient {\n+  queue = new Subject<Object>();\n+\n+  constructor(readonly id: string) {}\n+\n+  readonly messages: Object[] = [];\n+\n+  postMessage(message: Object): void {\n+    this.messages.push(message);\n+    this.queue.next(message);\n+  }\n+}\n+\n+export class WindowClientImpl extends MockClient implements WindowClient {\n+  readonly ancestorOrigins: ReadonlyArray<string> = [];\n+  readonly focused: boolean = false;\n+  readonly visibilityState: VisibilityState = 'hidden';\n+  frameType: ClientFrameType = 'top-level';\n+  url = 'http://localhost/unique';\n+\n+  constructor(readonly id: string) {\n+    super(id);\n+  }\n+\n+  async focus(): Promise<WindowClient> {\n+    return this;\n+  }\n+\n+  async navigate(url: string): Promise<WindowClient|null> {\n+    return this;\n+  }\n+}\n+\n+export class MockClients implements Clients {\n+  private clients = new Map<string, MockClient>();\n+\n+  add(clientId: string): void {\n+    if (this.clients.has(clientId)) {\n+      return;\n+    }\n+    this.clients.set(clientId, new MockClient(clientId));\n+  }\n+\n+  remove(clientId: string): void {\n+    this.clients.delete(clientId);\n+  }\n+\n+  async get(id: string): Promise<Client> {\n+    return this.clients.get(id)! as any as Client;\n+  }\n+\n+  getMock(id: string): MockClient|undefined {\n+    return this.clients.get(id);\n+  }\n+\n+  async matchAll<T extends ClientQueryOptions>(options?: T):\n+      Promise<ReadonlyArray<T['type'] extends 'window'? WindowClient : Client>> {\n+    return Array.from(this.clients.values()) as any[];\n+  }\n+\n+  async openWindow(url: string): Promise<WindowClient|null> {\n+    return null;\n+  }\n+\n+  async claim(): Promise<any> {}\n+}"
        },
        {
            "sha": "ddf6dd9a317f5e4557556cab2cf1fdf403f895b4",
            "filename": "packages/service-worker/worker/testing/scope.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 66,
            "changes": 67,
            "blob_url": "https://github.com/angular/angular/blob/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "raw_url": "https://github.com/angular/angular/raw/ad9085f3d62aac8b3e0af93254465bd119d20f5e/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts?ref=ad9085f3d62aac8b3e0af93254465bd119d20f5e",
            "patch": "@@ -6,51 +6,19 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Subject} from 'rxjs';\n-\n import {Adapter} from '../src/adapter';\n import {AssetGroupConfig, Manifest} from '../src/manifest';\n import {sha1} from '../src/sha1';\n \n import {MockCacheStorage} from './cache';\n+import {MockClient, MockClients} from './clients';\n import {MockActivateEvent, MockExtendableMessageEvent, MockFetchEvent, MockInstallEvent, MockNotificationEvent, MockPushEvent} from './events';\n import {MockHeaders, MockRequest, MockResponse} from './fetch';\n import {MockServerState, MockServerStateBuilder} from './mock';\n import {normalizeUrl, parseUrl} from './utils';\n \n const EMPTY_SERVER_STATE = new MockServerStateBuilder().build();\n \n-export class MockClient {\n-  queue = new Subject<Object>();\n-\n-  constructor(readonly id: string) {}\n-\n-  readonly messages: Object[] = [];\n-\n-  postMessage(message: Object): void {\n-    this.messages.push(message);\n-    this.queue.next(message);\n-  }\n-}\n-export class WindowClientImpl extends MockClient implements WindowClient {\n-  readonly ancestorOrigins: ReadonlyArray<string> = [];\n-  readonly focused: boolean = false;\n-  readonly visibilityState: VisibilityState = 'hidden';\n-  frameType: ClientFrameType = 'top-level';\n-  url = 'http://localhost/unique';\n-\n-  constructor(readonly id: string) {\n-    super(id);\n-  }\n-\n-  async focus(): Promise<WindowClient> {\n-    return this;\n-  }\n-  async navigate(url: string): Promise<WindowClient|null> {\n-    return this;\n-  }\n-}\n-\n export class SwTestHarnessBuilder {\n   private origin = parseUrl(this.scopeUrl).origin;\n   private server = EMPTY_SERVER_STATE;\n@@ -73,39 +41,6 @@ export class SwTestHarnessBuilder {\n   }\n }\n \n-export class MockClients implements Clients {\n-  private clients = new Map<string, MockClient>();\n-\n-  add(clientId: string): void {\n-    if (this.clients.has(clientId)) {\n-      return;\n-    }\n-    this.clients.set(clientId, new MockClient(clientId));\n-  }\n-\n-  remove(clientId: string): void {\n-    this.clients.delete(clientId);\n-  }\n-\n-  async get(id: string): Promise<Client> {\n-    return this.clients.get(id)! as any as Client;\n-  }\n-\n-  getMock(id: string): MockClient|undefined {\n-    return this.clients.get(id);\n-  }\n-\n-  async matchAll<T extends ClientQueryOptions>(options?: T):\n-      Promise<ReadonlyArray<T['type'] extends 'window'? WindowClient : Client>> {\n-    return Array.from(this.clients.values()) as any[];\n-  }\n-  async openWindow(url: string): Promise<WindowClient|null> {\n-    return null;\n-  }\n-\n-  async claim(): Promise<any> {}\n-}\n-\n export class SwTestHarness extends Adapter<MockCacheStorage> implements ServiceWorkerGlobalScope {\n   readonly clients = new MockClients();\n   private eventHandlers = new Map<string, Function>();"
        }
    ],
    "stats": {
        "total": 147,
        "additions": 80,
        "deletions": 67
    }
}