{
    "author": "dylhunn",
    "message": "feat(forms): Allow a FormControl to use initial value as default. (#44434)\n\nAllow a FormControl to be reset to its initial value. Provide this feature via a new option in a FormControlOptions interface, based on AbstractControlOptions.\n\nAlso, expose the default value as part of the public API. This is part of a feature that has been requested elsewhere (e.g. in #19747).\n\nThis was originally proposed as part of typed forms. As discussed in the GDE session (and after with akushnir/alxhub), it is likely better to just reuse the initial value rather than accepting an additional default.\n\nIt is desirable to land this separately in order to reduce the scope of the typed forms PR, and make it a types-only change.\n\nPertains to issue #13721.\n\nPR Close #44434",
    "sha": "72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
    "files": [
        {
            "sha": "eaa76df8e884addfe3febc2307067210637c4c3f",
            "filename": "goldens/public-api/forms/forms.md",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "raw_url": "https://github.com/angular/angular/raw/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fforms%2Fforms.md?ref=72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
            "patch": "@@ -276,7 +276,7 @@ export class FormArrayName extends ControlContainer implements OnInit, OnDestroy\n // @public\n export class FormBuilder {\n     array(controlsConfig: any[], validatorOrOpts?: ValidatorFn | ValidatorFn[] | AbstractControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null): FormArray;\n-    control(formState: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | AbstractControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null): FormControl;\n+    control(formState: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | FormControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null): FormControl;\n     group(controlsConfig: {\n         [key: string]: any;\n     }, options?: AbstractControlOptions | null): FormGroup;\n@@ -294,7 +294,8 @@ export class FormBuilder {\n \n // @public\n export class FormControl extends AbstractControl {\n-    constructor(formState?: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | AbstractControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null);\n+    constructor(formState?: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | FormControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null);\n+    readonly defaultValue: any;\n     patchValue(value: any, options?: {\n         onlySelf?: boolean;\n         emitEvent?: boolean;\n@@ -361,6 +362,11 @@ export class FormControlName extends NgControl implements OnChanges, OnDestroy {\n     static ɵfac: i0.ɵɵFactoryDeclaration<FormControlName, [{ optional: true; host: true; skipSelf: true; }, { optional: true; self: true; }, { optional: true; self: true; }, { optional: true; self: true; }, { optional: true; }]>;\n }\n \n+// @public\n+export interface FormControlOptions extends AbstractControlOptions {\n+    initialValueIsDefault?: boolean;\n+}\n+\n // @public\n export type FormControlStatus = 'VALID' | 'INVALID' | 'PENDING' | 'DISABLED';\n "
        },
        {
            "sha": "817d14f52e1a7bf8d35225d2fce0079ec3ae4d7f",
            "filename": "packages/forms/src/form_builder.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fform_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fform_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fform_builder.ts?ref=72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
            "patch": "@@ -10,7 +10,7 @@ import {Injectable} from '@angular/core';\n \n import {AsyncValidatorFn, ValidatorFn} from './directives/validators';\n import {ReactiveFormsModule} from './form_providers';\n-import {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormGroup, FormHooks} from './model';\n+import {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlOptions, FormGroup, FormHooks} from './model';\n \n function isAbstractControlOptions(options: AbstractControlOptions|\n                                   {[key: string]: any}): options is AbstractControlOptions {\n@@ -127,7 +127,7 @@ export class FormBuilder {\n    * </code-example>\n    */\n   control(\n-      formState: any, validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|null,\n+      formState: any, validatorOrOpts?: ValidatorFn|ValidatorFn[]|FormControlOptions|null,\n       asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null): FormControl {\n     return new FormControl(formState, validatorOrOpts, asyncValidator);\n   }"
        },
        {
            "sha": "326b9621c2808852bcadb26893f903d28122ca59",
            "filename": "packages/forms/src/forms.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fforms.ts",
            "raw_url": "https://github.com/angular/angular/raw/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fforms.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fforms.ts?ref=72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
            "patch": "@@ -43,7 +43,7 @@ export {NgSelectOption, SelectControlValueAccessor} from './directives/select_co\n export {SelectMultipleControlValueAccessor, ɵNgSelectMultipleOption} from './directives/select_multiple_control_value_accessor';\n export {AsyncValidator, AsyncValidatorFn, CheckboxRequiredValidator, EmailValidator, MaxLengthValidator, MaxValidator, MinLengthValidator, MinValidator, PatternValidator, RequiredValidator, ValidationErrors, Validator, ValidatorFn} from './directives/validators';\n export {FormBuilder} from './form_builder';\n-export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlStatus, FormGroup} from './model';\n+export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlOptions, FormControlStatus, FormGroup} from './model';\n export {NG_ASYNC_VALIDATORS, NG_VALIDATORS, Validators} from './validators';\n export {VERSION} from './version';\n "
        },
        {
            "sha": "9ae55af2f7c0d85d6adc6571d5f113c5fe5202ea",
            "filename": "packages/forms/src/model.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 7,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "raw_url": "https://github.com/angular/angular/raw/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fmodel.ts?ref=72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
            "patch": "@@ -146,6 +146,25 @@ export interface AbstractControlOptions {\n   updateOn?: 'change'|'blur'|'submit';\n }\n \n+/**\n+ * Interface for options provided to a {@link FormControl}.\n+ *\n+ * This interface extends all options from {@link AbstractControlOptions}, plus some options\n+ * unique to `FormControl`.\n+ *\n+ * @publicApi\n+ */\n+export interface FormControlOptions extends AbstractControlOptions {\n+  /**\n+   * @description\n+   * Whether to use the initial value used to construct the FormControl as its default value as\n+   * well. If this option is false or not provided, the default value of a FormControl is `null`.\n+   * When a FormControl is {@link FormControl#reset} without an explicit value, its value reverts to\n+   * its default value.\n+   */\n+  initialValueIsDefault?: boolean;\n+}\n+\n function isOptionsObj(validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|\n                       null): validatorOrOpts is AbstractControlOptions {\n   return validatorOrOpts != null && !Array.isArray(validatorOrOpts) &&\n@@ -1228,10 +1247,17 @@ export abstract class AbstractControl {\n  * @publicApi\n  */\n export class FormControl extends AbstractControl {\n+  /**\n+   * The default value of this FormControl, used whenever the control is reset without an explicit\n+   * value. See {@link FormControlOptions#initialValueIsDefault} for more information on configuring\n+   * a default value.\n+   * @publicApi\n+   */\n+  public readonly defaultValue: any = null;\n+\n   /** @internal */\n   _onChange: Array<Function> = [];\n \n-\n   /**\n    * This field holds a pending value that has not yet been applied to the form's value.\n    * It is `any` because the value is untyped.\n@@ -1256,8 +1282,7 @@ export class FormControl extends AbstractControl {\n    *\n    */\n   constructor(\n-      formState: any = null,\n-      validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|null,\n+      formState: any = null, validatorOrOpts?: ValidatorFn|ValidatorFn[]|FormControlOptions|null,\n       asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null) {\n     super(pickValidators(validatorOrOpts), pickAsyncValidators(asyncValidator, validatorOrOpts));\n     this._applyFormState(formState);\n@@ -1271,6 +1296,13 @@ export class FormControl extends AbstractControl {\n       // to `true` to allow that during the control creation process.\n       emitEvent: !!this.asyncValidator\n     });\n+    if (isOptionsObj(validatorOrOpts) && validatorOrOpts.initialValueIsDefault) {\n+      if (this._isBoxedValue(formState)) {\n+        this.defaultValue = formState.value;\n+      } else {\n+        this.defaultValue = formState;\n+      }\n+    }\n   }\n \n   /**\n@@ -1329,8 +1361,23 @@ export class FormControl extends AbstractControl {\n   }\n \n   /**\n-   * Resets the form control, marking it `pristine` and `untouched`, and setting\n-   * the value to null.\n+   * Resets the form control, marking it `pristine` and `untouched`, and resetting\n+   * the value. The new value will be the provided value (if passed), `null`, or the initial value\n+   * if `initialValueIsDefault` was set in the constructor via {@link FormControlOptions}.\n+   *\n+   * ```ts\n+   * // By default, the control will reset to null.\n+   * const dog = new FormControl('spot');\n+   * dog.reset(); // dog.value is null\n+   *\n+   * // If this flag is set, the control will instead reset to the initial value.\n+   * const cat = new FormControl('tabby', {initialValueIsDefault: true});\n+   * cat.reset(); // cat.value is \"tabby\"\n+   *\n+   * // A value passed to reset always takes precedence.\n+   * const fish = new FormControl('finn', {initialValueIsDefault: true});\n+   * fish.reset('bubble'); // fish.value is \"bubble\"\n+   * ```\n    *\n    * @param formState Resets the control with an initial value,\n    * or an object that defines the initial value and disabled state.\n@@ -1346,8 +1393,10 @@ export class FormControl extends AbstractControl {\n    * When false, no events are emitted.\n    *\n    */\n-  override reset(formState: any = null, options: {onlySelf?: boolean, emitEvent?: boolean} = {}):\n-      void {\n+  override reset(formState: any = this.defaultValue, options: {\n+    onlySelf?: boolean,\n+    emitEvent?: boolean\n+  } = {}): void {\n     this._applyFormState(formState);\n     this.markAsPristine(options);\n     this.markAsUntouched(options);"
        },
        {
            "sha": "1f880cbacb60079d92f30a622fe5ca8fab8b2f1a",
            "filename": "packages/forms/test/form_control_spec.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72092ebd26d6670a7dd02f6db5515d2afd27c4d6/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_control_spec.ts?ref=72092ebd26d6670a7dd02f6db5515d2afd27c4d6",
            "patch": "@@ -817,6 +817,62 @@ describe('FormControl', () => {\n       expect(c.value).toBe(null);\n     });\n \n+    it('should reset to the initial value if specified in FormControlOptions', () => {\n+      const c2 = new FormControl('foo', {initialValueIsDefault: true});\n+      expect(c2.value).toBe('foo');\n+      expect(c2.defaultValue).toBe('foo');\n+\n+      c2.setValue('bar');\n+      expect(c2.value).toBe('bar');\n+      expect(c2.defaultValue).toBe('foo');\n+\n+      c2.reset();\n+      expect(c2.value).toBe('foo');\n+      expect(c2.defaultValue).toBe('foo');\n+\n+      const c3 = new FormControl('foo', {initialValueIsDefault: false});\n+      expect(c3.value).toBe('foo');\n+      expect(c3.defaultValue).toBe(null);\n+\n+      c3.setValue('bar');\n+      expect(c3.value).toBe('bar');\n+      expect(c3.defaultValue).toBe(null);\n+\n+      c3.reset();\n+      expect(c3.value).toBe(null);\n+      expect(c3.defaultValue).toBe(null);\n+    });\n+\n+    it('should look inside FormState objects for a default value', () => {\n+      const c2 = new FormControl({value: 'foo', disabled: false}, {initialValueIsDefault: true});\n+      expect(c2.value).toBe('foo');\n+      expect(c2.defaultValue).toBe('foo');\n+\n+      c2.setValue('bar');\n+      expect(c2.value).toBe('bar');\n+      expect(c2.defaultValue).toBe('foo');\n+\n+      c2.reset();\n+      expect(c2.value).toBe('foo');\n+      expect(c2.defaultValue).toBe('foo');\n+    });\n+\n+    it('should not alter the disabled state when resetting, even if a default value is provided',\n+       () => {\n+         const c2 = new FormControl({value: 'foo', disabled: true}, {initialValueIsDefault: true});\n+         expect(c2.value).toBe('foo');\n+         expect(c2.defaultValue).toBe('foo');\n+         expect(c2.disabled).toBe(true);\n+\n+         c2.setValue('bar');\n+         c2.enable();\n+\n+         c2.reset();\n+         expect(c2.value).toBe('foo');\n+         expect(c2.defaultValue).toBe('foo');\n+         expect(c2.disabled).toBe(false);\n+       });\n+\n     it('should update the value of any parent controls with passed value', () => {\n       const g = new FormGroup({'one': c});\n       c.setValue('new value');"
        }
    ],
    "stats": {
        "total": 135,
        "additions": 123,
        "deletions": 12
    }
}