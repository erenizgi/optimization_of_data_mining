{
    "author": "dgp1130",
    "message": "feat(compiler-cli): enable extended diagnostics by default (#44712)\n\nRefs #42966.\n\nExtended diagnostics provide additional analysis about Angular templates by emitting warnings for specific patterns known to be error prone or cause developer confusion. Currently, there are two such diagnostics which are enabled by default:\n\n* `invalidBananaInBox` emits a warning if a user writes a two-way binding backwards like `([foo])=\"bar\"`, when they actually wanted `[(foo)]=\"bar\"`.\n* `nullishCoalescingNotNullable` emits a warning if a binding attempts to perform nullish coalescing (`??`) on a type which does not include `null` or `undefined`, such as `{{ foo ?? 'bar' }}` where `foo` is defined as `string` instead of `string | null`.\n\nThese diagnostics are enabled as warnings by default, but this can be configured in the `tsconfig.json` like so:\n\n```jsonc\n{\n  \"angularCompilerOptions\": {\n    \"extendedDiagnostics\": {\n      // The categories to use for specific diagnostics.\n      \"checks\": {\n        // Maps check name to its category.\n        \"invalidBananaInBox\": \"suppress\"\n      },\n\n      // The category to use for any diagnostics not listed in `checks` above.\n      \"defaultCategory\": \"error\"\n    }\n  }\n}\n```\n\nAllowed categories for a diagnostic are `warning` (default), `error`, or `suppress`. `warning` emits the diagnostic but allows the compilation to succeed, `error` *will* fail the compilation, while `suppress` will ignore the diagnostic altogether.\n\nThe initial release has two diagnostics, and we are hoping to expand this longer term to add more diagnostics and provide additional insight into Angular templates to detect and surface developer mistakes *before* hours of debugging are wasted.\n\nPR Close #44712",
    "sha": "fa835b5a297087087eac2750b662096ed5492cb6",
    "files": [
        {
            "sha": "b7f5a18f837b8135f10c0586ecaa5479e8281881",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/fa835b5a297087087eac2750b662096ed5492cb6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/fa835b5a297087087eac2750b662096ed5492cb6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=fa835b5a297087087eac2750b662096ed5492cb6",
            "patch": "@@ -430,7 +430,7 @@ export class NgCompiler {\n   getDiagnostics(): ts.Diagnostic[] {\n     const diagnostics: ts.Diagnostic[] = [];\n     diagnostics.push(...this.getNonTemplateDiagnostics(), ...this.getTemplateDiagnostics());\n-    if (this.options._extendedTemplateDiagnostics) {\n+    if (this.options.strictTemplates) {\n       diagnostics.push(...this.getExtendedTemplateDiagnostics());\n     }\n     return this.addMessageTextDetails(diagnostics);"
        },
        {
            "sha": "fa34ae1560f4852884ccccab90626004a52d247a",
            "filename": "packages/compiler-cli/test/ngtsc/extended_template_diagnostics_spec.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 23,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/fa835b5a297087087eac2750b662096ed5492cb6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fa835b5a297087087eac2750b662096ed5492cb6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts?ref=fa835b5a297087087eac2750b662096ed5492cb6",
            "patch": "@@ -22,7 +22,7 @@ runInEachFileSystem(() => {\n \n     beforeEach(() => {\n       env = NgtscTestEnvironment.setup(testFiles);\n-      env.tsconfig({_extendedTemplateDiagnostics: true, strictTemplates: true});\n+      env.tsconfig({strictTemplates: true});\n     });\n \n     it('should produce invalid banana in box warning', () => {\n@@ -67,23 +67,6 @@ runInEachFileSystem(() => {\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('([notARealThing])=\"bar\"');\n     });\n \n-    it('should not produce extended diagnostics if flag is disabled', () => {\n-      env.tsconfig({_extendedTemplateDiagnostics: false});\n-      env.write('test.ts', `\n-              import {Component} from '@angular/core';\n-              @Component({\n-                selector: 'test',\n-                template: '<div ([notARealThing])=\"bar\"></div>',\n-              })\n-              class TestCmp {\n-                bar: string = \"text\";\n-              }\n-            `);\n-\n-      const diags = env.driveDiagnostics();\n-      expect(diags.length).toBe(0);\n-    });\n-\n     it('should throw error if _extendedTemplateDiagnostics option is enabled and strictTemplates disabled',\n        () => {\n          env.tsconfig({_extendedTemplateDiagnostics: true, strictTemplates: false});\n@@ -139,10 +122,31 @@ runInEachFileSystem(() => {\n         }\n       `;\n \n+      it('by enabling extended template diagnostics when `strictTemplates` is enabled', () => {\n+        env.tsconfig({strictTemplates: true});\n+\n+        env.write('test.ts', warningComponent);\n+\n+        const diagnostics = env.driveDiagnostics(0 /* expectedExitCode */);\n+        expect(diagnostics.length).toBe(1);\n+        expect(diagnostics[0]).toEqual(jasmine.objectContaining({\n+          code: ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX),\n+          category: ts.DiagnosticCategory.Warning,\n+        }));\n+      });\n+\n+      it('by disabling extended template diagnostics when `strictTemplates` is disabled', () => {\n+        env.tsconfig({strictTemplates: false});\n+\n+        env.write('test.ts', warningComponent);\n+\n+        const diagnostics = env.driveDiagnostics(0 /* expectedExitCode */);\n+        expect(diagnostics).toEqual([]);\n+      });\n+\n       it('by emitting unconfigured diagnostics as is', () => {\n         env.tsconfig({\n           strictTemplates: true,\n-          _extendedTemplateDiagnostics: true,\n           extendedDiagnostics: {},  // No configured diagnostics.\n         });\n \n@@ -159,7 +163,6 @@ runInEachFileSystem(() => {\n       it('by emitting diagnostics with the default category', () => {\n         env.tsconfig({\n           strictTemplates: true,\n-          _extendedTemplateDiagnostics: true,\n           extendedDiagnostics: {\n             defaultCategory: 'error',\n           },\n@@ -178,7 +181,6 @@ runInEachFileSystem(() => {\n       it('by emitting diagnostics configured as `warning`', () => {\n         env.tsconfig({\n           strictTemplates: true,\n-          _extendedTemplateDiagnostics: true,\n           extendedDiagnostics: {\n             checks: {\n               invalidBananaInBox: 'warning',\n@@ -199,7 +201,6 @@ runInEachFileSystem(() => {\n       it('by promoting diagnostics configured as `error`', () => {\n         env.tsconfig({\n           strictTemplates: true,\n-          _extendedTemplateDiagnostics: true,\n           extendedDiagnostics: {\n             checks: {\n               invalidBananaInBox: 'error',\n@@ -220,7 +221,6 @@ runInEachFileSystem(() => {\n       it('by suppressing diagnostics configured as `suppress`', () => {\n         env.tsconfig({\n           strictTemplates: true,\n-          _extendedTemplateDiagnostics: true,\n           extendedDiagnostics: {\n             checks: {\n               invalidBananaInBox: 'suppress',"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 24,
        "deletions": 24
    }
}