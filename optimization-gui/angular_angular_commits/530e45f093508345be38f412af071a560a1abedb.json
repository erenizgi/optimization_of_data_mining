{
    "author": "devversion",
    "message": "fix(dev-infra): publish script python check not working on windows (#41943)\n\nWe recently added a sanity check that ensures that `python` is\navailable for Bazel. The check relies on `/usr/bin/python` to check\nif python is available w/ the correct version. The problem is\nthat on Windows there is no guarantee that the `/usr/bin` folder\nexists, so the `ng-dev release publish` command always fails.\n\nWe fix this by just accessing the `env` binary that is also consulted\nby scripts executed within Bazel actions. The `env` binary can be\nassumed exist in the shell's `$PATH` and can point us to Python\nas if it would be executed within Bazel.\n\nPR Close #41943",
    "sha": "530e45f093508345be38f412af071a560a1abedb",
    "files": [
        {
            "sha": "e24281c5ef6345cb28f64e99408b288c98411b63",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/530e45f093508345be38f412af071a560a1abedb/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/530e45f093508345be38f412af071a560a1abedb/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=530e45f093508345be38f412af071a560a1abedb",
            "patch": "@@ -6772,16 +6772,16 @@ class ReleaseTool {\n         });\n     }\n     /**\n-     * Verifies the current environment contains /usr/bin/python which points to the Python3\n-     * interpreter.  python is required by our tooling in bazel as it contains scripts setting\n-     * `#! /usr/bin/env python`.\n-     *\n+     * Verifies that Python can be resolved within scripts and points to a compatible version. Python\n+     * is required in Bazel actions as there can be tools (such as `skydoc`) that rely on it.\n      * @returns a boolean indicating success or failure.\n      */\n     _verifyEnvironmentHasPython3Symlink() {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             try {\n-                const pyVersion = yield spawnWithDebugOutput('/usr/bin/python', ['--version'], { mode: 'silent' });\n+                // Note: We do not rely on `/usr/bin/env` but rather access the `env` binary directly as it\n+                // should be part of the shell's `$PATH`. This is necessary for compatibility with Windows.\n+                const pyVersion = yield spawnWithDebugOutput('env', ['python', '--version'], { mode: 'silent' });\n                 const version = pyVersion.stdout.trim() || pyVersion.stderr.trim();\n                 if (version.startsWith('Python 3.')) {\n                     debug(`Local python version: ${version}`);"
        },
        {
            "sha": "061d7f5aab165f01d6b1c27c1af6a7ea75b0512d",
            "filename": "dev-infra/release/publish/index.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/530e45f093508345be38f412af071a560a1abedb/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/530e45f093508345be38f412af071a560a1abedb/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Findex.ts?ref=530e45f093508345be38f412af071a560a1abedb",
            "patch": "@@ -130,16 +130,16 @@ export class ReleaseTool {\n   }\n \n   /**\n-   * Verifies the current environment contains /usr/bin/python which points to the Python3\n-   * interpreter.  python is required by our tooling in bazel as it contains scripts setting\n-   * `#! /usr/bin/env python`.\n-   *\n+   * Verifies that Python can be resolved within scripts and points to a compatible version. Python\n+   * is required in Bazel actions as there can be tools (such as `skydoc`) that rely on it.\n    * @returns a boolean indicating success or failure.\n    */\n   private async _verifyEnvironmentHasPython3Symlink(): Promise<boolean> {\n     try {\n+      // Note: We do not rely on `/usr/bin/env` but rather access the `env` binary directly as it\n+      // should be part of the shell's `$PATH`. This is necessary for compatibility with Windows.\n       const pyVersion =\n-          await spawnWithDebugOutput('/usr/bin/python', ['--version'], {mode: 'silent'});\n+          await spawnWithDebugOutput('env', ['python', '--version'], {mode: 'silent'});\n       const version = pyVersion.stdout.trim() || pyVersion.stderr.trim();\n       if (version.startsWith('Python 3.')) {\n         debug(`Local python version: ${version}`);"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 10,
        "deletions": 10
    }
}