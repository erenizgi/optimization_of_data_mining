{
    "author": "josephperrott",
    "message": "feat(dev-infra): add utility method to GitClient to get latest SemVer tag (#41455)\n\nCreate a utility method for the latest git tag, sorted by committerdate, which\nmatches SemVer, representing the latest version released on the branch.\n\nPR Close #41455",
    "sha": "ba3344ddbe2d3cc8fcd81c704b187544eabb78e5",
    "files": [
        {
            "sha": "5ca940bbd624749a3d6f82714f0510a14a43f70e",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=ba3344ddbe2d3cc8fcd81c704b187544eabb78e5",
            "patch": "@@ -12,11 +12,11 @@ var path = require('path');\n var shelljs = require('shelljs');\n var url = require('url');\n var child_process = require('child_process');\n+var semver = require('semver');\n var graphql = require('@octokit/graphql');\n var Octokit = require('@octokit/rest');\n var typedGraphqlify = require('typed-graphqlify');\n var fetch = _interopDefault(require('node-fetch'));\n-var semver = require('semver');\n var multimatch = require('multimatch');\n var yaml = require('yaml');\n var conventionalCommitsParser = require('conventional-commits-parser');\n@@ -704,6 +704,16 @@ var GitClient = /** @class */ (function () {\n         }\n         return this.runGraceful(['checkout', branchOrRevision], { stdio: 'ignore' }).status === 0;\n     };\n+    /** Gets the latest git tag on the current branch that matches SemVer. */\n+    GitClient.prototype.getLatestSemverTag = function () {\n+        var semVerOptions = { loose: true };\n+        var tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n+        var latestTag = tags.find(function (tag) { return semver.parse(tag, semVerOptions); });\n+        if (latestTag === undefined) {\n+            throw new Error(\"Unable to find a SemVer matching tag on \\\"\" + this.getCurrentBranchOrRevision() + \"\\\"\");\n+        }\n+        return new semver.SemVer(latestTag, semVerOptions);\n+    };\n     /**\n      * Assert the GitClient instance is using a token with permissions for the all of the\n      * provided OAuth scopes."
        },
        {
            "sha": "2be6504dc0561612164a006aed922b519f8a7fb3",
            "filename": "dev-infra/utils/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Futils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Futils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2FBUILD.bazel?ref=ba3344ddbe2d3cc8fcd81c704b187544eabb78e5",
            "patch": "@@ -17,10 +17,12 @@ ts_library(\n         \"@npm//@octokit/types\",\n         \"@npm//@types/inquirer\",\n         \"@npm//@types/node\",\n+        \"@npm//@types/semver\",\n         \"@npm//@types/shelljs\",\n         \"@npm//@types/yargs\",\n         \"@npm//chalk\",\n         \"@npm//inquirer\",\n+        \"@npm//semver\",\n         \"@npm//shelljs\",\n         \"@npm//tslib\",\n         \"@npm//typed-graphqlify\","
        },
        {
            "sha": "e47b39aaa958ad65d36cd3e2a5906c8a11005be1",
            "filename": "dev-infra/utils/git/index.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Futils%2Fgit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/ba3344ddbe2d3cc8fcd81c704b187544eabb78e5/dev-infra%2Futils%2Fgit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Findex.ts?ref=ba3344ddbe2d3cc8fcd81c704b187544eabb78e5",
            "patch": "@@ -8,6 +8,7 @@\n \n import * as Octokit from '@octokit/rest';\n import {spawnSync, SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n+import {Options as SemVerOptions, parse, SemVer} from 'semver';\n \n import {getConfig, getRepoBaseDir, NgDevConfig} from '../config';\n import {debug, info, yellow} from '../console';\n@@ -181,6 +182,19 @@ export class GitClient {\n     return this.runGraceful(['checkout', branchOrRevision], {stdio: 'ignore'}).status === 0;\n   }\n \n+  /** Gets the latest git tag on the current branch that matches SemVer. */\n+  getLatestSemverTag(): SemVer {\n+    const semVerOptions: SemVerOptions = {loose: true};\n+    const tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n+    const latestTag = tags.find((tag: string) => parse(tag, semVerOptions));\n+\n+    if (latestTag === undefined) {\n+      throw new Error(\n+          `Unable to find a SemVer matching tag on \"${this.getCurrentBranchOrRevision()}\"`);\n+    }\n+    return new SemVer(latestTag, semVerOptions);\n+  }\n+\n   /**\n    * Assert the GitClient instance is using a token with permissions for the all of the\n    * provided OAuth scopes."
        }
    ],
    "stats": {
        "total": 28,
        "additions": 27,
        "deletions": 1
    }
}