{
    "author": "prashanttholia",
    "message": "feat(common): Add ISO week-numbering year formats support to formatDate (#38828)\n\nAdd ISO 8601 week-numbering year formats ('r', 'rr', 'rrr', 'rrrr') support for formatDate function.\n\nIssue:https://github.com/angular/angular/issues/38739\n\nPR Close #38828",
    "sha": "984ed39195d8291f0da0c2747a45761144e6daa2",
    "files": [
        {
            "sha": "5d4c704510162d7f665196336f888fd45f7cecb7",
            "filename": "packages/common/src/i18n/format_date.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 1,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "raw_url": "https://github.com/angular/angular/raw/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts?ref=984ed39195d8291f0da0c2747a45761144e6daa2",
            "patch": "@@ -13,7 +13,7 @@ export const ISO8601_DATE_REGEX =\n //    1        2       3         4          5          6          7          8  9     10      11\n const NAMED_FORMATS: {[localeId: string]: {[format: string]: string}} = {};\n const DATE_FORMATS_SPLIT =\n-    /((?:[^GyMLwWdEabBhHmsSzZO']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\\s\\S]*)/;\n+    /((?:[^GyrMLwWdEabBhHmsSzZO']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|r{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\\s\\S]*)/;\n \n enum ZoneWidth {\n   Short,\n@@ -394,6 +394,18 @@ function weekGetter(size: number, monthBased = false): DateFormatter {\n   };\n }\n \n+/**\n+ * Returns a date formatter that provides the week-numbering year for the input date.\n+ */\n+function weekNumberingYearGetter(size: number, trim = false): DateFormatter {\n+  return function(date: Date, locale: string) {\n+    const thisThurs = getThursdayThisWeek(date);\n+    const weekNumberingYear = thisThurs.getFullYear();\n+    return padNumber(\n+        weekNumberingYear, size, getLocaleNumberSymbol(locale, NumberSymbol.MinusSign), trim);\n+  };\n+}\n+\n type DateFormatter = (date: Date, locale: string, offset: number) => string;\n \n const DATE_FORMATS: {[format: string]: DateFormatter} = {};\n@@ -438,6 +450,25 @@ function getDateFormatter(format: string): DateFormatter|null {\n       formatter = dateGetter(DateType.FullYear, 4, 0, false, true);\n       break;\n \n+    // 1 digit representation of the week-numbering year, e.g. (AD 1 => 1, AD 199 => 199)\n+    case 'r':\n+      formatter = weekNumberingYearGetter(1);\n+      break;\n+    // 2 digit representation of the week-numbering year, padded (00-99). (e.g. AD 2001 => 01, AD\n+    // 2010 => 10)\n+    case 'rr':\n+      formatter = weekNumberingYearGetter(2, true);\n+      break;\n+    // 3 digit representation of the week-numbering year, padded (000-999). (e.g. AD 1 => 001, AD\n+    // 2010 => 2010)\n+    case 'rrr':\n+      formatter = weekNumberingYearGetter(3);\n+      break;\n+    // 4 digit representation of the week-numbering year (e.g. AD 1 => 0001, AD 2010 => 2010)\n+    case 'rrrr':\n+      formatter = weekNumberingYearGetter(4);\n+      break;\n+\n     // Month of the year (1-12), numeric\n     case 'M':\n     case 'L':"
        },
        {
            "sha": "bd9236c8659135bda917d98b6b7b2c391e72000a",
            "filename": "packages/common/src/pipes/date_pipe.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts?ref=984ed39195d8291f0da0c2747a45761144e6daa2",
            "patch": "@@ -65,6 +65,10 @@ import {invalidPipeArgumentError} from './invalid_pipe_argument_error';\n  *  |                    | yy          | Numeric: 2 digits + zero padded                               | 02, 20, 01, 17, 73                                         |\n  *  |                    | yyy         | Numeric: 3 digits + zero padded                               | 002, 020, 201, 2017, 20173                                 |\n  *  |                    | yyyy        | Numeric: 4 digits or more + zero padded                       | 0002, 0020, 0201, 2017, 20173                              |\n+ *  | Week-numbering year| r           | Numeric: minimum digits                                       | 2, 20, 201, 2017, 20173                                    |\n+ *  |                    | rr          | Numeric: 2 digits + zero padded                               | 02, 20, 01, 17, 73                                         |\n+ *  |                    | rrr         | Numeric: 3 digits + zero padded                               | 002, 020, 201, 2017, 20173                                 |\n+ *  |                    | rrrr        | Numeric: 4 digits or more + zero padded                       | 0002, 0020, 0201, 2017, 20173                              |\n  *  | Month              | M           | Numeric: 1 digit                                              | 9, 12                                                      |\n  *  |                    | MM          | Numeric: 2 digits + zero padded                               | 09, 12                                                     |\n  *  |                    | MMM         | Abbreviated                                                   | Sep                                                        |"
        },
        {
            "sha": "2a9cabf6ad78f8088c727f9d674e137f31eef06b",
            "filename": "packages/common/test/i18n/format_date_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Ftest%2Fi18n%2Fformat_date_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/984ed39195d8291f0da0c2747a45761144e6daa2/packages%2Fcommon%2Ftest%2Fi18n%2Fformat_date_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fi18n%2Fformat_date_spec.ts?ref=984ed39195d8291f0da0c2747a45761144e6daa2",
            "patch": "@@ -95,6 +95,10 @@ describe('Format date', () => {\n         yy: '15',\n         yyy: '2015',\n         yyyy: '2015',\n+        r: '2015',\n+        rr: '15',\n+        rrr: '2015',\n+        rrrr: '2015',\n         M: '6',\n         MM: '06',\n         MMM: 'Jun',\n@@ -153,6 +157,10 @@ describe('Format date', () => {\n         yy: '15',\n         yyy: '2015',\n         yyyy: '2015',\n+        r: '2015',\n+        rr: '15',\n+        rrr: '2015',\n+        rrrr: '2015',\n         M: '1',\n         MM: '01',\n         MMM: 'Jan',\n@@ -361,5 +369,14 @@ describe('Format date', () => {\n       expect(formatDate(3001, 'm:ss.SS', 'en')).toEqual('0:03.00');\n       expect(formatDate(3001, 'm:ss.SSS', 'en')).toEqual('0:03.001');\n     });\n+\n+    // https://github.com/angular/angular/issues/38739\n+    it('should return correct ISO 8601 week-numbering year for dates close to year end/beginning',\n+       () => {\n+         expect(formatDate('2013-12-27', 'rrrr', 'en')).toEqual('2013');\n+         expect(formatDate('2013-12-29', 'rrrr', 'en')).toEqual('2014');\n+         expect(formatDate('2010-01-02', 'rrrr', 'en')).toEqual('2009');\n+         expect(formatDate('2010-01-04', 'rrrr', 'en')).toEqual('2010');\n+       });\n   });\n });"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 53,
        "deletions": 1
    }
}