{
    "author": "devversion",
    "message": "build: update build scripts to no longer build View Engine output (#43431)\n\nRemoves View Engine compilation from the package builder script. For\nv13, we can no longer ship View Engine packages.\n\nPR Close #43431",
    "sha": "fcd958dd9fb6ee0de71903beec67a966d0141d3c",
    "files": [
        {
            "sha": "3ef3e5ac5d5bb18643358a15543674775ba1a215",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 1,
            "deletions": 24,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/fcd958dd9fb6ee0de71903beec67a966d0141d3c/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/fcd958dd9fb6ee0de71903beec67a966d0141d3c/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=fcd958dd9fb6ee0de71903beec67a966d0141d3c",
            "patch": "@@ -39,8 +39,7 @@ var_4_win: &cache_key_win_fallback v1-angular-win-node-14-{{ checksum \"month.txt\n var_5: &components_repo_unit_tests_cache_key v1-angular-components-{{ checksum \"month.txt\" }}-d090617912da8e70aa336aa5b4d804b1b535402e\n var_6: &components_repo_unit_tests_cache_key_fallback v1-angular-components-{{ checksum \"month.txt\" }}\n \n-# Workspace initially persisted by the `setup` job, and then enhanced by `build-npm-packages` and\n-# `build-ivy-npm-packages`.\n+# Workspace initially persisted by the `setup` job, and then enhanced by `build-npm-packages`.\n # https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs\n # https://circleci.com/blog/deep-diving-into-circleci-workspaces/\n var_7: &workspace_location ~/\n@@ -543,24 +542,6 @@ jobs:\n             - ~/bazel_repository_cache\n             - ~/.cache/bazelisk\n \n-  # Build the ivy npm packages.\n-  build-ivy-npm-packages:\n-    executor:\n-      name: default-executor\n-      resource_class: xlarge\n-    steps:\n-      - custom_attach_workspace\n-      - init_environment\n-      - run: node scripts/build/build-ivy-npm-packages.js\n-\n-      # Save the npm packages from //packages/... for other workflow jobs to read\n-      - persist_to_workspace:\n-          root: *workspace_location\n-          paths:\n-            - ng/dist/packages-dist-ivy-aot\n-            - ng/dist/angular-in-memory-web-api-dist-ivy-aot\n-            - ng/dist/zone.js-dist-ivy-aot\n-\n   # This job creates compressed tarballs (`.tgz` files) for all Angular packages and stores them as\n   # build artifacts. This makes it easy to try out changes from a PR build for testing purposes.\n   # More info CircleCI build artifacts: https://circleci.com/docs/2.0/artifacts\n@@ -848,9 +829,6 @@ workflows:\n       - build-npm-packages:\n           requires:\n             - setup\n-      - build-ivy-npm-packages:\n-          requires:\n-            - setup\n       - legacy-unit-tests-saucelabs:\n           requires:\n             - setup\n@@ -892,7 +870,6 @@ workflows:\n             # Get the artifacts to publish from the build-packages-dist job\n             # since the publishing script expects the legacy outputs layout.\n             - build-npm-packages\n-            - build-ivy-npm-packages\n             - legacy-unit-tests-saucelabs\n       - components-repo-unit-tests:\n           requires:"
        },
        {
            "sha": "323da56ef33a6d167985c41d0c4b346da5e96158",
            "filename": "scripts/build/angular-in-memory-web-api.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fangular-in-memory-web-api.js",
            "raw_url": "https://github.com/angular/angular/raw/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fangular-in-memory-web-api.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fangular-in-memory-web-api.js?ref=fcd958dd9fb6ee0de71903beec67a966d0141d3c",
            "patch": "@@ -34,7 +34,7 @@ function buildAngularInMemoryWebApiPackage(destDir) {\n   console.info(`${scriptPath}:`);\n   console.info('  Building angular-in-memory-web-api npm package');\n   console.info('##############################');\n-  exec(`${bazelCmd} build //packages/misc/angular-in-memory-web-api:npm_package`);\n+  exec(`${bazelCmd} build //packages/misc/angular-in-memory-web-api:npm_package --config=ivy`);\n \n   // Create the output directory.\n   const absDestDir = resolve(baseDir, destDir);"
        },
        {
            "sha": "64870240f9ffa9d09c917d1e3fa03a281407c29d",
            "filename": "scripts/build/build-ivy-npm-packages.js",
            "status": "removed",
            "additions": 0,
            "deletions": 37,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/7cba3f383426a7af83579fcf4866da0e07ece8e8/scripts%2Fbuild%2Fbuild-ivy-npm-packages.js",
            "raw_url": "https://github.com/angular/angular/raw/7cba3f383426a7af83579fcf4866da0e07ece8e8/scripts%2Fbuild%2Fbuild-ivy-npm-packages.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fbuild-ivy-npm-packages.js?ref=7cba3f383426a7af83579fcf4866da0e07ece8e8",
            "patch": "@@ -1,37 +0,0 @@\n-#!/usr/bin/env node\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-'use strict';\n-\n-const {buildAngularInMemoryWebApiPackage} = require('./angular-in-memory-web-api');\n-const {buildTargetPackages} = require('./package-builder');\n-const {buildZoneJsPackage} = require('./zone-js-builder');\n-\n-\n-// Build the ivy packages into `dist/packages-dist-ivy-aot/`.\n-buildTargetPackages('dist/packages-dist-ivy-aot', true, 'Ivy AOT');\n-\n-// Build the `angular-in-memory-web-api` npm package into\n-// `dist/angular-in-memory-web-api-dist-ivy-aot/`, because it might be needed by other\n-// scripts/targets.\n-//\n-// NOTE:\n-// The `-ivy-aot` suffix is only used to differentiate from the packages built by the\n-// `build-packages-dist.js` script, so that there is no conflict when persisting them to the\n-// workspace on CI.\n-buildAngularInMemoryWebApiPackage('dist/angular-in-memory-web-api-dist-ivy-aot');\n-\n-// Build the `zone.js` npm package into `dist/zone.js-dist-ivy-aot/`, because it might be needed by\n-// other scripts/tests.\n-//\n-// NOTE:\n-// The `-ivy-aot` suffix is only used to differentiate from the packages built by the\n-// `build-packages-dist.js` script, so that there is no conflict when persisting them to the\n-// workspace on CI.\n-buildZoneJsPackage('dist/zone.js-dist-ivy-aot');"
        },
        {
            "sha": "86575d509bb174f8a3086e655c6a4aa26c15a5eb",
            "filename": "scripts/build/build-packages-dist.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fbuild-packages-dist.js",
            "raw_url": "https://github.com/angular/angular/raw/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fbuild-packages-dist.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fbuild-packages-dist.js?ref=fcd958dd9fb6ee0de71903beec67a966d0141d3c",
            "patch": "@@ -15,7 +15,7 @@ const {buildZoneJsPackage} = require('./zone-js-builder');\n \n \n // Build the legacy (view engine) npm packages into `dist/packages-dist/`.\n-buildTargetPackages('dist/packages-dist', false, 'Production');\n+buildTargetPackages('dist/packages-dist', 'Production');\n \n // Build the `angular-in-memory-web-api` npm package into `dist/angular-in-memory-web-api-dist/`,\n // because it might be needed by other scripts/targets."
        },
        {
            "sha": "cd4105d3bc4b96f42df8a0cdc4e723069b0b7dea",
            "filename": "scripts/build/package-builder.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fpackage-builder.js",
            "raw_url": "https://github.com/angular/angular/raw/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fbuild%2Fpackage-builder.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fpackage-builder.js?ref=fcd958dd9fb6ee0de71903beec67a966d0141d3c",
            "patch": "@@ -60,12 +60,11 @@ module.exports = {\n  *\n  * @param {string} destDir Path to the output directory into which we copy the npm packages.\n  * This path should either be absolute or relative to the project root.\n- * @param {boolean} enableIvy True, if Ivy should be used.\n  * @param {string} description Human-readable description of the build.\n  * @param {boolean?} isRelease True, if the build should be stamped for a release.\n  * @returns {Array<{name: string, outputPath: string}} A list of packages built.\n  */\n-function buildTargetPackages(destDir, enableIvy, description, isRelease = false) {\n+function buildTargetPackages(destDir, description, isRelease = false) {\n   console.info('##################################');\n   console.info(`${scriptPath}:`);\n   console.info('  Building @angular/* npm packages');\n@@ -93,8 +92,8 @@ function buildTargetPackages(destDir, enableIvy, description, isRelease = false)\n \n   // Use either `--config=snapshot` or `--config=release` so that builds are created with the\n   // correct embedded version info.\n-  exec(`${bazelCmd} build --config=${isRelease ? 'release' : 'snapshot'} --config=${\n-      enableIvy ? 'ivy' : 'view-engine'} ${targets.join(' ')}`);\n+  exec(`${bazelCmd} build --config=${isRelease ? 'release' : 'snapshot'} --config=ivy ${\n+      targets.join(' ')}`);\n \n   // Create the output directory.\n   const absDestDir = resolve(baseDir, destDir);"
        },
        {
            "sha": "178daf6431ca91862feef3e1185e0c48a459b37d",
            "filename": "scripts/ci/publish-build-artifacts.sh",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fci%2Fpublish-build-artifacts.sh",
            "raw_url": "https://github.com/angular/angular/raw/fcd958dd9fb6ee0de71903beec67a966d0141d3c/scripts%2Fci%2Fpublish-build-artifacts.sh",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fci%2Fpublish-build-artifacts.sh?ref=fcd958dd9fb6ee0de71903beec67a966d0141d3c",
            "patch": "@@ -130,11 +130,6 @@ function publishAllBuilds() {\n   local latestTag=`getLatestTag`\n \n   publishPackages $GIT_SCHEME dist/packages-dist $CUR_BRANCH \"${latestTag}+${shortSha}\"\n-\n-  # don't publish ivy builds on non-master branch\n-  if [[ \"${CI_BRANCH-}\" == \"master\" ]]; then\n-    publishPackages $GIT_SCHEME dist/packages-dist-ivy-aot \"${CUR_BRANCH}-ivy-aot\" \"${latestTag}-ivy-aot+${shortSha}\"\n-  fi\n }\n \n # See docs/DEVELOPER.md for help"
        }
    ],
    "stats": {
        "total": 78,
        "additions": 6,
        "deletions": 72
    }
}