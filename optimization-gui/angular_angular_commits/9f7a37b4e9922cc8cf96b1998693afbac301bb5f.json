{
    "author": "josephperrott",
    "message": "feat(dev-infra): migrate to unified commit message types in commit message linting (#38430)\n\nPreviously commit message types were provided as part of the ng-dev config in the repository\nusing the ng-dev toolset.  This change removes this configuration expectation and instead\npredefines the valid types for commit messages.\n\nAdditionally, with this new unified set of types requirements around providing a scope have\nbeen put in place.  Scopes are either required, optional or forbidden for a given commit\ntype.\n\nPR Close #38430",
    "sha": "9f7a37b4e9922cc8cf96b1998693afbac301bb5f",
    "files": [
        {
            "sha": "9183e0c9ba41a827c1b0cdac231a1c0b1c8dbc80",
            "filename": "dev-infra/commit-message/config.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 1,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fconfig.ts?ref=9f7a37b4e9922cc8cf96b1998693afbac301bb5f",
            "patch": "@@ -12,7 +12,6 @@ export interface CommitMessageConfig {\n   maxLineLength: number;\n   minBodyLength: number;\n   minBodyLengthTypeExcludes?: string[];\n-  types: string[];\n   scopes: string[];\n }\n \n@@ -30,3 +29,46 @@ export function getCommitMessageConfig() {\n   assertNoErrors(errors);\n   return config as Required<typeof config>;\n }\n+\n+/** Scope requirement level to be set for each commit type.  */\n+export enum ScopeRequirement {\n+  Required,\n+  Optional,\n+  Forbidden,\n+}\n+\n+/** A commit type */\n+export interface CommitType {\n+  scope: ScopeRequirement;\n+}\n+\n+/** The valid commit types for Angular commit messages. */\n+export const COMMIT_TYPES: {[key: string]: CommitType} = {\n+  build: {\n+    scope: ScopeRequirement.Forbidden,\n+  },\n+  ci: {\n+    scope: ScopeRequirement.Forbidden,\n+  },\n+  docs: {\n+    scope: ScopeRequirement.Optional,\n+  },\n+  feat: {\n+    scope: ScopeRequirement.Required,\n+  },\n+  fix: {\n+    scope: ScopeRequirement.Required,\n+  },\n+  perf: {\n+    scope: ScopeRequirement.Required,\n+  },\n+  refactor: {\n+    scope: ScopeRequirement.Required,\n+  },\n+  release: {\n+    scope: ScopeRequirement.Forbidden,\n+  },\n+  test: {\n+    scope: ScopeRequirement.Required,\n+  },\n+};"
        },
        {
            "sha": "238a7909a943fa485e59e5f1d61a2c132d0ff4d3",
            "filename": "dev-infra/commit-message/validate.spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 19,
            "changes": 31,
            "blob_url": "https://github.com/angular/angular/blob/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.spec.ts?ref=9f7a37b4e9922cc8cf96b1998693afbac301bb5f",
            "patch": "@@ -18,13 +18,6 @@ const config: {commitMessage: CommitMessageConfig} = {\n   commitMessage: {\n     maxLineLength: 120,\n     minBodyLength: 0,\n-    types: [\n-      'feat',\n-      'fix',\n-      'refactor',\n-      'release',\n-      'style',\n-    ],\n     scopes: [\n       'common',\n       'compiler',\n@@ -33,7 +26,7 @@ const config: {commitMessage: CommitMessageConfig} = {\n     ]\n   }\n };\n-const TYPES = config.commitMessage.types.join(', ');\n+const TYPES = Object.keys(validateConfig.COMMIT_TYPES).join(', ');\n const SCOPES = config.commitMessage.scopes.join(', ');\n const INVALID = false;\n const VALID = true;\n@@ -47,24 +40,25 @@ describe('validate-commit-message.js', () => {\n     lastError = '';\n \n     spyOn(console, 'error').and.callFake((msg: string) => lastError = msg);\n-    spyOn(validateConfig, 'getCommitMessageConfig').and.returnValue(config);\n+    spyOn(validateConfig, 'getCommitMessageConfig')\n+        .and.returnValue(config as ReturnType<typeof validateConfig.getCommitMessageConfig>);\n   });\n \n   describe('validateMessage()', () => {\n     it('should be valid', () => {\n       expect(validateCommitMessage('feat(packaging): something')).toBe(VALID);\n       expect(lastError).toBe('');\n \n-      expect(validateCommitMessage('release(packaging): something')).toBe(VALID);\n+      expect(validateCommitMessage('fix(packaging): something')).toBe(VALID);\n       expect(lastError).toBe('');\n \n-      expect(validateCommitMessage('fixup! release(packaging): something')).toBe(VALID);\n+      expect(validateCommitMessage('fixup! fix(packaging): something')).toBe(VALID);\n       expect(lastError).toBe('');\n \n-      expect(validateCommitMessage('squash! release(packaging): something')).toBe(VALID);\n+      expect(validateCommitMessage('squash! fix(packaging): something')).toBe(VALID);\n       expect(lastError).toBe('');\n \n-      expect(validateCommitMessage('Revert: \"release(packaging): something\"')).toBe(VALID);\n+      expect(validateCommitMessage('Revert: \"fix(packaging): something\"')).toBe(VALID);\n       expect(lastError).toBe('');\n     });\n \n@@ -110,21 +104,21 @@ describe('validate-commit-message.js', () => {\n       expect(validateCommitMessage('feat(bah): something')).toBe(INVALID);\n       expect(lastError).toContain(errorMessageFor('bah', 'feat(bah): something'));\n \n-      expect(validateCommitMessage('style(webworker): something')).toBe(INVALID);\n-      expect(lastError).toContain(errorMessageFor('webworker', 'style(webworker): something'));\n+      expect(validateCommitMessage('fix(webworker): something')).toBe(INVALID);\n+      expect(lastError).toContain(errorMessageFor('webworker', 'fix(webworker): something'));\n \n       expect(validateCommitMessage('refactor(security): something')).toBe(INVALID);\n       expect(lastError).toContain(errorMessageFor('security', 'refactor(security): something'));\n \n       expect(validateCommitMessage('refactor(docs): something')).toBe(INVALID);\n       expect(lastError).toContain(errorMessageFor('docs', 'refactor(docs): something'));\n \n-      expect(validateCommitMessage('release(angular): something')).toBe(INVALID);\n-      expect(lastError).toContain(errorMessageFor('angular', 'release(angular): something'));\n+      expect(validateCommitMessage('feat(angular): something')).toBe(INVALID);\n+      expect(lastError).toContain(errorMessageFor('angular', 'feat(angular): something'));\n     });\n \n     it('should allow empty scope', () => {\n-      expect(validateCommitMessage('fix: blablabla')).toBe(VALID);\n+      expect(validateCommitMessage('build: blablabla')).toBe(VALID);\n       expect(lastError).toBe('');\n     });\n \n@@ -243,7 +237,6 @@ describe('validate-commit-message.js', () => {\n           maxLineLength: 120,\n           minBodyLength: 30,\n           minBodyLengthTypeExcludes: ['docs'],\n-          types: ['fix', 'docs'],\n           scopes: ['core']\n         }\n       };"
        },
        {
            "sha": "1c10ada900ca18be27e2a2a68c436e8545811faf",
            "filename": "dev-infra/commit-message/validate.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 3,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/9f7a37b4e9922cc8cf96b1998693afbac301bb5f/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.ts?ref=9f7a37b4e9922cc8cf96b1998693afbac301bb5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import {error} from '../utils/console';\n \n-import {getCommitMessageConfig} from './config';\n+import {COMMIT_TYPES, getCommitMessageConfig, ScopeRequirement} from './config';\n import {parseCommitMessage} from './parse';\n \n /** Options for commit message validation. */\n@@ -86,8 +86,26 @@ export function validateCommitMessage(\n     return false;\n   }\n \n-  if (!config.types.includes(commit.type)) {\n-    printError(`'${commit.type}' is not an allowed type.\\n => TYPES: ${config.types.join(', ')}`);\n+\n+\n+  if (COMMIT_TYPES[commit.type] === undefined) {\n+    printError(`'${commit.type}' is not an allowed type.\\n => TYPES: ${\n+        Object.keys(COMMIT_TYPES).join(', ')}`);\n+    return false;\n+  }\n+\n+  /** The scope requirement level for the provided type of the commit message. */\n+  const scopeRequirementForType = COMMIT_TYPES[commit.type].scope;\n+\n+  if (scopeRequirementForType === ScopeRequirement.Forbidden && commit.scope) {\n+    printError(`Scopes are forbidden for commits with type '${commit.type}', but a scope of '${\n+        commit.scope}' was provided.`);\n+    return false;\n+  }\n+\n+  if (scopeRequirementForType === ScopeRequirement.Required && !commit.scope) {\n+    printError(\n+        `Scopes are required for commits with type '${commit.type}', but no scope was provided.`);\n     return false;\n   }\n "
        }
    ],
    "stats": {
        "total": 99,
        "additions": 76,
        "deletions": 23
    }
}