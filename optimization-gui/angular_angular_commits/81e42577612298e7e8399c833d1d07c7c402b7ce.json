{
    "author": "josephperrott",
    "message": "build: remove dev-infra directory and migrate to relying on @angular/dev-infra-private-builds (#43061)\n\nRemove the dev-infra directory and complete the migration to using the code generated by the\nangular/dev-infra repository.\n\nPR Close #43061",
    "sha": "81e42577612298e7e8399c833d1d07c7c402b7ce",
    "files": [
        {
            "sha": "d0f63e8c11a5d4424a72a5c6cd7eb72459d846a1",
            "filename": ".bazelrc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.bazelrc?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -114,11 +114,11 @@ build:remote --cpu=k8\n build:remote --host_cpu=k8\n \n # Toolchain and platform related flags\n-build:remote --crosstool_top=//dev-infra/bazel/remote-execution/cpp:cc_toolchain_suite\n-build:remote --extra_toolchains=//dev-infra/bazel/remote-execution/cpp:cc_toolchain\n-build:remote --extra_execution_platforms=//dev-infra/bazel/remote-execution:platform\n-build:remote --host_platform=//dev-infra/bazel/remote-execution:platform\n-build:remote --platforms=//dev-infra/bazel/remote-execution:platform\n+build:remote --crosstool_top=@npm//@angular/dev-infra-private/bazel/remote-execution/cpp:cc_toolchain_suite\n+build:remote --extra_toolchains=@npm//@angular/dev-infra-private/bazel/remote-execution/cpp:cc_toolchain\n+build:remote --extra_execution_platforms=@npm//@angular/dev-infra-private/bazel/remote-execution:platform\n+build:remote --host_platform=@npm//@angular/dev-infra-private/bazel/remote-execution:platform\n+build:remote --platforms=@npm//@angular/dev-infra-private/bazel/remote-execution:platform\n \n # Remote instance and caching\n build:remote --remote_instance_name=projects/internal-200822/instances/primary_instance"
        },
        {
            "sha": "39c903cbe32564b984bb568177d386e782f03810",
            "filename": ".github/angular-robot.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.github%2Fangular-robot.yml",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.github%2Fangular-robot.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.github%2Fangular-robot.yml?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -38,7 +38,6 @@ merge:\n       - 'modules/benchmarks/**'\n       - 'modules/system.d.ts'\n       - 'packages/**'\n-      - 'dev-infra/benchmark/driver-utilities/**'\n     # list of patterns to ignore for the files changed by the PR\n     exclude:\n       - 'packages/*'"
        },
        {
            "sha": "c607c42e74a9ee7e2d35a7398bf81e99c77dc25a",
            "filename": ".gitmessage",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.gitmessage",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.gitmessage",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.gitmessage?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -106,8 +106,7 @@ Fixes #<issue number>\n #   │       └─⫸ Commit Scope: animations|bazel|benchpress|common|compiler|compiler-cli|core|\n #   │                          elements|forms|http|language-service|localize|platform-browser|\n #   │                          platform-browser-dynamic|platform-server|router|service-worker|\n-#   │                          upgrade|zone.js|packaging|changelog|dev-infra|docs-infra|migrations|\n-#   │                          ngcc|ve\n+#   │                          upgrade|zone.js|packaging|changelog|docs-infra|migrations|ngcc|ve\n #   │                          https://github.com/angular/angular/blob/master/CONTRIBUTING.md#scope\n #   │\n #   └─⫸ Commit Type: build|ci|docs|feat|fix|perf|refactor|style|test"
        },
        {
            "sha": "1b2a720e7a388cacf97d04f10df6014e9fd845a8",
            "filename": ".ng-dev/caretaker.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fcaretaker.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fcaretaker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fcaretaker.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,4 +1,4 @@\n-import {CaretakerConfig} from '../dev-infra/caretaker/config';\n+import {CaretakerConfig} from '@angular/dev-infra-private/ng-dev/caretaker/config';\n \n /** The configuration for `ng-dev caretaker` commands. */\n export const caretaker: CaretakerConfig = {"
        },
        {
            "sha": "13da4dc5ae203a49220cf4e04341d4c97a87fdb9",
            "filename": ".ng-dev/commit-message.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fcommit-message.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fcommit-message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fcommit-message.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,4 +1,4 @@\n-import {CommitMessageConfig} from '../dev-infra/commit-message/config';\n+import {CommitMessageConfig} from '@angular/dev-infra-private/ng-dev/commit-message/config';\n \n /**\n  * The configuration for `ng-dev commit-message` commands."
        },
        {
            "sha": "a729d4201f6446123237a04c7cfc2b0e528ed2d1",
            "filename": ".ng-dev/format.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fformat.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fformat.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fformat.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,4 +1,4 @@\n-import {FormatConfig} from '../dev-infra/format/config';\n+import {FormatConfig} from '@angular/dev-infra-private/ng-dev/format/config';\n \n /**\n  * Configuration for the `ng-dev format` command."
        },
        {
            "sha": "3425151c94554c696c3266e49dda8fabb1ae4526",
            "filename": ".ng-dev/github.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fgithub.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,4 +1,4 @@\n-import {GithubConfig} from '../dev-infra/utils/config';\n+import {GithubConfig} from '@angular/dev-infra-private/ng-dev/utils/config';\n \n /**\n  * Github configuration for the `ng-dev` command. This repository is used as"
        },
        {
            "sha": "4ebfb9957012a192b2d5caae8d159715670cbc3d",
            "filename": ".ng-dev/merge.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fmerge.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Fmerge.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fmerge.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n-import {DevInfraMergeConfig} from '../dev-infra/pr/merge/config';\n-import {getDefaultTargetLabelConfiguration} from '../dev-infra/pr/merge/defaults';\n+import {DevInfraMergeConfig} from '@angular/dev-infra-private/ng-dev/pr/merge/config';\n+import {getDefaultTargetLabelConfiguration} from '@angular/dev-infra-private/ng-dev/pr/merge/defaults';\n import {github} from './github';\n import {release} from './release';\n "
        },
        {
            "sha": "ec31bd1c077bde38ab215a6e99627b05655dcae0",
            "filename": ".ng-dev/release.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Frelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.ng-dev%2Frelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Frelease.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n+import {ReleaseConfig} from '@angular/dev-infra-private/ng-dev/release/config';\n import {join} from 'path';\n-import {ReleaseConfig} from '../dev-infra/release/config';\n \n /** Configuration for the `ng-dev release` command. */\n export const release: ReleaseConfig = {"
        },
        {
            "sha": "2c4ae1fa01914055f11a0d40e9ba40611bdf1835",
            "filename": ".pullapprove.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/.pullapprove.yml",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/.pullapprove.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.pullapprove.yml?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1155,7 +1155,6 @@ groups:\n           '.ng-dev/**',\n           '.vscode/**',\n           '.yarn/**',\n-          'dev-infra/**',\n           'docs/*.md',\n           'docs/images/**',\n           'goldens/*',"
        },
        {
            "sha": "bf9c0ad45de4a2f6797514dbc7194c91e53781d8",
            "filename": "CONTRIBUTING.md",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/CONTRIBUTING.md",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/CONTRIBUTING.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/CONTRIBUTING.md?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -248,8 +248,7 @@ Any line of the commit message cannot be longer than 100 characters.\n   │       └─⫸ Commit Scope: animations|bazel|benchpress|common|compiler|compiler-cli|core|\n   │                          elements|forms|http|language-service|localize|platform-browser|\n   │                          platform-browser-dynamic|platform-server|router|service-worker|\n-  │                          upgrade|zone.js|packaging|changelog|dev-infra|docs-infra|migrations|\n-  │                          ngcc|ve\n+  │                          upgrade|zone.js|packaging|changelog|docs-infra|migrations|ngcc|ve\n   │\n   └─⫸ Commit Type: build|ci|docs|feat|fix|perf|refactor|test\n ```\n@@ -302,7 +301,7 @@ There are currently a few exceptions to the \"use package name\" rule:\n \n * `changelog`: used for updating the release notes in CHANGELOG.md\n \n-* `dev-infra`: used for dev-infra related changes within the directories /scripts, /tools and /dev-infra\n+* `dev-infra`: used for dev-infra related changes within the directories /scripts and /tools\n \n * `docs-infra`: used for docs-app (angular.io) related changes within the /aio directory of the repo\n "
        },
        {
            "sha": "e09c90faf9d0ca550c2406d42d597b620b495dad",
            "filename": "WORKSPACE",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/WORKSPACE",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/WORKSPACE",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/WORKSPACE?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -44,7 +44,7 @@ load(\"@io_bazel_rules_webtesting//web:repositories.bzl\", \"web_test_repositories\"\n \n web_test_repositories()\n \n-load(\"//dev-infra/bazel/browsers:browser_repositories.bzl\", \"browser_repositories\")\n+load(\"@npm//@angular/dev-infra-private/bazel/browsers:browser_repositories.bzl\", \"browser_repositories\")\n \n browser_repositories()\n "
        },
        {
            "sha": "adf143a33cfe6ef1692b5e33edcec12844e8b36e",
            "filename": "dev-infra/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 116,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,116 +0,0 @@\n-# BEGIN-INTERNAL\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"pkg_npm\")\n-load(\"//dev-infra:defaults.bzl\", \"ng_dev_rolled_up_generated_file\", \"ts_library\")\n-# END-INTERNAL\n-\n-exports_files([\"tsconfig.json\"])\n-\n-# BEGIN-INTERNAL\n-ts_library(\n-    name = \"cli\",\n-    srcs = [\n-        \"cli.ts\",\n-    ],\n-    deps = [\n-        \"//dev-infra/caretaker\",\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/format\",\n-        \"//dev-infra/misc\",\n-        \"//dev-infra/ngbot\",\n-        \"//dev-infra/pr\",\n-        \"//dev-infra/pullapprove\",\n-        \"//dev-infra/release\",\n-        \"//dev-infra/ts-circular-dependencies\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//yargs\",\n-    ],\n-)\n-\n-genrule(\n-    name = \"package-json\",\n-    srcs = [\n-        \"tmpl-package.json\",\n-        \"//:package.json\",\n-    ],\n-    outs = [\"package.json\"],\n-    cmd = \"\"\"\n-        $(execpath //tools:inline-package-json-deps) $(execpath tmpl-package.json) \\\n-            $(execpath //:package.json) $@\n-    \"\"\",\n-    tools = [\"//tools:inline-package-json-deps\"],\n-)\n-\n-pkg_npm(\n-    name = \"npm_package\",\n-    srcs = [\n-        # Main bazel entry-point for the shared `dev-infra` package.\n-        \"index.bzl\",\n-        \"BUILD.bazel\",\n-        # Some tools within `dev-infra` which are shipped as Bazel rules might\n-        # rely on a tsconfig file. We bring the config into the NPM package.\n-        \"tsconfig.json\",\n-        \"//dev-infra/bazel:files\",\n-        \"//dev-infra/benchmark:files\",\n-    ],\n-    substitutions = {\n-        # angular/angular should not consume it's own packages, so we use\n-        # substitutions to replace these in the published version of dev-infra.\n-        \"@angular//dev-infra/\": \"@npm//@angular/dev-infra-private/\",\n-        \"//dev-infra/\": \"@npm//@angular/dev-infra-private/\",\n-        \"//dev-infra:\": \"@npm//@angular/dev-infra-private:\",\n-\n-        # Substitutions needed for `//dev-infra/benchmark`:\n-        \"//packages/benchpress\": \"@npm//@angular/benchpress\",\n-        \"//packages/bazel\": \"@npm//@angular/bazel\",\n-        \"//packages/zone.js/bundles:zone.umd.js\": \"@npm//zone.js\",\n-        \"//packages/core\": \"@npm//@angular/core\",\n-        \"//packages/platform-browser\": \"@npm//@angular/platform-browser\",\n-        # This substitution is particularly verbose because we need to make sure\n-        # that only things available via Angular Bazel are imported from\n-        # tools/defaults.bzl.\n-        \"load\\\\(\\\"//tools:defaults.bzl\\\", \\\"ng_module\\\"\\\\)\": \"load(\\\"@npm//@angular/bazel:index.bzl\\\", \\\"ng_module\\\")\",\n-    },\n-    visibility = [\"//visibility:public\"],\n-    deps = [\n-        \":cli\",\n-        \":package-json\",\n-        \"//dev-infra/benchmark/driver-utilities\",\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/ts-circular-dependencies\",\n-        \"//dev-infra/tslint-rules\",\n-    ],\n-)\n-\n-# Because the angular/angular repository relies on the local repository for running ng-dev commands,\n-# the rollup generated javascript files are committed into the repository to be used as node\n-# scripts. To ensure they stay up to date, they are created using a generated file test.\n-#\n-# Currently there are two generated files which are needed\n-#  ng-dev.js       -  The main script representing ng-dev\n-#  build-worker.js -  The worker script for the `ng-dev release build` command, allowing it to run\n-#                     in a forked process.\n-ng_dev_rolled_up_generated_file(\n-    name = \"ng-dev\",\n-    entry_point = \":cli.ts\",\n-    rollup_args = [\n-        \"--plugin\",\n-        \"rollup-plugin-hashbang\",\n-    ],\n-    deps = [\n-        \":cli\",\n-        # TODO(josephperrott): Determine if this plugin is the best method for ensuring the hashbang\n-        # in both local and published use case.\n-        \"@npm//rollup-plugin-hashbang\",\n-    ],\n-)\n-\n-ng_dev_rolled_up_generated_file(\n-    name = \"build-worker\",\n-    entry_point = \"//dev-infra/release/build:build-worker.ts\",\n-    deps = [\n-        \"//dev-infra/release/build\",\n-    ],\n-)\n-# END-INTERNAL"
        },
        {
            "sha": "b8e78fe5d50931e22b0ae0d203ed903b5a50fef9",
            "filename": "dev-infra/bazel/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-filegroup(\n-    name = \"files\",\n-    srcs = [\n-        \"BUILD.bazel\",\n-        \"expand_template.bzl\",\n-        \"extract_js_module_output.bzl\",\n-        \"//dev-infra/bazel/api-golden:files\",\n-        \"//dev-infra/bazel/browsers:files\",\n-        \"//dev-infra/bazel/remote-execution:files\",\n-    ],\n-)"
        },
        {
            "sha": "1c417b7d2c6a12f18ba05f79bf0a3129370f54d1",
            "filename": "dev-infra/bazel/api-golden/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,35 +0,0 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-exports_files([\n-    \"index.ts\",\n-    \"index_npm_packages.ts\",\n-])\n-\n-ts_library(\n-    name = \"api-golden\",\n-    srcs = [\n-        \"find_entry_points.ts\",\n-        \"index.ts\",\n-        \"index_npm_packages.ts\",\n-        \"test_api_report.ts\",\n-    ],\n-    # A tsconfig needs to be specified as otherwise `ts_library` will look for the config\n-    # in `//:package.json` and this breaks when the BUILD file is copied to `@npm//`.\n-    tsconfig = \"//dev-infra:tsconfig.json\",\n-    deps = [\n-        \"@npm//@bazel/runfiles\",\n-        \"@npm//@microsoft/api-extractor\",\n-        \"@npm//@types/node\",\n-        \"@npm//chalk\",\n-        \"@npm//tslib\",\n-        \"@npm//typescript\",\n-    ],\n-)\n-\n-# Expose the sources in the dev-infra NPM package.\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)"
        },
        {
            "sha": "3343639fecbadb1d450b313c8fda54670fa16384",
            "filename": "dev-infra/bazel/api-golden/find_entry_points.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 62,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Ffind_entry_points.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Ffind_entry_points.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2Ffind_entry_points.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,62 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {lstatSync, readdirSync, readFileSync} from 'fs';\n-import {dirname, join} from 'path';\n-\n-/** Interface describing a resolved NPM package entry point. */\n-export interface PackageEntryPoint {\n-  typesEntryPointPath: string;\n-  packageJsonPath: string;\n-}\n-\n-/** Interface describing contents of a `package.json`. */\n-interface PackageJson {\n-  types?: string;\n-  typings?: string;\n-}\n-\n-/** Finds all entry points within a given NPM package directory. */\n-export function findEntryPointsWithinNpmPackage(dirPath: string): PackageEntryPoint[] {\n-  const entryPoints: PackageEntryPoint[] = [];\n-\n-  for (const packageJsonFilePath of findPackageJsonFilesInDirectory(dirPath)) {\n-    const packageJson = JSON.parse(readFileSync(packageJsonFilePath, 'utf8')) as PackageJson;\n-    const typesFile = packageJson.types || packageJson.typings;\n-\n-    if (typesFile) {\n-      entryPoints.push({\n-        packageJsonPath: packageJsonFilePath,\n-        typesEntryPointPath: join(dirname(packageJsonFilePath), typesFile),\n-      });\n-    }\n-  }\n-\n-  return entryPoints;\n-}\n-\n-/** Determine if the provided path is a directory. */\n-function isDirectory(dirPath: string) {\n-  try {\n-    return lstatSync(dirPath).isDirectory();\n-  } catch {\n-    return false;\n-  }\n-}\n-\n-/** Finds all `package.json` files within a directory. */\n-function* findPackageJsonFilesInDirectory(directoryPath: string): IterableIterator<string> {\n-  for (const fileName of readdirSync(directoryPath)) {\n-    const fullPath = join(directoryPath, fileName);\n-    if (isDirectory(fullPath)) {\n-      yield* findPackageJsonFilesInDirectory(fullPath);\n-    } else if (fileName === 'package.json') {\n-      yield fullPath;\n-    }\n-  }\n-}"
        },
        {
            "sha": "6f2142fbe976ca5b5ece92226b1b0d8fb8097ff8",
            "filename": "dev-infra/bazel/api-golden/index.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 127,
            "changes": 127,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2Findex.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,127 +0,0 @@\n-load(\"//dev-infra/bazel:extract_js_module_output.bzl\", \"extract_js_module_output\")\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\", \"nodejs_test\")\n-\n-nodejs_test_args = [\n-    # Needed so that node doesn't walk back to the source directory.\n-    # From there, the relative imports would point to .ts files.\n-    \"--node_options=--preserve-symlinks\",\n-    # TODO(josephperrott): update dependency usages to no longer need bazel patch module resolver\n-    # See: https://github.com/bazelbuild/rules_nodejs/wiki#--bazel_patch_module_resolver-now-defaults-to-false-2324\n-    \"--bazel_patch_module_resolver\",\n-]\n-\n-default_strip_export_pattern = \"^ɵ(?!ɵdefineInjectable|ɵinject|ɵInjectableDef)\"\n-\n-\"\"\"Escapes a Regular expression so that it can be passed as process argument.\"\"\"\n-\n-def _escape_regex_for_arg(value):\n-    return \"\\\"%s\\\"\" % value\n-\n-\"\"\"\n-  Extracts type names from a list of NPM type targets.\n-\n-  For example: Consider the `@npm//@types/node` target. This function extracts `node`\n-  from the label. This is needed so that the Node types can be wired up within a\n-  TypeScript program using the `types` tsconfig option.\n-\"\"\"\n-\n-def extract_type_names_from_labels(type_targets):\n-    type_names = []\n-    for type_target in type_targets:\n-        type_package = Label(type_target).package\n-\n-        if (type_package.startswith(\"@types/\")):\n-            type_names.append(type_package[len(\"@types/\"):])\n-        else:\n-            fail(\"Expected type target to match the following format: \" +\n-                 \"`@<npm_workspace>//@types/<name>`, but got: %s\" % type_target)\n-\n-    return type_names\n-\n-\"\"\"\n-  Builds an API report for the specified entry-point and compares it against the\n-  specified golden\n-\"\"\"\n-\n-def api_golden_test(\n-        name,\n-        golden,\n-        entry_point,\n-        data = [],\n-        strip_export_pattern = default_strip_export_pattern,\n-        types = [],\n-        **kwargs):\n-    quoted_export_pattern = _escape_regex_for_arg(strip_export_pattern)\n-\n-    kwargs[\"tags\"] = kwargs.get(\"tags\", []) + [\"api_guard\"]\n-\n-    # For API golden tests not running against a NPM package, we extract all transitive\n-    # declarations of the specified `data` targets. This is necessary because API extractor\n-    # needs to resolve other targets that have been linked by the Bazel NodeJS rules. The\n-    # linker by default only provides access to JavaScript sources, but the API extractor is\n-    # specifically concerned with type definitions that we can extract manually here.\n-    extract_js_module_output(\n-        name = \"%s_data_typings\" % name,\n-        deps = data,\n-        provider = \"JSModuleInfo\",\n-        include_declarations = True,\n-        include_default_files = False,\n-    )\n-\n-    test_data = [\"//dev-infra/bazel/api-golden\", \"//:package.json\", \":%s_data_typings\" % name] + \\\n-                data + types\n-\n-    nodejs_test(\n-        name = name,\n-        data = test_data,\n-        entry_point = \"//dev-infra/bazel/api-golden:index.ts\",\n-        templated_args = nodejs_test_args + [golden, entry_point, \"false\", quoted_export_pattern] +\n-                         extract_type_names_from_labels(types),\n-        **kwargs\n-    )\n-\n-    nodejs_binary(\n-        name = name + \".accept\",\n-        testonly = True,\n-        data = test_data,\n-        entry_point = \"//dev-infra/bazel/api-golden:index.ts\",\n-        templated_args = nodejs_test_args + [golden, entry_point, \"true\", quoted_export_pattern] +\n-                         extract_type_names_from_labels(types),\n-        **kwargs\n-    )\n-\n-\"\"\"\n-  Builds an API report for all entrypoints within the given NPM package and compares it\n-  against goldens within the specified directory.\n-\"\"\"\n-\n-def api_golden_test_npm_package(\n-        name,\n-        golden_dir,\n-        npm_package,\n-        data = [],\n-        strip_export_pattern = default_strip_export_pattern,\n-        types = [],\n-        **kwargs):\n-    quoted_export_pattern = _escape_regex_for_arg(strip_export_pattern)\n-\n-    kwargs[\"tags\"] = kwargs.get(\"tags\", []) + [\"api_guard\"]\n-\n-    nodejs_test(\n-        name = name,\n-        data = [\"//dev-infra/bazel/api-golden\"] + data + types,\n-        entry_point = \"//dev-infra/bazel/api-golden:index_npm_packages.ts\",\n-        templated_args = nodejs_test_args + [golden_dir, npm_package, \"false\", quoted_export_pattern] +\n-                         extract_type_names_from_labels(types),\n-        **kwargs\n-    )\n-\n-    nodejs_binary(\n-        name = name + \".accept\",\n-        testonly = True,\n-        data = [\"//dev-infra/bazel/api-golden\"] + data + types,\n-        entry_point = \"//dev-infra/bazel/api-golden:index_npm_packages.ts\",\n-        templated_args = nodejs_test_args + [golden_dir, npm_package, \"true\", quoted_export_pattern] +\n-                         extract_type_names_from_labels(types),\n-        **kwargs\n-    )"
        },
        {
            "sha": "3de18aa7ca0b746f5cb6dc2f03a642266cc35a8c",
            "filename": "dev-infra/bazel/api-golden/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,47 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {runfiles} from '@bazel/runfiles';\n-import * as chalk from 'chalk';\n-\n-import {testApiGolden} from './test_api_report';\n-\n-/**\n- * Entry point for the `api_golden_test` Bazel rule. This function builds an API report for\n- * the specified entry point file and compares it against the specified golden file.\n- */\n-async function main(\n-    goldenFilePath: string, entryPointFilePath: string, approveGolden: boolean,\n-    stripExportPattern: RegExp, typeNames: string[]) {\n-  const {succeeded, apiReportChanged} = await testApiGolden(\n-      goldenFilePath, entryPointFilePath, approveGolden, stripExportPattern, typeNames);\n-\n-  if (!succeeded && apiReportChanged) {\n-    console.error(chalk.red(`The API signature has changed and the golden file is outdated.`));\n-    console.info(chalk.yellow(\n-        `Golden can be updated by running: yarn bazel run ${process.env.TEST_TARGET}.accept`));\n-  }\n-\n-  // Bazel expects `3` as exit code for failing tests.\n-  process.exitCode = succeeded ? 0 : 3;\n-}\n-\n-if (require.main === module) {\n-  const args = process.argv.slice(2);\n-  const goldenFilePath = runfiles.resolve(args[0]);\n-  const entryPointFilePath = runfiles.resolve(args[1]);\n-  const approveGolden = args[2] === 'true';\n-  const stripExportPattern = new RegExp(args[3]);\n-  const typeNames = args.slice(4);\n-\n-  main(goldenFilePath, entryPointFilePath, approveGolden, stripExportPattern, typeNames)\n-      .catch(e => {\n-        console.error(e);\n-        process.exit(1);\n-      });\n-}"
        },
        {
            "sha": "20dc2a4d3ddc5dcf8881514f7d416dc1d2c41058",
            "filename": "dev-infra/bazel/api-golden/index_npm_packages.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 74,
            "changes": 74,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex_npm_packages.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Findex_npm_packages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2Findex_npm_packages.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,74 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {runfiles} from '@bazel/runfiles';\n-import * as chalk from 'chalk';\n-import {join, relative} from 'path';\n-\n-import {findEntryPointsWithinNpmPackage} from './find_entry_points';\n-import {testApiGolden} from './test_api_report';\n-\n-/**\n- * Entry point for the `api_golden_test_npm_package` Bazel rule. This function determines\n- * all types within the specified NPM package and builds API reports that will be compared\n- * against golden files within the given golden directory.\n- */\n-async function main(\n-    goldenDir: string, npmPackageDir: string, approveGolden: boolean, stripExportPattern: RegExp,\n-    typeNames: string[]) {\n-  const entryPoints = findEntryPointsWithinNpmPackage(npmPackageDir);\n-  const outdatedGoldens: string[] = [];\n-  let allTestsSucceeding = true;\n-\n-  for (const {packageJsonPath, typesEntryPointPath} of entryPoints) {\n-    const pkgRelativeName = relative(npmPackageDir, typesEntryPointPath);\n-    // API extractor generates API reports as markdown files. For each types\n-    // entry-point we maintain a separate golden file. These golden files are\n-    // based on the name of the entry-point `.d.ts` file in the NPM package,\n-    // but with the proper `.md` file extension.\n-    // See: https://api-extractor.com/pages/overview/demo_api_report/.\n-    const goldenName = pkgRelativeName.replace(/\\.d\\.ts$/, '.md');\n-    const goldenFilePath = join(goldenDir, goldenName);\n-\n-    const {succeeded, apiReportChanged} = await testApiGolden(\n-        goldenFilePath, typesEntryPointPath, approveGolden, stripExportPattern, typeNames,\n-        packageJsonPath);\n-\n-    // Keep track of outdated goldens.\n-    if (!succeeded && apiReportChanged) {\n-      outdatedGoldens.push(goldenName);\n-    }\n-\n-    allTestsSucceeding = allTestsSucceeding && succeeded;\n-  }\n-\n-  if (outdatedGoldens.length) {\n-    console.error(chalk.red(`The following goldens are outdated:`));\n-    outdatedGoldens.forEach(name => console.info(`-  ${name}`));\n-    console.info();\n-    console.info(chalk.yellow(\n-        `The goldens can be updated by running: yarn bazel run ${process.env.TEST_TARGET}.accept`));\n-  }\n-\n-  // Bazel expects `3` as exit code for failing tests.\n-  process.exitCode = allTestsSucceeding ? 0 : 3;\n-}\n-\n-if (require.main === module) {\n-  const args = process.argv.slice(2);\n-  const goldenDir = runfiles.resolve(args[0]);\n-  const npmPackageDir = runfiles.resolve(args[1]);\n-  const approveGolden = args[2] === 'true';\n-  const stripExportPattern = new RegExp(args[3]);\n-  const typeNames = args.slice(4);\n-\n-  main(goldenDir, npmPackageDir, approveGolden, stripExportPattern, typeNames).catch(e => {\n-    console.error(e);\n-    process.exit(1);\n-  });\n-}"
        },
        {
            "sha": "45d82713c06efa85a20d9b369e959688182ad44b",
            "filename": "dev-infra/bazel/api-golden/test_api_report.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 142,
            "changes": 142,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Ftest_api_report.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fapi-golden%2Ftest_api_report.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fapi-golden%2Ftest_api_report.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,142 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {runfiles} from '@bazel/runfiles';\n-import {ConsoleMessageId, Extractor, ExtractorConfig, ExtractorLogLevel, ExtractorMessage, ExtractorMessageId, ExtractorResult, IConfigFile} from '@microsoft/api-extractor';\n-import {AstModule} from '@microsoft/api-extractor/lib/analyzer/AstModule';\n-import {ExportAnalyzer} from '@microsoft/api-extractor/lib/analyzer/ExportAnalyzer';\n-import {basename, dirname} from 'path';\n-\n-/**\n- * Original definition of the `ExportAnalyzer#fetchAstModuleExportInfo` method.\n- * We store the original function since we monkey-patch it later to account for\n- * specified strip export patterns.\n- * */\n-const _origFetchAstModuleExportInfo = ExportAnalyzer.prototype.fetchAstModuleExportInfo;\n-\n-/**\n- * Builds an API report for the given entry-point file and compares\n- * it against a golden file.\n- *\n- * @param goldenFilePath Path to an API report file that is used as golden\n- * @param indexFilePath Entry point file that is analyzed to build the API report.\n- * @param approveGolden Whether the golden file should be updated.\n- * @param stripExportPattern Regular Expression that can be used to filter out exports\n- *   from the API report.\n- * @param typeNames Name of types which should be included for analysis of the entry-point.\n- *   Types are expected to exist within the default `node_modules/@types/` folder.\n- * @param packageJsonPath Optional path to a `package.json` file that contains the entry\n- *   point. Note that the `package.json` is currently only used by `api-extractor` to determine\n- *   the package name displayed within the API golden.\n- */\n-export async function testApiGolden(\n-    goldenFilePath: string, indexFilePath: string, approveGolden: boolean,\n-    stripExportPattern: RegExp, typeNames: string[] = [],\n-    packageJsonPath = resolveWorkspacePackageJsonPath()): Promise<ExtractorResult> {\n-  // If no `TEST_TMPDIR` is defined, then this script runs using `bazel run`. We use\n-  // the runfile directory as temporary directory for API extractor.\n-  const tempDir = process.env.TEST_TMPDIR ?? process.cwd();\n-\n-  const configObject: IConfigFile = {\n-    compiler: {\n-      overrideTsconfig:\n-          // We disable automatic `@types` resolution as this throws-off API reports\n-          // when the API test is run outside sandbox. Instead we expect a list of\n-          // hard-coded types that should be included. This works in non-sandbox too.\n-          {files: [indexFilePath], compilerOptions: {types: typeNames, lib: ['esnext', 'dom']}}\n-    },\n-    projectFolder: dirname(packageJsonPath),\n-    mainEntryPointFilePath: indexFilePath,\n-    dtsRollup: {enabled: false},\n-    docModel: {enabled: false},\n-    apiReport: {\n-      enabled: true,\n-      reportFolder: dirname(goldenFilePath),\n-      reportTempFolder: tempDir,\n-      reportFileName: basename(goldenFilePath),\n-    },\n-    tsdocMetadata: {enabled: false},\n-    newlineKind: 'lf',\n-    messages: {\n-      extractorMessageReporting: {\n-        // If an export does not have a release tag (like `@public`), API extractor maps\n-        // considers it still as `Public`. We hide the message for now given the Angular\n-        // repositories do not follow the TSDoc standard. https://tsdoc.org/.\n-        // TODO: Make this an error once TSDoc standard is followed in all projects.\n-        [ExtractorMessageId.MissingReleaseTag]: {logLevel: ExtractorLogLevel.None},\n-      },\n-    },\n-  };\n-\n-  // We read the specified `package.json` manually and build a package name that is\n-  // compatible with the API extractor. This is a workaround for a bug in api-extractor.\n-  // TODO remove once https://github.com/microsoft/rushstack/issues/2774 is resolved.\n-  const packageJson = require(packageJsonPath);\n-  const packageNameSegments = packageJson.name.split('/');\n-  const packageName = packageNameSegments.length === 1 ?\n-      packageNameSegments[0] :\n-      `${packageNameSegments[0]}/${packageNameSegments.slice(1).join('_')}`;\n-\n-  const extractorConfig = ExtractorConfig.prepare({\n-    configObject,\n-    // TODO: Remove workaround once https://github.com/microsoft/rushstack/issues/2774 is fixed.\n-    packageJson: {name: packageName},\n-    packageJsonFullPath: packageJsonPath,\n-    configObjectFullPath: undefined,\n-  });\n-\n-  // This patches the `ExportAnalyzer` of `api-extractor` so that we can filter out\n-  // exports that match a specified pattern. Ideally this would not be needed as the\n-  // TSDoc JSDoc annotations could be used to filter out exports from the API report,\n-  // but there are cases in Angular where exports cannot be `@internal` but at the same\n-  // time are denoted as unstable. Such exports are allowed to change frequently and should\n-  // not be captured in the API report (as this would be unnecessarily inconvenient).\n-  ExportAnalyzer.prototype.fetchAstModuleExportInfo = function(module: AstModule) {\n-    const info = _origFetchAstModuleExportInfo.apply(this, [module]);\n-\n-    info.exportedLocalEntities.forEach((entity, exportName) => {\n-      if (stripExportPattern.test(exportName)) {\n-        info.exportedLocalEntities.delete(exportName);\n-      }\n-    });\n-\n-    return info;\n-  };\n-\n-  return Extractor.invoke(extractorConfig, {\n-    // If the golden should be approved, then `localBuild: true` instructs\n-    // API extractor to update the file.\n-    localBuild: approveGolden,\n-    // Process messages from the API extractor (and modify log levels if needed).\n-    messageCallback: msg => processExtractorMessage(msg, approveGolden),\n-  });\n-}\n-\n-/**\n- * Process an API extractor message. Microsoft's API extractor allows developers to\n- * handle messages before API extractor prints them. This allows us to adjust log level\n- * for certain messages, or to fully prevent messages from being printed out.\n- * */\n-async function processExtractorMessage(message: ExtractorMessage, isApprove: boolean) {\n-  // If the golden does not match, we hide the error as API extractor prints\n-  // a warning asking the user to manually copy the new API report. We print\n-  // a custom warning below asking the developer to run the `.accept` Bazel target.\n-  // TODO: Simplify once https://github.com/microsoft/rushstack/issues/2773 is resolved.\n-  if (message.messageId === ConsoleMessageId.ApiReportNotCopied) {\n-    // Mark the message as handled so that API-extractor does not print it. We print\n-    // a message manually after extraction.\n-    message.handled = true;\n-    message.logLevel = isApprove ? ExtractorLogLevel.None : ExtractorLogLevel.Error;\n-  }\n-}\n-\n-/** Resolves the `package.json` of the workspace executing this action. */\n-function resolveWorkspacePackageJsonPath(): string {\n-  const workspaceName = process.env.BAZEL_WORKSPACE!;\n-  return runfiles.resolve(`${workspaceName}/package.json`);\n-}"
        },
        {
            "sha": "dabe4af6da365f119f1c0bdb4898f663e3b857de",
            "filename": "dev-infra/bazel/browsers/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,10 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]) + [\n-        \"//dev-infra/bazel/browsers/chromium:files\",\n-        \"//dev-infra/bazel/browsers/firefox:files\",\n-    ],\n-)"
        },
        {
            "sha": "618146cbb1ea13c64688254dd9241bba3ccb3896",
            "filename": "dev-infra/bazel/browsers/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 110,
            "changes": 110,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2FREADME.md?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,110 +0,0 @@\n-# Browser configuration and versioning for testing of Angular\n-\n-Within the Angular organization, we use Chrome and Firefox to perform most of the local testing, and rely on Sauce Labs and BrowserStack to do cross-browser testing on our CI.\n-\n-The version of Chrome used in tests within this monorepo is configured and controlled via Bazel and `puppeteer`.\n-We manually keep the configuration of these two tools in sync to create a consistent testing environment across unit, e2e, and integration tests.\n-\n-## Bazel\n-\n-Bazel `karma_web_test_suite` and `protractor_web_test_suite` targets will use Chromium or Firefox provisioned by `//dev-infra/bazel/browsers`.\n-The version of Chrome and Firefox are specified in the `chromium.bzl` and `firefox.bzl` files in `/dev-infra/bazel/browsers`.\n-\n-The process of updating the Chrome or Firefox version is not straightforward, but below are dedicated sections for each browser.\n-\n-## Updating Chromium\n-\n-1. Visit https://chromium.woolyss.com/ and note the version (commit position) of the latest stable version.\n-\n-    For example, \"Google Chrome 83.0.4103.97 (756066) • Wednesday, 3 Jun 2020\".\n-    Alternatively, you can look in https://omahaproxy.appspot.com/.\n-\n-2. Find the closest commit position number available for each platform in chromium-browser-snapshots: https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html\n-\n-    For example:\n-    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Linux_x64/756066/\n-    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/756053/\n-    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/756065/\n-\n-    You can download Chromium for your local platform and double check that the `--version` matches up with what you expect.\n-\n-    For example:\n-    ``` bash\n-    $ ~/Downloads/chrome-mac/Chromium.app/Contents/MacOS/Chromium --version\n-    Chromium 83.0.4103.0\n-    ```\n-\n-3. Update the chrome & chrome driver build numbers in `dev-infra/bazel/browsers/chromium/chromium.bzl` and either run `bazel query @org_chromium_chromium_amd64//...` to prompt Bazel to calculate the new `sha256` for each platform binary or determine the new `sha256` values manually.\n-\n-    Here is an example with `curl` & `shasum`:\n-    ``` bash\n-    curl -L https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chrome-linux.zip | shasum -a 256\n-    ```\n-\n-## Puppeteer\n-\n-1. Visit https://github.com/puppeteer/puppeteer/blob/master/docs/api.md to determine which version of puppeteer corresponds to the version of Chrome desired.\n-\n-2. Visit https://chromedriver.chromium.org/downloads to determine which version of ChromeDriver should be used for the version of Chrome desired.\n-\n-    > NOTE:\n-    > The version of Chrome does not necessarily correspond exactly with the version of ChromeDriver.\n-    > For example, you might have to use ChromeDriver v87.0.4280.x to drive Chrome v87.0.4272.x.\n-\n-3. Update `scripts/puppeteer-chromedriver-versions.js` to include an entry with the new version of puppeteer as key and the new version of ChromeDriver as value (as determined in the two previous steps).\n-\n-4. Update all of the puppeteer versions throughout the repo:\n-\n-    * `package.json`\n-    * `aio/package.json`\n-    * `aio/tools/examples/shared/package.json`\n-\n-    ...and their corresponding `yarn.lock` files.\n-\n-## Firefox\n-\n-In order to update Firefox, open the `dev-infra/bazel/browsers/firefox/firefox.bzl` file and update the repository URLs to the desired version.\n-For example:\n-\n-```bzl\n-platform_http_file(\n-    name = \"org_mozilla_firefox_amd64\",\n-    licenses = [\"reciprocal\"],  # MPL 2.0\n-    sha256 = \"bde6e020556a21561e4b8d7aaecf8db7077951f179b98ca5d0305435bc6802c9\",\n-    # Firefox v78.0\n-    urls = [\"https://ftp.mozilla.org/pub/firefox/releases/78.0/linux-x86_64/en-US/firefox-78.0.tar.bz2\"],\n-)\n-```\n-\n-1. Go to the `urls` property and update the URL by replacing all `78.0` occurrences with the version you intend to use.\n-    Once done, do the same change for other platforms (such as `macos`).\n-\n-2. Update the `sha256` checksum of the browser archives.\n-    You can do this by downloading the artifacts from the URLs you just updated, and then running `shasum` on those files:\n-    ```sh\n-    curl -L <BROWSER_URL> | shasum -a 256\n-    ```\n-\n-In the same file, you can also update the version of gecko driver (the WebDriver implementation for Firefox browsers).\n-\n-1. Go to https://firefox-source-docs.mozilla.org/testing/geckodriver/Support.html and find a version that is compatible with the used version of Firefox.\n-\n-2. Update the `geckodriver` repository URLs to the desired version:\n-\n-    ```bzl\n-    platform_http_file(\n-        name = \"org_mozilla_geckodriver_amd64\",\n-        licenses = [\"reciprocal\"],  # MPL 2.0\n-        sha256 = \"d59ca434d8e41ec1e30dd7707b0c95171dd6d16056fb6db9c978449ad8b93cc0\",\n-        # Geckodriver v0.26.0\n-        urls = [\"https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-linux64.tar.gz\"],\n-    )\n-    ```\n-\n-    For example, replace all occurrences of `0.26.0` with the newer version.\n-\n-3. Update the `sha256` checksum of the driver archives.\n-    You can do this by downloading the artifacts from the URLs you just updated, and then running `shasum` on those files:\n-    ```sh\n-    curl -L <DRIVER_URL> | shasum -a 256\n-    ```"
        },
        {
            "sha": "c51c40336e84c9cf712156f6f17eb136bdb6f461",
            "filename": "dev-infra/bazel/browsers/browser_archive_repo.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 96,
            "changes": 96,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_archive_repo.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_archive_repo.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_archive_repo.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,96 +0,0 @@\n-\"\"\"Implementation of the `browser_archive` rule.\"\"\"\n-\n-def _browser_archive_impl(ctx):\n-    url = ctx.attr.url\n-    sha256 = ctx.attr.sha256\n-\n-    # If the URL resolves to a `.dmg` file, then we need to convert the file\n-    # to a zip so that we can extract the actual binaries. We use the `convert_dmg`\n-    # script provided by the webtesting Bazel rules.\n-    if url.endswith(\".dmg\"):\n-        download_file_name = \"_download_file_%s.dmg\" % ctx.attr.name\n-        result_zip_name = \"_converted_file_%s.zip\" % ctx.attr.name\n-\n-        ctx.download(url, download_file_name, sha256)\n-        ctx.execute([ctx.path(Label(\"@io_bazel_rules_webtesting//web/internal:convert_dmg.sh\")), download_file_name, result_zip_name])\n-        ctx.extract(result_zip_name)\n-\n-        ctx.delete(result_zip_name)\n-        ctx.delete(download_file_name)\n-    else:\n-        ctx.download_and_extract(\n-            url = url,\n-            sha256 = sha256,\n-        )\n-\n-    # The browser archive has been downloaded and extracted. We now generate a repository\n-    # `BUILD.bazel` file that exposes the archive files, together with the specified\n-    # named files using the `browser_configure` rule.\n-    ctx.file(\"BUILD.bazel\", content = \"\"\"\n-load(\"@angular//dev-infra/bazel/browsers:browser_configure.bzl\", \"browser_configure\")\n-\n-licenses(%s)\n-\n-browser_configure(\n-  name = \"metadata\",\n-  files = glob([\"**/*\"]),\n-  named_files = %s,\n-  visibility = [\"//visibility:public\"],\n-)\n-\"\"\" % (str(ctx.attr.licenses), str(ctx.attr.named_files)))\n-\n-\"\"\"\n-  Rule that can be used to download and unpack a browser archive in a dedicated Bazel\n-  repository. Additionally, files within the archive can be denoted with an unique name\n-  so that web tests can access browser files in a platform-agnostic way, regardless of\n-  which `browser_archive` repository is added as dependency.\n-\n-  As an example for the concept of denoting archive files with an unique name, consider a case\n-  where a a web test decides conditionally based on the current exec platform which\n-  `browser_archive` repository is used (e.g. mac, windows or linux). The archives are different\n-  for each platform. The test usually would need to determine the current platform, and know how\n-  each archive is structured in order to access the browser binary within the repository. By\n-  defining named files  though, the web test could just pull a named file called `BINARY` that\n-  always resolves to the browser binary in a platform-agnostic way.\n-\n-  Note #1: This rule exists as an alternative to the `platform_http_file` concept\n-  from `rules_webtesting` because the `platform_http_file` rule does not extract the archive\n-  directly, but relies on later build actions to perform the unpacking. This results in less\n-  efficient caching because build actions are invalidated more frequently (e.g. `bazel clean).\n-  We also noticed that the extraction within RBE containers is rather unstable, and extracting\n-  the archives as part of a Bazel repository mitigates this (as extractions happens on the host).\n-\n-  Note #2: Additionally `rules_webtesting` defines a single repository for all platforms,\n-  where only an archive for the current host platform is pulled. This breaks cross-compilation\n-  because the wrong platform archive would be used for web tests that run in the exec platform.\n-\"\"\"\n-browser_archive = repository_rule(\n-    implementation = _browser_archive_impl,\n-    attrs = {\n-        \"url\": attr.string(\n-            doc = \"Browser archive to download and extract.\",\n-            mandatory = True,\n-        ),\n-        \"sha256\": attr.string(\n-            doc = \"SHA256 checksum for the archive.\",\n-            mandatory = True,\n-        ),\n-        \"licenses\": attr.string_list(\n-            mandatory = True,\n-            allow_empty = False,\n-            doc = \"\"\"\n-              Licenses that apply to the archive. Will be passed to a `licenses` invocation\n-              within the repository. https://docs.bazel.build/versions/0.24.0/be/functions.html#licenses.\n-            \"\"\",\n-        ),\n-        \"named_files\": attr.string_dict(\n-            doc = \"\"\"\n-              Dictionary that maps files to unique identifiers. This is useful\n-              if browser archives are different on different platforms and the web\n-              tests would not want to care about archive-specific paths. e.g. targets\n-              expect a `CHROMIUM` key to point to the Chromium browser binary.\n-            \"\"\",\n-            mandatory = True,\n-        ),\n-    },\n-)"
        },
        {
            "sha": "ba184dcdce26e89bdff67196c006ae4411ee9d69",
            "filename": "dev-infra/bazel/browsers/browser_configure.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 69,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_configure.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_configure.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_configure.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,69 +0,0 @@\n-load(\"@io_bazel_rules_webtesting//web/internal:metadata.bzl\", \"metadata\")\n-load(\"@io_bazel_rules_webtesting//web/internal:provider.bzl\", \"WebTestInfo\")\n-\n-\"\"\"Converts the specified label to a manifest path\"\"\"\n-\n-def _label_to_manifest_path(label):\n-    if label.package != \"\":\n-        return \"%s/%s\" % (label.workspace_name, label.package)\n-    return label.workspace_name\n-\n-\"\"\"Implementation of the `browser_configure` rule.\"\"\"\n-\n-def _browser_configure_impl(ctx):\n-    named_files = {}\n-    base_dir = _label_to_manifest_path(ctx.label)\n-\n-    # Update the named files to manifest paths that can be resolved\n-    # with Bazel runfile resolution in web tests.\n-    for n, p in ctx.attr.named_files.items():\n-        named_files[n] = base_dir + \"/\" + p\n-\n-    # Create a web test metadata file that will be provided as part of\n-    # the `WebTestInfo` provider.\n-    metadata.create_file(\n-        ctx = ctx,\n-        output = ctx.outputs.web_test_metadata,\n-        web_test_files = [\n-            metadata.web_test_files(ctx = ctx, named_files = named_files),\n-        ],\n-    )\n-\n-    return [\n-        DefaultInfo(runfiles = ctx.runfiles(files = ctx.files.files)),\n-        WebTestInfo(metadata = ctx.outputs.web_test_metadata),\n-    ]\n-\n-\"\"\"\n-  Rule that is used in combination with the `browser_archive` rule. It captures a set\n-  of files which are needed for dealing with a browser. Additionally, specific files\n-  for the browser can be denoted with an unique name so that web tests can access browser\n-  files in a platform-agnostic way, regardless of which browser repository is selected.\n-\n-  The specified browser files are exposed as runfiles of the target defined through this\n-  rule. The unique names with their associated files are captured within a metadata file\n-  that is exposed through a `WebTestInfo` provider. Web tests will be able to deal with\n-  this metadata file to resolve browser files in a platform-agnostic way.\n-\n-  More details on this can be found in the `browser_archive` rule.\n-\"\"\"\n-browser_configure = rule(\n-    attrs = {\n-        \"files\": attr.label_list(\n-            mandatory = True,\n-            allow_files = True,\n-            doc = \"List of files which are needed for the browser.\",\n-        ),\n-        \"named_files\": attr.string_dict(\n-            doc = \"\"\"\n-              Dictionary that maps files to unique identifiers. This is useful\n-              if browser archives are different on different platforms and the web\n-              tests would not want to care about archive-specific paths. e.g. targets\n-              expect a `CHROMIUM` key to point to the Chromium browser binary.\n-            \"\"\",\n-            mandatory = True,\n-        ),\n-    },\n-    outputs = {\"web_test_metadata\": \"%{name}.gen.json\"},\n-    implementation = _browser_configure_impl,\n-)"
        },
        {
            "sha": "cd65f89abc61fbfedb7357ed45f77ca171fe93cb",
            "filename": "dev-infra/bazel/browsers/browser_repositories.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_repositories.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_repositories.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fbrowser_repositories.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-\"\"\"Pinned browser versions.\n-\n-This function is here to make browser repositories work with cross-platform RBE.\n-Unlike the `rules_webtesting` `browser_repositories`, this function defines\n-separate repositories for each platform.\n-\"\"\"\n-\n-load(\"//dev-infra/bazel/browsers/chromium:chromium.bzl\", \"define_chromium_repositories\")\n-load(\"//dev-infra/bazel/browsers/firefox:firefox.bzl\", \"define_firefox_repositories\")\n-\n-def browser_repositories():\n-    \"\"\"Load pinned rules_webtesting browser versions.\"\"\"\n-\n-    define_chromium_repositories()\n-    define_firefox_repositories()"
        },
        {
            "sha": "6f5d4077eb96a26f1a12e4530da5e981c96b5961",
            "filename": "dev-infra/bazel/browsers/chromium/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,30 +0,0 @@\n-load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"browser\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-browser(\n-    name = \"chromium\",\n-    metadata = \"chromium.json\",\n-    deps = [\n-        \"@io_bazel_rules_webtesting//go/wsl\",\n-    ] + select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": [\n-            \"@org_chromium_chromedriver_amd64//:metadata\",\n-            \"@org_chromium_chromium_amd64//:metadata\",\n-        ],\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": [\n-            \"@org_chromium_chromedriver_macos//:metadata\",\n-            \"@org_chromium_chromium_macos//:metadata\",\n-        ],\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": [\n-            \"@org_chromium_chromedriver_windows//:metadata\",\n-            \"@org_chromium_chromium_windows//:metadata\",\n-        ],\n-    }),\n-)\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)"
        },
        {
            "sha": "2af38af7bb8f35a298c79c936097c9afe54be95d",
            "filename": "dev-infra/bazel/browsers/chromium/chromium.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 76,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,76 +0,0 @@\n-load(\"//dev-infra/bazel/browsers:browser_archive_repo.bzl\", \"browser_archive\")\n-\n-\"\"\"\n-  Defines repositories for Chromium that can be used inside Karma unit tests\n-  and Protractor e2e tests with Bazel.\n-\"\"\"\n-\n-def define_chromium_repositories():\n-    # To update to a newer version of Chromium see instructions in\n-    # https://github.com/angular/angular/blob/master/dev-infra/bazel/browsers/README.md.\n-\n-    browser_archive(\n-        name = \"org_chromium_chromium_amd64\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"36759ed6d151645d00a3a015200334edc70188b422eec51bcaa5790c8e906e27\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/812847/chrome-linux.zip\",\n-        named_files = {\n-            \"CHROMIUM\": \"chrome-linux/chrome\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_chromium_chromium_macos\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"e10533c84ef57232975d6bde9cd28fd0354371e9556dda85e01178e6dcd56b93\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/812851/chrome-mac.zip\",\n-        named_files = {\n-            \"CHROMIUM\": \"chrome-mac/Chromium.app/Contents/MacOS/chromium\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_chromium_chromium_windows\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"40d0dec1892d729db2f7d8f27feff762b070a02f04d4e14f4e37b97d6b7c3c8f\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/812822/chrome-win.zip\",\n-        named_files = {\n-            \"CHROMIUM\": \"chrome-win/chrome.exe\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_chromium_chromedriver_amd64\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"d859f8ecb21e26d3ddaf3f229da695bc86512f4e6c9fe32533af7a8b36783ec5\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/812847/chromedriver_linux64.zip\",\n-        named_files = {\n-            \"CHROMEDRIVER\": \"chromedriver_linux64/chromedriver\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_chromium_chromedriver_macos\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"aa7a99fa23287725d7108cc07baa94e6f0ef4171ff7b134018387a939a67d93d\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/812851/chromedriver_mac64.zip\",\n-        named_files = {\n-            \"CHROMEDRIVER\": \"chromedriver_mac64/chromedriver\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_chromium_chromedriver_windows\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"826f2bd0c50b823e7642860ed08cacf69d3756002a71ac30cdd77c68f31d2d24\",\n-        # 87.0.4280\n-        url = \"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/812822/chromedriver_win32.zip\",\n-        named_files = {\n-            \"CHROMEDRIVER\": \"chromedriver_win32/chromedriver.exe\",\n-        },\n-    )"
        },
        {
            "sha": "7fb23d3486695cf2d3e3be67a71184b023c0fc08",
            "filename": "dev-infra/bazel/browsers/chromium/chromium.json",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Fchromium%2Fchromium.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,20 +0,0 @@\n-{\n-  \"environment\" : \"local\",\n-  \"capabilities\" : {\n-    \"browserName\" : \"chrome\",\n-    \"goog:chromeOptions\" : {\n-      \"binary\" : \"%FILE:CHROMIUM%\",\n-      \"args\" : [\n-        \"--headless\", \n-        \"--use-gl=swiftshader-webgl\"\n-      ]\n-    },\n-    \"google:wslConfig\": {\n-      \"binary\": \"%FILE:CHROMEDRIVER%\",\n-      \"port\":\"%WSLPORT:WSL%\",\n-      \"args\": [\"--port=%WSLPORT:WSL%\"],\n-      \"status\": true,\n-      \"shutdown\": true\n-    }\n-  }\n-}"
        },
        {
            "sha": "4c2ed68df628cae37cc407b9d765b1a94e073e1e",
            "filename": "dev-infra/bazel/browsers/firefox/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 33,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,33 +0,0 @@\n-load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"browser\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-browser(\n-    name = \"firefox\",\n-    disabled = select({\n-        # TODO: Consider adding support for Windows. Requires a portable version of\n-        # Firefox. Official distribution only ships with installers.\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"Firefox is not supported on Windows\",\n-        \"//conditions:default\": None,\n-    }),\n-    metadata = \"firefox.json\",\n-    deps = [\n-        \"@io_bazel_rules_webtesting//go/wsl\",\n-    ] + select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": [\n-            \"@org_mozilla_firefox_amd64//:metadata\",\n-            \"@org_mozilla_geckodriver_amd64//:metadata\",\n-        ],\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": [\n-            \"@org_mozilla_firefox_macos//:metadata\",\n-            \"@org_mozilla_geckodriver_macos//:metadata\",\n-        ],\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": [],\n-    }),\n-)\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)"
        },
        {
            "sha": "c959703fec8310ceb0f362ab2120e17cbd5186bf",
            "filename": "dev-infra/bazel/browsers/firefox/firefox.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 54,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,54 +0,0 @@\n-load(\"//dev-infra/bazel/browsers:browser_archive_repo.bzl\", \"browser_archive\")\n-\n-\"\"\"\n-  Defines repositories for Firefox that can be used inside Karma unit tests\n-  and Protractor e2e tests with Bazel.\n-\"\"\"\n-\n-def define_firefox_repositories():\n-    # Instructions on updating the Firefox version can be found in the `README.md` file\n-    # next to this file.\n-\n-    browser_archive(\n-        name = \"org_mozilla_firefox_amd64\",\n-        licenses = [\"reciprocal\"],  # MPL 2.0\n-        sha256 = \"601e5a9a12ce680ecd82177c7887dae008d8f33690da43be1a690b76563cd992\",\n-        # Firefox v84.0\n-        url = \"https://ftp.mozilla.org/pub/firefox/releases/84.0/linux-x86_64/en-US/firefox-84.0.tar.bz2\",\n-        named_files = {\n-            \"FIREFOX\": \"firefox/firefox\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_mozilla_firefox_macos\",\n-        licenses = [\"reciprocal\"],  # MPL 2.0\n-        sha256 = \"4c7bca050eb228f4f6f93a9895af0a87473e03c67401d1d2f1ba907faf87fefd\",\n-        # Firefox v84.0\n-        url = \"https://ftp.mozilla.org/pub/firefox/releases/84.0/mac/en-US/Firefox%2084.0.dmg\",\n-        named_files = {\n-            \"FIREFOX\": \"Firefox.app/Contents/MacOS/firefox\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_mozilla_geckodriver_amd64\",\n-        licenses = [\"reciprocal\"],  # MPL 2.0\n-        sha256 = \"61bfc547a623d7305256611a81ecd24e6bf9dac555529ed6baeafcf8160900da\",\n-        # Geckodriver v0.28.0\n-        url = \"https://github.com/mozilla/geckodriver/releases/download/v0.28.0/geckodriver-v0.28.0-linux64.tar.gz\",\n-        named_files = {\n-            \"GECKODRIVER\": \"geckodriver\",\n-        },\n-    )\n-\n-    browser_archive(\n-        name = \"org_mozilla_geckodriver_macos\",\n-        licenses = [\"reciprocal\"],  # MPL 2.0\n-        sha256 = \"c288ff6db39adfd5eea0e25b4c3e71bfd9fb383eccf521cdd65f67ea78eb1761\",\n-        # Geckodriver v0.28.0\n-        url = \"https://github.com/mozilla/geckodriver/releases/download/v0.28.0/geckodriver-v0.28.0-macos.tar.gz\",\n-        named_files = {\n-            \"GECKODRIVER\": \"geckodriver\",\n-        },\n-    )"
        },
        {
            "sha": "0cbc7af4a3aca67c04328c12dfcfdc6dc4dffe7a",
            "filename": "dev-infra/bazel/browsers/firefox/firefox.json",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fbrowsers%2Ffirefox%2Ffirefox.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-{\n-  \"environment\": \"local\",\n-  \"capabilities\": {\n-    \"browserName\": \"firefox\",\n-    \"moz:firefoxOptions\": {\n-      \"binary\": \"%FILE:FIREFOX%\",\n-      \"args\": [\"--headless\"]\n-    },\n-    \"google:wslConfig\": {\n-      \"binary\": \"%FILE:GECKODRIVER%\",\n-      \"port\":\"%WSLPORT:WSL%\",\n-      \"args\": [\n-        \"--port=%WSLPORT:WSL%\",\n-        \"--host=%WSL:HOST_IP%\",\n-        \"--marionette-port=%WSLPORT:MARIONETTE%\"\n-      ],\n-      \"status\": true,\n-      \"shutdown\": false\n-    }\n-  }\n-}"
        },
        {
            "sha": "e21bd9fa1d8357c5cfd0bd1ec82d9b7b9d0e4255",
            "filename": "dev-infra/bazel/expand_template.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fexpand_template.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fexpand_template.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fexpand_template.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,45 +0,0 @@\n-\"\"\"Implementation of the expand_template rule \"\"\"\n-\n-def expand_template_impl(ctx):\n-    substitutions = dict()\n-\n-    for k in ctx.attr.configuration_env_vars:\n-        if k in ctx.var.keys():\n-            substitutions[\"TMPL_%s\" % k] = ctx.var[k]\n-\n-    for k in ctx.attr.substitutions:\n-        substitutions[k] = ctx.expand_location(ctx.attr.substitutions[k], targets = ctx.attr.data)\n-\n-    ctx.actions.expand_template(\n-        template = ctx.file.template,\n-        output = ctx.outputs.output_name,\n-        substitutions = substitutions,\n-    )\n-\n-\"\"\"Rule that can be used to substitute variables in a given template file.\"\"\"\n-expand_template = rule(\n-    implementation = expand_template_impl,\n-    attrs = {\n-        \"configuration_env_vars\": attr.string_list(\n-            default = [],\n-            doc = \"Bazel configuration variables which should be exposed to the template.\",\n-        ),\n-        \"output_name\": attr.output(\n-            mandatory = True,\n-            doc = \"File where the substituted template is written to.\",\n-        ),\n-        \"substitutions\": attr.string_dict(\n-            mandatory = True,\n-            doc = \"Dictionary of substitutions that should be available to the template. Dictionary key represents the placeholder in the template.\",\n-        ),\n-        \"data\": attr.label_list(\n-            doc = \"\"\"Data dependencies for location expansion.\"\"\",\n-            allow_files = True,\n-        ),\n-        \"template\": attr.label(\n-            mandatory = True,\n-            allow_single_file = True,\n-            doc = \"File used as template.\",\n-        ),\n-    },\n-)"
        },
        {
            "sha": "42ca77f738f67d104ad4c8fec945e8c131dbea79",
            "filename": "dev-infra/bazel/extract_js_module_output.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fextract_js_module_output.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fextract_js_module_output.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fextract_js_module_output.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,78 +0,0 @@\n-load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"DeclarationInfo\", \"JSEcmaScriptModuleInfo\", \"JSModuleInfo\", \"JSNamedModuleInfo\")\n-\n-\"\"\"Converts a provider name to its actually Starlark provider instance.\"\"\"\n-\n-def _name_to_js_module_provider(name):\n-    if name == \"JSModuleInfo\":\n-        return JSModuleInfo\n-    elif name == \"JSNamedModuleInfo\":\n-        return JSNamedModuleInfo\n-    elif name == \"JSEcmaScriptModuleInfo\":\n-        return JSEcmaScriptModuleInfo\n-    fail(\"Unexpected JavaScript module provider.\")\n-\n-\"\"\"Implementation of the extract_js_module_output rule.\"\"\"\n-\n-def _extract_js_module_output_impl(ctx):\n-    js_module_provider = _name_to_js_module_provider(ctx.attr.provider)\n-    depsets = []\n-    for dep in ctx.attr.deps:\n-        # Include JavaScript sources (including transitive outputs) based on the\n-        # configured JavaScript module provider.\n-        if js_module_provider in dep:\n-            depsets.append(dep[js_module_provider].sources)\n-\n-        # Based on whether declarations should be collected, extract direct\n-        # and transitive declaration files using the `DeclarationInfo` provider.\n-        if ctx.attr.include_declarations and DeclarationInfo in dep:\n-            depsets.append(dep[DeclarationInfo].transitive_declarations)\n-\n-        # Based on whether default files should be collected, extract direct\n-        # files which are exposed using the `DefaultInfo` provider. Also include\n-        # data runfiles which are needed for the current target.\n-        # https://docs.bazel.build/versions/main/skylark/lib/DefaultInfo.html#data_runfiles\n-        if ctx.attr.include_default_files and DefaultInfo in dep:\n-            depsets.append(dep[DefaultInfo].files)\n-            depsets.append(dep[DefaultInfo].data_runfiles.files)\n-\n-    sources = depset(transitive = depsets)\n-\n-    return [DefaultInfo(files = sources)]\n-\n-\"\"\"\n-  Rule that collects declared JavaScript module output files from a list of dependencies\n-  based on a configurable JavaScript module provider. The extracted outputs are exposed\n-  within the `DefaultInfo` provider. Targets defined using this rule can be used as input\n-  for rules that require JavaScript sources, or if there are multiple JavaScript output\n-  variants defined for a target while for example only the `JSModule` outputs are of interest.\n-\n-  As an example: This rule is helpful in combination with `ts_library` and `ng_module` as\n-  those rule expose multiple output flavors (which are distinguishable by the JavaScript module\n-  providers as imported from `providers.bzl`). i.e. these rules expose flavors for named AMD\n-  modules and ECMAScript module output. For reference:\n-  https://github.com/bazelbuild/rules_nodejs/blob/stable/packages/typescript/internal/build_defs.bzl#L334-L337\n-\"\"\"\n-extract_js_module_output = rule(\n-    implementation = _extract_js_module_output_impl,\n-    attrs = {\n-        \"deps\": attr.label_list(\n-            allow_files = True,\n-        ),\n-        \"provider\": attr.string(\n-            doc = \"JavaScript module info provider that is used for collecting sources from the dependencies.\",\n-            mandatory = True,\n-            values = [\"JSModuleInfo\", \"JSNamedModuleInfo\", \"JSEcmaScriptModuleInfo\"],\n-        ),\n-        \"include_declarations\": attr.bool(\n-            mandatory = True,\n-            doc = \"Whether declaration files should be collected from the dependencies.\",\n-        ),\n-        \"include_default_files\": attr.bool(\n-            mandatory = True,\n-            doc = \"\"\"\n-              Whether files from the `DefaultInfo` provider should be collected. Includes\n-              data runfiles needed for the default outputs from dependencies.\n-            \"\"\",\n-        ),\n-    },\n-)"
        },
        {
            "sha": "718894068c207abc6fa028b2640638c6a9d0620c",
            "filename": "dev-infra/bazel/remote-execution/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fremote-execution%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fremote-execution%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fremote-execution%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-platform(\n-    name = \"platform\",\n-    constraint_values = [\n-        \"@bazel_tools//platforms:linux\",\n-        \"@bazel_tools//platforms:x86_64\",\n-        \"@bazel_tools//tools/cpp:clang\",\n-    ],\n-    exec_properties = {\n-        # We use a basic docker image from the Google Cloud container registry that supports\n-        # browser tests. Note that we usually do not use any of the local browsers, but the image\n-        # guarantees that necessary dependencies for launching browsers are installed. Since we\n-        # do not rely on many binaries/tools from the image, the image doesn't need to be updated\n-        # frequently. There are rare cases where it needs to be updated. e.g. for a more recent Bash\n-        # version, or new system settings that are required for launching browsers. In order to do that,\n-        # we need to either see if the `rbe-ubuntu16-04-webtest` image can be updated, or if we need to\n-        # build and publish our own image to the Google cloud image registry.\n-        \"container-image\": \"docker://gcr.io/cloud-marketplace/google/rbe-ubuntu16-04-webtest@sha256:886a12dc4726f5b991b46386292afa8d943b6703a5496c8a1e07cfde778d9044\",\n-        # The `SYS_ADMIN` capability is added so that browsers can be launched with sandbox mode enabled. Related\n-        # # information: https://developers.google.com/web/tools/puppeteer/troubleshooting#running_puppeteer_in_docker\n-        \"dockerAddCapabilities\": \"SYS_ADMIN\",\n-        # By default in Google Cloud Remote build execution, network access is disabled. We explicitly set the\n-        # property in the platform again in case the default ever changes. Network access is not desirable in\n-        # Bazel builds as it is potential source of flaky tests and therefore also breaks hermeticity.\n-        \"dockerNetwork\": \"off\",\n-    },\n-)\n-\n-filegroup(\n-    name = \"files\",\n-    srcs = [\n-        \"BUILD.bazel\",\n-        \"//dev-infra/bazel/remote-execution/cpp:files\",\n-    ],\n-)"
        },
        {
            "sha": "83c3fda085bfbbf45a04d68ed8f5f4c90bdc51a9",
            "filename": "dev-infra/bazel/remote-execution/cpp/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 57,
            "changes": 57,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fremote-execution%2Fcpp%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbazel%2Fremote-execution%2Fcpp%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbazel%2Fremote-execution%2Fcpp%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,57 +0,0 @@\n-load(\"@bazel_tools//tools/cpp:cc_toolchain_config.bzl\", \"cc_toolchain_config\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-filegroup(\n-    name = \"files\",\n-    srcs = [\"BUILD.bazel\"],\n-)\n-\n-cc_toolchain_suite(\n-    name = \"cc_toolchain_suite\",\n-    toolchains = {\n-        \"k8\": \":cc_compiler_k8\",\n-    },\n-)\n-\n-toolchain(\n-    name = \"cc_toolchain\",\n-    exec_compatible_with = [\n-        \"@bazel_tools//platforms:linux\",\n-        \"@bazel_tools//platforms:x86_64\",\n-        \"@bazel_tools//tools/cpp:clang\",\n-    ],\n-    target_compatible_with = [\n-        \"@bazel_tools//platforms:linux\",\n-        \"@bazel_tools//platforms:x86_64\",\n-    ],\n-    toolchain = \":cc_compiler_k8\",\n-    toolchain_type = \"@bazel_tools//tools/cpp:toolchain_type\",\n-)\n-\n-# Basic CC toolchain for k8 remote containers. Based on the default k8\n-# toolchain provided in Bazel (but unfortunately internal).\n-# https://github.com/bazelbuild/bazel/blob/c951753097b45cfb9be512c02199aa891b9646b8/tools/cpp/BUILD.tools#L298-L311\n-cc_toolchain(\n-    name = \"cc_compiler_k8\",\n-    all_files = \":empty\",\n-    ar_files = \":empty\",\n-    as_files = \":empty\",\n-    compiler_files = \":empty\",\n-    dwp_files = \":empty\",\n-    linker_files = \":empty\",\n-    objcopy_files = \":empty\",\n-    strip_files = \":empty\",\n-    supports_param_files = 1,\n-    toolchain_config = \":k8_toolchain_config\",\n-    toolchain_identifier = \"cc-k8-compiler\",\n-)\n-\n-cc_toolchain_config(\n-    name = \"k8_toolchain_config\",\n-    compiler = \"compiler\",\n-    cpu = \"local\",\n-)\n-\n-# Empty filegroup used for defining the CC toolchain.\n-filegroup(name = \"empty\")"
        },
        {
            "sha": "d56acdbef7a4d1df25c3916b600bca381baf15e4",
            "filename": "dev-infra/benchmark/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,11 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]) + [\n-        \"//dev-infra/benchmark/brotli-cli:files\",\n-        \"//dev-infra/benchmark/component_benchmark:files\",\n-        \"//dev-infra/benchmark/ng_rollup_bundle:files\",\n-    ],\n-)"
        },
        {
            "sha": "a97d1f5e19c1b50bfc6f83090a5301cd9301e9a9",
            "filename": "dev-infra/benchmark/brotli-cli/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fbrotli-cli%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fbrotli-cli%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fbrotli-cli%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,19 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n-\n-nodejs_binary(\n-    name = \"brotli-cli\",\n-    data = [\n-        \"cli.js\",\n-        \"@npm//brotli\",\n-    ],\n-    entry_point = \":cli.js\",\n-    visibility = [\"//visibility:public\"],\n-)\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)"
        },
        {
            "sha": "0c08cbf5b7b6198975637cb601147afd06bbd5f3",
            "filename": "dev-infra/benchmark/brotli-cli/cli.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fbrotli-cli%2Fcli.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fbrotli-cli%2Fcli.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fbrotli-cli%2Fcli.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-const fs = require('fs');\n-const compress = require('brotli/compress');\n-\n-function main(args) {\n-  const output = args[0].substring('--output='.length);\n-  const input = args[1];\n-  const buffer = fs.readFileSync(input);\n-  fs.writeFileSync(output, compress(buffer, {mode: 0, quality: 11}));\n-}\n-\n-if (require.main === module) {\n-  main(process.argv.slice(2));\n-}"
        },
        {
            "sha": "4a4596f070feb855d59cb42fe3ec1ea0d19ce35f",
            "filename": "dev-infra/benchmark/component_benchmark/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-exports_files([\n-    \"protractor-perf.conf.js\",\n-    \"start-server.js\",\n-])\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]) + [\"//dev-infra/benchmark/component_benchmark/defaults:files\"],\n-)"
        },
        {
            "sha": "e0fca3dfcee5f1fe0d6098c6df71f794949864cf",
            "filename": "dev-infra/benchmark/component_benchmark/benchmark_test.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,27 +0,0 @@\n-load(\"@npm//@bazel/protractor:index.bzl\", \"protractor_web_test_suite\")\n-\n-\"\"\"\n-  Macro that can be used to define a benchmark test. This differentiates from\n-  a normal Protractor test suite because we specify a custom \"perf\" configuration\n-  that sets up \"@angular/benchpress\". Benchmark test targets will not run on CI\n-  unless explicitly requested.\n-\"\"\"\n-\n-def benchmark_test(name, server, tags = [], **kwargs):\n-    protractor_web_test_suite(\n-        name = name,\n-        browsers = [\"//dev-infra/bazel/browsers/chromium:chromium\"],\n-        configuration = \"//dev-infra/benchmark/component_benchmark:protractor-perf.conf.js\",\n-        on_prepare = \"//dev-infra/benchmark/component_benchmark:start-server.js\",\n-        server = server,\n-        # Benchmark targets should not run on CI by default.\n-        tags = tags + [\n-            \"manual\",\n-            \"no-remote-exec\",\n-        ],\n-        test_suite_tags = [\n-            \"manual\",\n-            \"no-remote-exec\",\n-        ],\n-        **kwargs\n-    )"
        },
        {
            "sha": "4076a0f363b7c4f73ba571d3cdaa408000b714b6",
            "filename": "dev-infra/benchmark/component_benchmark/component_benchmark.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 149,
            "changes": 149,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fcomponent_benchmark.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fcomponent_benchmark.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fcomponent_benchmark.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,149 +0,0 @@\n-load(\"//dev-infra/benchmark/ng_rollup_bundle:ng_rollup_bundle.bzl\", \"ng_rollup_bundle\")\n-load(\"//tools:defaults.bzl\", \"ng_module\")\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-load(\"@npm//@bazel/concatjs:index.bzl\", \"concatjs_devserver\")\n-load(\":benchmark_test.bzl\", \"benchmark_test\")\n-\n-def copy_default_file(origin, destination):\n-    \"\"\"\n-    Copies a file from ./defaults to the destination.\n-\n-    Args:\n-        origin: The name of a file in ./defaults to be copied.\n-        destination: Where the original file will be clopied to.\n-    \"\"\"\n-    native.genrule(\n-        name = \"copy_default_\" + origin + \"_file_genrule\",\n-        srcs = [\"//dev-infra/benchmark/component_benchmark/defaults:\" + origin],\n-        outs = [destination],\n-        cmd = \"cat $(SRCS) >> $@\",\n-    )\n-\n-def component_benchmark(\n-        name,\n-        prefix,\n-        driver,\n-        driver_deps,\n-        ng_srcs,\n-        ng_deps,\n-        ng_assets = [],\n-        assets = None,\n-        styles = None,\n-        entry_point = None,\n-        entry_point_deps = [\n-            \"//packages/core\",\n-            \"//packages/platform-browser\",\n-        ]):\n-    \"\"\"\n-    Runs a benchmark test against the given angular app using the given driver.\n-\n-    This rule was created with the intention of reducing the amount of\n-    duplicate/boilderplate code, while also allowing you to be as verbose with\n-    your app as you'd like. The goal being that if you just want to test a\n-    simple component, the only thing you'd need to provide are the component\n-    (via ng_srcs) and driver.\n-\n-    ** USAGE NOTES **\n-\n-    (assets/styles): The default index.html imports a stylesheet named\n-    \"styles.css\". This allows the use of the default index.html with a custom\n-    stylesheet through the styles arg by providing either a styles.css in the\n-    prefix directory or by providing a css binary named styles.css.\n-\n-    (assets): The default index.html expects that the root selector for\n-    the benchmark app is \"app-root\".\n-\n-    (entry_point): The default entry_point expects a file named \"app.module\" to export\n-    the root NgModule for the benchmark application. It also expects that the\n-    root NgModule is named \"AppModule\".\n-\n-    TIP: The server is named `name + \"_server\"` so that you can view/debug the\n-    app.\n-\n-    Args:\n-      name: The name of the benchmark_test to be run\n-      prefix: The relative path to the root directory of the benchmark app\n-      driver: The ts driver for running the benchmark\n-      driver_deps: Driver's dependencies\n-      ng_srcs: All of the ts srcs for the angular app\n-      ng_deps: Dependencies for the angular app\n-      ng_assets: The static assets for the angular app\n-      assets: Static files\n-      styles: Stylesheets\n-      entry_point: Main entry point for the angular app\n-      entry_point_deps: Entry point's dependencies\n-    \"\"\"\n-    app_lib = name + \"_app_lib\"\n-    app_main = name + \"_app_main\"\n-    benchmark_driver = name + \"_driver\"\n-    server = name + \"_server\"\n-\n-    # If the user doesn't provide assets, entry_point, or styles, we use a\n-    # default version.\n-    # Note that we copy the default files to the same directory as what is used\n-    # by the app for three reasons:\n-    # 1. To avoid having the entry point be defined in a different package from\n-    # where this macro is called.\n-    # 2. So that we can use relative paths for imports in entry point.\n-    # 3. To make using default static files as seamless as possible.\n-\n-    if not entry_point:\n-        entry_point = prefix + \"default_index.ts\"\n-        ng_srcs.append(entry_point)\n-        copy_default_file(\"index.ts\", entry_point)\n-\n-    if not assets:\n-        html = prefix + \"index.html\"\n-        assets = [html]\n-        copy_default_file(\"index.html\", html)\n-\n-    if not styles:\n-        css = prefix + \"styles.css\"\n-        styles = [css]\n-        copy_default_file(\"styles.css\", css)\n-\n-    # Bootstraps the application and creates\n-    # additional files to be imported by the entry_point file.\n-    ng_module(\n-        name = app_lib,\n-        srcs = ng_srcs,\n-        assets = ng_assets,\n-        # Creates ngFactory and ngSummary to be imported by the app's entry point.\n-        generate_ve_shims = True,\n-        deps = ng_deps,\n-        tsconfig = \"//dev-infra/benchmark/component_benchmark:tsconfig-e2e.json\",\n-    )\n-\n-    # Bundle the application (needed by concatjs_devserver).\n-    ng_rollup_bundle(\n-        name = app_main,\n-        entry_point = entry_point,\n-        deps = [\":\" + app_lib] + entry_point_deps,\n-    )\n-\n-    # The ts_library for the driver that runs tests against the benchmark app.\n-    ts_library(\n-        name = benchmark_driver,\n-        tsconfig = \"//dev-infra/benchmark/component_benchmark:tsconfig-e2e.json\",\n-        testonly = True,\n-        srcs = [driver],\n-        deps = driver_deps,\n-    )\n-\n-    # The server for our application.\n-    concatjs_devserver(\n-        name = server,\n-        bootstrap = [\"//packages/zone.js/bundles:zone.umd.js\"],\n-        port = 4200,\n-        static_files = assets + styles,\n-        deps = [\":\" + app_main + \".min_debug.js\"],\n-        additional_root_paths = [\"//dev-infra/benchmark/component_benchmark/defaults\"],\n-        serving_path = \"/app_bundle.js\",\n-    )\n-\n-    # Runs a protractor test that's set up to use @angular/benchpress.\n-    benchmark_test(\n-        name = name,\n-        server = \":\" + server,\n-        deps = [\":\" + benchmark_driver],\n-    )"
        },
        {
            "sha": "0eb8038377aa384ae59679dbdc77f61fd15fa2f9",
            "filename": "dev-infra/benchmark/component_benchmark/defaults/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)\n-\n-exports_files([\n-    \"index.html\",\n-    \"index.ts\",\n-    \"styles.css\",\n-])"
        },
        {
            "sha": "f1fdc71047091c782098ddf5cc9246203dd8098e",
            "filename": "dev-infra/benchmark/component_benchmark/defaults/index.html",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.html",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.html?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,14 +0,0 @@\n-<!doctype html>\n-<html lang=\"en\">\n-  <head>\n-    <meta charset=\"utf-8\">\n-    <title>Benchmark Test</title>\n-    <!-- Prevent favicon.ico requests -->\n-    <link rel=\"icon\" href=\"data:,\">\n-    <link rel=\"stylesheet\" href=\"styles.css\">\n-  </head>\n-  <body>\n-    <app-root id=\"root\">Loading...</app-root>\n-    <script src=\"/app_bundle.js\"></script>\n-  </body>\n-</html>"
        },
        {
            "sha": "4186e824e5d567ea1dd7e8477cd879eb08f83fa3",
            "filename": "dev-infra/benchmark/component_benchmark/defaults/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,19 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// @ts-ignore Cannot find module\n-import {enableProdMode} from '@angular/core';\n-\n-// @ts-ignore Cannot find module\n-import {platformBrowser} from '@angular/platform-browser';\n-\n-// @ts-ignore Cannot find module\n-import {AppModuleNgFactory} from './app.module.ngfactory';\n-\n-enableProdMode();\n-platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);"
        },
        {
            "sha": "04bd77b44b6e601e72bc4bed83f127fa36a9d719",
            "filename": "dev-infra/benchmark/component_benchmark/defaults/styles.css",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Fstyles.css",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Fstyles.css",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fdefaults%2Fstyles.css?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,7 +0,0 @@\n-/*\n- * This file exists so that if the default index.html is used a 404 will not\n- * throw.\n- *\n- * We leave an import for \"styles.css\" in the default index.html for the case\n- * where someone wants to use index.html and provide their own styles.\n- */"
        },
        {
            "sha": "8ccf197b546b77cbcee45ddd355a0b321af30735",
            "filename": "dev-infra/benchmark/component_benchmark/protractor-perf.conf.js",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fprotractor-perf.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fprotractor-perf.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fprotractor-perf.conf.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-const CHROME_OPTIONS = {\n-  'args': ['--js-flags=--expose-gc', '--no-sandbox', '--headless', '--disable-dev-shm-usage'],\n-  'perfLoggingPrefs': {\n-    'traceCategories':\n-        'v8,blink.console,devtools.timeline,disabled-by-default-devtools.timeline,blink.user_timing'\n-  }\n-};\n-\n-exports.config = {\n-  onPrepare: function() {\n-    beforeEach(function() {\n-      browser.ignoreSynchronization = false;\n-    });\n-  },\n-  restartBrowserBetweenTests: true,\n-  allScriptsTimeout: 11000,\n-  capabilities: {\n-    'browserName': 'chrome',\n-    chromeOptions: CHROME_OPTIONS,\n-    loggingPrefs: {\n-      performance: 'ALL',\n-      browser: 'ALL',\n-    }\n-  },\n-  directConnect: true,\n-  framework: 'jasmine2',\n-  jasmineNodeOpts: {\n-    showColors: true,\n-    defaultTimeoutInterval: 90000,\n-    print: function(msg) {\n-      console.info(msg);\n-    },\n-  },\n-  useAllAngular2AppRoots: true\n-};"
        },
        {
            "sha": "2dacb55428bd03edd9b5eab9598c357d2c91d52d",
            "filename": "dev-infra/benchmark/component_benchmark/start-server.js",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fstart-server.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fstart-server.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fstart-server.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,18 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-const protractorUtils = require('@bazel/protractor/protractor-utils');\n-const protractor = require('protractor');\n-\n-module.exports = async function(config) {\n-  const {port} = await protractorUtils.runServer(config.workspace, config.server, '-port', []);\n-  const processedConfig = await protractor.browser.getProcessedConfig();\n-  const serverUrl = `http://localhost:${port}`;\n-\n-  return processedConfig.baseUrl = protractor.browser.baseUrl = serverUrl;\n-};"
        },
        {
            "sha": "ec8572b587b5cffaab9be7df6fb87ae0e4fc11f3",
            "filename": "dev-infra/benchmark/component_benchmark/tsconfig-e2e.json",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Ftsconfig-e2e.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Ftsconfig-e2e.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Ftsconfig-e2e.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,6 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"lib\": [\"es2015\", \"dom\"],\n-    \"types\": [\"node\", \"jasmine\"]\n-  }\n-}"
        },
        {
            "sha": "3ef04bd319b80f7ad4a953cf1468d15032a83d4f",
            "filename": "dev-infra/benchmark/driver-utilities/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-ts_library(\n-    name = \"driver-utilities\",\n-    srcs = glob([\"*.ts\"]),\n-    tsconfig = \"//dev-infra/benchmark/component_benchmark:tsconfig-e2e.json\",\n-    deps = [\n-        \"//packages/benchpress\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/selenium-webdriver\",\n-        \"@npm//node-uuid\",\n-        \"@npm//protractor\",\n-        \"@npm//selenium-webdriver\",\n-    ],\n-)"
        },
        {
            "sha": "3b391f26e4844b338c6f7b6329e6ceba8ae9b91b",
            "filename": "dev-infra/benchmark/driver-utilities/e2e_util.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fe2e_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fe2e_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fe2e_util.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,50 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/* tslint:disable:no-console  */\n-import {browser} from 'protractor';\n-import * as webdriver from 'selenium-webdriver';\n-\n-declare var expect: any;\n-\n-export function openBrowser(config: {\n-  url?: string,\n-  params?: {name: string, value: any}[],\n-  ignoreBrowserSynchronization?: boolean\n-}) {\n-  if (config.ignoreBrowserSynchronization) {\n-    browser.ignoreSynchronization = true;\n-  }\n-  const urlParams: string[] = [];\n-  if (config.params) {\n-    config.params.forEach((param) => urlParams.push(param.name + '=' + param.value));\n-  }\n-  const url = encodeURI(config.url + '?' + urlParams.join('&'));\n-  browser.get(url);\n-  if (config.ignoreBrowserSynchronization) {\n-    browser.sleep(2000);\n-  }\n-}\n-\n-/**\n- * @experimental This API will be moved to Protractor.\n- */\n-export function verifyNoBrowserErrors() {\n-  // TODO(tbosch): Bug in ChromeDriver: Need to execute at least one command\n-  // so that the browser logs can be read out!\n-  browser.executeScript('1+1');\n-  browser.manage().logs().get('browser').then(function(browserLog: any) {\n-    const filteredLog = browserLog.filter(function(logEntry: any) {\n-      if (logEntry.level.value >= webdriver.logging.Level.INFO.value) {\n-        console.log('>> ' + logEntry.message);\n-      }\n-      return logEntry.level.value > webdriver.logging.Level.WARNING.value;\n-    });\n-    expect(filteredLog).toEqual([]);\n-  });\n-}"
        },
        {
            "sha": "979bdf35007064df6c0c4cf70987df79f2b0f6c6",
            "filename": "dev-infra/benchmark/driver-utilities/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,9 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-export {openBrowser, verifyNoBrowserErrors} from './e2e_util';\n-export {runBenchmark} from './perf_util';"
        },
        {
            "sha": "a9043b9a2467a68ac3f662c8d69e575c6f210f2b",
            "filename": "dev-infra/benchmark/driver-utilities/perf_util.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 85,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,85 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {mkdirSync} from 'fs';\n-\n-export {verifyNoBrowserErrors} from './e2e_util';\n-\n-const nodeUuid = require('node-uuid');\n-\n-import {SeleniumWebDriverAdapter, Options, JsonFileReporter, Validator, RegressionSlopeValidator, ConsoleReporter, SizeValidator, MultiReporter, MultiMetric, Runner, StaticProvider} from '@angular/benchpress';\n-import {openBrowser} from './e2e_util';\n-\n-// Note: Keep the `modules/benchmarks/README.md` file in sync with the supported options.\n-const globalOptions = {\n-  sampleSize: process.env.PERF_SAMPLE_SIZE || 20,\n-  forceGc: process.env.PERF_FORCE_GC === 'true',\n-  dryRun: process.env.PERF_DRYRUN === 'true',\n-};\n-\n-const runner = createBenchpressRunner();\n-\n-export async function runBenchmark({\n-  id,\n-  url = '',\n-  params = [],\n-  ignoreBrowserSynchronization = true,\n-  microMetrics,\n-  work,\n-  prepare,\n-  setup,\n-}: {\n-  id: string,\n-  url?: string,\n-  params?: {name: string, value: any}[],\n-  ignoreBrowserSynchronization?: boolean,\n-  microMetrics?: {[key: string]: string},\n-  work?: (() => void)|(() => Promise<unknown>),\n-  prepare?: (() => void)|(() => Promise<unknown>),\n-  setup?: (() => void)|(() => Promise<unknown>),\n-}): Promise<any> {\n-  openBrowser({url, params, ignoreBrowserSynchronization});\n-  if (setup) {\n-    await setup();\n-  }\n-  return runner.sample({\n-    id,\n-    execute: work,\n-    prepare,\n-    microMetrics,\n-    providers: [{provide: Options.SAMPLE_DESCRIPTION, useValue: {}}]\n-  });\n-}\n-\n-function createBenchpressRunner(): Runner {\n-  let runId = nodeUuid.v1();\n-  if (process.env.GIT_SHA) {\n-    runId = process.env.GIT_SHA + ' ' + runId;\n-  }\n-  const resultsFolder = './dist/benchmark_results';\n-  mkdirSync(resultsFolder, {\n-    recursive: true,\n-  });\n-  const providers: StaticProvider[] = [\n-    SeleniumWebDriverAdapter.PROTRACTOR_PROVIDERS,\n-    {provide: Options.FORCE_GC, useValue: globalOptions.forceGc},\n-    {provide: Options.DEFAULT_DESCRIPTION, useValue: {'runId': runId}}, JsonFileReporter.PROVIDERS,\n-    {provide: JsonFileReporter.PATH, useValue: resultsFolder}\n-  ];\n-  if (!globalOptions.dryRun) {\n-    providers.push({provide: Validator, useExisting: RegressionSlopeValidator});\n-    providers.push(\n-        {provide: RegressionSlopeValidator.SAMPLE_SIZE, useValue: globalOptions.sampleSize});\n-    providers.push(MultiReporter.provideWith([ConsoleReporter, JsonFileReporter]));\n-  } else {\n-    providers.push({provide: Validator, useExisting: SizeValidator});\n-    providers.push({provide: SizeValidator.SAMPLE_SIZE, useValue: 1});\n-    providers.push(MultiReporter.provideWith([]));\n-    providers.push(MultiMetric.provideWith([]));\n-  }\n-  return new Runner(providers);\n-}"
        },
        {
            "sha": "afb8a7a6951717d805938930581d525ab24e643f",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,26 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n-\n-exports_files([\n-    \"rollup.config-tmpl.js\",\n-    \"terser_config.json\",\n-])\n-\n-nodejs_binary(\n-    name = \"rollup_with_build_optimizer\",\n-    data = [\n-        \"@npm//@angular-devkit/build-optimizer\",\n-        \"@npm//rollup\",\n-        \"@npm//rollup-plugin-commonjs\",\n-        \"@npm//rollup-plugin-node-resolve\",\n-        \"@npm//rollup-plugin-sourcemaps\",\n-    ],\n-    entry_point = \"@npm//:node_modules/rollup/dist/bin/rollup\",\n-)\n-\n-# Make source files available for distribution via pkg_npm\n-filegroup(\n-    name = \"files\",\n-    srcs = glob([\"*\"]),\n-)"
        },
        {
            "sha": "166fb1bb218615ab5eebbaf740a1ec1d0b3abb8d",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/ng_rollup_bundle.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 104,
            "changes": 104,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,104 +0,0 @@\n-# Copyright Google LLC All Rights Reserved.\n-#\n-# Use of this source code is governed by an MIT-style license that can be\n-# found in the LICENSE file at https://angular.io/license\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"npm_package_bin\")\n-load(\"@npm//@bazel/terser:index.bzl\", \"terser_minified\")\n-load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n-load(\"//dev-infra/bazel:expand_template.bzl\", \"expand_template\")\n-\n-def ng_rollup_bundle(\n-        name,\n-        entry_point,\n-        deps = [],\n-        license_banner = None,\n-        build_optimizer = True,\n-        visibility = None,\n-        format = \"iife\",\n-        globals = {},\n-        **kwargs):\n-    \"\"\"Rollup with Build Optimizer on target prodmode output (ESM2015).\n-\n-    This provides an extension of the [rollup_bundle] rule that works better for Angular apps.\n-\n-    Runs [rollup], [terser_minified] and [brotli] to produce a number of output bundles.\n-\n-    es2015                          : \"%{name}.js\"\n-    es2015 minified                 : \"%{name}.min.js\"\n-    es2015 minified (compressed)    : \"%{name}.min.js.br\",\n-    es2015 minified (debug)         : \"%{name}.min_debug.js\"\n-\n-    It registers `@angular-devkit/build-optimizer` as a rollup plugin by default. This helps\n-    with further optimization. See https://github.com/angular/angular-cli/tree/master/packages/angular_devkit/build_optimizer.\n-\n-    [rollup_bundle]: https://github.com/bazelbuild/rules_nodejs/blob/1.x/packages/rollup/src/rollup_bundle.bzl\n-    [rollup]: https://rollupjs.org/guide/en/\n-    [terser_minified]: https://bazelbuild.github.io/rules_nodejs/Terser.html\n-    [brotli]: https://brotli.org/\n-    \"\"\"\n-\n-    config_data = [license_banner] if license_banner else []\n-\n-    expand_template(\n-        name = \"%s_rollup_config\" % name,\n-        template = \"//dev-infra/benchmark/ng_rollup_bundle:rollup.config-tmpl.js\",\n-        output_name = \"%s_rollup_config.js\" % name,\n-        configuration_env_vars = [\"angular_ivy_enabled\"],\n-        data = config_data,\n-        substitutions = {\n-            \"TMPL_build_optimizer\": \"true\" if build_optimizer else \"false\",\n-            \"TMPL_banner_file\": \"\\\"$(execpath %s)\\\"\" % license_banner if license_banner else \"undefined\",\n-            \"TMPL_external\": \", \".join([\"'%s'\" % e for e in globals.keys()]),\n-            \"TMPL_globals\": \", \".join([\"'%s': '%s'\" % (g, g) for g in globals]),\n-        },\n-        visibility = visibility,\n-    )\n-\n-    rollup_bundle(\n-        name = name,\n-        config_file = \"%s_rollup_config\" % name,\n-        entry_points = {\n-            (entry_point): name,\n-        },\n-        visibility = visibility,\n-        deps = config_data + deps + [\n-            \"@npm//rollup-plugin-node-resolve\",\n-            \"@npm//rollup-plugin-sourcemaps\",\n-            \"@npm//rollup-plugin-commonjs\",\n-            \"@npm//@angular-devkit/build-optimizer\",\n-        ],\n-        silent = True,\n-        format = format,\n-        sourcemap = \"true\",\n-        # TODO(devversion): consider removing when View Engine is removed. View Engine\n-        # uses Bazel manifest path imports in generated factory files.\n-        # e.g. `import \"<workspace_root>/<..>/some_file\";`\n-        link_workspace_root = True,\n-        **kwargs\n-    )\n-\n-    common_terser_options = {\n-        \"visibility\": visibility,\n-        \"config_file\": \"//dev-infra/benchmark/ng_rollup_bundle:terser_config.json\",\n-        # TODO: Enable source maps for better debugging when `@bazel/terser` pre-declares\n-        # JS and map outputs. Tracked with: DEV-120\n-        \"sourcemap\": False,\n-    }\n-\n-    terser_minified(name = name + \".min\", src = name + \".js\", **common_terser_options)\n-    native.filegroup(name = name + \".min.js\", srcs = [name + \".min\"], visibility = visibility)\n-    terser_minified(name = name + \".min_debug\", src = name + \".js\", debug = True, **common_terser_options)\n-    native.filegroup(name = name + \".min_debug.js\", srcs = [name + \".min_debug\"], visibility = visibility)\n-\n-    npm_package_bin(\n-        name = \"_%s_brotli\" % name,\n-        tool = \"//dev-infra/benchmark/brotli-cli\",\n-        data = [name + \".min.js\"],\n-        outs = [name + \".min.js.br\"],\n-        args = [\n-            \"--output=$(execpath %s.min.js.br)\" % name,\n-            \"$(execpath %s.min.js)\" % name,\n-        ],\n-        visibility = visibility,\n-    )"
        },
        {
            "sha": "ab45b6fe6b45be1f1ca828a0e2361a93e5e100a3",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/rollup.config-tmpl.js",
            "status": "removed",
            "additions": 0,
            "deletions": 103,
            "changes": 103,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,103 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// Rollup configuration\n-// GENERATED BY Bazel\n-\n-const buildOptimizer =\n-    require('@angular-devkit/build-optimizer/src/build-optimizer/rollup-plugin.js');\n-const nodeResolve = require('rollup-plugin-node-resolve');\n-const sourcemaps = require('rollup-plugin-sourcemaps');\n-const commonjs = require('rollup-plugin-commonjs');\n-const path = require('path');\n-const fs = require('fs');\n-\n-function log_verbose(...m) {\n-  // This is a template file so we use __filename to output the actual filename\n-  if (!!process.env['VERBOSE_LOGS']) console.error(`[${path.basename(__filename)}]`, ...m);\n-}\n-\n-// Substitutions from the `ng_rollup_bundle` macro. We want to conditionally toggle\n-// build optimizer, support optional banner files, and generally respect the current\n-// compilation mode (i.e. Ivy or View Engine) as that affects module resolution.\n-const useBuildOptimizer = TMPL_build_optimizer;\n-const bannerFile = TMPL_banner_file;\n-const ivyEnabled = 'TMPL_angular_ivy_enabled' === 'True';\n-// `bazel_version_file` is a substitution that is applied by `@bazel/rollup`.\n-const stampDataFile = bazel_version_file;\n-\n-log_verbose(`running with\n-  cwd: ${process.cwd()}\n-  useBuildOptimizer: ${useBuildOptimizer}\n-  bannerFile: ${bannerFile}\n-  stampDataFile: ${stampDataFile}\n-  ivyEnabled: ${ivyEnabled}\n-`);\n-\n-const plugins = [\n-  nodeResolve({\n-    // If Ivy is enabled, we need to make sure that the module resolution prioritizes ngcc\n-    // processed entry-point fields. Ngcc adds special fields to `package.json` files of\n-    // modules that have been processed. Prioritizing these fields matches the Angular CLIs\n-    // behavior for supporting Ivy. We need to support ngcc because `ng_rollup_bundle` rule is\n-    // shared with other repositories that consume Angular from NPM (w/ ngcc).\n-    // https://github.com/angular/angular-cli/blob/1a1ceb609b9a87c4021cce3a6f0fc6d167cd09d2/packages/ngtools/webpack/src/angular_compiler_plugin.ts#L918-L920\n-    mainFields: ivyEnabled ? ['module_ivy_ngcc', 'main_ivy_ngcc', 'module', 'main'] :\n-                             ['module', 'main'],\n-    preferBuiltins: true,\n-  }),\n-  commonjs({ignoreGlobal: true}),\n-  sourcemaps(),\n-];\n-\n-if (useBuildOptimizer) {\n-  plugins.unshift(buildOptimizer.default({\n-    sideEffectFreeModules: [],\n-  }));\n-}\n-\n-module.exports = {\n-  plugins,\n-  onwarn: customWarningHandler,\n-  external: [TMPL_external],\n-  output: {\n-    globals: {TMPL_globals},\n-    banner: extractBannerIfConfigured(),\n-  }\n-};\n-\n-/** Custom warning handler for Rollup. */\n-function customWarningHandler(warning, defaultHandler) {\n-  // If rollup is unable to resolve an import, we want to throw an error\n-  // instead of silently treating the import as external dependency.\n-  // https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency\n-  if (warning.code === 'UNRESOLVED_IMPORT') {\n-    throw Error(`Unresolved import: ${warning.message}`);\n-  }\n-\n-  defaultHandler(warning);\n-}\n-\n-/** Extracts the top-level bundle banner if specified. */\n-function extractBannerIfConfigured() {\n-  if (!bannerFile) {\n-    return undefined;\n-  }\n-  let banner = fs.readFileSync(bannerFile, 'utf8');\n-  if (stampDataFile) {\n-    const versionTag = fs.readFileSync(stampDataFile, 'utf8')\n-                           .split('\\n')\n-                           .find(s => s.startsWith('BUILD_SCM_VERSION'));\n-    // Don't assume BUILD_SCM_VERSION exists\n-    if (versionTag) {\n-      const version = versionTag.split(' ')[1].trim();\n-      banner = banner.replace(/0.0.0-PLACEHOLDER/, version);\n-    }\n-  }\n-  return banner;\n-}"
        },
        {
            "sha": "fcb6a31ad47c316df592a070efcd148bf716a1e3",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/terser_config.json",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fterser_config.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fterser_config.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fterser_config.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,18 +0,0 @@\n-{\n-    \"output\": {\n-        \"ecma\": \"es2015\",\n-        \"comments\": false,\n-        \"beautify\": \"bazel_debug\"\n-    },\n-    \"compress\": {\n-        \"global_defs\": {\n-            \"ngDevMode\": false,\n-            \"ngI18nClosureMode\": false,\n-            \"ngJitMode\": false\n-        },\n-        \"passes\": 3,\n-        \"pure_getters\": true\n-    },\n-    \"toplevel\": true,\n-    \"mangle\": \"bazel_no_debug\"\n-}"
        },
        {
            "sha": "19a062e471e43a6aa6846581980c3ce60680c32b",
            "filename": "dev-infra/build-worker.js",
            "status": "removed",
            "additions": 0,
            "deletions": 609,
            "changes": 609,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbuild-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fbuild-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbuild-worker.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,609 +0,0 @@\n-'use strict';\n-\n-var tslib = require('tslib');\n-var fs = require('fs');\n-var path = require('path');\n-require('chalk');\n-require('inquirer');\n-var child_process = require('child_process');\n-var semver = require('semver');\n-var graphql = require('@octokit/graphql');\n-var rest = require('@octokit/rest');\n-var typedGraphqlify = require('typed-graphqlify');\n-var url = require('url');\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Whether the current environment is in dry run mode. */\n-function isDryRun() {\n-    return process.env['DRY_RUN'] !== undefined;\n-}\n-/** Error to be thrown when a function or method is called in dryRun mode and shouldn't be. */\n-var DryRunError = /** @class */ (function (_super) {\n-    tslib.__extends(DryRunError, _super);\n-    function DryRunError() {\n-        var _this = _super.call(this, 'Cannot call this function in dryRun mode.') || this;\n-        // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-        // a limitation in down-leveling.\n-        // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-        Object.setPrototypeOf(_this, DryRunError.prototype);\n-        return _this;\n-    }\n-    return DryRunError;\n-}(Error));\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Error for failed Github API requests. */\n-var GithubApiRequestError = /** @class */ (function (_super) {\n-    tslib.__extends(GithubApiRequestError, _super);\n-    function GithubApiRequestError(status, message) {\n-        var _this = _super.call(this, message) || this;\n-        _this.status = status;\n-        return _this;\n-    }\n-    return GithubApiRequestError;\n-}(Error));\n-/** A Github client for interacting with the Github APIs. */\n-var GithubClient = /** @class */ (function () {\n-    function GithubClient(_octokitOptions) {\n-        this._octokitOptions = _octokitOptions;\n-        /** The octokit instance actually performing API requests. */\n-        this._octokit = new rest.Octokit(this._octokitOptions);\n-        this.pulls = this._octokit.pulls;\n-        this.repos = this._octokit.repos;\n-        this.issues = this._octokit.issues;\n-        this.git = this._octokit.git;\n-        this.rateLimit = this._octokit.rateLimit;\n-        this.teams = this._octokit.teams;\n-        // Note: These are properties from `Octokit` that are brought in by optional plugins.\n-        // TypeScript requires us to provide an explicit type for these.\n-        this.rest = this._octokit.rest;\n-        this.paginate = this._octokit.paginate;\n-    }\n-    return GithubClient;\n-}());\n-/**\n- * Extension of the `GithubClient` that provides utilities which are specific\n- * to authenticated instances.\n- */\n-var AuthenticatedGithubClient = /** @class */ (function (_super) {\n-    tslib.__extends(AuthenticatedGithubClient, _super);\n-    function AuthenticatedGithubClient(_token) {\n-        var _this = \n-        // Set the token for the octokit instance.\n-        _super.call(this, { auth: _token }) || this;\n-        _this._token = _token;\n-        /** The graphql instance with authentication set during construction. */\n-        _this._graphql = graphql.graphql.defaults({ headers: { authorization: \"token \" + _this._token } });\n-        return _this;\n-    }\n-    /** Perform a query using Github's Graphql API. */\n-    AuthenticatedGithubClient.prototype.graphql = function (queryObject, params) {\n-        if (params === void 0) { params = {}; }\n-        return tslib.__awaiter(this, void 0, void 0, function () {\n-            return tslib.__generator(this, function (_a) {\n-                switch (_a.label) {\n-                    case 0: return [4 /*yield*/, this._graphql(typedGraphqlify.query(queryObject).toString(), params)];\n-                    case 1: return [2 /*return*/, (_a.sent())];\n-                }\n-            });\n-        });\n-    };\n-    return AuthenticatedGithubClient;\n-}(GithubClient));\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Adds the provided token to the given Github HTTPs remote url. */\n-function addTokenToGitHttpsUrl(githubHttpsUrl, token) {\n-    var url$1 = new url.URL(githubHttpsUrl);\n-    url$1.username = token;\n-    return url$1.href;\n-}\n-/** Gets the repository Git URL for the given github config. */\n-function getRepositoryGitUrl(config, githubToken) {\n-    if (config.useSsh) {\n-        return \"git@github.com:\" + config.owner + \"/\" + config.name + \".git\";\n-    }\n-    var baseHttpUrl = \"https://github.com/\" + config.owner + \"/\" + config.name + \".git\";\n-    if (githubToken !== undefined) {\n-        return addTokenToGitHttpsUrl(baseHttpUrl, githubToken);\n-    }\n-    return baseHttpUrl;\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Error for failed Git commands. */\n-var GitCommandError = /** @class */ (function (_super) {\n-    tslib.__extends(GitCommandError, _super);\n-    function GitCommandError(client, args) {\n-        var _this = \n-        // Errors are not guaranteed to be caught. To ensure that we don't\n-        // accidentally leak the Github token that might be used in a command,\n-        // we sanitize the command that will be part of the error message.\n-        _super.call(this, \"Command failed: git \" + client.sanitizeConsoleOutput(args.join(' '))) || this;\n-        _this.args = args;\n-        // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-        // a limitation in down-leveling.\n-        // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-        Object.setPrototypeOf(_this, GitCommandError.prototype);\n-        return _this;\n-    }\n-    return GitCommandError;\n-}(Error));\n-/** Class that can be used to perform Git interactions with a given remote. **/\n-var GitClient = /** @class */ (function () {\n-    function GitClient(\n-    /** The full path to the root of the repository base. */\n-    baseDir, \n-    /** The configuration, containing the github specific configuration. */\n-    config) {\n-        if (baseDir === void 0) { baseDir = determineRepoBaseDirFromCwd(); }\n-        if (config === void 0) { config = getConfig(baseDir); }\n-        this.baseDir = baseDir;\n-        this.config = config;\n-        /** Short-hand for accessing the default remote configuration. */\n-        this.remoteConfig = this.config.github;\n-        /** Octokit request parameters object for targeting the configured remote. */\n-        this.remoteParams = { owner: this.remoteConfig.owner, repo: this.remoteConfig.name };\n-        /** Instance of the Github client. */\n-        this.github = new GithubClient();\n-    }\n-    /** Executes the given git command. Throws if the command fails. */\n-    GitClient.prototype.run = function (args, options) {\n-        var result = this.runGraceful(args, options);\n-        if (result.status !== 0) {\n-            throw new GitCommandError(this, args);\n-        }\n-        // Omit `status` from the type so that it's obvious that the status is never\n-        // non-zero as explained in the method description.\n-        return result;\n-    };\n-    /**\n-     * Spawns a given Git command process. Does not throw if the command fails. Additionally,\n-     * if there is any stderr output, the output will be printed. This makes it easier to\n-     * info failed commands.\n-     */\n-    GitClient.prototype.runGraceful = function (args, options) {\n-        if (options === void 0) { options = {}; }\n-        /** The git command to be run. */\n-        var gitCommand = args[0];\n-        if (isDryRun() && gitCommand === 'push') {\n-            debug(\"\\\"git push\\\" is not able to be run in dryRun mode.\");\n-            throw new DryRunError();\n-        }\n-        // To improve the debugging experience in case something fails, we print all executed Git\n-        // commands at the DEBUG level to better understand the git actions occurring. Verbose logging,\n-        // always logging at the INFO level, can be enabled either by setting the verboseLogging\n-        // property on the GitClient class or the options object provided to the method.\n-        var printFn = (GitClient.verboseLogging || options.verboseLogging) ? info : debug;\n-        // Note that we sanitize the command before printing it to the console. We do not want to\n-        // print an access token if it is contained in the command. It's common to share errors with\n-        // others if the tool failed, and we do not want to leak tokens.\n-        printFn('Executing: git', this.sanitizeConsoleOutput(args.join(' ')));\n-        var result = child_process.spawnSync('git', args, tslib.__assign(tslib.__assign({ cwd: this.baseDir, stdio: 'pipe' }, options), { \n-            // Encoding is always `utf8` and not overridable. This ensures that this method\n-            // always returns `string` as output instead of buffers.\n-            encoding: 'utf8' }));\n-        if (result.stderr !== null) {\n-            // Git sometimes prints the command if it failed. This means that it could\n-            // potentially leak the Github token used for accessing the remote. To avoid\n-            // printing a token, we sanitize the string before printing the stderr output.\n-            process.stderr.write(this.sanitizeConsoleOutput(result.stderr));\n-        }\n-        return result;\n-    };\n-    /** Git URL that resolves to the configured repository. */\n-    GitClient.prototype.getRepoGitUrl = function () {\n-        return getRepositoryGitUrl(this.remoteConfig);\n-    };\n-    /** Whether the given branch contains the specified SHA. */\n-    GitClient.prototype.hasCommit = function (branchName, sha) {\n-        return this.run(['branch', branchName, '--contains', sha]).stdout !== '';\n-    };\n-    /** Gets the currently checked out branch or revision. */\n-    GitClient.prototype.getCurrentBranchOrRevision = function () {\n-        var branchName = this.run(['rev-parse', '--abbrev-ref', 'HEAD']).stdout.trim();\n-        // If no branch name could be resolved. i.e. `HEAD` has been returned, then Git\n-        // is currently in a detached state. In those cases, we just want to return the\n-        // currently checked out revision/SHA.\n-        if (branchName === 'HEAD') {\n-            return this.run(['rev-parse', 'HEAD']).stdout.trim();\n-        }\n-        return branchName;\n-    };\n-    /** Gets whether the current Git repository has uncommitted changes. */\n-    GitClient.prototype.hasUncommittedChanges = function () {\n-        return this.runGraceful(['diff-index', '--quiet', 'HEAD']).status !== 0;\n-    };\n-    /**\n-     * Checks out a requested branch or revision, optionally cleaning the state of the repository\n-     * before attempting the checking. Returns a boolean indicating whether the branch or revision\n-     * was cleanly checked out.\n-     */\n-    GitClient.prototype.checkout = function (branchOrRevision, cleanState) {\n-        if (cleanState) {\n-            // Abort any outstanding ams.\n-            this.runGraceful(['am', '--abort'], { stdio: 'ignore' });\n-            // Abort any outstanding cherry-picks.\n-            this.runGraceful(['cherry-pick', '--abort'], { stdio: 'ignore' });\n-            // Abort any outstanding rebases.\n-            this.runGraceful(['rebase', '--abort'], { stdio: 'ignore' });\n-            // Clear any changes in the current repo.\n-            this.runGraceful(['reset', '--hard'], { stdio: 'ignore' });\n-        }\n-        return this.runGraceful(['checkout', branchOrRevision], { stdio: 'ignore' }).status === 0;\n-    };\n-    /** Gets the latest git tag on the current branch that matches SemVer. */\n-    GitClient.prototype.getLatestSemverTag = function () {\n-        var semVerOptions = { loose: true };\n-        var tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n-        var latestTag = tags.find(function (tag) { return semver.parse(tag, semVerOptions); });\n-        if (latestTag === undefined) {\n-            throw new Error(\"Unable to find a SemVer matching tag on \\\"\" + this.getCurrentBranchOrRevision() + \"\\\"\");\n-        }\n-        return new semver.SemVer(latestTag, semVerOptions);\n-    };\n-    /** Retrieves the git tag matching the provided SemVer, if it exists. */\n-    GitClient.prototype.getMatchingTagForSemver = function (semver$1) {\n-        var semVerOptions = { loose: true };\n-        var tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n-        var matchingTag = tags.find(function (tag) { var _a; return ((_a = semver.parse(tag, semVerOptions)) === null || _a === void 0 ? void 0 : _a.compare(semver$1)) === 0; });\n-        if (matchingTag === undefined) {\n-            throw new Error(\"Unable to find a tag for the version: \\\"\" + semver$1.format() + \"\\\"\");\n-        }\n-        return matchingTag;\n-    };\n-    /** Retrieve a list of all files in the repository changed since the provided shaOrRef. */\n-    GitClient.prototype.allChangesFilesSince = function (shaOrRef) {\n-        if (shaOrRef === void 0) { shaOrRef = 'HEAD'; }\n-        return Array.from(new Set(tslib.__spreadArray(tslib.__spreadArray([], tslib.__read(gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=d', shaOrRef])))), tslib.__read(gitOutputAsArray(this.runGraceful(['ls-files', '--others', '--exclude-standard']))))));\n-    };\n-    /** Retrieve a list of all files currently staged in the repostitory. */\n-    GitClient.prototype.allStagedFiles = function () {\n-        return gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=ACM', '--staged']));\n-    };\n-    /** Retrieve a list of all files tracked in the repository. */\n-    GitClient.prototype.allFiles = function () {\n-        return gitOutputAsArray(this.runGraceful(['ls-files']));\n-    };\n-    /**\n-     * Sanitizes the given console message. This method can be overridden by\n-     * derived classes. e.g. to sanitize access tokens from Git commands.\n-     */\n-    GitClient.prototype.sanitizeConsoleOutput = function (value) {\n-        return value;\n-    };\n-    /** Set the verbose logging state of all git client instances. */\n-    GitClient.setVerboseLoggingState = function (verbose) {\n-        GitClient.verboseLogging = verbose;\n-    };\n-    /**\n-     * Static method to get the singleton instance of the `GitClient`, creating it\n-     * if it has not yet been created.\n-     */\n-    GitClient.get = function () {\n-        if (!this._unauthenticatedInstance) {\n-            GitClient._unauthenticatedInstance = new GitClient();\n-        }\n-        return GitClient._unauthenticatedInstance;\n-    };\n-    /** Whether verbose logging of Git actions should be used. */\n-    GitClient.verboseLogging = false;\n-    return GitClient;\n-}());\n-/**\n- * Takes the output from `run` and `runGraceful` and returns an array of strings for each\n- * new line. Git commands typically return multiple output values for a command a set of\n- * strings separated by new lines.\n- *\n- * Note: This is specifically created as a locally available function for usage as convenience\n- * utility within `GitClient`'s methods to create outputs as array.\n- */\n-function gitOutputAsArray(gitCommandResult) {\n-    return gitCommandResult.stdout.split('\\n').map(function (x) { return x.trim(); }).filter(function (x) { return !!x; });\n-}\n-/** Determines the repository base directory from the current working directory. */\n-function determineRepoBaseDirFromCwd() {\n-    // TODO(devversion): Replace with common spawn sync utility once available.\n-    var _a = child_process.spawnSync('git', ['rev-parse --show-toplevel'], { shell: true, stdio: 'pipe', encoding: 'utf8' }), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n-    if (status !== 0) {\n-        throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n-            \"Was the command run from inside of the repo?\\n\\n\" +\n-            (\"\" + stderr));\n-    }\n-    return stdout.trim();\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Supported levels for logging functions.\n- *\n- * Levels are mapped to numbers to represent a hierarchy of logging levels.\n- */\n-var LOG_LEVELS;\n-(function (LOG_LEVELS) {\n-    LOG_LEVELS[LOG_LEVELS[\"SILENT\"] = 0] = \"SILENT\";\n-    LOG_LEVELS[LOG_LEVELS[\"ERROR\"] = 1] = \"ERROR\";\n-    LOG_LEVELS[LOG_LEVELS[\"WARN\"] = 2] = \"WARN\";\n-    LOG_LEVELS[LOG_LEVELS[\"LOG\"] = 3] = \"LOG\";\n-    LOG_LEVELS[LOG_LEVELS[\"INFO\"] = 4] = \"INFO\";\n-    LOG_LEVELS[LOG_LEVELS[\"DEBUG\"] = 5] = \"DEBUG\";\n-})(LOG_LEVELS || (LOG_LEVELS = {}));\n-/** Default log level for the tool. */\n-var DEFAULT_LOG_LEVEL = LOG_LEVELS.INFO;\n-/** Write to the console for at INFO logging level */\n-var info = buildLogLevelFunction(function () { return console.info; }, LOG_LEVELS.INFO);\n-/** Write to the console for at ERROR logging level */\n-var error = buildLogLevelFunction(function () { return console.error; }, LOG_LEVELS.ERROR);\n-/** Write to the console for at DEBUG logging level */\n-var debug = buildLogLevelFunction(function () { return console.debug; }, LOG_LEVELS.DEBUG);\n-/** Write to the console for at LOG logging level */\n-// tslint:disable-next-line: no-console\n-var log = buildLogLevelFunction(function () { return console.log; }, LOG_LEVELS.LOG);\n-/** Write to the console for at WARN logging level */\n-var warn = buildLogLevelFunction(function () { return console.warn; }, LOG_LEVELS.WARN);\n-/** Build an instance of a logging function for the provided level. */\n-function buildLogLevelFunction(loadCommand, level) {\n-    /** Write to stdout for the LOG_LEVEL. */\n-    var loggingFunction = function () {\n-        var text = [];\n-        for (var _i = 0; _i < arguments.length; _i++) {\n-            text[_i] = arguments[_i];\n-        }\n-        runConsoleCommand.apply(void 0, tslib.__spreadArray([loadCommand, level], tslib.__read(text)));\n-    };\n-    /** Start a group at the LOG_LEVEL, optionally starting it as collapsed. */\n-    loggingFunction.group = function (text, collapsed) {\n-        if (collapsed === void 0) { collapsed = false; }\n-        var command = collapsed ? console.groupCollapsed : console.group;\n-        runConsoleCommand(function () { return command; }, level, text);\n-    };\n-    /** End the group at the LOG_LEVEL. */\n-    loggingFunction.groupEnd = function () {\n-        runConsoleCommand(function () { return console.groupEnd; }, level);\n-    };\n-    return loggingFunction;\n-}\n-/**\n- * Run the console command provided, if the environments logging level greater than the\n- * provided logging level.\n- *\n- * The loadCommand takes in a function which is called to retrieve the console.* function\n- * to allow for jasmine spies to still work in testing.  Without this method of retrieval\n- * the console.* function, the function is saved into the closure of the created logging\n- * function before jasmine can spy.\n- */\n-function runConsoleCommand(loadCommand, logLevel) {\n-    var text = [];\n-    for (var _i = 2; _i < arguments.length; _i++) {\n-        text[_i - 2] = arguments[_i];\n-    }\n-    if (getLogLevel() >= logLevel) {\n-        loadCommand().apply(void 0, tslib.__spreadArray([], tslib.__read(text)));\n-    }\n-    printToLogFile.apply(void 0, tslib.__spreadArray([logLevel], tslib.__read(text)));\n-}\n-/**\n- * Retrieve the log level from environment variables, if the value found\n- * based on the LOG_LEVEL environment variable is undefined, return the default\n- * logging level.\n- */\n-function getLogLevel() {\n-    var logLevelEnvValue = (process.env[\"LOG_LEVEL\"] || '').toUpperCase();\n-    var logLevel = LOG_LEVELS[logLevelEnvValue];\n-    if (logLevel === undefined) {\n-        return DEFAULT_LOG_LEVEL;\n-    }\n-    return logLevel;\n-}\n-/**\n- * The number of columns used in the prepended log level information on each line of the logging\n- * output file.\n- */\n-var LOG_LEVEL_COLUMNS = 7;\n-/** Write the provided text to the log file, prepending each line with the log level.  */\n-function printToLogFile(logLevel) {\n-    var text = [];\n-    for (var _i = 1; _i < arguments.length; _i++) {\n-        text[_i - 1] = arguments[_i];\n-    }\n-    var logLevelText = (LOG_LEVELS[logLevel] + \":\").padEnd(LOG_LEVEL_COLUMNS);\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Whether ts-node has been installed and is available to ng-dev. */\n-function isTsNodeAvailable() {\n-    try {\n-        require.resolve('ts-node');\n-        return true;\n-    }\n-    catch (_a) {\n-        return false;\n-    }\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * The filename expected for creating the ng-dev config, without the file\n- * extension to allow either a typescript or javascript file to be used.\n- */\n-var CONFIG_FILE_PATH = '.ng-dev/config';\n-/** The configuration for ng-dev. */\n-var cachedConfig = null;\n-function getConfig(baseDir) {\n-    // If the global config is not defined, load it from the file system.\n-    if (cachedConfig === null) {\n-        baseDir = baseDir || GitClient.get().baseDir;\n-        // The full path to the configuration file.\n-        var configPath = path.join(baseDir, CONFIG_FILE_PATH);\n-        // Read the configuration and validate it before caching it for the future.\n-        cachedConfig = validateCommonConfig(readConfigFile(configPath));\n-    }\n-    // Return a clone of the cached global config to ensure that a new instance of the config\n-    // is returned each time, preventing unexpected effects of modifications to the config object.\n-    return tslib.__assign({}, cachedConfig);\n-}\n-/** Validate the common configuration has been met for the ng-dev command. */\n-function validateCommonConfig(config) {\n-    var errors = [];\n-    // Validate the github configuration.\n-    if (config.github === undefined) {\n-        errors.push(\"Github repository not configured. Set the \\\"github\\\" option.\");\n-    }\n-    else {\n-        if (config.github.name === undefined) {\n-            errors.push(\"\\\"github.name\\\" is not defined\");\n-        }\n-        if (config.github.owner === undefined) {\n-            errors.push(\"\\\"github.owner\\\" is not defined\");\n-        }\n-    }\n-    assertNoErrors(errors);\n-    return config;\n-}\n-/**\n- * Resolves and reads the specified configuration file, optionally returning an empty object if the\n- * configuration file cannot be read.\n- */\n-function readConfigFile(configPath, returnEmptyObjectOnError) {\n-    if (returnEmptyObjectOnError === void 0) { returnEmptyObjectOnError = false; }\n-    // If the `.ts` extension has not been set up already, and a TypeScript based\n-    // version of the given configuration seems to exist, set up `ts-node` if available.\n-    if (require.extensions['.ts'] === undefined && fs.existsSync(configPath + \".ts\") &&\n-        isTsNodeAvailable()) {\n-        // Ensure the module target is set to `commonjs`. This is necessary because the\n-        // dev-infra tool runs in NodeJS which does not support ES modules by default.\n-        // Additionally, set the `dir` option to the directory that contains the configuration\n-        // file. This allows for custom compiler options (such as `--strict`).\n-        require('ts-node').register({ dir: path.dirname(configPath), transpileOnly: true, compilerOptions: { module: 'commonjs' } });\n-    }\n-    try {\n-        return require(configPath);\n-    }\n-    catch (e) {\n-        if (returnEmptyObjectOnError) {\n-            debug(\"Could not read configuration file at \" + configPath + \", returning empty object instead.\");\n-            debug(e);\n-            return {};\n-        }\n-        error(\"Could not read configuration file at \" + configPath + \".\");\n-        error(e);\n-        process.exit(1);\n-    }\n-}\n-/**\n- * Asserts the provided array of error messages is empty. If any errors are in the array,\n- * logs the errors and exit the process as a failure.\n- */\n-function assertNoErrors(errors) {\n-    var e_1, _a;\n-    if (errors.length == 0) {\n-        return;\n-    }\n-    error(\"Errors discovered while loading configuration file:\");\n-    try {\n-        for (var errors_1 = tslib.__values(errors), errors_1_1 = errors_1.next(); !errors_1_1.done; errors_1_1 = errors_1.next()) {\n-            var err = errors_1_1.value;\n-            error(\"  - \" + err);\n-        }\n-    }\n-    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n-    finally {\n-        try {\n-            if (errors_1_1 && !errors_1_1.done && (_a = errors_1.return)) _a.call(errors_1);\n-        }\n-        finally { if (e_1) throw e_1.error; }\n-    }\n-    process.exit(1);\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Retrieve and validate the config as `ReleaseConfig`. */\n-function getReleaseConfig(config = getConfig()) {\n-    var _a, _b, _c;\n-    // List of errors encountered validating the config.\n-    const errors = [];\n-    if (config.release === undefined) {\n-        errors.push(`No configuration defined for \"release\"`);\n-    }\n-    if (((_a = config.release) === null || _a === void 0 ? void 0 : _a.npmPackages) === undefined) {\n-        errors.push(`No \"npmPackages\" configured for releasing.`);\n-    }\n-    if (((_b = config.release) === null || _b === void 0 ? void 0 : _b.buildPackages) === undefined) {\n-        errors.push(`No \"buildPackages\" function configured for releasing.`);\n-    }\n-    if (((_c = config.release) === null || _c === void 0 ? void 0 : _c.releaseNotes) === undefined) {\n-        errors.push(`No \"releaseNotes\" configured for releasing.`);\n-    }\n-    assertNoErrors(errors);\n-    return config.release;\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-// Start the release package building.\n-main(process.argv[2] === 'true');\n-/** Main function for building the release packages. */\n-function main(stampForRelease) {\n-    return tslib.__awaiter(this, void 0, void 0, function* () {\n-        if (process.send === undefined) {\n-            throw Error('This script needs to be invoked as a NodeJS worker.');\n-        }\n-        const config = getReleaseConfig();\n-        const builtPackages = yield config.buildPackages(stampForRelease);\n-        // Transfer the built packages back to the parent process.\n-        process.send(builtPackages);\n-    });\n-}"
        },
        {
            "sha": "361b4c9ccec5579a0e9c846334d68c6f38f80e23",
            "filename": "dev-infra/caretaker/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,47 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"caretaker\",\n-    srcs = glob(\n-        [\"**/*.ts\"],\n-        exclude = [\"**/*.spec.ts\"],\n-    ),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/node-fetch\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//inquirer\",\n-        \"@npm//multimatch\",\n-        \"@npm//node-fetch\",\n-        \"@npm//typed-graphqlify\",\n-        \"@npm//yaml\",\n-        \"@npm//yargs\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    testonly = True,\n-    srcs = glob([\"**/*.spec.ts\"]),\n-    deps = [\n-        \":caretaker\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"//dev-infra/utils/testing\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//semver\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    deps = [\n-        \":test_lib\",\n-    ],\n-)"
        },
        {
            "sha": "0850d111173d1cd5a63e6dc51aacca3e9c25c7cc",
            "filename": "dev-infra/caretaker/check/base.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 42,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fbase.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fbase.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fbase.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,42 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {installVirtualGitClientSpies} from '../../utils/testing';\n-import {BaseModule} from './base';\n-\n-/** Data mocking as the \"retrieved data\". */\n-const exampleData = 'this is example data' as const;\n-\n-/** A simple usage of the BaseModule to illustrate the workings built into the abstract class. */\n-class ConcreteBaseModule extends BaseModule<typeof exampleData> {\n-  override async retrieveData() {\n-    return exampleData;\n-  }\n-  override async printToTerminal() {}\n-}\n-\n-describe('BaseModule', () => {\n-  let retrieveDataSpy: jasmine.Spy;\n-\n-  beforeEach(() => {\n-    retrieveDataSpy = spyOn(ConcreteBaseModule.prototype, 'retrieveData');\n-    installVirtualGitClientSpies();\n-  });\n-\n-  it('begins retrieving data during construction', () => {\n-    new ConcreteBaseModule({} as any);\n-\n-    expect(retrieveDataSpy).toHaveBeenCalled();\n-  });\n-\n-  it('makes the data available via the data attribute', async () => {\n-    retrieveDataSpy.and.callThrough();\n-    const module = new ConcreteBaseModule({} as any);\n-\n-    expect(await module.data).toBe(exampleData);\n-  });\n-});"
        },
        {
            "sha": "61ca5bbccbf858066ecc56e68b06c0442277ff38",
            "filename": "dev-infra/caretaker/check/base.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fbase.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fbase.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,27 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {NgDevConfig} from '../../utils/config';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {CaretakerConfig} from '../config';\n-\n-/** The BaseModule to extend modules for caretaker checks from. */\n-export abstract class BaseModule<Data> {\n-  /** The singleton instance of the authenticated git client. */\n-  protected git = AuthenticatedGitClient.get();\n-  /** The data for the module. */\n-  readonly data = this.retrieveData();\n-\n-  constructor(protected config: NgDevConfig<{caretaker: CaretakerConfig}>) {}\n-\n-  /** Asyncronously retrieve data for the module. */\n-  protected abstract retrieveData(): Promise<Data>;\n-\n-  /** Print the information discovered for the module to the terminal. */\n-  abstract printToTerminal(): Promise<void>;\n-}"
        },
        {
            "sha": "d4c4396be18fee6187aa064582950a16fa3f8175",
            "filename": "dev-infra/caretaker/check/check.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 39,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,39 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getCaretakerConfig} from '../config';\n-\n-import {CiModule} from './ci';\n-import {G3Module} from './g3';\n-import {GithubQueriesModule} from './github';\n-import {ServicesModule} from './services';\n-\n-/** List of modules checked for the caretaker check command. */\n-const moduleList = [\n-  GithubQueriesModule,\n-  ServicesModule,\n-  CiModule,\n-  G3Module,\n-];\n-\n-/** Check the status of services which Angular caretakers need to monitor. */\n-export async function checkServiceStatuses() {\n-  /** The configuration for the caretaker commands. */\n-  const config = getCaretakerConfig();\n-  /** List of instances of Caretaker Check modules */\n-  const caretakerCheckModules = moduleList.map(module => new module(config));\n-\n-  // Module's `data` is casted as Promise<unknown> because the data types of the `module`'s `data`\n-  // promises do not match typings, however our usage here is only to determine when the promise\n-  // resolves.\n-  await Promise.all(caretakerCheckModules.map(module => module.data as Promise<unknown>));\n-\n-  for (const module of caretakerCheckModules) {\n-    await module.printToTerminal();\n-  }\n-}"
        },
        {
            "sha": "4b21f0968b35e439edaf75a3a01df12d352e0a3c",
            "filename": "dev-infra/caretaker/check/ci.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 117,
            "changes": 117,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fci.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fci.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fci.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,117 +0,0 @@\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {SemVer} from 'semver';\n-\n-import {ReleaseTrain} from '../../release/versioning';\n-import * as versioning from '../../release/versioning/active-release-trains';\n-import * as console from '../../utils/console';\n-import {installVirtualGitClientSpies, mockNgDevConfig} from '../../utils/testing';\n-\n-import {CiModule} from './ci';\n-\n-describe('CiModule', () => {\n-  let fetchActiveReleaseTrainsSpy: jasmine.Spy;\n-  let getBranchStatusFromCiSpy: jasmine.Spy;\n-  let infoSpy: jasmine.Spy;\n-  let debugSpy: jasmine.Spy;\n-\n-  beforeEach(() => {\n-    installVirtualGitClientSpies();\n-    fetchActiveReleaseTrainsSpy = spyOn(versioning, 'fetchActiveReleaseTrains');\n-    getBranchStatusFromCiSpy = spyOn(CiModule.prototype, 'getBranchStatusFromCi' as any);\n-    infoSpy = spyOn(console, 'info');\n-    debugSpy = spyOn(console, 'debug');\n-  });\n-\n-  describe('getting data for active trains', () => {\n-    it('handles active rc train', async () => {\n-      const trains = buildMockActiveReleaseTrains(true);\n-      fetchActiveReleaseTrainsSpy.and.resolveTo(trains);\n-      const module = new CiModule({caretaker: {}, ...mockNgDevConfig});\n-      await module.data;\n-\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledWith(trains.releaseCandidate.branchName);\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledWith(trains.latest.branchName);\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledWith(trains.next.branchName);\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledTimes(3);\n-    });\n-\n-    it('handles an inactive rc train', async () => {\n-      const trains = buildMockActiveReleaseTrains(false);\n-      fetchActiveReleaseTrainsSpy.and.resolveTo(trains);\n-      const module = new CiModule({caretaker: {}, ...mockNgDevConfig});\n-      await module.data;\n-\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledWith(trains.latest.branchName);\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledWith(trains.next.branchName);\n-      expect(getBranchStatusFromCiSpy).toHaveBeenCalledTimes(2);\n-    });\n-\n-    it('aggregates information into a useful structure', async () => {\n-      const trains = buildMockActiveReleaseTrains(false);\n-      fetchActiveReleaseTrainsSpy.and.resolveTo(trains);\n-      getBranchStatusFromCiSpy.and.returnValue('success');\n-      const module = new CiModule({caretaker: {}, ...mockNgDevConfig});\n-      const data = await module.data;\n-\n-      expect(data[0]).toEqual(\n-          {active: false, name: 'releaseCandidate', label: '', status: 'not found'});\n-      expect(data[1]).toEqual({\n-        active: true,\n-        name: 'latest-branch',\n-        label: 'latest (latest-branch)',\n-        status: 'success',\n-      });\n-    });\n-  });\n-\n-  it('prints the data retrieved', async () => {\n-    const fakeData = Promise.resolve([\n-      {\n-        active: true,\n-        name: 'name0',\n-        label: 'label0',\n-        status: 'success',\n-      },\n-      {\n-        active: false,\n-        name: 'name1',\n-        label: 'label1',\n-        status: 'failed',\n-      },\n-    ]);\n-    fetchActiveReleaseTrainsSpy.and.resolveTo([]);\n-\n-    const module = new CiModule({caretaker: {}, ...mockNgDevConfig});\n-    Object.defineProperty(module, 'data', {value: fakeData});\n-\n-    await module.printToTerminal();\n-\n-    expect(debugSpy).toHaveBeenCalledWith('No active release train for name1');\n-    expect(infoSpy).toHaveBeenCalledWith('label0 ✅');\n-  });\n-});\n-\n-\n-/** Build a mock set of ActiveReleaseTrains. */\n-function buildMockActiveReleaseTrains(withRc: false): versioning.ActiveReleaseTrains&\n-    {releaseCandidate: null};\n-function buildMockActiveReleaseTrains(withRc: true): versioning.ActiveReleaseTrains&\n-    {releaseCandidate: ReleaseTrain};\n-function buildMockActiveReleaseTrains(withRc: boolean): versioning.ActiveReleaseTrains {\n-  const baseResult = {\n-    isMajor: false,\n-    version: new SemVer('0.0.0'),\n-  };\n-  return {\n-    releaseCandidate: withRc ? {branchName: 'rc-branch', ...baseResult} : null,\n-    latest: {branchName: 'latest-branch', ...baseResult},\n-    next: {branchName: 'next-branch', ...baseResult}\n-  };\n-}"
        },
        {
            "sha": "756a6ef32628dd48464f5a1021c018f908d21d75",
            "filename": "dev-infra/caretaker/check/ci.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 88,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fci.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fci.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fci.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,88 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import fetch from 'node-fetch';\n-import {fetchActiveReleaseTrains, ReleaseTrain} from '../../release/versioning/index';\n-\n-import {bold, debug, info} from '../../utils/console';\n-import {BaseModule} from './base';\n-\n-\n-/** The result of checking a branch on CI. */\n-type CiBranchStatus = 'success'|'failed'|'not found';\n-\n-/** A list of results for checking CI branches. */\n-type CiData = {\n-  active: boolean,\n-  name: string,\n-  label: string,\n-  status: CiBranchStatus,\n-}[];\n-\n-export class CiModule extends BaseModule<CiData> {\n-  override async retrieveData() {\n-    const gitRepoWithApi = {api: this.git.github, ...this.git.remoteConfig};\n-    const releaseTrains = await fetchActiveReleaseTrains(gitRepoWithApi);\n-\n-    const ciResultPromises = Object.entries(releaseTrains).map(async ([trainName, train]: [\n-                                                                 string, ReleaseTrain|null\n-                                                               ]) => {\n-      if (train === null) {\n-        return {\n-          active: false,\n-          name: trainName,\n-          label: '',\n-          status: 'not found' as const,\n-        };\n-      }\n-\n-      return {\n-        active: true,\n-        name: train.branchName,\n-        label: `${trainName} (${train.branchName})`,\n-        status: await this.getBranchStatusFromCi(train.branchName),\n-      };\n-    });\n-\n-    return await Promise.all(ciResultPromises);\n-  }\n-\n-  override async printToTerminal() {\n-    const data = await this.data;\n-    const minLabelLength = Math.max(...data.map(result => result.label.length));\n-    info.group(bold(`CI`));\n-    data.forEach(result => {\n-      if (result.active === false) {\n-        debug(`No active release train for ${result.name}`);\n-        return;\n-      }\n-      const label = result.label.padEnd(minLabelLength);\n-      if (result.status === 'not found') {\n-        info(`${result.name} was not found on CircleCI`);\n-      } else if (result.status === 'success') {\n-        info(`${label} ✅`);\n-      } else {\n-        info(`${label} ❌`);\n-      }\n-    });\n-    info.groupEnd();\n-    info();\n-  }\n-\n-  /** Get the CI status of a given branch from CircleCI. */\n-  private async getBranchStatusFromCi(branch: string): Promise<CiBranchStatus> {\n-    const {owner, name} = this.git.remoteConfig;\n-    const url = `https://circleci.com/gh/${owner}/${name}/tree/${branch}.svg?style=shield`;\n-    const result = await fetch(url).then(result => result.text());\n-\n-    if (result && !result.includes('no builds')) {\n-      return result.includes('passing') ? 'success' : 'failed';\n-    }\n-    return 'not found';\n-  }\n-}"
        },
        {
            "sha": "92343638ecb281a1ffa938a2fc204d489e1ecb5f",
            "filename": "dev-infra/caretaker/check/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Argv, CommandModule} from 'yargs';\n-\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-\n-import {checkServiceStatuses} from './check';\n-\n-\n-export interface CaretakerCheckOptions {\n-  githubToken: string;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return addGithubTokenOption(yargs);\n-}\n-\n-/** Handles the command. */\n-async function handler() {\n-  await checkServiceStatuses();\n-}\n-\n-/** yargs command module for checking status information for the repository  */\n-export const CheckModule: CommandModule<{}, CaretakerCheckOptions> = {\n-  handler,\n-  builder,\n-  command: 'check',\n-  describe: 'Check the status of information the caretaker manages for the repository',\n-};"
        },
        {
            "sha": "bd3483d485564b71a3ab76a85bf1ce891977f1e1",
            "filename": "dev-infra/caretaker/check/g3.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 109,
            "changes": 109,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,109 +0,0 @@\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {SpawnSyncReturns} from 'child_process';\n-\n-import * as console from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-import {installVirtualGitClientSpies, mockNgDevConfig} from '../../utils/testing';\n-\n-import {G3Module, G3StatsData} from './g3';\n-\n-describe('G3Module', () => {\n-  let getG3FileIncludeAndExcludeLists: jasmine.Spy;\n-  let getLatestShas: jasmine.Spy;\n-  let getDiffStats: jasmine.Spy;\n-  let infoSpy: jasmine.Spy;\n-\n-  beforeEach(() => {\n-    installVirtualGitClientSpies();\n-    getG3FileIncludeAndExcludeLists =\n-        spyOn(G3Module.prototype, 'getG3FileIncludeAndExcludeLists' as any).and.returnValue(null);\n-    getLatestShas = spyOn(G3Module.prototype, 'getLatestShas' as any).and.returnValue(null);\n-    getDiffStats = spyOn(G3Module.prototype, 'getDiffStats' as any).and.returnValue(null);\n-    infoSpy = spyOn(console, 'info');\n-  });\n-\n-  describe('gathering stats', () => {\n-    it('unless the g3 merge config is not defined in the angular robot file', async () => {\n-      getG3FileIncludeAndExcludeLists.and.returnValue(null);\n-      getLatestShas.and.returnValue({g3: 'abc123', master: 'zxy987'});\n-      const module = new G3Module({caretaker: {}, ...mockNgDevConfig});\n-\n-      expect(getDiffStats).not.toHaveBeenCalled();\n-      expect(await module.data).toBe(undefined);\n-    });\n-\n-    it('unless the branch shas are not able to be retrieved', async () => {\n-      getLatestShas.and.returnValue(null);\n-      getG3FileIncludeAndExcludeLists.and.returnValue({include: ['file1'], exclude: []});\n-      const module = new G3Module({caretaker: {}, ...mockNgDevConfig});\n-\n-      expect(getDiffStats).not.toHaveBeenCalled();\n-      expect(await module.data).toBe(undefined);\n-    });\n-\n-    it('for the files which are being synced to g3', async () => {\n-      getLatestShas.and.returnValue({g3: 'abc123', master: 'zxy987'});\n-      getG3FileIncludeAndExcludeLists.and.returnValue({include: ['project1/*'], exclude: []});\n-      getDiffStats.and.callThrough();\n-      spyOn(GitClient.prototype, 'run').and.callFake((args: string[]): any => {\n-        const output: Partial<SpawnSyncReturns<string>> = {};\n-        if (args[0] === 'rev-list') {\n-          output.stdout = '3';\n-        }\n-        if (args[0] === 'diff') {\n-          output.stdout = '5\\t6\\tproject1/file1\\n2\\t3\\tproject2/file2\\n7\\t1\\tproject1/file3\\n';\n-        }\n-        return output;\n-      });\n-\n-      const module = new G3Module({caretaker: {}, ...mockNgDevConfig});\n-      const {insertions, deletions, files, commits} = (await module.data) as G3StatsData;\n-\n-      expect(insertions).toBe(12);\n-      expect(deletions).toBe(7);\n-      expect(files).toBe(2);\n-      expect(commits).toBe(3);\n-    });\n-  });\n-\n-  describe('printing the data retrieved', () => {\n-    it('if files are discovered needing to sync', async () => {\n-      const fakeData = Promise.resolve({\n-        insertions: 25,\n-        deletions: 10,\n-        files: 2,\n-        commits: 2,\n-      });\n-\n-      const module = new G3Module({caretaker: {}, ...mockNgDevConfig});\n-      Object.defineProperty(module, 'data', {value: fakeData});\n-      await module.printToTerminal();\n-\n-      expect(infoSpy).toHaveBeenCalledWith(\n-          '2 files changed, 25 insertions(+), 10 deletions(-) from 2 commits will be included in the next sync');\n-    });\n-\n-    it('if no files need to sync', async () => {\n-      const fakeData = Promise.resolve({\n-        insertions: 0,\n-        deletions: 0,\n-        files: 0,\n-        commits: 25,\n-      });\n-\n-      const module = new G3Module({caretaker: {}, ...mockNgDevConfig});\n-      Object.defineProperty(module, 'data', {value: fakeData});\n-      await module.printToTerminal();\n-\n-      expect(infoSpy).toHaveBeenCalledWith('25 commits between g3 and master');\n-      expect(infoSpy).toHaveBeenCalledWith('✅  No sync is needed at this time');\n-    });\n-  });\n-});"
        },
        {
            "sha": "07349e50fd1ed31079371652a15fb0ea88175501",
            "filename": "dev-infra/caretaker/check/g3.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 156,
            "changes": 156,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,156 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {existsSync, readFileSync} from 'fs';\n-import * as multimatch from 'multimatch';\n-import {join} from 'path';\n-import {parse as parseYaml} from 'yaml';\n-import {bold, debug, info} from '../../utils/console';\n-\n-import {BaseModule} from './base';\n-\n-/** Information expressing the difference between the master and g3 branches */\n-export interface G3StatsData {\n-  insertions: number;\n-  deletions: number;\n-  files: number;\n-  commits: number;\n-}\n-\n-export class G3Module extends BaseModule<G3StatsData|void> {\n-  override async retrieveData() {\n-    const toCopyToG3 = this.getG3FileIncludeAndExcludeLists();\n-    const latestSha = this.getLatestShas();\n-\n-    if (toCopyToG3 === null || latestSha === null) {\n-      return;\n-    }\n-\n-    return this.getDiffStats(\n-        latestSha.g3, latestSha.master, toCopyToG3.include, toCopyToG3.exclude);\n-  }\n-\n-  override async printToTerminal() {\n-    const stats = await this.data;\n-    if (!stats) {\n-      return;\n-    }\n-    info.group(bold('g3 branch check'));\n-    if (stats.files === 0) {\n-      info(`${stats.commits} commits between g3 and master`);\n-      info('✅  No sync is needed at this time');\n-    } else {\n-      info(\n-          `${stats.files} files changed, ${stats.insertions} insertions(+), ${stats.deletions} ` +\n-          `deletions(-) from ${stats.commits} commits will be included in the next sync`);\n-    }\n-    info.groupEnd();\n-    info();\n-  }\n-\n-  /** Fetch and retrieve the latest sha for a specific branch. */\n-  private getShaForBranchLatest(branch: string) {\n-    const {owner, name} = this.git.remoteConfig;\n-    /** The result fo the fetch command. */\n-    const fetchResult =\n-        this.git.runGraceful(['fetch', '-q', `https://github.com/${owner}/${name}.git`, branch]);\n-\n-    if (fetchResult.status !== 0 &&\n-        fetchResult.stderr.includes(`couldn't find remote ref ${branch}`)) {\n-      debug(`No '${branch}' branch exists on upstream, skipping.`);\n-      return null;\n-    }\n-    return this.git.runGraceful(['rev-parse', 'FETCH_HEAD']).stdout.trim();\n-  }\n-\n-  /**\n-   * Get git diff stats between master and g3, for all files and filtered to only g3 affecting\n-   * files.\n-   */\n-  private getDiffStats(\n-      g3Ref: string, masterRef: string, includeFiles: string[], excludeFiles: string[]) {\n-    /** The diff stats to be returned. */\n-    const stats = {\n-      insertions: 0,\n-      deletions: 0,\n-      files: 0,\n-      commits: 0,\n-    };\n-\n-    // Determine the number of commits between master and g3 refs. */\n-    stats.commits =\n-        parseInt(this.git.run(['rev-list', '--count', `${g3Ref}..${masterRef}`]).stdout, 10);\n-\n-    // Get the numstat information between master and g3\n-    this.git.run(['diff', `${g3Ref}...${masterRef}`, '--numstat'])\n-        .stdout\n-        // Remove the extra space after git's output.\n-        .trim()\n-        // Split each line of git output into array\n-        .split('\\n')\n-        // Split each line from the git output into components parts: insertions,\n-        // deletions and file name respectively\n-        .map(line => line.trim().split('\\t'))\n-        // Parse number value from the insertions and deletions values\n-        // Example raw line input:\n-        //   10\\t5\\tsrc/file/name.ts\n-        .map(line => [Number(line[0]), Number(line[1]), line[2]] as [number, number, string])\n-        // Add each line's value to the diff stats, and conditionally to the g3\n-        // stats as well if the file name is included in the files synced to g3.\n-        .forEach(([insertions, deletions, fileName]) => {\n-          if (this.checkMatchAgainstIncludeAndExclude(fileName, includeFiles, excludeFiles)) {\n-            stats.insertions += insertions;\n-            stats.deletions += deletions;\n-            stats.files += 1;\n-          }\n-        });\n-    return stats;\n-  }\n-  /** Determine whether the file name passes both include and exclude checks. */\n-  private checkMatchAgainstIncludeAndExclude(file: string, includes: string[], excludes: string[]) {\n-    return (\n-        multimatch.call(undefined, file, includes).length >= 1 &&\n-        multimatch.call(undefined, file, excludes).length === 0);\n-  }\n-\n-\n-  private getG3FileIncludeAndExcludeLists() {\n-    const angularRobotFilePath = join(this.git.baseDir, '.github/angular-robot.yml');\n-    if (!existsSync(angularRobotFilePath)) {\n-      debug('No angular robot configuration file exists, skipping.');\n-      return null;\n-    }\n-    /** The configuration defined for the angular robot. */\n-    const robotConfig = parseYaml(readFileSync(angularRobotFilePath).toString());\n-    /** The files to be included in the g3 sync. */\n-    const include: string[] = robotConfig?.merge?.g3Status?.include || [];\n-    /** The files to be expected in the g3 sync. */\n-    const exclude: string[] = robotConfig?.merge?.g3Status?.exclude || [];\n-\n-    if (include.length === 0 && exclude.length === 0) {\n-      debug('No g3Status include or exclude lists are defined in the angular robot configuration');\n-      return null;\n-    }\n-\n-    return {include, exclude};\n-  }\n-\n-  private getLatestShas() {\n-    /** The latest sha for the g3 branch. */\n-    const g3 = this.getShaForBranchLatest('g3');\n-    /** The latest sha for the master branch. */\n-    const master = this.getShaForBranchLatest('master');\n-\n-    if (g3 === null || master === null) {\n-      debug('Either the g3 or master was unable to be retrieved');\n-      return null;\n-    }\n-\n-    return {g3, master};\n-  }\n-}"
        },
        {
            "sha": "08af371533bc910b313dbcc86c03259d21ea5743",
            "filename": "dev-infra/caretaker/check/github.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 119,
            "changes": 119,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,119 +0,0 @@\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as console from '../../utils/console';\n-import {AuthenticatedGithubClient, GithubClient} from '../../utils/git/github';\n-import {installVirtualGitClientSpies, mockNgDevConfig} from '../../utils/testing';\n-\n-import {GithubQueriesModule} from './github';\n-\n-describe('GithubQueriesModule', () => {\n-  let githubApiSpy: jasmine.Spy;\n-  let infoSpy: jasmine.Spy;\n-  let infoGroupSpy: jasmine.Spy;\n-\n-  beforeEach(() => {\n-    githubApiSpy = spyOn(AuthenticatedGithubClient.prototype, 'graphql')\n-                       .and.throwError(\n-                           'The graphql query response must always be manually defined in a test.');\n-    installVirtualGitClientSpies();\n-    infoGroupSpy = spyOn(console.info, 'group');\n-    infoSpy = spyOn(console, 'info');\n-  });\n-\n-  describe('gathering stats', () => {\n-    it('unless githubQueries are `undefined`', async () => {\n-      const module =\n-          new GithubQueriesModule({...mockNgDevConfig, caretaker: {githubQueries: undefined}});\n-\n-      expect(await module.data).toBe(undefined);\n-    });\n-\n-    it('unless githubQueries are an empty array', async () => {\n-      const module = new GithubQueriesModule({...mockNgDevConfig, caretaker: {githubQueries: []}});\n-\n-      expect(await module.data).toBe(undefined);\n-    });\n-\n-    it('for the requested Github queries', async () => {\n-      githubApiSpy.and.returnValue({\n-        'keynamewithspaces': {issueCount: 1, nodes: [{url: 'http://github.com/owner/name/issue/1'}]}\n-      });\n-      const module = new GithubQueriesModule({\n-        ...mockNgDevConfig,\n-        caretaker: {githubQueries: [{name: 'key name with spaces', query: 'issue: yes'}]}\n-      });\n-\n-      expect(await module.data).toEqual([{\n-        queryName: 'key name with spaces',\n-        count: 1,\n-        queryUrl: 'https://github.com/owner/name/issues?q=issue:%20yes',\n-        matchedUrls: ['http://github.com/owner/name/issue/1'],\n-      }]);\n-    });\n-  });\n-\n-  describe('printing the data retrieved', () => {\n-    it('if there are no matches of the query', async () => {\n-      const fakeData = Promise.resolve([\n-        {\n-          queryName: 'query1',\n-          count: 0,\n-          queryUrl: 'https://github.com/owner/name/issues?q=issue:%20no',\n-          matchedUrls: [],\n-        },\n-        {\n-          queryName: 'query2',\n-          count: 0,\n-          queryUrl: 'https://github.com/owner/name/issues?q=something',\n-          matchedUrls: [],\n-        },\n-      ]);\n-\n-\n-      const module = new GithubQueriesModule({caretaker: {}, ...mockNgDevConfig});\n-      Object.defineProperty(module, 'data', {value: fakeData});\n-\n-      await module.printToTerminal();\n-\n-\n-      expect(infoGroupSpy).toHaveBeenCalledWith('Github Tasks');\n-      expect(infoSpy).toHaveBeenCalledWith('query1  0');\n-      expect(infoSpy).toHaveBeenCalledWith('query2  0');\n-    });\n-\n-    it('if there are maches of the query', async () => {\n-      const fakeData = Promise.resolve([\n-        {\n-          queryName: 'query1',\n-          count: 1,\n-          queryUrl: 'https://github.com/owner/name/issues?q=issue:%20yes',\n-          matchedUrls: ['http://github.com/owner/name/issue/1'],\n-        },\n-        {\n-          queryName: 'query2',\n-          count: 0,\n-          queryUrl: 'https://github.com/owner/name/issues?q=something',\n-          matchedUrls: [],\n-        },\n-      ]);\n-\n-      const module = new GithubQueriesModule({caretaker: {}, ...mockNgDevConfig});\n-      Object.defineProperty(module, 'data', {value: fakeData});\n-\n-      await module.printToTerminal();\n-\n-      expect(infoGroupSpy).toHaveBeenCalledWith('Github Tasks');\n-      expect(infoSpy).toHaveBeenCalledWith('query1  1');\n-      expect(infoGroupSpy)\n-          .toHaveBeenCalledWith('https://github.com/owner/name/issues?q=issue:%20yes');\n-      expect(infoSpy).toHaveBeenCalledWith('- http://github.com/owner/name/issue/1');\n-      expect(infoSpy).toHaveBeenCalledWith('query2  0');\n-    });\n-  });\n-});"
        },
        {
            "sha": "7075ce2ed097a5c2303d58149f98c0bb3c0227b0",
            "filename": "dev-infra/caretaker/check/github.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 120,
            "changes": 120,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,120 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {alias, onUnion, params, types} from 'typed-graphqlify';\n-\n-import {bold, debug, info} from '../../utils/console';\n-import {CaretakerConfig} from '../config';\n-import {BaseModule} from './base';\n-\n-/** A list of generated results for a github query. */\n-type GithubQueryResults = {\n-  queryName: string,\n-  count: number,\n-  queryUrl: string,\n-  matchedUrls: string[],\n-}[];\n-\n-/** The fragment for a result from Github's api for a Github query. */\n-const GithubQueryResultFragment = {\n-  issueCount: types.number,\n-  nodes: [{...onUnion({\n-    PullRequest: {\n-      url: types.string,\n-    },\n-    Issue: {\n-      url: types.string,\n-    },\n-  })}],\n-};\n-\n-/** An object containing results of multiple queries.  */\n-type GithubQueryResult = {\n-  [key: string]: typeof GithubQueryResultFragment;\n-};\n-\n-/**\n- * Cap the returned issues in the queries to an arbitrary 20. At that point, caretaker has a lot\n- * of work to do and showing more than that isn't really useful.\n- */\n-const MAX_RETURNED_ISSUES = 20;\n-\n-export class GithubQueriesModule extends BaseModule<GithubQueryResults|void> {\n-  override async retrieveData() {\n-    // Non-null assertion is used here as the check for undefined immediately follows to confirm the\n-    // assertion.  Typescript's type filtering does not seem to work as needed to understand\n-    // whether githubQueries is undefined or not.\n-    let queries = this.config.caretaker?.githubQueries!;\n-    if (queries === undefined || queries.length === 0) {\n-      debug('No github queries defined in the configuration, skipping');\n-      return;\n-    }\n-\n-    /** The results of the generated github query. */\n-    const queryResult = await this.git.github.graphql(this.buildGraphqlQuery(queries));\n-    const results = Object.values(queryResult);\n-\n-    const {owner, name: repo} = this.git.remoteConfig;\n-\n-    return results.map((result, i) => {\n-      return {\n-        queryName: queries[i].name,\n-        count: result.issueCount,\n-        queryUrl: encodeURI(`https://github.com/${owner}/${repo}/issues?q=${queries[i].query}`),\n-        matchedUrls: result.nodes.map(node => node.url)\n-      };\n-    });\n-  }\n-\n-  /** Build a Graphql query statement for the provided queries. */\n-  private buildGraphqlQuery(queries: NonNullable<CaretakerConfig['githubQueries']>) {\n-    /** The query object for graphql. */\n-    const graphqlQuery: GithubQueryResult = {};\n-    const {owner, name: repo} = this.git.remoteConfig;\n-    /** The Github search filter for the configured repository. */\n-    const repoFilter = `repo:${owner}/${repo}`;\n-\n-\n-    queries.forEach(({name, query}) => {\n-      /** The name of the query, with spaces removed to match Graphql requirements. */\n-      const queryKey = alias(name.replace(/ /g, ''), 'search');\n-      graphqlQuery[queryKey] = params(\n-          {\n-            type: 'ISSUE',\n-            first: MAX_RETURNED_ISSUES,\n-            query: `\"${repoFilter} ${query.replace(/\"/g, '\\\\\"')}\"`,\n-          },\n-          {...GithubQueryResultFragment});\n-    });\n-\n-    return graphqlQuery;\n-  }\n-\n-  override async printToTerminal() {\n-    const queryResults = await this.data;\n-    if (!queryResults) {\n-      return;\n-    }\n-    info.group(bold('Github Tasks'));\n-    const minQueryNameLength = Math.max(...queryResults.map(result => result.queryName.length));\n-    for (const queryResult of queryResults) {\n-      info(`${queryResult.queryName.padEnd(minQueryNameLength)}  ${queryResult.count}`);\n-\n-      if (queryResult.count > 0) {\n-        info.group(queryResult.queryUrl);\n-        queryResult.matchedUrls.forEach(url => info(`- ${url}`));\n-        if (queryResult.count > MAX_RETURNED_ISSUES) {\n-          info(`... ${queryResult.count - MAX_RETURNED_ISSUES} additional matches`);\n-        }\n-        info.groupEnd();\n-      }\n-    }\n-    info.groupEnd();\n-    info();\n-  }\n-}"
        },
        {
            "sha": "6c4688fe7d8226b96c364180f7318e39727a5de4",
            "filename": "dev-infra/caretaker/check/services.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 68,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fservices.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,68 +0,0 @@\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as console from '../../utils/console';\n-import {installVirtualGitClientSpies, mockNgDevConfig} from '../../utils/testing';\n-\n-import {services, ServicesModule} from './services';\n-\n-describe('ServicesModule', () => {\n-  let getStatusFromStandardApiSpy: jasmine.Spy;\n-  let infoSpy: jasmine.Spy;\n-  let infoGroupSpy: jasmine.Spy;\n-\n-  services.splice(0, Infinity, {url: 'fakeStatus.com/api.json', name: 'Service Name'});\n-\n-  beforeEach(() => {\n-    getStatusFromStandardApiSpy = spyOn(ServicesModule.prototype, 'getStatusFromStandardApi');\n-    installVirtualGitClientSpies();\n-    infoGroupSpy = spyOn(console.info, 'group');\n-    infoSpy = spyOn(console, 'info');\n-  });\n-\n-  describe('gathering status', () => {\n-    it('for each of the services', async () => {\n-      new ServicesModule({caretaker: {}, ...mockNgDevConfig});\n-\n-      expect(getStatusFromStandardApiSpy)\n-          .toHaveBeenCalledWith({url: 'fakeStatus.com/api.json', name: 'Service Name'});\n-    });\n-  });\n-\n-  describe('printing the data retrieved', () => {\n-    it('for each service ', async () => {\n-      const fakeData = Promise.resolve([\n-        {\n-          name: 'Service 1',\n-          status: 'passing',\n-          description: 'Everything is working great',\n-          lastUpdated: new Date(0),\n-        },\n-        {\n-          name: 'Service 2',\n-          status: 'failing',\n-          description: 'Literally everything is broken',\n-          lastUpdated: new Date(0),\n-        },\n-      ]);\n-\n-\n-      const module = new ServicesModule({caretaker: {}, ...mockNgDevConfig});\n-      Object.defineProperty(module, 'data', {value: fakeData});\n-      await module.printToTerminal();\n-\n-\n-      expect(infoGroupSpy).toHaveBeenCalledWith('Service Statuses');\n-      expect(infoSpy).toHaveBeenCalledWith('Service 1 ✅');\n-      expect(infoGroupSpy)\n-          .toHaveBeenCalledWith(`Service 2 ❌ (Updated: ${new Date(0).toLocaleString()})`);\n-      expect(infoSpy).toHaveBeenCalledWith('  Details: Literally everything is broken');\n-    });\n-  });\n-});"
        },
        {
            "sha": "46364263a366357d51261358ed8c3a2279d302e1",
            "filename": "dev-infra/caretaker/check/services.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 81,
            "changes": 81,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,81 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import fetch from 'node-fetch';\n-\n-import {bold, info} from '../../utils/console';\n-import {BaseModule} from './base';\n-\n-interface ServiceConfig {\n-  name: string;\n-  url: string;\n-}\n-\n-/** The results of checking the status of a service */\n-interface StatusCheckResult {\n-  name: string;\n-  status: 'passing'|'failing';\n-  description: string;\n-  lastUpdated: Date;\n-}\n-\n-/** List of services Angular relies on. */\n-export const services: ServiceConfig[] = [\n-  {\n-    url: 'https://status.us-west-1.saucelabs.com/api/v2/status.json',\n-    name: 'Saucelabs',\n-  },\n-  {\n-    url: 'https://status.npmjs.org/api/v2/status.json',\n-    name: 'Npm',\n-  },\n-  {\n-    url: 'https://status.circleci.com/api/v2/status.json',\n-    name: 'CircleCi',\n-  },\n-  {\n-    url: 'https://www.githubstatus.com/api/v2/status.json',\n-    name: 'Github',\n-  },\n-];\n-\n-export class ServicesModule extends BaseModule<StatusCheckResult[]> {\n-  override async retrieveData() {\n-    return Promise.all(services.map(service => this.getStatusFromStandardApi(service)));\n-  }\n-\n-  override async printToTerminal() {\n-    const statuses = await this.data;\n-    const serviceNameMinLength = Math.max(...statuses.map(service => service.name.length));\n-    info.group(bold('Service Statuses'));\n-    for (const status of statuses) {\n-      const name = status.name.padEnd(serviceNameMinLength);\n-      if (status.status === 'passing') {\n-        info(`${name} ✅`);\n-      } else {\n-        info.group(`${name} ❌ (Updated: ${status.lastUpdated.toLocaleString()})`);\n-        info(`  Details: ${status.description}`);\n-        info.groupEnd();\n-      }\n-    }\n-    info.groupEnd();\n-    info();\n-  }\n-\n-  /** Retrieve the status information for a service which uses a standard API response. */\n-  async getStatusFromStandardApi(service: ServiceConfig): Promise<StatusCheckResult> {\n-    const result = await fetch(service.url).then(result => result.json());\n-    const status = result.status.indicator === 'none' ? 'passing' : 'failing';\n-    return {\n-      name: service.name,\n-      status,\n-      description: result.status.description,\n-      lastUpdated: new Date(result.page.updated_at)\n-    };\n-  }\n-}"
        },
        {
            "sha": "8a589c43db5a342091fdd745a445bd91be37e3c9",
            "filename": "dev-infra/caretaker/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Argv} from 'yargs';\n-import {CheckModule} from './check/cli';\n-import {HandoffModule} from './handoff/cli';\n-\n-\n-/** Build the parser for the caretaker commands. */\n-export function buildCaretakerParser(yargs: Argv) {\n-  return yargs.command(CheckModule).command(HandoffModule);\n-}"
        },
        {
            "sha": "027158e1e39a6abbb387065dc87fe41d9e2b726e",
            "filename": "dev-infra/caretaker/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,30 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n-\n-export interface CaretakerConfig {\n-  /** Github queries showing a snapshot of pulls/issues caretakers need to monitor. */\n-  githubQueries?: {name: string; query: string;}[];\n-  /**\n-   * The Github group used to track current caretakers. A second group is assumed to exist with the\n-   * name \"<group-name>-roster\" containing a list of all users eligible for the caretaker group.\n-   * */\n-  caretakerGroup?: string;\n-}\n-\n-/** Retrieve and validate the config as `CaretakerConfig`. */\n-export function getCaretakerConfig() {\n-  // List of errors encountered validating the config.\n-  const errors: string[] = [];\n-  // The non-validated config object.\n-  const config: Partial<NgDevConfig<{caretaker: CaretakerConfig}>> = getConfig();\n-\n-  assertNoErrors(errors);\n-  return config as Required<typeof config>;\n-}"
        },
        {
            "sha": "a59fc824803efea2ce07b09455371628ab5c8a0b",
            "filename": "dev-infra/caretaker/handoff/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fhandoff%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fhandoff%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fhandoff%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Argv, CommandModule} from 'yargs';\n-\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-\n-import {updateCaretakerTeamViaPrompt} from './update-github-team';\n-\n-\n-export interface CaretakerHandoffOptions {\n-  githubToken: string;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return addGithubTokenOption(yargs);\n-}\n-\n-/** Handles the command. */\n-async function handler() {\n-  await updateCaretakerTeamViaPrompt();\n-}\n-\n-/** yargs command module for assisting in handing off caretaker.  */\n-export const HandoffModule: CommandModule<{}, CaretakerHandoffOptions> = {\n-  handler,\n-  builder,\n-  command: 'handoff',\n-  describe: 'Run a handoff assistant to aide in moving to the next caretaker',\n-};"
        },
        {
            "sha": "337ff7d2583d63462958dca8f6f722a32cc8fb8e",
            "filename": "dev-infra/caretaker/handoff/update-github-team.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 132,
            "changes": 132,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fhandoff%2Fupdate-github-team.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcaretaker%2Fhandoff%2Fupdate-github-team.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fhandoff%2Fupdate-github-team.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,132 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {prompt} from 'inquirer';\n-\n-import {debug, green, info, red, yellow} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {getCaretakerConfig} from '../config';\n-\n-/** Update the Github caretaker group, using a prompt to obtain the new caretaker group members.  */\n-export async function updateCaretakerTeamViaPrompt() {\n-  /** Caretaker specific configuration. */\n-  const caretakerConfig = getCaretakerConfig().caretaker;\n-\n-  if (caretakerConfig.caretakerGroup === undefined) {\n-    throw Error('`caretakerGroup` is not defined in the `caretaker` config');\n-  }\n-\n-  /** The list of current members in the group. */\n-  const current = await getGroupMembers(caretakerConfig.caretakerGroup);\n-  /** The list of members able to be added to the group as defined by a separate roster group. */\n-  const roster = await getGroupMembers(`${caretakerConfig.caretakerGroup}-roster`);\n-  const {\n-    /** The list of users selected to be members of the caretaker group. */\n-    selected,\n-    /** Whether the user positively confirmed the selected made. */\n-    confirm\n-  } =\n-      await prompt([\n-        {\n-          type: 'checkbox',\n-          choices: roster,\n-          message: 'Select 2 caretakers for the upcoming rotation:',\n-          default: current,\n-          name: 'selected',\n-          prefix: '',\n-          validate: (selected: string[]) => {\n-            if (selected.length !== 2) {\n-              return 'Please select exactly 2 caretakers for the upcoming rotation.';\n-            }\n-            return true;\n-          },\n-        },\n-        {\n-          type: 'confirm',\n-          default: true,\n-          prefix: '',\n-          message: 'Are you sure?',\n-          name: 'confirm',\n-        }\n-      ]);\n-\n-  if (confirm === false) {\n-    info(yellow('  ⚠  Skipping caretaker group update.'));\n-    return;\n-  }\n-\n-  if (JSON.stringify(selected) === JSON.stringify(current)) {\n-    info(green('  √  Caretaker group already up to date.'));\n-    return;\n-  }\n-\n-  try {\n-    await setCaretakerGroup(caretakerConfig.caretakerGroup, selected);\n-  } catch {\n-    info(red('  ✘  Failed to update caretaker group.'));\n-    return;\n-  }\n-  info(green('  √  Successfully updated caretaker group'));\n-}\n-\n-\n-/** Retrieve the current list of members for the provided group. */\n-async function getGroupMembers(group: string) {\n-  /** The authenticated GitClient instance. */\n-  const git = AuthenticatedGitClient.get();\n-\n-  return (await git.github.teams.listMembersInOrg({\n-           org: git.remoteConfig.owner,\n-           team_slug: group,\n-         }))\n-      .data.filter(_ => !!_)\n-      .map(member => member!.login);\n-}\n-\n-async function setCaretakerGroup(group: string, members: string[]) {\n-  /** The authenticated GitClient instance. */\n-  const git = AuthenticatedGitClient.get();\n-  /** The full name of the group <org>/<group name>. */\n-  const fullSlug = `${git.remoteConfig.owner}/${group}`;\n-  /** The list of current members of the group. */\n-  const current = await getGroupMembers(group);\n-  /** The list of users to be removed from the group. */\n-  const removed = current.filter(login => !members.includes(login));\n-  /** Add a user to the group. */\n-  const add = async (username: string) => {\n-    debug(`Adding ${username} to ${fullSlug}.`);\n-    await git.github.teams.addOrUpdateMembershipForUserInOrg({\n-      org: git.remoteConfig.owner,\n-      team_slug: group,\n-      username,\n-      role: 'maintainer',\n-    });\n-  };\n-  /** Remove a user from the group. */\n-  const remove = async (username: string) => {\n-    debug(`Removing ${username} from ${fullSlug}.`);\n-    await git.github.teams.removeMembershipForUserInOrg({\n-      org: git.remoteConfig.owner,\n-      team_slug: group,\n-      username,\n-    });\n-  };\n-\n-  debug.group(`Caretaker Group: ${fullSlug}`);\n-  debug(`Current Membership: ${current.join(', ')}`);\n-  debug(`New Membership:     ${members.join(', ')}`);\n-  debug(`Removed:            ${removed.join(', ')}`);\n-  debug.groupEnd();\n-\n-  // Add members before removing to prevent the account performing the action from removing their\n-  // permissions to change the group membership early.\n-  await Promise.all(members.map(add));\n-  await Promise.all(removed.map(remove));\n-\n-  debug(`Successfuly updated ${fullSlug}`);\n-}"
        },
        {
            "sha": "6bfd94274ef248d63c74b6007b3cede24ed41b2a",
            "filename": "dev-infra/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 37,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,37 +0,0 @@\n-#!/usr/bin/env node\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-\n-import {buildCaretakerParser} from './caretaker/cli';\n-import {buildCommitMessageParser} from './commit-message/cli';\n-import {buildFormatParser} from './format/cli';\n-import {buildNgbotParser} from './ngbot/cli';\n-import {buildPrParser} from './pr/cli';\n-import {buildPullapproveParser} from './pullapprove/cli';\n-import {buildReleaseParser} from './release/cli';\n-import {tsCircularDependenciesBuilder} from './ts-circular-dependencies/index';\n-import {captureLogOutputForCommand} from './utils/console';\n-import {buildMiscParser} from './misc/cli';\n-\n-yargs.scriptName('ng-dev')\n-    .middleware(captureLogOutputForCommand)\n-    .demandCommand()\n-    .recommendCommands()\n-    .command('commit-message <command>', '', buildCommitMessageParser)\n-    .command('format <command>', '', buildFormatParser)\n-    .command('pr <command>', '', buildPrParser)\n-    .command('pullapprove <command>', '', buildPullapproveParser)\n-    .command('release <command>', '', buildReleaseParser)\n-    .command('ts-circular-deps <command>', '', tsCircularDependenciesBuilder)\n-    .command('caretaker <command>', '', buildCaretakerParser)\n-    .command('misc <command>', '', buildMiscParser)\n-    .command('ngbot <command>', false, buildNgbotParser)\n-    .wrap(120)\n-    .strict()\n-    .parse();"
        },
        {
            "sha": "abb734a839c2b1a4432132c4f9e2b07ee7f2d0d1",
            "filename": "dev-infra/commit-message-filter.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message-filter.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message-filter.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message-filter.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1 +0,0 @@\n-pr/merge/strategies/commit-message-filter.js\n\\ No newline at end of file"
        },
        {
            "sha": "e0299445f8fd0c64a21c8d5b99d715fa362fe0c5",
            "filename": "dev-infra/commit-message/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"commit-message\",\n-    srcs = glob(\n-        [\"**/*.ts\"],\n-        exclude = [\"**/*.spec.ts\"],\n-    ),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/conventional-commits-parser\",\n-        \"@npm//@types/git-raw-commits\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//conventional-commits-parser\",\n-        \"@npm//git-raw-commits\",\n-        \"@npm//inquirer\",\n-        \"@npm//yargs\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    testonly = True,\n-    srcs = glob([\"**/*.spec.ts\"]),\n-    deps = [\n-        \":commit-message\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/events\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-        \"@npm//inquirer\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    deps = [\n-        \":test_lib\",\n-    ],\n-)"
        },
        {
            "sha": "0ed65b71e3d295dd8562a7839912e118fff54bac",
            "filename": "dev-infra/commit-message/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-\n-import {RestoreCommitMessageModule} from './restore-commit-message/cli';\n-import {ValidateFileModule} from './validate-file/cli';\n-import {ValidateRangeModule} from './validate-range/cli';\n-\n-/** Build the parser for the commit-message commands. */\n-export function buildCommitMessageParser(localYargs: yargs.Argv) {\n-  return localYargs.help()\n-      .strict()\n-      .command(RestoreCommitMessageModule)\n-      .command(ValidateFileModule)\n-      .command(ValidateRangeModule);\n-}"
        },
        {
            "sha": "e0f24a5bf728f07754be960f2ce7494a4c6cf3b8",
            "filename": "dev-infra/commit-message/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 110,
            "changes": 110,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,110 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n-\n-/** Configuration for commit-message comands. */\n-export interface CommitMessageConfig {\n-  maxLineLength: number;\n-  minBodyLength: number;\n-  minBodyLengthTypeExcludes?: string[];\n-  scopes: string[];\n-}\n-\n-/** Retrieve and validate the config as `CommitMessageConfig`. */\n-export function getCommitMessageConfig() {\n-  // List of errors encountered validating the config.\n-  const errors: string[] = [];\n-  // The non-validated config object.\n-  const config: Partial<NgDevConfig<{commitMessage: CommitMessageConfig}>> = getConfig();\n-\n-  if (config.commitMessage === undefined) {\n-    errors.push(`No configuration defined for \"commitMessage\"`);\n-  }\n-\n-  assertNoErrors(errors);\n-  return config as Required<typeof config>;\n-}\n-\n-/** Scope requirement level to be set for each commit type. */\n-export enum ScopeRequirement {\n-  Required,\n-  Optional,\n-  Forbidden,\n-}\n-\n-export enum ReleaseNotesLevel {\n-  Hidden,\n-  Visible,\n-}\n-\n-/** A commit type */\n-export interface CommitType {\n-  description: string;\n-  name: string;\n-  scope: ScopeRequirement;\n-  releaseNotesLevel: ReleaseNotesLevel;\n-}\n-\n-/** The valid commit types for Angular commit messages. */\n-export const COMMIT_TYPES: {[key: string]: CommitType} = {\n-  build: {\n-    name: 'build',\n-    description: 'Changes to local repository build system and tooling',\n-    scope: ScopeRequirement.Optional,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-  ci: {\n-    name: 'ci',\n-    description: 'Changes to CI configuration and CI specific tooling',\n-    scope: ScopeRequirement.Forbidden,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-  docs: {\n-    name: 'docs',\n-    description: 'Changes which exclusively affects documentation.',\n-    scope: ScopeRequirement.Optional,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-  feat: {\n-    name: 'feat',\n-    description: 'Creates a new feature',\n-    scope: ScopeRequirement.Required,\n-    releaseNotesLevel: ReleaseNotesLevel.Visible,\n-  },\n-  fix: {\n-    name: 'fix',\n-    description: 'Fixes a previously discovered failure/bug',\n-    scope: ScopeRequirement.Required,\n-    releaseNotesLevel: ReleaseNotesLevel.Visible,\n-  },\n-  perf: {\n-    name: 'perf',\n-    description: 'Improves performance without any change in functionality or API',\n-    scope: ScopeRequirement.Required,\n-    releaseNotesLevel: ReleaseNotesLevel.Visible,\n-  },\n-  refactor: {\n-    name: 'refactor',\n-    description: 'Refactor without any change in functionality or API (includes style changes)',\n-    scope: ScopeRequirement.Optional,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-  release: {\n-    name: 'release',\n-    description: 'A release point in the repository',\n-    scope: ScopeRequirement.Forbidden,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-  test: {\n-    name: 'test',\n-    description: 'Improvements or corrections made to the project\\'s test suite',\n-    scope: ScopeRequirement.Optional,\n-    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n-  },\n-};"
        },
        {
            "sha": "e7f6924fa6d77fdcb9e7f1279922ab91af13736c",
            "filename": "dev-infra/commit-message/parse.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 190,
            "changes": 190,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,190 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {parseCommitMessage} from './parse';\n-import {commitMessageBuilder, CommitMessageParts} from './test-util';\n-\n-const commitValues: CommitMessageParts = {\n-  prefix: '',\n-  type: 'fix',\n-  npmScope: '',\n-  scope: 'changed-area',\n-  summary: 'This is a short summary of the change',\n-  body: 'This is a longer description of the change',\n-  footer: 'Closes #1',\n-};\n-\n-const buildCommitMessage = commitMessageBuilder(commitValues);\n-\n-\n-describe('commit message parsing:', () => {\n-  describe('parses the scope', () => {\n-    it('when only a scope is defined', () => {\n-      const message = buildCommitMessage();\n-      expect(parseCommitMessage(message).scope).toBe(commitValues.scope);\n-      expect(parseCommitMessage(message).npmScope).toBe('');\n-    });\n-\n-    it('when an npmScope and scope are defined', () => {\n-      const message = buildCommitMessage({npmScope: 'myNpmPackage'});\n-      expect(parseCommitMessage(message).scope).toBe(commitValues.scope);\n-      expect(parseCommitMessage(message).npmScope).toBe('myNpmPackage');\n-    });\n-  });\n-\n-  it('parses the type', () => {\n-    const message = buildCommitMessage();\n-    expect(parseCommitMessage(message).type).toBe(commitValues.type);\n-  });\n-\n-  it('parses the header', () => {\n-    const message = buildCommitMessage();\n-    expect(parseCommitMessage(message).header)\n-        .toBe(`${commitValues.type}(${commitValues.scope}): ${commitValues.summary}`);\n-  });\n-\n-  it('parses the body', () => {\n-    const message = buildCommitMessage();\n-    expect(parseCommitMessage(message).body).toBe(commitValues.body);\n-  });\n-\n-  it('parses the subject', () => {\n-    const message = buildCommitMessage();\n-    expect(parseCommitMessage(message).subject).toBe(commitValues.summary);\n-  });\n-\n-  it('identifies if a commit is a fixup', () => {\n-    const message1 = buildCommitMessage();\n-    expect(parseCommitMessage(message1).isFixup).toBe(false);\n-\n-    const message2 = buildCommitMessage({prefix: 'fixup! '});\n-    expect(parseCommitMessage(message2).isFixup).toBe(true);\n-  });\n-\n-  it('identifies if a commit is a revert', () => {\n-    const message1 = buildCommitMessage();\n-    expect(parseCommitMessage(message1).isRevert).toBe(false);\n-\n-    const message2 = buildCommitMessage({prefix: 'revert: '});\n-    expect(parseCommitMessage(message2).isRevert).toBe(true);\n-\n-    const message3 = buildCommitMessage({prefix: 'revert '});\n-    expect(parseCommitMessage(message3).isRevert).toBe(true);\n-  });\n-\n-  it('identifies if a commit is a squash', () => {\n-    const message1 = buildCommitMessage();\n-    expect(parseCommitMessage(message1).isSquash).toBe(false);\n-\n-    const message2 = buildCommitMessage({prefix: 'squash! '});\n-    expect(parseCommitMessage(message2).isSquash).toBe(true);\n-  });\n-\n-  it('ignores comment lines', () => {\n-    const message = buildCommitMessage({\n-      prefix: '# This is a comment line before the header.\\n' +\n-          '## This is another comment line before the headers.\\n',\n-      body: '# This is a comment line befor the body.\\n' +\n-          'This is line 1 of the actual body.\\n' +\n-          '## This is another comment line inside the body.\\n' +\n-          'This is line 2 of the actual body (and it also contains a # but it not a comment).\\n' +\n-          '### This is yet another comment line after the body.\\n',\n-    });\n-    const parsedMessage = parseCommitMessage(message);\n-\n-    expect(parsedMessage.header)\n-        .toBe(`${commitValues.type}(${commitValues.scope}): ${commitValues.summary}`);\n-    expect(parsedMessage.body)\n-        .toBe(\n-            'This is line 1 of the actual body.\\n' +\n-            'This is line 2 of the actual body (and it also contains a # but it not a comment).');\n-  });\n-\n-  describe('parses breaking change notes', () => {\n-    const summary = 'This breaks things';\n-    const description = 'This is how it breaks things.';\n-\n-    it('when only a summary is provided', () => {\n-      const message = buildCommitMessage({\n-        footer: `BREAKING CHANGE: ${summary}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.breakingChanges[0].text).toBe(summary);\n-      expect(parsedMessage.breakingChanges.length).toBe(1);\n-    });\n-\n-    it('when only a description is provided', () => {\n-      const message = buildCommitMessage({\n-        footer: `BREAKING CHANGE:\\n\\n${description}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.breakingChanges[0].text).toBe(description);\n-      expect(parsedMessage.breakingChanges.length).toBe(1);\n-    });\n-\n-    it('when a summary and description are provied', () => {\n-      const message = buildCommitMessage({\n-        footer: `BREAKING CHANGE: ${summary}\\n\\n${description}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.breakingChanges[0].text).toBe(`${summary}\\n\\n${description}`);\n-      expect(parsedMessage.breakingChanges.length).toBe(1);\n-    });\n-\n-    it('only when keyword is at the beginning of a line', () => {\n-      const message = buildCommitMessage({\n-        body: 'This changes how the `BREAKING CHANGE: ` commit message note\\n' +\n-            'keyword is detected for the changelog.',\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.breakingChanges.length).toBe(0);\n-    });\n-  });\n-\n-  describe('parses deprecation notes', () => {\n-    const summary = 'This will break things later';\n-    const description = 'This is a long winded explanation of why it \\nwill break things later.';\n-\n-\n-    it('when only a summary is provided', () => {\n-      const message = buildCommitMessage({\n-        footer: `DEPRECATED: ${summary}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.deprecations[0].text).toBe(summary);\n-      expect(parsedMessage.deprecations.length).toBe(1);\n-    });\n-\n-    it('when only a description is provided', () => {\n-      const message = buildCommitMessage({\n-        footer: `DEPRECATED:\\n\\n${description}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.deprecations[0].text).toBe(description);\n-      expect(parsedMessage.deprecations.length).toBe(1);\n-    });\n-\n-    it('when a summary and description are provied', () => {\n-      const message = buildCommitMessage({\n-        footer: `DEPRECATED: ${summary}\\n\\n${description}`,\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.deprecations[0].text).toBe(`${summary}\\n\\n${description}`);\n-      expect(parsedMessage.deprecations.length).toBe(1);\n-    });\n-\n-    it('only when keyword is at the beginning of a line', () => {\n-      const message = buildCommitMessage({\n-        body: 'This changes how the `DEPRECATED: ` commit message note\\n' +\n-            'keyword is detected for the changelog.',\n-      });\n-      const parsedMessage = parseCommitMessage(message);\n-      expect(parsedMessage.deprecations.length).toBe(0);\n-    });\n-  });\n-});"
        },
        {
            "sha": "0cebcc891365e123280df8c156bc5ce3af3aa387",
            "filename": "dev-infra/commit-message/parse.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 169,
            "changes": 169,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fparse.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fparse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,169 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Commit as ParsedCommit, Options, sync as parse} from 'conventional-commits-parser';\n-\n-\n-/** A parsed commit, containing the information needed to validate the commit. */\n-export interface Commit {\n-  /** The full raw text of the commit. */\n-  fullText: string;\n-  /** The header line of the commit, will be used in the changelog entries. */\n-  header: string;\n-  /** The full body of the commit, not including the footer. */\n-  body: string;\n-  /** The footer of the commit, containing issue references and note sections. */\n-  footer: string;\n-  /** A list of the references to other issues made throughout the commit message. */\n-  references: ParsedCommit.Reference[];\n-  /** The type of the commit message. */\n-  type: string;\n-  /** The scope of the commit message. */\n-  scope: string;\n-  /** The npm scope of the commit message. */\n-  npmScope: string;\n-  /** The subject of the commit message. */\n-  subject: string;\n-  /** A list of breaking change notes in the commit message. */\n-  breakingChanges: ParsedCommit.Note[];\n-  /** A list of deprecation notes in the commit message. */\n-  deprecations: ParsedCommit.Note[];\n-  /** Whether the commit is a fixup commit. */\n-  isFixup: boolean;\n-  /** Whether the commit is a squash commit. */\n-  isSquash: boolean;\n-  /** Whether the commit is a revert commit. */\n-  isRevert: boolean;\n-}\n-\n-/** A parsed commit which originated from a Git Log entry */\n-export interface CommitFromGitLog extends Commit {\n-  author: string;\n-  hash: string;\n-  shortHash: string;\n-}\n-\n-/**\n- * A list of tuples expressing the fields to extract from each commit log entry. The tuple contains\n- * two values, the first is the key for the property and the second is the template shortcut for the\n- * git log command.\n- */\n-const commitFields = {\n-  hash: '%H',\n-  shortHash: '%h',\n-  author: '%aN',\n-};\n-/** The additional fields to be included in commit log entries for parsing. */\n-export type CommitFields = typeof commitFields;\n-/** The commit fields described as git log format entries for parsing. */\n-export const commitFieldsAsFormat = (fields: CommitFields) => {\n-  return Object.entries(fields).map(([key, value]) => `%n-${key}-%n${value}`).join('');\n-};\n-/**\n- * The git log format template to create git log entries for parsing.\n- *\n- * The conventional commits parser expects to parse the standard git log raw body (%B) into its\n- * component parts. Additionally it will parse additional fields with keys defined by\n- * `-{key name}-` separated by new lines.\n- * */\n-export const gitLogFormatForParsing = `%B${commitFieldsAsFormat(commitFields)}`;\n-/** Markers used to denote the start of a note section in a commit. */\n-enum NoteSections {\n-  BREAKING_CHANGE = 'BREAKING CHANGE',\n-  DEPRECATED = 'DEPRECATED',\n-}\n-/** Regex determining if a commit is a fixup. */\n-const FIXUP_PREFIX_RE = /^fixup! /i;\n-/** Regex determining if a commit is a squash. */\n-const SQUASH_PREFIX_RE = /^squash! /i;\n-/** Regex determining if a commit is a revert. */\n-const REVERT_PREFIX_RE = /^revert:? /i;\n-/**\n- * Regex pattern for parsing the header line of a commit.\n- *\n- * Several groups are being matched to be used in the parsed commit object, being mapped to the\n- * `headerCorrespondence` object.\n- *\n- * The pattern can be broken down into component parts:\n- * - `(\\w+)` - a capturing group discovering the type of the commit.\n- * - `(?:\\((?:([^/]+)\\/)?([^)]+)\\))?` - a pair of capturing groups to capture the scope and,\n- * optionally the npmScope of the commit.\n- * - `(.*)` - a capturing group discovering the subject of the commit.\n- */\n-const headerPattern = /^(\\w+)(?:\\((?:([^/]+)\\/)?([^)]+)\\))?: (.*)$/;\n-/**\n- * The property names used for the values extracted from the header via the `headerPattern` regex.\n- */\n-const headerCorrespondence = ['type', 'npmScope', 'scope', 'subject'];\n-/**\n- * Configuration options for the commit parser.\n- *\n- * NOTE: An extended type from `Options` must be used because the current\n- * @types/conventional-commits-parser version does not include the `notesPattern` field.\n- */\n-const parseOptions: Options&{notesPattern: (keywords: string) => RegExp} = {\n-  commentChar: '#',\n-  headerPattern,\n-  headerCorrespondence,\n-  noteKeywords: [NoteSections.BREAKING_CHANGE, NoteSections.DEPRECATED],\n-  notesPattern: (keywords: string) => new RegExp(`^\\s*(${keywords}): ?(.*)`),\n-};\n-\n-/** Parse a commit message into its composite parts. */\n-export const parseCommitMessage: (fullText: string) => Commit = parseInternal;\n-\n-/** Parse a commit message from a git log entry into its composite parts. */\n-export const parseCommitFromGitLog: (fullText: Buffer) => CommitFromGitLog = parseInternal;\n-\n-/** Parse a full commit message into its composite parts. */\n-function parseInternal(fullText: string): Commit;\n-function parseInternal(fullText: Buffer): CommitFromGitLog;\n-function parseInternal(fullText: string|Buffer): CommitFromGitLog|Commit {\n-  // Ensure the fullText symbol is a `string`, even if a Buffer was provided.\n-  fullText = fullText.toString();\n-  /** The commit message text with the fixup and squash markers stripped out. */\n-  const strippedCommitMsg = fullText.replace(FIXUP_PREFIX_RE, '')\n-                                .replace(SQUASH_PREFIX_RE, '')\n-                                .replace(REVERT_PREFIX_RE, '');\n-  /** The initially parsed commit. */\n-  const commit = parse(strippedCommitMsg, parseOptions);\n-  /** A list of breaking change notes from the commit. */\n-  const breakingChanges: ParsedCommit.Note[] = [];\n-  /** A list of deprecation notes from the commit. */\n-  const deprecations: ParsedCommit.Note[] = [];\n-\n-  // Extract the commit message notes by marked types into their respective lists.\n-  commit.notes.forEach((note: ParsedCommit.Note) => {\n-    if (note.title === NoteSections.BREAKING_CHANGE) {\n-      return breakingChanges.push(note);\n-    }\n-    if (note.title === NoteSections.DEPRECATED) {\n-      return deprecations.push(note);\n-    }\n-  });\n-\n-  return {\n-    fullText,\n-    breakingChanges,\n-    deprecations,\n-    body: commit.body || '',\n-    footer: commit.footer || '',\n-    header: commit.header || '',\n-    references: commit.references,\n-    scope: commit.scope || '',\n-    subject: commit.subject || '',\n-    type: commit.type || '',\n-    npmScope: commit.npmScope || '',\n-    isFixup: FIXUP_PREFIX_RE.test(fullText),\n-    isSquash: SQUASH_PREFIX_RE.test(fullText),\n-    isRevert: REVERT_PREFIX_RE.test(fullText),\n-    author: commit.author || undefined,\n-    hash: commit.hash || undefined,\n-    shortHash: commit.shortHash || undefined,\n-  };\n-}"
        },
        {
            "sha": "785ecaaa77802e515a9b567cac31d35202db0fc6",
            "filename": "dev-infra/commit-message/restore-commit-message/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,65 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {CommitMsgSource} from './commit-message-source';\n-\n-import {restoreCommitMessage} from './restore-commit-message';\n-\n-export interface RestoreCommitMessageOptions {\n-  file?: string;\n-  source?: string;\n-  fileEnvVariable?: string;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return yargs\n-      .option('file-env-variable' as 'fileEnvVariable', {\n-        type: 'string',\n-        description: 'The key for the environment variable which holds the arguments for the\\n' +\n-            'prepare-commit-msg hook as described here:\\n' +\n-            'https://git-scm.com/docs/githooks#_prepare_commit_msg'\n-      })\n-      .positional('file', {type: 'string'})\n-      .positional('source', {type: 'string'});\n-}\n-\n-/** Handles the command. */\n-async function handler({fileEnvVariable, file, source}: Arguments<RestoreCommitMessageOptions>) {\n-  // File and source are provided as command line parameters\n-  if (file !== undefined) {\n-    restoreCommitMessage(file, source as CommitMsgSource);\n-    return;\n-  }\n-\n-  // File and source are provided as values held in an environment variable.\n-  if (fileEnvVariable !== undefined) {\n-    const [fileFromEnv, sourceFromEnv] = (process.env[fileEnvVariable!] || '').split(' ');\n-    if (!fileFromEnv) {\n-      throw new Error(`Provided environment variable \"${fileEnvVariable}\" was not found.`);\n-    }\n-    restoreCommitMessage(fileFromEnv, sourceFromEnv as CommitMsgSource);\n-    return;\n-  }\n-\n-  throw new Error(\n-      'No file path and commit message source provide. Provide values via positional command ' +\n-      'arguments, or via the --file-env-variable flag');\n-}\n-\n-/** yargs command module describing the command. */\n-export const RestoreCommitMessageModule: CommandModule<{}, RestoreCommitMessageOptions> = {\n-  handler,\n-  builder,\n-  command: 'restore-commit-message-draft [file] [source]',\n-  // Description: Restore a commit message draft if one has been saved from a failed commit attempt.\n-  // No describe is defiend to hide the command from the --help.\n-  describe: false,\n-};"
        },
        {
            "sha": "86a5655fd09b092a372351aa696224f0857ea05f",
            "filename": "dev-infra/commit-message/restore-commit-message/commit-message-draft.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-draft.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-draft.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-draft.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,30 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {existsSync, readFileSync, unlinkSync, writeFileSync} from 'fs';\n-\n-/** Load the commit message draft from the file system if it exists. */\n-export function loadCommitMessageDraft(basePath: string) {\n-  const commitMessageDraftPath = `${basePath}.ngDevSave`;\n-  if (existsSync(commitMessageDraftPath)) {\n-    return readFileSync(commitMessageDraftPath).toString();\n-  }\n-  return '';\n-}\n-\n-/** Remove the commit message draft from the file system. */\n-export function deleteCommitMessageDraft(basePath: string) {\n-  const commitMessageDraftPath = `${basePath}.ngDevSave`;\n-  if (existsSync(commitMessageDraftPath)) {\n-    unlinkSync(commitMessageDraftPath);\n-  }\n-}\n-\n-/** Save the commit message draft to the file system for later retrieval. */\n-export function saveCommitMessageDraft(basePath: string, commitMessage: string) {\n-  writeFileSync(`${basePath}.ngDevSave`, commitMessage);\n-}"
        },
        {
            "sha": "c8a9640e839edca7313635ece7955762b75da3bd",
            "filename": "dev-infra/commit-message/restore-commit-message/commit-message-source.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-source.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-source.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcommit-message-source.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * The source triggering the git commit message creation.\n- * As described in: https://git-scm.com/docs/githooks#_prepare_commit_msg\n- */\n-export type CommitMsgSource = 'message'|'template'|'merge'|'squash'|'commit';"
        },
        {
            "sha": "2a5d1be929f742aa11d068a9541d0a34bda6c931",
            "filename": "dev-infra/commit-message/restore-commit-message/restore-commit-message.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 48,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,48 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {writeFileSync} from 'fs';\n-\n-import {debug, log} from '../../utils/console';\n-\n-import {loadCommitMessageDraft} from './commit-message-draft';\n-import {CommitMsgSource} from './commit-message-source';\n-\n-/**\n- * Restore the commit message draft to the git to be used as the default commit message.\n- *\n- * The source provided may be one of the sources described in\n- *   https://git-scm.com/docs/githooks#_prepare_commit_msg\n- */\n-export function restoreCommitMessage(filePath: string, source?: CommitMsgSource) {\n-  if (!!source) {\n-    if (source === 'message') {\n-      debug('A commit message was already provided via the command with a -m or -F flag');\n-    }\n-    if (source === 'template') {\n-      debug('A commit message was already provided via the -t flag or config.template setting');\n-    }\n-    if (source === 'squash') {\n-      debug('A commit message was already provided as a merge action or via .git/MERGE_MSG');\n-    }\n-    if (source === 'commit') {\n-      debug('A commit message was already provided through a revision specified via --fixup, -c,');\n-      debug('-C or --amend flag');\n-    }\n-    process.exit(0);\n-  }\n-  /** A draft of a commit message. */\n-  const commitMessage = loadCommitMessageDraft(filePath);\n-\n-  // If the commit message draft has content, restore it into the provided filepath.\n-  if (commitMessage) {\n-    writeFileSync(filePath, commitMessage);\n-  }\n-  // Exit the process\n-  process.exit(0);\n-}"
        },
        {
            "sha": "0371cf0ec32e4d66986cfe61b8a66f75b662022e",
            "filename": "dev-infra/commit-message/test-util.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Ftest-util.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Ftest-util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Ftest-util.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,30 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** The parts that make up a commit message for creating a commit message string. */\n-export interface CommitMessageParts {\n-  prefix: string;\n-  type: string;\n-  npmScope: string;\n-  scope: string;\n-  summary: string;\n-  body: string;\n-  footer: string;\n-}\n-\n-/**\n- * Generate a commit message builder function, using the provided defaults.\n- */\n-export function commitMessageBuilder(defaults: CommitMessageParts) {\n-  return (params: Partial<CommitMessageParts> = {}) => {\n-    const {prefix, type, npmScope, scope, summary, body, footer} = {...defaults, ...params};\n-    const scopeSlug = npmScope ? `${npmScope}/${scope}` : scope;\n-    return `${prefix}${type}${scopeSlug ? '(' + scopeSlug + ')' : ''}: ${summary}\\n\\n${body}\\n\\n${\n-        footer}`;\n-  };\n-}"
        },
        {
            "sha": "82af851e5d9f27e7bb61224269164ed721556198",
            "filename": "dev-infra/commit-message/utils.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Futils.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as gitCommits_ from 'git-raw-commits';\n-\n-import {CommitFromGitLog, gitLogFormatForParsing, parseCommitFromGitLog} from './parse';\n-\n-// Set `gitCommits` as this imported value to address \"Cannot call a namespace\" error.\n-const gitCommits = gitCommits_;\n-\n-\n-/**\n- * Find all commits within the given range and return an object describing those.\n- */\n-export function getCommitsInRange(from: string, to: string = 'HEAD'): Promise<CommitFromGitLog[]> {\n-  return new Promise((resolve, reject) => {\n-    /** List of parsed commit objects. */\n-    const commits: CommitFromGitLog[] = [];\n-    /** Stream of raw git commit strings in the range provided. */\n-    const commitStream = gitCommits({from, to, format: gitLogFormatForParsing});\n-\n-    // Accumulate the parsed commits for each commit from the Readable stream into an array, then\n-    // resolve the promise with the array when the Readable stream ends.\n-    commitStream.on('data', (commit: Buffer) => commits.push(parseCommitFromGitLog(commit)));\n-    commitStream.on('error', (err: Error) => reject(err));\n-    commitStream.on('end', () => resolve(commits));\n-  });\n-}"
        },
        {
            "sha": "8ba2d5b2856b36546c92caaa02223df3a1a92abd",
            "filename": "dev-infra/commit-message/validate-file/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,65 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {getUserConfig} from '../../utils/config';\n-\n-import {validateFile} from './validate-file';\n-\n-\n-export interface ValidateFileOptions {\n-  file?: string;\n-  fileEnvVariable?: string;\n-  error: boolean;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return yargs\n-      .option('file', {\n-        type: 'string',\n-        conflicts: ['file-env-variable'],\n-        description: 'The path of the commit message file.',\n-      })\n-      .option('file-env-variable' as 'fileEnvVariable', {\n-        type: 'string',\n-        conflicts: ['file'],\n-        description: 'The key of the environment variable for the path of the commit message file.',\n-        coerce: (arg: string|undefined) => {\n-          if (arg === undefined) {\n-            return arg;\n-          }\n-          const file = process.env[arg];\n-          if (!file) {\n-            throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n-          }\n-          return file;\n-        },\n-      })\n-      .option('error', {\n-        type: 'boolean',\n-        description:\n-            'Whether invalid commit messages should be treated as failures rather than a warning',\n-        default: !!getUserConfig().commitMessage?.errorOnInvalidMessage || !!process.env['CI']\n-      });\n-}\n-\n-/** Handles the command. */\n-async function handler({error, file, fileEnvVariable}: Arguments<ValidateFileOptions>) {\n-  const filePath = file || fileEnvVariable || '.git/COMMIT_EDITMSG';\n-  validateFile(filePath, error);\n-}\n-\n-/** yargs command module describing the command. */\n-export const ValidateFileModule: CommandModule<{}, ValidateFileOptions> = {\n-  handler,\n-  builder,\n-  command: 'pre-commit-validate',\n-  describe: 'Validate the most recent commit message',\n-};"
        },
        {
            "sha": "31358459ddcfd60fe53f195d4cccae2120dbb55d",
            "filename": "dev-infra/commit-message/validate-file/validate-file.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 48,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,48 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {readFileSync} from 'fs';\n-import {resolve} from 'path';\n-\n-import {error, green, info, log, red, yellow} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-\n-import {deleteCommitMessageDraft, saveCommitMessageDraft} from '../restore-commit-message/commit-message-draft';\n-import {printValidationErrors, validateCommitMessage} from '../validate';\n-\n-/** Validate commit message at the provided file path. */\n-export function validateFile(filePath: string, isErrorMode: boolean) {\n-  const git = GitClient.get();\n-  const commitMessage = readFileSync(resolve(git.baseDir, filePath), 'utf8');\n-  const {valid, errors} = validateCommitMessage(commitMessage);\n-  if (valid) {\n-    info(`${green('√')}  Valid commit message`);\n-    deleteCommitMessageDraft(filePath);\n-    process.exitCode = 0;\n-    return;\n-  }\n-\n-  /** Function used to print to the console log. */\n-  let printFn = isErrorMode ? error : log;\n-\n-  printFn(`${isErrorMode ? red('✘') : yellow('!')}  Invalid commit message`);\n-  printValidationErrors(errors, printFn);\n-  if (isErrorMode) {\n-    printFn(red('Aborting commit attempt due to invalid commit message.'));\n-    printFn(\n-        red('Commit message aborted as failure rather than warning due to local configuration.'));\n-  } else {\n-    printFn(yellow('Before this commit can be merged into the upstream repository, it must be'));\n-    printFn(yellow('amended to follow commit message guidelines.'));\n-  }\n-\n-  // On all invalid commit messages, the commit message should be saved as a draft to be\n-  // restored on the next commit attempt.\n-  saveCommitMessageDraft(filePath, commitMessage);\n-  // Set the correct exit code based on if invalid commit message is an error.\n-  process.exitCode = isErrorMode ? 1 : 0;\n-}"
        },
        {
            "sha": "2878dc1b7a1cdf97614ea9d1f46b4c8f8a0ede88",
            "filename": "dev-infra/commit-message/validate-range/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 56,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,56 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {info} from '../../utils/console';\n-\n-import {validateCommitRange} from './validate-range';\n-\n-\n-export interface ValidateRangeOptions {\n-  startingRef: string;\n-  endingRef: string;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return yargs\n-      .positional('startingRef', {\n-        description: 'The first ref in the range to select',\n-        type: 'string',\n-        demandOption: true,\n-      })\n-      .positional('endingRef', {\n-        description: 'The last ref in the range to select',\n-        type: 'string',\n-        default: 'HEAD',\n-      });\n-}\n-\n-/** Handles the command. */\n-async function handler({startingRef, endingRef}: Arguments<ValidateRangeOptions>) {\n-  // If on CI, and no pull request number is provided, assume the branch\n-  // being run on is an upstream branch.\n-  if (process.env['CI'] && process.env['CI_PULL_REQUEST'] === 'false') {\n-    info(`Since valid commit messages are enforced by PR linting on CI, we do not`);\n-    info(`need to validate commit messages on CI runs on upstream branches.`);\n-    info();\n-    info(`Skipping check of provided commit range`);\n-    return;\n-  }\n-  await validateCommitRange(startingRef, endingRef);\n-}\n-\n-/** yargs command module describing the command. */\n-export const ValidateRangeModule: CommandModule<{}, ValidateRangeOptions> = {\n-  handler,\n-  builder,\n-  command: 'validate-range <starting-ref> [ending-ref]',\n-  describe: 'Validate a range of commit messages',\n-};"
        },
        {
            "sha": "5f506b99163239dc346d96bb2b6c137ce705ff5e",
            "filename": "dev-infra/commit-message/validate-range/validate-range.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,59 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {error, green, info, red} from '../../utils/console';\n-import {Commit} from '../parse';\n-import {getCommitsInRange} from '../utils';\n-import {printValidationErrors, validateCommitMessage, ValidateCommitMessageOptions} from '../validate';\n-\n-// Whether the provided commit is a fixup commit.\n-const isNonFixup = (commit: Commit) => !commit.isFixup;\n-\n-// Extracts commit header (first line of commit message).\n-const extractCommitHeader = (commit: Commit) => commit.header;\n-\n-/** Validate all commits in a provided git commit range. */\n-export async function validateCommitRange(from: string, to: string) {\n-  /** A list of tuples of the commit header string and a list of error messages for the commit. */\n-  const errors: [commitHeader: string, errors: string[]][] = [];\n-\n-  /** A list of parsed commit messages from the range. */\n-  const commits = await getCommitsInRange(from, to);\n-  info(`Examining ${commits.length} commit(s) in the provided range: ${from}..${to}`);\n-\n-  /**\n-   * Whether all commits in the range are valid, commits are allowed to be fixup commits for other\n-   * commits in the provided commit range.\n-   */\n-  const allCommitsInRangeValid = commits.every((commit, i) => {\n-    const options: ValidateCommitMessageOptions = {\n-      disallowSquash: true,\n-      nonFixupCommitHeaders: isNonFixup(commit) ?\n-          undefined :\n-          commits.slice(i + 1).filter(isNonFixup).map(extractCommitHeader)\n-    };\n-    const {valid, errors: localErrors} = validateCommitMessage(commit, options);\n-    if (localErrors.length) {\n-      errors.push([commit.header, localErrors]);\n-    }\n-    return valid;\n-  });\n-\n-  if (allCommitsInRangeValid) {\n-    info(green('√  All commit messages in range valid.'));\n-  } else {\n-    error(red('✘  Invalid commit message'));\n-    errors.forEach(([header, validationErrors]) => {\n-      error.group(header);\n-      printValidationErrors(validationErrors);\n-      error.groupEnd();\n-    });\n-    // Exit with a non-zero exit code if invalid commit messages have\n-    // been discovered.\n-    process.exit(1);\n-  }\n-}"
        },
        {
            "sha": "0c0b534ea5ddd3d0e22cb6c9941fde502e946d89",
            "filename": "dev-infra/commit-message/validate.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 469,
            "changes": 469,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,469 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// Imports\n-import * as validateConfig from './config';\n-import {parseCommitMessage} from './parse';\n-import {validateCommitMessage, ValidateCommitMessageResult} from './validate';\n-\n-type CommitMessageConfig = validateConfig.CommitMessageConfig;\n-\n-\n-// Constants\n-const config: {commitMessage: CommitMessageConfig} = {\n-  commitMessage: {\n-    maxLineLength: 120,\n-    minBodyLength: 0,\n-    scopes: [\n-      'common',\n-      'compiler',\n-      'core',\n-      'packaging',\n-      '@angular-devkit/build-angular',\n-    ]\n-  }\n-};\n-const TYPES = Object.keys(validateConfig.COMMIT_TYPES).join(', ');\n-const SCOPES = config.commitMessage.scopes.join(', ');\n-const INVALID = false;\n-const VALID = true;\n-\n-function expectValidationResult(\n-    validationResult: ValidateCommitMessageResult, valid: boolean, errors: string[] = []) {\n-  expect(validationResult).toEqual(jasmine.objectContaining({valid, errors}));\n-}\n-\n-// TODO(josephperrott): Clean up tests to test script rather than for\n-// specific commit messages we want to use.\n-describe('validate-commit-message.js', () => {\n-  beforeEach(() => {\n-    spyOn(validateConfig, 'getCommitMessageConfig')\n-        .and.returnValue(config as ReturnType<typeof validateConfig.getCommitMessageConfig>);\n-  });\n-\n-  describe('validateMessage()', () => {\n-    it('should be valid', () => {\n-      expectValidationResult(validateCommitMessage('feat(packaging): something'), VALID);\n-      expectValidationResult(validateCommitMessage('fix(packaging): something'), VALID);\n-      expectValidationResult(validateCommitMessage('fixup! fix(packaging): something'), VALID);\n-      expectValidationResult(validateCommitMessage('squash! fix(packaging): something'), VALID);\n-      expectValidationResult(validateCommitMessage('Revert: \"fix(packaging): something\"'), VALID);\n-    });\n-\n-    it('should validate max length', () => {\n-      const msg =\n-          'fix(compiler): something super mega extra giga tera long, maybe even longer and longer and longer and longer and longer and longer...';\n-\n-      expectValidationResult(validateCommitMessage(msg), INVALID, [\n-        `The commit message header is longer than ${config.commitMessage.maxLineLength} characters`\n-      ]);\n-    });\n-\n-    it('should skip max length limit for URLs', () => {\n-      const msg = 'fix(compiler): this is just a usual commit message title\\n\\n' +\n-          'This is a normal commit message body which does not exceed the max length\\n' +\n-          'limit. For more details see the following super long URL:\\n\\n' +\n-          'https://github.com/angular/components/commit/e2ace018ddfad10608e0e32932c43dcfef4095d7#diff-9879d6db96fd29134fc802214163b95a';\n-\n-      expectValidationResult(validateCommitMessage(msg), VALID);\n-    });\n-\n-    it('should validate \"<type>(<scope>): <subject>\" format', () => {\n-      const msg = 'not correct format';\n-\n-      expectValidationResult(\n-          validateCommitMessage(msg), INVALID,\n-          [`The commit message header does not match the expected format.`]);\n-    });\n-\n-    it('should fail when type is invalid', () => {\n-      const msg = 'weird(core): something';\n-\n-      expectValidationResult(\n-          validateCommitMessage(msg), INVALID,\n-          [`'weird' is not an allowed type.\\n => TYPES: ${TYPES}`]);\n-    });\n-\n-    it('should pass when scope contains NPM scope', () => {\n-      expectValidationResult(\n-          validateCommitMessage('fix(@angular-devkit/build-angular): something'), true);\n-    });\n-\n-    it('should fail when scope is invalid', () => {\n-      const errorMessageFor = (scope: string, header: string) =>\n-          `'${scope}' is not an allowed scope.\\n => SCOPES: ${SCOPES}`;\n-\n-      expectValidationResult(\n-          validateCommitMessage('fix(Compiler): something'), INVALID,\n-          [errorMessageFor('Compiler', 'fix(Compiler): something')]);\n-\n-      expectValidationResult(\n-          validateCommitMessage('feat(bah): something'), INVALID,\n-          [errorMessageFor('bah', 'feat(bah): something')]);\n-\n-      expectValidationResult(\n-          validateCommitMessage('fix(webworker): something'), INVALID,\n-          [errorMessageFor('webworker', 'fix(webworker): something')]);\n-\n-      expectValidationResult(\n-          validateCommitMessage('refactor(security): something'), INVALID,\n-          [errorMessageFor('security', 'refactor(security): something')]);\n-\n-      expectValidationResult(\n-          validateCommitMessage('refactor(docs): something'), INVALID,\n-          [errorMessageFor('docs', 'refactor(docs): something')]);\n-\n-      expectValidationResult(\n-          validateCommitMessage('feat(angular): something'), INVALID,\n-          [errorMessageFor('angular', 'feat(angular): something')]);\n-    });\n-\n-    it('should allow empty scope', () => {\n-      expectValidationResult(validateCommitMessage('build: blablabla'), VALID);\n-    });\n-\n-    // We do not want to allow WIP. It is OK to fail the PR build in this case to show that there is\n-    // work still to be done (i.e. fixing the commit message).\n-    it('should not allow \"WIP: ...\" syntax', () => {\n-      const msg = 'WIP: fix: something';\n-\n-      expectValidationResult(\n-          validateCommitMessage(msg), INVALID,\n-          [`'WIP' is not an allowed type.\\n => TYPES: ${TYPES}`]);\n-    });\n-\n-    describe('(revert)', () => {\n-      it('should allow valid \"revert: ...\" syntaxes', () => {\n-        expectValidationResult(validateCommitMessage('revert: anything'), VALID);\n-        expectValidationResult(validateCommitMessage('Revert: \"anything\"'), VALID);\n-        expectValidationResult(validateCommitMessage('revert anything'), VALID);\n-        expectValidationResult(validateCommitMessage('rEvErT anything'), VALID);\n-      });\n-\n-      it('should not allow \"revert(scope): ...\" syntax', () => {\n-        const msg = 'revert(compiler): reduce generated code payload size by 65%';\n-\n-        expectValidationResult(\n-            validateCommitMessage(msg), INVALID,\n-            [`'revert' is not an allowed type.\\n => TYPES: ${TYPES}`]);\n-      });\n-\n-      // https://github.com/angular/angular/issues/23479\n-      it('should allow typical Angular messages generated by git', () => {\n-        const msg =\n-            'Revert \"fix(compiler): Pretty print object instead of [Object object] (#22689)\" (#23442)';\n-\n-        expectValidationResult(validateCommitMessage(msg), VALID);\n-      });\n-    });\n-\n-    describe('(squash)', () => {\n-      describe('without `disallowSquash`', () => {\n-        it('should return commits as valid', () => {\n-          expectValidationResult(validateCommitMessage('squash! feat(core): add feature'), VALID);\n-          expectValidationResult(validateCommitMessage('squash! fix: a bug'), VALID);\n-          expectValidationResult(validateCommitMessage('squash! fix a typo'), VALID);\n-        });\n-      });\n-\n-      describe('with `disallowSquash`', () => {\n-        it('should fail', () => {\n-          expectValidationResult(\n-              validateCommitMessage('fix(core): something', {disallowSquash: true}), VALID);\n-          expectValidationResult(\n-              validateCommitMessage('squash! fix(core): something', {disallowSquash: true}),\n-              INVALID, ['The commit must be manually squashed into the target commit']);\n-        });\n-      });\n-    });\n-\n-    describe('(fixup)', () => {\n-      describe('without `nonFixupCommitHeaders`', () => {\n-        it('should return commits as valid', () => {\n-          expectValidationResult(validateCommitMessage('fixup! feat(core): add feature'), VALID);\n-          expectValidationResult(validateCommitMessage('fixup! fix: a bug'), VALID);\n-          expectValidationResult(validateCommitMessage('fixup! fixup! fix: a bug'), VALID);\n-        });\n-      });\n-\n-      describe('with `nonFixupCommitHeaders`', () => {\n-        it('should check that the fixup commit matches a non-fixup one', () => {\n-          const msg = 'fixup! foo';\n-\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  msg, {disallowSquash: false, nonFixupCommitHeaders: ['foo', 'bar', 'baz']}),\n-              VALID);\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  msg, {disallowSquash: false, nonFixupCommitHeaders: ['bar', 'baz', 'foo']}),\n-              VALID);\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  msg, {disallowSquash: false, nonFixupCommitHeaders: ['baz', 'foo', 'bar']}),\n-              VALID);\n-\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  msg, {disallowSquash: false, nonFixupCommitHeaders: ['qux', 'quux', 'quuux']}),\n-              INVALID,\n-              ['Unable to find match for fixup commit among prior commits: \\n' +\n-               '      qux\\n' +\n-               '      quux\\n' +\n-               '      quuux']);\n-        });\n-\n-        it('should fail if `nonFixupCommitHeaders` is empty', () => {\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  'refactor(core): make reactive',\n-                  {disallowSquash: false, nonFixupCommitHeaders: []}),\n-              VALID);\n-          expectValidationResult(\n-              validateCommitMessage(\n-                  'fixup! foo', {disallowSquash: false, nonFixupCommitHeaders: []}),\n-              INVALID, [`Unable to find match for fixup commit among prior commits: -`]);\n-        });\n-      });\n-    });\n-\n-    describe('minBodyLength', () => {\n-      const minBodyLengthConfig: {commitMessage: CommitMessageConfig} = {\n-        commitMessage: {\n-          maxLineLength: 120,\n-          minBodyLength: 30,\n-          minBodyLengthTypeExcludes: ['docs'],\n-          scopes: ['core']\n-        }\n-      };\n-\n-      beforeEach(() => {\n-        (validateConfig.getCommitMessageConfig as jasmine.Spy).and.returnValue(minBodyLengthConfig);\n-      });\n-\n-      it('should fail validation if the body is shorter than `minBodyLength`', () => {\n-        expectValidationResult(\n-            validateCommitMessage(\n-                'fix(core): something\\n\\n Explanation of the motivation behind this change'),\n-            VALID);\n-        expectValidationResult(\n-            validateCommitMessage('fix(core): something\\n\\n too short'), INVALID,\n-            ['The commit message body does not meet the minimum length of 30 characters']);\n-        expectValidationResult(validateCommitMessage('fix(core): something'), INVALID, [\n-\n-          'The commit message body does not meet the minimum length of 30 characters'\n-        ]);\n-      });\n-\n-      it('should pass validation even if the total non-header content is longer than `minBodyLength`, even if the body contains a `#` reference usage',\n-         () => {\n-           expectValidationResult(\n-               validateCommitMessage(\n-                   'fix(core): something\\n\\n Explanation of how #123 motivated this change'),\n-               VALID);\n-         });\n-\n-      it('should pass validation if the body is shorter than `minBodyLength` but the commit type is in the `minBodyLengthTypeExclusions` list',\n-         () => {\n-           expectValidationResult(validateCommitMessage('docs: just fixing a typo'), VALID);\n-           expectValidationResult(validateCommitMessage('docs(core): just fixing a typo'), VALID);\n-           expectValidationResult(\n-               validateCommitMessage(\n-                   'docs(core): just fixing a typo\\n\\nThis was just a silly typo.'),\n-               VALID);\n-         });\n-    });\n-\n-    describe('deprecations', () => {\n-      it('should allow valid deprecation notes in commit messages', () => {\n-        const msgWithListOfDeprecations =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATED:\\n' +\n-            ' * A to be removed\\n' +\n-            ' * B to be removed';\n-        expectValidationResult(validateCommitMessage(msgWithListOfDeprecations), VALID);\n-        expect(parseCommitMessage(msgWithListOfDeprecations).deprecations.length).toBe(1);\n-\n-        const msgWithSummary = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATED: All methods in X to be removed in v12.';\n-\n-        expectValidationResult(validateCommitMessage(msgWithSummary), VALID);\n-        expect(parseCommitMessage(msgWithSummary).deprecations.length).toBe(1);\n-\n-        const msgWithSummaryAndDescription =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATED: All methods in X to be removed in v12.\\n' +\n-            '' +\n-            'This is the more detailed description about the deprecation of X.';\n-\n-        expectValidationResult(validateCommitMessage(msgWithSummaryAndDescription), VALID);\n-        expect(parseCommitMessage(msgWithSummaryAndDescription).deprecations.length).toBe(1);\n-\n-        const msgWithNoDeprecation =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is not a\\n' +\n-            'deprecation commit.';\n-        expectValidationResult(validateCommitMessage(msgWithNoDeprecation), VALID);\n-        expect(parseCommitMessage(msgWithNoDeprecation).deprecations.length).toBe(0);\n-      });\n-\n-      it('should fail for non-valid deprecation notes in commit messages', () => {\n-        const incorrectKeyword1 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATE:\\n' +\n-            ' * A to be removed\\n' +\n-            ' * B to be removed';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword1), INVALID,\n-            ['The commit message body contains an invalid deprecation note.']);\n-\n-        const incorrectKeyword2 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATES:\\n' +\n-            ' * A to be removed\\n' +\n-            ' * B to be removed';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword2), INVALID,\n-            ['The commit message body contains an invalid deprecation note.']);\n-\n-        const incorrectKeyword3 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'DEPRECATIONS:\\n' +\n-            ' * A to be removed\\n' +\n-            ' * B to be removed';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword3), INVALID,\n-            ['The commit message body contains an invalid deprecation note.']);\n-      });\n-    });\n-\n-    describe('breaking change', () => {\n-      it('should allow valid breaking change commit descriptions', () => {\n-        const msgWithSummary = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE: This is a summary of a breaking change.';\n-        expectValidationResult(validateCommitMessage(msgWithSummary), VALID);\n-        expect(parseCommitMessage(msgWithSummary).breakingChanges.length).toBe(1);\n-\n-        const msgWithDescriptionDoubleLineBreakSeparator =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE:\\n\\n' +\n-            'This is a full description of the breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithDescriptionDoubleLineBreakSeparator), VALID);\n-        expect(\n-            parseCommitMessage(msgWithDescriptionDoubleLineBreakSeparator).breakingChanges.length)\n-            .toBe(1);\n-\n-        const msgWithDescriptionSingleLineBreakSeparator =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE:\\n' +\n-            'This is a full description of the breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithDescriptionSingleLineBreakSeparator), VALID);\n-        expect(\n-            parseCommitMessage(msgWithDescriptionSingleLineBreakSeparator).breakingChanges.length)\n-            .toBe(1);\n-\n-        const msgWithSummaryAndDescription =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE: This is a summary of a breaking change.\\n\\n' +\n-            'This is a full description of the breaking change.';\n-        expectValidationResult(validateCommitMessage(msgWithSummaryAndDescription), VALID);\n-        expect(parseCommitMessage(msgWithSummaryAndDescription).breakingChanges.length).toBe(1);\n-\n-        const msgWithNonBreaking = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is not a\\n' +\n-            'breaking change commit.';\n-        expectValidationResult(validateCommitMessage(msgWithNonBreaking), VALID);\n-        expect(parseCommitMessage(msgWithNonBreaking).breakingChanges.length).toBe(0);\n-      });\n-\n-      it('should fail for non-valid breaking change commit descriptions', () => {\n-        const msgWithSummary = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE This is a summary of a breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithSummary), INVALID,\n-            [`The commit message body contains an invalid breaking change note.`]);\n-\n-        const msgWithPlural = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGES: This is a summary of a breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithPlural), INVALID,\n-            [`The commit message body contains an invalid breaking change note.`]);\n-\n-        const msgWithWithDashedKeyword =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING-CHANGE:' +\n-            'This is a full description of the breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithWithDashedKeyword), INVALID,\n-            [`The commit message body contains an invalid breaking change note.`]);\n-\n-        const msgWithSummaryAndDescription =\n-            'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGE\\n\\n' +\n-            'This is a full description of the breaking change.';\n-        expectValidationResult(\n-            validateCommitMessage(msgWithSummaryAndDescription), INVALID,\n-            [`The commit message body contains an invalid breaking change note.`]);\n-\n-        const incorrectKeyword1 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING CHANGES:\\n' +\n-            ' * A has been removed\\n';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword1), INVALID,\n-            ['The commit message body contains an invalid breaking change note.']);\n-\n-        const incorrectKeyword2 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING-CHANGE:\\n' +\n-            ' * A has been removed\\n';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword2), INVALID,\n-            ['The commit message body contains an invalid breaking change note.']);\n-\n-        const incorrectKeyword3 = 'feat(compiler): this is just a usual commit message title\\n\\n' +\n-            'This is a normal commit message body which does not exceed the max length\\n' +\n-            'limit. For more details see the following super long URL:\\n\\n' +\n-            'BREAKING-CHANGES:\\n' +\n-            ' * A has been removed\\n';\n-        expectValidationResult(\n-            validateCommitMessage(incorrectKeyword3), INVALID,\n-            ['The commit message body contains an invalid breaking change note.']);\n-      });\n-    });\n-  });\n-});"
        },
        {
            "sha": "4a9215d602fec48d152f954dd62275e387d79822",
            "filename": "dev-infra/commit-message/validate.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 210,
            "changes": 210,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,210 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {error} from '../utils/console';\n-\n-import {COMMIT_TYPES, getCommitMessageConfig, ScopeRequirement} from './config';\n-import {Commit, parseCommitMessage} from './parse';\n-\n-/** Options for commit message validation. */\n-export interface ValidateCommitMessageOptions {\n-  disallowSquash?: boolean;\n-  nonFixupCommitHeaders?: string[];\n-}\n-\n-/** The result of a commit message validation check. */\n-export interface ValidateCommitMessageResult {\n-  valid: boolean;\n-  errors: string[];\n-  commit: Commit;\n-}\n-\n-/** Regex matching a URL for an entire commit body line. */\n-const COMMIT_BODY_URL_LINE_RE = /^https?:\\/\\/.*$/;\n-\n-/**\n- * Regular expression matching potential misuse of the `BREAKING CHANGE:` marker in a\n- * commit message. Commit messages containing one of the following snippets will fail:\n- *\n- *   - `BREAKING CHANGE <some-content>` | Here we assume the colon is missing by accident.\n- *   - `BREAKING-CHANGE: <some-content>` | The wrong keyword is used here.\n- *   - `BREAKING CHANGES: <some-content>` | The wrong keyword is used here.\n- *   - `BREAKING-CHANGES: <some-content>` | The wrong keyword is used here.\n- */\n-const INCORRECT_BREAKING_CHANGE_BODY_RE =\n-    /^(BREAKING CHANGE[^:]|BREAKING-CHANGE|BREAKING[ -]CHANGES)/m;\n-\n-/**\n- * Regular expression matching potential misuse of the `DEPRECATED:` marker in a commit\n- * message. Commit messages containing one of the following snippets will fail:\n- *\n- *   - `DEPRECATED <some-content>` | Here we assume the colon is missing by accident.\n- *   - `DEPRECATIONS: <some-content>` | The wrong keyword is used here.\n- *   - `DEPRECATE: <some-content>` | The wrong keyword is used here.\n- *   - `DEPRECATES: <some-content>` | The wrong keyword is used here.\n- */\n-const INCORRECT_DEPRECATION_BODY_RE = /^(DEPRECATED[^:]|DEPRECATIONS|DEPRECATE:|DEPRECATES)/m;\n-\n-/** Validate a commit message against using the local repo's config. */\n-export function validateCommitMessage(\n-    commitMsg: string|Commit,\n-    options: ValidateCommitMessageOptions = {}): ValidateCommitMessageResult {\n-  const config = getCommitMessageConfig().commitMessage;\n-  const commit = typeof commitMsg === 'string' ? parseCommitMessage(commitMsg) : commitMsg;\n-  const errors: string[] = [];\n-\n-  /** Perform the validation checks against the parsed commit. */\n-  function validateCommitAndCollectErrors() {\n-    ////////////////////////////////////\n-    // Checking revert, squash, fixup //\n-    ////////////////////////////////////\n-\n-    // All revert commits are considered valid.\n-    if (commit.isRevert) {\n-      return true;\n-    }\n-\n-    // All squashes are considered valid, as the commit will be squashed into another in\n-    // the git history anyway, unless the options provided to not allow squash commits.\n-    if (commit.isSquash) {\n-      if (options.disallowSquash) {\n-        errors.push('The commit must be manually squashed into the target commit');\n-        return false;\n-      }\n-      return true;\n-    }\n-\n-    // Fixups commits are considered valid, unless nonFixupCommitHeaders are provided to check\n-    // against. If `nonFixupCommitHeaders` is not empty, we check whether there is a corresponding\n-    // non-fixup commit (i.e. a commit whose header is identical to this commit's header after\n-    // stripping the `fixup! ` prefix), otherwise we assume this verification will happen in another\n-    // check.\n-    if (commit.isFixup) {\n-      if (options.nonFixupCommitHeaders && !options.nonFixupCommitHeaders.includes(commit.header)) {\n-        errors.push(\n-            'Unable to find match for fixup commit among prior commits: ' +\n-            (options.nonFixupCommitHeaders.map(x => `\\n      ${x}`).join('') || '-'));\n-        return false;\n-      }\n-\n-      return true;\n-    }\n-\n-    ////////////////////////////\n-    // Checking commit header //\n-    ////////////////////////////\n-    if (commit.header.length > config.maxLineLength) {\n-      errors.push(`The commit message header is longer than ${config.maxLineLength} characters`);\n-      return false;\n-    }\n-\n-    if (!commit.type) {\n-      errors.push(`The commit message header does not match the expected format.`);\n-      return false;\n-    }\n-\n-    if (COMMIT_TYPES[commit.type] === undefined) {\n-      errors.push(`'${commit.type}' is not an allowed type.\\n => TYPES: ${\n-          Object.keys(COMMIT_TYPES).join(', ')}`);\n-      return false;\n-    }\n-\n-    /** The scope requirement level for the provided type of the commit message. */\n-    const scopeRequirementForType = COMMIT_TYPES[commit.type].scope;\n-\n-    if (scopeRequirementForType === ScopeRequirement.Forbidden && commit.scope) {\n-      errors.push(`Scopes are forbidden for commits with type '${commit.type}', but a scope of '${\n-          commit.scope}' was provided.`);\n-      return false;\n-    }\n-\n-    if (scopeRequirementForType === ScopeRequirement.Required && !commit.scope) {\n-      errors.push(\n-          `Scopes are required for commits with type '${commit.type}', but no scope was provided.`);\n-      return false;\n-    }\n-\n-    const fullScope = commit.npmScope ? `${commit.npmScope}/${commit.scope}` : commit.scope;\n-    if (fullScope && !config.scopes.includes(fullScope)) {\n-      errors.push(\n-          `'${fullScope}' is not an allowed scope.\\n => SCOPES: ${config.scopes.join(', ')}`);\n-      return false;\n-    }\n-\n-    // Commits with the type of `release` do not require a commit body.\n-    if (commit.type === 'release') {\n-      return true;\n-    }\n-\n-    //////////////////////////\n-    // Checking commit body //\n-    //////////////////////////\n-\n-    // Due to an issue in which conventional-commits-parser considers all parts of a commit after\n-    // a `#` reference to be the footer, we check the length of all of the commit content after the\n-    // header. In the future, we expect to be able to check only the body once the parser properly\n-    // handles this case.\n-    const allNonHeaderContent = `${commit.body.trim()}\\n${commit.footer.trim()}`;\n-\n-    if (!config.minBodyLengthTypeExcludes?.includes(commit.type) &&\n-        allNonHeaderContent.length < config.minBodyLength) {\n-      errors.push(`The commit message body does not meet the minimum length of ${\n-          config.minBodyLength} characters`);\n-      return false;\n-    }\n-\n-    const bodyByLine = commit.body.split('\\n');\n-    const lineExceedsMaxLength = bodyByLine.some((line: string) => {\n-      // Check if any line exceeds the max line length limit. The limit is ignored for\n-      // lines that just contain an URL (as these usually cannot be wrapped or shortened).\n-      return line.length > config.maxLineLength && !COMMIT_BODY_URL_LINE_RE.test(line);\n-    });\n-\n-    if (lineExceedsMaxLength) {\n-      errors.push(`The commit message body contains lines greater than ${\n-          config.maxLineLength} characters.`);\n-      return false;\n-    }\n-\n-    // Breaking change\n-    // Check if the commit message contains a valid break change description.\n-    // https://github.com/angular/angular/blob/88fbc066775ab1a2f6a8c75f933375b46d8fa9a4/CONTRIBUTING.md#commit-message-footer\n-    if (INCORRECT_BREAKING_CHANGE_BODY_RE.test(commit.fullText)) {\n-      errors.push(`The commit message body contains an invalid breaking change note.`);\n-      return false;\n-    }\n-\n-    if (INCORRECT_DEPRECATION_BODY_RE.test(commit.fullText)) {\n-      errors.push(`The commit message body contains an invalid deprecation note.`);\n-      return false;\n-    }\n-\n-    return true;\n-  }\n-\n-  return {valid: validateCommitAndCollectErrors(), errors, commit};\n-}\n-\n-\n-/** Print the error messages from the commit message validation to the console. */\n-export function printValidationErrors(errors: string[], print = error) {\n-  print.group(`Error${errors.length === 1 ? '' : 's'}:`);\n-  errors.forEach(line => print(line));\n-  print.groupEnd();\n-  print();\n-  print('The expected format for a commit is: ');\n-  print('<type>(<scope>): <summary>');\n-  print();\n-  print('<body>');\n-  print();\n-  print(`BREAKING CHANGE: <breaking change summary>`);\n-  print();\n-  print(`<breaking change description>`);\n-  print();\n-  print();\n-}"
        },
        {
            "sha": "b7f4ad2a0847659f06e376d0395f462abea145d6",
            "filename": "dev-infra/defaults.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 67,
            "changes": 67,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fdefaults.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fdefaults.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fdefaults.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,67 +0,0 @@\n-\"\"\"\n-  Defaults for the `//dev-infra` Bazel package. These are different than\n-  the defaults in `//tools:defaults.bzl` which are specific to the package\n-  structure as seen within `/packages/`.\n-\"\"\"\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"generated_file_test\")\n-load(\"@npm//@bazel/jasmine:index.bzl\", _jasmine_node_test = \"jasmine_node_test\")\n-load(\"@npm//@bazel/typescript:index.bzl\", _ts_library = \"ts_library\")\n-load(\"@npm//@bazel/rollup:index.bzl\", \"rollup_bundle\")\n-\n-NPM_PACKAGE_NAME = \"@angular/dev-infra-private\"\n-\n-def _compute_module_name():\n-    current_pkg = native.package_name()\n-\n-    if current_pkg == \"dev-infra\":\n-        return NPM_PACKAGE_NAME\n-\n-    # For deep targets within `//dev-infra` construct the module name in a way that matches\n-    # the structure within the NPM package (i.e. simply appending the actual package path)\n-    return \"%s/%s\" % (NPM_PACKAGE_NAME, current_pkg[len(\"dev-infra/\"):])\n-\n-def ts_library(name, **kwargs):\n-    _ts_library(\n-        name = name,\n-        # If no `module_name` is set, compute a module name based on the current Bazel\n-        # package. The module names should match the NPM package structure so that the NPM\n-        # package can be used properly. Note that we disallow any custom `module_name` for\n-        # `//dev-infra` as this usually signifies a mistake we want to raise awareness for.\n-        module_name = _compute_module_name(),\n-        # We use the module name as package name, so that the target can be resolved within\n-        # NodeJS executions, by activating the Bazel NodeJS linker.\n-        # See: https://github.com/bazelbuild/rules_nodejs/pull/2799.\n-        package_name = _compute_module_name(),\n-        **kwargs\n-    )\n-\n-def jasmine_node_test(**kwargs):\n-    _jasmine_node_test(**kwargs)\n-\n-# This file continues to serve as indicator for `rules_nodejs` and instructs it to preserve the\n-# content output in the NPM install workspace. This allows consumers to use rules and targets from\n-# within Bazel. e.g. by using `@npm//@angular/dev-infra-private/<..>`.\n-# See: https://github.com/bazelbuild/rules_nodejs/commit/4f508b1a0be1f5444e9c13b0439e649449792fef.\n-\n-def ng_dev_rolled_up_generated_file(name, entry_point, deps = [], rollup_args = []):\n-    \"\"\"Rollup and generated file test macro.\n-\n-    This provides a single macro to create a rollup bundled script and a generated file\n-    test for the created script to ensure it stays up to date in the repository.\n-    \"\"\"\n-    rollup_bundle(\n-        name = \"%s_bundle\" % name,\n-        args = rollup_args,\n-        entry_point = entry_point,\n-        format = \"cjs\",\n-        silent = True,\n-        sourcemap = \"false\",\n-        deps = deps,\n-    )\n-\n-    generated_file_test(\n-        name = name,\n-        src = \"%s.js\" % name,\n-        generated = \"%s_bundle\" % name,\n-    )"
        },
        {
            "sha": "1c5a82ea8576eb678d8938a39ad4e357268716fe",
            "filename": "dev-infra/format/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,18 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"format\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/cli-progress\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//cli-progress\",\n-        \"@npm//multimatch\",\n-        \"@npm//yargs\",\n-    ],\n-)"
        },
        {
            "sha": "47261b58aea6d2cc241c7b8a939ff1df69e900f5",
            "filename": "dev-infra/format/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,52 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-import {GitClient} from '../utils/git/git-client';\n-\n-import {checkFiles, formatFiles} from './format';\n-\n-/** Build the parser for the format commands. */\n-export function buildFormatParser(localYargs: yargs.Argv) {\n-  return localYargs.help()\n-      .strict()\n-      .demandCommand()\n-      .option('check', {\n-        type: 'boolean',\n-        default: process.env['CI'] ? true : false,\n-        description: 'Run the formatter to check formatting rather than updating code format'\n-      })\n-      .command(\n-          'all', 'Run the formatter on all files in the repository', args => args,\n-          ({check}) => {\n-            const executionCmd = check ? checkFiles : formatFiles;\n-            const allFiles = GitClient.get().allFiles();\n-            executionCmd(allFiles);\n-          })\n-      .command(\n-          'changed [shaOrRef]', 'Run the formatter on files changed since the provided sha/ref',\n-          args => args.positional('shaOrRef', {type: 'string'}),\n-          ({shaOrRef, check}) => {\n-            const sha = shaOrRef || 'master';\n-            const executionCmd = check ? checkFiles : formatFiles;\n-            const allChangedFilesSince = GitClient.get().allChangesFilesSince(sha);\n-            executionCmd(allChangedFilesSince);\n-          })\n-      .command(\n-          'staged', 'Run the formatter on all staged files', args => args,\n-          ({check}) => {\n-            const executionCmd = check ? checkFiles : formatFiles;\n-            const allStagedFiles = GitClient.get().allStagedFiles();\n-            executionCmd(allStagedFiles);\n-          })\n-      .command(\n-          'files <files..>', 'Run the formatter on provided files',\n-          args => args.positional('files', {array: true, type: 'string'}), ({check, files}) => {\n-            const executionCmd = check ? checkFiles : formatFiles;\n-            executionCmd(files!);\n-          });\n-}"
        },
        {
            "sha": "62be7a6ca94f29a1c038607e7a0834fe0154a1de",
            "filename": "dev-infra/format/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 51,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,51 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n-\n-interface Formatter {\n-  matchers: string[];\n-}\n-\n-export interface FormatConfig {\n-  [key: string]: boolean|Formatter;\n-}\n-\n-/** Retrieve and validate the config as `FormatConfig`. */\n-export function getFormatConfig() {\n-  // List of errors encountered validating the config.\n-  const errors: string[] = [];\n-  // The unvalidated config object.\n-  const config: Partial<NgDevConfig<{format: FormatConfig}>> = getConfig();\n-\n-  if (config.format === undefined) {\n-    errors.push(`No configuration defined for \"format\"`);\n-  }\n-\n-  for (const [key, value] of Object.entries(config.format!)) {\n-    switch (typeof value) {\n-      case 'boolean':\n-        break;\n-      case 'object':\n-        checkFormatterConfig(key, value, errors);\n-        break;\n-      default:\n-        errors.push(`\"format.${key}\" is not a boolean or Formatter object`);\n-    }\n-  }\n-\n-  assertNoErrors(errors);\n-  return config as Required<typeof config>;\n-}\n-\n-/** Validate an individual Formatter config. */\n-function checkFormatterConfig(key: string, config: Partial<Formatter>, errors: string[]) {\n-  if (config.matchers === undefined) {\n-    errors.push(`Missing \"format.${key}.matchers\" value`);\n-  }\n-}"
        },
        {
            "sha": "50e458503dc7c18002d88418408bb35e7c504767",
            "filename": "dev-infra/format/format.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 80,
            "changes": 80,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformat.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformat.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformat.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,80 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {error, info, promptConfirm, red} from '../utils/console';\n-\n-import {runFormatterInParallel} from './run-commands-parallel';\n-\n-/**\n- * Format provided files in place.\n- */\n-export async function formatFiles(files: string[]) {\n-  // Whether any files failed to format.\n-  let failures = await runFormatterInParallel(files, 'format');\n-\n-  if (failures === false) {\n-    info('No files matched for formatting.');\n-    process.exit(0);\n-  }\n-\n-  // The process should exit as a failure if any of the files failed to format.\n-  if (failures.length !== 0) {\n-    error(red(`The following files could not be formatted:`));\n-    failures.forEach(({filePath, message}) => {\n-      info(`  • ${filePath}: ${message}`);\n-    });\n-    error(red(`Formatting failed, see errors above for more information.`));\n-    process.exit(1);\n-  }\n-  info(`√  Formatting complete.`);\n-  process.exit(0);\n-}\n-\n-/**\n- * Check provided files for formatting correctness.\n- */\n-export async function checkFiles(files: string[]) {\n-  // Files which are currently not formatted correctly.\n-  const failures = await runFormatterInParallel(files, 'check');\n-\n-  if (failures === false) {\n-    info('No files matched for formatting check.');\n-    process.exit(0);\n-  }\n-\n-  if (failures.length) {\n-    // Provide output expressing which files are failing formatting.\n-    info.group('\\nThe following files are out of format:');\n-    for (const {filePath} of failures) {\n-      info(`  • ${filePath}`);\n-    }\n-    info.groupEnd();\n-    info();\n-\n-    // If the command is run in a non-CI environment, prompt to format the files immediately.\n-    let runFormatter = false;\n-    if (!process.env['CI']) {\n-      runFormatter = await promptConfirm('Format the files now?', true);\n-    }\n-\n-    if (runFormatter) {\n-      // Format the failing files as requested.\n-      await formatFiles(failures.map(f => f.filePath));\n-      process.exit(0);\n-    } else {\n-      // Inform user how to format files in the future.\n-      info();\n-      info(`To format the failing file run the following command:`);\n-      info(`  yarn ng-dev format files ${failures.map(f => f.filePath).join(' ')}`);\n-      process.exit(1);\n-    }\n-  } else {\n-    info('√  All files correctly formatted.');\n-    process.exit(0);\n-  }\n-}"
        },
        {
            "sha": "65930adadb9c6442b363144939f9997562e45f13",
            "filename": "dev-infra/format/formatters/base-formatter.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 102,
            "changes": 102,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,102 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {GitClient} from '../../utils/git/git-client';\n-import {FormatConfig} from '../config';\n-\n-// A callback to determine if the formatter run found a failure in formatting.\n-export type CallbackFunc =\n-    (file: string, code: number|NodeJS.Signals, stdout: string, stderr: string) => boolean;\n-\n-// The actions a formatter can take.\n-export type FormatterAction = 'check'|'format';\n-\n-// The metadata needed for running one of the `FormatterAction`s on a file.\n-interface FormatterActionMetadata {\n-  commandFlags: string;\n-  callback: CallbackFunc;\n-}\n-\n-/**\n- * The base class for formatters to run against provided files.\n- */\n-export abstract class Formatter {\n-  protected git = GitClient.get();\n-  /**\n-   * The name of the formatter, this is used for identification in logging and for enabling and\n-   * configuring the formatter in the config.\n-   */\n-  abstract name: string;\n-\n-  /** The full path file location of the formatter binary. */\n-  abstract binaryFilePath: string;\n-\n-  /** Metadata for each `FormatterAction` available to the formatter. */\n-  abstract actions: {\n-    // An action performing a check of format without making any changes.\n-    check: FormatterActionMetadata;\n-    // An action to format files in place.\n-    format: FormatterActionMetadata;\n-  };\n-\n-  /** The default matchers for the formatter for filtering files to be formatted. */\n-  abstract defaultFileMatcher: string[];\n-\n-  constructor(protected config: FormatConfig) {}\n-\n-  /**\n-   * Retrieve the command to execute the provided action, including both the binary\n-   * and command line flags.\n-   */\n-  commandFor(action: FormatterAction) {\n-    switch (action) {\n-      case 'check':\n-        return `${this.binaryFilePath} ${this.actions.check.commandFlags}`;\n-      case 'format':\n-        return `${this.binaryFilePath} ${this.actions.format.commandFlags}`;\n-      default:\n-        throw Error('Unknown action type');\n-    }\n-  }\n-\n-  /**\n-   * Retrieve the callback for the provided action to determine if an action\n-   * failed in formatting.\n-   */\n-  callbackFor(action: FormatterAction) {\n-    switch (action) {\n-      case 'check':\n-        return this.actions.check.callback;\n-      case 'format':\n-        return this.actions.format.callback;\n-      default:\n-        throw Error('Unknown action type');\n-    }\n-  }\n-\n-  /** Whether the formatter is enabled in the provided config. */\n-  isEnabled() {\n-    return !!this.config[this.name];\n-  }\n-\n-  /** Retrieve the active file matcher for the formatter. */\n-  getFileMatcher() {\n-    return this.getFileMatcherFromConfig() || this.defaultFileMatcher;\n-  }\n-\n-  /**\n-   * Retrieves the file matcher from the config provided to the constructor if provided.\n-   */\n-  private getFileMatcherFromConfig(): string[]|undefined {\n-    const formatterConfig = this.config[this.name];\n-    if (typeof formatterConfig === 'boolean') {\n-      return undefined;\n-    }\n-    return formatterConfig.matchers;\n-  }\n-}"
        },
        {
            "sha": "3f49dc1b3c36c2b209c7602587cebc7c7937bcdc",
            "filename": "dev-infra/format/formatters/buildifier.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 54,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,54 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {join} from 'path';\n-\n-import {error} from '../../utils/console';\n-\n-import {Formatter} from './base-formatter';\n-\n-/**\n- * Formatter for running buildifier against bazel related files.\n- */\n-export class Buildifier extends Formatter {\n-  override name = 'buildifier';\n-\n-  override binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/buildifier');\n-\n-  override defaultFileMatcher = ['**/*.bzl', '**/BUILD.bazel', '**/WORKSPACE', '**/BUILD'];\n-\n-  override actions = {\n-    check: {\n-      commandFlags: `${BAZEL_WARNING_FLAG} --lint=warn --mode=check --format=json`,\n-      callback:\n-          (_: string, code: number|NodeJS.Signals, stdout: string) => {\n-            return code !== 0 || !(JSON.parse(stdout) as {success: string}).success;\n-          },\n-    },\n-    format: {\n-      commandFlags: `${BAZEL_WARNING_FLAG} --lint=fix --mode=fix`,\n-      callback:\n-          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n-            if (code !== 0) {\n-              error(`Error running buildifier on: ${file}`);\n-              error(stderr);\n-              error();\n-              return true;\n-            }\n-            return false;\n-          }\n-    }\n-  };\n-}\n-\n-// The warning flag for buildifier copied from angular/angular's usage.\n-const BAZEL_WARNING_FLAG = `--warnings=attr-cfg,attr-license,attr-non-empty,attr-output-default,` +\n-    `attr-single-file,constant-glob,ctx-args,depset-iteration,depset-union,dict-concatenation,` +\n-    `duplicated-name,filetype,git-repository,http-archive,integer-division,load,load-on-top,` +\n-    `native-build,native-package,output-group,package-name,package-on-top,positional-args,` +\n-    `redefined-variable,repository-name,same-origin-load,string-iteration,unused-variable`;"
        },
        {
            "sha": "616849a5791ca10b1e3f3e5e4d2b9eeb709ed7b3",
            "filename": "dev-infra/format/formatters/clang-format.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,47 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {join} from 'path';\n-\n-import {error} from '../../utils/console';\n-\n-import {Formatter} from './base-formatter';\n-\n-/**\n- * Formatter for running clang-format against Typescript and Javascript files\n- */\n-export class ClangFormat extends Formatter {\n-  override name = 'clang-format';\n-\n-  override binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/clang-format');\n-\n-  override defaultFileMatcher = ['**/*.{t,j}s'];\n-\n-  override actions = {\n-    check: {\n-      commandFlags: `--Werror -n -style=file`,\n-      callback:\n-          (_: string, code: number|NodeJS.Signals) => {\n-            return code !== 0;\n-          },\n-    },\n-    format: {\n-      commandFlags: `-i -style=file`,\n-      callback:\n-          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n-            if (code !== 0) {\n-              error(`Error running clang-format on: ${file}`);\n-              error(stderr);\n-              error();\n-              return true;\n-            }\n-            return false;\n-          }\n-    }\n-  };\n-}"
        },
        {
            "sha": "3279c3c279aa667f49b7042ff3cc6edb8944a08b",
            "filename": "dev-infra/format/formatters/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getFormatConfig} from '../config';\n-\n-import {Buildifier} from './buildifier';\n-import {ClangFormat} from './clang-format';\n-import {Prettier} from './prettier';\n-\n-/**\n- * Get all defined formatters which are active based on the current loaded config.\n- */\n-export function getActiveFormatters() {\n-  const config = getFormatConfig().format;\n-  return [\n-    new Prettier(config),\n-    new Buildifier(config),\n-    new ClangFormat(config),\n-  ].filter((formatter) => formatter.isEnabled());\n-}\n-\n-// Rexport symbols used for types elsewhere.\n-export {Formatter, FormatterAction} from './base-formatter';"
        },
        {
            "sha": "f2969203c76e3a1e88961c2ddaf52afe176c9205",
            "filename": "dev-infra/format/formatters/prettier.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 56,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fprettier.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,56 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {join} from 'path';\n-\n-import {spawnSync} from '../../utils/child-process';\n-import {error} from '../../utils/console';\n-\n-import {Formatter} from './base-formatter';\n-\n-/**\n- * Formatter for running prettier against Typescript and Javascript files.\n- */\n-export class Prettier extends Formatter {\n-  override name = 'prettier';\n-\n-  override binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/prettier');\n-\n-  override defaultFileMatcher = ['**/*.{t,j}s'];\n-\n-  /**\n-   * The configuration path of the prettier config, obtained during construction to prevent needing\n-   * to discover it repeatedly for each execution.\n-   */\n-  private configPath = this.config['prettier'] ?\n-      spawnSync(this.binaryFilePath, ['--find-config-path', '.']).stdout.trim() :\n-      '';\n-\n-  override actions = {\n-    check: {\n-      commandFlags: `--config ${this.configPath} --check`,\n-      callback:\n-          (_: string, code: number|NodeJS.Signals, stdout: string) => {\n-            return code !== 0;\n-          },\n-    },\n-    format: {\n-      commandFlags: `--config ${this.configPath} --write`,\n-      callback:\n-          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n-            if (code !== 0) {\n-              error(`Error running prettier on: ${file}`);\n-              error(stderr);\n-              error();\n-              return true;\n-            }\n-            return false;\n-          },\n-    },\n-  };\n-}"
        },
        {
            "sha": "c10a27f9c9c77ee18b21a00c7462d865c39e0efc",
            "filename": "dev-infra/format/run-commands-parallel.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 122,
            "changes": 122,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Frun-commands-parallel.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fformat%2Frun-commands-parallel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Frun-commands-parallel.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,122 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Bar} from 'cli-progress';\n-import * as multimatch from 'multimatch';\n-import {cpus} from 'os';\n-\n-import {spawn, SpawnResult} from '../utils/child-process';\n-import {info} from '../utils/console';\n-\n-import {Formatter, FormatterAction, getActiveFormatters} from './formatters/index';\n-\n-const AVAILABLE_THREADS = Math.max(cpus().length - 1, 1);\n-\n-/** Interface describing a failure occurred during formatting of a file. */\n-export interface FormatFailure {\n-  /** Path to the file that failed. */\n-  filePath: string;\n-  /** Error message reported by the formatter. */\n-  message: string;\n-}\n-\n-/**\n- * Run the provided commands in parallel for each provided file.\n- *\n- * Running the formatter is split across (number of available cpu threads - 1) processess.\n- * The task is done in multiple processess to speed up the overall time of the task, as running\n- * across entire repositories takes a large amount of time.\n- * As a data point for illustration, using 8 process rather than 1 cut the execution\n- * time from 276 seconds to 39 seconds for the same 2700 files.\n- *\n- * A promise is returned, completed when the command has completed running for each file.\n- * The promise resolves with a list of failures, or `false` if no formatters have matched.\n- */\n-export function runFormatterInParallel(allFiles: string[], action: FormatterAction) {\n-  return new Promise<false|FormatFailure[]>((resolve) => {\n-    const formatters = getActiveFormatters();\n-    const failures: FormatFailure[] = [];\n-    const pendingCommands: {formatter: Formatter, file: string}[] = [];\n-\n-    for (const formatter of formatters) {\n-      pendingCommands.push(\n-          ...multimatch.call(undefined, allFiles, formatter.getFileMatcher(), {dot: true})\n-              .map(file => ({formatter, file})));\n-    }\n-\n-    // If no commands are generated, resolve the promise as `false` as no files\n-    // were run against the any formatters.\n-    if (pendingCommands.length === 0) {\n-      return resolve(false);\n-    }\n-\n-    switch (action) {\n-      case 'format':\n-        info(`Formatting ${pendingCommands.length} file(s)`);\n-        break;\n-      case 'check':\n-        info(`Checking format of ${pendingCommands.length} file(s)`);\n-        break;\n-      default:\n-        throw Error(`Invalid format action \"${action}\": allowed actions are \"format\" and \"check\"`);\n-    }\n-\n-    // The progress bar instance to use for progress tracking.\n-    const progressBar =\n-        new Bar({format: `[{bar}] ETA: {eta}s | {value}/{total} files`, clearOnComplete: true});\n-    // A local copy of the files to run the command on.\n-    // An array to represent the current usage state of each of the threads for parallelization.\n-    const threads = new Array<boolean>(AVAILABLE_THREADS).fill(false);\n-\n-    // Recursively run the command on the next available file from the list using the provided\n-    // thread.\n-    function runCommandInThread(thread: number) {\n-      const nextCommand = pendingCommands.pop();\n-      // If no file was pulled from the array, return as there are no more files to run against.\n-      if (nextCommand === undefined) {\n-        threads[thread] = false;\n-        return;\n-      }\n-\n-      // Get the file and formatter for the next command.\n-      const {file, formatter} = nextCommand;\n-\n-      const [spawnCmd, ...spawnArgs] = [...formatter.commandFor(action).split(' '), file];\n-      spawn(spawnCmd, spawnArgs, {suppressErrorOnFailingExitCode: true, mode: 'silent'})\n-          .then(({stdout, stderr, status}: SpawnResult) => {\n-            // Run the provided callback function.\n-            const failed = formatter.callbackFor(action)(file, status, stdout, stderr);\n-            if (failed) {\n-              failures.push({filePath: file, message: stderr});\n-            }\n-            // Note in the progress bar another file being completed.\n-            progressBar.increment(1);\n-            // If more files exist in the list, run again to work on the next file,\n-            // using the same slot.\n-            if (pendingCommands.length) {\n-              return runCommandInThread(thread);\n-            }\n-            // If not more files are available, mark the thread as unused.\n-            threads[thread] = false;\n-            // If all of the threads are false, as they are unused, mark the progress bar\n-            // completed and resolve the promise.\n-            if (threads.every(active => !active)) {\n-              progressBar.stop();\n-              resolve(failures);\n-            }\n-          });\n-      // Mark the thread as in use as the command execution has been started.\n-      threads[thread] = true;\n-    }\n-\n-    // Start the progress bar\n-    progressBar.start(pendingCommands.length, 0);\n-    // Start running the command on files from the least in each available thread.\n-    threads.forEach((_, idx) => runCommandInThread(idx));\n-  });\n-}"
        },
        {
            "sha": "cd495e8552cf4b72155df44633de38f701412b6d",
            "filename": "dev-infra/index.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Findex.bzl?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,9 +0,0 @@\n-# Copyright Google LLC All Rights Reserved.\n-#\n-# Use of this source code is governed by an MIT-style license that can be\n-# found in the LICENSE file at https://angular.io/license\n-\n-# File is currently empty but serves as indicator for `rules_nodejs` and instructs it to\n-# preserve the content output in the NPM install workspace. This allows consumers to use\n-# rules and targets from within Bazel. e.g. by using `@npm//@angular/dev-infra-private/<..>`.\n-# See: https://github.com/bazelbuild/rules_nodejs/commit/4f508b1a0be1f5444e9c13b0439e649449792fef."
        },
        {
            "sha": "49c38e1561503801f29a537db89932dff9d1d338",
            "filename": "dev-infra/misc/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fmisc%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"misc\",\n-    srcs = glob([\"**/*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/build\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//chalk\",\n-    ],\n-)"
        },
        {
            "sha": "d9144b6a3210641d1657eaf37b24da2a3e63ece1",
            "filename": "dev-infra/misc/build-and-link/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 69,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,69 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {green} from 'chalk';\n-import {lstatSync} from 'fs';\n-import {resolve} from 'path';\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {buildReleaseOutput} from '../../release/build/index';\n-import {spawn} from '../../utils/child-process';\n-import {error, info, red} from '../../utils/console';\n-\n-\n-/** Command line options. */\n-export interface BuildAndLinkOptions {\n-  projectRoot: string;\n-}\n-\n-/** Yargs command builder for the command. */\n-function builder(argv: Argv): Argv<BuildAndLinkOptions> {\n-  return argv.positional('projectRoot', {\n-    type: 'string',\n-    normalize: true,\n-    coerce: (path: string) => resolve(path),\n-    demandOption: true,\n-  });\n-}\n-\n-/** Yargs command handler for the command. */\n-async function handler({projectRoot}: Arguments<BuildAndLinkOptions>) {\n-  try {\n-    if (!lstatSync(projectRoot).isDirectory()) {\n-      error(red(`  ✘   The 'projectRoot' must be a directory: ${projectRoot}`));\n-      process.exit(1);\n-    }\n-  } catch {\n-    error(red(`  ✘   Could not find the 'projectRoot' provided: ${projectRoot}`));\n-    process.exit(1);\n-  }\n-\n-  const releaseOutputs = await buildReleaseOutput(false);\n-\n-  if (releaseOutputs === null) {\n-    error(red(`  ✘   Could not build release output. Please check output above.`));\n-    process.exit(1);\n-  }\n-  info(green(` ✓  Built release output.`));\n-\n-  for (const {outputPath, name} of releaseOutputs) {\n-    await spawn('yarn', ['link', '--cwd', outputPath]);\n-    await spawn('yarn', ['link', '--cwd', projectRoot, name]);\n-  }\n-\n-  info(green(` ✓  Linked release packages in provided project.`));\n-}\n-\n-/** CLI command module. */\n-export const BuildAndLinkCommandModule: CommandModule<{}, BuildAndLinkOptions> = {\n-  builder,\n-  handler,\n-  command: 'build-and-link <projectRoot>',\n-  describe:\n-      'Builds the release output, registers the outputs as linked, and links via yarn to the provided project',\n-};"
        },
        {
            "sha": "64b2b785a4f61216a564cf2f44ea9b0dafd58d9f",
            "filename": "dev-infra/misc/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fmisc%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fmisc%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-\n-import {BuildAndLinkCommandModule} from './build-and-link/cli';\n-\n-/** Build the parser for the misc commands. */\n-export function buildMiscParser(localYargs: yargs.Argv) {\n-  return localYargs.help().strict().command(BuildAndLinkCommandModule);\n-}"
        },
        {
            "sha": "32da46f99f20a7177bde1e97a0dd9fee92c33c8c",
            "filename": "dev-infra/ng-dev.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8340,
            "changes": 8340,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=30bf47259715057b69837556010d7b91792a1ae6"
        },
        {
            "sha": "a22ccaa646f88cfb447fc0d09105822d78901132",
            "filename": "dev-infra/ngbot/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,18 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"ngbot\",\n-    srcs = [\n-        \"cli.ts\",\n-        \"verify.ts\",\n-    ],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yaml\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//yaml\",\n-        \"@npm//yargs\",\n-    ],\n-)"
        },
        {
            "sha": "e03b57926fb9d044b2f4bd24745f40bfb9dcd1ce",
            "filename": "dev-infra/ngbot/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-import {verify} from './verify';\n-\n-/** Build the parser for the NgBot commands. */\n-export function buildNgbotParser(localYargs: yargs.Argv) {\n-  return localYargs.help().strict().demandCommand().command(\n-      'verify', 'Verify the NgBot config', {}, () => verify());\n-}"
        },
        {
            "sha": "af9e559efcb6cb63c6689072f5be0d9b2ccbfe2b",
            "filename": "dev-infra/ngbot/verify.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fngbot%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2Fverify.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {readFileSync} from 'fs';\n-import {resolve} from 'path';\n-import {parse as parseYaml} from 'yaml';\n-\n-import {error, green, info, red} from '../utils/console';\n-import {GitClient} from '../utils/git/git-client';\n-\n-export function verify() {\n-  const git = GitClient.get();\n-  /** Full path to NgBot config file */\n-  const NGBOT_CONFIG_YAML_PATH = resolve(git.baseDir, '.github/angular-robot.yml');\n-\n-  /** The NgBot config file */\n-  const ngBotYaml = readFileSync(NGBOT_CONFIG_YAML_PATH, 'utf8');\n-\n-  try {\n-    // Try parsing the config file to verify that the syntax is correct.\n-    parseYaml(ngBotYaml);\n-    info(`${green('√')}  Valid NgBot YAML config`);\n-  } catch (e) {\n-    error(`${red('!')} Invalid NgBot YAML config`);\n-    error(e);\n-    process.exitCode = 1;\n-  }\n-}"
        },
        {
            "sha": "fd55fd837eeb1ebe9d7a4759b58835cdc78a9c06",
            "filename": "dev-infra/pr/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"pr\",\n-    srcs = [\"cli.ts\"],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/pr/check-target-branches\",\n-        \"//dev-infra/pr/checkout\",\n-        \"//dev-infra/pr/discover-new-conflicts\",\n-        \"//dev-infra/pr/merge\",\n-        \"//dev-infra/pr/rebase\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)"
        },
        {
            "sha": "7b33c529be91a8328070372dcbb645e7a13ca178",
            "filename": "dev-infra/pr/check-target-branches/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"check-target-branches\",\n-    srcs = glob([\"*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/pr/merge\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)"
        },
        {
            "sha": "8b151c5b6d84bb1b4550385fd9825a2d6e90040d",
            "filename": "dev-infra/pr/check-target-branches/check-target-branches.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 63,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,63 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getConfig} from '../../utils/config';\n-import {error, info, red} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-import {loadAndValidateConfig, TargetLabel} from '../merge/config';\n-import {getBranchesFromTargetLabel, getTargetLabelFromPullRequest, InvalidTargetLabelError} from '../merge/target-label';\n-\n-export async function getTargetBranchesForPr(prNumber: number) {\n-  /** The ng-dev configuration. */\n-  const config = getConfig();\n-  /** Repo owner and name for the github repository. */\n-  const {owner, name: repo} = config.github;\n-  /** The singleton instance of the GitClient. */\n-  const git = GitClient.get();\n-  /** The validated merge config. */\n-  const {config: mergeConfig, errors} = await loadAndValidateConfig(config, git.github);\n-  if (errors !== undefined) {\n-    throw Error(`Invalid configuration found: ${errors}`);\n-  }\n-  /** The current state of the pull request from Github. */\n-  const prData = (await git.github.pulls.get({owner, repo, pull_number: prNumber})).data;\n-  /** The list of labels on the PR as strings. */\n-  // Note: The `name` property of labels is always set but the Github OpenAPI spec is incorrect\n-  // here.\n-  // TODO(devversion): Remove the non-null cast once\n-  // https://github.com/github/rest-api-description/issues/169 is fixed.\n-  const labels = prData.labels.map(l => l.name!);\n-  /** The branch targetted via the Github UI. */\n-  const githubTargetBranch = prData.base.ref;\n-  /** The active label which is being used for targetting the PR. */\n-  let targetLabel: TargetLabel;\n-\n-  try {\n-    targetLabel = getTargetLabelFromPullRequest(mergeConfig!, labels);\n-  } catch (e) {\n-    if (e instanceof InvalidTargetLabelError) {\n-      error(red(e.failureMessage));\n-      process.exitCode = 1;\n-      return;\n-    }\n-    throw e;\n-  }\n-  /** The target branches based on the target label and branch targetted in the Github UI. */\n-  return await getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n-}\n-\n-\n-export async function printTargetBranchesForPr(prNumber: number) {\n-  const targets = await getTargetBranchesForPr(prNumber);\n-  if (targets === undefined) {\n-    return;\n-  }\n-  info.group(`PR #${prNumber} will merge into:`);\n-  targets.forEach(target => info(`- ${target}`));\n-  info.groupEnd();\n-}"
        },
        {
            "sha": "a00300378cb9d9ab90b19863378b93011261a6f6",
            "filename": "dev-infra/pr/check-target-branches/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 37,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,37 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {printTargetBranchesForPr} from './check-target-branches';\n-\n-export interface CheckTargetBranchesOptions {\n-  pr: number;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return yargs.positional('pr', {\n-    description: 'The pull request number',\n-    type: 'number',\n-    demandOption: true,\n-  });\n-}\n-\n-/** Handles the command. */\n-async function handler({pr}: Arguments<CheckTargetBranchesOptions>) {\n-  await printTargetBranchesForPr(pr);\n-}\n-\n-/** yargs command module describing the command.  */\n-export const CheckTargetBranchesModule: CommandModule<{}, CheckTargetBranchesOptions> = {\n-  handler,\n-  builder,\n-  command: 'check-target-branches <pr>',\n-  describe: 'Check a PR to determine what branches it is currently targeting',\n-};"
        },
        {
            "sha": "a1a2b3e3e24dff82c8d3817f689a3d49f679719d",
            "filename": "dev-infra/pr/checkout/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheckout%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheckout%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheckout%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"checkout\",\n-    srcs = glob([\"*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/pr/common\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)"
        },
        {
            "sha": "1ea44bd937fefe66ef618e98d10f251a2c0121e8",
            "filename": "dev-infra/pr/checkout/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheckout%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcheckout%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheckout%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-import {checkOutPullRequestLocally} from '../common/checkout-pr';\n-\n-export interface CheckoutOptions {\n-  prNumber: number;\n-  githubToken: string;\n-}\n-\n-/** Builds the checkout pull request command. */\n-function builder(yargs: Argv) {\n-  return addGithubTokenOption(yargs).positional('prNumber', {type: 'number', demandOption: true});\n-}\n-\n-/** Handles the checkout pull request command. */\n-async function handler({prNumber, githubToken}: Arguments<CheckoutOptions>) {\n-  const prCheckoutOptions = {allowIfMaintainerCannotModify: true, branchName: `pr-${prNumber}`};\n-  await checkOutPullRequestLocally(prNumber, githubToken, prCheckoutOptions);\n-}\n-\n-/** yargs command module for checking out a PR  */\n-export const CheckoutCommandModule: CommandModule<{}, CheckoutOptions> = {\n-  handler,\n-  builder,\n-  command: 'checkout <pr-number>',\n-  describe: 'Checkout a PR from the upstream repo',\n-};"
        },
        {
            "sha": "df57551dfabd98300c9e7c68e3a71109d617330c",
            "filename": "dev-infra/pr/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as yargs from 'yargs';\n-\n-import {CheckTargetBranchesModule} from './check-target-branches/cli';\n-import {CheckoutCommandModule} from './checkout/cli';\n-import {buildDiscoverNewConflictsCommand, handleDiscoverNewConflictsCommand} from './discover-new-conflicts/cli';\n-import {MergeCommandModule} from './merge/cli';\n-import {buildRebaseCommand, handleRebaseCommand} from './rebase/cli';\n-\n-/** Build the parser for pull request commands. */\n-export function buildPrParser(localYargs: yargs.Argv) {\n-  return localYargs.help()\n-      .strict()\n-      .demandCommand()\n-      .command(\n-          'discover-new-conflicts <pr-number>',\n-          'Check if a pending PR causes new conflicts for other pending PRs',\n-          buildDiscoverNewConflictsCommand, handleDiscoverNewConflictsCommand)\n-      .command(\n-          'rebase <pr-number>', 'Rebase a pending PR and push the rebased commits back to Github',\n-          buildRebaseCommand, handleRebaseCommand)\n-      .command(MergeCommandModule)\n-      .command(CheckoutCommandModule)\n-      .command(CheckTargetBranchesModule);\n-}"
        },
        {
            "sha": "36c43925dffb49a4321a9a9806506442f44956bf",
            "filename": "dev-infra/pr/common/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcommon%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcommon%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcommon%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"common\",\n-    srcs = glob([\"*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//typed-graphqlify\",\n-    ],\n-)"
        },
        {
            "sha": "998bbba421ff680a40e7c582dfd39e14be78abee",
            "filename": "dev-infra/pr/common/checkout-pr.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 128,
            "changes": 128,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcommon%2Fcheckout-pr.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fcommon%2Fcheckout-pr.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcommon%2Fcheckout-pr.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,128 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {types as graphqlTypes} from 'typed-graphqlify';\n-\n-import {info} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {addTokenToGitHttpsUrl} from '../../utils/git/github-urls';\n-import {getPr} from '../../utils/github';\n-\n-/* Graphql schema for the response body for a pending PR. */\n-const PR_SCHEMA = {\n-  state: graphqlTypes.string,\n-  maintainerCanModify: graphqlTypes.boolean,\n-  viewerDidAuthor: graphqlTypes.boolean,\n-  headRefOid: graphqlTypes.string,\n-  headRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-  baseRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-};\n-\n-\n-export class UnexpectedLocalChangesError extends Error {\n-  constructor(m: string) {\n-    super(m);\n-    Object.setPrototypeOf(this, UnexpectedLocalChangesError.prototype);\n-  }\n-}\n-\n-export class MaintainerModifyAccessError extends Error {\n-  constructor(m: string) {\n-    super(m);\n-    Object.setPrototypeOf(this, MaintainerModifyAccessError.prototype);\n-  }\n-}\n-\n-/** Options for checking out a PR */\n-export interface PullRequestCheckoutOptions {\n-  /** Whether the PR should be checked out if the maintainer cannot modify. */\n-  allowIfMaintainerCannotModify?: boolean;\n-}\n-\n-/**\n- * Rebase the provided PR onto its merge target branch, and push up the resulting\n- * commit to the PRs repository.\n- */\n-export async function checkOutPullRequestLocally(\n-    prNumber: number, githubToken: string, opts: PullRequestCheckoutOptions = {}) {\n-  /** The singleton instance of the authenticated git client. */\n-  const git = AuthenticatedGitClient.get();\n-\n-  // In order to preserve local changes, checkouts cannot occur if local changes are present in the\n-  // git environment. Checked before retrieving the PR to fail fast.\n-  if (git.hasUncommittedChanges()) {\n-    throw new UnexpectedLocalChangesError('Unable to checkout PR due to uncommitted changes.');\n-  }\n-\n-  /**\n-   * The branch or revision originally checked out before this method performed\n-   * any Git operations that may change the working branch.\n-   */\n-  const previousBranchOrRevision = git.getCurrentBranchOrRevision();\n-  /* The PR information from Github. */\n-  const pr = await getPr(PR_SCHEMA, prNumber, git);\n-  /** The branch name of the PR from the repository the PR came from. */\n-  const headRefName = pr.headRef.name;\n-  /** The full ref for the repository and branch the PR came from. */\n-  const fullHeadRef = `${pr.headRef.repository.nameWithOwner}:${headRefName}`;\n-  /** The full URL path of the repository the PR came from with github token as authentication. */\n-  const headRefUrl = addTokenToGitHttpsUrl(pr.headRef.repository.url, githubToken);\n-  // Note: Since we use a detached head for rebasing the PR and therefore do not have\n-  // remote-tracking branches configured, we need to set our expected ref and SHA. This\n-  // allows us to use `--force-with-lease` for the detached head while ensuring that we\n-  // never accidentally override upstream changes that have been pushed in the meanwhile.\n-  // See:\n-  // https://git-scm.com/docs/git-push#Documentation/git-push.txt---force-with-leaseltrefnamegtltexpectgt\n-  /** Flag for a force push with lease back to upstream. */\n-  const forceWithLeaseFlag = `--force-with-lease=${headRefName}:${pr.headRefOid}`;\n-\n-  // If the PR does not allow maintainers to modify it, exit as the rebased PR cannot\n-  // be pushed up.\n-  if (!pr.maintainerCanModify && !pr.viewerDidAuthor && !opts.allowIfMaintainerCannotModify) {\n-    throw new MaintainerModifyAccessError('PR is not set to allow maintainers to modify the PR');\n-  }\n-\n-  try {\n-    // Fetch the branch at the commit of the PR, and check it out in a detached state.\n-    info(`Checking out PR #${prNumber} from ${fullHeadRef}`);\n-    git.run(['fetch', '-q', headRefUrl, headRefName]);\n-    git.run(['checkout', '--detach', 'FETCH_HEAD']);\n-  } catch (e) {\n-    git.checkout(previousBranchOrRevision, true);\n-    throw e;\n-  }\n-\n-  return {\n-    /**\n-     * Pushes the current local branch to the PR on the upstream repository.\n-     *\n-     * @returns true If the command did not fail causing a GitCommandError to be thrown.\n-     * @throws GitCommandError Thrown when the push back to upstream fails.\n-     */\n-    pushToUpstream: (): true => {\n-      git.run(['push', headRefUrl, `HEAD:${headRefName}`, forceWithLeaseFlag]);\n-      return true;\n-    },\n-    /** Restores the state of the local repository to before the PR checkout occured. */\n-    resetGitState: (): boolean => {\n-      return git.checkout(previousBranchOrRevision, true);\n-    }\n-  };\n-}"
        },
        {
            "sha": "e88ed7eaeda4cd30e810357b9e1fe0920b5be0e7",
            "filename": "dev-infra/pr/discover-new-conflicts/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"discover-new-conflicts\",\n-    srcs = [\n-        \"cli.ts\",\n-        \"index.ts\",\n-    ],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/cli-progress\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//typed-graphqlify\",\n-    ],\n-)"
        },
        {
            "sha": "11e4cd0f248d4e9439916b4ee48af9ca69dd2e8e",
            "filename": "dev-infra/pr/discover-new-conflicts/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 54,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,54 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv} from 'yargs';\n-\n-import {error} from '../../utils/console';\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-\n-import {discoverNewConflictsForPr} from './index';\n-\n-/** The options available to the discover-new-conflicts command via CLI. */\n-export interface DiscoverNewConflictsCommandOptions {\n-  date: number;\n-  'pr-number': number;\n-}\n-\n-/** Builds the discover-new-conflicts pull request command. */\n-export function buildDiscoverNewConflictsCommand(yargs: Argv):\n-    Argv<DiscoverNewConflictsCommandOptions> {\n-  return addGithubTokenOption(yargs)\n-      .option('date', {\n-        description: 'Only consider PRs updated since provided date',\n-        defaultDescription: '30 days ago',\n-        coerce: (date) => typeof date === 'number' ? date : Date.parse(date),\n-        default: getThirtyDaysAgoDate(),\n-      })\n-      .positional('pr-number', {demandOption: true, type: 'number'});\n-}\n-\n-/** Handles the discover-new-conflicts pull request command. */\n-export async function handleDiscoverNewConflictsCommand(\n-    {'pr-number': prNumber, date}: Arguments<DiscoverNewConflictsCommandOptions>) {\n-  // If a provided date is not able to be parsed, yargs provides it as NaN.\n-  if (isNaN(date)) {\n-    error('Unable to parse the value provided via --date flag');\n-    process.exit(1);\n-  }\n-  await discoverNewConflictsForPr(prNumber, date);\n-}\n-\n-/** Gets a date object 30 days ago from today. */\n-function getThirtyDaysAgoDate() {\n-  const date = new Date();\n-  // Set the hours, minutes and seconds to 0 to only consider date.\n-  date.setHours(0, 0, 0, 0);\n-  // Set the date to 30 days in the past.\n-  date.setDate(date.getDate() - 30);\n-  return date.getTime();\n-}"
        },
        {
            "sha": "7438b02dfb0c295193910f8ad1362d3927f3cf62",
            "filename": "dev-infra/pr/discover-new-conflicts/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 156,
            "changes": 156,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,156 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Bar} from 'cli-progress';\n-import {types as graphqlTypes} from 'typed-graphqlify';\n-\n-import {error, info} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {GitCommandError} from '../../utils/git/git-client';\n-import {getPendingPrs} from '../../utils/github';\n-\n-\n-/* Graphql schema for the response body for each pending PR. */\n-const PR_SCHEMA = {\n-  headRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-  baseRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-  updatedAt: graphqlTypes.string,\n-  number: graphqlTypes.number,\n-  mergeable: graphqlTypes.string,\n-  title: graphqlTypes.string,\n-};\n-\n-/* Pull Request response from Github Graphql query */\n-type RawPullRequest = typeof PR_SCHEMA;\n-\n-/** Convert raw Pull Request response from Github to usable Pull Request object. */\n-function processPr(pr: RawPullRequest) {\n-  return {...pr, updatedAt: (new Date(pr.updatedAt)).getTime()};\n-}\n-\n-/* Pull Request object after processing, derived from the return type of the processPr function. */\n-type PullRequest = ReturnType<typeof processPr>;\n-\n-/** Name of a temporary local branch that is used for checking conflicts. **/\n-const tempWorkingBranch = '__NgDevRepoBaseAfterChange__';\n-\n-/** Checks if the provided PR will cause new conflicts in other pending PRs. */\n-export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfter: number) {\n-  /** The singleton instance of the authenticated git client. */\n-  const git = AuthenticatedGitClient.get();\n-  // If there are any local changes in the current repository state, the\n-  // check cannot run as it needs to move between branches.\n-  if (git.hasUncommittedChanges()) {\n-    error('Cannot run with local changes. Please make sure there are no local changes.');\n-    process.exit(1);\n-  }\n-\n-  /** The active github branch or revision before we performed any Git commands. */\n-  const previousBranchOrRevision = git.getCurrentBranchOrRevision();\n-  /* Progress bar to indicate progress. */\n-  const progressBar = new Bar({format: `[{bar}] ETA: {eta}s | {value}/{total}`});\n-  /* PRs which were found to be conflicting. */\n-  const conflicts: Array<PullRequest> = [];\n-\n-  info(`Requesting pending PRs from Github`);\n-  /** List of PRs from github currently known as mergeable. */\n-  const allPendingPRs = (await getPendingPrs(PR_SCHEMA, git)).map(processPr);\n-  /** The PR which is being checked against. */\n-  const requestedPr = allPendingPRs.find(pr => pr.number === newPrNumber);\n-  if (requestedPr === undefined) {\n-    error(\n-        `The request PR, #${newPrNumber} was not found as a pending PR on github, please confirm`);\n-    error(`the PR number is correct and is an open PR`);\n-    process.exit(1);\n-  }\n-\n-  const pendingPrs = allPendingPRs.filter(pr => {\n-    return (\n-        // PRs being merged into the same target branch as the requested PR\n-        pr.baseRef.name === requestedPr.baseRef.name &&\n-        // PRs which either have not been processed or are determined as mergeable by Github\n-        pr.mergeable !== 'CONFLICTING' &&\n-        // PRs updated after the provided date\n-        pr.updatedAt >= updatedAfter);\n-  });\n-  info(`Retrieved ${allPendingPRs.length} total pending PRs`);\n-  info(`Checking ${pendingPrs.length} PRs for conflicts after a merge of #${newPrNumber}`);\n-\n-  // Fetch and checkout the PR being checked.\n-  git.run(['fetch', '-q', requestedPr.headRef.repository.url, requestedPr.headRef.name]);\n-  git.run(['checkout', '-q', '-B', tempWorkingBranch, 'FETCH_HEAD']);\n-\n-  // Rebase the PR against the PRs target branch.\n-  git.run(['fetch', '-q', requestedPr.baseRef.repository.url, requestedPr.baseRef.name]);\n-  try {\n-    git.run(['rebase', 'FETCH_HEAD'], {stdio: 'ignore'});\n-  } catch (err) {\n-    if (err instanceof GitCommandError) {\n-      error('The requested PR currently has conflicts');\n-      git.checkout(previousBranchOrRevision, true);\n-      process.exit(1);\n-    }\n-    throw err;\n-  }\n-\n-  // Start the progress bar\n-  progressBar.start(pendingPrs.length, 0);\n-\n-  // Check each PR to determine if it can merge cleanly into the repo after the target PR.\n-  for (const pr of pendingPrs) {\n-    // Fetch and checkout the next PR\n-    git.run(['fetch', '-q', pr.headRef.repository.url, pr.headRef.name]);\n-    git.run(['checkout', '-q', '--detach', 'FETCH_HEAD']);\n-    // Check if the PR cleanly rebases into the repo after the target PR.\n-    try {\n-      git.run(['rebase', tempWorkingBranch], {stdio: 'ignore'});\n-    } catch (err) {\n-      if (err instanceof GitCommandError) {\n-        conflicts.push(pr);\n-      } else {\n-        throw err;\n-      }\n-    }\n-    // Abort any outstanding rebase attempt.\n-    git.runGraceful(['rebase', '--abort'], {stdio: 'ignore'});\n-\n-    progressBar.increment(1);\n-  }\n-  // End the progress bar as all PRs have been processed.\n-  progressBar.stop();\n-  info();\n-  info(`Result:`);\n-\n-  git.checkout(previousBranchOrRevision, true);\n-\n-  // If no conflicts are found, exit successfully.\n-  if (conflicts.length === 0) {\n-    info(`No new conflicting PRs found after #${newPrNumber} merging`);\n-    process.exit(0);\n-  }\n-\n-  // Inform about discovered conflicts, exit with failure.\n-  error.group(`${conflicts.length} PR(s) which conflict(s) after #${newPrNumber} merges:`);\n-  for (const pr of conflicts) {\n-    error(`  - #${pr.number}: ${pr.title}`);\n-  }\n-  error.groupEnd();\n-  process.exit(1);\n-}"
        },
        {
            "sha": "e1d94a8c6a452e6ad85595eac39b9df02d9e5fa0",
            "filename": "dev-infra/pr/merge/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 60,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,60 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"merge\",\n-    srcs = glob(\n-        [\"**/*.ts\"],\n-        exclude = [\"**/*.spec.ts\"],\n-    ),\n-\n-    # prodmode target must be set to es5 as the Ora class, which is extended is not a proper\n-    # prototyped object.\n-    prodmode_target = \"es5\",\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@octokit/plugin-rest-endpoint-methods\",\n-        \"@npm//@octokit/rest\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/node-fetch\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//chalk\",\n-        \"@npm//typed-graphqlify\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    testonly = True,\n-    srcs = glob([\"**/*.spec.ts\"]),\n-    deps = [\n-        \":merge\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"//dev-infra/utils/testing\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/node-fetch\",\n-        \"@npm//nock\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    # Disable the Bazel patched module resolution. It always loads \".mjs\" files first. This\n-    # breaks NodeJS execution for \"node-fetch\" as it uses experimental modules which are not\n-    # enabled in NodeJS. TODO: Remove this with rules_nodejs 3.x where patching is optional.\n-    # https://github.com/bazelbuild/rules_nodejs/commit/7d070ffadf9c3b41711382a4737b995f987c14fa.\n-    args = [\"--nobazel_patch_module_resolver\"],\n-    deps = [\n-        \":test_lib\",\n-        \"@npm//node-fetch\",\n-        \"@npm//semver\",\n-    ],\n-)"
        },
        {
            "sha": "e752422d74f0736777a9cad64387c936c718beda",
            "filename": "dev-infra/pr/merge/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,50 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-\n-import {mergePullRequest} from './index';\n-\n-/** The options available to the merge command via CLI. */\n-export interface MergeCommandOptions {\n-  githubToken: string;\n-  pr: number;\n-  branchPrompt: boolean;\n-}\n-\n-/** Builds the command. */\n-function builder(yargs: Argv) {\n-  return addGithubTokenOption(yargs)\n-      .help()\n-      .strict()\n-      .positional('pr', {\n-        demandOption: true,\n-        type: 'number',\n-        description: 'The PR to be merged.',\n-      })\n-      .option('branch-prompt' as 'branchPrompt', {\n-        type: 'boolean',\n-        default: true,\n-        description: 'Whether to prompt to confirm the branches a PR will merge into.',\n-      });\n-}\n-\n-/** Handles the command. */\n-async function handler({pr, branchPrompt}: Arguments<MergeCommandOptions>) {\n-  await mergePullRequest(pr, {branchPrompt});\n-}\n-\n-/** yargs command module describing the command. */\n-export const MergeCommandModule: CommandModule<{}, MergeCommandOptions> = {\n-  handler,\n-  builder,\n-  command: 'merge <pr>',\n-  describe: 'Merge a PR into its targeted branches.',\n-};"
        },
        {
            "sha": "b34df2ed24b53ad8328c5d81e7d5ec5c710b5acf",
            "filename": "dev-infra/pr/merge/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 132,
            "changes": 132,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,132 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {GitClientConfig, NgDevConfig} from '../../utils/config';\n-import {GithubClient} from '../../utils/git/github';\n-\n-import {GithubApiMergeStrategyConfig} from './strategies/api-merge';\n-\n-/** Describes possible values that can be returned for `branches` of a target label. */\n-export type TargetLabelBranchResult = string[]|Promise<string[]>;\n-\n-/**\n- * Possible merge methods supported by the Github API.\n- * https://developer.github.com/v3/pulls/#merge-a-pull-request-merge-button.\n- */\n-export type GithubApiMergeMethod = 'merge'|'squash'|'rebase';\n-\n-/**\n- * Target labels represent Github pull requests labels. These labels instruct the merge\n- * script into which branches a given pull request should be merged to.\n- */\n-export interface TargetLabel {\n-  /** Pattern that matches the given target label. */\n-  pattern: RegExp|string;\n-  /**\n-   * List of branches a pull request with this target label should be merged into.\n-   * Can also be wrapped in a function that accepts the target branch specified in the\n-   * Github Web UI. This is useful for supporting labels like `target: development-branch`.\n-   *\n-   * @throws {InvalidTargetLabelError} Invalid label has been applied to pull request.\n-   * @throws {InvalidTargetBranchError} Invalid Github target branch has been selected.\n-   */\n-  branches: TargetLabelBranchResult|((githubTargetBranch: string) => TargetLabelBranchResult);\n-}\n-\n-/**\n- * Configuration for the merge script with all remote options specified. The\n- * default `MergeConfig` has does not require any of these options as defaults\n- * are provided by the common dev-infra github configuration.\n- */\n-export type MergeConfigWithRemote = MergeConfig&{remote: GitClientConfig};\n-\n-/** Configuration for the merge script. */\n-export interface MergeConfig {\n-  /**\n-   * Configuration for the upstream remote. All of these options are optional as\n-   * defaults are provided by the common dev-infra github configuration.\n-   */\n-  remote?: GitClientConfig;\n-  /** List of target labels. */\n-  labels: TargetLabel[];\n-  /** Required base commits for given branches. */\n-  requiredBaseCommits?: {[branchName: string]: string};\n-  /** Pattern that matches labels which imply a signed CLA. */\n-  claSignedLabel: string|RegExp;\n-  /** Pattern that matches labels which imply a merge ready pull request. */\n-  mergeReadyLabel: string|RegExp;\n-  /** Label that is applied when special attention from the caretaker is required. */\n-  caretakerNoteLabel?: string|RegExp;\n-  /** Label which can be applied to fixup commit messages in the merge script. */\n-  commitMessageFixupLabel: string|RegExp;\n-  /** Label that is applied when a breaking change is made in the pull request. */\n-  breakingChangeLabel?: string;\n-  /**\n-   * Whether pull requests should be merged using the Github API. This can be enabled\n-   * if projects want to have their pull requests show up as `Merged` in the Github UI.\n-   * The downside is that fixup or squash commits no longer work as the Github API does\n-   * not support this.\n-   */\n-  githubApiMerge: false|GithubApiMergeStrategyConfig;\n-  /**\n-   * List of commit scopes which are exempted from target label content requirements. i.e. no `feat`\n-   * scopes in patch branches, no breaking changes in minor or patch changes.\n-   */\n-  targetLabelExemptScopes?: string[];\n-}\n-\n-/**\n- * Configuration of the merge script in the dev-infra configuration. Note that the\n- * merge configuration is retrieved lazily as usually these configurations rely\n- * on branch name computations. We don't want to run these immediately whenever\n- * the dev-infra configuration is loaded as that could slow-down other commands.\n- */\n-export type DevInfraMergeConfig =\n-    NgDevConfig<{'merge': (api: GithubClient) => MergeConfig | Promise<MergeConfig>}>;\n-\n-/** Loads and validates the merge configuration. */\n-export async function loadAndValidateConfig(\n-    config: Partial<DevInfraMergeConfig>,\n-    api: GithubClient): Promise<{config?: MergeConfig, errors?: string[]}> {\n-  if (config.merge === undefined) {\n-    return {errors: ['No merge configuration found. Set the `merge` configuration.']};\n-  }\n-\n-  if (typeof config.merge !== 'function') {\n-    return {errors: ['Expected merge configuration to be defined lazily through a function.']};\n-  }\n-\n-  const mergeConfig = await config.merge(api);\n-  const errors = validateMergeConfig(mergeConfig);\n-\n-  if (errors.length) {\n-    return {errors};\n-  }\n-\n-  return {config: mergeConfig};\n-}\n-\n-/** Validates the specified configuration. Returns a list of failure messages. */\n-function validateMergeConfig(config: Partial<MergeConfig>): string[] {\n-  const errors: string[] = [];\n-  if (!config.labels) {\n-    errors.push('No label configuration.');\n-  } else if (!Array.isArray(config.labels)) {\n-    errors.push('Label configuration needs to be an array.');\n-  }\n-  if (!config.claSignedLabel) {\n-    errors.push('No CLA signed label configured.');\n-  }\n-  if (!config.mergeReadyLabel) {\n-    errors.push('No merge ready label configured.');\n-  }\n-  if (config.githubApiMerge === undefined) {\n-    errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');\n-  }\n-  return errors;\n-}"
        },
        {
            "sha": "292bf3fb3ebd79ff4c71a769207c784dfcf4c4cd",
            "filename": "dev-infra/pr/merge/defaults/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,10 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export * from './labels';\n-export * from './lts-branch';"
        },
        {
            "sha": "83a86bb2a8862ced404a9297ba3f89df3554bfcf",
            "filename": "dev-infra/pr/merge/defaults/integration.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 508,
            "changes": 508,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fintegration.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,508 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as nock from 'nock';\n-import {ParsedUrlQuery} from 'querystring';\n-\n-import {ReleaseConfig} from '../../../release/config/index';\n-import {_npmPackageInfoCache, NpmPackageInfo} from '../../../release/versioning/npm-registry';\n-import {GithubConfig} from '../../../utils/config';\n-import * as console from '../../../utils/console';\n-import {GithubClient} from '../../../utils/git/github';\n-import {buildGithubPaginationResponseHeader} from '../../../utils/testing/github-pagination-header';\n-import {TargetLabel} from '../config';\n-import {getBranchesFromTargetLabel, getTargetLabelFromPullRequest} from '../target-label';\n-\n-import {getDefaultTargetLabelConfiguration} from './index';\n-\n-const API_ENDPOINT = `https://api.github.com`;\n-\n-describe('default target labels', () => {\n-  let api: GithubClient;\n-  let githubConfig: GithubConfig;\n-  let releaseConfig: ReleaseConfig;\n-\n-  beforeEach(() => {\n-    api = new GithubClient();\n-    githubConfig = {owner: 'angular', name: 'dev-infra-test'};\n-    releaseConfig = {\n-      npmPackages: ['@angular/dev-infra-test-pkg'],\n-      buildPackages: async () => [],\n-      releaseNotes: {}\n-    };\n-\n-    // The label determination will print warn messages. These should not be\n-    // printed to the console, so we turn `console.warn` into a spy.\n-    spyOn(console, 'warn');\n-  });\n-\n-  afterEach(() => nock.cleanAll());\n-\n-  async function computeTargetLabels(): Promise<TargetLabel[]> {\n-    return getDefaultTargetLabelConfiguration(api, githubConfig, releaseConfig);\n-  }\n-\n-  function getRepoApiRequestUrl(): string {\n-    return `${API_ENDPOINT}/repos/${githubConfig.owner}/${githubConfig.name}`;\n-  }\n-\n-  /**\n-   * Mocks a branch `package.json` version API request.\n-   * https://docs.github.com/en/rest/reference/repos#get-repository-content.\n-   */\n-  function interceptBranchVersionRequest(branchName: string, version: string) {\n-    nock(getRepoApiRequestUrl())\n-        .get('/contents/%2Fpackage.json')\n-        .query(params => params.ref === branchName)\n-        .reply(200, {content: Buffer.from(JSON.stringify({version})).toString('base64')});\n-  }\n-\n-  /** Fakes a prompt confirm question with the given value. */\n-  function fakePromptConfirmValue(returnValue: boolean) {\n-    spyOn(console, 'promptConfirm').and.resolveTo(returnValue);\n-  }\n-\n-  /** Fakes a NPM package query API request. */\n-  function fakeNpmPackageQueryRequest(data: Partial<NpmPackageInfo>) {\n-    _npmPackageInfoCache[releaseConfig.npmPackages[0]] =\n-        Promise.resolve({'dist-tags': {}, versions: {}, time: {}, ...data});\n-  }\n-\n-  /**\n-   * Mocks a repository branch list API request.\n-   * https://docs.github.com/en/rest/reference/repos#list-branches.\n-   */\n-  function interceptBranchesListRequest(branches: string[]) {\n-    nock(getRepoApiRequestUrl())\n-        .get('/branches')\n-        .query(true)\n-        .reply(200, branches.slice(0, 29).map(name => ({name})));\n-  }\n-\n-  /**\n-   * Mocks a repository branch list API request with pagination.\n-   * https://docs.github.com/en/rest/guides/traversing-with-pagination.\n-   * https://docs.github.com/en/rest/reference/repos#list-branches.\n-   */\n-  function interceptBranchesListRequestWithPagination(branches: string[]) {\n-    const apiUrl = getRepoApiRequestUrl();\n-\n-    // For each branch, create its own API page so that pagination is required\n-    // to resolve all given branches.\n-    for (let index = 0; index < branches.length; index++) {\n-      // Pages start with `1` as per the Github API specification.\n-      const pageNum = index + 1;\n-      const name = branches[index];\n-      const linkHeader =\n-          buildGithubPaginationResponseHeader(branches.length, pageNum, `${apiUrl}/branches`);\n-\n-      // For the first page, either `?page=1` needs to be set, or no `page` should be specified.\n-      const queryMatch = pageNum === 1 ?\n-          (params: ParsedUrlQuery) => params.page === '1' || params.page === undefined :\n-          {page: pageNum};\n-\n-      nock(getRepoApiRequestUrl()).get('/branches').query(queryMatch).reply(200, [{name}], {\n-        link: linkHeader,\n-      });\n-    }\n-  }\n-\n-  async function getBranchesForLabel(\n-      name: string, githubTargetBranch = 'master', labels?: TargetLabel[]): Promise<string[]|null> {\n-    if (labels === undefined) {\n-      labels = await computeTargetLabels();\n-    }\n-    let label: TargetLabel;\n-    try {\n-      label = getTargetLabelFromPullRequest({labels}, [name]);\n-    } catch (error) {\n-      return null;\n-    }\n-    return await getBranchesFromTargetLabel(label, githubTargetBranch);\n-  }\n-\n-  it('should detect \"master\" as branch for target: minor', async () => {\n-    interceptBranchVersionRequest('master', '11.0.0-next.0');\n-    interceptBranchVersionRequest('10.2.x', '10.2.4');\n-\n-    // Note: We add a few more branches here to ensure that branches API requests are\n-    // paginated properly. In Angular projects, there are usually many branches so that\n-    // pagination is ultimately needed to detect the active release trains.\n-    // See: https://github.com/angular/angular/commit/261b060fa168754db00248d1c5c9574bb19a72b4.\n-    interceptBranchesListRequestWithPagination(['9.8.x', '10.1.x', '10.2.x']);\n-\n-    expect(await getBranchesForLabel('target: minor')).toEqual(['master']);\n-  });\n-\n-  it('should error if non version-branch is targeted with \"target: lts\"', async () => {\n-    interceptBranchVersionRequest('master', '11.0.0-next.0');\n-    interceptBranchVersionRequest('10.2.x', '10.2.4');\n-    interceptBranchesListRequest(['10.2.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', 'master'))\n-        .toBeRejectedWith(jasmine.objectContaining({\n-          failureMessage:\n-              'PR cannot be merged as it does not target a long-term support branch: \"master\"'\n-        }));\n-  });\n-\n-  it('should error if patch branch is targeted with \"target: lts\"', async () => {\n-    interceptBranchVersionRequest('master', '11.0.0-next.0');\n-    interceptBranchVersionRequest('10.2.x', '10.2.4');\n-    interceptBranchesListRequest(['10.2.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWith(jasmine.objectContaining({\n-          failureMessage:\n-              'PR cannot be merged with \"target: lts\" into patch branch. Consider changing the ' +\n-              'label to \"target: patch\" if this is intentional.'\n-        }));\n-  });\n-\n-  it('should error if feature-freeze branch is targeted with \"target: lts\"', async () => {\n-    interceptBranchVersionRequest('master', '11.0.0-next.0');\n-    interceptBranchVersionRequest('10.2.x', '10.2.0-next.0');\n-    interceptBranchVersionRequest('10.1.x', '10.1.0');\n-    interceptBranchesListRequest(['10.1.x', '10.2.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWith(jasmine.objectContaining({\n-          failureMessage:\n-              'PR cannot be merged with \"target: lts\" into feature-freeze/release-candidate branch. ' +\n-              'Consider changing the label to \"target: rc\" if this is intentional.'\n-        }));\n-  });\n-\n-  it('should error if release-candidate branch is targeted with \"target: lts\"', async () => {\n-    interceptBranchVersionRequest('master', '11.0.0-next.0');\n-    interceptBranchVersionRequest('10.2.x', '10.2.0-rc.0');\n-    interceptBranchVersionRequest('10.1.x', '10.1.0');\n-    interceptBranchesListRequest(['10.1.x', '10.2.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWith(jasmine.objectContaining({\n-          failureMessage:\n-              'PR cannot be merged with \"target: lts\" into feature-freeze/release-candidate branch. ' +\n-              'Consider changing the label to \"target: rc\" if this is intentional.'\n-        }));\n-  });\n-\n-  it('should error if branch targeted with \"target: lts\" is no longer active', async () => {\n-    interceptBranchVersionRequest('master', '11.1.0-next.0');\n-    interceptBranchVersionRequest('11.0.x', '11.0.0');\n-    interceptBranchVersionRequest('10.5.x', '10.5.1');\n-    interceptBranchesListRequest(['10.5.x', '11.0.x']);\n-\n-    // We support forcibly proceeding with merging if a given branch previously was in LTS mode\n-    // but no longer is (after a period of time). In this test, we are not forcibly proceeding.\n-    fakePromptConfirmValue(false);\n-    fakeNpmPackageQueryRequest({\n-      'dist-tags': {\n-        'v10-lts': '10.5.1',\n-      },\n-      'time': {\n-        // v10 has been released at the given specified date. We pick a date that\n-        // guarantees that the version is no longer considered as active LTS version.\n-        '10.0.0': new Date(1912, 5, 23).toISOString(),\n-      }\n-    });\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.5.x'))\n-        .toBeRejectedWith(jasmine.objectContaining({\n-          failureMessage:\n-              'Long-term supported ended for v10 on 12/23/1913. Pull request cannot be merged ' +\n-              'into the 10.5.x branch.'\n-        }));\n-  });\n-\n-  it('should error if branch targeted with \"target: lts\" is not latest LTS for given major',\n-     async () => {\n-       interceptBranchVersionRequest('master', '11.1.0-next.0');\n-       interceptBranchVersionRequest('11.0.x', '11.0.0');\n-       interceptBranchVersionRequest('10.5.x', '10.5.1');\n-       interceptBranchVersionRequest('10.4.x', '10.4.4');\n-       interceptBranchesListRequest(['10.4.x', '10.5.x', '11.0.x']);\n-\n-       fakeNpmPackageQueryRequest({\n-         'dist-tags': {\n-           'v10-lts': '10.5.1',\n-         }\n-       });\n-\n-       await expectAsync(getBranchesForLabel('target: lts', '10.4.x'))\n-           .toBeRejectedWith(jasmine.objectContaining({\n-             failureMessage:\n-                 'Not using last-minor branch for v10 LTS version. PR should be updated to ' +\n-                 'target: 10.5.x'\n-           }));\n-     });\n-\n-  it('should error if branch targeted with \"target: lts\" is not a major version with LTS',\n-     async () => {\n-       interceptBranchVersionRequest('master', '11.1.0-next.0');\n-       interceptBranchVersionRequest('11.0.x', '11.0.0');\n-       interceptBranchVersionRequest('10.5.x', '10.5.1');\n-       interceptBranchesListRequest(['10.5.x', '11.0.x']);\n-\n-       fakeNpmPackageQueryRequest({'dist-tags': {}});\n-\n-       await expectAsync(getBranchesForLabel('target: lts', '10.5.x'))\n-           .toBeRejectedWith(\n-               jasmine.objectContaining({failureMessage: 'No LTS version tagged for v10 in NPM.'}));\n-     });\n-\n-  it('should allow forcibly proceeding with merge if branch targeted with \"target: lts\" is no ' +\n-         'longer active',\n-     async () => {\n-       interceptBranchVersionRequest('master', '11.1.0-next.0');\n-       interceptBranchVersionRequest('11.0.x', '11.0.0');\n-       interceptBranchVersionRequest('10.5.x', '10.5.1');\n-       interceptBranchesListRequest(['10.5.x', '11.0.x']);\n-\n-       // We support forcibly proceeding with merging if a given branch previously was in LTS mode\n-       // but no longer is (after a period of time). In this test, we are forcibly proceeding and\n-       // expect the Github target branch to be picked up as branch for the `target: lts` label.\n-       fakePromptConfirmValue(true);\n-       fakeNpmPackageQueryRequest({\n-         'dist-tags': {\n-           'v10-lts': '10.5.1',\n-         },\n-         'time': {\n-           // v10 has been released at the given specified date. We pick a date that\n-           // guarantees that the version is no longer considered as active LTS version.\n-           '10.0.0': new Date(1912, 5, 23).toISOString(),\n-         }\n-       });\n-\n-       expect(await getBranchesForLabel('target: lts', '10.5.x')).toEqual(['10.5.x']);\n-     });\n-\n-  it('should use target branch for \"target: lts\" if it matches an active LTS branch', async () => {\n-    interceptBranchVersionRequest('master', '11.1.0-next.0');\n-    interceptBranchVersionRequest('11.0.x', '11.0.0');\n-    interceptBranchVersionRequest('10.5.x', '10.5.1');\n-    interceptBranchesListRequest(['10.5.x', '11.0.x']);\n-\n-    fakeNpmPackageQueryRequest({\n-      'dist-tags': {\n-        'v10-lts': '10.5.1',\n-      },\n-      'time': {\n-        '10.0.0': new Date().toISOString(),\n-      }\n-    });\n-\n-    expect(await getBranchesForLabel('target: lts', '10.5.x')).toEqual(['10.5.x']);\n-  });\n-\n-  it('should error if no active branch for given major version could be found', async () => {\n-    interceptBranchVersionRequest('master', '12.0.0-next.0');\n-    interceptBranchesListRequest(['9.0.x', '9.1.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWithError(\n-            'Unable to determine the latest release-train. The following branches have ' +\n-            'been considered: []');\n-  });\n-\n-  it('should error if invalid version is set for version-branch', async () => {\n-    interceptBranchVersionRequest('master', '11.2.0-next.0');\n-    interceptBranchVersionRequest('11.1.x', '11.1.x');\n-    interceptBranchesListRequest(['11.1.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWithError('Invalid version detected in following branch: 11.1.x.');\n-  });\n-\n-  it('should error if version-branch more recent than \"next\" is discovered', async () => {\n-    interceptBranchVersionRequest('master', '11.2.0-next.0');\n-    interceptBranchVersionRequest('11.3.x', '11.3.0-next.0');\n-    interceptBranchVersionRequest('11.1.x', '11.1.5');\n-    interceptBranchesListRequest(['11.1.x', '11.3.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWithError(\n-            'Discovered unexpected version-branch \"11.3.x\" for a release-train that is ' +\n-            'more recent than the release-train currently in the \"master\" branch. Please ' +\n-            'either delete the branch if created by accident, or update the outdated version ' +\n-            'in the next branch (master).');\n-  });\n-\n-  it('should error if branch is matching with release-train in the \"next\" branch', async () => {\n-    interceptBranchVersionRequest('master', '11.2.0-next.0');\n-    interceptBranchVersionRequest('11.2.x', '11.2.0-next.0');\n-    interceptBranchVersionRequest('11.1.x', '11.1.5');\n-    interceptBranchesListRequest(['11.1.x', '11.2.x']);\n-\n-    await expectAsync(getBranchesForLabel('target: lts', '10.2.x'))\n-        .toBeRejectedWithError(\n-            'Discovered unexpected version-branch \"11.2.x\" for a release-train that is already ' +\n-            'active in the \"master\" branch. Please either delete the branch if created by ' +\n-            'accident, or update the version in the next branch (master).');\n-  });\n-\n-  it('should allow merging PR only into patch branch with \"target: patch\"', async () => {\n-    interceptBranchVersionRequest('master', '11.2.0-next.0');\n-    interceptBranchVersionRequest('11.1.x', '11.1.0');\n-    interceptBranchesListRequest(['11.1.x']);\n-\n-    expect(await getBranchesForLabel('target: patch', '11.1.x')).toEqual(['11.1.x']);\n-  });\n-\n-  describe('next: major release', () => {\n-    it('should detect \"master\" as branch for target: major', async () => {\n-      interceptBranchVersionRequest('master', '11.0.0-next.0');\n-      interceptBranchVersionRequest('10.2.x', '10.2.4');\n-      interceptBranchesListRequest(['10.2.x']);\n-\n-      expect(await getBranchesForLabel('target: major')).toEqual(['master']);\n-    });\n-\n-    describe('without active release-candidate', () => {\n-      it('should detect last-minor from previous major as branch for target: patch', async () => {\n-        interceptBranchVersionRequest('master', '11.0.0-next.0');\n-        interceptBranchVersionRequest('10.2.x', '10.2.4');\n-        interceptBranchesListRequest(['10.0.x', '10.1.x', '10.2.x']);\n-\n-        expect(await getBranchesForLabel('target: patch')).toEqual(['master', '10.2.x']);\n-      });\n-\n-      it('should error if \"target: rc\" is applied', async () => {\n-        interceptBranchVersionRequest('master', '11.0.0-next.0');\n-        interceptBranchVersionRequest('10.2.x', '10.2.4');\n-        interceptBranchesListRequest(['10.0.x', '10.1.x', '10.2.x']);\n-\n-        await expectAsync(getBranchesForLabel('target: rc'))\n-            .toBeRejectedWith(jasmine.objectContaining({\n-              failureMessage:\n-                  'No active feature-freeze/release-candidate branch. Unable to merge ' +\n-                  'pull request using \"target: rc\" label.'\n-            }));\n-      });\n-    });\n-\n-    describe('with active release-candidate', () => {\n-      it('should detect most recent non-prerelease minor branch from previous major for ' +\n-             'target: patch',\n-         async () => {\n-           interceptBranchVersionRequest('master', '11.0.0-next.0');\n-           interceptBranchVersionRequest('10.2.x', '10.2.0-rc.0');\n-           interceptBranchVersionRequest('10.1.x', '10.2.3');\n-           interceptBranchesListRequest(['10.1.x', '10.2.x']);\n-\n-           // Pull requests should also be merged into the RC and `next` (i.e. `master`) branch.\n-           expect(await getBranchesForLabel('target: patch')).toEqual([\n-             'master', '10.1.x', '10.2.x'\n-           ]);\n-         });\n-\n-      it('should detect release-candidate branch for \"target: rc\"', async () => {\n-        interceptBranchVersionRequest('master', '11.0.0-next.0');\n-        interceptBranchVersionRequest('10.2.x', '10.2.0-rc.0');\n-        interceptBranchVersionRequest('10.1.x', '10.1.0');\n-        interceptBranchesListRequest(['10.0.x', '10.1.x', '10.2.x']);\n-\n-        expect(await getBranchesForLabel('target: rc')).toEqual(['master', '10.2.x']);\n-      });\n-\n-      it('should detect feature-freeze branch with \"target: rc\"', async () => {\n-        interceptBranchVersionRequest('master', '11.0.0-next.0');\n-        interceptBranchVersionRequest('10.2.x', '10.2.0-next.0');\n-        interceptBranchVersionRequest('10.1.x', '10.1.0');\n-        interceptBranchesListRequest(['10.0.x', '10.1.x', '10.2.x']);\n-\n-        expect(await getBranchesForLabel('target: rc')).toEqual(['master', '10.2.x']);\n-      });\n-\n-      it('should error if multiple consecutive release-candidate branches are found', async () => {\n-        interceptBranchVersionRequest('master', '11.0.0-next.0');\n-        interceptBranchVersionRequest('10.4.x', '10.4.0-next.0');\n-        interceptBranchVersionRequest('10.3.x', '10.4.0-rc.5');\n-        interceptBranchesListRequest(['10.3.x', '10.4.x']);\n-\n-        await expectAsync(getBranchesForLabel('target: patch'))\n-            .toBeRejectedWithError(\n-                'Unable to determine latest release-train. Found two consecutive ' +\n-                'branches in feature-freeze/release-candidate phase. Did not expect both ' +\n-                '\"10.3.x\" and \"10.4.x\" to be in feature-freeze/release-candidate mode.');\n-      });\n-    });\n-  });\n-\n-  describe('next: minor release', () => {\n-    it('should error if \"target: major\" is applied', async () => {\n-      interceptBranchVersionRequest('master', '11.2.0-next.0');\n-      interceptBranchVersionRequest('11.1.x', '11.1.4');\n-      interceptBranchesListRequest(['11.1.x']);\n-\n-      await expectAsync(getBranchesForLabel('target: major'))\n-          .toBeRejectedWith(jasmine.objectContaining({\n-            failureMessage:\n-                'Unable to merge pull request. The \"master\" branch will be released as ' +\n-                'a minor version.',\n-          }));\n-    });\n-\n-    describe('without active release-candidate', () => {\n-      it('should detect last-minor from previous major as branch for target: patch', async () => {\n-        interceptBranchVersionRequest('master', '11.2.0-next.0');\n-        interceptBranchVersionRequest('11.1.x', '11.1.0');\n-        interceptBranchesListRequest(['11.1.x']);\n-\n-        expect(await getBranchesForLabel('target: patch')).toEqual(['master', '11.1.x']);\n-      });\n-\n-      it('should error if \"target: rc\" is applied', async () => {\n-        interceptBranchVersionRequest('master', '11.2.0-next.0');\n-        interceptBranchVersionRequest('11.1.x', '11.1.0');\n-        interceptBranchesListRequest(['11.1.x']);\n-\n-        await expectAsync(getBranchesForLabel('target: rc'))\n-            .toBeRejectedWith(jasmine.objectContaining({\n-              failureMessage:\n-                  'No active feature-freeze/release-candidate branch. Unable to merge pull ' +\n-                  'request using \"target: rc\" label.'\n-            }));\n-      });\n-    });\n-\n-    describe('with active release-candidate', () => {\n-      it('should detect most recent non-prerelease minor branch from previous major for ' +\n-             'target: patch',\n-         async () => {\n-           interceptBranchVersionRequest('master', '11.2.0-next.0');\n-           interceptBranchVersionRequest('11.1.x', '11.1.0-rc.0');\n-           interceptBranchVersionRequest('11.0.x', '11.0.0');\n-           interceptBranchesListRequest(['11.0.x', '11.1.x']);\n-\n-           // Pull requests should also be merged into the RC and `next` (i.e. `master`) branch.\n-           expect(await getBranchesForLabel('target: patch')).toEqual([\n-             'master', '11.0.x', '11.1.x'\n-           ]);\n-         });\n-\n-      it('should detect release-candidate branch for \"target: rc\"', async () => {\n-        interceptBranchVersionRequest('master', '11.2.0-next.0');\n-        interceptBranchVersionRequest('11.1.x', '11.1.0-rc.0');\n-        interceptBranchVersionRequest('11.0.x', '10.0.0');\n-        interceptBranchesListRequest(['11.0.x', '11.1.x']);\n-\n-        expect(await getBranchesForLabel('target: rc')).toEqual(['master', '11.1.x']);\n-      });\n-\n-      it('should detect feature-freeze branch with \"target: rc\"', async () => {\n-        interceptBranchVersionRequest('master', '11.2.0-next.0');\n-        interceptBranchVersionRequest('11.1.x', '11.1.0-next.0');\n-        interceptBranchVersionRequest('11.0.x', '10.0.0');\n-        interceptBranchesListRequest(['11.0.x', '11.1.x']);\n-\n-        expect(await getBranchesForLabel('target: rc')).toEqual(['master', '11.1.x']);\n-      });\n-    });\n-  });\n-});"
        },
        {
            "sha": "57f01c166879b90cf2a47e0d37461d21d6682e81",
            "filename": "dev-infra/pr/merge/defaults/labels.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 129,
            "changes": 129,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,129 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseConfig} from '../../../release/config/index';\n-import {fetchActiveReleaseTrains, isVersionBranch, nextBranchName} from '../../../release/versioning';\n-import {GithubConfig} from '../../../utils/config';\n-import {GithubClient} from '../../../utils/git/github';\n-import {TargetLabel} from '../config';\n-import {InvalidTargetBranchError, InvalidTargetLabelError} from '../target-label';\n-\n-import {assertActiveLtsBranch} from './lts-branch';\n-\n-/**\n- * Gets a label configuration for the merge tooling that reflects the default Angular\n- * organization-wide labeling and branching semantics as outlined in the specification.\n- *\n- * https://docs.google.com/document/d/197kVillDwx-RZtSVOBtPb4BBIAw0E9RT3q3v6DZkykU\n- *\n- * @param api Instance of an authenticated Github client.\n- * @param githubConfig Configuration for the Github remote. Used as Git remote\n- *   for the release train branches.\n- * @param releaseConfig Configuration for the release packages. Used to fetch\n- *   NPM version data when LTS version branches are validated.\n- */\n-export async function getDefaultTargetLabelConfiguration(\n-    api: GithubClient, githubConfig: GithubConfig,\n-    releaseConfig: ReleaseConfig): Promise<TargetLabel[]> {\n-  const repo = {owner: githubConfig.owner, name: githubConfig.name, api};\n-  const {latest, releaseCandidate, next} = await fetchActiveReleaseTrains(repo);\n-\n-  return [\n-    {\n-      pattern: 'target: major',\n-      branches: () => {\n-        // If `next` is currently not designated to be a major version, we do not\n-        // allow merging of PRs with `target: major`.\n-        if (!next.isMajor) {\n-          throw new InvalidTargetLabelError(\n-              `Unable to merge pull request. The \"${nextBranchName}\" branch will be released as ` +\n-              'a minor version.');\n-        }\n-        return [nextBranchName];\n-      },\n-    },\n-    {\n-      pattern: 'target: minor',\n-      // Changes labeled with `target: minor` are merged most commonly into the next branch\n-      // (i.e. `master`). In rare cases of an exceptional minor version while being already\n-      // on a major release train, this would need to be overridden manually.\n-      // TODO: Consider handling this automatically by checking if the NPM version matches\n-      // the last-minor. If not, then an exceptional minor might be in progress. See:\n-      // https://docs.google.com/document/d/197kVillDwx-RZtSVOBtPb4BBIAw0E9RT3q3v6DZkykU/edit#heading=h.h7o5pjq6yqd0\n-      branches: [nextBranchName],\n-    },\n-    {\n-      pattern: 'target: patch',\n-      branches: githubTargetBranch => {\n-        // If a PR is targeting the latest active version-branch through the Github UI,\n-        // and is also labeled with `target: patch`, then we merge it directly into the\n-        // branch without doing any cherry-picking. This is useful if a PR could not be\n-        // applied cleanly, and a separate PR for the patch branch has been created.\n-        if (githubTargetBranch === latest.branchName) {\n-          return [latest.branchName];\n-        }\n-        // Otherwise, patch changes are always merged into the next and patch branch.\n-        const branches = [nextBranchName, latest.branchName];\n-        // Additionally, if there is a release-candidate/feature-freeze release-train\n-        // currently active, also merge the PR into that version-branch.\n-        if (releaseCandidate !== null) {\n-          branches.push(releaseCandidate.branchName);\n-        }\n-        return branches;\n-      }\n-    },\n-    {\n-      pattern: 'target: rc',\n-      branches: githubTargetBranch => {\n-        // The `target: rc` label cannot be applied if there is no active feature-freeze\n-        // or release-candidate release train.\n-        if (releaseCandidate === null) {\n-          throw new InvalidTargetLabelError(\n-              `No active feature-freeze/release-candidate branch. ` +\n-              `Unable to merge pull request using \"target: rc\" label.`);\n-        }\n-        // If the PR is targeting the active release-candidate/feature-freeze version branch\n-        // directly through the Github UI and has the `target: rc` label applied, merge it\n-        // only into the release candidate branch. This is useful if a PR did not apply cleanly\n-        // into the release-candidate/feature-freeze branch, and a separate PR has been created.\n-        if (githubTargetBranch === releaseCandidate.branchName) {\n-          return [releaseCandidate.branchName];\n-        }\n-        // Otherwise, merge into the next and active release-candidate/feature-freeze branch.\n-        return [nextBranchName, releaseCandidate.branchName];\n-      },\n-    },\n-    {\n-      // LTS changes are rare enough that we won't worry about cherry-picking changes into all\n-      // active LTS branches for PRs created against any other branch. Instead, PR authors need\n-      // to manually create separate PRs for desired LTS branches. Additionally, active LT branches\n-      // commonly diverge quickly. This makes cherry-picking not an option for LTS changes.\n-      pattern: 'target: lts',\n-      branches: async githubTargetBranch => {\n-        if (!isVersionBranch(githubTargetBranch)) {\n-          throw new InvalidTargetBranchError(\n-              `PR cannot be merged as it does not target a long-term support ` +\n-              `branch: \"${githubTargetBranch}\"`);\n-        }\n-        if (githubTargetBranch === latest.branchName) {\n-          throw new InvalidTargetBranchError(\n-              `PR cannot be merged with \"target: lts\" into patch branch. ` +\n-              `Consider changing the label to \"target: patch\" if this is intentional.`);\n-        }\n-        if (releaseCandidate !== null && githubTargetBranch === releaseCandidate.branchName) {\n-          throw new InvalidTargetBranchError(\n-              `PR cannot be merged with \"target: lts\" into feature-freeze/release-candidate ` +\n-              `branch. Consider changing the label to \"target: rc\" if this is intentional.`);\n-        }\n-        // Assert that the selected branch is an active LTS branch.\n-        await assertActiveLtsBranch(repo, releaseConfig, githubTargetBranch);\n-        return [githubTargetBranch];\n-      },\n-    },\n-  ];\n-}"
        },
        {
            "sha": "64e934d72dfc936fd6831d46647bf2dacd03e976",
            "filename": "dev-infra/pr/merge/defaults/lts-branch.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 68,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,68 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {ReleaseConfig} from '../../../release/config/index';\n-import {computeLtsEndDateOfMajor, fetchProjectNpmPackageInfo, getLtsNpmDistTagOfMajor, getVersionOfBranch, GithubRepoWithApi} from '../../../release/versioning';\n-import {promptConfirm, red, warn, yellow} from '../../../utils/console';\n-import {InvalidTargetBranchError} from '../target-label';\n-\n-/**\n- * Asserts that the given branch corresponds to an active LTS version-branch that can receive\n- * backport fixes. Throws an error if LTS expired or an invalid branch is selected.\n- *\n- * @param repo Repository containing the given branch. Used for Github API queries.\n- * @param releaseConfig Configuration for releases. Used to query NPM about past publishes.\n- * @param branchName Branch that is checked to be an active LTS version-branch.\n- * */\n-export async function assertActiveLtsBranch(\n-    repo: GithubRepoWithApi, releaseConfig: ReleaseConfig, branchName: string) {\n-  const version = await getVersionOfBranch(repo, branchName);\n-  const {'dist-tags': distTags, time} = await fetchProjectNpmPackageInfo(releaseConfig);\n-\n-  // LTS versions should be tagged in NPM in the following format: `v{major}-lts`.\n-  const ltsNpmTag = getLtsNpmDistTagOfMajor(version.major);\n-  const ltsVersion = semver.parse(distTags[ltsNpmTag]);\n-\n-  // Ensure that there is an LTS version tagged for the given version-branch major. e.g.\n-  // if the version branch is `9.2.x` then we want to make sure that there is an LTS\n-  // version tagged in NPM for `v9`, following the `v{major}-lts` tag convention.\n-  if (ltsVersion === null) {\n-    throw new InvalidTargetBranchError(`No LTS version tagged for v${version.major} in NPM.`);\n-  }\n-\n-  // Ensure that the correct branch is used for the LTS version. We do not want to merge\n-  // changes to older minor version branches that do not reflect the current LTS version.\n-  if (branchName !== `${ltsVersion.major}.${ltsVersion.minor}.x`) {\n-    throw new InvalidTargetBranchError(\n-        `Not using last-minor branch for v${version.major} LTS version. PR ` +\n-        `should be updated to target: ${ltsVersion.major}.${ltsVersion.minor}.x`);\n-  }\n-\n-  const today = new Date();\n-  const majorReleaseDate = new Date(time[`${version.major}.0.0`]);\n-  const ltsEndDate = computeLtsEndDateOfMajor(majorReleaseDate);\n-\n-  // Check if LTS has already expired for the targeted major version. If so, we do not\n-  // allow the merge as per our LTS guarantees. Can be forcibly overridden if desired.\n-  // See: https://angular.io/guide/releases#support-policy-and-schedule.\n-  if (today > ltsEndDate) {\n-    const ltsEndDateText = ltsEndDate.toLocaleDateString('en-US');\n-    warn(red(`Long-term support ended for v${version.major} on ${ltsEndDateText}.`));\n-    warn(yellow(\n-        `Merging of pull requests for this major is generally not ` +\n-        `desired, but can be forcibly ignored.`));\n-    if (await promptConfirm('Do you want to forcibly proceed with merging?')) {\n-      return;\n-    }\n-    throw new InvalidTargetBranchError(\n-        `Long-term supported ended for v${version.major} on ${ltsEndDateText}. ` +\n-        `Pull request cannot be merged into the ${branchName} branch.`);\n-  }\n-}"
        },
        {
            "sha": "29e5725c0978597c8b7e6c3ccfd018d8e331a21c",
            "filename": "dev-infra/pr/merge/failures.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 121,
            "changes": 121,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ffailures.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ffailures.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Ffailures.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,121 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {TargetLabel} from './config';\n-\n-/**\n- * Class that can be used to describe pull request failures. A failure\n- * is described through a human-readable message and a flag indicating\n- * whether it is non-fatal or not.\n- */\n-export class PullRequestFailure {\n-  constructor(\n-      /** Human-readable message for the failure */\n-      public message: string,\n-      /** Whether the failure is non-fatal and can be forcibly ignored. */\n-      public nonFatal = false) {}\n-\n-  static claUnsigned() {\n-    return new this(`CLA has not been signed. Please make sure the PR author has signed the CLA.`);\n-  }\n-\n-  static failingCiJobs() {\n-    return new this(`Failing CI jobs.`, true);\n-  }\n-\n-  static pendingCiJobs() {\n-    return new this(`Pending CI jobs.`, true);\n-  }\n-\n-  static notMergeReady() {\n-    return new this(`Not marked as merge ready.`);\n-  }\n-\n-  static isDraft() {\n-    return new this('Pull request is still in draft.');\n-  }\n-\n-  static isClosed() {\n-    return new this('Pull request is already closed.');\n-  }\n-\n-  static isMerged() {\n-    return new this('Pull request is already merged.');\n-  }\n-\n-  static mismatchingTargetBranch(allowedBranches: string[]) {\n-    return new this(\n-        `Pull request is set to wrong base branch. Please update the PR in the Github UI ` +\n-        `to one of the following branches: ${allowedBranches.join(', ')}.`);\n-  }\n-\n-  static unsatisfiedBaseSha() {\n-    return new this(\n-        `Pull request has not been rebased recently and could be bypassing CI checks. ` +\n-        `Please rebase the PR.`);\n-  }\n-\n-  static mergeConflicts(failedBranches: string[]) {\n-    return new this(\n-        `Could not merge pull request into the following branches due to merge ` +\n-        `conflicts: ${\n-            failedBranches.join(', ')}. Please rebase the PR or update the target label.`);\n-  }\n-\n-  static unknownMergeError() {\n-    return new this(`Unknown merge error occurred. Please see console output above for debugging.`);\n-  }\n-\n-  static unableToFixupCommitMessageSquashOnly() {\n-    return new this(\n-        `Unable to fixup commit message of pull request. Commit message can only be ` +\n-        `modified if the PR is merged using squash.`);\n-  }\n-\n-  static notFound() {\n-    return new this(`Pull request could not be found upstream.`);\n-  }\n-\n-  static insufficientPermissionsToMerge(\n-      message = `Insufficient Github API permissions to merge pull request. Please ensure that ` +\n-          `your auth token has write access.`) {\n-    return new this(message);\n-  }\n-\n-  static hasBreakingChanges(label: TargetLabel) {\n-    const message = `Cannot merge into branch for \"${label.pattern}\" as the pull request has ` +\n-        `breaking changes. Breaking changes can only be merged with the \"target: major\" label.`;\n-    return new this(message);\n-  }\n-\n-  static hasDeprecations(label: TargetLabel) {\n-    const message = `Cannot merge into branch for \"${label.pattern}\" as the pull request ` +\n-        `contains deprecations. Deprecations can only be merged with the \"target: minor\" or ` +\n-        `\"target: major\" label.`;\n-    return new this(message);\n-  }\n-\n-  static hasFeatureCommits(label: TargetLabel) {\n-    const message = `Cannot merge into branch for \"${label.pattern}\" as the pull request has ` +\n-        'commits with the \"feat\" type. New features can only be merged with the \"target: minor\" ' +\n-        'or \"target: major\" label.';\n-    return new this(message);\n-  }\n-\n-  static missingBreakingChangeLabel() {\n-    const message = 'Pull Request has at least one commit containing a breaking change note, but ' +\n-        'does not have a breaking change label.';\n-    return new this(message);\n-  }\n-\n-  static missingBreakingChangeCommit() {\n-    const message = 'Pull Request has a breaking change label, but does not contain any commits ' +\n-        'with breaking change notes.';\n-    return new this(message);\n-  }\n-}"
        },
        {
            "sha": "76feb3db69e4f22cd4a1246b9b906fcae3a2c535",
            "filename": "dev-infra/pr/merge/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 145,
            "changes": 145,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,145 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-\n-import {getConfig} from '../../utils/config';\n-import {error, green, info, promptConfirm, red, yellow} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {GithubApiRequestError} from '../../utils/git/github';\n-import {GITHUB_TOKEN_GENERATE_URL} from '../../utils/git/github-urls';\n-\n-import {loadAndValidateConfig, MergeConfigWithRemote} from './config';\n-import {MergeResult, MergeStatus, PullRequestMergeTask, PullRequestMergeTaskFlags} from './task';\n-\n-/**\n- * Merges a given pull request based on labels configured in the given merge configuration.\n- * Pull requests can be merged with different strategies such as the Github API merge\n- * strategy, or the local autosquash strategy. Either strategy has benefits and downsides.\n- * More information on these strategies can be found in their dedicated strategy classes.\n- *\n- * See {@link GithubApiMergeStrategy} and {@link AutosquashMergeStrategy}\n- *\n- * @param prNumber Number of the pull request that should be merged.\n- * @param flags Configuration options for merging pull requests.\n- */\n-export async function mergePullRequest(prNumber: number, flags: PullRequestMergeTaskFlags) {\n-  // Set the environment variable to skip all git commit hooks triggered by husky. We are unable to\n-  // rely on `--no-verify` as some hooks still run, notably the `prepare-commit-msg` hook.\n-  process.env['HUSKY'] = '0';\n-\n-  const api = await createPullRequestMergeTask(flags);\n-\n-  // Perform the merge. Force mode can be activated through a command line flag.\n-  // Alternatively, if the merge fails with non-fatal failures, the script\n-  // will prompt whether it should rerun in force mode.\n-  if (!await performMerge(false)) {\n-    process.exit(1);\n-  }\n-\n-  /** Performs the merge and returns whether it was successful or not. */\n-  async function performMerge(ignoreFatalErrors: boolean): Promise<boolean> {\n-    try {\n-      const result = await api.merge(prNumber, ignoreFatalErrors);\n-      return await handleMergeResult(result, ignoreFatalErrors);\n-    } catch (e) {\n-      // Catch errors to the Github API for invalid requests. We want to\n-      // exit the script with a better explanation of the error.\n-      if (e instanceof GithubApiRequestError && e.status === 401) {\n-        error(red('Github API request failed. ' + e.message));\n-        error(yellow('Please ensure that your provided token is valid.'));\n-        error(yellow(`You can generate a token here: ${GITHUB_TOKEN_GENERATE_URL}`));\n-        process.exit(1);\n-      }\n-      throw e;\n-    }\n-  }\n-\n-  /**\n-   * Prompts whether the specified pull request should be forcibly merged. If so, merges\n-   * the specified pull request forcibly (ignoring non-critical failures).\n-   * @returns Whether the specified pull request has been forcibly merged.\n-   */\n-  async function promptAndPerformForceMerge(): Promise<boolean> {\n-    if (await promptConfirm('Do you want to forcibly proceed with merging?')) {\n-      // Perform the merge in force mode. This means that non-fatal failures\n-      // are ignored and the merge continues.\n-      return performMerge(true);\n-    }\n-    return false;\n-  }\n-\n-  /**\n-   * Handles the merge result by printing console messages, exiting the process\n-   * based on the result, or by restarting the merge if force mode has been enabled.\n-   * @returns Whether the merge completed without errors or not.\n-   */\n-  async function handleMergeResult(result: MergeResult, disableForceMergePrompt = false) {\n-    const {failure, status} = result;\n-    const canForciblyMerge = failure && failure.nonFatal;\n-\n-    switch (status) {\n-      case MergeStatus.SUCCESS:\n-        info(green(`Successfully merged the pull request: #${prNumber}`));\n-        return true;\n-      case MergeStatus.DIRTY_WORKING_DIR:\n-        error(\n-            red(`Local working repository not clean. Please make sure there are ` +\n-                `no uncommitted changes.`));\n-        return false;\n-      case MergeStatus.UNKNOWN_GIT_ERROR:\n-        error(\n-            red('An unknown Git error has been thrown. Please check the output ' +\n-                'above for details.'));\n-        return false;\n-      case MergeStatus.GITHUB_ERROR:\n-        error(red('An error related to interacting with Github has been discovered.'));\n-        error(failure!.message);\n-        return false;\n-      case MergeStatus.USER_ABORTED:\n-        info(`Merge of pull request has been aborted manually: #${prNumber}`);\n-        return true;\n-      case MergeStatus.FAILED:\n-        error(yellow(`Could not merge the specified pull request.`));\n-        error(red(failure!.message));\n-        if (canForciblyMerge && !disableForceMergePrompt) {\n-          info();\n-          info(yellow('The pull request above failed due to non-critical errors.'));\n-          info(yellow(`This error can be forcibly ignored if desired.`));\n-          return await promptAndPerformForceMerge();\n-        }\n-        return false;\n-      default:\n-        throw Error(`Unexpected merge result: ${status}`);\n-    }\n-  }\n-}\n-\n-/**\n- * Creates the pull request merge task using the given configuration options. Explicit configuration\n- * options can be specified when the merge script is used outside of an `ng-dev` configured\n- * repository.\n- */\n-async function createPullRequestMergeTask(flags: PullRequestMergeTaskFlags) {\n-  const devInfraConfig = getConfig();\n-  /** The singleton instance of the authenticated git client. */\n-  const git = AuthenticatedGitClient.get();\n-  const {config, errors} = await loadAndValidateConfig(devInfraConfig, git.github);\n-\n-  if (errors) {\n-    error(red('Invalid merge configuration:'));\n-    errors.forEach(desc => error(yellow(`  -  ${desc}`)));\n-    process.exit(1);\n-  }\n-\n-  // Set the remote so that the merge tool has access to information about\n-  // the remote it intends to merge to.\n-  config!.remote = devInfraConfig.github;\n-  // We can cast this to a merge config with remote because we always set the\n-  // remote above.\n-  return new PullRequestMergeTask(config! as MergeConfigWithRemote, git, flags);\n-}"
        },
        {
            "sha": "34a34ce3db5b25e352f9fd9bfd71221c45734df6",
            "filename": "dev-infra/pr/merge/messages.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fmessages.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fmessages.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {red} from '../../utils/console';\n-\n-import {PullRequest} from './pull-request';\n-\n-export function getCaretakerNotePromptMessage(pullRequest: PullRequest): string {\n-  return red('Pull request has a caretaker note applied. Please make sure you read it.') +\n-      `\\nQuick link to PR: ${pullRequest.url}\\nDo you want to proceed merging?`;\n-}\n-\n-export function getTargettedBranchesConfirmationPromptMessage(pullRequest: PullRequest): string {\n-  const targetBranchListAsString = pullRequest.targetBranches.map(b => ` - ${b}\\n`).join('');\n-  return `Pull request #${pullRequest.prNumber} will merge into:\\n${\n-      targetBranchListAsString}\\nDo you want to proceed merging?`;\n-}"
        },
        {
            "sha": "3137e425f1a38375b7cd9a5a16052d8e20bacb90",
            "filename": "dev-infra/pr/merge/pull-request.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 273,
            "changes": 273,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,273 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {params, types as graphqlTypes} from 'typed-graphqlify';\n-\n-import {Commit, parseCommitMessage} from '../../commit-message/parse';\n-import {red, warn} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {getPr} from '../../utils/github';\n-\n-import {MergeConfig, TargetLabel} from './config';\n-import {PullRequestFailure} from './failures';\n-import {matchesPattern} from './string-pattern';\n-import {getBranchesFromTargetLabel, getTargetLabelFromPullRequest, InvalidTargetBranchError, InvalidTargetLabelError} from './target-label';\n-import {PullRequestMergeTask} from './task';\n-\n-/** The default label for labeling pull requests containing a breaking change. */\n-const BreakingChangeLabel = 'breaking changes';\n-\n-/** Interface that describes a pull request. */\n-export interface PullRequest {\n-  /** URL to the pull request. */\n-  url: string;\n-  /** Number of the pull request. */\n-  prNumber: number;\n-  /** Title of the pull request. */\n-  title: string;\n-  /** Labels applied to the pull request. */\n-  labels: string[];\n-  /** List of branches this PR should be merged into. */\n-  targetBranches: string[];\n-  /** Branch that the PR targets in the Github UI. */\n-  githubTargetBranch: string;\n-  /** Count of commits in this pull request. */\n-  commitCount: number;\n-  /** Optional SHA that this pull request needs to be based on. */\n-  requiredBaseSha?: string;\n-  /** Whether the pull request commit message fixup. */\n-  needsCommitMessageFixup: boolean;\n-  /** Whether the pull request has a caretaker note. */\n-  hasCaretakerNote: boolean;\n-}\n-\n-/**\n- * Loads and validates the specified pull request against the given configuration.\n- * If the pull requests fails, a pull request failure is returned.\n- */\n-export async function loadAndValidatePullRequest(\n-    {git, config}: PullRequestMergeTask, prNumber: number,\n-    ignoreNonFatalFailures = false): Promise<PullRequest|PullRequestFailure> {\n-  const prData = await fetchPullRequestFromGithub(git, prNumber);\n-\n-  if (prData === null) {\n-    return PullRequestFailure.notFound();\n-  }\n-\n-  const labels = prData.labels.nodes.map(l => l.name);\n-\n-  if (!labels.some(name => matchesPattern(name, config.mergeReadyLabel))) {\n-    return PullRequestFailure.notMergeReady();\n-  }\n-  if (!labels.some(name => matchesPattern(name, config.claSignedLabel))) {\n-    return PullRequestFailure.claUnsigned();\n-  }\n-\n-  let targetLabel: TargetLabel;\n-  try {\n-    targetLabel = getTargetLabelFromPullRequest(config, labels);\n-  } catch (error) {\n-    if (error instanceof InvalidTargetLabelError) {\n-      return new PullRequestFailure(error.failureMessage);\n-    }\n-    throw error;\n-  }\n-\n-  /** List of parsed commits for all of the commits in the pull request. */\n-  const commitsInPr = prData.commits.nodes.map(n => parseCommitMessage(n.commit.message));\n-\n-  try {\n-    assertPendingState(prData);\n-    assertChangesAllowForTargetLabel(commitsInPr, targetLabel, config);\n-    assertCorrectBreakingChangeLabeling(commitsInPr, labels, config);\n-  } catch (error) {\n-    return error;\n-  }\n-\n-  /** The combined status of the latest commit in the pull request. */\n-  const state = prData.commits.nodes.slice(-1)[0].commit.status.state;\n-  if (state === 'FAILURE' && !ignoreNonFatalFailures) {\n-    return PullRequestFailure.failingCiJobs();\n-  }\n-  if (state === 'PENDING' && !ignoreNonFatalFailures) {\n-    return PullRequestFailure.pendingCiJobs();\n-  }\n-\n-  const githubTargetBranch = prData.baseRefName;\n-  const requiredBaseSha =\n-      config.requiredBaseCommits && config.requiredBaseCommits[githubTargetBranch];\n-  const needsCommitMessageFixup = !!config.commitMessageFixupLabel &&\n-      labels.some(name => matchesPattern(name, config.commitMessageFixupLabel));\n-  const hasCaretakerNote = !!config.caretakerNoteLabel &&\n-      labels.some(name => matchesPattern(name, config.caretakerNoteLabel!));\n-  let targetBranches: string[];\n-\n-  // If branches are determined for a given target label, capture errors that are\n-  // thrown as part of branch computation. This is expected because a merge configuration\n-  // can lazily compute branches for a target label and throw. e.g. if an invalid target\n-  // label is applied, we want to exit the script gracefully with an error message.\n-  try {\n-    targetBranches = await getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n-  } catch (error) {\n-    if (error instanceof InvalidTargetBranchError || error instanceof InvalidTargetLabelError) {\n-      return new PullRequestFailure(error.failureMessage);\n-    }\n-    throw error;\n-  }\n-\n-  return {\n-    url: prData.url,\n-    prNumber,\n-    labels,\n-    requiredBaseSha,\n-    githubTargetBranch,\n-    needsCommitMessageFixup,\n-    hasCaretakerNote,\n-    targetBranches,\n-    title: prData.title,\n-    commitCount: prData.commits.totalCount,\n-  };\n-}\n-\n-/* Graphql schema for the response body the requested pull request. */\n-const PR_SCHEMA = {\n-  url: graphqlTypes.string,\n-  isDraft: graphqlTypes.boolean,\n-  state: graphqlTypes.oneOf(['OPEN', 'MERGED', 'CLOSED'] as const),\n-  number: graphqlTypes.number,\n-  // Only the last 100 commits from a pull request are obtained as we likely will never see a pull\n-  // requests with more than 100 commits.\n-  commits: params({last: 100}, {\n-    totalCount: graphqlTypes.number,\n-    nodes: [{\n-      commit: {\n-        status: {\n-          state: graphqlTypes.oneOf(['FAILURE', 'PENDING', 'SUCCESS'] as const),\n-        },\n-        message: graphqlTypes.string,\n-      },\n-    }],\n-  }),\n-  baseRefName: graphqlTypes.string,\n-  title: graphqlTypes.string,\n-  labels: params({first: 100}, {\n-    nodes: [{\n-      name: graphqlTypes.string,\n-    }]\n-  }),\n-};\n-\n-/** A pull request retrieved from github via the graphql API. */\n-type RawPullRequest = typeof PR_SCHEMA;\n-\n-\n-/** Fetches a pull request from Github. Returns null if an error occurred. */\n-async function fetchPullRequestFromGithub(\n-    git: AuthenticatedGitClient, prNumber: number): Promise<RawPullRequest|null> {\n-  try {\n-    return await getPr(PR_SCHEMA, prNumber, git);\n-  } catch (e) {\n-    // If the pull request could not be found, we want to return `null` so\n-    // that the error can be handled gracefully.\n-    if (e.status === 404) {\n-      return null;\n-    }\n-    throw e;\n-  }\n-}\n-\n-/** Whether the specified value resolves to a pull request. */\n-export function isPullRequest(v: PullRequestFailure|PullRequest): v is PullRequest {\n-  return (v as PullRequest).targetBranches !== undefined;\n-}\n-\n-/**\n- * Assert the commits provided are allowed to merge to the provided target label,\n- * throwing an error otherwise.\n- * @throws {PullRequestFailure}\n- */\n-function assertChangesAllowForTargetLabel(\n-    commits: Commit[], label: TargetLabel, config: MergeConfig) {\n-  /**\n-   * List of commit scopes which are exempted from target label content requirements. i.e. no `feat`\n-   * scopes in patch branches, no breaking changes in minor or patch changes.\n-   */\n-  const exemptedScopes = config.targetLabelExemptScopes || [];\n-  /** List of commits which are subject to content requirements for the target label. */\n-  commits = commits.filter(commit => !exemptedScopes.includes(commit.scope));\n-  const hasBreakingChanges = commits.some(commit => commit.breakingChanges.length !== 0);\n-  const hasDeprecations = commits.some(commit => commit.deprecations.length !== 0);\n-  const hasFeatureCommits = commits.some(commit => commit.type === 'feat');\n-  switch (label.pattern) {\n-    case 'target: major':\n-      break;\n-    case 'target: minor':\n-      if (hasBreakingChanges) {\n-        throw PullRequestFailure.hasBreakingChanges(label);\n-      }\n-      break;\n-    case 'target: rc':\n-    case 'target: patch':\n-    case 'target: lts':\n-      if (hasBreakingChanges) {\n-        throw PullRequestFailure.hasBreakingChanges(label);\n-      }\n-      if (hasFeatureCommits) {\n-        throw PullRequestFailure.hasFeatureCommits(label);\n-      }\n-      // Deprecations should not be merged into RC, patch or LTS branches.\n-      // https://semver.org/#spec-item-7. Deprecations should be part of\n-      // minor releases, or major releases according to SemVer.\n-      if (hasDeprecations) {\n-        throw PullRequestFailure.hasDeprecations(label);\n-      }\n-      break;\n-    default:\n-      warn(red('WARNING: Unable to confirm all commits in the pull request are eligible to be'));\n-      warn(red(`merged into the target branch: ${label.pattern}`));\n-      break;\n-  }\n-}\n-\n-/**\n- * Assert the pull request has the proper label for breaking changes if there are breaking change\n- * commits, and only has the label if there are breaking change commits.\n- * @throws {PullRequestFailure}\n- */\n-function assertCorrectBreakingChangeLabeling(\n-    commits: Commit[], labels: string[], config: MergeConfig) {\n-  /** Whether the PR has a label noting a breaking change. */\n-  const hasLabel = labels.includes(config.breakingChangeLabel || BreakingChangeLabel);\n-  //** Whether the PR has at least one commit which notes a breaking change. */\n-  const hasCommit = commits.some(commit => commit.breakingChanges.length !== 0);\n-\n-  if (!hasLabel && hasCommit) {\n-    throw PullRequestFailure.missingBreakingChangeLabel();\n-  }\n-\n-  if (hasLabel && !hasCommit) {\n-    throw PullRequestFailure.missingBreakingChangeCommit();\n-  }\n-}\n-\n-\n-/**\n- * Assert the pull request is pending, not closed, merged or in draft.\n- * @throws {PullRequestFailure} if the pull request is not pending.\n- */\n-function assertPendingState(pr: RawPullRequest) {\n-  if (pr.isDraft) {\n-    throw PullRequestFailure.isDraft();\n-  }\n-  switch (pr.state) {\n-    case 'CLOSED':\n-      throw PullRequestFailure.isClosed();\n-    case 'MERGED':\n-      throw PullRequestFailure.isMerged();\n-  }\n-}"
        },
        {
            "sha": "49f2cc3cf787d7d15ff46df8a430148e24ca5da8",
            "filename": "dev-infra/pr/merge/strategies/api-merge.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 234,
            "changes": 234,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,234 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {RestEndpointMethodTypes} from '@octokit/plugin-rest-endpoint-methods';\n-import {prompt} from 'inquirer';\n-\n-import {parseCommitMessage} from '../../../commit-message/parse';\n-import {AuthenticatedGitClient} from '../../../utils/git/authenticated-git-client';\n-import {GithubApiMergeMethod} from '../config';\n-import {PullRequestFailure} from '../failures';\n-import {PullRequest} from '../pull-request';\n-import {matchesPattern} from '../string-pattern';\n-\n-import {MergeStrategy, TEMP_PR_HEAD_BRANCH} from './strategy';\n-\n-/** Type describing the parameters for the Octokit `merge` API endpoint. */\n-type OctokitMergeParams = RestEndpointMethodTypes['pulls']['merge']['parameters'];\n-\n-/** Configuration for the Github API merge strategy. */\n-export interface GithubApiMergeStrategyConfig {\n-  /** Default method used for merging pull requests */\n-  default: GithubApiMergeMethod;\n-  /** Labels which specify a different merge method than the default. */\n-  labels?: {pattern: string, method: GithubApiMergeMethod}[];\n-}\n-\n-/** Separator between commit message header and body. */\n-const COMMIT_HEADER_SEPARATOR = '\\n\\n';\n-\n-/**\n- * Merge strategy that primarily leverages the Github API. The strategy merges a given\n- * pull request into a target branch using the API. This ensures that Github displays\n- * the pull request as merged. The merged commits are then cherry-picked into the remaining\n- * target branches using the local Git instance. The benefit is that the Github merged state\n- * is properly set, but a notable downside is that PRs cannot use fixup or squash commits.\n- */\n-export class GithubApiMergeStrategy extends MergeStrategy {\n-  constructor(git: AuthenticatedGitClient, private _config: GithubApiMergeStrategyConfig) {\n-    super(git);\n-  }\n-\n-  override async merge(pullRequest: PullRequest): Promise<PullRequestFailure|null> {\n-    const {githubTargetBranch, prNumber, targetBranches, requiredBaseSha, needsCommitMessageFixup} =\n-        pullRequest;\n-    // If the pull request does not have its base branch set to any determined target\n-    // branch, we cannot merge using the API.\n-    if (targetBranches.every(t => t !== githubTargetBranch)) {\n-      return PullRequestFailure.mismatchingTargetBranch(targetBranches);\n-    }\n-\n-    // In cases where a required base commit is specified for this pull request, check if\n-    // the pull request contains the given commit. If not, return a pull request failure.\n-    // This check is useful for enforcing that PRs are rebased on top of a given commit.\n-    // e.g. a commit that changes the code ownership validation. PRs which are not rebased\n-    // could bypass new codeowner ship rules.\n-    if (requiredBaseSha && !this.git.hasCommit(TEMP_PR_HEAD_BRANCH, requiredBaseSha)) {\n-      return PullRequestFailure.unsatisfiedBaseSha();\n-    }\n-\n-    const method = this._getMergeActionFromPullRequest(pullRequest);\n-    const cherryPickTargetBranches = targetBranches.filter(b => b !== githubTargetBranch);\n-\n-    // First cherry-pick the PR into all local target branches in dry-run mode. This is\n-    // purely for testing so that we can figure out whether the PR can be cherry-picked\n-    // into the other target branches. We don't want to merge the PR through the API, and\n-    // then run into cherry-pick conflicts after the initial merge already completed.\n-    const failure = await this._checkMergability(pullRequest, cherryPickTargetBranches);\n-\n-    // If the PR could not be cherry-picked into all target branches locally, we know it can't\n-    // be done through the Github API either. We abort merging and pass-through the failure.\n-    if (failure !== null) {\n-      return failure;\n-    }\n-\n-    const mergeOptions: OctokitMergeParams = {\n-      pull_number: prNumber,\n-      merge_method: method,\n-      ...this.git.remoteParams,\n-    };\n-\n-    if (needsCommitMessageFixup) {\n-      // Commit message fixup does not work with other merge methods as the Github API only\n-      // allows commit message modifications for squash merging.\n-      if (method !== 'squash') {\n-        return PullRequestFailure.unableToFixupCommitMessageSquashOnly();\n-      }\n-      await this._promptCommitMessageEdit(pullRequest, mergeOptions);\n-    }\n-\n-    let mergeStatusCode: number;\n-    let targetSha: string;\n-\n-    try {\n-      // Merge the pull request using the Github API into the selected base branch.\n-      const result = await this.git.github.pulls.merge(mergeOptions);\n-\n-      mergeStatusCode = result.status;\n-      targetSha = result.data.sha;\n-    } catch (e) {\n-      // Note: Github usually returns `404` as status code if the API request uses a\n-      // token with insufficient permissions. Github does this because it doesn't want\n-      // to leak whether a repository exists or not. In our case we expect a certain\n-      // repository to exist, so we always treat this as a permission failure.\n-      if (e.status === 403 || e.status === 404) {\n-        return PullRequestFailure.insufficientPermissionsToMerge();\n-      }\n-      throw e;\n-    }\n-\n-    // https://developer.github.com/v3/pulls/#response-if-merge-cannot-be-performed\n-    // Pull request cannot be merged due to merge conflicts.\n-    if (mergeStatusCode === 405) {\n-      return PullRequestFailure.mergeConflicts([githubTargetBranch]);\n-    }\n-    if (mergeStatusCode !== 200) {\n-      return PullRequestFailure.unknownMergeError();\n-    }\n-\n-    // If the PR does  not need to be merged into any other target branches,\n-    // we exit here as we already completed the merge.\n-    if (!cherryPickTargetBranches.length) {\n-      return null;\n-    }\n-\n-    // Refresh the target branch the PR has been merged into through the API. We need\n-    // to re-fetch as otherwise we cannot cherry-pick the new commits into the remaining\n-    // target branches.\n-    this.fetchTargetBranches([githubTargetBranch]);\n-\n-    // Number of commits that have landed in the target branch. This could vary from\n-    // the count of commits in the PR due to squashing.\n-    const targetCommitsCount = method === 'squash' ? 1 : pullRequest.commitCount;\n-\n-    // Cherry pick the merged commits into the remaining target branches.\n-    const failedBranches = await this.cherryPickIntoTargetBranches(\n-        `${targetSha}~${targetCommitsCount}..${targetSha}`, cherryPickTargetBranches, {\n-          // Commits that have been created by the Github API do not necessarily contain\n-          // a reference to the source pull request (unless the squash strategy is used).\n-          // To ensure that original commits can be found when a commit is viewed in a\n-          // target branch, we add a link to the original commits when cherry-picking.\n-          linkToOriginalCommits: true,\n-        });\n-\n-    // We already checked whether the PR can be cherry-picked into the target branches,\n-    // but in case the cherry-pick somehow fails, we still handle the conflicts here. The\n-    // commits created through the Github API could be different (i.e. through squash).\n-    if (failedBranches.length) {\n-      return PullRequestFailure.mergeConflicts(failedBranches);\n-    }\n-\n-    this.pushTargetBranchesUpstream(cherryPickTargetBranches);\n-    return null;\n-  }\n-\n-  /**\n-   * Prompts the user for the commit message changes. Unlike as in the autosquash merge\n-   * strategy, we cannot start an interactive rebase because we merge using the Github API.\n-   * The Github API only allows modifications to PR title and body for squash merges.\n-   */\n-  private async _promptCommitMessageEdit(\n-      pullRequest: PullRequest, mergeOptions: OctokitMergeParams) {\n-    const commitMessage = await this._getDefaultSquashCommitMessage(pullRequest);\n-    const {result} = await prompt<{result: string}>({\n-      type: 'editor',\n-      name: 'result',\n-      message: 'Please update the commit message',\n-      default: commitMessage,\n-    });\n-\n-    // Split the new message into title and message. This is necessary because the\n-    // Github API expects title and message to be passed separately.\n-    const [newTitle, ...newMessage] = result.split(COMMIT_HEADER_SEPARATOR);\n-\n-    // Update the merge options so that the changes are reflected in there.\n-    mergeOptions.commit_title = `${newTitle} (#${pullRequest.prNumber})`;\n-    mergeOptions.commit_message = newMessage.join(COMMIT_HEADER_SEPARATOR);\n-  }\n-\n-  /**\n-   * Gets a commit message for the given pull request. Github by default concatenates\n-   * multiple commit messages if a PR is merged in squash mode. We try to replicate this\n-   * behavior here so that we have a default commit message that can be fixed up.\n-   */\n-  private async _getDefaultSquashCommitMessage(pullRequest: PullRequest): Promise<string> {\n-    const commits = (await this._getPullRequestCommitMessages(pullRequest))\n-                        .map(message => ({message, parsed: parseCommitMessage(message)}));\n-    const messageBase = `${pullRequest.title}${COMMIT_HEADER_SEPARATOR}`;\n-    if (commits.length <= 1) {\n-      return `${messageBase}${commits[0].parsed.body}`;\n-    }\n-    const joinedMessages = commits.map(c => `* ${c.message}`).join(COMMIT_HEADER_SEPARATOR);\n-    return `${messageBase}${joinedMessages}`;\n-  }\n-\n-  /** Gets all commit messages of commits in the pull request. */\n-  private async _getPullRequestCommitMessages({prNumber}: PullRequest) {\n-    const allCommits = await this.git.github.paginate(\n-        this.git.github.pulls.listCommits, {...this.git.remoteParams, pull_number: prNumber});\n-    return allCommits.map(({commit}) => commit.message);\n-  }\n-\n-  /**\n-   * Checks if given pull request could be merged into its target branches.\n-   * @returns A pull request failure if it the PR could not be merged.\n-   */\n-  private async _checkMergability(pullRequest: PullRequest, targetBranches: string[]):\n-      Promise<null|PullRequestFailure> {\n-    const revisionRange = this.getPullRequestRevisionRange(pullRequest);\n-    const failedBranches =\n-        this.cherryPickIntoTargetBranches(revisionRange, targetBranches, {dryRun: true});\n-\n-    if (failedBranches.length) {\n-      return PullRequestFailure.mergeConflicts(failedBranches);\n-    }\n-    return null;\n-  }\n-\n-  /** Determines the merge action from the given pull request. */\n-  private _getMergeActionFromPullRequest({labels}: PullRequest): GithubApiMergeMethod {\n-    if (this._config.labels) {\n-      const matchingLabel =\n-          this._config.labels.find(({pattern}) => labels.some(l => matchesPattern(l, pattern)));\n-      if (matchingLabel !== undefined) {\n-        return matchingLabel.method;\n-      }\n-    }\n-    return this._config.default;\n-  }\n-}"
        },
        {
            "sha": "bff4e518e94a90e4078d93c7c5fbf29286fb3568",
            "filename": "dev-infra/pr/merge/strategies/autosquash-merge.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 113,
            "changes": 113,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fautosquash-merge.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fautosquash-merge.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fautosquash-merge.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,113 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {join} from 'path';\n-import {PullRequestFailure} from '../failures';\n-import {PullRequest} from '../pull-request';\n-import {MergeStrategy, TEMP_PR_HEAD_BRANCH} from './strategy';\n-\n-/** Path to the commit message filter script. Git expects this paths to use forward slashes. */\n-const MSG_FILTER_SCRIPT = join(__dirname, './commit-message-filter.js').replace(/\\\\/g, '/');\n-\n-/**\n- * Merge strategy that does not use the Github API for merging. Instead, it fetches\n- * all target branches and the PR locally. The PR is then cherry-picked with autosquash\n- * enabled into the target branches. The benefit is the support for fixup and squash commits.\n- * A notable downside though is that Github does not show the PR as `Merged` due to non\n- * fast-forward merges\n- */\n-export class AutosquashMergeStrategy extends MergeStrategy {\n-  /**\n-   * Merges the specified pull request into the target branches and pushes the target\n-   * branches upstream. This method requires the temporary target branches to be fetched\n-   * already as we don't want to fetch the target branches per pull request merge. This\n-   * would causes unnecessary multiple fetch requests when multiple PRs are merged.\n-   * @throws {GitCommandError} An unknown Git command error occurred that is not\n-   *   specific to the pull request merge.\n-   * @returns A pull request failure or null in case of success.\n-   */\n-  override async merge(pullRequest: PullRequest): Promise<PullRequestFailure|null> {\n-    const {prNumber, targetBranches, requiredBaseSha, needsCommitMessageFixup, githubTargetBranch} =\n-        pullRequest;\n-    // In case a required base is specified for this pull request, check if the pull\n-    // request contains the given commit. If not, return a pull request failure. This\n-    // check is useful for enforcing that PRs are rebased on top of a given commit. e.g.\n-    // a commit that changes the codeowner ship validation. PRs which are not rebased\n-    // could bypass new codeowner ship rules.\n-    if (requiredBaseSha && !this.git.hasCommit(TEMP_PR_HEAD_BRANCH, requiredBaseSha)) {\n-      return PullRequestFailure.unsatisfiedBaseSha();\n-    }\n-\n-    // SHA for the first commit the pull request is based on. Usually we would able\n-    // to just rely on the base revision provided by `getPullRequestBaseRevision`, but\n-    // the revision would rely on the amount of commits in a pull request. This is not\n-    // reliable as we rebase the PR with autosquash where the amount of commits could\n-    // change. We work around this by parsing the base revision so that we have a fixated\n-    // SHA before the autosquash rebase is performed.\n-    const baseSha =\n-        this.git.run(['rev-parse', this.getPullRequestBaseRevision(pullRequest)]).stdout.trim();\n-    // Git revision range that matches the pull request commits.\n-    const revisionRange = `${baseSha}..${TEMP_PR_HEAD_BRANCH}`;\n-\n-    // We always rebase the pull request so that fixup or squash commits are automatically\n-    // collapsed. Git's autosquash functionality does only work in interactive rebases, so\n-    // our rebase is always interactive. In reality though, unless a commit message fixup\n-    // is desired, we set the `GIT_SEQUENCE_EDITOR` environment variable to `true` so that\n-    // the rebase seems interactive to Git, while it's not interactive to the user.\n-    // See: https://github.com/git/git/commit/891d4a0313edc03f7e2ecb96edec5d30dc182294.\n-    const branchOrRevisionBeforeRebase = this.git.getCurrentBranchOrRevision();\n-    const rebaseEnv =\n-        needsCommitMessageFixup ? undefined : {...process.env, GIT_SEQUENCE_EDITOR: 'true'};\n-    this.git.run(\n-        ['rebase', '--interactive', '--autosquash', baseSha, TEMP_PR_HEAD_BRANCH],\n-        {stdio: 'inherit', env: rebaseEnv});\n-\n-    // Update pull requests commits to reference the pull request. This matches what\n-    // Github does when pull requests are merged through the Web UI. The motivation is\n-    // that it should be easy to determine which pull request contained a given commit.\n-    // Note: The filter-branch command relies on the working tree, so we want to make sure\n-    // that we are on the initial branch or revision where the merge script has been invoked.\n-    this.git.run(['checkout', '-f', branchOrRevisionBeforeRebase]);\n-    this.git.run(\n-        ['filter-branch', '-f', '--msg-filter', `${MSG_FILTER_SCRIPT} ${prNumber}`, revisionRange]);\n-\n-    // Cherry-pick the pull request into all determined target branches.\n-    const failedBranches = this.cherryPickIntoTargetBranches(revisionRange, targetBranches);\n-\n-    if (failedBranches.length) {\n-      return PullRequestFailure.mergeConflicts(failedBranches);\n-    }\n-\n-    this.pushTargetBranchesUpstream(targetBranches);\n-\n-    // For PRs which do not target the `master` branch on Github, Github does not automatically\n-    // close the PR when its commit is pushed into the repository.  To ensure these PRs are\n-    // correctly marked as closed, we must detect this situation and close the PR via the API after\n-    // the upstream pushes are completed.\n-    if (githubTargetBranch !== 'master') {\n-      /** The local branch name of the github targeted branch. */\n-      const localBranch = this.getLocalTargetBranchName(githubTargetBranch);\n-      /** The SHA of the commit pushed to github which represents closing the PR. */\n-      const sha = this.git.run(['rev-parse', localBranch]).stdout.trim();\n-      // Create a comment saying the PR was closed by the SHA.\n-      await this.git.github.issues.createComment({\n-        ...this.git.remoteParams,\n-        issue_number: pullRequest.prNumber,\n-        body: `Closed by commit ${sha}`\n-      });\n-      // Actually close the PR.\n-      await this.git.github.pulls.update({\n-        ...this.git.remoteParams,\n-        pull_number: pullRequest.prNumber,\n-        state: 'closed',\n-      });\n-    }\n-\n-    return null;\n-  }\n-}"
        },
        {
            "sha": "5503b5b1e32df1adadd8c5c33a50603434852eb5",
            "filename": "dev-infra/pr/merge/strategies/commit-message-filter.js",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fcommit-message-filter.js",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fcommit-message-filter.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fcommit-message-filter.js?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,45 +0,0 @@\n-#!/usr/bin/env node\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * Script that can be passed as commit message filter to `git filter-branch --msg-filter`.\n- * The script rewrites commit messages to contain a Github instruction to close the\n- * corresponding pull request. For more details. See: https://git.io/Jv64r.\n- */\n-\n-if (require.main === module) {\n-  const [prNumber] = process.argv.slice(2);\n-  if (!prNumber) {\n-    console.error('No pull request number specified.');\n-    process.exit(1);\n-  }\n-\n-  let commitMessage = '';\n-  process.stdin.setEncoding('utf8');\n-  process.stdin.on('readable', () => {\n-    const chunk = process.stdin.read();\n-    if (chunk !== null) {\n-      commitMessage += chunk;\n-    }\n-  });\n-\n-  process.stdin.on('end', () => {\n-    console.info(rewriteCommitMessage(commitMessage, prNumber));\n-  });\n-}\n-\n-function rewriteCommitMessage(message, prNumber) {\n-  const lines = message.split(/\\n/);\n-  // Add the pull request number to the commit message title. This matches what\n-  // Github does when PRs are merged on the web through the `Squash and Merge` button.\n-  lines[0] += ` (#${prNumber})`;\n-  // Push a new line that instructs Github to close the specified pull request.\n-  lines.push(`PR Close #${prNumber}`);\n-  return lines.join('\\n');\n-}"
        },
        {
            "sha": "0011b5b2e36021b5698f2b5279c6e1b40307bdb5",
            "filename": "dev-infra/pr/merge/strategies/strategy.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 141,
            "changes": 141,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,141 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {AuthenticatedGitClient} from '../../../utils/git/authenticated-git-client';\n-import {PullRequestFailure} from '../failures';\n-import {PullRequest} from '../pull-request';\n-\n-/**\n- * Name of a temporary branch that contains the head of a currently-processed PR. Note\n- * that a branch name should be used that most likely does not conflict with other local\n- * development branches.\n- */\n-export const TEMP_PR_HEAD_BRANCH = 'merge_pr_head';\n-\n-/**\n- * Base class for merge strategies. A merge strategy accepts a pull request and\n- * merges it into the determined target branches.\n- */\n-export abstract class MergeStrategy {\n-  constructor(protected git: AuthenticatedGitClient) {}\n-\n-  /**\n-   * Prepares a merge of the given pull request. The strategy by default will\n-   * fetch all target branches and the pull request into local temporary branches.\n-   */\n-  async prepare(pullRequest: PullRequest) {\n-    this.fetchTargetBranches(\n-        pullRequest.targetBranches, `pull/${pullRequest.prNumber}/head:${TEMP_PR_HEAD_BRANCH}`);\n-  }\n-\n-  /**\n-   * Performs the merge of the given pull request. This needs to be implemented\n-   * by individual merge strategies.\n-   */\n-  abstract merge(pullRequest: PullRequest): Promise<null|PullRequestFailure>;\n-\n-  /** Cleans up the pull request merge. e.g. deleting temporary local branches. */\n-  async cleanup(pullRequest: PullRequest) {\n-    // Delete all temporary target branches.\n-    pullRequest.targetBranches.forEach(\n-        branchName => this.git.run(['branch', '-D', this.getLocalTargetBranchName(branchName)]));\n-\n-    // Delete temporary branch for the pull request head.\n-    this.git.run(['branch', '-D', TEMP_PR_HEAD_BRANCH]);\n-  }\n-\n-  /** Gets the revision range for all commits in the given pull request. */\n-  protected getPullRequestRevisionRange(pullRequest: PullRequest): string {\n-    return `${this.getPullRequestBaseRevision(pullRequest)}..${TEMP_PR_HEAD_BRANCH}`;\n-  }\n-\n-  /** Gets the base revision of a pull request. i.e. the commit the PR is based on. */\n-  protected getPullRequestBaseRevision(pullRequest: PullRequest): string {\n-    return `${TEMP_PR_HEAD_BRANCH}~${pullRequest.commitCount}`;\n-  }\n-\n-  /** Gets a deterministic local branch name for a given branch. */\n-  protected getLocalTargetBranchName(targetBranch: string): string {\n-    return `merge_pr_target_${targetBranch.replace(/\\//g, '_')}`;\n-  }\n-\n-  /**\n-   * Cherry-picks the given revision range into the specified target branches.\n-   * @returns A list of branches for which the revisions could not be cherry-picked into.\n-   */\n-  protected cherryPickIntoTargetBranches(revisionRange: string, targetBranches: string[], options: {\n-    dryRun?: boolean,\n-    linkToOriginalCommits?: boolean,\n-  } = {}) {\n-    const cherryPickArgs = [revisionRange];\n-    const failedBranches: string[] = [];\n-\n-    if (options.dryRun) {\n-      // https://git-scm.com/docs/git-cherry-pick#Documentation/git-cherry-pick.txt---no-commit\n-      // This causes `git cherry-pick` to not generate any commits. Instead, the changes are\n-      // applied directly in the working tree. This allow us to easily discard the changes\n-      // for dry-run purposes.\n-      cherryPickArgs.push('--no-commit');\n-    }\n-\n-    if (options.linkToOriginalCommits) {\n-      // We add `-x` when cherry-picking as that will allow us to easily jump to original\n-      // commits for cherry-picked commits. With that flag set, Git will automatically append\n-      // the original SHA/revision to the commit message. e.g. `(cherry picked from commit <..>)`.\n-      // https://git-scm.com/docs/git-cherry-pick#Documentation/git-cherry-pick.txt--x.\n-      cherryPickArgs.push('-x');\n-    }\n-\n-    // Cherry-pick the refspec into all determined target branches.\n-    for (const branchName of targetBranches) {\n-      const localTargetBranch = this.getLocalTargetBranchName(branchName);\n-      // Checkout the local target branch.\n-      this.git.run(['checkout', localTargetBranch]);\n-      // Cherry-pick the refspec into the target branch.\n-      if (this.git.runGraceful(['cherry-pick', ...cherryPickArgs]).status !== 0) {\n-        // Abort the failed cherry-pick. We do this because Git persists the failed\n-        // cherry-pick state globally in the repository. This could prevent future\n-        // pull request merges as a Git thinks a cherry-pick is still in progress.\n-        this.git.runGraceful(['cherry-pick', '--abort']);\n-        failedBranches.push(branchName);\n-      }\n-      // If we run with dry run mode, we reset the local target branch so that all dry-run\n-      // cherry-pick changes are discard. Changes are applied to the working tree and index.\n-      if (options.dryRun) {\n-        this.git.run(['reset', '--hard', 'HEAD']);\n-      }\n-    }\n-    return failedBranches;\n-  }\n-\n-  /**\n-   * Fetches the given target branches. Also accepts a list of additional refspecs that\n-   * should be fetched. This is helpful as multiple slow fetches could be avoided.\n-   */\n-  protected fetchTargetBranches(names: string[], ...extraRefspecs: string[]) {\n-    const fetchRefspecs = names.map(targetBranch => {\n-      const localTargetBranch = this.getLocalTargetBranchName(targetBranch);\n-      return `refs/heads/${targetBranch}:${localTargetBranch}`;\n-    });\n-    // Fetch all target branches with a single command. We don't want to fetch them\n-    // individually as that could cause an unnecessary slow-down.\n-    this.git.run(\n-        ['fetch', '-q', '-f', this.git.getRepoGitUrl(), ...fetchRefspecs, ...extraRefspecs]);\n-  }\n-\n-  /** Pushes the given target branches upstream. */\n-  protected pushTargetBranchesUpstream(names: string[]) {\n-    const pushRefspecs = names.map(targetBranch => {\n-      const localTargetBranch = this.getLocalTargetBranchName(targetBranch);\n-      return `${localTargetBranch}:refs/heads/${targetBranch}`;\n-    });\n-    // Push all target branches with a single command if we don't run in dry-run mode.\n-    // We don't want to push them individually as that could cause an unnecessary slow-down.\n-    this.git.run(['push', this.git.getRepoGitUrl(), ...pushRefspecs]);\n-  }\n-}"
        },
        {
            "sha": "01c9c7122ff47e7b3fd1bf88b884fb7283b296e5",
            "filename": "dev-infra/pr/merge/string-pattern.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstring-pattern.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Fstring-pattern.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstring-pattern.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** Checks whether the specified value matches the given pattern. */\n-export function matchesPattern(value: string, pattern: RegExp|string): boolean {\n-  return typeof pattern === 'string' ? value === pattern : pattern.test(value);\n-}"
        },
        {
            "sha": "707676306a05f125ec8a305f756752b4dc9bbbd0",
            "filename": "dev-infra/pr/merge/target-label.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 60,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ftarget-label.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ftarget-label.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Ftarget-label.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,60 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {MergeConfig, TargetLabel} from './config';\n-import {matchesPattern} from './string-pattern';\n-\n-/**\n- * Unique error that can be thrown in the merge configuration if an\n- * invalid branch is targeted.\n- */\n-export class InvalidTargetBranchError {\n-  constructor(public failureMessage: string) {}\n-}\n-\n-/**\n- * Unique error that can be thrown in the merge configuration if an\n- * invalid label has been applied to a pull request.\n- */\n-export class InvalidTargetLabelError {\n-  constructor(public failureMessage: string) {}\n-}\n-\n-/** Gets the target label from the specified pull request labels. */\n-export function getTargetLabelFromPullRequest(\n-    config: Pick<MergeConfig, 'labels'>, labels: string[]): TargetLabel {\n-  /** List of discovered target labels for the PR. */\n-  const matches = [];\n-  for (const label of labels) {\n-    const match = config.labels.find(({pattern}) => matchesPattern(label, pattern));\n-    if (match !== undefined) {\n-      matches.push(match);\n-    }\n-  }\n-  if (matches.length === 1) {\n-    return matches[0];\n-  }\n-  if (matches.length === 0) {\n-    throw new InvalidTargetLabelError(\n-        'Unable to determine target for the PR as it has no target label.');\n-  }\n-  throw new InvalidTargetLabelError(\n-      'Unable to determine target for the PR as it has multiple target labels.');\n-}\n-\n-/**\n- * Gets the branches from the specified target label.\n- *\n- * @throws {InvalidTargetLabelError} Invalid label has been applied to pull request.\n- * @throws {InvalidTargetBranchError} Invalid Github target branch has been selected.\n- */\n-export async function getBranchesFromTargetLabel(\n-    label: TargetLabel, githubTargetBranch: string): Promise<string[]> {\n-  return typeof label.branches === 'function' ? await label.branches(githubTargetBranch) :\n-                                                await label.branches;\n-}"
        },
        {
            "sha": "2d6ec9c66f31dee48903506ccd68d8f3cafbbce1",
            "filename": "dev-infra/pr/merge/task.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 165,
            "changes": 165,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ftask.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Fmerge%2Ftask.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Ftask.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,165 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {promptConfirm} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {GitCommandError} from '../../utils/git/git-client';\n-\n-import {MergeConfigWithRemote} from './config';\n-import {PullRequestFailure} from './failures';\n-import {getCaretakerNotePromptMessage, getTargettedBranchesConfirmationPromptMessage} from './messages';\n-import {isPullRequest, loadAndValidatePullRequest,} from './pull-request';\n-import {GithubApiMergeStrategy} from './strategies/api-merge';\n-import {AutosquashMergeStrategy} from './strategies/autosquash-merge';\n-\n-/** Describes the status of a pull request merge. */\n-export const enum MergeStatus {\n-  UNKNOWN_GIT_ERROR,\n-  DIRTY_WORKING_DIR,\n-  SUCCESS,\n-  FAILED,\n-  USER_ABORTED,\n-  GITHUB_ERROR,\n-}\n-\n-/** Result of a pull request merge. */\n-export interface MergeResult {\n-  /** Overall status of the merge. */\n-  status: MergeStatus;\n-  /** List of pull request failures. */\n-  failure?: PullRequestFailure;\n-}\n-\n-export interface PullRequestMergeTaskFlags {\n-  branchPrompt: boolean;\n-}\n-\n-const defaultPullRequestMergeTaskFlags: PullRequestMergeTaskFlags = {\n-  branchPrompt: true,\n-};\n-\n-/**\n- * Class that accepts a merge script configuration and Github token. It provides\n- * a programmatic interface for merging multiple pull requests based on their\n- * labels that have been resolved through the merge script configuration.\n- */\n-export class PullRequestMergeTask {\n-  private flags: PullRequestMergeTaskFlags;\n-\n-  constructor(\n-      public config: MergeConfigWithRemote, public git: AuthenticatedGitClient,\n-      flags: Partial<PullRequestMergeTaskFlags>) {\n-    // Update flags property with the provided flags values as patches to the default flag values.\n-    this.flags = {...defaultPullRequestMergeTaskFlags, ...flags};\n-  }\n-\n-  /**\n-   * Merges the given pull request and pushes it upstream.\n-   * @param prNumber Pull request that should be merged.\n-   * @param force Whether non-critical pull request failures should be ignored.\n-   */\n-  async merge(prNumber: number, force = false): Promise<MergeResult> {\n-    // Check whether the given Github token has sufficient permissions for writing\n-    // to the configured repository. If the repository is not private, only the\n-    // reduced `public_repo` OAuth scope is sufficient for performing merges.\n-    const hasOauthScopes = await this.git.hasOauthScopes((scopes, missing) => {\n-      if (!scopes.includes('repo')) {\n-        if (this.config.remote.private) {\n-          missing.push('repo');\n-        } else if (!scopes.includes('public_repo')) {\n-          missing.push('public_repo');\n-        }\n-      }\n-\n-      // Pull requests can modify Github action workflow files. In such cases Github requires us to\n-      // push with a token that has the `workflow` oauth scope set. To avoid errors when the\n-      // caretaker intends to merge such PRs, we ensure the scope is always set on the token before\n-      // the merge process starts.\n-      // https://docs.github.com/en/developers/apps/scopes-for-oauth-apps#available-scopes\n-      if (!scopes.includes('workflow')) {\n-        missing.push('workflow');\n-      }\n-    });\n-\n-    if (hasOauthScopes !== true) {\n-      return {\n-        status: MergeStatus.GITHUB_ERROR,\n-        failure: PullRequestFailure.insufficientPermissionsToMerge(hasOauthScopes.error)\n-      };\n-    }\n-\n-    if (this.git.hasUncommittedChanges()) {\n-      return {status: MergeStatus.DIRTY_WORKING_DIR};\n-    }\n-\n-    const pullRequest = await loadAndValidatePullRequest(this, prNumber, force);\n-\n-    if (!isPullRequest(pullRequest)) {\n-      return {status: MergeStatus.FAILED, failure: pullRequest};\n-    }\n-\n-\n-    if (this.flags.branchPrompt &&\n-        !await promptConfirm(getTargettedBranchesConfirmationPromptMessage(pullRequest))) {\n-      return {status: MergeStatus.USER_ABORTED};\n-    }\n-\n-\n-    // If the pull request has a caretaker note applied, raise awareness by prompting\n-    // the caretaker. The caretaker can then decide to proceed or abort the merge.\n-    if (pullRequest.hasCaretakerNote &&\n-        !await promptConfirm(getCaretakerNotePromptMessage(pullRequest))) {\n-      return {status: MergeStatus.USER_ABORTED};\n-    }\n-\n-    const strategy = this.config.githubApiMerge ?\n-        new GithubApiMergeStrategy(this.git, this.config.githubApiMerge) :\n-        new AutosquashMergeStrategy(this.git);\n-\n-    // Branch or revision that is currently checked out so that we can switch back to\n-    // it once the pull request has been merged.\n-    let previousBranchOrRevision: null|string = null;\n-\n-    // The following block runs Git commands as child processes. These Git commands can fail.\n-    // We want to capture these command errors and return an appropriate merge request status.\n-    try {\n-      previousBranchOrRevision = this.git.getCurrentBranchOrRevision();\n-\n-      // Run preparations for the merge (e.g. fetching branches).\n-      await strategy.prepare(pullRequest);\n-\n-      // Perform the merge and capture potential failures.\n-      const failure = await strategy.merge(pullRequest);\n-      if (failure !== null) {\n-        return {status: MergeStatus.FAILED, failure};\n-      }\n-\n-      // Switch back to the previous branch. We need to do this before deleting the temporary\n-      // branches because we cannot delete branches which are currently checked out.\n-      this.git.run(['checkout', '-f', previousBranchOrRevision]);\n-\n-      await strategy.cleanup(pullRequest);\n-\n-      // Return a successful merge status.\n-      return {status: MergeStatus.SUCCESS};\n-    } catch (e) {\n-      // Catch all git command errors and return a merge result w/ git error status code.\n-      // Other unknown errors which aren't caused by a git command are re-thrown.\n-      if (e instanceof GitCommandError) {\n-        return {status: MergeStatus.UNKNOWN_GIT_ERROR};\n-      }\n-      throw e;\n-    } finally {\n-      // Always try to restore the branch if possible. We don't want to leave\n-      // the repository in a different state than before.\n-      if (previousBranchOrRevision !== null) {\n-        this.git.runGraceful(['checkout', '-f', previousBranchOrRevision]);\n-      }\n-    }\n-  }\n-}"
        },
        {
            "sha": "9d1d58a2dba1c70d08cf507a80934a6c1bd3727a",
            "filename": "dev-infra/pr/rebase/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Frebase%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,22 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"rebase\",\n-    srcs = [\n-        \"cli.ts\",\n-        \"index.ts\",\n-    ],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/conventional-commits-parser\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//conventional-commits-parser\",\n-        \"@npm//inquirer\",\n-        \"@npm//typed-graphqlify\",\n-        \"@npm//yargs\",\n-    ],\n-)"
        },
        {
            "sha": "6b1c0c05f128edca478a684d5f98808430501afd",
            "filename": "dev-infra/pr/rebase/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Frebase%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,30 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv} from 'yargs';\n-\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-\n-import {rebasePr} from './index';\n-\n-/** The options available to the rebase command via CLI. */\n-export interface RebaseCommandOptions {\n-  githubToken: string;\n-  prNumber: number;\n-}\n-\n-/** Builds the rebase pull request command. */\n-export function buildRebaseCommand(yargs: Argv): Argv<RebaseCommandOptions> {\n-  return addGithubTokenOption(yargs).positional('prNumber', {type: 'number', demandOption: true});\n-}\n-\n-/** Handles the rebase pull request command. */\n-export async function handleRebaseCommand(\n-    {prNumber, githubToken}: Arguments<RebaseCommandOptions>) {\n-  await rebasePr(prNumber, githubToken);\n-}"
        },
        {
            "sha": "b9dbd8517f8f8dd6bf5770cd72766abaa0fa9cbb",
            "filename": "dev-infra/pr/rebase/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 154,
            "changes": 154,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpr%2Frebase%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Frebase%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,154 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {types as graphqlTypes} from 'typed-graphqlify';\n-\n-import {Commit} from '../../commit-message/parse';\n-import {getCommitsInRange} from '../../commit-message/utils';\n-import {getConfig, NgDevConfig} from '../../utils/config';\n-import {error, info, promptConfirm} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {addTokenToGitHttpsUrl} from '../../utils/git/github-urls';\n-import {getPr} from '../../utils/github';\n-\n-/* Graphql schema for the response body for each pending PR. */\n-const PR_SCHEMA = {\n-  state: graphqlTypes.string,\n-  maintainerCanModify: graphqlTypes.boolean,\n-  viewerDidAuthor: graphqlTypes.boolean,\n-  headRefOid: graphqlTypes.string,\n-  headRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-  baseRef: {\n-    name: graphqlTypes.string,\n-    repository: {\n-      url: graphqlTypes.string,\n-      nameWithOwner: graphqlTypes.string,\n-    },\n-  },\n-};\n-\n-/**\n- * Rebase the provided PR onto its merge target branch, and push up the resulting\n- * commit to the PRs repository.\n- */\n-export async function rebasePr(\n-    prNumber: number, githubToken: string, config: Pick<NgDevConfig, 'github'> = getConfig()) {\n-  /** The singleton instance of the authenticated git client. */\n-  const git = AuthenticatedGitClient.get();\n-  if (git.hasUncommittedChanges()) {\n-    error('Cannot perform rebase of PR with local changes.');\n-    process.exit(1);\n-  }\n-\n-  /**\n-   * The branch or revision originally checked out before this method performed\n-   * any Git operations that may change the working branch.\n-   */\n-  const previousBranchOrRevision = git.getCurrentBranchOrRevision();\n-  /* Get the PR information from Github. */\n-  const pr = await getPr(PR_SCHEMA, prNumber, git);\n-\n-  const headRefName = pr.headRef.name;\n-  const baseRefName = pr.baseRef.name;\n-  const fullHeadRef = `${pr.headRef.repository.nameWithOwner}:${headRefName}`;\n-  const fullBaseRef = `${pr.baseRef.repository.nameWithOwner}:${baseRefName}`;\n-  const headRefUrl = addTokenToGitHttpsUrl(pr.headRef.repository.url, githubToken);\n-  const baseRefUrl = addTokenToGitHttpsUrl(pr.baseRef.repository.url, githubToken);\n-\n-  // Note: Since we use a detached head for rebasing the PR and therefore do not have\n-  // remote-tracking branches configured, we need to set our expected ref and SHA. This\n-  // allows us to use `--force-with-lease` for the detached head while ensuring that we\n-  // never accidentally override upstream changes that have been pushed in the meanwhile.\n-  // See:\n-  // https://git-scm.com/docs/git-push#Documentation/git-push.txt---force-with-leaseltrefnamegtltexpectgt\n-  const forceWithLeaseFlag = `--force-with-lease=${headRefName}:${pr.headRefOid}`;\n-\n-  // If the PR does not allow maintainers to modify it, exit as the rebased PR cannot\n-  // be pushed up.\n-  if (!pr.maintainerCanModify && !pr.viewerDidAuthor) {\n-    error(\n-        `Cannot rebase as you did not author the PR and the PR does not allow maintainers` +\n-        `to modify the PR`);\n-    process.exit(1);\n-  }\n-\n-  try {\n-    // Fetch the branch at the commit of the PR, and check it out in a detached state.\n-    info(`Checking out PR #${prNumber} from ${fullHeadRef}`);\n-    git.run(['fetch', '-q', headRefUrl, headRefName]);\n-    git.run(['checkout', '-q', '--detach', 'FETCH_HEAD']);\n-    // Fetch the PRs target branch and rebase onto it.\n-    info(`Fetching ${fullBaseRef} to rebase #${prNumber} on`);\n-    git.run(['fetch', '-q', baseRefUrl, baseRefName]);\n-\n-    const commonAncestorSha = git.run(['merge-base', 'HEAD', 'FETCH_HEAD']).stdout.trim();\n-\n-    const commits = await getCommitsInRange(commonAncestorSha, 'HEAD');\n-\n-    let squashFixups = commits.filter((commit: Commit) => commit.isFixup).length === 0 ?\n-        false :\n-        await promptConfirm(\n-            `PR #${prNumber} contains fixup commits, would you like to squash them during rebase?`,\n-            true);\n-\n-    info(`Attempting to rebase PR #${prNumber} on ${fullBaseRef}`);\n-\n-    /**\n-     * Tuple of flags to be added to the rebase command and env object to run the git command.\n-     *\n-     * Additional flags to perform the autosquashing are added when the user confirm squashing of\n-     * fixup commits should occur.\n-     */\n-    const [flags, env] = squashFixups ?\n-        [['--interactive', '--autosquash'], {...process.env, GIT_SEQUENCE_EDITOR: 'true'}] :\n-        [[], undefined];\n-    const rebaseResult = git.runGraceful(['rebase', ...flags, 'FETCH_HEAD'], {env: env});\n-\n-    // If the rebase was clean, push the rebased PR up to the authors fork.\n-    if (rebaseResult.status === 0) {\n-      info(`Rebase was able to complete automatically without conflicts`);\n-      info(`Pushing rebased PR #${prNumber} to ${fullHeadRef}`);\n-      git.run(['push', headRefUrl, `HEAD:${headRefName}`, forceWithLeaseFlag]);\n-      info(`Rebased and updated PR #${prNumber}`);\n-      git.checkout(previousBranchOrRevision, true);\n-      process.exit(0);\n-    }\n-  } catch (err) {\n-    error(err.message);\n-    git.checkout(previousBranchOrRevision, true);\n-    process.exit(1);\n-  }\n-\n-  // On automatic rebase failures, prompt to choose if the rebase should be continued\n-  // manually or aborted now.\n-  info(`Rebase was unable to complete automatically without conflicts.`);\n-  // If the command is run in a non-CI environment, prompt to format the files immediately.\n-  const continueRebase =\n-      process.env['CI'] === undefined && await promptConfirm('Manually complete rebase?');\n-\n-  if (continueRebase) {\n-    info(`After manually completing rebase, run the following command to update PR #${prNumber}:`);\n-    info(` $ git push ${pr.headRef.repository.url} HEAD:${headRefName} ${forceWithLeaseFlag}`);\n-    info();\n-    info(`To abort the rebase and return to the state of the repository before this command`);\n-    info(`run the following command:`);\n-    info(` $ git rebase --abort && git reset --hard && git checkout ${previousBranchOrRevision}`);\n-    process.exit(1);\n-  } else {\n-    info(`Cleaning up git state, and restoring previous state.`);\n-  }\n-\n-  git.checkout(previousBranchOrRevision, true);\n-  process.exit(1);\n-}"
        },
        {
            "sha": "7ab68b7d64bb808277e160a05d514e21b66031e9",
            "filename": "dev-infra/pullapprove/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,47 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"pullapprove\",\n-    srcs = [\n-        \"cli.ts\",\n-        \"condition_evaluator.ts\",\n-        \"group.ts\",\n-        \"logging.ts\",\n-        \"parse-yaml.ts\",\n-        \"pullapprove_arrays.ts\",\n-        \"utils.ts\",\n-        \"verify.ts\",\n-    ],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/minimatch\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yaml\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//minimatch\",\n-        \"@npm//yaml\",\n-        \"@npm//yargs\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"pullapprove_test_lib\",\n-    testonly = True,\n-    srcs = glob(\n-        [\"*.spec.ts\"],\n-    ),\n-    visibility = [\"//visibility:private\"],\n-    deps = [\n-        \":pullapprove\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-        \"@npm//typescript\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"pullapprove_test\",\n-    srcs = [\":pullapprove_test_lib\"],\n-    visibility = [\"//visibility:private\"],\n-)"
        },
        {
            "sha": "f3fa0b083b9db3da5aad1126417e441190fa1dd4",
            "filename": "dev-infra/pullapprove/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-import {verify} from './verify';\n-\n-/** Build the parser for the pullapprove commands. */\n-export function buildPullapproveParser(localYargs: yargs.Argv) {\n-  return localYargs.help().strict().demandCommand().command(\n-      'verify', 'Verify the pullapprove config', {}, () => verify());\n-}"
        },
        {
            "sha": "b64eb7a5a8f03621b1b25d4cc35e042f8b1a2344",
            "filename": "dev-infra/pullapprove/condition_evaluator.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 64,
            "changes": 64,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,64 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {PullApproveGroup} from './group';\n-import {PullApproveGroupArray, PullApproveStringArray} from './pullapprove_arrays';\n-import {getOrCreateGlob} from './utils';\n-\n-/**\n- * Context that is provided to conditions. Conditions can use various helpers\n- * that PullApprove provides. We try to mock them here. Consult the official\n- * docs for more details: https://docs.pullapprove.com/config/conditions.\n- */\n-const conditionContext = {\n-  'len': (value: any[]) => value.length,\n-  'contains_any_globs': (files: PullApproveStringArray, patterns: string[]) => {\n-    // Note: Do not always create globs for the same pattern again. This method\n-    // could be called for each source file. Creating glob's is expensive.\n-    return files.some(f => patterns.some(pattern => getOrCreateGlob(pattern).match(f)));\n-  },\n-};\n-\n-/**\n- * Converts a given condition to a function that accepts a set of files. The returned\n- * function can be called to check if the set of files matches the condition.\n- */\n-export function convertConditionToFunction(expr: string): (\n-    files: string[], groups: PullApproveGroup[]) => boolean {\n-  // Creates a dynamic function with the specified expression.\n-  // The first parameter will be `files` as that corresponds to the supported `files` variable that\n-  // can be accessed in PullApprove condition expressions. The second parameter is the list of\n-  // PullApproveGroups that are accessible in the condition expressions. The followed parameters\n-  // correspond to other context variables provided by PullApprove for conditions.\n-  const evaluateFn = new Function('files', 'groups', ...Object.keys(conditionContext), `\n-    return (${transformExpressionToJs(expr)});\n-  `);\n-\n-  // Create a function that calls the dynamically constructed function which mimics\n-  // the condition expression that is usually evaluated with Python in PullApprove.\n-  return (files, groups) => {\n-    const result = evaluateFn(\n-        new PullApproveStringArray(...files), new PullApproveGroupArray(...groups),\n-        ...Object.values(conditionContext));\n-    // If an array is returned, we consider the condition as active if the array is not\n-    // empty. This matches PullApprove's condition evaluation that is based on Python.\n-    if (Array.isArray(result)) {\n-      return result.length !== 0;\n-    }\n-    return !!result;\n-  };\n-}\n-\n-/**\n- * Transforms a condition expression from PullApprove that is based on python\n- * so that it can be run inside JavaScript. Current transformations:\n- *   1. `not <..>` -> `!<..>`\n- */\n-function transformExpressionToJs(expression: string): string {\n-  return expression.replace(/not\\s+/g, '!');\n-}"
        },
        {
            "sha": "2c1b2669065a07f47809743df3d86d6bea169fec",
            "filename": "dev-infra/pullapprove/group.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 132,
            "changes": 132,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fgroup.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fgroup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fgroup.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,132 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {error} from '../utils/console';\n-import {convertConditionToFunction} from './condition_evaluator';\n-import {PullApproveGroupConfig} from './parse-yaml';\n-import {PullApproveGroupStateDependencyError} from './pullapprove_arrays';\n-\n-/** A condition for a group. */\n-interface GroupCondition {\n-  expression: string;\n-  checkFn: (files: string[], groups: PullApproveGroup[]) => boolean;\n-  matchedFiles: Set<string>;\n-  unverifiable: boolean;\n-}\n-\n-interface GroupReviewers {\n-  users?: string[];\n-  teams?: string[];\n-}\n-\n-/** Result of testing files against the group. */\n-export interface PullApproveGroupResult {\n-  groupName: string;\n-  matchedConditions: GroupCondition[];\n-  matchedCount: number;\n-  unmatchedConditions: GroupCondition[];\n-  unmatchedCount: number;\n-  unverifiableConditions: GroupCondition[];\n-}\n-\n-// Regular expression that matches conditions for the global approval.\n-const GLOBAL_APPROVAL_CONDITION_REGEX = /^\"global-(docs-)?approvers\" not in groups.approved$/;\n-\n-/** A PullApprove group to be able to test files against. */\n-export class PullApproveGroup {\n-  /** List of conditions for the group. */\n-  readonly conditions: GroupCondition[] = [];\n-  /** List of reviewers for the group. */\n-  readonly reviewers: GroupReviewers;\n-\n-  constructor(\n-      public groupName: string, config: PullApproveGroupConfig,\n-      readonly precedingGroups: PullApproveGroup[] = []) {\n-    this._captureConditions(config);\n-    this.reviewers = config.reviewers ?? {users: [], teams: []};\n-  }\n-\n-  private _captureConditions(config: PullApproveGroupConfig) {\n-    if (config.conditions) {\n-      return config.conditions.forEach(condition => {\n-        const expression = condition.trim();\n-\n-        if (expression.match(GLOBAL_APPROVAL_CONDITION_REGEX)) {\n-          // Currently a noop as we don't take any action for global approval conditions.\n-          return;\n-        }\n-\n-        try {\n-          this.conditions.push({\n-            expression,\n-            checkFn: convertConditionToFunction(expression),\n-            matchedFiles: new Set(),\n-            unverifiable: false,\n-          });\n-        } catch (e) {\n-          error(`Could not parse condition in group: ${this.groupName}`);\n-          error(` - ${expression}`);\n-          error(`Error:`);\n-          error(e.message);\n-          error(e.stack);\n-          process.exit(1);\n-        }\n-      });\n-    }\n-  }\n-\n-  /**\n-   * Tests a provided file path to determine if it would be considered matched by\n-   * the pull approve group's conditions.\n-   */\n-  testFile(filePath: string): boolean {\n-    return this.conditions.every((condition) => {\n-      const {matchedFiles, checkFn, expression} = condition;\n-      try {\n-        const matchesFile = checkFn([filePath], this.precedingGroups);\n-        if (matchesFile) {\n-          matchedFiles.add(filePath);\n-        }\n-        return matchesFile;\n-      } catch (e) {\n-        // In the case of a condition that depends on the state of groups we want to\n-        // ignore that the verification can't accurately evaluate the condition and then\n-        // continue processing. Other types of errors fail the verification, as conditions\n-        // should otherwise be able to execute without throwing.\n-        if (e instanceof PullApproveGroupStateDependencyError) {\n-          condition.unverifiable = true;\n-          // Return true so that `this.conditions.every` can continue evaluating.\n-          return true;\n-        } else {\n-          const errMessage = `Condition could not be evaluated: \\n\\n` +\n-              `From the [${this.groupName}] group:\\n` +\n-              ` - ${expression}` +\n-              `\\n\\n${e.message} ${e.stack}\\n\\n`;\n-          error(errMessage);\n-          process.exit(1);\n-        }\n-      }\n-    });\n-  }\n-\n-  /** Retrieve the results for the Group, all matched and unmatched conditions. */\n-  getResults(): PullApproveGroupResult {\n-    const matchedConditions = this.conditions.filter(c => c.matchedFiles.size > 0);\n-    const unmatchedConditions =\n-        this.conditions.filter(c => c.matchedFiles.size === 0 && !c.unverifiable);\n-    const unverifiableConditions = this.conditions.filter(c => c.unverifiable);\n-    return {\n-      matchedConditions,\n-      matchedCount: matchedConditions.length,\n-      unmatchedConditions,\n-      unmatchedCount: unmatchedConditions.length,\n-      unverifiableConditions,\n-      groupName: this.groupName,\n-    };\n-  }\n-}"
        },
        {
            "sha": "573516e23e738886a6205355d6a6faa4d861f7a0",
            "filename": "dev-infra/pullapprove/logging.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 46,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Flogging.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Flogging.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Flogging.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,46 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {info} from '../utils/console';\n-import {PullApproveGroupResult} from './group';\n-\n-type ConditionGrouping = keyof Pick<\n-    PullApproveGroupResult, 'matchedConditions'|'unmatchedConditions'|'unverifiableConditions'>;\n-\n-/** Create logs for each pullapprove group result. */\n-export function logGroup(\n-    group: PullApproveGroupResult, conditionsToPrint: ConditionGrouping, printMessageFn = info) {\n-  const conditions = group[conditionsToPrint];\n-  printMessageFn.group(`[${group.groupName}]`);\n-  if (conditions.length) {\n-    conditions.forEach(groupCondition => {\n-      const count = groupCondition.matchedFiles.size;\n-      if (conditionsToPrint === 'unverifiableConditions') {\n-        printMessageFn(`${groupCondition.expression}`);\n-      } else {\n-        printMessageFn(\n-            `${count} ${count === 1 ? 'match' : 'matches'} - ${groupCondition.expression}`);\n-      }\n-    });\n-    printMessageFn.groupEnd();\n-  }\n-}\n-\n-/** Logs a header within a text drawn box. */\n-export function logHeader(...params: string[]) {\n-  const totalWidth = 80;\n-  const fillWidth = totalWidth - 2;\n-  const headerText = params.join(' ').substr(0, fillWidth);\n-  const leftSpace = Math.ceil((fillWidth - headerText.length) / 2);\n-  const rightSpace = fillWidth - leftSpace - headerText.length;\n-  const fill = (count: number, content: string) => content.repeat(count);\n-\n-  info(`┌${fill(fillWidth, '─')}┐`);\n-  info(`│${fill(leftSpace, ' ')}${headerText}${fill(rightSpace, ' ')}│`);\n-  info(`└${fill(fillWidth, '─')}┘`);\n-}"
        },
        {
            "sha": "fc0289ecce7efdbdcc23c6f8fac4373018fc7c03",
            "filename": "dev-infra/pullapprove/parse-yaml.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fparse-yaml.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fparse-yaml.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fparse-yaml.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,45 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {parse as parseYaml} from 'yaml';\n-import {PullApproveGroup} from './group';\n-\n-export interface PullApproveGroupConfig {\n-  conditions?: string[];\n-  reviewers?: {\n-    users: string[],\n-    teams?: string[],\n-  }|{\n-    teams: string[],\n-  };\n-}\n-\n-export interface PullApproveConfig {\n-  version: number;\n-  github_api_version?: string;\n-  pullapprove_conditions?: {\n-    condition: string,\n-    unmet_status: string,\n-    explanation: string,\n-  }[];\n-  groups: {\n-    [key: string]: PullApproveGroupConfig,\n-  };\n-}\n-\n-export function parsePullApproveYaml(rawYaml: string): PullApproveConfig {\n-  return parseYaml(rawYaml, {merge: true}) as PullApproveConfig;\n-}\n-\n-/** Parses all of the groups defined in the pullapprove yaml. */\n-export function getGroupsFromYaml(pullApproveYamlRaw: string): PullApproveGroup[] {\n-  /** JSON representation of the pullapprove yaml file. */\n-  const pullApprove = parsePullApproveYaml(pullApproveYamlRaw);\n-  return Object.entries(pullApprove.groups).reduce((groups, [groupName, group]) => {\n-    return groups.concat(new PullApproveGroup(groupName, group, groups));\n-  }, [] as PullApproveGroup[]);\n-}"
        },
        {
            "sha": "46cec6d5227baef2ab36d15f73f46c623b74f7ef",
            "filename": "dev-infra/pullapprove/pullapprove_arrays.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 89,
            "changes": 89,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,89 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {PullApproveGroup} from './group';\n-import {getOrCreateGlob} from './utils';\n-\n-export class PullApproveGroupStateDependencyError extends Error {\n-  constructor(message?: string) {\n-    super(message);\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally\n-    // lost due to a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, PullApproveGroupStateDependencyError.prototype);\n-    // Error names are displayed in their stack but can't be set in the constructor.\n-    this.name = PullApproveGroupStateDependencyError.name;\n-  }\n-}\n-\n-/**\n- * Superset of a native array. The superset provides methods which mimic the\n- * list data structure used in PullApprove for files in conditions.\n- */\n-export class PullApproveStringArray extends Array<string> {\n-  constructor(...elements: string[]) {\n-    super(...elements);\n-\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally\n-    // lost due to a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, PullApproveStringArray.prototype);\n-  }\n-  /** Returns a new array which only includes files that match the given pattern. */\n-  include(pattern: string): PullApproveStringArray {\n-    return new PullApproveStringArray(...this.filter(s => getOrCreateGlob(pattern).match(s)));\n-  }\n-\n-  /** Returns a new array which only includes files that did not match the given pattern. */\n-  exclude(pattern: string): PullApproveStringArray {\n-    return new PullApproveStringArray(...this.filter(s => !getOrCreateGlob(pattern).match(s)));\n-  }\n-}\n-\n-/**\n- * Superset of a native array. The superset provides methods which mimic the\n- * list data structure used in PullApprove for groups in conditions.\n- */\n-export class PullApproveGroupArray extends Array<PullApproveGroup> {\n-  constructor(...elements: PullApproveGroup[]) {\n-    super(...elements);\n-\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally\n-    // lost due to a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, PullApproveGroupArray.prototype);\n-  }\n-\n-  include(pattern: string): PullApproveGroupArray {\n-    return new PullApproveGroupArray(...this.filter(s => s.groupName.match(pattern)));\n-  }\n-\n-  /** Returns a new array which only includes files that did not match the given pattern. */\n-  exclude(pattern: string): PullApproveGroupArray {\n-    return new PullApproveGroupArray(...this.filter(s => s.groupName.match(pattern)));\n-  }\n-\n-  get pending() {\n-    throw new PullApproveGroupStateDependencyError();\n-  }\n-\n-  get active() {\n-    throw new PullApproveGroupStateDependencyError();\n-  }\n-\n-  get inactive() {\n-    throw new PullApproveGroupStateDependencyError();\n-  }\n-\n-  get rejected() {\n-    throw new PullApproveGroupStateDependencyError();\n-  }\n-\n-  get names() {\n-    return this.map(g => g.groupName);\n-  }\n-}"
        },
        {
            "sha": "8e93f07a9f7f1be3b2029ba636baf35693ba073e",
            "filename": "dev-infra/pullapprove/utils.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Futils.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,24 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {IMinimatch, Minimatch} from 'minimatch';\n-\n-/** Map that holds patterns and their corresponding Minimatch globs. */\n-const patternCache = new Map<string, IMinimatch>();\n-\n-/**\n- * Gets a glob for the given pattern. The cached glob will be returned\n- * if available. Otherwise a new glob will be created and cached.\n- */\n-export function getOrCreateGlob(pattern: string) {\n-  if (patternCache.has(pattern)) {\n-    return patternCache.get(pattern)!;\n-  }\n-  const glob = new Minimatch(pattern, {dot: true});\n-  patternCache.set(pattern, glob);\n-  return glob;\n-}"
        },
        {
            "sha": "f3ddb620887e7849a3b18e84c3791c30cd13f2e7",
            "filename": "dev-infra/pullapprove/verify.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 88,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fverify.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fverify.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fverify.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,88 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {PullApproveGroup} from './group';\n-import {getGroupsFromYaml} from './parse-yaml';\n-\n-describe('group parsing', () => {\n-  it('gets group name', () => {\n-    const groupName = 'fw-migrations';\n-    const groups = getGroupsFromYaml(`\n-      groups:\n-        ${groupName}:\n-          type: optional\n-      `);\n-    expect(groups[0].groupName).toBe(groupName);\n-  });\n-\n-  it('gets correct number of groups', () => {\n-    const groups = getGroupsFromYaml(`\n-      groups:\n-        fw-migrations:\n-          type: optional\n-        fw-core:\n-          type: optional\n-      `);\n-    expect(groups.length).toBe(2);\n-  });\n-\n-  it('gets preceding groups', () => {\n-    const groups = getGroupsFromYaml(`\n-      groups:\n-        fw-migrations:\n-          type: optional\n-        fw-core:\n-          type: optional\n-        dev-infra:\n-          type: optional\n-      `);\n-    const fwMigrations = getGroupByName(groups, 'fw-migrations')!;\n-    const fwCore = getGroupByName(groups, 'fw-core')!;\n-    const devInfra = getGroupByName(groups, 'dev-infra')!;\n-    expect(getGroupNames(fwMigrations.precedingGroups)).toEqual([]);\n-    expect(getGroupNames(fwCore.precedingGroups)).toEqual([fwMigrations.groupName]);\n-    expect(getGroupNames(devInfra.precedingGroups)).toEqual([\n-      fwMigrations.groupName, fwCore.groupName\n-    ]);\n-  });\n-\n-  it('matches file conditions', () => {\n-    const groups = getGroupsFromYaml(`\n-      groups:\n-        fw-core:\n-          conditions:\n-            - contains_any_globs(files, ['packages/core/**'])\n-      `);\n-    const fwCore = getGroupByName(groups, 'fw-core')!;\n-    expect(fwCore.testFile('packages/core/test.ts')).toBe(true);\n-    expect(fwCore.testFile('some/other/location/test.ts')).toBe(false);\n-  });\n-\n-  it('allows conditions based on groups', () => {\n-    const groups = getGroupsFromYaml(`\n-      groups:\n-        fw-migrations:\n-          conditions:\n-            - len(groups) > 0\n-        fw-core:\n-          conditions:\n-            - len(groups.active) > 0\n-      `);\n-    const fwMigrations = getGroupByName(groups, 'fw-migrations')!;\n-    expect(() => fwMigrations.testFile('any')).not.toThrow();\n-    const fwCore = getGroupByName(groups, 'fw-core')!;\n-    expect(() => fwCore.testFile('any')).not.toThrow();\n-  });\n-});\n-\n-function getGroupByName(groups: PullApproveGroup[], name: string): PullApproveGroup|undefined {\n-  return groups.find(g => g.groupName === name);\n-}\n-\n-function getGroupNames(groups: PullApproveGroup[]) {\n-  return groups.map(g => g.groupName);\n-}"
        },
        {
            "sha": "93bfe9948ec2c156e6b58d94391ca86550d86fa4",
            "filename": "dev-infra/pullapprove/verify.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 114,
            "changes": 114,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fpullapprove%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fverify.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,114 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {readFileSync} from 'fs';\n-import {resolve} from 'path';\n-\n-import {debug, info} from '../utils/console';\n-import {GitClient} from '../utils/git/git-client';\n-import {logGroup, logHeader} from './logging';\n-import {getGroupsFromYaml} from './parse-yaml';\n-\n-export function verify() {\n-  const git = GitClient.get();\n-  /** Full path to PullApprove config file */\n-  const PULL_APPROVE_YAML_PATH = resolve(git.baseDir, '.pullapprove.yml');\n-  /** All tracked files in the repository. */\n-  const REPO_FILES = git.allFiles();\n-  /** The pull approve config file. */\n-  const pullApproveYamlRaw = readFileSync(PULL_APPROVE_YAML_PATH, 'utf8');\n-  /** All of the groups defined in the pullapprove yaml. */\n-  const groups = getGroupsFromYaml(pullApproveYamlRaw);\n-  /**\n-   * PullApprove groups without conditions. These are skipped in the verification\n-   * as those would always be active and cause zero unmatched files.\n-   */\n-  const groupsSkipped = groups.filter(group => !group.conditions.length);\n-  /** PullApprove groups with conditions. */\n-  const groupsWithConditions = groups.filter(group => !!group.conditions.length);\n-  /** Files which are matched by at least one group. */\n-  const matchedFiles: string[] = [];\n-  /** Files which are not matched by at least one group. */\n-  const unmatchedFiles: string[] = [];\n-\n-  // Test each file in the repo against each group for being matched.\n-  REPO_FILES.forEach((file: string) => {\n-    if (groupsWithConditions.filter(group => group.testFile(file)).length) {\n-      matchedFiles.push(file);\n-    } else {\n-      unmatchedFiles.push(file);\n-    }\n-  });\n-  /** Results for each group */\n-  const resultsByGroup = groupsWithConditions.map(group => group.getResults());\n-  /**\n-   * Whether all group condition lines match at least one file and all files\n-   * are matched by at least one group.\n-   */\n-  const allGroupConditionsValid =\n-      resultsByGroup.every(r => !r.unmatchedCount) && !unmatchedFiles.length;\n-  /** Whether all groups have at least one reviewer user or team defined.  */\n-  const groupsWithoutReviewers = groups.filter(group => Object.keys(group.reviewers).length === 0);\n-  /** The overall result of the verifcation. */\n-  const overallResult = allGroupConditionsValid && groupsWithoutReviewers.length === 0;\n-\n-  /**\n-   * Overall result\n-   */\n-  logHeader('Overall Result');\n-  if (overallResult) {\n-    info('PullApprove verification succeeded!');\n-  } else {\n-    info(`PullApprove verification failed.`);\n-    info();\n-    info(`Please update '.pullapprove.yml' to ensure that all necessary`);\n-    info(`files/directories have owners and all patterns that appear in`);\n-    info(`the file correspond to actual files/directories in the repo.`);\n-  }\n-  /** Reviewers check */\n-  logHeader(`Group Reviewers Check`);\n-  if (groupsWithoutReviewers.length === 0) {\n-    info('All group contain at least one reviewer user or team.');\n-  } else {\n-    info.group(`Discovered ${groupsWithoutReviewers.length} group(s) without a reviewer defined`);\n-    groupsWithoutReviewers.forEach(g => info(g.groupName));\n-    info.groupEnd();\n-  }\n-  /**\n-   * File by file Summary\n-   */\n-  logHeader('PullApprove results by file');\n-  info.group(`Matched Files (${matchedFiles.length} files)`);\n-  matchedFiles.forEach(file => debug(file));\n-  info.groupEnd();\n-  info.group(`Unmatched Files (${unmatchedFiles.length} files)`);\n-  unmatchedFiles.forEach(file => info(file));\n-  info.groupEnd();\n-  /**\n-   * Group by group Summary\n-   */\n-  logHeader('PullApprove results by group');\n-  info.group(`Groups skipped (${groupsSkipped.length} groups)`);\n-  groupsSkipped.forEach(group => debug(`${group.groupName}`));\n-  info.groupEnd();\n-  const matchedGroups = resultsByGroup.filter(group => !group.unmatchedCount);\n-  info.group(`Matched conditions by Group (${matchedGroups.length} groups)`);\n-  matchedGroups.forEach(group => logGroup(group, 'matchedConditions', debug));\n-  info.groupEnd();\n-  const unmatchedGroups = resultsByGroup.filter(group => group.unmatchedCount);\n-  info.group(`Unmatched conditions by Group (${unmatchedGroups.length} groups)`);\n-  unmatchedGroups.forEach(group => logGroup(group, 'unmatchedConditions'));\n-  info.groupEnd();\n-  const unverifiableConditionsInGroups =\n-      resultsByGroup.filter(group => group.unverifiableConditions.length > 0);\n-  info.group(`Unverifiable conditions by Group (${unverifiableConditionsInGroups.length} groups)`);\n-  unverifiableConditionsInGroups.forEach(group => logGroup(group, 'unverifiableConditions'));\n-  info.groupEnd();\n-\n-  // Provide correct exit code based on verification success.\n-  process.exit(overallResult ? 0 : 1);\n-}"
        },
        {
            "sha": "54b73c76a12b8901c21c94165471a844ebde35a3",
            "filename": "dev-infra/release/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,22 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"release\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/build\",\n-        \"//dev-infra/release/info\",\n-        \"//dev-infra/release/notes\",\n-        \"//dev-infra/release/publish\",\n-        \"//dev-infra/release/set-dist-tag\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//semver\",\n-        \"@npm//yargs\",\n-    ],\n-)"
        },
        {
            "sha": "de0198f8b45903dc784bbdfecfbff4ad783e4271",
            "filename": "dev-infra/release/build/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,40 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-exports_files([\n-    \"build-worker.ts\",\n-])\n-\n-ts_library(\n-    name = \"build\",\n-    srcs = glob(\n-        [\n-            \"**/*.ts\",\n-        ],\n-        exclude = [\"*.spec.ts\"],\n-    ),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    srcs = glob([\n-        \"*.spec.ts\",\n-    ]),\n-    deps = [\n-        \":build\",\n-        \"//dev-infra/release/config\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    deps = [\":test_lib\"],\n-)"
        },
        {
            "sha": "97d7a9bcecb57956bbe0fc1a259e612d988838c1",
            "filename": "dev-infra/release/build/build-worker.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fbuild-worker.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fbuild-worker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2Fbuild-worker.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/*\n- * This file will be spawned as a separate process when the `ng-dev release build` command is\n- * invoked. A separate process allows us to hide any superfluous stdout output from arbitrary\n- * build commands that we cannot control. This is necessary as the `ng-dev release build` command\n- * supports stdout JSON output that should be parsable and not polluted from other stdout messages.\n- */\n-\n-import {getReleaseConfig} from '../config/index';\n-\n-// Start the release package building.\n-main(process.argv[2] === 'true');\n-\n-/** Main function for building the release packages. */\n-async function main(stampForRelease: boolean) {\n-  if (process.send === undefined) {\n-    throw Error('This script needs to be invoked as a NodeJS worker.');\n-  }\n-\n-  const config = getReleaseConfig();\n-  const builtPackages = await config.buildPackages(stampForRelease);\n-\n-  // Transfer the built packages back to the parent process.\n-  process.send(builtPackages);\n-}"
        },
        {
            "sha": "1853a665386b060343d31b26dc12f994ac46c178",
            "filename": "dev-infra/release/build/build.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 77,
            "changes": 77,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,77 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as releaseConfig from '../config/index';\n-import {ReleaseBuildCommandModule} from './cli';\n-import * as index from './index';\n-\n-describe('ng-dev release build', () => {\n-  let npmPackages: string[];\n-  let buildPackages: jasmine.Spy;\n-\n-  beforeEach(() => {\n-    npmPackages = ['@angular/pkg1', '@angular/pkg2'];\n-    buildPackages = jasmine.createSpy('buildPackages').and.resolveTo([\n-      {name: '@angular/pkg1', outputPath: 'dist/pkg1'},\n-      {name: '@angular/pkg2', outputPath: 'dist/pkg2'},\n-    ]);\n-\n-    // We cannot test the worker process, so we fake the worker function and\n-    // directly call the package build function.\n-    spyOn(index, 'buildReleaseOutput').and.callFake(() => buildPackages());\n-    // We need to stub out the `process.exit` function during tests as the CLI\n-    // handler calls those in case of failures.\n-    spyOn(process, 'exit');\n-  });\n-\n-  /** Invokes the build command handler. */\n-  async function invokeBuild({json}: {json?: boolean} = {}) {\n-    spyOn(releaseConfig, 'getReleaseConfig')\n-        .and.returnValue({npmPackages, buildPackages, releaseNotes: {}});\n-    await ReleaseBuildCommandModule.handler({json: !!json, stampForRelease: true, $0: '', _: []});\n-  }\n-\n-  it('should invoke configured build packages function', async () => {\n-    await invokeBuild();\n-    expect(buildPackages).toHaveBeenCalledTimes(1);\n-    expect(process.exit).toHaveBeenCalledTimes(0);\n-  });\n-\n-  it('should print built packages as JSON if `--json` is specified', async () => {\n-    const writeSpy = spyOn(process.stdout, 'write');\n-    await invokeBuild({json: true});\n-\n-    expect(buildPackages).toHaveBeenCalledTimes(1);\n-    expect(writeSpy).toHaveBeenCalledTimes(1);\n-\n-    const jsonText = writeSpy.calls.mostRecent().args[0] as string;\n-    const parsed = JSON.parse(jsonText) as releaseConfig.BuiltPackage[];\n-\n-    expect(parsed).toEqual([\n-      {name: '@angular/pkg1', outputPath: 'dist/pkg1'},\n-      {name: '@angular/pkg2', outputPath: 'dist/pkg2'}\n-    ]);\n-    expect(process.exit).toHaveBeenCalledTimes(0);\n-  });\n-\n-  it('should error if package has not been built', async () => {\n-    // Set up an NPM package that is not built.\n-    npmPackages.push('@angular/non-existent');\n-\n-    spyOn(console, 'error');\n-    await invokeBuild();\n-\n-    expect(console.error).toHaveBeenCalledTimes(2);\n-    expect(console.error)\n-        .toHaveBeenCalledWith(\n-            jasmine.stringMatching(`Release output missing for the following packages`));\n-    expect(console.error).toHaveBeenCalledWith(jasmine.stringMatching(`- @angular/non-existent`));\n-    expect(process.exit).toHaveBeenCalledTimes(1);\n-    expect(process.exit).toHaveBeenCalledWith(1);\n-  });\n-});"
        },
        {
            "sha": "6125dad1a9eb340ebe5126f55d580b95142c76ab",
            "filename": "dev-infra/release/build/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 75,
            "changes": 75,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,75 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {getConfig} from '../../utils/config';\n-import {error, green, info, red, warn, yellow} from '../../utils/console';\n-import {BuiltPackage, getReleaseConfig} from '../config/index';\n-\n-import {buildReleaseOutput} from './index';\n-\n-/** Command line options for building a release. */\n-export interface ReleaseBuildOptions {\n-  json: boolean;\n-}\n-\n-/** Yargs command builder for configuring the `ng-dev release build` command. */\n-function builder(argv: Argv): Argv<ReleaseBuildOptions> {\n-  return argv.option('json', {\n-    type: 'boolean',\n-    description: 'Whether the built packages should be printed to stdout as JSON.',\n-    default: false,\n-  });\n-}\n-\n-/** Yargs command handler for building a release. */\n-async function handler(args: Arguments<ReleaseBuildOptions>) {\n-  const {npmPackages} = getReleaseConfig();\n-  let builtPackages = await buildReleaseOutput(true);\n-\n-  // If package building failed, print an error and exit with an error code.\n-  if (builtPackages === null) {\n-    error(red(`  ✘   Could not build release output. Please check output above.`));\n-    process.exit(1);\n-  }\n-\n-  // If no packages have been built, we assume that this is never correct\n-  // and exit with an error code.\n-  if (builtPackages.length === 0) {\n-    error(red(`  ✘   No release packages have been built. Please ensure that the`));\n-    error(red(`      build script is configured correctly in \".ng-dev\".`));\n-    process.exit(1);\n-  }\n-\n-  const missingPackages =\n-      npmPackages.filter(pkgName => !builtPackages!.find(b => b.name === pkgName));\n-\n-  // Check for configured release packages which have not been built. We want to\n-  // error and exit if any configured package has not been built.\n-  if (missingPackages.length > 0) {\n-    error(red(`  ✘   Release output missing for the following packages:`));\n-    missingPackages.forEach(pkgName => error(red(`      - ${pkgName}`)));\n-    process.exit(1);\n-  }\n-\n-  if (args.json) {\n-    process.stdout.write(JSON.stringify(builtPackages, null, 2));\n-  } else {\n-    info(green('  ✓   Built release packages.'));\n-    builtPackages.forEach(({name}) => info(green(`      - ${name}`)));\n-  }\n-}\n-\n-/** CLI command module for building release output. */\n-export const ReleaseBuildCommandModule: CommandModule<{}, ReleaseBuildOptions> = {\n-  builder,\n-  handler,\n-  command: 'build',\n-  describe: 'Builds the release output for the current branch.',\n-};"
        },
        {
            "sha": "97bf1c38475e245efb488c6c648894756931671b",
            "filename": "dev-infra/release/build/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 37,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,37 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {fork} from 'child_process';\n-import {BuiltPackage} from '../config/index';\n-\n-/**\n- * Builds the release output without polluting the process stdout. Build scripts commonly\n- * print messages to stderr or stdout. This is fine in most cases, but sometimes other tooling\n- * reserves stdout for data transfer (e.g. when `ng release build --json` is invoked). To not\n- * pollute the stdout in such cases, we launch a child process for building the release packages\n- * and redirect all stdout output to the stderr channel (which can be read in the terminal).\n- */\n-export async function buildReleaseOutput(stampForRelease: boolean = false):\n-    Promise<BuiltPackage[]|null> {\n-  return new Promise(resolve => {\n-    const buildProcess = fork(require.resolve('./build-worker'), [`${stampForRelease}`], {\n-      // The stdio option is set to redirect any \"stdout\" output directly to the \"stderr\" file\n-      // descriptor. An additional \"ipc\" file descriptor is created to support communication with\n-      // the build process. https://nodejs.org/api/child_process.html#child_process_options_stdio.\n-      stdio: ['inherit', 2, 2, 'ipc'],\n-    });\n-    let builtPackages: BuiltPackage[]|null = null;\n-\n-    // The child process will pass the `buildPackages()` output through the\n-    // IPC channel. We keep track of it so that we can use it as resolve value.\n-    buildProcess.on('message', buildResponse => builtPackages = buildResponse);\n-\n-    // On child process exit, resolve the promise with the received output.\n-    buildProcess.on('exit', () => resolve(builtPackages));\n-  });\n-}"
        },
        {
            "sha": "7bcffa031231478ec423c85c6b28663095493fc6",
            "filename": "dev-infra/release/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import * as yargs from 'yargs';\n-\n-import {ReleaseBuildCommandModule} from './build/cli';\n-import {ReleaseInfoCommandModule} from './info/cli';\n-import {ReleaseNotesCommandModule} from './notes/cli';\n-import {ReleasePublishCommandModule} from './publish/cli';\n-import {ReleaseSetDistTagCommand} from './set-dist-tag/cli';\n-import {BuildEnvStampCommand} from './stamping/cli';\n-\n-/** Build the parser for the release commands. */\n-export function buildReleaseParser(localYargs: yargs.Argv) {\n-  return localYargs.help()\n-      .strict()\n-      .demandCommand()\n-      .command(ReleasePublishCommandModule)\n-      .command(ReleaseBuildCommandModule)\n-      .command(ReleaseInfoCommandModule)\n-      .command(ReleaseSetDistTagCommand)\n-      .command(BuildEnvStampCommand)\n-      .command(ReleaseNotesCommandModule);\n-}"
        },
        {
            "sha": "c8170c2acab4a47a77c077b694cfad8c1aa246e5",
            "filename": "dev-infra/release/config/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"config\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/semver\",\n-    ],\n-)"
        },
        {
            "sha": "2f4bd12e46acbe91bc8a0b6a01c7932c13da5a68",
            "filename": "dev-infra/release/config/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 72,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fconfig%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fconfig%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fconfig%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,72 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {assertNoErrors, getConfig, NgDevConfig} from '../../utils/config';\n-\n-/** Interface describing a built package. */\n-export interface BuiltPackage {\n-  /** Name of the package. */\n-  name: string;\n-  /** Path to the package output directory. */\n-  outputPath: string;\n-}\n-\n-/** Configuration for staging and publishing a release. */\n-export interface ReleaseConfig {\n-  /** Registry URL used for publishing release packages. Defaults to the NPM registry. */\n-  publishRegistry?: string;\n-  /** List of NPM packages that are published as part of this project. */\n-  npmPackages: string[];\n-  /** Builds release packages and returns a list of paths pointing to the output. */\n-  buildPackages: (stampForRelease?: boolean) => Promise<BuiltPackage[]|null>;\n-  /** The list of github labels to add to the release PRs. */\n-  releasePrLabels?: string[];\n-  /** Configuration for creating release notes during publishing. */\n-  releaseNotes: ReleaseNotesConfig;\n-}\n-\n-/** Configuration for creating release notes during publishing. */\n-export interface ReleaseNotesConfig {\n-  /** Whether to prompt for and include a release title in the generated release notes. */\n-  useReleaseTitle?: boolean;\n-  /** List of commit scopes to disclude from generated release notes. */\n-  hiddenScopes?: string[];\n-  /**\n-   * List of commit groups, either {npmScope}/{scope} or {scope}, to use for ordering.\n-   *\n-   * Each group for the release notes, will appear in the order provided in groupOrder and any other\n-   * groups will appear after these groups, sorted by `Array.sort`'s default sorting order.\n-   */\n-  groupOrder?: string[];\n-}\n-\n-/** Configuration for releases in the dev-infra configuration. */\n-export type DevInfraReleaseConfig = NgDevConfig<{release: ReleaseConfig}>;\n-\n-/** Retrieve and validate the config as `ReleaseConfig`. */\n-export function getReleaseConfig(config: Partial<DevInfraReleaseConfig> = getConfig()):\n-    ReleaseConfig {\n-  // List of errors encountered validating the config.\n-  const errors: string[] = [];\n-\n-  if (config.release === undefined) {\n-    errors.push(`No configuration defined for \"release\"`);\n-  }\n-  if (config.release?.npmPackages === undefined) {\n-    errors.push(`No \"npmPackages\" configured for releasing.`);\n-  }\n-  if (config.release?.buildPackages === undefined) {\n-    errors.push(`No \"buildPackages\" function configured for releasing.`);\n-  }\n-  if (config.release?.releaseNotes === undefined) {\n-    errors.push(`No \"releaseNotes\" configured for releasing.`);\n-  }\n-\n-  assertNoErrors(errors);\n-  return config.release!;\n-}"
        },
        {
            "sha": "62b6cdf6fa4887b71a3e7e7a0890099ecebdb9a1",
            "filename": "dev-infra/release/info/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Finfo%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Finfo%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Finfo%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,14 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"info\",\n-    srcs = [\"cli.ts\"],\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)"
        },
        {
            "sha": "966f4d0c25f0aefaad3b3dc5d7c93b9e58972648",
            "filename": "dev-infra/release/info/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Finfo%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Finfo%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Finfo%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {CommandModule} from 'yargs';\n-\n-import {info} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-import {getReleaseConfig} from '../config/index';\n-import {fetchActiveReleaseTrains} from '../versioning/active-release-trains';\n-import {printActiveReleaseTrains} from '../versioning/print-active-trains';\n-\n-/** Yargs command handler for printing release information. */\n-async function handler() {\n-  const git = GitClient.get();\n-  const gitRepoWithApi = {api: git.github, ...git.remoteConfig};\n-  const releaseTrains = await fetchActiveReleaseTrains(gitRepoWithApi);\n-\n-  // Print the active release trains.\n-  await printActiveReleaseTrains(releaseTrains, getReleaseConfig());\n-}\n-\n-/** CLI command module for retrieving release information. */\n-export const ReleaseInfoCommandModule: CommandModule = {\n-  handler,\n-  command: 'info',\n-  describe: 'Prints active release trains to the console.',\n-};"
        },
        {
            "sha": "7fabae8cc6bef1419897931a681b8e0bc92f7456",
            "filename": "dev-infra/release/notes/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"notes\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/ejs\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//ejs\",\n-        \"@npm//semver\",\n-    ],\n-)"
        },
        {
            "sha": "5f6e5217abfbe2fb496c38c07ebcbc2b08e9648a",
            "filename": "dev-infra/release/notes/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 84,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,84 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {writeFileSync} from 'fs';\n-import {join} from 'path';\n-import {SemVer} from 'semver';\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {info} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-\n-import {ReleaseNotes} from './release-notes';\n-\n-/** Command line options for building a release. */\n-export interface ReleaseNotesOptions {\n-  from?: string;\n-  to: string;\n-  outFile?: string;\n-  releaseVersion: SemVer;\n-  type: 'github-release'|'changelog';\n-}\n-\n-/** Yargs command builder for configuring the `ng-dev release build` command. */\n-function builder(argv: Argv): Argv<ReleaseNotesOptions> {\n-  return argv\n-      .option(\n-          'releaseVersion',\n-          {type: 'string', default: '0.0.0', coerce: (version: string) => new SemVer(version)})\n-      .option('from', {\n-        type: 'string',\n-        description: 'The git tag or ref to start the changelog entry from',\n-        defaultDescription: 'The latest semver tag',\n-      })\n-      .option('to', {\n-        type: 'string',\n-        description: 'The git tag or ref to end the changelog entry with',\n-        default: 'HEAD',\n-      })\n-      .option('type', {\n-        type: 'string',\n-        description: 'The type of release notes to create',\n-        choices: ['github-release', 'changelog'] as const,\n-        default: 'changelog' as const,\n-      })\n-      .option('outFile', {\n-        type: 'string',\n-        description: 'File location to write the generated release notes to',\n-        coerce: (filePath?: string) => filePath ? join(process.cwd(), filePath) : undefined\n-      });\n-}\n-\n-/** Yargs command handler for generating release notes. */\n-async function handler({releaseVersion, from, to, outFile, type}: Arguments<ReleaseNotesOptions>) {\n-  // Since `yargs` evaluates defaults even if a value as been provided, if no value is provided to\n-  // the handler, the latest semver tag on the branch is used.\n-  from = from || GitClient.get().getLatestSemverTag().format();\n-  /** The ReleaseNotes instance to generate release notes. */\n-  const releaseNotes = await ReleaseNotes.fromRange(releaseVersion, from, to);\n-\n-  /** The requested release notes entry. */\n-  const releaseNotesEntry = await (\n-      type === 'changelog' ? releaseNotes.getChangelogEntry() :\n-                             releaseNotes.getGithubReleaseEntry());\n-\n-  if (outFile) {\n-    writeFileSync(outFile, releaseNotesEntry);\n-    info(`Generated release notes for \"${releaseVersion}\" written to ${outFile}`);\n-  } else {\n-    process.stdout.write(releaseNotesEntry);\n-  }\n-}\n-\n-/** CLI command module for generating release notes. */\n-export const ReleaseNotesCommandModule: CommandModule<{}, ReleaseNotesOptions> = {\n-  builder,\n-  handler,\n-  command: 'notes',\n-  describe: 'Generate release notes',\n-};"
        },
        {
            "sha": "c1c4093904cfb346a9b40ea418920956351e01a9",
            "filename": "dev-infra/release/notes/context.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 178,
            "changes": 178,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Fcontext.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,178 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {COMMIT_TYPES, ReleaseNotesLevel} from '../../commit-message/config';\n-import {CommitFromGitLog} from '../../commit-message/parse';\n-import {GithubConfig} from '../../utils/config';\n-import {ReleaseNotesConfig} from '../config/index';\n-\n-\n-/** List of types to be included in the release notes. */\n-const typesToIncludeInReleaseNotes =\n-    Object.values(COMMIT_TYPES)\n-        .filter(type => type.releaseNotesLevel === ReleaseNotesLevel.Visible)\n-        .map(type => type.name);\n-\n-/** Data used for context during rendering. */\n-export interface RenderContextData {\n-  title: string|false;\n-  groupOrder?: ReleaseNotesConfig['groupOrder'];\n-  hiddenScopes?: ReleaseNotesConfig['hiddenScopes'];\n-  date?: Date;\n-  commits: CommitFromGitLog[];\n-  version: string;\n-  github: GithubConfig;\n-}\n-\n-/** Context class used for rendering release notes. */\n-export class RenderContext {\n-  /** An array of group names in sort order if defined. */\n-  private readonly groupOrder = this.data.groupOrder || [];\n-  /** An array of scopes to hide from the release entry output. */\n-  private readonly hiddenScopes = this.data.hiddenScopes || [];\n-  /** The title of the release, or `false` if no title should be used. */\n-  readonly title = this.data.title;\n-  /** An array of commits in the release period. */\n-  readonly commits = this.data.commits;\n-  /** The version of the release. */\n-  readonly version = this.data.version;\n-  /** The date stamp string for use in the release notes entry. */\n-  readonly dateStamp = buildDateStamp(this.data.date);\n-\n-  constructor(private readonly data: RenderContextData) {}\n-\n-  /**\n-   * Organizes and sorts the commits into groups of commits.\n-   *\n-   * Groups are sorted either by default `Array.sort` order, or using the provided group order from\n-   * the configuration. Commits are order in the same order within each groups commit list as they\n-   * appear in the provided list of commits.\n-   * */\n-  asCommitGroups(commits: CommitFromGitLog[]) {\n-    /** The discovered groups to organize into. */\n-    const groups = new Map<string, CommitFromGitLog[]>();\n-\n-    // Place each commit in the list into its group.\n-    commits.forEach(commit => {\n-      const key = commit.npmScope ? `${commit.npmScope}/${commit.scope}` : commit.scope;\n-      const groupCommits = groups.get(key) || [];\n-      groups.set(key, groupCommits);\n-      groupCommits.push(commit);\n-    });\n-\n-    /**\n-     * Array of CommitGroups containing the discovered commit groups. Sorted in alphanumeric order\n-     * of the group title.\n-     */\n-    const commitGroups = Array.from(groups.entries())\n-                             .map(([title, commits]) => ({title, commits}))\n-                             .sort((a, b) => a.title > b.title ? 1 : a.title < b.title ? -1 : 0);\n-\n-    // If the configuration provides a sorting order, updated the sorted list of group keys to\n-    // satisfy the order of the groups provided in the list with any groups not found in the list at\n-    // the end of the sorted list.\n-    if (this.groupOrder.length) {\n-      for (const groupTitle of this.groupOrder.reverse()) {\n-        const currentIdx = commitGroups.findIndex(k => k.title === groupTitle);\n-        if (currentIdx !== -1) {\n-          const removedGroups = commitGroups.splice(currentIdx, 1);\n-          commitGroups.splice(0, 0, ...removedGroups);\n-        }\n-      }\n-    }\n-    return commitGroups;\n-  }\n-\n-  /**\n-   * A filter function for filtering a list of commits to only include commits which should appear\n-   * in release notes.\n-   */\n-  includeInReleaseNotes() {\n-    return (commit: CommitFromGitLog) => {\n-      if (!typesToIncludeInReleaseNotes.includes(commit.type)) {\n-        return false;\n-      }\n-\n-      if (this.hiddenScopes.includes(commit.scope)) {\n-        return false;\n-      }\n-      return true;\n-    };\n-  }\n-\n-  /**\n-   * A filter function for filtering a list of commits to only include commits which contain a\n-   * truthy value, or for arrays an array with 1 or more elements, for the provided field.\n-   */\n-  contains(field: keyof CommitFromGitLog) {\n-    return (commit: CommitFromGitLog) => {\n-      const fieldValue = commit[field];\n-      if (!fieldValue) {\n-        return false;\n-      }\n-\n-      if (Array.isArray(fieldValue) && fieldValue.length === 0) {\n-        return false;\n-      }\n-      return true;\n-    };\n-  }\n-\n-  /**\n-   * A filter function for filtering a list of commits to only include commits which contain a\n-   * unique value for the provided field across all commits in the list.\n-   */\n-  unique(field: keyof CommitFromGitLog) {\n-    const set = new Set<CommitFromGitLog[typeof field]>();\n-    return (commit: CommitFromGitLog) => {\n-      const include = !set.has(commit[field]);\n-      set.add(commit[field]);\n-      return include;\n-    };\n-  }\n-\n-  /**\n-   * Convert a commit object to a Markdown link.\n-   */\n-  commitToLink(commit: CommitFromGitLog): string {\n-    const url = `https://github.com/${this.data.github.owner}/${this.data.github.name}/commit/${\n-        commit.hash}`;\n-    return `[${commit.shortHash}](${url})`;\n-  }\n-\n-  /**\n-   * Convert a pull request number to a Markdown link.\n-   */\n-  pullRequestToLink(prNumber: number): string {\n-    const url =\n-        `https://github.com/${this.data.github.owner}/${this.data.github.name}/pull/${prNumber}`;\n-    return `[#${prNumber}](${url})`;\n-  }\n-\n-  /**\n-   * Transform a commit message header by replacing the parenthesized pull request reference at the\n-   * end of the line (which is added by merge tooling) to a Markdown link.\n-   */\n-  replaceCommitHeaderPullRequestNumber(header: string): string {\n-    return header.replace(/\\(#(\\d+)\\)$/, (_, g) => `(${this.pullRequestToLink(+g)})`);\n-  }\n-}\n-\n-\n-/**\n- * Builds a date stamp for stamping in release notes.\n- *\n- * Uses the current date, or a provided date in the format of YYYY-MM-DD, i.e. 1970-11-05.\n- */\n-export function buildDateStamp(date = new Date()) {\n-  const year = `${date.getFullYear()}`;\n-  const month = `${(date.getMonth() + 1)}`.padStart(2, '0');\n-  const day = `${date.getDate()}`.padStart(2, '0');\n-\n-  return [year, month, day].join('-');\n-}"
        },
        {
            "sha": "74b46db024e8a4891d3bedb8babdab657e1bc57c",
            "filename": "dev-infra/release/notes/release-notes.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 92,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Frelease-notes.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Frelease-notes.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Frelease-notes.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,92 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {render} from 'ejs';\n-import * as semver from 'semver';\n-import {CommitFromGitLog} from '../../commit-message/parse';\n-\n-import {getCommitsInRange} from '../../commit-message/utils';\n-import {promptInput} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-import {DevInfraReleaseConfig, getReleaseConfig, ReleaseNotesConfig} from '../config/index';\n-import {RenderContext} from './context';\n-\n-import changelogTemplate from './templates/changelog';\n-import githubReleaseTemplate from './templates/github-release';\n-\n-/** Release note generation. */\n-export class ReleaseNotes {\n-  static async fromRange(version: semver.SemVer, startingRef: string, endingRef: string) {\n-    return new ReleaseNotes(version, startingRef, endingRef);\n-  }\n-\n-  /** An instance of GitClient. */\n-  private git = GitClient.get();\n-  /** The RenderContext to be used during rendering. */\n-  private renderContext: RenderContext|undefined;\n-  /** The title to use for the release. */\n-  private title: string|false|undefined;\n-  /** A promise resolving to a list of Commits since the latest semver tag on the branch. */\n-  private commits: Promise<CommitFromGitLog[]> =\n-      this.getCommitsInRange(this.startingRef, this.endingRef);\n-  /** The configuration for release notes. */\n-  private config: ReleaseNotesConfig = this.getReleaseConfig().releaseNotes;\n-\n-  protected constructor(\n-      public version: semver.SemVer, private startingRef: string, private endingRef: string) {}\n-\n-  /** Retrieve the release note generated for a Github Release. */\n-  async getGithubReleaseEntry(): Promise<string> {\n-    return render(githubReleaseTemplate, await this.generateRenderContext(), {rmWhitespace: true});\n-  }\n-\n-  /** Retrieve the release note generated for a CHANGELOG entry. */\n-  async getChangelogEntry() {\n-    return render(changelogTemplate, await this.generateRenderContext(), {rmWhitespace: true});\n-  }\n-\n-  /**\n-   * Prompt the user for a title for the release, if the project's configuration is defined to use a\n-   * title.\n-   */\n-  async promptForReleaseTitle() {\n-    if (this.title === undefined) {\n-      if (this.config.useReleaseTitle) {\n-        this.title = await promptInput('Please provide a title for the release:');\n-      } else {\n-        this.title = false;\n-      }\n-    }\n-    return this.title;\n-  }\n-\n-  /** Build the render context data object for constructing the RenderContext instance. */\n-  private async generateRenderContext(): Promise<RenderContext> {\n-    if (!this.renderContext) {\n-      this.renderContext = new RenderContext({\n-        commits: await this.commits,\n-        github: this.git.remoteConfig,\n-        version: this.version.format(),\n-        groupOrder: this.config.groupOrder,\n-        hiddenScopes: this.config.hiddenScopes,\n-        title: await this.promptForReleaseTitle(),\n-      });\n-    }\n-    return this.renderContext;\n-  }\n-\n-\n-  // These methods are used for access to the utility functions while allowing them to be\n-  // overwritten in subclasses during testing.\n-  protected async getCommitsInRange(from: string, to?: string) {\n-    return getCommitsInRange(from, to);\n-  }\n-\n-  protected getReleaseConfig(config?: Partial<DevInfraReleaseConfig>) {\n-    return getReleaseConfig(config);\n-  }\n-}"
        },
        {
            "sha": "462c3ac331fc07a1f637c5cc190126fecbc80181",
            "filename": "dev-infra/release/notes/templates/changelog.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 92,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,92 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export default `\n-<a name=\"<%- version %>\"></a>\n-# <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n-\n-<%_\n-const commitsInChangelog = commits.filter(includeInReleaseNotes());\n-for (const group of asCommitGroups(commitsInChangelog)) {\n-_%>\n-\n-### <%- group.title %>\n-| Commit | Description |\n-| -- | -- |\n-<%_\n-  for (const commit of group.commits) {\n-_%>\n-| <%- commitToLink(commit) %> | <%- replaceCommitHeaderPullRequestNumber(commit.header) %> |\n-<%_\n-  }\n-}\n-_%>\n-\n-<%_\n-const breakingChanges = commits.filter(contains('breakingChanges'));\n-if (breakingChanges.length) {\n-_%>\n-## Breaking Changes\n-\n-<%_\n-  for (const group of asCommitGroups(breakingChanges)) {\n-_%>\n-### <%- group.title %>\n-\n-<%_\n-    for (const commit of group.commits) {\n-_%>\n-<%- commit.breakingChanges[0].text %>\n-\n-<%_\n-    }\n-  }\n-}\n-_%>\n-\n-<%_\n-const deprecations = commits.filter(contains('deprecations'));\n-if (deprecations.length) {\n-_%>\n-## Deprecations\n-<%_\n-  for (const group of asCommitGroups(deprecations)) {\n-_%>\n-### <%- group.title %>\n-\n-<%_\n-    for (const commit of group.commits) {\n-_%>\n-<%- commit.deprecations[0].text %>\n-<%_\n-    }\n-  }\n-}\n-_%>\n-\n-<%_\n-const botsAuthorName = ['dependabot[bot]', 'Renovate Bot'];\n-const authors = commits\n-  .filter(unique('author'))\n-  .map(c => c.author)\n-  .filter(a => !botsAuthorName.includes(a))\n-  .sort();\n-if (authors.length === 1) {\n-_%>\n-## Special Thanks:\n-<%- authors[0]%>\n-<%_\n-}\n-if (authors.length > 1) {\n-_%>\n-## Special Thanks:\n-<%- authors.slice(0, -1).join(', ') %> and <%- authors.slice(-1)[0] %>\n-<%_\n-}\n-_%>\n-`;"
        },
        {
            "sha": "8b96d62531e357acb31a578087a36f4255b05720",
            "filename": "dev-infra/release/notes/templates/github-release.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fgithub-release.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fgithub-release.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fgithub-release.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,87 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export default `\n-<a name=\"<%- version %>\"></a>\n-# <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n-\n-<%_\n-const commitsInChangelog = commits.filter(includeInReleaseNotes());\n-for (const group of asCommitGroups(commitsInChangelog)) {\n-_%>\n-\n-### <%- group.title %>\n-| Commit | Description |\n-| -- | -- |\n-<%_\n-  for (const commit of group.commits) {\n-_%>\n-| <%- commit.shortHash %> | <%- commit.header %> |\n-<%_\n-  }\n-}\n-_%>\n-\n-<%_\n-const breakingChanges = commits.filter(contains('breakingChanges'));\n-if (breakingChanges.length) {\n-_%>\n-## Breaking Changes\n-\n-<%_\n-  for (const group of asCommitGroups(breakingChanges)) {\n-_%>\n-### <%- group.title %>\n-\n-<%_\n-    for (const commit of group.commits) {\n-_%>\n-<%- commit.breakingChanges[0].text %>\n-\n-<%_\n-    }\n-  }\n-}\n-_%>\n-\n-<%_\n-const deprecations = commits.filter(contains('deprecations'));\n-if (deprecations.length) {\n-_%>\n-## Deprecations\n-<%_\n-  for (const group of asCommitGroups(deprecations)) {\n-_%>\n-### <%- group.title %>\n-\n-<%_\n-    for (const commit of group.commits) {\n-_%>\n-<%- commit.deprecations[0].text %>\n-<%_\n-    }\n-  }\n-}\n-_%>\n-\n-<%_\n-const authors = commits.filter(unique('author')).map(c => c.author).sort();\n-if (authors.length === 1) {\n-_%>\n-## Special Thanks:\n-<%- authors[0]%>\n-<%_\n-}\n-if (authors.length > 1) {\n-_%>\n-## Special Thanks:\n-<%- authors.slice(0, -1).join(', ') %> and <%- authors.slice(-1)[0] %>\n-<%_\n-}\n-_%>\n-`;"
        },
        {
            "sha": "ec03dfbdf7b2c6c445b69b3896b3504aca836c33",
            "filename": "dev-infra/release/publish/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"publish\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/pr/merge\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/notes\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@octokit/rest\",\n-        \"@npm//@types/ejs\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//ejs\",\n-        \"@npm//inquirer\",\n-        \"@npm//ora\",\n-        \"@npm//semver\",\n-        \"@npm//typed-graphqlify\",\n-    ],\n-)"
        },
        {
            "sha": "517b7bcf47d6af7af6e77c70eb924e3477c0790b",
            "filename": "dev-infra/release/publish/actions-error.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions-error.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions-error.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions-error.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,29 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** Error that will be thrown if the user manually aborted a release action. */\n-export class UserAbortedReleaseActionError extends Error {\n-  constructor() {\n-    super();\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-    // a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, UserAbortedReleaseActionError.prototype);\n-  }\n-}\n-\n-/** Error that will be thrown if the action has been aborted due to a fatal error. */\n-export class FatalReleaseActionError extends Error {\n-  constructor() {\n-    super();\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-    // a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, FatalReleaseActionError.prototype);\n-  }\n-}"
        },
        {
            "sha": "68460ac0dbfb102b06062802c9119daa0c703552",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 543,
            "changes": 543,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,543 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {promises as fs} from 'fs';\n-import * as ora from 'ora';\n-import {join} from 'path';\n-import * as semver from 'semver';\n-\n-import {debug, error, green, info, promptConfirm, red, warn, yellow} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {getListCommitsInBranchUrl, getRepositoryGitUrl} from '../../utils/git/github-urls';\n-import {createExperimentalSemver} from '../../utils/semver';\n-import {BuiltPackage, ReleaseConfig} from '../config/index';\n-import {ReleaseNotes} from '../notes/release-notes';\n-import {NpmDistTag} from '../versioning';\n-import {ActiveReleaseTrains} from '../versioning/active-release-trains';\n-import {runNpmPublish} from '../versioning/npm-publish';\n-\n-import {FatalReleaseActionError, UserAbortedReleaseActionError} from './actions-error';\n-import {getCommitMessageForRelease, getReleaseNoteCherryPickCommitMessage} from './commit-message';\n-import {changelogPath, packageJsonPath, waitForPullRequestInterval} from './constants';\n-import {invokeReleaseBuildCommand, invokeYarnInstallCommand} from './external-commands';\n-import {findOwnedForksOfRepoQuery} from './graphql-queries';\n-import {getPullRequestState} from './pull-request-state';\n-\n-/** Interface describing a Github repository. */\n-export interface GithubRepo {\n-  owner: string;\n-  name: string;\n-}\n-\n-/** Interface describing a Github pull request. */\n-export interface PullRequest {\n-  /** Unique id for the pull request (i.e. the PR number). */\n-  id: number;\n-  /** URL that resolves to the pull request in Github. */\n-  url: string;\n-  /** Fork containing the head branch of this pull request. */\n-  fork: GithubRepo;\n-  /** Branch name in the fork that defines this pull request. */\n-  forkBranch: string;\n-}\n-\n-/** Constructor type for instantiating a release action */\n-export interface ReleaseActionConstructor<T extends ReleaseAction = ReleaseAction> {\n-  /** Whether the release action is currently active. */\n-  isActive(active: ActiveReleaseTrains, config: ReleaseConfig): Promise<boolean>;\n-  /** Constructs a release action. */\n-  new(...args: [ActiveReleaseTrains, AuthenticatedGitClient, ReleaseConfig, string]): T;\n-}\n-\n-/**\n- * Abstract base class for a release action. A release action is selectable by the caretaker\n- * if active, and can perform changes for releasing, such as staging a release, bumping the\n- * version, cherry-picking the changelog, branching off from master. etc.\n- */\n-export abstract class ReleaseAction {\n-  /** Whether the release action is currently active. */\n-  static isActive(_trains: ActiveReleaseTrains, _config: ReleaseConfig): Promise<boolean> {\n-    throw Error('Not implemented.');\n-  }\n-\n-  /** Gets the description for a release action. */\n-  abstract getDescription(): Promise<string>;\n-  /**\n-   * Performs the given release action.\n-   * @throws {UserAbortedReleaseActionError} When the user manually aborted the action.\n-   * @throws {FatalReleaseActionError} When the action has been aborted due to a fatal error.\n-   */\n-  abstract perform(): Promise<void>;\n-\n-  /** Cached found fork of the configured project. */\n-  private _cachedForkRepo: GithubRepo|null = null;\n-\n-  constructor(\n-      protected active: ActiveReleaseTrains, protected git: AuthenticatedGitClient,\n-      protected config: ReleaseConfig, protected projectDir: string) {}\n-\n-  /** Retrieves the version in the project top-level `package.json` file. */\n-  private async getProjectVersion() {\n-    const pkgJsonPath = join(this.projectDir, packageJsonPath);\n-    const pkgJson =\n-        JSON.parse(await fs.readFile(pkgJsonPath, 'utf8')) as {version: string, [key: string]: any};\n-    return new semver.SemVer(pkgJson.version);\n-  }\n-\n-  /** Updates the version in the project top-level `package.json` file. */\n-  protected async updateProjectVersion(newVersion: semver.SemVer) {\n-    const pkgJsonPath = join(this.projectDir, packageJsonPath);\n-    const pkgJson =\n-        JSON.parse(await fs.readFile(pkgJsonPath, 'utf8')) as {version: string, [key: string]: any};\n-    pkgJson.version = newVersion.format();\n-    // Write the `package.json` file. Note that we add a trailing new line\n-    // to avoid unnecessary diff. IDEs usually add a trailing new line.\n-    await fs.writeFile(pkgJsonPath, `${JSON.stringify(pkgJson, null, 2)}\\n`);\n-    info(green(`  ✓   Updated project version to ${pkgJson.version}`));\n-  }\n-\n-  /** Gets the most recent commit of a specified branch. */\n-  private async _getCommitOfBranch(branchName: string): Promise<string> {\n-    const {data: {commit}} =\n-        await this.git.github.repos.getBranch({...this.git.remoteParams, branch: branchName});\n-    return commit.sha;\n-  }\n-\n-  /** Verifies that the latest commit for the given branch is passing all statuses. */\n-  protected async verifyPassingGithubStatus(branchName: string) {\n-    const commitSha = await this._getCommitOfBranch(branchName);\n-    const {data: {state}} = await this.git.github.repos.getCombinedStatusForRef(\n-        {...this.git.remoteParams, ref: commitSha});\n-    const branchCommitsUrl = getListCommitsInBranchUrl(this.git, branchName);\n-\n-    if (state === 'failure') {\n-      error(\n-          red(`  ✘   Cannot stage release. Commit \"${commitSha}\" does not pass all github ` +\n-              'status checks. Please make sure this commit passes all checks before re-running.'));\n-      error(`      Please have a look at: ${branchCommitsUrl}`);\n-\n-      if (await promptConfirm('Do you want to ignore the Github status and proceed?')) {\n-        info(yellow(\n-            '  ⚠   Upstream commit is failing CI checks, but status has been forcibly ignored.'));\n-        return;\n-      }\n-      throw new UserAbortedReleaseActionError();\n-    } else if (state === 'pending') {\n-      error(\n-          red(`  ✘   Commit \"${commitSha}\" still has pending github statuses that ` +\n-              'need to succeed before staging a release.'));\n-      error(red(`      Please have a look at: ${branchCommitsUrl}`));\n-      if (await promptConfirm('Do you want to ignore the Github status and proceed?')) {\n-        info(yellow('  ⚠   Upstream commit is pending CI, but status has been forcibly ignored.'));\n-        return;\n-      }\n-      throw new UserAbortedReleaseActionError();\n-    }\n-\n-    info(green('  ✓   Upstream commit is passing all github status checks.'));\n-  }\n-\n-\n-  /**\n-   * Prompts the user for potential release notes edits that need to be made. Once\n-   * confirmed, a new commit for the release point is created.\n-   */\n-  protected async waitForEditsAndCreateReleaseCommit(newVersion: semver.SemVer) {\n-    info(yellow(\n-        '  ⚠   Please review the changelog and ensure that the log contains only changes ' +\n-        'that apply to the public API surface. Manual changes can be made. When done, please ' +\n-        'proceed with the prompt below.'));\n-\n-    if (!await promptConfirm('Do you want to proceed and commit the changes?')) {\n-      throw new UserAbortedReleaseActionError();\n-    }\n-\n-    // Commit message for the release point.\n-    const commitMessage = getCommitMessageForRelease(newVersion);\n-    // Create a release staging commit including changelog and version bump.\n-    await this.createCommit(commitMessage, [packageJsonPath, changelogPath]);\n-\n-    info(green(`  ✓   Created release commit for: \"${newVersion}\".`));\n-  }\n-\n-  /**\n-   * Gets an owned fork for the configured project of the authenticated user. Aborts the\n-   * process with an error if no fork could be found. Also caches the determined fork\n-   * repository as the authenticated user cannot change during action execution.\n-   */\n-  private async _getForkOfAuthenticatedUser(): Promise<GithubRepo> {\n-    if (this._cachedForkRepo !== null) {\n-      return this._cachedForkRepo;\n-    }\n-\n-    const {owner, name} = this.git.remoteConfig;\n-    const result = await this.git.github.graphql(findOwnedForksOfRepoQuery, {owner, name});\n-    const forks = result.repository.forks.nodes;\n-\n-    if (forks.length === 0) {\n-      error(red('  ✘   Unable to find fork for currently authenticated user.'));\n-      error(red(`      Please ensure you created a fork of: ${owner}/${name}.`));\n-      throw new FatalReleaseActionError();\n-    }\n-\n-    const fork = forks[0];\n-    return this._cachedForkRepo = {owner: fork.owner.login, name: fork.name};\n-  }\n-\n-  /** Checks whether a given branch name is reserved in the specified repository. */\n-  private async _isBranchNameReservedInRepo(repo: GithubRepo, name: string): Promise<boolean> {\n-    try {\n-      await this.git.github.repos.getBranch({owner: repo.owner, repo: repo.name, branch: name});\n-      return true;\n-    } catch (e) {\n-      // If the error has a `status` property set to `404`, then we know that the branch\n-      // does not exist. Otherwise, it might be an API error that we want to report/re-throw.\n-      if (e.status === 404) {\n-        return false;\n-      }\n-      throw e;\n-    }\n-  }\n-\n-  /** Finds a non-reserved branch name in the repository with respect to a base name. */\n-  private async _findAvailableBranchName(repo: GithubRepo, baseName: string): Promise<string> {\n-    let currentName = baseName;\n-    let suffixNum = 0;\n-    while (await this._isBranchNameReservedInRepo(repo, currentName)) {\n-      suffixNum++;\n-      currentName = `${baseName}_${suffixNum}`;\n-    }\n-    return currentName;\n-  }\n-\n-  /**\n-   * Creates a local branch from the current Git `HEAD`. Will override\n-   * existing branches in case of a collision.\n-   */\n-  protected async createLocalBranchFromHead(branchName: string) {\n-    this.git.run(['checkout', '-q', '-B', branchName]);\n-  }\n-\n-  /** Pushes the current Git `HEAD` to the given remote branch in the configured project. */\n-  protected async pushHeadToRemoteBranch(branchName: string) {\n-    // Push the local `HEAD` to the remote branch in the configured project.\n-    this.git.run(['push', '-q', this.git.getRepoGitUrl(), `HEAD:refs/heads/${branchName}`]);\n-  }\n-\n-  /**\n-   * Pushes the current Git `HEAD` to a fork for the configured project that is owned by\n-   * the authenticated user. If the specified branch name exists in the fork already, a\n-   * unique one will be generated based on the proposed name to avoid collisions.\n-   * @param proposedBranchName Proposed branch name for the fork.\n-   * @param trackLocalBranch Whether the fork branch should be tracked locally. i.e. whether\n-   *   a local branch with remote tracking should be set up.\n-   * @returns The fork and branch name containing the pushed changes.\n-   */\n-  private async _pushHeadToFork(proposedBranchName: string, trackLocalBranch: boolean):\n-      Promise<{fork: GithubRepo, branchName: string}> {\n-    const fork = await this._getForkOfAuthenticatedUser();\n-    // Compute a repository URL for pushing to the fork. Note that we want to respect\n-    // the SSH option from the dev-infra github configuration.\n-    const repoGitUrl =\n-        getRepositoryGitUrl({...fork, useSsh: this.git.remoteConfig.useSsh}, this.git.githubToken);\n-    const branchName = await this._findAvailableBranchName(fork, proposedBranchName);\n-    const pushArgs: string[] = [];\n-    // If a local branch should track the remote fork branch, create a branch matching\n-    // the remote branch. Later with the `git push`, the remote is set for the branch.\n-    if (trackLocalBranch) {\n-      await this.createLocalBranchFromHead(branchName);\n-      pushArgs.push('--set-upstream');\n-    }\n-    // Push the local `HEAD` to the remote branch in the fork.\n-    this.git.run(['push', '-q', repoGitUrl, `HEAD:refs/heads/${branchName}`, ...pushArgs]);\n-    return {fork, branchName};\n-  }\n-\n-  /**\n-   * Pushes changes to a fork for the configured project that is owned by the currently\n-   * authenticated user. A pull request is then created for the pushed changes on the\n-   * configured project that targets the specified target branch.\n-   * @returns An object describing the created pull request.\n-   */\n-  protected async pushChangesToForkAndCreatePullRequest(\n-      targetBranch: string, proposedForkBranchName: string, title: string,\n-      body?: string): Promise<PullRequest> {\n-    const repoSlug = `${this.git.remoteParams.owner}/${this.git.remoteParams.repo}`;\n-    const {fork, branchName} = await this._pushHeadToFork(proposedForkBranchName, true);\n-    const {data} = await this.git.github.pulls.create({\n-      ...this.git.remoteParams,\n-      head: `${fork.owner}:${branchName}`,\n-      base: targetBranch,\n-      body,\n-      title,\n-    });\n-\n-    // Add labels to the newly created PR if provided in the configuration.\n-    if (this.config.releasePrLabels !== undefined) {\n-      await this.git.github.issues.addLabels({\n-        ...this.git.remoteParams,\n-        issue_number: data.number,\n-        labels: this.config.releasePrLabels,\n-      });\n-    }\n-\n-    info(green(`  ✓   Created pull request #${data.number} in ${repoSlug}.`));\n-    return {\n-      id: data.number,\n-      url: data.html_url,\n-      fork,\n-      forkBranch: branchName,\n-    };\n-  }\n-\n-  /**\n-   * Waits for the given pull request to be merged. Default interval for checking the Github\n-   * API is 10 seconds (to not exceed any rate limits). If the pull request is closed without\n-   * merge, the script will abort gracefully (considering a manual user abort).\n-   */\n-  protected async waitForPullRequestToBeMerged(\n-      {id}: PullRequest, interval = waitForPullRequestInterval): Promise<void> {\n-    return new Promise((resolve, reject) => {\n-      debug(`Waiting for pull request #${id} to be merged.`);\n-\n-      const spinner = ora.call(undefined).start(`Waiting for pull request #${id} to be merged.`);\n-      const intervalId = setInterval(async () => {\n-        const prState = await getPullRequestState(this.git, id);\n-        if (prState === 'merged') {\n-          spinner.stop();\n-          info(green(`  ✓   Pull request #${id} has been merged.`));\n-          clearInterval(intervalId);\n-          resolve();\n-        } else if (prState === 'closed') {\n-          spinner.stop();\n-          warn(yellow(`  ✘   Pull request #${id} has been closed.`));\n-          clearInterval(intervalId);\n-          reject(new UserAbortedReleaseActionError());\n-        }\n-      }, interval);\n-    });\n-  }\n-\n-  /**\n-   * Prepend releases notes for a version published in a given branch to the changelog in\n-   * the current Git `HEAD`. This is useful for cherry-picking the changelog.\n-   * @returns A boolean indicating whether the release notes have been prepended.\n-   */\n-  protected async prependReleaseNotesToChangelog(releaseNotes: ReleaseNotes): Promise<void> {\n-    const localChangelogPath = join(this.projectDir, changelogPath);\n-    const localChangelog = await fs.readFile(localChangelogPath, 'utf8');\n-    const releaseNotesEntry = await releaseNotes.getChangelogEntry();\n-    await fs.writeFile(localChangelogPath, `${releaseNotesEntry}\\n\\n${localChangelog}`);\n-    info(green(`  ✓   Updated the changelog to capture changes for \"${releaseNotes.version}\".`));\n-  }\n-\n-  /** Checks out an upstream branch with a detached head. */\n-  protected async checkoutUpstreamBranch(branchName: string) {\n-    this.git.run(['fetch', '-q', this.git.getRepoGitUrl(), branchName]);\n-    this.git.run(['checkout', '-q', 'FETCH_HEAD', '--detach']);\n-  }\n-\n-  /**\n-   * Creates a commit for the specified files with the given message.\n-   * @param message Message for the created commit\n-   * @param files List of project-relative file paths to be commited.\n-   */\n-  protected async createCommit(message: string, files: string[]) {\n-    this.git.run(['commit', '-q', '--no-verify', '-m', message, ...files]);\n-  }\n-\n-\n-  /**\n-   * Stages the specified new version for the current branch and creates a\n-   * pull request that targets the given base branch.\n-   * @returns an object describing the created pull request.\n-   */\n-  protected async stageVersionForBranchAndCreatePullRequest(\n-      newVersion: semver.SemVer, pullRequestBaseBranch: string):\n-      Promise<{releaseNotes: ReleaseNotes, pullRequest: PullRequest}> {\n-    /**\n-     * The current version of the project for the branch from the root package.json. This must be\n-     * retrieved prior to updating the project version.\n-     */\n-    const currentVersion = this.git.getMatchingTagForSemver(await this.getProjectVersion());\n-    const releaseNotes = await ReleaseNotes.fromRange(newVersion, currentVersion, 'HEAD');\n-    await this.updateProjectVersion(newVersion);\n-    await this.prependReleaseNotesToChangelog(releaseNotes);\n-    await this.waitForEditsAndCreateReleaseCommit(newVersion);\n-\n-    const pullRequest = await this.pushChangesToForkAndCreatePullRequest(\n-        pullRequestBaseBranch, `release-stage-${newVersion}`,\n-        `Bump version to \"v${newVersion}\" with changelog.`);\n-\n-    info(green('  ✓   Release staging pull request has been created.'));\n-    info(yellow(`      Please ask team members to review: ${pullRequest.url}.`));\n-\n-    return {releaseNotes, pullRequest};\n-  }\n-\n-  /**\n-   * Checks out the specified target branch, verifies its CI status and stages\n-   * the specified new version in order to create a pull request.\n-   * @returns an object describing the created pull request.\n-   */\n-  protected async checkoutBranchAndStageVersion(newVersion: semver.SemVer, stagingBranch: string):\n-      Promise<{releaseNotes: ReleaseNotes, pullRequest: PullRequest}> {\n-    await this.verifyPassingGithubStatus(stagingBranch);\n-    await this.checkoutUpstreamBranch(stagingBranch);\n-    return await this.stageVersionForBranchAndCreatePullRequest(newVersion, stagingBranch);\n-  }\n-\n-  /**\n-   * Cherry-picks the release notes of a version that have been pushed to a given branch\n-   * into the `next` primary development branch. A pull request is created for this.\n-   * @returns a boolean indicating successful creation of the cherry-pick pull request.\n-   */\n-  protected async cherryPickChangelogIntoNextBranch(\n-      releaseNotes: ReleaseNotes, stagingBranch: string): Promise<boolean> {\n-    const nextBranch = this.active.next.branchName;\n-    const commitMessage = getReleaseNoteCherryPickCommitMessage(releaseNotes.version);\n-\n-    // Checkout the next branch.\n-    await this.checkoutUpstreamBranch(nextBranch);\n-\n-    await this.prependReleaseNotesToChangelog(releaseNotes);\n-\n-    // Create a changelog cherry-pick commit.\n-    await this.createCommit(commitMessage, [changelogPath]);\n-    info(green(`  ✓   Created changelog cherry-pick commit for: \"${releaseNotes.version}\".`));\n-\n-    // Create a cherry-pick pull request that should be merged by the caretaker.\n-    const pullRequest = await this.pushChangesToForkAndCreatePullRequest(\n-        nextBranch, `changelog-cherry-pick-${releaseNotes.version}`, commitMessage,\n-        `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n-            `branch (${nextBranch}).`);\n-\n-    info(green(\n-        `  ✓   Pull request for cherry-picking the changelog into \"${nextBranch}\" ` +\n-        'has been created.'));\n-    info(yellow(`      Please ask team members to review: ${pullRequest.url}.`));\n-\n-    // Wait for the Pull Request to be merged.\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-\n-    return true;\n-  }\n-\n-  /**\n-   * Creates a Github release for the specified version in the configured project.\n-   * The release is created by tagging the specified commit SHA.\n-   */\n-  private async _createGithubReleaseForVersion(\n-      releaseNotes: ReleaseNotes, versionBumpCommitSha: string, prerelease: boolean) {\n-    const tagName = releaseNotes.version.format();\n-    await this.git.github.git.createRef({\n-      ...this.git.remoteParams,\n-      ref: `refs/tags/${tagName}`,\n-      sha: versionBumpCommitSha,\n-    });\n-    info(green(`  ✓   Tagged v${releaseNotes.version} release upstream.`));\n-\n-    await this.git.github.repos.createRelease({\n-      ...this.git.remoteParams,\n-      name: `v${releaseNotes.version}`,\n-      tag_name: tagName,\n-      prerelease,\n-      body: await releaseNotes.getGithubReleaseEntry(),\n-    });\n-    info(green(`  ✓   Created v${releaseNotes.version} release in Github.`));\n-  }\n-\n-  /**\n-   * Builds and publishes the given version in the specified branch.\n-   * @param releaseNotes The release notes for the version being published.\n-   * @param publishBranch Name of the branch that contains the new version.\n-   * @param npmDistTag NPM dist tag where the version should be published to.\n-   */\n-  protected async buildAndPublish(\n-      releaseNotes: ReleaseNotes, publishBranch: string, npmDistTag: NpmDistTag) {\n-    const versionBumpCommitSha = await this._getCommitOfBranch(publishBranch);\n-\n-    if (!await this._isCommitForVersionStaging(releaseNotes.version, versionBumpCommitSha)) {\n-      error(red(`  ✘   Latest commit in \"${publishBranch}\" branch is not a staging commit.`));\n-      error(red('      Please make sure the staging pull request has been merged.'));\n-      throw new FatalReleaseActionError();\n-    }\n-\n-    // Checkout the publish branch and build the release packages.\n-    await this.checkoutUpstreamBranch(publishBranch);\n-\n-    // Install the project dependencies for the publish branch, and then build the release\n-    // packages. Note that we do not directly call the build packages function from the release\n-    // config. We only want to build and publish packages that have been configured in the given\n-    // publish branch. e.g. consider we publish patch version and a new package has been\n-    // created in the `next` branch. The new package would not be part of the patch branch,\n-    // so we cannot build and publish it.\n-    await invokeYarnInstallCommand(this.projectDir);\n-    const builtPackages = await invokeReleaseBuildCommand();\n-\n-    // Verify the packages built are the correct version.\n-    await this._verifyPackageVersions(releaseNotes.version, builtPackages);\n-\n-    // Create a Github release for the new version.\n-    await this._createGithubReleaseForVersion(\n-        releaseNotes, versionBumpCommitSha, npmDistTag === 'next');\n-\n-    // Walk through all built packages and publish them to NPM.\n-    for (const builtPackage of builtPackages) {\n-      await this._publishBuiltPackageToNpm(builtPackage, npmDistTag);\n-    }\n-\n-    info(green('  ✓   Published all packages successfully'));\n-  }\n-\n-  /** Publishes the given built package to NPM with the specified NPM dist tag. */\n-  private async _publishBuiltPackageToNpm(pkg: BuiltPackage, npmDistTag: NpmDistTag) {\n-    debug(`Starting publish of \"${pkg.name}\".`);\n-    const spinner = ora.call(undefined).start(`Publishing \"${pkg.name}\"`);\n-\n-    try {\n-      await runNpmPublish(pkg.outputPath, npmDistTag, this.config.publishRegistry);\n-      spinner.stop();\n-      info(green(`  ✓   Successfully published \"${pkg.name}.`));\n-    } catch (e) {\n-      spinner.stop();\n-      error(e);\n-      error(red(`  ✘   An error occurred while publishing \"${pkg.name}\".`));\n-      throw new FatalReleaseActionError();\n-    }\n-  }\n-\n-  /** Checks whether the given commit represents a staging commit for the specified version. */\n-  private async _isCommitForVersionStaging(version: semver.SemVer, commitSha: string) {\n-    const {data} =\n-        await this.git.github.repos.getCommit({...this.git.remoteParams, ref: commitSha});\n-    return data.commit.message.startsWith(getCommitMessageForRelease(version));\n-  }\n-\n-  /** Verify the version of each generated package exact matches the specified version. */\n-  private async _verifyPackageVersions(version: semver.SemVer, packages: BuiltPackage[]) {\n-    /** Experimental equivalent version for packages created with the provided version. */\n-    const experimentalVersion = createExperimentalSemver(version);\n-\n-    for (const pkg of packages) {\n-      const {version: packageJsonVersion} =\n-          JSON.parse(await fs.readFile(join(pkg.outputPath, 'package.json'), 'utf8')) as\n-          {version: string, [key: string]: any};\n-\n-      const mismatchesVersion = version.compare(packageJsonVersion) !== 0;\n-      const mismatchesExperimental = experimentalVersion.compare(packageJsonVersion) !== 0;\n-\n-      if (mismatchesExperimental && mismatchesVersion) {\n-        error(red('The built package version does not match the version being released.'));\n-        error(`  Release Version:   ${version.version} (${experimentalVersion.version})`);\n-        error(`  Generated Version: ${packageJsonVersion}`);\n-        throw new FatalReleaseActionError();\n-      }\n-    }\n-  }\n-}"
        },
        {
            "sha": "5b64b3a6e1dd43d77a5d8224e757b52f6481f4c1",
            "filename": "dev-infra/release/publish/actions/branch-off-next-branch.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 120,
            "changes": 120,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fbranch-off-next-branch.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fbranch-off-next-branch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fbranch-off-next-branch.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,120 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {green, info, yellow} from '../../../utils/console';\n-import {semverInc} from '../../../utils/semver';\n-import {ReleaseNotes} from '../../notes/release-notes';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {computeNewPrereleaseVersionForNext} from '../../versioning/next-prerelease-version';\n-import {ReleaseAction} from '../actions';\n-import {getCommitMessageForExceptionalNextVersionBump, getReleaseNoteCherryPickCommitMessage} from '../commit-message';\n-import {changelogPath, packageJsonPath} from '../constants';\n-\n-/**\n- * Base action that can be used to move the next release-train into the feature-freeze or\n- * release-candidate phase. This means that a new version branch is created from the next\n- * branch, and a new pre-release (either RC or another `next`) is cut indicating the new phase.\n- */\n-export abstract class BranchOffNextBranchBaseAction extends ReleaseAction {\n-  /**\n-   * Phase which the release-train currently in the `next` phase will move into.\n-   *\n-   * Note that we only allow for a next version to branch into feature-freeze or\n-   * directly into the release-candidate phase. A stable version cannot be released\n-   * without release-candidate.\n-   */\n-  abstract newPhaseName: 'feature-freeze'|'release-candidate';\n-\n-  override async getDescription() {\n-    const {branchName} = this.active.next;\n-    const newVersion = await this._computeNewVersion();\n-    return `Move the \"${branchName}\" branch into ${this.newPhaseName} phase (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const newVersion = await this._computeNewVersion();\n-    const newBranch = `${newVersion.major}.${newVersion.minor}.x`;\n-\n-    // Branch-off the next branch into a new version branch.\n-    await this._createNewVersionBranchFromNext(newBranch);\n-\n-    // Stage the new version for the newly created branch, and push changes to a\n-    // fork in order to create a staging pull request. Note that we re-use the newly\n-    // created branch instead of re-fetching from the upstream.\n-    const {pullRequest, releaseNotes} =\n-        await this.stageVersionForBranchAndCreatePullRequest(newVersion, newBranch);\n-\n-    // Wait for the staging PR to be merged. Then build and publish the feature-freeze next\n-    // pre-release. Finally, cherry-pick the release notes into the next branch in combination\n-    // with bumping the version to the next minor too.\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-    await this.buildAndPublish(releaseNotes, newBranch, 'next');\n-    await this._createNextBranchUpdatePullRequest(releaseNotes, newVersion);\n-  }\n-\n-  /** Computes the new version for the release-train being branched-off. */\n-  private async _computeNewVersion() {\n-    if (this.newPhaseName === 'feature-freeze') {\n-      return computeNewPrereleaseVersionForNext(this.active, this.config);\n-    } else {\n-      return semverInc(this.active.next.version, 'prerelease', 'rc');\n-    }\n-  }\n-\n-  /** Creates a new version branch from the next branch. */\n-  private async _createNewVersionBranchFromNext(newBranch: string) {\n-    const {branchName: nextBranch} = this.active.next;\n-    await this.verifyPassingGithubStatus(nextBranch);\n-    await this.checkoutUpstreamBranch(nextBranch);\n-    await this.createLocalBranchFromHead(newBranch);\n-    await this.pushHeadToRemoteBranch(newBranch);\n-    info(green(`  ✓   Version branch \"${newBranch}\" created.`));\n-  }\n-\n-  /**\n-   * Creates a pull request for the next branch that bumps the version to the next\n-   * minor, and cherry-picks the changelog for the newly branched-off release-candidate\n-   * or feature-freeze version.\n-   */\n-  private async _createNextBranchUpdatePullRequest(\n-      releaseNotes: ReleaseNotes, newVersion: semver.SemVer) {\n-    const {branchName: nextBranch, version} = this.active.next;\n-    // We increase the version for the next branch to the next minor. The team can decide\n-    // later if they want next to be a major through the `Configure Next as Major` release action.\n-    const newNextVersion = semver.parse(`${version.major}.${version.minor + 1}.0-next.0`)!;\n-    const bumpCommitMessage = getCommitMessageForExceptionalNextVersionBump(newNextVersion);\n-\n-    await this.checkoutUpstreamBranch(nextBranch);\n-    await this.updateProjectVersion(newNextVersion);\n-\n-    // Create an individual commit for the next version bump. The changelog should go into\n-    // a separate commit that makes it clear where the changelog is cherry-picked from.\n-    await this.createCommit(bumpCommitMessage, [packageJsonPath]);\n-\n-    await this.prependReleaseNotesToChangelog(releaseNotes);\n-\n-    const commitMessage = getReleaseNoteCherryPickCommitMessage(releaseNotes.version);\n-\n-    await this.createCommit(commitMessage, [changelogPath]);\n-\n-    let nextPullRequestMessage = `The previous \"next\" release-train has moved into the ` +\n-        `${this.newPhaseName} phase. This PR updates the next branch to the subsequent ` +\n-        `release-train.\\n\\nAlso this PR cherry-picks the changelog for ` +\n-        `v${newVersion} into the ${nextBranch} branch so that the changelog is up to date.`;\n-\n-    const nextUpdatePullRequest = await this.pushChangesToForkAndCreatePullRequest(\n-        nextBranch, `next-release-train-${newNextVersion}`,\n-        `Update next branch to reflect new release-train \"v${newNextVersion}\".`,\n-        nextPullRequestMessage);\n-\n-    info(green(`  ✓   Pull request for updating the \"${nextBranch}\" branch has been created.`));\n-    info(yellow(`      Please ask team members to review: ${nextUpdatePullRequest.url}.`));\n-  }\n-}"
        },
        {
            "sha": "f3003f29758e0c91a5fb554a2f7def309f522ec6",
            "filename": "dev-infra/release/publish/actions/configure-next-as-major.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 53,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fconfigure-next-as-major.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fconfigure-next-as-major.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fconfigure-next-as-major.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,53 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {green, info, yellow} from '../../../utils/console';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {ReleaseAction} from '../actions';\n-import {getCommitMessageForNextBranchMajorSwitch} from '../commit-message';\n-import {packageJsonPath} from '../constants';\n-\n-/**\n- * Release action that configures the active next release-train to be for a major\n- * version. This means that major changes can land in the next branch.\n- */\n-export class ConfigureNextAsMajorAction extends ReleaseAction {\n-  private _newVersion = semver.parse(`${this.active.next.version.major + 1}.0.0-next.0`)!;\n-\n-  override async getDescription() {\n-    const {branchName} = this.active.next;\n-    const newVersion = this._newVersion;\n-    return `Configure the \"${branchName}\" branch to be released as major (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const {branchName} = this.active.next;\n-    const newVersion = this._newVersion;\n-\n-    await this.verifyPassingGithubStatus(branchName);\n-    await this.checkoutUpstreamBranch(branchName);\n-    await this.updateProjectVersion(newVersion);\n-    await this.createCommit(\n-        getCommitMessageForNextBranchMajorSwitch(newVersion), [packageJsonPath]);\n-    const pullRequest = await this.pushChangesToForkAndCreatePullRequest(\n-        branchName, `switch-next-to-major-${newVersion}`,\n-        `Configure next branch to receive major changes for v${newVersion}`);\n-\n-    info(green('  ✓   Next branch update pull request has been created.'));\n-    info(yellow(`      Please ask team members to review: ${pullRequest.url}.`));\n-  }\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // The `next` branch can always be switched to a major version, unless it already\n-    // is targeting a new major. A major can contain minor changes, so we can always\n-    // change the target from a minor to a major.\n-    return !active.next.isMajor;\n-  }\n-}"
        },
        {
            "sha": "940bd257ef159348edf0a45053e08d58d92daf88",
            "filename": "dev-infra/release/publish/actions/cut-lts-patch.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 83,
            "changes": 83,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,83 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ListChoiceOptions, prompt} from 'inquirer';\n-\n-import {semverInc} from '../../../utils/semver';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {fetchLongTermSupportBranchesFromNpm, LtsBranch} from '../../versioning/long-term-support';\n-import {ReleaseAction} from '../actions';\n-\n-/**\n- * Release action that cuts a new patch release for an active release-train in the long-term\n- * support phase. The patch segment is incremented. The changelog is generated for the new\n- * patch version, but also needs to be cherry-picked into the next development branch.\n- */\n-export class CutLongTermSupportPatchAction extends ReleaseAction {\n-  /** Promise resolving an object describing long-term support branches. */\n-  ltsBranches = fetchLongTermSupportBranchesFromNpm(this.config);\n-\n-  override async getDescription() {\n-    const {active} = await this.ltsBranches;\n-    return `Cut a new release for an active LTS branch (${active.length} active).`;\n-  }\n-\n-  override async perform() {\n-    const ltsBranch = await this._promptForTargetLtsBranch();\n-    const newVersion = semverInc(ltsBranch.version, 'patch');\n-    const {pullRequest, releaseNotes} =\n-        await this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n-\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-    await this.buildAndPublish(releaseNotes, ltsBranch.name, ltsBranch.npmDistTag);\n-    await this.cherryPickChangelogIntoNextBranch(releaseNotes, ltsBranch.name);\n-  }\n-\n-  /** Prompts the user to select an LTS branch for which a patch should but cut. */\n-  private async _promptForTargetLtsBranch(): Promise<LtsBranch> {\n-    const {active, inactive} = await this.ltsBranches;\n-    const activeBranchChoices = active.map(branch => this._getChoiceForLtsBranch(branch));\n-\n-    // If there are inactive LTS branches, we allow them to be selected. In some situations,\n-    // patch releases are still cut for inactive LTS branches. e.g. when the LTS duration\n-    // has been increased due to exceptional events ()\n-    if (inactive.length !== 0) {\n-      activeBranchChoices.push({name: 'Inactive LTS versions (not recommended)', value: null});\n-    }\n-\n-    const {activeLtsBranch, inactiveLtsBranch} =\n-        await prompt<{activeLtsBranch: LtsBranch | null, inactiveLtsBranch: LtsBranch}>([\n-          {\n-            name: 'activeLtsBranch',\n-            type: 'list',\n-            message: 'Please select a version for which you want to cut an LTS patch',\n-            choices: activeBranchChoices,\n-          },\n-          {\n-            name: 'inactiveLtsBranch',\n-            type: 'list',\n-            when: o => o.activeLtsBranch === null,\n-            message: 'Please select an inactive LTS version for which you want to cut an LTS patch',\n-            choices: inactive.map(branch => this._getChoiceForLtsBranch(branch)),\n-          }\n-        ]);\n-    return activeLtsBranch ?? inactiveLtsBranch;\n-  }\n-\n-  /** Gets an inquirer choice for the given LTS branch. */\n-  private _getChoiceForLtsBranch(branch: LtsBranch): ListChoiceOptions {\n-    return {name: `v${branch.version.major} (from ${branch.name})`, value: branch};\n-  }\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // LTS patch versions can be only cut if there are release trains in LTS phase.\n-    // This action is always selectable as we support publishing of old LTS branches,\n-    // and have prompt for selecting an LTS branch when the action performs.\n-    return true;\n-  }\n-}"
        },
        {
            "sha": "bb8702941f56db13d3d4312d233bd5b6f8dd9f53",
            "filename": "dev-infra/release/publish/actions/cut-new-patch.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,44 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {semverInc} from '../../../utils/semver';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {ReleaseAction} from '../actions';\n-\n-/**\n- * Release action that cuts a new patch release for the current latest release-train version\n- * branch (i.e. the patch branch). The patch segment is incremented. The changelog is generated\n- * for the new patch version, but also needs to be cherry-picked into the next development branch.\n- */\n-export class CutNewPatchAction extends ReleaseAction {\n-  private _newVersion = semverInc(this.active.latest.version, 'patch');\n-\n-  override async getDescription() {\n-    const {branchName} = this.active.latest;\n-    const newVersion = this._newVersion;\n-    return `Cut a new patch release for the \"${branchName}\" branch (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const {branchName} = this.active.latest;\n-    const newVersion = this._newVersion;\n-\n-    const {pullRequest, releaseNotes} =\n-        await this.checkoutBranchAndStageVersion(newVersion, branchName);\n-\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-    await this.buildAndPublish(releaseNotes, branchName, 'latest');\n-    await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n-  }\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // Patch versions can be cut at any time. See:\n-    // https://hackmd.io/2Le8leq0S6G_R5VEVTNK9A#Release-prompt-options.\n-    return true;\n-  }\n-}"
        },
        {
            "sha": "1be4f70177802778721fcff2164912fb387d80a7",
            "filename": "dev-infra/release/publish/actions/cut-next-prerelease.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,73 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {semverInc} from '../../../utils/semver';\n-import {computeNewPrereleaseVersionForNext} from '../../versioning/next-prerelease-version';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {ReleaseAction} from '../actions';\n-\n-/**\n- * Release action that cuts a prerelease for the next branch. A version in the next\n- * branch can have an arbitrary amount of next pre-releases.\n- */\n-export class CutNextPrereleaseAction extends ReleaseAction {\n-  /** Promise resolving with the new version if a NPM next pre-release is cut. */\n-  private _newVersion: Promise<semver.SemVer> = this._computeNewVersion();\n-\n-  override async getDescription() {\n-    const {branchName} = this._getActivePrereleaseTrain();\n-    const newVersion = await this._newVersion;\n-    return `Cut a new next pre-release for the \"${branchName}\" branch (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const releaseTrain = this._getActivePrereleaseTrain();\n-    const {branchName} = releaseTrain;\n-    const newVersion = await this._newVersion;\n-\n-    const {pullRequest, releaseNotes} =\n-        await this.checkoutBranchAndStageVersion(newVersion, branchName);\n-\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-    await this.buildAndPublish(releaseNotes, branchName, 'next');\n-\n-    // If the pre-release has been cut from a branch that is not corresponding\n-    // to the next release-train, cherry-pick the changelog into the primary\n-    // development branch. i.e. the `next` branch that is usually `master`.\n-    if (releaseTrain !== this.active.next) {\n-      await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n-    }\n-  }\n-\n-  /** Gets the release train for which NPM next pre-releases should be cut. */\n-  private _getActivePrereleaseTrain(): ReleaseTrain {\n-    return this.active.releaseCandidate ?? this.active.next;\n-  }\n-\n-  /** Gets the new pre-release version for this release action. */\n-  private async _computeNewVersion(): Promise<semver.SemVer> {\n-    const releaseTrain = this._getActivePrereleaseTrain();\n-    // If a pre-release is cut for the next release-train, the new version is computed\n-    // with respect to special cases surfacing with FF/RC branches. Otherwise, the basic\n-    // pre-release increment of the version is used as new version.\n-    if (releaseTrain === this.active.next) {\n-      return await computeNewPrereleaseVersionForNext(this.active, this.config);\n-    } else {\n-      return semverInc(releaseTrain.version, 'prerelease');\n-    }\n-  }\n-\n-  static override async isActive() {\n-    // Pre-releases for the `next` NPM dist tag can always be cut. Depending on whether\n-    // there is a feature-freeze/release-candidate branch, the next pre-releases are either\n-    // cut from such a branch, or from the actual `next` release-train branch (i.e. master).\n-    return true;\n-  }\n-}"
        },
        {
            "sha": "bf3d8e6c8aa4d3d8531f23124e5578ee3bfbd71e",
            "filename": "dev-infra/release/publish/actions/cut-release-candidate-for-feature-freeze.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate-for-feature-freeze.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate-for-feature-freeze.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate-for-feature-freeze.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {semverInc} from '../../../utils/semver';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {ReleaseAction} from '../actions';\n-\n-/**\n- * Cuts the first release candidate for a release-train currently in the\n- * feature-freeze phase. The version is bumped from `next` to `rc.0`.\n- */\n-export class CutReleaseCandidateForFeatureFreezeAction extends ReleaseAction {\n-  private _newVersion = semverInc(this.active.releaseCandidate!.version, 'prerelease', 'rc');\n-\n-  override async getDescription() {\n-    const newVersion = this._newVersion;\n-    return `Cut a first release-candidate for the feature-freeze branch (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const {branchName} = this.active.releaseCandidate!;\n-    const newVersion = this._newVersion;\n-\n-    const {pullRequest, releaseNotes} =\n-        await this.checkoutBranchAndStageVersion(newVersion, branchName);\n-\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-    await this.buildAndPublish(releaseNotes, branchName, 'next');\n-    await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n-  }\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // A release-candidate can be cut for an active release-train currently\n-    // in the feature-freeze phase.\n-    return active.releaseCandidate !== null &&\n-        active.releaseCandidate.version.prerelease[0] === 'next';\n-  }\n-}"
        },
        {
            "sha": "7c8747a8dba63022fb0f4b3c6a0f814002d80703",
            "filename": "dev-infra/release/publish/actions/cut-stable.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 83,
            "changes": 83,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,83 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {getLtsNpmDistTagOfMajor} from '../../versioning/long-term-support';\n-import {ReleaseAction} from '../actions';\n-import {invokeSetNpmDistCommand, invokeYarnInstallCommand} from '../external-commands';\n-\n-/**\n- * Release action that cuts a stable version for the current release-train in the release\n- * candidate phase. The pre-release release-candidate version label is removed.\n- */\n-export class CutStableAction extends ReleaseAction {\n-  private _newVersion = this._computeNewVersion();\n-\n-  override async getDescription() {\n-    const newVersion = this._newVersion;\n-    return `Cut a stable release for the release-candidate branch (v${newVersion}).`;\n-  }\n-\n-  override async perform() {\n-    const {branchName} = this.active.releaseCandidate!;\n-    const newVersion = this._newVersion;\n-    const isNewMajor = this.active.releaseCandidate?.isMajor;\n-\n-    const {pullRequest, releaseNotes} =\n-        await this.checkoutBranchAndStageVersion(newVersion, branchName);\n-\n-    await this.waitForPullRequestToBeMerged(pullRequest);\n-\n-    // If a new major version is published, we publish to the `next` NPM dist tag temporarily.\n-    // We do this because for major versions, we want all main Angular projects to have their\n-    // new major become available at the same time. Publishing immediately to the `latest` NPM\n-    // dist tag could cause inconsistent versions when users install packages with `@latest`.\n-    // For example: Consider Angular Framework releases v12. CLI and Components would need to\n-    // wait for that release to complete. Once done, they can update their dependencies to point\n-    // to v12. Afterwards they could start the release process. In the meanwhile though, the FW\n-    // dependencies were already available as `@latest`, so users could end up installing v12 while\n-    // still having the older (but currently still latest) CLI version that is incompatible.\n-    // The major release can be re-tagged to `latest` through a separate release action.\n-    await this.buildAndPublish(releaseNotes, branchName, isNewMajor ? 'next' : 'latest');\n-\n-    // If a new major version is published and becomes the \"latest\" release-train, we need\n-    // to set the LTS npm dist tag for the previous latest release-train (the current patch).\n-    if (isNewMajor) {\n-      const previousPatch = this.active.latest;\n-      const ltsTagForPatch = getLtsNpmDistTagOfMajor(previousPatch.version.major);\n-\n-      // Instead of directly setting the NPM dist tags, we invoke the ng-dev command for\n-      // setting the NPM dist tag to the specified version. We do this because release NPM\n-      // packages could be different in the previous patch branch, and we want to set the\n-      // LTS tag for all packages part of the last major. It would not be possible to set the\n-      // NPM dist tag for new packages part of the released major, nor would it be acceptable\n-      // to skip the LTS tag for packages which are no longer part of the new major.\n-      await this.checkoutUpstreamBranch(previousPatch.branchName);\n-      await invokeYarnInstallCommand(this.projectDir);\n-      await invokeSetNpmDistCommand(ltsTagForPatch, previousPatch.version);\n-    }\n-\n-    await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n-  }\n-\n-  /** Gets the new stable version of the release candidate release-train. */\n-  private _computeNewVersion(): semver.SemVer {\n-    const {version} = this.active.releaseCandidate!;\n-    return semver.parse(`${version.major}.${version.minor}.${version.patch}`)!;\n-  }\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // A stable version can be cut for an active release-train currently in the\n-    // release-candidate phase. Note: It is not possible to directly release from\n-    // feature-freeze phase into a stable version.\n-    return active.releaseCandidate !== null &&\n-        active.releaseCandidate.version.prerelease[0] === 'rc';\n-  }\n-}"
        },
        {
            "sha": "d3f7558591e7dffb5a0a862a87b54b3452409e7e",
            "filename": "dev-infra/release/publish/actions/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 33,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,33 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseActionConstructor} from '../actions';\n-\n-import {CutLongTermSupportPatchAction} from './cut-lts-patch';\n-import {CutNewPatchAction} from './cut-new-patch';\n-import {CutNextPrereleaseAction} from './cut-next-prerelease';\n-import {CutReleaseCandidateForFeatureFreezeAction} from './cut-release-candidate-for-feature-freeze';\n-import {CutStableAction} from './cut-stable';\n-import {MoveNextIntoFeatureFreezeAction} from './move-next-into-feature-freeze';\n-import {MoveNextIntoReleaseCandidateAction} from './move-next-into-release-candidate';\n-import {TagRecentMajorAsLatest} from './tag-recent-major-as-latest';\n-\n-/**\n- * List of release actions supported by the release staging tool. These are sorted\n- * by priority. Actions which are selectable are sorted based on this declaration order.\n- */\n-export const actions: ReleaseActionConstructor[] = [\n-  TagRecentMajorAsLatest,\n-  CutStableAction,\n-  CutReleaseCandidateForFeatureFreezeAction,\n-  CutNewPatchAction,\n-  CutNextPrereleaseAction,\n-  MoveNextIntoFeatureFreezeAction,\n-  MoveNextIntoReleaseCandidateAction,\n-  CutLongTermSupportPatchAction,\n-];"
        },
        {
            "sha": "90ccd3d8270b10d95cb5f5a4d934b2f0adad2b09",
            "filename": "dev-infra/release/publish/actions/move-next-into-feature-freeze.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ActiveReleaseTrains} from '../../versioning';\n-\n-import {BranchOffNextBranchBaseAction} from './branch-off-next-branch';\n-\n-/**\n- * Release action that moves the next release-train into the feature-freeze phase. This means\n- * that a new version branch is created from the next branch, and a new next pre-release is\n- * cut indicating the started feature-freeze.\n- */\n-export class MoveNextIntoFeatureFreezeAction extends BranchOffNextBranchBaseAction {\n-  override newPhaseName = 'feature-freeze' as const;\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // A new feature-freeze branch can only be created if there is no active\n-    // release-train in feature-freeze/release-candidate phase and the version\n-    // currently in the `next` branch is for a major. The feature-freeze phase\n-    // is not foreseen for minor versions.\n-    return active.releaseCandidate === null && active.next.isMajor;\n-  }\n-}"
        },
        {
            "sha": "4d9b7280edb91ab9ef41af3373ab4caf396f2a2b",
            "filename": "dev-infra/release/publish/actions/move-next-into-release-candidate.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-release-candidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-release-candidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-release-candidate.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,27 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ActiveReleaseTrains} from '../../versioning';\n-\n-import {BranchOffNextBranchBaseAction} from './branch-off-next-branch';\n-\n-/**\n- * Release action that moves the next release-train into the release-candidate phase. This means\n- * that a new version branch is created from the next branch, and the first release candidate\n- * version is cut indicating the new phase.\n- */\n-export class MoveNextIntoReleaseCandidateAction extends BranchOffNextBranchBaseAction {\n-  override newPhaseName = 'release-candidate' as const;\n-\n-  static override async isActive(active: ActiveReleaseTrains) {\n-    // Directly switching a next release-train into the `release-candidate`\n-    // phase is only allowed for minor releases. Major version always need to\n-    // go through the `feature-freeze` phase.\n-    return active.releaseCandidate === null && !active.next.isMajor;\n-  }\n-}"
        },
        {
            "sha": "004441cfb42d2fca5a02195b6d54f1197427f2c3",
            "filename": "dev-infra/release/publish/actions/tag-recent-major-as-latest.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 53,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Ftag-recent-major-as-latest.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,53 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {ReleaseConfig} from '../../config';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import {fetchProjectNpmPackageInfo} from '../../versioning/npm-registry';\n-import {ReleaseAction} from '../actions';\n-import {invokeSetNpmDistCommand, invokeYarnInstallCommand} from '../external-commands';\n-\n-/**\n- * Release action that tags the recently published major as latest within the NPM\n- * registry. Major versions are published to the `next` NPM dist tag initially and\n- * can be re-tagged to the `latest` NPM dist tag. This allows caretakers to make major\n- * releases available at the same time. e.g. Framework, Tooling and Components\n- * are able to publish v12 to `@latest` at the same time. This wouldn't be possible if\n- * we directly publish to `@latest` because Tooling and Components needs to wait\n- * for the major framework release to be available on NPM.\n- * @see {CutStableAction#perform} for more details.\n- */\n-export class TagRecentMajorAsLatest extends ReleaseAction {\n-  override async getDescription() {\n-    return `Tag recently published major v${this.active.latest.version} as \"next\" in NPM.`;\n-  }\n-\n-  override async perform() {\n-    await this.checkoutUpstreamBranch(this.active.latest.branchName);\n-    await invokeYarnInstallCommand(this.projectDir);\n-    await invokeSetNpmDistCommand('latest', this.active.latest.version);\n-  }\n-\n-  static override async isActive({latest}: ActiveReleaseTrains, config: ReleaseConfig) {\n-    // If the latest release-train does currently not have a major version as version. e.g.\n-    // the latest branch is `10.0.x` with the version being `10.0.2`. In such cases, a major\n-    // has not been released recently, and this action should never become active.\n-    if (latest.version.minor !== 0 || latest.version.patch !== 0) {\n-      return false;\n-    }\n-\n-    const packageInfo = await fetchProjectNpmPackageInfo(config);\n-    const npmLatestVersion = semver.parse(packageInfo['dist-tags']['latest']);\n-    // This action only becomes active if a major just has been released recently, but is\n-    // not set to the `latest` NPM dist tag in the NPM registry. Note that we only allow\n-    // re-tagging if the current `@latest` in NPM is the previous major version.\n-    return npmLatestVersion !== null && npmLatestVersion.major === latest.version.major - 1;\n-  }\n-}"
        },
        {
            "sha": "5a6ec8363d203295ef0b3b2347e684da1de20e27",
            "filename": "dev-infra/release/publish/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,59 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {getConfig} from '../../utils/config';\n-import {error, green, info, red, yellow} from '../../utils/console';\n-import {GitClient} from '../../utils/git/git-client';\n-import {addGithubTokenOption} from '../../utils/git/github-yargs';\n-import {getReleaseConfig} from '../config/index';\n-\n-import {CompletionState, ReleaseTool} from './index';\n-\n-/** Command line options for publishing a release. */\n-export interface ReleasePublishOptions {\n-  githubToken: string;\n-}\n-\n-/** Yargs command builder for configuring the `ng-dev release publish` command. */\n-function builder(argv: Argv): Argv<ReleasePublishOptions> {\n-  return addGithubTokenOption(argv);\n-}\n-\n-/** Yargs command handler for staging a release. */\n-async function handler() {\n-  const git = GitClient.get();\n-  const config = getConfig();\n-  const releaseConfig = getReleaseConfig(config);\n-  const projectDir = git.baseDir;\n-  const task = new ReleaseTool(releaseConfig, config.github, projectDir);\n-  const result = await task.run();\n-\n-  switch (result) {\n-    case CompletionState.FATAL_ERROR:\n-      error(red(`Release action has been aborted due to fatal errors. See above.`));\n-      process.exitCode = 2;\n-      break;\n-    case CompletionState.MANUALLY_ABORTED:\n-      info(yellow(`Release action has been manually aborted.`));\n-      process.exitCode = 1;\n-      break;\n-    case CompletionState.SUCCESS:\n-      info(green(`Release action has completed successfully.`));\n-      break;\n-  }\n-}\n-\n-/** CLI command module for publishing a release. */\n-export const ReleasePublishCommandModule: CommandModule<{}, ReleasePublishOptions> = {\n-  builder,\n-  handler,\n-  command: 'publish',\n-  describe: 'Publish new releases and configure version branches.',\n-};"
        },
        {
            "sha": "a4bc73aa2c3cb66c3df23de10595ce3b7ffe2b10",
            "filename": "dev-infra/release/publish/commit-message.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 39,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fcommit-message.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fcommit-message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fcommit-message.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,39 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-/** Gets the commit message for a new release point in the project. */\n-export function getCommitMessageForRelease(newVersion: semver.SemVer): string {\n-  return `release: cut the v${newVersion} release`;\n-}\n-\n-/**\n- * Gets the commit message for an exceptional version bump in the next branch. The next\n- * branch version will be bumped without the release being published in some situations.\n- * More details can be found in the `MoveNextIntoFeatureFreeze` release action and in:\n- * https://hackmd.io/2Le8leq0S6G_R5VEVTNK9A.\n- */\n-export function getCommitMessageForExceptionalNextVersionBump(newVersion: semver.SemVer) {\n-  return `release: bump the next branch to v${newVersion}`;\n-}\n-\n-/**\n- * Gets the commit message for a version update in the next branch to a major version. The next\n- * branch version will be updated without the release being published if the branch is configured\n- * as a major. More details can be found in the `ConfigureNextAsMajor` release action and in:\n- * https://hackmd.io/2Le8leq0S6G_R5VEVTNK9A.\n- */\n-export function getCommitMessageForNextBranchMajorSwitch(newVersion: semver.SemVer) {\n-  return `release: switch the next branch to v${newVersion}`;\n-}\n-\n-/** Gets the commit message for a release notes cherry-pick commit */\n-export function getReleaseNoteCherryPickCommitMessage(newVersion: semver.SemVer): string {\n-  return `docs: release notes for the v${newVersion} release`;\n-}"
        },
        {
            "sha": "530c1b8c47f083baf26f4caa30dab4c0a0d85e90",
            "filename": "dev-infra/release/publish/constants.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fconstants.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fconstants.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fconstants.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,16 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** Project-relative path for the \"package.json\" file. */\n-export const packageJsonPath = 'package.json';\n-\n-/** Project-relative path for the changelog file. */\n-export const changelogPath = 'CHANGELOG.md';\n-\n-/** Default interval in milliseconds to check whether a pull request has been merged. */\n-export const waitForPullRequestInterval = 10000;"
        },
        {
            "sha": "f0b9edf3665035febb3753068f831c90ded4e317",
            "filename": "dev-infra/release/publish/external-commands.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 92,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,92 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ora from 'ora';\n-import * as semver from 'semver';\n-\n-import {spawn} from '../../utils/child-process';\n-import {error, green, info, red} from '../../utils/console';\n-import {BuiltPackage} from '../config/index';\n-import {NpmDistTag} from '../versioning';\n-\n-import {FatalReleaseActionError} from './actions-error';\n-\n-/*\n- * ###############################################################\n- *\n- * This file contains helpers for invoking external `ng-dev` commands. A subset of actions,\n- * like building release output or setting aν NPM dist tag for release packages, cannot be\n- * performed directly as part of the release tool and need to be delegated to external `ng-dev`\n- * commands that exist across arbitrary version branches.\n- *\n- * In a concrete example: Consider a new patch version is released and that a new release\n- * package has been added to the `next` branch. The patch branch will not contain the new\n- * release package, so we could not build the release output for it. To work around this, we\n- * call the ng-dev build command for the patch version branch and expect it to return a list\n- * of built packages that need to be released as part of this release train.\n- *\n- * ###############################################################\n- */\n-\n-/**\n- * Invokes the `ng-dev release set-dist-tag` command in order to set the specified\n- * NPM dist tag for all packages in the checked out branch to the given version.\n- */\n-export async function invokeSetNpmDistCommand(npmDistTag: NpmDistTag, version: semver.SemVer) {\n-  try {\n-    // Note: No progress indicator needed as that is the responsibility of the command.\n-    await spawn(\n-        'yarn', ['--silent', 'ng-dev', 'release', 'set-dist-tag', npmDistTag, version.format()]);\n-    info(green(`  ✓   Set \"${npmDistTag}\" NPM dist tag for all packages to v${version}.`));\n-  } catch (e) {\n-    error(e);\n-    error(red(`  ✘   An error occurred while setting the NPM dist tag for \"${npmDistTag}\".`));\n-    throw new FatalReleaseActionError();\n-  }\n-}\n-\n-/**\n- * Invokes the `ng-dev release build` command in order to build the release\n- * packages for the currently checked out branch.\n- */\n-export async function invokeReleaseBuildCommand(): Promise<BuiltPackage[]> {\n-  const spinner = ora.call(undefined).start('Building release output.');\n-  try {\n-    // Since we expect JSON to be printed from the `ng-dev release build` command,\n-    // we spawn the process in silent mode. We have set up an Ora progress spinner.\n-    const {stdout} =\n-        await spawn('yarn', ['--silent', 'ng-dev', 'release', 'build', '--json'], {mode: 'silent'});\n-    spinner.stop();\n-    info(green('  ✓   Built release output for all packages.'));\n-    // The `ng-dev release build` command prints a JSON array to stdout\n-    // that represents the built release packages and their output paths.\n-    return JSON.parse(stdout.trim()) as BuiltPackage[];\n-  } catch (e) {\n-    spinner.stop();\n-    error(e);\n-    error(red('  ✘   An error occurred while building the release packages.'));\n-    throw new FatalReleaseActionError();\n-  }\n-}\n-\n-/**\n- * Invokes the `yarn install` command in order to install dependencies for\n- * the configured project with the currently checked out revision.\n- */\n-export async function invokeYarnInstallCommand(projectDir: string): Promise<void> {\n-  try {\n-    // Note: No progress indicator needed as that is the responsibility of the command.\n-    // TODO: Consider using an Ora spinner instead to ensure minimal console output.\n-    await spawn('yarn', ['install', '--frozen-lockfile', '--non-interactive'], {cwd: projectDir});\n-    info(green('  ✓   Installed project dependencies.'));\n-  } catch (e) {\n-    error(e);\n-    error(red('  ✘   An error occurred while installing dependencies.'));\n-    throw new FatalReleaseActionError();\n-  }\n-}"
        },
        {
            "sha": "63679d7a77bd5aef2cf5fc9f7521fd75c5e708da",
            "filename": "dev-infra/release/publish/graphql-queries.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 31,
            "changes": 31,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fgraphql-queries.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fgraphql-queries.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fgraphql-queries.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,31 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {params, types} from 'typed-graphqlify';\n-\n-/**\n- * Graphql Github API query that can be used to find forks of a given repository\n- * that are owned by the current viewer authenticated with the Github API.\n- */\n-export const findOwnedForksOfRepoQuery = params(\n-    {\n-      $owner: 'String!',\n-      $name: 'String!',\n-    },\n-    {\n-      repository: params({owner: '$owner', name: '$name'}, {\n-        forks: params({affiliations: 'OWNER', first: 1}, {\n-          nodes: [{\n-            owner: {\n-              login: types.string,\n-            },\n-            name: types.string,\n-          }],\n-        }),\n-      }),\n-    });"
        },
        {
            "sha": "f5c551a2d02c6ea6281e0c667a3a4160bce2c4de",
            "filename": "dev-infra/release/publish/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 214,
            "changes": 214,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,214 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ListChoiceOptions, prompt} from 'inquirer';\n-\n-import {spawn} from '../../utils/child-process';\n-import {GithubConfig} from '../../utils/config';\n-import {debug, error, info, log, promptConfirm, red, yellow} from '../../utils/console';\n-import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {ReleaseConfig} from '../config/index';\n-import {ActiveReleaseTrains, fetchActiveReleaseTrains, nextBranchName} from '../versioning/active-release-trains';\n-import {npmIsLoggedIn, npmLogin, npmLogout} from '../versioning/npm-publish';\n-import {printActiveReleaseTrains} from '../versioning/print-active-trains';\n-import {GithubRepoWithApi} from '../versioning/version-branches';\n-\n-import {ReleaseAction} from './actions';\n-import {FatalReleaseActionError, UserAbortedReleaseActionError} from './actions-error';\n-import {actions} from './actions/index';\n-\n-export enum CompletionState {\n-  SUCCESS,\n-  FATAL_ERROR,\n-  MANUALLY_ABORTED,\n-}\n-\n-export class ReleaseTool {\n-  /** The singleton instance of the authenticated git client. */\n-  private _git = AuthenticatedGitClient.get();\n-  /** The previous git commit to return back to after the release tool runs. */\n-  private previousGitBranchOrRevision = this._git.getCurrentBranchOrRevision();\n-\n-  constructor(\n-      protected _config: ReleaseConfig, protected _github: GithubConfig,\n-      protected _projectRoot: string) {}\n-\n-  /** Runs the interactive release tool. */\n-  async run(): Promise<CompletionState> {\n-    log();\n-    log(yellow('--------------------------------------------'));\n-    log(yellow('  Angular Dev-Infra release staging script'));\n-    log(yellow('--------------------------------------------'));\n-    log();\n-\n-    if (!await this._verifyEnvironmentHasPython3Symlink() ||\n-        !await this._verifyNoUncommittedChanges() || !await this._verifyRunningFromNextBranch()) {\n-      return CompletionState.FATAL_ERROR;\n-    }\n-\n-    if (!await this._verifyNpmLoginState()) {\n-      return CompletionState.MANUALLY_ABORTED;\n-    }\n-\n-    const {owner, name} = this._github;\n-    const repo: GithubRepoWithApi = {owner, name, api: this._git.github};\n-    const releaseTrains = await fetchActiveReleaseTrains(repo);\n-\n-    // Print the active release trains so that the caretaker can access\n-    // the current project branching state without switching context.\n-    await printActiveReleaseTrains(releaseTrains, this._config);\n-\n-    const action = await this._promptForReleaseAction(releaseTrains);\n-\n-    try {\n-      await action.perform();\n-    } catch (e) {\n-      if (e instanceof UserAbortedReleaseActionError) {\n-        return CompletionState.MANUALLY_ABORTED;\n-      }\n-      // Only print the error message and stack if the error is not a known fatal release\n-      // action error (for which we print the error gracefully to the console with colors).\n-      if (!(e instanceof FatalReleaseActionError) && e instanceof Error) {\n-        console.error(e);\n-      }\n-      return CompletionState.FATAL_ERROR;\n-    } finally {\n-      await this.cleanup();\n-    }\n-\n-    return CompletionState.SUCCESS;\n-  }\n-\n-  /** Run post release tool cleanups. */\n-  private async cleanup(): Promise<void> {\n-    // Return back to the git state from before the release tool ran.\n-    this._git.checkout(this.previousGitBranchOrRevision, true);\n-    // Ensure log out of NPM.\n-    await npmLogout(this._config.publishRegistry);\n-  }\n-\n-  /** Prompts the caretaker for a release action that should be performed. */\n-  private async _promptForReleaseAction(activeTrains: ActiveReleaseTrains) {\n-    const choices: ListChoiceOptions[] = [];\n-\n-    // Find and instantiate all release actions which are currently valid.\n-    for (let actionType of actions) {\n-      if (await actionType.isActive(activeTrains, this._config)) {\n-        const action: ReleaseAction =\n-            new actionType(activeTrains, this._git, this._config, this._projectRoot);\n-        choices.push({name: await action.getDescription(), value: action});\n-      }\n-    }\n-\n-    info('Please select the type of release you want to perform.');\n-\n-    const {releaseAction} = await prompt<{releaseAction: ReleaseAction}>({\n-      name: 'releaseAction',\n-      message: 'Please select an action:',\n-      type: 'list',\n-      choices,\n-    });\n-\n-    return releaseAction;\n-  }\n-\n-  /**\n-   * Verifies that there are no uncommitted changes in the project.\n-   * @returns a boolean indicating success or failure.\n-   */\n-  private async _verifyNoUncommittedChanges(): Promise<boolean> {\n-    if (this._git.hasUncommittedChanges()) {\n-      error(red('  ✘   There are changes which are not committed and should be discarded.'));\n-      return false;\n-    }\n-    return true;\n-  }\n-\n-  /**\n-   * Verifies that Python can be resolved within scripts and points to a compatible version. Python\n-   * is required in Bazel actions as there can be tools (such as `skydoc`) that rely on it.\n-   * @returns a boolean indicating success or failure.\n-   */\n-  private async _verifyEnvironmentHasPython3Symlink(): Promise<boolean> {\n-    try {\n-      // Note: We do not rely on `/usr/bin/env` but rather access the `env` binary directly as it\n-      // should be part of the shell's `$PATH`. This is necessary for compatibility with Windows.\n-      const pyVersion = await spawn('env', ['python', '--version'], {mode: 'silent'});\n-      const version = pyVersion.stdout.trim() || pyVersion.stderr.trim();\n-      if (version.startsWith('Python 3.')) {\n-        debug(`Local python version: ${version}`);\n-        return true;\n-      }\n-      error(red(`  ✘   \\`/usr/bin/python\\` is currently symlinked to \"${version}\", please update`));\n-      error(red('      the symlink to link instead to Python3'));\n-      error();\n-      error(red('      Googlers: please run the following command to symlink python to python3:'));\n-      error(red('        sudo ln -s /usr/bin/python3 /usr/bin/python'));\n-      return false;\n-    } catch {\n-      error(red('  ✘   `/usr/bin/python` does not exist, please ensure `/usr/bin/python` is'));\n-      error(red('      symlinked to Python3.'));\n-      error();\n-      error(red('      Googlers: please run the following command to symlink python to python3:'));\n-      error(red('        sudo ln -s /usr/bin/python3 /usr/bin/python'));\n-    }\n-    return false;\n-  }\n-\n-  /**\n-   * Verifies that the next branch from the configured repository is checked out.\n-   * @returns a boolean indicating success or failure.\n-   */\n-  private async _verifyRunningFromNextBranch(): Promise<boolean> {\n-    const headSha = this._git.run(['rev-parse', 'HEAD']).stdout.trim();\n-    const {data} =\n-        await this._git.github.repos.getBranch({...this._git.remoteParams, branch: nextBranchName});\n-\n-    if (headSha !== data.commit.sha) {\n-      error(red('  ✘   Running release tool from an outdated local branch.'));\n-      error(red(`      Please make sure you are running from the \"${nextBranchName}\" branch.`));\n-      return false;\n-    }\n-    return true;\n-  }\n-\n-  /**\n-   * Verifies that the user is logged into NPM at the correct registry, if defined for the release.\n-   * @returns a boolean indicating whether the user is logged into NPM.\n-   */\n-  private async _verifyNpmLoginState(): Promise<boolean> {\n-    const registry = `NPM at the ${this._config.publishRegistry ?? 'default NPM'} registry`;\n-    // TODO(josephperrott): remove wombat specific block once wombot allows `npm whoami` check to\n-    // check the status of the local token in the .npmrc file.\n-    if (this._config.publishRegistry?.includes('wombat-dressing-room.appspot.com')) {\n-      info('Unable to determine NPM login state for wombat proxy, requiring login now.');\n-      try {\n-        await npmLogin(this._config.publishRegistry);\n-      } catch {\n-        return false;\n-      }\n-      return true;\n-    }\n-    if (await npmIsLoggedIn(this._config.publishRegistry)) {\n-      debug(`Already logged into ${registry}.`);\n-      return true;\n-    }\n-    error(red(`  ✘   Not currently logged into ${registry}.`));\n-    const shouldLogin = await promptConfirm('Would you like to log into NPM now?');\n-    if (shouldLogin) {\n-      debug('Starting NPM login.');\n-      try {\n-        await npmLogin(this._config.publishRegistry);\n-      } catch {\n-        return false;\n-      }\n-      return true;\n-    }\n-    return false;\n-  }\n-}"
        },
        {
            "sha": "d74eb21806a75702f6370c738d4512dbf4269588",
            "filename": "dev-infra/release/publish/pull-request-state.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 79,
            "changes": 79,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fpull-request-state.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Fpull-request-state.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fpull-request-state.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,79 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {GitClient} from '../../utils/git/git-client';\n-\n-/** Thirty seconds in milliseconds. */\n-const THIRTY_SECONDS_IN_MS = 30000;\n-\n-/** State of a pull request in Github. */\n-export type PullRequestState = 'merged'|'closed'|'open';\n-\n-/** Gets whether a given pull request has been merged. */\n-export async function getPullRequestState(api: GitClient, id: number): Promise<PullRequestState> {\n-  const {data} = await api.github.pulls.get({...api.remoteParams, pull_number: id});\n-  if (data.merged) {\n-    return 'merged';\n-  }\n-  // Check if the PR was closed more than 30 seconds ago, this extra time gives Github time to\n-  // update the closed pull request to be associated with the closing commit.\n-  // Note: a Date constructed with `null` creates an object at 0 time, which will never be greater\n-  // than the current date time.\n-  if (data.closed_at !== null &&\n-      (new Date(data.closed_at).getTime() < Date.now() - THIRTY_SECONDS_IN_MS)) {\n-    return await isPullRequestClosedWithAssociatedCommit(api, id) ? 'merged' : 'closed';\n-  }\n-  return 'open';\n-}\n-\n-/**\n- * Whether the pull request has been closed with an associated commit. This is usually\n- * the case if a PR has been merged using the autosquash merge script strategy. Since\n- * the merge is not fast-forward, Github does not consider the PR as merged and instead\n- * shows the PR as closed. See for example: https://github.com/angular/angular/pull/37918.\n- */\n-async function isPullRequestClosedWithAssociatedCommit(api: GitClient, id: number) {\n-  const events = await api.github.paginate(\n-      api.github.issues.listEvents, {...api.remoteParams, issue_number: id});\n-  // Iterate through the events of the pull request in reverse. We want to find the most\n-  // recent events and check if the PR has been closed with a commit associated with it.\n-  // If the PR has been closed through a commit, we assume that the PR has been merged\n-  // using the autosquash merge strategy. For more details. See the `AutosquashMergeStrategy`.\n-  for (let i = events.length - 1; i >= 0; i--) {\n-    const {event, commit_id} = events[i];\n-    // If we come across a \"reopened\" event, we abort looking for referenced commits. Any\n-    // commits that closed the PR before, are no longer relevant and did not close the PR.\n-    if (event === 'reopened') {\n-      return false;\n-    }\n-    // If a `closed` event is captured with a commit assigned, then we assume that\n-    // this PR has been merged properly.\n-    if (event === 'closed' && commit_id) {\n-      return true;\n-    }\n-    // If the PR has been referenced by a commit, check if the commit closes this pull\n-    // request. Note that this is needed besides checking `closed` as PRs could be merged\n-    // into any non-default branch where the `Closes <..>` keyword does not work and the PR\n-    // is simply closed without an associated `commit_id`. For more details see:\n-    // https://docs.github.com/en/enterprise/2.16/user/github/managing-your-work-on-github/closing-issues-using-keywords#:~:text=non-default.\n-    if (event === 'referenced' && commit_id &&\n-        await isCommitClosingPullRequest(api, commit_id, id)) {\n-      return true;\n-    }\n-  }\n-  return false;\n-}\n-\n-/** Checks whether the specified commit is closing the given pull request. */\n-async function isCommitClosingPullRequest(api: GitClient, sha: string, id: number) {\n-  const {data} = await api.github.repos.getCommit({...api.remoteParams, ref: sha});\n-  // Matches the closing keyword supported in commit messages. See:\n-  // https://docs.github.com/en/enterprise/2.16/user/github/managing-your-work-on-github/closing-issues-using-keywords.\n-  return data.commit.message.match(\n-      new RegExp(`(?:close[sd]?|fix(?:e[sd]?)|resolve[sd]?):? #${id}(?!\\\\d)`, 'i'));\n-}"
        },
        {
            "sha": "b27935084d9c4796c4e1e32177b18feeb3e88a76",
            "filename": "dev-infra/release/publish/test/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"test_lib\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    deps = [\n-        \"//dev-infra/commit-message\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/notes\",\n-        \"//dev-infra/release/publish\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"//dev-infra/utils/testing\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/minimist\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/node-fetch\",\n-        \"@npm//@types/semver\",\n-        \"@npm//minimist\",\n-        \"@npm//nock\",\n-        \"@npm//node-fetch\",\n-        \"@npm//semver\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    # Disable the Bazel patched module resolution. It always loads \".mjs\" files first. This\n-    # breaks NodeJS execution for \"node-fetch\" as it uses experimental modules which are not\n-    # enabled in NodeJS. TODO: Remove this with rules_nodejs 3.x where patching is optional.\n-    # https://github.com/bazelbuild/rules_nodejs/commit/7d070ffadf9c3b41711382a4737b995f987c14fa.\n-    args = [\"--nobazel_patch_module_resolver\"],\n-    deps = [\":test_lib\"],\n-)"
        },
        {
            "sha": "1934d872f460c21ec9ae22eb333b6d42e8be58c7",
            "filename": "dev-infra/release/publish/test/branch-off-next-branch-testing.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 103,
            "changes": 103,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fbranch-off-next-branch-testing.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fbranch-off-next-branch-testing.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fbranch-off-next-branch-testing.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,103 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getBranchPushMatcher} from '../../../utils/testing';\n-import {ActiveReleaseTrains} from '../../versioning';\n-import * as npm from '../../versioning/npm-publish';\n-import {ReleaseActionConstructor} from '../actions';\n-import {BranchOffNextBranchBaseAction} from '../actions/branch-off-next-branch';\n-import * as externalCommands from '../external-commands';\n-\n-import {setupReleaseActionForTesting, testTmpDir} from './test-utils';\n-\n-/**\n- * Performs the given branch-off release action and expects versions and\n- * branches to be determined and created properly.\n- */\n-export async function expectBranchOffActionToRun(\n-    action: ReleaseActionConstructor<BranchOffNextBranchBaseAction>, active: ActiveReleaseTrains,\n-    isNextPublishedToNpm: boolean, expectedNextVersion: string, expectedVersion: string,\n-    expectedNewBranch: string) {\n-  const {repo, fork, instance, gitClient} =\n-      setupReleaseActionForTesting(action, active, isNextPublishedToNpm);\n-\n-  const expectedNextUpdateBranch = `next-release-train-${expectedNextVersion}`;\n-  const expectedStagingForkBranch = `release-stage-${expectedVersion}`;\n-  const expectedTagName = expectedVersion;\n-\n-  // We first mock the commit status check for the next branch, then expect two pull\n-  // requests from a fork that are targeting next and the new feature-freeze branch.\n-  repo.expectBranchRequest('master', 'MASTER_COMMIT_SHA')\n-      .expectCommitStatusCheck('MASTER_COMMIT_SHA', 'success')\n-      .expectFindForkRequest(fork)\n-      .expectPullRequestToBeCreated(expectedNewBranch, fork, expectedStagingForkBranch, 200)\n-      .expectPullRequestWait(200)\n-      .expectBranchRequest(expectedNewBranch, 'STAGING_COMMIT_SHA')\n-      .expectCommitRequest(\n-          'STAGING_COMMIT_SHA', `release: cut the v${expectedVersion} release\\n\\nPR Close #200.`)\n-      .expectTagToBeCreated(expectedTagName, 'STAGING_COMMIT_SHA')\n-      .expectReleaseToBeCreated(`v${expectedVersion}`, expectedTagName)\n-      .expectPullRequestToBeCreated('master', fork, expectedNextUpdateBranch, 100);\n-\n-  // In the fork, we make the following branches appear as non-existent,\n-  // so that the PRs can be created properly without collisions.\n-  fork.expectBranchRequest(expectedStagingForkBranch, null)\n-      .expectBranchRequest(expectedNextUpdateBranch, null);\n-\n-  await instance.perform();\n-\n-  expect(gitClient.pushed.length).toBe(3);\n-  expect(gitClient.pushed[0])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseRepo: repo,\n-            baseBranch: 'master',\n-            targetRepo: repo,\n-            targetBranch: expectedNewBranch,\n-            expectedCommits: [],\n-          }),\n-          'Expected new version-branch to be created upstream and based on \"master\".');\n-  expect(gitClient.pushed[1])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseBranch: 'master',\n-            baseRepo: repo,\n-            targetBranch: expectedStagingForkBranch,\n-            targetRepo: fork,\n-            expectedCommits: [{\n-              message: `release: cut the v${expectedVersion} release`,\n-              files: ['package.json', 'CHANGELOG.md'],\n-            }],\n-          }),\n-          'Expected release staging branch to be created in fork.');\n-\n-  expect(gitClient.pushed[2])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseBranch: 'master',\n-            baseRepo: repo,\n-            targetBranch: expectedNextUpdateBranch,\n-            targetRepo: fork,\n-            expectedCommits: [\n-              {\n-                message: `release: bump the next branch to v${expectedNextVersion}`,\n-                files: ['package.json']\n-              },\n-              {\n-                message: `docs: release notes for the v${expectedVersion} release`,\n-                files: ['CHANGELOG.md']\n-              },\n-            ],\n-          }),\n-          'Expected next release-train update branch be created in fork.');\n-\n-  expect(externalCommands.invokeReleaseBuildCommand).toHaveBeenCalledTimes(1);\n-  expect(npm.runNpmPublish).toHaveBeenCalledTimes(2);\n-  expect(npm.runNpmPublish).toHaveBeenCalledWith(`${testTmpDir}/dist/pkg1`, 'next', undefined);\n-  expect(npm.runNpmPublish).toHaveBeenCalledWith(`${testTmpDir}/dist/pkg2`, 'next', undefined);\n-}"
        },
        {
            "sha": "e5bba5df635e34b1dc91449f861362c7e3040012",
            "filename": "dev-infra/release/publish/test/common.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 163,
            "changes": 163,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,163 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {readFileSync} from 'fs';\n-import {join} from 'path';\n-import * as semver from 'semver';\n-\n-import {getBranchPushMatcher} from '../../../utils/testing';\n-import {ReleaseNotes} from '../../notes/release-notes';\n-import {NpmDistTag} from '../../versioning';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import * as npm from '../../versioning/npm-publish';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {ReleaseAction} from '../actions';\n-import {actions} from '../actions/index';\n-import {changelogPath} from '../constants';\n-\n-import {fakeNpmPackageQueryRequest, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting, testTmpDir} from './test-utils';\n-\n-describe('common release action logic', () => {\n-  const baseReleaseTrains: ActiveReleaseTrains = {\n-    releaseCandidate: null,\n-    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-    latest: new ReleaseTrain('10.0.x', parse('10.0.1')),\n-  };\n-\n-  describe('version computation', async () => {\n-    const testReleaseTrain: ActiveReleaseTrains = {\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.3')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.1')),\n-    };\n-\n-    it('should not modify release train versions and cause invalid other actions', async () => {\n-      const {releaseConfig, gitClient} = getTestingMocksForReleaseAction();\n-      const descriptions: string[] = [];\n-\n-      // Fake the NPM package request as otherwise the test would rely on `npmjs.org`.\n-      fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {}});\n-\n-      for (const actionCtor of actions) {\n-        if (await actionCtor.isActive(testReleaseTrain, releaseConfig)) {\n-          const action = new actionCtor(testReleaseTrain, gitClient, releaseConfig, testTmpDir);\n-          descriptions.push(await action.getDescription());\n-        }\n-      }\n-\n-      expect(descriptions).toEqual([\n-        `Cut a first release-candidate for the feature-freeze branch (v10.1.0-rc.0).`,\n-        `Cut a new patch release for the \"10.0.x\" branch (v10.0.2).`,\n-        `Cut a new next pre-release for the \"10.1.x\" branch (v10.1.0-next.4).`,\n-        `Cut a new release for an active LTS branch (0 active).`\n-      ]);\n-    });\n-  });\n-\n-  describe('build and publishing', () => {\n-    it('should support a custom NPM registry', async () => {\n-      const {repo, instance, releaseConfig} =\n-          setupReleaseActionForTesting(TestAction, baseReleaseTrains);\n-      const {version, branchName} = baseReleaseTrains.next;\n-      const tagName = version.format();\n-      const customRegistryUrl = 'https://custom-npm-registry.google.com';\n-\n-      repo.expectBranchRequest(branchName, 'STAGING_SHA')\n-          .expectCommitRequest('STAGING_SHA', `release: cut the v${version} release`)\n-          .expectTagToBeCreated(tagName, 'STAGING_SHA')\n-          .expectReleaseToBeCreated(`v${version}`, tagName);\n-\n-      // Set up a custom NPM registry.\n-      releaseConfig.publishRegistry = customRegistryUrl;\n-\n-      await instance.testBuildAndPublish(version, branchName, 'latest');\n-\n-      expect(npm.runNpmPublish).toHaveBeenCalledTimes(2);\n-      expect(npm.runNpmPublish)\n-          .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg1`, 'latest', customRegistryUrl);\n-      expect(npm.runNpmPublish)\n-          .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg2`, 'latest', customRegistryUrl);\n-    });\n-  });\n-\n-  describe('changelog cherry-picking', () => {\n-    const {version, branchName} = baseReleaseTrains.latest;\n-    const forkBranchName = `changelog-cherry-pick-${version}`;\n-\n-    it('should prepend the changelog to the next branch', async () => {\n-      const {repo, fork, instance, testTmpDir} =\n-          setupReleaseActionForTesting(TestAction, baseReleaseTrains);\n-\n-      // Expect the changelog to be fetched and return a fake changelog to test that\n-      // it is properly appended. Also expect a pull request to be created in the fork.\n-      repo.expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n-          .expectPullRequestWait(200);\n-\n-      // Simulate that the fork branch name is available.\n-      fork.expectBranchRequest(forkBranchName, null);\n-\n-      await instance.testCherryPickWithPullRequest(version, branchName);\n-\n-      const changelogContent = readFileSync(join(testTmpDir, changelogPath), 'utf8');\n-      expect(changelogContent).toEqual(`Changelog Entry for 10.0.1\\n\\nExisting changelog`);\n-    });\n-\n-    it('should push changes to a fork for creating a pull request', async () => {\n-      const {repo, fork, instance, gitClient} =\n-          setupReleaseActionForTesting(TestAction, baseReleaseTrains);\n-\n-      // Expect the changelog to be fetched and return a fake changelog to test that\n-      // it is properly appended. Also expect a pull request to be created in the fork.\n-      repo.expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n-          .expectPullRequestWait(200);\n-\n-      // Simulate that the fork branch name is available.\n-      fork.expectBranchRequest(forkBranchName, null);\n-\n-      await instance.testCherryPickWithPullRequest(version, branchName);\n-\n-      expect(gitClient.pushed.length).toBe(1);\n-      expect(gitClient.pushed[0]).toEqual(getBranchPushMatcher({\n-        targetBranch: forkBranchName,\n-        targetRepo: fork,\n-        baseBranch: 'master',\n-        baseRepo: repo,\n-        expectedCommits: [{\n-          message: `docs: release notes for the v${version} release`,\n-          files: ['CHANGELOG.md'],\n-        }],\n-      }));\n-    });\n-  });\n-});\n-\n-/**\n- * Test release action that exposes protected units of the base\n- * release action class. This allows us to add unit tests.\n- */\n-class TestAction extends ReleaseAction {\n-  override async getDescription() {\n-    return 'Test action';\n-  }\n-\n-  override async perform() {\n-    throw Error('Not implemented.');\n-  }\n-\n-  async testBuildAndPublish(version: semver.SemVer, publishBranch: string, distTag: NpmDistTag) {\n-    const releaseNotes = await ReleaseNotes.fromRange(version, '', '');\n-    await this.buildAndPublish(releaseNotes, publishBranch, distTag);\n-  }\n-\n-  async testCherryPickWithPullRequest(version: semver.SemVer, branch: string) {\n-    const releaseNotes = await ReleaseNotes.fromRange(version, '', '');\n-    await this.cherryPickChangelogIntoNextBranch(releaseNotes, branch);\n-  }\n-}"
        },
        {
            "sha": "10fb3b5639b735fb3ea9d7930acab95170bea161",
            "filename": "dev-infra/release/publish/test/configure-next-as-major.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 79,
            "changes": 79,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fconfigure-next-as-major.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fconfigure-next-as-major.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fconfigure-next-as-major.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,79 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getBranchPushMatcher} from '../../../utils/testing';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {ConfigureNextAsMajorAction} from '../actions/configure-next-as-major';\n-\n-import {parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('configure next as major action', () => {\n-  it('should be active if the next branch is for a minor', async () => {\n-    expect(await ConfigureNextAsMajorAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should be active regardless of a feature-freeze/release-candidate train', async () => {\n-    expect(await ConfigureNextAsMajorAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should not be active if the next branch is for a major', async () => {\n-    expect(await ConfigureNextAsMajorAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('11.0.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should compute proper version and create staging pull request', async () => {\n-    const action = setupReleaseActionForTesting(ConfigureNextAsMajorAction, {\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-    });\n-\n-    const {repo, fork, gitClient} = action;\n-    const expectedVersion = `11.0.0-next.0`;\n-    const expectedForkBranch = `switch-next-to-major-${expectedVersion}`;\n-\n-    // We first mock the commit status check for the next branch, then expect two pull\n-    // requests from a fork that are targeting next and the new feature-freeze branch.\n-    repo.expectBranchRequest('master', 'MASTER_COMMIT_SHA')\n-        .expectCommitStatusCheck('MASTER_COMMIT_SHA', 'success')\n-        .expectFindForkRequest(fork)\n-        .expectPullRequestToBeCreated('master', fork, expectedForkBranch, 200);\n-\n-    // In the fork, we make the staging branch appear as non-existent,\n-    // so that the PR can be created properly without collisions.\n-    fork.expectBranchRequest(expectedForkBranch, null);\n-\n-    await action.instance.perform();\n-\n-    expect(gitClient.pushed.length).toBe(1);\n-    expect(gitClient.pushed[0])\n-        .toEqual(\n-            getBranchPushMatcher({\n-              baseBranch: 'master',\n-              baseRepo: repo,\n-              targetBranch: expectedForkBranch,\n-              targetRepo: fork,\n-              expectedCommits: [{\n-                message: `release: switch the next branch to v${expectedVersion}`,\n-                files: ['package.json'],\n-              }],\n-            }),\n-            'Expected the update branch to be created in fork for a pull request.');\n-  });\n-});"
        },
        {
            "sha": "d27bbd60883d649aabc6e55e9da2fd7c7d282105",
            "filename": "dev-infra/release/publish/test/cut-lts-patch.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 110,
            "changes": 110,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-lts-patch.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-lts-patch.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-lts-patch.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,110 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {matchesVersion} from '../../../utils/testing/semver-matchers';\n-import {fetchLongTermSupportBranchesFromNpm} from '../../versioning/long-term-support';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {CutLongTermSupportPatchAction} from '../actions/cut-lts-patch';\n-\n-import {expectStagingAndPublishWithCherryPick, fakeNpmPackageQueryRequest, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting, testTmpDir} from './test-utils';\n-\n-describe('cut an LTS patch action', () => {\n-  it('should be active', async () => {\n-    expect(await CutLongTermSupportPatchAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should be active if there is a feature-freeze train', async () => {\n-    expect(await CutLongTermSupportPatchAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.3')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should be active if there is a release-candidate train', async () => {\n-    expect(await CutLongTermSupportPatchAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should compute proper new version and select correct branch', async () => {\n-    const action = setupReleaseActionForTesting(CutLongTermSupportPatchAction, {\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-    });\n-\n-    spyOn<any>(action.instance, '_promptForTargetLtsBranch')\n-        .and.resolveTo({name: '9.2.x', version: parse('9.2.4'), npmDistTag: 'v9-lts'});\n-\n-    await expectStagingAndPublishWithCherryPick(action, '9.2.x', '9.2.5', 'v9-lts');\n-  });\n-\n-  it('should include number of active LTS branches in action description', async () => {\n-    const {releaseConfig, gitClient} = getTestingMocksForReleaseAction();\n-    const activeReleaseTrains = {\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-    };\n-\n-    fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {\n-      'dist-tags': {'v9-lts': '9.1.2', 'v8-lts': '8.2.2'},\n-      'time': {\n-        '9.0.0': new Date().toISOString(),\n-        '8.0.0': new Date().toISOString(),\n-      },\n-    });\n-\n-    const action = new CutLongTermSupportPatchAction(\n-        activeReleaseTrains, gitClient, releaseConfig, testTmpDir);\n-\n-    expect(await action.getDescription())\n-        .toEqual(`Cut a new release for an active LTS branch (2 active).`);\n-  });\n-\n-  it('should properly determine active and inactive LTS branches', async () => {\n-    const {releaseConfig} = getTestingMocksForReleaseAction();\n-    fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {\n-      'dist-tags': {\n-        'v9-lts': '9.2.3',\n-        'v8-lts': '8.4.4',\n-        'v7-lts': '7.0.1',\n-        'v6-lts': '6.0.0',\n-      },\n-      time: {\n-        '9.0.0': new Date().toISOString(),\n-        '8.0.0': new Date().toISOString(),\n-        // We pick dates for the v6 and v7 major versions that guarantee that the version\n-        // is no longer considered as active LTS version.\n-        '7.0.0': new Date(1912, 5, 23).toISOString(),\n-        '6.0.0': new Date(1912, 5, 23).toISOString(),\n-      },\n-    });\n-\n-    // Note: This accesses a private method, so we need to use an element access to satisfy\n-    // TypeScript. It is acceptable to access the member for fine-grained unit testing due to\n-    // complexity with inquirer we want to avoid. It is not easy to test prompts.\n-    const {active, inactive} = await fetchLongTermSupportBranchesFromNpm(releaseConfig);\n-\n-    expect(active).toEqual([\n-      {name: '9.2.x', version: matchesVersion('9.2.3'), npmDistTag: 'v9-lts'},\n-      {name: '8.4.x', version: matchesVersion('8.4.4'), npmDistTag: 'v8-lts'},\n-    ]);\n-    expect(inactive).toEqual([\n-      {name: '7.0.x', version: matchesVersion('7.0.1'), npmDistTag: 'v7-lts'},\n-      {name: '6.0.x', version: matchesVersion('6.0.0'), npmDistTag: 'v6-lts'},\n-    ]);\n-  });\n-});"
        },
        {
            "sha": "9df19191f01cc114841c27b50bc21bca92041ef1",
            "filename": "dev-infra/release/publish/test/cut-new-patch.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-new-patch.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-new-patch.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-new-patch.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,52 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {CutNewPatchAction} from '../actions/cut-new-patch';\n-\n-import {expectStagingAndPublishWithCherryPick, parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('cut new patch action', () => {\n-  it('should be active', async () => {\n-    expect(await CutNewPatchAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should compute proper new version and select correct branch', async () => {\n-    const action = setupReleaseActionForTesting(CutNewPatchAction, {\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.3')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.0.x', '10.0.3', 'latest');\n-  });\n-\n-  it('should create a proper new version if there is a feature-freeze release-train', async () => {\n-    const action = setupReleaseActionForTesting(CutNewPatchAction, {\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.3')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.9')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.0.x', '10.0.10', 'latest');\n-  });\n-\n-  it('should create a proper new version if there is a release-candidate train', async () => {\n-    const action = setupReleaseActionForTesting(CutNewPatchAction, {\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.9')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.0.x', '10.0.10', 'latest');\n-  });\n-});"
        },
        {
            "sha": "3802d6653eec1455e86e37f03c22afdad1fb7c8f",
            "filename": "dev-infra/release/publish/test/cut-next-prerelease.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 79,
            "changes": 79,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,79 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {readFileSync} from 'fs';\n-import {join} from 'path';\n-\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {CutNextPrereleaseAction} from '../actions/cut-next-prerelease';\n-import {packageJsonPath} from '../constants';\n-\n-import {expectStagingAndPublishWithCherryPick, expectStagingAndPublishWithoutCherryPick, parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('cut next pre-release action', () => {\n-  it('should always be active regardless of release-trains', async () => {\n-    expect(await CutNextPrereleaseAction.isActive()).toBe(true);\n-  });\n-\n-  it('should cut a pre-release for the next branch if there is no FF/RC branch', async () => {\n-    const action = setupReleaseActionForTesting(CutNextPrereleaseAction, {\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.1.x', parse('10.1.2')),\n-    });\n-\n-    await expectStagingAndPublishWithoutCherryPick(action, 'master', '10.2.0-next.1', 'next');\n-  });\n-\n-  // This is test for a special case in the release tooling. Whenever we branch off for\n-  // feature-freeze, we immediately bump the version in the `next` branch but do not publish\n-  // it. This is because there are no new changes in the next branch that wouldn't be part of\n-  // the branched-off feature-freeze release-train. Also while a FF/RC is active, we cannot\n-  // publish versions to the NPM dist tag. This means that the version is later published, but\n-  // still needs all the staging work (e.g. changelog). We special-case this by not incrementing\n-  // the version if the version in the next branch has not been published yet.\n-  it('should not bump version if current next version has not been published', async () => {\n-    const action = setupReleaseActionForTesting(\n-        CutNextPrereleaseAction, {\n-          releaseCandidate: null,\n-          next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-          latest: new ReleaseTrain('10.1.x', parse('10.1.0')),\n-        },\n-        /* isNextPublishedToNpm */ false);\n-\n-    await expectStagingAndPublishWithoutCherryPick(action, 'master', '10.2.0-next.0', 'next');\n-\n-    const pkgJsonContents = readFileSync(join(action.testTmpDir, packageJsonPath), 'utf8');\n-    const pkgJson = JSON.parse(pkgJsonContents) as {version: string, [key: string]: any};\n-    expect(pkgJson.version).toBe('10.2.0-next.0', 'Expected version to not have changed.');\n-  });\n-\n-  describe('with active feature-freeze', () => {\n-    it('should create a proper new version and select correct branch', async () => {\n-      const action = setupReleaseActionForTesting(CutNextPrereleaseAction, {\n-        releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.4')),\n-        next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-        latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-      });\n-\n-      await expectStagingAndPublishWithCherryPick(action, '10.1.x', '10.1.0-next.5', 'next');\n-    });\n-  });\n-\n-  describe('with active release-candidate', () => {\n-    it('should create a proper new version and select correct branch', async () => {\n-      const action = setupReleaseActionForTesting(CutNextPrereleaseAction, {\n-        releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-        next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-        latest: new ReleaseTrain('10.0.x', parse('10.0.2')),\n-      });\n-\n-      await expectStagingAndPublishWithCherryPick(action, '10.1.x', '10.1.0-rc.1', 'next');\n-    });\n-  });\n-});"
        },
        {
            "sha": "abb913f0903eb1427d156112909a7b95415bdd64",
            "filename": "dev-infra/release/publish/test/cut-release-candidate-for-feature-freeze.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 49,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-release-candidate-for-feature-freeze.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-release-candidate-for-feature-freeze.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-release-candidate-for-feature-freeze.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,49 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {CutReleaseCandidateForFeatureFreezeAction} from '../actions/cut-release-candidate-for-feature-freeze';\n-\n-import {expectStagingAndPublishWithCherryPick, parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('cut release candidate for feature-freeze action', () => {\n-  it('should activate if a feature-freeze release-train is active', async () => {\n-    expect(await CutReleaseCandidateForFeatureFreezeAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should not activate if release-candidate release-train is active', async () => {\n-    expect(await CutReleaseCandidateForFeatureFreezeAction.isActive({\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should not activate if no FF/RC release-train is active', async () => {\n-    expect(await CutReleaseCandidateForFeatureFreezeAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should create a proper new version and select correct branch', async () => {\n-    const action = setupReleaseActionForTesting(CutReleaseCandidateForFeatureFreezeAction, {\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.1.x', '10.1.0-rc.0', 'next');\n-  });\n-});"
        },
        {
            "sha": "850a57b5a3fbb4a792cd3953dbf157ad82942d6c",
            "filename": "dev-infra/release/publish/test/cut-stable.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-stable.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,87 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {matchesVersion} from '../../../utils/testing/semver-matchers';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {CutStableAction} from '../actions/cut-stable';\n-import * as externalCommands from '../external-commands';\n-\n-import {expectStagingAndPublishWithCherryPick, parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('cut stable action', () => {\n-  it('should not activate if a feature-freeze release-train is active', async () => {\n-    expect(await CutStableAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should activate if release-candidate release-train is active', async () => {\n-    expect(await CutStableAction.isActive({\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should not activate if no FF/RC release-train is active', async () => {\n-    expect(await CutStableAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should create a proper new version and select correct branch', async () => {\n-    const action = setupReleaseActionForTesting(CutStableAction, {\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.1.x', '10.1.0', 'latest');\n-  });\n-\n-  it('should not tag the previous latest release-train if a minor has been cut', async () => {\n-    const action = setupReleaseActionForTesting(CutStableAction, {\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    });\n-\n-    await expectStagingAndPublishWithCherryPick(action, '10.1.x', '10.1.0', 'latest');\n-    expect(externalCommands.invokeSetNpmDistCommand).toHaveBeenCalledTimes(0);\n-  });\n-\n-  it('should tag the previous latest release-train if a major has been cut', async () => {\n-    const action = setupReleaseActionForTesting(CutStableAction, {\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('11.0.x', parse('11.0.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    });\n-\n-    // Ensure that the NPM dist tag is set only for packages that were available in the previous\n-    // major version. A spy has already been installed on the function.\n-    (externalCommands.invokeSetNpmDistCommand as jasmine.Spy).and.callFake(() => {\n-      expect(action.gitClient.head.ref?.name).toBe('10.0.x');\n-      return Promise.resolve();\n-    });\n-\n-    // Major is released to the `next` NPM dist tag initially. Can be re-tagged with\n-    // a separate release action. See `CutStableAction` for more details.\n-    await expectStagingAndPublishWithCherryPick(action, '11.0.x', '11.0.0', 'next');\n-    expect(externalCommands.invokeSetNpmDistCommand).toHaveBeenCalledTimes(1);\n-    expect(externalCommands.invokeSetNpmDistCommand)\n-        .toHaveBeenCalledWith('v10-lts', matchesVersion('10.0.3'));\n-  });\n-});"
        },
        {
            "sha": "084b9097dc8921ef147831b00b9c27c1096fce63",
            "filename": "dev-infra/release/publish/test/github-api-testing.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 81,
            "changes": 81,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fgithub-api-testing.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fgithub-api-testing.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fgithub-api-testing.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,81 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as nock from 'nock';\n-\n-/**\n- * Class that represents a Github repository in testing. The class can be\n- * used to intercept and except Github API requests for release actions.\n- */\n-export class GithubTestingRepo {\n-  /** Github API endpoint. */\n-  private apiEndpoint = `https://api.github.com`;\n-\n-  /** Github API url for the given repository. */\n-  private repoApiUrl = `${this.apiEndpoint}/repos/${this.owner}/${this.name}`;\n-\n-  constructor(public owner: string, public name: string) {}\n-\n-  expectPullRequestToBeCreated(\n-      baseBranch: string, fork: GithubTestingRepo, forkBranch: string, prNumber: number): this {\n-    const expectedHead = `${fork.owner}:${forkBranch}`;\n-    nock(this.repoApiUrl)\n-        .post('/pulls', ({base, head}) => base === baseBranch && head === expectedHead)\n-        .reply(200, {number: prNumber});\n-    return this;\n-  }\n-\n-  expectBranchRequest(branchName: string, sha: string|null): this {\n-    nock(this.repoApiUrl)\n-        .get(`/branches/${branchName}`)\n-        .reply(sha ? 200 : 404, sha ? {commit: {sha}} : undefined);\n-    return this;\n-  }\n-\n-  expectFindForkRequest(fork: GithubTestingRepo): this {\n-    nock(this.apiEndpoint)\n-        .post(\n-            '/graphql',\n-            ({variables}) => variables.owner === this.owner && variables.name === this.name)\n-        .reply(200, {\n-          data: {repository: {forks: {nodes: [{owner: {login: fork.owner}, name: fork.name}]}}}\n-        });\n-    return this;\n-  }\n-\n-  expectCommitStatusCheck(sha: string, state: 'success'|'pending'|'failure'): this {\n-    nock(this.repoApiUrl).get(`/commits/${sha}/status`).reply(200, {state}).activeMocks();\n-    return this;\n-  }\n-\n-  expectPullRequestWait(prNumber: number): this {\n-    // The pull request state could be queried multiple times, so we persist\n-    // this mock request. By default, nock only mocks requests once.\n-    nock(this.repoApiUrl).get(`/pulls/${prNumber}`).reply(200, {merged: true}).persist();\n-    return this;\n-  }\n-\n-  expectCommitRequest(sha: string, message: string): this {\n-    nock(this.repoApiUrl).get(`/commits/${sha}`).reply(200, {commit: {message}});\n-    return this;\n-  }\n-\n-  expectTagToBeCreated(tagName: string, sha: string): this {\n-    nock(this.repoApiUrl)\n-        .post(`/git/refs`, b => b.ref === `refs/tags/${tagName}` && b.sha === sha)\n-        .reply(200, {});\n-    return this;\n-  }\n-\n-  expectReleaseToBeCreated(name: string, tagName: string): this {\n-    nock(this.repoApiUrl)\n-        .post('/releases', b => b.name === name && b['tag_name'] === tagName)\n-        .reply(200, {});\n-    return this;\n-  }\n-}"
        },
        {
            "sha": "bf84b90b6bfb9bc9a05167ead446f5d6472cce07",
            "filename": "dev-infra/release/publish/test/move-next-into-feature-freeze.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 68,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-feature-freeze.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-feature-freeze.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-feature-freeze.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,68 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {MoveNextIntoFeatureFreezeAction} from '../actions/move-next-into-feature-freeze';\n-\n-import {expectBranchOffActionToRun} from './branch-off-next-branch-testing';\n-import {parse} from './test-utils';\n-\n-describe('move next into feature-freeze action', () => {\n-  it('should not activate if a feature-freeze release-train is active', async () => {\n-    expect(await MoveNextIntoFeatureFreezeAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should not activate if release-candidate release-train is active', async () => {\n-    expect(await MoveNextIntoFeatureFreezeAction.isActive({\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should not activate if the next release-train is for a minor', async () => {\n-    expect(await MoveNextIntoFeatureFreezeAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.2')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should activate if no FF/RC release-train is active', async () => {\n-    expect(await MoveNextIntoFeatureFreezeAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('11.0.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should create pull requests and feature-freeze branch', async () => {\n-    await expectBranchOffActionToRun(\n-        MoveNextIntoFeatureFreezeAction, {\n-          releaseCandidate: null,\n-          next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-          latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-        },\n-        /* isNextPublishedToNpm */ true, '10.3.0-next.0', '10.2.0-next.1', '10.2.x');\n-  });\n-\n-  it('should not increment the version if \"next\" version is not yet published', async () => {\n-    await expectBranchOffActionToRun(\n-        MoveNextIntoFeatureFreezeAction, {\n-          releaseCandidate: null,\n-          next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-          latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-        },\n-        /* isNextPublishedToNpm */ false, '10.3.0-next.0', '10.2.0-next.0', '10.2.x');\n-  });\n-});"
        },
        {
            "sha": "d12b2ae159fe435a86e109d369c284ef9902ae1e",
            "filename": "dev-infra/release/publish/test/move-next-into-release-candidate.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 58,
            "changes": 58,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-release-candidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-release-candidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fmove-next-into-release-candidate.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,58 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {MoveNextIntoReleaseCandidateAction} from '../actions/move-next-into-release-candidate';\n-\n-import {expectBranchOffActionToRun} from './branch-off-next-branch-testing';\n-import {parse} from './test-utils';\n-\n-describe('move next into release-candidate action', () => {\n-  it('should not activate if a feature-freeze release-train is active', async () => {\n-    expect(await MoveNextIntoReleaseCandidateAction.isActive({\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-next.1')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should not activate if release-candidate release-train is active', async () => {\n-    expect(await MoveNextIntoReleaseCandidateAction.isActive({\n-      // No longer in feature-freeze but in release-candidate phase.\n-      releaseCandidate: new ReleaseTrain('10.1.x', parse('10.1.0-rc.0')),\n-      next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should not activate if the next release-train is for a major', async () => {\n-    expect(await MoveNextIntoReleaseCandidateAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('11.0.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(false);\n-  });\n-\n-  it('should activate if no FF/RC release-train is active', async () => {\n-    expect(await MoveNextIntoReleaseCandidateAction.isActive({\n-      releaseCandidate: null,\n-      next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-      latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-    })).toBe(true);\n-  });\n-\n-  it('should create pull requests and new version-branch', async () => {\n-    await expectBranchOffActionToRun(\n-        MoveNextIntoReleaseCandidateAction, {\n-          releaseCandidate: null,\n-          next: new ReleaseTrain('master', parse('10.2.0-next.0')),\n-          latest: new ReleaseTrain('10.0.x', parse('10.0.3')),\n-        },\n-        /* isNextPublishedToNpm */ true, '10.3.0-next.0', '10.2.0-rc.0', '10.2.x');\n-  });\n-});"
        },
        {
            "sha": "40553742cc3fa22f5b9d072797dcc082d25206b6",
            "filename": "dev-infra/release/publish/test/release-notes/context.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 168,
            "changes": 168,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Fcontext.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Fcontext.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Fcontext.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,168 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {CommitFromGitLog, parseCommitFromGitLog} from '../../../../commit-message/parse';\n-import {commitMessageBuilder} from '../../../../commit-message/test-util';\n-import {RenderContext, RenderContextData,} from '../../../notes/context';\n-\n-const defaultContextData: RenderContextData = {\n-  commits: [],\n-  github: {\n-    name: 'repoName',\n-    owner: 'repoOwner',\n-  },\n-  title: false,\n-  version: '1.2.3',\n-};\n-\n-describe('RenderContext', () => {\n-  beforeAll(() => {\n-    jasmine.clock().install();\n-  });\n-\n-  it('contains a date stamp using the current date by default', async () => {\n-    jasmine.clock().mockDate(new Date(1996, 11, 11));\n-    const renderContext = new RenderContext(defaultContextData);\n-    expect(renderContext.dateStamp).toBe('1996-12-11');\n-  });\n-\n-  it('contains a date stamp using a provided date', async () => {\n-    const data = {...defaultContextData, date: new Date(2000, 0, 20)};\n-    const renderContext = new RenderContext(data);\n-    expect(renderContext.dateStamp).toBe('2000-01-20');\n-  });\n-\n-  it('filters to include only commits which have specified field', () => {\n-    const renderContext = new RenderContext(defaultContextData);\n-    const matchingCommits = commitsFromList(2, 15);\n-    expect(commits.filter(renderContext.contains('breakingChanges'))).toEqual(matchingCommits);\n-  });\n-\n-  it('filters to include only the first commit discovered with a unique value for a specified field',\n-     () => {\n-       const renderContext = new RenderContext(defaultContextData);\n-       const matchingCommits = commitsFromList(0, 1, 2, 3, 4, 7, 12);\n-       expect(commits.filter(renderContext.unique('type'))).toEqual(matchingCommits);\n-     });\n-\n-\n-  describe('filters to include commits which are to be included in the release notes', () => {\n-    it('including all scopes by default', () => {\n-      const renderContext = new RenderContext(defaultContextData);\n-      const matchingCommits = commitsFromList(0, 2, 5, 6, 8, 10, 11, 12, 15, 16);\n-      expect(commits.filter(renderContext.includeInReleaseNotes())).toEqual(matchingCommits);\n-    });\n-\n-    it('excluding hidden scopes defined in the config', () => {\n-      const renderContext = new RenderContext({...defaultContextData, hiddenScopes: ['core']});\n-      const matchingCommits = commitsFromList(0, 2, 6, 8, 10, 11, 15, 16);\n-      expect(commits.filter(renderContext.includeInReleaseNotes())).toEqual(matchingCommits);\n-    });\n-  });\n-\n-  describe('organized lists of commits into groups', () => {\n-    let devInfraCommits: CommitFromGitLog[];\n-    let coreCommits: CommitFromGitLog[];\n-    let compilerCommits: CommitFromGitLog[];\n-    let unorganizedCommits: CommitFromGitLog[];\n-    function assertOrganizedGroupsMatch(\n-        generatedGroups: {title: string, commits: CommitFromGitLog[]}[],\n-        providedGroups: {title: string, commits: CommitFromGitLog[]}[]) {\n-      expect(generatedGroups.length).toBe(providedGroups.length);\n-      generatedGroups.forEach(({title, commits}, idx) => {\n-        expect(title).toBe(providedGroups[idx].title);\n-        expect(commits).toEqual(jasmine.arrayWithExactContents(providedGroups[idx].commits));\n-      });\n-    }\n-\n-    beforeEach(() => {\n-      devInfraCommits = commits.filter(c => c.scope === 'dev-infra');\n-      coreCommits = commits.filter(c => c.scope === 'core');\n-      compilerCommits = commits.filter(c => c.scope === 'compiler');\n-      unorganizedCommits =\n-          [...devInfraCommits, ...coreCommits, ...compilerCommits].sort(() => Math.random() - 0.5);\n-    });\n-\n-\n-\n-    it('with default sorting', () => {\n-      const renderContext = new RenderContext(defaultContextData);\n-      const organizedCommits = renderContext.asCommitGroups(unorganizedCommits);\n-\n-      assertOrganizedGroupsMatch(organizedCommits, [\n-        {title: 'compiler', commits: compilerCommits},\n-        {title: 'core', commits: coreCommits},\n-        {title: 'dev-infra', commits: devInfraCommits},\n-      ]);\n-    });\n-\n-    it('sorted by the provided order in the config', () => {\n-      const renderContext =\n-          new RenderContext({...defaultContextData, groupOrder: ['core', 'dev-infra']});\n-      const organizedCommits = renderContext.asCommitGroups(unorganizedCommits);\n-\n-      assertOrganizedGroupsMatch(organizedCommits, [\n-        {title: 'core', commits: coreCommits},\n-        {title: 'dev-infra', commits: devInfraCommits},\n-        {title: 'compiler', commits: compilerCommits},\n-      ]);\n-    });\n-  });\n-\n-  afterAll(() => {\n-    jasmine.clock().uninstall();\n-  });\n-});\n-\n-\n-\n-const buildCommitMessage = commitMessageBuilder({\n-  prefix: '',\n-  type: '',\n-  npmScope: '',\n-  scope: '',\n-  summary: 'This is a short summary of the change',\n-  body: 'This is a longer description of the change',\n-  footer: '',\n-});\n-\n-function buildCommit(type: string, scope: string, withBreakingChange = false) {\n-  const footer = withBreakingChange ? 'BREAKING CHANGE: something is broken now' : '';\n-  const parts = {type, scope, footer};\n-  return parseCommitFromGitLog(Buffer.from(buildCommitMessage(parts)));\n-}\n-\n-\n-function commitsFromList(...indexes: number[]) {\n-  const output: CommitFromGitLog[] = [];\n-  for (const i of indexes) {\n-    output.push(commits[i]);\n-  }\n-  return output;\n-}\n-\n-\n-const commits: CommitFromGitLog[] = [\n-  buildCommit('fix', 'platform-browser'),\n-  buildCommit('test', 'dev-infra'),\n-  buildCommit('feat', 'dev-infra', true),\n-  buildCommit('build', 'docs-infra'),\n-  buildCommit('docs', 'router'),\n-  buildCommit('feat', 'core'),\n-  buildCommit('feat', 'common'),\n-  buildCommit('refactor', 'compiler'),\n-  buildCommit('fix', 'docs-infra'),\n-  buildCommit('test', 'core'),\n-  buildCommit('feat', 'compiler-cli'),\n-  buildCommit('fix', 'dev-infra'),\n-  buildCommit('perf', 'core'),\n-  buildCommit('docs', 'forms'),\n-  buildCommit('refactor', 'dev-infra'),\n-  buildCommit('feat', 'docs-infra', true),\n-  buildCommit('fix', 'compiler'),\n-];"
        },
        {
            "sha": "1f7a4ad32d8858ce8ded807e6f541daea5fb8e5d",
            "filename": "dev-infra/release/publish/test/release-notes/release-notes-utils.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Frelease-notes-utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Frelease-notes-utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Frelease-notes%2Frelease-notes-utils.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {DevInfraReleaseConfig, ReleaseConfig} from '../../../config';\n-import {ReleaseNotes} from '../../../notes/release-notes';\n-\n-/**\n- * Mock version of the ReleaseNotes for testing, preventing actual calls to git for commits and\n- * returning versioned entry strings.\n- */\n-class MockReleaseNotes extends ReleaseNotes {\n-  static override async fromRange(version: semver.SemVer, startingRef: string, endingRef: string) {\n-    return new MockReleaseNotes(version, startingRef, endingRef);\n-  }\n-\n-  override async getChangelogEntry() {\n-    return `Changelog Entry for ${this.version}`;\n-  }\n-\n-  override async getGithubReleaseEntry() {\n-    return `Github Release Entry for ${this.version}`;\n-  }\n-\n-  // Overrides of utility functions which call out to other tools and are unused in this mock.\n-  protected override async getCommitsInRange(from: string, to?: string) {\n-    return [];\n-  }\n-  protected override getReleaseConfig(config?: Partial<DevInfraReleaseConfig>) {\n-    return {} as ReleaseConfig;\n-  }\n-}\n-\n-/** Replace the ReleaseNotes static builder function with the MockReleaseNotes builder function. */\n-export function installMockReleaseNotes() {\n-  spyOn(ReleaseNotes, 'fromRange').and.callFake(MockReleaseNotes.fromRange);\n-}"
        },
        {
            "sha": "0bd42463c2cfcd26992104b8e4c49f5425ef6e8a",
            "filename": "dev-infra/release/publish/test/tag-recent-major-as-latest.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 116,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftag-recent-major-as-latest.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,116 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {matchesVersion} from '../../../utils/testing';\n-import {ReleaseTrain} from '../../versioning/release-trains';\n-import {TagRecentMajorAsLatest} from '../actions/tag-recent-major-as-latest';\n-import * as externalCommands from '../external-commands';\n-\n-import {fakeNpmPackageQueryRequest, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting} from './test-utils';\n-\n-describe('tag recent major as latest action', () => {\n-  it('should not be active if a patch has been published after major release', async () => {\n-    const {releaseConfig} = getTestingMocksForReleaseAction();\n-    expect(await TagRecentMajorAsLatest.isActive(\n-               {\n-                 releaseCandidate: null,\n-                 next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-                 latest: new ReleaseTrain('10.0.x', parse('10.0.1')),\n-               },\n-               releaseConfig))\n-        .toBe(false);\n-  });\n-\n-  it('should not be active if a major has been released recently but \"@latest\" on NPM points to ' +\n-         'a more recent major',\n-     async () => {\n-       const {releaseConfig} = getTestingMocksForReleaseAction();\n-\n-       // NPM `@latest` will point to a patch release of a more recent major. This is unlikely\n-       // to happen (only with manual changes outside of the release tool), but should\n-       // prevent accidental overrides from the release action.\n-       fakeNpmPackageQueryRequest(\n-           releaseConfig.npmPackages[0], {'dist-tags': {'latest': '11.0.3'}});\n-\n-       expect(await TagRecentMajorAsLatest.isActive(\n-                  {\n-                    releaseCandidate: null,\n-                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n-                  },\n-                  releaseConfig))\n-           .toBe(false);\n-     });\n-\n-  it('should not be active if a major has been released recently but \"@latest\" on NPM points to ' +\n-         'an older major',\n-     async () => {\n-       const {releaseConfig} = getTestingMocksForReleaseAction();\n-\n-       // NPM `@latest` will point to a patch release of an older major. This is unlikely to happen\n-       // (only with manual changes outside of the release tool), but should prevent accidental\n-       // changes from the release action that indicate mismatched version branches, or an\n-       // out-of-sync NPM registry.\n-       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '8.4.7'}});\n-\n-       expect(await TagRecentMajorAsLatest.isActive(\n-                  {\n-                    releaseCandidate: null,\n-                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n-                  },\n-                  releaseConfig))\n-           .toBe(false);\n-     });\n-\n-\n-  it('should be active if a major has been released recently but is not published as ' +\n-         '\"@latest\" to NPM',\n-     async () => {\n-       const {releaseConfig} = getTestingMocksForReleaseAction();\n-\n-       // NPM `@latest` will point to a patch release of the previous major.\n-       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '9.2.3'}});\n-\n-       expect(await TagRecentMajorAsLatest.isActive(\n-                  {\n-                    releaseCandidate: null,\n-                    next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-                    latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n-                  },\n-                  releaseConfig))\n-           .toBe(true);\n-     });\n-\n-  it('should be active if a major has been released recently but is not published as ' +\n-         '\"@latest\" to NPM',\n-     async () => {\n-       const {instance, gitClient, releaseConfig} =\n-           setupReleaseActionForTesting(TagRecentMajorAsLatest, {\n-             releaseCandidate: null,\n-             next: new ReleaseTrain('master', parse('10.1.0-next.0')),\n-             latest: new ReleaseTrain('10.0.x', parse('10.0.0')),\n-           });\n-\n-       // NPM `@latest` will point to a patch release of the previous major.\n-       fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {'latest': '9.2.3'}});\n-\n-       await instance.perform();\n-\n-       // Ensure that the NPM dist tag is set only for packages that were available in the previous\n-       // major version. A spy has already been installed on the function.\n-       (externalCommands.invokeSetNpmDistCommand as jasmine.Spy).and.callFake(() => {\n-         expect(gitClient.head.ref?.name).toBe('10.0.x');\n-         return Promise.resolve();\n-       });\n-\n-       expect(externalCommands.invokeSetNpmDistCommand).toHaveBeenCalledTimes(1);\n-       expect(externalCommands.invokeSetNpmDistCommand)\n-           .toHaveBeenCalledWith('latest', matchesVersion('10.0.0'));\n-     });\n-});"
        },
        {
            "sha": "3681e3c2c0290c534aa67232eb16df433ef61376",
            "filename": "dev-infra/release/publish/test/test-utils.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 245,
            "changes": 245,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,245 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {writeFileSync} from 'fs';\n-import * as nock from 'nock';\n-import {join} from 'path';\n-import * as semver from 'semver';\n-\n-import {GithubConfig} from '../../../utils/config';\n-import * as console from '../../../utils/console';\n-import {getBranchPushMatcher, installVirtualGitClientSpies, VirtualGitClient} from '../../../utils/testing';\n-import {ReleaseConfig} from '../../config/index';\n-import {ActiveReleaseTrains} from '../../versioning/active-release-trains';\n-import * as npm from '../../versioning/npm-publish';\n-import {_npmPackageInfoCache, NpmDistTag, NpmPackageInfo} from '../../versioning/npm-registry';\n-import {ReleaseAction, ReleaseActionConstructor} from '../actions';\n-import * as constants from '../constants';\n-import * as externalCommands from '../external-commands';\n-\n-import {GithubTestingRepo} from './github-api-testing';\n-import {installMockReleaseNotes} from './release-notes/release-notes-utils';\n-\n-/**\n- * Temporary directory which will be used as project directory in tests. Note that\n- * this environment variable is automatically set by Bazel for tests.\n- */\n-export const testTmpDir: string = process.env['TEST_TMPDIR']!;\n-\n-/** Interface describing a test release action. */\n-export interface TestReleaseAction<T extends ReleaseAction = ReleaseAction> {\n-  instance: T;\n-  gitClient: VirtualGitClient;\n-  repo: GithubTestingRepo;\n-  fork: GithubTestingRepo;\n-  testTmpDir: string;\n-  githubConfig: GithubConfig;\n-  releaseConfig: ReleaseConfig;\n-}\n-\n-/** Gets necessary test mocks for running a release action. */\n-export function getTestingMocksForReleaseAction() {\n-  const githubConfig = {owner: 'angular', name: 'dev-infra-test'};\n-  const gitClient = VirtualGitClient.createInstance({github: githubConfig});\n-  const releaseConfig: ReleaseConfig = {\n-    npmPackages: [\n-      '@angular/pkg1',\n-      '@angular/pkg2',\n-    ],\n-    releaseNotes: {},\n-    buildPackages: () => {\n-      throw Error('Not implemented');\n-    },\n-  };\n-  return {githubConfig, gitClient, releaseConfig};\n-}\n-\n-/**\n- * Sets up the given release action for testing.\n- * @param actionCtor Type of release action to be tested.\n- * @param active Fake active release trains for the action,\n- * @param isNextPublishedToNpm Whether the next version is published to NPM. True by default.\n- */\n-export function setupReleaseActionForTesting<T extends ReleaseAction>(\n-    actionCtor: ReleaseActionConstructor<T>, active: ActiveReleaseTrains,\n-    isNextPublishedToNpm = true): TestReleaseAction<T> {\n-  // Reset existing HTTP interceptors.\n-  nock.cleanAll();\n-\n-  const {gitClient, githubConfig, releaseConfig} = getTestingMocksForReleaseAction();\n-  const repo = new GithubTestingRepo(githubConfig.owner, githubConfig.name);\n-  const fork = new GithubTestingRepo('some-user', 'fork');\n-\n-  installVirtualGitClientSpies(gitClient);\n-  installMockReleaseNotes();\n-\n-  // The version for the release-train in the next phase does not necessarily need to be\n-  // published to NPM. We mock the NPM package request and fake the state of the next\n-  // version based on the `isNextPublishedToNpm` testing parameter. More details on the\n-  // special case for the next release train can be found in the next pre-release action.\n-  fakeNpmPackageQueryRequest(\n-      releaseConfig.npmPackages[0],\n-      {versions: {[active.next.version.format()]: isNextPublishedToNpm ? {} : undefined}});\n-\n-  const action = new actionCtor(active, gitClient, releaseConfig, testTmpDir);\n-\n-  // Fake confirm any prompts. We do not want to make any changelog edits and\n-  // just proceed with the release action.\n-  spyOn(console, 'promptConfirm').and.resolveTo(true);\n-\n-  // Fake all external commands for the release tool.\n-  spyOn(npm, 'runNpmPublish').and.resolveTo();\n-  spyOn(externalCommands, 'invokeSetNpmDistCommand').and.resolveTo();\n-  spyOn(externalCommands, 'invokeYarnInstallCommand').and.resolveTo();\n-  spyOn(externalCommands, 'invokeReleaseBuildCommand').and.resolveTo([\n-    {name: '@angular/pkg1', outputPath: `${testTmpDir}/dist/pkg1`},\n-    {name: '@angular/pkg2', outputPath: `${testTmpDir}/dist/pkg2`}\n-  ]);\n-\n-  // Fake checking the package versions since we don't actually create packages to check against in\n-  // the publish tests.\n-  spyOn(ReleaseAction.prototype, '_verifyPackageVersions' as any).and.resolveTo();\n-\n-  // Create an empty changelog and a `package.json` file so that file system\n-  // interactions with the project directory do not cause exceptions.\n-  writeFileSync(join(testTmpDir, 'CHANGELOG.md'), 'Existing changelog');\n-  writeFileSync(join(testTmpDir, 'package.json'), JSON.stringify({version: '0.0.0'}));\n-\n-  // Override the default pull request wait interval to a number of milliseconds that can be\n-  // awaited in Jasmine tests. The default interval of 10sec is too large and causes a timeout.\n-  Object.defineProperty(constants, 'waitForPullRequestInterval', {value: 50});\n-\n-  return {instance: action, repo, fork, testTmpDir, githubConfig, releaseConfig, gitClient};\n-}\n-\n-/** Parses the specified version into Semver. */\n-export function parse(version: string): semver.SemVer {\n-  return semver.parse(version)!;\n-}\n-\n-export async function expectStagingAndPublishWithoutCherryPick(\n-    action: TestReleaseAction, expectedBranch: string, expectedVersion: string,\n-    expectedNpmDistTag: NpmDistTag) {\n-  const {repo, fork, gitClient} = action;\n-  const expectedStagingForkBranch = `release-stage-${expectedVersion}`;\n-  const expectedTagName = expectedVersion;\n-\n-  // We first mock the commit status check for the next branch, then expect two pull\n-  // requests from a fork that are targeting next and the new feature-freeze branch.\n-  repo.expectBranchRequest(expectedBranch, 'MASTER_COMMIT_SHA')\n-      .expectCommitStatusCheck('MASTER_COMMIT_SHA', 'success')\n-      .expectFindForkRequest(fork)\n-      .expectPullRequestToBeCreated(expectedBranch, fork, expectedStagingForkBranch, 200)\n-      .expectPullRequestWait(200)\n-      .expectBranchRequest(expectedBranch, 'STAGING_COMMIT_SHA')\n-      .expectCommitRequest(\n-          'STAGING_COMMIT_SHA', `release: cut the v${expectedVersion} release\\n\\nPR Close #200.`)\n-      .expectTagToBeCreated(expectedTagName, 'STAGING_COMMIT_SHA')\n-      .expectReleaseToBeCreated(`v${expectedVersion}`, expectedTagName);\n-\n-  // In the fork, we make the staging branch appear as non-existent,\n-  // so that the PR can be created properly without collisions.\n-  fork.expectBranchRequest(expectedStagingForkBranch, null);\n-\n-  await action.instance.perform();\n-\n-  expect(gitClient.pushed.length).toBe(1);\n-  expect(gitClient.pushed[0])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseBranch: expectedBranch,\n-            baseRepo: repo,\n-            targetBranch: expectedStagingForkBranch,\n-            targetRepo: fork,\n-            expectedCommits: [{\n-              message: `release: cut the v${expectedVersion} release`,\n-              files: ['package.json', 'CHANGELOG.md'],\n-            }],\n-          }),\n-          'Expected release staging branch to be created in fork.');\n-\n-  expect(externalCommands.invokeReleaseBuildCommand).toHaveBeenCalledTimes(1);\n-  expect(npm.runNpmPublish).toHaveBeenCalledTimes(2);\n-  expect(npm.runNpmPublish)\n-      .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg1`, expectedNpmDistTag, undefined);\n-  expect(npm.runNpmPublish)\n-      .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg2`, expectedNpmDistTag, undefined);\n-}\n-\n-export async function expectStagingAndPublishWithCherryPick(\n-    action: TestReleaseAction, expectedBranch: string, expectedVersion: string,\n-    expectedNpmDistTag: NpmDistTag) {\n-  const {repo, fork, gitClient, releaseConfig} = action;\n-  const expectedStagingForkBranch = `release-stage-${expectedVersion}`;\n-  const expectedCherryPickForkBranch = `changelog-cherry-pick-${expectedVersion}`;\n-  const expectedTagName = expectedVersion;\n-\n-  // We first mock the commit status check for the next branch, then expect two pull\n-  // requests from a fork that are targeting next and the new feature-freeze branch.\n-  repo.expectBranchRequest(expectedBranch, 'MASTER_COMMIT_SHA')\n-      .expectCommitStatusCheck('MASTER_COMMIT_SHA', 'success')\n-      .expectFindForkRequest(fork)\n-      .expectPullRequestToBeCreated(expectedBranch, fork, expectedStagingForkBranch, 200)\n-      .expectPullRequestWait(200)\n-      .expectBranchRequest(expectedBranch, 'STAGING_COMMIT_SHA')\n-      .expectCommitRequest(\n-          'STAGING_COMMIT_SHA', `release: cut the v${expectedVersion} release\\n\\nPR Close #200.`)\n-      .expectTagToBeCreated(expectedTagName, 'STAGING_COMMIT_SHA')\n-      .expectReleaseToBeCreated(`v${expectedVersion}`, expectedTagName)\n-      .expectPullRequestToBeCreated('master', fork, expectedCherryPickForkBranch, 300)\n-      .expectPullRequestWait(300);\n-\n-  // In the fork, we make the staging and cherry-pick branches appear as\n-  // non-existent, so that the PRs can be created properly without collisions.\n-  fork.expectBranchRequest(expectedStagingForkBranch, null)\n-      .expectBranchRequest(expectedCherryPickForkBranch, null);\n-\n-  await action.instance.perform();\n-\n-  expect(gitClient.pushed.length).toBe(2);\n-  expect(gitClient.pushed[0])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseBranch: expectedBranch,\n-            baseRepo: repo,\n-            targetBranch: expectedStagingForkBranch,\n-            targetRepo: fork,\n-            expectedCommits: [{\n-              message: `release: cut the v${expectedVersion} release`,\n-              files: ['package.json', 'CHANGELOG.md'],\n-            }],\n-          }),\n-          'Expected release staging branch to be created in fork.');\n-\n-  expect(gitClient.pushed[1])\n-      .toEqual(\n-          getBranchPushMatcher({\n-            baseBranch: 'master',\n-            baseRepo: repo,\n-            targetBranch: expectedCherryPickForkBranch,\n-            targetRepo: fork,\n-            expectedCommits: [{\n-              message: `docs: release notes for the v${expectedVersion} release`,\n-              files: ['CHANGELOG.md'],\n-            }],\n-          }),\n-          'Expected cherry-pick branch to be created in fork.');\n-\n-  expect(externalCommands.invokeReleaseBuildCommand).toHaveBeenCalledTimes(1);\n-  expect(npm.runNpmPublish).toHaveBeenCalledTimes(2);\n-  expect(npm.runNpmPublish)\n-      .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg1`, expectedNpmDistTag, undefined);\n-  expect(npm.runNpmPublish)\n-      .toHaveBeenCalledWith(`${testTmpDir}/dist/pkg2`, expectedNpmDistTag, undefined);\n-}\n-\n-/** Fakes a NPM package query API request for the given package. */\n-export function fakeNpmPackageQueryRequest(pkgName: string, data: Partial<NpmPackageInfo>) {\n-  _npmPackageInfoCache[pkgName] =\n-      Promise.resolve({'dist-tags': {}, versions: {}, time: {}, ...data});\n-}"
        },
        {
            "sha": "3e2f49d3fcf273bc57511d530621a9b18f595138",
            "filename": "dev-infra/release/set-dist-tag/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 42,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fset-dist-tag%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,42 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-ts_library(\n-    name = \"set-dist-tag\",\n-    srcs = glob(\n-        [\n-            \"**/*.ts\",\n-        ],\n-        exclude = [\"*.spec.ts\"],\n-    ),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//ora\",\n-        \"@npm//semver\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    srcs = glob([\n-        \"*.spec.ts\",\n-    ]),\n-    deps = [\n-        \":set-dist-tag\",\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/release/versioning\",\n-        \"//dev-infra/utils/testing\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/node\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    deps = [\":test_lib\"],\n-)"
        },
        {
            "sha": "06c5e7e2a3b2295ab15a6bcdb6233f4309a9be39",
            "filename": "dev-infra/release/set-dist-tag/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fset-dist-tag%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,78 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ora from 'ora';\n-import * as semver from 'semver';\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {bold, debug, error, green, info, red} from '../../utils/console';\n-import {getReleaseConfig} from '../config/index';\n-import {setNpmTagForPackage} from '../versioning/npm-publish';\n-\n-\n-/** Command line options for setting an NPM dist tag. */\n-export interface ReleaseSetDistTagOptions {\n-  tagName: string;\n-  targetVersion: string;\n-}\n-\n-function builder(args: Argv): Argv<ReleaseSetDistTagOptions> {\n-  return args\n-      .positional('tagName', {\n-        type: 'string',\n-        demandOption: true,\n-        description: 'Name of the NPM dist tag.',\n-      })\n-      .positional('targetVersion', {\n-        type: 'string',\n-        demandOption: true,\n-        description: 'Version to which the dist tag should be set.'\n-      });\n-}\n-\n-/** Yargs command handler for building a release. */\n-async function handler(args: Arguments<ReleaseSetDistTagOptions>) {\n-  const {targetVersion: rawVersion, tagName} = args;\n-  const {npmPackages, publishRegistry} = getReleaseConfig();\n-  const version = semver.parse(rawVersion);\n-\n-  if (version === null) {\n-    error(red(`Invalid version specified (${rawVersion}). Unable to set NPM dist tag.`));\n-    process.exit(1);\n-  }\n-\n-  const spinner = ora.call(undefined).start();\n-  debug(`Setting \"${tagName}\" NPM dist tag for release packages to v${version}.`);\n-\n-  for (const pkgName of npmPackages) {\n-    spinner.text = `Setting NPM dist tag for \"${pkgName}\"`;\n-    spinner.render();\n-\n-    try {\n-      await setNpmTagForPackage(pkgName, tagName, version!, publishRegistry);\n-      debug(`Successfully set \"${tagName}\" NPM dist tag for \"${pkgName}\".`);\n-    } catch (e) {\n-      spinner.stop();\n-      error(e);\n-      error(red(`  ✘   An error occurred while setting the NPM dist tag for \"${pkgName}\".`));\n-      process.exit(1);\n-    }\n-  }\n-\n-  spinner.stop();\n-  info(green(`  ✓   Set NPM dist tag for all release packages.`));\n-  info(green(`      ${bold(tagName)} will now point to ${bold(`v${version}`)}.`));\n-}\n-\n-/** CLI command module for setting an NPM dist tag. */\n-export const ReleaseSetDistTagCommand: CommandModule<{}, ReleaseSetDistTagOptions> = {\n-  builder,\n-  handler,\n-  command: 'set-dist-tag <tag-name> <target-version>',\n-  describe: 'Sets a given NPM dist tag for all release packages.',\n-};"
        },
        {
            "sha": "13cbe1064a9c4ec6959c3c01e56b871ff2a18fe5",
            "filename": "dev-infra/release/set-dist-tag/set-dist-tag.spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2Fset-dist-tag.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fset-dist-tag%2Fset-dist-tag.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fset-dist-tag%2Fset-dist-tag.spec.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,73 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {matchesVersion} from '../../utils/testing/semver-matchers';\n-import * as releaseConfig from '../config/index';\n-import * as npm from '../versioning/npm-publish';\n-\n-import {ReleaseSetDistTagCommand} from './cli';\n-\n-describe('ng-dev release set-dist-tag', () => {\n-  let npmPackages: string[];\n-  let publishRegistry: string|undefined;\n-\n-  beforeEach(() => {\n-    npmPackages = ['@angular/pkg1', '@angular/pkg2'];\n-    publishRegistry = undefined;\n-\n-    spyOn(npm, 'setNpmTagForPackage');\n-    // We need to stub out the `process.exit` function during tests as the\n-    // CLI handler calls those in case of failures.\n-    spyOn(process, 'exit');\n-  });\n-\n-  /** Invokes the `set-dist-tag` command handler. */\n-  async function invokeCommand(tagName: string, targetVersion: string) {\n-    spyOn(releaseConfig, 'getReleaseConfig').and.returnValue({\n-      npmPackages,\n-      publishRegistry,\n-      buildPackages: async () => [],\n-      releaseNotes: {},\n-    });\n-    await ReleaseSetDistTagCommand.handler({tagName, targetVersion, $0: '', _: []});\n-  }\n-\n-  it('should invoke \"npm dist-tag\" command for all configured packages', async () => {\n-    await invokeCommand('latest', '10.0.0');\n-    expect(npm.setNpmTagForPackage).toHaveBeenCalledTimes(2);\n-    expect(npm.setNpmTagForPackage)\n-        .toHaveBeenCalledWith('@angular/pkg1', 'latest', matchesVersion('10.0.0'), undefined);\n-    expect(npm.setNpmTagForPackage)\n-        .toHaveBeenCalledWith('@angular/pkg2', 'latest', matchesVersion('10.0.0'), undefined);\n-  });\n-\n-  it('should support a configured custom NPM registry', async () => {\n-    publishRegistry = 'https://my-custom-registry.angular.io';\n-    await invokeCommand('latest', '10.0.0');\n-\n-    expect(npm.setNpmTagForPackage).toHaveBeenCalledTimes(2);\n-    expect(npm.setNpmTagForPackage)\n-        .toHaveBeenCalledWith(\n-            '@angular/pkg1', 'latest', matchesVersion('10.0.0'),\n-            'https://my-custom-registry.angular.io');\n-    expect(npm.setNpmTagForPackage)\n-        .toHaveBeenCalledWith(\n-            '@angular/pkg2', 'latest', matchesVersion('10.0.0'),\n-            'https://my-custom-registry.angular.io');\n-  });\n-\n-  it('should error if an invalid version has been specified', async () => {\n-    spyOn(console, 'error');\n-    await invokeCommand('latest', '10.0');\n-\n-    expect(console.error)\n-        .toHaveBeenCalledWith('Invalid version specified (10.0). Unable to set NPM dist tag.');\n-    expect(process.exit).toHaveBeenCalledWith(1);\n-    expect(process.exit).toHaveBeenCalledTimes(1);\n-  });\n-});"
        },
        {
            "sha": "f6343df956003bfbd7027530ed9652fa9248681f",
            "filename": "dev-infra/release/stamping/cli.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fstamping%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fstamping%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fstamping%2Fcli.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,36 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Arguments, Argv, CommandModule} from 'yargs';\n-\n-import {buildEnvStamp, EnvStampMode} from './env-stamp';\n-\n-\n-export interface Options {\n-  mode: EnvStampMode;\n-}\n-\n-function builder(args: Argv): Argv<Options> {\n-  return args.option('mode', {\n-    demandOption: true,\n-    description: 'Whether the env-stamp should be built for a snapshot or release',\n-    choices: ['snapshot' as const, 'release' as const]\n-  });\n-}\n-\n-async function handler({mode}: Arguments<Options>) {\n-  buildEnvStamp(mode);\n-}\n-\n-/** CLI command module for building the environment stamp. */\n-export const BuildEnvStampCommand: CommandModule<{}, Options> = {\n-  builder,\n-  handler,\n-  command: 'build-env-stamp',\n-  describe: 'Build the environment stamping information',\n-};"
        },
        {
            "sha": "3c9f9bd547265f95c34a0cbef1e9cf2fe88e42f3",
            "filename": "dev-infra/release/stamping/env-stamp.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 112,
            "changes": 112,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,112 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {join} from 'path';\n-import {SemVer} from 'semver';\n-import {GitClient} from '../../utils/git/git-client';\n-import {createExperimentalSemver} from '../../utils/semver';\n-\n-export type EnvStampMode = 'snapshot'|'release';\n-\n-/**\n- * Log the environment variables expected by bazel for stamping.\n- *\n- * See the section on stamping in docs / BAZEL.md\n- *\n- * This script must be a NodeJS script in order to be cross-platform.\n- * See https://github.com/bazelbuild/bazel/issues/5958\n- * Note: git operations, especially git status, take a long time inside mounted docker volumes\n- * in Windows or OSX hosts (https://github.com/docker/for-win/issues/188).\n- */\n-export function buildEnvStamp(mode: EnvStampMode) {\n-  console.info(`BUILD_SCM_BRANCH ${getCurrentBranch()}`);\n-  console.info(`BUILD_SCM_COMMIT_SHA ${getCurrentBranchOrRevision()}`);\n-  console.info(`BUILD_SCM_HASH ${getCurrentBranchOrRevision()}`);\n-  console.info(`BUILD_SCM_LOCAL_CHANGES ${hasLocalChanges()}`);\n-  console.info(`BUILD_SCM_USER ${getCurrentGitUser()}`);\n-  const {version, experimentalVersion} = getSCMVersions(mode);\n-  console.info(`BUILD_SCM_VERSION ${version}`);\n-  console.info(`BUILD_SCM_EXPERIMENTAL_VERSION ${experimentalVersion}`);\n-  process.exit();\n-}\n-\n-/** Whether the repo has local changes. */\n-function hasLocalChanges() {\n-  try {\n-    const git = GitClient.get();\n-    return git.hasUncommittedChanges();\n-  } catch {\n-    return true;\n-  }\n-}\n-\n-/**\n- * Get the versions for generated packages.\n- *\n- * In snapshot mode, the version is based on the most recent semver tag.\n- * In release mode, the version is based on the base package.json version.\n- */\n-function getSCMVersions(mode: EnvStampMode): {version: string, experimentalVersion: string} {\n-  try {\n-    const git = GitClient.get();\n-    if (mode === 'snapshot') {\n-      const localChanges = hasLocalChanges() ? '.with-local-changes' : '';\n-      const {stdout: rawVersion} =\n-          git.run(['describe', '--match', '*[0-9]*.[0-9]*.[0-9]*', '--abbrev=7', '--tags', 'HEAD']);\n-      const {version} = new SemVer(rawVersion);\n-      const {version: experimentalVersion} = createExperimentalSemver(version);\n-      return {\n-        version: `${version.replace(/-([0-9]+)-g/, '+$1.sha-')}${localChanges}`,\n-        experimentalVersion:\n-            `${experimentalVersion.replace(/-([0-9]+)-g/, '+$1.sha-')}${localChanges}`,\n-      };\n-    } else {\n-      const packageJsonPath = join(git.baseDir, 'package.json');\n-      const {version} = new SemVer(require(packageJsonPath).version);\n-      const {version: experimentalVersion} = createExperimentalSemver(new SemVer(version));\n-      return {version, experimentalVersion};\n-    }\n-  } catch {\n-    return {\n-      version: '',\n-      experimentalVersion: '',\n-    };\n-  }\n-}\n-\n-/** Get the current branch or revision of HEAD. */\n-function getCurrentBranchOrRevision() {\n-  try {\n-    const git = GitClient.get();\n-    return git.getCurrentBranchOrRevision();\n-  } catch {\n-    return '';\n-  }\n-}\n-\n-/** Get the currently checked out branch. */\n-function getCurrentBranch() {\n-  try {\n-    const git = GitClient.get();\n-    return git.run(['symbolic-ref', '--short', 'HEAD']).stdout.trim();\n-  } catch {\n-    return '';\n-  }\n-}\n-\n-/** Get the current git user based on the git config. */\n-function getCurrentGitUser() {\n-  try {\n-    const git = GitClient.get();\n-    let userName = git.runGraceful(['config', 'user.name']).stdout.trim() || 'Unknown User';\n-    let userEmail = git.runGraceful(['config', 'user.email']).stdout.trim() || 'unknown_email';\n-    return `${userName} <${userEmail}>`;\n-  } catch {\n-    return '';\n-  }\n-}"
        },
        {
            "sha": "7a486a5d8f315928c293bb81dd6cc1e8ace07582",
            "filename": "dev-infra/release/versioning/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"versioning\",\n-    srcs = glob([\n-        \"**/*.ts\",\n-    ]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/release/config\",\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/node-fetch\",\n-        \"@npm//@types/semver\",\n-        \"@npm//node-fetch\",\n-        \"@npm//semver\",\n-    ],\n-)"
        },
        {
            "sha": "b428492b7f02e2703f96471b0d5dc508ff0d9e87",
            "filename": "dev-infra/release/versioning/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2FREADME.md?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,5 +0,0 @@\n-## Versioning for the Angular organization\n-\n-The folder contains common tooling needed for implementing the versioning as proposed\n-by [this design document](https://docs.google.com/document/d/197kVillDwx-RZtSVOBtPb4BBIAw0E9RT3q3v6DZkykU).\n-Primary tooling is the determination of _active_ release trains."
        },
        {
            "sha": "d123db02e4c2fbdf09c3581ce3e80059edfe4f6c",
            "filename": "dev-infra/release/versioning/active-release-trains.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 139,
            "changes": 139,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Factive-release-trains.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Factive-release-trains.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Factive-release-trains.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,139 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {ReleaseTrain} from './release-trains';\n-import {getBranchesForMajorVersions, getVersionOfBranch, GithubRepoWithApi, VersionBranch} from './version-branches';\n-\n-/** Interface describing determined active release trains for a project. */\n-export interface ActiveReleaseTrains {\n-  /** Release-train currently in the \"release-candidate\" or \"feature-freeze\" phase. */\n-  releaseCandidate: ReleaseTrain|null;\n-  /** Release-train currently in the \"latest\" phase. */\n-  latest: ReleaseTrain;\n-  /** Release-train in the `next` phase. */\n-  next: ReleaseTrain;\n-}\n-\n-/** Branch name for the `next` branch. */\n-export const nextBranchName = 'master';\n-\n-/** Fetches the active release trains for the configured project. */\n-export async function fetchActiveReleaseTrains(repo: GithubRepoWithApi):\n-    Promise<ActiveReleaseTrains> {\n-  const nextVersion = await getVersionOfBranch(repo, nextBranchName);\n-  const next = new ReleaseTrain(nextBranchName, nextVersion);\n-  const majorVersionsToConsider: number[] = [];\n-  let expectedReleaseCandidateMajor: number;\n-\n-  // If the `next` branch (i.e. `master` branch) is for an upcoming major version, we know\n-  // that there is no patch branch or feature-freeze/release-candidate branch for this major\n-  // digit. If the current `next` version is the first minor of a major version, we know that\n-  // the feature-freeze/release-candidate branch can only be the actual major branch. The\n-  // patch branch is based on that, either the actual major branch or the last minor from the\n-  // preceding major version. In all other cases, the patch branch and feature-freeze or\n-  // release-candidate branch are part of the same major version. Consider the following:\n-  //\n-  //  CASE 1. next: 11.0.0-next.0: patch and feature-freeze/release-candidate can only be\n-  //          most recent `10.<>.x` branches. The FF/RC branch can only be the last-minor of v10.\n-  //  CASE 2. next: 11.1.0-next.0: patch can be either `11.0.x` or last-minor in v10 based\n-  //          on whether there is a feature-freeze/release-candidate branch (=> `11.0.x`).\n-  //  CASE 3. next: 10.6.0-next.0: patch can be either `10.5.x` or `10.4.x` based on whether\n-  //          there is a feature-freeze/release-candidate branch (=> `10.5.x`)\n-  if (nextVersion.minor === 0) {\n-    expectedReleaseCandidateMajor = nextVersion.major - 1;\n-    majorVersionsToConsider.push(nextVersion.major - 1);\n-  } else if (nextVersion.minor === 1) {\n-    expectedReleaseCandidateMajor = nextVersion.major;\n-    majorVersionsToConsider.push(nextVersion.major, nextVersion.major - 1);\n-  } else {\n-    expectedReleaseCandidateMajor = nextVersion.major;\n-    majorVersionsToConsider.push(nextVersion.major);\n-  }\n-\n-  // Collect all version-branches that should be considered for the latest version-branch,\n-  // or the feature-freeze/release-candidate.\n-  const branches = await getBranchesForMajorVersions(repo, majorVersionsToConsider);\n-  const {latest, releaseCandidate} = await findActiveReleaseTrainsFromVersionBranches(\n-      repo, nextVersion, branches, expectedReleaseCandidateMajor);\n-\n-  if (latest === null) {\n-    throw Error(\n-        `Unable to determine the latest release-train. The following branches ` +\n-        `have been considered: [${branches.map(b => b.name).join(', ')}]`);\n-  }\n-\n-  return {releaseCandidate, latest, next};\n-}\n-\n-/** Finds the currently active release trains from the specified version branches. */\n-export async function findActiveReleaseTrainsFromVersionBranches(\n-    repo: GithubRepoWithApi, nextVersion: semver.SemVer, branches: VersionBranch[],\n-    expectedReleaseCandidateMajor: number): Promise<{\n-  latest: ReleaseTrain | null,\n-  releaseCandidate: ReleaseTrain | null,\n-}> {\n-  // Version representing the release-train currently in the next phase. Note that we ignore\n-  // patch and pre-release segments in order to be able to compare the next release train to\n-  // other release trains from version branches (which follow the `N.N.x` pattern).\n-  const nextReleaseTrainVersion = semver.parse(`${nextVersion.major}.${nextVersion.minor}.0`)!;\n-\n-  let latest: ReleaseTrain|null = null;\n-  let releaseCandidate: ReleaseTrain|null = null;\n-\n-  // Iterate through the captured branches and find the latest non-prerelease branch and a\n-  // potential release candidate branch. From the collected branches we iterate descending\n-  // order (most recent semantic version-branch first). The first branch is either the latest\n-  // active version branch (i.e. patch) or a feature-freeze/release-candidate branch. A FF/RC\n-  // branch cannot be older than the latest active version-branch, so we stop iterating once\n-  // we found such a branch. Otherwise, if we found a FF/RC branch, we continue looking for the\n-  // next version-branch as that one is supposed to be the latest active version-branch. If it\n-  // is not, then an error will be thrown due to two FF/RC branches existing at the same time.\n-  for (const {name, parsed} of branches) {\n-    // It can happen that version branches have been accidentally created which are more recent\n-    // than the release-train in the next branch (i.e. `master`). We could ignore such branches\n-    // silently, but it might be symptomatic for an outdated version in the `next` branch, or an\n-    // accidentally created branch by the caretaker. In either way we want to raise awareness.\n-    if (semver.gt(parsed, nextReleaseTrainVersion)) {\n-      throw Error(\n-          `Discovered unexpected version-branch \"${name}\" for a release-train that is ` +\n-          `more recent than the release-train currently in the \"${nextBranchName}\" branch. ` +\n-          `Please either delete the branch if created by accident, or update the outdated ` +\n-          `version in the next branch (${nextBranchName}).`);\n-    } else if (semver.eq(parsed, nextReleaseTrainVersion)) {\n-      throw Error(\n-          `Discovered unexpected version-branch \"${name}\" for a release-train that is already ` +\n-          `active in the \"${nextBranchName}\" branch. Please either delete the branch if ` +\n-          `created by accident, or update the version in the next branch (${nextBranchName}).`);\n-    }\n-\n-    const version = await getVersionOfBranch(repo, name);\n-    const releaseTrain = new ReleaseTrain(name, version);\n-    const isPrerelease = version.prerelease[0] === 'rc' || version.prerelease[0] === 'next';\n-\n-    if (isPrerelease) {\n-      if (releaseCandidate !== null) {\n-        throw Error(\n-            `Unable to determine latest release-train. Found two consecutive ` +\n-            `branches in feature-freeze/release-candidate phase. Did not expect both \"${name}\" ` +\n-            `and \"${releaseCandidate.branchName}\" to be in feature-freeze/release-candidate mode.`);\n-      } else if (version.major !== expectedReleaseCandidateMajor) {\n-        throw Error(\n-            `Discovered unexpected old feature-freeze/release-candidate branch. Expected no ` +\n-            `version-branch in feature-freeze/release-candidate mode for v${version.major}.`);\n-      }\n-      releaseCandidate = releaseTrain;\n-    } else {\n-      latest = releaseTrain;\n-      break;\n-    }\n-  }\n-\n-  return {releaseCandidate, latest};\n-}"
        },
        {
            "sha": "fa834458cd150bb4e6abaa77e15a2b2e5a979778",
            "filename": "dev-infra/release/versioning/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export * from './active-release-trains';\n-export * from './release-trains';\n-export * from './long-term-support';\n-export * from './version-branches';\n-export * from './npm-registry';"
        },
        {
            "sha": "676b85b2fd4c7251fdcc01ee00f047daa6bd8036",
            "filename": "dev-infra/release/versioning/long-term-support.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 107,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,107 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {ReleaseConfig} from '../config/index';\n-\n-import {fetchProjectNpmPackageInfo} from './npm-registry';\n-\n-/** Type describing a NPM dist tag indicating long-term support. */\n-export type LtsNpmDistTag = `v${number}-lts`;\n-\n-/** Interface describing determined LTS branches. */\n-export interface LtsBranches {\n-  /** List of active LTS version branches. */\n-  active: LtsBranch[];\n-  /** List of inactive LTS version branches. */\n-  inactive: LtsBranch[];\n-}\n-\n-/** Interface describing an LTS version branch. */\n-export interface LtsBranch {\n-  /** Name of the branch. */\n-  name: string;\n-  /** Most recent version for the given LTS branch. */\n-  version: semver.SemVer;\n-  /** NPM dist tag for the LTS version. */\n-  npmDistTag: LtsNpmDistTag;\n-}\n-\n-/**\n- * Number of months a major version in Angular is actively supported. See:\n- * https://angular.io/guide/releases#support-policy-and-schedule.\n- */\n-const majorActiveSupportDuration = 6;\n-\n-/**\n- * Number of months a major version has active long-term support. See:\n- * https://angular.io/guide/releases#support-policy-and-schedule.\n- */\n-const majorLongTermSupportDuration = 12;\n-\n-/** Regular expression that matches LTS NPM dist tags. */\n-const ltsNpmDistTagRegex = /^v(\\d+)-lts$/;\n-\n-/** Finds all long-term support release trains from the specified NPM package. */\n-export async function fetchLongTermSupportBranchesFromNpm(config: ReleaseConfig):\n-    Promise<LtsBranches> {\n-  const {'dist-tags': distTags, time} = await fetchProjectNpmPackageInfo(config);\n-  const today = new Date();\n-  const active: LtsBranch[] = [];\n-  const inactive: LtsBranch[] = [];\n-\n-  // Iterate through the NPM package information and determine active/inactive LTS versions with\n-  // their corresponding branches. We assume that an LTS tagged version in NPM belongs to the\n-  // last-minor branch of a given major (i.e. we assume there are no outdated LTS NPM dist tags).\n-  for (const npmDistTag in distTags) {\n-    if (isLtsDistTag(npmDistTag)) {\n-      const version = semver.parse(distTags[npmDistTag])!;\n-      const branchName = `${version.major}.${version.minor}.x`;\n-      const majorReleaseDate = new Date(time[`${version.major}.0.0`]);\n-      const ltsEndDate = computeLtsEndDateOfMajor(majorReleaseDate);\n-      const ltsBranch: LtsBranch = {name: branchName, version, npmDistTag};\n-      // Depending on whether the LTS phase is still active, add the branch\n-      // to the list of active or inactive LTS branches.\n-      if (today <= ltsEndDate) {\n-        active.push(ltsBranch);\n-      } else {\n-        inactive.push(ltsBranch);\n-      }\n-    }\n-  }\n-\n-  // Sort LTS branches in descending order. i.e. most recent ones first.\n-  active.sort((a, b) => semver.rcompare(a.version, b.version));\n-  inactive.sort((a, b) => semver.rcompare(a.version, b.version));\n-\n-  return {active, inactive};\n-}\n-\n-/** Gets whether the specified tag corresponds to a LTS dist tag. */\n-export function isLtsDistTag(tagName: string): tagName is LtsNpmDistTag {\n-  return ltsNpmDistTagRegex.test(tagName);\n-}\n-\n-/**\n- * Computes the date when long-term support ends for a major released at the\n- * specified date.\n- */\n-export function computeLtsEndDateOfMajor(majorReleaseDate: Date): Date {\n-  return new Date(\n-      majorReleaseDate.getFullYear(),\n-      majorReleaseDate.getMonth() + majorActiveSupportDuration + majorLongTermSupportDuration,\n-      majorReleaseDate.getDate(), majorReleaseDate.getHours(), majorReleaseDate.getMinutes(),\n-      majorReleaseDate.getSeconds(), majorReleaseDate.getMilliseconds());\n-}\n-\n-/** Gets the long-term support NPM dist tag for a given major version. */\n-export function getLtsNpmDistTagOfMajor(major: number): LtsNpmDistTag {\n-  // LTS versions should be tagged in NPM in the following format: `v{major}-lts`.\n-  return `v${major}-lts` as const;\n-}"
        },
        {
            "sha": "8603a11d14721b362f0ef78bf86313ac0aa45be4",
            "filename": "dev-infra/release/versioning/next-prerelease-version.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnext-prerelease-version.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnext-prerelease-version.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fnext-prerelease-version.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {semverInc} from '../../utils/semver';\n-import {ReleaseConfig} from '../config/index';\n-\n-import {ActiveReleaseTrains} from './active-release-trains';\n-import {isVersionPublishedToNpm} from './npm-registry';\n-\n-/** Computes the new pre-release version for the next release-train. */\n-export async function computeNewPrereleaseVersionForNext(\n-    active: ActiveReleaseTrains, config: ReleaseConfig): Promise<semver.SemVer> {\n-  const {version: nextVersion} = active.next;\n-  const isNextPublishedToNpm = await isVersionPublishedToNpm(nextVersion, config);\n-  // Special-case where the version in the `next` release-train is not published yet. This\n-  // happens when we recently branched off for feature-freeze. We already bump the version to\n-  // the next minor or major, but do not publish immediately. Cutting a release immediately would\n-  // be not helpful as there are no other changes than in the feature-freeze branch. If we happen\n-  // to detect this case, we stage the release as usual but do not increment the version.\n-  if (isNextPublishedToNpm) {\n-    return semverInc(nextVersion, 'prerelease');\n-  } else {\n-    return nextVersion;\n-  }\n-}"
        },
        {
            "sha": "248bef824d32b9fc057bff7a86710f5005416235",
            "filename": "dev-infra/release/versioning/npm-publish.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 95,
            "changes": 95,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,95 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-import {spawn, spawnInteractive} from '../../utils/child-process';\n-\n-import {NpmDistTag} from './npm-registry';\n-\n-/**\n- * Runs NPM publish within a specified package directory.\n- * @throws With the process log output if the publish failed.\n- */\n-export async function runNpmPublish(\n-    packagePath: string, distTag: NpmDistTag, registryUrl: string|undefined) {\n-  const args = ['publish', '--access', 'public', '--tag', distTag];\n-  // If a custom registry URL has been specified, add the `--registry` flag.\n-  if (registryUrl !== undefined) {\n-    args.push('--registry', registryUrl);\n-  }\n-  await spawn('npm', args, {cwd: packagePath, mode: 'silent'});\n-}\n-\n-/**\n- * Sets the NPM tag to the specified version for the given package.\n- * @throws With the process log output if the tagging failed.\n- */\n-export async function setNpmTagForPackage(\n-    packageName: string, distTag: string, version: semver.SemVer, registryUrl: string|undefined) {\n-  const args = ['dist-tag', 'add', `${packageName}@${version}`, distTag];\n-  // If a custom registry URL has been specified, add the `--registry` flag.\n-  if (registryUrl !== undefined) {\n-    args.push('--registry', registryUrl);\n-  }\n-  await spawn('npm', args, {mode: 'silent'});\n-}\n-\n-/**\n- * Checks whether the user is currently logged into NPM.\n- * @returns Whether the user is currently logged into NPM.\n- */\n-export async function npmIsLoggedIn(registryUrl: string|undefined): Promise<boolean> {\n-  const args = ['whoami'];\n-  // If a custom registry URL has been specified, add the `--registry` flag.\n-  if (registryUrl !== undefined) {\n-    args.push('--registry', registryUrl);\n-  }\n-  try {\n-    await spawn('npm', args, {mode: 'silent'});\n-  } catch (e) {\n-    return false;\n-  }\n-  return true;\n-}\n-\n-/**\n- * Log into NPM at a provided registry.\n- * @throws With the `npm login` status code if the login failed.\n- */\n-export async function npmLogin(registryUrl: string|undefined) {\n-  const args = ['login', '--no-browser'];\n-  // If a custom registry URL has been specified, add the `--registry` flag. The `--registry` flag\n-  // must be spliced into the correct place in the command as npm expects it to be the flag\n-  // immediately following the login subcommand.\n-  if (registryUrl !== undefined) {\n-    args.splice(1, 0, '--registry', registryUrl);\n-  }\n-  // The login command prompts for username, password and other profile information. Hence\n-  // the process needs to be interactive (i.e. respecting current TTYs stdin).\n-  await spawnInteractive('npm', args);\n-}\n-\n-/**\n- * Log out of NPM at a provided registry.\n- * @returns Whether the user was logged out of NPM.\n- */\n-export async function npmLogout(registryUrl: string|undefined): Promise<boolean> {\n-  const args = ['logout'];\n-  // If a custom registry URL has been specified, add the `--registry` flag. The `--registry` flag\n-  // must be spliced into the correct place in the command as npm expects it to be the flag\n-  // immediately following the logout subcommand.\n-  if (registryUrl !== undefined) {\n-    args.splice(1, 0, '--registry', registryUrl);\n-  }\n-  try {\n-    await spawn('npm', args, {mode: 'silent'});\n-  } finally {\n-    return npmIsLoggedIn(registryUrl);\n-  }\n-}"
        },
        {
            "sha": "de6daf0970e9e0c90d4822e2c152a752abb09d7f",
            "filename": "dev-infra/release/versioning/npm-registry.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 69,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnpm-registry.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fnpm-registry.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fnpm-registry.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,69 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import fetch from 'node-fetch';\n-import * as semver from 'semver';\n-\n-import {ReleaseConfig} from '../config/index';\n-import {LtsNpmDistTag} from './long-term-support';\n-\n-/** Type describing the possible NPM dist tags used by Angular packages. */\n-export type NpmDistTag = 'latest'|'next'|LtsNpmDistTag;\n-\n-/** Type describing an NPM package fetched from the registry. */\n-export interface NpmPackageInfo {\n-  /** Maps of versions and their package JSON objects. */\n-  'versions': {[name: string]: undefined|object};\n-  /** Map of NPM dist-tags and their chosen version. */\n-  'dist-tags': {[tagName: string]: string|undefined};\n-  /** Map of versions and their ISO release time. */\n-  'time': {[name: string]: string};\n-}\n-\n-/**\n- * Cache for requested NPM package information. A cache is desirable as the NPM\n- * registry requests are usually very large and slow.\n- */\n-export const _npmPackageInfoCache: {[pkgName: string]: Promise<NpmPackageInfo>} = {};\n-\n-/**\n- * Fetches the NPM package representing the project. Angular repositories usually contain\n- * multiple packages in a monorepo scheme, but packages dealt with as part of the release\n- * tooling are released together with the same versioning and branching. This means that\n- * a single package can be used as source of truth for NPM package queries.\n- */\n-export async function fetchProjectNpmPackageInfo(config: ReleaseConfig): Promise<NpmPackageInfo> {\n-  const pkgName = getRepresentativeNpmPackage(config);\n-  return await fetchPackageInfoFromNpmRegistry(pkgName);\n-}\n-\n-/** Gets whether the given version is published to NPM or not */\n-export async function isVersionPublishedToNpm(\n-    version: semver.SemVer, config: ReleaseConfig): Promise<boolean> {\n-  const {versions} = await fetchProjectNpmPackageInfo(config);\n-  return versions[version.format()] !== undefined;\n-}\n-\n-/**\n- * Gets the representative NPM package for the specified release configuration. Angular\n- * repositories usually contain multiple packages in a monorepo scheme, but packages dealt with\n- * as part of the release tooling are released together with the same versioning and branching.\n- * This means that a single package can be used as source of truth for NPM package queries.\n- */\n-function getRepresentativeNpmPackage(config: ReleaseConfig) {\n-  return config.npmPackages[0];\n-}\n-\n-/** Fetches the specified NPM package from the NPM registry. */\n-async function fetchPackageInfoFromNpmRegistry(pkgName: string): Promise<NpmPackageInfo> {\n-  if (_npmPackageInfoCache[pkgName] === undefined) {\n-    _npmPackageInfoCache[pkgName] =\n-        fetch(`https://registry.npmjs.org/${pkgName}`).then(r => r.json());\n-  }\n-  return await _npmPackageInfoCache[pkgName];\n-}"
        },
        {
            "sha": "b4314cea2e5dbd4d257a0698b6df8497a91210a5",
            "filename": "dev-infra/release/versioning/print-active-trains.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 80,
            "changes": 80,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fprint-active-trains.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fprint-active-trains.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fprint-active-trains.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,80 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {blue, bold, info} from '../../utils/console';\n-import {ReleaseConfig} from '../config/index';\n-\n-import {ActiveReleaseTrains} from './active-release-trains';\n-import {fetchLongTermSupportBranchesFromNpm} from './long-term-support';\n-import {isVersionPublishedToNpm} from './npm-registry';\n-\n-/**\n- * Prints the active release trains to the console.\n- * @params active Active release trains that should be printed.\n- * @params config Release configuration used for querying NPM on published versions.\n- */\n-export async function printActiveReleaseTrains(\n-    active: ActiveReleaseTrains, config: ReleaseConfig): Promise<void> {\n-  const {releaseCandidate, next, latest} = active;\n-  const isNextPublishedToNpm = await isVersionPublishedToNpm(next.version, config);\n-  const nextTrainType = next.isMajor ? 'major' : 'minor';\n-  const ltsBranches = await fetchLongTermSupportBranchesFromNpm(config);\n-\n-  info();\n-  info(blue('Current version branches in the project:'));\n-\n-  // Print information for release trains in the feature-freeze/release-candidate phase.\n-  if (releaseCandidate !== null) {\n-    const rcVersion = releaseCandidate.version;\n-    const rcTrainType = releaseCandidate.isMajor ? 'major' : 'minor';\n-    const rcTrainPhase =\n-        rcVersion.prerelease[0] === 'next' ? 'feature-freeze' : 'release-candidate';\n-    info(\n-        ` • ${bold(releaseCandidate.branchName)} contains changes for an upcoming ` +\n-        `${rcTrainType} that is currently in ${bold(rcTrainPhase)} phase.`);\n-    info(`   Most recent pre-release for this branch is \"${bold(`v${rcVersion}`)}\".`);\n-  }\n-\n-  // Print information about the release-train in the latest phase. i.e. the patch branch.\n-  info(` • ${bold(latest.branchName)} contains changes for the most recent patch.`);\n-  info(`   Most recent patch version for this branch is \"${bold(`v${latest.version}`)}\".`);\n-\n-  // Print information about the release-train in the next phase.\n-  info(\n-      ` • ${bold(next.branchName)} contains changes for a ${nextTrainType} ` +\n-      `currently in active development.`);\n-  // Note that there is a special case for versions in the next release-train. The version in\n-  // the next branch is not always published to NPM. This can happen when we recently branched\n-  // off for a feature-freeze release-train. More details are in the next pre-release action.\n-  if (isNextPublishedToNpm) {\n-    info(`   Most recent pre-release version for this branch is \"${bold(`v${next.version}`)}\".`);\n-  } else {\n-    info(\n-        `   Version is currently set to \"${bold(`v${next.version}`)}\", but has not been ` +\n-        `published yet.`);\n-  }\n-\n-  // If no release-train in release-candidate or feature-freeze phase is active,\n-  // we print a message as last bullet point to make this clear.\n-  if (releaseCandidate === null) {\n-    info(' • No release-candidate or feature-freeze branch currently active.');\n-  }\n-\n-  info();\n-  info(blue('Current active LTS version branches:'));\n-\n-  // Print all active LTS branches (each branch as own bullet point).\n-  if (ltsBranches.active.length !== 0) {\n-    for (const ltsBranch of ltsBranches.active) {\n-      info(` • ${bold(ltsBranch.name)} is currently in active long-term support phase.`);\n-      info(`   Most recent patch version for this branch is \"${bold(`v${ltsBranch.version}`)}\".`);\n-    }\n-  }\n-\n-  info();\n-}"
        },
        {
            "sha": "ee72c603f67c5a5b273625d9b815bb501771d814",
            "filename": "dev-infra/release/versioning/release-trains.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Frelease-trains.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Frelease-trains.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Frelease-trains.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,21 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-/** Class describing a release-train. */\n-export class ReleaseTrain {\n-  /** Whether the release train is currently targeting a major. */\n-  isMajor = this.version.minor === 0 && this.version.patch === 0;\n-\n-  constructor(\n-      /** Name of the branch for this release-train. */\n-      public branchName: string,\n-      /** Most recent version for this release train. */\n-      public version: semver.SemVer) {}\n-}"
        },
        {
            "sha": "5f47dc117b5efe08b4347cb816437331baa313b5",
            "filename": "dev-infra/release/versioning/version-branches.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 94,
            "changes": 94,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,94 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-import {GithubClient, GithubRepo} from '../../utils/git/github';\n-\n-/** Type describing a Github repository with corresponding API client. */\n-export interface GithubRepoWithApi extends GithubRepo {\n-  /** API client that can access the repository. */\n-  api: GithubClient;\n-}\n-\n-/** Type describing a version-branch. */\n-export interface VersionBranch {\n-  /** Name of the branch in Git. e.g. `10.0.x`. */\n-  name: string;\n-  /**\n-   * Parsed SemVer version for the version-branch. Version branches technically do\n-   * not follow the SemVer format, but we can have representative SemVer versions\n-   * that can be used for comparisons, sorting and other checks.\n-   */\n-  parsed: semver.SemVer;\n-}\n-\n-/** Regular expression that matches version-branches. */\n-const versionBranchNameRegex = /^(\\d+)\\.(\\d+)\\.x$/;\n-\n-/** Gets the version of a given branch by reading the `package.json` upstream. */\n-export async function getVersionOfBranch(\n-    repo: GithubRepoWithApi, branchName: string): Promise<semver.SemVer> {\n-  const {data} = await repo.api.repos.getContent(\n-      {owner: repo.owner, repo: repo.name, path: '/package.json', ref: branchName});\n-  // Workaround for: https://github.com/octokit/rest.js/issues/32.\n-  // TODO: Remove cast once types of Octokit `getContent` are fixed.\n-  const content = (data as {content?: string}).content;\n-  if (!content) {\n-    throw Error(`Unable to read \"package.json\" file from repository.`);\n-  }\n-  const {version} = JSON.parse(Buffer.from(content, 'base64').toString()) as\n-      {version: string, [key: string]: any};\n-  const parsedVersion = semver.parse(version);\n-  if (parsedVersion === null) {\n-    throw Error(`Invalid version detected in following branch: ${branchName}.`);\n-  }\n-  return parsedVersion;\n-}\n-\n-/** Whether the given branch corresponds to a version branch. */\n-export function isVersionBranch(branchName: string): boolean {\n-  return versionBranchNameRegex.test(branchName);\n-}\n-\n-/**\n- * Converts a given version-branch into a SemVer version that can be used with SemVer\n- * utilities. e.g. to determine semantic order, extract major digit, compare.\n- *\n- * For example `10.0.x` will become `10.0.0` in SemVer. The patch digit is not\n- * relevant but needed for parsing. SemVer does not allow `x` as patch digit.\n- */\n-export function getVersionForVersionBranch(branchName: string): semver.SemVer|null {\n-  return semver.parse(branchName.replace(versionBranchNameRegex, '$1.$2.0'));\n-}\n-\n-/**\n- * Gets the version branches for the specified major versions in descending\n- * order. i.e. latest version branches first.\n- */\n-export async function getBranchesForMajorVersions(\n-    repo: GithubRepoWithApi, majorVersions: number[]): Promise<VersionBranch[]> {\n-  const branchData = await repo.api.paginate(\n-      repo.api.repos.listBranches, {owner: repo.owner, repo: repo.name, protected: true});\n-  const branches: VersionBranch[] = [];\n-\n-  for (const {name} of branchData) {\n-    if (!isVersionBranch(name)) {\n-      continue;\n-    }\n-    // Convert the version-branch into a SemVer version that can be used with the\n-    // SemVer utilities. e.g. to determine semantic order, compare versions.\n-    const parsed = getVersionForVersionBranch(name);\n-    // Collect all version-branches that match the specified major versions.\n-    if (parsed !== null && majorVersions.includes(parsed.major)) {\n-      branches.push({name, parsed});\n-    }\n-  }\n-\n-  // Sort captured version-branches in descending order.\n-  return branches.sort((a, b) => semver.rcompare(a.parsed, b.parsed));\n-}"
        },
        {
            "sha": "901b3b9d36685ddc5253d0fca79374aabcf259e0",
            "filename": "dev-infra/tmpl-package.json",
            "status": "removed",
            "additions": 0,
            "deletions": 63,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftmpl-package.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftmpl-package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftmpl-package.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,63 +0,0 @@\n-{\n-  \"name\": \"@angular/dev-infra-private\",\n-  \"version\": \"0.0.0\",\n-  \"description\": \"INTERNAL USE ONLY - Angular internal DevInfra tooling/scripts - INTERNAL USE ONLY\",\n-  \"license\": \"MIT\",\n-  \"private\": true,\n-  \"bin\": {\n-    \"ng-dev\": \"./cli.js\",\n-    \"ts-circular-deps\": \"./ts-circular-dependencies/index.js\"\n-  },\n-  \"dependencies\": {\n-    \"@angular/benchpress\": \"0.2.1\",\n-    \"@bazel/buildifier\": \"<from-root>\",\n-    \"@bazel/runfiles\": \"<from-root>\",\n-    \"@microsoft/api-extractor\": \"<from-root>\",\n-    \"@octokit/graphql\": \"<from-root>\",\n-    \"@octokit/rest\": \"<from-root>\",\n-    \"@octokit/types\": \"<from-root>\",\n-    \"brotli\": \"<from-root>\",\n-    \"chalk\": \"<from-root>\",\n-    \"clang-format\": \"<from-root>\",\n-    \"cli-progress\": \"<from-root>\",\n-    \"conventional-commits-parser\": \"<from-root>\",\n-    \"ejs\": \"<from-root>\",\n-    \"git-raw-commits\": \"<from-root>\",\n-    \"glob\": \"<from-root>\",\n-    \"inquirer\": \"<from-root>\",\n-    \"minimatch\": \"<from-root>\",\n-    \"multimatch\": \"<from-root>\",\n-    \"node-fetch\": \"<from-root>\",\n-    \"node-uuid\": \"<from-root>\",\n-    \"ora\": \"<from-root>\",\n-    \"protractor\": \"<from-root>\",\n-    \"selenium-webdriver\": \"<from-root>\",\n-    \"semver\": \"<from-root>\",\n-    \"ts-node\": \"<from-root>\",\n-    \"tslib\": \"<from-root>\",\n-    \"typed-graphqlify\": \"<from-root>\",\n-    \"typescript\": \"<from-root>\",\n-    \"yaml\": \"<from-root>\",\n-    \"yargs\": \"<from-root>\"\n-  },\n-  \"peerDependenciesMeta\": {\n-    \"@bazel/buildifier\": {\n-      \"optional\": true\n-    },\n-    \"clang-format\": {\n-      \"optional\": true\n-    },\n-    \"prettier\": {\n-      \"optional\": true\n-    },\n-    \"protractor\": {\n-      \"optional\": true\n-    },\n-    \"selenium-webdriver\": {\n-      \"optional\": true\n-    },\n-    \"ts-node\": {\n-      \"optional\": true\n-    }\n-  }\n-}"
        },
        {
            "sha": "13fbc819e06cc705c6448f0faf3bb5b761dc02c5",
            "filename": "dev-infra/ts-circular-dependencies/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,15 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"ts-circular-dependencies\",\n-    srcs = glob([\"*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/glob\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//chalk\",\n-        \"@npm//typescript\",\n-    ],\n-)"
        },
        {
            "sha": "2ed88cf1ba3c80b2ec041529bacacad6d6fbc212",
            "filename": "dev-infra/ts-circular-dependencies/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 82,
            "changes": 82,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2FREADME.md?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,82 +0,0 @@\n-### ts-circular-dependencies\n-\n-This tool requires a test configuration that declares a set of source files which\n-should be checked for cyclic dependencies. e.g.\n-\n-```\n-yarn ts-circular-deps --config ./test-config.js <check|approve>\n-```\n-\n-### Limitations\n-\n-In order to detect cycles, the tool currently visits each source file and runs\n-depth first search. If the DFS comes across any node that is part of the current\n-DFS path, then a cycle has been detected and the tool will capture it.\n-\n-This algorithm has limitations. For example, consider the following graph:\n-\n-![Example graph](./example-graph.png)\n-\n-Depending on which source file is considered first, the output of the circular dependency tool\n-will be different. This is because the tool does not recursively find _all_ possible cycles. This\n-would be too inefficient for large graphs (especially in the `angular/angular` repository).\n-\n-In this concrete example, the tool will visit `r3_test_bed` first. Then the first neighbour\n-(based on the import in the source file) will be visited. This is `test_bed`. Once done, the\n-tool will visit the first neighbour of `test_bed`. This is `r3_test_bed` again. The node has\n-already been visited, and also is part of the current DFS path. The tool captures this as cycle.\n-\n-As no more nodes can be visited within that path, the tool continues (as per DFS algorithm)\n-with visiting the remaining neighbours of `r3_test_bed`. It will visit `test_bed_common` and\n-then come across `test_bed`. The tool only knows that `test_bed` has already been visited, but\n-it does not know that it would close a cycle. The tool certainly could know this by recursively\n-checking neighbours of `test_bed` again, but this is inefficient and will cause the algorithm\n-to eventually degenerate into brute-force.\n-\n-In summary, the tool is unable to capture _all_ elementary cycles in the graph. This does not\n-mean though that the tool is incorrectly suggesting that there are _no_ cycles in a graph. The\n-tool is still able to correctly detect whether there are _any_ cycles in a graph or not. For\n-example, if edge from `r3_test_bed` to `test_bed` is removed, then the tool will be able to\n-capture at least one of the other cycles. The golden will change in an unexpected way, but it's\n-**expected** given the trade-off we take for an acceptable running time.\n-\n-Other algorithms exist which are proven to print out _all_ the elementary cycles in a directed\n-graph. For example:\n-\n-* [Johnson's algorithm for finding simple cycles][johnson-cycles].\n-* [Tarjan's algorithm for enumerating elementary circuits][tarjan-cycles].\n-\n-Experiments with these algorithms unveiled that usual source file graphs we have in Angular\n-repositories are too large to be processed in acceptable time. At the time of writing, the\n-source file graph of `angular/angular` consists of 3350 nodes and 8730 edges.\n-\n-Algorithms like the one from Donald B. Johnson, which first split the graph into strongly\n-connected components, and then search for elementary cycles in all components with at least\n-two vertices, are too inefficient for the source files graphs we have. Time complexity for\n-such algorithms is described to be `O((n + e)(c + 1))` where `c` is the number of elementary\n-circuits. Donald B. Johnson describes the number of elementary circuits the followed:\n-\n-> Thus the number of elementary circuits in a directed graph can grow faster with n than\n-the exponential 2\"\n-\n-This shows quite well that these algorithms become quickly inefficient the more vertices, edges\n-and simple cycles a graph has. Finding elementary cycles of arbitrary length seems NP-complete as\n-finding a Hamiltonian cycle with length of `n` is NP-complete too. Below is a quote from a\n-[paper describing a randomized algorithm](np-complete-cycles) for finding simple cycles of a\n-_fixed_ length that seems to confirm this hypothesis:\n-\n-> It is well known that finding the longest cycle in a graph is a hard problem, since finding\n-a hamiltonian cycle is NP-complete. Hence finding a simple cycle of length k, for an arbitrary\n-k, is NP-complete. \n-\n-Other tools like `madge` or `dpdm` have the same limitations.\n-\n-**Resources**:\n-\n-* [Finding all the elementary circuits of a directed graph - Donald. B. Johnson][johnson-cycles]\n-* [Enumeration of the elementary circuits of a directed graph - Robert Tarjan][tarjan-cycles]\n-* [Once again: Finding simple cycles in graphs - Carsten Dorgerlohx; Jürgen Wirtgen][np-complete-cycles]\n-\n-[johnson-cycles]: https://www.cs.tufts.edu/comp/150GA/homeworks/hw1/Johnson%2075.PDF\n-[tarjan-cycles]: https://ecommons.cornell.edu/bitstream/handle/1813/5941/72-145.pdf?sequence=1&isAllowed=y\n-[np-complete-cycles]: https://pdfs.semanticscholar.org/16b2/d1a3cf4a8a5dbcad10bb901724631ebead33.pdf"
        },
        {
            "sha": "a526eb622c91ffffe78a43481e57a421fd00c5b7",
            "filename": "dev-infra/ts-circular-dependencies/analyzer.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 133,
            "changes": 133,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fanalyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fanalyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Fanalyzer.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,133 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {readFileSync} from 'fs';\n-import {dirname, join, resolve} from 'path';\n-import * as ts from 'typescript';\n-\n-import {getFileStatus} from './file_system';\n-import {getModuleReferences} from './parser';\n-\n-export type ModuleResolver = (specifier: string) => string|null;\n-\n-/**\n- * Reference chains describe a sequence of source files which are connected through imports.\n- * e.g. `file_a.ts` imports `file_b.ts`, whereas `file_b.ts` imports `file_c.ts`. The reference\n- * chain data structure could be used to represent this import sequence.\n- */\n-export type ReferenceChain<T = ts.SourceFile> = T[];\n-\n-/** Default extensions that the analyzer uses for resolving imports. */\n-const DEFAULT_EXTENSIONS = ['ts', 'js', 'd.ts'];\n-\n-/**\n- * Analyzer that can be used to detect import cycles within source files. It supports\n- * custom module resolution, source file caching and collects unresolved specifiers.\n- */\n-export class Analyzer {\n-  private _sourceFileCache = new Map<string, ts.SourceFile>();\n-\n-  unresolvedModules = new Set<string>();\n-  unresolvedFiles = new Map<string, string[]>();\n-\n-  constructor(\n-      public resolveModuleFn?: ModuleResolver, public extensions: string[] = DEFAULT_EXTENSIONS) {}\n-\n-  /** Finds all cycles in the specified source file. */\n-  findCycles(sf: ts.SourceFile, visited = new WeakSet<ts.SourceFile>(), path: ReferenceChain = []):\n-      ReferenceChain[] {\n-    const previousIndex = path.indexOf(sf);\n-    // If the given node is already part of the current path, then a cycle has\n-    // been found. Add the reference chain which represents the cycle to the results.\n-    if (previousIndex !== -1) {\n-      return [path.slice(previousIndex)];\n-    }\n-    // If the node has already been visited, then it's not necessary to go check its edges\n-    // again. Cycles would have been already detected and collected in the first check.\n-    if (visited.has(sf)) {\n-      return [];\n-    }\n-    path.push(sf);\n-    visited.add(sf);\n-    // Go through all edges, which are determined through import/exports, and collect cycles.\n-    const result: ReferenceChain[] = [];\n-    for (const ref of getModuleReferences(sf)) {\n-      const targetFile = this._resolveImport(ref, sf.fileName);\n-      if (targetFile !== null) {\n-        result.push(...this.findCycles(this.getSourceFile(targetFile), visited, path.slice()));\n-      }\n-    }\n-    return result;\n-  }\n-\n-  /** Gets the TypeScript source file of the specified path. */\n-  getSourceFile(filePath: string): ts.SourceFile {\n-    const resolvedPath = resolve(filePath);\n-    if (this._sourceFileCache.has(resolvedPath)) {\n-      return this._sourceFileCache.get(resolvedPath)!;\n-    }\n-    const fileContent = readFileSync(resolvedPath, 'utf8');\n-    const sourceFile =\n-        ts.createSourceFile(resolvedPath, fileContent, ts.ScriptTarget.Latest, false);\n-    this._sourceFileCache.set(resolvedPath, sourceFile);\n-    return sourceFile;\n-  }\n-\n-  /** Resolves the given import specifier with respect to the specified containing file path. */\n-  private _resolveImport(specifier: string, containingFilePath: string): string|null {\n-    if (specifier.charAt(0) === '.') {\n-      const resolvedPath = this._resolveFileSpecifier(specifier, containingFilePath);\n-      if (resolvedPath === null) {\n-        this._trackUnresolvedFileImport(specifier, containingFilePath);\n-      }\n-      return resolvedPath;\n-    }\n-    if (this.resolveModuleFn) {\n-      const targetFile = this.resolveModuleFn(specifier);\n-      if (targetFile !== null) {\n-        const resolvedPath = this._resolveFileSpecifier(targetFile);\n-        if (resolvedPath !== null) {\n-          return resolvedPath;\n-        }\n-      }\n-    }\n-    this.unresolvedModules.add(specifier);\n-    return null;\n-  }\n-\n-  /** Tracks the given file import as unresolved. */\n-  private _trackUnresolvedFileImport(specifier: string, originFilePath: string) {\n-    if (!this.unresolvedFiles.has(originFilePath)) {\n-      this.unresolvedFiles.set(originFilePath, [specifier]);\n-    }\n-    this.unresolvedFiles.get(originFilePath)!.push(specifier);\n-  }\n-\n-  /** Resolves the given import specifier to the corresponding source file. */\n-  private _resolveFileSpecifier(specifier: string, containingFilePath?: string): string|null {\n-    const importFullPath =\n-        containingFilePath !== undefined ? join(dirname(containingFilePath), specifier) : specifier;\n-    const stat = getFileStatus(importFullPath);\n-    if (stat && stat.isFile()) {\n-      return importFullPath;\n-    }\n-    for (const extension of this.extensions) {\n-      const pathWithExtension = `${importFullPath}.${extension}`;\n-      const stat = getFileStatus(pathWithExtension);\n-      if (stat && stat.isFile()) {\n-        return pathWithExtension;\n-      }\n-    }\n-    // Directories should be considered last. TypeScript first looks for source files, then\n-    // falls back to directories if no file with appropriate extension could be found.\n-    if (stat && stat.isDirectory()) {\n-      return this._resolveFileSpecifier(join(importFullPath, 'index'));\n-    }\n-    return null;\n-  }\n-}"
        },
        {
            "sha": "86c7d1f1d05fda6f08d9890067e6497d4752316d",
            "filename": "dev-infra/ts-circular-dependencies/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 61,
            "changes": 61,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,61 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {dirname, isAbsolute, resolve} from 'path';\n-\n-import {error} from '../utils/console';\n-\n-import {ModuleResolver} from './analyzer';\n-\n-\n-/** Configuration for a circular dependencies test. */\n-export interface CircularDependenciesTestConfig {\n-  /** Base directory used for shortening paths in the golden file. */\n-  baseDir: string;\n-  /** Path to the golden file that is used for checking and approving. */\n-  goldenFile: string;\n-  /** Glob that resolves source files which should be checked. */\n-  glob: string;\n-  /**\n-   * Optional module resolver function that can be used to resolve modules\n-   * to absolute file paths.\n-   */\n-  resolveModule?: ModuleResolver;\n-  /**\n-   * Optional command that will be displayed if the golden check failed. This can be used\n-   * to consistently use script aliases for checking/approving the golden.\n-   */\n-  approveCommand?: string;\n-}\n-\n-/**\n- * Loads the configuration for the circular dependencies test. If the config cannot be\n- * loaded, an error will be printed and the process exists with a non-zero exit code.\n- */\n-export function loadTestConfig(configPath: string): CircularDependenciesTestConfig {\n-  const configBaseDir = dirname(configPath);\n-  const resolveRelativePath = (relativePath: string) => resolve(configBaseDir, relativePath);\n-\n-  try {\n-    const config = require(configPath) as CircularDependenciesTestConfig;\n-    if (!isAbsolute(config.baseDir)) {\n-      config.baseDir = resolveRelativePath(config.baseDir);\n-    }\n-    if (!isAbsolute(config.goldenFile)) {\n-      config.goldenFile = resolveRelativePath(config.goldenFile);\n-    }\n-    if (!isAbsolute(config.glob)) {\n-      config.glob = resolveRelativePath(config.glob);\n-    }\n-    return config;\n-  } catch (e) {\n-    error('Could not load test configuration file at: ' + configPath);\n-    error(`Failed with: ${e.message}`);\n-    process.exit(1);\n-  }\n-}"
        },
        {
            "sha": "02adffbb86b0adeae617ce005eeef4415968712d",
            "filename": "dev-infra/ts-circular-dependencies/example-graph.png",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fexample-graph.png",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fexample-graph.png",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Fexample-graph.png?ref=30bf47259715057b69837556010d7b91792a1ae6"
        },
        {
            "sha": "9f5db3199afaa0f78eed03f97c3d3978a843117e",
            "filename": "dev-infra/ts-circular-dependencies/file_system.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Ffile_system.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Ffile_system.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Ffile_system.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,23 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Stats, statSync} from 'fs';\n-\n-/** Gets the status of the specified file. Returns null if the file does not exist. */\n-export function getFileStatus(filePath: string): Stats|null {\n-  try {\n-    return statSync(filePath);\n-  } catch {\n-    return null;\n-  }\n-}\n-\n-/** Ensures that the specified path uses forward slashes as delimiter. */\n-export function convertPathToForwardSlash(path: string) {\n-  return path.replace(/\\\\/g, '/');\n-}"
        },
        {
            "sha": "1c957332608cf0e39712a4db49e7c6435ccacf3b",
            "filename": "dev-infra/ts-circular-dependencies/golden.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 131,
            "changes": 131,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fgolden.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fgolden.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Fgolden.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,131 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {relative} from 'path';\n-\n-import {ReferenceChain} from './analyzer';\n-import {convertPathToForwardSlash} from './file_system';\n-\n-export type CircularDependency = ReferenceChain<string>;\n-export type Golden = CircularDependency[];\n-\n-/**\n- * Converts a list of reference chains to a JSON-compatible golden object. Reference chains\n- * by default use TypeScript source file objects. In order to make those chains printable,\n- * the source file objects are mapped to their relative file names.\n- */\n-export function convertReferenceChainToGolden(refs: ReferenceChain[], baseDir: string): Golden {\n-  return refs\n-      .map(\n-          // Normalize cycles as the paths can vary based on which node in the cycle is visited\n-          // first in the analyzer. The paths represent cycles. Hence we can shift nodes in a\n-          // deterministic way so that the goldens don't change unnecessarily and cycle comparison\n-          // is simpler.\n-          chain => normalizeCircularDependency(\n-              chain.map(({fileName}) => convertPathToForwardSlash(relative(baseDir, fileName)))))\n-      // Sort cycles so that the golden doesn't change unnecessarily when cycles are detected\n-      // in different order (e.g. new imports cause cycles to be detected earlier or later).\n-      .sort(compareCircularDependency);\n-}\n-\n-/**\n- * Compares the specified goldens and returns two lists that describe newly\n- * added circular dependencies, or fixed circular dependencies.\n- */\n-export function compareGoldens(actual: Golden, expected: Golden) {\n-  const newCircularDeps: CircularDependency[] = [];\n-  const fixedCircularDeps: CircularDependency[] = [];\n-  actual.forEach(a => {\n-    if (!expected.find(e => isSameCircularDependency(a, e))) {\n-      newCircularDeps.push(a);\n-    }\n-  });\n-  expected.forEach(e => {\n-    if (!actual.find(a => isSameCircularDependency(e, a))) {\n-      fixedCircularDeps.push(e);\n-    }\n-  });\n-  return {newCircularDeps, fixedCircularDeps};\n-}\n-\n-/**\n- * Normalizes the a circular dependency by ensuring that the path starts with the first\n- * node in alphabetical order. Since the path array represents a cycle, we can make a\n- * specific node the first element in the path that represents the cycle.\n- *\n- * This method is helpful because the path of circular dependencies changes based on which\n- * file in the path has been visited first by the analyzer. e.g. Assume we have a circular\n- * dependency represented as: `A -> B -> C`. The analyzer will detect this cycle when it\n- * visits `A`. Though when a source file that is analyzed before `A` starts importing `B`,\n- * the cycle path will detected as `B -> C -> A`. This represents the same cycle, but is just\n- * different due to a limitation of using a data structure that can be written to a text-based\n- * golden file.\n- *\n- * To account for this non-deterministic behavior in goldens, we shift the circular\n- * dependency path to the first node based on alphabetical order. e.g. `A` will always\n- * be the first node in the path that represents the cycle.\n- */\n-function normalizeCircularDependency(path: CircularDependency): CircularDependency {\n-  if (path.length <= 1) {\n-    return path;\n-  }\n-\n-  let indexFirstNode: number = 0;\n-  let valueFirstNode: string = path[0];\n-\n-  // Find a node in the cycle path that precedes all other elements\n-  // in terms of alphabetical order.\n-  for (let i = 1; i < path.length; i++) {\n-    const value = path[i];\n-    if (value.localeCompare(valueFirstNode, 'en') < 0) {\n-      indexFirstNode = i;\n-      valueFirstNode = value;\n-    }\n-  }\n-\n-  // If the alphabetically first node is already at start of the path, just\n-  // return the actual path as no changes need to be made.\n-  if (indexFirstNode === 0) {\n-    return path;\n-  }\n-\n-  // Move the determined first node (as of alphabetical order) to the start of a new\n-  // path array. The nodes before the first node in the old path are then concatenated\n-  // to the end of the new path. This is possible because the path represents a cycle.\n-  return [...path.slice(indexFirstNode), ...path.slice(0, indexFirstNode)];\n-}\n-\n-/** Checks whether the specified circular dependencies are equal. */\n-function isSameCircularDependency(actual: CircularDependency, expected: CircularDependency) {\n-  if (actual.length !== expected.length) {\n-    return false;\n-  }\n-  for (let i = 0; i < actual.length; i++) {\n-    if (actual[i] !== expected[i]) {\n-      return false;\n-    }\n-  }\n-  return true;\n-}\n-\n-/**\n- * Compares two circular dependencies by respecting the alphabetic order of nodes in the\n- * cycle paths. The first nodes which don't match in both paths are decisive on the order.\n- */\n-function compareCircularDependency(a: CircularDependency, b: CircularDependency): number {\n-  // Go through nodes in both cycle paths and determine whether `a` should be ordered\n-  // before `b`. The first nodes which don't match decide on the order.\n-  for (let i = 0; i < Math.min(a.length, b.length); i++) {\n-    const compareValue = a[i].localeCompare(b[i], 'en');\n-    if (compareValue !== 0) {\n-      return compareValue;\n-    }\n-  }\n-  // If all nodes are equal in the cycles, the order is based on the length of both cycles.\n-  return a.length - b.length;\n-}"
        },
        {
            "sha": "279a281da5b425c666a18b5f428db39da4ee498a",
            "filename": "dev-infra/ts-circular-dependencies/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 135,
            "changes": 135,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,135 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {existsSync, readFileSync, writeFileSync} from 'fs';\n-import {sync as globSync} from 'glob';\n-import {isAbsolute, relative, resolve} from 'path';\n-import * as ts from 'typescript';\n-import * as yargs from 'yargs';\n-\n-import {error, green, info, red, yellow} from '../utils/console';\n-\n-import {Analyzer, ReferenceChain} from './analyzer';\n-import {CircularDependenciesTestConfig, loadTestConfig} from './config';\n-import {convertPathToForwardSlash} from './file_system';\n-import {compareGoldens, convertReferenceChainToGolden, Golden} from './golden';\n-\n-\n-export function tsCircularDependenciesBuilder(localYargs: yargs.Argv) {\n-  return localYargs.help()\n-      .strict()\n-      .demandCommand()\n-      .option(\n-          'config',\n-          {type: 'string', demandOption: true, description: 'Path to the configuration file.'})\n-      .option('warnings', {type: 'boolean', description: 'Prints all warnings.'})\n-      .command(\n-          'check', 'Checks if the circular dependencies have changed.', args => args,\n-          argv => {\n-            const {config: configArg, warnings} = argv;\n-            const configPath = isAbsolute(configArg) ? configArg : resolve(configArg);\n-            const config = loadTestConfig(configPath);\n-            process.exit(main(false, config, !!warnings));\n-          })\n-      .command('approve', 'Approves the current circular dependencies.', args => args, argv => {\n-        const {config: configArg, warnings} = argv;\n-        const configPath = isAbsolute(configArg) ? configArg : resolve(configArg);\n-        const config = loadTestConfig(configPath);\n-        process.exit(main(true, config, !!warnings));\n-      });\n-}\n-\n-/**\n- * Runs the ts-circular-dependencies tool.\n- * @param approve Whether the detected circular dependencies should be approved.\n- * @param config Configuration for the current circular dependencies test.\n- * @param printWarnings Whether warnings should be printed out.\n- * @returns Status code.\n- */\n-export function main(\n-    approve: boolean, config: CircularDependenciesTestConfig, printWarnings: boolean): number {\n-  const {baseDir, goldenFile, glob, resolveModule, approveCommand} = config;\n-  const analyzer = new Analyzer(resolveModule);\n-  const cycles: ReferenceChain[] = [];\n-  const checkedNodes = new WeakSet<ts.SourceFile>();\n-\n-  globSync(glob, {absolute: true, ignore: ['**/node_modules/**']}).forEach(filePath => {\n-    const sourceFile = analyzer.getSourceFile(filePath);\n-    cycles.push(...analyzer.findCycles(sourceFile, checkedNodes));\n-  });\n-\n-  const actual = convertReferenceChainToGolden(cycles, baseDir);\n-\n-  info(green(`   Current number of cycles: ${yellow(cycles.length.toString())}`));\n-\n-  if (approve) {\n-    writeFileSync(goldenFile, JSON.stringify(actual, null, 2));\n-    info(green('✅  Updated golden file.'));\n-    return 0;\n-  } else if (!existsSync(goldenFile)) {\n-    error(red(`❌  Could not find golden file: ${goldenFile}`));\n-    return 1;\n-  }\n-\n-  const warningsCount = analyzer.unresolvedFiles.size + analyzer.unresolvedModules.size;\n-\n-  // By default, warnings for unresolved files or modules are not printed. This is because\n-  // it's common that third-party modules are not resolved/visited. Also generated files\n-  // from the View Engine compiler (i.e. factories, summaries) cannot be resolved.\n-  if (printWarnings && warningsCount !== 0) {\n-    info(yellow('⚠  The following imports could not be resolved:'));\n-    Array.from(analyzer.unresolvedModules).sort().forEach(specifier => info(`  • ${specifier}`));\n-    analyzer.unresolvedFiles.forEach((value, key) => {\n-      info(`  • ${getRelativePath(baseDir, key)}`);\n-      value.sort().forEach(specifier => info(`      ${specifier}`));\n-    });\n-  } else {\n-    info(yellow(`⚠  ${warningsCount} imports could not be resolved.`));\n-    info(yellow(`   Please rerun with \"--warnings\" to inspect unresolved imports.`));\n-  }\n-\n-  const expected = JSON.parse(readFileSync(goldenFile, 'utf8')) as Golden;\n-  const {fixedCircularDeps, newCircularDeps} = compareGoldens(actual, expected);\n-  const isMatching = fixedCircularDeps.length === 0 && newCircularDeps.length === 0;\n-\n-  if (isMatching) {\n-    info(green('✅  Golden matches current circular dependencies.'));\n-    return 0;\n-  }\n-\n-  error(red('❌  Golden does not match current circular dependencies.'));\n-  if (newCircularDeps.length !== 0) {\n-    error(yellow(`   New circular dependencies which are not allowed:`));\n-    newCircularDeps.forEach(c => error(`     • ${convertReferenceChainToString(c)}`));\n-    error();\n-  }\n-  if (fixedCircularDeps.length !== 0) {\n-    error(yellow(`   Fixed circular dependencies that need to be removed from the golden:`));\n-    fixedCircularDeps.forEach(c => error(`     • ${convertReferenceChainToString(c)}`));\n-    info(yellow(`\\n   Total: ${newCircularDeps.length} new cycle(s), ${\n-        fixedCircularDeps.length} fixed cycle(s). \\n`));\n-    if (approveCommand) {\n-      info(yellow(`   Please approve the new golden with: ${approveCommand}`));\n-    } else {\n-      info(yellow(\n-          `   Please update the golden. The following command can be ` +\n-          `run: yarn ts-circular-deps approve ${getRelativePath(process.cwd(), goldenFile)}.`));\n-    }\n-  }\n-  return 1;\n-}\n-\n-/** Gets the specified path relative to the base directory. */\n-function getRelativePath(baseDir: string, path: string) {\n-  return convertPathToForwardSlash(relative(baseDir, path));\n-}\n-\n-/** Converts the given reference chain to its string representation. */\n-function convertReferenceChainToString(chain: ReferenceChain<string>) {\n-  return chain.join(' → ');\n-}"
        },
        {
            "sha": "dc7b85b945c3dc7a669e555f5b60c1332ec6bd95",
            "filename": "dev-infra/ts-circular-dependencies/parser.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Fts-circular-dependencies%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Fparser.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,27 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ts from 'typescript';\n-\n-/**\n- * Finds all module references in the specified source file.\n- * @param node Source file which should be parsed.\n- * @returns List of import specifiers in the source file.\n- */\n-export function getModuleReferences(node: ts.SourceFile): string[] {\n-  const references: string[] = [];\n-  const visitNode = (node: ts.Node) => {\n-    if ((ts.isImportDeclaration(node) || ts.isExportDeclaration(node)) &&\n-        node.moduleSpecifier !== undefined && ts.isStringLiteral(node.moduleSpecifier)) {\n-      references.push(node.moduleSpecifier.text);\n-    }\n-    ts.forEachChild(node, visitNode);\n-  };\n-  ts.forEachChild(node, visitNode);\n-  return references;\n-}"
        },
        {
            "sha": "b5c32c096ce0c8d4076339a681159be7c05a0e2e",
            "filename": "dev-infra/tsconfig.json",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftsconfig.json?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,8 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"strict\": true,\n-    \"downlevelIteration\": true,\n-    \"noImplicitAny\": true,\n-    \"noImplicitOverride\": true\n-  }\n-}"
        },
        {
            "sha": "7d7baf8d33e7a6b29e51a42315c56668643cfaa9",
            "filename": "dev-infra/tslint-rules/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftslint-rules%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftslint-rules%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftslint-rules%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,13 +0,0 @@\n-load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"tslint-rules\",\n-    srcs = glob([\"*.ts\"]),\n-    module_name = \"@angular/dev-infra-private/tslint-rules\",\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"@npm//tslib\",\n-        \"@npm//tslint\",\n-        \"@npm//typescript\",\n-    ],\n-)"
        },
        {
            "sha": "73ad2f9fc6dd9d9ed2d821d6c97f773c7f01a4c3",
            "filename": "dev-infra/tslint-rules/noImplicitOverrideAbstractRule.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 145,
            "changes": 145,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftslint-rules%2FnoImplicitOverrideAbstractRule.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Ftslint-rules%2FnoImplicitOverrideAbstractRule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftslint-rules%2FnoImplicitOverrideAbstractRule.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,145 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Replacement, RuleFailure, WalkContext} from 'tslint/lib';\n-import {TypedRule} from 'tslint/lib/rules';\n-import * as ts from 'typescript';\n-\n-const FAILURE_MESSAGE = 'Missing override modifier. Members implemented as part of ' +\n-    'abstract classes must explicitly set the \"override\" modifier. ' +\n-    'More details: https://github.com/microsoft/TypeScript/issues/44457#issuecomment-856202843.';\n-\n-/**\n- * Rule which enforces that class members implementing abstract members\n- * from base classes explicitly specify the `override` modifier.\n- *\n- * This ensures we follow the best-practice of applying `override` for abstract-implemented\n- * members so that TypeScript creates diagnostics in both scenarios where either the abstract\n- * class member is removed, or renamed.\n- *\n- * More details can be found here: https://github.com/microsoft/TypeScript/issues/44457.\n- */\n-export class Rule extends TypedRule {\n-  override applyWithProgram(sourceFile: ts.SourceFile, program: ts.Program): RuleFailure[] {\n-    return this.applyWithFunction(sourceFile, ctx => visitNode(sourceFile, ctx, program));\n-  }\n-}\n-\n-/**\n- * For a TypeScript AST node and each of its child nodes, check whether the node is a class\n- * element which implements an abstract member but does not have the `override` keyword.\n- */\n-function visitNode(node: ts.Node, ctx: WalkContext, program: ts.Program) {\n-  // If a class element implements an abstract member but does not have the\n-  // `override` keyword, create a lint failure.\n-  if (ts.isClassElement(node) && !hasOverrideModifier(node) &&\n-      matchesParentAbstractElement(node, program)) {\n-    ctx.addFailureAtNode(\n-        node, FAILURE_MESSAGE, Replacement.appendText(node.getStart(), `override `));\n-  }\n-\n-  ts.forEachChild(node, node => visitNode(node, ctx, program));\n-}\n-\n-/**\n- * Checks if the specified class element matches a parent abstract class element. i.e.\n- * whether the specified member \"implements\" an abstract member from a base class.\n- */\n-function matchesParentAbstractElement(node: ts.ClassElement, program: ts.Program): boolean {\n-  const containingClass = node.parent as ts.ClassDeclaration;\n-\n-  // If the property we check does not have a property name, we cannot look for similarly-named\n-  // members in parent classes and therefore return early.\n-  if (node.name === undefined) {\n-    return false;\n-  }\n-\n-  const propertyName = getPropertyNameText(node.name);\n-  const typeChecker = program.getTypeChecker();\n-\n-  // If the property we check does not have a statically-analyzable property name,\n-  // we cannot look for similarly-named members in parent classes and return early.\n-  if (propertyName === null) {\n-    return false;\n-  }\n-\n-  return checkClassForInheritedMatchingAbstractMember(containingClass, typeChecker, propertyName);\n-}\n-\n-/** Checks if the given class inherits an abstract member with the specified name. */\n-function checkClassForInheritedMatchingAbstractMember(\n-    clazz: ts.ClassDeclaration, typeChecker: ts.TypeChecker, searchMemberName: string): boolean {\n-  const baseClass = getBaseClass(clazz, typeChecker);\n-\n-  // If the class is not `abstract`, then all parent abstract methods would need to\n-  // be implemented, and there is never an abstract member within the class.\n-  if (baseClass === null || !hasAbstractModifier(baseClass)) {\n-    return false;\n-  }\n-\n-  const matchingMember = baseClass.members.find(\n-      m => m.name !== undefined && getPropertyNameText(m.name) === searchMemberName);\n-\n-  if (matchingMember !== undefined) {\n-    return hasAbstractModifier(matchingMember);\n-  }\n-\n-  return checkClassForInheritedMatchingAbstractMember(baseClass, typeChecker, searchMemberName);\n-}\n-\n-/** Gets the base class for the given class declaration. */\n-function getBaseClass(node: ts.ClassDeclaration, typeChecker: ts.TypeChecker): ts.ClassDeclaration|\n-    null {\n-  const baseTypes = getExtendsHeritageExpressions(node);\n-\n-  if (baseTypes.length > 1) {\n-    throw Error('Class unexpectedly extends from multiple types.');\n-  }\n-\n-  const baseClass = typeChecker.getTypeAtLocation(baseTypes[0]).getSymbol();\n-  const baseClassDecl = baseClass?.valueDeclaration ?? baseClass?.declarations?.[0];\n-\n-  if (baseClassDecl !== undefined && ts.isClassDeclaration(baseClassDecl)) {\n-    return baseClassDecl;\n-  }\n-\n-  return null;\n-}\n-\n-/** Gets the `extends` base type expressions of the specified class. */\n-function getExtendsHeritageExpressions(classDecl: ts.ClassDeclaration):\n-    ts.ExpressionWithTypeArguments[] {\n-  if (classDecl.heritageClauses === undefined) {\n-    return [];\n-  }\n-  const result: ts.ExpressionWithTypeArguments[] = [];\n-  for (const clause of classDecl.heritageClauses) {\n-    if (clause.token === ts.SyntaxKind.ExtendsKeyword) {\n-      result.push(...clause.types);\n-    }\n-  }\n-  return result;\n-}\n-\n-/** Gets whether the specified node has the `abstract` modifier applied. */\n-function hasAbstractModifier(node: ts.Node): boolean {\n-  return !!node.modifiers?.some(s => s.kind === ts.SyntaxKind.AbstractKeyword);\n-}\n-\n-/** Gets whether the specified node has the `override` modifier applied. */\n-function hasOverrideModifier(node: ts.Node): boolean {\n-  return !!node.modifiers?.some(s => s.kind === ts.SyntaxKind.OverrideKeyword);\n-}\n-\n-/** Gets the property name text of the specified property name. */\n-function getPropertyNameText(name: ts.PropertyName): string|null {\n-  if (ts.isComputedPropertyName(name)) {\n-    return null;\n-  }\n-  return name.text;\n-}"
        },
        {
            "sha": "cc51124606a881f8e26ddb6d54c4b35ed3e4083e",
            "filename": "dev-infra/utils/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,32 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"utils\",\n-    srcs = glob([\n-        \"*.ts\",\n-        \"git/*.ts\",\n-    ]),\n-\n-    # prodmode target must be set to es5 as the Octokit class, which is extended is not a proper\n-    # prototyped object.\n-    prodmode_target = \"es5\",\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"@npm//@octokit/core\",\n-        \"@npm//@octokit/graphql\",\n-        \"@npm//@octokit/plugin-paginate-rest\",\n-        \"@npm//@octokit/plugin-rest-endpoint-methods\",\n-        \"@npm//@octokit/rest\",\n-        \"@npm//@octokit/types\",\n-        \"@npm//@types/inquirer\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//@types/yargs\",\n-        \"@npm//chalk\",\n-        \"@npm//inquirer\",\n-        \"@npm//semver\",\n-        \"@npm//tslib\",\n-        \"@npm//typed-graphqlify\",\n-        \"@npm//yargs\",\n-    ],\n-)"
        },
        {
            "sha": "809b39baefc10367319ddea674c4e042d7efc83d",
            "filename": "dev-infra/utils/child-process.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 151,
            "changes": 151,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fchild-process.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fchild-process.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fchild-process.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,151 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {spawn as _spawn, SpawnOptions as _SpawnOptions, spawnSync as _spawnSync, SpawnSyncOptions as _SpawnSyncOptions} from 'child_process';\n-import {debug, error} from './console';\n-\n-\n-/** Interface describing the options for spawning a process synchronously. */\n-export interface SpawnSyncOptions extends Omit<_SpawnSyncOptions, 'shell'|'stdio'> {\n-  /** Whether to prevent exit codes being treated as failures. */\n-  suppressErrorOnFailingExitCode?: boolean;\n-}\n-\n-/** Interface describing the options for spawning a process. */\n-export interface SpawnOptions extends Omit<_SpawnOptions, 'shell'|'stdio'> {\n-  /** Console output mode. Defaults to \"enabled\". */\n-  mode?: 'enabled'|'silent'|'on-error';\n-  /** Whether to prevent exit codes being treated as failures. */\n-  suppressErrorOnFailingExitCode?: boolean;\n-}\n-\n-/** Interface describing the options for spawning an interactive process. */\n-export type SpawnInteractiveCommandOptions = Omit<_SpawnOptions, 'shell'|'stdio'>;\n-\n-/** Interface describing the result of a spawned process. */\n-export interface SpawnResult {\n-  /** Captured stdout in string format. */\n-  stdout: string;\n-  /** Captured stderr in string format. */\n-  stderr: string;\n-  /** The exit code or signal of the process. */\n-  status: number|NodeJS.Signals;\n-}\n-\n-/**\n- * Spawns a given command with the specified arguments inside an interactive shell. All process\n- * stdin, stdout and stderr output is printed to the current console.\n- *\n- * @returns a Promise resolving on success, and rejecting on command failure with the status code.\n- */\n-export function spawnInteractive(\n-    command: string, args: string[], options: SpawnInteractiveCommandOptions = {}) {\n-  return new Promise<void>((resolve, reject) => {\n-    const commandText = `${command} ${args.join(' ')}`;\n-    debug(`Executing command: ${commandText}`);\n-    const childProcess = _spawn(command, args, {...options, shell: true, stdio: 'inherit'});\n-    childProcess.on('exit', status => status === 0 ? resolve() : reject(status));\n-  });\n-}\n-\n-/**\n- * Spawns a given command with the specified arguments inside a shell. All process stdout\n- * output is captured and returned as resolution on completion. Depending on the chosen\n- * output mode, stdout/stderr output is also printed to the console, or only on error.\n- *\n- * @returns a Promise resolving with captured stdout and stderr on success. The promise\n- *   rejects on command failure.\n- */\n-export function spawn(\n-    command: string, args: string[], options: SpawnOptions = {}): Promise<SpawnResult> {\n-  return new Promise((resolve, reject) => {\n-    const commandText = `${command} ${args.join(' ')}`;\n-    const outputMode = options.mode;\n-\n-    debug(`Executing command: ${commandText}`);\n-\n-    const childProcess = _spawn(command, args, {...options, shell: true, stdio: 'pipe'});\n-    let logOutput = '';\n-    let stdout = '';\n-    let stderr = '';\n-\n-    // Capture the stdout separately so that it can be passed as resolve value.\n-    // This is useful if commands return parsable stdout.\n-    childProcess.stderr.on('data', message => {\n-      stderr += message;\n-      logOutput += message;\n-      // If console output is enabled, print the message directly to the stderr. Note that\n-      // we intentionally print all output to stderr as stdout should not be polluted.\n-      if (outputMode === undefined || outputMode === 'enabled') {\n-        process.stderr.write(message);\n-      }\n-    });\n-\n-    childProcess.stdout.on('data', message => {\n-      stdout += message;\n-      logOutput += message;\n-      // If console output is enabled, print the message directly to the stderr. Note that\n-      // we intentionally print all output to stderr as stdout should not be polluted.\n-      if (outputMode === undefined || outputMode === 'enabled') {\n-        process.stderr.write(message);\n-      }\n-    });\n-\n-    childProcess.on('exit', (exitCode, signal) => {\n-      const exitDescription = exitCode !== null ? `exit code \"${exitCode}\"` : `signal \"${signal}\"`;\n-      const printFn = outputMode === 'on-error' ? error : debug;\n-      const status = statusFromExitCodeAndSignal(exitCode, signal);\n-\n-      printFn(`Command \"${commandText}\" completed with ${exitDescription}.`);\n-      printFn(`Process output: \\n${logOutput}`);\n-\n-      // On success, resolve the promise. Otherwise reject with the captured stderr\n-      // and stdout log output if the output mode was set to `silent`.\n-      if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-        resolve({stdout, stderr, status});\n-      } else {\n-        reject(outputMode === 'silent' ? logOutput : undefined);\n-      }\n-    });\n-  });\n-}\n-\n-/**\n- * Spawns a given command with the specified arguments inside a shell synchronously.\n- *\n- * @returns The command's stdout and stderr.\n- */\n-export function spawnSync(\n-    command: string, args: string[], options: SpawnSyncOptions = {}): SpawnResult {\n-  const commandText = `${command} ${args.join(' ')}`;\n-  debug(`Executing command: ${commandText}`);\n-\n-  const {status: exitCode, signal, stdout, stderr} =\n-      _spawnSync(command, args, {...options, encoding: 'utf8', shell: true, stdio: 'pipe'});\n-\n-  /** The status of the spawn result. */\n-  const status = statusFromExitCodeAndSignal(exitCode, signal);\n-\n-  if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-    return {status, stdout, stderr};\n-  }\n-\n-  throw new Error(stderr);\n-}\n-\n-/**\n- * Convert the provided exitCode and signal to a single status code.\n- *\n- * During `exit` node provides either a `code` or `signal`, one of which is guaranteed to be\n- * non-null.\n- *\n- * For more details see: https://nodejs.org/api/child_process.html#child_process_event_exit\n- */\n-function statusFromExitCodeAndSignal(exitCode: number|null, signal: NodeJS.Signals|null) {\n-  return exitCode ?? signal ?? -1;\n-}"
        },
        {
            "sha": "ca9b25e14ff8ecaa546025615623794ec8148bff",
            "filename": "dev-infra/utils/config.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 166,
            "changes": 166,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconfig.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,166 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {existsSync} from 'fs';\n-import {dirname, join} from 'path';\n-\n-import {debug, error} from './console';\n-import {GitClient} from './git/git-client';\n-import {isTsNodeAvailable} from './ts-node';\n-\n-/** Configuration for Git client interactions. */\n-export interface GitClientConfig {\n-  /** Owner name of the repository. */\n-  owner: string;\n-  /** Name of the repository. */\n-  name: string;\n-  /** If SSH protocol should be used for git interactions. */\n-  useSsh?: boolean;\n-  /** Whether the specified repository is private. */\n-  private?: boolean;\n-}\n-\n-/**\n- * Describes the Github configuration for dev-infra. This configuration is\n- * used for API requests, determining the upstream remote, etc.\n- */\n-export interface GithubConfig extends GitClientConfig {}\n-\n-/** The common configuration for ng-dev. */\n-type CommonConfig = {\n-  github: GithubConfig\n-};\n-\n-/**\n- * The configuration for the specific ng-dev command, providing both the common\n- * ng-dev config as well as the specific config of a subcommand.\n- */\n-export type NgDevConfig<T = {}> = CommonConfig&T;\n-\n-/**\n- * The filename expected for creating the ng-dev config, without the file\n- * extension to allow either a typescript or javascript file to be used.\n- */\n-const CONFIG_FILE_PATH = '.ng-dev/config';\n-\n-/** The configuration for ng-dev. */\n-let cachedConfig: NgDevConfig|null = null;\n-\n-/**\n- * The filename expected for local user config, without the file extension to allow a typescript,\n- * javascript or json file to be used.\n- */\n-const USER_CONFIG_FILE_PATH = '.ng-dev.user';\n-\n-/** The local user configuration for ng-dev. */\n-let userConfig: {[key: string]: any}|null = null;\n-\n-/**\n- * Get the configuration from the file system, returning the already loaded\n- * copy if it is defined.\n- */\n-export function getConfig(): NgDevConfig;\n-export function getConfig(baseDir?: string): NgDevConfig;\n-export function getConfig(baseDir?: string): NgDevConfig {\n-  // If the global config is not defined, load it from the file system.\n-  if (cachedConfig === null) {\n-    baseDir = baseDir || GitClient.get().baseDir;\n-    // The full path to the configuration file.\n-    const configPath = join(baseDir, CONFIG_FILE_PATH);\n-    // Read the configuration and validate it before caching it for the future.\n-    cachedConfig = validateCommonConfig(readConfigFile(configPath));\n-  }\n-  // Return a clone of the cached global config to ensure that a new instance of the config\n-  // is returned each time, preventing unexpected effects of modifications to the config object.\n-  return {...cachedConfig};\n-}\n-\n-/** Validate the common configuration has been met for the ng-dev command. */\n-function validateCommonConfig(config: Partial<NgDevConfig>) {\n-  const errors: string[] = [];\n-  // Validate the github configuration.\n-  if (config.github === undefined) {\n-    errors.push(`Github repository not configured. Set the \"github\" option.`);\n-  } else {\n-    if (config.github.name === undefined) {\n-      errors.push(`\"github.name\" is not defined`);\n-    }\n-    if (config.github.owner === undefined) {\n-      errors.push(`\"github.owner\" is not defined`);\n-    }\n-  }\n-  assertNoErrors(errors);\n-  return config as NgDevConfig;\n-}\n-\n-/**\n- * Resolves and reads the specified configuration file, optionally returning an empty object if the\n- * configuration file cannot be read.\n- */\n-function readConfigFile(configPath: string, returnEmptyObjectOnError = false): object {\n-  // If the `.ts` extension has not been set up already, and a TypeScript based\n-  // version of the given configuration seems to exist, set up `ts-node` if available.\n-  if (require.extensions['.ts'] === undefined && existsSync(`${configPath}.ts`) &&\n-      isTsNodeAvailable()) {\n-    // Ensure the module target is set to `commonjs`. This is necessary because the\n-    // dev-infra tool runs in NodeJS which does not support ES modules by default.\n-    // Additionally, set the `dir` option to the directory that contains the configuration\n-    // file. This allows for custom compiler options (such as `--strict`).\n-    require('ts-node').register(\n-        {dir: dirname(configPath), transpileOnly: true, compilerOptions: {module: 'commonjs'}});\n-  }\n-\n-  try {\n-    return require(configPath);\n-  } catch (e) {\n-    if (returnEmptyObjectOnError) {\n-      debug(`Could not read configuration file at ${configPath}, returning empty object instead.`);\n-      debug(e);\n-      return {};\n-    }\n-    error(`Could not read configuration file at ${configPath}.`);\n-    error(e);\n-    process.exit(1);\n-  }\n-}\n-\n-/**\n- * Asserts the provided array of error messages is empty. If any errors are in the array,\n- * logs the errors and exit the process as a failure.\n- */\n-export function assertNoErrors(errors: string[]) {\n-  if (errors.length == 0) {\n-    return;\n-  }\n-  error(`Errors discovered while loading configuration file:`);\n-  for (const err of errors) {\n-    error(`  - ${err}`);\n-  }\n-  process.exit(1);\n-}\n-\n-/**\n- * Get the local user configuration from the file system, returning the already loaded copy if it is\n- * defined.\n- *\n- * @returns The user configuration object, or an empty object if no user configuration file is\n- * present. The object is an untyped object as there are no required user configurations.\n- */\n-export function getUserConfig() {\n-  // If the global config is not defined, load it from the file system.\n-  if (userConfig === null) {\n-    const git = GitClient.get();\n-    // The full path to the configuration file.\n-    const configPath = join(git.baseDir, USER_CONFIG_FILE_PATH);\n-    // Set the global config object.\n-    userConfig = readConfigFile(configPath, true);\n-  }\n-  // Return a clone of the user config to ensure that a new instance of the config is returned\n-  // each time, preventing unexpected effects of modifications to the config object.\n-  return {...userConfig};\n-}"
        },
        {
            "sha": "b24f722f75bc7dad86533265fa3fd84c513e069b",
            "filename": "dev-infra/utils/console.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 184,
            "changes": 184,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fconsole.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fconsole.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconsole.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,184 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as chalk from 'chalk';\n-import {writeFileSync} from 'fs';\n-import {prompt} from 'inquirer';\n-import {join} from 'path';\n-import {Arguments} from 'yargs';\n-\n-import {GitClient} from './git/git-client';\n-\n-/** Reexport of chalk colors for convenient access. */\n-export const red = chalk.red;\n-export const green = chalk.green;\n-export const yellow = chalk.yellow;\n-export const bold = chalk.bold;\n-export const blue = chalk.blue;\n-\n-/** Prompts the user with a confirmation question and a specified message. */\n-export async function promptConfirm(message: string, defaultValue = false): Promise<boolean> {\n-  return (await prompt<{result: boolean}>({\n-           type: 'confirm',\n-           name: 'result',\n-           message: message,\n-           default: defaultValue,\n-         }))\n-      .result;\n-}\n-\n-/** Prompts the user for one line of input. */\n-export async function promptInput(message: string): Promise<string> {\n-  return (await prompt<{result: string}>({type: 'input', name: 'result', message})).result;\n-}\n-\n-/**\n- * Supported levels for logging functions.\n- *\n- * Levels are mapped to numbers to represent a hierarchy of logging levels.\n- */\n-export enum LOG_LEVELS {\n-  SILENT = 0,\n-  ERROR = 1,\n-  WARN = 2,\n-  LOG = 3,\n-  INFO = 4,\n-  DEBUG = 5,\n-}\n-\n-/** Default log level for the tool. */\n-export const DEFAULT_LOG_LEVEL = LOG_LEVELS.INFO;\n-\n-/** Write to the console for at INFO logging level */\n-export const info = buildLogLevelFunction(() => console.info, LOG_LEVELS.INFO);\n-\n-/** Write to the console for at ERROR logging level */\n-export const error = buildLogLevelFunction(() => console.error, LOG_LEVELS.ERROR);\n-\n-/** Write to the console for at DEBUG logging level */\n-export const debug = buildLogLevelFunction(() => console.debug, LOG_LEVELS.DEBUG);\n-\n-/** Write to the console for at LOG logging level */\n-// tslint:disable-next-line: no-console\n-export const log = buildLogLevelFunction(() => console.log, LOG_LEVELS.LOG);\n-\n-/** Write to the console for at WARN logging level */\n-export const warn = buildLogLevelFunction(() => console.warn, LOG_LEVELS.WARN);\n-\n-/** Build an instance of a logging function for the provided level. */\n-function buildLogLevelFunction(loadCommand: () => Function, level: LOG_LEVELS) {\n-  /** Write to stdout for the LOG_LEVEL. */\n-  const loggingFunction = (...text: string[]) => {\n-    runConsoleCommand(loadCommand, level, ...text);\n-  };\n-\n-  /** Start a group at the LOG_LEVEL, optionally starting it as collapsed. */\n-  loggingFunction.group = (text: string, collapsed = false) => {\n-    const command = collapsed ? console.groupCollapsed : console.group;\n-    runConsoleCommand(() => command, level, text);\n-  };\n-\n-  /** End the group at the LOG_LEVEL. */\n-  loggingFunction.groupEnd = () => {\n-    runConsoleCommand(() => console.groupEnd, level);\n-  };\n-\n-  return loggingFunction;\n-}\n-\n-/**\n- * Run the console command provided, if the environments logging level greater than the\n- * provided logging level.\n- *\n- * The loadCommand takes in a function which is called to retrieve the console.* function\n- * to allow for jasmine spies to still work in testing.  Without this method of retrieval\n- * the console.* function, the function is saved into the closure of the created logging\n- * function before jasmine can spy.\n- */\n-function runConsoleCommand(loadCommand: () => Function, logLevel: LOG_LEVELS, ...text: string[]) {\n-  if (getLogLevel() >= logLevel) {\n-    loadCommand()(...text);\n-  }\n-  printToLogFile(logLevel, ...text);\n-}\n-\n-/**\n- * Retrieve the log level from environment variables, if the value found\n- * based on the LOG_LEVEL environment variable is undefined, return the default\n- * logging level.\n- */\n-function getLogLevel() {\n-  const logLevelEnvValue: any = (process.env[`LOG_LEVEL`] || '').toUpperCase();\n-  const logLevel = LOG_LEVELS[logLevelEnvValue];\n-  if (logLevel === undefined) {\n-    return DEFAULT_LOG_LEVEL;\n-  }\n-  return logLevel;\n-}\n-\n-/** All text to write to the log file. */\n-let LOGGED_TEXT = '';\n-/** Whether file logging as been enabled. */\n-let FILE_LOGGING_ENABLED = false;\n-/**\n- * The number of columns used in the prepended log level information on each line of the logging\n- * output file.\n- */\n-const LOG_LEVEL_COLUMNS = 7;\n-\n-/**\n- * Enable writing the logged outputs to the log file on process exit, sets initial lines from the\n- * command execution, containing information about the timing and command parameters.\n- *\n- * This is expected to be called only once during a command run, and should be called by the\n- * middleware of yargs to enable the file logging before the rest of the command parsing and\n- * response is executed.\n- */\n-export function captureLogOutputForCommand(argv: Arguments) {\n-  if (FILE_LOGGING_ENABLED) {\n-    throw Error('`captureLogOutputForCommand` cannot be called multiple times');\n-  }\n-\n-  const git = GitClient.get();\n-  /** The date time used for timestamping when the command was invoked. */\n-  const now = new Date();\n-  /** Header line to separate command runs in log files. */\n-  const headerLine = Array(100).fill('#').join('');\n-  LOGGED_TEXT += `${headerLine}\\nCommand: ${argv.$0} ${argv._.join(' ')}\\nRan at: ${now}\\n`;\n-\n-  // On process exit, write the logged output to the appropriate log files\n-  process.on('exit', (code: number) => {\n-    LOGGED_TEXT += `${headerLine}\\n`;\n-    LOGGED_TEXT += `Command ran in ${new Date().getTime() - now.getTime()}ms\\n`;\n-    LOGGED_TEXT += `Exit Code: ${code}\\n`;\n-    /** Path to the log file location. */\n-    const logFilePath = join(git.baseDir, '.ng-dev.log');\n-\n-    // Strip ANSI escape codes from log outputs.\n-    LOGGED_TEXT = LOGGED_TEXT.replace(/\\x1B\\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]/g, '');\n-\n-    writeFileSync(logFilePath, LOGGED_TEXT);\n-\n-    // For failure codes greater than 1, the new logged lines should be written to a specific log\n-    // file for the command run failure.\n-    if (code > 1) {\n-      const logFileName = `.ng-dev.err-${now.getTime()}.log`;\n-      console.error(`Exit code: ${code}. Writing full log to ${logFileName}`);\n-      writeFileSync(join(git.baseDir, logFileName), LOGGED_TEXT);\n-    }\n-  });\n-\n-  // Mark file logging as enabled to prevent the function from executing multiple times.\n-  FILE_LOGGING_ENABLED = true;\n-}\n-\n-/** Write the provided text to the log file, prepending each line with the log level.  */\n-function printToLogFile(logLevel: LOG_LEVELS, ...text: string[]) {\n-  const logLevelText = `${LOG_LEVELS[logLevel]}:`.padEnd(LOG_LEVEL_COLUMNS);\n-  LOGGED_TEXT += text.join(' ').split('\\n').map(l => `${logLevelText} ${l}\\n`).join('');\n-}"
        },
        {
            "sha": "e1358e4af2ce5a77f937b7523e42354c53348e85",
            "filename": "dev-infra/utils/dry-run.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fdry-run.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fdry-run.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fdry-run.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Argv} from 'yargs';\n-\n-/**\n- * Add a --dry-run flag to the available options for the yargs argv object. When present, sets an\n- * environment variable noting dry run mode.\n- */\n-export function addDryRunFlag<T>(args: Argv<T>) {\n-  return args.option('dry-run' as 'dryRun', {\n-    type: 'boolean',\n-    default: false,\n-    description: 'Whether to do a dry run',\n-    coerce: (dryRun: boolean) => {\n-      if (dryRun) {\n-        process.env['DRY_RUN'] = '1';\n-      }\n-      return dryRun;\n-    }\n-  });\n-}\n-\n-/** Whether the current environment is in dry run mode. */\n-export function isDryRun(): boolean {\n-  return process.env['DRY_RUN'] !== undefined;\n-}\n-\n-/** Error to be thrown when a function or method is called in dryRun mode and shouldn't be. */\n-export class DryRunError extends Error {\n-  constructor() {\n-    super('Cannot call this function in dryRun mode.');\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-    // a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, DryRunError.prototype);\n-  }\n-}"
        },
        {
            "sha": "7cc3987b328dab4cbbc93bca37a4f210022023e0",
            "filename": "dev-infra/utils/git/authenticated-git-client.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 120,
            "changes": 120,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fauthenticated-git-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fauthenticated-git-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fauthenticated-git-client.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,120 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {NgDevConfig} from '../config';\n-import {yellow} from '../console';\n-\n-import {GitClient} from './git-client';\n-import {AuthenticatedGithubClient} from './github';\n-import {getRepositoryGitUrl, GITHUB_TOKEN_GENERATE_URL, GITHUB_TOKEN_SETTINGS_URL} from './github-urls';\n-\n-/** Describes a function that can be used to test for given Github OAuth scopes. */\n-export type OAuthScopeTestFunction = (scopes: string[], missing: string[]) => void;\n-\n-/**\n- * Extension of the `GitClient` with additional utilities which are useful for\n- * authenticated Git client instances.\n- */\n-export class AuthenticatedGitClient extends GitClient {\n-  /**\n-   * Regular expression that matches the provided Github token. Used for\n-   * sanitizing the token from Git child process output.\n-   */\n-  private readonly _githubTokenRegex: RegExp = new RegExp(this.githubToken, 'g');\n-\n-  /** The OAuth scopes available for the provided Github token. */\n-  private _cachedOauthScopes: Promise<string[]>|null = null;\n-\n-  /** Instance of an authenticated github client. */\n-  override readonly github = new AuthenticatedGithubClient(this.githubToken);\n-\n-  protected constructor(readonly githubToken: string, baseDir?: string, config?: NgDevConfig) {\n-    super(baseDir, config);\n-  }\n-\n-  /** Sanitizes a given message by omitting the provided Github token if present. */\n-  override sanitizeConsoleOutput(value: string): string {\n-    return value.replace(this._githubTokenRegex, '<TOKEN>');\n-  }\n-\n-  /** Git URL that resolves to the configured repository. */\n-  override getRepoGitUrl() {\n-    return getRepositoryGitUrl(this.remoteConfig, this.githubToken);\n-  }\n-\n-  /**\n-   * Assert the GitClient instance is using a token with permissions for the all of the\n-   * provided OAuth scopes.\n-   */\n-  async hasOauthScopes(testFn: OAuthScopeTestFunction): Promise<true|{error: string}> {\n-    const scopes = await this._fetchAuthScopesForToken();\n-    const missingScopes: string[] = [];\n-    // Test Github OAuth scopes and collect missing ones.\n-    testFn(scopes, missingScopes);\n-    // If no missing scopes are found, return true to indicate all OAuth Scopes are available.\n-    if (missingScopes.length === 0) {\n-      return true;\n-    }\n-\n-    // Pre-constructed error message to log to the user, providing missing scopes and\n-    // remediation instructions.\n-    const error =\n-        `The provided <TOKEN> does not have required permissions due to missing scope(s): ` +\n-        `${yellow(missingScopes.join(', '))}\\n\\n` +\n-        `Update the token in use at:\\n` +\n-        `  ${GITHUB_TOKEN_SETTINGS_URL}\\n\\n` +\n-        `Alternatively, a new token can be created at: ${GITHUB_TOKEN_GENERATE_URL}\\n`;\n-\n-    return {error};\n-  }\n-\n-  /** Fetch the OAuth scopes for the loaded Github token. */\n-  private _fetchAuthScopesForToken() {\n-    // If the OAuth scopes have already been loaded, return the Promise containing them.\n-    if (this._cachedOauthScopes !== null) {\n-      return this._cachedOauthScopes;\n-    }\n-    // OAuth scopes are loaded via the /rate_limit endpoint to prevent\n-    // usage of a request against that rate_limit for this lookup.\n-    return this._cachedOauthScopes = this.github.rateLimit.get().then(response => {\n-      const scopes = response.headers['x-oauth-scopes'];\n-\n-      // If no token is provided, or if the Github client is authenticated incorrectly,\n-      // the `x-oauth-scopes` response header is not set. We error in such cases as it\n-      // signifies a faulty  of the\n-      if (scopes === undefined) {\n-        throw Error('Unable to retrieve OAuth scopes for token provided to Git client.');\n-      }\n-\n-      return scopes.split(',').map(scope => scope.trim()).filter(scope => scope !== '');\n-    });\n-  }\n-\n-  /** The singleton instance of the `AuthenticatedGitClient`. */\n-  private static _authenticatedInstance: AuthenticatedGitClient;\n-\n-  /**\n-   * Static method to get the singleton instance of the `AuthenticatedGitClient`,\n-   * creating it if it has not yet been created.\n-   */\n-  static override get(): AuthenticatedGitClient {\n-    if (!AuthenticatedGitClient._authenticatedInstance) {\n-      throw new Error('No instance of `AuthenticatedGitClient` has been set up yet.');\n-    }\n-    return AuthenticatedGitClient._authenticatedInstance;\n-  }\n-\n-  /** Configures an authenticated git client. */\n-  static configure(token: string): void {\n-    if (AuthenticatedGitClient._authenticatedInstance) {\n-      throw Error(\n-          'Unable to configure `AuthenticatedGitClient` as it has been configured already.');\n-    }\n-    AuthenticatedGitClient._authenticatedInstance = new AuthenticatedGitClient(token);\n-  }\n-}"
        },
        {
            "sha": "e66f85ed1d9f65dd581969e1b855eed7bb232f13",
            "filename": "dev-infra/utils/git/git-client.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 256,
            "changes": 256,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgit-client.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,256 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {spawnSync, SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n-import {Options as SemVerOptions, parse, SemVer} from 'semver';\n-\n-import {getConfig, GithubConfig, NgDevConfig} from '../config';\n-import {debug, info} from '../console';\n-import {DryRunError, isDryRun} from '../dry-run';\n-\n-import {GithubClient} from './github';\n-import {getRepositoryGitUrl} from './github-urls';\n-\n-/** Error for failed Git commands. */\n-export class GitCommandError extends Error {\n-  constructor(client: GitClient, public args: string[]) {\n-    // Errors are not guaranteed to be caught. To ensure that we don't\n-    // accidentally leak the Github token that might be used in a command,\n-    // we sanitize the command that will be part of the error message.\n-    super(`Command failed: git ${client.sanitizeConsoleOutput(args.join(' '))}`);\n-\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n-    // a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, GitCommandError.prototype);\n-  }\n-}\n-\n-/** The options available for the `GitClient``run` and `runGraceful` methods. */\n-type GitCommandRunOptions = SpawnSyncOptions&{\n-  verboseLogging?: boolean;\n-};\n-\n-/** Class that can be used to perform Git interactions with a given remote. **/\n-export class GitClient {\n-  /** Short-hand for accessing the default remote configuration. */\n-  readonly remoteConfig: GithubConfig = this.config.github;\n-\n-  /** Octokit request parameters object for targeting the configured remote. */\n-  readonly remoteParams = {owner: this.remoteConfig.owner, repo: this.remoteConfig.name};\n-\n-  /** Instance of the Github client. */\n-  readonly github = new GithubClient();\n-\n-  constructor(\n-      /** The full path to the root of the repository base. */\n-      readonly baseDir = determineRepoBaseDirFromCwd(),\n-      /** The configuration, containing the github specific configuration. */\n-      readonly config = getConfig(baseDir)) {}\n-\n-  /** Executes the given git command. Throws if the command fails. */\n-  run(args: string[], options?: GitCommandRunOptions): Omit<SpawnSyncReturns<string>, 'status'> {\n-    const result = this.runGraceful(args, options);\n-    if (result.status !== 0) {\n-      throw new GitCommandError(this, args);\n-    }\n-    // Omit `status` from the type so that it's obvious that the status is never\n-    // non-zero as explained in the method description.\n-    return result as Omit<SpawnSyncReturns<string>, 'status'>;\n-  }\n-\n-  /**\n-   * Spawns a given Git command process. Does not throw if the command fails. Additionally,\n-   * if there is any stderr output, the output will be printed. This makes it easier to\n-   * info failed commands.\n-   */\n-  runGraceful(args: string[], options: GitCommandRunOptions = {}): SpawnSyncReturns<string> {\n-    /** The git command to be run. */\n-    const gitCommand = args[0];\n-\n-    if (isDryRun() && gitCommand === 'push') {\n-      debug(`\"git push\" is not able to be run in dryRun mode.`);\n-      throw new DryRunError();\n-    }\n-\n-    // To improve the debugging experience in case something fails, we print all executed Git\n-    // commands at the DEBUG level to better understand the git actions occurring. Verbose logging,\n-    // always logging at the INFO level, can be enabled either by setting the verboseLogging\n-    // property on the GitClient class or the options object provided to the method.\n-    const printFn = (GitClient.verboseLogging || options.verboseLogging) ? info : debug;\n-    // Note that we sanitize the command before printing it to the console. We do not want to\n-    // print an access token if it is contained in the command. It's common to share errors with\n-    // others if the tool failed, and we do not want to leak tokens.\n-    printFn('Executing: git', this.sanitizeConsoleOutput(args.join(' ')));\n-\n-    const result = spawnSync('git', args, {\n-      cwd: this.baseDir,\n-      stdio: 'pipe',\n-      ...options,\n-      // Encoding is always `utf8` and not overridable. This ensures that this method\n-      // always returns `string` as output instead of buffers.\n-      encoding: 'utf8',\n-    });\n-\n-    if (result.stderr !== null) {\n-      // Git sometimes prints the command if it failed. This means that it could\n-      // potentially leak the Github token used for accessing the remote. To avoid\n-      // printing a token, we sanitize the string before printing the stderr output.\n-      process.stderr.write(this.sanitizeConsoleOutput(result.stderr));\n-    }\n-\n-    return result;\n-  }\n-\n-  /** Git URL that resolves to the configured repository. */\n-  getRepoGitUrl() {\n-    return getRepositoryGitUrl(this.remoteConfig);\n-  }\n-\n-  /** Whether the given branch contains the specified SHA. */\n-  hasCommit(branchName: string, sha: string): boolean {\n-    return this.run(['branch', branchName, '--contains', sha]).stdout !== '';\n-  }\n-\n-  /** Gets the currently checked out branch or revision. */\n-  getCurrentBranchOrRevision(): string {\n-    const branchName = this.run(['rev-parse', '--abbrev-ref', 'HEAD']).stdout.trim();\n-    // If no branch name could be resolved. i.e. `HEAD` has been returned, then Git\n-    // is currently in a detached state. In those cases, we just want to return the\n-    // currently checked out revision/SHA.\n-    if (branchName === 'HEAD') {\n-      return this.run(['rev-parse', 'HEAD']).stdout.trim();\n-    }\n-    return branchName;\n-  }\n-\n-  /** Gets whether the current Git repository has uncommitted changes. */\n-  hasUncommittedChanges(): boolean {\n-    return this.runGraceful(['diff-index', '--quiet', 'HEAD']).status !== 0;\n-  }\n-\n-  /**\n-   * Checks out a requested branch or revision, optionally cleaning the state of the repository\n-   * before attempting the checking. Returns a boolean indicating whether the branch or revision\n-   * was cleanly checked out.\n-   */\n-  checkout(branchOrRevision: string, cleanState: boolean): boolean {\n-    if (cleanState) {\n-      // Abort any outstanding ams.\n-      this.runGraceful(['am', '--abort'], {stdio: 'ignore'});\n-      // Abort any outstanding cherry-picks.\n-      this.runGraceful(['cherry-pick', '--abort'], {stdio: 'ignore'});\n-      // Abort any outstanding rebases.\n-      this.runGraceful(['rebase', '--abort'], {stdio: 'ignore'});\n-      // Clear any changes in the current repo.\n-      this.runGraceful(['reset', '--hard'], {stdio: 'ignore'});\n-    }\n-    return this.runGraceful(['checkout', branchOrRevision], {stdio: 'ignore'}).status === 0;\n-  }\n-\n-  /** Gets the latest git tag on the current branch that matches SemVer. */\n-  getLatestSemverTag(): SemVer {\n-    const semVerOptions: SemVerOptions = {loose: true};\n-    const tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n-    const latestTag = tags.find((tag: string) => parse(tag, semVerOptions));\n-\n-    if (latestTag === undefined) {\n-      throw new Error(\n-          `Unable to find a SemVer matching tag on \"${this.getCurrentBranchOrRevision()}\"`);\n-    }\n-    return new SemVer(latestTag, semVerOptions);\n-  }\n-\n-  /** Retrieves the git tag matching the provided SemVer, if it exists. */\n-  getMatchingTagForSemver(semver: SemVer): string {\n-    const semVerOptions: SemVerOptions = {loose: true};\n-    const tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n-    const matchingTag =\n-        tags.find((tag: string) => parse(tag, semVerOptions)?.compare(semver) === 0);\n-\n-    if (matchingTag === undefined) {\n-      throw new Error(`Unable to find a tag for the version: \"${semver.format()}\"`);\n-    }\n-    return matchingTag;\n-  }\n-\n-  /** Retrieve a list of all files in the repository changed since the provided shaOrRef. */\n-  allChangesFilesSince(shaOrRef = 'HEAD'): string[] {\n-    return Array.from(new Set([\n-      ...gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=d', shaOrRef])),\n-      ...gitOutputAsArray(this.runGraceful(['ls-files', '--others', '--exclude-standard'])),\n-    ]));\n-  }\n-\n-  /** Retrieve a list of all files currently staged in the repostitory. */\n-  allStagedFiles(): string[] {\n-    return gitOutputAsArray(\n-        this.runGraceful(['diff', '--name-only', '--diff-filter=ACM', '--staged']));\n-  }\n-\n-  /** Retrieve a list of all files tracked in the repository. */\n-  allFiles(): string[] {\n-    return gitOutputAsArray(this.runGraceful(['ls-files']));\n-  }\n-\n-  /**\n-   * Sanitizes the given console message. This method can be overridden by\n-   * derived classes. e.g. to sanitize access tokens from Git commands.\n-   */\n-  sanitizeConsoleOutput(value: string) {\n-    return value;\n-  }\n-\n-  /** Whether verbose logging of Git actions should be used. */\n-  private static verboseLogging = false;\n-\n-  /** The singleton instance of the unauthenticated `GitClient`. */\n-  private static _unauthenticatedInstance: GitClient;\n-\n-  /** Set the verbose logging state of all git client instances. */\n-  static setVerboseLoggingState(verbose: boolean) {\n-    GitClient.verboseLogging = verbose;\n-  }\n-\n-  /**\n-   * Static method to get the singleton instance of the `GitClient`, creating it\n-   * if it has not yet been created.\n-   */\n-  static get(): GitClient {\n-    if (!this._unauthenticatedInstance) {\n-      GitClient._unauthenticatedInstance = new GitClient();\n-    }\n-    return GitClient._unauthenticatedInstance;\n-  }\n-}\n-\n-/**\n- * Takes the output from `run` and `runGraceful` and returns an array of strings for each\n- * new line. Git commands typically return multiple output values for a command a set of\n- * strings separated by new lines.\n- *\n- * Note: This is specifically created as a locally available function for usage as convenience\n- * utility within `GitClient`'s methods to create outputs as array.\n- */\n-function gitOutputAsArray(gitCommandResult: SpawnSyncReturns<string>): string[] {\n-  return gitCommandResult.stdout.split('\\n').map(x => x.trim()).filter(x => !!x);\n-}\n-\n-/** Determines the repository base directory from the current working directory. */\n-function determineRepoBaseDirFromCwd() {\n-  // TODO(devversion): Replace with common spawn sync utility once available.\n-  const {stdout, stderr, status} = spawnSync(\n-      'git', ['rev-parse --show-toplevel'], {shell: true, stdio: 'pipe', encoding: 'utf8'});\n-  if (status !== 0) {\n-    throw Error(\n-        `Unable to find the path to the base directory of the repository.\\n` +\n-        `Was the command run from inside of the repo?\\n\\n` +\n-        `${stderr}`);\n-  }\n-  return stdout.trim();\n-}"
        },
        {
            "sha": "bce1e08fbae7bdd2be2049c76d1e14a227219240",
            "filename": "dev-infra/utils/git/github-urls.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub-urls.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub-urls.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgithub-urls.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,43 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-\n-import {URL} from 'url';\n-\n-import {GithubConfig} from '../config';\n-import {GitClient} from './git-client';\n-\n-/** URL to the Github page where personal access tokens can be managed. */\n-export const GITHUB_TOKEN_SETTINGS_URL = 'https://github.com/settings/tokens';\n-\n-/** URL to the Github page where personal access tokens can be generated. */\n-export const GITHUB_TOKEN_GENERATE_URL = 'https://github.com/settings/tokens/new';\n-\n-/** Adds the provided token to the given Github HTTPs remote url. */\n-export function addTokenToGitHttpsUrl(githubHttpsUrl: string, token: string) {\n-  const url = new URL(githubHttpsUrl);\n-  url.username = token;\n-  return url.href;\n-}\n-\n-/** Gets the repository Git URL for the given github config. */\n-export function getRepositoryGitUrl(config: GithubConfig, githubToken?: string): string {\n-  if (config.useSsh) {\n-    return `git@github.com:${config.owner}/${config.name}.git`;\n-  }\n-  const baseHttpUrl = `https://github.com/${config.owner}/${config.name}.git`;\n-  if (githubToken !== undefined) {\n-    return addTokenToGitHttpsUrl(baseHttpUrl, githubToken);\n-  }\n-  return baseHttpUrl;\n-}\n-\n-/** Gets a Github URL that refers to a list of recent commits within a specified branch. */\n-export function getListCommitsInBranchUrl({remoteParams}: GitClient, branchName: string) {\n-  return `https://github.com/${remoteParams.owner}/${remoteParams.repo}/commits/${branchName}`;\n-}"
        },
        {
            "sha": "606d66bdd055acc2fa3e2d0926ad5665bbdf8ea2",
            "filename": "dev-infra/utils/git/github-yargs.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub-yargs.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub-yargs.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgithub-yargs.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,44 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Argv} from 'yargs';\n-\n-import {error, red, yellow} from '../console';\n-\n-import {AuthenticatedGitClient} from './authenticated-git-client';\n-import {GITHUB_TOKEN_GENERATE_URL} from './github-urls';\n-\n-export type ArgvWithGithubToken = Argv<{githubToken: string}>;\n-\n-/** Sets up the `github-token` command option for the given Yargs instance. */\n-export function addGithubTokenOption(yargs: Argv): ArgvWithGithubToken {\n-  return yargs\n-      // 'github-token' is casted to 'githubToken' to properly set up typings to reflect the key in\n-      // the Argv object being camelCase rather than kebab case due to the `camel-case-expansion`\n-      // config: https://github.com/yargs/yargs-parser#camel-case-expansion\n-      .option('github-token' as 'githubToken', {\n-        type: 'string',\n-        description: 'Github token. If not set, token is retrieved from the environment variables.',\n-        coerce: (token: string) => {\n-          const githubToken = token || process.env.GITHUB_TOKEN || process.env.TOKEN;\n-          if (!githubToken) {\n-            error(red('No Github token set. Please set the `GITHUB_TOKEN` environment variable.'));\n-            error(red('Alternatively, pass the `--github-token` command line flag.'));\n-            error(yellow(`You can generate a token here: ${GITHUB_TOKEN_GENERATE_URL}`));\n-            process.exit(1);\n-          }\n-          try {\n-            AuthenticatedGitClient.get();\n-          } catch {\n-            AuthenticatedGitClient.configure(githubToken);\n-          }\n-          return githubToken;\n-        },\n-      })\n-      .default('github-token' as 'githubToken', '', '<LOCAL TOKEN>');\n-}"
        },
        {
            "sha": "3b0891d1c70d89b825da7707bd3414e8edd1d3a5",
            "filename": "dev-infra/utils/git/github.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 75,
            "changes": 75,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgit%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgithub.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,75 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {OctokitOptions} from '@octokit/core/dist-types/types';\n-import {graphql} from '@octokit/graphql';\n-import {PaginateInterface} from '@octokit/plugin-paginate-rest';\n-import {RestEndpointMethods} from '@octokit/plugin-rest-endpoint-methods/dist-types/generated/method-types';\n-import {Octokit} from '@octokit/rest';\n-import {RequestParameters} from '@octokit/types';\n-import {query} from 'typed-graphqlify';\n-\n-/**\n- * An object representation of a Graphql Query to be used as a response type and\n- * to generate a Graphql query string.\n- */\n-export type GraphqlQueryObject = Parameters<typeof query>[1];\n-\n-/** Interface describing a Github repository. */\n-export interface GithubRepo {\n-  /** Owner login of the repository. */\n-  owner: string;\n-  /** Name of the repository. */\n-  name: string;\n-}\n-\n-/** Error for failed Github API requests. */\n-export class GithubApiRequestError extends Error {\n-  constructor(public status: number, message: string) {\n-    super(message);\n-  }\n-}\n-\n-/** A Github client for interacting with the Github APIs. */\n-export class GithubClient {\n-  /** The octokit instance actually performing API requests. */\n-  private _octokit = new Octokit(this._octokitOptions);\n-\n-  readonly pulls = this._octokit.pulls;\n-  readonly repos = this._octokit.repos;\n-  readonly issues = this._octokit.issues;\n-  readonly git = this._octokit.git;\n-  readonly rateLimit = this._octokit.rateLimit;\n-  readonly teams = this._octokit.teams;\n-\n-  // Note: These are properties from `Octokit` that are brought in by optional plugins.\n-  // TypeScript requires us to provide an explicit type for these.\n-  readonly rest: RestEndpointMethods = this._octokit.rest;\n-  readonly paginate: PaginateInterface = this._octokit.paginate;\n-\n-  constructor(private _octokitOptions?: OctokitOptions) {}\n-}\n-\n-/**\n- * Extension of the `GithubClient` that provides utilities which are specific\n- * to authenticated instances.\n- */\n-export class AuthenticatedGithubClient extends GithubClient {\n-  /** The graphql instance with authentication set during construction. */\n-  private _graphql = graphql.defaults({headers: {authorization: `token ${this._token}`}});\n-\n-  constructor(private _token: string) {\n-    // Set the token for the octokit instance.\n-    super({auth: _token});\n-  }\n-\n-  /** Perform a query using Github's Graphql API. */\n-  async graphql<T extends GraphqlQueryObject>(queryObject: T, params: RequestParameters = {}) {\n-    return (await this._graphql(query(queryObject).toString(), params)) as T;\n-  }\n-}"
        },
        {
            "sha": "9df744378ed47dc5ba818d99c36704d6d288a212",
            "filename": "dev-infra/utils/github.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 85,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgithub.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,85 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {params, types} from 'typed-graphqlify';\n-import {AuthenticatedGitClient} from './git/authenticated-git-client';\n-\n-\n-/** Get a PR from github  */\n-export async function getPr<PrSchema>(\n-    prSchema: PrSchema, prNumber: number, git: AuthenticatedGitClient) {\n-  /** The owner and name of the repository */\n-  const {owner, name} = git.remoteConfig;\n-  /** The Graphql query object to get a the PR */\n-  const PR_QUERY = params(\n-      {\n-        $number: 'Int!',    // The PR number\n-        $owner: 'String!',  // The organization to query for\n-        $name: 'String!',   // The organization to query for\n-      },\n-      {\n-        repository: params({owner: '$owner', name: '$name'}, {\n-          pullRequest: params({number: '$number'}, prSchema),\n-        })\n-      });\n-\n-  const result = (await git.github.graphql(PR_QUERY, {number: prNumber, owner, name}));\n-  return result.repository.pullRequest;\n-}\n-\n-/** Get all pending PRs from github  */\n-export async function getPendingPrs<PrSchema>(prSchema: PrSchema, git: AuthenticatedGitClient) {\n-  /** The owner and name of the repository */\n-  const {owner, name} = git.remoteConfig;\n-  /** The Graphql query object to get a page of pending PRs */\n-  const PRS_QUERY = params(\n-      {\n-        $first: 'Int',      // How many entries to get with each request\n-        $after: 'String',   // The cursor to start the page at\n-        $owner: 'String!',  // The organization to query for\n-        $name: 'String!',   // The repository to query for\n-      },\n-      {\n-        repository: params({owner: '$owner', name: '$name'}, {\n-          pullRequests: params(\n-              {\n-                first: '$first',\n-                after: '$after',\n-                states: `OPEN`,\n-              },\n-              {\n-                nodes: [prSchema],\n-                pageInfo: {\n-                  hasNextPage: types.boolean,\n-                  endCursor: types.string,\n-                },\n-              }),\n-        })\n-      });\n-  /** The current cursor */\n-  let cursor: string|undefined;\n-  /** If an additional page of members is expected */\n-  let hasNextPage = true;\n-  /** Array of pending PRs */\n-  const prs: Array<PrSchema> = [];\n-\n-  // For each page of the response, get the page and add it to the list of PRs\n-  while (hasNextPage) {\n-    const params = {\n-      after: cursor || null,\n-      first: 100,\n-      owner,\n-      name,\n-    };\n-    const results = await git.github.graphql(PRS_QUERY, params) as typeof PRS_QUERY;\n-    prs.push(...results.repository.pullRequests.nodes);\n-    hasNextPage = results.repository.pullRequests.pageInfo.hasNextPage;\n-    cursor = results.repository.pullRequests.pageInfo.endCursor;\n-  }\n-  return prs;\n-}"
        },
        {
            "sha": "bddf9e2e1a20cccf01b0f34961e9228b9c4fc8f4",
            "filename": "dev-infra/utils/inquirer-autocomplete-typings.d.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Finquirer-autocomplete-typings.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Finquirer-autocomplete-typings.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Finquirer-autocomplete-typings.d.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// inquirer-autocomplete-prompt doesn't provide types and no types are made available via\n-// DefinitelyTyped.\n-declare module \"inquirer-autocomplete-prompt\" {\n-\n-  import {registerPrompt} from 'inquirer';\n-\n-  let AutocompletePrompt: Parameters<typeof registerPrompt>[1];\n-  export = AutocompletePrompt;\n-}"
        },
        {
            "sha": "ad2141435ff31177ab862d817b98adeb5ecdb068",
            "filename": "dev-infra/utils/semver.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fsemver.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fsemver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fsemver.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as semver from 'semver';\n-\n-/**\n- * Increments a specified SemVer version. Compared to the original increment in SemVer,\n- * the version is cloned to not modify the original version instance.\n- */\n-export function semverInc(\n-    version: semver.SemVer, release: semver.ReleaseType, identifier?: string) {\n-  const clone = new semver.SemVer(version.version);\n-  return clone.inc(release, identifier);\n-}\n-\n-/** Creates the equivalent experimental version for a provided SemVer. */\n-export function createExperimentalSemver(version: string|semver.SemVer): semver.SemVer {\n-  version = new semver.SemVer(version);\n-  const experimentalVersion = new semver.SemVer(version.format());\n-  experimentalVersion.major = 0;\n-  experimentalVersion.minor = version.major * 100 + version.minor;\n-  return new semver.SemVer(experimentalVersion.format());\n-}"
        },
        {
            "sha": "160d4391971ae6c8be0ab77d9d15a1a9f94d7ee3",
            "filename": "dev-infra/utils/testing/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2FBUILD.bazel?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,16 +0,0 @@\n-load(\"//dev-infra:defaults.bzl\", \"ts_library\")\n-\n-ts_library(\n-    name = \"testing\",\n-    srcs = glob([\"*.ts\"]),\n-    visibility = [\"//dev-infra:__subpackages__\"],\n-    deps = [\n-        \"//dev-infra/utils\",\n-        \"@npm//@types/jasmine\",\n-        \"@npm//@types/minimist\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/semver\",\n-        \"@npm//minimist\",\n-        \"@npm//semver\",\n-    ],\n-)"
        },
        {
            "sha": "094250cbf50f954ff886999920c559714ebd0831",
            "filename": "dev-infra/utils/testing/github-pagination-header.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fgithub-pagination-header.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fgithub-pagination-header.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Fgithub-pagination-header.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,28 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/**\n- * Builds the `Link` response header to indicate an API response that is suitable\n- * for pagination. This follows the specification as outlined within:\n- * https://docs.github.com/en/rest/guides/traversing-with-pagination\n- */\n-export function buildGithubPaginationResponseHeader(\n-    totalPages: number, currentPage: number, baseUrl: string) {\n-  const links = [`<${baseUrl}?page=1>; rel=\"first\"`, `<${baseUrl}?page=${totalPages}>; rel=\"last\"`];\n-\n-  if (currentPage < totalPages) {\n-    links.push(`<${baseUrl}?page=${currentPage + 1}>; rel=\"next\"`);\n-  }\n-\n-  // Pages start with `1` as per the Github API specification.\n-  if (currentPage > 1) {\n-    links.push(`<${baseUrl}?page=${currentPage - 1}>; rel=\"prev\"`);\n-  }\n-\n-  return links.join(',');\n-}"
        },
        {
            "sha": "30052d6e230d46ecce2f3417d2ae8457a4125e83",
            "filename": "dev-infra/utils/testing/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Findex.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,11 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export * from './semver-matchers';\n-export * from './virtual-git-client';\n-export * from './virtual-git-matchers';"
        },
        {
            "sha": "fa38e6af12bc41d05989c59d9624b0b76ea27697",
            "filename": "dev-infra/utils/testing/semver-matchers.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fsemver-matchers.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fsemver-matchers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Fsemver-matchers.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,12 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** Gets a jasmine asymmetric matcher for matching a given SemVer version. */\n-export function matchesVersion(versionName: string) {\n-  return jasmine.objectContaining({raw: versionName, version: versionName});\n-}"
        },
        {
            "sha": "17202127c2e233e051325d8e1b991f128c85d9da",
            "filename": "dev-infra/utils/testing/virtual-git-client.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 217,
            "changes": 217,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,217 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n-import * as parseArgs from 'minimist';\n-import {SemVer} from 'semver';\n-\n-import {NgDevConfig} from '../config';\n-import {AuthenticatedGitClient} from '../git/authenticated-git-client';\n-import {GitClient} from '../git/git-client';\n-\n-/**\n- * Temporary directory which will be used as project directory in tests. Note that\n- * this environment variable is automatically set by Bazel for tests.\n- */\n-export const testTmpDir: string = process.env['TEST_TMPDIR']!;\n-\n-\n-/** A mock instance of a configuration for the ng-dev toolset for default testing. */\n-export const mockNgDevConfig: NgDevConfig = {\n-  github: {\n-    name: 'name',\n-    owner: 'owner',\n-  }\n-};\n-\n-\n-/** Type describing a Git head. */\n-interface GitHead {\n-  /** Name of the head. Not defined in a detached state. */\n-  branch?: string;\n-  /** Ref associated with this head. i.e. the remote base of this head. */\n-  ref?: RemoteRef;\n-  /** List of commits added to this head (on top of the ref's base). */\n-  newCommits: Commit[];\n-}\n-\n-/** Type describing a remote Git ref. */\n-export interface RemoteRef {\n-  /** Name of the reference. */\n-  name: string;\n-  /** Repository containing this ref. */\n-  repoUrl: string;\n-}\n-\n-/** Type describing a Git commit. */\n-export interface Commit {\n-  /** Commit message. */\n-  message: string;\n-  /** List of files included in this commit. */\n-  files: string[];\n-}\n-\n-/**\n- * Virtual git client that mocks Git commands and keeps track of the repository state\n- * in memory. This allows for convenient test assertions with Git interactions.\n- */\n-export class VirtualGitClient extends AuthenticatedGitClient {\n-  static createInstance(config = mockNgDevConfig, tmpDir = testTmpDir): VirtualGitClient {\n-    return new VirtualGitClient('abc123', tmpDir, config);\n-  }\n-\n-  /** Current Git HEAD that has been previously fetched. */\n-  fetchHeadRef: RemoteRef|null = null;\n-  /** List of known branches in the repository. */\n-  branches: {[branchName: string]: GitHead} = {master: {branch: 'master', newCommits: []}};\n-  /** Current checked out HEAD in the repository. */\n-  head: GitHead = this.branches['master'];\n-  /** List of pushed heads to a given remote ref. */\n-  pushed: {remote: RemoteRef, head: GitHead}[] = [];\n-\n-  /**\n-   * Override the actual GitClient getLatestSemverTag, as an actual tag cannot be retrieved in\n-   * testing.\n-   */\n-  override getLatestSemverTag() {\n-    return new SemVer('0.0.0');\n-  }\n-\n-  /**\n-   * Override the actual GitClient getLatestSemverTag, as an actual tags cannot be checked during\n-   * testing, return back the SemVer version as the tag.\n-   */\n-  override getMatchingTagForSemver(semver: SemVer) {\n-    return semver.format();\n-  }\n-\n-  /** Override for the actual Git client command execution. */\n-  override runGraceful(args: string[], options: SpawnSyncOptions = {}): SpawnSyncReturns<string> {\n-    const [command, ...rawArgs] = args;\n-    switch (command) {\n-      case 'push':\n-        this._push(rawArgs);\n-        break;\n-      case 'fetch':\n-        this._fetch(rawArgs);\n-        break;\n-      case 'checkout':\n-        this._checkout(rawArgs);\n-        break;\n-      case 'commit':\n-        this._commit(rawArgs);\n-        break;\n-    }\n-\n-    // Return a fake spawn sync return value. We error non-gracefully if any command fails\n-    // in the tests, so we always return success and stub out the `SpawnSyncReturns` type.\n-    return {status: 0, stderr: '', output: [], pid: -1, signal: null, stdout: ''};\n-  }\n-\n-  /** Handler for the `git push` command. */\n-  private _push(args: string[]) {\n-    const [repoUrl, refspec] = parseArgs(args, {boolean: ['q']})._;\n-    const ref = this._unwrapRefspec(refspec);\n-    const name = ref.destination || ref.source;\n-    const existingPush =\n-        this.pushed.find(({remote}) => remote.repoUrl === repoUrl && remote.name === name);\n-    const pushedHead = this._cloneHead(this.head);\n-\n-    // Either, update a previously pushed branch, or keep track of a newly\n-    // performed branch push. We don't respect the `--force` flag.\n-    if (existingPush !== undefined) {\n-      existingPush.head = pushedHead;\n-    } else {\n-      this.pushed.push({remote: {repoUrl, name}, head: pushedHead});\n-    }\n-  }\n-\n-  /** Handler for the `git commit` command. */\n-  private _commit(rawArgs: string[]) {\n-    const args = parseArgs(rawArgs, {string: ['m', 'message']});\n-    const message = args['m'] || args['message'];\n-    const files = args._;\n-    if (!message) {\n-      throw Error('No commit message has been specified.');\n-    }\n-    this.head.newCommits.push({message, files});\n-  }\n-\n-  /** Handler for the `git fetch` command. */\n-  private _fetch(rawArgs: string[]) {\n-    const args = parseArgs(rawArgs, {boolean: ['f', 'force', 'q', 'quiet']});\n-    const [repoUrl, refspec] = args._;\n-    const force = args['f'] || args['force'];\n-    const ref = this._unwrapRefspec(refspec);\n-\n-    // Keep track of the fetch head, so that it can be checked out\n-    // later in a detached state.\n-    this.fetchHeadRef = {name: ref.source, repoUrl};\n-\n-    // If a destination has been specified in the ref spec, add it to the\n-    // list of available local branches.\n-    if (ref.destination) {\n-      if (this.branches[ref.destination] && !force) {\n-        throw Error('Cannot override existing local branch when fetching.');\n-      }\n-      this.branches[ref.destination] = {\n-        branch: ref.destination,\n-        ref: this.fetchHeadRef,\n-        newCommits: [],\n-      };\n-    }\n-  }\n-\n-  /** Handler for the `git checkout` command. */\n-  private _checkout(rawArgs: string[]) {\n-    const args = parseArgs(rawArgs, {boolean: ['detach', 'B', 'q']});\n-    const createBranch = args['B'];\n-    const detached = args['detach'];\n-    const [target] = args._;\n-\n-    if (target === 'FETCH_HEAD') {\n-      if (this.fetchHeadRef === null) {\n-        throw Error('Unexpectedly trying to check out \"FETCH_HEAD\". Not fetch head set.');\n-      }\n-      this.head = {ref: this.fetchHeadRef, newCommits: []};\n-    } else if (this.branches[target]) {\n-      this.head = this._cloneHead(this.branches[target], detached);\n-    } else if (createBranch) {\n-      this.head = this.branches[target] = {branch: target, ...this._cloneHead(this.head, detached)};\n-    } else {\n-      throw Error(`Unexpected branch checked out: ${target}`);\n-    }\n-  }\n-\n-  /**\n-   * Unwraps a refspec into the base and target ref names.\n-   * https://git-scm.com/docs/git-fetch#Documentation/git-fetch.txt-ltrefspecgt.\n-   */\n-  private _unwrapRefspec(refspec: string): {source: string, destination?: string} {\n-    const [source, destination] = refspec.split(':');\n-    if (!destination) {\n-      return {source};\n-    } else {\n-      return {source, destination};\n-    }\n-  }\n-\n-  /** Clones the specified Git head with respect to the detached flag. */\n-  private _cloneHead(head: GitHead, detached = false): GitHead {\n-    return {\n-      branch: detached ? undefined : head.branch,\n-      ref: head.ref,\n-      newCommits: [...head.newCommits],\n-    };\n-  }\n-}\n-\n-export function installVirtualGitClientSpies(mockInstance = VirtualGitClient.createInstance()) {\n-  spyOn(GitClient, 'get').and.returnValue(mockInstance);\n-  spyOn(AuthenticatedGitClient, 'get').and.returnValue(mockInstance);\n-}"
        },
        {
            "sha": "6e09d76facc53d29ad13a3a5893d1d2be7601b8a",
            "filename": "dev-infra/utils/testing/virtual-git-matchers.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fvirtual-git-matchers.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Ftesting%2Fvirtual-git-matchers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Fvirtual-git-matchers.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,41 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {GithubRepo} from '../git/github';\n-\n-import {Commit} from './virtual-git-client';\n-\n-/** Interface describing the match parameters for a virtual Git client push. */\n-interface BranchPushMatchParameters {\n-  targetRepo: GithubRepo;\n-  targetBranch: string;\n-  baseRepo: GithubRepo;\n-  baseBranch: string;\n-  expectedCommits: Commit[]|jasmine.ArrayContaining<Commit>;\n-}\n-\n-/**\n- * Gets a jasmine object matcher for asserting that a virtual Git client push\n- * matches the specified branch push (through the match parameters).\n- */\n-export function getBranchPushMatcher(options: BranchPushMatchParameters) {\n-  const {targetRepo, targetBranch, baseBranch, baseRepo, expectedCommits} = options;\n-  return jasmine.objectContaining({\n-    remote: {\n-      repoUrl: `https://abc123@github.com/${targetRepo.owner}/${targetRepo.name}.git`,\n-      name: `refs/heads/${targetBranch}`\n-    },\n-    head: jasmine.objectContaining({\n-      newCommits: expectedCommits,\n-      ref: {\n-        repoUrl: `https://abc123@github.com/${baseRepo.owner}/${baseRepo.name}.git`,\n-        name: baseBranch,\n-      },\n-    })\n-  });\n-}"
        },
        {
            "sha": "f8bb14079435ebc11a5e917acfd4b023751e1af5",
            "filename": "dev-infra/utils/ts-node.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fts-node.ts",
            "raw_url": "https://github.com/angular/angular/raw/30bf47259715057b69837556010d7b91792a1ae6/dev-infra%2Futils%2Fts-node.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fts-node.ts?ref=30bf47259715057b69837556010d7b91792a1ae6",
            "patch": "@@ -1,17 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-/** Whether ts-node has been installed and is available to ng-dev. */\n-export function isTsNodeAvailable(): boolean {\n-  try {\n-    require.resolve('ts-node');\n-    return true;\n-  } catch {\n-    return false;\n-  }\n-}"
        },
        {
            "sha": "385c36115fc9d580df260cb90285934ae1962ccd",
            "filename": "docs/FIXUP_COMMITS.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/docs%2FFIXUP_COMMITS.md",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/docs%2FFIXUP_COMMITS.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/docs%2FFIXUP_COMMITS.md?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -48,7 +48,7 @@ Here is where fixup commits come in handy.\n By addressing review feedback in fixup commits, you make it very straight forward for the reviewer to see what are the new changes that need to be reviewed and verify that their earlier feedback has been addressed.\n This can save a lot of effort, especially on larger Pull Requests (where having to re-review _all_ the changes is pretty wasteful).\n \n-When the time comes to merge the Pull Request into the repository, the merge script [knows how to automatically squash](../dev-infra/pr/merge/strategies/autosquash-merge.ts) fixup commits with the corresponding regular commits.\n+When the time comes to merge the Pull Request into the repository, the merge script knows how to automatically squash fixup commits with the corresponding regular commits.\n \n \n ## <a name=\"create-fixup-commits\"></a> Creating fixup commits\n@@ -69,7 +69,7 @@ git commit --fixup <COMMIT_SHA> ...\n \n ## <a name=\"squash-fixup-commits\"></a> Squashing fixup commits\n \n-As mentioned above, the merge script will [automatically squash](../dev-infra/pr/merge/strategies/autosquash-merge.ts) fixup commits.\n+As mentioned above, the merge script will automatically squash fixup commits.\n However, sometimes you might want to manually squash a fixup commit.\n \n "
        },
        {
            "sha": "0a6a308638bdd9d6f29f40cb226b260545b1adbd",
            "filename": "modules/benchmarks/e2e_test.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fe2e_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fe2e_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fe2e_test.bzl?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -9,7 +9,7 @@ load(\"//tools:defaults.bzl\", \"protractor_web_test_suite\")\n def e2e_test(name, server, **kwargs):\n     protractor_web_test_suite(\n         name = name,\n-        on_prepare = \"//dev-infra/benchmark/component_benchmark:start-server.js\",\n+        on_prepare = \"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:start-server.js\",\n         server = server,\n         **kwargs\n     )"
        },
        {
            "sha": "a98c034829cc68f5838a908ec3840cefc1c99a46",
            "filename": "modules/benchmarks/src/change_detection/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -15,7 +15,7 @@ ts_library(\n     srcs = [\"change_detection.perf-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )\n@@ -26,7 +26,7 @@ ts_library(\n     srcs = [\"change_detection.e2e-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "789d51824bd92a75553d1ddfb03f47ae0244eda5",
            "filename": "modules/benchmarks/src/change_detection/change_detection.e2e-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.e2e-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {openBrowser, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n \n-import {openBrowser, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n describe('change detection benchmark', () => {\n   afterEach(verifyNoBrowserErrors);\n "
        },
        {
            "sha": "5c1491ac71925441f867a5edd65a4058750976f7",
            "filename": "modules/benchmarks/src/change_detection/change_detection.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Fchange_detection.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n-import {runBenchmark, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n \n interface Worker {\n   id: string;"
        },
        {
            "sha": "40cdfb5d00cbc1ba02591c368714e62302e87c9c",
            "filename": "modules/benchmarks/src/change_detection/transplanted_views/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Ftransplanted_views%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Ftransplanted_views%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fchange_detection%2Ftransplanted_views%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "fa1d612b45bef4c238f3ee70a3623e102761bab1",
            "filename": "modules/benchmarks/src/class_bindings/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,12 +1,12 @@\n-load(\"//dev-infra/benchmark/component_benchmark:component_benchmark.bzl\", \"component_benchmark\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:component_benchmark.bzl\", \"component_benchmark\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n \n component_benchmark(\n     name = \"benchmark\",\n     driver = \":class_bindings.perf-spec.ts\",\n     driver_deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//@types/jasmine\",\n         \"@npm//protractor\",\n     ],"
        },
        {
            "sha": "0fac5c7cdb885e6d19052f120bad31aaaf8ea54b",
            "filename": "modules/benchmarks/src/class_bindings/class_bindings.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fclass_bindings.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fclass_bindings.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fclass_bindings.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$, browser} from 'protractor';\n-import {runBenchmark} from '../../../../dev-infra/benchmark/driver-utilities';\n \n describe('class bindings perf', () => {\n   it('should work for update', async () => {"
        },
        {
            "sha": "ce611bc602cffd18e7f48834fa33653c6c42803f",
            "filename": "modules/benchmarks/src/expanding_rows/BUILD.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,7 +1,7 @@\n-package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n-\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+\n+package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n \n ng_module(\n     name = \"application_lib\",\n@@ -26,7 +26,7 @@ ts_library(\n     srcs = [\"expanding_rows.perf-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "976b7b1954413f95718756dd19246770392a69bb",
            "filename": "modules/benchmarks/src/expanding_rows/expanding_rows.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2Fexpanding_rows.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2Fexpanding_rows.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fexpanding_rows%2Fexpanding_rows.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$, browser} from 'protractor';\n-import {runBenchmark} from '../../../../dev-infra/benchmark/driver-utilities';\n \n describe('benchmarks', () => {\n   it('should work for create', async () => {"
        },
        {
            "sha": "f545b40e3e64f7b1128c26fa01304a7ec0be617b",
            "filename": "modules/benchmarks/src/js-web-frameworks/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -8,7 +8,7 @@ ts_library(\n     srcs = [\"js-web-frameworks.perf-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "d18646c0be44a2a72f040571846680d6a8b78eca",
            "filename": "modules/benchmarks/src/js-web-frameworks/js-web-frameworks.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fjs-web-frameworks.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fjs-web-frameworks.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fjs-web-frameworks.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n-import {runBenchmark, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n \n interface Worker {\n   id: string;"
        },
        {
            "sha": "5692c34ad6cb1a6d98ed2aa9fbe7ecfd69e43bf1",
            "filename": "modules/benchmarks/src/js-web-frameworks/ng2/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fng2%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fng2%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fjs-web-frameworks%2Fng2%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n "
        },
        {
            "sha": "80e5a42d1656f7789b9ac48fb3522b462f069bf6",
            "filename": "modules/benchmarks/src/largeform/BUILD.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargeform%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,14 +1,14 @@\n-package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n-\n load(\"//tools:defaults.bzl\", \"ts_library\")\n \n+package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n+\n ts_library(\n     name = \"perf_tests_lib\",\n     testonly = 1,\n     srcs = [\"largeform.perf-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )\n@@ -19,7 +19,7 @@ ts_library(\n     srcs = [\"largeform.e2e-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "2c72b1c6967ad00566fc24d48e73896948d6f620",
            "filename": "modules/benchmarks/src/largeform/largeform.e2e-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.e2e-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {openBrowser, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$, By, element} from 'protractor';\n \n-import {openBrowser, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n describe('largeform benchmark', () => {\n   afterEach(verifyNoBrowserErrors);\n "
        },
        {
            "sha": "bbb26ce0a5b4bf0aa16e37dcf04ee84ce7e94b99",
            "filename": "modules/benchmarks/src/largeform/largeform.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Flargeform.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n \n-import {runBenchmark, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n interface Worker {\n   id: string;\n   prepare?(): void;"
        },
        {
            "sha": "871de42f91e0494ff47b10a3d06b7fa59241ffaf",
            "filename": "modules/benchmarks/src/largeform/ng2/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Fng2%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Fng2%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargeform%2Fng2%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "2b850d7719b8f9371518715575f4e4acf312c3d1",
            "filename": "modules/benchmarks/src/largetable/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -15,7 +15,7 @@ ts_library(\n     srcs = [\"largetable.perf-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )\n@@ -26,7 +26,7 @@ ts_library(\n     srcs = [\"largetable.e2e-spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "c90e3a0093d329256acad9322dc4bbcef4ef5670",
            "filename": "modules/benchmarks/src/largetable/baseline/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fbaseline%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fbaseline%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fbaseline%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "79b622ab590b065f3d00b53bd9bf387417d8b14e",
            "filename": "modules/benchmarks/src/largetable/incremental_dom/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fincremental_dom%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fincremental_dom%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fincremental_dom%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "896252fb442baacc5dbb74def7b05e18a0118aab",
            "filename": "modules/benchmarks/src/largetable/iv/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fiv%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fiv%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fiv%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "0ff96319c44e8eb3d7410d47f260d919e4f16fa1",
            "filename": "modules/benchmarks/src/largetable/largetable.e2e-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.e2e-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {openBrowser, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n \n-import {openBrowser, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n describe('largetable benchmark', () => {\n   afterEach(verifyNoBrowserErrors);\n "
        },
        {
            "sha": "dbc1aa586887ca838cbad26e1ce84a71be51892b",
            "filename": "modules/benchmarks/src/largetable/largetable.perf-spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.perf-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.perf-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Flargetable.perf-spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {runBenchmark, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$} from 'protractor';\n-import {runBenchmark, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n \n interface Worker {\n   id: string;"
        },
        {
            "sha": "dec5af1b2f01ab06c0277996dec4bbd35360bfc6",
            "filename": "modules/benchmarks/src/largetable/ng2/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "e549635ac6a995d55e47700b611c382a0ca74a98",
            "filename": "modules/benchmarks/src/largetable/ng2_switch/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2_switch%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2_switch%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Fng2_switch%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "0c62a6f9301e8102b2e94e400d2a807328806dd0",
            "filename": "modules/benchmarks/src/largetable/render3/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Frender3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Frender3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Flargetable%2Frender3%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,9 +1,9 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n+package(default_visibility = [\"//visibility:public\"])\n+\n ng_module(\n     name = \"largetable_lib\",\n     srcs = ["
        },
        {
            "sha": "8213337c0f9d063b05215cdac5b9e3930ae3b090",
            "filename": "modules/benchmarks/src/styling/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fstyling%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,14 +1,14 @@\n-package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n-\n load(\"//tools:defaults.bzl\", \"ts_library\")\n \n+package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n+\n ts_library(\n     name = \"tests_lib\",\n     testonly = True,\n     srcs = [\"styling_perf.spec.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "773802f17df0d3892f63cd467260f2ece4edf71e",
            "filename": "modules/benchmarks/src/styling/ng2/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fng2%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fng2%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fng2%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n "
        },
        {
            "sha": "511dd29416c7524b54107b69f6c4d9fef3c381e2",
            "filename": "modules/benchmarks/src/styling/styling_perf.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fstyling_perf.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fstyling_perf.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fstyling%2Fstyling_perf.spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {openBrowser, runBenchmark, verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$, by, element} from 'protractor';\n-import {openBrowser, runBenchmark, verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n \n /** List of possible scenarios that should be tested.  */\n const SCENARIOS = ["
        },
        {
            "sha": "e6da68d61de9295367fae398e0bc19ebfc96b99f",
            "filename": "modules/benchmarks/src/tree/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -15,7 +15,7 @@ ts_library(\n     srcs = [\"test_utils.ts\"],\n     tsconfig = \"//modules/benchmarks:tsconfig-e2e.json\",\n     deps = [\n-        \"//dev-infra/benchmark/driver-utilities\",\n+        \"@npm//@angular/dev-infra-private/bazel/benchmark/driver-utilities\",\n         \"@npm//protractor\",\n     ],\n )"
        },
        {
            "sha": "23de50c79b31c18b59b86604a73a0cf9c52fc11c",
            "filename": "modules/benchmarks/src/tree/baseline/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fbaseline%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fbaseline%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fbaseline%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "723544557db6426abf8a0d65d37927d50e2b1690",
            "filename": "modules/benchmarks/src/tree/incremental_dom/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fincremental_dom%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fincremental_dom%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fincremental_dom%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "45cabecd193f4aacc4a00558b176892c5008d9ba",
            "filename": "modules/benchmarks/src/tree/iv/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fiv%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fiv%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fiv%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "aecb68cf07e7065928d4a3d34355a29bb17c6368",
            "filename": "modules/benchmarks/src/tree/ng1/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "82fa164aa645186311e5a97e787c83ec0027b588",
            "filename": "modules/benchmarks/src/tree/ng2/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "001c8c49eeb9b3784f41e69eac4eaee70342354a",
            "filename": "modules/benchmarks/src/tree/ng2_next/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_next%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_next%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_next%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "077cbb8dd5737071dc207811f78cc932d2eced30",
            "filename": "modules/benchmarks/src/tree/ng2_static/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_static%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_static%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_static%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_devserver\", \"ts_library\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "41e5c77db06c2c510ee36a1fc1ab493bf2700dc9",
            "filename": "modules/benchmarks/src/tree/ng2_switch/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_switch%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_switch%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng2_switch%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])"
        },
        {
            "sha": "8c24d5c2440b8f12849cc377d006bd6d87260bdd",
            "filename": "modules/benchmarks/src/tree/render3/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Frender3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Frender3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Frender3%2FBUILD.bazel?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -1,9 +1,9 @@\n-package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n-\n load(\"//tools:defaults.bzl\", \"ng_module\", \"ng_rollup_bundle\", \"ts_devserver\")\n-load(\"//dev-infra/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n+load(\"@npm//@angular/dev-infra-private/bazel/benchmark/component_benchmark:benchmark_test.bzl\", \"benchmark_test\")\n load(\"//modules/benchmarks:e2e_test.bzl\", \"e2e_test\")\n \n+package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n+\n ng_module(\n     name = \"tree_lib\",\n     srcs = ["
        },
        {
            "sha": "de9f2a88ef67d3f587ea09f83db3c6bc9eac408c",
            "filename": "modules/benchmarks/src/tree/test_utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Ftest_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Fsrc%2Ftree%2Ftest_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Ftest_utils.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {openBrowser, runBenchmark} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {browser} from 'protractor';\n \n-import {openBrowser, runBenchmark} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n export function runTreeBenchmark({id, prepare, setup, work}: {\n   id: string; prepare ? () : void; setup ? () : void; work(): void;\n }) {"
        },
        {
            "sha": "11f311cf2a08ea5956706c417a55dba78b3a1042",
            "filename": "modules/benchmarks/tsconfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fbenchmarks%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Ftsconfig.json?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -31,5 +31,5 @@\n     \"no-unused-expression\": true,\n     \"no-unused-variable\": true\n   },\n-  \"include\": [\"../../dev-infra/benchmark/driver-utilities/\"]\n+  \"include\": [\"../../node_modules/@angular/dev-infra-private/bazel/benchmark/driver-utilities/\"]\n }"
        },
        {
            "sha": "9a4c0c4d60489dd8f834ae3e0cfef40fea6e8499",
            "filename": "modules/playground/e2e_test/async/async_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fplayground%2Fe2e_test%2Fasync%2Fasync_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81e42577612298e7e8399c833d1d07c7c402b7ce/modules%2Fplayground%2Fe2e_test%2Fasync%2Fasync_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fplayground%2Fe2e_test%2Fasync%2Fasync_spec.ts?ref=81e42577612298e7e8399c833d1d07c7c402b7ce",
            "patch": "@@ -6,11 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {verifyNoBrowserErrors} from '@angular/dev-infra-private/bazel/benchmark/driver-utilities';\n import {$, browser} from 'protractor';\n import {promise} from 'selenium-webdriver';\n \n-import {verifyNoBrowserErrors} from '../../../../dev-infra/benchmark/driver-utilities';\n-\n describe('async', () => {\n   const URL = '/';\n "
        }
    ],
    "stats": {
        "total": 27072,
        "additions": 547,
        "deletions": 26525
    }
}