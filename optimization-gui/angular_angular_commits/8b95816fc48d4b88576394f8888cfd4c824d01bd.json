{
    "author": "gkalpak",
    "message": "fix(docs-infra): log more SW debug info (#42776)\n\nThis commit expands the info printed to the console to help diagnose\nServiceWorker issues to include the [internal debug info][1] retrieved\nfrom `/ngsw/state`. This will provide more useful data, such as the\nactivated SW's version, state, clients, recent operations and any recent\nerrors.\n\nNOTE:\nThis temporarily increases the payload size. Removing this code and\nreclaiming the payload size is being tracked in #41117.\n\n[1]: https://angular.io/guide/service-worker-devops#locating-and-analyzing-debugging-information\n\nPR Close #42776",
    "sha": "8b95816fc48d4b88576394f8888cfd4c824d01bd",
    "files": [
        {
            "sha": "dcab6be9c380c63f9f559b5652dccd1476649b1a",
            "filename": "aio/src/app/layout/doc-viewer/doc-viewer.component.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 3,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/8b95816fc48d4b88576394f8888cfd4c824d01bd/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/8b95816fc48d4b88576394f8888cfd4c824d01bd/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts?ref=8b95816fc48d4b88576394f8888cfd4c824d01bd",
            "patch": "@@ -260,10 +260,13 @@ export class DocViewerComponent implements OnDestroy {\n  * (See https://github.com/angular/angular/issues/28114.)\n  */\n async function printSwDebugInfo(): Promise<void> {\n-  console.log(`\\nServiceWorker: ${navigator.serviceWorker?.controller?.state ?? 'N/A'}`);\n+  const sep = '\\n----------';\n+  const swState = navigator.serviceWorker?.controller?.state ?? 'N/A';\n+\n+  console.log(`\\nServiceWorker: ${swState}`);\n \n   if (typeof caches === 'undefined') {\n-    console.log('\\nCaches: N/A');\n+    console.log(`${sep}\\nCaches: N/A`);\n   } else {\n     const allCacheNames = await caches.keys();\n     const swCacheNames = allCacheNames.filter(name => name.startsWith('ngsw:/:'));\n@@ -273,11 +276,28 @@ async function printSwDebugInfo(): Promise<void> {\n     await findCachesAndPrintEntries(swCacheNames, 'assets:app-shell:meta', true);\n   }\n \n+  if (swState === 'activated') {\n+    console.log(sep);\n+    await fetchAndPrintSwInternalDebugInfo();\n+  }\n+\n   console.warn(\n-      '\\nIf you see this error, please report an issue at ' +\n+      `${sep}\\nIf you see this error, please report an issue at ` +\n       'https://github.com/angular/angular/issues/new?template=3-docs-bug.md including the above logs.');\n \n   // Internal helpers\n+  async function fetchAndPrintSwInternalDebugInfo() {\n+    try {\n+      const res = await fetch('/ngsw/state');\n+      if (!res.ok) {\n+        throw new Error(`Response ${res.status} ${res.statusText}`);\n+      }\n+      console.log(await res.text());\n+    } catch (err) {\n+      console.log(`Failed to retrieve debug info from '/ngsw/state': ${err.message || err}`);\n+    }\n+  }\n+\n   async function findCachesAndPrintEntries(\n       swCacheNames: string[], nameSuffix: string, includeValues: boolean,\n       ignoredKeys: string[] = []): Promise<void> {"
        },
        {
            "sha": "bb32c44fee997ac73b0c1dafd8cc63a2480cf8b7",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/8b95816fc48d4b88576394f8888cfd4c824d01bd/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/8b95816fc48d4b88576394f8888cfd4c824d01bd/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=8b95816fc48d4b88576394f8888cfd4c824d01bd",
            "patch": "@@ -3,7 +3,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2017\": 4841,\n-        \"main-es2017\": 458609,\n+        \"main-es2017\": 459014,\n         \"polyfills-es2017\": 55235,\n         \"styles\": 69213,\n         \"light-theme\": 79025,\n@@ -15,7 +15,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2017\": 4841,\n-        \"main-es2017\": 458748,\n+        \"main-es2017\": 459153,\n         \"polyfills-es2017\": 55373,\n         \"styles\": 69213,\n         \"light-theme\": 79025,"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 25,
        "deletions": 5
    }
}