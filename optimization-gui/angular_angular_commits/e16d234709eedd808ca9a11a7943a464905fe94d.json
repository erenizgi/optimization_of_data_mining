{
    "author": "petebacondarwin",
    "message": "ci: enable compliance tests on Windows (#41556)\n\nNow that we have updated the Bazel node.js rules we can run all the\ncompliance tests in Windows on CI.\n\nPR Close #41556",
    "sha": "e16d234709eedd808ca9a11a7943a464905fe94d",
    "files": [
        {
            "sha": "0cfaf722890f1ac94f9ff9375e5b99b763859a7d",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 16,
            "deletions": 18,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/e16d234709eedd808ca9a11a7943a464905fe94d/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/e16d234709eedd808ca9a11a7943a464905fe94d/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=e16d234709eedd808ca9a11a7943a464905fe94d",
            "patch": "@@ -145,8 +145,8 @@ commands:\n       - run:\n           name: Set up environment\n           environment:\n-              CIRCLE_GIT_BASE_REVISION: << pipeline.git.base_revision >>\n-              CIRCLE_GIT_REVISION: << pipeline.git.revision >>\n+            CIRCLE_GIT_BASE_REVISION: << pipeline.git.base_revision >>\n+            CIRCLE_GIT_REVISION: << pipeline.git.revision >>\n           command: ./.circleci/env.sh\n       - run:\n           # Configure git as the CircleCI `checkout` command does.\n@@ -463,7 +463,7 @@ jobs:\n   aio_preview:\n     executor: default-executor\n     environment:\n-       AIO_SNAPSHOT_ARTIFACT_PATH: &aio_preview_artifact_path 'aio/tmp/snapshot.tgz'\n+      AIO_SNAPSHOT_ARTIFACT_PATH: &aio_preview_artifact_path \"aio/tmp/snapshot.tgz\"\n     steps:\n       - custom_attach_workspace\n       - init_environment\n@@ -487,7 +487,6 @@ jobs:\n           name: Wait for preview and run tests\n           command: node aio/scripts/test-preview.js $CI_PULL_REQUEST $CI_COMMIT $CI_AIO_MIN_PWA_SCORE\n \n-\n   # The `build-npm-packages` tasks exist for backwards-compatibility with old scripts and\n   # tests that rely on the pre-Bazel `dist/packages-dist` output structure (build.sh).\n   # Having multiple jobs that independently build in this manner duplicates some work; we build\n@@ -547,12 +546,12 @@ jobs:\n   publish_packages_as_artifacts:\n     executor: default-executor\n     environment:\n-      AIMWA_PACKAGES_DIR: &aimwa_packages_dir 'dist/angular-in-memory-web-api-dist'\n-      AIMWA_PACKAGES_ARCHIVES_DIR: &aimwa_packages_archives_dir 'dist/angular-in-memory-web-api-dist-archives'\n-      NG_PACKAGES_DIR: &ng_packages_dir 'dist/packages-dist'\n-      NG_PACKAGES_ARCHIVES_DIR: &ng_packages_archives_dir 'dist/packages-dist-archives'\n-      ZONEJS_PACKAGES_DIR: &zonejs_packages_dir 'dist/zone.js-dist'\n-      ZONEJS_PACKAGES_ARCHIVES_DIR: &zonejs_packages_archives_dir 'dist/zone.js-dist-archives'\n+      AIMWA_PACKAGES_DIR: &aimwa_packages_dir \"dist/angular-in-memory-web-api-dist\"\n+      AIMWA_PACKAGES_ARCHIVES_DIR: &aimwa_packages_archives_dir \"dist/angular-in-memory-web-api-dist-archives\"\n+      NG_PACKAGES_DIR: &ng_packages_dir \"dist/packages-dist\"\n+      NG_PACKAGES_ARCHIVES_DIR: &ng_packages_archives_dir \"dist/packages-dist-archives\"\n+      ZONEJS_PACKAGES_DIR: &zonejs_packages_dir \"dist/zone.js-dist\"\n+      ZONEJS_PACKAGES_ARCHIVES_DIR: &zonejs_packages_archives_dir \"dist/zone.js-dist-archives\"\n     steps:\n       - custom_attach_workspace\n       - init_environment\n@@ -756,9 +755,9 @@ jobs:\n       - run: yarn --cwd packages/zone.js promisetest\n       - run: yarn --cwd packages/zone.js promisefinallytest\n       - run: yarn bazel build //packages/zone.js:npm_package &&\n-             cp dist/bin/packages/zone.js/npm_package/bundles/zone-mix.umd.js ./packages/zone.js/test/extra/ &&\n-             cp dist/bin/packages/zone.js/npm_package/bundles/zone-patch-electron.umd.js ./packages/zone.js/test/extra/ &&\n-             cp dist/bin/packages/zone.js/npm_package/bundles/zone.umd.js ./packages/zone.js/build/test/closure/zone.js\n+          cp dist/bin/packages/zone.js/npm_package/bundles/zone-mix.umd.js ./packages/zone.js/test/extra/ &&\n+          cp dist/bin/packages/zone.js/npm_package/bundles/zone-patch-electron.umd.js ./packages/zone.js/test/extra/ &&\n+          cp dist/bin/packages/zone.js/npm_package/bundles/zone.umd.js ./packages/zone.js/build/test/closure/zone.js\n       - run: yarn --cwd packages/zone.js jest:test\n       - run: yarn --cwd packages/zone.js jest:nodetest\n       - run: yarn --cwd packages/zone.js electrontest\n@@ -774,11 +773,11 @@ jobs:\n       - setup_win\n       - run:\n           name: Build all windows CI targets\n-          command: yarn bazel build --build_tag_filters=-ivy-only,-no-windows //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          command: yarn bazel build --build_tag_filters=-ivy-only //packages/compiler-cli/... //tools/ts-api-guardian/...\n           no_output_timeout: 15m\n       - run:\n           name: Test all windows CI targets\n-          command: yarn bazel test --build_tag_filters=-no-windows --test_tag_filters=\"-ivy-only,-no-windows,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          command: yarn bazel test --test_tag_filters=\"-ivy-only,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/...\n           no_output_timeout: 15m\n \n   test_ivy_aot_win:\n@@ -787,19 +786,18 @@ jobs:\n       - setup_win\n       - run:\n           name: Build all windows CI targets\n-          command: yarn bazel build --config=ivy --build_tag_filters=-no-ivy-aot,-no-windows,-fixme-ivy-aot //packages/compiler-cli/... //tools/ts-api-guardian/...\n+          command: yarn bazel build --config=ivy --build_tag_filters=-no-ivy-aot,-fixme-ivy-aot //packages/compiler-cli/... //tools/ts-api-guardian/...\n           no_output_timeout: 15m\n       - run:\n           name: Test all windows CI targets\n-          command: yarn bazel test --config=ivy --build_tag_filters=-no-windows --test_tag_filters=\"-no-ivy-aot,-no-windows,-fixme-ivy-aot,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/... //packages/localize/...\n+          command: yarn bazel test --config=ivy --test_tag_filters=\"-no-ivy-aot,-fixme-ivy-aot,-browser:chromium-local\" //packages/compiler-cli/... //tools/ts-api-guardian/... //packages/localize/...\n           no_output_timeout: 15m\n       # Save dependencies to use on subsequent runs.\n       - save_cache:\n           key: *cache_key_win\n           paths:\n             - ~/.cache/yarn\n \n-\n workflows:\n   version: 2\n   default_workflow:"
        },
        {
            "sha": "8fe2fb41af7c6f400ba1acf455bc5e25e8cc556c",
            "filename": "packages/compiler-cli/test/compliance/partial/partial_compliance_goldens.bzl",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/e16d234709eedd808ca9a11a7943a464905fe94d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl",
            "raw_url": "https://github.com/angular/angular/raw/e16d234709eedd808ca9a11a7943a464905fe94d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl?ref=e16d234709eedd808ca9a11a7943a464905fe94d",
            "patch": "@@ -48,10 +48,6 @@ def partial_compliance_golden(filePath):\n         testonly = True,\n         stdout = \"%s/this_file_should_not_be_committed\" % path,\n         link_workspace_root = True,\n-        tags = [\n-            # TODO(josephperrott): Begin running these tests on windows after updating to rules_nodejs 3.0\n-            \"no-windows\",\n-        ],\n         visibility = [\":__pkg__\"],\n         data = data,\n     )\n@@ -60,8 +56,6 @@ def partial_compliance_golden(filePath):\n         visibility = [\"//visibility:public\"],\n         tags = [\n             \"ivy-only\",\n-            # TODO(josephperrott): Begin running these tests on windows after updating to rules_nodejs 3.0\n-            \"no-windows\",\n         ],\n         name = \"%s.golden\" % path,\n         src = \"//packages/compiler-cli/test/compliance/test_cases:%s/GOLDEN_PARTIAL.js\" % path,"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 16,
        "deletions": 24
    }
}