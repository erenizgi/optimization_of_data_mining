{
    "author": "kyliau",
    "message": "build(language-service): use 'export =' syntax for default export (#41165)\n\nTsserver expects `@angular/language-service` to provide a factory function\nas the default export (commonjs-style) of the package.\n\nThe current implementation side steps TypeScript's import syntax by using\n`module.exports = factory`.\nThis allows the code to incorrectly re-export other symbols:\n\n```ts\nexport * from './api';\n```\n\nwhich transpiles to:\n\n```js\nvar tslib_1 = require(\"tslib\");\ntslib_1.__exportStar(require(\"@angular/language-service/api\"), exports);\n```\n\nDoing this meant that the package now has a runtime dependency on `tslib`,\nwhich is totally unnecessary.\n\nWith the proper `export =` syntax, `tslib` is removed, and no other exports\nare allowed.\n\nOutput:\n```js\n(function (factory) {\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        var v = factory(require, exports);\n        if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === \"function\" && define.amd) {\n        define(\"@angular/language-service\", [\"require\", \"exports\"], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    return function factory(tsModule) {\n        var plugin;\n        return {\n            create: function (info) {\n                var config = info.config;\n                var bundleName = config.ivy ? 'ivy.js' : 'language-service.js';\n                plugin = require(\"./bundles/\" + bundleName)(tsModule);\n                return plugin.create(info);\n            },\n            getExternalFiles: function (project) {\n                var _a, _b;\n                return (_b = (_a = plugin === null || plugin === void 0 ? void 0 : plugin.getExternalFiles) === null || _a === void 0 ? void 0 : _a.call(plugin, project)) !== null && _b !== void 0 ? _b : [];\n            },\n            onConfigurationChanged: function (config) {\n                var _a;\n                (_a = plugin === null || plugin === void 0 ? void 0 : plugin.onConfigurationChanged) === null || _a === void 0 ? void 0 : _a.call(plugin, config);\n            },\n        };\n    };\n});\n```\n\nPR Close #41165",
    "sha": "012a2b55e103e16ca8ae1407d2b6441ec92c07ea",
    "files": [
        {
            "sha": "7239b0da4a121f4c74bb58594868702f177f88e1",
            "filename": "packages/language-service/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/012a2b55e103e16ca8ae1407d2b6441ec92c07ea/packages%2Flanguage-service%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/012a2b55e103e16ca8ae1407d2b6441ec92c07ea/packages%2Flanguage-service%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2FBUILD.bazel?ref=012a2b55e103e16ca8ae1407d2b6441ec92c07ea",
            "patch": "@@ -8,6 +8,7 @@ ts_library(\n         \"api.ts\",\n         \"index.ts\",\n     ],\n+    prodmode_module = \"commonjs\",\n     deps = [\n         \"@npm//@types/node\",\n         \"@npm//typescript\","
        },
        {
            "sha": "5d4e0219ce799155ce8a2d08a3fc08f6f6c8b8fb",
            "filename": "packages/language-service/index.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/012a2b55e103e16ca8ae1407d2b6441ec92c07ea/packages%2Flanguage-service%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/012a2b55e103e16ca8ae1407d2b6441ec92c07ea/packages%2Flanguage-service%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Findex.ts?ref=012a2b55e103e16ca8ae1407d2b6441ec92c07ea",
            "patch": "@@ -9,8 +9,6 @@\n import * as ts from 'typescript/lib/tsserverlibrary';\n import {NgLanguageService, PluginConfig} from './api';\n \n-export * from './api';\n-\n interface PluginModule extends ts.server.PluginModule {\n   create(createInfo: ts.server.PluginCreateInfo): NgLanguageService;\n   onConfigurationChanged?(config: PluginConfig): void;\n@@ -35,4 +33,9 @@ const factory: ts.server.PluginModuleFactory = (tsModule): PluginModule => {\n   };\n };\n \n-module.exports = factory;\n+/**\n+ * Tsserver expects `@angular/language-service` to provide a factory function\n+ * as the default export of the package. See\n+ * https://github.com/microsoft/TypeScript/blob/f4d0ea6539edb6d8f70b626132d6f9ac1ac4281a/src/server/project.ts#L1611\n+ */\n+export = factory;"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 7,
        "deletions": 3
    }
}