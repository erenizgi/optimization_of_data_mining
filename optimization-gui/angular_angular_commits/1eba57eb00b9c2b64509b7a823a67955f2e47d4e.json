{
    "author": "alxhub",
    "message": "fix(language-service): show suggestion when type inference is suboptimal (#41072)\n\nThe Ivy Language Service uses the compiler's template type-checking engine,\nwhich honors the configuration in the user's tsconfig.json. We recommend\nthat users upgrade to `strictTemplates` mode in their projects to take\nadvantage of the best possible type inference, and thus to have the best\nexperience in Language Service.\n\nIf a project is not using `strictTemplates`, then the compiler will not\nleverage certain type inference options it has. One case where this is very\nnoticeable is the inference of let- variables for structural directives that\nprovide a template context guard (such as NgFor). Without `strictTemplates`,\nthese guards will not be applied and such variables will be inferred as\n'any', degrading the user experience within Language Service.\n\nThis is working as designed, since the Language Service _should_ reflect\ntypes exactly as the compiler sees them. However, the View Engine Language\nService used its own type system that _would_ infer these types even when\nthe compiler did not. As a result, it's confusing to some users why the\nIvy Language Service has \"worse\" type inference.\n\nTo address this confusion, this commit implements a suggestion diagnostic\nwhich is shown in the Language Service for variables which could have been\nnarrowed via a context guard, but the type checking configuration didn't\nallow it. This should make the reason why variables receive the 'any' type\nas well as the action needed to improve the typings much more obvious,\nimproving the Language Service experience.\n\nFixes angular/vscode-ng-language-service#1155\nCloses #41042\n\nPR Close #41072",
    "sha": "1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
    "files": [
        {
            "sha": "9116012fe49ef1413f67a2e1ad64377b959d1303",
            "filename": "goldens/public-api/compiler-cli/error_code.d.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.d.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -38,5 +38,6 @@ export declare enum ErrorCode {\n     INLINE_TCB_REQUIRED = 8900,\n     INLINE_TYPE_CTOR_REQUIRED = 8901,\n     INJECTABLE_DUPLICATE_PROV = 9001,\n-    SUGGEST_STRICT_TEMPLATES = 10001\n+    SUGGEST_STRICT_TEMPLATES = 10001,\n+    SUGGEST_SUBOPTIMAL_TYPE_INFERENCE = 10002\n }"
        },
        {
            "sha": "32cedf2641128faab7a3f84bab5ec8d9cb515eeb",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -692,6 +692,10 @@ export class NgCompiler {\n         strictLiteralTypes: true,\n         enableTemplateTypeChecker: this.enableTemplateTypeChecker,\n         useInlineTypeConstructors,\n+        // Warnings for suboptimal type inference are only enabled if in Language Service mode\n+        // (providing the full TemplateTypeChecker API) and if strict mode is not enabled. In strict\n+        // mode, the user is in full control of type inference.\n+        suggestionsForSuboptimalTypeInference: this.enableTemplateTypeChecker && !strictTemplates,\n       };\n     } else {\n       typeCheckingConfig = {\n@@ -717,6 +721,9 @@ export class NgCompiler {\n         strictLiteralTypes: false,\n         enableTemplateTypeChecker: this.enableTemplateTypeChecker,\n         useInlineTypeConstructors,\n+        // In \"basic\" template type-checking mode, no warnings are produced since most things are\n+        // not checked anyways.\n+        suggestionsForSuboptimalTypeInference: false,\n       };\n     }\n "
        },
        {
            "sha": "910abcbde66e7c5005ddf2628cdd8b288dd4f26f",
            "filename": "packages/compiler-cli/src/ngtsc/diagnostics/src/error_code.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -171,15 +171,22 @@ export enum ErrorCode {\n    */\n   INJECTABLE_DUPLICATE_PROV = 9001,\n \n-  // 10XXX error codes are reserved for diagnostics with category\n-  // `ts.DiagnosticCategory.Suggestion`. These diagnostics are generated by\n-  // language service.\n+  // 10XXX error codes are reserved for diagnostics with categories other than\n+  // `ts.DiagnosticCategory.Error`. These diagnostics are generated by the compiler when configured\n+  // to do so by a tool such as the Language Service, or by the Language Service itself.\n \n   /**\n    * Suggest users to enable `strictTemplates` to make use of full capabilities\n    * provided by Angular language service.\n    */\n   SUGGEST_STRICT_TEMPLATES = 10001,\n+\n+  /**\n+   * Indicates that a particular structural directive provides advanced type narrowing\n+   * functionality, but the current template type-checking configuration does not allow its usage in\n+   * type inference.\n+   */\n+  SUGGEST_SUBOPTIMAL_TYPE_INFERENCE = 10002,\n }\n \n /**"
        },
        {
            "sha": "8f3c5a7d075037af4a68344efa93273944a6170d",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/api.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fapi.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -275,6 +275,20 @@ export interface TypeCheckingConfig {\n    * inlining, this must be set to `false`.\n    */\n   useInlineTypeConstructors: boolean;\n+\n+  /**\n+   * Whether or not to produce diagnostic suggestions in cases where the compiler could have\n+   * inferred a better type for a construct, but was prevented from doing so by the current type\n+   * checking configuration.\n+   *\n+   * For example, if the compiler could have used a template context guard to infer a better type\n+   * for a structural directive's context and `let-` variables, but the user is in\n+   * `fullTemplateTypeCheck` mode and such guards are therefore disabled.\n+   *\n+   * This mode is useful for clients like the Language Service which want to inform users of\n+   * opportunities to improve their own developer experience.\n+   */\n+  suggestionsForSuboptimalTypeInference: boolean;\n }\n \n "
        },
        {
            "sha": "446debb4ee2d19dbc0f0ee59ab2eb1a5de25b311",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/oob.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Foob.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -68,6 +68,12 @@ export interface OutOfBandDiagnosticRecorder {\n \n   requiresInlineTypeConstructors(\n       templateId: TemplateId, node: ClassDeclaration, directives: ClassDeclaration[]): void;\n+\n+  /**\n+   * Report a warning when structural directives support context guards, but the current\n+   * type-checking configuration prohibits their usage.\n+   */\n+  suboptimalTypeInference(templateId: TemplateId, variables: TmplAstVariable[]): void;\n }\n \n export class OutOfBandDiagnosticRecorderImpl implements OutOfBandDiagnosticRecorder {\n@@ -174,6 +180,37 @@ export class OutOfBandDiagnosticRecorderImpl implements OutOfBandDiagnosticRecor\n         directives.map(\n             dir => makeRelatedInformation(dir.name, `Requires an inline type constructor.`))));\n   }\n+\n+  suboptimalTypeInference(templateId: TemplateId, variables: TmplAstVariable[]): void {\n+    const mapping = this.resolver.getSourceMapping(templateId);\n+\n+    // Select one of the template variables that's most suitable for reporting the diagnostic. Any\n+    // variable will do, but prefer one bound to the context's $implicit if present.\n+    let diagnosticVar: TmplAstVariable|null = null;\n+    for (const variable of variables) {\n+      if (diagnosticVar === null || (variable.value === '' || variable.value === '$implicit')) {\n+        diagnosticVar = variable;\n+      }\n+    }\n+    if (diagnosticVar === null) {\n+      // There is no variable on which to report the diagnostic.\n+      return;\n+    }\n+\n+    let varIdentification = `'${diagnosticVar.name}'`;\n+    if (variables.length === 2) {\n+      varIdentification += ` (and 1 other)`;\n+    } else if (variables.length > 2) {\n+      varIdentification += ` (and ${variables.length - 1} others)`;\n+    }\n+    const message =\n+        `This structural directive supports advanced type inference, but the current compiler configuration prevents its usage. The variable ${\n+            varIdentification} will have type 'any' as a result.\\n\\nConsider enabling the 'strictTemplates' option in your tsconfig.json for better type inference within this template.`;\n+\n+    this._diagnostics.push(makeTemplateDiagnostic(\n+        templateId, mapping, diagnosticVar.keySpan, ts.DiagnosticCategory.Suggestion,\n+        ngErrorCode(ErrorCode.SUGGEST_SUBOPTIMAL_TYPE_INFERENCE), message));\n+  }\n }\n \n function makeInlineDiagnostic("
        },
        {
            "sha": "bf384afc4523909a2121d91d42eec53c4028b604",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -286,11 +286,20 @@ class TcbTemplateBodyOp extends TcbOp {\n \n         // The second kind of guard is a template context guard. This guard narrows the template\n         // rendering context variable `ctx`.\n-        if (dir.hasNgTemplateContextGuard && this.tcb.env.config.applyTemplateContextGuards) {\n-          const ctx = this.scope.resolve(this.template);\n-          const guardInvoke = tsCallMethod(dirId, 'ngTemplateContextGuard', [dirInstId, ctx]);\n-          addParseSpanInfo(guardInvoke, this.template.sourceSpan);\n-          directiveGuards.push(guardInvoke);\n+        if (dir.hasNgTemplateContextGuard) {\n+          if (this.tcb.env.config.applyTemplateContextGuards) {\n+            const ctx = this.scope.resolve(this.template);\n+            const guardInvoke = tsCallMethod(dirId, 'ngTemplateContextGuard', [dirInstId, ctx]);\n+            addParseSpanInfo(guardInvoke, this.template.sourceSpan);\n+            directiveGuards.push(guardInvoke);\n+          } else if (\n+              this.template.variables.length > 0 &&\n+              this.tcb.env.config.suggestionsForSuboptimalTypeInference) {\n+            // The compiler could have inferred a better type for the variables in this template,\n+            // but was prevented from doing so by the type-checking configuration. Issue a warning\n+            // diagnostic.\n+            this.tcb.oobRecorder.suboptimalTypeInference(this.tcb.id, this.template.variables);\n+          }\n         }\n       }\n     }"
        },
        {
            "sha": "0c8083b3575fd63e343ec5cb835b34b35a4ce59b",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/test_utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -188,7 +188,8 @@ export const ALL_ENABLED_CONFIG: Readonly<TypeCheckingConfig> = {\n   useContextGenericType: true,\n   strictLiteralTypes: true,\n   enableTemplateTypeChecker: false,\n-  useInlineTypeConstructors: true\n+  useInlineTypeConstructors: true,\n+  suggestionsForSuboptimalTypeInference: false,\n };\n \n // Remove 'ref' from TypeCheckableDirectiveMeta and add a 'selector' instead.\n@@ -272,6 +273,7 @@ export function tcb(\n     strictLiteralTypes: true,\n     enableTemplateTypeChecker: false,\n     useInlineTypeConstructors: true,\n+    suggestionsForSuboptimalTypeInference: false,\n     ...config\n   };\n   options = options || {\n@@ -690,4 +692,5 @@ export class NoopOobRecorder implements OutOfBandDiagnosticRecorder {\n   duplicateTemplateVar(): void {}\n   requiresInlineTcb(): void {}\n   requiresInlineTypeConstructors(): void {}\n+  suboptimalTypeInference(): void {}\n }"
        },
        {
            "sha": "9ccb53db849cec2f5b6130df147d1d5c2c8ca816",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -745,7 +745,8 @@ describe('type check blocks', () => {\n       useContextGenericType: true,\n       strictLiteralTypes: true,\n       enableTemplateTypeChecker: false,\n-      useInlineTypeConstructors: true\n+      useInlineTypeConstructors: true,\n+      suggestionsForSuboptimalTypeInference: false,\n     };\n \n     describe('config.applyTemplateContextGuards', () => {"
        },
        {
            "sha": "2fc4b2a7f56ab0fb20ce451ba0034fe6d10dde35",
            "filename": "packages/language-service/ivy/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2FBUILD.bazel?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -7,6 +7,7 @@ ts_library(\n     deps = [\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/src/ngtsc/core:api\",\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\","
        },
        {
            "sha": "d1264db20724eb3d086ba0bf7c367db9dcd70f87",
            "filename": "packages/language-service/ivy/test/diagnostic_spec.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {ErrorCode, ngErrorCode} from '@angular/compiler-cli/src/ngtsc/diagnostics';\n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import * as ts from 'typescript';\n \n@@ -245,4 +246,40 @@ describe('getSemanticDiagnostics', () => {\n       'component is missing a template',\n     ]);\n   });\n+\n+  it('reports a warning when the project configuration prevents good type inference', () => {\n+    const files = {\n+      'app.ts': `\n+        import {Component, NgModule} from '@angular/core';\n+        import {CommonModule} from '@angular/common';\n+\n+        @Component({\n+          template: '<div *ngFor=\"let user of users\">{{user}}</div>',\n+        })\n+        export class MyComponent {\n+          users = ['Alpha', 'Beta'];\n+        }\n+      `\n+    };\n+\n+    const project = createModuleAndProjectWithDeclarations(env, 'test', files, {\n+      // Disable `strictTemplates`.\n+      strictTemplates: false,\n+      // Use `fullTemplateTypeCheck` mode instead.\n+      fullTemplateTypeCheck: true,\n+    });\n+    const diags = project.getDiagnosticsForFile('app.ts');\n+    expect(diags.length).toBe(1);\n+    const diag = diags[0];\n+    expect(diag.code).toBe(ngErrorCode(ErrorCode.SUGGEST_SUBOPTIMAL_TYPE_INFERENCE));\n+    expect(diag.category).toBe(ts.DiagnosticCategory.Suggestion);\n+    expect(getTextOfDiagnostic(diag)).toBe('user');\n+  });\n });\n+\n+function getTextOfDiagnostic(diag: ts.Diagnostic): string {\n+  expect(diag.file).not.toBeUndefined();\n+  expect(diag.start).not.toBeUndefined();\n+  expect(diag.length).not.toBeUndefined();\n+  return diag.file!.text.substring(diag.start!, diag.start! + diag.length!);\n+}"
        },
        {
            "sha": "5577f7c705c497d44d155642fc9f7875250bf6d4",
            "filename": "packages/language-service/ivy/testing/src/project.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts",
            "raw_url": "https://github.com/angular/angular/raw/1eba57eb00b9c2b64509b7a823a67955f2e47d4e/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts?ref=1eba57eb00b9c2b64509b7a823a67955f2e47d4e",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {StrictTemplateOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n+import {LegacyNgcOptions, StrictTemplateOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, getSourceFileOrError} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {OptimizeFor, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript/lib/tsserverlibrary';\n@@ -19,7 +19,7 @@ export type ProjectFiles = {\n \n function writeTsconfig(\n     fs: FileSystem, tsConfigPath: AbsoluteFsPath, entryFiles: AbsoluteFsPath[],\n-    options: StrictTemplateOptions): void {\n+    options: TestableOptions): void {\n   fs.writeFile(\n       tsConfigPath,\n       JSON.stringify(\n@@ -44,7 +44,7 @@ function writeTsconfig(\n           null, 2));\n }\n \n-export type TestableOptions = StrictTemplateOptions;\n+export type TestableOptions = StrictTemplateOptions&Pick<LegacyNgcOptions, 'fullTemplateTypeCheck'>;\n \n export class Project {\n   private tsProject: ts.server.Project;"
        }
    ],
    "stats": {
        "total": 145,
        "additions": 131,
        "deletions": 14
    }
}