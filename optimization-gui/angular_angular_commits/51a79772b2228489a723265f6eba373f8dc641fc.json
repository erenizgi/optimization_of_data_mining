{
    "author": "petebacondarwin",
    "message": "test(localize): ensure tests pass on Windows (#40952)\n\nThese tests were relying upon unix-like paths, which\ncaused them to fail on Windows.\n\nNote that the `filegroup` Bazel rule tends not to work well\non Windows, so this has been replaced with `copy_to_bin`\ninstead.\n\nPR Close #40952",
    "sha": "51a79772b2228489a723265f6eba373f8dc641fc",
    "files": [
        {
            "sha": "41b8f53fc1ea21476e2a6dd8ae05094668950e73",
            "filename": "packages/localize/src/tools/src/extract/source_files/es5_extract_plugin.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -35,7 +35,7 @@ export function makeEs5ExtractPlugin(\n             // If we get a BabelParseError here then something went wrong with Babel itself\n             // since there must be something wrong with the structure of the AST generated\n             // by Babel parsing a TaggedTemplateExpression.\n-            throw buildCodeFrameError(callPath, e);\n+            throw buildCodeFrameError(fs, callPath, e);\n           } else {\n             throw e;\n           }"
        },
        {
            "sha": "4d225659879989995e76f8d885fee35357040493",
            "filename": "packages/localize/src/tools/src/source_file_utils.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 6,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵisMissingTranslationError, ɵmakeTemplateObject, ɵParsedTranslation, ɵSourceLocation, ɵtranslate} from '@angular/localize';\n import {NodePath} from '@babel/traverse';\n import * as t from '@babel/types';\n@@ -400,8 +400,19 @@ export function isBabelParseError(e: any): e is BabelParseError {\n   return e.type === 'BabelParseError';\n }\n \n-export function buildCodeFrameError(path: NodePath, e: BabelParseError): string {\n-  const filename = path.hub.file.opts.filename || '(unknown file)';\n+export function buildCodeFrameError(\n+    fs: PathManipulation, path: NodePath, e: BabelParseError): string {\n+  let filename = path.hub.file.opts.filename;\n+  if (filename) {\n+    filename = fs.resolve(filename);\n+    let cwd = path.hub.file.opts.cwd;\n+    if (cwd) {\n+      cwd = fs.resolve(cwd);\n+      filename = fs.relative(cwd, filename);\n+    }\n+  } else {\n+    filename = '(unknown file)';\n+  }\n   const message = path.hub.file.buildCodeFrameError(e.node, e.message).message;\n   return `${filename}: ${message}`;\n }\n@@ -434,9 +445,14 @@ export function serializeLocationPosition(location: ɵSourceLocation): string {\n \n function getFileFromPath(fs: PathManipulation, path: NodePath|undefined): AbsoluteFsPath|null {\n   const opts = path?.hub.file.opts;\n-  return opts?.filename ?\n-      fs.resolve(opts.generatorOpts.sourceRoot ?? opts.cwd, fs.relative(opts.cwd, opts.filename)) :\n-      null;\n+  const filename = opts?.filename;\n+  if (!filename) {\n+    return null;\n+  }\n+  const relativePath = fs.relative(opts.cwd, filename);\n+  const root = opts.generatorOpts.sourceRoot ?? opts.cwd;\n+  const absPath = fs.resolve(root, relativePath);\n+  return absPath;\n }\n \n function getLineAndColumn(loc: {line: number, column: number}): {line: number, column: number} {"
        },
        {
            "sha": "f0ef79e12b069b723b5e40276f3eb767868d7797",
            "filename": "packages/localize/src/tools/src/translate/main.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -105,7 +105,7 @@ if (require.main === module) {\n   const sourceRootPath = options.r;\n   const sourceFilePaths = glob.sync(options.s, {cwd: sourceRootPath, nodir: true});\n   const translationFilePaths: (string|string[])[] = convertArraysFromArgs(options.t);\n-  const outputPathFn = getOutputPathFn(fs.resolve(options.o));\n+  const outputPathFn = getOutputPathFn(fs, fs.resolve(options.o));\n   const diagnostics = new Diagnostics();\n   const missingTranslation = options.m as DiagnosticHandlingStrategy;\n   const duplicateTranslation = options.d as DiagnosticHandlingStrategy;"
        },
        {
            "sha": "2285794bdbc52c2434ed6ff1495ad39017fb9f38",
            "filename": "packages/localize/src/tools/src/translate/output_path.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Foutput_path.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Foutput_path.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Foutput_path.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,8 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {join} from 'path';\n+import {AbsoluteFsPath, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n \n /**\n  * A function that will return an absolute path to where a file is to be written, given a locale and\n@@ -23,8 +22,8 @@ export interface OutputPathFn {\n  * The special `{{LOCALE}}` marker will be replaced with the locale code of the current translation.\n  * @param outputFolder An absolute path to the folder containing this set of translations.\n  */\n-export function getOutputPathFn(outputFolder: AbsoluteFsPath): OutputPathFn {\n+export function getOutputPathFn(fs: PathManipulation, outputFolder: AbsoluteFsPath): OutputPathFn {\n   const [pre, post] = outputFolder.split('{{LOCALE}}');\n-  return post === undefined ? (_locale, relativePath) => join(pre, relativePath) :\n-                              (locale, relativePath) => join(pre + locale + post, relativePath);\n+  return post === undefined ? (_locale, relativePath) => fs.join(pre, relativePath) :\n+                              (locale, relativePath) => fs.join(pre + locale + post, relativePath);\n }"
        },
        {
            "sha": "a3aa49ea6037ca29ac72cabbe5b00589772f9881",
            "filename": "packages/localize/src/tools/src/translate/source_files/es2015_translate_plugin.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -41,7 +41,7 @@ export function makeEs2015TranslatePlugin(\n             // If we get a BabelParseError here then something went wrong with Babel itself\n             // since there must be something wrong with the structure of the AST generated\n             // by Babel parsing a TaggedTemplateExpression.\n-            throw buildCodeFrameError(path, e);\n+            throw buildCodeFrameError(fs, path, e);\n           } else {\n             throw e;\n           }"
        },
        {
            "sha": "b8f1bf4c65e2776fc96c3b99da8e573af848db09",
            "filename": "packages/localize/src/tools/src/translate/source_files/es5_translate_plugin.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -37,7 +37,7 @@ export function makeEs5TranslatePlugin(\n           }\n         } catch (e) {\n           if (isBabelParseError(e)) {\n-            diagnostics.error(buildCodeFrameError(callPath, e));\n+            diagnostics.error(buildCodeFrameError(fs, callPath, e));\n           } else {\n             throw e;\n           }"
        },
        {
            "sha": "8c71aed038f9b2eb13a696ae7d4a7e08720ae6de",
            "filename": "packages/localize/src/tools/src/translate/source_files/source_file_translation_handler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -81,6 +81,7 @@ export class SourceFileTranslationHandler implements TranslationHandler {\n         makeEs2015TranslatePlugin(diagnostics, translationBundle.translations, options, this.fs),\n         makeEs5TranslatePlugin(diagnostics, translationBundle.translations, options, this.fs),\n       ],\n+      cwd: sourceRoot,\n       filename,\n     });\n     if (translated && translated.code) {"
        },
        {
            "sha": "1e2d6d768c9410ba1a25dc72635bf947275f8635",
            "filename": "packages/localize/src/tools/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -15,6 +15,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/localize\",\n         \"//packages/localize/src/tools\",\n+        \"//packages/localize/src/tools/test/helpers\",\n         \"//packages/localize/src/utils\",\n         \"@npm//@babel/core\",\n         \"@npm//@babel/generator\","
        },
        {
            "sha": "d2dfa903059543bb7be5f7d80e93a4594ce9f88a",
            "filename": "packages/localize/src/tools/test/extract/extractor_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 64,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,13 +5,13 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, getFileSystem, relativeFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {absoluteFrom, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n \n import {MessageExtractor} from '../../src/extract/extraction';\n+import {runInNativeFileSystem} from '../helpers';\n \n-runInEachFileSystem(() => {\n+runInNativeFileSystem(() => {\n   describe('extractMessages', () => {\n     it('should extract a message for each $localize template tag', () => {\n       const fs = getFileSystem();\n@@ -20,7 +20,7 @@ runInEachFileSystem(() => {\n       const filename = 'relative/path.js';\n       const file = fs.resolve(basePath, filename);\n       const extractor = new MessageExtractor(fs, logger, {basePath});\n-      fs.ensureDir(absoluteFrom('/root/path/relative'));\n+      fs.ensureDir(fs.dirname(file));\n       fs.writeFile(file, [\n         '$localize`:meaning|description:a${1}b${2}c`;',\n         '$localize(__makeTemplateObject([\"a\", \":custom-placeholder:b\", \"c\"], [\"a\", \":custom-placeholder:b\", \"c\"]), 1, 2);',\n@@ -40,38 +40,28 @@ runInEachFileSystem(() => {\n           {\n             start: {line: 0, column: 10},\n             end: {line: 0, column: 32},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: ':meaning|description:a',\n           },\n           {\n             start: {line: 0, column: 36},\n             end: {line: 0, column: 37},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: 'b',\n           },\n           {\n             start: {line: 0, column: 41},\n             end: {line: 0, column: 42},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: 'c',\n           }\n         ],\n         text: 'a{$PH}b{$PH_1}c',\n         placeholderNames: ['PH', 'PH_1'],\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n-          PH: {\n-            start: {line: 0, column: 34},\n-            end: {line: 0, column: 35},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '1'\n-          },\n-          PH_1: {\n-            start: {line: 0, column: 39},\n-            end: {line: 0, column: 40},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '2'\n-          }\n+          PH: {start: {line: 0, column: 34}, end: {line: 0, column: 35}, file, text: '1'},\n+          PH_1: {start: {line: 0, column: 39}, end: {line: 0, column: 40}, file, text: '2'}\n         },\n         legacyIds: [],\n         location: {\n@@ -92,38 +82,29 @@ runInEachFileSystem(() => {\n           {\n             start: {line: 1, column: 69},\n             end: {line: 1, column: 72},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: '\"a\"',\n           },\n           {\n             start: {line: 1, column: 74},\n             end: {line: 1, column: 97},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: '\":custom-placeholder:b\"',\n           },\n           {\n             start: {line: 1, column: 99},\n             end: {line: 1, column: 102},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n+            file,\n             text: '\"c\"',\n           }\n         ],\n         text: 'a{$custom-placeholder}b{$PH_1}c',\n         placeholderNames: ['custom-placeholder', 'PH_1'],\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n-          'custom-placeholder': {\n-            start: {line: 1, column: 106},\n-            end: {line: 1, column: 107},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '1'\n-          },\n-          PH_1: {\n-            start: {line: 1, column: 109},\n-            end: {line: 1, column: 110},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '2'\n-          }\n+          'custom-placeholder':\n+              {start: {line: 1, column: 106}, end: {line: 1, column: 107}, file, text: '1'},\n+          PH_1: {start: {line: 1, column: 109}, end: {line: 1, column: 110}, file, text: '2'}\n         },\n         legacyIds: [],\n         location: {\n@@ -145,38 +126,13 @@ runInEachFileSystem(() => {\n         placeholderNames: ['PH', 'PH_1'],\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n-          PH: {\n-            start: {line: 2, column: 26},\n-            end: {line: 2, column: 27},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '1'\n-          },\n-          PH_1: {\n-            start: {line: 2, column: 31},\n-            end: {line: 2, column: 32},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: '2'\n-          }\n+          PH: {start: {line: 2, column: 26}, end: {line: 2, column: 27}, file, text: '1'},\n+          PH_1: {start: {line: 2, column: 31}, end: {line: 2, column: 32}, file, text: '2'}\n         },\n         messagePartLocations: [\n-          {\n-            start: {line: 2, column: 10},\n-            end: {line: 2, column: 24},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: ':@@custom-id:a'\n-          },\n-          {\n-            start: {line: 2, column: 28},\n-            end: {line: 2, column: 29},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: 'b'\n-          },\n-          {\n-            start: {line: 2, column: 33},\n-            end: {line: 2, column: 34},\n-            file: absoluteFrom('/root/path/relative/path.js'),\n-            text: 'c'\n-          }\n+          {start: {line: 2, column: 10}, end: {line: 2, column: 24}, file, text: ':@@custom-id:a'},\n+          {start: {line: 2, column: 28}, end: {line: 2, column: 29}, file, text: 'b'},\n+          {start: {line: 2, column: 33}, end: {line: 2, column: 34}, file, text: 'c'}\n         ],\n         legacyIds: [],\n         location: {"
        },
        {
            "sha": "0fbc08c302ecd5b726d982113bb9f255222615e3",
            "filename": "packages/localize/src/tools/test/extract/integration/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -15,6 +15,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/localize/src/tools\",\n         \"//packages/localize/src/tools/test:test_lib\",\n+        \"//packages/localize/src/tools/test/helpers\",\n     ],\n )\n "
        },
        {
            "sha": "982ee272101e9ea6faac868ac65fc27a4e412c1b",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -7,15 +7,15 @@\n  */\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, setFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {InvalidFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/src/invalid_file_system';\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n import {loadTestDirectory} from '@angular/compiler-cli/src/ngtsc/testing';\n \n import {extractTranslations} from '../../../src/extract/main';\n import {FormatOptions} from '../../../src/extract/translation_files/format_options';\n+import {runInNativeFileSystem} from '../../helpers';\n import {toAttributes} from '../translation_files/utils';\n \n-runInEachFileSystem(() => {\n+runInNativeFileSystem(() => {\n   let fs: FileSystem;\n   let logger: MockLogger;\n   let rootPath: AbsoluteFsPath;"
        },
        {
            "sha": "a56e44bec81b75f4343c33dbbe2e15b4a05314e7",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -1,6 +1,7 @@\n package(default_visibility = [\"//packages/localize/src/tools/test/extract/integration:__pkg__\"])\n \n load(\"@npm//typescript:index.bzl\", \"tsc\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n \n tsc(\n     name = \"compile_es5\",\n@@ -44,7 +45,8 @@ tsc(\n     data = glob([\"src/*.ts\"]),\n )\n \n-filegroup(\n+# Use copy_to_bin since filegroup doesn't seem to work on Windows.\n+copy_to_bin(\n     name = \"test_files\",\n     srcs = glob([\n         \"**/*.js\","
        },
        {
            "sha": "a1eb1b4b682acc87765f77b0f276e9337eca648e",
            "filename": "packages/localize/src/tools/test/extract/source_files/es5_extract_plugin_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 5,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fsource_files%2Fes5_extract_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fsource_files%2Fes5_extract_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fsource_files%2Fes5_extract_plugin_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -6,30 +6,42 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {FileSystem, getFileSystem, PathSegment, relativeFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage} from '@angular/localize/private';\n import {transformSync} from '@babel/core';\n \n import {makeEs5ExtractPlugin} from '../../../src/extract/source_files/es5_extract_plugin';\n+import {runInNativeFileSystem} from '../../helpers';\n+\n+runInNativeFileSystem(() => {\n+  let fs: FileSystem;\n+  let testPath: PathSegment;\n+\n+  beforeEach(() => {\n+    fs = getFileSystem();\n+    testPath = relativeFrom('app/dist/test.js');\n+  });\n \n-runInEachFileSystem(() => {\n   describe('makeEs5ExtractPlugin()', () => {\n     it('should error with code-frame information if the first argument to `$localize` is not an array',\n        () => {\n          const input = '$localize(null, [])';\n          expect(() => transformCode(input))\n              .toThrowError(\n-                 'Cannot create property \\'message\\' on string \\'/app/dist/test.js: Unexpected messageParts for `$localize` (expected an array of strings).\\n' +\n+                 `Cannot create property 'message' on string '${testPath}: ` +\n+                 'Unexpected messageParts for `$localize` (expected an array of strings).\\n' +\n                  '> 1 | $localize(null, [])\\n' +\n                  '    |           ^^^^\\'');\n        });\n \n     function transformCode(input: string): ɵParsedMessage[] {\n       const messages: ɵParsedMessage[] = [];\n+      const cwd = fs.resolve('/');\n+      const filename = fs.resolve(cwd, testPath);\n       transformSync(input, {\n         plugins: [makeEs5ExtractPlugin(getFileSystem(), messages)],\n-        filename: '/app/dist/test.js'\n+        filename,\n+        cwd,\n       })!.code!;\n       return messages;\n     }"
        },
        {
            "sha": "a54218c740247050e21d62698c1eeeb4b6b9f4a8",
            "filename": "packages/localize/src/tools/test/helpers/BUILD.bazel",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -0,0 +1,14 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"helpers\",\n+    testonly = True,\n+    srcs = glob(\n+        [\"**/*.ts\"],\n+    ),\n+    visibility = [\"//packages/localize/src/tools/test:__subpackages__\"],\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+    ],\n+)"
        },
        {
            "sha": "9911cdd2b3d82ab42ec73377ad2cc15f208ccc96",
            "filename": "packages/localize/src/tools/test/helpers/index.ts",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fhelpers%2Findex.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -0,0 +1,25 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {setFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {InvalidFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/src/invalid_file_system';\n+import {MockFileSystemNative} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+\n+/**\n+ * Only run these tests on the \"native\" file-system.\n+ *\n+ * Babel uses the `path.resolve()` function internally, which makes it very hard to mock out the\n+ * file-system from the outside. We run these tests on Unix and Windows in our CI jobs, so there is\n+ * test coverage.\n+ */\n+export function runInNativeFileSystem(callback: () => void) {\n+  describe(`<<FileSystem: Native>>`, () => {\n+    beforeEach(() => setFileSystem(new MockFileSystemNative()));\n+    afterEach(() => setFileSystem(new InvalidFileSystem()));\n+    callback();\n+  });\n+}"
        },
        {
            "sha": "4f36d9d9e79bc5cbce64ae1645431359d00ede91",
            "filename": "packages/localize/src/tools/test/source_file_utils_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -6,16 +6,16 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {absoluteFrom, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵmakeTemplateObject} from '@angular/localize';\n import {NodePath, TransformOptions, transformSync} from '@babel/core';\n import generate from '@babel/generator';\n-\n import template from '@babel/template';\n import {Expression, Identifier, TaggedTemplateExpression, ExpressionStatement, CallExpression, isParenthesizedExpression, numericLiteral, binaryExpression, NumericLiteral} from '@babel/types';\n+\n import {isGlobalIdentifier, isNamedIdentifier, isStringLiteralArray, isArrayOfExpressions, unwrapStringLiteralArray, unwrapMessagePartsFromLocalizeCall, wrapInParensIfNecessary, buildLocalizeReplacement, unwrapSubstitutionsFromLocalizeCall, unwrapMessagePartsFromTemplateLiteral, getLocation} from '../src/source_file_utils';\n+import {runInNativeFileSystem} from './helpers';\n \n-runInEachFileSystem(() => {\n+runInNativeFileSystem(() => {\n   let fs: PathManipulation;\n   beforeEach(() => fs = getFileSystem());\n   describe('utils', () => {\n@@ -414,20 +414,20 @@ runInEachFileSystem(() => {\n       it('should return a plain object containing the start, end and file of a NodePath', () => {\n         const taggedTemplate = getTaggedTemplate('const x = $localize `message`;', {\n           filename: 'src/test.js',\n-          sourceRoot: '/root',\n+          sourceRoot: fs.resolve('/project'),\n         });\n         const location = getLocation(fs, taggedTemplate)!;\n         expect(location).toBeDefined();\n         expect(location.start).toEqual({line: 0, column: 10});\n         expect(location.start.constructor.name).toEqual('Object');\n         expect(location.end).toEqual({line: 0, column: 29});\n         expect(location.end?.constructor.name).toEqual('Object');\n-        expect(location.file).toEqual(absoluteFrom('/root/src/test.js'));\n+        expect(location.file).toEqual(fs.resolve('/project/src/test.js'));\n       });\n \n       it('should return `undefined` if the NodePath has no filename', () => {\n         const taggedTemplate = getTaggedTemplate(\n-            'const x = $localize ``;', {sourceRoot: '/root', filename: undefined});\n+            'const x = $localize ``;', {sourceRoot: fs.resolve('/project'), filename: undefined});\n         const location = getLocation(fs, taggedTemplate);\n         expect(location).toBeUndefined();\n       });\n@@ -451,7 +451,8 @@ function getExpressions<T extends Expression>(\n   const expressions: NodePath<Expression>[] = [];\n   transformSync(code, {\n     code: false,\n-    filename: '/test/file.js',\n+    filename: 'test/file.js',\n+    cwd: '/',\n     plugins: [{\n       visitor: {\n         Expression: (path: NodePath<Expression>) => {\n@@ -468,7 +469,8 @@ function getLocalizeCall(code: string): NodePath<CallExpression> {\n   let callPaths: NodePath<CallExpression>[] = [];\n   transformSync(code, {\n     code: false,\n-    filename: '/test/file.js',\n+    filename: 'test/file.js',\n+    cwd: '/',\n     plugins: [{\n       visitor: {\n         CallExpression(path) {"
        },
        {
            "sha": "548e43dbf49dd5463c46d8f13b4bcde9865b2cbb",
            "filename": "packages/localize/src/tools/test/translate/asset_files/asset_file_translation_handler_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fasset_files%2Fasset_file_translation_handler_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fasset_files%2Fasset_file_translation_handler_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fasset_files%2Fasset_file_translation_handler_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -23,7 +23,7 @@ runInEachFileSystem(() => {\n \n     beforeEach(() => {\n       fs = getFileSystem();\n-      rootPath = absoluteFrom('/root/path');\n+      rootPath = absoluteFrom('/src/path');\n       filePath = relativeFrom('relative/path');\n       enTranslationPath = absoluteFrom('/translations/en/relative/path');\n       enUSTranslationPath = absoluteFrom('/translations/en-US/relative/path');"
        },
        {
            "sha": "f2fd7a622f9d804a13468e0858404e1f733eb8c5",
            "filename": "packages/localize/src/tools/test/translate/integration/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -12,18 +12,17 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/localize/src/tools\",\n+        \"//packages/localize/src/tools/test/helpers\",\n     ],\n )\n \n jasmine_node_test(\n     name = \"integration\",\n     bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n-    data = glob(\n-        [\n-            \"locales/**\",\n-            \"test_files/**\",\n-        ],\n-    ),\n+    data = [\n+        \"//packages/localize/src/tools/test/translate/integration/locales\",\n+        \"//packages/localize/src/tools/test/translate/integration/test_files\",\n+    ],\n     deps = [\n         \":test_lib\",\n         \"@npm//glob\","
        },
        {
            "sha": "2a192a90ad66595432040bccff08011f6f5427cb",
            "filename": "packages/localize/src/tools/test/translate/integration/locales/BUILD.bazel",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -0,0 +1,13 @@\n+package(default_visibility = [\"//packages/localize/src/tools/test/translate/integration:__pkg__\"])\n+\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n+\n+# Use copy_to_bin since filegroup doesn't seem to work on Windows.\n+copy_to_bin(\n+    name = \"locales\",\n+    srcs = glob([\n+        \"**/*.json\",\n+        \"**/*.xlf\",\n+        \"**/*.xtb\",\n+    ]),\n+)"
        },
        {
            "sha": "d0912838202d858f5dca43f66cb379a54011bde1",
            "filename": "packages/localize/src/tools/test/translate/integration/main_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -6,15 +6,15 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {loadTestDirectory} from '@angular/compiler-cli/src/ngtsc/testing';\n import {resolve as realResolve} from 'path';\n \n import {Diagnostics} from '../../../src/diagnostics';\n import {translateFiles} from '../../../src/translate/main';\n import {getOutputPathFn} from '../../../src/translate/output_path';\n+import {runInNativeFileSystem} from '../../helpers';\n \n-runInEachFileSystem(() => {\n+runInNativeFileSystem(() => {\n   describe('translateFiles()', () => {\n     let fs: FileSystem;\n     let testDir: AbsoluteFsPath;\n@@ -33,7 +33,7 @@ runInEachFileSystem(() => {\n \n     it('should copy non-code files to the destination folders', () => {\n       const diagnostics = new Diagnostics();\n-      const outputPathFn = getOutputPathFn(fs.resolve(testDir, '{{LOCALE}}'));\n+      const outputPathFn = getOutputPathFn(fs, fs.resolve(testDir, '{{LOCALE}}'));\n       translateFiles({\n         sourceRootPath: testFilesDir,\n         sourceFilePaths: ['test-1.txt', 'test-2.txt'],\n@@ -69,7 +69,7 @@ runInEachFileSystem(() => {\n \n     it('should translate and copy source-code files to the destination folders', () => {\n       const diagnostics = new Diagnostics();\n-      const outputPathFn = getOutputPathFn(fs.resolve(testDir, '{{LOCALE}}'));\n+      const outputPathFn = getOutputPathFn(fs, fs.resolve(testDir, '{{LOCALE}}'));\n       translateFiles({\n         sourceRootPath: testFilesDir,\n         sourceFilePaths: ['test.js'],\n@@ -97,7 +97,7 @@ runInEachFileSystem(() => {\n \n     it('should translate and copy source-code files overriding the locales', () => {\n       const diagnostics = new Diagnostics();\n-      const outputPathFn = getOutputPathFn(fs.resolve(testDir, '{{LOCALE}}'));\n+      const outputPathFn = getOutputPathFn(fs, fs.resolve(testDir, '{{LOCALE}}'));\n       translateFiles({\n         sourceRootPath: testFilesDir,\n         sourceFilePaths: ['test.js'],\n@@ -131,7 +131,7 @@ runInEachFileSystem(() => {\n \n     it('should merge translation files, if more than one provided, and translate source-code', () => {\n       const diagnostics = new Diagnostics();\n-      const outputPathFn = getOutputPathFn(fs.resolve(testDir, '{{LOCALE}}'));\n+      const outputPathFn = getOutputPathFn(fs, fs.resolve(testDir, '{{LOCALE}}'));\n       translateFiles({\n         sourceRootPath: testFilesDir,\n         sourceFilePaths: ['test-extra.js'],\n@@ -165,7 +165,7 @@ runInEachFileSystem(() => {\n \n     it('should transform and/or copy files to the destination folders', () => {\n       const diagnostics = new Diagnostics();\n-      const outputPathFn = getOutputPathFn(fs.resolve(testDir, '{{LOCALE}}'));\n+      const outputPathFn = getOutputPathFn(fs, fs.resolve(testDir, '{{LOCALE}}'));\n       translateFiles({\n         sourceRootPath: testFilesDir,\n         sourceFilePaths: ['test-1.txt', 'test-2.txt', 'test.js'],"
        },
        {
            "sha": "9e8dfcfa8fa7276cb6ef055e200d5d308539d968",
            "filename": "packages/localize/src/tools/test/translate/integration/test_files/BUILD.bazel",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -0,0 +1,12 @@\n+package(default_visibility = [\"//packages/localize/src/tools/test/translate/integration:__pkg__\"])\n+\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n+\n+# Use copy_to_bin since filegroup doesn't seem to work on Windows.\n+copy_to_bin(\n+    name = \"test_files\",\n+    srcs = glob([\n+        \"**/*.js\",\n+        \"**/*.txt\",\n+    ]),\n+)"
        },
        {
            "sha": "377a5009b08a0749fb2c918e4ceaf3c1882cde0c",
            "filename": "packages/localize/src/tools/test/translate/output_path_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Foutput_path_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Foutput_path_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Foutput_path_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,36 +5,39 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {absoluteFrom, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n import {getOutputPathFn} from '../../src/translate/output_path';\n \n runInEachFileSystem(() => {\n+  let fs: PathManipulation;\n+  beforeEach(() => fs = getFileSystem());\n+\n   describe('getOutputPathFn()', () => {\n     it('should return a function that joins the `outputPath` and the `relativePath`', () => {\n-      const fn = getOutputPathFn(absoluteFrom('/output/path'));\n+      const fn = getOutputPathFn(fs, absoluteFrom('/output/path'));\n       expect(fn('en', 'relative/path')).toEqual(absoluteFrom('/output/path/relative/path'));\n       expect(fn('en', '../parent/path')).toEqual(absoluteFrom('/output/parent/path'));\n     });\n \n     it('should return a function that interpolates the `{{LOCALE}}` in the middle of the `outputPath`',\n        () => {\n-         const fn = getOutputPathFn(absoluteFrom('/output/{{LOCALE}}/path'));\n+         const fn = getOutputPathFn(fs, absoluteFrom('/output/{{LOCALE}}/path'));\n          expect(fn('en', 'relative/path')).toEqual(absoluteFrom('/output/en/path/relative/path'));\n          expect(fn('fr', 'relative/path')).toEqual(absoluteFrom('/output/fr/path/relative/path'));\n        });\n \n     it('should return a function that interpolates the `{{LOCALE}}` in the middle of a path segment in the `outputPath`',\n        () => {\n-         const fn = getOutputPathFn(absoluteFrom('/output-{{LOCALE}}-path'));\n+         const fn = getOutputPathFn(fs, absoluteFrom('/output-{{LOCALE}}-path'));\n          expect(fn('en', 'relative/path')).toEqual(absoluteFrom('/output-en-path/relative/path'));\n          expect(fn('fr', 'relative/path')).toEqual(absoluteFrom('/output-fr-path/relative/path'));\n        });\n \n     it('should return a function that interpolates the `{{LOCALE}}` at the end of the `outputPath`',\n        () => {\n-         const fn = getOutputPathFn(absoluteFrom('/output/{{LOCALE}}'));\n+         const fn = getOutputPathFn(fs, absoluteFrom('/output/{{LOCALE}}'));\n          expect(fn('en', 'relative/path')).toEqual(absoluteFrom('/output/en/relative/path'));\n          expect(fn('fr', 'relative/path')).toEqual(absoluteFrom('/output/fr/relative/path'));\n        });"
        },
        {
            "sha": "3e3b5300db55f29ee12a9e2f685bd8fb4ca28812",
            "filename": "packages/localize/src/tools/test/translate/source_files/es2015_translate_plugin_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,16 +5,23 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵcomputeMsgId, ɵparseTranslation} from '@angular/localize';\n import {ɵParsedTranslation} from '@angular/localize/private';\n import {transformSync} from '@babel/core';\n \n import {Diagnostics} from '../../../src/diagnostics';\n import {TranslatePluginOptions} from '../../../src/source_file_utils';\n import {makeEs2015TranslatePlugin} from '../../../src/translate/source_files/es2015_translate_plugin';\n+import {runInNativeFileSystem} from '../../helpers';\n+\n+runInNativeFileSystem(() => {\n+  let fs: FileSystem;\n+\n+  beforeEach(() => {\n+    fs = getFileSystem();\n+  });\n \n-runInEachFileSystem(() => {\n   describe('makeEs2015Plugin', () => {\n     describe('(no translations)', () => {\n       it('should transform `$localize` tags with binary expression', () => {\n@@ -172,9 +179,12 @@ runInEachFileSystem(() => {\n   function transformCode(\n       input: string, translations: Record<string, ɵParsedTranslation> = {},\n       pluginOptions?: TranslatePluginOptions, diagnostics = new Diagnostics()): string {\n+    const cwd = fs.resolve('/');\n+    const filename = fs.resolve(cwd, 'app/dist/test.js');\n     return transformSync(input, {\n              plugins: [makeEs2015TranslatePlugin(diagnostics, translations, pluginOptions)],\n-             filename: '/app/dist/test.js'\n+             filename,\n+             cwd,\n            })!.code!;\n   }\n });"
        },
        {
            "sha": "a562c250e30d7b9139d37ad604fc1f4c156733ac",
            "filename": "packages/localize/src/tools/test/translate/source_files/es5_translate_plugin_spec.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 12,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -5,16 +5,25 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {FileSystem, getFileSystem, PathSegment, relativeFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵcomputeMsgId, ɵparseTranslation} from '@angular/localize';\n import {ɵParsedTranslation} from '@angular/localize/private';\n import {transformSync} from '@babel/core';\n \n import {Diagnostics} from '../../../src/diagnostics';\n import {TranslatePluginOptions} from '../../../src/source_file_utils';\n import {makeEs5TranslatePlugin} from '../../../src/translate/source_files/es5_translate_plugin';\n+import {runInNativeFileSystem} from '../../helpers';\n+\n+runInNativeFileSystem(() => {\n+  let fs: FileSystem;\n+  let testPath: PathSegment;\n+\n+  beforeEach(() => {\n+    fs = getFileSystem();\n+    testPath = relativeFrom('app/dist/test.js');\n+  });\n \n-runInEachFileSystem(() => {\n   describe('makeEs5Plugin', () => {\n     describe('(no translations)', () => {\n       it('should transform `$localize` calls with binary expression', () => {\n@@ -142,7 +151,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.hasErrors).toBe(true);\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n-             message: '/app/dist/test.js: `$localize` called without any arguments.\\n' +\n+             message: `${testPath}: \\`$localize\\` called without any arguments.\\n` +\n                  '> 1 | $localize()\\n' +\n                  '    | ^^^^^^^^^^^',\n            });\n@@ -156,8 +165,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.hasErrors).toBe(true);\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n-             message:\n-                 '/app/dist/test.js: Unexpected argument to `$localize` (expected an array).\\n' +\n+             message: `${testPath}: Unexpected argument to \\`$localize\\` (expected an array).\\n` +\n                  '> 1 | $localize(...x)\\n' +\n                  '    |           ^^^^',\n            });\n@@ -172,7 +180,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Unexpected messageParts for `$localize` (expected an array of strings).\\n' +\n+                 `${testPath}: Unexpected messageParts for \\`$localize\\` (expected an array of strings).\\n` +\n                  '> 1 | $localize(null, [])\\n' +\n                  '    |           ^^^^',\n            });\n@@ -187,7 +195,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Unexpected `raw` argument to the \"makeTemplateObject()\" function (expected an expression).\\n' +\n+                 `${testPath}: Unexpected \\`raw\\` argument to the \"makeTemplateObject()\" function (expected an expression).\\n` +\n                  '> 1 | $localize(__makeTemplateObject([], ...[]))\\n' +\n                  '    |                                    ^^^^^',\n            });\n@@ -202,7 +210,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Unexpected `cooked` argument to the \"makeTemplateObject()\" function (expected an expression).\\n' +\n+                 `${testPath}: Unexpected \\`cooked\\` argument to the \"makeTemplateObject()\" function (expected an expression).\\n` +\n                  '> 1 | $localize(__makeTemplateObject(...[], []))\\n' +\n                  '    |                                ^^^^^',\n            });\n@@ -217,7 +225,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Unexpected messageParts for `$localize` (expected an array of strings).\\n' +\n+                 `${testPath}: Unexpected messageParts for \\`$localize\\` (expected an array of strings).\\n` +\n                  '> 1 | $localize(__makeTemplateObject([\"a\", 12, \"b\"], [\"a\", \"12\", \"b\"]))\\n' +\n                  '    |                                ^^^^^^^^^^^^^^',\n            });\n@@ -232,7 +240,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Unexpected messageParts for `$localize` (expected an array of strings).\\n' +\n+                 `${testPath}: Unexpected messageParts for \\`$localize\\` (expected an array of strings).\\n` +\n                  '> 1 | $localize(__makeTemplateObject([\"a\", \"12\", \"b\"], [\"a\", 12, \"b\"]))\\n' +\n                  '    |                                                  ^^^^^^^^^^^^^^',\n            });\n@@ -247,7 +255,7 @@ runInEachFileSystem(() => {\n            expect(diagnostics.messages[0]).toEqual({\n              type: 'error',\n              message:\n-                 '/app/dist/test.js: Invalid substitutions for `$localize` (expected all substitution arguments to be expressions).\\n' +\n+                 `${testPath}: Invalid substitutions for \\`$localize\\` (expected all substitution arguments to be expressions).\\n` +\n                  '> 1 | $localize(__makeTemplateObject([\"a\", \"b\"], [\"a\", \"b\"]), ...[])\\n' +\n                  '    |                                                         ^^^^^',\n            });\n@@ -361,9 +369,12 @@ runInEachFileSystem(() => {\n   function transformCode(\n       input: string, translations: Record<string, ɵParsedTranslation> = {},\n       pluginOptions?: TranslatePluginOptions, diagnostics = new Diagnostics()): string {\n+    const cwd = fs.resolve('/');\n+    const filename = fs.resolve(cwd, testPath);\n     return transformSync(input, {\n              plugins: [makeEs5TranslatePlugin(diagnostics, translations, pluginOptions)],\n-             filename: '/app/dist/test.js'\n+             filename,\n+             cwd,\n            })!.code!;\n   }\n });"
        },
        {
            "sha": "aa9ae1dbd96362d1eedebaac042e16da29d1c35b",
            "filename": "packages/localize/src/tools/test/translate/source_files/source_file_translation_handler_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/51a79772b2228489a723265f6eba373f8dc641fc/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fsource_file_translation_handler_spec.ts?ref=51a79772b2228489a723265f6eba373f8dc641fc",
            "patch": "@@ -23,7 +23,7 @@ runInEachFileSystem(() => {\n \n     beforeEach(() => {\n       fs = getFileSystem();\n-      rootPath = absoluteFrom('/root/path');\n+      rootPath = absoluteFrom('/src/path');\n       filePath = relativeFrom('relative/path.js');\n       enTranslationPath = absoluteFrom('/translations/en/relative/path.js');\n       enUSTranslationPath = absoluteFrom('/translations/en-US/relative/path.js');"
        }
    ],
    "stats": {
        "total": 337,
        "additions": 207,
        "deletions": 130
    }
}