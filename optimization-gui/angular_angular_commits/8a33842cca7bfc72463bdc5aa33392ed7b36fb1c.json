{
    "author": "petebacondarwin",
    "message": "refactor(compiler): consolidate `R3CompiledExpression` (#41080)\n\nThere were a number of almost identical interfaces used in\nthe same way throughout the Render3 compiler code.\nThis commit changes the compiler to use the same interface\nthroughout.\n\nPR Close #41080",
    "sha": "8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
    "files": [
        {
            "sha": "de37e283d28b69eb93ea2cfeb95580636a300c11",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -6,11 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, ConstantPool, CssSelector, DeclarationListEmitMode, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, Identifiers, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3ComponentDef, R3ComponentMetadata, R3FactoryTarget, R3TargetBinder, R3UsedDirectiveMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n+import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, ConstantPool, CssSelector, DeclarationListEmitMode, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, Identifiers, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3CompiledExpression, R3ComponentMetadata, R3FactoryTarget, R3TargetBinder, R3UsedDirectiveMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {Cycle, CycleAnalyzer, CycleHandlingStrategy} from '../../cycles';\n-import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n+import {ErrorCode, FatalDiagnosticError, makeRelatedInformation} from '../../diagnostics';\n import {absoluteFrom, relative} from '../../file_system';\n import {DefaultImportRecorder, ImportedFile, ModuleResolver, Reference, ReferenceEmitter} from '../../imports';\n import {DependencyTracker} from '../../incremental/api';\n@@ -848,7 +848,7 @@ export class ComponentDecoratorHandler implements\n \n   private compileComponent(\n       analysis: Readonly<ComponentAnalysisData>,\n-      {expression: initializer, type}: R3ComponentDef): CompileResult[] {\n+      {expression: initializer, statements, type}: R3CompiledExpression): CompileResult[] {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n       injectFn: Identifiers.directiveInject,\n@@ -861,7 +861,7 @@ export class ComponentDecoratorHandler implements\n       factoryRes, {\n         name: 'ɵcmp',\n         initializer,\n-        statements: [],\n+        statements,\n         type,\n       }\n     ];"
        },
        {
            "sha": "fd03d1b92ee5ed3ce603747c35097a343d04cb6e",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -6,12 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3DependencyMetadata, R3DirectiveDef, R3DirectiveMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n+import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3CompiledExpression, R3DependencyMetadata, R3DirectiveMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n import {emitDistinctChangesOnlyDefaultValue} from '@angular/compiler/src/core';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n-import {absoluteFromSourceFile} from '../../file_system';\n import {DefaultImportRecorder, Reference} from '../../imports';\n import {areTypeParametersEqual, extractSemanticTypeParameters, isArrayEqual, isSetEqual, isSymbolEqual, SemanticDepGraphUpdater, SemanticSymbol, SemanticTypeParameter} from '../../incremental/semantic_graph';\n import {BindingPropertyName, ClassPropertyMapping, ClassPropertyName, DirectiveTypeCheckMeta, InjectableClassRegistry, MetadataReader, MetadataRegistry, TemplateGuardMeta} from '../../metadata';\n@@ -313,7 +312,7 @@ export class DirectiveDecoratorHandler implements\n \n   private compileDirective(\n       analysis: Readonly<DirectiveHandlerData>,\n-      {expression: initializer, type}: R3DirectiveDef): CompileResult[] {\n+      {expression: initializer, statements, type}: R3CompiledExpression): CompileResult[] {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n       injectFn: Identifiers.directiveInject,\n@@ -326,7 +325,7 @@ export class DirectiveDecoratorHandler implements\n       factoryRes, {\n         name: 'ɵdir',\n         initializer,\n-        statements: [],\n+        statements,\n         type,\n       }\n     ];"
        },
        {
            "sha": "93594c49a1b43f0c9ec9478f810d39186116d9b4",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/factory.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Ffactory.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Ffactory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Ffactory.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -12,5 +12,5 @@ import {CompileResult} from '../../transform';\n \n export function compileNgFactoryDefField(metadata: R3FactoryMetadata): CompileResult {\n   const res = compileFactoryFunction(metadata);\n-  return {name: 'ɵfac', initializer: res.factory, statements: res.statements, type: res.type};\n+  return {name: 'ɵfac', initializer: res.expression, statements: res.statements, type: res.type};\n }"
        },
        {
            "sha": "88f2a4320609ccbacb018c28aa4073928d8583de",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/ng_module.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -457,7 +457,7 @@ export class NgModuleDecoratorHandler implements\n     const ngInjectorDef =\n         compileInjector({...inj, imports: [...inj.imports, ...resolution.injectorImports]});\n     const ngModuleDef = compileNgModule(mod);\n-    const ngModuleStatements = ngModuleDef.additionalStatements;\n+    const ngModuleStatements = ngModuleDef.statements;\n     if (metadataStmt !== null) {\n       ngModuleStatements.push(metadataStmt);\n     }\n@@ -497,7 +497,7 @@ export class NgModuleDecoratorHandler implements\n       {\n         name: 'ɵinj',\n         initializer: ngInjectorDef.expression,\n-        statements: [],\n+        statements: ngInjectorDef.statements,\n         type: ngInjectorDef.type,\n       },\n     ];"
        },
        {
            "sha": "a19b5bae5906fb0f37d35596d05143a15c463232",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/pipe.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileDeclarePipeFromMetadata, compilePipeFromMetadata, Identifiers, R3FactoryTarget, R3PipeDef, R3PipeMetadata, Statement, WrappedNodeExpr} from '@angular/compiler';\n+import {compileDeclarePipeFromMetadata, compilePipeFromMetadata, Identifiers, R3CompiledExpression, R3FactoryTarget, R3PipeMetadata, Statement, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n@@ -170,7 +170,7 @@ export class PipeDecoratorHandler implements\n     return this.compilePipe(analysis, res);\n   }\n \n-  private compilePipe(analysis: Readonly<PipeHandlerData>, def: R3PipeDef) {\n+  private compilePipe(analysis: Readonly<PipeHandlerData>, def: R3CompiledExpression) {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n       injectFn: Identifiers.directiveInject,\n@@ -183,7 +183,7 @@ export class PipeDecoratorHandler implements\n       factoryRes, {\n         name: 'ɵpipe',\n         initializer: def.expression,\n-        statements: [],\n+        statements: def.statements,\n         type: def.type,\n       }\n     ];"
        },
        {
            "sha": "d32f9c29ef03113104e5298f2da70e008612c566",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -101,7 +101,7 @@ export {R3DependencyMetadata, R3ResolvedDependencyType, compileFactoryFunction,\n export {compileInjector, compileNgModule, R3InjectorMetadata, R3NgModuleMetadata} from './render3/r3_module_compiler';\n export {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n export {makeBindingParser, ParsedTemplate, parseTemplate, ParseTemplateOptions} from './render3/view/template';\n-export {R3Reference, devOnlyGuardedExpression, getSafePropertyAccessString} from './render3/util';\n+export {R3CompiledExpression, R3Reference, devOnlyGuardedExpression, getSafePropertyAccessString} from './render3/util';\n export {compileComponentFromMetadata, compileDirectiveFromMetadata, parseHostBindings, ParsedHostBindings, verifyHostBindings} from './render3/view/compiler';\n export {compileDeclareComponentFromMetadata} from './render3/partial/component';\n export {compileDeclareDirectiveFromMetadata} from './render3/partial/directive';"
        },
        {
            "sha": "def4178fd976601ef838b190c8d8816f682c4557",
            "filename": "packages/compiler/src/injectable_compiler_2.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -32,7 +32,7 @@ export interface R3InjectableMetadata {\n }\n \n export function compileInjectable(meta: R3InjectableMetadata): InjectableDef {\n-  let result: {factory: o.Expression, statements: o.Statement[]}|null = null;\n+  let result: {expression: o.Expression, statements: o.Statement[]}|null = null;\n \n   const factoryMeta: R3FactoryMetadata = {\n     name: meta.name,\n@@ -83,7 +83,7 @@ export function compileInjectable(meta: R3InjectableMetadata): InjectableDef {\n     } else {\n       result = {\n         statements: [],\n-        factory: o.fn([], [new o.ReturnStatement(meta.useFactory.callFn([]))])\n+        expression: o.fn([], [new o.ReturnStatement(meta.useFactory.callFn([]))])\n       };\n     }\n   } else if (meta.useValue !== undefined) {\n@@ -110,7 +110,7 @@ export function compileInjectable(meta: R3InjectableMetadata): InjectableDef {\n   const injectableProps =\n       new DefinitionMap<{token: o.Expression, factory: o.Expression, providedIn: o.Expression}>();\n   injectableProps.set('token', token);\n-  injectableProps.set('factory', result.factory);\n+  injectableProps.set('factory', result.expression);\n \n   // Only generate providedIn property if it has a non-null value\n   if ((meta.providedIn as o.LiteralExpr).value !== null) {\n@@ -135,7 +135,7 @@ function delegateToFactory(type: o.WrappedNodeExpr<any>, internalType: o.Wrapped\n     // If types are the same, we can generate `factory: type.ɵfac`\n     // If types are different, we have to generate a wrapper function to ensure\n     // the internal type has been resolved (`factory: function(t) { return type.ɵfac(t); }`)\n-    factory: type.node === internalType.node ?\n+    expression: type.node === internalType.node ?\n         internalType.prop('ɵfac') :\n         o.fn([new o.FnParam('t', o.DYNAMIC_TYPE)], [new o.ReturnStatement(internalType.callMethod(\n                                                        'ɵfac', [o.variable('t')]))])"
        },
        {
            "sha": "ee97a86f1135e112b323a1c2554670adfe0b8488",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -196,7 +196,7 @@ export class CompilerFacadeImpl implements CompilerFacade {\n       target: meta.target,\n     });\n     return this.jitExpression(\n-        factoryRes.factory, angularCoreEnv, sourceMapUrl, factoryRes.statements);\n+        factoryRes.expression, angularCoreEnv, sourceMapUrl, factoryRes.statements);\n   }\n \n   createParseSourceSpan(kind: string, typeName: string, sourceUrl: string): ParseSourceSpan {"
        },
        {
            "sha": "74080d082b03f3f440f91c97a072b4583410230e",
            "filename": "packages/compiler/src/render3/partial/component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -10,7 +10,8 @@ import {DEFAULT_INTERPOLATION_CONFIG} from '../../ml_parser/interpolation_config\n import * as o from '../../output/output_ast';\n import {ParseLocation, ParseSourceFile, ParseSourceSpan} from '../../parse_util';\n import {Identifiers as R3} from '../r3_identifiers';\n-import {DeclarationListEmitMode, R3ComponentDef, R3ComponentMetadata, R3UsedDirectiveMetadata} from '../view/api';\n+import {R3CompiledExpression} from '../util';\n+import {DeclarationListEmitMode, R3ComponentMetadata, R3UsedDirectiveMetadata} from '../view/api';\n import {createComponentType} from '../view/compiler';\n import {ParsedTemplate} from '../view/template';\n import {DefinitionMap} from '../view/util';\n@@ -24,13 +25,13 @@ import {toOptionalLiteralArray} from './util';\n  * Compile a component declaration defined by the `R3ComponentMetadata`.\n  */\n export function compileDeclareComponentFromMetadata(\n-    meta: R3ComponentMetadata, template: ParsedTemplate): R3ComponentDef {\n+    meta: R3ComponentMetadata, template: ParsedTemplate): R3CompiledExpression {\n   const definitionMap = createComponentDefinitionMap(meta, template);\n \n   const expression = o.importExpr(R3.declareComponent).callFn([definitionMap.toLiteralMap()]);\n   const type = createComponentType(meta);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n /**"
        },
        {
            "sha": "a14c3c5ef69ac3ef7ff69077b94a68e4bb1a950d",
            "filename": "packages/compiler/src/render3/partial/directive.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -7,7 +7,8 @@\n  */\n import * as o from '../../output/output_ast';\n import {Identifiers as R3} from '../r3_identifiers';\n-import {R3DirectiveDef, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata} from '../view/api';\n+import {R3CompiledExpression} from '../util';\n+import {R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata} from '../view/api';\n import {createDirectiveType} from '../view/compiler';\n import {asLiteral, conditionallyCreateMapObjectLiteral, DefinitionMap} from '../view/util';\n import {R3DeclareDirectiveMetadata, R3DeclareQueryMetadata} from './api';\n@@ -17,13 +18,14 @@ import {toOptionalLiteralMap} from './util';\n /**\n  * Compile a directive declaration defined by the `R3DirectiveMetadata`.\n  */\n-export function compileDeclareDirectiveFromMetadata(meta: R3DirectiveMetadata): R3DirectiveDef {\n+export function compileDeclareDirectiveFromMetadata(meta: R3DirectiveMetadata):\n+    R3CompiledExpression {\n   const definitionMap = createDirectiveDefinitionMap(meta);\n \n   const expression = o.importExpr(R3.declareDirective).callFn([definitionMap.toLiteralMap()]);\n   const type = createDirectiveType(meta);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n /**"
        },
        {
            "sha": "bea20bcc20d2e632d5683f7d5f41347022408f1e",
            "filename": "packages/compiler/src/render3/partial/pipe.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fpipe.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -8,21 +8,21 @@\n import * as o from '../../output/output_ast';\n import {Identifiers as R3} from '../r3_identifiers';\n import {createPipeType, R3PipeMetadata} from '../r3_pipe_compiler';\n-import {R3PipeDef} from '../view/api';\n+import {R3CompiledExpression} from '../util';\n import {DefinitionMap} from '../view/util';\n import {R3DeclarePipeMetadata} from './api';\n \n \n /**\n  * Compile a Pipe declaration defined by the `R3PipeMetadata`.\n  */\n-export function compileDeclarePipeFromMetadata(meta: R3PipeMetadata): R3PipeDef {\n+export function compileDeclarePipeFromMetadata(meta: R3PipeMetadata): R3CompiledExpression {\n   const definitionMap = createPipeDefinitionMap(meta);\n \n   const expression = o.importExpr(R3.declarePipe).callFn([definitionMap.toLiteralMap()]);\n   const type = createPipeType(meta);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n /**"
        },
        {
            "sha": "1ed89bc85ebebb2a8b29c109ea0bd4bcfa77fc01",
            "filename": "packages/compiler/src/render3/r3_factory.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -15,7 +15,7 @@ import * as o from '../output/output_ast';\n import {Identifiers as R3} from '../render3/r3_identifiers';\n import {OutputContext} from '../util';\n \n-import {R3Reference, typeWithParameters} from './util';\n+import {R3CompiledExpression, R3Reference, typeWithParameters} from './util';\n import {unsupported} from './view/util';\n \n \n@@ -169,16 +169,10 @@ export interface R3DependencyMetadata {\n   skipSelf: boolean;\n }\n \n-export interface R3FactoryFn {\n-  factory: o.Expression;\n-  statements: o.Statement[];\n-  type: o.ExpressionType;\n-}\n-\n /**\n  * Construct a factory function expression for the given `R3FactoryMetadata`.\n  */\n-export function compileFactoryFunction(meta: R3FactoryMetadata): R3FactoryFn {\n+export function compileFactoryFunction(meta: R3FactoryMetadata): R3CompiledExpression {\n   const t = o.variable('t');\n   const statements: o.Statement[] = [];\n   let ctorDepsType: o.Type = o.NONE_TYPE;\n@@ -258,7 +252,7 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3FactoryFn {\n   }\n \n   return {\n-    factory: o.fn(\n+    expression: o.fn(\n         [new o.FnParam('t', o.DYNAMIC_TYPE)], body, o.INFERRED_TYPE, undefined,\n         `${meta.name}_Factory`),\n     statements,"
        },
        {
            "sha": "fc08bc2076ac082c2048efc9867001d8147665ac",
            "filename": "packages/compiler/src/render3/r3_module_compiler.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 18,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_module_compiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_module_compiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_module_compiler.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -9,15 +9,9 @@\n import * as o from '../output/output_ast';\n \n import {Identifiers as R3} from './r3_identifiers';\n-import {jitOnlyGuardedExpression, R3Reference} from './util';\n+import {jitOnlyGuardedExpression, R3CompiledExpression, R3Reference} from './util';\n import {DefinitionMap} from './view/util';\n \n-export interface R3NgModuleDef {\n-  expression: o.Expression;\n-  type: o.Type;\n-  additionalStatements: o.Statement[];\n-}\n-\n /**\n  * Metadata required by the module compiler to generate a module def (`ɵmod`) for a type.\n  */\n@@ -126,7 +120,7 @@ interface R3NgModuleDefMap {\n /**\n  * Construct an `R3NgModuleDef` for the given `R3NgModuleMetadata`.\n  */\n-export function compileNgModule(meta: R3NgModuleMetadata): R3NgModuleDef {\n+export function compileNgModule(meta: R3NgModuleMetadata): R3CompiledExpression {\n   const {\n     internalType,\n     type: moduleType,\n@@ -140,7 +134,7 @@ export function compileNgModule(meta: R3NgModuleMetadata): R3NgModuleDef {\n     id\n   } = meta;\n \n-  const additionalStatements: o.Statement[] = [];\n+  const statements: o.Statement[] = [];\n   const definitionMap = new DefinitionMap<R3NgModuleDefMap>();\n   definitionMap.set('type', internalType);\n \n@@ -170,7 +164,7 @@ export function compileNgModule(meta: R3NgModuleMetadata): R3NgModuleDef {\n   else {\n     const setNgModuleScopeCall = generateSetNgModuleScopeCall(meta);\n     if (setNgModuleScopeCall !== null) {\n-      additionalStatements.push(setNgModuleScopeCall);\n+      statements.push(setNgModuleScopeCall);\n     }\n   }\n \n@@ -190,7 +184,7 @@ export function compileNgModule(meta: R3NgModuleMetadata): R3NgModuleDef {\n   ]));\n \n \n-  return {expression, type, additionalStatements};\n+  return {expression, type, statements};\n }\n \n /**\n@@ -242,11 +236,6 @@ function generateSetNgModuleScopeCall(meta: R3NgModuleMetadata): o.Statement|nul\n   return iifeCall.toStmt();\n }\n \n-export interface R3InjectorDef {\n-  expression: o.Expression;\n-  type: o.Type;\n-}\n-\n export interface R3InjectorMetadata {\n   name: string;\n   type: R3Reference;\n@@ -255,7 +244,7 @@ export interface R3InjectorMetadata {\n   imports: o.Expression[];\n }\n \n-export function compileInjector(meta: R3InjectorMetadata): R3InjectorDef {\n+export function compileInjector(meta: R3InjectorMetadata): R3CompiledExpression {\n   const definitionMap = new DefinitionMap<{providers: o.Expression, imports: o.Expression}>();\n \n   if (meta.providers !== null) {\n@@ -270,7 +259,7 @@ export function compileInjector(meta: R3InjectorMetadata): R3InjectorDef {\n       o.importExpr(R3.defineInjector).callFn([definitionMap.toLiteralMap()], undefined, true);\n   const type =\n       new o.ExpressionType(o.importExpr(R3.InjectorDef, [new o.ExpressionType(meta.type.type)]));\n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n function tupleTypeOf(exp: R3Reference[]): o.Type {"
        },
        {
            "sha": "f2342086c804be958c6f4c75c8e1b481661be37d",
            "filename": "packages/compiler/src/render3/r3_pipe_compiler.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_pipe_compiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_pipe_compiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_pipe_compiler.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -9,8 +9,7 @@ import * as o from '../output/output_ast';\n \n import {R3DependencyMetadata} from './r3_factory';\n import {Identifiers as R3} from './r3_identifiers';\n-import {R3Reference, typeWithParameters} from './util';\n-import {R3PipeDef} from './view/api';\n+import {R3CompiledExpression, R3Reference, typeWithParameters} from './util';\n \n export interface R3PipeMetadata {\n   /**\n@@ -53,7 +52,7 @@ export interface R3PipeMetadata {\n   pure: boolean;\n }\n \n-export function compilePipeFromMetadata(metadata: R3PipeMetadata): R3PipeDef {\n+export function compilePipeFromMetadata(metadata: R3PipeMetadata): R3CompiledExpression {\n   const definitionMapValues: {key: string, quoted: boolean, value: o.Expression}[] = [];\n \n   // e.g. `name: 'myPipe'`\n@@ -69,7 +68,7 @@ export function compilePipeFromMetadata(metadata: R3PipeMetadata): R3PipeDef {\n       o.importExpr(R3.definePipe).callFn([o.literalMap(definitionMapValues)], undefined, true);\n   const type = createPipeType(metadata);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n export function createPipeType(metadata: R3PipeMetadata): o.Type {"
        },
        {
            "sha": "ab8aaf33ad920c0e8b92b1e554f8d4eb719e68dc",
            "filename": "packages/compiler/src/render3/util.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -25,6 +25,15 @@ export interface R3Reference {\n   type: o.Expression;\n }\n \n+/**\n+ * Result of compilation of a render3 code unit, e.g. component, directive, pipe, etc.\n+ */\n+export interface R3CompiledExpression {\n+  expression: o.Expression;\n+  type: o.Type;\n+  statements: o.Statement[];\n+}\n+\n const ANIMATE_SYMBOL_PREFIX = '@';\n export function prepareSyntheticPropertyName(name: string) {\n   return `${ANIMATE_SYMBOL_PREFIX}${name}`;"
        },
        {
            "sha": "2e1d67a545b0dc8d564d84f1ba8ce641f0b7aa55",
            "filename": "packages/compiler/src/render3/view/api.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -338,30 +338,6 @@ export interface R3QueryMetadata {\n   static: boolean;\n }\n \n-/**\n- * Output of render3 directive compilation.\n- */\n-export interface R3DirectiveDef {\n-  expression: o.Expression;\n-  type: o.Type;\n-}\n-\n-/**\n- * Output of render3 component compilation.\n- */\n-export interface R3ComponentDef {\n-  expression: o.Expression;\n-  type: o.Type;\n-}\n-\n-/**\n- * Output of render3 pipe compilation.\n- */\n-export interface R3PipeDef {\n-  expression: o.Expression;\n-  type: o.Type;\n-}\n-\n /**\n  * Mappings indicating how the class interacts with its\n  * host element (host bindings, listeners, etc)."
        },
        {
            "sha": "3d582ee77b5efab2d7d1feae1cf657cfc6414a46",
            "filename": "packages/compiler/src/render3/view/compiler.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a33842cca7bfc72463bdc5aa33392ed7b36fb1c/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts?ref=8a33842cca7bfc72463bdc5aa33392ed7b36fb1c",
            "patch": "@@ -20,9 +20,9 @@ import {BindingParser} from '../../template_parser/binding_parser';\n import {error} from '../../util';\n import {BoundEvent} from '../r3_ast';\n import {Identifiers as R3} from '../r3_identifiers';\n-import {prepareSyntheticListenerFunctionName, prepareSyntheticPropertyName, typeWithParameters} from '../util';\n+import {prepareSyntheticListenerFunctionName, prepareSyntheticPropertyName, R3CompiledExpression, typeWithParameters} from '../util';\n \n-import {DeclarationListEmitMode, R3ComponentDef, R3ComponentMetadata, R3DirectiveDef, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata} from './api';\n+import {DeclarationListEmitMode, R3ComponentMetadata, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata} from './api';\n import {MIN_STYLING_BINDING_SLOTS_REQUIRED, StylingBuilder, StylingInstructionCall} from './styling_builder';\n import {BindingScope, makeBindingParser, prepareEventListenerParameters, renderFlagCheckIfStmt, resolveSanitizationFn, TemplateDefinitionBuilder, ValueConverter} from './template';\n import {asLiteral, chainedInstruction, conditionallyCreateMapObjectLiteral, CONTEXT_NAME, DefinitionMap, getQueryPredicate, RENDER_FLAGS, TEMPORARY_NAME, temporaryAllocator} from './util';\n@@ -113,22 +113,22 @@ function addFeatures(definitionMap: DefinitionMap, meta: R3DirectiveMetadata|R3C\n  */\n export function compileDirectiveFromMetadata(\n     meta: R3DirectiveMetadata, constantPool: ConstantPool,\n-    bindingParser: BindingParser): R3DirectiveDef {\n+    bindingParser: BindingParser): R3CompiledExpression {\n   const definitionMap = baseDirectiveFields(meta, constantPool, bindingParser);\n   addFeatures(definitionMap, meta);\n   const expression =\n       o.importExpr(R3.defineDirective).callFn([definitionMap.toLiteralMap()], undefined, true);\n   const type = createDirectiveType(meta);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n /**\n  * Compile a component for the render3 runtime as defined by the `R3ComponentMetadata`.\n  */\n export function compileComponentFromMetadata(\n     meta: R3ComponentMetadata, constantPool: ConstantPool,\n-    bindingParser: BindingParser): R3ComponentDef {\n+    bindingParser: BindingParser): R3CompiledExpression {\n   const definitionMap = baseDirectiveFields(meta, constantPool, bindingParser);\n   addFeatures(definitionMap, meta);\n \n@@ -256,7 +256,7 @@ export function compileComponentFromMetadata(\n       o.importExpr(R3.defineComponent).callFn([definitionMap.toLiteralMap()], undefined, true);\n   const type = createComponentType(meta);\n \n-  return {expression, type};\n+  return {expression, type, statements: []};\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 149,
        "additions": 59,
        "deletions": 90
    }
}