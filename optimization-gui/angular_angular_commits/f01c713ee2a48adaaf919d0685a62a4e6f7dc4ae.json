{
    "author": "gkalpak",
    "message": "ci: fix AIO deployment to multiple Firebase sites (#39948)\n\nSince #39853, it is possible to deploy to multiple Firebase sites from a\nsingle branch. In order to deploy to a site, we need to associate an\nalias (`aio`) with a site. This is done via the `firebase target:apply`\ncommand. However, when the command is called multiple times, it\nassociates the alias with many sites, which subsequently fails during\ndeployment ([example failure][1]), since the `firebase deploy` command\ndoes not know what site to deploy to.\n\nThis commit fixes the deployment script by ensuring that any previous\nassociation with the `aio` alias is cleared (via the\n`firebase target:clear` command) before associating it with a new site.\n\n[1]: https://circleci.com/gh/angular/angular/871020\n\nPR Close #39948",
    "sha": "f01c713ee2a48adaaf919d0685a62a4e6f7dc4ae",
    "files": [
        {
            "sha": "735a8d740a4969fbec0e25f3f9430b1262c72c54",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/f01c713ee2a48adaaf919d0685a62a4e6f7dc4ae/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/f01c713ee2a48adaaf919d0685a62a4e6f7dc4ae/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=f01c713ee2a48adaaf919d0685a62a4e6f7dc4ae",
            "patch": "@@ -250,11 +250,11 @@ function deploy(data) {\n   preDeployActions.forEach(fn => fn(data));\n \n   console.log('\\n\\n\\n==== Deploy AIO to Firebase hosting. ====\\n');\n-  yarn(`firebase use \"${projectId}\" --token \"${firebaseToken}\"`);\n-  yarn(`firebase target:apply hosting aio \"${siteId}\" --token \"${firebaseToken}\"`);\n-  yarn(\n-      `firebase deploy --only hosting:aio --message \"Commit: ${currentCommit}\" --non-interactive ` +\n-      `--token \"${firebaseToken}\"`);\n+  const firebase = cmd => yarn(`firebase ${cmd} --token \"${firebaseToken}\"`);\n+  firebase(`use \"${projectId}\"`);\n+  firebase('target:clear hosting aio');\n+  firebase(`target:apply hosting aio \"${siteId}\"`);\n+  firebase(`deploy --only hosting:aio --message \"Commit: ${currentCommit}\" --non-interactive`);\n \n   console.log('\\n\\n\\n==== Run post-deploy actions. ====\\n');\n   postDeployActions.forEach(fn => fn(data));"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}