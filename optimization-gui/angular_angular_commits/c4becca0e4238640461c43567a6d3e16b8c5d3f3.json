{
    "author": "CaerusKaru",
    "message": "feat(router): add new initialNavigation options to replace legacy (#37480)\n\nAs of Angular v4, four of the options for\n`ExtraOptions#initialNavigation` have been deprecated. We intend\nto remove them in v11. The final state for these options is:\n`enabledBlocking`, `enabledNonBlocking`, and `disabled`. We plan\nto remove and deprecate the remaining option in the next two\nmajor releases.\n\nNew options:\n- `enabledNonBlocking`: same as legacy_enabled\n- `enabledBlocking`: same as enabled\n\nBREAKING CHANGE:\n\n* The `initialNavigation` property for the options in\n  `RouterModule.forRoot` no longer supports `legacy_disabled`,\n  `legacy_enabled`, `true`, or `false` as valid values.\n  `legacy_enabled` (the old default) is instead `enabledNonBlocking`\n* `enabled` is deprecated as a valid value for the\n  `RouterModule.forRoot` `initialNavigation` option. `enabledBlocking`\n  has been introduced to replace it\n\nPR Close #37480",
    "sha": "c4becca0e4238640461c43567a6d3e16b8c5d3f3",
    "files": [
        {
            "sha": "8734cd842a2f29eacf2f88efba6e7aae3c22bb61",
            "filename": "goldens/public-api/router/router.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c4becca0e4238640461c43567a6d3e16b8c5d3f3/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/c4becca0e4238640461c43567a6d3e16b8c5d3f3/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts?ref=c4becca0e4238640461c43567a6d3e16b8c5d3f3",
            "patch": "@@ -156,7 +156,7 @@ export declare class GuardsCheckStart extends RouterEvent {\n     toString(): string;\n }\n \n-export declare type InitialNavigation = true | false | 'enabled' | 'disabled' | 'legacy_enabled' | 'legacy_disabled';\n+export declare type InitialNavigation = 'disabled' | 'enabled' | 'enabledBlocking' | 'enabledNonBlocking';\n \n export declare type LoadChildren = LoadChildrenCallback | DeprecatedLoadChildren;\n "
        },
        {
            "sha": "b632516078edfa4515796dcc90ee9f833c6588a3",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c4becca0e4238640461c43567a6d3e16b8c5d3f3/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/c4becca0e4238640461c43567a6d3e16b8c5d3f3/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=c4becca0e4238640461c43567a6d3e16b8c5d3f3",
            "patch": "@@ -49,7 +49,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 2289,\n-        \"main-es2015\": 218329,\n+        \"main-es2015\": 217827,\n         \"polyfills-es2015\": 36723,\n         \"5-es2015\": 781\n       }"
        },
        {
            "sha": "46ad352138ab0e36b7615ceeca078bf379463969",
            "filename": "packages/router/src/router_module.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 49,
            "changes": 71,
            "blob_url": "https://github.com/angular/angular/blob/c4becca0e4238640461c43567a6d3e16b8c5d3f3/packages%2Frouter%2Fsrc%2Frouter_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/c4becca0e4238640461c43567a6d3e16b8c5d3f3/packages%2Frouter%2Fsrc%2Frouter_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter_module.ts?ref=c4becca0e4238640461c43567a6d3e16b8c5d3f3",
            "patch": "@@ -222,32 +222,27 @@ export function provideRoutes(routes: Routes): any {\n  * Allowed values in an `ExtraOptions` object that configure\n  * when the router performs the initial navigation operation.\n  *\n- * * 'enabled' - The initial navigation starts before the root component is created.\n+ * * 'enabledNonBlocking' - (default) The initial navigation starts after the\n+ * root component has been created. The bootstrap is not blocked on the completion of the initial\n+ * navigation.\n+ * * 'enabledBlocking' - The initial navigation starts before the root component is created.\n  * The bootstrap is blocked until the initial navigation is complete. This value is required\n  * for [server-side rendering](guide/universal) to work.\n  * * 'disabled' - The initial navigation is not performed. The location listener is set up before\n  * the root component gets created. Use if there is a reason to have\n  * more control over when the router starts its initial navigation due to some complex\n  * initialization logic.\n  *\n- * The following values have been [deprecated](guide/releases#deprecation-practices) since v4,\n+ * The following values have been [deprecated](guide/releases#deprecation-practices) since v11,\n  * and should not be used for new applications.\n  *\n- * * 'legacy_enabled'- (Default, for compatibility.) The initial navigation starts after the root\n- * component has been created. The bootstrap is not blocked until the initial navigation is\n- * complete.\n- * * 'legacy_disabled'- The initial navigation is not performed. The location listener is set up\n- * after the root component gets created.\n- * * `true` - same as 'legacy_enabled'.\n- * * `false` - same as 'legacy_disabled'.\n- *\n- * The 'legacy_enabled' and 'legacy_disabled' should not be used for new applications.\n+ * * 'enabled' - This option is 1:1 replaceable with `enabledNonBlocking`.\n  *\n  * @see `forRoot()`\n  *\n  * @publicApi\n  */\n-export type InitialNavigation = true|false|'enabled'|'disabled'|'legacy_enabled'|'legacy_disabled';\n+export type InitialNavigation = 'disabled'|'enabled'|'enabledBlocking'|'enabledNonBlocking';\n \n /**\n  * A set of configuration options for a router module, provided in the\n@@ -272,24 +267,15 @@ export interface ExtraOptions {\n   useHash?: boolean;\n \n   /**\n-   * One of `enabled` or `disabled`.\n-   * When set to `enabled`, the initial navigation starts before the root component is created.\n-   * The bootstrap is blocked until the initial navigation is complete. This value is required for\n-   * [server-side rendering](guide/universal) to work.\n-   * When set to `disabled`, the initial navigation is not performed.\n-   * The location listener is set up before the root component gets created.\n-   * Use if there is a reason to have more control over when the router\n+   * One of `enabled`, `enabledBlocking`, `enabledNonBlocking` or `disabled`.\n+   * When set to `enabled` or `enabledBlocking`, the initial navigation starts before the root\n+   * component is created. The bootstrap is blocked until the initial navigation is complete. This\n+   * value is required for [server-side rendering](guide/universal) to work. When set to\n+   * `enabledNonBlocking`, the initial navigation starts after the root component has been created.\n+   * The bootstrap is not blocked on the completion of the initial navigation. When set to\n+   * `disabled`, the initial navigation is not performed. The location listener is set up before the\n+   * root component gets created. Use if there is a reason to have more control over when the router\n    * starts its initial navigation due to some complex initialization logic.\n-   *\n-   * Legacy values are deprecated since v4 and should not be used for new applications:\n-   *\n-   * * `legacy_enabled` - Default for compatibility.\n-   * The initial navigation starts after the root component has been created,\n-   * but the bootstrap is not blocked until the initial navigation is complete.\n-   * * `legacy_disabled` - The initial navigation is not performed.\n-   * The location listener is set up after the root component gets created.\n-   * * `true` - same as `legacy_enabled`.\n-   * * `false` - same as `legacy_disabled`.\n    */\n   initialNavigation?: InitialNavigation;\n \n@@ -519,14 +505,12 @@ export class RouterInitializer {\n       const router = this.injector.get(Router);\n       const opts = this.injector.get(ROUTER_CONFIGURATION);\n \n-      if (this.isLegacyDisabled(opts) || this.isLegacyEnabled(opts)) {\n-        resolve(true);\n-\n-      } else if (opts.initialNavigation === 'disabled') {\n+      if (opts.initialNavigation === 'disabled') {\n         router.setUpLocationChangeListener();\n         resolve(true);\n-\n-      } else if (opts.initialNavigation === 'enabled') {\n+      } else if (\n+          // TODO: enabled is deprecated as of v11, can be removed in v13\n+          opts.initialNavigation === 'enabled' || opts.initialNavigation === 'enabledBlocking') {\n         router.hooks.afterPreactivation = () => {\n           // only the initial navigation should be delayed\n           if (!this.initNavigation) {\n@@ -540,9 +524,8 @@ export class RouterInitializer {\n           }\n         };\n         router.initialNavigation();\n-\n       } else {\n-        throw new Error(`Invalid initialNavigation options: '${opts.initialNavigation}'`);\n+        resolve(true);\n       }\n \n       return res;\n@@ -560,10 +543,9 @@ export class RouterInitializer {\n       return;\n     }\n \n-    if (this.isLegacyEnabled(opts)) {\n+    // Default case\n+    if (opts.initialNavigation === 'enabledNonBlocking' || opts.initialNavigation === undefined) {\n       router.initialNavigation();\n-    } else if (this.isLegacyDisabled(opts)) {\n-      router.setUpLocationChangeListener();\n     }\n \n     preloader.setUpPreloading();\n@@ -572,15 +554,6 @@ export class RouterInitializer {\n     this.resultOfPreactivationDone.next(null!);\n     this.resultOfPreactivationDone.complete();\n   }\n-\n-  private isLegacyEnabled(opts: ExtraOptions): boolean {\n-    return opts.initialNavigation === 'legacy_enabled' || opts.initialNavigation === true ||\n-        opts.initialNavigation === undefined;\n-  }\n-\n-  private isLegacyDisabled(opts: ExtraOptions): boolean {\n-    return opts.initialNavigation === 'legacy_disabled' || opts.initialNavigation === false;\n-  }\n }\n \n export function getAppInitializer(r: RouterInitializer) {"
        },
        {
            "sha": "f3ee2c51df20a81bc35a4c8c675264382c73f9b0",
            "filename": "packages/router/test/bootstrap.spec.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 15,
            "changes": 77,
            "blob_url": "https://github.com/angular/angular/blob/c4becca0e4238640461c43567a6d3e16b8c5d3f3/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c4becca0e4238640461c43567a6d3e16b8c5d3f3/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts?ref=c4becca0e4238640461c43567a6d3e16b8c5d3f3",
            "patch": "@@ -95,7 +95,44 @@ describe('bootstrap', () => {\n     });\n   });\n \n-  it('should NOT wait for resolvers to complete when initialNavigation = legacy_enabled',\n+  it('should wait for resolvers to complete when initialNavigation = enabledBlocking', (done) => {\n+    @Component({selector: 'test', template: 'test'})\n+    class TestCmpEnabled {\n+    }\n+\n+    @NgModule({\n+      imports: [\n+        BrowserModule,\n+        RouterModule.forRoot(\n+            [{path: '**', component: TestCmpEnabled, resolve: {test: TestResolver}}],\n+            {useHash: true, initialNavigation: 'enabledBlocking'})\n+      ],\n+      declarations: [RootCmp, TestCmpEnabled],\n+      bootstrap: [RootCmp],\n+      providers: [...testProviders, TestResolver],\n+      schemas: [CUSTOM_ELEMENTS_SCHEMA]\n+    })\n+    class TestModule {\n+      constructor(router: Router) {\n+        log.push('TestModule');\n+        router.events.subscribe(e => log.push(e.constructor.name));\n+      }\n+    }\n+\n+    platformBrowserDynamic([]).bootstrapModule(TestModule).then(res => {\n+      const router = res.injector.get(Router);\n+      const data = router.routerState.snapshot.root.firstChild!.data;\n+      expect(data['test']).toEqual('test-data');\n+      expect(log).toEqual([\n+        'TestModule', 'NavigationStart', 'RoutesRecognized', 'GuardsCheckStart',\n+        'ChildActivationStart', 'ActivationStart', 'GuardsCheckEnd', 'ResolveStart', 'ResolveEnd',\n+        'RootCmp', 'ActivationEnd', 'ChildActivationEnd', 'NavigationEnd', 'Scroll'\n+      ]);\n+      done();\n+    });\n+  });\n+\n+  it('should NOT wait for resolvers to complete when initialNavigation = enabledNonBlocking',\n      (done) => {\n        @Component({selector: 'test', template: 'test'})\n        class TestCmpLegacyEnabled {\n@@ -106,7 +143,7 @@ describe('bootstrap', () => {\n            BrowserModule,\n            RouterModule.forRoot(\n                [{path: '**', component: TestCmpLegacyEnabled, resolve: {test: TestResolver}}],\n-               {useHash: true, initialNavigation: 'legacy_enabled'})\n+               {useHash: true, initialNavigation: 'enabledNonBlocking'})\n          ],\n          declarations: [RootCmp, TestCmpLegacyEnabled],\n          bootstrap: [RootCmp],\n@@ -137,19 +174,19 @@ describe('bootstrap', () => {\n        });\n      });\n \n-  it('should not run navigation when initialNavigation = disabled', (done) => {\n+  it('should NOT wait for resolvers to complete when initialNavigation is not set', (done) => {\n     @Component({selector: 'test', template: 'test'})\n-    class TestCmpDiabled {\n+    class TestCmpLegacyEnabled {\n     }\n \n     @NgModule({\n       imports: [\n         BrowserModule,\n         RouterModule.forRoot(\n-            [{path: '**', component: TestCmpDiabled, resolve: {test: TestResolver}}],\n-            {useHash: true, initialNavigation: 'disabled'})\n+            [{path: '**', component: TestCmpLegacyEnabled, resolve: {test: TestResolver}}],\n+            {useHash: true})\n       ],\n-      declarations: [RootCmp, TestCmpDiabled],\n+      declarations: [RootCmp, TestCmpLegacyEnabled],\n       bootstrap: [RootCmp],\n       providers: [...testProviders, TestResolver],\n       schemas: [CUSTOM_ELEMENTS_SCHEMA]\n@@ -162,25 +199,35 @@ describe('bootstrap', () => {\n     }\n \n     platformBrowserDynamic([]).bootstrapModule(TestModule).then(res => {\n-      const router = res.injector.get(Router);\n-      expect(log).toEqual(['TestModule', 'RootCmp']);\n-      done();\n+      const router: Router = res.injector.get(Router);\n+      expect(router.routerState.snapshot.root.firstChild).toBeNull();\n+      // ResolveEnd has not been emitted yet because bootstrap returned too early\n+      expect(log).toEqual([\n+        'TestModule', 'RootCmp', 'NavigationStart', 'RoutesRecognized', 'GuardsCheckStart',\n+        'ChildActivationStart', 'ActivationStart', 'GuardsCheckEnd', 'ResolveStart'\n+      ]);\n+\n+      router.events.subscribe((e) => {\n+        if (e instanceof NavigationEnd) {\n+          done();\n+        }\n+      });\n     });\n   });\n \n-  it('should not run navigation when initialNavigation = legacy_disabled', (done) => {\n+  it('should not run navigation when initialNavigation = disabled', (done) => {\n     @Component({selector: 'test', template: 'test'})\n-    class TestCmpLegacyDisabled {\n+    class TestCmpDiabled {\n     }\n \n     @NgModule({\n       imports: [\n         BrowserModule,\n         RouterModule.forRoot(\n-            [{path: '**', component: TestCmpLegacyDisabled, resolve: {test: TestResolver}}],\n-            {useHash: true, initialNavigation: 'legacy_disabled'})\n+            [{path: '**', component: TestCmpDiabled, resolve: {test: TestResolver}}],\n+            {useHash: true, initialNavigation: 'disabled'})\n       ],\n-      declarations: [RootCmp, TestCmpLegacyDisabled],\n+      declarations: [RootCmp, TestCmpDiabled],\n       bootstrap: [RootCmp],\n       providers: [...testProviders, TestResolver],\n       schemas: [CUSTOM_ELEMENTS_SCHEMA]"
        }
    ],
    "stats": {
        "total": 152,
        "additions": 86,
        "deletions": 66
    }
}