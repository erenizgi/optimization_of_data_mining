{
    "author": "gkalpak",
    "message": "fix(service-worker): avoid storing redundant metadata for hashed assets (#42606)\n\nThe ServiceWorker needs to keep track of some metadata for unhashed\nasset resources to know if/when they might need to be revalidated. This\napplies to resources that do not exist on the filesystem at build-time\n(and thus cannot be hashed), such as fonts or images loaded from\nexternal sources. For hashed resources, this metadata is irrelevant,\nbecause the hash is enough to verify that the content hasn't changed and\nno revalidation is necessary.\n\nPreviously, the ServiceWorker would store such metadata for hashed\nresources as well, even though it would never be used (thus taking up\nspace unnecessarily).\n\nThis commit fixes it by not storing metadata for hashed resources, i.e.\nthose that are included in an asset-group's `hashes` array.\n\nPR Close #42606",
    "sha": "f592a120057c3787ad6b7385b6f8e10928627e9e",
    "files": [
        {
            "sha": "b6650ff0e6bad0c11d685506192b1eb1da8188e4",
            "filename": "packages/service-worker/worker/src/assets.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/f592a120057c3787ad6b7385b6f8e10928627e9e/packages%2Fservice-worker%2Fworker%2Fsrc%2Fassets.ts",
            "raw_url": "https://github.com/angular/angular/raw/f592a120057c3787ad6b7385b6f8e10928627e9e/packages%2Fservice-worker%2Fworker%2Fsrc%2Fassets.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fassets.ts?ref=f592a120057c3787ad6b7385b6f8e10928627e9e",
            "patch": "@@ -454,7 +454,6 @@ export abstract class AssetGroup {\n   protected async maybeUpdate(updateFrom: UpdateSource, req: Request, cache: Cache):\n       Promise<boolean> {\n     const url = this.adapter.normalizeUrl(req.url);\n-    const meta = await this.metadata;\n     // Check if this resource is hashed and already exists in the cache of a prior version.\n     if (this.hashes.has(url)) {\n       const hash = this.hashes.get(url)!;\n@@ -467,7 +466,6 @@ export abstract class AssetGroup {\n       if (res !== null) {\n         // Copy to this cache.\n         await cache.put(req, res);\n-        await meta.write(req.url, {ts: this.adapter.time, used: false} as UrlMetadata);\n \n         // No need to do anything further with this resource, it's now cached properly.\n         return true;"
        }
    ],
    "stats": {
        "total": 2,
        "additions": 0,
        "deletions": 2
    }
}