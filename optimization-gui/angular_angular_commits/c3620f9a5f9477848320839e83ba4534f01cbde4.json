{
    "author": "gkalpak",
    "message": "fix(dev-infra): convert commit SHAs and PR numbers to links when generating changelog (#42732)\n\nPreviously, the commit SHAs and PR numbers referenced in the generated\n`CHANGELOG.md` were not automatically converted to links in the GitHub\nUI (as happens for release notes and issue/PR comments). This made it\nless straight-forward for someone reading the changelog to get to the\ncommit/PR corresponding to a change.\n\nThis commit updates the tooling that generates the changelog to convert\nthe commit SHA and the corresponding PR number (referenced at the end of\nthe commit message header) to links.\n\nPR Close #42732",
    "sha": "c3620f9a5f9477848320839e83ba4534f01cbde4",
    "files": [
        {
            "sha": "4dcd9b108296d7900a079ad183259b4035bbea12",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=c3620f9a5f9477848320839e83ba4534f01cbde4",
            "patch": "@@ -5462,6 +5462,27 @@ class RenderContext {\n             return include;\n         };\n     }\n+    /**\n+     * Convert a commit object to a Markdown link.\n+     */\n+    commitToLink(commit) {\n+        const url = `https://github.com/${this.data.github.owner}/${this.data.github.name}/commit/${commit.hash}`;\n+        return `[${commit.shortHash}](${url})`;\n+    }\n+    /**\n+     * Convert a pull request number to a Markdown link.\n+     */\n+    pullRequestToLink(prNumber) {\n+        const url = `https://github.com/${this.data.github.owner}/${this.data.github.name}/pull/${prNumber}`;\n+        return `[#${prNumber}](${url})`;\n+    }\n+    /**\n+     * Transform a commit message header by replacing the parenthesized pull request reference at the\n+     * end of the line (which is added by merge tooling) to a Markdown link.\n+     */\n+    replaceCommitHeaderPullRequestNumber(header) {\n+        return header.replace(/\\(#(\\d+)\\)$/, (_, g) => `(${this.pullRequestToLink(+g)})`);\n+    }\n }\n /**\n  * Builds a date stamp for stamping in release notes.\n@@ -5497,7 +5518,7 @@ _%>\n <%_\n   for (const commit of group.commits) {\n _%>\n-| <%- commit.shortHash %> | <%- commit.header %> |\n+| <%- commitToLink(commit) %> | <%- replaceCommitHeaderPullRequestNumber(commit.header) %> |\n <%_\n   }\n }"
        },
        {
            "sha": "5f6e5217abfbe2fb496c38c07ebcbc2b08e9648a",
            "filename": "dev-infra/release/notes/cli.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Fcli.ts?ref=c3620f9a5f9477848320839e83ba4534f01cbde4",
            "patch": "@@ -11,7 +11,7 @@ import {join} from 'path';\n import {SemVer} from 'semver';\n import {Arguments, Argv, CommandModule} from 'yargs';\n \n-import {debug, info} from '../../utils/console';\n+import {info} from '../../utils/console';\n import {GitClient} from '../../utils/git/git-client';\n \n import {ReleaseNotes} from './release-notes';"
        },
        {
            "sha": "c1c4093904cfb346a9b40ea418920956351e01a9",
            "filename": "dev-infra/release/notes/context.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Fcontext.ts?ref=c3620f9a5f9477848320839e83ba4534f01cbde4",
            "patch": "@@ -135,6 +135,32 @@ export class RenderContext {\n       return include;\n     };\n   }\n+\n+  /**\n+   * Convert a commit object to a Markdown link.\n+   */\n+  commitToLink(commit: CommitFromGitLog): string {\n+    const url = `https://github.com/${this.data.github.owner}/${this.data.github.name}/commit/${\n+        commit.hash}`;\n+    return `[${commit.shortHash}](${url})`;\n+  }\n+\n+  /**\n+   * Convert a pull request number to a Markdown link.\n+   */\n+  pullRequestToLink(prNumber: number): string {\n+    const url =\n+        `https://github.com/${this.data.github.owner}/${this.data.github.name}/pull/${prNumber}`;\n+    return `[#${prNumber}](${url})`;\n+  }\n+\n+  /**\n+   * Transform a commit message header by replacing the parenthesized pull request reference at the\n+   * end of the line (which is added by merge tooling) to a Markdown link.\n+   */\n+  replaceCommitHeaderPullRequestNumber(header: string): string {\n+    return header.replace(/\\(#(\\d+)\\)$/, (_, g) => `(${this.pullRequestToLink(+g)})`);\n+  }\n }\n \n "
        },
        {
            "sha": "462c3ac331fc07a1f637c5cc190126fecbc80181",
            "filename": "dev-infra/release/notes/templates/changelog.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts",
            "raw_url": "https://github.com/angular/angular/raw/c3620f9a5f9477848320839e83ba4534f01cbde4/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fnotes%2Ftemplates%2Fchangelog.ts?ref=c3620f9a5f9477848320839e83ba4534f01cbde4",
            "patch": "@@ -21,7 +21,7 @@ _%>\n <%_\n   for (const commit of group.commits) {\n _%>\n-| <%- commit.shortHash %> | <%- commit.header %> |\n+| <%- commitToLink(commit) %> | <%- replaceCommitHeaderPullRequestNumber(commit.header) %> |\n <%_\n   }\n }"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 50,
        "deletions": 3
    }
}