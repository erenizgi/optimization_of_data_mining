{
    "author": "JoostK",
    "message": "test(compiler-cli): workaround for performance cliff in TypeScript (#39707)\n\nThe type checker had to do extensive work in resolving the\n`NodePath.get` method call for the `NodePath` that had an intersection\ntype of `ts.VariableDeclarator&{init:t.Expression}`. The `NodePath.get`\nmethod is typed using a conditional type which became expensive to\ncompute with this intersection type. As a workaround, the original\n`init` property is explicitly omitted which avoids the performance\ncliff. This brings down the compile time by 15s.\n\nPR Close #39707",
    "sha": "8348556b776d1457bb520d63f6b0b8ca0d3f2f6c",
    "files": [
        {
            "sha": "ee0ebb89d9c996a3537dca2f6a1d555439eac77f",
            "filename": "packages/compiler-cli/linker/babel/test/babel_declaration_scope_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/8348556b776d1457bb520d63f6b0b8ca0d3f2f6c/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_declaration_scope_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8348556b776d1457bb520d63f6b0b8ca0d3f2f6c/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_declaration_scope_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_declaration_scope_spec.ts?ref=8348556b776d1457bb520d63f6b0b8ca0d3f2f6c",
            "patch": "@@ -10,7 +10,6 @@ import traverse, {NodePath} from '@babel/traverse';\n import * as t from '@babel/types';\n import {BabelDeclarationScope} from '../src/babel_declaration_scope';\n \n-\n describe('BabelDeclarationScope', () => {\n   describe('getConstantScopeRef()', () => {\n     it('should return a path to the ES module where the expression was imported', () => {\n@@ -83,11 +82,19 @@ describe('BabelDeclarationScope', () => {\n   });\n });\n \n+/**\n+ * The type of a variable declarator that is known to have an initializer.\n+ *\n+ * Note: the `init` property is explicitly omitted to workaround a performance cliff in the\n+ * TypeScript type checker.\n+ */\n+type InitializedVariableDeclarator = Omit<t.VariableDeclarator, 'init'>&{init: t.Expression};\n+\n function findVarDeclaration(\n-    file: t.File, varName: string): NodePath<t.VariableDeclarator&{init: t.Expression}> {\n+    file: t.File, varName: string): NodePath<InitializedVariableDeclarator> {\n   let varDecl: NodePath<t.VariableDeclarator>|undefined = undefined;\n   traverse(file, {\n-    VariableDeclarator: (path) => {\n+    VariableDeclarator: (path: NodePath<t.VariableDeclarator>) => {\n       const id = path.get('id');\n       if (id.isIdentifier() && id.node.name === varName && path.get('init') !== null) {\n         varDecl = path;"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 10,
        "deletions": 3
    }
}