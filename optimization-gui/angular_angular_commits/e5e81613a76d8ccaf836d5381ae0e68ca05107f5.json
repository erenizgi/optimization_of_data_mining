{
    "author": "dylhunn",
    "message": "Revert \"refactor(forms): Temporarily disable the typed forms migration. (#44828) (#44834)\n\nThis reverts commit 894fa759f1eba6de1960b08d511ce4332a423ae5. In that commit, the migration was completely diabled in order to prevent users from selecting it for the 13.2 release. This revert commit restores the migration to its previous (fully optional) state, in order to continue migration-focused work.\n\nPR Close #44834",
    "sha": "e5e81613a76d8ccaf836d5381ae0e68ca05107f5",
    "files": [
        {
            "sha": "4bf74de3fb8d0573fd9adb2661eb49a30112b331",
            "filename": "packages/core/schematics/migrations.json",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/e5e81613a76d8ccaf836d5381ae0e68ca05107f5/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "raw_url": "https://github.com/angular/angular/raw/e5e81613a76d8ccaf836d5381ae0e68ca05107f5/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations.json?ref=e5e81613a76d8ccaf836d5381ae0e68ca05107f5",
            "patch": "@@ -19,6 +19,11 @@\n       \"version\": \"14.0.0-beta\",\n       \"description\": \"As of Angular version 13, `entryComponents` are no longer necessary.\",\n       \"factory\": \"./migrations/entry-components/index\"\n+    },\n+    \"migration-v14-typed-forms\": {\n+      \"version\": \"9999.0.0\",\n+      \"description\": \"Experimental migration that adds <any>s for Typed Forms.\",\n+      \"factory\": \"./migrations/typed-forms/index\"\n     }\n   }\n }"
        },
        {
            "sha": "1d833dcd739cabf10902f4c8feb2cdc1856e7047",
            "filename": "packages/core/schematics/test/typed_forms_spec.ts",
            "status": "modified",
            "additions": 188,
            "deletions": 194,
            "changes": 382,
            "blob_url": "https://github.com/angular/angular/blob/e5e81613a76d8ccaf836d5381ae0e68ca05107f5/packages%2Fcore%2Fschematics%2Ftest%2Ftyped_forms_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e5e81613a76d8ccaf836d5381ae0e68ca05107f5/packages%2Fcore%2Fschematics%2Ftest%2Ftyped_forms_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Ftyped_forms_spec.ts?ref=e5e81613a76d8ccaf836d5381ae0e68ca05107f5",
            "patch": "@@ -80,214 +80,208 @@ describe('Typed Forms migration', () => {\n     shx.rm('-r', tmpDirPath);\n   });\n \n-  // These tests are disabled because the migration is removed from migration.json, and cannot be\n-  // run.\n+  describe(`should add ${anySymbolName} to constructors`, () => {\n+    it('for FormControl', async () => {\n+      writeFile('/index.ts', `\n+           import { FormControl } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fc1 = new FormControl();\n+             new FormControl(42);\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fc1 = new FormControl<${anySymbolName}>();`);\n+      expect(tree.readContent('/index.ts')).toContain(`new FormControl<${anySymbolName}>(42);`);\n+    });\n \n-  // describe(`should add ${anySymbolName} to constructors`, () => {\n-  //   it('for FormControl', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormControl } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fc1 = new FormControl();\n-  //            new FormControl(42);\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fc1 = new FormControl<${anySymbolName}>();`);\n-  //     expect(tree.readContent('/index.ts')).toContain(`new FormControl<${anySymbolName}>(42);`);\n-  //   });\n+    it('for FormGroup', async () => {\n+      writeFile('/index.ts', `\n+           import { FormGroup } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fg = new FormGroup({foo: 3});\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fg = new FormGroup<${anySymbolName}>({foo: 3});`);\n+    });\n \n-  //   it('for FormGroup', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormGroup } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fg = new FormGroup({foo: 3});\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fg = new FormGroup<${anySymbolName}>({foo: 3});`);\n-  //   });\n+    it('for FormArray', async () => {\n+      writeFile('/index.ts', `\n+           import { FormArray } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fa = new FormArray([null]);\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fa = new FormArray<${anySymbolName}[]>([null]);`);\n+    });\n \n-  //   it('for FormArray', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormArray } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fa = new FormArray([null]);\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fa = new FormArray<${anySymbolName}[]>([null]);`);\n-  //   });\n+    it('for FormControl with a qualified import', async () => {\n+      writeFile('/index.ts', `\n+           import { FormControl as FC } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fc = new FC({foo: 3});\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fc = new FC<${anySymbolName}>({foo: 3});`);\n+    });\n \n-  //   it('for FormControl with a qualified import', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormControl as FC } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fc = new FC({foo: 3});\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fc = new FC<${anySymbolName}>({foo: 3});`);\n-  //   });\n+    it('for FormArray with a qualified import', async () => {\n+      writeFile('/index.ts', `\n+           import { FormArray as FA } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fa = new FA([null]);\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fa = new FA<${anySymbolName}[]>([null]);`);\n+    });\n \n-  //   it('for FormArray with a qualified import', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormArray as FA } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fa = new FA([null]);\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fa = new FA<${anySymbolName}[]>([null]);`);\n-  //   });\n-\n-  //   it('but not for controls that already have type arguments', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormControl } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            const fc1 = new FormControl<${anySymbolName}>();\n-  //            constructor() {}\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fc1 = new FormControl<${anySymbolName}>();`);\n-  //   });\n-  // });\n+    it('but not for controls that already have type arguments', async () => {\n+      writeFile('/index.ts', `\n+           import { FormControl } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             const fc1 = new FormControl<${anySymbolName}>();\n+             constructor() {}\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fc1 = new FormControl<${anySymbolName}>();`);\n+    });\n+  });\n \n-  // describe(`should add ${anySymbolName} to FormBuilder method`, () => {\n-  //   it('control', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormBuilder } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            constructor() {\n-  //              const fb = new FormBuilder();\n-  //              const fc = fb.control(43);\n-  //              const fd = new FormBuilder().control(42);\n-  //            }\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts')).toContain(`.control<${anySymbolName}>(43);`);\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fd = new FormBuilder().control<${anySymbolName}>(42)`);\n-  //   });\n+  describe(`should add ${anySymbolName} to FormBuilder method`, () => {\n+    it('control', async () => {\n+      writeFile('/index.ts', `\n+           import { FormBuilder } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             constructor() {\n+               const fb = new FormBuilder();\n+               const fc = fb.control(43);\n+               const fd = new FormBuilder().control(42);\n+             }\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts')).toContain(`.control<${anySymbolName}>(43);`);\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fd = new FormBuilder().control<${anySymbolName}>(42)`);\n+    });\n \n-  //   it('group', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormBuilder } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            constructor() {\n-  //              const fb = new FormBuilder();\n-  //              const fc = fb.group({});\n-  //              const fd = new FormBuilder().group({});\n-  //            }\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts')).toContain(`fb.group<${anySymbolName}>({});`);\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fd = new FormBuilder().group<${anySymbolName}>({})`);\n-  //   });\n+    it('group', async () => {\n+      writeFile('/index.ts', `\n+           import { FormBuilder } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             constructor() {\n+               const fb = new FormBuilder();\n+               const fc = fb.group({});\n+               const fd = new FormBuilder().group({});\n+             }\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts')).toContain(`fb.group<${anySymbolName}>({});`);\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fd = new FormBuilder().group<${anySymbolName}>({})`);\n+    });\n \n-  //   it('array', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { FormBuilder } from '@angular/forms';\n-  //          @Component({template: ''})\n-  //          export class MyComp {\n-  //            constructor() {\n-  //              const fb = new FormBuilder();\n-  //              const fc = fb.array([0]);\n-  //              const fd = new FormBuilder().array([0]);\n-  //            }\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts')).toContain(`fb.array<${anySymbolName}[]>([0]);`);\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`const fd = new FormBuilder().array<${anySymbolName}[]>([0])`);\n-  //   });\n-  // });\n+    it('array', async () => {\n+      writeFile('/index.ts', `\n+           import { FormBuilder } from '@angular/forms';\n+           @Component({template: ''})\n+           export class MyComp {\n+             constructor() {\n+               const fb = new FormBuilder();\n+               const fc = fb.array([0]);\n+               const fd = new FormBuilder().array([0]);\n+             }\n+           }\n+         `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts')).toContain(`fb.array<${anySymbolName}[]>([0]);`);\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`const fd = new FormBuilder().array<${anySymbolName}[]>([0])`);\n+    });\n+  });\n \n-  // describe('should add import', () => {\n-  //   it('any when not already imported', async () => {\n-  //     writeFile('/index.ts', `\n-  //       import { FormBuilder } from '@angular/forms';\n-  //       @Component({template: ''})\n-  //       export class MyComp { }\n-  //     `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`import { ${anySymbolName}, FormBuilder } from '@angular/forms';`);\n-  //   });\n+  describe('should add import', () => {\n+    it('any when not already imported', async () => {\n+      writeFile('/index.ts', `\n+        import { FormBuilder } from '@angular/forms';\n+        @Component({template: ''})\n+        export class MyComp { }\n+      `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`import { ${anySymbolName}, FormBuilder } from '@angular/forms';`);\n+    });\n \n-  //   it('exclusively when not already imported', async () => {\n-  //     writeFile('/index.ts', `\n-  //       import { ${anySymbolName}, FormBuilder } from '@angular/forms';\n-  //       @Component({template: ''})\n-  //       export class MyComp { }\n-  //     `);\n-  //     await runMigration();\n-  //     expect(tree.readContent('/index.ts'))\n-  //         .toContain(`import { ${anySymbolName}, FormBuilder } from '@angular/forms';`);\n-  //   });\n-  // });\n+    it('exclusively when not already imported', async () => {\n+      writeFile('/index.ts', `\n+        import { ${anySymbolName}, FormBuilder } from '@angular/forms';\n+        @Component({template: ''})\n+        export class MyComp { }\n+      `);\n+      await runMigration();\n+      expect(tree.readContent('/index.ts'))\n+          .toContain(`import { ${anySymbolName}, FormBuilder } from '@angular/forms';`);\n+    });\n+  });\n \n-  // describe('should handle', () => {\n-  //   it('an integrated example', async () => {\n-  //     writeFile('/index.ts', `\n-  //          import { Component } from '@angular/core';\n-  //          import { AbstractControl, FormArray, FormBuilder, FormControl as FC, FormGroup } from\n-  //          '@angular/forms';\n+  describe('should handle', () => {\n+    it('an integrated example', async () => {\n+      writeFile('/index.ts', `\n+           import { Component } from '@angular/core';\n+           import { AbstractControl, FormArray, FormBuilder, FormControl as FC, FormGroup } from '@angular/forms';\n \n-  //          @Component({template: ''})\n-  //          export class MyComponent {\n-  //            private _control = new FC(42);\n-  //            private _group = new FormGroup({});\n-  //            private _array = new FormArray([]);\n+           @Component({template: ''})\n+           export class MyComponent {\n+             private _control = new FC(42);\n+             private _group = new FormGroup({});\n+             private _array = new FormArray([]);\n \n-  //            private fb = new FormBuilder();\n+             private fb = new FormBuilder();\n \n-  //            build() {\n-  //              const c = this.fb.control(42);\n-  //              const g = this.fb.group({one: this.fb.control('')});\n-  //              const a = this.fb.array([42]);\n-  //              const fc2 = new FC(0);\n-  //            }\n-  //          }\n-  //        `);\n-  //     await runMigration();\n-  //     [`import { ${\n-  //          anySymbolName}, AbstractControl, FormArray, FormBuilder, FormControl as FC, FormGroup\n-  //          } from '@angular/forms';`,\n-  //      `private _control = new FC<${anySymbolName}>(42)`,\n-  //      `private _group = new FormGroup<${anySymbolName}>({})`,\n-  //      `private _array = new FormArray<${anySymbolName}[]>([])`,\n-  //      `const fc2 = new FC<${anySymbolName}>(0)`, `const c =\n-  //      this.fb.control<${anySymbolName}>(42)`, `const g = this.fb.group<${anySymbolName}>({one:\n-  //      this.fb.control<${anySymbolName}>('')})`, `const a =\n-  //      this.fb.array<${anySymbolName}[]>([42])`]\n-  //         .forEach(t => expect(tree.readContent('/index.ts')).toContain(t));\n-  //   });\n-  // });\n+             build() {\n+               const c = this.fb.control(42);\n+               const g = this.fb.group({one: this.fb.control('')});\n+               const a = this.fb.array([42]);\n+               const fc2 = new FC(0);\n+             }\n+           }\n+         `);\n+      await runMigration();\n+      [`import { ${\n+           anySymbolName}, AbstractControl, FormArray, FormBuilder, FormControl as FC, FormGroup } from '@angular/forms';`,\n+       `private _control = new FC<${anySymbolName}>(42)`,\n+       `private _group = new FormGroup<${anySymbolName}>({})`,\n+       `private _array = new FormArray<${anySymbolName}[]>([])`,\n+       `const fc2 = new FC<${anySymbolName}>(0)`, `const c = this.fb.control<${anySymbolName}>(42)`,\n+       `const g = this.fb.group<${anySymbolName}>({one: this.fb.control<${anySymbolName}>('')})`,\n+       `const a = this.fb.array<${anySymbolName}[]>([42])`]\n+          .forEach(t => expect(tree.readContent('/index.ts')).toContain(t));\n+    });\n+  });\n \n   function writeFile(filePath: string, contents: string) {\n     host.sync.write(normalize(filePath), virtualFs.stringToFileBuffer(contents));"
        }
    ],
    "stats": {
        "total": 387,
        "additions": 193,
        "deletions": 194
    }
}