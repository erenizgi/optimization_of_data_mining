{
    "author": "mhevery",
    "message": "fix(core): `QueryList` should not fire changes if the underlying list did not change. (#40091)\n\nPrevious implementation would fire changes `QueryList.changes.subscribe`\nwhenever the `QueryList` was recomputed. This resulted in artificially\nhigh number of change notifications, as it is possible that recomputing\n`QueryList` results in the same list. When the `QueryList` gets recomputed\nis an implementation detail and it should not be the thing which determines\nhow often change event should fire.\n\nThis change introduces a new `emitDistinctChangesOnly` option for\n`ContentChildren` and `ViewChildren`.\n\n```\nexport class QueryCompWithStrictChangeEmitParent {\n  @ContentChildren('foo', {\n    // This option will become the default in the future\n    emitDistinctChangesOnly: true,\n  })\n  foos!: QueryList<any>;\n}\n```\n\nPR Close #40091",
    "sha": "e32b6256ce7cc28a774180c42a88535bf3e468bf",
    "files": [
        {
            "sha": "41aab0aeca2df3bc5c5f8096adb5e7c325355d53",
            "filename": "goldens/public-api/core/core.d.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcore%2Fcore.d.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -174,10 +174,12 @@ export declare type ContentChildren = Query;\n export declare interface ContentChildrenDecorator {\n     (selector: Type<any> | InjectionToken<unknown> | Function | string, opts?: {\n         descendants?: boolean;\n+        emitDistinctChangesOnly?: boolean;\n         read?: any;\n     }): any;\n     new (selector: Type<any> | InjectionToken<unknown> | Function | string, opts?: {\n         descendants?: boolean;\n+        emitDistinctChangesOnly?: boolean;\n         read?: any;\n     }): Query;\n }\n@@ -734,6 +736,7 @@ export declare type Provider = TypeProvider | ValueProvider | ClassProvider | Co\n \n export declare interface Query {\n     descendants: boolean;\n+    emitDistinctChangesOnly: boolean;\n     first: boolean;\n     isViewQuery: boolean;\n     read: any;\n@@ -746,12 +749,12 @@ export declare abstract class Query {\n \n export declare class QueryList<T> implements Iterable<T> {\n     [Symbol.iterator]: () => Iterator<T>;\n-    readonly changes: Observable<any>;\n+    get changes(): Observable<any>;\n     readonly dirty = true;\n     readonly first: T;\n     readonly last: T;\n     readonly length: number;\n-    constructor();\n+    constructor(_emitDistinctChangesOnly?: boolean);\n     destroy(): void;\n     filter(fn: (item: T, index: number, array: T[]) => boolean): T[];\n     find(fn: (item: T, index: number, array: T[]) => boolean): T | undefined;\n@@ -760,7 +763,7 @@ export declare class QueryList<T> implements Iterable<T> {\n     map<U>(fn: (item: T, index: number, array: T[]) => U): U[];\n     notifyOnChanges(): void;\n     reduce<U>(fn: (prevValue: U, curValue: T, curIndex: number, array: T[]) => U, init: U): U;\n-    reset(resultsTree: Array<T | any[]>): void;\n+    reset(resultsTree: Array<T | any[]>, identityAccessor?: (value: T) => unknown): void;\n     setDirty(): void;\n     some(fn: (value: T, index: number, array: T[]) => boolean): boolean;\n     toArray(): T[];\n@@ -1010,9 +1013,11 @@ export declare type ViewChildren = Query;\n export declare interface ViewChildrenDecorator {\n     (selector: Type<any> | InjectionToken<unknown> | Function | string, opts?: {\n         read?: any;\n+        emitDistinctChangesOnly?: boolean;\n     }): any;\n     new (selector: Type<any> | InjectionToken<unknown> | Function | string, opts?: {\n         read?: any;\n+        emitDistinctChangesOnly?: boolean;\n     }): ViewChildren;\n }\n "
        },
        {
            "sha": "369ce99aced302491d3804c4de3642d159e8694d",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -12,7 +12,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3033,\n-        \"main-es2015\": 447349,\n+        \"main-es2015\": 448090,\n         \"polyfills-es2015\": 52493\n       }\n     }\n@@ -21,7 +21,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3153,\n-        \"main-es2015\": 431137,\n+        \"main-es2015\": 432078,\n         \"polyfills-es2015\": 52493\n       }\n     }"
        },
        {
            "sha": "e1d22c89e11bae6641d8a378c7e01cb63885779f",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -39,7 +39,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 2285,\n-        \"main-es2015\": 240909,\n+        \"main-es2015\": 241738,\n         \"polyfills-es2015\": 36709,\n         \"5-es2015\": 745\n       }"
        },
        {
            "sha": "e11c5e79c519ad3e108b166d4b031daabd73837a",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_directive_linker_1.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -147,6 +147,8 @@ function toQueryMetadata<TExpression>(obj: AstObject<R3DeclareQueryMetadata, TEx\n     first: obj.has('first') ? obj.getBoolean('first') : false,\n     predicate,\n     descendants: obj.has('descendants') ? obj.getBoolean('descendants') : false,\n+    emitDistinctChangesOnly:\n+        obj.has('emitDistinctChangesOnly') ? obj.getBoolean('emitDistinctChangesOnly') : true,\n     read: obj.has('read') ? obj.getOpaque('read') : null,\n     static: obj.has('static') ? obj.getBoolean('static') : false,\n   };"
        },
        {
            "sha": "e0b7194ecb06fdc559679b0c6deeb1db2e644e3f",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3DependencyMetadata, R3DirectiveDef, R3DirectiveMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n+import {emitDistinctChangesOnlyDefaultValue} from '@angular/compiler/src/core';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n@@ -436,6 +437,7 @@ export function extractQueryMetadata(\n   let read: Expression|null = null;\n   // The default value for descendants is true for every decorator except @ContentChildren.\n   let descendants: boolean = name !== 'ContentChildren';\n+  let emitDistinctChangesOnly: boolean = emitDistinctChangesOnlyDefaultValue;\n   if (args.length === 2) {\n     const optionsExpr = unwrapExpression(args[1]);\n     if (!ts.isObjectLiteralExpression(optionsExpr)) {\n@@ -458,6 +460,17 @@ export function extractQueryMetadata(\n       descendants = descendantsValue;\n     }\n \n+    if (options.has('emitDistinctChangesOnly')) {\n+      const emitDistinctChangesOnlyExpr = options.get('emitDistinctChangesOnly')!;\n+      const emitDistinctChangesOnlyValue = evaluator.evaluate(emitDistinctChangesOnlyExpr);\n+      if (typeof emitDistinctChangesOnlyValue !== 'boolean') {\n+        throw createValueHasWrongTypeError(\n+            emitDistinctChangesOnlyExpr, emitDistinctChangesOnlyValue,\n+            `@${name} options.emitDistinctChangesOnlys must be a boolean`);\n+      }\n+      emitDistinctChangesOnly = emitDistinctChangesOnlyValue;\n+    }\n+\n     if (options.has('static')) {\n       const staticValue = evaluator.evaluate(options.get('static')!);\n       if (typeof staticValue !== 'boolean') {\n@@ -480,6 +493,7 @@ export function extractQueryMetadata(\n     descendants,\n     read,\n     static: isStatic,\n+    emitDistinctChangesOnly,\n   };\n }\n "
        },
        {
            "sha": "2408ef18547d8d80c570006c031586cbfa07be39",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 96,
            "deletions": 8,
            "changes": 104,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FGOLDEN_PARTIAL.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -32,7 +32,7 @@ import * as i0 from \"@angular/core\";\n export class ViewQueryComponent {\n }\n ViewQueryComponent.ɵfac = function ViewQueryComponent_Factory(t) { return new (t || ViewQueryComponent)(); };\n-ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true }, { propertyName: \"someDirs\", predicate: SomeDirective, descendants: true }], ngImport: i0, template: `\n+ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true }, { propertyName: \"someDirs\", predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true }], ngImport: i0, template: `\n     <div someDir></div>\n   `, isInline: true, directives: [{ type: i0.forwardRef(function () { return SomeDirective; }), selector: \"[someDir]\" }] });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ViewQueryComponent, [{\n@@ -86,7 +86,7 @@ import * as i0 from \"@angular/core\";\n export class ViewQueryComponent {\n }\n ViewQueryComponent.ɵfac = function ViewQueryComponent_Factory(t) { return new (t || ViewQueryComponent)(); };\n-ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], descendants: true }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], descendants: true }], ngImport: i0, template: `\n+ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], emitDistinctChangesOnly: false, descendants: true }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], emitDistinctChangesOnly: false, descendants: true }], ngImport: i0, template: `\n     <div #myRef></div>\n     <div #myRef1></div>\n   `, isInline: true });\n@@ -166,7 +166,7 @@ import * as i0 from \"@angular/core\";\n export class ViewQueryComponent {\n }\n ViewQueryComponent.ɵfac = function ViewQueryComponent_Factory(t) { return new (t || ViewQueryComponent)(); };\n-ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true, static: true }, { propertyName: \"foo\", first: true, predicate: [\"foo\"], descendants: true }], ngImport: i0, template: `\n+ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true, static: true }, { propertyName: \"foo\", first: true, predicate: [\"foo\"], emitDistinctChangesOnly: false, descendants: true }], ngImport: i0, template: `\n     <div someDir></div>\n   `, isInline: true, directives: [{ type: i0.forwardRef(function () { return SomeDirective; }), selector: \"[someDir]\" }] });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ViewQueryComponent, [{\n@@ -246,7 +246,7 @@ import * as i0 from \"@angular/core\";\n export class ViewQueryComponent {\n }\n ViewQueryComponent.ɵfac = function ViewQueryComponent_Factory(t) { return new (t || ViewQueryComponent)(); };\n-ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], descendants: true, read: TemplateRef }, { propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true, read: ElementRef }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], descendants: true, read: ElementRef }, { propertyName: \"someDirs\", predicate: SomeDirective, descendants: true, read: TemplateRef }], ngImport: i0, template: `\n+ViewQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ViewQueryComponent, selector: \"view-query-component\", viewQueries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], emitDistinctChangesOnly: false, descendants: true, read: TemplateRef }, { propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true, read: ElementRef }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], emitDistinctChangesOnly: false, descendants: true, read: ElementRef }, { propertyName: \"someDirs\", predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true, read: TemplateRef }], ngImport: i0, template: `\n     <div someDir></div>\n     <div #myRef></div>\n     <div #myRef1></div>\n@@ -336,7 +336,7 @@ import * as i0 from \"@angular/core\";\n export class ContentQueryComponent {\n }\n ContentQueryComponent.ɵfac = function ContentQueryComponent_Factory(t) { return new (t || ContentQueryComponent)(); };\n-ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true }, { propertyName: \"someDirList\", predicate: SomeDirective }], ngImport: i0, template: `\n+ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true }, { propertyName: \"someDirList\", predicate: SomeDirective, emitDistinctChangesOnly: false }], ngImport: i0, template: `\n     <div><ng-content></ng-content></div>\n   `, isInline: true });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ContentQueryComponent, [{\n@@ -413,7 +413,7 @@ import * as i0 from \"@angular/core\";\n export class ContentQueryComponent {\n }\n ContentQueryComponent.ɵfac = function ContentQueryComponent_Factory(t) { return new (t || ContentQueryComponent)(); };\n-ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], descendants: true }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"] }], ngImport: i0, template: `\n+ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], emitDistinctChangesOnly: false, descendants: true }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], emitDistinctChangesOnly: false }], ngImport: i0, template: `\n     <div #myRef></div>\n     <div #myRef1></div>\n   `, isInline: true });\n@@ -493,7 +493,7 @@ import * as i0 from \"@angular/core\";\n export class ContentQueryComponent {\n }\n ContentQueryComponent.ɵfac = function ContentQueryComponent_Factory(t) { return new (t || ContentQueryComponent)(); };\n-ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true, static: true }, { propertyName: \"foo\", first: true, predicate: [\"foo\"], descendants: true }], ngImport: i0, template: `\n+ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true, static: true }, { propertyName: \"foo\", first: true, predicate: [\"foo\"], emitDistinctChangesOnly: false, descendants: true }], ngImport: i0, template: `\n     <div><ng-content></ng-content></div>\n   `, isInline: true });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ContentQueryComponent, [{\n@@ -596,7 +596,7 @@ import * as i0 from \"@angular/core\";\n export class ContentQueryComponent {\n }\n ContentQueryComponent.ɵfac = function ContentQueryComponent_Factory(t) { return new (t || ContentQueryComponent)(); };\n-ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], descendants: true, read: TemplateRef }, { propertyName: \"someDir\", first: true, predicate: SomeDirective, descendants: true, read: ElementRef }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], read: ElementRef }, { propertyName: \"someDirs\", predicate: SomeDirective, read: TemplateRef }], ngImport: i0, template: `\n+ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"myRef\", first: true, predicate: [\"myRef\"], emitDistinctChangesOnly: false, descendants: true, read: TemplateRef }, { propertyName: \"someDir\", first: true, predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true, read: ElementRef }, { propertyName: \"myRefs\", predicate: [\"myRef1, myRef2, myRef3\"], emitDistinctChangesOnly: false, read: ElementRef }, { propertyName: \"someDirs\", predicate: SomeDirective, emitDistinctChangesOnly: false, read: TemplateRef }], ngImport: i0, template: `\n     <div someDir></div>\n     <div #myRef></div>\n     <div #myRef1></div>\n@@ -652,3 +652,91 @@ export declare class MyModule {\n     static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n }\n \n+/****************************************************************************************************\n+ * PARTIAL FILE: some.directive.js\n+ ****************************************************************************************************/\n+import { Directive } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class SomeDirective {\n+}\n+SomeDirective.ɵfac = function SomeDirective_Factory(t) { return new (t || SomeDirective)(); };\n+SomeDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: SomeDirective, selector: \"[someDir]\", ngImport: i0 });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(SomeDirective, [{\n+        type: Directive,\n+        args: [{\n+                selector: '[someDir]',\n+            }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: some.directive.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class SomeDirective {\n+    static ɵfac: i0.ɵɵFactoryDef<SomeDirective, never>;\n+    static ɵdir: i0.ɵɵDirectiveDefWithMeta<SomeDirective, \"[someDir]\", never, {}, {}, never>;\n+}\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: query_with_emit_distinct_changes_only.js\n+ ****************************************************************************************************/\n+import { Component, ContentChildren, NgModule, ViewChildren } from '@angular/core';\n+import { SomeDirective } from './some.directive';\n+import * as i0 from \"@angular/core\";\n+export class ContentQueryComponent {\n+}\n+ContentQueryComponent.ɵfac = function ContentQueryComponent_Factory(t) { return new (t || ContentQueryComponent)(); };\n+ContentQueryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: ContentQueryComponent, selector: \"content-query-component\", queries: [{ propertyName: \"myRefs\", predicate: [\"myRef\"] }, { propertyName: \"oldMyRefs\", predicate: [\"myRef\"], emitDistinctChangesOnly: false }], viewQueries: [{ propertyName: \"someDirs\", predicate: SomeDirective, descendants: true }, { propertyName: \"oldSomeDirs\", predicate: SomeDirective, emitDistinctChangesOnly: false, descendants: true }], ngImport: i0, template: `\n+    <div someDir></div>\n+    <div #myRef></div>\n+  `, isInline: true });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ContentQueryComponent, [{\n+        type: Component,\n+        args: [{\n+                selector: 'content-query-component',\n+                template: `\n+    <div someDir></div>\n+    <div #myRef></div>\n+  `\n+            }]\n+    }], null, { myRefs: [{\n+            type: ContentChildren,\n+            args: ['myRef', { emitDistinctChangesOnly: true }]\n+        }], oldMyRefs: [{\n+            type: ContentChildren,\n+            args: ['myRef', { emitDistinctChangesOnly: false }]\n+        }], someDirs: [{\n+            type: ViewChildren,\n+            args: [SomeDirective, { emitDistinctChangesOnly: true }]\n+        }], oldSomeDirs: [{\n+            type: ViewChildren,\n+            args: [SomeDirective, { emitDistinctChangesOnly: false }]\n+        }] }); })();\n+export class MyModule {\n+}\n+MyModule.ɵmod = i0.ɵɵdefineNgModule({ type: MyModule });\n+MyModule.ɵinj = i0.ɵɵdefineInjector({ factory: function MyModule_Factory(t) { return new (t || MyModule)(); } });\n+(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && i0.ɵɵsetNgModuleScope(MyModule, { declarations: [ContentQueryComponent] }); })();\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [ContentQueryComponent] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: query_with_emit_distinct_changes_only.d.ts\n+ ****************************************************************************************************/\n+import { ElementRef, QueryList } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export declare class ContentQueryComponent {\n+    myRefs: QueryList<ElementRef>;\n+    oldMyRefs: QueryList<ElementRef>;\n+    someDirs: QueryList<any>;\n+    oldSomeDirs: QueryList<any>;\n+    static ɵfac: i0.ɵɵFactoryDef<ContentQueryComponent, never>;\n+    static ɵcmp: i0.ɵɵComponentDefWithMeta<ContentQueryComponent, \"content-query-component\", never, {}, {}, [\"myRefs\", \"oldMyRefs\"], never>;\n+}\n+export declare class MyModule {\n+    static ɵmod: i0.ɵɵNgModuleDefWithMeta<MyModule, [typeof ContentQueryComponent], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n+}\n+"
        },
        {
            "sha": "a842eacb0ac43f2f9956c18b716b6c11032aecf9",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/TEST_CASES.json",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2FTEST_CASES.json?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -118,6 +118,21 @@\n           ]\n         }\n       ]\n+    },\n+    {\n+      \"description\": \"should support query emitDistinctChangesOnly flag\",\n+      \"inputFiles\": [\n+        \"some.directive.ts\",\n+        \"query_with_emit_distinct_changes_only.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Invalid ContentQuery declaration\",\n+          \"files\": [\n+            \"query_with_emit_distinct_changes_only.js\"\n+          ]\n+        }\n+      ]\n     }\n   ]\n }"
        },
        {
            "sha": "faa1846e6419ee582bc29a8e4449a615ba908733",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/content_query_for_directive.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_directive.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_directive.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_directive.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -3,8 +3,8 @@ ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"content-query-component\"]],\n   contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n     if (rf & 1) {\n-    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, true);\n-    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, false);\n+    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 1);\n+    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 0);\n     }\n     if (rf & 2) {\n     let $tmp$;"
        },
        {
            "sha": "06369baed7c75c764a3ce38656e1555573ba932c",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/content_query_for_local_ref.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_local_ref.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_local_ref.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_for_local_ref.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -5,8 +5,8 @@ ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   // ...\n   contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n     if (rf & 1) {\n-    $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, true);\n-    $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, false);\n+    $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, 1);\n+    $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, 0);\n     }\n     if (rf & 2) {\n     let $tmp$;"
        },
        {
            "sha": "052641dff7ed68d8318b8705acce6642ab0219f5",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/content_query_read_token.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_read_token.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_read_token.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fcontent_query_read_token.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -5,10 +5,10 @@ ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   // ...\n   contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n     if (rf & 1) {\n-      $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, true, TemplateRef);\n-    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, true, ElementRef);\n-    $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, false, ElementRef);\n-    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, false, TemplateRef);\n+      $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, 1, TemplateRef);\n+    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 1, ElementRef);\n+    $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, 0, ElementRef);\n+    $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 0, TemplateRef);\n     }\n     if (rf & 2) {\n     let $tmp$;"
        },
        {
            "sha": "abf538c04c847c012ab6b43566e165d202e60c67",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/query_with_emit_distinct_changes_only.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -0,0 +1,29 @@\n+const $e0_attrs$ = [\"myRef\"];\n+// ...\n+ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n+  // ...\n+  contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n+    if (rf & 1) {\n+      $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, __QueryFlags.emitDistinctChangesOnly__);\n+      $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, __QueryFlags.none__);\n+    }\n+    if (rf & 2) {\n+      let $tmp$;\n+      $r3$.ɵɵqueryRefresh($tmp$ = $r3$.ɵɵloadQuery()) && (ctx.myRefs = $tmp$);\n+      $r3$.ɵɵqueryRefresh($tmp$ = $r3$.ɵɵloadQuery()) && (ctx.oldMyRefs = $tmp$);\n+    }\n+  },\n+  // ...\n+  viewQuery: function ContentQueryComponent_Query(rf, ctx) {\n+    if (rf & 1) {\n+      $r3$.ɵɵviewQuery(SomeDirective, __QueryFlags.emitDistinctChangesOnly__|__QueryFlags.descendants__);\n+      $r3$.ɵɵviewQuery(SomeDirective, __QueryFlags.descendants__);\n+    }\n+    if (rf & 2) {\n+      let $tmp$;\n+      $r3$.ɵɵqueryRefresh($tmp$ = $r3$.ɵɵloadQuery()) && (ctx.someDirs = $tmp$);\n+      $r3$.ɵɵqueryRefresh($tmp$ = $r3$.ɵɵloadQuery()) && (ctx.oldSomeDirs = $tmp$);\n+    }\n+  },\n+  //...\n+});"
        },
        {
            "sha": "c00f5958fbb92baa9abec6d66497d523e6471437",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/query_with_emit_distinct_changes_only.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fquery_with_emit_distinct_changes_only.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -0,0 +1,21 @@\n+import {Component, ContentChildren, ElementRef, NgModule, QueryList, TemplateRef, ViewChildren} from '@angular/core';\n+\n+import {SomeDirective} from './some.directive';\n+\n+@Component({\n+  selector: 'content-query-component',\n+  template: `\n+    <div someDir></div>\n+    <div #myRef></div>\n+  `\n+})\n+export class ContentQueryComponent {\n+  @ContentChildren('myRef', {emitDistinctChangesOnly: true}) myRefs!: QueryList<ElementRef>;\n+  @ContentChildren('myRef', {emitDistinctChangesOnly: false}) oldMyRefs!: QueryList<ElementRef>;\n+\n+  @ViewChildren(SomeDirective, {emitDistinctChangesOnly: true}) someDirs!: QueryList<any>;\n+  @ViewChildren(SomeDirective, {emitDistinctChangesOnly: false}) oldSomeDirs!: QueryList<any>;\n+}\n+@NgModule({declarations: [ContentQueryComponent]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "e7053157b859c5ef71f4c74415788de13762bb48",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/static_content_query.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -3,8 +3,8 @@ ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"content-query-component\"]],\n   contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n     if (rf & 1) {\n-    $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, true);\n-    $r3$.ɵɵcontentQuery(dirIndex, $ref0$, true);\n+    $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, 3);\n+    $r3$.ɵɵcontentQuery(dirIndex, $ref0$, 1);\n     }\n     if (rf & 2) {\n     let $tmp$;"
        },
        {
            "sha": "1ece02dd91612d438495ab334512dfb32d820f97",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/static_view_query.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -5,8 +5,8 @@ ViewQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"view-query-component\"]],\n   viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n     if (rf & 1) {\n-      $r3$.ɵɵstaticViewQuery(SomeDirective, true);\n-      $r3$.ɵɵviewQuery($refs$, true);\n+      $r3$.ɵɵstaticViewQuery(SomeDirective, 3);\n+      $r3$.ɵɵviewQuery($refs$, 1);\n     }\n     if (rf & 2) {\n       let $tmp$;"
        },
        {
            "sha": "beccd991aaad40a1a501ccef0cb04b74eb050dc5",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/view_query_for_directive.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_directive.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_directive.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_directive.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -3,8 +3,8 @@ ViewQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"view-query-component\"]],\n   viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n     if (rf & 1) {\n-      $r3$.ɵɵviewQuery(SomeDirective, true);\n-      $r3$.ɵɵviewQuery(SomeDirective, true);\n+      $r3$.ɵɵviewQuery(SomeDirective, 1);\n+      $r3$.ɵɵviewQuery(SomeDirective, 1);\n     }\n     if (rf & 2) {\n       let $tmp$;"
        },
        {
            "sha": "f03ef5933e1acd3558d533d1c8aa788db1ccf859",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/view_query_for_local_ref.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_local_ref.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_local_ref.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_for_local_ref.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -5,8 +5,8 @@ ViewQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   // ...\n   viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n     if (rf & 1) {\n-      $r3$.ɵɵviewQuery($e0_attrs$, true);\n-      $r3$.ɵɵviewQuery($e1_attrs$, true);\n+      $r3$.ɵɵviewQuery($e0_attrs$, 1);\n+      $r3$.ɵɵviewQuery($e1_attrs$, 1);\n     }\n     if (rf & 2) {\n       let $tmp$;"
        },
        {
            "sha": "7daae2be02e6b649e04ef55f7025c3bc3f03b43a",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/view_query_read_token.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_read_token.js",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_read_token.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fview_query_read_token.js?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -5,10 +5,10 @@ ViewQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   // ...\n   viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n     if (rf & 1) {\n-      $r3$.ɵɵviewQuery($e0_attrs$, true, TemplateRef);\n-      $r3$.ɵɵviewQuery(SomeDirective, true, ElementRef);\n-      $r3$.ɵɵviewQuery($e1_attrs$, true, ElementRef);\n-      $r3$.ɵɵviewQuery(SomeDirective, true, TemplateRef);\n+      $r3$.ɵɵviewQuery($e0_attrs$, 1, TemplateRef);\n+      $r3$.ɵɵviewQuery(SomeDirective, 1, ElementRef);\n+      $r3$.ɵɵviewQuery($e1_attrs$, 1, ElementRef);\n+      $r3$.ɵɵviewQuery(SomeDirective, 1, TemplateRef);\n     }\n     if (rf & 2) {\n       let $tmp$;"
        },
        {
            "sha": "80989aaa5528def873f5f89dbec0f030e99e880c",
            "filename": "packages/compiler-cli/test/compliance_old/r3_compiler_compliance_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -1636,8 +1636,8 @@ describe('compiler compliance', () => {\n             selectors: [[\"view-query-component\"]],\n             viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n               if (rf & 1) {\n-                $r3$.ɵɵviewQuery(SomeDirective, true);\n-                $r3$.ɵɵviewQuery(SomeDirective, true);\n+                $r3$.ɵɵviewQuery(SomeDirective, 1);\n+                $r3$.ɵɵviewQuery(SomeDirective, 1);\n               }\n               if (rf & 2) {\n                 let $tmp$;\n@@ -1695,8 +1695,8 @@ describe('compiler compliance', () => {\n             …\n             viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n               if (rf & 1) {\n-                $r3$.ɵɵviewQuery($e0_attrs$, true);\n-                $r3$.ɵɵviewQuery($e1_attrs$, true);\n+                $r3$.ɵɵviewQuery($e0_attrs$, 1);\n+                $r3$.ɵɵviewQuery($e1_attrs$, 1);\n               }\n               if (rf & 2) {\n                 let $tmp$;\n@@ -1746,8 +1746,8 @@ describe('compiler compliance', () => {\n             selectors: [[\"view-query-component\"]],\n             viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n               if (rf & 1) {\n-                $r3$.ɵɵstaticViewQuery(SomeDirective, true);\n-                $r3$.ɵɵviewQuery($refs$, true);\n+                $r3$.ɵɵstaticViewQuery(SomeDirective, 3);\n+                $r3$.ɵɵviewQuery($refs$, 1);\n               }\n               if (rf & 2) {\n                 let $tmp$;\n@@ -1810,10 +1810,10 @@ describe('compiler compliance', () => {\n             …\n             viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n               if (rf & 1) {\n-                $r3$.ɵɵviewQuery($e0_attrs$, true, TemplateRef);\n-                $r3$.ɵɵviewQuery(SomeDirective, true, ElementRef);\n-                $r3$.ɵɵviewQuery($e1_attrs$, true, ElementRef);\n-                $r3$.ɵɵviewQuery(SomeDirective, true, TemplateRef);\n+                $r3$.ɵɵviewQuery($e0_attrs$, 1, TemplateRef);\n+                $r3$.ɵɵviewQuery(SomeDirective, 1, ElementRef);\n+                $r3$.ɵɵviewQuery($e1_attrs$, 1, ElementRef);\n+                $r3$.ɵɵviewQuery(SomeDirective, 1, TemplateRef);\n               }\n               if (rf & 2) {\n                 let $tmp$;\n@@ -1873,8 +1873,8 @@ describe('compiler compliance', () => {\n             selectors: [[\"content-query-component\"]],\n             contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n               if (rf & 1) {\n-              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, true);\n-              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, false);\n+              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 1);\n+              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 0);\n               }\n               if (rf & 2) {\n               let $tmp$;\n@@ -1933,8 +1933,8 @@ describe('compiler compliance', () => {\n             …\n             contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n               if (rf & 1) {\n-              $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, true);\n-              $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, false);\n+              $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, 1);\n+              $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, 0);\n               }\n               if (rf & 2) {\n               let $tmp$;\n@@ -1992,8 +1992,8 @@ describe('compiler compliance', () => {\n             selectors: [[\"content-query-component\"]],\n             contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n               if (rf & 1) {\n-              $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, true);\n-              $r3$.ɵɵcontentQuery(dirIndex, $ref0$, true);\n+              $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, 3);\n+              $r3$.ɵɵcontentQuery(dirIndex, $ref0$, 1);\n               }\n               if (rf & 2) {\n               let $tmp$;\n@@ -2057,10 +2057,10 @@ describe('compiler compliance', () => {\n             …\n             contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n               if (rf & 1) {\n-                $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, true, TemplateRef);\n-              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, true, ElementRef);\n-              $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, false, ElementRef);\n-              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, false, TemplateRef);\n+                $r3$.ɵɵcontentQuery(dirIndex, $e0_attrs$, 1, TemplateRef);\n+              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 1, ElementRef);\n+              $r3$.ɵɵcontentQuery(dirIndex, $e1_attrs$, 0, ElementRef);\n+              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 0, TemplateRef);\n               }\n               if (rf & 2) {\n               let $tmp$;"
        },
        {
            "sha": "618467ae90814ca8e733c587bc7e141101649fd0",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 22,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -22,14 +22,14 @@ const trim = (input: string): string => input.replace(/\\s+/g, ' ').trim();\n \n const varRegExp = (name: string): RegExp => new RegExp(`var \\\\w+ = \\\\[\\\"${name}\\\"\\\\];`);\n \n-const viewQueryRegExp = (predicate: string, descend: boolean, ref?: string): RegExp => {\n+const viewQueryRegExp = (predicate: string, flags: number, ref?: string): RegExp => {\n   const maybeRef = ref ? `, ${ref}` : ``;\n-  return new RegExp(`i0\\\\.ɵɵviewQuery\\\\(${predicate}, ${descend}${maybeRef}\\\\)`);\n+  return new RegExp(`i0\\\\.ɵɵviewQuery\\\\(${predicate}, ${flags}${maybeRef}\\\\)`);\n };\n \n-const contentQueryRegExp = (predicate: string, descend: boolean, ref?: string): RegExp => {\n+const contentQueryRegExp = (predicate: string, flags: number, ref?: string): RegExp => {\n   const maybeRef = ref ? `, ${ref}` : ``;\n-  return new RegExp(`i0\\\\.ɵɵcontentQuery\\\\(dirIndex, ${predicate}, ${descend}${maybeRef}\\\\)`);\n+  return new RegExp(`i0\\\\.ɵɵcontentQuery\\\\(dirIndex, ${predicate}, ${flags}${maybeRef}\\\\)`);\n };\n \n const setClassMetadataRegExp = (expectedType: string): RegExp =>\n@@ -3093,10 +3093,10 @@ runInEachFileSystem(os => {\n       expect(jsContents).toMatch(varRegExp('test1'));\n       expect(jsContents).toMatch(varRegExp('test2'));\n       expect(jsContents).toMatch(varRegExp('accessor'));\n-      // match `i0.ɵɵcontentQuery(dirIndex, _c1, true, TemplateRef)`\n-      expect(jsContents).toMatch(contentQueryRegExp('\\\\w+', true, 'TemplateRef'));\n-      // match `i0.ɵɵviewQuery(_c2, true, null)`\n-      expect(jsContents).toMatch(viewQueryRegExp('\\\\w+', true));\n+      // match `i0.ɵɵcontentQuery(dirIndex, _c1, 1, TemplateRef)`\n+      expect(jsContents).toMatch(contentQueryRegExp('\\\\w+', 1, 'TemplateRef'));\n+      // match `i0.ɵɵviewQuery(_c2, 1, null)`\n+      expect(jsContents).toMatch(viewQueryRegExp('\\\\w+', 1));\n     });\n \n     it('should generate queries for directives', () => {\n@@ -3125,14 +3125,14 @@ runInEachFileSystem(os => {\n       expect(jsContents).toMatch(varRegExp('test1'));\n       expect(jsContents).toMatch(varRegExp('test2'));\n       expect(jsContents).toMatch(varRegExp('accessor'));\n-      // match `i0.ɵɵcontentQuery(dirIndex, _c1, true, TemplateRef)`\n-      expect(jsContents).toMatch(contentQueryRegExp('\\\\w+', true, 'TemplateRef'));\n+      // match `i0.ɵɵcontentQuery(dirIndex, _c1, 1, TemplateRef)`\n+      expect(jsContents).toMatch(contentQueryRegExp('\\\\w+', 1, 'TemplateRef'));\n \n-      // match `i0.ɵɵviewQuery(_c2, true)`\n+      // match `i0.ɵɵviewQuery(_c2, 1)`\n       // Note that while ViewQuery doesn't necessarily make sense on a directive,\n       // because it doesn't have a view, we still need to handle it because a component\n       // could extend the directive.\n-      expect(jsContents).toMatch(viewQueryRegExp('\\\\w+', true));\n+      expect(jsContents).toMatch(viewQueryRegExp('\\\\w+', 1));\n     });\n \n     it('should handle queries that use forwardRef', () => {\n@@ -3154,13 +3154,13 @@ runInEachFileSystem(os => {\n \n       env.driveMain();\n       const jsContents = env.getContents('test.js');\n-      // match `i0.ɵɵcontentQuery(dirIndex, TemplateRef, true, null)`\n-      expect(jsContents).toMatch(contentQueryRegExp('TemplateRef', true));\n-      // match `i0.ɵɵcontentQuery(dirIndex, ViewContainerRef, true, null)`\n-      expect(jsContents).toMatch(contentQueryRegExp('ViewContainerRef', true));\n-      // match `i0.ɵɵcontentQuery(dirIndex, _c0, true, null)`\n+      // match `i0.ɵɵcontentQuery(dirIndex, TemplateRef, 1, null)`\n+      expect(jsContents).toMatch(contentQueryRegExp('TemplateRef', 1));\n+      // match `i0.ɵɵcontentQuery(dirIndex, ViewContainerRef, 1, null)`\n+      expect(jsContents).toMatch(contentQueryRegExp('ViewContainerRef', 1));\n+      // match `i0.ɵɵcontentQuery(dirIndex, _c0, 1, null)`\n       expect(jsContents).toContain('_c0 = [\"parens\"];');\n-      expect(jsContents).toMatch(contentQueryRegExp('_c0', true));\n+      expect(jsContents).toMatch(contentQueryRegExp('_c0', 1));\n     });\n \n     it('should handle queries that use an InjectionToken', () => {\n@@ -3181,10 +3181,10 @@ runInEachFileSystem(os => {\n \n       env.driveMain();\n       const jsContents = env.getContents('test.js');\n-      // match `i0.ɵɵviewQuery(TOKEN, true, null)`\n-      expect(jsContents).toMatch(viewQueryRegExp('TOKEN', true));\n-      // match `i0.ɵɵcontentQuery(dirIndex, TOKEN, true, null)`\n-      expect(jsContents).toMatch(contentQueryRegExp('TOKEN', true));\n+      // match `i0.ɵɵviewQuery(TOKEN, 1, null)`\n+      expect(jsContents).toMatch(viewQueryRegExp('TOKEN', 1));\n+      // match `i0.ɵɵcontentQuery(dirIndex, TOKEN, 1, null)`\n+      expect(jsContents).toMatch(contentQueryRegExp('TOKEN', 1));\n     });\n \n     it('should compile expressions that write keys', () => {"
        },
        {
            "sha": "e194e6183e708a0ee961eab9333f0215cf78c8e9",
            "filename": "packages/compiler/src/compile_metadata.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcompile_metadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcompile_metadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompile_metadata.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -169,6 +169,7 @@ export interface CompileQueryMetadata {\n   propertyName: string;\n   read: CompileTokenMetadata;\n   static?: boolean;\n+  emitDistinctChangesOnly?: boolean;\n }\n \n /**"
        },
        {
            "sha": "336a5fa76c01df35cd0b201d10c213893f51891c",
            "filename": "packages/compiler/src/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -240,6 +240,7 @@ export interface R3QueryMetadataFacade {\n   first: boolean;\n   predicate: any|string[];\n   descendants: boolean;\n+  emitDistinctChangesOnly: boolean;\n   read: any|null;\n   static: boolean;\n }\n@@ -251,6 +252,7 @@ export interface R3DeclareQueryMetadataFacade {\n   descendants?: boolean;\n   read?: OpaqueValue;\n   static?: boolean;\n+  emitDistinctChangesOnly?: boolean;\n }\n \n export interface ParseSourceSpan {"
        },
        {
            "sha": "8ac2250a307cced3ffbb56968f392e2488928429",
            "filename": "packages/compiler/src/core.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 6,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcore.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fcore.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcore.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -27,6 +27,12 @@ export interface Attribute {\n export const createAttribute =\n     makeMetadataFactory<Attribute>('Attribute', (attributeName: string) => ({attributeName}));\n \n+// Stores the default value of `emitDistinctChangesOnly` when the `emitDistinctChangesOnly` is not\n+// explicitly set. This value will be changed to `true` in v12.\n+// TODO(misko): switch the default in v12 to `true`. See: packages/core/src/metadata/di.ts\n+export const emitDistinctChangesOnlyDefaultValue = false;\n+\n+\n export interface Query {\n   descendants: boolean;\n   first: boolean;\n@@ -37,17 +43,27 @@ export interface Query {\n }\n \n export const createContentChildren = makeMetadataFactory<Query>(\n-    'ContentChildren',\n-    (selector?: any, data: any = {}) =>\n-        ({selector, first: false, isViewQuery: false, descendants: false, ...data}));\n+    'ContentChildren', (selector?: any, data: any = {}) => ({\n+                         selector,\n+                         first: false,\n+                         isViewQuery: false,\n+                         descendants: false,\n+                         emitDistinctChangesOnly: emitDistinctChangesOnlyDefaultValue,\n+                         ...data\n+                       }));\n export const createContentChild = makeMetadataFactory<Query>(\n     'ContentChild',\n     (selector?: any, data: any = {}) =>\n         ({selector, first: true, isViewQuery: false, descendants: true, ...data}));\n export const createViewChildren = makeMetadataFactory<Query>(\n-    'ViewChildren',\n-    (selector?: any, data: any = {}) =>\n-        ({selector, first: false, isViewQuery: true, descendants: true, ...data}));\n+    'ViewChildren', (selector?: any, data: any = {}) => ({\n+                      selector,\n+                      first: false,\n+                      isViewQuery: true,\n+                      descendants: true,\n+                      emitDistinctChangesOnly: emitDistinctChangesOnlyDefaultValue,\n+                      ...data\n+                    }));\n export const createViewChild = makeMetadataFactory<Query>(\n     'ViewChild',\n     (selector: any, data: any) =>\n@@ -224,6 +240,7 @@ export const enum NodeFlags {\n   StaticQuery = 1 << 28,\n   DynamicQuery = 1 << 29,\n   TypeModuleProvider = 1 << 30,\n+  EmitDistinctChangesOnly = 1 << 31,\n   CatQuery = TypeContentQuery | TypeViewQuery,\n \n   // mutually exclusive values..."
        },
        {
            "sha": "76d6236ad3e16ba51311b93badb24ddffd6ea720",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -243,7 +243,8 @@ function convertToR3QueryMetadata(facade: R3QueryMetadataFacade): R3QueryMetadat\n     predicate: Array.isArray(facade.predicate) ? facade.predicate :\n                                                  new WrappedNodeExpr(facade.predicate),\n     read: facade.read ? new WrappedNodeExpr(facade.read) : null,\n-    static: facade.static\n+    static: facade.static,\n+    emitDistinctChangesOnly: facade.emitDistinctChangesOnly,\n   };\n }\n \n@@ -257,6 +258,7 @@ function convertQueryDeclarationToMetadata(declaration: R3DeclareQueryMetadataFa\n     descendants: declaration.descendants ?? false,\n     read: declaration.read ? new WrappedNodeExpr(declaration.read) : null,\n     static: declaration.static ?? false,\n+    emitDistinctChangesOnly: declaration.emitDistinctChangesOnly ?? true,\n   };\n }\n "
        },
        {
            "sha": "c1d1e51314b321aeab0209320c2a9fe35f6b7a13",
            "filename": "packages/compiler/src/metadata_resolver.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fmetadata_resolver.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fmetadata_resolver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fmetadata_resolver.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -1196,6 +1196,7 @@ export class CompileMetadataResolver {\n       selectors,\n       first: q.first,\n       descendants: q.descendants,\n+      emitDistinctChangesOnly: q.emitDistinctChangesOnly,\n       propertyName,\n       read: q.read ? this._getTokenMetadata(q.read) : null!,\n       static: q.static"
        },
        {
            "sha": "38f8eee4e8cbcb0d8be5f4099a46f8d5a02106f8",
            "filename": "packages/compiler/src/render3/partial/api.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -232,6 +232,14 @@ export interface R3DeclareQueryMetadata {\n    */\n   descendants?: boolean;\n \n+  /**\n+   * True to only fire changes if there are underlying changes to the query.\n+   */\n+  // TODO(misko):  This will become `true` be default in v12. `QueryList.changes` would fire even if\n+  // no changes to the query list were detected. This is not ideal, as changes should only fire if\n+  // the `QueryList` actually materially changed.\n+  emitDistinctChangesOnly?: boolean;\n+\n   /**\n    * An expression representing a type to read from each matched node, or null if the default value\n    * for a given node is to be returned."
        },
        {
            "sha": "8b5a854585bf576647df2b3bb74747833213b07f",
            "filename": "packages/compiler/src/render3/partial/directive.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -86,6 +86,11 @@ function compileQuery(query: R3QueryMetadata): o.LiteralMapExpr {\n   }\n   meta.set(\n       'predicate', Array.isArray(query.predicate) ? asLiteral(query.predicate) : query.predicate);\n+  if (!query.emitDistinctChangesOnly) {\n+    // `emitDistinctChangesOnly` is special because in future we expect it to be `true`. For this\n+    // reason the absence should be interpreted as `true`.\n+    meta.set('emitDistinctChangesOnly', o.literal(false));\n+  }\n   if (query.descendants) {\n     meta.set('descendants', o.literal(true));\n   }"
        },
        {
            "sha": "050efaba0af8fda5f66ec0a9d9c6a34f10fe1faf",
            "filename": "packages/compiler/src/render3/view/api.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -304,6 +304,13 @@ export interface R3QueryMetadata {\n    */\n   descendants: boolean;\n \n+  /**\n+   * If the `QueryList` should fire change event only if actual change to query was computed (vs old\n+   * behavior where the change was fired whenever the query was recomputed, even if the recomputed\n+   * query resulted in the same list.)\n+   */\n+  emitDistinctChangesOnly: boolean;\n+\n   /**\n    * An expression representing a type to read from each matched node, or null if the default value\n    * for a given node is to be returned."
        },
        {
            "sha": "9c7ddce8c51d48b015ac6fd182258bb2dc5b5675",
            "filename": "packages/compiler/src/render3/view/compiler.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 1,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -404,6 +404,7 @@ function queriesFromGlobalMetadata(\n       predicate: selectorsFromGlobalMetadata(query.selectors, outputCtx),\n       descendants: query.descendants,\n       read,\n+      emitDistinctChangesOnly: !!query.emitDistinctChangesOnly,\n       static: !!query.static\n     };\n   });\n@@ -435,13 +436,55 @@ function selectorsFromGlobalMetadata(\n }\n \n function prepareQueryParams(query: R3QueryMetadata, constantPool: ConstantPool): o.Expression[] {\n-  const parameters = [getQueryPredicate(query, constantPool), o.literal(query.descendants)];\n+  const parameters = [getQueryPredicate(query, constantPool), o.literal(toQueryFlags(query))];\n   if (query.read) {\n     parameters.push(query.read);\n   }\n   return parameters;\n }\n \n+/**\n+ * A set of flags to be used with Queries.\n+ *\n+ * NOTE: Ensure changes here are in sync with `packages/core/src/render3/interfaces/query.ts`\n+ */\n+export const enum QueryFlags {\n+  /**\n+   * No flags\n+   */\n+  none = 0b0000,\n+\n+  /**\n+   * Whether or not the query should descend into children.\n+   */\n+  descendants = 0b0001,\n+\n+  /**\n+   * The query can be computed statically and hence can be assigned eagerly.\n+   *\n+   * NOTE: Backwards compatibility with ViewEngine.\n+   */\n+  isStatic = 0b0010,\n+\n+  /**\n+   * If the `QueryList` should fire change event only if actual change to query was computed (vs old\n+   * behavior where the change was fired whenever the query was recomputed, even if the recomputed\n+   * query resulted in the same list.)\n+   */\n+  emitDistinctChangesOnly = 0b0100,\n+}\n+\n+/**\n+ * Translates query flags into `TQueryFlags` type in packages/core/src/render3/interfaces/query.ts\n+ * @param query\n+ */\n+function toQueryFlags(query: R3QueryMetadata): number {\n+  // NOTE: Verify that changes here match\n+  return (query.descendants ? 1 /* TQueryFlags.descendants */ : 0) |\n+      (query.static ? 2 /* TQueryFlags.isStatic */ : 0) |\n+      (query.emitDistinctChangesOnly ? 4 /* TQueryFlags.emitDistinctChangesOnly */ : 0);\n+}\n+\n function convertAttributesToExpressions(attributes: {[name: string]: o.Expression}):\n     o.Expression[] {\n   const values: o.Expression[] = [];"
        },
        {
            "sha": "b8c9f76c803f1b7435905119ea2972e044799c01",
            "filename": "packages/compiler/src/view_compiler/view_compiler.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fview_compiler%2Fview_compiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcompiler%2Fsrc%2Fview_compiler%2Fview_compiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fview_compiler%2Fview_compiler.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -143,7 +143,7 @@ class ViewBuilder implements TemplateAstVisitor, LocalResolver {\n         // Note: queries start with id 1 so we can use the number in a Bloom filter!\n         const queryId = queryIndex + 1;\n         const bindingType = query.first ? QueryBindingType.First : QueryBindingType.All;\n-        const flags = NodeFlags.TypeViewQuery | calcStaticDynamicQueryFlags(query);\n+        const flags = NodeFlags.TypeViewQuery | calcQueryFlags(query);\n         this.nodes.push(() => ({\n                           sourceSpan: null,\n                           nodeFlags: flags,\n@@ -485,7 +485,7 @@ class ViewBuilder implements TemplateAstVisitor, LocalResolver {\n \n     dirAst.directive.queries.forEach((query, queryIndex) => {\n       const queryId = dirAst.contentQueryStartId + queryIndex;\n-      const flags = NodeFlags.TypeContentQuery | calcStaticDynamicQueryFlags(query);\n+      const flags = NodeFlags.TypeContentQuery | calcQueryFlags(query);\n       const bindingType = query.first ? QueryBindingType.First : QueryBindingType.All;\n       this.nodes.push(() => ({\n                         sourceSpan: dirAst.sourceSpan,\n@@ -1028,7 +1028,7 @@ function elementEventNameAndTarget(\n   }\n }\n \n-function calcStaticDynamicQueryFlags(query: CompileQueryMetadata) {\n+function calcQueryFlags(query: CompileQueryMetadata) {\n   let flags = NodeFlags.None;\n   // Note: We only make queries static that query for a single item and the user specifically\n   // set the to be static. This is because of backwards compatibility with the old view compiler...\n@@ -1037,6 +1037,9 @@ function calcStaticDynamicQueryFlags(query: CompileQueryMetadata) {\n   } else {\n     flags |= NodeFlags.DynamicQuery;\n   }\n+  if (query.emitDistinctChangesOnly) {\n+    flags |= NodeFlags.EmitDistinctChangesOnly;\n+  }\n   return flags;\n }\n "
        },
        {
            "sha": "336a5fa76c01df35cd0b201d10c213893f51891c",
            "filename": "packages/core/src/compiler/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -240,6 +240,7 @@ export interface R3QueryMetadataFacade {\n   first: boolean;\n   predicate: any|string[];\n   descendants: boolean;\n+  emitDistinctChangesOnly: boolean;\n   read: any|null;\n   static: boolean;\n }\n@@ -251,6 +252,7 @@ export interface R3DeclareQueryMetadataFacade {\n   descendants?: boolean;\n   read?: OpaqueValue;\n   static?: boolean;\n+  emitDistinctChangesOnly?: boolean;\n }\n \n export interface ParseSourceSpan {"
        },
        {
            "sha": "8a9ff8133eca30667c57b5b23603680478a8e7db",
            "filename": "packages/core/src/linker/element_ref.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -86,3 +86,14 @@ export class ElementRef<T = any> {\n    */\n   static __NG_ELEMENT_ID__: () => ElementRef = SWITCH_ELEMENT_REF_FACTORY;\n }\n+\n+/**\n+ * Unwraps `ElementRef` and return the `nativeElement`.\n+ *\n+ * Conditionally unwrap the `ElementRef`.\n+ * @param value value to unwrap\n+ * @returns `nativeElement` if `ElementRef` otherwise returns value as is.\n+ */\n+export function unwrapElementRef<T, R>(value: T|ElementRef<R>): T|R {\n+  return value instanceof ElementRef ? value.nativeElement : value;\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "71f6e5fb4f1617eba7647885e42f14d40131a157",
            "filename": "packages/core/src/linker/query_list.ts",
            "status": "modified",
            "additions": 48,
            "deletions": 14,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -9,7 +9,7 @@\n import {Observable} from 'rxjs';\n \n import {EventEmitter} from '../event_emitter';\n-import {flatten} from '../util/array_utils';\n+import {arrayEquals, flatten} from '../util/array_utils';\n import {getSymbolIterator} from '../util/symbol';\n \n function symbolIterator<T>(this: QueryList<T>): Iterator<T> {\n@@ -45,15 +45,31 @@ function symbolIterator<T>(this: QueryList<T>): Iterator<T> {\n export class QueryList<T> implements Iterable<T> {\n   public readonly dirty = true;\n   private _results: Array<T> = [];\n-  public readonly changes: Observable<any> = new EventEmitter();\n+  private _changesDetected: boolean = false;\n+  private _changes: EventEmitter<QueryList<T>>|null = null;\n \n   readonly length: number = 0;\n-  // TODO(issue/24571): remove '!'.\n-  readonly first!: T;\n-  // TODO(issue/24571): remove '!'.\n-  readonly last!: T;\n+  readonly first: T = undefined!;\n+  readonly last: T = undefined!;\n \n-  constructor() {\n+  /**\n+   * Returns `Observable` of `QueryList` notifying the subscriber of changes.\n+   *\n+   * NOTE: This currently points to `changesDeprecated` which incorrectly notifies of changes even\n+   * if no changes to `QueryList` have occurred. (It fires more often than it needs to.)\n+   * The implementation will change to point `changesStrict` starting with v12.\n+   */\n+  get changes(): Observable<any> {\n+    return this._changes || (this._changes = new EventEmitter());\n+  }\n+\n+  /**\n+   * @param emitDistinctChangesOnly Whether `QueryList.changes` should fire only when actual change\n+   *     has occurred. Or if it should fire when query is recomputed. (recomputing could resolve in\n+   *     the same result) This is set to `false` for backwards compatibility but will be changed to\n+   *     true in v12.\n+   */\n+  constructor(private _emitDistinctChangesOnly: boolean = false) {\n     // This function should be declared on the prototype, but doing so there will cause the class\n     // declaration to have side-effects and become not tree-shakable. For this reason we do it in\n     // the constructor.\n@@ -135,20 +151,27 @@ export class QueryList<T> implements Iterable<T> {\n    * occurs.\n    *\n    * @param resultsTree The query results to store\n+   * @param identityAccessor Optional functions for extracting stable object identity from a value\n+   *     in the array.\n    */\n-  reset(resultsTree: Array<T|any[]>): void {\n-    this._results = flatten(resultsTree);\n-    (this as {dirty: boolean}).dirty = false;\n-    (this as {length: number}).length = this._results.length;\n-    (this as {last: T}).last = this._results[this.length - 1];\n-    (this as {first: T}).first = this._results[0];\n+  reset(resultsTree: Array<T|any[]>, identityAccessor?: (value: T) => unknown): void {\n+    const self = this as QueryListInternal<T>;\n+    (self as {dirty: boolean}).dirty = false;\n+    const newResultFlat = flatten(resultsTree);\n+    if (this._changesDetected = !arrayEquals(self._results, newResultFlat, identityAccessor)) {\n+      self._results = newResultFlat;\n+      self.length = newResultFlat.length;\n+      self.last = newResultFlat[this.length - 1];\n+      self.first = newResultFlat[0];\n+    }\n   }\n \n   /**\n    * Triggers a change event by emitting on the `changes` {@link EventEmitter}.\n    */\n   notifyOnChanges(): void {\n-    (this.changes as EventEmitter<any>).emit(this);\n+    if (this._changes && (this._emitDistinctChangesOnly ? this._changesDetected : true))\n+      this._changes.emit(this);\n   }\n \n   /** internal */\n@@ -169,3 +192,14 @@ export class QueryList<T> implements Iterable<T> {\n   // over QueryLists to work correctly, since QueryList must be assignable to NgIterable.\n   [Symbol.iterator]!: () => Iterator<T>;\n }\n+\n+/**\n+ * Internal set of APIs used by the framework. (not to be made public)\n+ */\n+export interface QueryListInternal<T> extends QueryList<T> {\n+  reset(a: any[]): void;\n+  notifyOnChanges(): void;\n+  length: number;\n+  last: T;\n+  first: T;\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "e33d78f3bf1899e5124e8d1ca01afeb86651b050",
            "filename": "packages/core/src/metadata/di.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 11,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fmetadata%2Fdi.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fmetadata%2Fdi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fmetadata%2Fdi.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -98,13 +98,20 @@ export interface Attribute {\n  */\n export interface Query {\n   descendants: boolean;\n+  emitDistinctChangesOnly: boolean;\n   first: boolean;\n   read: any;\n   isViewQuery: boolean;\n   selector: any;\n   static?: boolean;\n }\n \n+// Stores the default value of `emitDistinctChangesOnly` when the `emitDistinctChangesOnly` is not\n+// explicitly set. This value will be changed to `true` in v12.\n+// TODO(misko): switch the default in v12 to `true`. See: packages/compiler/src/core.ts\n+export const emitDistinctChangesOnlyDefaultValue = false;\n+\n+\n /**\n  * Base class for query metadata.\n  *\n@@ -140,6 +147,9 @@ export interface ContentChildrenDecorator {\n    *\n    * * **selector** - The directive type or the name used for querying.\n    * * **descendants** - True to include all descendants, otherwise include only direct children.\n+   * * **emitDistinctChangesOnly** - The ` QueryList#changes` observable will emit new values only\n+   *   if the QueryList result has changed. The default value will change from `false` to `true` in\n+   *   v12. When `false` the `changes` observable might emit even if the QueryList has not changed.\n    * * **read** - Used to read a different token from the queried elements.\n    *\n    * @usageNotes\n@@ -157,10 +167,13 @@ export interface ContentChildrenDecorator {\n    *\n    * @Annotation\n    */\n-  (selector: Type<any>|InjectionToken<unknown>|Function|string,\n-   opts?: {descendants?: boolean, read?: any}): any;\n+  (selector: Type<any>|InjectionToken<unknown>|Function|string, opts?: {\n+    descendants?: boolean,\n+    emitDistinctChangesOnly?: boolean,\n+    read?: any,\n+  }): any;\n   new(selector: Type<any>|InjectionToken<unknown>|Function|string,\n-      opts?: {descendants?: boolean, read?: any}): Query;\n+      opts?: {descendants?: boolean, emitDistinctChangesOnly?: boolean, read?: any}): Query;\n }\n \n /**\n@@ -180,9 +193,14 @@ export type ContentChildren = Query;\n  * @publicApi\n  */\n export const ContentChildren: ContentChildrenDecorator = makePropDecorator(\n-    'ContentChildren',\n-    (selector?: any, data: any = {}) =>\n-        ({selector, first: false, isViewQuery: false, descendants: false, ...data}),\n+    'ContentChildren', (selector?: any, data: any = {}) => ({\n+                         selector,\n+                         first: false,\n+                         isViewQuery: false,\n+                         descendants: false,\n+                         emitDistinctChangesOnly: emitDistinctChangesOnlyDefaultValue,\n+                         ...data\n+                       }),\n     Query);\n \n /**\n@@ -268,6 +286,9 @@ export interface ViewChildrenDecorator {\n    *\n    * * **selector** - The directive type or the name used for querying.\n    * * **read** - Used to read a different token from the queried elements.\n+   * * **emitDistinctChangesOnly** - The ` QueryList#changes` observable will emit new values only\n+   *   if the QueryList result has changed. The default value will change from `false` to `true` in\n+   *   v12. When `false` the `changes` observable might emit even if the QueryList has not changed.\n    *\n    * @usageNotes\n    *\n@@ -279,9 +300,10 @@ export interface ViewChildrenDecorator {\n    *\n    * @Annotation\n    */\n-  (selector: Type<any>|InjectionToken<unknown>|Function|string, opts?: {read?: any}): any;\n+  (selector: Type<any>|InjectionToken<unknown>|Function|string,\n+   opts?: {read?: any, emitDistinctChangesOnly?: boolean}): any;\n   new(selector: Type<any>|InjectionToken<unknown>|Function|string,\n-      opts?: {read?: any}): ViewChildren;\n+      opts?: {read?: any, emitDistinctChangesOnly?: boolean}): ViewChildren;\n }\n \n /**\n@@ -298,9 +320,14 @@ export type ViewChildren = Query;\n  * @publicApi\n  */\n export const ViewChildren: ViewChildrenDecorator = makePropDecorator(\n-    'ViewChildren',\n-    (selector?: any, data: any = {}) =>\n-        ({selector, first: false, isViewQuery: true, descendants: true, ...data}),\n+    'ViewChildren', (selector?: any, data: any = {}) => ({\n+                      selector,\n+                      first: false,\n+                      isViewQuery: true,\n+                      descendants: true,\n+                      emitDistinctChangesOnly: emitDistinctChangesOnlyDefaultValue,\n+                      ...data\n+                    }),\n     Query);\n \n /**"
        },
        {
            "sha": "7281967dceaa9585bf1c119b366c50e0c3e747ee",
            "filename": "packages/core/src/render3/interfaces/query.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 2,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fquery.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -18,9 +18,39 @@ import {TView} from './view';\n  */\n export interface TQueryMetadata {\n   predicate: Type<any>|InjectionToken<unknown>|string[];\n-  descendants: boolean;\n   read: any;\n-  isStatic: boolean;\n+  flags: QueryFlags;\n+}\n+\n+/**\n+ * A set of flags to be used with Queries.\n+ *\n+ * NOTE: Ensure changes here are reflected in `packages/compiler/src/render3/view/compiler.ts`\n+ */\n+export const enum QueryFlags {\n+  /**\n+   * No flags\n+   */\n+  none = 0b0000,\n+\n+  /**\n+   * Whether or not the query should descend into children.\n+   */\n+  descendants = 0b0001,\n+\n+  /**\n+   * The query can be computed statically and hence can be assigned eagerly.\n+   *\n+   * NOTE: Backwards compatibility with ViewEngine.\n+   */\n+  isStatic = 0b0010,\n+\n+  /**\n+   * If the `QueryList` should fire change event only if actual change to query was computed (vs old\n+   * behavior where the change was fired whenever the query was recomputed, even if the recomputed\n+   * query resulted in the same list.)\n+   */\n+  emitDistinctChangesOnly = 0b0100,\n }\n \n /**"
        },
        {
            "sha": "1b7085ebd3002f59c4ff5046b8e9e974b5c5a126",
            "filename": "packages/core/src/render3/jit/directive.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -286,7 +286,8 @@ export function convertToR3QueryMetadata(propertyName: string, ann: Query): R3Qu\n     descendants: ann.descendants,\n     first: ann.first,\n     read: ann.read ? ann.read : null,\n-    static: !!ann.static\n+    static: !!ann.static,\n+    emitDistinctChangesOnly: !!ann.emitDistinctChangesOnly,\n   };\n }\n function extractQueriesMetadata("
        },
        {
            "sha": "eaa599d255ca7998dc090d9a5e9caeb5b7f55fa5",
            "filename": "packages/core/src/render3/query.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 31,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -11,11 +11,11 @@\n \n import {InjectionToken} from '../di/injection_token';\n import {Type} from '../interface/type';\n-import {createElementRef, ElementRef as ViewEngine_ElementRef} from '../linker/element_ref';\n+import {createElementRef, ElementRef as ViewEngine_ElementRef, unwrapElementRef} from '../linker/element_ref';\n import {QueryList} from '../linker/query_list';\n import {createTemplateRef, TemplateRef as ViewEngine_TemplateRef} from '../linker/template_ref';\n import {createContainerRef, ViewContainerRef} from '../linker/view_container_ref';\n-import {assertDefined, assertIndexInRange, throwError} from '../util/assert';\n+import {assertDefined, assertIndexInRange, assertNumber, throwError} from '../util/assert';\n import {stringify} from '../util/stringify';\n import {assertFirstCreatePass, assertLContainer} from './assert';\n import {getNodeInjectable, locateDirectiveOrProvider} from './di';\n@@ -24,7 +24,7 @@ import {CONTAINER_HEADER_OFFSET, LContainer, MOVED_VIEWS} from './interfaces/con\n import {unusedValueExportToPlacateAjd as unused1} from './interfaces/definition';\n import {unusedValueExportToPlacateAjd as unused2} from './interfaces/injector';\n import {TContainerNode, TElementContainerNode, TElementNode, TNode, TNodeType, unusedValueExportToPlacateAjd as unused3} from './interfaces/node';\n-import {LQueries, LQuery, TQueries, TQuery, TQueryMetadata, unusedValueExportToPlacateAjd as unused4} from './interfaces/query';\n+import {LQueries, LQuery, QueryFlags, TQueries, TQuery, TQueryMetadata, unusedValueExportToPlacateAjd as unused4} from './interfaces/query';\n import {DECLARATION_LCONTAINER, LView, PARENT, QUERIES, TVIEW, TView} from './interfaces/view';\n import {assertTNodeType} from './node_assert';\n import {getCurrentQueryIndex, getCurrentTNode, getLView, getTView, setCurrentQueryIndex} from './state';\n@@ -88,8 +88,8 @@ class LQueries_ implements LQueries {\n \n class TQueryMetadata_ implements TQueryMetadata {\n   constructor(\n-      public predicate: Type<any>|InjectionToken<unknown>|string[], public descendants: boolean,\n-      public isStatic: boolean, public read: any = null) {}\n+      public predicate: Type<any>|InjectionToken<unknown>|string[], public flags: QueryFlags,\n+      public read: any = null) {}\n }\n \n class TQueries_ implements TQueries {\n@@ -202,7 +202,8 @@ class TQuery_ implements TQuery {\n   }\n \n   private isApplyingToNode(tNode: TNode): boolean {\n-    if (this._appliesToNextNode && this.metadata.descendants === false) {\n+    const isDescend = (this.metadata.flags & QueryFlags.descendants) === QueryFlags.descendants;\n+    if (this._appliesToNextNode && !isDescend) {\n       const declarationNodeIdx = this._declarationNodeIndex;\n       let parent = tNode.parent;\n       // Determine if a given TNode is a \"direct\" child of a node on which a content query was\n@@ -427,14 +428,15 @@ export function ɵɵqueryRefresh(queryList: QueryList<any>): boolean {\n   setCurrentQueryIndex(queryIndex + 1);\n \n   const tQuery = getTQuery(tView, queryIndex);\n-  if (queryList.dirty && (isCreationMode(lView) === tQuery.metadata.isStatic)) {\n+  const isStatic = (tQuery.metadata.flags & QueryFlags.isStatic) === QueryFlags.isStatic;\n+  if (queryList.dirty && (isCreationMode(lView) === isStatic)) {\n     if (tQuery.matches === null) {\n       queryList.reset([]);\n     } else {\n       const result = tQuery.crossesNgTemplate ?\n           collectQueryResults(tView, lView, queryIndex, []) :\n           materializeViewResults(tView, lView, tQuery, queryIndex);\n-      queryList.reset(result);\n+      queryList.reset(result, unwrapElementRef);\n       queryList.notifyOnChanges();\n     }\n     return true;\n@@ -447,40 +449,42 @@ export function ɵɵqueryRefresh(queryList: QueryList<any>): boolean {\n  * Creates new QueryList for a static view query.\n  *\n  * @param predicate The type for which the query will search\n- * @param descend Whether or not to descend into children\n+ * @param flags Flags associated with the query\n  * @param read What to save in the query\n  *\n  * @codeGenApi\n  */\n export function ɵɵstaticViewQuery<T>(\n-    predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean, read?: any): void {\n-  viewQueryInternal(getTView(), getLView(), predicate, descend, read, true);\n+    predicate: Type<any>|InjectionToken<unknown>|string[], flags: QueryFlags, read?: any): void {\n+  ngDevMode && assertNumber(flags, 'Expecting flags');\n+  viewQueryInternal(getTView(), getLView(), predicate, flags | QueryFlags.isStatic, read);\n }\n \n /**\n  * Creates new QueryList, stores the reference in LView and returns QueryList.\n  *\n  * @param predicate The type for which the query will search\n- * @param descend Whether or not to descend into children\n+ * @param flags Flags associated with the query\n  * @param read What to save in the query\n  *\n  * @codeGenApi\n  */\n export function ɵɵviewQuery<T>(\n-    predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean, read?: any): void {\n-  viewQueryInternal(getTView(), getLView(), predicate, descend, read, false);\n+    predicate: Type<any>|InjectionToken<unknown>|string[], flags: QueryFlags, read?: any): void {\n+  ngDevMode && assertNumber(flags, 'Expecting flags');\n+  viewQueryInternal(getTView(), getLView(), predicate, flags, read);\n }\n \n function viewQueryInternal<T>(\n     tView: TView, lView: LView, predicate: Type<any>|InjectionToken<unknown>|string[],\n-    descend: boolean, read: any, isStatic: boolean): void {\n+    flags: QueryFlags, read: any): void {\n   if (tView.firstCreatePass) {\n-    createTQuery(tView, new TQueryMetadata_(predicate, descend, isStatic, read), -1);\n-    if (isStatic) {\n+    createTQuery(tView, new TQueryMetadata_(predicate, flags, read), -1);\n+    if (flags & QueryFlags.isStatic) {\n       tView.staticViewQueries = true;\n     }\n   }\n-  createLQuery<T>(tView, lView);\n+  createLQuery<T>(tView, lView, flags);\n }\n \n /**\n@@ -489,17 +493,18 @@ function viewQueryInternal<T>(\n  *\n  * @param directiveIndex Current directive index\n  * @param predicate The type for which the query will search\n- * @param descend Whether or not to descend into children\n+ * @param flags Flags associated with the query\n  * @param read What to save in the query\n  * @returns QueryList<T>\n  *\n  * @codeGenApi\n  */\n export function ɵɵcontentQuery<T>(\n-    directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean,\n-    read?: any): void {\n+    directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[],\n+    flags: QueryFlags, read?: any): void {\n+  ngDevMode && assertNumber(flags, 'Expecting flags');\n   contentQueryInternal(\n-      getTView(), getLView(), predicate, descend, read, false, getCurrentTNode()!, directiveIndex);\n+      getTView(), getLView(), predicate, flags, read, false, getCurrentTNode()!, directiveIndex);\n }\n \n /**\n@@ -508,31 +513,32 @@ export function ɵɵcontentQuery<T>(\n  *\n  * @param directiveIndex Current directive index\n  * @param predicate The type for which the query will search\n- * @param descend Whether or not to descend into children\n+ * @param flags Flags associated with the query\n  * @param read What to save in the query\n  * @returns QueryList<T>\n  *\n  * @codeGenApi\n  */\n export function ɵɵstaticContentQuery<T>(\n-    directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[], descend: boolean,\n-    read?: any): void {\n+    directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[],\n+    flags: QueryFlags, read?: any): void {\n+  ngDevMode && assertNumber(flags, 'Expecting flags');\n   contentQueryInternal(\n-      getTView(), getLView(), predicate, descend, read, true, getCurrentTNode()!, directiveIndex);\n+      getTView(), getLView(), predicate, flags, read, true, getCurrentTNode()!, directiveIndex);\n }\n \n function contentQueryInternal<T>(\n     tView: TView, lView: LView, predicate: Type<any>|InjectionToken<unknown>|string[],\n-    descend: boolean, read: any, isStatic: boolean, tNode: TNode, directiveIndex: number): void {\n+    flags: QueryFlags, read: any, isStatic: boolean, tNode: TNode, directiveIndex: number): void {\n   if (tView.firstCreatePass) {\n-    createTQuery(tView, new TQueryMetadata_(predicate, descend, isStatic, read), tNode.index);\n+    createTQuery(tView, new TQueryMetadata_(predicate, flags, read), tNode.index);\n     saveContentQueryAndDirectiveIndex(tView, directiveIndex);\n     if (isStatic) {\n       tView.staticContentQueries = true;\n     }\n   }\n \n-  createLQuery<T>(tView, lView);\n+  createLQuery<T>(tView, lView, flags);\n }\n \n /**\n@@ -551,8 +557,9 @@ function loadQueryInternal<T>(lView: LView, queryIndex: number): QueryList<T> {\n   return lView[QUERIES]!.queries[queryIndex].queryList;\n }\n \n-function createLQuery<T>(tView: TView, lView: LView) {\n-  const queryList = new QueryList<T>();\n+function createLQuery<T>(tView: TView, lView: LView, flags: QueryFlags) {\n+  const queryList = new QueryList<T>(\n+      (flags & QueryFlags.emitDistinctChangesOnly) === QueryFlags.emitDistinctChangesOnly);\n   storeCleanupWithContext(tView, lView, queryList, queryList.destroy);\n \n   if (lView[QUERIES] === null) lView[QUERIES] = new LQueries_();"
        },
        {
            "sha": "90e5ffe8cfbabf0203c646413e2a23fe6b0eba35",
            "filename": "packages/core/src/util/array_utils.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -20,6 +20,31 @@ export function addAllToArray(items: any[], arr: any[]) {\n   }\n }\n \n+/**\n+ * Determines if the contents of two arrays is identical\n+ *\n+ * @param a first array\n+ * @param b second array\n+ * @param identityAccessor Optional functions for extracting stable object identity from a value in\n+ *     the array.\n+ */\n+export function arrayEquals<T>(a: T[], b: T[], identityAccessor?: (value: T) => unknown): boolean {\n+  if (a.length !== b.length) return false;\n+  for (let i = 0; i < a.length; i++) {\n+    let valueA = a[i];\n+    let valueB = b[i];\n+    if (identityAccessor) {\n+      valueA = identityAccessor(valueA) as any;\n+      valueB = identityAccessor(valueB) as any;\n+    }\n+    if (valueB !== valueA) {\n+      return false;\n+    }\n+  }\n+  return true;\n+}\n+\n+\n /**\n  * Flattens an array.\n  */"
        },
        {
            "sha": "e60248ab82ff39a96291fb54c11c5e0758901f54",
            "filename": "packages/core/src/view/query.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fview%2Fquery.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {ElementRef} from '../linker/element_ref';\n+import {ElementRef, unwrapElementRef} from '../linker/element_ref';\n import {QueryList} from '../linker/query_list';\n \n import {asElementData, asProviderData, asQueryList, NodeDef, NodeFlags, QueryBindingDef, QueryBindingType, QueryDef, QueryValueType, ViewData} from './types';\n@@ -50,8 +50,8 @@ export function queryDef(\n   };\n }\n \n-export function createQuery(): QueryList<any> {\n-  return new QueryList();\n+export function createQuery(emitDistinctChangesOnly: boolean): QueryList<any> {\n+  return new QueryList(emitDistinctChangesOnly);\n }\n \n export function dirtyParentQueries(view: ViewData) {\n@@ -107,7 +107,7 @@ export function checkAndUpdateQuery(view: ViewData, nodeDef: NodeDef) {\n     newValues = calcQueryValues(view, 0, view.def.nodes.length - 1, nodeDef.query!, []);\n     directiveInstance = view.component;\n   }\n-  queryList.reset(newValues);\n+  queryList.reset(newValues, unwrapElementRef);\n   const bindings = nodeDef.query!.bindings;\n   let notify = false;\n   for (let i = 0; i < bindings.length; i++) {"
        },
        {
            "sha": "caef9f00d7017f54f9c517216e956bf2a687fe50",
            "filename": "packages/core/src/view/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Ftypes.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fview%2Ftypes.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -209,6 +209,7 @@ export const enum NodeFlags {\n   StaticQuery = 1 << 28,\n   DynamicQuery = 1 << 29,\n   TypeNgModule = 1 << 30,\n+  EmitDistinctChangesOnly = 1 << 31,\n   CatQuery = TypeContentQuery | TypeViewQuery,\n \n   // mutually exclusive values..."
        },
        {
            "sha": "9a3c1a737a3382abdb7e9bb27493c49dc35227e2",
            "filename": "packages/core/src/view/view.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Fsrc%2Fview%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fview%2Fview.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -327,7 +327,9 @@ function createViewNodes(view: ViewData) {\n         break;\n       case NodeFlags.TypeContentQuery:\n       case NodeFlags.TypeViewQuery:\n-        nodeData = createQuery() as any;\n+        nodeData = createQuery(\n+                       (nodeDef.flags & NodeFlags.EmitDistinctChangesOnly) ===\n+                       NodeFlags.EmitDistinctChangesOnly) as any;\n         break;\n       case NodeFlags.TypeNgContent:\n         appendNgContent(view, renderHost, nodeDef);"
        },
        {
            "sha": "82da5b20e3b94c3b759ccd591edda69ed2d27f15",
            "filename": "packages/core/test/acceptance/query_spec.ts",
            "status": "modified",
            "additions": 72,
            "deletions": 1,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Facceptance%2Fquery_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Facceptance%2Fquery_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fquery_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -1123,6 +1123,46 @@ describe('query logic', () => {\n       fixture.detectChanges();\n       expect(changes).toBe(1);\n     });\n+\n+    it('should only fire if the content of the query changes', () => {\n+      // When views are inserted/removed the content query need to be recomputed.\n+      // Recomputing the query may result in no changes to the query (the item added/removed was\n+      // not part of the query). This tests asserts that the query does not fire when no changes\n+      // occur.\n+      TestBed.configureTestingModule(\n+          {declarations: [QueryCompWithStrictChangeEmitParent, QueryCompWithNoChanges]});\n+      const fixture = TestBed.createComponent(QueryCompWithNoChanges);\n+      let changesStrict = 0;\n+      const componentInstance = fixture.componentInstance.queryComp;\n+      fixture.detectChanges();\n+\n+      componentInstance.foos.changes.subscribe((value: any) => {\n+        // subscribe to the changes and record when changes occur.\n+        changesStrict += 1;\n+      });\n+\n+      // First verify that the subscription is working.\n+      fixture.componentInstance.innerShowing = false;\n+      fixture.detectChanges();\n+      expect(changesStrict).toBe(1);  // We detected a change\n+      expect(componentInstance.foos.toArray().length).toEqual(1);\n+\n+\n+      // now verify that removing a view does not needlessly fire subscription\n+      fixture.componentInstance.showing = false;\n+      fixture.detectChanges();\n+      expect(changesStrict).toBe(1);  // We detected a change\n+      expect(componentInstance.foos.toArray().length).toEqual(1);\n+\n+      // now verify that adding a view does not needlessly fire subscription\n+      fixture.componentInstance.showing = true;\n+      fixture.detectChanges();\n+      expect(changesStrict).toBe(1);  // We detected a change\n+      // Note: even though the `showing` is `true` and the second `<div>` is displayed, the\n+      // child element of that <div> is hidden because the `innerShowing` flag is still `false`,\n+      // so we expect only one element to be present in the `foos` array.\n+      expect(componentInstance.foos.toArray().length).toEqual(1);\n+    });\n   });\n \n   describe('view boundaries', () => {\n@@ -1219,7 +1259,7 @@ describe('query logic', () => {\n        * - detect the situation where the indexes are the same and do no processing in such case.\n        *\n        * This tests asserts on the implementation choices done by the VE (detach and insert) so we\n-       * can replicate the same behaviour in ivy.\n+       * can replicate the same behavior in ivy.\n        */\n       it('should notify on changes when a given view is removed and re-inserted at the same index',\n          () => {\n@@ -1964,6 +2004,37 @@ export class QueryCompWithChanges {\n   showing = false;\n }\n \n+@Component({\n+  selector: 'query-with-no-changes',\n+  template: `\n+    <query-component>\n+      <div *ngIf=\"true\" #foo></div>\n+      <div *ngIf=\"showing\">\n+        Showing me should not change the content of the query\n+        <div *ngIf=\"innerShowing\" #foo></div>\n+      </div>\n+    </query-component>\n+  `\n+})\n+export class QueryCompWithNoChanges {\n+  showing: boolean = true;\n+  innerShowing: boolean = true;\n+  queryComp!: QueryCompWithStrictChangeEmitParent;\n+}\n+\n+@Component({selector: 'query-component', template: `<ng-content></ng-content>`})\n+export class QueryCompWithStrictChangeEmitParent {\n+  @ContentChildren('foo', {\n+    descendants: true,\n+    emitDistinctChangesOnly: true,\n+  })\n+  foos!: QueryList<any>;\n+\n+  constructor(public queryCompWithNoChanges: QueryCompWithNoChanges) {\n+    queryCompWithNoChanges.queryComp = this;\n+  }\n+}\n+\n @Component({selector: 'query-target', template: '<ng-content></ng-content>'})\n class SuperDirectiveQueryTarget {\n }"
        },
        {
            "sha": "d7ca828b94523aec8f1880aeb21f50bec25486e1",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -1982,6 +1982,9 @@\n   {\n     \"name\": \"u\"\n   },\n+  {\n+    \"name\": \"unwrapElementRef\"\n+  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "e395b1f1e1bcc885347bc8cdd389e15322d45de2",
            "filename": "packages/core/test/render3/jit/declare_component_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -121,22 +121,24 @@ describe('component declaration jit compilation', () => {\n                       static: true,\n                       first: true,\n                       read: ElementRef,\n+                      emitDistinctChangesOnly: false,\n                     }\n                   ],\n                 }) as ComponentDef<TestClass>;\n \n     expectComponentDef(def, {\n       contentQueries: functionContaining([\n-        // \"byRef\" should use `contentQuery` with `false` for descendants flag without a read token,\n-        // and bind to the full query result.\n+        // \"byRef\" should use `contentQuery` with `0` (`QueryFlags.none`) for descendants flag\n+        // without a read token, and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,false\\)/,\n+        /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n-        // \"byToken\" should use `staticContentQuery` with `true` for descendants flag and\n-        // `ElementRef` as read token, and bind to the first result in the query result.\n+        // \"byToken\" should use `staticContentQuery` with `3`\n+        // (`QueryFlags.descendants|QueryFlags.isStatic`) for descendants flag and `ElementRef` as\n+        // read token, and bind to the first result in the query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:staticContentQuery|anonymous)[^(]*\\(dirIndex,[^,]*String[^,]*,true,[^)]*ElementRef[^)]*\\)/,\n+        /(?:contentQuery|anonymous)[^(]*\\(dirIndex,[^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n         '(ctx.byToken = _t.first)',\n       ]),\n     });\n@@ -158,22 +160,24 @@ describe('component declaration jit compilation', () => {\n                       static: true,\n                       first: true,\n                       read: ElementRef,\n+                      emitDistinctChangesOnly: false,\n                     }\n                   ],\n                 }) as ComponentDef<TestClass>;\n \n     expectComponentDef(def, {\n       viewQuery: functionContaining([\n-        // \"byRef\" should use `viewQuery` with `false` for descendants flag without a read token,\n-        // and bind to the full query result.\n-        // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:viewQuery|anonymous)[^(]*\\(_c0,false\\)/,\n+        // \"byRef\" should use `viewQuery` with `0` (`QueryFlags.none`) for query flag without a read\n+        // token, and bind to the full query result. NOTE: the `anonymous` match is to support IE11,\n+        // as functions don't have a name there.\n+        /(?:viewQuery|anonymous)[^(]*\\(_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n-        // \"byToken\" should use `staticViewQuery` with `true` for descendants flag and\n-        // `ElementRef` as read token, and bind to the first result in the query result.\n+        // \"byToken\" should use `viewQuery` with `3`\n+        // (`QueryFlags.descendants|QueryFlags.isStatic`) for descendants flag and `ElementRef` as\n+        // read token, and bind to the first result in the query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:staticViewQuery|anonymous)[^(]*\\([^,]*String[^,]*,true,[^)]*ElementRef[^)]*\\)/,\n+        /(?:viewQuery|anonymous)[^(]*\\([^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n         '(ctx.byToken = _t.first)',\n       ]),\n     });"
        },
        {
            "sha": "08ef808b8341f9593623d73cae6753c75d3cee7b",
            "filename": "packages/core/test/render3/jit/declare_directive_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -95,22 +95,24 @@ describe('directive declaration jit compilation', () => {\n                       static: true,\n                       first: true,\n                       read: ElementRef,\n+                      emitDistinctChangesOnly: false,\n                     }\n                   ],\n                 }) as DirectiveDef<TestClass>;\n \n     expectDirectiveDef(def, {\n       contentQueries: functionContaining([\n-        // \"byRef\" should use `contentQuery` with `false` for descendants flag without a read token,\n-        // and bind to the full query result.\n+        // \"byRef\" should use `contentQuery` with `0` (`QueryFlags.descendants|QueryFlags.isStatic`)\n+        // for descendants flag without a read token, and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,false\\)/,\n+        /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n-        // \"byToken\" should use `staticContentQuery` with `true` for descendants flag and\n-        // `ElementRef` as read token, and bind to the first result in the query result.\n+        // \"byToken\" should use `viewQuery` with `3` (`QueryFlags.static|QueryFlags.descendants`)\n+        // for descendants flag and `ElementRef` as read token, and bind to the first result in the\n+        // query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:staticContentQuery|anonymous)[^(]*\\(dirIndex,[^,]*String[^,]*,true,[^)]*ElementRef[^)]*\\)/,\n+        /(?:contentQuery|anonymous)[^(]*\\([^,]*dirIndex,[^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n         '(ctx.byToken = _t.first)',\n       ]),\n     });\n@@ -131,6 +133,7 @@ describe('directive declaration jit compilation', () => {\n                       static: true,\n                       first: true,\n                       read: ElementRef,\n+                      emitDistinctChangesOnly: false,\n                     }\n                   ],\n                 }) as DirectiveDef<TestClass>;\n@@ -140,13 +143,14 @@ describe('directive declaration jit compilation', () => {\n         // \"byRef\" should use `viewQuery` with `false` for descendants flag without a read token,\n         // and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:viewQuery|anonymous)[^(]*\\(_c0,false\\)/,\n+        /(?:viewQuery|anonymous)[^(]*\\(_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n-        // \"byToken\" should use `staticViewQuery` with `true` for descendants flag and\n-        // `ElementRef` as read token, and bind to the first result in the query result.\n+        // \"byToken\" should use `viewQuery` with `3` (`QueryFlags.static|QueryFlags.descendants`)\n+        // for descendants flag and `ElementRef` as read token, and bind to the first result in the\n+        // query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n-        /(?:staticViewQuery|anonymous)[^(]*\\([^,]*String[^,]*,true,[^)]*ElementRef[^)]*\\)/,\n+        /(?:viewQuery|anonymous)[^(]*\\([^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n         '(ctx.byToken = _t.first)',\n       ]),\n     });"
        },
        {
            "sha": "5b41d82ec0a4787742d267a924c46259e3f6a740",
            "filename": "packages/core/test/render3/jit/directive_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdirective_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdirective_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdirective_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -51,13 +51,15 @@ describe('jit directive helper functions', () => {\n         isViewQuery: false,\n         read: undefined,\n         static: false,\n+        emitDistinctChangesOnly: false,\n       })).toEqual({\n         propertyName: 'propName',\n         predicate: ['localRef'],\n         descendants: false,\n         first: false,\n         read: null,\n-        static: false\n+        static: false,\n+        emitDistinctChangesOnly: false,\n       });\n     });\n \n@@ -69,13 +71,15 @@ describe('jit directive helper functions', () => {\n         isViewQuery: true,\n         read: undefined,\n         static: false,\n+        emitDistinctChangesOnly: false,\n       })).toEqual({\n         propertyName: 'propName',\n         predicate: ['foo', 'bar', 'baz'],\n         descendants: true,\n         first: true,\n         read: null,\n-        static: false\n+        static: false,\n+        emitDistinctChangesOnly: false,\n       });\n     });\n \n@@ -88,7 +92,8 @@ describe('jit directive helper functions', () => {\n         first: true,\n         isViewQuery: true,\n         read: Directive,\n-        static: false\n+        static: false,\n+        emitDistinctChangesOnly: false,\n       });\n \n       expect(converted.predicate).toEqual(Directive);"
        },
        {
            "sha": "b0bd6ece633cac41bdf35bebcd27e64a5a8e3f67",
            "filename": "packages/core/test/render3/query_spec.ts",
            "status": "modified",
            "additions": 49,
            "deletions": 48,
            "changes": 97,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {ElementRef, QueryList, TemplateRef, ViewContainerRef} from '@angular/core';\n+import {QueryFlags} from '@angular/core/src/render3/interfaces/query';\n import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n \n import {AttributeMarker, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵProvidersFeature} from '../../src/render3/index';\n@@ -80,8 +81,8 @@ describe('query', () => {\n         2, 0, [Child], [],\n         function(rf: RenderFlags, ctx: any) {\n           if (rf & RenderFlags.Create) {\n-            ɵɵviewQuery(Child, false);\n-            ɵɵviewQuery(Child, true);\n+            ɵɵviewQuery(Child, QueryFlags.none);\n+            ɵɵviewQuery(Child, QueryFlags.descendants);\n           }\n           if (rf & RenderFlags.Update) {\n             let tmp: any;\n@@ -119,7 +120,7 @@ describe('query', () => {\n             1, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(Child, false, ElementRef);\n+                ɵɵviewQuery(Child, QueryFlags.none, ElementRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -158,7 +159,7 @@ describe('query', () => {\n             1, 0, [Child, OtherChild], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(Child, false, OtherChild);\n+                ɵɵviewQuery(Child, QueryFlags.none, OtherChild);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -193,7 +194,7 @@ describe('query', () => {\n             1, 0, [Child, OtherChild], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(Child, false, OtherChild);\n+                ɵɵviewQuery(Child, QueryFlags.none, OtherChild);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -263,9 +264,9 @@ describe('query', () => {\n             viewQuery:\n                 function(rf: RenderFlags, ctx: App) {\n                   if (rf & RenderFlags.Create) {\n-                    ɵɵviewQuery(MyDirective, false);\n-                    ɵɵviewQuery(Service, false);\n-                    ɵɵviewQuery(Alias, false);\n+                    ɵɵviewQuery(MyDirective, QueryFlags.none);\n+                    ɵɵviewQuery(Service, QueryFlags.none);\n+                    ɵɵviewQuery(Alias, QueryFlags.none);\n                   }\n                   if (rf & RenderFlags.Update) {\n                     let tmp: any;\n@@ -315,7 +316,7 @@ describe('query', () => {\n                 function(rf: RenderFlags, ctx: App) {\n                   let tmp: any;\n                   if (rf & RenderFlags.Create) {\n-                    ɵɵviewQuery(MyDirective, false, Alias);\n+                    ɵɵviewQuery(MyDirective, QueryFlags.none, Alias);\n                   }\n                   if (rf & RenderFlags.Update) {\n                     ɵɵqueryRefresh(tmp = ɵɵloadQuery<QueryList<any>>()) &&\n@@ -353,7 +354,7 @@ describe('query', () => {\n             3, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false);\n+                ɵɵviewQuery(['foo'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -392,8 +393,8 @@ describe('query', () => {\n             4, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false);\n-                ɵɵviewQuery(['bar'], false);\n+                ɵɵviewQuery(['foo'], QueryFlags.none);\n+                ɵɵviewQuery(['bar'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -441,7 +442,7 @@ describe('query', () => {\n             5, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo', 'bar'], false);\n+                ɵɵviewQuery(['foo', 'bar'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -479,7 +480,7 @@ describe('query', () => {\n             3, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false);\n+                ɵɵviewQuery(['foo'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -517,7 +518,7 @@ describe('query', () => {\n                2, 0, [], [],\n                function(rf: RenderFlags, ctx: any) {\n                  if (rf & RenderFlags.Create) {\n-                   ɵɵviewQuery(['foo'], false, ElementRef);\n+                   ɵɵviewQuery(['foo'], QueryFlags.none, ElementRef);\n                  }\n                  if (rf & RenderFlags.Update) {\n                    let tmp: any;\n@@ -554,7 +555,7 @@ describe('query', () => {\n             2, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], true);\n+                ɵɵviewQuery(['foo'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -588,7 +589,7 @@ describe('query', () => {\n             2, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, ViewContainerRef);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, ViewContainerRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -621,7 +622,7 @@ describe('query', () => {\n             2, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, ViewContainerRef);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, ViewContainerRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -655,7 +656,7 @@ describe('query', () => {\n                2, 0, [], [],\n                function(rf: RenderFlags, ctx: any) {\n                  if (rf & RenderFlags.Create) {\n-                   ɵɵviewQuery(['foo'], false, ElementRef);\n+                   ɵɵviewQuery(['foo'], QueryFlags.none, ElementRef);\n                  }\n                  if (rf & RenderFlags.Update) {\n                    let tmp: any;\n@@ -690,7 +691,7 @@ describe('query', () => {\n             2, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false);\n+                ɵɵviewQuery(['foo'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -724,7 +725,7 @@ describe('query', () => {\n             2, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, TemplateRef);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, TemplateRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -763,7 +764,7 @@ describe('query', () => {\n             2, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], true);\n+                ɵɵviewQuery(['foo'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -810,7 +811,7 @@ describe('query', () => {\n             2, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], true);\n+                ɵɵviewQuery(['foo'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -850,7 +851,7 @@ describe('query', () => {\n                2, 0, [Child], [],\n                function(rf: RenderFlags, ctx: any) {\n                  if (rf & RenderFlags.Create) {\n-                   ɵɵviewQuery(['foo'], true);\n+                   ɵɵviewQuery(['foo'], QueryFlags.descendants);\n                  }\n                  if (rf & RenderFlags.Update) {\n                    let tmp: any;\n@@ -891,7 +892,7 @@ describe('query', () => {\n             3, 0, [Child1, Child2], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo', 'bar'], true);\n+                ɵɵviewQuery(['foo', 'bar'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -932,8 +933,8 @@ describe('query', () => {\n             3, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], true);\n-                ɵɵviewQuery(['bar'], true);\n+                ɵɵviewQuery(['foo'], QueryFlags.descendants);\n+                ɵɵviewQuery(['bar'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -977,7 +978,7 @@ describe('query', () => {\n             2, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, ElementRef);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, ElementRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1017,7 +1018,7 @@ describe('query', () => {\n             3, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo', 'bar'], false);\n+                ɵɵviewQuery(['foo', 'bar'], QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1053,7 +1054,7 @@ describe('query', () => {\n             2, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, Child);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, Child);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1088,7 +1089,7 @@ describe('query', () => {\n             1, 0, [Child, OtherChild], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(Child, false, OtherChild);\n+                ɵɵviewQuery(Child, QueryFlags.none, OtherChild);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1123,7 +1124,7 @@ describe('query', () => {\n             1, 0, [Child, OtherChild], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(OtherChild, false, Child);\n+                ɵɵviewQuery(OtherChild, QueryFlags.none, Child);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1155,7 +1156,7 @@ describe('query', () => {\n             1, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(TemplateRef as any, false, ElementRef);\n+                ɵɵviewQuery(TemplateRef as any, QueryFlags.none, ElementRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1188,7 +1189,7 @@ describe('query', () => {\n             2, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(['foo'], false, Child);\n+                ɵɵviewQuery(['foo'], QueryFlags.none, Child);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1223,7 +1224,7 @@ describe('query', () => {\n             1, 0, [Child], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(TemplateRef as any, false);\n+                ɵɵviewQuery(TemplateRef as any, QueryFlags.none);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1270,8 +1271,8 @@ describe('query', () => {\n             6, 0, [], [],\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n-                ɵɵviewQuery(TemplateRef as any, false);\n-                ɵɵviewQuery(TemplateRef as any, false, ElementRef);\n+                ɵɵviewQuery(TemplateRef as any, QueryFlags.none);\n+                ɵɵviewQuery(TemplateRef as any, QueryFlags.none, ElementRef);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1334,7 +1335,7 @@ describe('query', () => {\n         3, 0, [SomeDir], [],\n         function(rf: RenderFlags, ctx: any) {\n           if (rf & RenderFlags.Create) {\n-            ɵɵviewQuery(['foo'], true);\n+            ɵɵviewQuery(['foo'], QueryFlags.descendants);\n           }\n           if (rf & RenderFlags.Update) {\n             let tmp: any;\n@@ -1376,7 +1377,7 @@ describe('query', () => {\n         contentQueries:\n             (rf: RenderFlags, ctx: any, dirIndex: number) => {\n               if (rf & RenderFlags.Create) {\n-                ɵɵcontentQuery(dirIndex, ['foo'], true);\n+                ɵɵcontentQuery(dirIndex, ['foo'], QueryFlags.descendants);\n               }\n               if (rf & RenderFlags.Update) {\n                 let tmp: any;\n@@ -1463,7 +1464,7 @@ describe('query', () => {\n           5, 0, [WithContentDirective], [],\n           function(rf: RenderFlags, ctx: any) {\n             if (rf & RenderFlags.Create) {\n-              ɵɵviewQuery(['foo', 'bar'], true);\n+              ɵɵviewQuery(['foo', 'bar'], QueryFlags.descendants);\n             }\n             if (rf & RenderFlags.Update) {\n               let tmp: any;\n@@ -1505,7 +1506,7 @@ describe('query', () => {\n           5, 0, [WithContentDirective], [],\n           function(rf: RenderFlags, ctx: any) {\n             if (rf & RenderFlags.Create) {\n-              ɵɵviewQuery(['bar'], true);\n+              ɵɵviewQuery(['bar'], QueryFlags.descendants);\n             }\n             if (rf & RenderFlags.Update) {\n               let tmp: any;\n@@ -1533,7 +1534,7 @@ describe('query', () => {\n                 // @ContentChildren('foo, bar, baz', {descendants: true})\n                 // fooBars: QueryList<ElementRef>;\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵcontentQuery(dirIndex, ['foo', 'bar', 'baz'], true);\n+                  ɵɵcontentQuery(dirIndex, ['foo', 'bar', 'baz'], QueryFlags.descendants);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   let tmp: any;\n@@ -1602,7 +1603,7 @@ describe('query', () => {\n                 // @ContentChildren('foo', {descendants: true})\n                 // fooBars: QueryList<ElementRef>;\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵcontentQuery(dirIndex, ['foo'], false);\n+                  ɵɵcontentQuery(dirIndex, ['foo'], QueryFlags.none);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   let tmp: any;\n@@ -1662,7 +1663,7 @@ describe('query', () => {\n                 // @ContentChildren('foo', {descendants: true})\n                 // fooBars: QueryList<ElementRef>;\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵcontentQuery(dirIndex, ['foo'], false);\n+                  ɵɵcontentQuery(dirIndex, ['foo'], QueryFlags.none);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   let tmp: any;\n@@ -1726,7 +1727,7 @@ describe('query', () => {\n                    // @ContentChildren('foo', {descendants: false})\n                    // foos: QueryList<ElementRef>;\n                    if (rf & RenderFlags.Create) {\n-                     ɵɵcontentQuery(dirIndex, ['foo'], false);\n+                     ɵɵcontentQuery(dirIndex, ['foo'], QueryFlags.none);\n                    }\n                    if (rf & RenderFlags.Update) {\n                      let tmp: any;\n@@ -1748,7 +1749,7 @@ describe('query', () => {\n                    // @ContentChildren('foo', {descendants: true})\n                    // foos: QueryList<ElementRef>;\n                    if (rf & RenderFlags.Create) {\n-                     ɵɵcontentQuery(dirIndex, ['foo'], true);\n+                     ɵɵcontentQuery(dirIndex, ['foo'], QueryFlags.descendants);\n                    }\n                    if (rf & RenderFlags.Update) {\n                      let tmp: any;\n@@ -1824,7 +1825,7 @@ describe('query', () => {\n                 // @ContentChildren(TextDirective, {descendants: true})\n                 // texts: QueryList<TextDirective>;\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵcontentQuery(dirIndex, TextDirective, true);\n+                  ɵɵcontentQuery(dirIndex, TextDirective, QueryFlags.descendants);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   let tmp: any;\n@@ -1910,7 +1911,7 @@ describe('query', () => {\n               function(rf: RenderFlags, ctx: ViewQueryComponent) {\n                 let tmp: any;\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵviewQuery(TextDirective, true);\n+                  ɵɵviewQuery(TextDirective, QueryFlags.descendants);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   ɵɵqueryRefresh(tmp = ɵɵloadQuery<QueryList<TextDirective>>()) &&"
        },
        {
            "sha": "877bec2de8accca952f7289e43021e0e04844544",
            "filename": "packages/core/test/render3/view_container_ref_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e32b6256ce7cc28a774180c42a88535bf3e468bf/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts?ref=e32b6256ce7cc28a774180c42a88535bf3e468bf",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {QueryFlags} from '@angular/core/src/render3/interfaces/query';\n import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n import {ChangeDetectorRef, Component as _Component, ComponentFactoryResolver, ElementRef, QueryList, TemplateRef, ViewContainerRef, ViewRef} from '../../src/core';\n import {ViewEncapsulation} from '../../src/metadata';\n@@ -368,7 +369,7 @@ describe('ViewContainerRef', () => {\n           viewQuery:\n               function(rf: RenderFlags, ctx: any) {\n                 if (rf & RenderFlags.Create) {\n-                  ɵɵviewQuery(['foo'], true);\n+                  ɵɵviewQuery(['foo'], QueryFlags.descendants);\n                 }\n                 if (rf & RenderFlags.Update) {\n                   let tmp: any;"
        }
    ],
    "stats": {
        "total": 946,
        "additions": 719,
        "deletions": 227
    }
}