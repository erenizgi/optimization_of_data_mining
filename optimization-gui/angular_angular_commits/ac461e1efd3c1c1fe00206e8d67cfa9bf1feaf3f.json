{
    "author": "petebacondarwin",
    "message": "fix(localize): extract the correct message ids (#38498)\n\nPreviously, if `useLegacyIds` was enabled, the message extractor\nwas always rendering the legacy message ids in translation\nfiles even if an explicit \"custom message id\" had been provided\nin the original message.\n\nPR Close #38498",
    "sha": "ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
    "files": [
        {
            "sha": "334a508b0fea3c2da612963f6b74d5dc3f2bc5d5",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -107,6 +107,8 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n   /**\n    * Get the id for the given `message`.\n    *\n+   * If there was a custom id provided, use that.\n+   *\n    * If we have requested legacy message ids, then try to return the appropriate id\n    * from the list of legacy ids that were extracted.\n    *\n@@ -116,7 +118,8 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n    * https://csrc.nist.gov/csrc/media/publications/fips/180/4/final/documents/fips180-4-draft-aug2014.pdf\n    */\n   private getMessageId(message: ɵParsedMessage): string {\n-    return this.useLegacyIds && message.legacyIds !== undefined &&\n+    return message.customId ||\n+        this.useLegacyIds && message.legacyIds !== undefined &&\n         message.legacyIds.find(id => id.length === LEGACY_XLIFF_MESSAGE_LENGTH) ||\n         message.id;\n   }"
        },
        {
            "sha": "66ed022474f9aebac7c2c8a840a2a9873905bb69",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -120,6 +120,8 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n   /**\n    * Get the id for the given `message`.\n    *\n+   * If there was a custom id provided, use that.\n+   *\n    * If we have requested legacy message ids, then try to return the appropriate id\n    * from the list of legacy ids that were extracted.\n    *\n@@ -130,7 +132,8 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n    * https://github.com/google/closure-compiler/blob/master/src/com/google/javascript/jscomp/GoogleJsMessageIdGenerator.java\n    */\n   private getMessageId(message: ɵParsedMessage): string {\n-    return this.useLegacyIds && message.legacyIds !== undefined &&\n+    return message.customId ||\n+        this.useLegacyIds && message.legacyIds !== undefined &&\n         message.legacyIds.find(\n             id => id.length <= MAX_LEGACY_XLIFF_2_MESSAGE_LENGTH && !/[^0-9]/.test(id)) ||\n         message.id;"
        },
        {
            "sha": "a43437731f5fb6fb2c9a77c93da2c3aa2adf3986",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xmb_translation_serializer.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -99,6 +99,8 @@ export class XmbTranslationSerializer implements TranslationSerializer {\n   /**\n    * Get the id for the given `message`.\n    *\n+   * If there was a custom id provided, use that.\n+   *\n    * If we have requested legacy message ids, then try to return the appropriate id\n    * from the list of legacy ids that were extracted.\n    *\n@@ -109,7 +111,8 @@ export class XmbTranslationSerializer implements TranslationSerializer {\n    * https://github.com/google/closure-compiler/blob/master/src/com/google/javascript/jscomp/GoogleJsMessageIdGenerator.java\n    */\n   private getMessageId(message: ɵParsedMessage): string {\n-    return this.useLegacyIds && message.legacyIds !== undefined &&\n+    return message.customId ||\n+        this.useLegacyIds && message.legacyIds !== undefined &&\n         message.legacyIds.find(id => id.length <= 20 && !/[^0-9]/.test(id)) ||\n         message.id;\n   }"
        },
        {
            "sha": "b45e9cfda30ad4f6f2669f6fbf75f465d0e43505",
            "filename": "packages/localize/src/tools/test/extract/extractor_spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -23,14 +23,16 @@ runInEachFileSystem(() => {\n       fs.ensureDir(absoluteFrom('/root/path/relative'));\n       fs.writeFile(file, [\n         '$localize`:meaning|description:a${1}b${2}c`;',\n-        '$localize(__makeTemplateObject([\"a\", \":custom-placeholder:b\", \"c\"], [\"a\", \":custom-placeholder:b\", \"c\"]), 1, 2);'\n+        '$localize(__makeTemplateObject([\"a\", \":custom-placeholder:b\", \"c\"], [\"a\", \":custom-placeholder:b\", \"c\"]), 1, 2);',\n+        '$localize`:@@custom-id:a${1}b${2}c`;',\n       ].join('\\n'));\n       const messages = extractor.extractMessages(filename);\n \n-      expect(messages.length).toEqual(2);\n+      expect(messages.length).toEqual(3);\n \n       expect(messages[0]).toEqual({\n         id: '2714330828844000684',\n+        customId: undefined,\n         description: 'description',\n         meaning: 'meaning',\n         messageParts: ['a', 'b', 'c'],\n@@ -43,6 +45,7 @@ runInEachFileSystem(() => {\n \n       expect(messages[1]).toEqual({\n         id: '5692770902395945649',\n+        customId: undefined,\n         description: '',\n         meaning: '',\n         messageParts: ['a', 'b', 'c'],\n@@ -52,6 +55,19 @@ runInEachFileSystem(() => {\n         legacyIds: [],\n         location: {start: {line: 1, column: 0}, end: {line: 1, column: 111}, file},\n       });\n+\n+      expect(messages[2]).toEqual({\n+        id: 'custom-id',\n+        customId: 'custom-id',\n+        description: '',\n+        meaning: '',\n+        messageParts: ['a', 'b', 'c'],\n+        text: 'a{$PH}b{$PH_1}c',\n+        placeholderNames: ['PH', 'PH_1'],\n+        substitutions: jasmine.any(Object),\n+        legacyIds: [],\n+        location: {start: {line: 2, column: 9}, end: {line: 2, column: 35}, file},\n+      });\n     });\n   });\n });"
        },
        {
            "sha": "1fa46237bc9a9226ba35ee9216b87341cf06b3c9",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 179,
            "deletions": 128,
            "changes": 307,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -55,138 +55,189 @@ runInEachFileSystem(() => {\n       ].join('\\n'));\n     });\n \n-    it('should extract translations from source code, and write as JSON format', () => {\n-      extractTranslations({\n-        rootPath,\n-        sourceLocale: 'en-GB',\n-        sourceFilePaths: [sourceFilePath],\n-        format: 'json',\n-        outputPath,\n-        logger,\n-        useSourceMaps: false,\n-        useLegacyIds: false,\n-        duplicateMessageHandling: 'ignore',\n-      });\n-      expect(fs.readFile(outputPath)).toEqual([\n-        `{`,\n-        `  \"locale\": \"en-GB\",`,\n-        `  \"translations\": {`,\n-        `    \"3291030485717846467\": \"Hello, {$PH}!\",`,\n-        `    \"8669027859022295761\": \"try{$PH}me\"`,\n-        `  }`,\n-        `}`,\n-      ].join('\\n'));\n-    });\n+    for (const useLegacyIds of [true, false]) {\n+      describe(useLegacyIds ? '[using legacy ids]' : '', () => {\n+        it('should extract translations from source code, and write as JSON format', () => {\n+          extractTranslations({\n+            rootPath,\n+            sourceLocale: 'en-GB',\n+            sourceFilePaths: [sourceFilePath],\n+            format: 'json',\n+            outputPath,\n+            logger,\n+            useSourceMaps: false,\n+            useLegacyIds,\n+            duplicateMessageHandling: 'ignore',\n+          });\n+          expect(fs.readFile(outputPath)).toEqual([\n+            `{`,\n+            `  \"locale\": \"en-GB\",`,\n+            `  \"translations\": {`,\n+            `    \"3291030485717846467\": \"Hello, {$PH}!\",`,\n+            `    \"8669027859022295761\": \"try{$PH}me\",`,\n+            `    \"custom-id\": \"Custom id message\",`,\n+            `    \"273296103957933077\": \"Legacy id message\",`,\n+            `    \"custom-id-2\": \"Custom and legacy message\"`,\n+            `  }`,\n+            `}`,\n+          ].join('\\n'));\n+        });\n \n-    it('should extract translations from source code, and write as xmb format', () => {\n-      extractTranslations({\n-        rootPath,\n-        sourceLocale: 'en',\n-        sourceFilePaths: [sourceFilePath],\n-        format: 'xmb',\n-        outputPath,\n-        logger,\n-        useSourceMaps: false,\n-        useLegacyIds: false,\n-        duplicateMessageHandling: 'ignore',\n-      });\n-      expect(fs.readFile(outputPath)).toEqual([\n-        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n-        `<!DOCTYPE messagebundle [`,\n-        `<!ELEMENT messagebundle (msg)*>`,\n-        `<!ATTLIST messagebundle class CDATA #IMPLIED>`,\n-        ``,\n-        `<!ELEMENT msg (#PCDATA|ph|source)*>`,\n-        `<!ATTLIST msg id CDATA #IMPLIED>`,\n-        `<!ATTLIST msg seq CDATA #IMPLIED>`,\n-        `<!ATTLIST msg name CDATA #IMPLIED>`,\n-        `<!ATTLIST msg desc CDATA #IMPLIED>`,\n-        `<!ATTLIST msg meaning CDATA #IMPLIED>`,\n-        `<!ATTLIST msg obsolete (obsolete) #IMPLIED>`,\n-        `<!ATTLIST msg xml:space (default|preserve) \"default\">`,\n-        `<!ATTLIST msg is_hidden CDATA #IMPLIED>`,\n-        ``,\n-        `<!ELEMENT source (#PCDATA)>`,\n-        ``,\n-        `<!ELEMENT ph (#PCDATA|ex)*>`,\n-        `<!ATTLIST ph name CDATA #REQUIRED>`,\n-        ``,\n-        `<!ELEMENT ex (#PCDATA)>`,\n-        `]>`,\n-        `<messagebundle>`,\n-        `  <msg id=\"3291030485717846467\"><source>test_files/test.js:1</source>Hello, <ph name=\"PH\"/>!</msg>`,\n-        `  <msg id=\"8669027859022295761\"><source>test_files/test.js:2</source>try<ph name=\"PH\"/>me</msg>`,\n-        `</messagebundle>\\n`,\n-      ].join('\\n'));\n-    });\n+        it('should extract translations from source code, and write as xmb format', () => {\n+          extractTranslations({\n+            rootPath,\n+            sourceLocale: 'en',\n+            sourceFilePaths: [sourceFilePath],\n+            format: 'xmb',\n+            outputPath,\n+            logger,\n+            useSourceMaps: false,\n+            useLegacyIds,\n+            duplicateMessageHandling: 'ignore',\n+          });\n+          expect(fs.readFile(outputPath)).toEqual([\n+            `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+            `<!DOCTYPE messagebundle [`,\n+            `<!ELEMENT messagebundle (msg)*>`,\n+            `<!ATTLIST messagebundle class CDATA #IMPLIED>`,\n+            ``,\n+            `<!ELEMENT msg (#PCDATA|ph|source)*>`,\n+            `<!ATTLIST msg id CDATA #IMPLIED>`,\n+            `<!ATTLIST msg seq CDATA #IMPLIED>`,\n+            `<!ATTLIST msg name CDATA #IMPLIED>`,\n+            `<!ATTLIST msg desc CDATA #IMPLIED>`,\n+            `<!ATTLIST msg meaning CDATA #IMPLIED>`,\n+            `<!ATTLIST msg obsolete (obsolete) #IMPLIED>`,\n+            `<!ATTLIST msg xml:space (default|preserve) \"default\">`,\n+            `<!ATTLIST msg is_hidden CDATA #IMPLIED>`,\n+            ``,\n+            `<!ELEMENT source (#PCDATA)>`,\n+            ``,\n+            `<!ELEMENT ph (#PCDATA|ex)*>`,\n+            `<!ATTLIST ph name CDATA #REQUIRED>`,\n+            ``,\n+            `<!ELEMENT ex (#PCDATA)>`,\n+            `]>`,\n+            `<messagebundle>`,\n+            `  <msg id=\"3291030485717846467\"><source>test_files/test.js:1</source>Hello, <ph name=\"PH\"/>!</msg>`,\n+            `  <msg id=\"8669027859022295761\"><source>test_files/test.js:2</source>try<ph name=\"PH\"/>me</msg>`,\n+            `  <msg id=\"custom-id\"><source>test_files/test.js:3</source>Custom id message</msg>`,\n+            `  <msg id=\"${\n+                useLegacyIds ?\n+                    '12345678901234567890' :\n+                    '273296103957933077'}\"><source>test_files/test.js:5</source>Legacy id message</msg>`,\n+            `  <msg id=\"custom-id-2\"><source>test_files/test.js:7</source>Custom and legacy message</msg>`,\n+            `</messagebundle>\\n`,\n+          ].join('\\n'));\n+        });\n \n-    it('should extract translations from source code, and write as XLIFF 1.2 format', () => {\n-      extractTranslations({\n-        rootPath,\n-        sourceLocale: 'en-CA',\n-        sourceFilePaths: [sourceFilePath],\n-        format: 'xliff',\n-        outputPath,\n-        logger,\n-        useSourceMaps: false,\n-        useLegacyIds: false,\n-        duplicateMessageHandling: 'ignore',\n-      });\n-      expect(fs.readFile(outputPath)).toEqual([\n-        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n-        `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n-        `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n-        `    <body>`,\n-        `      <trans-unit id=\"3291030485717846467\" datatype=\"html\">`,\n-        `        <source>Hello, <x id=\"PH\"/>!</source>`,\n-        `        <context-group purpose=\"location\">`,\n-        `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n-        `          <context context-type=\"linenumber\">2</context>`,\n-        `        </context-group>`,\n-        `      </trans-unit>`,\n-        `      <trans-unit id=\"8669027859022295761\" datatype=\"html\">`,\n-        `        <source>try<x id=\"PH\"/>me</source>`,\n-        `        <context-group purpose=\"location\">`,\n-        `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n-        `          <context context-type=\"linenumber\">3</context>`,\n-        `        </context-group>`,\n-        `      </trans-unit>`,\n-        `    </body>`,\n-        `  </file>`,\n-        `</xliff>\\n`,\n-      ].join('\\n'));\n-    });\n+        it('should extract translations from source code, and write as XLIFF 1.2 format', () => {\n+          extractTranslations({\n+            rootPath,\n+            sourceLocale: 'en-CA',\n+            sourceFilePaths: [sourceFilePath],\n+            format: 'xliff',\n+            outputPath,\n+            logger,\n+            useSourceMaps: false,\n+            useLegacyIds,\n+            duplicateMessageHandling: 'ignore',\n+          });\n+          expect(fs.readFile(outputPath)).toEqual([\n+            `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+            `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n+            `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n+            `    <body>`,\n+            `      <trans-unit id=\"3291030485717846467\" datatype=\"html\">`,\n+            `        <source>Hello, <x id=\"PH\"/>!</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">2</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"8669027859022295761\" datatype=\"html\">`,\n+            `        <source>try<x id=\"PH\"/>me</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">3</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"custom-id\" datatype=\"html\">`,\n+            `        <source>Custom id message</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">4</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"${\n+                useLegacyIds ? '1234567890123456789012345678901234567890' :\n+                               '273296103957933077'}\" datatype=\"html\">`,\n+            `        <source>Legacy id message</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">6</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"custom-id-2\" datatype=\"html\">`,\n+            `        <source>Custom and legacy message</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+            `          <context context-type=\"linenumber\">8</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n+            `    </body>`,\n+            `  </file>`,\n+            `</xliff>\\n`,\n+          ].join('\\n'));\n+        });\n \n-    it('should extract translations from source code, and write as XLIFF 2 format', () => {\n-      extractTranslations({\n-        rootPath,\n-        sourceLocale: 'en-AU',\n-        sourceFilePaths: [sourceFilePath],\n-        format: 'xliff2',\n-        outputPath,\n-        logger,\n-        useSourceMaps: false,\n-        useLegacyIds: false,\n-        duplicateMessageHandling: 'ignore',\n+        it('should extract translations from source code, and write as XLIFF 2 format', () => {\n+          extractTranslations({\n+            rootPath,\n+            sourceLocale: 'en-AU',\n+            sourceFilePaths: [sourceFilePath],\n+            format: 'xliff2',\n+            outputPath,\n+            logger,\n+            useSourceMaps: false,\n+            useLegacyIds,\n+            duplicateMessageHandling: 'ignore',\n+          });\n+          expect(fs.readFile(outputPath)).toEqual([\n+            `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+            `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"en-AU\">`,\n+            `  <file>`,\n+            `    <unit id=\"3291030485717846467\">`,\n+            `      <segment>`,\n+            `        <source>Hello, <ph id=\"0\" equiv=\"PH\"/>!</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"8669027859022295761\">`,\n+            `      <segment>`,\n+            `        <source>try<ph id=\"0\" equiv=\"PH\"/>me</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"custom-id\">`,\n+            `      <segment>`,\n+            `        <source>Custom id message</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"${useLegacyIds ? '12345678901234567890' : '273296103957933077'}\">`,\n+            `      <segment>`,\n+            `        <source>Legacy id message</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"custom-id-2\">`,\n+            `      <segment>`,\n+            `        <source>Custom and legacy message</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `  </file>`,\n+            `</xliff>\\n`,\n+          ].join('\\n'));\n+        });\n       });\n-      expect(fs.readFile(outputPath)).toEqual([\n-        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n-        `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"en-AU\">`,\n-        `  <file>`,\n-        `    <unit id=\"3291030485717846467\">`,\n-        `      <segment>`,\n-        `        <source>Hello, <ph id=\"0\" equiv=\"PH\"/>!</source>`,\n-        `      </segment>`,\n-        `    </unit>`,\n-        `    <unit id=\"8669027859022295761\">`,\n-        `      <segment>`,\n-        `        <source>try<ph id=\"0\" equiv=\"PH\"/>me</source>`,\n-        `      </segment>`,\n-        `    </unit>`,\n-        `  </file>`,\n-        `</xliff>\\n`,\n-      ].join('\\n'));\n-    });\n+    }\n \n     for (const target of ['es2015', 'es5']) {\n       it(`should render the original location of translations, when processing an ${"
        },
        {
            "sha": "e098bc127d8ef216e08116a648395a883ceb9e6a",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/test.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -1,3 +1,8 @@\n var name = 'World';\n var message = $localize`Hello, ${name}!`;\n-var other = $localize(__makeTemplateObject(['try', 'me'], ['try', 'me']), 40 + 2);\n\\ No newline at end of file\n+var other = $localize(__makeTemplateObject(['try', 'me'], ['try', 'me']), 40 + 2);\n+var customMessage = $localize`:@@custom-id:Custom id message`;\n+var legacyMessage =\n+    $localize`:␟1234567890123456789012345678901234567890␟12345678901234567890:Legacy id message`;\n+var customAndLegacyMessage =\n+    $localize`:@@custom-id-2␟1234567890123456789012345678901234567890␟12345678901234567890:Custom and legacy message`;"
        },
        {
            "sha": "2816ca2600f7cb19f3c9c890d553636d48765569",
            "filename": "packages/localize/src/tools/test/extract/translation_files/json_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -16,6 +16,9 @@ describe('JsonTranslationSerializer', () => {\n     it('should convert a set of parsed messages into a JSON string', () => {\n       const messages: ɵParsedMessage[] = [\n         mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {meaning: 'some meaning'}),\n+        mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+          customId: 'someId',\n+        }),\n         mockMessage(\n             '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n             {description: 'some description'}),\n@@ -49,7 +52,8 @@ describe('JsonTranslationSerializer', () => {\n         `    \"80808\": \"multi\\\\nlines\",`,\n         `    \"90000\": \"<escape{$double-quotes-\\\\\"}me>\",`,\n         `    \"100000\": \"pre-ICU {VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}} post-ICU\",`,\n-        `    \"100001\": \"{VAR_PLURAL, plural, one {{START_BOLD_TEXT}something bold{CLOSE_BOLD_TEXT}} other {pre {START_TAG_SPAN}middle{CLOSE_TAG_SPAN} post}}\"`,\n+        `    \"100001\": \"{VAR_PLURAL, plural, one {{START_BOLD_TEXT}something bold{CLOSE_BOLD_TEXT}} other {pre {START_TAG_SPAN}middle{CLOSE_TAG_SPAN} post}}\",`,\n+        `    \"someId\": \"a{$PH}b{$PH_1}c\"`,\n         `  }`,\n         `}`,\n       ].join('\\n'));"
        },
        {
            "sha": "19cfe6d96c67e4774279379292761caae83f2a8c",
            "filename": "packages/localize/src/tools/test/extract/translation_files/mock_message.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -9,28 +9,31 @@ import {ɵParsedMessage} from '@angular/localize';\n import {SourceLocation} from '@angular/localize/src/utils';\n \n export interface MockMessageOptions {\n+  customId?: string;\n   meaning?: string;\n   description?: string;\n   location?: SourceLocation;\n   legacyIds?: string[];\n }\n+\n /**\n  * This helper is used to create `ParsedMessage` objects to be rendered in the\n  * `TranslationSerializer` tests.\n  */\n export function mockMessage(\n     id: string, messageParts: string[], placeholderNames: string[],\n-    {meaning = '', description = '', location, legacyIds = []}: MockMessageOptions):\n+    {customId, meaning = '', description = '', location, legacyIds = []}: MockMessageOptions):\n     ɵParsedMessage {\n   let text = messageParts[0];\n   for (let i = 1; i < messageParts.length; i++) {\n     text += `{$${placeholderNames[i - 1]}}${messageParts[i]}`;\n   }\n   return {\n-    id,\n+    id: customId || id,  // customId trumps id\n     text,\n     messageParts,\n     placeholderNames,\n+    customId,\n     description,\n     meaning,\n     substitutions: [],"
        },
        {
            "sha": "9b66fb96fee21d43cbb4c36791346d3856664481",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -28,6 +28,10 @@ runInEachFileSystem(() => {\n               },\n               legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n             }),\n+            mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              customId: 'someId',\n+              legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+            }),\n             mockMessage(\n                 '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n                 {description: 'some description'}),\n@@ -66,6 +70,9 @@ runInEachFileSystem(() => {\n             `        </context-group>`,\n             `        <note priority=\"1\" from=\"meaning\">some meaning</note>`,\n             `      </trans-unit>`,\n+            `      <trans-unit id=\"someId\" datatype=\"html\">`,\n+            `        <source>a<x id=\"PH\"/>b<x id=\"PH_1\"/>c</source>`,\n+            `      </trans-unit>`,\n             `      <trans-unit id=\"67890\" datatype=\"html\">`,\n             `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n             `        <note priority=\"1\" from=\"description\">some description</note>`,"
        },
        {
            "sha": "8e98690fcd83381b82396f642fae3b022c97cd6e",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -29,6 +29,10 @@ runInEachFileSystem(() => {\n               },\n               legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n             }),\n+            mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              customId: 'someId',\n+              legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+            }),\n             mockMessage('67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n               description: 'some description',\n               location: {\n@@ -70,6 +74,11 @@ runInEachFileSystem(() => {\n             `        <source>a<ph id=\"0\" equiv=\"PH\"/>b<ph id=\"1\" equiv=\"PH_1\"/>c</source>`,\n             `      </segment>`,\n             `    </unit>`,\n+            `    <unit id=\"someId\">`,\n+            `      <segment>`,\n+            `        <source>a<ph id=\"0\" equiv=\"PH\"/>b<ph id=\"1\" equiv=\"PH_1\"/>c</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n             `    <unit id=\"67890\">`,\n             `      <notes>`,\n             `        <note category=\"location\">file.ts:3,4</note>`,"
        },
        {
            "sha": "1c735018721d11201b564fa87c2802a9d38997e3",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xmb_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -23,6 +23,10 @@ runInEachFileSystem(() => {\n               meaning: 'some meaning',\n               legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n             }),\n+            mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              customId: 'someId',\n+              legacyIds: ['87654321FEDCBA0987654321FEDCBA0987654321', '563965274788097516'],\n+            }),\n             mockMessage(\n                 '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n                 {description: 'some description'}),\n@@ -51,6 +55,7 @@ runInEachFileSystem(() => {\n                 useLegacyIds ?\n                     '615790887472569365' :\n                     '12345'}\" meaning=\"some meaning\">a<ph name=\"PH\"/>b<ph name=\"PH_1\"/>c</msg>`,\n+            `  <msg id=\"someId\">a<ph name=\"PH\"/>b<ph name=\"PH_1\"/>c</msg>`,\n             `  <msg id=\"67890\" desc=\"some description\">a<ph name=\"START_TAG_SPAN\"/><ph name=\"CLOSE_TAG_SPAN\"/>c</msg>`,\n             `  <msg id=\"13579\"><ph name=\"START_BOLD_TEXT\"/>b<ph name=\"CLOSE_BOLD_TEXT\"/></msg>`,\n             `  <msg id=\"24680\" desc=\"and description\" meaning=\"meaning\">a</msg>`,"
        },
        {
            "sha": "fdf938276a682b224941a85f8f7917f9237c7aa5",
            "filename": "packages/localize/src/utils/src/messages.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -58,10 +58,6 @@ export interface MessageMetadata {\n    * A human readable rendering of the message\n    */\n   text: string;\n-  /**\n-   * A unique identifier for this message.\n-   */\n-  id?: MessageId;\n   /**\n    * Legacy message ids, if provided.\n    *\n@@ -73,6 +69,12 @@ export interface MessageMetadata {\n    * of translation if the translations are encoded using the legacy message id.\n    */\n   legacyIds?: string[];\n+  /**\n+   * The id of the `message` if a custom one was specified explicitly.\n+   *\n+   * This id overrides any computed or legacy ids.\n+   */\n+  customId?: string;\n   /**\n    * The meaning of the `message`, used to distinguish identical `messageString`s.\n    */\n@@ -110,8 +112,6 @@ export interface MessageMetadata {\n export interface ParsedMessage extends MessageMetadata {\n   /**\n    * The key used to look up the appropriate translation target.\n-   *\n-   * In `ParsedMessage` this is a required field, whereas it is optional in `MessageMetadata`.\n    */\n   id: MessageId;\n   /**\n@@ -129,7 +129,8 @@ export interface ParsedMessage extends MessageMetadata {\n }\n \n /**\n- * Parse a `$localize` tagged string into a structure that can be used for translation.\n+ * Parse a `$localize` tagged string into a structure that can be used for translation or\n+ * extraction.\n  *\n  * See `ParsedMessage` for an example.\n  */\n@@ -151,13 +152,14 @@ export function parseMessage(\n     placeholderNames.push(placeholderName);\n     cleanedMessageParts.push(messagePart);\n   }\n-  const messageId = metadata.id || computeMsgId(messageString, metadata.meaning || '');\n+  const messageId = metadata.customId || computeMsgId(messageString, metadata.meaning || '');\n   const legacyIds = metadata.legacyIds ? metadata.legacyIds.filter(id => id !== messageId) : [];\n   return {\n     id: messageId,\n     legacyIds,\n     substitutions,\n     text: messageString,\n+    customId: metadata.customId,\n     meaning: metadata.meaning || '',\n     description: metadata.description || '',\n     messageParts: cleanedMessageParts,\n@@ -198,7 +200,7 @@ export function parseMetadata(cooked: string, raw: string): MessageMetadata {\n     return {text: messageString};\n   } else {\n     const [meaningDescAndId, ...legacyIds] = block.split(LEGACY_ID_INDICATOR);\n-    const [meaningAndDesc, id] = meaningDescAndId.split(ID_SEPARATOR, 2);\n+    const [meaningAndDesc, customId] = meaningDescAndId.split(ID_SEPARATOR, 2);\n     let [meaning, description]: (string|undefined)[] = meaningAndDesc.split(MEANING_SEPARATOR, 2);\n     if (description === undefined) {\n       description = meaning;\n@@ -207,7 +209,7 @@ export function parseMetadata(cooked: string, raw: string): MessageMetadata {\n     if (description === '') {\n       description = undefined;\n     }\n-    return {text: messageString, meaning, description, id, legacyIds};\n+    return {text: messageString, meaning, description, customId, legacyIds};\n   }\n }\n "
        },
        {
            "sha": "4bcd12cd1d625bb1908c6bccb851d51404387145",
            "filename": "packages/localize/src/utils/test/messages_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 14,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Futils%2Ftest%2Fmessages_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f/packages%2Flocalize%2Fsrc%2Futils%2Ftest%2Fmessages_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Futils%2Ftest%2Fmessages_spec.ts?ref=ac461e1efd3c1c1fe00206e8d67cfa9bf1feaf3f",
            "patch": "@@ -9,13 +9,14 @@ import {findEndOfBlock, makeTemplateObject, parseMessage, parseMetadata, splitBl\n \n describe('messages utils', () => {\n   describe('parseMessage', () => {\n-    it('should use the custom id parsed from the metadata if available', () => {\n+    it('should use the custom id parsed from the metadata for the message id, if available', () => {\n       const message = parseMessage(\n           makeTemplateObject(\n               [':@@custom-message-id:a', ':one:b', ':two:c'],\n               [':@@custom-message-id:a', ':one:b', ':two:c']),\n           [1, 2]);\n-      expect(message.id).toEqual('custom-message-id');\n+      expect(message.customId).toEqual('custom-message-id');\n+      expect(message.id).toEqual(message.customId!);\n     });\n \n     it('should compute the translation key if no metadata', () => {\n@@ -24,7 +25,7 @@ describe('messages utils', () => {\n       expect(message.id).toEqual('8865273085679272414');\n     });\n \n-    it('should compute the translation key if no id in the metadata', () => {\n+    it('should compute the translation key if no custom id in the metadata', () => {\n       const message = parseMessage(\n           makeTemplateObject(\n               [':description:a', ':one:b', ':two:c'], [':description:a', ':one:b', ':two:c']),\n@@ -181,45 +182,45 @@ describe('messages utils', () => {\n         text: 'abc def',\n         description: 'description',\n         meaning: undefined,\n-        id: undefined,\n+        customId: undefined,\n         legacyIds: []\n       });\n       expect(parseMetadata(':meaning|:abc def', ':meaning|:abc def')).toEqual({\n         text: 'abc def',\n         description: undefined,\n         meaning: 'meaning',\n-        id: undefined,\n+        customId: undefined,\n         legacyIds: []\n       });\n       expect(parseMetadata(':@@message-id:abc def', ':@@message-id:abc def')).toEqual({\n         text: 'abc def',\n         description: undefined,\n         meaning: undefined,\n-        id: 'message-id',\n+        customId: 'message-id',\n         legacyIds: []\n       });\n       expect(parseMetadata(':meaning|description:abc def', ':meaning|description:abc def'))\n           .toEqual({\n             text: 'abc def',\n             description: 'description',\n             meaning: 'meaning',\n-            id: undefined,\n+            customId: undefined,\n             legacyIds: []\n           });\n       expect(parseMetadata(':description@@message-id:abc def', ':description@@message-id:abc def'))\n           .toEqual({\n             text: 'abc def',\n             description: 'description',\n             meaning: undefined,\n-            id: 'message-id',\n+            customId: 'message-id',\n             legacyIds: []\n           });\n       expect(parseMetadata(':meaning|@@message-id:abc def', ':meaning|@@message-id:abc def'))\n           .toEqual({\n             text: 'abc def',\n             description: undefined,\n             meaning: 'meaning',\n-            id: 'message-id',\n+            customId: 'message-id',\n             legacyIds: []\n           });\n       expect(parseMetadata(\n@@ -229,7 +230,7 @@ describe('messages utils', () => {\n             text: 'abc def',\n             description: 'description',\n             meaning: undefined,\n-            id: 'message-id',\n+            customId: 'message-id',\n             legacyIds: ['legacy-1', 'legacy-2', 'legacy-3']\n           });\n       expect(parseMetadata(\n@@ -239,7 +240,7 @@ describe('messages utils', () => {\n             text: 'abc def',\n             description: undefined,\n             meaning: 'meaning',\n-            id: 'message-id',\n+            customId: 'message-id',\n             legacyIds: ['legacy-message-id']\n           });\n       expect(parseMetadata(\n@@ -248,15 +249,15 @@ describe('messages utils', () => {\n             text: 'abc def',\n             description: undefined,\n             meaning: 'meaning',\n-            id: undefined,\n+            customId: undefined,\n             legacyIds: ['legacy-message-id']\n           });\n \n       expect(parseMetadata(':␟legacy-message-id:abc def', ':␟legacy-message-id:abc def')).toEqual({\n         text: 'abc def',\n         description: undefined,\n         meaning: undefined,\n-        id: undefined,\n+        customId: undefined,\n         legacyIds: ['legacy-message-id']\n       });\n     });\n@@ -266,7 +267,7 @@ describe('messages utils', () => {\n         text: 'abc def',\n         meaning: undefined,\n         description: undefined,\n-        id: undefined,\n+        customId: undefined,\n         legacyIds: []\n       });\n     });"
        }
    ],
    "stats": {
        "total": 434,
        "additions": 273,
        "deletions": 161
    }
}