{
    "author": "kapunahelewong",
    "message": "docs: move template ref vars doc to concepts section clarify, add scope section, and update headers (#31195)\n\nFixes #31186. This commit adds more context about the behavior\nof template reference variables in nested templates and moves\ndoc into concepts section.\n\nPR Close #31195",
    "sha": "e3d2f46bbdc27b57011b57247894f85297f54923",
    "files": [
        {
            "sha": "9a9e6dc50f0124b8f9ed178fbf05426811bb8d6f",
            "filename": "aio/content/examples/template-reference-variables/src/app/app.component.css",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.css",
            "raw_url": "https://github.com/angular/angular/raw/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.css",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.css?ref=e3d2f46bbdc27b57011b57247894f85297f54923",
            "patch": "@@ -0,0 +1,14 @@\n+h3 {\n+  font-weight: 700;\n+}\n+\n+pre, .wrapper {\n+  background-color: rgb(240, 250, 250);\n+  padding: 1rem;\n+  border: 1px solid #444;\n+}\n+\n+input {\n+  margin: .5rem;\n+  padding: .5rem;\n+}"
        },
        {
            "sha": "5458d96ad3990f51b0cdf6acbca2bc034d27b4f9",
            "filename": "aio/content/examples/template-reference-variables/src/app/app.component.html",
            "status": "modified",
            "additions": 58,
            "deletions": 2,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.html",
            "raw_url": "https://github.com/angular/angular/raw/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.html?ref=e3d2f46bbdc27b57011b57247894f85297f54923",
            "patch": "@@ -39,8 +39,7 @@ <h2>Template reference variable with disabled button</h2>\n <h2>Reference variables, forms, and NgForm</h2>\n <!-- #docregion ngForm -->\n <form #itemForm=\"ngForm\" (ngSubmit)=\"onSubmit(itemForm)\">\n-  <label for=\"name\"\n-    >Name <input class=\"form-control\" name=\"name\" ngModel required />\n+  <label for=\"name\">Name <input class=\"form-control\" name=\"name\" ngModel required />\n   </label>\n   <button type=\"submit\">Submit</button>\n </form>\n@@ -53,3 +52,60 @@ <h2>Reference variables, forms, and NgForm</h2>\n \n \n <p>JSON: {{ itemForm.form.value | json }}</p>\n+\n+<hr />\n+\n+<h2>Template Reference Variable Scope</h2>\n+\n+<p>This section demonstrates in which situations you can access local template reference variables (<code>#ref</code>).</p>\n+\n+<h3>Accessing in a child template</h3>\n+<!-- Accessing a template reference variable from an inner template\n+  works as the context is inherited. Try changing the text in the\n+  input to see how it is immediately reflected through the template\n+  reference variable. -->\n+\n+<div class=\"example\">\n+  <!-- #docregion template-ref-vars-scope1 -->\n+  <input #ref1 type=\"text\" [(ngModel)]=\"firstExample\" />\n+  <span *ngIf=\"true\">Value: {{ ref1.value }}</span>\n+  <!-- #enddocregion template-ref-vars-scope1 -->\n+</div>\n+\n+<!-- In this case there's a \"hidden\" ng-template around the\n+  span and the definition of the variable is outside of it. Thus, you access a template variable from a parent template (which is logical as the context is inherited). -->\n+\n+<p>Here's the desugared syntax:</p>\n+<pre><code [innerText]=\"desugared1\"></code></pre>\n+\n+<h3>Accessing from outside parent template. (Doesn't work.)</h3>\n+<!-- Accessing the template reference variable from outside the parent template does\n+not work. The value to the right is empty and changing the\n+value of the input will have no effect. -->\n+\n+<div class=\"example\">\n+  <!-- #docregion template-ref-vars-scope2 -->\n+  <input *ngIf=\"true\" #ref2 type=\"text\" [(ngModel)]=\"secondExample\" />\n+  <!-- <span>Value: {{ ref2?.value }}</span> -->\n+  <!-- uncomment the above and the app breaks -->\n+  <!-- #enddocregion template-ref-vars-scope2 -->\n+</div>\n+\n+<p>Here's the desugared syntax:</p>\n+<pre><code [innerText]=\"desugared2\"></code></pre>\n+\n+<h3>*ngFor and template reference variable scope</h3>\n+\n+<!-- The template is instantiated twice because *ngFor iterates\n+  over the two items in the array, so it's impossible to define what ref2 is referencing. -->\n+\n+<pre><code [innerText]=\"ngForExample\"></code></pre>\n+\n+<h3>Accessing a on an <code>ng-template</code></h3>\n+\n+See the console output to see that when you declare the variable on an <code>ng-template</code>, the variable refers to a <code>TemplateRef</code> instance, which represents the template.\n+\n+<!-- #docregion template-ref -->\n+<ng-template #ref3></ng-template>\n+<button (click)=\"log(ref3)\">Log type of #ref</button>\n+<!-- #enddocregion template-ref -->"
        },
        {
            "sha": "3ed03c8d82ff2e824e32da390e7de1ab02c661c2",
            "filename": "aio/content/examples/template-reference-variables/src/app/app.component.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Ftemplate-reference-variables%2Fsrc%2Fapp%2Fapp.component.ts?ref=e3d2f46bbdc27b57011b57247894f85297f54923",
            "patch": "@@ -8,7 +8,38 @@ import { NgForm } from '@angular/forms';\n   styleUrls: ['./app.component.css']\n })\n export class AppComponent {\n-  @ViewChild('itemForm') form: NgForm;\n+\n+  public firstExample = 'Hello, World!';\n+  public secondExample = 'Hello, World!';\n+\n+  public ref2 = '';\n+\n+  public desugared1 = `\n+  <input #ref1 type=\"text\" [(ngModel)]=\"firstExample\" /><!-- A new template! -->\n+  <ng-template [ngIf]=\"true\">\n+    <!-- … and it works  -->\n+    <span>Value: {{ ref1.value }}</span>\n+  </ng-template>`\n+  ;\n+\n+  public desugared2 = `<ng-template [ngIf]=\"true\">\n+    <!-- The reference, ref2, is defined within a template -->\n+    <input #ref2 type=\"text\" [(ngModel)]=\"secondExample\" />\n+  </ng-template>\n+\n+  <!-- Attempting to access ref2 from outside the above template doesn't work. -->\n+  <span>Value: {{ ref2?.value }}</span>`;\n+\n+    public ngForExample = `<ng-container *ngFor=\"let i of [1,2]\">\n+    <input #ref type=\"text\" [value]=\"i\" />\n+  </ng-container>\n+\n+  <!-- The template is instantiated twice because *ngFor iterates\n+  over the two items in the array, so it's impossible to define what ref2 is referencing.-->\n+\n+  {{ ref.value }}`;\n+\n+  @ViewChild('itemForm', { static: false }) form: NgForm;\n \n   get submitMessage() { return this._submitMessage; }\n   private _submitMessage = '';  // tslint:disable-line: variable-name\n@@ -25,4 +56,7 @@ export class AppComponent {\n     console.warn(`Faxing ${value} ...`);\n   }\n \n+  log(ref3: any) {\n+    console.warn(ref3.constructor);\n+  }\n }"
        },
        {
            "sha": "a95a0699d58cf7e23d08315e8af8922e3a5772a8",
            "filename": "aio/content/guide/template-reference-variables.md",
            "status": "modified",
            "additions": 114,
            "deletions": 29,
            "changes": 143,
            "blob_url": "https://github.com/angular/angular/blob/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fguide%2Ftemplate-reference-variables.md",
            "raw_url": "https://github.com/angular/angular/raw/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fguide%2Ftemplate-reference-variables.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Ftemplate-reference-variables.md?ref=e3d2f46bbdc27b57011b57247894f85297f54923",
            "patch": "@@ -1,69 +1,154 @@\n-# Template reference variables (`#var`)\n+# Template variables\n \n-A **template reference variable** is often a reference to a DOM element within a template.\n-It can also refer to a directive (which contains a component), an element, [TemplateRef](api/core/TemplateRef), or a <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\" title=\"MDN: Web Components\">web component</a>.\n+Template variables help you use data from one part of a template in another part of the template.\n+With template variables, you can perform tasks such as respond to user input or finely tune your application's forms.\n+\n+A template variable can refer to the following:\n+\n+* a DOM element within a template\n+* a directive\n+* an element\n+* [TemplateRef](api/core/TemplateRef)\n+* a <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\" title=\"MDN: Web Components\">web component</a>\n \n <div class=\"alert is-helpful\">\n \n See the <live-example></live-example> for a working example containing the code snippets in this guide.\n \n </div>\n \n-Use the hash symbol (#) to declare a reference variable.\n-The following reference variable, `#phone`, declares a `phone` variable on an `<input>` element.\n+## Syntax\n+\n+In the template, you use the hash symbol, `#`, to declare a template variable.\n+The following template variable, `#phone`, declares a `phone` variable on an `<input>` element.\n \n <code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"ref-var\" header=\"src/app/app.component.html\"></code-example>\n \n-You can refer to a template reference variable anywhere in the component's template.\n+You can refer to a template variable anywhere in the component's template.\n Here, a `<button>` further down the template refers to the `phone` variable.\n \n <code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"ref-phone\" header=\"src/app/app.component.html\"></code-example>\n \n-Angular assigns each template reference variable a value based on where you declare the variable:\n+## How Angular assigns values to template variables\n+\n+Angular assigns a template variable a value based on where you declare the variable:\n \n * If you declare the variable on a component, the variable refers to the component instance.\n * If you declare the variable on a standard HTML tag, the variable refers to the element.\n * If you declare the variable on an `<ng-template>` element, the variable refers to a `TemplateRef` instance, which represents the template.\n+  For more information on `<ng-template>`, see the [ng-template](guide/structural-directives#the-ng-template) section of [Structural directives](guide/structural-directives).\n * If the variable specifies a name on the right-hand side, such as `#var=\"ngModel\"`, the variable refers to the directive or component on the element with a matching `exportAs` name.\n+<!-- What does the second half of this mean?^^ Can we explain this more fully? Could I see a working example? -kw -->\n \n-<h3 class=\"no-toc\">How a reference variable gets its value</h3>\n+### Using `NgForm` with template variables\n \n-In most cases, Angular sets the reference variable's value to the element on which it is declared.\n+In most cases, Angular sets the template variable's value to the element on which it occurs.\n In the previous example, `phone` refers to the phone number `<input>`.\n The button's click handler passes the `<input>` value to the component's `callPhone()` method.\n \n-The `NgForm` directive can change that behavior and set the value to something else. In the following example, the template reference variable, `itemForm`, appears three times separated\n-by HTML.\n+The `NgForm` directive demonstrates getting a reference to a different value by reference a directive's `exportAs` name.\n+In the following example, the template variable, `itemForm`, appears three times separated by HTML.\n \n <code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"ngForm\" header=\"src/app/hero-form.component.html\"></code-example>\n \n-The reference value of `itemForm`, without the `ngForm` attribute value, would be\n-the [HTMLFormElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement).\n-There is, however, a difference between a `Component` and a `Directive` in that a `Component`\n-will be referenced without specifying the attribute value, and a `Directive` will not\n-change the implicit reference (that is, the element).\n+Without the `ngForm` attribute value, the reference value of `itemForm` would be\n+the [HTMLFormElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement), `<form>`.\n+There is, however, a difference between a `Component` and a `Directive` in that Angular references a `Component` without specifying the attribute value, and a `Directive` does not change the implicit reference, or the element.\n+<!-- What is the train of thought from talking about a form element to the difference between a component and a directive? Why is the component directive conversation relevant here?  -kw -->\n+\n+With `NgForm`, `itemForm` is a reference to the [NgForm](api/forms/NgForm \"API: NgForm\") directive with the ability to track the value and validity of every control in the form.\n+\n+Unlike the native `<form>` element, the `NgForm` directive has a `form` property.\n+The `NgForm` `form` property allows you to disable the submit button if the `itemForm.form.valid` is invalid.\n+\n+\n+## Template variable scope\n+\n+You can refer to a template variable anywhere within its surrounding template.\n+[Structural directives](guide/built-in-directives), such as `*ngIf` and `*ngFor`, or `<ng-template>` act as a template boundary.\n+You cannot access template variables outside of these boundaries.\n+\n+<div class=\"alert is-helpful\">\n+\n+Define a variable only once in the template so the runtime value remains predictable.\n+\n+</div>\n+\n+### Accessing in a nested template\n+\n+An inner template can access template variables that the outer template defines.\n+\n+In the following example, changing the text in the `<input>` changes the value in the `<span>` because Angular immediately updates changes through the template variable, `ref1`.\n+\n+<code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"template-ref-vars-scope1\" header=\"src/app/app.component.html\"></code-example>\n+\n+In this case, there is an implied `<ng-template>` around the `<span>` and the definition of the variable is outside of it.\n+Accessing a template variable from the parent template works because the child template inherits the context from the parent template.\n+\n+Rewriting the above code in a more verbose form explicitly shows the `<ng-template>`.\n+\n+```html\n+\n+<input #ref1 type=\"text\" [(ngModel)]=\"firstExample\" />\n+\n+<!-- New template -->\n+<ng-template [ngIf]=\"true\">\n+  <!-- Since the context is inherited, the value is available to the new template -->\n+  <span>Value: {{ ref1.value }}</span>\n+</ng-template>\n+\n+```\n+\n+However, accessing a template variable from outside the parent template doesn't work.\n+\n+```html\n+  <input *ngIf=\"true\" #ref2 type=\"text\" [(ngModel)]=\"secondExample\" />\n+  <span>Value: {{ ref2?.value }}</span> <!-- doesn't work -->\n+```\n+\n+The verbose form shows that `ref2` is outside the parent template.\n+\n+```\n+<ng-template [ngIf]=\"true\">\n+  <!-- The reference is defined within a template -->\n+  <input #ref2 type=\"text\" [(ngModel)]=\"secondExample\" />\n+</ng-template>\n+<!-- ref2 accessed from outside that template doesn't work -->\n+<span>Value: {{ ref2?.value }}</span>\n+```\n+\n+Consider the following example that uses `*ngFor`.\n \n+```\n+<ng-container *ngFor=\"let i of [1,2]\">\n+  <input #ref type=\"text\" [value]=\"i\" />\n+</ng-container>\n+{{ ref.value }}\n+```\n \n+Here, `ref.value` doesn't work.\n+The structural directive, `*ngFor` instantiates the template twice because `*ngFor` iterates over the two items in the array.\n+It is impossible to define what the `ref.value` reference signifies.\n \n-However, with `NgForm`, `itemForm` is a reference to the [NgForm](api/forms/NgForm \"API: NgForm\")\n-directive with the ability to track the value and validity of every control in the form.\n+With structural directives, such as `*ngFor` or `*ngIf`, there is no way for Angular to know if a template is ever instantiated.\n \n-The native `<form>` element doesn't have a `form` property, but the `NgForm` directive does, which allows disabling the submit button\n-if the `itemForm.form.valid` is invalid and passing the entire form control tree\n-to the parent component's `onSubmit()` method.\n+As a result, Angular isn't able to access the value and returns an error.\n \n-<h3 class=\"no-toc\">Template reference variable considerations</h3>\n+### Accessing a template variable within `<ng-template>`\n \n-A template _reference_ variable (`#phone`) is not the same as a template _input_ variable (`let phone`) such as in an [`*ngFor`](guide/built-in-directives#template-input-variable).\n-See [_Structural directives_](guide/structural-directives#template-input-variable) for more information.\n+When you declare the variable on an `<ng-template>`, the variable refers to a `TemplateRef` instance, which represents the template.\n \n-The scope of a reference variable is the entire template. So, don't define the same variable name more than once in the same template as the runtime value will be unpredictable.\n+<code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"template-ref\" header=\"src/app/app.component.html\"></code-example>\n \n-### Alternative syntax\n+In this example, clicking the button calls the `log()` function, which outputs the value of `#ref3` to the console.\n+Because the `#ref` variable is on an `<ng-template>`, the value is `TemplateRef`.\n \n-You can use the `ref-` prefix alternative to `#`.\n-This example declares the `fax` variable as `ref-fax` instead of `#fax`.\n+The following is the expanded browser console output of the `TemplateRef()` function with the name of `TemplateRef`.\n \n+<code-example language=\"sh\">\n \n-<code-example path=\"template-reference-variables/src/app/app.component.html\" region=\"ref-fax\" header=\"src/app/app.component.html\"></code-example>\n+&#9660; ƒ TemplateRef()\n+name: \"TemplateRef\"\n+__proto__: Function\n \n+</code-example>"
        },
        {
            "sha": "af963ed7523ffba29dde1d322c969eddbce4a175",
            "filename": "aio/content/navigation.json",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fnavigation.json",
            "raw_url": "https://github.com/angular/angular/raw/e3d2f46bbdc27b57011b57247894f85297f54923/aio%2Fcontent%2Fnavigation.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fnavigation.json?ref=e3d2f46bbdc27b57011b57247894f85297f54923",
            "patch": "@@ -192,11 +192,6 @@\n               \"title\": \"Two-way binding\",\n               \"tooltip\": \"Introductory guide to sharing data between a class and a template.\"\n             },\n-            {\n-              \"url\": \"guide/template-reference-variables\",\n-              \"title\": \"Template reference variables\",\n-              \"tooltip\": \"Introductory guide to referring to DOM elements within a template.\"\n-            },\n             {\n               \"url\": \"guide/template-expression-operators\",\n               \"title\": \"Template expression operators\",\n@@ -777,6 +772,11 @@\n                   \"url\": \"guide/event-binding-concepts\",\n                   \"title\": \"How event binding works\",\n                   \"tooltip\": \"About event binding.\"\n+                },\n+                {\n+                  \"url\": \"guide/template-reference-variables\",\n+                  \"title\": \"Template variables\",\n+                  \"tooltip\": \"Introductory guide to referring to DOM elements within a template.\"\n                 }\n               ]\n             },"
        }
    ],
    "stats": {
        "total": 263,
        "additions": 226,
        "deletions": 37
    }
}