{
    "author": "josephperrott",
    "message": "build: update release configuration to use new release notes system (#41905)\n\nUpdate the ng-dev config for release to use the new release notes system\nfor generating release notes.\n\nPR Close #41905",
    "sha": "5c9bd237e34c38ae03a4defd5776aba56deec131",
    "files": [
        {
            "sha": "b7795290743f33cde005cf6901f809fa72e67ea1",
            "filename": ".ng-dev/release.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/5c9bd237e34c38ae03a4defd5776aba56deec131/.ng-dev%2Frelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/5c9bd237e34c38ae03a4defd5776aba56deec131/.ng-dev%2Frelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Frelease.ts?ref=5c9bd237e34c38ae03a4defd5776aba56deec131",
            "patch": "@@ -1,5 +1,4 @@\n import {join} from 'path';\n-import {exec} from 'shelljs';\n import {ReleaseConfig} from '../dev-infra/release/config';\n \n /** Configuration for the `ng-dev release` command. */\n@@ -29,9 +28,8 @@ export const release: ReleaseConfig = {\n     const {buildTargetPackages} = require(join(__dirname, '../scripts/build/package-builder'));\n     return buildTargetPackages('dist/release-output', false, 'Release', true);\n   },\n-  // TODO: This can be removed once there is an org-wide tool for changelog generation.\n-  generateReleaseNotesForHead: async () => {\n-    exec('yarn -s gulp changelog', {cwd: join(__dirname, '../')});\n+  releaseNotes: {\n+    hiddenScopes: ['aio', 'dev-infra', 'docs-infra', 'zone.js'],\n   },\n   releasePrLabels: ['comp: build & ci', 'action: merge', 'PullApprove: disable'],\n };"
        },
        {
            "sha": "e4779fe862c1f585e08d1e4ef5d10fa1ad47c277",
            "filename": "gulpfile.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/5c9bd237e34c38ae03a4defd5776aba56deec131/gulpfile.js",
            "raw_url": "https://github.com/angular/angular/raw/5c9bd237e34c38ae03a4defd5776aba56deec131/gulpfile.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/gulpfile.js?ref=5c9bd237e34c38ae03a4defd5776aba56deec131",
            "patch": "@@ -19,7 +19,6 @@ function loadTask(fileName, taskName) {\n \n \n gulp.task('source-map-test', loadTask('source-map-test'));\n-gulp.task('changelog', loadTask('changelog'));\n gulp.task('changelog:zonejs', loadTask('changelog-zonejs'));\n gulp.task('cldr:extract', loadTask('cldr', 'extract'));\n gulp.task('cldr:download', loadTask('cldr', 'download'));"
        },
        {
            "sha": "0caaf1c0d54c0fd6fbf0dcb75c25930138c02c26",
            "filename": "tools/gulp-tasks/changelog.js",
            "status": "removed",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/393ce94718cccf3d69fff44cb509ab487d61f3de/tools%2Fgulp-tasks%2Fchangelog.js",
            "raw_url": "https://github.com/angular/angular/raw/393ce94718cccf3d69fff44cb509ab487d61f3de/tools%2Fgulp-tasks%2Fchangelog.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fgulp-tasks%2Fchangelog.js?ref=393ce94718cccf3d69fff44cb509ab487d61f3de",
            "patch": "@@ -1,73 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-const {readFileSync} = require('fs');\n-const {bold, yellow} = require('chalk');\n-\n-module.exports = (gulp) => () => {\n-  const conventionalChangelog = require('gulp-conventional-changelog');\n-  const ignoredScopes = [\n-    'aio',\n-    'dev-infra',\n-    'docs-infra',\n-    'zone.js',\n-  ];\n-\n-  return gulp.src('CHANGELOG.md')\n-      .pipe(conventionalChangelog(\n-          /* core options */ {preset: 'angular'},\n-          /* context options */ {},\n-          /* raw-commit options */ {\n-            // Ignore commits that start with `<type>(<scope>)` for any of the ignored scopes.\n-            extendedRegexp: true,\n-            grep: `^[^(]+\\\\((${ignoredScopes.join('|')})\\\\)`,\n-            invertGrep: true,\n-          },\n-          /* commit parser options */ null,\n-          /* writer options*/ createDedupeWriterOptions()))\n-      .pipe(gulp.dest('./'));\n-};\n-\n-/**\n- * Creates changelog writer options which ensure that commits are not showing up multiple times.\n- * Commits can show up multiple times if a changelog has been generated on a publish branch\n- * and has been cherry-picked into \"master\". In that case, the changelog will already contain\n- * commits from master which might be added to the changelog again. This is because usually\n- * patch and minor releases are tagged from the publish branches and therefore\n- * conventional-changelog tries to build the changelog from last minor version to HEAD when a\n- * new minor version is being published from the \"master\" branch. We naively match commit\n- * headers as otherwise we would need to query Git and diff commits between a given patch branch.\n- * The commit header is reliable enough as it contains a direct reference to the source PR.\n- */\n-function createDedupeWriterOptions() {\n-  const existingChangelogContent = readFileSync('CHANGELOG.md', 'utf8');\n-\n-  return {\n-    // Specify a writer option that can be used to modify the content of a new changelog section.\n-    // See: conventional-changelog/tree/master/packages/conventional-changelog-writer\n-    finalizeContext: (context) => {\n-      context.commitGroups = context.commitGroups.filter((group) => {\n-        group.commits = group.commits.filter((commit) => {\n-          // NOTE: We cannot compare the SHAs because the commits will have a different SHA\n-          // if they are being cherry-picked into a different branch.\n-          if (existingChangelogContent.includes(commit.subject)) {\n-            console.info(yellow(`  â†º   Skipping duplicate: \"${bold(commit.header)}\"`));\n-            return false;\n-          }\n-          return true;\n-        });\n-\n-        // Filter out commit groups which don't have any commits. Commit groups will become\n-        // empty if we filter out all duplicated commits.\n-        return group.commits.length !== 0;\n-      });\n-\n-      return context;\n-    }\n-  };\n-}"
        }
    ],
    "stats": {
        "total": 80,
        "additions": 2,
        "deletions": 78
    }
}