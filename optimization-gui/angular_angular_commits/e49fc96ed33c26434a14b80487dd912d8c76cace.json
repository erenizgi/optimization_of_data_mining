{
    "author": "dylhunn",
    "message": "feat(forms): Make Form Statuses use stricter types. (#42952)\n\nSpecifically: narrow the type used for form statuses from string to a union of possible statuses. Change the API methods from any to use the new type.\n\nThis is a breaking change. However, as discussed in the PR, breakage seems minimal, and google3 has been prepped to land this.\n\nBackground: we uncovered these any typings in the course of design work for typed forms. They could be fixed in a non-breaking manner by piggybacking them on top of the new typed forms generics, but it would be much cleaner to fix them separately if possible.\n\nBREAKING CHANGE:\n\nA new type called `FormControlStatus` has been introduced, which is a union of all possible status strings for form controls. `AbstractControl.status` has been narrowed from `string` to `FormControlStatus`, and `statusChanges` has been narrowed from `Observable<any>` to `Observable<FormControlStatus>`. Most applications should consume the new types seamlessly. Any breakage caused by this change is likely due to one of the following two problems: (1) the app is comparing `AbstractControl.status` against a string which is not a valid status; or, (2) the app is using `statusChanges` events as if they were something other than strings.\n\nPR Close #42952",
    "sha": "e49fc96ed33c26434a14b80487dd912d8c76cace",
    "files": [
        {
            "sha": "b9339e221f59eaac82f66275d244dad6a37014f3",
            "filename": "goldens/public-api/forms/forms.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e49fc96ed33c26434a14b80487dd912d8c76cace/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "raw_url": "https://github.com/angular/angular/raw/e49fc96ed33c26434a14b80487dd912d8c76cace/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fforms%2Fforms.md?ref=e49fc96ed33c26434a14b80487dd912d8c76cace",
            "patch": "@@ -78,8 +78,8 @@ export abstract class AbstractControl {\n     setParent(parent: FormGroup | FormArray): void;\n     setValidators(validators: ValidatorFn | ValidatorFn[] | null): void;\n     abstract setValue(value: any, options?: Object): void;\n-    readonly status: string;\n-    readonly statusChanges: Observable<any>;\n+    readonly status: FormControlStatus;\n+    readonly statusChanges: Observable<FormControlStatus>;\n     readonly touched: boolean;\n     get untouched(): boolean;\n     get updateOn(): FormHooks;"
        },
        {
            "sha": "c84ea4565b2dd1624806ee007dad8101a6e5c518",
            "filename": "packages/forms/src/model.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 22,
            "changes": 58,
            "blob_url": "https://github.com/angular/angular/blob/e49fc96ed33c26434a14b80487dd912d8c76cace/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "raw_url": "https://github.com/angular/angular/raw/e49fc96ed33c26434a14b80487dd912d8c76cace/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fmodel.ts?ref=e49fc96ed33c26434a14b80487dd912d8c76cace",
            "patch": "@@ -45,6 +45,23 @@ export const PENDING = 'PENDING';\n  */\n export const DISABLED = 'DISABLED';\n \n+/**\n+ * A form can have several different statuses. Each\n+ * possible status is returned as a string literal.\n+ *\n+ * * **VALID**: Reports that a FormControl is valid, meaning that no errors exist in the input\n+ * value.\n+ * * **INVALID**: Reports that a FormControl is invalid, meaning that an error exists in the input\n+ * value.\n+ * * **PENDING**: Reports that a FormControl is pending, meaning that that async validation is\n+ * occurring and errors are not yet available for the input value.\n+ * * **DISABLED**: Reports that a FormControl is\n+ * disabled, meaning that the control is exempt from ancestor calculations of validity or value.\n+ *\n+ * @publicApi\n+ */\n+export type FormControlStatus = 'VALID'|'INVALID'|'PENDING'|'DISABLED';\n+\n function _find(control: AbstractControl, path: Array<string|number>|string, delimiter: string) {\n   if (path == null) return null;\n \n@@ -274,19 +291,15 @@ export abstract class AbstractControl {\n   }\n \n   /**\n-   * The validation status of the control. There are four possible\n-   * validation status values:\n+   * The validation status of the control.\n    *\n-   * * **VALID**: This control has passed all validation checks.\n-   * * **INVALID**: This control has failed at least one validation check.\n-   * * **PENDING**: This control is in the midst of conducting a validation check.\n-   * * **DISABLED**: This control is exempt from validation checks.\n+   * @see `FormControlStatus`\n    *\n    * These status values are mutually exclusive, so a control cannot be\n    * both valid AND invalid or invalid AND disabled.\n    */\n   // TODO(issue/24571): remove '!'.\n-  public readonly status!: string;\n+  public readonly status!: FormControlStatus;\n \n   /**\n    * A control is `valid` when its `status` is `VALID`.\n@@ -409,11 +422,12 @@ export abstract class AbstractControl {\n    * A multicasting observable that emits an event every time the validation `status` of the control\n    * recalculates.\n    *\n+   * @see `FormControlStatus`\n    * @see {@link AbstractControl.status}\n    *\n    */\n   // TODO(issue/24571): remove '!'.\n-  public readonly statusChanges!: Observable<any>;\n+  public readonly statusChanges!: Observable<FormControlStatus>;\n \n   /**\n    * Reports the update strategy of the `AbstractControl` (meaning\n@@ -687,10 +701,10 @@ export abstract class AbstractControl {\n    *\n    */\n   markAsPending(opts: {onlySelf?: boolean, emitEvent?: boolean} = {}): void {\n-    (this as {status: string}).status = PENDING;\n+    (this as {status: FormControlStatus}).status = PENDING;\n \n     if (opts.emitEvent !== false) {\n-      (this.statusChanges as EventEmitter<any>).emit(this.status);\n+      (this.statusChanges as EventEmitter<FormControlStatus>).emit(this.status);\n     }\n \n     if (this._parent && !opts.onlySelf) {\n@@ -720,7 +734,7 @@ export abstract class AbstractControl {\n     // parent's dirtiness based on the children.\n     const skipPristineCheck = this._parentMarkedDirty(opts.onlySelf);\n \n-    (this as {status: string}).status = DISABLED;\n+    (this as {status: FormControlStatus}).status = DISABLED;\n     (this as {errors: ValidationErrors | null}).errors = null;\n     this._forEachChild((control: AbstractControl) => {\n       control.disable({...opts, onlySelf: true});\n@@ -729,7 +743,7 @@ export abstract class AbstractControl {\n \n     if (opts.emitEvent !== false) {\n       (this.valueChanges as EventEmitter<any>).emit(this.value);\n-      (this.statusChanges as EventEmitter<string>).emit(this.status);\n+      (this.statusChanges as EventEmitter<FormControlStatus>).emit(this.status);\n     }\n \n     this._updateAncestors({...opts, skipPristineCheck});\n@@ -759,7 +773,7 @@ export abstract class AbstractControl {\n     // parent's dirtiness based on the children.\n     const skipPristineCheck = this._parentMarkedDirty(opts.onlySelf);\n \n-    (this as {status: string}).status = VALID;\n+    (this as {status: FormControlStatus}).status = VALID;\n     this._forEachChild((control: AbstractControl) => {\n       control.enable({...opts, onlySelf: true});\n     });\n@@ -823,7 +837,7 @@ export abstract class AbstractControl {\n     if (this.enabled) {\n       this._cancelExistingSubscription();\n       (this as {errors: ValidationErrors | null}).errors = this._runValidator();\n-      (this as {status: string}).status = this._calculateStatus();\n+      (this as {status: FormControlStatus}).status = this._calculateStatus();\n \n       if (this.status === VALID || this.status === PENDING) {\n         this._runAsyncValidator(opts.emitEvent);\n@@ -832,7 +846,7 @@ export abstract class AbstractControl {\n \n     if (opts.emitEvent !== false) {\n       (this.valueChanges as EventEmitter<any>).emit(this.value);\n-      (this.statusChanges as EventEmitter<string>).emit(this.status);\n+      (this.statusChanges as EventEmitter<FormControlStatus>).emit(this.status);\n     }\n \n     if (this._parent && !opts.onlySelf) {\n@@ -847,7 +861,7 @@ export abstract class AbstractControl {\n   }\n \n   private _setInitialStatus() {\n-    (this as {status: string}).status = this._allControlsDisabled() ? DISABLED : VALID;\n+    (this as {status: FormControlStatus}).status = this._allControlsDisabled() ? DISABLED : VALID;\n   }\n \n   private _runValidator(): ValidationErrors|null {\n@@ -856,7 +870,7 @@ export abstract class AbstractControl {\n \n   private _runAsyncValidator(emitEvent?: boolean): void {\n     if (this.asyncValidator) {\n-      (this as {status: string}).status = PENDING;\n+      (this as {status: FormControlStatus}).status = PENDING;\n       this._hasOwnPendingAsyncValidator = true;\n       const obs = toObservable(this.asyncValidator(this));\n       this._asyncValidationSubscription = obs.subscribe((errors: ValidationErrors|null) => {\n@@ -1017,10 +1031,10 @@ export abstract class AbstractControl {\n \n   /** @internal */\n   _updateControlsErrors(emitEvent: boolean): void {\n-    (this as {status: string}).status = this._calculateStatus();\n+    (this as {status: FormControlStatus}).status = this._calculateStatus();\n \n     if (emitEvent) {\n-      (this.statusChanges as EventEmitter<string>).emit(this.status);\n+      (this.statusChanges as EventEmitter<FormControlStatus>).emit(this.status);\n     }\n \n     if (this._parent) {\n@@ -1031,11 +1045,11 @@ export abstract class AbstractControl {\n   /** @internal */\n   _initObservables() {\n     (this as {valueChanges: Observable<any>}).valueChanges = new EventEmitter();\n-    (this as {statusChanges: Observable<any>}).statusChanges = new EventEmitter();\n+    (this as {statusChanges: Observable<FormControlStatus>}).statusChanges = new EventEmitter();\n   }\n \n \n-  private _calculateStatus(): string {\n+  private _calculateStatus(): FormControlStatus {\n     if (this._allControlsDisabled()) return DISABLED;\n     if (this.errors) return INVALID;\n     if (this._hasOwnPendingAsyncValidator || this._anyControlsHaveStatus(PENDING)) return PENDING;\n@@ -1059,7 +1073,7 @@ export abstract class AbstractControl {\n   abstract _syncPendingControls(): boolean;\n \n   /** @internal */\n-  _anyControlsHaveStatus(status: string): boolean {\n+  _anyControlsHaveStatus(status: FormControlStatus): boolean {\n     return this._anyControls((control: AbstractControl) => control.status === status);\n   }\n "
        }
    ],
    "stats": {
        "total": 62,
        "additions": 38,
        "deletions": 24
    }
}