{
    "author": "JiaLiPassion",
    "message": "fix(zone.js): add missing types field in package.json (#38585)\n\nClose #38584\n\nIn zone.js 0.11.1, the `types` field is missing in the `package.json`,\nthe reason is in zone.js 0.11.0, the `files` field is used to specify the\ntypes, but it cause the npm package not contain any bundles issue, so zone.js\n0.11.1 remove the `files` field, which cause the `type` definition gone.\n\nThis PR concat the `zone.js.d.ts`, `zone.configurations.api.ts`, `zone.api.extensions.ts`\ntypes into a single `zone.d.ts` file.\n\nPR Close #38585",
    "sha": "27cc56b359a542761af5d9fba61db26d4f3f30b1",
    "files": [
        {
            "sha": "d75e1f9b4f8d8a233a5a331b76448e6ab77e6138",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -749,6 +749,8 @@ jobs:\n              cp dist/bin/packages/zone.js/npm_package/bundles/zone-patch-electron.umd.js ./packages/zone.js/test/extra/ &&\n              yarn --cwd packages/zone.js electrontest\n       - run: yarn --cwd packages/zone.js jesttest\n+      - run: yarn --cwd packages/zone.js/test/typings install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd packages/zone.js/test/typings test\n \n   # Windows jobs\n   # Docs: https://circleci.com/docs/2.0/hello-world-windows/"
        },
        {
            "sha": "e93eab0e555e9fc33d1d6cd94abcfe653c670fa4",
            "filename": "packages/zone.js/BUILD.bazel",
            "status": "modified",
            "additions": 6,
            "deletions": 25,
            "changes": 31,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2FBUILD.bazel?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -34,32 +34,13 @@ genrule(\n \n genrule(\n     name = \"zone_js_d_ts\",\n-    srcs = [\"//packages/zone.js/lib:zone_d_ts\"],\n-    outs = [\"zone.js.d.ts\"],\n-    cmd = \"cp $< $@\",\n-)\n-\n-genrule(\n-    name = \"zone_extensions_d_ts\",\n-    srcs = [\"//packages/zone.js/lib:zone.api.extensions.ts\"],\n-    outs = [\"zone.api.extensions.ts\"],\n-    cmd = \"cp $< $@\",\n-)\n-\n-genrule(\n-    name = \"zone_configurations_d_ts\",\n-    srcs = [\"//packages/zone.js/lib:zone.configurations.api.ts\"],\n-    outs = [\"zone.configurations.api.ts\"],\n-    cmd = \"cp $< $@\",\n-)\n-\n-filegroup(\n-    name = \"zone_d_ts\",\n     srcs = [\n-        \":zone_configurations_d_ts\",\n-        \":zone_extensions_d_ts\",\n-        \":zone_js_d_ts\",\n+        \"//packages/zone.js/lib:zone_d_ts\",\n+        \"//packages/zone.js/lib:zone.api.extensions.ts\",\n+        \"//packages/zone.js/lib:zone.configurations.api.ts\",\n     ],\n+    outs = [\"zone.d.ts\"],\n+    cmd = \"cat $(SRCS) > $@\",\n )\n \n generate_rollup_bundle(\n@@ -95,5 +76,5 @@ pkg_npm(\n     ] + [\n         \"//packages/zone.js/fesm2015:\" + b + \"-es2015.min.dist\"\n         for b in BUNDLES_ENTRY_POINTS.keys()\n-    ] + [\":zone_d_ts\"],\n+    ] + [\":zone_js_d_ts\"],\n )"
        },
        {
            "sha": "29d122c8d6f683603e450536e967673c8816ba6e",
            "filename": "packages/zone.js/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Fpackage.json?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -6,6 +6,7 @@\n   \"module\": \"./fesm2015/zone.js\",\n   \"es2015\": \"./fesm2015/zone.js\",\n   \"fesm2015\": \"./fesm2015/zone.js\",\n+  \"typings\": \"./zone.d.ts\",\n   \"dependencies\": {\n     \"tslib\": \"^2.0.0\"\n   },"
        },
        {
            "sha": "42f0b519daa87bcbcc4928df41311d88912ff44d",
            "filename": "packages/zone.js/test/npm_package/npm_package.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 10,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Fnpm_package%2Fnpm_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Fnpm_package%2Fnpm_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fnpm_package%2Fnpm_package.spec.ts?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -40,20 +40,18 @@ describe('Zone.js npm_package', () => {\n     it('should contain module resolution mappings', () => {\n       expect(shx.grep('\"main\":', packageJson)).toContain(`zone.umd.js`);\n     });\n+\n+    it('should contain typings', () => {\n+      expect(shx.grep('\"typings\":', packageJson)).toContain(`./zone.d.ts`);\n+    });\n   });\n \n   describe('check npm_package root folder', () => {\n     describe('typescript support', () => {\n-      it('should have an zone.js.d.ts file', () => {\n-        expect(shx.cat('zone.js.d.ts')).toContain('declare const');\n-      });\n-\n-      it('should have an zone.api.extensions.ts file', () => {\n-        expect(shx.cat('zone.api.extensions.ts')).toContain('EventTarget');\n-      });\n-\n-      it('should have an zone.configurations.api.ts file', () => {\n-        expect(shx.cat('zone.configurations.api.ts')).toContain('ZoneGlobalConfigurations');\n+      it('should have an zone.d.ts file', () => {\n+        expect(shx.cat('zone.d.ts')).toContain('declare const');\n+        expect(shx.cat('zone.d.ts')).toContain('interface EventTarget');\n+        expect(shx.cat('zone.d.ts')).toContain('ZoneGlobalConfigurations');\n       });\n     });\n "
        },
        {
            "sha": "01a5e93c1293f0d6ec202d42453aab0f23b48274",
            "filename": "packages/zone.js/test/typings/.gitignore",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2F.gitignore",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2F.gitignore",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Ftypings%2F.gitignore?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -0,0 +1,3 @@\n+node_modules\n+build\n+*.log"
        },
        {
            "sha": "cb87d67ac1c7026ab1aeeb9d089f776971a30250",
            "filename": "packages/zone.js/test/typings/package.json",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Ftypings%2Fpackage.json?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -0,0 +1,19 @@\n+{\n+  \"name\": \"typings\",\n+  \"version\": \"1.0.0\",\n+  \"description\": \"typing test package to test zone.js.d.ts\",\n+  \"scripts\": {\n+    \"test\": \"tsc -p .\"\n+  },\n+  \"keywords\": [],\n+  \"author\": \"\",\n+  \"license\": \"MIT\",\n+  \"dependencies\": {\n+    \"@types/node\": \"12.11.1\",\n+    \"domino\": \"^2.1.6\",\n+    \"zone.js\": \"file:../../../../dist/bin/packages/zone.js/npm_package\"\n+  },\n+  \"devDependencies\": {\n+    \"typescript\": \"~4.0.2\"\n+  }\n+}"
        },
        {
            "sha": "bbca0533b0d203f345e09397235de4d9ea1ae9ba",
            "filename": "packages/zone.js/test/typings/tsconfig.json",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Ftypings%2Ftsconfig.json?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -0,0 +1,27 @@\n+{\n+  \"compilerOptions\": {\n+    \"forceConsistentCasingInFileNames\": true,\n+    \"noImplicitReturns\": true,\n+    \"noFallthroughCasesInSwitch\": true,\n+    \"experimentalDecorators\": true,\n+    \"module\": \"commonjs\",\n+    \"moduleResolution\": \"node\",\n+    \"outDir\": \"./build\",\n+    \"rootDir\": \".\",\n+    \"target\": \"es5\",\n+    \"noEmitOnError\": false,\n+    \"stripInternal\": false,\n+    \"strict\": true,\n+    \"lib\": [\n+      \"es5\",\n+      \"dom\",\n+      \"es2015.collection\",\n+      \"es2015.iterable\",\n+      \"es2015.promise\",\n+    ],\n+  },\n+  \"files\": [\n+    \"./type.test.ts\",\n+    \"./node_modules/zone.js/zone.d.ts\"\n+  ],\n+}"
        },
        {
            "sha": "d013f40f0b4b58420ccd5e3f58a5d74f13b32c98",
            "filename": "packages/zone.js/test/typings/type.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Ftype.test.ts",
            "raw_url": "https://github.com/angular/angular/raw/27cc56b359a542761af5d9fba61db26d4f3f30b1/packages%2Fzone.js%2Ftest%2Ftypings%2Ftype.test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Ftypings%2Ftype.test.ts?ref=27cc56b359a542761af5d9fba61db26d4f3f30b1",
            "patch": "@@ -0,0 +1,18 @@\n+import * as domino from 'domino';\n+require('zone.js/bundles/zone.umd');\n+\n+// Zone public API should be included\n+Zone.current.fork({name: 'testZone'}).run(() => {});\n+\n+// Zone extra APIs for EventTarget should be available\n+const w = domino.createWindow('<h1>Hello zone.js</h1>');\n+const h1 = w.document.querySelector('h1');\n+const listener = () => {};\n+h1!.addEventListener('click', listener);\n+const clickListeners = h1!.eventListeners!('click');\n+if (!clickListeners || clickListeners.length === 0 || clickListeners[0] !== listener) {\n+  throw new Error('eventListeners not work!!!');\n+}\n+\n+const globalZoneConfig = w as ZoneGlobalConfigurations;\n+globalZoneConfig.__Zone_disable_EventEmitter = true;"
        }
    ],
    "stats": {
        "total": 119,
        "additions": 84,
        "deletions": 35
    }
}