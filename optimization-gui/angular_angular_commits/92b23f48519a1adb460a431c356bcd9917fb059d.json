{
    "author": "alxhub",
    "message": "fix(compiler-cli): properly index <svg> elements (#44678)\n\nIn the `Element` node of a parsed `<svg>` element, the `name` is recorded\nas `:svg:svg`. When the Angular Indexer ran over this element, it would\nattempt to find this name in the template text and fail, as the namespace\nportion of the name was added automatically at parse time and is of course\nmissing from the original template.\n\nThis commit changes the indexer to detect these namespaced elements and only\nsearch for the tag name.\n\nPR Close #44678",
    "sha": "92b23f48519a1adb460a431c356bcd9917fb059d",
    "files": [
        {
            "sha": "3d932ab5353728b87d3d88b191820824150f7d64",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/src/template.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/92b23f48519a1adb460a431c356bcd9917fb059d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/92b23f48519a1adb460a431c356bcd9917fb059d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts?ref=92b23f48519a1adb460a431c356bcd9917fb059d",
            "patch": "@@ -232,7 +232,15 @@ class TemplateVisitor extends TmplAstRecursiveVisitor {\n       name = node.tagName;\n       kind = IdentifierKind.Template;\n     } else {\n-      name = node.name;\n+      // Namespaced elements have a particular format for `node.name` that needs to be handled.\n+      // For example, an `<svg>` element has a `node.name` of `':svg:svg'`.\n+\n+      // TODO(alxhub): properly handle namespaced elements\n+      if (node.name.startsWith(':')) {\n+        name = node.name.split(':').pop()!;\n+      } else {\n+        name = node.name;\n+      }\n       kind = IdentifierKind.Element;\n     }\n     const sourceSpan = node.startSourceSpan;"
        },
        {
            "sha": "97c63a6d759e62d5ed4f6a749848a4f7d55a5548",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/test/template_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/92b23f48519a1adb460a431c356bcd9917fb059d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/92b23f48519a1adb460a431c356bcd9917fb059d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts?ref=92b23f48519a1adb460a431c356bcd9917fb059d",
            "patch": "@@ -21,6 +21,20 @@ function bind(template: string) {\n \n runInEachFileSystem(() => {\n   describe('getTemplateIdentifiers', () => {\n+    it('should handle svg elements', () => {\n+      const template = '<svg></svg>';\n+      const refs = getTemplateIdentifiers(bind(template));\n+\n+      const [ref] = Array.from(refs);\n+      expect(ref).toEqual({\n+        kind: IdentifierKind.Element,\n+        name: 'svg',\n+        span: new AbsoluteSourceSpan(1, 4),\n+        usedDirectives: new Set(),\n+        attributes: new Set(),\n+      });\n+    });\n+\n     it('should handle comments in interpolations', () => {\n       const template = '{{foo // comment}}';\n       const refs = getTemplateIdentifiers(bind(template));"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 23,
        "deletions": 1
    }
}