{
    "author": "josephperrott",
    "message": "feat(dev-infra): check services/status information of the repository for caretaker (#38601)\n\nThe angular team relies on a number of services for hosting code, running CI, etc. This\ntool allows for checking the operational status of all services at once as well as the current\nstate of the repository with respect to merge and triage ready issues and prs.\n\nPR Close #38601",
    "sha": "a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
    "files": [
        {
            "sha": "065f6efad78495bec123b28a7d7210f047a70e4c",
            "filename": "dev-infra/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2FBUILD.bazel?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -8,6 +8,7 @@ ts_library(\n     ],\n     module_name = \"@angular/dev-infra-private\",\n     deps = [\n+        \"//dev-infra/caretaker\",\n         \"//dev-infra/commit-message\",\n         \"//dev-infra/format\",\n         \"//dev-infra/pr\","
        },
        {
            "sha": "268ab0f616181f4b5e9a9461e4b865f819d311b5",
            "filename": "dev-infra/caretaker/BUILD.bazel",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2FBUILD.bazel?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,26 @@\n+load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"caretaker\",\n+    srcs = [\n+        \"cli.ts\",\n+    ],\n+    module_name = \"@angular/dev-infra-private/caretaker\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/caretaker/check\",\n+        \"@npm//@types/yargs\",\n+        \"@npm//yargs\",\n+    ],\n+)\n+\n+ts_library(\n+    name = \"config\",\n+    srcs = [\n+        \"config.ts\",\n+    ],\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/utils\",\n+    ],\n+)"
        },
        {
            "sha": "e4a8644799c09514eeb6b8c66b38b4c26d0bc64d",
            "filename": "dev-infra/caretaker/check/BUILD.bazel",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2FBUILD.bazel?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,21 @@\n+load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"check\",\n+    srcs = glob([\"*.ts\"]),\n+    module_name = \"@angular/dev-infra-private/caretaker/service-statuses\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/caretaker:config\",\n+        \"//dev-infra/utils\",\n+        \"@npm//@types/fs-extra\",\n+        \"@npm//@types/node\",\n+        \"@npm//@types/node-fetch\",\n+        \"@npm//@types/yargs\",\n+        \"@npm//multimatch\",\n+        \"@npm//node-fetch\",\n+        \"@npm//typed-graphqlify\",\n+        \"@npm//yaml\",\n+        \"@npm//yargs\",\n+    ],\n+)"
        },
        {
            "sha": "9fdfb8b984e1883be5c864eac565838a1dfae282",
            "filename": "dev-infra/caretaker/check/check.ts",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fcheck.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,27 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {GitClient} from '../../utils/git';\n+import {getCaretakerConfig} from '../config';\n+\n+import {printG3Comparison} from './g3';\n+import {printGithubTasks} from './github';\n+import {printServiceStatuses} from './services';\n+\n+\n+/** Check the status of services which Angular caretakers need to monitor. */\n+export async function checkServiceStatuses(githubToken: string) {\n+  /** The configuration for the caretaker commands. */\n+  const config = getCaretakerConfig();\n+  /** The GitClient for interacting with git and Github. */\n+  const git = new GitClient(githubToken, config);\n+\n+  await printServiceStatuses();\n+  await printGithubTasks(git, config.caretaker);\n+  await printG3Comparison(git);\n+}"
        },
        {
            "sha": "8e50c7f26124a42a8370a4373da65703b90b6a95",
            "filename": "dev-infra/caretaker/check/cli.ts",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fcli.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,39 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {addGithubTokenFlag} from '../../utils/yargs';\n+\n+import {checkServiceStatuses} from './check';\n+\n+\n+export interface CaretakerCheckOptions {\n+  githubToken: string;\n+}\n+\n+/** URL to the Github page where personal access tokens can be generated. */\n+export const GITHUB_TOKEN_GENERATE_URL = `https://github.com/settings/tokens`;\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return addGithubTokenFlag(yargs);\n+}\n+\n+/** Handles the command. */\n+async function handler({githubToken}: Arguments<CaretakerCheckOptions>) {\n+  await checkServiceStatuses(githubToken);\n+}\n+\n+/** yargs command module for checking status information for the repository  */\n+export const CheckModule: CommandModule<{}, CaretakerCheckOptions> = {\n+  handler,\n+  builder,\n+  command: 'check',\n+  describe: 'Check the status of information the caretaker manages for the repository',\n+};"
        },
        {
            "sha": "bba0f0b4c1046c89b7a3f5c21b57168bd7a2b7da",
            "filename": "dev-infra/caretaker/check/g3.ts",
            "status": "added",
            "additions": 123,
            "deletions": 0,
            "changes": 123,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,123 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {existsSync, readFileSync} from 'fs-extra';\n+import * as multimatch from 'multimatch';\n+import {join} from 'path';\n+import {parse as parseYaml} from 'yaml';\n+\n+import {getRepoBaseDir} from '../../utils/config';\n+import {bold, debug, info} from '../../utils/console';\n+import {GitClient} from '../../utils/git';\n+\n+/** Compare the upstream master to the upstream g3 branch, if it exists. */\n+export async function printG3Comparison(git: GitClient) {\n+  const angularRobotFilePath = join(getRepoBaseDir(), '.github/angular-robot.yml');\n+  if (!existsSync(angularRobotFilePath)) {\n+    return debug('No angular robot configuration file exists, skipping.');\n+  }\n+\n+  /** The configuration defined for the angular robot. */\n+  const robotConfig = parseYaml(readFileSync(angularRobotFilePath).toString());\n+  /** The files to be included in the g3 sync. */\n+  const includeFiles = robotConfig?.merge?.g3Status?.include || [];\n+  /** The files to be expected in the g3 sync. */\n+  const excludeFiles = robotConfig?.merge?.g3Status?.exclude || [];\n+\n+  if (includeFiles.length === 0 && excludeFiles.length === 0) {\n+    debug('No g3Status include or exclude lists are defined in the angular robot configuration,');\n+    debug('skipping.');\n+    return;\n+  }\n+\n+  /** Random prefix to create unique branch names. */\n+  const randomPrefix = `prefix${Math.floor(Math.random() * 1000000)}`;\n+  /** Ref name of the temporary master branch. */\n+  const masterRef = `${randomPrefix}-master`;\n+  /** Ref name of the temporary g3 branch. */\n+  const g3Ref = `${randomPrefix}-g3`;\n+  /** Url of the ref for fetching master and g3 branches. */\n+  const refUrl = `https://github.com/${git.remoteConfig.owner}/${git.remoteConfig.name}.git`;\n+  /** The result fo the fetch command. */\n+  const fetchResult = git.runGraceful(['fetch', refUrl, `master:${masterRef}`, `g3:${g3Ref}`]);\n+\n+  // If the upstream repository does not have a g3 branch to compare to, skip the comparison.\n+  if (fetchResult.status !== 0) {\n+    if (fetchResult.stderr.includes(`couldn't find remote ref g3`)) {\n+      return debug('No g3 branch exists on upstream, skipping.');\n+    }\n+    throw Error('Fetch of master and g3 branches for comparison failed.');\n+  }\n+\n+  /** The statistical information about the git diff between master and g3. */\n+  const stats = getDiffStats(git);\n+\n+  // Delete the temporarily created mater and g3 branches.\n+  git.runGraceful(['branch', '-D', masterRef, g3Ref]);\n+\n+  info.group(bold('g3 branch check'));\n+  info(`${stats.commits} commits between g3 and master`);\n+  if (stats.files === 0) {\n+    info('✅ No sync is needed at this time');\n+  } else {\n+    info(`${stats.files} files changed, ${stats.insertions} insertions(+), ${\n+        stats.deletions} deletions(-) will be included in the next sync`);\n+  }\n+  info.groupEnd();\n+  info();\n+\n+\n+  /**\n+   * Get git diff stats between master and g3, for all files and filtered to only g3 affecting\n+   * files.\n+   */\n+  function getDiffStats(git: GitClient) {\n+    /** The diff stats to be returned. */\n+    const stats = {\n+      insertions: 0,\n+      deletions: 0,\n+      files: 0,\n+      commits: 0,\n+    };\n+\n+\n+    // Determine the number of commits between master and g3 refs. */\n+    stats.commits = parseInt(git.run(['rev-list', '--count', `${g3Ref}..${masterRef}`]).stdout, 10);\n+\n+    // Get the numstat information between master and g3\n+    git.run(['diff', `${g3Ref}...${masterRef}`, '--numstat'])\n+        .stdout\n+        // Remove the extra space after git's output.\n+        .trim()\n+        // Split each line of git output into array\n+        .split('\\n')\n+        // Split each line from the git output into components parts: insertions,\n+        // deletions and file name respectively\n+        .map(line => line.split('\\t'))\n+        // Parse number value from the insertions and deletions values\n+        // Example raw line input:\n+        //   10\\t5\\tsrc/file/name.ts\n+        .map(line => [Number(line[0]), Number(line[1]), line[2]] as [number, number, string])\n+        // Add each line's value to the diff stats, and conditionally to the g3\n+        // stats as well if the file name is included in the files synced to g3.\n+        .forEach(([insertions, deletions, fileName]) => {\n+          if (checkMatchAgainstIncludeAndExclude(fileName, includeFiles, excludeFiles)) {\n+            stats.insertions += insertions;\n+            stats.deletions += deletions;\n+            stats.files += 1;\n+          }\n+        });\n+    return stats;\n+  }\n+\n+  /** Determine whether the file name passes both include and exclude checks. */\n+  function checkMatchAgainstIncludeAndExclude(\n+      file: string, includes: string[], excludes: string[]) {\n+    return multimatch(multimatch(file, includes), excludes, {flipNegate: true}).length !== 0;\n+  }\n+}"
        },
        {
            "sha": "5020c11531f3aae0102b85a3c25999a93d450ee4",
            "filename": "dev-infra/caretaker/check/github.ts",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,56 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {alias, params, types} from 'typed-graphqlify';\n+\n+import {bold, debug, info} from '../../utils/console';\n+import {GitClient} from '../../utils/git';\n+import {CaretakerConfig} from '../config';\n+\n+\n+interface GithubInfoQuery {\n+  [key: string]: {\n+    issueCount: number,\n+  };\n+}\n+\n+/** Retrieve the number of matching issues for each github query. */\n+export async function printGithubTasks(git: GitClient, config: CaretakerConfig) {\n+  if (!config.githubQueries?.length) {\n+    debug('No github queries defined in the configuration, skipping.');\n+    return;\n+  }\n+  info.group(bold('Github Tasks'));\n+  await getGithubInfo(git, config);\n+  info.groupEnd();\n+  info();\n+}\n+\n+/** Retrieve query match counts and log discovered counts to the console. */\n+async function getGithubInfo(git: GitClient, {githubQueries: queries = []}: CaretakerConfig) {\n+  /** The query object for graphql. */\n+  const graphQlQuery: {[key: string]: {issueCount: number}} = {};\n+  /** The Github search filter for the configured repository. */\n+  const repoFilter = `repo:${git.remoteConfig.owner}/${git.remoteConfig.name}`;\n+  queries.forEach(({name, query}) => {\n+    /** The name of the query, with spaces removed to match GraphQL requirements. */\n+    const queryKey = alias(name.replace(/ /g, ''), 'search');\n+    graphQlQuery[queryKey] = params(\n+        {\n+          type: 'ISSUE',\n+          query: `\"${repoFilter} ${query.replace(/\"/g, '\\\\\"')}\"`,\n+        },\n+        {issueCount: types.number},\n+    );\n+  });\n+  /** The results of the generated github query. */\n+  const results = await git.github.graphql.query(graphQlQuery);\n+  Object.values(results).forEach((result, i) => {\n+    info(`${queries[i]?.name.padEnd(25)} ${result.issueCount}`);\n+  });\n+}"
        },
        {
            "sha": "8fd3a2dbc33ef24b376fe371d7650dee1b2eba65",
            "filename": "dev-infra/caretaker/check/services.ts",
            "status": "added",
            "additions": 79,
            "deletions": 0,
            "changes": 79,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fservices.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,79 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import fetch from 'node-fetch';\n+\n+import {bold, green, info, red} from '../../utils/console';\n+\n+/** The status levels for services. */\n+enum ServiceStatus {\n+  GREEN,\n+  RED\n+}\n+\n+/** The results of checking the status of a service */\n+interface StatusCheckResult {\n+  status: ServiceStatus;\n+  description: string;\n+  lastUpdated: Date;\n+}\n+\n+/** Retrieve and log stasuses for all of the services of concern. */\n+export async function printServiceStatuses() {\n+  info.group(bold(`Service Statuses (checked: ${new Date().toLocaleString()})`));\n+  logStatus('CircleCI', await getCircleCiStatus());\n+  logStatus('Github', await getGithubStatus());\n+  logStatus('NPM', await getNpmStatus());\n+  logStatus('Saucelabs', await getSaucelabsStatus());\n+  info.groupEnd();\n+  info();\n+}\n+\n+\n+/** Log the status of the service to the console. */\n+function logStatus(serviceName: string, status: StatusCheckResult) {\n+  serviceName = serviceName.padEnd(15);\n+  if (status.status === ServiceStatus.GREEN) {\n+    info(`${serviceName} ${green('✅')}`);\n+  } else if (status.status === ServiceStatus.RED) {\n+    info.group(`${serviceName} ${red('❌')} (Updated: ${status.lastUpdated.toLocaleString()})`);\n+    info(`  Details: ${status.description}`);\n+    info.groupEnd();\n+  }\n+}\n+\n+/** Gets the service status information for Saucelabs. */\n+async function getSaucelabsStatus(): Promise<StatusCheckResult> {\n+  return getStatusFromStandardApi('https://status.us-west-1.saucelabs.com/api/v2/status.json');\n+}\n+\n+/** Gets the service status information for NPM. */\n+async function getNpmStatus(): Promise<StatusCheckResult> {\n+  return getStatusFromStandardApi('https://status.npmjs.org/api/v2/status.json');\n+}\n+\n+/** Gets the service status information for CircleCI. */\n+async function getCircleCiStatus(): Promise<StatusCheckResult> {\n+  return getStatusFromStandardApi('https://status.circleci.com/api/v2/status.json');\n+}\n+\n+/** Gets the service status information for Github. */\n+async function getGithubStatus(): Promise<StatusCheckResult> {\n+  return getStatusFromStandardApi('https://www.githubstatus.com/api/v2/status.json');\n+}\n+\n+/** Retrieve the status information for a service which uses a standard API response. */\n+async function getStatusFromStandardApi(url: string) {\n+  const result = await fetch(url).then(result => result.json());\n+  const status = result.status.indicator === 'none' ? ServiceStatus.GREEN : ServiceStatus.RED;\n+  return {\n+    status,\n+    description: result.status.description,\n+    lastUpdated: new Date(result.page.updated_at)\n+  };\n+}"
        },
        {
            "sha": "dd464699e83a03789b130c2ee18b3188ff0a7dee",
            "filename": "dev-infra/caretaker/cli.ts",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcli.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,16 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Argv} from 'yargs';\n+import {CheckModule} from './check/cli';\n+\n+\n+/** Build the parser for the caretaker commands. */\n+export function buildCaretakerParser(yargs: Argv) {\n+  return yargs.command(CheckModule);\n+}"
        },
        {
            "sha": "8ac7ea630335d6a24e2184ab6dbe9df78146beea",
            "filename": "dev-infra/caretaker/config.ts",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcaretaker%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fconfig.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -0,0 +1,24 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n+\n+export interface CaretakerConfig {\n+  githubQueries?: {name: string; query: string;}[];\n+}\n+\n+/** Retrieve and validate the config as `CaretakerConfig`. */\n+export function getCaretakerConfig() {\n+  // List of errors encountered validating the config.\n+  const errors: string[] = [];\n+  // The non-validated config object.\n+  const config: Partial<NgDevConfig<{caretaker: CaretakerConfig}>> = getConfig();\n+\n+  assertNoErrors(errors);\n+  return config as Required<typeof config>;\n+}"
        },
        {
            "sha": "5ec25a624577759dbe93bc838a8117724ee62158",
            "filename": "dev-infra/cli.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcli.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -14,6 +14,7 @@ import {buildFormatParser} from './format/cli';\n import {buildReleaseParser} from './release/cli';\n import {buildPrParser} from './pr/cli';\n import {captureLogOutputForCommand} from './utils/console';\n+import {buildCaretakerParser} from './caretaker/cli';\n \n yargs.scriptName('ng-dev')\n     .middleware(captureLogOutputForCommand)\n@@ -25,6 +26,7 @@ yargs.scriptName('ng-dev')\n     .command('pullapprove <command>', '', buildPullapproveParser)\n     .command('release <command>', '', buildReleaseParser)\n     .command('ts-circular-deps <command>', '', tsCircularDependenciesBuilder)\n+    .command('caretaker <command>', '', buildCaretakerParser)\n     .wrap(120)\n     .strict()\n     .parse();"
        },
        {
            "sha": "9687d090f33989db6c1d351dcb29e532f703d20a",
            "filename": "dev-infra/utils/console.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Futils%2Fconsole.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Futils%2Fconsole.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconsole.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -19,6 +19,7 @@ import {getRepoBaseDir} from './config';\n export const red: typeof chalk = chalk.red;\n export const green: typeof chalk = chalk.green;\n export const yellow: typeof chalk = chalk.yellow;\n+export const bold: typeof chalk = chalk.bold;\n \n /** Prompts the user with a confirmation question and a specified message. */\n export async function promptConfirm(message: string, defaultValue = false): Promise<boolean> {"
        },
        {
            "sha": "15f2592f1a5d9be11abafb7cd6b1dc8b724478ba",
            "filename": "dev-infra/utils/git/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Futils%2Fgit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/dev-infra%2Futils%2Fgit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Findex.ts?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -86,10 +86,10 @@ export class GitClient {\n   /**\n    * Spawns a given Git command process. Does not throw if the command fails. Additionally,\n    * if there is any stderr output, the output will be printed. This makes it easier to\n-   * debug failed commands.\n+   * info failed commands.\n    */\n   runGraceful(args: string[], options: SpawnSyncOptions = {}): SpawnSyncReturns<string> {\n-    // To improve the debugging experience in case something fails, we print all executed\n+    // To improve the infoging experience in case something fails, we print all executed\n     // Git commands. Note that we do not want to print the token if is contained in the\n     // command. It's common to share errors with others if the tool failed.\n     info('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));"
        },
        {
            "sha": "88cc917984be81cfe26da53bd4c49a2e142fe3b9",
            "filename": "package.json",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/package.json",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -81,13 +81,14 @@\n     \"@types/jasmine-ajax\": \"^3.3.1\",\n     \"@types/jasminewd2\": \"^2.0.8\",\n     \"@types/minimist\": \"^1.2.0\",\n+    \"@types/multimatch\": \"^4.0.0\",\n     \"@types/node\": \"^12.11.1\",\n     \"@types/node-fetch\": \"^2.5.7\",\n     \"@types/selenium-webdriver\": \"3.0.7\",\n     \"@types/semver\": \"^6.0.2\",\n     \"@types/shelljs\": \"^0.8.6\",\n     \"@types/systemjs\": \"0.19.32\",\n-    \"@types/yaml\": \"^1.2.0\",\n+    \"@types/yaml\": \"^1.9.7\",\n     \"@types/yargs\": \"^15.0.5\",\n     \"@webcomponents/custom-elements\": \"^1.1.0\",\n     \"angular\": \"npm:angular@1.7\",\n@@ -152,7 +153,7 @@\n     \"tslint\": \"6.1.3\",\n     \"typescript\": \"~4.0.2\",\n     \"xhr2\": \"0.2.0\",\n-    \"yaml\": \"^1.7.2\",\n+    \"yaml\": \"^1.10.0\",\n     \"yargs\": \"^15.4.1\"\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\","
        },
        {
            "sha": "c8918b79fc83c01d5bd389d28c863ba67dd2e449",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 19,
            "deletions": 5,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/a6f3cd93a91abf06ad29dad1639e578b1bf469b6/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=a6f3cd93a91abf06ad29dad1639e578b1bf469b6",
            "patch": "@@ -2243,6 +2243,13 @@\n   resolved \"https://registry.yarnpkg.com/@types/minimist/-/minimist-1.2.0.tgz#69a23a3ad29caf0097f06eda59b361ee2f0639f6\"\n   integrity sha1-aaI6OtKcrwCX8G7aWbNh7i8GOfY=\n \n+\"@types/multimatch@^4.0.0\":\n+  version \"4.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/multimatch/-/multimatch-4.0.0.tgz#e14237ade6cba7b79fe3a1a5d4e9579613cee6b6\"\n+  integrity sha512-xS26gtqY5QASmfU/6jb5vj7F0D0SctgRGtwXsKSNng1knk/OewjISlkMwGonkMCbZCqSoW3s6nL0sAtTlzbL/g==\n+  dependencies:\n+    multimatch \"*\"\n+\n \"@types/node-fetch@^2.5.7\":\n   version \"2.5.7\"\n   resolved \"https://registry.yarnpkg.com/@types/node-fetch/-/node-fetch-2.5.7.tgz#20a2afffa882ab04d44ca786449a276f9f6bbf3c\"\n@@ -2347,10 +2354,12 @@\n     \"@types/source-list-map\" \"*\"\n     source-map \"^0.6.1\"\n \n-\"@types/yaml@^1.2.0\":\n-  version \"1.2.0\"\n-  resolved \"https://registry.yarnpkg.com/@types/yaml/-/yaml-1.2.0.tgz#4ed577fc4ebbd6b829b28734e56d10c9e6984e09\"\n-  integrity sha512-GW8b9qM+ebgW3/zjzPm0I1NxMvLaz/YKT9Ph6tTb+Fkeyzd9yLTvQ6ciQ2MorTRmb/qXmfjMerRpG4LviixaqQ==\n+\"@types/yaml@^1.9.7\":\n+  version \"1.9.7\"\n+  resolved \"https://registry.yarnpkg.com/@types/yaml/-/yaml-1.9.7.tgz#2331f36e0aac91311a63d33eb026c21687729679\"\n+  integrity sha512-8WMXRDD1D+wCohjfslHDgICd2JtMATZU8CkhH8LVJqcJs6dyYj5TGptzP8wApbmEullGBSsCEzzap73DQ1HJaA==\n+  dependencies:\n+    yaml \"*\"\n \n \"@types/yargs-parser@*\":\n   version \"15.0.0\"\n@@ -10714,7 +10723,7 @@ multicast-dns@^6.0.1:\n     dns-packet \"^1.3.1\"\n     thunky \"^1.0.2\"\n \n-multimatch@^4.0.0:\n+multimatch@*, multimatch@^4.0.0:\n   version \"4.0.0\"\n   resolved \"https://registry.yarnpkg.com/multimatch/-/multimatch-4.0.0.tgz#8c3c0f6e3e8449ada0af3dd29efb491a375191b3\"\n   integrity sha512-lDmx79y1z6i7RNx0ZGCPq1bzJ6ZoDDKbvh7jxr9SJcWLkShMzXrHbYVpTdnhNM5MXpDUxCQ4DgqVttVXlBgiBQ==\n@@ -16342,6 +16351,11 @@ yallist@^4.0.0:\n   resolved \"https://registry.yarnpkg.com/yallist/-/yallist-4.0.0.tgz#9bb92790d9c0effec63be73519e11a35019a3a72\"\n   integrity sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==\n \n+yaml@*, yaml@^1.10.0:\n+  version \"1.10.0\"\n+  resolved \"https://registry.yarnpkg.com/yaml/-/yaml-1.10.0.tgz#3b593add944876077d4d683fee01081bd9fff31e\"\n+  integrity sha512-yr2icI4glYaNG+KWONODapy2/jDdMSDnrONSjblABjD9B4Z5LgiircSt8m8sRZFNi08kG9Sm0uSHtEmP3zaEGg==\n+\n yaml@^1.7.2:\n   version \"1.8.3\"\n   resolved \"https://registry.yarnpkg.com/yaml/-/yaml-1.8.3.tgz#2f420fca58b68ce3a332d0ca64be1d191dd3f87a\""
        }
    ],
    "stats": {
        "total": 448,
        "additions": 439,
        "deletions": 9
    }
}