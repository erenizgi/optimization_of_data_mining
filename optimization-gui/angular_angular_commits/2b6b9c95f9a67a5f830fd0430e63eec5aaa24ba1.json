{
    "author": "gkalpak",
    "message": "fix(docs-infra): fix the `component-interaction` example e2e tests to run in prod mode (#39001)\n\nPreviously, the `component-interaction` docs example was configured to\nrun e2e tests on CI in development mode (in contrast to the default for\nall docs examples, which is to run e2e tests in production mode). This\nwas necessary due to the following reasons:\n- One of the components, `CountdownTimerComponent`, which is used by\n  `CountdownLocalVarParentComponent` and\n  `CountdownViewChildParentComponent`, was triggering a periodic\n  asynchronous task (via `setInterval()`), which prevented the app from\n  stabilizing and caused tests to fail.\n- In order to prevent this from happening, the example's `AppModule` had\n  special provisioning to not include the problematic components in its\n  declarations when testing.\n- Since this had to be determined dynamically at runtime (via inspecting\n  the URL query params), the `AppModule`'s config could not be\n  statically evaluated in AOT compilation.\n\nThis commit fixes the example to make it compatible with AOT compilation\nand removes the custom test command from its `example-config.json`\n(allowing it to be run with the default e2e test command, i.e. in\nproduction mode).\n\nPR Close #39001",
    "sha": "2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
    "files": [
        {
            "sha": "692d67c27c3d81ec291352bfafb5a35d9208b2aa",
            "filename": "aio/content/examples/component-interaction/e2e/src/app.e2e-spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts?ref=2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
            "patch": "@@ -2,11 +2,7 @@ import { browser, element, by } from 'protractor';\n \n describe('Component Communication Cookbook Tests', () => {\n \n-  // Note: '?e2e' which app can read to know it is running in protractor\n-  // e.g. `if (!/e2e/.test(location.search)) { ...`\n-  beforeAll(() => {\n-    browser.get('?e2e');\n-  });\n+  beforeAll(() => browser.get(browser.baseUrl));\n \n   describe('Parent-to-child communication', () => {\n     // #docregion parent-to-child\n@@ -156,22 +152,26 @@ describe('Component Communication Cookbook Tests', () => {\n   // Can't run timer tests in protractor because\n   // interaction w/ zones causes all tests to freeze & timeout.\n   xdescribe('Parent calls child via local var', () => {\n-    countDownTimerTests('countdown-parent-lv');\n+    countDownTimerTests('app-countdown-parent-lv');\n   });\n \n   xdescribe('Parent calls ViewChild', () => {\n-    countDownTimerTests('countdown-parent-vc');\n+    countDownTimerTests('app-countdown-parent-vc');\n   });\n \n   function countDownTimerTests(parentTag: string) {\n     // #docregion countdown-timer-tests\n     // ...\n     it('timer and parent seconds should match', () => {\n       const parent = element(by.tagName(parentTag));\n+      const startButton = parent.element(by.tagName('button')).get(0);\n       const message = parent.element(by.tagName('app-countdown-timer')).getText();\n-      browser.sleep(10); // give `seconds` a chance to catchup with `message`\n-      const seconds = parent.element(by.className('seconds')).getText();\n-      expect(message).toContain(seconds);\n+\n+      startButton.click().then(() => {\n+        browser.sleep(10); // give `seconds` a chance to catchup with `message`\n+        const seconds = parent.element(by.className('seconds')).getText();\n+        expect(message).toContain(seconds);\n+      });\n     });\n \n     it('should stop the countdown', () => {"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "aio/content/examples/component-interaction/example-config.json",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fexample-config.json",
            "raw_url": "https://github.com/angular/angular/raw/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fexample-config.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fexample-config.json?ref=2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
            "patch": "@@ -1,13 +0,0 @@\n-{\n-  \"tests\": [\n-    {\n-      \"cmd\": \"yarn\",\n-      \"args\": [\n-        \"e2e\",\n-        \"--protractor-config=e2e/protractor-puppeteer.conf.js\",\n-        \"--no-webdriver-update\",\n-        \"--port={PORT}\"\n-      ]\n-    }\n-  ]\n-}"
        },
        {
            "sha": "88d05abdb1e4036a28647ea17b2a62a85f1fbb2c",
            "filename": "aio/content/examples/component-interaction/src/app/app.component.html",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.component.html",
            "raw_url": "https://github.com/angular/angular/raw/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.component.html?ref=2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
            "patch": "@@ -30,22 +30,21 @@ <h1 id=\"top\">Component Communication Cookbook</h1>\n   <app-vote-taker></app-vote-taker>\n </div>\n <a href=\"#top\" class=\"to-top\">Back to Top</a>\n-<hr>\n \n+<hr>\n <div id=\"parent-to-child-local-var\">\n   <app-countdown-parent-lv></app-countdown-parent-lv>\n </div>\n <a href=\"#top\" class=\"to-top\">Back to Top</a>\n-<hr>\n \n+<hr>\n <div id=\"parent-to-view-child\">\n   <app-countdown-parent-vc></app-countdown-parent-vc>\n </div>\n <a href=\"#top\" class=\"to-top\">Back to Top</a>\n-<hr>\n \n+<hr>\n <div id=\"bidirectional-service\">\n   <app-mission-control></app-mission-control>\n </div>\n <a href=\"#top\" class=\"to-top\">Back to Top</a>\n-<hr>"
        },
        {
            "sha": "caecee59e5d95c1042e0b3e7d2f64bcb8fa9352b",
            "filename": "aio/content/examples/component-interaction/src/app/app.module.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 23,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.module.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fapp.module.ts?ref=2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
            "patch": "@@ -1,4 +1,4 @@\n-import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\n+import { NgModule } from '@angular/core';\n import { BrowserModule } from '@angular/platform-browser';\n \n import { AppComponent } from './app.component';\n@@ -15,10 +15,17 @@ import { VersionParentComponent } from './version-parent.component';\n import { VoterComponent } from './voter.component';\n import { VoteTakerComponent } from './votetaker.component';\n \n-const directives: any[] = [\n+\n+@NgModule({\n+  imports: [\n+    BrowserModule,\n+  ],\n+  declarations: [\n     AppComponent,\n     AstronautComponent,\n+    CountdownLocalVarParentComponent,\n     CountdownTimerComponent,\n+    CountdownViewChildParentComponent,\n     HeroChildComponent,\n     HeroParentComponent,\n     MissionControlComponent,\n@@ -27,28 +34,8 @@ const directives: any[] = [\n     VersionChildComponent,\n     VersionParentComponent,\n     VoterComponent,\n-    VoteTakerComponent\n-  ];\n-\n-const schemas: any[] = [];\n-\n-// Include Countdown examples\n-// unless in e2e tests which they break.\n-if (!/e2e/.test(location.search)) {\n-  console.log('adding countdown timer examples');\n-  directives.push(CountdownLocalVarParentComponent);\n-  directives.push(CountdownViewChildParentComponent);\n-} else {\n-  // In e2e test use CUSTOM_ELEMENTS_SCHEMA to suppress unknown element errors\n-  schemas.push(CUSTOM_ELEMENTS_SCHEMA);\n-}\n-\n-@NgModule({\n-  imports: [\n-    BrowserModule\n+    VoteTakerComponent,\n   ],\n-  declarations: directives,\n   bootstrap: [ AppComponent ],\n-  schemas\n })\n export class AppModule { }"
        },
        {
            "sha": "cba4de07ac42a787c53ccee49acc0e3e808b7af3",
            "filename": "aio/content/examples/component-interaction/src/app/countdown-timer.component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fcountdown-timer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fcountdown-timer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fsrc%2Fapp%2Fcountdown-timer.component.ts?ref=2b6b9c95f9a67a5f830fd0430e63eec5aaa24ba1",
            "patch": "@@ -1,19 +1,16 @@\n // #docregion\n-import { Component, OnDestroy, OnInit } from '@angular/core';\n+import { Component, OnDestroy } from '@angular/core';\n \n @Component({\n   selector: 'app-countdown-timer',\n   template: '<p>{{message}}</p>'\n })\n-export class CountdownTimerComponent implements OnInit, OnDestroy {\n+export class CountdownTimerComponent implements OnDestroy {\n \n   intervalId = 0;\n   message = '';\n   seconds = 11;\n \n-  clearTimer() { clearInterval(this.intervalId); }\n-\n-  ngOnInit()    { this.start(); }\n   ngOnDestroy() { this.clearTimer(); }\n \n   start() { this.countDown(); }\n@@ -22,6 +19,8 @@ export class CountdownTimerComponent implements OnInit, OnDestroy {\n     this.message = `Holding at T-${this.seconds} seconds`;\n   }\n \n+  private clearTimer() { clearInterval(this.intervalId); }\n+\n   private countDown() {\n     this.clearTimer();\n     this.intervalId = window.setInterval(() => {"
        }
    ],
    "stats": {
        "total": 82,
        "additions": 27,
        "deletions": 55
    }
}