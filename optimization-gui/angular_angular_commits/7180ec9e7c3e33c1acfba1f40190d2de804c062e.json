{
    "author": "dylhunn",
    "message": "fix(forms): changes to status not always being emitted to statusChanges observable for async validators. (#42553)\n\nWhen a FormControl, FormArray, or FormGroup is first constructed, if an async validator is attached, the `statusChanges` observable should receive a message when the validator complete (i.e. pending -> valid/invalid). If the validator was provided as part of the constructor options, it was not fired at construction time, which is fixed in this PR.\n\nFixes #35309.\n\nPR Close #42553",
    "sha": "7180ec9e7c3e33c1acfba1f40190d2de804c062e",
    "files": [
        {
            "sha": "96c8f320fd89cddb173855847fc6aea155f4631f",
            "filename": "packages/forms/src/model.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "raw_url": "https://github.com/angular/angular/raw/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fmodel.ts?ref=7180ec9e7c3e33c1acfba1f40190d2de804c062e",
            "patch": "@@ -1167,7 +1167,7 @@ export class FormControl extends AbstractControl {\n       // `VALID` or `INVALID`.\n       // The status should be broadcasted via the `statusChanges` observable, so we set `emitEvent`\n       // to `true` to allow that during the control creation process.\n-      emitEvent: !!asyncValidator\n+      emitEvent: !!this.asyncValidator\n     });\n   }\n \n@@ -1433,7 +1433,7 @@ export class FormGroup extends AbstractControl {\n       // If `asyncValidator` is present, it will trigger control status change from `PENDING` to\n       // `VALID` or `INVALID`. The status should be broadcasted via the `statusChanges` observable,\n       // so we set `emitEvent` to `true` to allow that during the control creation process.\n-      emitEvent: !!asyncValidator\n+      emitEvent: !!this.asyncValidator\n     });\n   }\n \n@@ -1887,7 +1887,7 @@ export class FormArray extends AbstractControl {\n       // `VALID` or `INVALID`.\n       // The status should be broadcasted via the `statusChanges` observable, so we set `emitEvent`\n       // to `true` to allow that during the control creation process.\n-      emitEvent: !!asyncValidator\n+      emitEvent: !!this.asyncValidator\n     });\n   }\n "
        },
        {
            "sha": "0ddc42a564273baf67b76d7279c95b8f41ea1eed",
            "filename": "packages/forms/test/form_array_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_array_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_array_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_array_spec.ts?ref=7180ec9e7c3e33c1acfba1f40190d2de804c062e",
            "patch": "@@ -1055,6 +1055,23 @@ describe('FormArray', () => {\n          expect(g.errors).toEqual({'async': true, 'other': true});\n          expect(g.pending).toEqual(false);\n        }));\n+\n+    it('should fire statusChanges events when async validators are added via options object',\n+       fakeAsync(() => {\n+         // The behavior is tested (in other spec files) for each of the model types (`FormControl`,\n+         // `FormGroup` and `FormArray`).\n+         let statuses: string[] = [];\n+\n+         // Create a form control with an async validator added via options object.\n+         const asc = new FormArray([], {asyncValidators: [() => Promise.resolve(null)]});\n+\n+         // Subscribe to status changes.\n+         asc.statusChanges.subscribe((status: any) => statuses.push(status));\n+\n+         // After a tick, the async validator should change status PENDING -> VALID.\n+         tick();\n+         expect(statuses).toEqual(['VALID']);\n+       }));\n   });\n \n   describe('disable() & enable()', () => {"
        },
        {
            "sha": "3584e963f17dbb3d7dfac437e3e90685fbb29bba",
            "filename": "packages/forms/test/form_control_spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_control_spec.ts?ref=7180ec9e7c3e33c1acfba1f40190d2de804c062e",
            "patch": "@@ -879,6 +879,22 @@ describe('FormControl', () => {\n          tick();\n        }));\n \n+    it('should fire statusChanges events for async validators added via options object',\n+       fakeAsync(() => {\n+         // The behavior can be tested for each of the model types.\n+         let statuses: string[] = [];\n+\n+         // Create a form control with an async validator added via options object.\n+         const asc = new FormControl('', {asyncValidators: [() => Promise.resolve(null)]});\n+\n+         // Subscribe to status changes.\n+         asc.statusChanges.subscribe((status: any) => statuses.push(status));\n+\n+         // After a tick, the async validator should change status PENDING -> VALID.\n+         tick();\n+         expect(statuses).toEqual(['VALID']);\n+       }));\n+\n     it('should fire an event after the status has been updated to pending', fakeAsync(() => {\n          const c = new FormControl('old', Validators.required, asyncValidator('expected'));\n "
        },
        {
            "sha": "37de0698503bd83af7d3bb6b5f7158852ef55832",
            "filename": "packages/forms/test/form_group_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_group_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7180ec9e7c3e33c1acfba1f40190d2de804c062e/packages%2Fforms%2Ftest%2Fform_group_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_group_spec.ts?ref=7180ec9e7c3e33c1acfba1f40190d2de804c062e",
            "patch": "@@ -819,6 +819,21 @@ describe('FormGroup', () => {\n       group = new FormGroup({'one': control});\n     }));\n \n+    it('should fire statusChanges events for async validators added via options object',\n+       fakeAsync(() => {\n+         // The behavior can be tested for each of the model types.\n+         let statuses: string[] = [];\n+\n+         // Create a form control with an async validator added via options object.\n+         const asc = new FormGroup({}, {asyncValidators: [() => Promise.resolve(null)]});\n+\n+         // Subscribe to status changes.\n+         asc.statusChanges.subscribe((status: any) => statuses.push(status));\n+\n+         // After a tick, the async validator should change status PENDING -> VALID.\n+         tick();\n+         expect(statuses).toEqual(['VALID']);\n+       }));\n \n     // TODO(kara): update these tests to use fake Async\n     it('should fire a statusChange if child has async validation change', done => {"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 51,
        "deletions": 3
    }
}