{
    "author": "gkalpak",
    "message": "build(docs-infra): update scripts using Lighthouse to ES modules (#43607)\n\nUpdate the AIO scripts that use Lighthouse (i.e. `audit-web-app.js` and\n`test-aio-a11y.js`) to ES modules. This allows consuming\n`lighthouse/lighthouse-cli` [v8.5.0+][1], which also switched to ES\nmodules.\n\nNOTE:\nSwitching the `test-aio-a11y.js` script to ES modules is not strictly\nnecessary, since it invokes `audit-web-app.mjs` via a shell command, but\nit was done for consistency.\n\n[1]: https://github.com/GoogleChrome/lighthouse/releases/tag/v8.5.0\n\nPR Close #43607",
    "sha": "c997fef08ae6eb24bce86f3481a960587ce6871a",
    "files": [
        {
            "sha": "6dfc9edbdc199b184c78512f180582d761b2e071",
            "filename": "aio/package.json",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fpackage.json?ref=c997fef08ae6eb24bce86f3481a960587ce6871a",
            "patch": "@@ -35,7 +35,7 @@\n     \"set-opensearch-url\": \"node --eval \\\"const sh = require('shelljs'); sh.set('-e'); sh.sed('-i', /PLACEHOLDER_URL/g, process.argv[1], 'dist/assets/opensearch.xml');\\\"\",\n     \"presmoke-tests\": \"yarn update-webdriver\",\n     \"smoke-tests\": \"protractor tests/deployment/e2e/protractor.conf.js --suite smoke --baseUrl\",\n-    \"test-a11y-score\": \"node scripts/test-aio-a11y\",\n+    \"test-a11y-score\": \"node scripts/test-aio-a11y.mjs\",\n     \"test-a11y-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-a11y-score http://localhost:4200\\\" --\",\n     \"test-pwa-score\": \"run-s \\\"~~audit-web-app {1} all:0,pwa:{2} {3}\\\" --\",\n     \"test-pwa-score-localhost\": \"run-p --race \\\"~~light-server -s dist -p 4200 --quiet\\\" \\\"test-pwa-score http://localhost:4200 {1} {2}\\\" --\",\n@@ -69,7 +69,7 @@\n     \"build-404-page\": \"node scripts/build-404-page\",\n     \"update-webdriver\": \"node ../scripts/webdriver-manager-update.js\",\n     \"security-lint\": \"tsec -p tsconfig.app.json\",\n-    \"~~audit-web-app\": \"node scripts/audit-web-app\",\n+    \"~~audit-web-app\": \"node scripts/audit-web-app.mjs\",\n     \"~~check-env\": \"node scripts/check-environment\",\n     \"~~clean-generated\": \"node --eval \\\"require('shelljs').rm('-rf', 'src/generated')\\\"\",\n     \"pre~~build\": \"yarn ~~build-ce-es5-polyfills && yarn ~~build-ngsw-config\",\n@@ -162,8 +162,8 @@\n     \"karma-jasmine\": \"~4.0.0\",\n     \"karma-jasmine-html-reporter\": \"^1.5.0\",\n     \"light-server\": \"^2.9.1\",\n-    \"lighthouse\": \"^8.1.0\",\n-    \"lighthouse-logger\": \"^1.2.0\",\n+    \"lighthouse\": \"^8.5.1\",\n+    \"lighthouse-logger\": \"^1.3.0\",\n     \"lodash\": \"^4.17.21\",\n     \"lunr\": \"^2.3.9\",\n     \"npm-run-all\": \"^4.1.5\","
        },
        {
            "sha": "c7e5ad708ed82cbcde448da12ba9a354b59deb15",
            "filename": "aio/scripts/audit-web-app.mjs",
            "status": "renamed",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fscripts%2Faudit-web-app.mjs",
            "raw_url": "https://github.com/angular/angular/raw/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fscripts%2Faudit-web-app.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Faudit-web-app.mjs?ref=c997fef08ae6eb24bce86f3481a960587ce6871a",
            "patch": "@@ -1,10 +1,9 @@\n #!/bin/env node\n-'use strict';\n \n /**\n  * Usage:\n  * ```sh\n- * node scripts/audit-web-app <url> <min-scores> [<log-file>]\n+ * node scripts/audit-web-app.mjs <url> <min-scores> [<log-file>]\n  * ```\n  *\n  * Runs audits against the specified URL on specific categories (accessibility, best practices, performance, PWA, SEO).\n@@ -27,10 +26,10 @@\n  */\n \n // Imports\n-const lighthouse = require('lighthouse');\n-const printer = require('lighthouse/lighthouse-cli/printer');\n-const logger = require('lighthouse-logger');\n-const puppeteer = require('puppeteer');\n+import lighthouse from 'lighthouse';\n+import * as printer from 'lighthouse/lighthouse-cli/printer.js';\n+import logger from 'lighthouse-logger';\n+import puppeteer from 'puppeteer';\n \n // Constants\n const AUDIT_CATEGORIES = ['accessibility', 'best-practices', 'performance', 'pwa', 'seo'];",
            "previous_filename": "aio/scripts/audit-web-app.js"
        },
        {
            "sha": "126cf035e7b55c2189967038434e3ebe6642c2ba",
            "filename": "aio/scripts/test-aio-a11y.mjs",
            "status": "renamed",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fscripts%2Ftest-aio-a11y.mjs",
            "raw_url": "https://github.com/angular/angular/raw/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fscripts%2Ftest-aio-a11y.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Ftest-aio-a11y.mjs?ref=c997fef08ae6eb24bce86f3481a960587ce6871a",
            "patch": "@@ -1,10 +1,9 @@\n #!/bin/env node\n-'use strict';\n \n /**\n  * Usage:\n  * ```sh\n- * node scripts/test-aio-a11y <origin>\n+ * node scripts/test-aio-a11y.mjs <origin>\n  * ```\n  *\n  * Runs accessibility audits on several (pre-defined) pages on the specified origin. It fails, if\n@@ -15,7 +14,10 @@\n  */\n \n // Imports\n-const sh = require('shelljs');\n+import {dirname} from 'path';\n+import sh from 'shelljs';\n+import {fileURLToPath} from 'url';\n+\n sh.set('-e');\n \n // Constants\n@@ -32,7 +34,8 @@ const MIN_SCORES_PER_PAGE = {\n };\n \n // Run\n-const auditWebAppCmd = `\"${process.execPath}\" \"${__dirname}/audit-web-app\"`;\n+const __dirname = dirname(fileURLToPath(import.meta.url));\n+const auditWebAppCmd = `\"${process.execPath}\" \"${__dirname}/audit-web-app.mjs\"`;\n const origin = process.argv[2];\n for (const [page, minScore] of Object.entries(MIN_SCORES_PER_PAGE)) {\n   sh.exec(`${auditWebAppCmd} ${origin}/${page} accessibility:${minScore}`);",
            "previous_filename": "aio/scripts/test-aio-a11y.js"
        },
        {
            "sha": "ad0167ed933abdb9c50a9e9dab0d560820096f86",
            "filename": "aio/yarn.lock",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fyarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/c997fef08ae6eb24bce86f3481a960587ce6871a/aio%2Fyarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fyarn.lock?ref=c997fef08ae6eb24bce86f3481a960587ce6871a",
            "patch": "@@ -7487,7 +7487,7 @@ light-server@^2.9.1:\n     strip-json-comments \"^3.1.1\"\n     ws \"^7.3.1\"\n \n-lighthouse-logger@^1.0.0, lighthouse-logger@^1.2.0, lighthouse-logger@^1.3.0:\n+lighthouse-logger@^1.0.0, lighthouse-logger@^1.3.0:\n   version \"1.3.0\"\n   resolved \"https://registry.yarnpkg.com/lighthouse-logger/-/lighthouse-logger-1.3.0.tgz#ba6303e739307c4eee18f08249524e7dafd510db\"\n   integrity sha512-BbqAKApLb9ywUli+0a+PcV04SyJ/N1q/8qgCNe6U97KbPCS1BTksEuHFLYdvc8DltuhfxIUBqDZsC0bBGtl3lA==\n@@ -7500,7 +7500,7 @@ lighthouse-stack-packs@^1.5.0:\n   resolved \"https://registry.yarnpkg.com/lighthouse-stack-packs/-/lighthouse-stack-packs-1.5.0.tgz#c191f2b94db21602254baaebfb0bb90307a00ffa\"\n   integrity sha512-ntVOqFsrrTQYrNf+W+sNE9GjddW+ab5QN0WrrCikjMFsUvEQ28CvT0SXcHPZXFtcsb1lMSuVaNCmEuj7oXtYGQ==\n \n-lighthouse@^8.1.0:\n+lighthouse@^8.5.1:\n   version \"8.5.1\"\n   resolved \"https://registry.yarnpkg.com/lighthouse/-/lighthouse-8.5.1.tgz#0cf4f2d3ebf67e40cd14fcbb027c9d5fb3cfa912\"\n   integrity sha512-phe3g77N5AE5pf5TARUBb9uHLvvzwpd2z/S0G+6KrC5ShEe2laSxkiiTLo/jYxsrmy5kL7qohVztdOuafy4HGQ=="
        }
    ],
    "stats": {
        "total": 34,
        "additions": 18,
        "deletions": 16
    }
}