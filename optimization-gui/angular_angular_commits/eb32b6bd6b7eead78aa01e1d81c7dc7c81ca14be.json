{
    "author": "mhevery",
    "message": "refactor(core): Remove reliance on `TNodeType.View`. (#38707)\n\n`TNodeType.View` was created to support inline views. That feature did\nnot materialize and we have since removed the instructions for it, leave\n an unneeded `TNodeType.View` which was still used in a very\n inconsistent way. This change no longer created `TNodeType.View` (and\n there will be a follow up chang to completely remove it.)\n\nAlso simplified the mental model so that `LView[HOST]`/`LView[T_HOST]`\nalways point to the insertion location of the `LView`.\n\nPR Close #38707",
    "sha": "eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
    "files": [
        {
            "sha": "8c26c0a4898b6fe60b9e164db4e5c10b92b9a38d",
            "filename": "goldens/circular-deps/packages.json",
            "status": "modified",
            "additions": 6,
            "deletions": 21,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fcircular-deps%2Fpackages.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fcircular-deps%2Fpackages.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fcircular-deps%2Fpackages.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -389,27 +389,6 @@\n     \"packages/core/src/render3/definition.ts\",\n     \"packages/core/src/metadata/ng_module.ts\"\n   ],\n-  [\n-    \"packages/core/src/application_ref.ts\",\n-    \"packages/core/src/application_tokens.ts\",\n-    \"packages/core/src/linker/component_factory.ts\",\n-    \"packages/core/src/change_detection/change_detection.ts\",\n-    \"packages/core/src/change_detection/change_detector_ref.ts\",\n-    \"packages/core/src/render3/view_engine_compatibility.ts\",\n-    \"packages/core/src/render3/node_manipulation.ts\",\n-    \"packages/core/src/core.ts\",\n-    \"packages/core/src/metadata.ts\",\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/injectable.ts\",\n-    \"packages/core/src/di/jit/injectable.ts\",\n-    \"packages/core/src/di/jit/environment.ts\",\n-    \"packages/core/src/di/injector_compatibility.ts\",\n-    \"packages/core/src/di/injector.ts\",\n-    \"packages/core/src/di/r3_injector.ts\",\n-    \"packages/core/src/render3/definition.ts\",\n-    \"packages/core/src/metadata/ng_module.ts\"\n-  ],\n   [\n     \"packages/core/src/application_ref.ts\",\n     \"packages/core/src/application_tokens.ts\",\n@@ -904,6 +883,12 @@\n     \"packages/core/src/change_detection/differs/default_keyvalue_differ.ts\",\n     \"packages/core/src/change_detection/differs/keyvalue_differs.ts\"\n   ],\n+  [\n+    \"packages/core/src/debug/debug_node.ts\",\n+    \"packages/core/src/view/index.ts\",\n+    \"packages/core/src/view/entrypoint.ts\",\n+    \"packages/core/src/view/services.ts\"\n+  ],\n   [\n     \"packages/core/src/di/injectable.ts\",\n     \"packages/core/src/di/jit/injectable.ts\""
        },
        {
            "sha": "0d8ab13b75cbc586d53279c5df84f6aae9b85d30",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -12,7 +12,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3037,\n-        \"main-es2015\": 448493,\n+        \"main-es2015\": 447742,\n         \"polyfills-es2015\": 52415\n       }\n     }"
        },
        {
            "sha": "60e1524d25667e341bd5d2928c12a51613f87075",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -21,7 +21,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1485,\n-        \"main-es2015\": 146989,\n+        \"main-es2015\": 146417,\n         \"polyfills-es2015\": 36571\n       }\n     }\n@@ -39,7 +39,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 2289,\n-        \"main-es2015\": 242351,\n+        \"main-es2015\": 241850,\n         \"polyfills-es2015\": 36938,\n         \"5-es2015\": 751\n       }\n@@ -49,7 +49,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 2289,\n-        \"main-es2015\": 218961,\n+        \"main-es2015\": 218329,\n         \"polyfills-es2015\": 36723,\n         \"5-es2015\": 781\n       }"
        },
        {
            "sha": "2cdbd75585f6de78a3f668d8f19c40e3928bb827",
            "filename": "packages/core/src/debug/debug_node.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {Injector} from '../di/injector';\n+import {assertTNodeForLView} from '../render3/assert';\n import {CONTAINER_HEADER_OFFSET, LContainer, NATIVE} from '../render3/interfaces/container';\n import {TElementNode, TNode, TNodeFlags, TNodeType} from '../render3/interfaces/node';\n import {isComponentHost, isLContainer} from '../render3/interfaces/type_checks';\n@@ -15,7 +16,7 @@ import {getComponent, getContext, getInjectionTokens, getInjector, getListeners,\n import {INTERPOLATION_DELIMITER, renderStringify} from '../render3/util/misc_utils';\n import {getComponentLViewByIndex, getNativeByTNodeOrNull} from '../render3/util/view_utils';\n import {assertDomNode} from '../util/assert';\n-import {DebugContext} from '../view/types';\n+import {DebugContext} from '../view/index';\n \n \n \n@@ -525,6 +526,7 @@ function _queryAllR3(\n function _queryNodeChildrenR3(\n     tNode: TNode, lView: LView, predicate: Predicate<DebugElement>|Predicate<DebugNode>,\n     matches: DebugElement[]|DebugNode[], elementsOnly: boolean, rootNativeNode: any) {\n+  ngDevMode && assertTNodeForLView(tNode, lView);\n   const nativeNode = getNativeByTNodeOrNull(tNode, lView);\n   // For each type of TNode, specific logic is executed.\n   if (tNode.type === TNodeType.Element || tNode.type === TNodeType.ElementContainer) {\n@@ -616,9 +618,11 @@ function _queryNodeChildrenInContainerR3(\n     lContainer: LContainer, predicate: Predicate<DebugElement>|Predicate<DebugNode>,\n     matches: DebugElement[]|DebugNode[], elementsOnly: boolean, rootNativeNode: any) {\n   for (let i = CONTAINER_HEADER_OFFSET; i < lContainer.length; i++) {\n-    const childView = lContainer[i];\n-    _queryNodeChildrenR3(\n-        childView[TVIEW].node!, childView, predicate, matches, elementsOnly, rootNativeNode);\n+    const childView = lContainer[i] as LView;\n+    const firstChild = childView[TVIEW].firstChild;\n+    if (firstChild) {\n+      _queryNodeChildrenR3(firstChild, childView, predicate, matches, elementsOnly, rootNativeNode);\n+    }\n   }\n }\n \n@@ -658,7 +662,7 @@ function _addQueryMatchR3(\n  *\n  * @param nativeNode the current native node\n  * @param predicate the predicate to match\n- * @param matches the list of positive matches\n+ * @param matches the list where matches are stored\n  * @param elementsOnly whether only elements should be searched\n  */\n function _queryNativeNodeDescendants("
        },
        {
            "sha": "fde76e1801a1c2e07c1a295fb414361b55569637",
            "filename": "packages/core/src/di/injector_compatibility.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Fdi%2Finjector_compatibility.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Fdi%2Finjector_compatibility.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Finjector_compatibility.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -9,6 +9,7 @@\n import '../util/ng_dev_mode';\n \n import {Type} from '../interface/type';\n+import {assertNotEqual} from '../util/assert';\n import {getClosureSafeProperty} from '../util/property';\n import {stringify} from '../util/stringify';\n \n@@ -84,6 +85,19 @@ export function setInjectImplementation(\n   return previous;\n }\n \n+/**\n+ * Assert that `_injectImplementation` is not `fn`.\n+ *\n+ * This is useful, to prevent infinite recursion.\n+ *\n+ * @param fn Function which it should not equal to\n+ */\n+export function assertInjectImplementationNot(\n+    fn: (<T>(token: Type<T>|InjectionToken<T>, flags?: InjectFlags) => T | null)) {\n+  ngDevMode &&\n+      assertNotEqual(_injectImplementation, fn, 'Calling ɵɵinject would cause infinite recursion');\n+}\n+\n export function injectInjectorOnly<T>(token: Type<T>|InjectionToken<T>): T;\n export function injectInjectorOnly<T>(token: Type<T>|InjectionToken<T>, flags?: InjectFlags): T|\n     null;"
        },
        {
            "sha": "e9920df6d09036d4891faf2af6f5c96ab8ae14a4",
            "filename": "packages/core/src/render3/assert.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fassert.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fassert.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fassert.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -6,14 +6,16 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {assertDefined, assertEqual, assertIndexInRange, assertNumber, throwError} from '../util/assert';\n-import {getComponentDef, getNgModuleDef} from './definition';\n-import {LContainer} from './interfaces/container';\n-import {DirectiveDef} from './interfaces/definition';\n+import { assertDefined, assertEqual, assertNumber, throwError } from '../util/assert';\n+import { getComponentDef, getNgModuleDef } from './definition';\n+import { LContainer } from './interfaces/container';\n+import { DirectiveDef } from './interfaces/definition';\n import { PARENT_INJECTOR } from './interfaces/injector';\n-import {TNode} from './interfaces/node';\n-import {isLContainer, isLView} from './interfaces/type_checks';\n-import {HEADER_OFFSET, LView, TVIEW, TView} from './interfaces/view';\n+import { TNode } from './interfaces/node';\n+import { isLContainer, isLView } from './interfaces/type_checks';\n+import { HEADER_OFFSET, LView, TVIEW, TView } from './interfaces/view';\n+\n+\n \n // [Assert functions do not constraint type when they are guarded by a truthy\n // expression.](https://github.com/microsoft/TypeScript/issues/37295)\n@@ -147,4 +149,4 @@ export function assertNodeInjector(lView: LView, injectorIndex: number) {\n   assertNumber(\n       lView[injectorIndex + 8 /*PARENT_INJECTOR*/],\n       'injectorIndex should point to parent injector');\n-}\n\\ No newline at end of file\n+}"
        },
        {
            "sha": "427e00ad2ccd21988137bd32efc29fc35f26b83d",
            "filename": "packages/core/src/render3/component.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -129,9 +129,9 @@ export function renderComponent<T>(\n   const rootContext = createRootContext(opts.scheduler, opts.playerHandler);\n \n   const renderer = rendererFactory.createRenderer(hostRNode, componentDef);\n-  const rootTView = createTView(TViewType.Root, -1, null, 1, 0, null, null, null, null, null);\n+  const rootTView = createTView(TViewType.Root, null, null, 1, 0, null, null, null, null, null);\n   const rootView: LView = createLView(\n-      null, rootTView, rootContext, rootFlags, null, null, rendererFactory, renderer, undefined,\n+      null, rootTView, rootContext, rootFlags, null, null, rendererFactory, renderer, null,\n       opts.injector || null);\n \n   enterView(rootView);\n@@ -193,7 +193,7 @@ export function createRootComponentView(\n   const componentView = createLView(\n       rootView, getOrCreateTComponentView(def), null,\n       def.onPush ? LViewFlags.Dirty : LViewFlags.CheckAlways, rootView[HEADER_OFFSET], tNode,\n-      rendererFactory, viewRenderer, sanitizer);\n+      rendererFactory, viewRenderer, sanitizer || null, null);\n \n   if (tView.firstCreatePass) {\n     diPublicInInjector(getOrCreateNodeInjectorForNode(tNode, rootView), tView, def.type);"
        },
        {
            "sha": "8ef0a9b53747132142478e0ae20c9f77cca61aac",
            "filename": "packages/core/src/render3/component_ref.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -19,18 +19,16 @@ import {RendererFactory2} from '../render/api';\n import {Sanitizer} from '../sanitization/sanitizer';\n import {VERSION} from '../version';\n import {NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR} from '../view/provider';\n-\n import {assertComponentType} from './assert';\n import {createRootComponent, createRootComponentView, createRootContext, LifecycleHooksFeature} from './component';\n import {getComponentDef} from './definition';\n import {NodeInjector} from './di';\n-import {assignTViewNodeToLView, createLView, createTView, elementCreate, locateHostElement, renderView} from './instructions/shared';\n+import {createLView, createTView, elementCreate, locateHostElement, renderView} from './instructions/shared';\n import {ComponentDef} from './interfaces/definition';\n-import {TContainerNode, TElementContainerNode, TElementNode, TNode, TNodeType} from './interfaces/node';\n+import {TContainerNode, TElementContainerNode, TElementNode, TNode} from './interfaces/node';\n import {domRendererFactory3, RendererFactory3, RNode} from './interfaces/renderer';\n-import {LView, LViewFlags, TVIEW, TViewType} from './interfaces/view';\n+import {LView, LViewFlags, TViewType} from './interfaces/view';\n import {MATH_ML_NAMESPACE, SVG_NAMESPACE} from './namespaces';\n-import {assertNodeOfPossibleTypes} from './node_assert';\n import {writeDirectClass} from './node_manipulation';\n import {extractAttrsAndClassesFromSelector, stringifyCSSSelectorList} from './node_selector_matcher';\n import {enterView, leaveView} from './state';\n@@ -158,7 +156,7 @@ export class ComponentFactory<T> extends viewEngine_ComponentFactory<T> {\n     const rootContext = createRootContext();\n \n     // Create the root view. Uses empty TView and ContentTemplate.\n-    const rootTView = createTView(TViewType.Root, -1, null, 1, 0, null, null, null, null, null);\n+    const rootTView = createTView(TViewType.Root, null, null, 1, 0, null, null, null, null, null);\n     const rootLView = createLView(\n         null, rootTView, rootContext, rootFlags, null, null, rendererFactory, hostRenderer,\n         sanitizer, rootViewInjector);\n@@ -223,11 +221,6 @@ export class ComponentFactory<T> extends viewEngine_ComponentFactory<T> {\n     const componentRef = new ComponentRef(\n         this.componentType, component,\n         createElementRef(viewEngine_ElementRef, tElementNode, rootLView), rootLView, tElementNode);\n-\n-    // The host element of the internal root view is attached to the component's host view node.\n-    ngDevMode && assertNodeOfPossibleTypes(rootTView.node, [TNodeType.View]);\n-    rootTView.node!.child = tElementNode;\n-\n     return componentRef;\n   }\n }\n@@ -267,7 +260,6 @@ export class ComponentRef<T> extends viewEngine_ComponentRef<T> {\n     super();\n     this.instance = instance;\n     this.hostView = this.changeDetectorRef = new RootViewRef<T>(_rootLView);\n-    assignTViewNodeToLView(_rootLView[TVIEW], null, -1, _rootLView);\n     this.componentType = componentType;\n   }\n "
        },
        {
            "sha": "de2211c71030f4865e40317210ed9b04459ae1a9",
            "filename": "packages/core/src/render3/context_discovery.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -190,13 +190,11 @@ export function isDirectiveInstance(instance: any): boolean {\n  * Locates the element within the given LView and returns the matching index\n  */\n function findViaNativeElement(lView: LView, target: RElement): number {\n-  let tNode = lView[TVIEW].firstChild;\n-  while (tNode) {\n-    const native = getNativeByTNodeOrNull(tNode, lView)!;\n-    if (native === target) {\n-      return tNode.index;\n+  const tView = lView[TVIEW];\n+  for (let i = HEADER_OFFSET; i < tView.bindingStartIndex; i++) {\n+    if (unwrapRNode(lView[i]) === target) {\n+      return i;\n     }\n-    tNode = traverseNextElement(tNode);\n   }\n \n   return -1;\n@@ -206,7 +204,11 @@ function findViaNativeElement(lView: LView, target: RElement): number {\n  * Locates the next tNode (child, sibling or parent).\n  */\n function traverseNextElement(tNode: TNode): TNode|null {\n-  if (tNode.child) {\n+  if (tNode.child && tNode.child.parent === tNode) {\n+    // FIXME(misko): checking if `tNode.child.parent === tNode` should not be necessary\n+    // We have added it here because i18n creates TNode's which are not valid, so this is a work\n+    // around. The i18n code is being refactored in #??? and once it lands this extra check can be\n+    // deleted.\n     return tNode.child;\n   } else if (tNode.next) {\n     return tNode.next;"
        },
        {
            "sha": "f7b4043d277184c6f709e636adb79af67d5a3803",
            "filename": "packages/core/src/render3/di.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 30,
            "changes": 92,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fdi.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fdi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fdi.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -13,18 +13,18 @@ import {injectRootLimpMode, setInjectImplementation} from '../di/injector_compat\n import {getInjectorDef} from '../di/interface/defs';\n import {InjectFlags} from '../di/interface/injector';\n import {Type} from '../interface/type';\n-import {assertDefined, assertEqual} from '../util/assert';\n+import {assertDefined, assertEqual, assertIndexInRange, throwError} from '../util/assert';\n import {noSideEffects} from '../util/closure';\n \n-import {assertDirectiveDef} from './assert';\n+import {assertDirectiveDef, assertNodeInjector, assertTNodeForLView} from './assert';\n import {getFactoryDef} from './definition';\n import {NG_ELEMENT_ID, NG_FACTORY_DEF} from './fields';\n import {registerPreOrderHooks} from './hooks';\n import {DirectiveDef, FactoryFn} from './interfaces/definition';\n import {isFactory, NO_PARENT_INJECTOR, NodeInjectorFactory, PARENT_INJECTOR, RelativeInjectorLocation, RelativeInjectorLocationFlags, TNODE} from './interfaces/injector';\n import {AttributeMarker, TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TNode, TNodeProviderIndexes, TNodeType} from './interfaces/node';\n import {isComponentDef, isComponentHost} from './interfaces/type_checks';\n-import {DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, INJECTOR, LView, T_HOST, TData, TVIEW, TView} from './interfaces/view';\n+import {DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, INJECTOR, LView, T_HOST, TData, TVIEW, TView, TViewType} from './interfaces/view';\n import {assertNodeOfPossibleTypes} from './node_assert';\n import {enterDI, leaveDI} from './state';\n import {isNameOnlyAttributeMarker} from './util/attrs_utils';\n@@ -184,16 +184,17 @@ function insertBloom(arr: any[], footer: TNode|null): void {\n }\n \n \n-export function getInjectorIndex(tNode: TNode, hostView: LView): number {\n+export function getInjectorIndex(tNode: TNode, lView: LView): number {\n   if (tNode.injectorIndex === -1 ||\n       // If the injector index is the same as its parent's injector index, then the index has been\n       // copied down from the parent node. No injector has been created yet on this node.\n       (tNode.parent && tNode.parent.injectorIndex === tNode.injectorIndex) ||\n       // After the first template pass, the injector index might exist but the parent values\n       // might not have been calculated yet for this instance\n-      hostView[tNode.injectorIndex + PARENT_INJECTOR] == null) {\n+      lView[tNode.injectorIndex + PARENT_INJECTOR] == null) {\n     return -1;\n   } else {\n+    ngDevMode && assertIndexInRange(lView, tNode.injectorIndex);\n     return tNode.injectorIndex;\n   }\n }\n@@ -204,25 +205,55 @@ export function getInjectorIndex(tNode: TNode, hostView: LView): number {\n  *\n  * Returns a combination of number of `LView` we have to go up and index in that `LView`\n  */\n-export function getParentInjectorLocation(tNode: TNode, view: LView): RelativeInjectorLocation {\n+export function getParentInjectorLocation(tNode: TNode, lView: LView): RelativeInjectorLocation {\n   if (tNode.parent && tNode.parent.injectorIndex !== -1) {\n+    // If we have a parent `TNode` and there is an injector associated with it we are done, because\n+    // the parent injector is within the current `LView`.\n     return tNode.parent.injectorIndex as any;  // ViewOffset is 0\n   }\n \n-  // For most cases, the parent injector index can be found on the host node (e.g. for component\n-  // or container), so this loop will be skipped, but we must keep the loop here to support\n-  // the rarer case of deeply nested <ng-template> tags or inline views.\n-  let hostTNode = view[T_HOST];\n-  let viewOffset = 1;\n-  while (hostTNode && hostTNode.injectorIndex === -1) {\n-    view = view[DECLARATION_VIEW]!;\n-    hostTNode = view ? view[T_HOST] : null;\n-    viewOffset++;\n-  }\n+  // When parent injector location is computed it may be outside of the current view. (ie it could\n+  // be pointing to a declared parent location). This variable stores number of declaration parents\n+  // we need to walk up in order to find the parent injector location.\n+  let declarationViewOffset = 0;\n+  let parentTNode: TNode|null = null;\n+  let lViewCursor: LView|null = lView;\n+\n+  // The parent injector is not in the current `LView`. We will have to walk the declared parent\n+  // `LView` hierarchy and look for it. If we walk of the top, that means that there is no parent\n+  // `NodeInjector`.\n+  while (lViewCursor !== null) {\n+    // First determine the `parentTNode` location. The parent pointer differs based on `TView.type`.\n+    const tView = lViewCursor[TVIEW];\n+    const tViewType = tView.type;\n+    if (tViewType === TViewType.Embedded) {\n+      ngDevMode && assertDefined(tView.node, 'Embedded TNodes should have declaration parents.');\n+      parentTNode = tView.node;\n+    } else if (tViewType === TViewType.Component) {\n+      // Components don't have `TView.declTNode` because each instance of component could be\n+      // inserted in different location, hence `TView.declTNode` is meaningless.\n+      parentTNode = lViewCursor[T_HOST];\n+    } else {\n+      ngDevMode && assertEqual(tView.type, TViewType.Root, 'Root type expected');\n+      parentTNode = null;\n+    }\n+    if (parentTNode === null) {\n+      // If we have no parent, than we are done.\n+      return NO_PARENT_INJECTOR;\n+    }\n \n-  return hostTNode ?\n-      hostTNode.injectorIndex | (viewOffset << RelativeInjectorLocationFlags.ViewOffsetShift) :\n-      -1 as any;\n+    ngDevMode && parentTNode && assertTNodeForLView(parentTNode!, lViewCursor[DECLARATION_VIEW]!);\n+    // Every iteration of the loop requires that we go to the declared parent.\n+    declarationViewOffset++;\n+    lViewCursor = lViewCursor[DECLARATION_VIEW];\n+\n+    if (parentTNode.injectorIndex !== -1) {\n+      // We found a NodeInjector which points to something.\n+      return (parentTNode.injectorIndex |\n+              (declarationViewOffset << RelativeInjectorLocationFlags.ViewOffsetShift)) as any;\n+    }\n+  }\n+  return NO_PARENT_INJECTOR;\n }\n \n /**\n@@ -367,13 +398,12 @@ export function getOrCreateInjectable<T>(\n           flags & InjectFlags.Host ? lView[DECLARATION_COMPONENT_VIEW][T_HOST] : null;\n \n       // If we should skip this injector, or if there is no injector on this node, start by\n-      // searching\n-      // the parent injector.\n+      // searching the parent injector.\n       if (injectorIndex === -1 || flags & InjectFlags.SkipSelf) {\n         parentLocation = injectorIndex === -1 ? getParentInjectorLocation(tNode, lView) :\n                                                 lView[injectorIndex + PARENT_INJECTOR];\n \n-        if (!shouldSearchParent(flags, false)) {\n+        if (parentLocation === NO_PARENT_INJECTOR || !shouldSearchParent(flags, false)) {\n           injectorIndex = -1;\n         } else {\n           previousTView = lView[TVIEW];\n@@ -385,10 +415,11 @@ export function getOrCreateInjectable<T>(\n       // Traverse up the injector tree until we find a potential match or until we know there\n       // *isn't* a match.\n       while (injectorIndex !== -1) {\n-        parentLocation = lView[injectorIndex + PARENT_INJECTOR];\n+        ngDevMode && assertNodeInjector(lView, injectorIndex);\n \n         // Check the current injector. If it matches, see if it contains token.\n         const tView = lView[TVIEW];\n+        ngDevMode && assertTNodeForLView(tView.data[injectorIndex + TNODE] as TNode, lView);\n         if (bloomHasToken(bloomHash, injectorIndex, tView.data)) {\n           // At this point, we have an injector which *may* contain the token, so we step through\n           // the providers and directives associated with the injector's corresponding node to get\n@@ -399,7 +430,9 @@ export function getOrCreateInjectable<T>(\n             return instance;\n           }\n         }\n-        if (shouldSearchParent(\n+        parentLocation = lView[injectorIndex + PARENT_INJECTOR];\n+        if (parentLocation !== NO_PARENT_INJECTOR &&\n+            shouldSearchParent(\n                 flags, lView[TVIEW].data[injectorIndex + TNODE] === hostTElementNode) &&\n             bloomHasToken(bloomHash, injectorIndex, lView)) {\n           // The def wasn't found anywhere on this node, so it was a false positive.\n@@ -453,7 +486,7 @@ function searchTokensOnInjector<T>(\n   const currentTView = lView[TVIEW];\n   const tNode = currentTView.data[injectorIndex + TNODE] as TNode;\n   // First, we need to determine if view providers can be accessed by the starting element.\n-  // There are two possibities\n+  // There are two possibilities\n   const canAccessViewProviders = previousTView == null ?\n       // 1) This is the first invocation `previousTView == null` which means that we are at the\n       // `TNode` of where injector is starting to look. In such a case the only time we are allowed\n@@ -544,10 +577,8 @@ export function getNodeInjectable(\n     }\n     const previousIncludeViewProviders = setIncludeViewProviders(factory.canSeeViewProviders);\n     factory.resolving = true;\n-    let previousInjectImplementation;\n-    if (factory.injectImpl) {\n-      previousInjectImplementation = setInjectImplementation(factory.injectImpl);\n-    }\n+    const previousInjectImplementation =\n+        factory.injectImpl ? setInjectImplementation(factory.injectImpl) : null;\n     enterDI(lView, tNode);\n     try {\n       value = lView[index] = factory.factory(undefined, tData, lView, tNode);\n@@ -562,7 +593,8 @@ export function getNodeInjectable(\n         registerPreOrderHooks(index, tData[index] as DirectiveDef<any>, tView);\n       }\n     } finally {\n-      if (factory.injectImpl) setInjectImplementation(previousInjectImplementation);\n+      previousInjectImplementation !== null &&\n+          setInjectImplementation(previousInjectImplementation);\n       setIncludeViewProviders(previousIncludeViewProviders);\n       factory.resolving = false;\n       leaveDI();"
        },
        {
            "sha": "81e23b9622acf13c8b785bffe9b2c583832e603a",
            "filename": "packages/core/src/render3/i18n/i18n_apply.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -354,7 +354,13 @@ function appendI18nNode(\n   // Re-organize node tree to put this node in the correct position.\n   if (previousTNode === parentTNode && tNode !== parentTNode.child) {\n     tNode.next = parentTNode.child;\n-    parentTNode.child = tNode;\n+    // FIXME(misko): Checking `tNode.parent` is a temporary workaround until we properly\n+    // refactor the i18n code in #38707 and this code will be deleted.\n+    if (tNode.parent === null) {\n+      tView.firstChild = tNode;\n+    } else {\n+      parentTNode.child = tNode;\n+    }\n   } else if (previousTNode !== parentTNode && tNode !== previousTNode.next) {\n     tNode.next = previousTNode.next;\n     previousTNode.next = tNode;\n@@ -446,7 +452,7 @@ function removeNode(tView: TView, lView: LView, index: number, markAsDetached: b\n     }\n   }\n \n-  if (markAsDetached) {\n+  if (markAsDetached && removedPhTNode) {\n     // Define this node as detached to avoid projecting it later\n     removedPhTNode.flags |= TNodeFlags.isDetached;\n   }"
        },
        {
            "sha": "ce010ab12666a3e8c4c4b7ebac9a12c2dccf2e88",
            "filename": "packages/core/src/render3/instructions/di.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {InjectFlags, InjectionToken, resolveForwardRef} from '../../di';\n-import {ɵɵinject} from '../../di/injector_compatibility';\n+import {assertInjectImplementationNot, ɵɵinject} from '../../di/injector_compatibility';\n import {Type} from '../../interface/type';\n import {getOrCreateInjectable, injectAttributeImpl} from '../di';\n import {TDirectiveHostNode} from '../interfaces/node';\n@@ -43,7 +43,11 @@ export function ɵɵdirectiveInject<T>(\n   const lView = getLView();\n   // Fall back to inject() if view hasn't been created. This situation can happen in tests\n   // if inject utilities are used before bootstrapping.\n-  if (lView == null) return ɵɵinject(token, flags);\n+  if (lView === null) {\n+    // Verify that we will not get into infinite loop.\n+    ngDevMode && assertInjectImplementationNot(ɵɵdirectiveInject);\n+    return ɵɵinject(token, flags);\n+  }\n   const tNode = getPreviousOrParentTNode();\n   return getOrCreateInjectable<T>(\n       tNode as TDirectiveHostNode, lView, resolveForwardRef(token), flags);"
        },
        {
            "sha": "4a7117049121ee36c56f4d7df805a86b22dd03fc",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -17,7 +17,7 @@ import {getInjectorIndex} from '../di';\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE} from '../interfaces/container';\n import {ComponentTemplate, DirectiveDef, DirectiveDefList, PipeDefList, ViewQueriesFunction} from '../interfaces/definition';\n import {NO_PARENT_INJECTOR, PARENT_INJECTOR, TNODE} from '../interfaces/injector';\n-import {AttributeMarker, PropertyAliases, TConstants, TContainerNode, TElementNode, TNode as ITNode, TNodeFlags, TNodeProviderIndexes, TNodeType, TNodeTypeAsString, TViewNode} from '../interfaces/node';\n+import {AttributeMarker, PropertyAliases, TConstants, TContainerNode, TElementNode, TNode as ITNode, TNodeFlags, TNodeProviderIndexes, TNodeType, TNodeTypeAsString} from '../interfaces/node';\n import {SelectorFlags} from '../interfaces/projection';\n import {LQueries, TQueries} from '../interfaces/query';\n import {RComment, RElement, Renderer3, RendererFactory3, RNode} from '../interfaces/renderer';\n@@ -116,12 +116,11 @@ function nameSuffix(text: string|null|undefined): string {\n export const TViewConstructor = class TView implements ITView {\n   constructor(\n       public type: TViewType,                                //\n-      public id: number,                                     //\n       public blueprint: LView,                               //\n       public template: ComponentTemplate<{}>|null,           //\n       public queries: TQueries|null,                         //\n       public viewQuery: ViewQueriesFunction<{}>|null,        //\n-      public node: TViewNode|TElementNode|null,              //\n+      public node: ITNode|null,                              //\n       public data: TData,                                    //\n       public bindingStartIndex: number,                      //\n       public expandoStartIndex: number,                      //\n@@ -493,7 +492,7 @@ export class LViewDebug implements ILViewDebug {\n   get queries(): LQueries|null {\n     return this._raw_lView[QUERIES];\n   }\n-  get tHost(): TViewNode|TElementNode|null {\n+  get tHost(): ITNode|null {\n     return this._raw_lView[T_HOST];\n   }\n "
        },
        {
            "sha": "d4226fe72d019c11cd495c1354fde03ae2e63698",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 29,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -17,7 +17,7 @@ import {createNamedArrayType} from '../../util/named_array_type';\n import {initNgDevMode} from '../../util/ng_dev_mode';\n import {normalizeDebugBindingName, normalizeDebugBindingValue} from '../../util/ng_reflect';\n import {stringify} from '../../util/stringify';\n-import {assertFirstCreatePass, assertLContainer, assertLView} from '../assert';\n+import {assertFirstCreatePass, assertLContainer, assertLView, assertTNodeForLView} from '../assert';\n import {attachPatchData} from '../context_discovery';\n import {getFactoryDef} from '../definition';\n import {diPublicInInjector, getNodeInjectable, getOrCreateNodeInjectorForNode} from '../di';\n@@ -172,13 +172,14 @@ export function elementCreate(name: string, renderer: Renderer3, namespace: stri\n \n export function createLView<T>(\n     parentLView: LView|null, tView: TView, context: T|null, flags: LViewFlags, host: RElement|null,\n-    tHostNode: TViewNode|TElementNode|null, rendererFactory?: RendererFactory3|null,\n-    renderer?: Renderer3|null, sanitizer?: Sanitizer|null, injector?: Injector|null): LView {\n+    tHostNode: TNode|null, rendererFactory: RendererFactory3|null, renderer: Renderer3|null,\n+    sanitizer: Sanitizer|null, injector: Injector|null): LView {\n   const lView =\n       ngDevMode ? cloneToLViewFromTViewBlueprint(tView) : tView.blueprint.slice() as LView;\n   lView[HOST] = host;\n   lView[FLAGS] = flags | LViewFlags.CreationMode | LViewFlags.Attached | LViewFlags.FirstLViewPass;\n   resetPreOrderHookFlags(lView);\n+  ngDevMode && tView.node && parentLView && assertTNodeForLView(tView.node, parentLView);\n   lView[PARENT] = lView[DECLARATION_VIEW] = parentLView;\n   lView[CONTEXT] = context;\n   lView[RENDERER_FACTORY] = (rendererFactory || parentLView && parentLView[RENDERER_FACTORY])!;\n@@ -250,7 +251,7 @@ function createTNodeAtIndex(\n   const parentInSameView = parent !== null && parent.type !== TNodeType.View;\n   const tParentNode = parentInSameView ? parent as TElementNode | TContainerNode : null;\n   const tNode = tView.data[adjustedIndex] =\n-      createTNode(tView, tParentNode, type, adjustedIndex, name, attrs);\n+      createTNode(tView, parent as TElementNode | TContainerNode, type, adjustedIndex, name, attrs);\n   // Assign a pointer to the first child node of a given view. The first node is not always the one\n   // at index 0, in case of i18n, index 0 can be the instruction `i18nStart` and the first node has\n   // the index 1 or more, so we can't just check node index.\n@@ -269,23 +270,6 @@ function createTNodeAtIndex(\n   return tNode;\n }\n \n-export function assignTViewNodeToLView(\n-    tView: TView, tParentNode: TNode|null, index: number, lView: LView): void {\n-  // View nodes are not stored in data because they can be added / removed at runtime (which\n-  // would cause indices to change). Their TNodes are instead stored in tView.node.\n-  let tNode = tView.node;\n-  if (tNode == null) {\n-    ngDevMode && tParentNode &&\n-        assertNodeOfPossibleTypes(tParentNode, [TNodeType.Element, TNodeType.Container]);\n-    tView.node = tNode = createTNode(\n-                             tView,\n-                             tParentNode as TElementNode | TContainerNode | null,  //\n-                             TNodeType.View, index, null, null) as TViewNode;\n-  }\n-\n-  lView[T_HOST] = tNode as TViewNode;\n-}\n-\n \n /**\n  * When elements are created dynamically after a view blueprint is created (e.g. through\n@@ -623,8 +607,11 @@ export function getOrCreateTComponentView(def: ComponentDef<any>): TView {\n   // Create a TView if there isn't one, or recreate it if the first create pass didn't\n   // complete successfully since we can't know for sure whether it's in a usable shape.\n   if (tView === null || tView.incompleteFirstPass) {\n+    // Declaration node here is null since this function is called when we dynamically create a\n+    // component and hence there is no declaration.\n+    const declTNode = null;\n     return def.tView = createTView(\n-               TViewType.Component, -1, def.template, def.decls, def.vars, def.directiveDefs,\n+               TViewType.Component, declTNode, def.template, def.decls, def.vars, def.directiveDefs,\n                def.pipeDefs, def.viewQuery, def.schemas, def.consts);\n   }\n \n@@ -635,7 +622,8 @@ export function getOrCreateTComponentView(def: ComponentDef<any>): TView {\n /**\n  * Creates a TView instance\n  *\n- * @param viewIndex The viewBlockId for inline views, or -1 if it's a component/dynamic\n+ * @param type Type of `TView`.\n+ * @param declTNode Declaration location of this `TView`.\n  * @param templateFn Template function\n  * @param decls The number of nodes, local refs, and pipes in this template\n  * @param directives Registry of directives for this view\n@@ -645,7 +633,7 @@ export function getOrCreateTComponentView(def: ComponentDef<any>): TView {\n  * @param consts Constants for this view\n  */\n export function createTView(\n-    type: TViewType, viewIndex: number, templateFn: ComponentTemplate<any>|null, decls: number,\n+    type: TViewType, declTNode: TNode|null, templateFn: ComponentTemplate<any>|null, decls: number,\n     vars: number, directives: DirectiveDefListOrFactory|null, pipes: PipeDefListOrFactory|null,\n     viewQuery: ViewQueriesFunction<any>|null, schemas: SchemaMetadata[]|null,\n     constsOrFactory: TConstantsOrFactory|null): TView {\n@@ -660,12 +648,11 @@ export function createTView(\n   const tView = blueprint[TVIEW as any] = ngDevMode ?\n       new TViewConstructor(\n           type,\n-          viewIndex,   // id: number,\n           blueprint,   // blueprint: LView,\n           templateFn,  // template: ComponentTemplate<{}>|null,\n           null,        // queries: TQueries|null\n           viewQuery,   // viewQuery: ViewQueriesFunction<{}>|null,\n-          null!,       // node: TViewNode|TElementNode|null,\n+          declTNode,   // declTNode: TNode|null,\n           cloneToTViewData(blueprint).fill(null, bindingStartIndex),  // data: TData,\n           bindingStartIndex,                                          // bindingStartIndex: number,\n           initialViewLength,                                          // expandoStartIndex: number,\n@@ -697,12 +684,11 @@ export function createTView(\n           ) :\n       {\n         type: type,\n-        id: viewIndex,\n         blueprint: blueprint,\n         template: templateFn,\n         queries: null,\n         viewQuery: viewQuery,\n-        node: null!,\n+        node: declTNode,\n         data: blueprint.slice().fill(null, bindingStartIndex),\n         bindingStartIndex: bindingStartIndex,\n         expandoStartIndex: initialViewLength,\n@@ -812,6 +798,7 @@ export function storeCleanupWithContext(\n  * Constructs a TNode object from the arguments.\n  *\n  * @param tView `TView` to which this `TNode` belongs (used only in `ngDevMode`)\n+ * @param tParent Parent `TNode`\n  * @param type The type of the node\n  * @param adjustedIndex The index of the TNode in TView.data, adjusted for HEADER_OFFSET\n  * @param tagName The tag name of the node\n@@ -1488,7 +1475,8 @@ function addComponentLogic<T>(lView: LView, hostTNode: TElementNode, def: Compon\n       lView,\n       createLView(\n           lView, tView, null, def.onPush ? LViewFlags.Dirty : LViewFlags.CheckAlways, native,\n-          hostTNode as TElementNode, rendererFactory, rendererFactory.createRenderer(native, def)));\n+          hostTNode as TElementNode, rendererFactory, rendererFactory.createRenderer(native, def),\n+          null, null));\n \n   // Component view will always be created before any injected LContainers,\n   // so this is a regular element, wrap it with the component view"
        },
        {
            "sha": "1bfacec8d77025eb56dd34acf9b5ed3839c95b2d",
            "filename": "packages/core/src/render3/instructions/template.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -35,13 +35,8 @@ function templateFirstCreatePass(\n   registerPostOrderHooks(tView, tNode);\n \n   const embeddedTView = tNode.tViews = createTView(\n-      TViewType.Embedded, -1, templateFn, decls, vars, tView.directiveRegistry, tView.pipeRegistry,\n-      null, tView.schemas, tViewConsts);\n-  const embeddedTViewNode =\n-      createTNode(embeddedTView, null, TNodeType.View, -1, null, null) as TViewNode;\n-  embeddedTViewNode.injectorIndex = tNode.injectorIndex;\n-  // FIXME(misko): remove `embeddedTView.node'\n-  embeddedTView.node = embeddedTView.firstChild = embeddedTViewNode;\n+      TViewType.Embedded, tNode, templateFn, decls, vars, tView.directiveRegistry,\n+      tView.pipeRegistry, null, tView.schemas, tViewConsts);\n \n   if (tView.queries !== null) {\n     tView.queries.template(tView, tNode);"
        },
        {
            "sha": "566775cfa18a7119481bebdb5b52ff0f243e8f16",
            "filename": "packages/core/src/render3/interfaces/injector.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Finjector.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Finjector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Finjector.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -14,6 +14,11 @@ import {assertDefined, assertEqual} from '../../util/assert';\n import {TDirectiveHostNode} from './node';\n import {LView, TData} from './view';\n \n+/**\n+ * Offset from 'injectorIndex' where:\n+ * - `TViewData[injectorIndex + TNODE]` => `TNode` associated with the current injector.\n+ * - `LView[injectorIndex + TNODE]` => index to the parent injector.\n+ */\n export const TNODE = 8;\n export const PARENT_INJECTOR = 8;\n export const INJECTOR_BLOOM_PARENT_SIZE = 9;"
        },
        {
            "sha": "8ee233cb7bc6658500b1158aa82e838c780bb1e3",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 34,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -41,6 +41,7 @@ export const RENDERER = 11;\n export const SANITIZER = 12;\n export const CHILD_HEAD = 13;\n export const CHILD_TAIL = 14;\n+// FIXME(misko): Investigate if the three declarations aren't all same thing.\n export const DECLARATION_VIEW = 15;\n export const DECLARATION_COMPONENT_VIEW = 16;\n export const DECLARATION_LCONTAINER = 17;\n@@ -79,8 +80,7 @@ export interface LView extends Array<any> {\n   debug?: LViewDebug;\n \n   /**\n-   * The host node for this LView instance, if this is a component view.\n-   * If this is an embedded view, HOST will be null.\n+   * The node into which this `LView` is inserted.\n    */\n   [HOST]: RElement|null;\n \n@@ -120,16 +120,35 @@ export interface LView extends Array<any> {\n   [QUERIES]: LQueries|null;\n \n   /**\n-   * Pointer to the `TViewNode` or `TElementNode` which represents the root of the view.\n+   * Store the `TNode` of the location where the current `LView` is inserted into.\n    *\n-   * If `TViewNode`, this is an embedded view of a container. We need this to be able to\n-   * efficiently find the `LViewNode` when inserting the view into an anchor.\n+   * Given:\n+   * ```\n+   * <div>\n+   *   <ng-template><span></span></ng-template>\n+   * </div>\n+   * ```\n+   *\n+   * We end up with two `TView`s.\n+   * - `parent` `TView` which contains `<div><!-- anchor --></div>`\n+   * - `child` `TView` which contains `<span></span>`\n+   *\n+   * Typically the `child` is inserted into the declaration location of the `parent`, but it can be\n+   * inserted anywhere. Because it can be inserted anywhere it is not possible to store the\n+   * insertion information in the `TView` and instead we must store it in the `LView[T_HOST]`.\n+   *\n+   * So to determine where is our insertion parent we would execute:\n+   * ```\n+   * const parentLView = lView[PARENT];\n+   * const parentTNode = lView[T_HOST];\n+   * const insertionParent = parentLView[parentTNode.index];\n+   * ```\n    *\n-   * If `TElementNode`, this is the LView of a component.\n    *\n-   * If null, this is the root view of an application (root component is in this view).\n+   * If `null`, this is the root view of an application (root component is in this view) and it has\n+   * no parents.\n    */\n-  [T_HOST]: TViewNode|TElementNode|null;\n+  [T_HOST]: TNode|null;\n \n   /**\n    * When a view is destroyed, listeners need to be released and outputs need to be\n@@ -183,8 +202,6 @@ export interface LView extends Array<any> {\n   /**\n    * View where this view's template was declared.\n    *\n-   * Only applicable for dynamically created views. Will be null for inline/component views.\n-   *\n    * The template for a dynamically created view may be declared in a different view than\n    * it is inserted. We already track the \"insertion view\" (view where the template was\n    * inserted) in LView[PARENT], but we also need access to the \"declaration view\"\n@@ -439,6 +456,17 @@ export const enum TViewType {\n   Embedded = 2,\n }\n \n+/**\n+ * Converts `TViewType` into human readable text.\n+ * Make sure this matches with `TViewType`\n+ */\n+export const TViewTypeAsString = [\n+  'Root',       // 0\n+  'Component',  // 1\n+  'Embedded',   // 2\n+] as const;\n+\n+\n /**\n  * The static data for an LView (shared between all templates of a\n  * given type).\n@@ -451,15 +479,6 @@ export interface TView {\n    */\n   type: TViewType;\n \n-  /**\n-   * ID for inline views to determine whether a view is the same as the previous view\n-   * in a certain position. If it's not, we know the new view needs to be inserted\n-   * and the one that exists needs to be removed (e.g. if/else statements)\n-   *\n-   * If this is -1, then this is a component view or a dynamically created view.\n-   */\n-  readonly id: number;\n-\n   /**\n    * This is a blueprint used to generate LView instances for this TView. Copying this\n    * blueprint is faster than creating a new LView from scratch.\n@@ -478,21 +497,12 @@ export interface TView {\n   viewQuery: ViewQueriesFunction<{}>|null;\n \n   /**\n-   * Pointer to the host `TNode` (not part of this TView).\n-   *\n-   * If this is a `TViewNode` for an `LViewNode`, this is an embedded view of a container.\n-   * We need this pointer to be able to efficiently find this node when inserting the view\n-   * into an anchor.\n-   *\n-   * If this is a `TElementNode`, this is the view of a root component. It has exactly one\n-   * root TNode.\n-   *\n-   * If this is null, this is the view of a component that is not at root. We do not store\n-   * the host TNodes for child component views because they can potentially have several\n-   * different host TNodes, depending on where the component is being used. These host\n-   * TNodes cannot be shared (due to different indices, etc).\n+   * A `TNode` representing the declaration location of this `TView` (not part of this TView).\n    */\n-  node: TViewNode|TElementNode|null;\n+  // FIXME(misko): Rename `node` to `declTNode`\n+  node: TNode|null;\n+\n+  // FIXME(misko): Why does `TView` not have `declarationTView` property?\n \n   /** Whether or not this template has been processed in creation mode. */\n   firstCreatePass: boolean;\n@@ -1038,7 +1048,7 @@ export interface DebugNode {\n   injector: NodeInjectorDebug;\n }\n \n-interface NodeInjectorDebug {\n+export interface NodeInjectorDebug {\n   /**\n    * Instance bloom. Does the current injector have a provider with a given bloom mask.\n    */"
        },
        {
            "sha": "3d5aa109795f4439caad18acbccfc71931a048e8",
            "filename": "packages/core/src/render3/node_manipulation.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 29,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Renderer2} from '../core';\n import {ViewEncapsulation} from '../metadata/view';\n+import {Renderer2} from '../render/api';\n import {addToArray, removeFromArray} from '../util/array_utils';\n import {assertDefined, assertDomNode, assertEqual, assertSame, assertString} from '../util/assert';\n \n@@ -20,7 +20,7 @@ import {TElementNode, TNode, TNodeFlags, TNodeType, TProjectionNode, TViewNode,\n import {unusedValueExportToPlacateAjd as unused3} from './interfaces/projection';\n import {isProceduralRenderer, ProceduralRenderer3, RElement, Renderer3, RNode, RText, unusedValueExportToPlacateAjd as unused4} from './interfaces/renderer';\n import {isLContainer, isLView} from './interfaces/type_checks';\n-import {CHILD_HEAD, CLEANUP, DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, DestroyHookData, FLAGS, HookData, HookFn, HOST, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView, unusedValueExportToPlacateAjd as unused5} from './interfaces/view';\n+import {CHILD_HEAD, CLEANUP, DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, DestroyHookData, FLAGS, HookData, HookFn, HOST, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView, TViewType, unusedValueExportToPlacateAjd as unused5} from './interfaces/view';\n import {assertNodeOfPossibleTypes, assertNodeType} from './node_assert';\n import {getLViewParent} from './util/view_traversal_utils';\n import {getNativeByTNode, getNonViewFirstChild, unwrapRNode, updateTransplantedViewCount} from './util/view_utils';\n@@ -125,32 +125,45 @@ export function createTextNode(value: string, renderer: Renderer3): RText {\n }\n \n /**\n- * Adds or removes all DOM elements associated with a view.\n+ * Removes all DOM elements associated with a view.\n  *\n  * Because some root nodes of the view may be containers, we sometimes need\n  * to propagate deeply into the nested containers to remove all elements in the\n  * views beneath it.\n  *\n  * @param tView The `TView' of the `LView` from which elements should be added or removed\n  * @param lView The view from which elements should be added or removed\n- * @param insertMode Whether or not elements should be added (if false, removing)\n+ */\n+export function removeViewFromContainer(tView: TView, lView: LView): void {\n+  const renderer = lView[RENDERER];\n+  applyView(tView, lView, renderer, WalkTNodeTreeAction.Detach, null, null);\n+  lView[HOST] = null;\n+  lView[T_HOST] = null;\n+}\n+\n+/**\n+ * Adds all DOM elements associated with a view.\n+ *\n+ * Because some root nodes of the view may be containers, we sometimes need\n+ * to propagate deeply into the nested containers to add all elements in the\n+ * views beneath it.\n+ *\n+ * @param tView The `TView' of the `LView` from which elements should be added or removed\n+ * @param parentTNode The `TNode` where the `LView` should be attached to.\n+ * @param renderer Current renderer to use for DOM manipulations.\n+ * @param lView The view from which elements should be added or removed\n+ * @param parentNativeNode The parent `RElement` where it should be inserted into.\n  * @param beforeNode The node before which elements should be added, if insert mode\n  */\n-export function addRemoveViewFromContainer(\n-    tView: TView, lView: LView, insertMode: true, beforeNode: RNode|null): void;\n-export function addRemoveViewFromContainer(\n-    tView: TView, lView: LView, insertMode: false, beforeNode: null): void;\n-export function addRemoveViewFromContainer(\n-    tView: TView, lView: LView, insertMode: boolean, beforeNode: RNode|null): void {\n-  const renderParent = getContainerRenderParent(tView.node as TViewNode, lView);\n-  ngDevMode && assertNodeType(tView.node as TNode, TNodeType.View);\n-  if (renderParent) {\n-    const renderer = lView[RENDERER];\n-    const action = insertMode ? WalkTNodeTreeAction.Insert : WalkTNodeTreeAction.Detach;\n-    applyView(tView, lView, renderer, action, renderParent, beforeNode);\n-  }\n+export function addViewToContainer(\n+    tView: TView, parentTNode: TNode, renderer: Renderer3, lView: LView, parentNativeNode: RElement,\n+    beforeNode: RNode|null): void {\n+  lView[HOST] = parentNativeNode;\n+  lView[T_HOST] = parentTNode;\n+  applyView(tView, lView, renderer, WalkTNodeTreeAction.Insert, parentNativeNode, beforeNode);\n }\n \n+\n /**\n  * Detach a `LView` from the DOM by detaching its nodes.\n  *\n@@ -334,7 +347,7 @@ export function detachView(lContainer: LContainer, removeIndex: number): LView|u\n       lContainer[indexInContainer - 1][NEXT] = viewToDetach[NEXT] as LView;\n     }\n     const removedLView = removeFromArray(lContainer, CONTAINER_HEADER_OFFSET + removeIndex);\n-    addRemoveViewFromContainer(viewToDetach[TVIEW], viewToDetach, false, null);\n+    removeViewFromContainer(viewToDetach[TVIEW], viewToDetach);\n \n     // notify query that a view has been removed\n     const lQueries = removedLView[QUERIES];\n@@ -417,10 +430,8 @@ function cleanUpView(tView: TView, lView: LView): void {\n \n     executeOnDestroys(tView, lView);\n     removeListeners(tView, lView);\n-    const hostTNode = lView[T_HOST];\n-    // For component views only, the local renderer is destroyed as clean up time.\n-    if (hostTNode && hostTNode.type === TNodeType.Element &&\n-        isProceduralRenderer(lView[RENDERER])) {\n+    // For component views only, the local renderer is destroyed at clean up time.\n+    if (lView[TVIEW].type === TViewType.Component && isProceduralRenderer(lView[RENDERER])) {\n       ngDevMode && ngDevMode.rendererDestroy++;\n       (lView[RENDERER] as ProceduralRenderer3).destroy();\n     }\n@@ -530,7 +541,7 @@ function getRenderParent(tView: TView, tNode: TNode, currentView: LView): REleme\n   // or a component view.\n   if (parentTNode == null) {\n     const hostTNode = currentView[T_HOST]!;\n-    if (hostTNode.type === TNodeType.View) {\n+    if (hostTNode && hostTNode.type === TNodeType.View) {\n       // We are inserting a root element of an embedded view We might delay insertion of children\n       // for a given view if it is disconnected. This might happen for 2 main reasons:\n       // - view is not inserted into any container(view was created but not inserted yet)\n@@ -542,7 +553,6 @@ function getRenderParent(tView: TView, tNode: TNode, currentView: LView): REleme\n     } else {\n       // We are inserting a root element of the component view into the component host element and\n       // it should always be eager.\n-      ngDevMode && assertNodeOfPossibleTypes(hostTNode, [TNodeType.Element]);\n       return currentView[HOST];\n     }\n   } else {\n@@ -817,15 +827,19 @@ function applyNodes(\n  * @param lView The LView which needs to be inserted, detached, destroyed.\n  * @param renderer Renderer to use\n  * @param action action to perform (insert, detach, destroy)\n- * @param renderParent parent DOM element for insertion/removal.\n+ * @param renderParent parent DOM element for insertion (Removal does not need it).\n  * @param beforeNode Before which node the insertions should happen.\n  */\n+function applyView(\n+    tView: TView, lView: LView, renderer: Renderer3, action: WalkTNodeTreeAction.Destroy,\n+    renderParent: null, beforeNode: null): void;\n+function applyView(\n+    tView: TView, lView: LView, renderer: Renderer3, action: WalkTNodeTreeAction,\n+    renderParent: RElement|null, beforeNode: RNode|null): void;\n function applyView(\n     tView: TView, lView: LView, renderer: Renderer3, action: WalkTNodeTreeAction,\n-    renderParent: RElement|null, beforeNode: RNode|null) {\n-  ngDevMode && assertNodeType(tView.node!, TNodeType.View);\n-  const viewRootTNode: TNode|null = getNonViewFirstChild(tView);\n-  applyNodes(renderer, action, viewRootTNode, lView, renderParent, beforeNode, false);\n+    renderParent: RElement|null, beforeNode: RNode|null): void {\n+  applyNodes(renderer, action, tView.firstChild, lView, renderParent, beforeNode, false);\n }\n \n /**"
        },
        {
            "sha": "ab98bbacea0147e6cc09987769115d522a1f652d",
            "filename": "packages/core/src/render3/node_util.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 51,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/b2579d43cdb91d1bbfd524be6b917ef384896ff2/packages%2Fcore%2Fsrc%2Frender3%2Fnode_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/b2579d43cdb91d1bbfd524be6b917ef384896ff2/packages%2Fcore%2Fsrc%2Frender3%2Fnode_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnode_util.ts?ref=b2579d43cdb91d1bbfd524be6b917ef384896ff2",
            "patch": "@@ -1,51 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {RelativeInjectorLocation} from './interfaces/injector';\n-import {TContainerNode, TElementNode, TNode} from './interfaces/node';\n-import {DECLARATION_VIEW, LView, T_HOST} from './interfaces/view';\n-import {getParentInjectorViewOffset} from './util/injector_utils';\n-\n-/**\n- * If `startTNode.parent` exists and has an injector, returns TNode for that injector.\n- * Otherwise, unwraps a parent injector location number to find the view offset from the current\n- * injector, then walks up the declaration view tree until the TNode of the parent injector is\n- * found.\n- *\n- * @param location The location of the parent injector, which contains the view offset\n- * @param startView The LView instance from which to start walking up the view tree\n- * @param startTNode The TNode instance of the starting element\n- * @returns The TNode of the parent injector\n- */\n-export function getParentInjectorTNode(\n-    location: RelativeInjectorLocation, startView: LView, startTNode: TNode): TElementNode|\n-    TContainerNode|null {\n-  // If there is an injector on the parent TNode, retrieve the TNode for that injector.\n-  if (startTNode.parent && startTNode.parent.injectorIndex !== -1) {\n-    // view offset is 0\n-    const injectorIndex = startTNode.parent.injectorIndex;\n-    let tNode = startTNode.parent;\n-    // If tNode.injectorIndex === tNode.parent.injectorIndex, then the index belongs to a parent\n-    // injector.\n-    while (tNode.parent != null && injectorIndex == tNode.parent.injectorIndex) {\n-      tNode = tNode.parent;\n-    }\n-    return tNode;\n-  }\n-  let viewOffset = getParentInjectorViewOffset(location);\n-  // view offset is 1\n-  let parentView = startView;\n-  let parentTNode = startView[T_HOST] as TElementNode;\n-  // view offset is superior to 1\n-  while (viewOffset > 1) {\n-    parentView = parentView[DECLARATION_VIEW]!;\n-    parentTNode = parentView[T_HOST] as TElementNode;\n-    viewOffset--;\n-  }\n-  return parentTNode;\n-}"
        },
        {
            "sha": "55cfe61864a518a459cb34c3db6c1a2baac2a445",
            "filename": "packages/core/src/render3/pipe.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -48,13 +48,17 @@ export function ɵɵpipe(index: number, pipeName: string): any {\n \n   const pipeFactory = pipeDef.factory || (pipeDef.factory = getFactoryDef(pipeDef.type, true));\n   const previousInjectImplementation = setInjectImplementation(ɵɵdirectiveInject);\n-\n-  // DI for pipes is supposed to behave like directives when placed on a component\n-  // host node, which means that we have to disable access to `viewProviders`.\n-  const previousIncludeViewProviders = setIncludeViewProviders(false);\n-  const pipeInstance = pipeFactory();\n-  setIncludeViewProviders(previousIncludeViewProviders);\n-  setInjectImplementation(previousInjectImplementation);\n+  let pipeInstance: any;\n+\n+  try {\n+    // DI for pipes is supposed to behave like directives when placed on a component\n+    // host node, which means that we have to disable access to `viewProviders`.\n+    const previousIncludeViewProviders = setIncludeViewProviders(false);\n+    pipeInstance = pipeFactory();\n+    setIncludeViewProviders(previousIncludeViewProviders);\n+  } finally {\n+    setInjectImplementation(previousInjectImplementation);\n+  }\n   store(tView, getLView(), index, pipeInstance);\n   return pipeInstance;\n }"
        },
        {
            "sha": "ec6913f145a69734ca76e56a431b39cc9bc44202",
            "filename": "packages/core/src/render3/util/discovery_utils.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {Injector} from '../../di/injector';\n+import {assertEqual} from '../../util/assert';\n import {assertLView} from '../assert';\n import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext} from '../context_discovery';\n import {NodeInjector} from '../di';\n@@ -15,7 +16,7 @@ import {LContext} from '../interfaces/context';\n import {DirectiveDef} from '../interfaces/definition';\n import {TElementNode, TNode, TNodeProviderIndexes} from '../interfaces/node';\n import {isLView} from '../interfaces/type_checks';\n-import {CLEANUP, CONTEXT, DebugNode, FLAGS, HEADER_OFFSET, HOST, LView, LViewFlags, T_HOST, TVIEW} from '../interfaces/view';\n+import {CLEANUP, CONTEXT, DebugNode, FLAGS, HEADER_OFFSET, HOST, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../interfaces/view';\n \n import {stringifyForError} from './misc_utils';\n import {getLViewParent, getRootContext} from './view_traversal_utils';\n@@ -101,8 +102,7 @@ export function getOwningComponent<T>(elementOrDir: Element|{}): T|null {\n   let lView = context.lView;\n   let parent: LView|null;\n   ngDevMode && assertLView(lView);\n-  while (lView[HOST] === null && (parent = getLViewParent(lView)!)) {\n-    // As long as lView[HOST] is null we know we are part of sub-template such as `*ngIf`\n+  while (lView[TVIEW].type === TViewType.Embedded && (parent = getLViewParent(lView)!)) {\n     lView = parent;\n   }\n   return lView[FLAGS] & LViewFlags.IsRoot ? null : lView[CONTEXT] as T;\n@@ -389,6 +389,8 @@ export function getDebugNode(element: Element): DebugNode|null {\n     // data. In this situation the TNode is not accessed at the same spot.\n     const tNode = isLView(valueInLView) ? (valueInLView[T_HOST] as TNode) :\n                                           getTNode(lView[TVIEW], nodeIndex - HEADER_OFFSET);\n+    ngDevMode &&\n+        assertEqual(tNode.index, nodeIndex, 'Expecting that TNode at index is same as index');\n     debugNode = buildDebugNode(tNode, lView);\n   }\n "
        },
        {
            "sha": "c8b6835b14916007de5d08beff96abd10f893be9",
            "filename": "packages/core/src/render3/util/injector_utils.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Finjector_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Finjector_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Finjector_utils.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -5,14 +5,26 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+\n+import {assertGreaterThan, assertNotEqual, assertNumber} from '../../util/assert';\n import {NO_PARENT_INJECTOR, RelativeInjectorLocation, RelativeInjectorLocationFlags} from '../interfaces/injector';\n-import {DECLARATION_VIEW, LView} from '../interfaces/view';\n+import {DECLARATION_VIEW, HEADER_OFFSET, LView} from '../interfaces/view';\n+\n+\n /// Parent Injector Utils ///////////////////////////////////////////////////////////////\n export function hasParentInjector(parentLocation: RelativeInjectorLocation): boolean {\n   return parentLocation !== NO_PARENT_INJECTOR;\n }\n \n export function getParentInjectorIndex(parentLocation: RelativeInjectorLocation): number {\n+  ngDevMode && assertNumber(parentLocation, 'Number expected');\n+  ngDevMode && assertNotEqual(parentLocation as any, -1, 'Not a valid state.');\n+  const parentInjectorIndex =\n+      (parentLocation as any as number) & RelativeInjectorLocationFlags.InjectorIndexMask;\n+  ngDevMode &&\n+      assertGreaterThan(\n+          parentInjectorIndex, HEADER_OFFSET,\n+          'Parent injector must be pointing past HEADER_OFFSET.');\n   return (parentLocation as any as number) & RelativeInjectorLocationFlags.InjectorIndexMask;\n }\n "
        },
        {
            "sha": "f86c85d0196902d1fa7934f4dae0b80038a40abb",
            "filename": "packages/core/src/render3/util/view_utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -105,10 +105,10 @@ export function getNativeByTNode(tNode: TNode, lView: LView): RNode {\n  * @param tNode\n  * @param lView\n  */\n-export function getNativeByTNodeOrNull(tNode: TNode, lView: LView): RNode|null {\n-  const index = tNode.index;\n+export function getNativeByTNodeOrNull(tNode: TNode|null, lView: LView): RNode|null {\n+  const index = tNode === null ? -1 : tNode.index;\n   if (index !== -1) {\n-    ngDevMode && assertTNodeForLView(tNode, lView);\n+    ngDevMode && assertTNodeForLView(tNode!, lView);\n     const node: RNode|null = unwrapRNode(lView[index]);\n     ngDevMode && node !== null && !isProceduralRenderer(lView[RENDERER]) && assertDomNode(node);\n     return node;\n@@ -216,6 +216,7 @@ export function updateTransplantedViewCount(lContainer: LContainer, amount: 1|-\n  * crashes on it, so we unwrap it.\n  */\n export function getNonViewFirstChild(tView: TView): TNode|null {\n+  // FIXME(misko): Delete me! (as TNodeType.View no longer exists)\n   const firstChild = tView.firstChild;\n   return firstChild === null ? null :\n                                (firstChild.type === TNodeType.View ? firstChild.child : firstChild);"
        },
        {
            "sha": "6ec59301f26625eacac7468ca4b8d6be53467c4f",
            "filename": "packages/core/src/render3/view_engine_compatibility.ts",
            "status": "modified",
            "additions": 49,
            "deletions": 39,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -6,33 +6,33 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {ChangeDetectorRef as ViewEngine_ChangeDetectorRef} from '../change_detection/change_detector_ref';\n-import {Injector} from '../di/injector';\n-import {ComponentFactory as viewEngine_ComponentFactory, ComponentRef as viewEngine_ComponentRef} from '../linker/component_factory';\n-import {ElementRef as ViewEngine_ElementRef} from '../linker/element_ref';\n-import {NgModuleRef as viewEngine_NgModuleRef} from '../linker/ng_module_factory';\n-import {TemplateRef as ViewEngine_TemplateRef} from '../linker/template_ref';\n-import {ViewContainerRef as ViewEngine_ViewContainerRef} from '../linker/view_container_ref';\n-import {EmbeddedViewRef as viewEngine_EmbeddedViewRef, ViewRef as viewEngine_ViewRef} from '../linker/view_ref';\n-import {Renderer2} from '../render/api';\n-import {addToArray, removeFromArray} from '../util/array_utils';\n-import {assertDefined, assertEqual, assertGreaterThan, assertLessThan} from '../util/assert';\n-\n-import {assertLContainer} from './assert';\n-import {getParentInjectorLocation, NodeInjector} from './di';\n-import {addToViewTree, createLContainer, createLView, renderView} from './instructions/shared';\n-import {CONTAINER_HEADER_OFFSET, LContainer, VIEW_REFS} from './interfaces/container';\n-import {TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TNode, TNodeType} from './interfaces/node';\n-import {isProceduralRenderer, RComment, RElement} from './interfaces/renderer';\n-import {isComponentHost, isLContainer, isLView, isRootView} from './interfaces/type_checks';\n-import {DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, LView, LViewFlags, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView} from './interfaces/view';\n-import {assertNodeOfPossibleTypes} from './node_assert';\n-import {addRemoveViewFromContainer, appendChild, destroyLView, detachView, getBeforeNodeForView, insertView, nativeInsertBefore, nativeNextSibling, nativeParentNode} from './node_manipulation';\n-import {getParentInjectorTNode} from './node_util';\n-import {getLView, getPreviousOrParentTNode} from './state';\n-import {getParentInjectorView, hasParentInjector} from './util/injector_utils';\n-import {getComponentLViewByIndex, getNativeByTNode, unwrapRNode, viewAttachedToContainer} from './util/view_utils';\n-import {ViewRef} from './view_ref';\n+import { ChangeDetectorRef as ViewEngine_ChangeDetectorRef } from '../change_detection/change_detector_ref';\n+import { Injector } from '../di/injector';\n+import { ComponentFactory as viewEngine_ComponentFactory, ComponentRef as viewEngine_ComponentRef } from '../linker/component_factory';\n+import { ElementRef as ViewEngine_ElementRef } from '../linker/element_ref';\n+import { NgModuleRef as viewEngine_NgModuleRef } from '../linker/ng_module_factory';\n+import { TemplateRef as ViewEngine_TemplateRef } from '../linker/template_ref';\n+import { ViewContainerRef as ViewEngine_ViewContainerRef } from '../linker/view_container_ref';\n+import { EmbeddedViewRef as viewEngine_EmbeddedViewRef, ViewRef as viewEngine_ViewRef } from '../linker/view_ref';\n+import { Renderer2 } from '../render/api';\n+import { addToArray, removeFromArray } from '../util/array_utils';\n+import { assertDefined, assertEqual, assertGreaterThan, assertLessThan } from '../util/assert';\n+import { assertLContainer, assertNodeInjector } from './assert';\n+import { getParentInjectorLocation, NodeInjector } from './di';\n+import { addToViewTree, createLContainer, createLView, renderView } from './instructions/shared';\n+import { CONTAINER_HEADER_OFFSET, LContainer, NATIVE, VIEW_REFS } from './interfaces/container';\n+import { TNODE } from './interfaces/injector';\n+import { TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TNode, TNodeType } from './interfaces/node';\n+import { isProceduralRenderer, RComment, RElement } from './interfaces/renderer';\n+import { isComponentHost, isLContainer, isLView, isRootView } from './interfaces/type_checks';\n+import { DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, LView, LViewFlags, PARENT, QUERIES, RENDERER, TVIEW, TView, T_HOST } from './interfaces/view';\n+import { assertNodeOfPossibleTypes } from './node_assert';\n+import { addViewToContainer, appendChild, destroyLView, detachView, getBeforeNodeForView, insertView, nativeInsertBefore, nativeNextSibling, nativeParentNode } from './node_manipulation';\n+import { getLView, getPreviousOrParentTNode } from './state';\n+import { getParentInjectorIndex, getParentInjectorView, hasParentInjector } from './util/injector_utils';\n+import { getComponentLViewByIndex, getNativeByTNode, unwrapRNode, viewAttachedToContainer } from './util/view_utils';\n+import { ViewRef } from './view_ref';\n+\n \n \n \n@@ -106,7 +106,7 @@ export function createTemplateRef<T>(\n         const embeddedTView = this._declarationTContainer.tViews as TView;\n         const embeddedLView = createLView(\n             this._declarationView, embeddedTView, context, LViewFlags.CheckAlways, null,\n-            embeddedTView.node);\n+            embeddedTView.node, null, null, null, null);\n \n         const declarationLContainer = this._declarationView[this._declarationTContainer.index];\n         ngDevMode && assertLContainer(declarationLContainer);\n@@ -188,12 +188,15 @@ export function createContainerRef(\n       /** @deprecated No replacement */\n       get parentInjector(): Injector {\n         const parentLocation = getParentInjectorLocation(this._hostTNode, this._hostView);\n-        const parentView = getParentInjectorView(parentLocation, this._hostView);\n-        const parentTNode = getParentInjectorTNode(parentLocation, this._hostView, this._hostTNode);\n-\n-        return !hasParentInjector(parentLocation) || parentTNode == null ?\n-            new NodeInjector(null, this._hostView) :\n-            new NodeInjector(parentTNode, parentView);\n+        if (hasParentInjector(parentLocation)) {\n+          const parentView = getParentInjectorView(parentLocation, this._hostView);\n+          const injectorIndex = getParentInjectorIndex(parentLocation);\n+          ngDevMode && assertNodeInjector(parentView, injectorIndex);\n+          const parentTNode = parentView[TVIEW].data[injectorIndex + TNODE] as TElementNode;\n+          return new NodeInjector(parentTNode, parentView);\n+        } else {\n+          return new NodeInjector(null, this._hostView);\n+        }\n       }\n \n       clear(): void {\n@@ -277,14 +280,21 @@ export function createContainerRef(\n           }\n         }\n \n+        // Logical operation of adding `LView` to `LContainer`\n         const adjustedIdx = this._adjustIndex(index);\n-        insertView(tView, lView, this._lContainer, adjustedIdx);\n-\n-        const beforeNode = getBeforeNodeForView(adjustedIdx, this._lContainer);\n-        addRemoveViewFromContainer(tView, lView, true, beforeNode);\n+        const lContainer = this._lContainer;\n+        insertView(tView, lView, lContainer, adjustedIdx);\n+\n+        // Physical operation of adding the DOM nodes.\n+        const beforeNode = getBeforeNodeForView(adjustedIdx, lContainer);\n+        const renderer = lView[RENDERER];\n+        const renderParent = nativeParentNode(renderer, lContainer[NATIVE] as RElement | RComment);\n+        if (renderParent !== null) {\n+          addViewToContainer(tView, lContainer[T_HOST], renderer, lView, renderParent, beforeNode);\n+        }\n \n         (viewRef as ViewRef<any>).attachToViewContainerRef(this);\n-        addToArray(this._lContainer[VIEW_REFS]!, adjustedIdx, viewRef);\n+        addToArray(lContainer[VIEW_REFS]!, adjustedIdx, viewRef);\n \n         return viewRef;\n       }"
        },
        {
            "sha": "688d4774dee433eb91505bae57f4217d3fc21863",
            "filename": "packages/core/src/render3/view_ref.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fview_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Fsrc%2Frender3%2Fview_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fview_ref.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -35,11 +35,8 @@ export class ViewRef<T> implements viewEngine_EmbeddedViewRef<T>, viewEngine_Int\n \n   get rootNodes(): any[] {\n     const lView = this._lView;\n-    if (lView[HOST] == null) {\n-      const hostTView = lView[T_HOST] as TViewNode;\n-      return collectNativeNodes(lView[TVIEW], lView, hostTView.child, []);\n-    }\n-    return [];\n+    const tView = lView[TVIEW];\n+    return collectNativeNodes(tView, lView, tView.firstChild, []);\n   }\n \n   constructor("
        },
        {
            "sha": "27b0e15c08bfd165a7af6911790d5a94e6004b0a",
            "filename": "packages/core/test/acceptance/di_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fdi_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fdi_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdi_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Attribute, ChangeDetectorRef, Component, ComponentFactoryResolver, ComponentRef, Directive, ElementRef, EventEmitter, forwardRef, Host, HostBinding, Inject, Injectable, InjectionToken, INJECTOR, Injector, Input, LOCALE_ID, ModuleWithProviders, NgModule, NgZone, Optional, Output, Pipe, PipeTransform, Self, SkipSelf, TemplateRef, ViewChild, ViewContainerRef, ViewRef, ɵDEFAULT_LOCALE_ID as DEFAULT_LOCALE_ID} from '@angular/core';\n+import {Attribute, ChangeDetectorRef, Component, ComponentFactoryResolver, ComponentRef, Directive, ElementRef, EventEmitter, forwardRef, Host, HostBinding, Inject, Injectable, InjectionToken, INJECTOR, Injector, Input, LOCALE_ID, NgModule, NgZone, Optional, Output, Pipe, PipeTransform, Self, SkipSelf, TemplateRef, ViewChild, ViewContainerRef, ViewRef, ɵDEFAULT_LOCALE_ID as DEFAULT_LOCALE_ID} from '@angular/core';\n import {ɵINJECTOR_SCOPE} from '@angular/core/src/core';\n import {ViewRef as ViewRefInternal} from '@angular/core/src/render3/view_ref';\n import {TestBed} from '@angular/core/testing';"
        },
        {
            "sha": "5d07cbcefa4d83d600fad93414e0b28ec2dd72ec",
            "filename": "packages/core/test/acceptance/integration_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -53,7 +53,7 @@ describe('acceptance integration tests', () => {\n       expect(fixture.nativeElement.innerHTML).toEqual('<h1>Hello, World!</h1>');\n       onlyInIvy('perf counters').expectPerfCounters({\n         tView: 2,  // Host view + App\n-        tNode: 4,  // Host Node + App Node + <span> + #text\n+        tNode: 3,  // Host Node + <h1> + #text\n       });\n \n       fixture.componentInstance.name = 'New World';\n@@ -63,7 +63,7 @@ describe('acceptance integration tests', () => {\n       // Assert that the tView/tNode count does not increase (they are correctly cached)\n       onlyInIvy('perf counters').expectPerfCounters({\n         tView: 2,\n-        tNode: 4,\n+        tNode: 3,\n       });\n     });\n   });"
        },
        {
            "sha": "42e4934f9b8e02461b2421b7e02e85de1a941cec",
            "filename": "packages/core/test/acceptance/styling_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -797,7 +797,7 @@ describe('styling', () => {\n \n     onlyInIvy('perf counters').expectPerfCounters({\n       rendererSetStyle: 1,\n-      tNode: 3,\n+      tNode: 2,\n     });\n   });\n "
        },
        {
            "sha": "f474a0e612f56bc8effb89b972790ee36ced2fde",
            "filename": "packages/core/test/bundling/forms/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -704,9 +704,6 @@\n   {\n     \"name\": \"addHostBindingsToExpandoInstructions\"\n   },\n-  {\n-    \"name\": \"addRemoveViewFromContainer\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n@@ -821,9 +818,6 @@\n   {\n     \"name\": \"createPlatformFactory\"\n   },\n-  {\n-    \"name\": \"createTNode\"\n-  },\n   {\n     \"name\": \"createTView\"\n   },\n@@ -974,9 +968,6 @@\n   {\n     \"name\": \"getConstant\"\n   },\n-  {\n-    \"name\": \"getContainerRenderParent\"\n-  },\n   {\n     \"name\": \"getDOM\"\n   },\n@@ -1064,9 +1055,6 @@\n   {\n     \"name\": \"getParentInjectorView\"\n   },\n-  {\n-    \"name\": \"getParentInjectorViewOffset\"\n-  },\n   {\n     \"name\": \"getParentState\"\n   },"
        },
        {
            "sha": "afbed9a415a7e40999da27d130b2a32c93653260",
            "filename": "packages/core/test/bundling/hello_world/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -59,9 +59,6 @@\n   {\n     \"name\": \"allocLFrame\"\n   },\n-  {\n-    \"name\": \"appendChild\"\n-  },\n   {\n     \"name\": \"attachPatchData\"\n   },\n@@ -110,6 +107,9 @@\n   {\n     \"name\": \"extractPipeDef\"\n   },\n+  {\n+    \"name\": \"getBeforeNodeForView\"\n+  },\n   {\n     \"name\": \"getCheckNoChangesMode\"\n   },\n@@ -235,5 +235,8 @@\n   },\n   {\n     \"name\": \"viewAttachedToChangeDetector\"\n+  },\n+  {\n+    \"name\": \"ɵɵtext\"\n   }\n ]\n\\ No newline at end of file"
        },
        {
            "sha": "88b6a1db6452dd2b5da0980c54f95432a276150f",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -926,9 +926,6 @@\n   {\n     \"name\": \"addHostBindingsToExpandoInstructions\"\n   },\n-  {\n-    \"name\": \"addRemoveViewFromContainer\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n@@ -1070,9 +1067,6 @@\n   {\n     \"name\": \"createRouterScroller\"\n   },\n-  {\n-    \"name\": \"createTNode\"\n-  },\n   {\n     \"name\": \"createTView\"\n   },\n@@ -1286,9 +1280,6 @@\n   {\n     \"name\": \"getConstant\"\n   },\n-  {\n-    \"name\": \"getContainerRenderParent\"\n-  },\n   {\n     \"name\": \"getCurrentQueryIndex\"\n   },\n@@ -1394,9 +1385,6 @@\n   {\n     \"name\": \"getParentInjectorView\"\n   },\n-  {\n-    \"name\": \"getParentInjectorViewOffset\"\n-  },\n   {\n     \"name\": \"getParentState\"\n   },"
        },
        {
            "sha": "30cd8d19a4c2b4045d71d719cf459977eab36572",
            "filename": "packages/core/test/bundling/todo/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -179,9 +179,6 @@\n   {\n     \"name\": \"addHostBindingsToExpandoInstructions\"\n   },\n-  {\n-    \"name\": \"addRemoveViewFromContainer\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n@@ -260,9 +257,6 @@\n   {\n     \"name\": \"createLView\"\n   },\n-  {\n-    \"name\": \"createTNode\"\n-  },\n   {\n     \"name\": \"createTView\"\n   },\n@@ -353,9 +347,6 @@\n   {\n     \"name\": \"getConstant\"\n   },\n-  {\n-    \"name\": \"getContainerRenderParent\"\n-  },\n   {\n     \"name\": \"getDebugContext\"\n   },\n@@ -425,9 +416,6 @@\n   {\n     \"name\": \"getParentInjectorView\"\n   },\n-  {\n-    \"name\": \"getParentInjectorViewOffset\"\n-  },\n   {\n     \"name\": \"getParentState\"\n   },"
        },
        {
            "sha": "2aa775ecc0f349cbf205df6374fd22ed32b00292",
            "filename": "packages/core/test/render3/di_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fdi_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fdi_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fdi_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -226,8 +226,8 @@ describe('di', () => {\n   describe('getOrCreateNodeInjector', () => {\n     it('should handle initial undefined state', () => {\n       const contentView = createLView(\n-          null, createTView(TViewType.Component, -1, null, 1, 0, null, null, null, null, null), {},\n-          LViewFlags.CheckAlways, null, null, {} as any, {} as any);\n+          null, createTView(TViewType.Component, null, null, 1, 0, null, null, null, null, null),\n+          {}, LViewFlags.CheckAlways, null, null, {} as any, {} as any, null, null);\n       enterView(contentView);\n       try {\n         const parentTNode = getOrCreateTNode(contentView[TVIEW], 0, TNodeType.Element, null, null);"
        },
        {
            "sha": "5205e3e13611cf0c88590c2cfc7cb0fd78a130a0",
            "filename": "packages/core/test/render3/instructions/lview_debug_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -26,7 +26,7 @@ describe('lView_debug', () => {\n     let tNode!: TNodeDebug;\n     let tView!: TView;\n     beforeEach(() => {\n-      tView = createTView(TViewType.Component, 0, null, 0, 0, null, null, null, null, null);\n+      tView = createTView(TViewType.Component, null, null, 0, 0, null, null, null, null, null);\n       tNode = createTNode(tView, null!, TNodeType.Element, 0, '', null) as TNodeDebug;\n     });\n     afterEach(() => tNode = tView = null!);"
        },
        {
            "sha": "8af4ecc97311560f7c85ef5ab66865cdb2b7400d",
            "filename": "packages/core/test/render3/instructions/shared_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -36,7 +36,7 @@ export function enterViewWithOneDiv() {\n   const vars = 60;  // Space for directive expando,  template, component + 3 directives if we assume\n                     // that each consume 10 slots.\n   const tView = createTView(\n-      TViewType.Component, -1, emptyTemplate, consts, vars, null, null, null, null, null);\n+      TViewType.Component, null, emptyTemplate, consts, vars, null, null, null, null, null);\n   // Just assume that the expando starts after 10 initial bindings.\n   tView.expandoStartIndex = HEADER_OFFSET + 10;\n   const tNode = tView.firstChild = createTNode(tView, null!, TNodeType.Element, 0, 'div', null);"
        },
        {
            "sha": "7096136f5596b65946058c75bdcb09998c9c1db5",
            "filename": "packages/core/test/render3/is_shape_of.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -91,7 +91,6 @@ export function isTView(obj: any): obj is TView {\n }\n const ShapeOfTView: ShapeOf<TView> = {\n   type: true,\n-  id: true,\n   blueprint: true,\n   template: true,\n   viewQuery: true,"
        },
        {
            "sha": "f873a124bff3ed76e2766163fc9eec527715832d",
            "filename": "packages/core/test/render3/matchers_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -52,15 +52,15 @@ describe('render3 matchers', () => {\n   });\n \n   describe('matchTView', () => {\n-    const tView = createTView(TViewType.Root, 1, null, 2, 3, null, null, null, null, null);\n+    const tView = createTView(TViewType.Root, null, null, 2, 3, null, null, null, null, null);\n     it('should match', () => {\n       expect(tView).toEqual(matchTView());\n       expect(tView).toEqual(matchTView({type: TViewType.Root}));\n       expect({node: tView}).toEqual({node: matchTView({type: TViewType.Root})});\n     });\n   });\n   describe('matchTNode', () => {\n-    const tView = createTView(TViewType.Root, 1, null, 2, 3, null, null, null, null, null);\n+    const tView = createTView(TViewType.Root, null, null, 2, 3, null, null, null, null, null);\n     const tNode = createTNode(tView, null, TNodeType.Element, 1, 'tagName', []);\n \n     it('should match', () => {"
        },
        {
            "sha": "d27206f88a99ac1cc75c2c3a0394f39fda5ee579",
            "filename": "packages/core/test/render3/perf/directive_instantiate/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fdirective_instantiate%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fdirective_instantiate%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fdirective_instantiate%2Findex.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -75,12 +75,12 @@ function testTemplate(rf: RenderFlags, ctx: any) {\n }\n \n const rootLView = createLView(\n-    null, createTView(TViewType.Root, -1, null, 0, 0, null, null, null, null, null), {},\n-    LViewFlags.IsRoot, null, null);\n+    null, createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null), {},\n+    LViewFlags.IsRoot, null, null, null, null, null, null);\n \n const viewTNode = createTNode(null!, null, TNodeType.View, -1, null, null) as TViewNode;\n const embeddedTView = createTView(\n-    TViewType.Embedded, -1, testTemplate, 21, 10, [Tooltip.ɵdir], null, null, null,\n+    TViewType.Embedded, null, testTemplate, 21, 10, [Tooltip.ɵdir], null, null, null,\n     [['position', 'top', 3, 'tooltip']]);\n \n // create view once so we don't profile the first create pass"
        },
        {
            "sha": "b076c8ebd71923125ca4aad26ae76caaf3b432d7",
            "filename": "packages/core/test/render3/perf/element_text_create/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Felement_text_create%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Felement_text_create%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Felement_text_create%2Findex.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -64,12 +64,12 @@ function testTemplate(rf: RenderFlags, ctx: any) {\n }\n \n const rootLView = createLView(\n-    null, createTView(TViewType.Root, -1, null, 0, 0, null, null, null, null, null), {},\n-    LViewFlags.IsRoot, null, null);\n+    null, createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null), {},\n+    LViewFlags.IsRoot, null, null, null, null, null, null);\n \n const viewTNode = createTNode(null!, null, TNodeType.View, -1, null, null) as TViewNode;\n const embeddedTView = createTView(\n-    TViewType.Embedded, -1, testTemplate, 21, 0, null, null, null, null, [[\n+    TViewType.Embedded, null, testTemplate, 21, 0, null, null, null, null, [[\n       'name1', 'value1', 'name2', 'value2', 'name3', 'value3', 'name4', 'value4', 'name5', 'value5'\n     ]]);\n "
        },
        {
            "sha": "3bd64a43461593b2b3b5ae50824586a0e8eb01ef",
            "filename": "packages/core/test/render3/perf/listeners/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Flisteners%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Flisteners%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Flisteners%2Findex.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -66,12 +66,12 @@ function testTemplate(rf: RenderFlags, ctx: any) {\n }\n \n const rootLView = createLView(\n-    null, createTView(TViewType.Root, -1, null, 0, 0, null, null, null, null, null), {},\n-    LViewFlags.IsRoot, null, null);\n+    null, createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null), {},\n+    LViewFlags.IsRoot, null, null, null, null, null, null);\n \n const viewTNode = createTNode(null!, null, TNodeType.View, -1, null, null) as TViewNode;\n const embeddedTView = createTView(\n-    TViewType.Embedded, -1, testTemplate, 11, 0, null, null, null, null, [[3, 'click', 'input']]);\n+    TViewType.Embedded, null, testTemplate, 11, 0, null, null, null, null, [[3, 'click', 'input']]);\n \n // create view once so we don't profile the first create pass\n createAndRenderLView(rootLView, embeddedTView, viewTNode);"
        },
        {
            "sha": "fe8153dc647068ec5b2d64cb1085d9c909ac11ec",
            "filename": "packages/core/test/render3/perf/ng_template/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fng_template%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fng_template%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fng_template%2Findex.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -59,12 +59,12 @@ function testTemplate(rf: RenderFlags, ctx: any) {\n }\n \n const rootLView = createLView(\n-    null, createTView(TViewType.Root, -1, null, 0, 0, null, null, null, null, null), {},\n-    LViewFlags.IsRoot, null, null);\n+    null, createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null), {},\n+    LViewFlags.IsRoot, null, null, null, null, null, null);\n \n const viewTNode = createTNode(null!, null, TNodeType.View, -1, null, null) as TViewNode;\n const embeddedTView = createTView(\n-    TViewType.Root, -1, testTemplate, 2, 0, [NgIfLike.ɵdir], null, null, null,\n+    TViewType.Root, null, testTemplate, 2, 0, [NgIfLike.ɵdir], null, null, null,\n     [['viewManipulation', '']]);\n \n // create view once so we don't profile first template pass"
        },
        {
            "sha": "6ac22272e281562cf884c139382b6dbee32be5ce",
            "filename": "packages/core/test/render3/perf/setup.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fsetup.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fsetup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fsetup.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -22,7 +22,8 @@ const renderer = rendererFactory.createRenderer(null, null);\n export function createAndRenderLView(\n     parentLView: LView, tView: TView, hostTNode: TViewNode): LView {\n   const embeddedLView = createLView(\n-      parentLView, tView, {}, LViewFlags.CheckAlways, null, hostTNode, rendererFactory, renderer);\n+      parentLView, tView, {}, LViewFlags.CheckAlways, null, hostTNode, rendererFactory, renderer,\n+      null, null);\n   renderView(tView, embeddedLView, null);\n   return embeddedLView;\n }\n@@ -49,12 +50,12 @@ export function setupTestHarness(\n     embeddedViewContext: any = {}, consts: TAttributes[]|null = null,\n     directiveRegistry: DirectiveDefList|null = null): TestHarness {\n   // Create a root view with a container\n-  const hostTView = createTView(TViewType.Root, -1, null, 1, 0, null, null, null, null, consts);\n+  const hostTView = createTView(TViewType.Root, null, null, 1, 0, null, null, null, null, consts);\n   const tContainerNode = getOrCreateTNode(hostTView, 0, TNodeType.Container, null, null);\n   const hostNode = renderer.createElement('div');\n   const hostLView = createLView(\n       null, hostTView, {}, LViewFlags.CheckAlways | LViewFlags.IsRoot, hostNode, null,\n-      rendererFactory, renderer);\n+      rendererFactory, renderer, null, null);\n   const mockRCommentNode = renderer.createComment('');\n   const lContainer =\n       createLContainer(mockRCommentNode, hostLView, mockRCommentNode, tContainerNode);\n@@ -63,13 +64,14 @@ export function setupTestHarness(\n \n   // create test embedded views\n   const embeddedTView = createTView(\n-      TViewType.Embedded, -1, templateFn, decls, vars, directiveRegistry, null, null, null, consts);\n+      TViewType.Embedded, null, templateFn, decls, vars, directiveRegistry, null, null, null,\n+      consts);\n   const viewTNode = createTNode(hostTView, null, TNodeType.View, -1, null, null) as TViewNode;\n \n   function createEmbeddedLView(): LView {\n     const embeddedLView = createLView(\n         hostLView, embeddedTView, embeddedViewContext, LViewFlags.CheckAlways, null, viewTNode,\n-        rendererFactory, renderer);\n+        rendererFactory, renderer, null, null);\n     renderView(embeddedTView, embeddedLView, embeddedViewContext);\n     return embeddedLView;\n   }"
        },
        {
            "sha": "b0dfd5059a6c99b72dc4781eefb59579e0add999",
            "filename": "packages/core/test/render3/perf/view_destroy_hook/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fview_destroy_hook%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fview_destroy_hook%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fperf%2Fview_destroy_hook%2Findex.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -52,12 +52,12 @@ function testTemplate(rf: RenderFlags, ctx: any) {\n }\n \n const rootLView = createLView(\n-    null, createTView(TViewType.Root, -1, null, 0, 0, null, null, null, null, null), {},\n-    LViewFlags.IsRoot, null, null);\n+    null, createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null), {},\n+    LViewFlags.IsRoot, null, null, null, null, null, null);\n \n const viewTNode = createTNode(null!, null, TNodeType.View, -1, null, null) as TViewNode;\n const embeddedTView = createTView(\n-    TViewType.Embedded, -1, testTemplate, 21, 10, [ToDestroy.ɵdir], null, null, null,\n+    TViewType.Embedded, null, testTemplate, 21, 10, [ToDestroy.ɵdir], null, null, null,\n     [['to-destroy']]);\n \n // create view once so we don't profile the first create pass"
        },
        {
            "sha": "9b3de3fa2ae9bcf6f048bdb9a294e31176b4de0e",
            "filename": "packages/core/test/render3/render_util.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -261,10 +261,10 @@ export function renderTemplate<T>(\n     const renderer = providedRendererFactory.createRenderer(null, null);\n \n     // We need to create a root view so it's possible to look up the host element through its index\n-    const tView = createTView(TViewType.Root, -1, null, 1, 0, null, null, null, null, null);\n+    const tView = createTView(TViewType.Root, null, null, 1, 0, null, null, null, null, null);\n     const hostLView = createLView(\n         null, tView, {}, LViewFlags.CheckAlways | LViewFlags.IsRoot, null, null,\n-        providedRendererFactory, renderer);\n+        providedRendererFactory, renderer, null, null);\n     enterView(hostLView);\n \n     const def: ComponentDef<any> = ɵɵdefineComponent({\n@@ -282,7 +282,7 @@ export function renderTemplate<T>(\n     hostLView[hostTNode.index] = hostNode;\n     componentView = createLView(\n         hostLView, componentTView, context, LViewFlags.CheckAlways, hostNode, hostTNode,\n-        providedRendererFactory, renderer, sanitizer);\n+        providedRendererFactory, renderer, sanitizer || null, null);\n   }\n   renderComponentOrTemplate(componentView[TVIEW], componentView, templateFn, context);\n   return componentView;"
        },
        {
            "sha": "b7f30fdc368d66886e2dced9f9882124be7bd922",
            "filename": "packages/core/test/render3/view_utils_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fview_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be/packages%2Fcore%2Ftest%2Frender3%2Fview_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fview_utils_spec.ts?ref=eb32b6bd6b7eead78aa01e1d81c7dc7c81ca14be",
            "patch": "@@ -13,7 +13,7 @@ import {TViewType} from '@angular/core/src/render3/interfaces/view';\n describe('view_utils', () => {\n   it('should verify unwrap methods', () => {\n     const div = document.createElement('div');\n-    const tView = createTView(TViewType.Root, 0, null, 0, 0, null, null, null, null, null);\n+    const tView = createTView(TViewType.Root, null, null, 0, 0, null, null, null, null, null);\n     const lView = createLView(null, tView, {}, 0, div, null, {} as any, {} as any, null, null);\n     const tNode = createTNode(null!, null, 3, 0, 'div', []);\n     const lContainer = createLContainer(lView, lView, div, tNode);"
        }
    ],
    "stats": {
        "total": 755,
        "additions": 375,
        "deletions": 380
    }
}