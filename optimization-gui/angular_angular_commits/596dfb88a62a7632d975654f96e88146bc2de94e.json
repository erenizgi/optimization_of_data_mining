{
    "author": "josephperrott",
    "message": "test(bazel): use bazel runfiles helper for resolving file names (#40955)\n\nUse bazel's runfiles helper to resolve file name paths rather than\nrequire.\n\nPR Close #40955",
    "sha": "596dfb88a62a7632d975654f96e88146bc2de94e",
    "files": [
        {
            "sha": "50e881b37b57f43c1e620cdab4e5f98fae760053",
            "filename": "packages/bazel/test/ng_package/common_package.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts?ref=596dfb88a62a7632d975654f96e88146bc2de94e",
            "patch": "@@ -11,10 +11,13 @@ import * as fs from 'fs';\n import * as path from 'path';\n import * as shx from 'shelljs';\n \n+/** Runfiles helper from bazel to resolve file name paths.  */\n+const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']!);\n+\n // Resolve the \"npm_package\" directory by using the runfile resolution. Note that we need to\n // resolve the \"package.json\" of the package since otherwise NodeJS would resolve the \"main\"\n // file, which is not necessarily at the root of the \"npm_package\".\n-shx.cd(path.dirname(require.resolve('angular/packages/common/npm_package/package.json')));\n+shx.cd(path.dirname(runfiles.resolve('angular/packages/common/npm_package/package.json')));\n \n describe('@angular/common ng_package', () => {\n   describe('should have the locales files', () => {"
        },
        {
            "sha": "7c5876c2ec28ee7411a9ca9939cda6ed00e257b4",
            "filename": "packages/bazel/test/ng_package/core_package.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts?ref=596dfb88a62a7632d975654f96e88146bc2de94e",
            "patch": "@@ -10,10 +10,13 @@ import {ivyEnabled, obsoleteInIvy} from '@angular/private/testing';\n import * as path from 'path';\n import * as shx from 'shelljs';\n \n+/** Runfiles helper from bazel to resolve file name paths.  */\n+const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']!);\n+\n // Resolve the \"npm_package\" directory by using the runfile resolution. Note that we need to\n // resolve the \"package.json\" of the package since otherwise NodeJS would resolve the \"main\"\n // file, which is not necessarily at the root of the \"npm_package\".\n-shx.cd(path.dirname(require.resolve('angular/packages/core/npm_package/package.json')));\n+shx.cd(path.dirname(runfiles.resolve('angular/packages/core/npm_package/package.json')));\n \n /**\n  * Utility functions that allows me to create fs paths"
        },
        {
            "sha": "50f3eb8fdc78bd66c6835796336d9eedca596544",
            "filename": "packages/bazel/test/ng_package/example_package.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fexample_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fng_package%2Fexample_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fexample_package.spec.ts?ref=596dfb88a62a7632d975654f96e88146bc2de94e",
            "patch": "@@ -11,6 +11,9 @@ import {createPatch} from 'diff';\n import * as fs from 'fs';\n import * as path from 'path';\n \n+/** Runfiles helper from bazel to resolve file name paths.  */\n+const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']!);\n+\n type TestPackage = {\n   displayName: string; packagePath: string; goldenFilePath: string;\n };\n@@ -21,18 +24,18 @@ const packagesToTest: TestPackage[] = [\n     // Resolve the \"npm_package\" directory by using the runfile resolution. Note that we need to\n     // resolve the \"package.json\" of the package since otherwise NodeJS would resolve the \"main\"\n     // file, which is not necessarily at the root of the \"npm_package\".\n-    packagePath: path.dirname(\n-        require.resolve('angular/packages/bazel/test/ng_package/example/npm_package/package.json')),\n-    goldenFilePath: require.resolve('./example_package.golden')\n+    packagePath: path.dirname(runfiles.resolve(\n+        'angular/packages/bazel/test/ng_package/example/npm_package/package.json')),\n+    goldenFilePath: runfiles.resolvePackageRelative('./example_package.golden')\n   },\n   {\n     displayName: 'Example with ts_library NPM package',\n     // Resolve the \"npm_package\" directory by using the runfile resolution. Note that we need to\n     // resolve the \"package.json\" of the package since otherwise NodeJS would resolve the \"main\"\n     // file, which is not necessarily at the root of the \"npm_package\".\n-    packagePath: path.dirname(require.resolve(\n+    packagePath: path.dirname(runfiles.resolve(\n         'angular/packages/bazel/test/ng_package/example-with-ts-library/npm_package/package.json')),\n-    goldenFilePath: require.resolve('./example_with_ts_library_package.golden')\n+    goldenFilePath: runfiles.resolvePackageRelative('./example_with_ts_library_package.golden')\n   },\n ];\n "
        },
        {
            "sha": "492ca59d48a6c0efb078c58f4f7f4ae9e1deb4c0",
            "filename": "packages/bazel/test/ngc-wrapped/flat_module_test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fflat_module_test.ts",
            "raw_url": "https://github.com/angular/angular/raw/596dfb88a62a7632d975654f96e88146bc2de94e/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fflat_module_test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fflat_module_test.ts?ref=596dfb88a62a7632d975654f96e88146bc2de94e",
            "patch": "@@ -10,13 +10,16 @@ import {obsoleteInIvy, onlyInIvy} from '@angular/private/testing';\n import {existsSync, readFileSync} from 'fs';\n import {dirname, join} from 'path';\n \n+/** Runfiles helper from bazel to resolve file name paths.  */\n+const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']!);\n+\n describe('flat_module ng_module', () => {\n   let packageOutput: string;\n   let flatModuleOutFile: string;\n \n   beforeAll(() => {\n     packageOutput =\n-        dirname(require.resolve('angular/packages/bazel/test/ngc-wrapped/flat_module/index.js'));\n+        dirname(runfiles.resolve('angular/packages/bazel/test/ngc-wrapped/flat_module/index.js'));\n     flatModuleOutFile = join(packageOutput, 'flat_module.js');\n   });\n "
        }
    ],
    "stats": {
        "total": 28,
        "additions": 20,
        "deletions": 8
    }
}