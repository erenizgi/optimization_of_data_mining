{
    "author": "JoostK",
    "message": "feat(compiler): support unary operators for more accurate type checking (#37918)\n\nPrior to this change, the unary + and - operators would be parsed as `x - 0`\nand `0 - x` respectively. The runtime semantics of these expressions are\nequivalent, however they may introduce inaccurate template type checking\nerrors as the literal type is lost, for example:\n\n```ts\n@Component({\n  template: `<button [disabled]=\"isAdjacent(-1)\"></button>`\n})\nexport class Example {\n  isAdjacent(direction: -1 | 1): boolean { return false; }\n}\n```\n\nwould incorrectly report a type-check error:\n\n> error TS2345: Argument of type 'number' is not assignable to parameter\n  of type '-1 | 1'.\n\nAdditionally, the translated expression for the unary + operator would be\nconsidered as arithmetic expression with an incompatible left-hand side:\n\n> error TS2362: The left-hand side of an arithmetic operation must be of\n  type 'any', 'number', 'bigint' or an enum type.\n\nTo resolve this issues, the implicit transformation should be avoided.\nThis commit adds a new unary AST node to represent these expressions,\nallowing for more accurate type-checking.\n\nFixes #20845\nFixes #36178\n\nPR Close #37918",
    "sha": "874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
    "files": [
        {
            "sha": "9e672d2f383c9f2f0bc78906d8f6072ef5649ebe",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {ArrayType, AssertNotNull, BinaryOperator, BinaryOperatorExpr, BuiltinType, BuiltinTypeName, CastExpr, ClassStmt, CommaExpr, CommentStmt, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, Expression, ExpressionStatement, ExpressionType, ExpressionVisitor, ExternalExpr, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, InvokeMethodExpr, JSDocCommentStmt, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, MapType, NotExpr, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, Statement, StatementVisitor, StmtModifier, ThrowStmt, TryCatchStmt, Type, TypeofExpr, TypeVisitor, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr} from '@angular/compiler';\n-import {LocalizedString} from '@angular/compiler/src/output/output_ast';\n+import {LocalizedString, UnaryOperator, UnaryOperatorExpr} from '@angular/compiler/src/output/output_ast';\n import * as ts from 'typescript';\n \n import {DefaultImportRecorder, ImportRewriter, NOOP_DEFAULT_IMPORT_RECORDER, NoopImportRewriter} from '../../imports';\n@@ -24,6 +24,11 @@ export class Context {\n   }\n }\n \n+const UNARY_OPERATORS = new Map<UnaryOperator, ts.PrefixUnaryOperator>([\n+  [UnaryOperator.Minus, ts.SyntaxKind.MinusToken],\n+  [UnaryOperator.Plus, ts.SyntaxKind.PlusToken],\n+]);\n+\n const BINARY_OPERATORS = new Map<BinaryOperator, ts.BinaryOperator>([\n   [BinaryOperator.And, ts.SyntaxKind.AmpersandAmpersandToken],\n   [BinaryOperator.Bigger, ts.SyntaxKind.GreaterThanToken],\n@@ -361,6 +366,14 @@ class ExpressionTranslatorVisitor implements ExpressionVisitor, StatementVisitor\n         undefined, ts.createBlock(ast.statements.map(stmt => stmt.visitStatement(this, context))));\n   }\n \n+  visitUnaryOperatorExpr(ast: UnaryOperatorExpr, context: Context): ts.Expression {\n+    if (!UNARY_OPERATORS.has(ast.operator)) {\n+      throw new Error(`Unknown unary operator: ${UnaryOperator[ast.operator]}`);\n+    }\n+    return ts.createPrefix(\n+        UNARY_OPERATORS.get(ast.operator)!, ast.expr.visitExpression(this, context));\n+  }\n+\n   visitBinaryOperatorExpr(ast: BinaryOperatorExpr, context: Context): ts.Expression {\n     if (!BINARY_OPERATORS.has(ast.operator)) {\n       throw new Error(`Unknown binary operator: ${BinaryOperator[ast.operator]}`);\n@@ -567,6 +580,10 @@ export class TypeTranslatorVisitor implements ExpressionVisitor, TypeVisitor {\n     throw new Error('Method not implemented.');\n   }\n \n+  visitUnaryOperatorExpr(ast: UnaryOperatorExpr, context: Context) {\n+    throw new Error('Method not implemented.');\n+  }\n+\n   visitBinaryOperatorExpr(ast: BinaryOperatorExpr, context: Context) {\n     throw new Error('Method not implemented.');\n   }"
        },
        {
            "sha": "708ac522a1fc0d5bee0270f359a130efa86980d5",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 3,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead} from '@angular/compiler';\n+import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, Unary} from '@angular/compiler';\n import * as ts from 'typescript';\n import {TypeCheckingConfig} from '../api';\n \n@@ -17,7 +17,12 @@ export const NULL_AS_ANY =\n     ts.createAsExpression(ts.createNull(), ts.createKeywordTypeNode(ts.SyntaxKind.AnyKeyword));\n const UNDEFINED = ts.createIdentifier('undefined');\n \n-const BINARY_OPS = new Map<string, ts.SyntaxKind>([\n+const UNARY_OPS = new Map<string, ts.PrefixUnaryOperator>([\n+  ['+', ts.SyntaxKind.PlusToken],\n+  ['-', ts.SyntaxKind.MinusToken],\n+]);\n+\n+const BINARY_OPS = new Map<string, ts.BinaryOperator>([\n   ['+', ts.SyntaxKind.PlusToken],\n   ['-', ts.SyntaxKind.MinusToken],\n   ['<', ts.SyntaxKind.LessThanToken],\n@@ -74,14 +79,25 @@ class AstTranslator implements AstVisitor {\n     return ast.visit(this);\n   }\n \n+  visitUnary(ast: Unary): ts.Expression {\n+    const expr = this.translate(ast.expr);\n+    const op = UNARY_OPS.get(ast.operator);\n+    if (op === undefined) {\n+      throw new Error(`Unsupported Unary.operator: ${ast.operator}`);\n+    }\n+    const node = wrapForDiagnostics(ts.createPrefix(op, expr));\n+    addParseSpanInfo(node, ast.sourceSpan);\n+    return node;\n+  }\n+\n   visitBinary(ast: Binary): ts.Expression {\n     const lhs = wrapForDiagnostics(this.translate(ast.left));\n     const rhs = wrapForDiagnostics(this.translate(ast.right));\n     const op = BINARY_OPS.get(ast.operation);\n     if (op === undefined) {\n       throw new Error(`Unsupported Binary.operation: ${ast.operation}`);\n     }\n-    const node = ts.createBinary(lhs, op as any, rhs);\n+    const node = ts.createBinary(lhs, op, rhs);\n     addParseSpanInfo(node, ast.sourceSpan);\n     return node;\n   }\n@@ -314,6 +330,9 @@ class VeSafeLhsInferenceBugDetector implements AstVisitor {\n     return ast.receiver.visit(VeSafeLhsInferenceBugDetector.SINGLETON);\n   }\n \n+  visitUnary(ast: Unary): boolean {\n+    return ast.expr.visit(this);\n+  }\n   visitBinary(ast: Binary): boolean {\n     return ast.left.visit(this) || ast.right.visit(this);\n   }"
        },
        {
            "sha": "4a19284ea10cae5d60d7b14b340856e10f9c87a4",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/diagnostics_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -248,6 +248,17 @@ runInEachFileSystem(() => {\n       expect(messages).toEqual([]);\n     });\n \n+    it('should treat unary operators as literal types', () => {\n+      const messages = diagnose(`{{ test(-1) + test(+1) + test(-2) }}`, `\n+      class TestComponent {\n+        test(value: -1 | 1): number { return value; }\n+      }`);\n+\n+      expect(messages).toEqual([\n+        `TestComponent.html(1, 31): Argument of type '-2' is not assignable to parameter of type '1 | -1'.`,\n+      ]);\n+    });\n+\n     describe('outputs', () => {\n       it('should produce a diagnostic for directive outputs', () => {\n         const messages = diagnose("
        },
        {
            "sha": "1a87da69871b6d49faf668b76984d75ce8713783",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -10,6 +10,10 @@ import {tcb, TestDeclaration} from './test_utils';\n \n describe('type check blocks diagnostics', () => {\n   describe('parse spans', () => {\n+    it('should annotate unary ops', () => {\n+      expect(tcbWithSpans('{{ -a }}')).toContain('(-((ctx).a /*4,5*/) /*4,5*/) /*3,5*/');\n+    });\n+\n     it('should annotate binary ops', () => {\n       expect(tcbWithSpans('{{ a + b }}'))\n           .toContain('(((ctx).a /*3,4*/) /*3,4*/) + (((ctx).b /*7,8*/) /*7,8*/) /*3,8*/');"
        },
        {
            "sha": "fb168922b4a3a64abebdcf1bd12e1dc1863df38e",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -31,6 +31,11 @@ describe('type check blocks', () => {\n     expect(tcb(TEMPLATE)).toContain('((((ctx).a))!);');\n   });\n \n+  it('should handle unary - operator', () => {\n+    const TEMPLATE = `{{-1}}`;\n+    expect(tcb(TEMPLATE)).toContain('(-1);');\n+  });\n+\n   it('should handle keyed property access', () => {\n     const TEMPLATE = `{{a[b]}}`;\n     expect(tcb(TEMPLATE)).toContain('(((ctx).a))[((ctx).b)];');"
        },
        {
            "sha": "5ad9e0b2e33cbf684ba8eeafb82b59187aebcf69",
            "filename": "packages/compiler-cli/src/transformers/node_emitter.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {AssertNotNull, BinaryOperator, BinaryOperatorExpr, BuiltinMethod, BuiltinVar, CastExpr, ClassStmt, CommaExpr, CommentStmt, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, ExpressionStatement, ExpressionVisitor, ExternalExpr, ExternalReference, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, InvokeMethodExpr, JSDocCommentStmt, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, NotExpr, ParseSourceFile, ParseSourceSpan, PartialModule, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, Statement, StatementVisitor, StmtModifier, ThrowStmt, TryCatchStmt, TypeofExpr, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr} from '@angular/compiler';\n-import {LocalizedString} from '@angular/compiler/src/output/output_ast';\n+import {LocalizedString, UnaryOperator, UnaryOperatorExpr} from '@angular/compiler/src/output/output_ast';\n import * as ts from 'typescript';\n \n import {error} from './util';\n@@ -622,6 +622,23 @@ export class NodeEmitterVisitor implements StatementVisitor, ExpressionVisitor {\n             /* type */ undefined, this._visitStatements(expr.statements)));\n   }\n \n+  visitUnaryOperatorExpr(expr: UnaryOperatorExpr):\n+      RecordedNode<ts.UnaryExpression|ts.ParenthesizedExpression> {\n+    let unaryOperator: ts.BinaryOperator;\n+    switch (expr.operator) {\n+      case UnaryOperator.Minus:\n+        unaryOperator = ts.SyntaxKind.MinusToken;\n+        break;\n+      case UnaryOperator.Plus:\n+        unaryOperator = ts.SyntaxKind.PlusToken;\n+        break;\n+      default:\n+        throw new Error(`Unknown operator: ${expr.operator}`);\n+    }\n+    const binary = ts.createPrefix(unaryOperator, expr.expr.visitExpression(this, null));\n+    return this.record(expr, expr.parens ? ts.createParen(binary) : binary);\n+  }\n+\n   visitBinaryOperatorExpr(expr: BinaryOperatorExpr):\n       RecordedNode<ts.BinaryExpression|ts.ParenthesizedExpression> {\n     let binaryOperator: ts.BinaryOperator;"
        },
        {
            "sha": "1bae07ce32ef2d254b5ed4f2e2f0edde78a5dc1a",
            "filename": "packages/compiler/src/compiler_util/expression_converter.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -330,6 +330,26 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       private bindingId: string, private interpolationFunction: InterpolationFunction|undefined,\n       private baseSourceSpan?: ParseSourceSpan, private implicitReceiverAccesses?: Set<string>) {}\n \n+  visitUnary(ast: cdAst.Unary, mode: _Mode): any {\n+    let op: o.UnaryOperator;\n+    switch (ast.operator) {\n+      case '+':\n+        op = o.UnaryOperator.Plus;\n+        break;\n+      case '-':\n+        op = o.UnaryOperator.Minus;\n+        break;\n+      default:\n+        throw new Error(`Unsupported operator ${ast.operator}`);\n+    }\n+\n+    return convertToStatementIfNeeded(\n+        mode,\n+        new o.UnaryOperatorExpr(\n+            op, this._visit(ast.expr, _Mode.Expression), undefined,\n+            this.convertSourceSpan(ast.span)));\n+  }\n+\n   visitBinary(ast: cdAst.Binary, mode: _Mode): any {\n     let op: o.BinaryOperator;\n     switch (ast.operation) {\n@@ -710,6 +730,9 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       return (this._nodeMap.get(ast) || ast).visit(visitor);\n     };\n     return ast.visit({\n+      visitUnary(ast: cdAst.Unary) {\n+        return null;\n+      },\n       visitBinary(ast: cdAst.Binary) {\n         return null;\n       },\n@@ -784,6 +807,9 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       return ast.some(ast => visit(visitor, ast));\n     };\n     return ast.visit({\n+      visitUnary(ast: cdAst.Unary): boolean {\n+        return visit(this, ast.expr);\n+      },\n       visitBinary(ast: cdAst.Binary): boolean {\n         return visit(this, ast.left) || visit(this, ast.right);\n       },"
        },
        {
            "sha": "0046f7cc8790f1f686bd72b590afa1216034908d",
            "filename": "packages/compiler/src/constant_pool.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fconstant_pool.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -330,6 +330,7 @@ class KeyVisitor implements o.ExpressionVisitor {\n   visitAssertNotNullExpr = invalid;\n   visitCastExpr = invalid;\n   visitFunctionExpr = invalid;\n+  visitUnaryOperatorExpr = invalid;\n   visitBinaryOperatorExpr = invalid;\n   visitReadPropExpr = invalid;\n   visitReadKeyExpr = invalid;"
        },
        {
            "sha": "6568d6fafb15f10da0115d2abb7e2f104239af92",
            "filename": "packages/compiler/src/expression_parser/ast.ts",
            "status": "modified",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -227,6 +227,52 @@ export class Binary extends AST {\n   }\n }\n \n+/**\n+ * For backwards compatibility reasons, `Unary` inherits from `Binary` and mimics the binary AST\n+ * node that was originally used. This inheritance relation can be deleted in some future major,\n+ * after consumers have been given a chance to fully support Unary.\n+ */\n+export class Unary extends Binary {\n+  // Redeclare the properties that are inherited from `Binary` as `never`, as consumers should not\n+  // depend on these fields when operating on `Unary`.\n+  left: never;\n+  right: never;\n+  operation: never;\n+\n+  /**\n+   * Creates a unary minus expression \"-x\", represented as `Binary` using \"0 - x\".\n+   */\n+  static createMinus(span: ParseSpan, sourceSpan: AbsoluteSourceSpan, expr: AST): Unary {\n+    return new Unary(\n+        span, sourceSpan, '-', expr, '-', new LiteralPrimitive(span, sourceSpan, 0), expr);\n+  }\n+\n+  /**\n+   * Creates a unary plus expression \"+x\", represented as `Binary` using \"x - 0\".\n+   */\n+  static createPlus(span: ParseSpan, sourceSpan: AbsoluteSourceSpan, expr: AST): Unary {\n+    return new Unary(\n+        span, sourceSpan, '+', expr, '-', expr, new LiteralPrimitive(span, sourceSpan, 0));\n+  }\n+\n+  /**\n+   * During the deprecation period this constructor is private, to avoid consumers from creating\n+   * a `Unary` with the fallback properties for `Binary`.\n+   */\n+  private constructor(\n+      span: ParseSpan, sourceSpan: AbsoluteSourceSpan, public operator: string, public expr: AST,\n+      binaryOp: string, binaryLeft: AST, binaryRight: AST) {\n+    super(span, sourceSpan, binaryOp, binaryLeft, binaryRight);\n+  }\n+\n+  visit(visitor: AstVisitor, context: any = null): any {\n+    if (visitor.visitUnary !== undefined) {\n+      return visitor.visitUnary(this, context);\n+    }\n+    return visitor.visitBinary(this, context);\n+  }\n+}\n+\n export class PrefixNot extends AST {\n   constructor(span: ParseSpan, sourceSpan: AbsoluteSourceSpan, public expression: AST) {\n     super(span, sourceSpan);\n@@ -361,6 +407,11 @@ export interface TemplateBindingIdentifier {\n }\n \n export interface AstVisitor {\n+  /**\n+   * The `visitUnary` method is declared as optional for backwards compatibility. In an upcoming\n+   * major release, this method will be made required.\n+   */\n+  visitUnary?(ast: Unary, context: any): any;\n   visitBinary(ast: Binary, context: any): any;\n   visitChain(ast: Chain, context: any): any;\n   visitConditional(ast: Conditional, context: any): any;\n@@ -398,6 +449,9 @@ export class RecursiveAstVisitor implements AstVisitor {\n     // to selectively visit the specified node.\n     ast.visit(this, context);\n   }\n+  visitUnary(ast: Unary, context: any): any {\n+    this.visit(ast.expr, context);\n+  }\n   visitBinary(ast: Binary, context: any): any {\n     this.visit(ast.left, context);\n     this.visit(ast.right, context);\n@@ -527,6 +581,17 @@ export class AstTransformer implements AstVisitor {\n     return new LiteralMap(ast.span, ast.sourceSpan, ast.keys, this.visitAll(ast.values));\n   }\n \n+  visitUnary(ast: Unary, context: any): AST {\n+    switch (ast.operator) {\n+      case '+':\n+        return Unary.createPlus(ast.span, ast.sourceSpan, ast.expr.visit(this));\n+      case '-':\n+        return Unary.createMinus(ast.span, ast.sourceSpan, ast.expr.visit(this));\n+      default:\n+        throw new Error(`Unknown unary operator ${ast.operator}`);\n+    }\n+  }\n+\n   visitBinary(ast: Binary, context: any): AST {\n     return new Binary(\n         ast.span, ast.sourceSpan, ast.operation, ast.left.visit(this), ast.right.visit(this));\n@@ -665,6 +730,21 @@ export class AstMemoryEfficientTransformer implements AstVisitor {\n     return ast;\n   }\n \n+  visitUnary(ast: Unary, context: any): AST {\n+    const expr = ast.expr.visit(this);\n+    if (expr !== ast.expr) {\n+      switch (ast.operator) {\n+        case '+':\n+          return Unary.createPlus(ast.span, ast.sourceSpan, expr);\n+        case '-':\n+          return Unary.createMinus(ast.span, ast.sourceSpan, expr);\n+        default:\n+          throw new Error(`Unknown unary operator ${ast.operator}`);\n+      }\n+    }\n+    return ast;\n+  }\n+\n   visitBinary(ast: Binary, context: any): AST {\n     const left = ast.left.visit(this);\n     const right = ast.right.visit(this);"
        },
        {
            "sha": "f71fa40f5741e207907462d918326d000bfc27e0",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -10,7 +10,7 @@ import * as chars from '../chars';\n import {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../ml_parser/interpolation_config';\n import {escapeRegExp} from '../util';\n \n-import {AbsoluteSourceSpan, AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, ExpressionBinding, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralMapKey, LiteralPrimitive, MethodCall, NonNullAssert, ParserError, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, TemplateBinding, TemplateBindingIdentifier, VariableBinding} from './ast';\n+import {AbsoluteSourceSpan, AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, ExpressionBinding, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralMapKey, LiteralPrimitive, MethodCall, NonNullAssert, ParserError, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, TemplateBinding, TemplateBindingIdentifier, Unary, VariableBinding} from './ast';\n import {EOF, isIdentifier, isQuote, Lexer, Token, TokenType} from './lexer';\n \n export class SplitInterpolation {\n@@ -591,22 +591,16 @@ export class _ParseAST {\n     if (this.next.type == TokenType.Operator) {\n       const start = this.inputIndex;\n       const operator = this.next.strValue;\n-      const literalSpan = new ParseSpan(start, start);\n-      const literalSourceSpan = literalSpan.toAbsolute(this.absoluteOffset);\n       let result: AST;\n       switch (operator) {\n         case '+':\n           this.advance();\n           result = this.parsePrefix();\n-          return new Binary(\n-              this.span(start), this.sourceSpan(start), '-', result,\n-              new LiteralPrimitive(literalSpan, literalSourceSpan, 0));\n+          return Unary.createPlus(this.span(start), this.sourceSpan(start), result);\n         case '-':\n           this.advance();\n           result = this.parsePrefix();\n-          return new Binary(\n-              this.span(start), this.sourceSpan(start), operator,\n-              new LiteralPrimitive(literalSpan, literalSourceSpan, 0), result);\n+          return Unary.createMinus(this.span(start), this.sourceSpan(start), result);\n         case '!':\n           this.advance();\n           result = this.parsePrefix();\n@@ -1059,6 +1053,8 @@ class SimpleExpressionChecker implements AstVisitor {\n     this.visitAll(ast.values, context);\n   }\n \n+  visitUnary(ast: Unary, context: any) {}\n+\n   visitBinary(ast: Binary, context: any) {}\n \n   visitPrefixNot(ast: PrefixNot, context: any) {}"
        },
        {
            "sha": "486e0753582120217d79048160531055bb5fafab",
            "filename": "packages/compiler/src/output/abstract_emitter.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -420,6 +420,25 @@ export abstract class AbstractEmitterVisitor implements o.StatementVisitor, o.Ex\n   abstract visitFunctionExpr(ast: o.FunctionExpr, ctx: EmitterVisitorContext): any;\n   abstract visitDeclareFunctionStmt(stmt: o.DeclareFunctionStmt, context: any): any;\n \n+  visitUnaryOperatorExpr(ast: o.UnaryOperatorExpr, ctx: EmitterVisitorContext): any {\n+    let opStr: string;\n+    switch (ast.operator) {\n+      case o.UnaryOperator.Plus:\n+        opStr = '+';\n+        break;\n+      case o.UnaryOperator.Minus:\n+        opStr = '-';\n+        break;\n+      default:\n+        throw new Error(`Unknown operator ${ast.operator}`);\n+    }\n+    if (ast.parens) ctx.print(ast, `(`);\n+    ctx.print(ast, opStr);\n+    ast.expr.visitExpression(this, ctx);\n+    if (ast.parens) ctx.print(ast, `)`);\n+    return null;\n+  }\n+\n   visitBinaryOperatorExpr(ast: o.BinaryOperatorExpr, ctx: EmitterVisitorContext): any {\n     let opStr: string;\n     switch (ast.operator) {"
        },
        {
            "sha": "f718565ce32f464a151eb189c94a60976d02360b",
            "filename": "packages/compiler/src/output/output_ast.ts",
            "status": "modified",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -100,6 +100,11 @@ export interface TypeVisitor {\n \n ///// Expressions\n \n+export enum UnaryOperator {\n+  Minus,\n+  Plus,\n+}\n+\n export enum BinaryOperator {\n   Equals,\n   NotEquals,\n@@ -753,6 +758,28 @@ export class FunctionExpr extends Expression {\n }\n \n \n+export class UnaryOperatorExpr extends Expression {\n+  constructor(\n+      public operator: UnaryOperator, public expr: Expression, type?: Type|null,\n+      sourceSpan?: ParseSourceSpan|null, public parens: boolean = true) {\n+    super(type || NUMBER_TYPE, sourceSpan);\n+  }\n+\n+  isEquivalent(e: Expression): boolean {\n+    return e instanceof UnaryOperatorExpr && this.operator === e.operator &&\n+        this.expr.isEquivalent(e.expr);\n+  }\n+\n+  isConstant() {\n+    return false;\n+  }\n+\n+  visitExpression(visitor: ExpressionVisitor, context: any): any {\n+    return visitor.visitUnaryOperatorExpr(this, context);\n+  }\n+}\n+\n+\n export class BinaryOperatorExpr extends Expression {\n   public lhs: Expression;\n   constructor(\n@@ -912,6 +939,7 @@ export interface ExpressionVisitor {\n   visitAssertNotNullExpr(ast: AssertNotNull, context: any): any;\n   visitCastExpr(ast: CastExpr, context: any): any;\n   visitFunctionExpr(ast: FunctionExpr, context: any): any;\n+  visitUnaryOperatorExpr(ast: UnaryOperatorExpr, context: any): any;\n   visitBinaryOperatorExpr(ast: BinaryOperatorExpr, context: any): any;\n   visitReadPropExpr(ast: ReadPropExpr, context: any): any;\n   visitReadKeyExpr(ast: ReadKeyExpr, context: any): any;\n@@ -1292,6 +1320,13 @@ export class AstTransformer implements StatementVisitor, ExpressionVisitor {\n         context);\n   }\n \n+  visitUnaryOperatorExpr(ast: UnaryOperatorExpr, context: any): any {\n+    return this.transformExpr(\n+        new UnaryOperatorExpr(\n+            ast.operator, ast.expr.visitExpression(this, context), ast.type, ast.sourceSpan),\n+        context);\n+  }\n+\n   visitBinaryOperatorExpr(ast: BinaryOperatorExpr, context: any): any {\n     return this.transformExpr(\n         new BinaryOperatorExpr(\n@@ -1517,6 +1552,10 @@ export class RecursiveAstVisitor implements StatementVisitor, ExpressionVisitor\n     this.visitAllStatements(ast.statements, context);\n     return this.visitExpression(ast, context);\n   }\n+  visitUnaryOperatorExpr(ast: UnaryOperatorExpr, context: any): any {\n+    ast.expr.visitExpression(this, context);\n+    return this.visitExpression(ast, context);\n+  }\n   visitBinaryOperatorExpr(ast: BinaryOperatorExpr, context: any): any {\n     ast.lhs.visitExpression(this, context);\n     ast.rhs.visitExpression(this, context);\n@@ -1730,6 +1769,12 @@ export function literalMap(\n       values.map(e => new LiteralMapEntry(e.key, e.value, e.quoted)), type, null);\n }\n \n+export function unary(\n+    operator: UnaryOperator, expr: Expression, type?: Type,\n+    sourceSpan?: ParseSourceSpan|null): UnaryOperatorExpr {\n+  return new UnaryOperatorExpr(operator, expr, type, sourceSpan);\n+}\n+\n export function not(expr: Expression, sourceSpan?: ParseSourceSpan|null): NotExpr {\n   return new NotExpr(expr, sourceSpan);\n }"
        },
        {
            "sha": "b45444469d80e728ce4b11c221e10fda02ca25b1",
            "filename": "packages/compiler/src/output/output_interpreter.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -282,6 +282,18 @@ class StatementInterpreter implements o.StatementVisitor, o.ExpressionVisitor {\n     }\n     return null;\n   }\n+  visitUnaryOperatorExpr(ast: o.UnaryOperatorExpr, ctx: _ExecutionContext): any {\n+    const rhs = () => ast.expr.visitExpression(this, ctx);\n+\n+    switch (ast.operator) {\n+      case o.UnaryOperator.Plus:\n+        return +rhs();\n+      case o.UnaryOperator.Minus:\n+        return -rhs();\n+      default:\n+        throw new Error(`Unknown operator ${ast.operator}`);\n+    }\n+  }\n   visitBinaryOperatorExpr(ast: o.BinaryOperatorExpr, ctx: _ExecutionContext): any {\n     const lhs = () => ast.lhs.visitExpression(this, ctx);\n     const rhs = () => ast.rhs.visitExpression(this, ctx);"
        },
        {
            "sha": "bbc58d16f7ae1954325dced1f5c15f8ca27ab9b5",
            "filename": "packages/compiler/test/expression_parser/parser_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -34,11 +34,11 @@ describe('parser', () => {\n       checkAction('undefined');\n     });\n \n-    it('should parse unary - expressions', () => {\n-      checkAction('-1', '0 - 1');\n-      checkAction('+1', '1 - 0');\n-      checkAction(`-'1'`, `0 - \"1\"`);\n-      checkAction(`+'1'`, `\"1\" - 0`);\n+    it('should parse unary - and + expressions', () => {\n+      checkAction('-1', '-1');\n+      checkAction('+1', '+1');\n+      checkAction(`-'1'`, `-\"1\"`);\n+      checkAction(`+'1'`, `+\"1\"`);\n     });\n \n     it('should parse unary ! expressions', () => {"
        },
        {
            "sha": "c16dae0d5113182e7b88fce2f658030c37259511",
            "filename": "packages/compiler/test/expression_parser/utils/unparser.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AbsoluteSourceSpan, AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead} from '../../../src/expression_parser/ast';\n+import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, Unary} from '../../../src/expression_parser/ast';\n import {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../../../src/ml_parser/interpolation_config';\n \n class Unparser implements AstVisitor {\n@@ -35,6 +35,11 @@ class Unparser implements AstVisitor {\n     this._visit(ast.value);\n   }\n \n+  visitUnary(ast: Unary, context: any) {\n+    this._expression += ast.operator;\n+    this._visit(ast.expr);\n+  }\n+\n   visitBinary(ast: Binary, context: any) {\n     this._visit(ast.left);\n     this._expression += ` ${ast.operation} `;"
        },
        {
            "sha": "0023fa77dde373376dd65d25863f92ee3efad575",
            "filename": "packages/compiler/test/expression_parser/utils/validator.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Fvalidator.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Fvalidator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Fvalidator.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead} from '../../../src/expression_parser/ast';\n+import {AST, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, Unary} from '../../../src/expression_parser/ast';\n \n import {unparse} from './unparser';\n \n@@ -34,6 +34,10 @@ class ASTValidator extends RecursiveAstVisitor {\n     this.parentSpan = oldParent;\n   }\n \n+  visitUnary(ast: Unary, context: any): any {\n+    this.validate(ast, () => super.visitUnary(ast, context));\n+  }\n+\n   visitBinary(ast: Binary, context: any): any {\n     this.validate(ast, () => super.visitBinary(ast, context));\n   }"
        },
        {
            "sha": "c21297c4ee823c58ab54c0cabdcb6bda681597db",
            "filename": "packages/compiler/test/output/js_emitter_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Foutput%2Fjs_emitter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Foutput%2Fjs_emitter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Foutput%2Fjs_emitter_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -138,6 +138,8 @@ const externalModuleIdentifier = new o.ExternalReference(anotherModuleUrl, 'some\n       const lhs = o.variable('lhs');\n       const rhs = o.variable('rhs');\n       expect(emitStmt(o.not(someVar).toStmt())).toEqual('!someVar;');\n+      expect(emitStmt(o.unary(o.UnaryOperator.Minus, someVar).toStmt())).toEqual('(-someVar);');\n+      expect(emitStmt(o.unary(o.UnaryOperator.Plus, someVar).toStmt())).toEqual('(+someVar);');\n       expect(emitStmt(o.assertNotNull(someVar).toStmt())).toEqual('someVar;');\n       expect(\n           emitStmt(someVar.conditional(o.variable('trueCase'), o.variable('falseCase')).toStmt()))"
        },
        {
            "sha": "78da4b697fb9c53c3a93eea81d9d1666d709ce08",
            "filename": "packages/compiler/test/output/ts_emitter_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Foutput%2Fts_emitter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Foutput%2Fts_emitter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Foutput%2Fts_emitter_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -191,6 +191,8 @@ const externalModuleIdentifier = new o.ExternalReference(anotherModuleUrl, 'some\n       const rhs = o.variable('rhs');\n       expect(emitStmt(someVar.cast(o.INT_TYPE).toStmt())).toEqual('(<number>someVar);');\n       expect(emitStmt(o.not(someVar).toStmt())).toEqual('!someVar;');\n+      expect(emitStmt(o.unary(o.UnaryOperator.Minus, someVar).toStmt())).toEqual('(-someVar);');\n+      expect(emitStmt(o.unary(o.UnaryOperator.Plus, someVar).toStmt())).toEqual('(+someVar);');\n       expect(emitStmt(o.assertNotNull(someVar).toStmt())).toEqual('someVar!;');\n       expect(\n           emitStmt(someVar.conditional(o.variable('trueCase'), o.variable('falseCase')).toStmt()))"
        },
        {
            "sha": "fe620e0e6f7848de60d97b6e80f92274b3a75f43",
            "filename": "packages/compiler/test/template_parser/template_parser_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -1656,7 +1656,7 @@ Reference \"#a\" is defined several times (\"<div #a></div><div [ERROR ->]#a></div>\n         expect(humanizeTplAst(parse('<div *ngIf=\"-1\">', [ngIf]))).toEqual([\n           [EmbeddedTemplateAst],\n           [DirectiveAst, ngIf],\n-          [BoundDirectivePropertyAst, 'ngIf', '0 - 1'],\n+          [BoundDirectivePropertyAst, 'ngIf', '-1'],\n           [ElementAst, 'div'],\n         ]);\n       });"
        },
        {
            "sha": "bad905d9fffd98144caa2a10431a47c2ff366765",
            "filename": "packages/compiler/test/template_parser/util/expression.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Futil%2Fexpression.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Futil%2Fexpression.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Futil%2Fexpression.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -30,6 +30,10 @@ class ExpressionSourceHumanizer extends e.RecursiveAstVisitor implements t.Templ\n     this.recordAst(ast);\n     this.visitAll([ast.ast], null);\n   }\n+  visitUnary(ast: e.Unary) {\n+    this.recordAst(ast);\n+    super.visitUnary(ast, null);\n+  }\n   visitBinary(ast: e.Binary) {\n     this.recordAst(ast);\n     super.visitBinary(ast, null);"
        },
        {
            "sha": "099ff99fccd0827448bb2296296d73682068c85a",
            "filename": "packages/language-service/src/expression_type.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, AstVisitor, ASTWithName, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead} from '@angular/compiler';\n+import {AST, AstVisitor, ASTWithName, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, Unary} from '@angular/compiler';\n \n import {createDiagnostic, Diagnostic} from './diagnostic_messages';\n import {BuiltinType, Signature, Symbol, SymbolQuery, SymbolTable} from './symbols';\n@@ -38,6 +38,23 @@ export class AstType implements AstVisitor {\n     return this.diagnostics;\n   }\n \n+  visitUnary(ast: Unary): Symbol {\n+    // Visit the child to produce diagnostics.\n+    ast.expr.visit(this);\n+\n+    // The unary plus and minus operator are always of type number.\n+    // https://github.com/Microsoft/TypeScript/blob/v1.8.10/doc/spec.md#4.18\n+    switch (ast.operator) {\n+      case '-':\n+      case '+':\n+        return this.query.getBuiltinType(BuiltinType.Number);\n+    }\n+\n+    this.diagnostics.push(\n+        createDiagnostic(refinedSpan(ast), Diagnostic.unrecognized_operator, ast.operator));\n+    return this.anyType;\n+  }\n+\n   visitBinary(ast: Binary): Symbol {\n     const getType = (ast: AST, operation: string): Symbol => {\n       const type = this.getType(ast);"
        },
        {
            "sha": "ac0eb18ab472de4807c7c83064286f4132923e04",
            "filename": "packages/language-service/src/expressions.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -63,6 +63,7 @@ export function getExpressionCompletions(\n   // (that is the scope of the implicit receiver) is the right scope as the user is typing the\n   // beginning of an expression.\n   tail.visit({\n+    visitUnary(_ast) {},\n     visitBinary(_ast) {},\n     visitChain(_ast) {},\n     visitConditional(_ast) {},\n@@ -157,6 +158,7 @@ export function getExpressionSymbol(\n   // (that is the scope of the implicit receiver) is the right scope as the user is typing the\n   // beginning of an expression.\n   tail.visit({\n+    visitUnary(_ast) {},\n     visitBinary(_ast) {},\n     visitChain(_ast) {},\n     visitConditional(_ast) {},"
        },
        {
            "sha": "cab7a9a6901d4cd2ff31b82614dc6f5d86e897ca",
            "filename": "packages/language-service/test/expression_diagnostics_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Ftest%2Fexpression_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/874792dc43a70dc55c9b926807ca6bbcb5cafb9e/packages%2Flanguage-service%2Ftest%2Fexpression_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Ftest%2Fexpression_diagnostics_spec.ts?ref=874792dc43a70dc55c9b926807ca6bbcb5cafb9e",
            "patch": "@@ -102,6 +102,8 @@ describe('expression diagnostics', () => {\n   it('should reject *ngIf of misspelled identifier in PrefixNot node',\n      () =>\n          reject('<div *ngIf=\"people && !persson\"></div>', 'Identifier \\'persson\\' is not defined'));\n+  it('should reject misspelled field in unary operator expression',\n+     () => reject('{{ +persson }}', `Identifier 'persson' is not defined`));\n   it('should accept an *ngFor', () => accept(`\n       <div *ngFor=\"let p of people\">\n         {{p.name.first}} {{p.name.last}}"
        }
    ],
    "stats": {
        "total": 336,
        "additions": 313,
        "deletions": 23
    }
}