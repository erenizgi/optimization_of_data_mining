{
    "author": "josephperrott",
    "message": "feat(dev-infra): provide tooling to check what branches a pr targets (#39504)\n\nCreate a command in the `ng-dev` toolset that allows user's to check\nwhat branches a PR will merge into based on its targeting.\n\nPR Close #39504",
    "sha": "d0dd0e80f67739575e17c93171abdaf5639d4200",
    "files": [
        {
            "sha": "a84314d67d518f678cb6edfad787776ae4977f6e",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 247,
            "deletions": 165,
            "changes": 412,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -2599,6 +2599,235 @@ function buildNgbotParser(localYargs) {\n     return localYargs.help().strict().demandCommand().command('verify', 'Verify the NgBot config', {}, () => verify());\n }\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Loads and validates the merge configuration. */\n+function loadAndValidateConfig(config, api) {\n+    return tslib.__awaiter(this, void 0, void 0, function () {\n+        var mergeConfig, errors;\n+        return tslib.__generator(this, function (_a) {\n+            switch (_a.label) {\n+                case 0:\n+                    if (config.merge === undefined) {\n+                        return [2 /*return*/, { errors: ['No merge configuration found. Set the `merge` configuration.'] }];\n+                    }\n+                    if (typeof config.merge !== 'function') {\n+                        return [2 /*return*/, { errors: ['Expected merge configuration to be defined lazily through a function.'] }];\n+                    }\n+                    return [4 /*yield*/, config.merge(api)];\n+                case 1:\n+                    mergeConfig = _a.sent();\n+                    errors = validateMergeConfig(mergeConfig);\n+                    if (errors.length) {\n+                        return [2 /*return*/, { errors: errors }];\n+                    }\n+                    return [2 /*return*/, { config: mergeConfig }];\n+            }\n+        });\n+    });\n+}\n+/** Validates the specified configuration. Returns a list of failure messages. */\n+function validateMergeConfig(config) {\n+    var errors = [];\n+    if (!config.labels) {\n+        errors.push('No label configuration.');\n+    }\n+    else if (!Array.isArray(config.labels)) {\n+        errors.push('Label configuration needs to be an array.');\n+    }\n+    if (!config.claSignedLabel) {\n+        errors.push('No CLA signed label configured.');\n+    }\n+    if (!config.mergeReadyLabel) {\n+        errors.push('No merge ready label configured.');\n+    }\n+    if (config.githubApiMerge === undefined) {\n+        errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');\n+    }\n+    return errors;\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Checks whether the specified value matches the given pattern. */\n+function matchesPattern(value, pattern) {\n+    return typeof pattern === 'string' ? value === pattern : pattern.test(value);\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Unique error that can be thrown in the merge configuration if an\n+ * invalid branch is targeted.\n+ */\n+var InvalidTargetBranchError = /** @class */ (function () {\n+    function InvalidTargetBranchError(failureMessage) {\n+        this.failureMessage = failureMessage;\n+    }\n+    return InvalidTargetBranchError;\n+}());\n+/**\n+ * Unique error that can be thrown in the merge configuration if an\n+ * invalid label has been applied to a pull request.\n+ */\n+var InvalidTargetLabelError = /** @class */ (function () {\n+    function InvalidTargetLabelError(failureMessage) {\n+        this.failureMessage = failureMessage;\n+    }\n+    return InvalidTargetLabelError;\n+}());\n+/** Gets the target label from the specified pull request labels. */\n+function getTargetLabelFromPullRequest(config, labels) {\n+    var e_1, _a;\n+    var _loop_1 = function (label) {\n+        var match = config.labels.find(function (_a) {\n+            var pattern = _a.pattern;\n+            return matchesPattern(label, pattern);\n+        });\n+        if (match !== undefined) {\n+            return { value: match };\n+        }\n+    };\n+    try {\n+        for (var labels_1 = tslib.__values(labels), labels_1_1 = labels_1.next(); !labels_1_1.done; labels_1_1 = labels_1.next()) {\n+            var label = labels_1_1.value;\n+            var state_1 = _loop_1(label);\n+            if (typeof state_1 === \"object\")\n+                return state_1.value;\n+        }\n+    }\n+    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n+    finally {\n+        try {\n+            if (labels_1_1 && !labels_1_1.done && (_a = labels_1.return)) _a.call(labels_1);\n+        }\n+        finally { if (e_1) throw e_1.error; }\n+    }\n+    return null;\n+}\n+/**\n+ * Gets the branches from the specified target label.\n+ *\n+ * @throws {InvalidTargetLabelError} Invalid label has been applied to pull request.\n+ * @throws {InvalidTargetBranchError} Invalid Github target branch has been selected.\n+ */\n+function getBranchesFromTargetLabel(label, githubTargetBranch) {\n+    return tslib.__awaiter(this, void 0, void 0, function () {\n+        var _a;\n+        return tslib.__generator(this, function (_b) {\n+            switch (_b.label) {\n+                case 0:\n+                    if (!(typeof label.branches === 'function')) return [3 /*break*/, 2];\n+                    return [4 /*yield*/, label.branches(githubTargetBranch)];\n+                case 1:\n+                    _a = _b.sent();\n+                    return [3 /*break*/, 4];\n+                case 2: return [4 /*yield*/, label.branches];\n+                case 3:\n+                    _a = _b.sent();\n+                    _b.label = 4;\n+                case 4: return [2 /*return*/, _a];\n+            }\n+        });\n+    });\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+function checkTargetBranchesForPr(prNumber, jsonOutput = false) {\n+    return tslib.__awaiter(this, void 0, void 0, function* () {\n+        /** The ng-dev configuration. */\n+        const config = getConfig();\n+        /** Repo owner and name for the github repository. */\n+        const { owner, name: repo } = config.github;\n+        /** The git client to get a Github API service instance. */\n+        const git = new GitClient(undefined, config);\n+        /** The validated merge config. */\n+        const { config: mergeConfig, errors } = yield loadAndValidateConfig(config, git.github);\n+        if (errors !== undefined) {\n+            throw Error(`Invalid configuration found: ${errors}`);\n+        }\n+        /** The current state of the pull request from Github. */\n+        const prData = (yield git.github.pulls.get({ owner, repo, pull_number: prNumber })).data;\n+        /** The list of labels on the PR as strings. */\n+        const labels = prData.labels.map(l => l.name);\n+        /** The branch targetted via the Github UI. */\n+        const githubTargetBranch = prData.base.ref;\n+        /** The active label which is being used for targetting the PR. */\n+        const targetLabel = getTargetLabelFromPullRequest(mergeConfig, labels);\n+        if (targetLabel === null) {\n+            error(red(`No target label was found on pr #${prNumber}`));\n+            process.exitCode = 1;\n+            return;\n+        }\n+        /** The target branches based on the target label and branch targetted in the Github UI. */\n+        const targets = yield getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n+        // When requested, print a json output to stdout, rather than using standard ng-dev logging.\n+        if (jsonOutput) {\n+            process.stdout.write(JSON.stringify(targets));\n+            return;\n+        }\n+        info.group(`PR #${prNumber} will merge into:`);\n+        targets.forEach(target => info(`- ${target}`));\n+        info.groupEnd();\n+    });\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Builds the command. */\n+function builder$5(yargs) {\n+    return yargs\n+        .positional('pr', {\n+        description: 'The pull request number',\n+        type: 'number',\n+        demandOption: true,\n+    })\n+        .option('json', {\n+        type: 'boolean',\n+        default: false,\n+        description: 'Print response as json',\n+    });\n+}\n+/** Handles the command. */\n+function handler$5({ pr, json }) {\n+    return tslib.__awaiter(this, void 0, void 0, function* () {\n+        yield checkTargetBranchesForPr(pr, json);\n+    });\n+}\n+/** yargs command module describing the command.  */\n+const CheckTargetBranchesModule = {\n+    handler: handler$5,\n+    builder: builder$5,\n+    command: 'check-target-branches <pr>',\n+    describe: 'Check a PR to determine what branches it is currently targeting',\n+};\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -2799,20 +3028,20 @@ function checkOutPullRequestLocally(prNumber, githubToken, opts = {}) {\n  * found in the LICENSE file at https://angular.io/license\n  */\n /** Builds the checkout pull request command. */\n-function builder$5(yargs) {\n+function builder$6(yargs) {\n     return addGithubTokenOption(yargs).positional('prNumber', { type: 'number', demandOption: true });\n }\n /** Handles the checkout pull request command. */\n-function handler$5({ prNumber, githubToken }) {\n+function handler$6({ prNumber, githubToken }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const prCheckoutOptions = { allowIfMaintainerCannotModify: true, branchName: `pr-${prNumber}` };\n         yield checkOutPullRequestLocally(prNumber, githubToken, prCheckoutOptions);\n     });\n }\n /** yargs command module for checking out a PR  */\n const CheckoutCommandModule = {\n-    handler: handler$5,\n-    builder: builder$5,\n+    handler: handler$6,\n+    builder: builder$6,\n     command: 'checkout <pr-number>',\n     describe: 'Checkout a PR from the upstream repo',\n };\n@@ -2985,59 +3214,6 @@ function getThirtyDaysAgoDate() {\n     return date.getTime();\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Loads and validates the merge configuration. */\n-function loadAndValidateConfig(config, api) {\n-    return tslib.__awaiter(this, void 0, void 0, function () {\n-        var mergeConfig, errors;\n-        return tslib.__generator(this, function (_a) {\n-            switch (_a.label) {\n-                case 0:\n-                    if (config.merge === undefined) {\n-                        return [2 /*return*/, { errors: ['No merge configuration found. Set the `merge` configuration.'] }];\n-                    }\n-                    if (typeof config.merge !== 'function') {\n-                        return [2 /*return*/, { errors: ['Expected merge configuration to be defined lazily through a function.'] }];\n-                    }\n-                    return [4 /*yield*/, config.merge(api)];\n-                case 1:\n-                    mergeConfig = _a.sent();\n-                    errors = validateMergeConfig(mergeConfig);\n-                    if (errors.length) {\n-                        return [2 /*return*/, { errors: errors }];\n-                    }\n-                    return [2 /*return*/, { config: mergeConfig }];\n-            }\n-        });\n-    });\n-}\n-/** Validates the specified configuration. Returns a list of failure messages. */\n-function validateMergeConfig(config) {\n-    var errors = [];\n-    if (!config.labels) {\n-        errors.push('No label configuration.');\n-    }\n-    else if (!Array.isArray(config.labels)) {\n-        errors.push('Label configuration needs to be an array.');\n-    }\n-    if (!config.claSignedLabel) {\n-        errors.push('No CLA signed label configured.');\n-    }\n-    if (!config.mergeReadyLabel) {\n-        errors.push('No merge ready label configured.');\n-    }\n-    if (config.githubApiMerge === undefined) {\n-        errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');\n-    }\n-    return errors;\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -3121,101 +3297,6 @@ function getTargettedBranchesConfirmationPromptMessage(pullRequest) {\n     return \"Pull request #\" + pullRequest.prNumber + \" will merge into:\\n\" + targetBranchListAsString + \"\\nDo you want to proceed merging?\";\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Checks whether the specified value matches the given pattern. */\n-function matchesPattern(value, pattern) {\n-    return typeof pattern === 'string' ? value === pattern : pattern.test(value);\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Unique error that can be thrown in the merge configuration if an\n- * invalid branch is targeted.\n- */\n-var InvalidTargetBranchError = /** @class */ (function () {\n-    function InvalidTargetBranchError(failureMessage) {\n-        this.failureMessage = failureMessage;\n-    }\n-    return InvalidTargetBranchError;\n-}());\n-/**\n- * Unique error that can be thrown in the merge configuration if an\n- * invalid label has been applied to a pull request.\n- */\n-var InvalidTargetLabelError = /** @class */ (function () {\n-    function InvalidTargetLabelError(failureMessage) {\n-        this.failureMessage = failureMessage;\n-    }\n-    return InvalidTargetLabelError;\n-}());\n-/** Gets the target label from the specified pull request labels. */\n-function getTargetLabelFromPullRequest(config, labels) {\n-    var e_1, _a;\n-    var _loop_1 = function (label) {\n-        var match = config.labels.find(function (_a) {\n-            var pattern = _a.pattern;\n-            return matchesPattern(label, pattern);\n-        });\n-        if (match !== undefined) {\n-            return { value: match };\n-        }\n-    };\n-    try {\n-        for (var labels_1 = tslib.__values(labels), labels_1_1 = labels_1.next(); !labels_1_1.done; labels_1_1 = labels_1.next()) {\n-            var label = labels_1_1.value;\n-            var state_1 = _loop_1(label);\n-            if (typeof state_1 === \"object\")\n-                return state_1.value;\n-        }\n-    }\n-    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n-    finally {\n-        try {\n-            if (labels_1_1 && !labels_1_1.done && (_a = labels_1.return)) _a.call(labels_1);\n-        }\n-        finally { if (e_1) throw e_1.error; }\n-    }\n-    return null;\n-}\n-/**\n- * Gets the branches from the specified target label.\n- *\n- * @throws {InvalidTargetLabelError} Invalid label has been applied to pull request.\n- * @throws {InvalidTargetBranchError} Invalid Github target branch has been selected.\n- */\n-function getBranchesFromTargetLabel(label, githubTargetBranch) {\n-    return tslib.__awaiter(this, void 0, void 0, function () {\n-        var _a;\n-        return tslib.__generator(this, function (_b) {\n-            switch (_b.label) {\n-                case 0:\n-                    if (!(typeof label.branches === 'function')) return [3 /*break*/, 2];\n-                    return [4 /*yield*/, label.branches(githubTargetBranch)];\n-                case 1:\n-                    _a = _b.sent();\n-                    return [3 /*break*/, 4];\n-                case 2: return [4 /*yield*/, label.branches];\n-                case 3:\n-                    _a = _b.sent();\n-                    _b.label = 4;\n-                case 4: return [2 /*return*/, _a];\n-            }\n-        });\n-    });\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -4251,7 +4332,8 @@ function buildPrParser(localYargs) {\n         .command('merge <pr-number>', 'Merge pull requests', buildMergeCommand, handleMergeCommand)\n         .command('discover-new-conflicts <pr-number>', 'Check if a pending PR causes new conflicts for other pending PRs', buildDiscoverNewConflictsCommand, handleDiscoverNewConflictsCommand)\n         .command('rebase <pr-number>', 'Rebase a pending PR and push the rebased commits back to Github', buildRebaseCommand, handleRebaseCommand)\n-        .command(CheckoutCommandModule);\n+        .command(CheckoutCommandModule)\n+        .command(CheckTargetBranchesModule);\n }\n \n /**\n@@ -4718,15 +4800,15 @@ function buildReleaseOutput() {\n  * found in the LICENSE file at https://angular.io/license\n  */\n /** Yargs command builder for configuring the `ng-dev release build` command. */\n-function builder$6(argv) {\n+function builder$7(argv) {\n     return argv.option('json', {\n         type: 'boolean',\n         description: 'Whether the built packages should be printed to stdout as JSON.',\n         default: false,\n     });\n }\n /** Yargs command handler for building a release. */\n-function handler$6(args) {\n+function handler$7(args) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const { npmPackages } = getReleaseConfig();\n         let builtPackages = yield buildReleaseOutput();\n@@ -4761,8 +4843,8 @@ function handler$6(args) {\n }\n /** CLI command module for building release output. */\n const ReleaseBuildCommandModule = {\n-    builder: builder$6,\n-    handler: handler$6,\n+    builder: builder$7,\n+    handler: handler$7,\n     command: 'build',\n     describe: 'Builds the release output for the current branch.',\n };\n@@ -6217,11 +6299,11 @@ class ReleaseTool {\n  * found in the LICENSE file at https://angular.io/license\n  */\n /** Yargs command builder for configuring the `ng-dev release publish` command. */\n-function builder$7(argv) {\n+function builder$8(argv) {\n     return addGithubTokenOption(argv);\n }\n /** Yargs command handler for staging a release. */\n-function handler$7(args) {\n+function handler$8(args) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const config = getConfig();\n         const releaseConfig = getReleaseConfig(config);\n@@ -6244,8 +6326,8 @@ function handler$7(args) {\n }\n /** CLI command module for publishing a release. */\n const ReleasePublishCommandModule = {\n-    builder: builder$7,\n-    handler: handler$7,\n+    builder: builder$8,\n+    handler: handler$8,\n     command: 'publish',\n     describe: 'Publish new releases and configure version branches.',\n };\n@@ -6257,7 +6339,7 @@ const ReleasePublishCommandModule = {\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-function builder$8(args) {\n+function builder$9(args) {\n     return args\n         .positional('tagName', {\n         type: 'string',\n@@ -6271,7 +6353,7 @@ function builder$8(args) {\n     });\n }\n /** Yargs command handler for building a release. */\n-function handler$8(args) {\n+function handler$9(args) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const { targetVersion: rawVersion, tagName } = args;\n         const { npmPackages, publishRegistry } = getReleaseConfig();\n@@ -6303,8 +6385,8 @@ function handler$8(args) {\n }\n /** CLI command module for setting an NPM dist tag. */\n const ReleaseSetDistTagCommand = {\n-    builder: builder$8,\n-    handler: handler$8,\n+    builder: builder$9,\n+    handler: handler$9,\n     command: 'set-dist-tag <tag-name> <target-version>',\n     describe: 'Sets a given NPM dist tag for all release packages.',\n };"
        },
        {
            "sha": "00a0cee65442c0cd7d3c9ab2f5e491ee9bf54ab4",
            "filename": "dev-infra/pr/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2FBUILD.bazel?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -6,6 +6,7 @@ ts_library(\n     module_name = \"@angular/dev-infra-private/pr\",\n     visibility = [\"//dev-infra:__subpackages__\"],\n     deps = [\n+        \"//dev-infra/pr/check-target-branches\",\n         \"//dev-infra/pr/checkout\",\n         \"//dev-infra/pr/discover-new-conflicts\",\n         \"//dev-infra/pr/merge\","
        },
        {
            "sha": "4250f863170ccb162ff3d705814e36790975a5c5",
            "filename": "dev-infra/pr/check-target-branches/BUILD.bazel",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2FBUILD.bazel?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -0,0 +1,13 @@\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"check-target-branches\",\n+    srcs = glob([\"*.ts\"]),\n+    module_name = \"@angular/dev-infra-private/pr/check-target-branches\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/pr/merge\",\n+        \"//dev-infra/utils\",\n+        \"@npm//@types/yargs\",\n+    ],\n+)"
        },
        {
            "sha": "992a4976f212ab4ef0c71c7080c6d7d37ef4d33e",
            "filename": "dev-infra/pr/check-target-branches/check-target-branches.ts",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -0,0 +1,52 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {getConfig} from '../../utils/config';\n+import {error, info, red} from '../../utils/console';\n+import {GitClient} from '../../utils/git/index';\n+import {loadAndValidateConfig} from '../merge/config';\n+import {getBranchesFromTargetLabel, getTargetLabelFromPullRequest} from '../merge/target-label';\n+\n+export async function checkTargetBranchesForPr(prNumber: number, jsonOutput = false) {\n+  /** The ng-dev configuration. */\n+  const config = getConfig();\n+  /** Repo owner and name for the github repository. */\n+  const {owner, name: repo} = config.github;\n+  /** The git client to get a Github API service instance. */\n+  const git = new GitClient(undefined, config);\n+  /** The validated merge config. */\n+  const {config: mergeConfig, errors} = await loadAndValidateConfig(config, git.github);\n+  if (errors !== undefined) {\n+    throw Error(`Invalid configuration found: ${errors}`);\n+  }\n+  /** The current state of the pull request from Github. */\n+  const prData = (await git.github.pulls.get({owner, repo, pull_number: prNumber})).data;\n+  /** The list of labels on the PR as strings. */\n+  const labels = prData.labels.map(l => l.name);\n+  /** The branch targetted via the Github UI. */\n+  const githubTargetBranch = prData.base.ref;\n+  /** The active label which is being used for targetting the PR. */\n+  const targetLabel = getTargetLabelFromPullRequest(mergeConfig!, labels);\n+  if (targetLabel === null) {\n+    error(red(`No target label was found on pr #${prNumber}`));\n+    process.exitCode = 1;\n+    return;\n+  }\n+  /** The target branches based on the target label and branch targetted in the Github UI. */\n+  const targets = await getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n+\n+  // When requested, print a json output to stdout, rather than using standard ng-dev logging.\n+  if (jsonOutput) {\n+    process.stdout.write(JSON.stringify(targets));\n+    return;\n+  }\n+\n+  info.group(`PR #${prNumber} will merge into:`);\n+  targets.forEach(target => info(`- ${target}`));\n+  info.groupEnd();\n+}"
        },
        {
            "sha": "2ad937c554c1c5819b52f694497a5af61a7437ee",
            "filename": "dev-infra/pr/check-target-branches/cli.ts",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -0,0 +1,44 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {checkTargetBranchesForPr} from './check-target-branches';\n+\n+export interface CheckTargetBranchesOptions {\n+  pr: number;\n+  json: boolean;\n+}\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return yargs\n+      .positional('pr', {\n+        description: 'The pull request number',\n+        type: 'number',\n+        demandOption: true,\n+      })\n+      .option('json', {\n+        type: 'boolean',\n+        default: false,\n+        description: 'Print response as json',\n+      });\n+}\n+\n+/** Handles the command. */\n+async function handler({pr, json}: Arguments<CheckTargetBranchesOptions>) {\n+  await checkTargetBranchesForPr(pr, json);\n+}\n+\n+/** yargs command module describing the command.  */\n+export const CheckTargetBranchesModule: CommandModule<{}, CheckTargetBranchesOptions> = {\n+  handler,\n+  builder,\n+  command: 'check-target-branches <pr>',\n+  describe: 'Check a PR to determine what branches it is currently targeting',\n+};"
        },
        {
            "sha": "c9e6ccfbca06c4e870e1d8715b12decbb07db683",
            "filename": "dev-infra/pr/cli.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0dd0e80f67739575e17c93171abdaf5639d4200/dev-infra%2Fpr%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcli.ts?ref=d0dd0e80f67739575e17c93171abdaf5639d4200",
            "patch": "@@ -8,6 +8,7 @@\n \n import * as yargs from 'yargs';\n \n+import {CheckTargetBranchesModule} from './check-target-branches/cli';\n import {CheckoutCommandModule} from './checkout/cli';\n import {buildDiscoverNewConflictsCommand, handleDiscoverNewConflictsCommand} from './discover-new-conflicts/cli';\n import {buildMergeCommand, handleMergeCommand} from './merge/cli';\n@@ -26,5 +27,6 @@ export function buildPrParser(localYargs: yargs.Argv) {\n       .command(\n           'rebase <pr-number>', 'Rebase a pending PR and push the rebased commits back to Github',\n           buildRebaseCommand, handleRebaseCommand)\n-      .command(CheckoutCommandModule);\n+      .command(CheckoutCommandModule)\n+      .command(CheckTargetBranchesModule);\n }"
        }
    ],
    "stats": {
        "total": 526,
        "additions": 360,
        "deletions": 166
    }
}