{
    "author": "dgp1130",
    "message": "refactor(compiler): add `ModuleInfo` interface (#38320)\n\nThis introduces a new `ModuleInfo` interface to represent some of the statically analyzed data from an `NgModule`. This\ngets passed into transforms to give them more context around a given `NgModule` in the compilation.\n\nPR Close #38320",
    "sha": "2a745c8df85261004fda3e518498b6215ea295be",
    "files": [
        {
            "sha": "e83ced30ad399d461f118e2942a02d7123c817b2",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/ng_module.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts?ref=2a745c8df85261004fda3e518498b6215ea295be",
            "patch": "@@ -307,7 +307,10 @@ export class NgModuleDecoratorHandler implements\n     });\n \n     if (this.factoryTracker !== null) {\n-      this.factoryTracker.track(node.getSourceFile(), analysis.factorySymbolName);\n+      this.factoryTracker.track(node.getSourceFile(), {\n+        name: analysis.factorySymbolName,\n+        hasId: !!analysis.id,\n+      });\n     }\n \n     this.injectableRegistry.registerInjectable(node);"
        },
        {
            "sha": "ec1e943c139132eccb8cf8b9e3c771b60dfed583",
            "filename": "packages/compiler-cli/src/ngtsc/shims/api.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fapi.ts?ref=2a745c8df85261004fda3e518498b6215ea295be",
            "patch": "@@ -61,10 +61,15 @@ export interface PerFileShimGenerator {\n export interface FactoryTracker {\n   readonly sourceInfo: Map<string, FactoryInfo>;\n \n-  track(sf: ts.SourceFile, factorySymbolName: string): void;\n+  track(sf: ts.SourceFile, moduleInfo: ModuleInfo): void;\n }\n \n export interface FactoryInfo {\n   sourceFilePath: string;\n-  moduleSymbolNames: Set<string>;\n-}\n\\ No newline at end of file\n+  moduleSymbols: Map<string, ModuleInfo>;\n+}\n+\n+export interface ModuleInfo {\n+  name: string;\n+  hasId: boolean;\n+}"
        },
        {
            "sha": "f9dcf6de28dc5d961d87eadaa52558f5a2462e81",
            "filename": "packages/compiler-cli/src/ngtsc/shims/src/factory_generator.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "raw_url": "https://github.com/angular/angular/raw/2a745c8df85261004fda3e518498b6215ea295be/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts?ref=2a745c8df85261004fda3e518498b6215ea295be",
            "patch": "@@ -9,7 +9,7 @@ import * as ts from 'typescript';\n \n import {absoluteFromSourceFile, AbsoluteFsPath, basename} from '../../file_system';\n import {ImportRewriter} from '../../imports';\n-import {FactoryInfo, FactoryTracker, PerFileShimGenerator} from '../api';\n+import {FactoryInfo, FactoryTracker, ModuleInfo, PerFileShimGenerator} from '../api';\n \n import {generatedModuleName} from './util';\n \n@@ -22,7 +22,7 @@ const STRIP_NG_FACTORY = /(.*)NgFactory$/;\n  */\n export class FactoryGenerator implements PerFileShimGenerator, FactoryTracker {\n   readonly sourceInfo = new Map<string, FactoryInfo>();\n-  private sourceToFactorySymbols = new Map<string, Set<string>>();\n+  private sourceToFactorySymbols = new Map<string, Map<string, ModuleInfo>>();\n \n   readonly shouldEmit = true;\n   readonly extensionPrefix = 'ngfactory';\n@@ -85,16 +85,19 @@ export class FactoryGenerator implements PerFileShimGenerator, FactoryTracker {\n       genFile.moduleName = generatedModuleName(sf.moduleName, sf.fileName, '.ngfactory');\n     }\n \n-    const moduleSymbolNames = new Set<string>();\n-    this.sourceToFactorySymbols.set(absoluteSfPath, moduleSymbolNames);\n-    this.sourceInfo.set(genFilePath, {sourceFilePath: absoluteSfPath, moduleSymbolNames});\n+    const moduleSymbols = new Map<string, ModuleInfo>();\n+    this.sourceToFactorySymbols.set(absoluteSfPath, moduleSymbols);\n+    this.sourceInfo.set(genFilePath, {\n+      sourceFilePath: absoluteSfPath,\n+      moduleSymbols,\n+    });\n \n     return genFile;\n   }\n \n-  track(sf: ts.SourceFile, factorySymbolName: string): void {\n+  track(sf: ts.SourceFile, moduleInfo: ModuleInfo): void {\n     if (this.sourceToFactorySymbols.has(sf.fileName)) {\n-      this.sourceToFactorySymbols.get(sf.fileName)!.add(factorySymbolName);\n+      this.sourceToFactorySymbols.get(sf.fileName)!.set(moduleInfo.name, moduleInfo);\n     }\n   }\n }\n@@ -123,7 +126,7 @@ function transformFactorySourceFile(\n     return file;\n   }\n \n-  const {moduleSymbolNames, sourceFilePath} = factoryMap.get(file.fileName)!;\n+  const {moduleSymbols, sourceFilePath} = factoryMap.get(file.fileName)!;\n \n   file = ts.getMutableClone(file);\n \n@@ -183,7 +186,7 @@ function transformFactorySourceFile(\n \n         // Otherwise, check if this export is a factory for a known NgModule, and retain it if so.\n         const match = STRIP_NG_FACTORY.exec(decl.name.text);\n-        if (match !== null && moduleSymbolNames.has(match[1])) {\n+        if (match !== null && moduleSymbols.has(match[1])) {\n           transformedStatements.push(stmt);\n         }\n       } else {"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 24,
        "deletions": 13
    }
}