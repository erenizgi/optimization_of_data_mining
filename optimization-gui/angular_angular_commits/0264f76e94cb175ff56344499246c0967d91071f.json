{
    "author": "kyliau",
    "message": "fix(language-service): LSParseConfigHost.resolve should not concat abs paths (#40242)\n\n`ts.server.ServerHost.resolvePath()` is different from Angular's\n`FileSystem.resolve()` because the signature of the former is\n\n```ts\nresolvePath(path: string): string;\t// ts.server.ServerHost\n```\n\nwhereas the signature of the latter is\n```ts\nresolve(...paths: string[]): AbsoluteFsPath; // FileSystem on compiler-cli\n```\n\nThe current implementation calls `path.join()` to concatenate all the input\npaths and pass the result to `ts.server.ServerHost.resolvePath()`, but doing\nso results in filenames like\n```\n/foo/bar/baz/foo/bar/baz/tsconfig.json\n```\nif both input paths are absolute.\n\n`ts.server.ServerHost` should not be used to implement the\n`resolve()` method expected by Angular's `FileSystem`.\nWe should use Node's `path.resolve()` instead, which will correctly collapse\nthe absolute paths.\n\nFix https://github.com/angular/vscode-ng-language-service/issues/1035\n\nPR Close #40242",
    "sha": "0264f76e94cb175ff56344499246c0967d91071f",
    "files": [
        {
            "sha": "958217717513c4cfda6ec5fdf0db4f793364f248",
            "filename": "packages/language-service/ivy/adapters.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0264f76e94cb175ff56344499246c0967d91071f/packages%2Flanguage-service%2Fivy%2Fadapters.ts",
            "raw_url": "https://github.com/angular/angular/raw/0264f76e94cb175ff56344499246c0967d91071f/packages%2Flanguage-service%2Fivy%2Fadapters.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fadapters.ts?ref=0264f76e94cb175ff56344499246c0967d91071f",
            "patch": "@@ -123,7 +123,7 @@ export class LSParseConfigHost implements ConfigurationHost {\n     return p.extname(path);\n   }\n   resolve(...paths: string[]): AbsoluteFsPath {\n-    return this.serverHost.resolvePath(this.join(paths[0], ...paths.slice(1))) as AbsoluteFsPath;\n+    return p.resolve(...paths) as AbsoluteFsPath;\n   }\n   dirname<T extends PathString>(file: T): T {\n     return p.dirname(file) as T;"
        },
        {
            "sha": "cd3ae1d8f9137604e0870e6192f8250290211f6d",
            "filename": "packages/language-service/ivy/test/adapters_spec.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/0264f76e94cb175ff56344499246c0967d91071f/packages%2Flanguage-service%2Fivy%2Ftest%2Fadapters_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0264f76e94cb175ff56344499246c0967d91071f/packages%2Flanguage-service%2Fivy%2Ftest%2Fadapters_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fadapters_spec.ts?ref=0264f76e94cb175ff56344499246c0967d91071f",
            "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript/lib/tsserverlibrary';\n+\n+import {LSParseConfigHost} from '../adapters';\n+\n+describe('LSParseConfigHost.resolve()', () => {\n+  it('should collapse absolute paths', () => {\n+    const p1 = '/foo/bar/baz';\n+    const p2 = '/foo/bar/baz/tsconfig.json';\n+    const host = new LSParseConfigHost(ts.sys as ts.server.ServerHost);\n+    const resolved = host.resolve(p1, p2);\n+    expect(resolved).toBe('/foo/bar/baz/tsconfig.json');\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 22,
        "deletions": 1
    }
}