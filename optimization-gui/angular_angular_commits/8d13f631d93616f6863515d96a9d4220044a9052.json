{
    "author": "petebacondarwin",
    "message": "refactor(ngcc): support processing only the typings files of packages (#40976)\n\nSome tools (such as Language Server and ng-packagr) only care about\nthe processed typings generated by ngcc. Forcing these tools to process\nthe JavaScript files as well has two disadvantages:\n\nFirst, unnecessary work is being done, which is time consuming.\n\nBut more importantly, it is not always possible to know how the final bundling\ntools will want the processed JavaScript to be configured. For example,\nthe CLI would prefer the `--create-ivy-entry-points` option but this would\nbreak non-CLI build tooling.\n\nThis commit adds a new option (`--typings-only` on the command line, and\n`typingsOnly` via programmatic API) that instructs ngcc to only render changes\nto the typings files for the entry-points that it finds, and not to write any\nJavaScript files.\n\nIn order to process the typings, a JavaScript format will need to be analysed, but\nit will not be rendered to disk. When using this option, it is best to offer ngcc a\nwide range of possible JavaScript formats to choose from, and it will use the\nfirst format that it finds. Ideally you would configure it to try the `ES2015` FESM\nformat first, since this will be the most performant.\n\nFixes #40969\n\nPR Close #40976",
    "sha": "8d13f631d93616f6863515d96a9d4220044a9052",
    "files": [
        {
            "sha": "b423d127a8c2cdc55f5943fa0d208f7973d26d0f",
            "filename": "packages/compiler-cli/ngcc/src/command_line_options.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -49,7 +49,14 @@ export function parseCommandLineOptions(args: string[]): NgccOptions {\n           })\n           .option('first-only', {\n             describe:\n-                'If specified then only the first matching package.json property will be compiled.',\n+                'If specified then only the first matching package.json property will be compiled.\\n' +\n+                'This option is overridden by `--typings-only`.',\n+            type: 'boolean',\n+          })\n+          .option('typings-only', {\n+            describe:\n+                'If specified then only the typings files are processed, and no JS source files will be modified.\\n' +\n+                'Setting this option will force `--first-only` to be set, since only one format is needed to process the typings',\n             type: 'boolean',\n           })\n           .option('create-ivy-entry-points', {\n@@ -122,6 +129,7 @@ export function parseCommandLineOptions(args: string[]): NgccOptions {\n   const propertiesToConsider = options.p;\n   const targetEntryPointPath = options.t;\n   const compileAllFormats = !options['first-only'];\n+  const typingsOnly = options['typings-only'];\n   const createNewEntryPointFormats = options['create-ivy-entry-points'];\n   const logLevel = options.l as keyof typeof LogLevel | undefined;\n   const enableI18nLegacyMessageIdFormat = options['legacy-message-ids'];\n@@ -139,6 +147,7 @@ export function parseCommandLineOptions(args: string[]): NgccOptions {\n     basePath: baseSourcePath,\n     propertiesToConsider,\n     targetEntryPointPath,\n+    typingsOnly,\n     compileAllFormats,\n     createNewEntryPointFormats,\n     logger,"
        },
        {
            "sha": "196db381b4d69889a7414c757f2cfd00e03a974f",
            "filename": "packages/compiler-cli/ngcc/src/execution/analyze_entry_points.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fanalyze_entry_points.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fanalyze_entry_points.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fanalyze_entry_points.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -19,15 +19,16 @@ import {EntryPoint, EntryPointJsonProperty, EntryPointPackageJson, SUPPORTED_FOR\n import {cleanOutdatedPackages} from '../writing/cleaning/package_cleaner';\n \n import {AnalyzeEntryPointsFn} from './api';\n-import {PartiallyOrderedTasks, TaskQueue} from './tasks/api';\n+import {DtsProcessing, PartiallyOrderedTasks, TaskQueue} from './tasks/api';\n \n /**\n  * Create the function for performing the analysis of the entry-points.\n  */\n export function getAnalyzeEntryPointsFn(\n     logger: Logger, finder: EntryPointFinder, fileSystem: FileSystem,\n-    supportedPropertiesToConsider: EntryPointJsonProperty[], compileAllFormats: boolean,\n-    propertiesToConsider: string[], inParallel: boolean): AnalyzeEntryPointsFn {\n+    supportedPropertiesToConsider: EntryPointJsonProperty[], typingsOnly: boolean,\n+    compileAllFormats: boolean, propertiesToConsider: string[],\n+    inParallel: boolean): AnalyzeEntryPointsFn {\n   return () => {\n     logger.debug('Analyzing entry-points...');\n     const startTime = Date.now();\n@@ -49,9 +50,10 @@ export function getAnalyzeEntryPointsFn(\n     for (const entryPoint of entryPoints) {\n       const packageJson = entryPoint.packageJson;\n       const hasProcessedTypings = hasBeenProcessed(packageJson, 'typings');\n-      const {propertiesToProcess, equivalentPropertiesMap} =\n-          getPropertiesToProcess(packageJson, supportedPropertiesToConsider, compileAllFormats);\n-      let processDts = !hasProcessedTypings;\n+      const {propertiesToProcess, equivalentPropertiesMap} = getPropertiesToProcess(\n+          packageJson, supportedPropertiesToConsider, compileAllFormats, typingsOnly);\n+      let processDts = hasProcessedTypings ? DtsProcessing.No :\n+                                             typingsOnly ? DtsProcessing.Only : DtsProcessing.Yes;\n \n       if (propertiesToProcess.length === 0) {\n         // This entry-point is unprocessable (i.e. there is no format property that is of interest\n@@ -73,7 +75,7 @@ export function getAnalyzeEntryPointsFn(\n         tasks.push({entryPoint, formatProperty, formatPropertiesToMarkAsProcessed, processDts});\n \n         // Only process typings for the first property (if not already processed).\n-        processDts = false;\n+        processDts = DtsProcessing.No;\n       }\n     }\n \n@@ -114,7 +116,7 @@ function logInvalidEntryPoints(logger: Logger, invalidEntryPoints: InvalidEntryP\n  */\n function getPropertiesToProcess(\n     packageJson: EntryPointPackageJson, propertiesToConsider: EntryPointJsonProperty[],\n-    compileAllFormats: boolean): {\n+    compileAllFormats: boolean, typingsOnly: boolean): {\n   propertiesToProcess: EntryPointJsonProperty[];\n   equivalentPropertiesMap: Map<EntryPointJsonProperty, EntryPointJsonProperty[]>;\n } {\n@@ -156,7 +158,8 @@ function getPropertiesToProcess(\n   const equivalentPropertiesMap = new Map<EntryPointJsonProperty, EntryPointJsonProperty[]>();\n   for (const prop of propertiesToConsider) {\n     const formatPath = packageJson[prop]!;\n-    const equivalentProperties = formatPathToProperties[formatPath];\n+    // If we are only processing typings then there should be no format properties to mark\n+    const equivalentProperties = typingsOnly ? [] : formatPathToProperties[formatPath];\n     equivalentPropertiesMap.set(prop, equivalentProperties);\n   }\n "
        },
        {
            "sha": "3185a6ff852a6650476615b61d91c158c60f45b0",
            "filename": "packages/compiler-cli/ngcc/src/execution/tasks/api.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fapi.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -32,8 +32,30 @@ export interface Task extends JsonObject {\n    */\n   formatPropertiesToMarkAsProcessed: EntryPointJsonProperty[];\n \n-  /** Whether to also process typings for this entry-point as part of the task. */\n-  processDts: boolean;\n+  /**\n+   * Whether to process typings for this entry-point as part of the task.\n+   */\n+  processDts: DtsProcessing;\n+}\n+\n+/**\n+ * The options for processing Typescript typings (.d.ts) files.\n+ */\n+export enum DtsProcessing {\n+  /**\n+   * Yes, process the typings for this entry point as part of the task.\n+   */\n+  Yes,\n+  /**\n+   * No, do not process the typings as part of this task - they must have already been processed by\n+   * another task or previous ngcc process.\n+   */\n+  No,\n+  /**\n+   * Only process the typings for this entry-point; do not render any JavaScript files for the\n+   * `formatProperty` of this task.\n+   */\n+  Only,\n }\n \n /**"
        },
        {
            "sha": "b984561b28d8edbc5dee3c0fb95c3f6891f96d2a",
            "filename": "packages/compiler-cli/ngcc/src/execution/tasks/completion.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -11,7 +11,7 @@ import {markAsProcessed} from '../../packages/build_marker';\n import {getEntryPointFormat, PackageJsonFormatProperties} from '../../packages/entry_point';\n import {PackageJsonUpdater} from '../../writing/package_json_updater';\n \n-import {Task, TaskCompletedCallback, TaskProcessingOutcome, TaskQueue} from './api';\n+import {DtsProcessing, Task, TaskCompletedCallback, TaskProcessingOutcome, TaskQueue} from './api';\n \n /**\n  * A function that can handle a specific outcome of a task completion.\n@@ -53,7 +53,7 @@ export function createMarkAsProcessedHandler(\n     const packageJsonPath = fs.resolve(entryPoint.path, 'package.json');\n     const propsToMarkAsProcessed: PackageJsonFormatProperties[] =\n         [...formatPropertiesToMarkAsProcessed];\n-    if (processDts) {\n+    if (processDts !== DtsProcessing.No) {\n       propsToMarkAsProcessed.push('typings');\n     }\n     markAsProcessed(\n@@ -66,11 +66,7 @@ export function createMarkAsProcessedHandler(\n  */\n export function createThrowErrorHandler(fs: ReadonlyFileSystem): TaskCompletedHandler {\n   return (task: Task, message: string|null): void => {\n-    const format = getEntryPointFormat(fs, task.entryPoint, task.formatProperty);\n-    throw new Error(\n-        `Failed to compile entry-point ${task.entryPoint.name} (${task.formatProperty} as ${\n-            format})` +\n-        (message !== null ? ` due to ${message}` : ''));\n+    throw new Error(createErrorMessage(fs, task, message));\n   };\n }\n \n@@ -81,10 +77,14 @@ export function createLogErrorHandler(\n     logger: Logger, fs: ReadonlyFileSystem, taskQueue: TaskQueue): TaskCompletedHandler {\n   return (task: Task, message: string|null): void => {\n     taskQueue.markAsFailed(task);\n-    const format = getEntryPointFormat(fs, task.entryPoint, task.formatProperty);\n-    logger.error(\n-        `Failed to compile entry-point ${task.entryPoint.name} (${task.formatProperty} as ${\n-            format})` +\n-        (message !== null ? ` due to ${message}` : ''));\n+    logger.error(createErrorMessage(fs, task, message));\n   };\n }\n+\n+function createErrorMessage(fs: ReadonlyFileSystem, task: Task, message: string|null): string {\n+  const jsFormat =\n+      `${task.formatProperty} as ${getEntryPointFormat(fs, task.entryPoint, task.formatProperty)}`;\n+  const format = task.typingsOnly ? `typings only using ${jsFormat}` : jsFormat;\n+  message = message !== null ? ` due to ${message}` : '';\n+  return `Failed to compile entry-point ${task.entryPoint.name} (${format})` + message;\n+}"
        },
        {
            "sha": "3ea7a8a7ea16138a6b7212e6d8cb0a2a12848aea",
            "filename": "packages/compiler-cli/ngcc/src/execution/tasks/utils.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Futils.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -7,11 +7,12 @@\n  */\n import {DepGraph} from 'dependency-graph';\n import {EntryPoint} from '../../packages/entry_point';\n-import {PartiallyOrderedTasks, Task, TaskDependencies} from './api';\n+import {DtsProcessing, PartiallyOrderedTasks, Task, TaskDependencies} from './api';\n \n /** Stringify a task for debugging purposes. */\n-export const stringifyTask = (task: Task): string => `{entryPoint: ${\n-    task.entryPoint.name}, formatProperty: ${task.formatProperty}, processDts: ${task.processDts}}`;\n+export const stringifyTask = (task: Task): string =>\n+    `{entryPoint: ${task.entryPoint.name}, formatProperty: ${task.formatProperty}, ` +\n+    `processDts: ${DtsProcessing[task.processDts]}}`;\n \n /**\n  * Compute a mapping of tasks to the tasks that are dependent on them (if any).\n@@ -55,7 +56,7 @@ export function computeTaskDependencies(\n       }\n     }\n \n-    if (task.processDts) {\n+    if (task.processDts !== DtsProcessing.No) {\n       // SANITY CHECK:\n       // There should only be one task per entry-point that generates typings (and thus can be a\n       // dependency of other tasks), so the following should theoretically never happen, but check"
        },
        {
            "sha": "99f155ee92eed9dc2a488e526b070b7c2a014298",
            "filename": "packages/compiler-cli/ngcc/src/main.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -56,6 +56,7 @@ export function mainNgcc(options: AsyncNgccOptions|SyncNgccOptions): void|Promis\n     basePath,\n     targetEntryPointPath,\n     propertiesToConsider,\n+    typingsOnly,\n     compileAllFormats,\n     logger,\n     pathMappings,\n@@ -96,7 +97,7 @@ export function mainNgcc(options: AsyncNgccOptions|SyncNgccOptions): void|Promis\n   const inParallel = workerCount > 1;\n \n   const analyzeEntryPoints = getAnalyzeEntryPointsFn(\n-      logger, finder, fileSystem, supportedPropertiesToConsider, compileAllFormats,\n+      logger, finder, fileSystem, supportedPropertiesToConsider, typingsOnly, compileAllFormats,\n       propertiesToConsider, inParallel);\n \n   // Create an updater that will actually write to disk."
        },
        {
            "sha": "7acc6373606e12f60f1184502503dd4bedbeda15",
            "filename": "packages/compiler-cli/ngcc/src/ngcc_options.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -42,9 +42,21 @@ export interface SyncNgccOptions {\n    */\n   propertiesToConsider?: string[];\n \n+  /**\n+   * Whether to only process the typings files for this entry-point.\n+   *\n+   * This is useful when running ngcc only to provide typings files to downstream tooling such as\n+   * the Angular Language Service or ng-packagr. Defaults to `false`.\n+   *\n+   * If this is set to `true` then `compileAllFormats` is forced to `false`.\n+   */\n+  typingsOnly?: boolean;\n+\n   /**\n    * Whether to process all formats specified by (`propertiesToConsider`)  or to stop processing\n-   * this entry-point at the first matching format. Defaults to `true`.\n+   * this entry-point at the first matching format.\n+   *\n+   * Defaults to `true`, but is forced to `false` if `typingsOnly` is `true`.\n    */\n   compileAllFormats?: boolean;\n \n@@ -172,6 +184,7 @@ export function getSharedSetup(options: NgccOptions): SharedSetup&RequiredNgccOp\n     basePath,\n     targetEntryPointPath,\n     propertiesToConsider = SUPPORTED_FORMAT_PROPERTIES,\n+    typingsOnly = false,\n     compileAllFormats = true,\n     createNewEntryPointFormats = false,\n     logger = new ConsoleLogger(LogLevel.info),\n@@ -188,12 +201,19 @@ export function getSharedSetup(options: NgccOptions): SharedSetup&RequiredNgccOp\n     errorOnFailedEntryPoint = true;\n   }\n \n+  if (typingsOnly) {\n+    // If we only want to process the typings then we do not want to waste time trying to process\n+    // multiple JS formats.\n+    compileAllFormats = false;\n+  }\n+\n   checkForSolutionStyleTsConfig(fileSystem, logger, projectPath, options.tsConfigPath, tsConfig);\n \n   return {\n     basePath,\n     targetEntryPointPath,\n     propertiesToConsider,\n+    typingsOnly,\n     compileAllFormats,\n     createNewEntryPointFormats,\n     logger,"
        },
        {
            "sha": "25fffcf41cd76e341b8a5ae3061feac82be73222",
            "filename": "packages/compiler-cli/ngcc/src/packages/entry_point_bundle.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -7,6 +7,7 @@\n  */\n import * as ts from 'typescript';\n import {AbsoluteFsPath, FileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n+import {DtsProcessing} from '../execution/tasks/api';\n import {PathMappings} from '../path_mappings';\n import {BundleProgram, makeBundleProgram} from './bundle_program';\n import {EntryPoint, EntryPointFormat} from './entry_point';\n@@ -25,6 +26,7 @@ export interface EntryPointBundle {\n   rootDirs: AbsoluteFsPath[];\n   src: BundleProgram;\n   dts: BundleProgram|null;\n+  dtsProcessing: DtsProcessing;\n   enableI18nLegacyMessageIdFormat: boolean;\n }\n \n@@ -37,7 +39,7 @@ export interface EntryPointBundle {\n  * @param formatPath The path to the source files for this bundle.\n  * @param isCore This entry point is the Angular core package.\n  * @param format The underlying format of the bundle.\n- * @param transformDts Whether to transform the typings along with this bundle.\n+ * @param dtsProcessing Whether to transform the typings along with this bundle.\n  * @param pathMappings An optional set of mappings to use when compiling files.\n  * @param mirrorDtsFromSrc If true then the `dts` program will contain additional files that\n  * were guessed by mapping the `src` files to `dts` files.\n@@ -47,7 +49,7 @@ export interface EntryPointBundle {\n export function makeEntryPointBundle(\n     fs: FileSystem, entryPoint: EntryPoint, sharedFileCache: SharedFileCache,\n     moduleResolutionCache: ts.ModuleResolutionCache, formatPath: string, isCore: boolean,\n-    format: EntryPointFormat, transformDts: boolean, pathMappings?: PathMappings,\n+    format: EntryPointFormat, dtsProcessing: DtsProcessing, pathMappings?: PathMappings,\n     mirrorDtsFromSrc: boolean = false,\n     enableI18nLegacyMessageIdFormat: boolean = true): EntryPointBundle {\n   // Create the TS program and necessary helpers.\n@@ -64,13 +66,14 @@ export function makeEntryPointBundle(\n   const typingsPath = fs.resolve(entryPoint.path, entryPoint.typings);\n   const src = makeBundleProgram(\n       fs, isCore, entryPoint.packagePath, absFormatPath, 'r3_symbols.js', options, srcHost);\n-  const additionalDtsFiles = transformDts && mirrorDtsFromSrc ?\n+  const additionalDtsFiles = dtsProcessing !== DtsProcessing.No && mirrorDtsFromSrc ?\n       computePotentialDtsFilesFromJsFiles(fs, src.program, absFormatPath, typingsPath) :\n       [];\n-  const dts = transformDts ? makeBundleProgram(\n-                                 fs, isCore, entryPoint.packagePath, typingsPath, 'r3_symbols.d.ts',\n-                                 {...options, allowJs: false}, dtsHost, additionalDtsFiles) :\n-                             null;\n+  const dts = dtsProcessing !== DtsProcessing.No ?\n+      makeBundleProgram(\n+          fs, isCore, entryPoint.packagePath, typingsPath, 'r3_symbols.d.ts',\n+          {...options, allowJs: false}, dtsHost, additionalDtsFiles) :\n+      null;\n   const isFlatCore = isCore && src.r3SymbolsFile === null;\n \n   return {\n@@ -81,6 +84,7 @@ export function makeEntryPointBundle(\n     isFlatCore,\n     src,\n     dts,\n+    dtsProcessing,\n     enableI18nLegacyMessageIdFormat\n   };\n }"
        },
        {
            "sha": "78aa506c02d4d5151355a01683f0f7879406d298",
            "filename": "packages/compiler-cli/ngcc/src/packages/transformer.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -17,6 +17,7 @@ import {NgccReferencesRegistry} from '../analysis/ngcc_references_registry';\n import {ExportInfo, PrivateDeclarationsAnalyzer} from '../analysis/private_declarations_analyzer';\n import {SwitchMarkerAnalyses, SwitchMarkerAnalyzer} from '../analysis/switch_marker_analyzer';\n import {CompiledFile} from '../analysis/types';\n+import {DtsProcessing} from '../execution/tasks/api';\n import {CommonJsReflectionHost} from '../host/commonjs_host';\n import {DelegatingReflectionHost} from '../host/delegating_host';\n import {Esm2015ReflectionHost} from '../host/esm2015_host';\n@@ -92,12 +93,16 @@ export class Transformer {\n     }\n \n     // Transform the source files and source maps.\n-    const srcFormatter = this.getRenderingFormatter(ngccReflectionHost, bundle);\n-\n-    const renderer =\n-        new Renderer(reflectionHost, srcFormatter, this.fs, this.logger, bundle, this.tsConfig);\n-    let renderedFiles = renderer.renderProgram(\n-        decorationAnalyses, switchMarkerAnalyses, privateDeclarationsAnalyses);\n+    let renderedFiles: FileToWrite[] = [];\n+\n+    if (bundle.dtsProcessing !== DtsProcessing.Only) {\n+      // Render the transformed JavaScript files only if we are not doing \"typings-only\" processing.\n+      const srcFormatter = this.getRenderingFormatter(ngccReflectionHost, bundle);\n+      const renderer =\n+          new Renderer(reflectionHost, srcFormatter, this.fs, this.logger, bundle, this.tsConfig);\n+      renderedFiles = renderer.renderProgram(\n+          decorationAnalyses, switchMarkerAnalyses, privateDeclarationsAnalyses);\n+    }\n \n     if (bundle.dts) {\n       const dtsFormatter = new EsmRenderingFormatter(this.fs, reflectionHost, bundle.isCore);"
        },
        {
            "sha": "359beb7ab54127f7eb343435727c3a0576257e7e",
            "filename": "packages/compiler-cli/ngcc/test/execution/cluster/worker_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fcluster%2Fworker_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fcluster%2Fworker_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fcluster%2Fworker_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -15,7 +15,7 @@ import {AbsoluteFsPath} from '../../../../src/ngtsc/file_system';\n import {MockLogger} from '../../../../src/ngtsc/logging/testing';\n import {CreateCompileFn} from '../../../src/execution/api';\n import {startWorker} from '../../../src/execution/cluster/worker';\n-import {Task, TaskCompletedCallback, TaskProcessingOutcome} from '../../../src/execution/tasks/api';\n+import {DtsProcessing, Task, TaskCompletedCallback, TaskProcessingOutcome} from '../../../src/execution/tasks/api';\n import {FileToWrite} from '../../../src/rendering/utils';\n import {mockProperty, spyProperty} from '../../helpers/spy_utils';\n \n@@ -124,7 +124,7 @@ describe('startWorker()', () => {\n       const mockTask = {\n         entryPoint: {name: 'foo'},\n         formatProperty: 'es2015',\n-        processDts: true,\n+        processDts: DtsProcessing.Yes,\n       } as unknown as Task;\n \n       startWorker(mockLogger, createCompileFnSpy);\n@@ -134,15 +134,15 @@ describe('startWorker()', () => {\n       expect(processSendSpy).not.toHaveBeenCalled();\n \n       expect(mockLogger.logs.debug[0]).toEqual([\n-        '[Worker #42] Processing task: {entryPoint: foo, formatProperty: es2015, processDts: true}',\n+        '[Worker #42] Processing task: {entryPoint: foo, formatProperty: es2015, processDts: Yes}',\n       ]);\n     });\n \n     it('should send errors during task processing back to the master process', () => {\n       const mockTask = {\n         entryPoint: {name: 'foo'},\n         formatProperty: 'es2015',\n-        processDts: true,\n+        processDts: DtsProcessing.Yes,\n       } as unknown as Task;\n \n       let err: string|Error;\n@@ -178,7 +178,7 @@ describe('startWorker()', () => {\n         const mockTask = {\n           entryPoint: {name: 'foo'},\n           formatProperty: 'es2015',\n-          processDts: true,\n+          processDts: DtsProcessing.Yes,\n         } as unknown as Task;\n \n         const noMemError = Object.assign(new Error('ENOMEM: not enough memory'), {code: 'ENOMEM'});"
        },
        {
            "sha": "f01537a6a0533c71f769f0f92b287e2f42be05ff",
            "filename": "packages/compiler-cli/ngcc/test/execution/helpers.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fhelpers.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fhelpers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Fhelpers.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {DepGraph} from 'dependency-graph';\n-import {PartiallyOrderedTasks, Task} from '../../src/execution/tasks/api';\n+import {DtsProcessing, PartiallyOrderedTasks, Task} from '../../src/execution/tasks/api';\n import {EntryPoint} from '../../src/packages/entry_point';\n \n /**\n@@ -52,7 +52,8 @@ export function createTasksAndGraph(\n     graph.addNode(entryPoint.path);\n \n     for (let tIdx = 0; tIdx < tasksPerEntryPointCount; tIdx++) {\n-      tasks.push({entryPoint, formatProperty: `prop-${tIdx}`, processDts: tIdx === 0} as Task);\n+      const processDts = tIdx === 0 ? DtsProcessing.Yes : DtsProcessing.No;\n+      tasks.push({entryPoint, formatProperty: `prop-${tIdx}`, processDts} as Task);\n     }\n   }\n "
        },
        {
            "sha": "30f466602b92c94b5b5358bb43d17d821fcf94f4",
            "filename": "packages/compiler-cli/ngcc/test/execution/tasks/queues/parallel_task_queue_spec.ts",
            "status": "modified",
            "additions": 53,
            "deletions": 53,
            "changes": 106,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fparallel_task_queue_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fparallel_task_queue_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fparallel_task_queue_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {MockLogger} from '../../../../../src/ngtsc/logging/testing';\n-import {PartiallyOrderedTasks, TaskQueue} from '../../../../src/execution/tasks/api';\n+import {DtsProcessing, PartiallyOrderedTasks, TaskQueue} from '../../../../src/execution/tasks/api';\n import {ParallelTaskQueue} from '../../../../src/execution/tasks/queues/parallel_task_queue';\n import {computeTaskDependencies} from '../../../../src/execution/tasks/utils';\n import {createTasksAndGraph} from '../../helpers';\n@@ -141,9 +141,9 @@ describe('ParallelTaskQueue', () => {\n \n       // Verify that the first two tasks are for the first entry-point.\n       expect(tasks[0].entryPoint.name).toBe('entry-point-0');\n-      expect(tasks[0].processDts).toBe(true);\n+      expect(tasks[0].processDts).toBe(DtsProcessing.Yes);\n       expect(tasks[1].entryPoint.name).toBe('entry-point-0');\n-      expect(tasks[1].processDts).toBe(false);\n+      expect(tasks[1].processDts).toBe(DtsProcessing.No);\n \n       // Verify that the last two tasks are for the second entry-point.\n       expect(tasks[2].entryPoint.name).toBe('entry-point-1');\n@@ -282,7 +282,7 @@ describe('ParallelTaskQueue', () => {\n       expect(() => queue.markAsCompleted(tasks[2]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as completed: ` +\n-              `{entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}`);\n+              `{entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}`);\n     });\n \n     it('should remove the completed task from the lists of blocking tasks (so other tasks can be unblocked)',\n@@ -340,13 +340,13 @@ describe('ParallelTaskQueue', () => {\n       expect(() => queue.markAsUnprocessed(tasks[0]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as unprocessed: ` +\n-              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}`);\n+              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}`);\n \n       // Try with a task that is not yet started.\n       expect(() => queue.markAsUnprocessed(tasks[2]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as unprocessed: ` +\n-              `{entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}`);\n+              `{entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}`);\n     });\n \n     it('should not remove the unprocessed task from the lists of blocking tasks', () => {\n@@ -399,23 +399,23 @@ describe('ParallelTaskQueue', () => {\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (3): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n');\n \n       const task1 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (2): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task1);\n       const task2 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task2);\n       processNextTask(queue);\n@@ -430,14 +430,14 @@ describe('ParallelTaskQueue', () => {\n       expect(queue.toString())\n           .toContain(\n               '  In-progress tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task1);\n       const task2 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  In-progress tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task2);\n       processNextTask(queue);\n@@ -463,53 +463,53 @@ describe('ParallelTaskQueue', () => {\n           .toContain(\n               '  Blocked tasks (6): \\n' +\n               // #0.1 blocked by its typings #0.0\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-1, processDts: false} (1): \\n' +\n-              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-1, processDts: No} (1): \\n' +\n+              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #1.0 blocked by #0.0\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true} (1): \\n' +\n-              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes} (1): \\n' +\n+              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #1.1 blocked by #0.0 and its typings #1.0\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false} (2): \\n' +\n-              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No} (2): \\n' +\n+              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #3.0 blocked by #0.0 (transitively), #1.0 and #2.0.\n-              '    - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: true} (3): \\n' +\n-              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: Yes} (3): \\n' +\n+              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #3.1 blocked by #0.0 (transitively), #1.0 and #2.0, and its typings #3.0\n-              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: false} (4): \\n' +\n-              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: No} (4): \\n' +\n+              '        - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #2.1 blocked by its typings #2.0\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-1, processDts: false} (1): \\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-1, processDts: No} (1): \\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}');\n \n       expect(processNextTask(queue)).toBe(tasks[0]);  // Process #0.0.\n       expect(processNextTask(queue)).toBe(tasks[2]);  // Process #1.0.\n       expect(queue.toString())\n           .toContain(\n               '  Blocked tasks (3): \\n' +\n               // #3.0 blocked by #2.0.\n-              '    - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: true} (1): \\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: Yes} (1): \\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #3.1 blocked by #2.0 and its typings #3.0\n-              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: false} (2): \\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n-              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: No} (2): \\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: Yes}\\n' +\n               // #2.1 blocked by its typings #2.0\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-1, processDts: false} (1): \\n' +\n-              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-1, processDts: No} (1): \\n' +\n+              '        - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}');\n \n       expect(processNextTask(queue)).toBe(tasks[4]);  // Process #2.0.\n       expect(queue.toString())\n           .toContain(\n               '  Blocked tasks (1): \\n' +\n               // #3.1 blocked by its typings #3.0\n-              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: false} (1): \\n' +\n-              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-3, formatProperty: prop-1, processDts: No} (1): \\n' +\n+              '        - {entryPoint: entry-point-3, formatProperty: prop-0, processDts: Yes}');\n       expect(processNextTask(queue)).toBe(tasks[6]);  // Process #3.0.\n       expect(queue.toString()).toContain('  Blocked tasks (0): ');\n     });\n@@ -532,13 +532,13 @@ describe('ParallelTaskQueue', () => {\n               'ParallelTaskQueue\\n' +\n               '  All tasks completed: false\\n' +\n               '  Unprocessed tasks (3): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n               '  In-progress tasks (0): \\n' +\n               '  Blocked tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true} (1): \\n' +\n-              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes} (1): \\n' +\n+              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}');\n \n       // Start processing tasks #1 and #0 (#2 is still blocked on #1).\n       expect(queue2.getNextTask()).toBe(tasks2[1]);\n@@ -548,13 +548,13 @@ describe('ParallelTaskQueue', () => {\n               'ParallelTaskQueue\\n' +\n               '  All tasks completed: false\\n' +\n               '  Unprocessed tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n               '  In-progress tasks (2): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n               '  Blocked tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true} (1): \\n' +\n-              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes} (1): \\n' +\n+              '        - {entryPoint: entry-point-1, formatProperty: prop-0, processDts: Yes}');\n \n       // Complete task #1 nd start processing #2 (which is not unblocked).\n       queue2.markAsCompleted(tasks2[1]);\n@@ -565,8 +565,8 @@ describe('ParallelTaskQueue', () => {\n               '  All tasks completed: false\\n' +\n               '  Unprocessed tasks (0): \\n' +\n               '  In-progress tasks (2): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-0, processDts: Yes}\\n' +\n               '  Blocked tasks (0): ');\n \n       // Complete tasks #2 and #0. All tasks are now completed."
        },
        {
            "sha": "85b8b63031852071adbf69411aeb1bf452ba1b22",
            "filename": "packages/compiler-cli/ngcc/test/execution/tasks/queues/serial_task_queue_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fserial_task_queue_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fserial_task_queue_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Ftasks%2Fqueues%2Fserial_task_queue_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -8,7 +8,7 @@\n import {DepGraph} from 'dependency-graph';\n \n import {MockLogger} from '../../../../../src/ngtsc/logging/testing';\n-import {PartiallyOrderedTasks, Task, TaskQueue} from '../../../../src/execution/tasks/api';\n+import {DtsProcessing, PartiallyOrderedTasks, Task, TaskQueue} from '../../../../src/execution/tasks/api';\n import {SerialTaskQueue} from '../../../../src/execution/tasks/queues/serial_task_queue';\n import {computeTaskDependencies} from '../../../../src/execution/tasks/utils';\n import {EntryPoint} from '../../../../src/packages/entry_point';\n@@ -32,8 +32,8 @@ describe('SerialTaskQueue', () => {\n     for (let i = 0; i < taskCount; i++) {\n       const entryPoint = {name: `entry-point-${i}`, path: `/path/to/entry/point/${i}`} as\n           EntryPoint;\n-      tasks.push(\n-          {entryPoint: entryPoint, formatProperty: `prop-${i}`, processDts: i % 2 === 0} as Task);\n+      const processDts = i % 2 === 0 ? DtsProcessing.Yes : DtsProcessing.No;\n+      tasks.push({entryPoint: entryPoint, formatProperty: `prop-${i}`, processDts} as Task);\n       graph.addNode(entryPoint.path);\n     }\n     const dependencies = computeTaskDependencies(tasks, graph);\n@@ -131,7 +131,7 @@ describe('SerialTaskQueue', () => {\n       expect(() => queue.getNextTask())\n           .toThrowError(\n               `Trying to get next task, while there is already a task in progress: ` +\n-              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}`);\n+              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}`);\n     });\n   });\n \n@@ -153,7 +153,7 @@ describe('SerialTaskQueue', () => {\n       expect(() => queue.markAsCompleted(tasks[2]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as completed: ` +\n-              `{entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}`);\n+              `{entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}`);\n     });\n   });\n \n@@ -177,13 +177,13 @@ describe('SerialTaskQueue', () => {\n       expect(() => queue.markAsUnprocessed(tasks[0]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as unprocessed: ` +\n-              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}`);\n+              `{entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}`);\n \n       // Try with a task that is not yet started.\n       expect(() => queue.markAsUnprocessed(tasks[2]))\n           .toThrowError(\n               `Trying to mark task that was not in progress as unprocessed: ` +\n-              `{entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}`);\n+              `{entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}`);\n     });\n   });\n \n@@ -215,23 +215,23 @@ describe('SerialTaskQueue', () => {\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (3): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}\\n');\n \n       const task1 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (2): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task1);\n       const task2 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  Unprocessed tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}\\n');\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}\\n');\n \n       queue.markAsCompleted(task2);\n       processNextTask(queue);\n@@ -246,14 +246,14 @@ describe('SerialTaskQueue', () => {\n       expect(queue.toString())\n           .toContain(\n               '  In-progress tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}');\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}');\n \n       queue.markAsCompleted(task1);\n       const task2 = queue.getNextTask()!;\n       expect(queue.toString())\n           .toContain(\n               '  In-progress tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false}');\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No}');\n \n       queue.markAsCompleted(task2);\n       processNextTask(queue);\n@@ -275,9 +275,9 @@ describe('SerialTaskQueue', () => {\n               'SerialTaskQueue\\n' +\n               '  All tasks completed: false\\n' +\n               '  Unprocessed tasks (3): \\n' +\n-              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false}\\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}\\n' +\n               '  In-progress tasks (0): ');\n \n       processNextTask(queue2);\n@@ -287,9 +287,9 @@ describe('SerialTaskQueue', () => {\n               'SerialTaskQueue\\n' +\n               '  All tasks completed: false\\n' +\n               '  Unprocessed tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: true}\\n' +\n+              '    - {entryPoint: entry-point-2, formatProperty: prop-2, processDts: Yes}\\n' +\n               '  In-progress tasks (1): \\n' +\n-              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: false}');\n+              '    - {entryPoint: entry-point-1, formatProperty: prop-1, processDts: No}');\n \n       queue2.markAsCompleted(task);\n       processNextTask(queue2);"
        },
        {
            "sha": "a50684e663faaab1165a866e8a378ec5f08a3be2",
            "filename": "packages/compiler-cli/ngcc/test/execution/utils_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Futils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Futils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fexecution%2Futils_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -5,6 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {DtsProcessing} from '../../src/execution/tasks/api';\n import {computeTaskDependencies, sortTasksByPriority} from '../../src/execution/tasks/utils';\n import {createTasksAndGraph} from './helpers';\n \n@@ -16,14 +17,14 @@ describe('execution utils', () => {\n            0: [],   // Entry-point #0 does not depend on anything.\n            1: [0],  // Entry-point #1 depends on #0.\n          });\n-         tasks[1].processDts = true;  // Tweak task #1 to also generate typings.\n+         tasks[1].processDts = DtsProcessing.Yes;  // Tweak task #1 to also generate typings.\n \n          expect(() => computeTaskDependencies(tasks, graph))\n              .toThrowError(\n                  'Invariant violated: Multiple tasks are assigned generating typings for ' +\n                  '\\'/path/to/entry/point/0\\':\\n' +\n-                 '  - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: true}\\n' +\n-                 '  - {entryPoint: entry-point-0, formatProperty: prop-1, processDts: true}');\n+                 '  - {entryPoint: entry-point-0, formatProperty: prop-0, processDts: Yes}\\n' +\n+                 '  - {entryPoint: entry-point-0, formatProperty: prop-1, processDts: Yes}');\n        });\n \n     it('should add non-typings tasks to the dependents of typings tasks', () => {"
        },
        {
            "sha": "6ddd8a0ef94fca0f8421b86e87ea33c6b858d088",
            "filename": "packages/compiler-cli/ngcc/test/helpers/utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Futils.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -9,6 +9,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom, AbsoluteFsPath, getFileSystem, NgtscCompilerHost} from '../../../src/ngtsc/file_system';\n import {TestFile} from '../../../src/ngtsc/file_system/testing';\n+import {DtsProcessing} from '../../src/execution/tasks/api';\n import {BundleProgram, makeBundleProgram} from '../../src/packages/bundle_program';\n import {NgccEntryPointConfig} from '../../src/packages/configuration';\n import {EntryPoint, EntryPointFormat} from '../../src/packages/entry_point';\n@@ -55,6 +56,7 @@ export function makeTestEntryPointBundle(\n     rootDirs: [absoluteFrom('/')],\n     src,\n     dts,\n+    dtsProcessing: dtsRootNames ? DtsProcessing.Yes : DtsProcessing.No,\n     isCore,\n     isFlatCore,\n     enableI18nLegacyMessageIdFormat"
        },
        {
            "sha": "7036b11f1ddb2e1262dc6bc07e41313f6669f79e",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 87,
            "deletions": 1,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -25,6 +25,7 @@ import {DirectPackageJsonUpdater, PackageJsonUpdater} from '../../src/writing/pa\n \n import {compileIntoApf, compileIntoFlatEs2015Package, compileIntoFlatEs5Package} from './util';\n \n+const ANGULAR_CORE_IMPORT_REGEX = /import \\* as ngcc\\d+ from '@angular\\/core';/;\n const testFiles = loadStandardTestFiles({fakeCore: false, rxjs: true});\n \n runInEachFileSystem(() => {\n@@ -1240,9 +1241,94 @@ runInEachFileSystem(() => {\n          });\n     });\n \n+    describe('with typingsOnly set to true', () => {\n+      it('should only compile the typings', () => {\n+        mainNgcc({\n+          basePath: '/node_modules',\n+          propertiesToConsider: ['module', 'fesm2015', 'main'],\n+          typingsOnly: true,\n+          compileAllFormats: true,\n+          logger: new MockLogger(),\n+        });\n+        expect(loadPackage('@angular/core').__processed_by_ivy_ngcc__).toEqual({\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+        expect(loadPackage('@angular/common').__processed_by_ivy_ngcc__).toEqual({\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+        expect(loadPackage('@angular/common/testing').__processed_by_ivy_ngcc__).toEqual({\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+        expect(loadPackage('@angular/common/http').__processed_by_ivy_ngcc__).toEqual({\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+\n+        // Doesn't touch original source files\n+        expect(fs.readFile(_(`/node_modules/@angular/common/esm2015/src/common_module.js`)))\n+            .not.toMatch(ANGULAR_CORE_IMPORT_REGEX);\n+        // Or create a backup of the original\n+        expect(fs.exists(\n+                   _(`/node_modules/@angular/common/esm2015/src/common_module.js.__ivy_ngcc_bak`)))\n+            .toBe(false);\n+\n+        // Overwrites .d.ts files\n+        expect(fs.readFile(_(`/node_modules/@angular/common/common.d.ts`)))\n+            .toMatch(ANGULAR_CORE_IMPORT_REGEX);\n+        // And makes a backup\n+        expect(fs.exists(_(`/node_modules/@angular/common/common.d.ts.__ivy_ngcc_bak`))).toBe(true);\n+      });\n+\n+      it('should cope with compiling the same entry-point multiple times with different formats',\n+         () => {\n+           mainNgcc({\n+             basePath: '/node_modules',\n+             propertiesToConsider: ['main'],\n+             typingsOnly: true,\n+             logger: new MockLogger(),\n+           });\n+           expect(loadPackage('@angular/core').__processed_by_ivy_ngcc__).toEqual({\n+             typings: '0.0.0-PLACEHOLDER',\n+           });\n+\n+           // If ngcc tries to write out the typings files again, this will throw an exception.\n+           mainNgcc({\n+             basePath: '/node_modules',\n+             propertiesToConsider: ['esm2015'],\n+             typingsOnly: true,\n+             logger: new MockLogger(),\n+           });\n+           expect(loadPackage('@angular/core').__processed_by_ivy_ngcc__).toEqual({\n+             typings: '0.0.0-PLACEHOLDER',\n+           });\n+         });\n+\n+      it('should cope with compiling typings only followed by javascript formats', () => {\n+        mainNgcc({\n+          basePath: '/node_modules',\n+          propertiesToConsider: ['esm2015', 'main'],\n+          typingsOnly: true,\n+          logger: new MockLogger(),\n+        });\n+        expect(loadPackage('@angular/core').__processed_by_ivy_ngcc__).toEqual({\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+\n+        // If ngcc tries to write out the typings files again, this will throw an exception.\n+        mainNgcc({\n+          basePath: '/node_modules',\n+          propertiesToConsider: ['esm2015', 'main'],\n+          logger: new MockLogger(),\n+        });\n+        expect(loadPackage('@angular/core').__processed_by_ivy_ngcc__).toEqual({\n+          main: '0.0.0-PLACEHOLDER',\n+          esm2015: '0.0.0-PLACEHOLDER',\n+          typings: '0.0.0-PLACEHOLDER',\n+        });\n+      });\n+    });\n+\n     describe('with createNewEntryPointFormats', () => {\n       it('should create new files rather than overwriting the originals', () => {\n-        const ANGULAR_CORE_IMPORT_REGEX = /import \\* as ngcc\\d+ from '@angular\\/core';/;\n         mainNgcc({\n           basePath: '/node_modules',\n           createNewEntryPointFormats: true,"
        },
        {
            "sha": "31ee7522a5857a36566dceec7570fc9e75dd2ae0",
            "filename": "packages/compiler-cli/ngcc/test/ngcc_options_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fngcc_options_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fngcc_options_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fngcc_options_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -99,6 +99,23 @@ runInEachFileSystem(() => {\n       expect(setup.tsConfig?.rootNames).toEqual([]);\n       expect((setup.logger as MockLogger).logs.warn).toEqual([]);\n     });\n+\n+    it('should not modify `compileAllFormats` if `typingsOnly` is falsy', () => {\n+      let setup = getSharedSetup({...createOptions(), compileAllFormats: true, typingsOnly: false});\n+      expect(setup.typingsOnly).toBe(false);\n+      expect(setup.compileAllFormats).toBe(true);\n+\n+      setup = getSharedSetup({...createOptions(), compileAllFormats: true});\n+      expect(setup.typingsOnly).toBe(false);\n+      expect(setup.compileAllFormats).toBe(true);\n+    });\n+\n+    it('should force `compileAllFormats` to false if `typingsOnly` is true', () => {\n+      const setup =\n+          getSharedSetup({...createOptions(), compileAllFormats: true, typingsOnly: true});\n+      expect(setup.typingsOnly).toBe(true);\n+      expect(setup.compileAllFormats).toBe(false);\n+    });\n   });\n \n   describe('getMaxNumberOfWorkers', () => {"
        },
        {
            "sha": "adec4b45fcd030c1e038270495c19e651767fe13",
            "filename": "packages/compiler-cli/ngcc/test/packages/entry_point_bundle_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_bundle_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_bundle_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_bundle_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -8,6 +8,7 @@\n import {absoluteFrom, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n+import {DtsProcessing} from '../../src/execution/tasks/api';\n import {EntryPoint} from '../../src/packages/entry_point';\n import {makeEntryPointBundle} from '../../src/packages/entry_point_bundle';\n import {createModuleResolutionCache, SharedFileCache} from '../../src/packages/source_file_cache';\n@@ -184,7 +185,7 @@ runInEachFileSystem(() => {\n          const moduleResolutionCache = createModuleResolutionCache(fs);\n          const esm5bundle = makeEntryPointBundle(\n              fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache, './index.js', false,\n-             'esm5', true);\n+             'esm5', DtsProcessing.Yes);\n \n          expect(esm5bundle.src.program.getSourceFiles().map(sf => sf.fileName))\n              .toEqual(jasmine.arrayWithExactContents([\n@@ -298,8 +299,7 @@ runInEachFileSystem(() => {\n       const moduleResolutionCache = createModuleResolutionCache(fs);\n       const esm5bundle = makeEntryPointBundle(\n           fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache, './index.js', false,\n-          'esm5',\n-          /* transformDts */ true,\n+          'esm5', DtsProcessing.Yes,\n           /* pathMappings */ undefined, /* mirrorDtsFromSrc */ true);\n \n       expect(esm5bundle.src.program.getSourceFiles().map(sf => _(sf.fileName)))\n@@ -338,8 +338,7 @@ runInEachFileSystem(() => {\n             const moduleResolutionCache = createModuleResolutionCache(fs);\n             const esm5bundle = makeEntryPointBundle(\n                 fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache, './index.js', false,\n-                'esm5',\n-                /* transformDts */ true,\n+                'esm5', DtsProcessing.Yes,\n                 /* pathMappings */ undefined, /* mirrorDtsFromSrc */ true);\n             expect(esm5bundle.src.program.getSourceFiles().map(sf => sf.fileName))\n                 .toContain(absoluteFrom('/node_modules/test/internal.js'));\n@@ -364,8 +363,7 @@ runInEachFileSystem(() => {\n             const moduleResolutionCache = createModuleResolutionCache(fs);\n             const esm5bundle = makeEntryPointBundle(\n                 fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache,\n-                './esm2015/index.js', false, 'esm2015',\n-                /* transformDts */ true,\n+                './esm2015/index.js', false, 'esm2015', DtsProcessing.Yes,\n                 /* pathMappings */ undefined, /* mirrorDtsFromSrc */ true);\n             expect(esm5bundle.src.program.getSourceFiles().map(sf => sf.fileName))\n                 .toContain(absoluteFrom('/node_modules/internal/esm2015/src/internal.js'));\n@@ -390,8 +388,7 @@ runInEachFileSystem(() => {\n             const moduleResolutionCache = createModuleResolutionCache(fs);\n             const esm5bundle = makeEntryPointBundle(\n                 fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache, './index.js', false,\n-                'esm5',\n-                /* transformDts */ true,\n+                'esm5', DtsProcessing.Yes,\n                 /* pathMappings */ undefined, /* mirrorDtsFromSrc */ false);\n             expect(esm5bundle.src.program.getSourceFiles().map(sf => sf.fileName))\n                 .toContain(absoluteFrom('/node_modules/test/internal.js'));\n@@ -417,8 +414,7 @@ runInEachFileSystem(() => {\n       const moduleResolutionCache = createModuleResolutionCache(fs);\n       const bundle = makeEntryPointBundle(\n           fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache, './index.js', false,\n-          'esm2015',\n-          /* transformDts */ true,\n+          'esm2015', DtsProcessing.Yes,\n           /* pathMappings */ undefined, /* mirrorDtsFromSrc */ true);\n       expect(bundle.rootDirs).toEqual([absoluteFrom('/node_modules/primary')]);\n     });"
        },
        {
            "sha": "758f108d3f7317ef93082e96048ed4faf17e0a0c",
            "filename": "packages/compiler-cli/ngcc/test/writing/new_entry_point_file_writer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d13f631d93616f6863515d96a9d4220044a9052/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts?ref=8d13f631d93616f6863515d96a9d4220044a9052",
            "patch": "@@ -10,6 +10,7 @@ import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {RawSourceMap} from '../../../src/ngtsc/sourcemaps';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n+import {DtsProcessing} from '../../src/execution/tasks/api';\n import {NgccConfiguration} from '../../src/packages/configuration';\n import {EntryPoint, EntryPointFormat, EntryPointJsonProperty, getEntryPointInfo, isEntryPoint} from '../../src/packages/entry_point';\n import {EntryPointBundle, makeEntryPointBundle} from '../../src/packages/entry_point_bundle';\n@@ -731,6 +732,6 @@ runInEachFileSystem(() => {\n     const moduleResolutionCache = createModuleResolutionCache(fs);\n     return makeEntryPointBundle(\n         fs, entryPoint, new SharedFileCache(fs), moduleResolutionCache,\n-        entryPoint.packageJson[formatProperty]!, false, format, true);\n+        entryPoint.packageJson[formatProperty]!, false, format, DtsProcessing.Yes);\n   }\n });"
        }
    ],
    "stats": {
        "total": 447,
        "additions": 308,
        "deletions": 139
    }
}