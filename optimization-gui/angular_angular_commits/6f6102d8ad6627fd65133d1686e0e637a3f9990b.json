{
    "author": "clydin",
    "message": "fix(compiler): add PURE annotation to getInheritedFactory calls (#38291)\n\nCurrently the `getInheritedFactory` function is implemented to allow\nclosure to remove the call if the base factory is unused.  However, this\nmethod does not work with terser.  By adding the PURE annotation,\nterser will also be able to remove the call when unused.\n\nPR Close #38291",
    "sha": "6f6102d8ad6627fd65133d1686e0e637a3f9990b",
    "files": [
        {
            "sha": "93448d1db33f625b7b784e356ff06707404c6abc",
            "filename": "integration/ngcc/test.sh",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/6f6102d8ad6627fd65133d1686e0e637a3f9990b/integration%2Fngcc%2Ftest.sh",
            "raw_url": "https://github.com/angular/angular/raw/6f6102d8ad6627fd65133d1686e0e637a3f9990b/integration%2Fngcc%2Ftest.sh",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fngcc%2Ftest.sh?ref=6f6102d8ad6627fd65133d1686e0e637a3f9990b",
            "patch": "@@ -104,10 +104,10 @@ assertSucceeded \"Expected 'ngcc' to log 'Compiling'.\"\n \n \n # Did it generate a base factory call for synthesized constructors correctly?\n-  grep \"const ɵMatTable_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(MatTable);\" node_modules/@angular/material/esm2015/table/table.js\n+  grep \"const ɵMatTable_BaseFactory = /\\*@__PURE__\\*/ ɵngcc0.ɵɵgetInheritedFactory(MatTable);\" node_modules/@angular/material/esm2015/table/table.js\n   assertSucceeded \"Expected 'ngcc' to generate a base factory for 'MatTable' in '@angular/material' (esm2015).\"\n \n-  grep \"var ɵMatTable_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(MatTable);\" node_modules/@angular/material/esm5/table/table.js\n+  grep \"var ɵMatTable_BaseFactory = /\\*@__PURE__\\*/ ɵngcc0.ɵɵgetInheritedFactory(MatTable);\" node_modules/@angular/material/esm5/table/table.js\n   assertSucceeded \"Expected 'ngcc' to generate a base factory for 'MatTable' in '@angular/material' (esm5).\"\n \n "
        },
        {
            "sha": "886e364fbcd082159a5f1d80fb59a86901f9fba6",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=6f6102d8ad6627fd65133d1686e0e637a3f9990b",
            "patch": "@@ -3822,7 +3822,8 @@ runInEachFileSystem(os => {\n \n       expect(jsContents)\n           .toContain('function Base_Factory(t) { return new (t || Base)(i0.ɵɵinject(Dep)); }');\n-      expect(jsContents).toContain('var \\u0275Child_BaseFactory = i0.ɵɵgetInheritedFactory(Child)');\n+      expect(jsContents)\n+          .toContain('var \\u0275Child_BaseFactory = /*@__PURE__*/ i0.ɵɵgetInheritedFactory(Child)');\n       expect(jsContents)\n           .toContain('function Child_Factory(t) { return \\u0275Child_BaseFactory(t || Child); }');\n       expect(jsContents)\n@@ -3849,7 +3850,8 @@ runInEachFileSystem(os => {\n       env.driveMain();\n       const jsContents = env.getContents('test.js');\n \n-      expect(jsContents).toContain('var \\u0275Dir_BaseFactory = i0.ɵɵgetInheritedFactory(Dir)');\n+      expect(jsContents)\n+          .toContain('var \\u0275Dir_BaseFactory = /*@__PURE__*/ i0.ɵɵgetInheritedFactory(Dir)');\n     });\n \n     it('should wrap \"directives\" in component metadata in a closure when forward references are present',"
        },
        {
            "sha": "dfac81e170e10cc3a6f7114d2c8cd7bf0c479a67",
            "filename": "packages/compiler/src/output/output_ast.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "raw_url": "https://github.com/angular/angular/raw/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts?ref=6f6102d8ad6627fd65133d1686e0e637a3f9990b",
            "patch": "@@ -176,8 +176,9 @@ export abstract class Expression {\n     return new InvokeMethodExpr(this, name, params, null, sourceSpan);\n   }\n \n-  callFn(params: Expression[], sourceSpan?: ParseSourceSpan|null): InvokeFunctionExpr {\n-    return new InvokeFunctionExpr(this, params, null, sourceSpan);\n+  callFn(params: Expression[], sourceSpan?: ParseSourceSpan|null, pure?: boolean):\n+      InvokeFunctionExpr {\n+    return new InvokeFunctionExpr(this, params, null, sourceSpan, pure);\n   }\n \n   instantiate(params: Expression[], type?: Type|null, sourceSpan?: ParseSourceSpan|null):"
        },
        {
            "sha": "c1cb7c923b3faeaff1e5b4a83bd176eb17c453f6",
            "filename": "packages/compiler/src/render3/r3_factory.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/6f6102d8ad6627fd65133d1686e0e637a3f9990b/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts?ref=6f6102d8ad6627fd65133d1686e0e637a3f9990b",
            "patch": "@@ -212,7 +212,9 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3FactoryFn {\n     const baseFactory = o.variable(`ɵ${meta.name}_BaseFactory`);\n     const getInheritedFactory = o.importExpr(R3.getInheritedFactory);\n     const baseFactoryStmt =\n-        baseFactory.set(getInheritedFactory.callFn([meta.internalType]))\n+        baseFactory\n+            .set(getInheritedFactory.callFn(\n+                [meta.internalType], /* sourceSpan */ undefined, /* pure */ true))\n             .toDeclStmt(o.INFERRED_TYPE, [o.StmtModifier.Exported, o.StmtModifier.Final]);\n     statements.push(baseFactoryStmt);\n "
        }
    ],
    "stats": {
        "total": 19,
        "additions": 12,
        "deletions": 7
    }
}