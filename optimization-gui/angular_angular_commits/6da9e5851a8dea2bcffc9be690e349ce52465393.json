{
    "author": "crisbeto",
    "message": "fix(compiler-cli): preserve quotes in class member names (#38387)\n\nWhen we were outputting class members for `setClassMetadata` calls,\nwe were using the string representation of the member name. This can\nlead to us generating invalid code when the name contains dashes and\nis quoted (e.g. `@Output() 'has-dashes' = new EventEmitter()`), because\nthe quotes will be stripped for the string representation.\n\nThese changes fix the issue by using the original name AST node that was\nused for the declaration and which knows whether it's supposed to be\nquoted or not.\n\nFixes #38311.\n\nPR Close #38387",
    "sha": "6da9e5851a8dea2bcffc9be690e349ce52465393",
    "files": [
        {
            "sha": "3ac72e8d1082a5b50002a95547624defde6c2ae4",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/metadata.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/6da9e5851a8dea2bcffc9be690e349ce52465393/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/6da9e5851a8dea2bcffc9be690e349ce52465393/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts?ref=6da9e5851a8dea2bcffc9be690e349ce52465393",
            "patch": "@@ -70,8 +70,8 @@ export function generateSetClassMetadataCall(\n         `Duplicate decorated properties found on class '${clazz.name.text}': ` +\n         duplicateDecoratedMemberNames.join(', '));\n   }\n-  const decoratedMembers =\n-      classMembers.map(member => classMemberToMetadata(member.name, member.decorators!, isCore));\n+  const decoratedMembers = classMembers.map(\n+      member => classMemberToMetadata(member.nameNode ?? member.name, member.decorators!, isCore));\n   if (decoratedMembers.length > 0) {\n     metaPropDecorators = ts.createObjectLiteral(decoratedMembers);\n   }\n@@ -127,7 +127,7 @@ function ctorParameterToMetadata(\n  * Convert a reflected class member to metadata.\n  */\n function classMemberToMetadata(\n-    name: string, decorators: Decorator[], isCore: boolean): ts.PropertyAssignment {\n+    name: ts.PropertyName|string, decorators: Decorator[], isCore: boolean): ts.PropertyAssignment {\n   const ngDecorators = decorators.filter(dec => isAngularDecorator(dec, isCore))\n                            .map((decorator: Decorator) => decoratorToMetadata(decorator));\n   const decoratorMeta = ts.createArrayLiteral(ngDecorators);"
        },
        {
            "sha": "1745af51a76f0b38c56edbd33de2950302922a06",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/metadata_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/6da9e5851a8dea2bcffc9be690e349ce52465393/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/6da9e5851a8dea2bcffc9be690e349ce52465393/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts?ref=6da9e5851a8dea2bcffc9be690e349ce52465393",
            "patch": "@@ -90,6 +90,19 @@ runInEachFileSystem(() => {\n     `);\n       expect(res).toBe('');\n     });\n+\n+    it('should preserve quotes around class member names', () => {\n+      const res = compileAndPrint(`\n+        import {Component, Input} from '@angular/core';\n+\n+        @Component('metadata') class Target {\n+          @Input() 'has-dashes-in-name' = 123;\n+          @Input() noDashesInName = 456;\n+        }\n+      `);\n+      expect(res).toContain(\n+          `{ 'has-dashes-in-name': [{ type: Input }], noDashesInName: [{ type: Input }] })`);\n+    });\n   });\n \n   function compileAndPrint(contents: string): string {"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 16,
        "deletions": 3
    }
}