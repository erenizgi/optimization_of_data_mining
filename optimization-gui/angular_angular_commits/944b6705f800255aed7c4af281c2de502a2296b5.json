{
    "author": "devversion",
    "message": "build: remove unused starlark file that is no longer used (#44430)\n\nCleans up an unused Starlark file used by the old integration test\nsetup.\n\nPR Close #44430",
    "sha": "944b6705f800255aed7c4af281c2de502a2296b5",
    "files": [
        {
            "sha": "f55c2dd4a5d9980e68866b00feb36fc4094392ad",
            "filename": "integration/angular_integration_test.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 198,
            "changes": 198,
            "blob_url": "https://github.com/angular/angular/blob/f51b00916efe8b65b5b2839f592c92cc2d642e02/integration%2Fangular_integration_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/f51b00916efe8b65b5b2839f592c92cc2d642e02/integration%2Fangular_integration_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fangular_integration_test.bzl?ref=f51b00916efe8b65b5b2839f592c92cc2d642e02",
            "patch": "@@ -1,198 +0,0 @@\n-# Copyright Google LLC All Rights Reserved.\n-#\n-# Use of this source code is governed by an MIT-style license that can be\n-# found in the LICENSE file at https://angular.io/license\n-\"\"\"Angular integration testing\n-\"\"\"\n-\n-load(\"//tools/npm_integration_test:npm_integration_test.bzl\", \"npm_integration_test\")\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n-\n-# The @npm packages at the root node_modules are used by integration tests\n-# with `file:../../node_modules/foobar` references\n-NPM_PACKAGE_ARCHIVES = [\n-    \"@angular/animations-12\",\n-    \"@angular/common-12\",\n-    \"@angular/core-12\",\n-    \"@angular/forms-12\",\n-    \"@angular/platform-browser-12\",\n-    \"@angular/platform-browser-dynamic-12\",\n-    \"@angular/platform-server-12\",\n-    \"@angular/router-12\",\n-    \"@babel/core\",\n-    \"@rollup/plugin-babel\",\n-    \"@rollup/plugin-node-resolve\",\n-    \"@rollup/plugin-commonjs\",\n-    \"check-side-effects\",\n-    \"core-js\",\n-    \"google-closure-compiler\",\n-    \"jasmine\",\n-    \"typescript\",\n-    \"rxjs\",\n-    \"systemjs\",\n-    \"tsickle\",\n-    \"tslib\",\n-    \"protractor\",\n-    \"terser\",\n-    \"puppeteer\",\n-    \"rollup\",\n-    \"rollup-plugin-sourcemaps\",\n-    \"webdriver-manager\",\n-    \"@angular/cli\",\n-    \"@angular-devkit/build-angular\",\n-    \"@bazel/bazelisk\",\n-    \"@types/jasmine\",\n-    \"@types/jasminewd2\",\n-    \"@types/node\",\n-]\n-\n-# The generated npm packages should ALWAYS be replaced in integration tests\n-# so we pass them to the `check_npm_packages` attribute of npm_integration_test\n-FRAMEWORK_PACKAGES = [\n-    \"@angular/animations\",\n-    \"@angular/bazel\",\n-    \"@angular/benchpress\",\n-    \"@angular/common\",\n-    \"@angular/compiler\",\n-    \"@angular/compiler-cli\",\n-    \"@angular/core\",\n-    \"@angular/elements\",\n-    \"@angular/forms\",\n-    \"@angular/language-service\",\n-    \"@angular/localize\",\n-    \"@angular/platform-browser\",\n-    \"@angular/platform-browser-dynamic\",\n-    \"@angular/platform-server\",\n-    \"@angular/router\",\n-    \"@angular/service-worker\",\n-    \"@angular/upgrade\",\n-    \"zone.js\",\n-]\n-\n-def npm_package_archives():\n-    \"\"\"Function to generate pkg_tar definitions for WORKSPACE yarn_install manual_build_file_contents\"\"\"\n-    npm_packages_to_archive = NPM_PACKAGE_ARCHIVES\n-    result = \"\"\"load(\"@rules_pkg//:pkg.bzl\", \"pkg_tar\")\n-\"\"\"\n-    for name in npm_packages_to_archive:\n-        label_name = _npm_package_archive_label(name)\n-        last_segment_name = name.split(\"/\")[-1]\n-        result += \"\"\"pkg_tar(\n-    name = \"{label_name}\",\n-    srcs = [\"//{name}:{last_segment_name}__all_files\"],\n-    extension = \"tar.gz\",\n-    strip_prefix = \"/external/npm/node_modules/{name}\",\n-    # should not be built unless it is a dependency of another rule\n-    tags = [\"manual\"],\n-)\n-\"\"\".format(name = name, label_name = label_name, last_segment_name = last_segment_name)\n-    return result\n-\n-def _npm_package_archive_label(package_name):\n-    return package_name.replace(\"/\", \"_\").replace(\"@\", \"\") + \"_archive\"\n-\n-def _angular_integration_test(name, **kwargs):\n-    \"Set defaults for the npm_integration_test common to the angular repo\"\n-    payload_size_tracking = kwargs.pop(\"payload_size_tracking\", [])\n-    pinned_npm_packages = kwargs.pop(\"pinned_npm_packages\", [])\n-    use_view_engine_packages = kwargs.pop(\"use_view_engine_packages\", [])\n-    data = [\n-        # We need the yarn_bin & yarn_files available at runtime\n-        \"@nodejs//:yarn_bin\",\n-        \"@nodejs//:yarn_files\",\n-    ]\n-\n-    # By default run `yarn install` followed by `yarn test` using\n-    # the bazel managed hermetic version of yarn inside\n-    DEFAULT_COMMANDS = [\n-        \"patch-package-json\",\n-        # Workaround https://github.com/yarnpkg/yarn/issues/2165\n-        # Yarn will cache file://dist URIs and not update Angular code\n-        \"rm -rf ./.yarn_local_cache\",\n-        \"mkdir .yarn_local_cache\",\n-        \"$(rootpath @nodejs//:yarn_bin) install --cache-folder ./.yarn_local_cache\",\n-        \"$(rootpath @nodejs//:yarn_bin) test\",\n-    ]\n-\n-    commands = kwargs.pop(\"commands\", [])\n-    if commands == \"default\":\n-        commands = DEFAULT_COMMANDS\n-    elif commands == \"payload_size_tracking\":\n-        commands = DEFAULT_COMMANDS + [\n-            \"$(rootpath @nodejs//:yarn_bin) build\",\n-            \"$(rootpath //:scripts/ci/track-payload-size.sh) %s dist/*.js true ${RUNFILES}/angular/$(rootpath //goldens:size-tracking/integration-payloads.json)\" % name,\n-        ]\n-        data = data + [\n-            \"//goldens:size-tracking/integration-payloads.json\",\n-            \"//:scripts/ci/track-payload-size.sh\",\n-            \"//:scripts/ci/payload-size.sh\",\n-            \"//:scripts/ci/payload-size.js\",\n-        ]\n-\n-    # Complete list of npm packages to override in the test's package.json file mapped to\n-    # tgz archive to use for the replacement. This is the full list for all integration\n-    # tests. Any given integration does not need to use all of these packages.\n-    npm_packages = {}\n-    for pkg in NPM_PACKAGE_ARCHIVES:\n-        if pkg not in pinned_npm_packages:\n-            npm_packages[\"@npm//:\" + _npm_package_archive_label(pkg)] = pkg\n-    for pkg in FRAMEWORK_PACKAGES:\n-        # If the generated Angular framework package is listed in the `use_view_engine_packages`\n-        # list, we will not use the local-built NPM package, but instead map to the\n-        # corresponding View Engine v12.x package from the `@npm//` workspace.\n-        if pkg in use_view_engine_packages:\n-            npm_packages[\"@npm//:\" + _npm_package_archive_label(\"%s-12\" % pkg)] = pkg\n-        else:\n-            last_segment_name = pkg.split(\"/\")[-1]\n-            npm_packages[\"//packages/%s:npm_package_archive\" % last_segment_name] = pkg\n-\n-    npm_integration_test(\n-        name = name + \"_test\",\n-        check_npm_packages = FRAMEWORK_PACKAGES,\n-        commands = commands,\n-        npm_packages = npm_packages,\n-        tags = kwargs.pop(\"tags\", []) + [\n-            # `integration` tag is used for filtering out these tests from the normal\n-            # developer workflow\n-            \"integration\",\n-            # Integration do not work inside of a sandbox as they may run host applications such\n-            # as chrome (which is run by ng) that require access to files outside of the sandbox.\n-            \"no-sandbox\",\n-            # Remote doesn't work as it needs network access right now\n-            \"no-remote-exec\",\n-        ],\n-        data = kwargs.pop(\"data\", []) + data,\n-        # 15-minute timeout\n-        timeout = \"long\",\n-        # Tells bazel that this test should be allocated a large amount of memory.\n-        # See https://docs.bazel.build/versions/2.0.0/be/common-definitions.html#common-attributes-tests.\n-        size = \"enormous\",\n-        **kwargs\n-    )\n-\n-def angular_integration_test(name, **kwargs):\n-    \"Sets up the integration test target based on the test folder name\"\n-\n-    # Note: We copy the `package.json` file to the `bazel-bin` as otherwise\n-    # the actual source file `package.json` file would be modified on Windows.\n-    copy_to_bin(\n-        name = \"%s_package_json\" % name,\n-        srcs = [\"%s/package.json\" % name],\n-    )\n-\n-    native.filegroup(\n-        name = \"_%s_sources\" % name,\n-        srcs = [\"%s_package_json\" % name] + native.glob(\n-            include = [\"%s/**\" % name],\n-            exclude = [\n-                \"%s/package.json\",\n-                \"%s/node_modules/**\" % name,\n-                \"%s/.yarn_local_cache/**\" % name,\n-            ],\n-        ),\n-    )\n-    _angular_integration_test(\n-        name = name,\n-        test_files = kwargs.pop(\"test_files\", \"_%s_sources\" % name),\n-        **kwargs\n-    )"
        }
    ],
    "stats": {
        "total": 198,
        "additions": 0,
        "deletions": 198
    }
}