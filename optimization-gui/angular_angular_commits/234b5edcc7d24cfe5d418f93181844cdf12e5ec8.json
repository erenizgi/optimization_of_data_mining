{
    "author": "petebacondarwin",
    "message": "fix(platform-browser): in `Meta.addTag()` do not add duplicate meta tags (#42703)\n\nPreviously, if there were two tags with the same \"name\" or \"property\" attribute selector,\nthen only the first was checked for duplicates when deciding whether to add a new meta\ntag.\n\nFixes #42700\nFixes #19606\n\nPR Close #42703",
    "sha": "234b5edcc7d24cfe5d418f93181844cdf12e5ec8",
    "files": [
        {
            "sha": "ba62dd170e79079b32818538174eb6eb1f2134f6",
            "filename": "packages/platform-browser/src/browser/meta.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/234b5edcc7d24cfe5d418f93181844cdf12e5ec8/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fmeta.ts",
            "raw_url": "https://github.com/angular/angular/raw/234b5edcc7d24cfe5d418f93181844cdf12e5ec8/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fmeta.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fmeta.ts?ref=234b5edcc7d24cfe5d418f93181844cdf12e5ec8",
            "patch": "@@ -166,11 +166,11 @@ export class Meta {\n       HTMLMetaElement {\n     if (!forceCreation) {\n       const selector: string = this._parseSelector(meta);\n-      const elem: HTMLMetaElement = this.getTag(selector)!;\n       // It's allowed to have multiple elements with the same name so it's not enough to\n       // just check that element with the same name already present on the page. We also need to\n       // check if element has tag attributes\n-      if (elem && this._containsAttributes(meta, elem)) return elem;\n+      const elem = this.getTags(selector).filter(elem => this._containsAttributes(meta, elem))[0];\n+      if (elem !== undefined) return elem;\n     }\n     const element: HTMLMetaElement = this._dom.createElement('meta') as HTMLMetaElement;\n     this._setMetaElementAttributes(meta, element);"
        },
        {
            "sha": "e1e379b7960eeea2ff4ea1504a50f51da3ebfa36",
            "filename": "packages/platform-browser/test/browser/meta_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/234b5edcc7d24cfe5d418f93181844cdf12e5ec8/packages%2Fplatform-browser%2Ftest%2Fbrowser%2Fmeta_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/234b5edcc7d24cfe5d418f93181844cdf12e5ec8/packages%2Fplatform-browser%2Ftest%2Fbrowser%2Fmeta_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Ftest%2Fbrowser%2Fmeta_spec.ts?ref=234b5edcc7d24cfe5d418f93181844cdf12e5ec8",
            "patch": "@@ -167,6 +167,16 @@ import {expect} from '@angular/platform-browser/testing/src/matchers';\n       expect(metaService.getTags(selector).length).toEqual(1);\n     });\n \n+    it('should not add meta tag if it is already present on the page, even if the first tag with the same name has different other attributes',\n+       () => {\n+         metaService.addTag({name: 'description', content: 'aaa'});\n+         metaService.addTag({name: 'description', content: 'bbb'});\n+         metaService.addTag({name: 'description', content: 'aaa'});\n+         metaService.addTag({name: 'description', content: 'bbb'});\n+\n+         expect(metaService.getTags('name=\"description\"').length).toEqual(2);\n+       });\n+\n     it('should add meta tag if it is already present on the page and but has different attr',\n        () => {\n          const selector = 'property=\"fb:app_id\"';"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 12,
        "deletions": 2
    }
}