{
    "author": "josephperrott",
    "message": "refactor(dev-infra): move `getRepoBaseDir()` to `GitClient` (#41527)\n\nAs `getRepoBaseDir()` relies on git, it should be a method on `GitClient` for retrieval\nrather than its own utility outside of the common GitClient used for all git ineractions.\n\nPR Close #41527",
    "sha": "dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
    "files": [
        {
            "sha": "1ee07bfd30395f58fb0ecc43ef5ac314e984d1cf",
            "filename": "dev-infra/build-worker.js",
            "status": "modified",
            "additions": 458,
            "deletions": 32,
            "changes": 490,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fbuild-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fbuild-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbuild-worker.js?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -7,7 +7,461 @@ var fs = require('fs');\n var path = require('path');\n var chalk = _interopDefault(require('chalk'));\n require('inquirer');\n-var shelljs = require('shelljs');\n+var child_process = require('child_process');\n+var semver = require('semver');\n+var graphql = require('@octokit/graphql');\n+var Octokit = require('@octokit/rest');\n+var typedGraphqlify = require('typed-graphqlify');\n+var url = require('url');\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Whether the current environment is in dry run mode. */\n+function isDryRun() {\n+    return process.env['DRY_RUN'] !== undefined;\n+}\n+/** Error to be thrown when a function or method is called in dryRun mode and shouldn't be. */\n+var DryRunError = /** @class */ (function (_super) {\n+    tslib.__extends(DryRunError, _super);\n+    function DryRunError() {\n+        var _this = _super.call(this, 'Cannot call this function in dryRun mode.') || this;\n+        // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n+        // a limitation in down-leveling.\n+        // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n+        Object.setPrototypeOf(_this, DryRunError.prototype);\n+        return _this;\n+    }\n+    return DryRunError;\n+}(Error));\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Error for failed Github API requests. */\n+var GithubApiRequestError = /** @class */ (function (_super) {\n+    tslib.__extends(GithubApiRequestError, _super);\n+    function GithubApiRequestError(status, message) {\n+        var _this = _super.call(this, message) || this;\n+        _this.status = status;\n+        return _this;\n+    }\n+    return GithubApiRequestError;\n+}(Error));\n+/** Error for failed Github API requests. */\n+var GithubGraphqlClientError = /** @class */ (function (_super) {\n+    tslib.__extends(GithubGraphqlClientError, _super);\n+    function GithubGraphqlClientError() {\n+        return _super !== null && _super.apply(this, arguments) || this;\n+    }\n+    return GithubGraphqlClientError;\n+}(Error));\n+/**\n+ * A Github client for interacting with the Github APIs.\n+ *\n+ * Additionally, provides convenience methods for actions which require multiple requests, or\n+ * would provide value from memoized style responses.\n+ **/\n+var GithubClient = /** @class */ (function (_super) {\n+    tslib.__extends(GithubClient, _super);\n+    /**\n+     * @param token The github authentication token for Github Rest and Graphql API requests.\n+     */\n+    function GithubClient(token) {\n+        var _this = \n+        // Pass in authentication token to base Octokit class.\n+        _super.call(this, { auth: token }) || this;\n+        _this.token = token;\n+        /** The current user based on checking against the Github API. */\n+        _this._currentUser = null;\n+        /** The graphql instance with authentication set during construction. */\n+        _this._graphql = graphql.graphql.defaults({ headers: { authorization: \"token \" + _this.token } });\n+        _this.hook.error('request', function (error) {\n+            // Wrap API errors in a known error class. This allows us to\n+            // expect Github API errors better and in a non-ambiguous way.\n+            throw new GithubApiRequestError(error.status, error.message);\n+        });\n+        // Note: The prototype must be set explictly as Github's Octokit class is a non-standard class\n+        // definition which adjusts the prototype chain.\n+        // See:\n+        //    https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work\n+        //    https://github.com/octokit/rest.js/blob/7b51cee4a22b6e52adcdca011f93efdffa5df998/lib/constructor.js\n+        Object.setPrototypeOf(_this, GithubClient.prototype);\n+        return _this;\n+    }\n+    /** Perform a query using Github's Graphql API. */\n+    GithubClient.prototype.graphql = function (queryObject, params) {\n+        if (params === void 0) { params = {}; }\n+        return tslib.__awaiter(this, void 0, void 0, function () {\n+            return tslib.__generator(this, function (_a) {\n+                switch (_a.label) {\n+                    case 0:\n+                        if (this.token === undefined) {\n+                            throw new GithubGraphqlClientError('Cannot query via graphql without an authentication token set, use the authenticated ' +\n+                                '`GitClient` by calling `GitClient.getAuthenticatedInstance()`.');\n+                        }\n+                        return [4 /*yield*/, this._graphql(typedGraphqlify.query(queryObject), params)];\n+                    case 1: return [2 /*return*/, (_a.sent())];\n+                }\n+            });\n+        });\n+    };\n+    /** Retrieve the login of the current user from Github. */\n+    GithubClient.prototype.getCurrentUser = function () {\n+        return tslib.__awaiter(this, void 0, void 0, function () {\n+            var result;\n+            return tslib.__generator(this, function (_a) {\n+                switch (_a.label) {\n+                    case 0:\n+                        // If the current user has already been retrieved return the current user value again.\n+                        if (this._currentUser !== null) {\n+                            return [2 /*return*/, this._currentUser];\n+                        }\n+                        return [4 /*yield*/, this.graphql({\n+                                viewer: {\n+                                    login: typedGraphqlify.types.string,\n+                                }\n+                            })];\n+                    case 1:\n+                        result = _a.sent();\n+                        return [2 /*return*/, this._currentUser = result.viewer.login];\n+                }\n+            });\n+        });\n+    };\n+    return GithubClient;\n+}(Octokit));\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** URL to the Github page where personal access tokens can be managed. */\n+var GITHUB_TOKEN_SETTINGS_URL = 'https://github.com/settings/tokens';\n+/** URL to the Github page where personal access tokens can be generated. */\n+var GITHUB_TOKEN_GENERATE_URL = 'https://github.com/settings/tokens/new';\n+/** Adds the provided token to the given Github HTTPs remote url. */\n+function addTokenToGitHttpsUrl(githubHttpsUrl, token) {\n+    var url$1 = new url.URL(githubHttpsUrl);\n+    url$1.username = token;\n+    return url$1.href;\n+}\n+/** Gets the repository Git URL for the given github config. */\n+function getRepositoryGitUrl(config, githubToken) {\n+    if (config.useSsh) {\n+        return \"git@github.com:\" + config.owner + \"/\" + config.name + \".git\";\n+    }\n+    var baseHttpUrl = \"https://github.com/\" + config.owner + \"/\" + config.name + \".git\";\n+    if (githubToken !== undefined) {\n+        return addTokenToGitHttpsUrl(baseHttpUrl, githubToken);\n+    }\n+    return baseHttpUrl;\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Error for failed Git commands. */\n+var GitCommandError = /** @class */ (function (_super) {\n+    tslib.__extends(GitCommandError, _super);\n+    function GitCommandError(client, args) {\n+        var _this = \n+        // Errors are not guaranteed to be caught. To ensure that we don't\n+        // accidentally leak the Github token that might be used in a command,\n+        // we sanitize the command that will be part of the error message.\n+        _super.call(this, \"Command failed: git \" + client.omitGithubTokenFromMessage(args.join(' '))) || this;\n+        _this.args = args;\n+        return _this;\n+    }\n+    return GitCommandError;\n+}(Error));\n+/**\n+ * Common client for performing Git interactions with a given remote.\n+ *\n+ * Takes in two optional arguments:\n+ *   `githubToken`: the token used for authentication in Github interactions, by default empty\n+ *     allowing readonly actions.\n+ *   `config`: The dev-infra configuration containing information about the remote. By default\n+ *     the dev-infra configuration is loaded with its Github configuration.\n+ **/\n+var GitClient = /** @class */ (function () {\n+    /**\n+     * @param githubToken The github token used for authentication, if provided.\n+     * @param _config The configuration, containing the github specific configuration.\n+     * @param baseDir The full path to the root of the repository base.\n+     */\n+    function GitClient(githubToken, config, baseDir) {\n+        this.githubToken = githubToken;\n+        /** Whether verbose logging of Git actions should be used. */\n+        this.verboseLogging = true;\n+        /** The OAuth scopes available for the provided Github token. */\n+        this._cachedOauthScopes = null;\n+        /**\n+         * Regular expression that matches the provided Github token. Used for\n+         * sanitizing the token from Git child process output.\n+         */\n+        this._githubTokenRegex = null;\n+        /** Instance of the Github octokit API. */\n+        this.github = new GithubClient(this.githubToken);\n+        this.baseDir = baseDir || this.determineBaseDir();\n+        this.config = config || getConfig(this.baseDir);\n+        this.remoteConfig = this.config.github;\n+        this.remoteParams = { owner: this.remoteConfig.owner, repo: this.remoteConfig.name };\n+        // If a token has been specified (and is not empty), pass it to the Octokit API and\n+        // also create a regular expression that can be used for sanitizing Git command output\n+        // so that it does not print the token accidentally.\n+        if (typeof githubToken === 'string') {\n+            this._githubTokenRegex = new RegExp(githubToken, 'g');\n+        }\n+    }\n+    /**\n+     * Static method to get the singleton instance of the unauthorized GitClient, creating it if it\n+     * has not yet been created.\n+     */\n+    GitClient.getInstance = function () {\n+        if (!GitClient.unauthenticated) {\n+            GitClient.unauthenticated = new GitClient(undefined);\n+        }\n+        return GitClient.unauthenticated;\n+    };\n+    /**\n+     * Static method to get the singleton instance of the authenticated GitClient if it has been\n+     * generated.\n+     */\n+    GitClient.getAuthenticatedInstance = function () {\n+        if (!GitClient.authenticated) {\n+            throw Error('The authenticated GitClient has not yet been generated.');\n+        }\n+        return GitClient.authenticated;\n+    };\n+    /** Build the authenticated GitClient instance. */\n+    GitClient.authenticateWithToken = function (token) {\n+        if (GitClient.authenticated) {\n+            throw Error('Cannot generate new authenticated GitClient after one has already been generated.');\n+        }\n+        GitClient.authenticated = new GitClient(token);\n+    };\n+    /** Set the verbose logging state of the GitClient instance. */\n+    GitClient.prototype.setVerboseLoggingState = function (verbose) {\n+        this.verboseLogging = verbose;\n+        return this;\n+    };\n+    /** Executes the given git command. Throws if the command fails. */\n+    GitClient.prototype.run = function (args, options) {\n+        var result = this.runGraceful(args, options);\n+        if (result.status !== 0) {\n+            throw new GitCommandError(this, args);\n+        }\n+        // Omit `status` from the type so that it's obvious that the status is never\n+        // non-zero as explained in the method description.\n+        return result;\n+    };\n+    /**\n+     * Spawns a given Git command process. Does not throw if the command fails. Additionally,\n+     * if there is any stderr output, the output will be printed. This makes it easier to\n+     * info failed commands.\n+     */\n+    GitClient.prototype.runGraceful = function (args, options) {\n+        if (options === void 0) { options = {}; }\n+        /** The git command to be run. */\n+        var gitCommand = args[0];\n+        if (isDryRun() && gitCommand === 'push') {\n+            debug(\"\\\"git push\\\" is not able to be run in dryRun mode.\");\n+            throw new DryRunError();\n+        }\n+        // To improve the debugging experience in case something fails, we print all executed Git\n+        // commands to better understand the git actions occuring. Depending on the command being\n+        // executed, this debugging information should be logged at different logging levels.\n+        var printFn = (!this.verboseLogging || options.stdio === 'ignore') ? debug : info;\n+        // Note that we do not want to print the token if it is contained in the command. It's common\n+        // to share errors with others if the tool failed, and we do not want to leak tokens.\n+        printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n+        var result = child_process.spawnSync('git', args, tslib.__assign(tslib.__assign({ cwd: this.baseDir, stdio: 'pipe' }, options), { \n+            // Encoding is always `utf8` and not overridable. This ensures that this method\n+            // always returns `string` as output instead of buffers.\n+            encoding: 'utf8' }));\n+        if (result.stderr !== null) {\n+            // Git sometimes prints the command if it failed. This means that it could\n+            // potentially leak the Github token used for accessing the remote. To avoid\n+            // printing a token, we sanitize the string before printing the stderr output.\n+            process.stderr.write(this.omitGithubTokenFromMessage(result.stderr));\n+        }\n+        return result;\n+    };\n+    /** Git URL that resolves to the configured repository. */\n+    GitClient.prototype.getRepoGitUrl = function () {\n+        return getRepositoryGitUrl(this.remoteConfig, this.githubToken);\n+    };\n+    /** Whether the given branch contains the specified SHA. */\n+    GitClient.prototype.hasCommit = function (branchName, sha) {\n+        return this.run(['branch', branchName, '--contains', sha]).stdout !== '';\n+    };\n+    /** Gets the currently checked out branch or revision. */\n+    GitClient.prototype.getCurrentBranchOrRevision = function () {\n+        var branchName = this.run(['rev-parse', '--abbrev-ref', 'HEAD']).stdout.trim();\n+        // If no branch name could be resolved. i.e. `HEAD` has been returned, then Git\n+        // is currently in a detached state. In those cases, we just want to return the\n+        // currently checked out revision/SHA.\n+        if (branchName === 'HEAD') {\n+            return this.run(['rev-parse', 'HEAD']).stdout.trim();\n+        }\n+        return branchName;\n+    };\n+    /** Gets whether the current Git repository has uncommitted changes. */\n+    GitClient.prototype.hasUncommittedChanges = function () {\n+        return this.runGraceful(['diff-index', '--quiet', 'HEAD']).status !== 0;\n+    };\n+    /** Whether the repo has any local changes. */\n+    GitClient.prototype.hasLocalChanges = function () {\n+        return this.runGraceful(['diff-index', '--quiet', 'HEAD']).status !== 0;\n+    };\n+    /** Sanitizes a given message by omitting the provided Github token if present. */\n+    GitClient.prototype.omitGithubTokenFromMessage = function (value) {\n+        // If no token has been defined (i.e. no token regex), we just return the\n+        // value as is. There is no secret value that needs to be omitted.\n+        if (this._githubTokenRegex === null) {\n+            return value;\n+        }\n+        return value.replace(this._githubTokenRegex, '<TOKEN>');\n+    };\n+    /**\n+     * Checks out a requested branch or revision, optionally cleaning the state of the repository\n+     * before attempting the checking. Returns a boolean indicating whether the branch or revision\n+     * was cleanly checked out.\n+     */\n+    GitClient.prototype.checkout = function (branchOrRevision, cleanState) {\n+        if (cleanState) {\n+            // Abort any outstanding ams.\n+            this.runGraceful(['am', '--abort'], { stdio: 'ignore' });\n+            // Abort any outstanding cherry-picks.\n+            this.runGraceful(['cherry-pick', '--abort'], { stdio: 'ignore' });\n+            // Abort any outstanding rebases.\n+            this.runGraceful(['rebase', '--abort'], { stdio: 'ignore' });\n+            // Clear any changes in the current repo.\n+            this.runGraceful(['reset', '--hard'], { stdio: 'ignore' });\n+        }\n+        return this.runGraceful(['checkout', branchOrRevision], { stdio: 'ignore' }).status === 0;\n+    };\n+    /** Gets the latest git tag on the current branch that matches SemVer. */\n+    GitClient.prototype.getLatestSemverTag = function () {\n+        var semVerOptions = { loose: true };\n+        var tags = this.runGraceful(['tag', '--sort=-committerdate', '--merged']).stdout.split('\\n');\n+        var latestTag = tags.find(function (tag) { return semver.parse(tag, semVerOptions); });\n+        if (latestTag === undefined) {\n+            throw new Error(\"Unable to find a SemVer matching tag on \\\"\" + this.getCurrentBranchOrRevision() + \"\\\"\");\n+        }\n+        return new semver.SemVer(latestTag, semVerOptions);\n+    };\n+    /** Gets the path of the directory for the repository base. */\n+    GitClient.prototype.getBaseDir = function () {\n+        var previousVerboseLoggingState = this.verboseLogging;\n+        this.setVerboseLoggingState(false);\n+        var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n+        this.setVerboseLoggingState(previousVerboseLoggingState);\n+        if (status !== 0) {\n+            throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n+                \"Was the command run from inside of the repo?\\n\\n\" +\n+                (\"ERROR:\\n \" + stderr));\n+        }\n+        return stdout.trim();\n+    };\n+    /** Retrieve a list of all files in the repostitory changed since the provided shaOrRef. */\n+    GitClient.prototype.allChangesFilesSince = function (shaOrRef) {\n+        if (shaOrRef === void 0) { shaOrRef = 'HEAD'; }\n+        return Array.from(new Set(tslib.__spreadArray(tslib.__spreadArray([], tslib.__read(gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=d', shaOrRef])))), tslib.__read(gitOutputAsArray(this.runGraceful(['ls-files', '--others', '--exclude-standard']))))));\n+    };\n+    /** Retrieve a list of all files currently staged in the repostitory. */\n+    GitClient.prototype.allStagedFiles = function () {\n+        return gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=ACM', '--staged']));\n+    };\n+    /** Retrieve a list of all files tracked in the repostitory. */\n+    GitClient.prototype.allFiles = function () {\n+        return gitOutputAsArray(this.runGraceful(['ls-files']));\n+    };\n+    /**\n+     * Assert the GitClient instance is using a token with permissions for the all of the\n+     * provided OAuth scopes.\n+     */\n+    GitClient.prototype.hasOauthScopes = function (testFn) {\n+        return tslib.__awaiter(this, void 0, void 0, function () {\n+            var scopes, missingScopes, error;\n+            return tslib.__generator(this, function (_a) {\n+                switch (_a.label) {\n+                    case 0: return [4 /*yield*/, this.getAuthScopesForToken()];\n+                    case 1:\n+                        scopes = _a.sent();\n+                        missingScopes = [];\n+                        // Test Github OAuth scopes and collect missing ones.\n+                        testFn(scopes, missingScopes);\n+                        // If no missing scopes are found, return true to indicate all OAuth Scopes are available.\n+                        if (missingScopes.length === 0) {\n+                            return [2 /*return*/, true];\n+                        }\n+                        error = \"The provided <TOKEN> does not have required permissions due to missing scope(s): \" +\n+                            (yellow(missingScopes.join(', ')) + \"\\n\\n\") +\n+                            \"Update the token in use at:\\n\" +\n+                            (\"  \" + GITHUB_TOKEN_SETTINGS_URL + \"\\n\\n\") +\n+                            (\"Alternatively, a new token can be created at: \" + GITHUB_TOKEN_GENERATE_URL + \"\\n\");\n+                        return [2 /*return*/, { error: error }];\n+                }\n+            });\n+        });\n+    };\n+    /**\n+     * Retrieve the OAuth scopes for the loaded Github token.\n+     **/\n+    GitClient.prototype.getAuthScopesForToken = function () {\n+        // If the OAuth scopes have already been loaded, return the Promise containing them.\n+        if (this._cachedOauthScopes !== null) {\n+            return this._cachedOauthScopes;\n+        }\n+        // OAuth scopes are loaded via the /rate_limit endpoint to prevent\n+        // usage of a request against that rate_limit for this lookup.\n+        return this._cachedOauthScopes = this.github.rateLimit.get().then(function (_response) {\n+            var response = _response;\n+            var scopes = response.headers['x-oauth-scopes'] || '';\n+            return scopes.split(',').map(function (scope) { return scope.trim(); });\n+        });\n+    };\n+    GitClient.prototype.determineBaseDir = function () {\n+        this.setVerboseLoggingState(false);\n+        var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n+        if (status !== 0) {\n+            throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n+                \"Was the command run from inside of the repo?\\n\\n\" +\n+                (\"ERROR:\\n \" + stderr));\n+        }\n+        this.setVerboseLoggingState(true);\n+        return stdout.trim();\n+    };\n+    return GitClient;\n+}());\n+/**\n+ * Takes the output from `GitClient.run` and `GitClient.runGraceful` and returns an array of strings\n+ * for each new line. Git commands typically return multiple output values for a command a set of\n+ * strings separated by new lines.\n+ *\n+ * Note: This is specifically created as a locally available function for usage as convience utility\n+ * within `GitClient`'s methods to create outputs as array.\n+ */\n+function gitOutputAsArray(gitCommandResult) {\n+    return gitCommandResult.stdout.split('\\n').map(function (x) { return x.trim(); }).filter(function (x) { return !!x; });\n+}\n \n /**\n  * @license\n@@ -117,21 +571,6 @@ function printToLogFile(logLevel) {\n     var logLevelText = (LOG_LEVELS[logLevel] + \":\").padEnd(LOG_LEVEL_COLUMNS);\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Runs an given command as child process. By default, child process\n- * output will not be printed.\n- */\n-function exec(cmd, opts) {\n-    return shelljs.exec(cmd, tslib.__assign(tslib.__assign({ silent: true }, opts), { async: false }));\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -164,15 +603,12 @@ function isTsNodeAvailable() {\n var CONFIG_FILE_PATH = '.ng-dev/config';\n /** The configuration for ng-dev. */\n var cachedConfig = null;\n-/**\n- * Get the configuration from the file system, returning the already loaded\n- * copy if it is defined.\n- */\n-function getConfig() {\n+function getConfig(baseDir) {\n     // If the global config is not defined, load it from the file system.\n     if (cachedConfig === null) {\n+        baseDir = baseDir || GitClient.getInstance().getBaseDir();\n         // The full path to the configuration file.\n-        var configPath = path.join(getRepoBaseDir(), CONFIG_FILE_PATH);\n+        var configPath = path.join(baseDir, CONFIG_FILE_PATH);\n         // Read the configuration and validate it before caching it for the future.\n         cachedConfig = validateCommonConfig(readConfigFile(configPath));\n     }\n@@ -253,16 +689,6 @@ function assertNoErrors(errors) {\n     }\n     process.exit(1);\n }\n-/** Gets the path of the directory for the repository base. */\n-function getRepoBaseDir() {\n-    var baseRepoDir = exec(\"git rev-parse --show-toplevel\");\n-    if (baseRepoDir.code) {\n-        throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n-            \"Was the command run from inside of the repo?\\n\\n\" +\n-            (\"ERROR:\\n \" + baseRepoDir.stderr));\n-    }\n-    return baseRepoDir.trim();\n-}\n \n /**\n  * @license"
        },
        {
            "sha": "ab7b63c5205477a53a9da2ad77fd322ccc901e78",
            "filename": "dev-infra/caretaker/check/g3.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fg3.spec.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -9,7 +9,7 @@\n import {SpawnSyncReturns} from 'child_process';\n \n import * as console from '../../utils/console';\n-import {GitClient} from '../../utils/git';\n+import {GitClient} from '../../utils/git/index';\n import {installVirtualGitClientSpies, mockNgDevConfig} from '../../utils/testing';\n \n import {G3Module, G3StatsData} from './g3';"
        },
        {
            "sha": "94ec261505eb70cabcd274b9ab06be5203a8b791",
            "filename": "dev-infra/caretaker/check/g3.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fg3.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -10,7 +10,6 @@ import {existsSync, readFileSync} from 'fs';\n import * as multimatch from 'multimatch';\n import {join} from 'path';\n import {parse as parseYaml} from 'yaml';\n-import {getRepoBaseDir} from '../../utils/config';\n import {bold, debug, error, info} from '../../utils/console';\n \n import {BaseModule} from './base';\n@@ -121,7 +120,7 @@ export class G3Module extends BaseModule<G3StatsData|void> {\n \n \n   private getG3FileIncludeAndExcludeLists() {\n-    const angularRobotFilePath = join(getRepoBaseDir(), '.github/angular-robot.yml');\n+    const angularRobotFilePath = join(this.git.baseDir, '.github/angular-robot.yml');\n     if (!existsSync(angularRobotFilePath)) {\n       debug('No angular robot configuration file exists, skipping.');\n       return null;"
        },
        {
            "sha": "5656cc5c16a98ae09758ff7649c687d6abab2771",
            "filename": "dev-infra/commit-message/validate-file/validate-file.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -8,15 +8,16 @@\n import {readFileSync} from 'fs';\n import {resolve} from 'path';\n \n-import {getRepoBaseDir} from '../../utils/config';\n import {error, green, info, log, red, yellow} from '../../utils/console';\n+import {GitClient} from '../../utils/git/index';\n \n import {deleteCommitMessageDraft, saveCommitMessageDraft} from '../restore-commit-message/commit-message-draft';\n import {printValidationErrors, validateCommitMessage} from '../validate';\n \n /** Validate commit message at the provided file path. */\n export function validateFile(filePath: string, isErrorMode: boolean) {\n-  const commitMessage = readFileSync(resolve(getRepoBaseDir(), filePath), 'utf8');\n+  const git = GitClient.getInstance();\n+  const commitMessage = readFileSync(resolve(git.baseDir, filePath), 'utf8');\n   const {valid, errors} = validateCommitMessage(commitMessage);\n   if (valid) {\n     info(`${green('âˆš')}  Valid commit message`);"
        },
        {
            "sha": "cf1e44ee87c629e0acb174327f1af3c4a9f28273",
            "filename": "dev-infra/format/cli.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fcli.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -6,8 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as yargs from 'yargs';\n-\n-import {allChangedFilesSince, allFiles, allStagedFiles} from '../utils/repo-files';\n+import {GitClient} from '../utils/git/index';\n \n import {checkFiles, formatFiles} from './format';\n \n@@ -25,21 +24,24 @@ export function buildFormatParser(localYargs: yargs.Argv) {\n           'all', 'Run the formatter on all files in the repository', args => args,\n           ({check}) => {\n             const executionCmd = check ? checkFiles : formatFiles;\n-            executionCmd(allFiles());\n+            const allFiles = GitClient.getInstance().allFiles();\n+            executionCmd(allFiles);\n           })\n       .command(\n           'changed [shaOrRef]', 'Run the formatter on files changed since the provided sha/ref',\n           args => args.positional('shaOrRef', {type: 'string'}),\n           ({shaOrRef, check}) => {\n             const sha = shaOrRef || 'master';\n             const executionCmd = check ? checkFiles : formatFiles;\n-            executionCmd(allChangedFilesSince(sha));\n+            const allChangedFilesSince = GitClient.getInstance().allChangesFilesSince(sha);\n+            executionCmd(allChangedFilesSince);\n           })\n       .command(\n           'staged', 'Run the formatter on all staged files', args => args,\n           ({check}) => {\n             const executionCmd = check ? checkFiles : formatFiles;\n-            executionCmd(allStagedFiles());\n+            const allStagedFiles = GitClient.getInstance().allStagedFiles();\n+            executionCmd(allStagedFiles);\n           })\n       .command(\n           'files <files..>', 'Run the formatter on provided files',"
        },
        {
            "sha": "b22eb8c9687ba22f337824c2dd318a9957ac7ccc",
            "filename": "dev-infra/format/formatters/base-formatter.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {GitClient} from '../../utils/git/index';\n import {FormatConfig} from '../config';\n \n // A callback to determine if the formatter run found a failure in formatting.\n@@ -24,6 +25,7 @@ interface FormatterActionMetadata {\n  * The base class for formatters to run against provided files.\n  */\n export abstract class Formatter {\n+  protected git = GitClient.getInstance();\n   /**\n    * The name of the formatter, this is used for identification in logging and for enabling and\n    * configuring the formatter in the config."
        },
        {
            "sha": "823200faa77858f34a4a2baddbe5529d82bf4833",
            "filename": "dev-infra/format/formatters/buildifier.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -8,7 +8,6 @@\n \n import {join} from 'path';\n \n-import {getRepoBaseDir} from '../../utils/config';\n import {error} from '../../utils/console';\n \n import {Formatter} from './base-formatter';\n@@ -19,7 +18,7 @@ import {Formatter} from './base-formatter';\n export class Buildifier extends Formatter {\n   name = 'buildifier';\n \n-  binaryFilePath = join(getRepoBaseDir(), 'node_modules/.bin/buildifier');\n+  binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/buildifier');\n \n   defaultFileMatcher = ['**/*.bzl', '**/BUILD.bazel', '**/WORKSPACE', '**/BUILD'];\n "
        },
        {
            "sha": "971893b3361a29dda26bf10a34c8920249d36f90",
            "filename": "dev-infra/format/formatters/clang-format.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -8,7 +8,6 @@\n \n import {join} from 'path';\n \n-import {getRepoBaseDir} from '../../utils/config';\n import {error} from '../../utils/console';\n \n import {Formatter} from './base-formatter';\n@@ -19,7 +18,7 @@ import {Formatter} from './base-formatter';\n export class ClangFormat extends Formatter {\n   name = 'clang-format';\n \n-  binaryFilePath = join(getRepoBaseDir(), 'node_modules/.bin/clang-format');\n+  binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/clang-format');\n \n   defaultFileMatcher = ['**/*.{t,j}s'];\n "
        },
        {
            "sha": "3e13d97362f98a627ea90a7aad373be65aa6a313",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 303,
            "deletions": 302,
            "changes": 605,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -9,41 +9,26 @@ var chalk = _interopDefault(require('chalk'));\n var fs = require('fs');\n var inquirer = require('inquirer');\n var path = require('path');\n-var shelljs = require('shelljs');\n-var url = require('url');\n var child_process = require('child_process');\n var semver = require('semver');\n var graphql = require('@octokit/graphql');\n var Octokit = require('@octokit/rest');\n var typedGraphqlify = require('typed-graphqlify');\n+var url = require('url');\n var fetch = _interopDefault(require('node-fetch'));\n var multimatch = require('multimatch');\n var yaml = require('yaml');\n var conventionalCommitsParser = require('conventional-commits-parser');\n var gitCommits_ = require('git-raw-commits');\n var cliProgress = require('cli-progress');\n var os = require('os');\n+var shelljs = require('shelljs');\n var minimatch = require('minimatch');\n var ora = require('ora');\n require('ejs');\n var glob = require('glob');\n var ts = require('typescript');\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Runs an given command as child process. By default, child process\n- * output will not be printed.\n- */\n-function exec(cmd, opts) {\n-    return shelljs.exec(cmd, tslib.__assign(tslib.__assign({ silent: true }, opts), { async: false }));\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -83,15 +68,12 @@ var cachedConfig = null;\n var USER_CONFIG_FILE_PATH = '.ng-dev.user';\n /** The local user configuration for ng-dev. */\n var userConfig = null;\n-/**\n- * Get the configuration from the file system, returning the already loaded\n- * copy if it is defined.\n- */\n-function getConfig() {\n+function getConfig(baseDir) {\n     // If the global config is not defined, load it from the file system.\n     if (cachedConfig === null) {\n+        baseDir = baseDir || GitClient.getInstance().getBaseDir();\n         // The full path to the configuration file.\n-        var configPath = path.join(getRepoBaseDir(), CONFIG_FILE_PATH);\n+        var configPath = path.join(baseDir, CONFIG_FILE_PATH);\n         // Read the configuration and validate it before caching it for the future.\n         cachedConfig = validateCommonConfig(readConfigFile(configPath));\n     }\n@@ -172,16 +154,6 @@ function assertNoErrors(errors) {\n     }\n     process.exit(1);\n }\n-/** Gets the path of the directory for the repository base. */\n-function getRepoBaseDir() {\n-    var baseRepoDir = exec(\"git rev-parse --show-toplevel\");\n-    if (baseRepoDir.code) {\n-        throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n-            \"Was the command run from inside of the repo?\\n\\n\" +\n-            (\"ERROR:\\n \" + baseRepoDir.stderr));\n-    }\n-    return baseRepoDir.trim();\n-}\n /**\n  * Get the local user configuration from the file system, returning the already loaded copy if it is\n  * defined.\n@@ -192,8 +164,9 @@ function getRepoBaseDir() {\n function getUserConfig() {\n     // If the global config is not defined, load it from the file system.\n     if (userConfig === null) {\n+        var git = GitClient.getInstance();\n         // The full path to the configuration file.\n-        var configPath = path.join(getRepoBaseDir(), USER_CONFIG_FILE_PATH);\n+        var configPath = path.join(git.baseDir, USER_CONFIG_FILE_PATH);\n         // Set the global config object.\n         userConfig = readConfigFile(configPath, true);\n     }\n@@ -202,209 +175,6 @@ function getUserConfig() {\n     return tslib.__assign({}, userConfig);\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** Reexport of chalk colors for convenient access. */\n-var red = chalk.red;\n-var green = chalk.green;\n-var yellow = chalk.yellow;\n-var bold = chalk.bold;\n-var blue = chalk.blue;\n-/** Prompts the user with a confirmation question and a specified message. */\n-function promptConfirm(message, defaultValue) {\n-    if (defaultValue === void 0) { defaultValue = false; }\n-    return tslib.__awaiter(this, void 0, void 0, function () {\n-        return tslib.__generator(this, function (_a) {\n-            switch (_a.label) {\n-                case 0: return [4 /*yield*/, inquirer.prompt({\n-                        type: 'confirm',\n-                        name: 'result',\n-                        message: message,\n-                        default: defaultValue,\n-                    })];\n-                case 1: return [2 /*return*/, (_a.sent())\n-                        .result];\n-            }\n-        });\n-    });\n-}\n-/**\n- * Supported levels for logging functions.\n- *\n- * Levels are mapped to numbers to represent a hierarchy of logging levels.\n- */\n-var LOG_LEVELS;\n-(function (LOG_LEVELS) {\n-    LOG_LEVELS[LOG_LEVELS[\"SILENT\"] = 0] = \"SILENT\";\n-    LOG_LEVELS[LOG_LEVELS[\"ERROR\"] = 1] = \"ERROR\";\n-    LOG_LEVELS[LOG_LEVELS[\"WARN\"] = 2] = \"WARN\";\n-    LOG_LEVELS[LOG_LEVELS[\"LOG\"] = 3] = \"LOG\";\n-    LOG_LEVELS[LOG_LEVELS[\"INFO\"] = 4] = \"INFO\";\n-    LOG_LEVELS[LOG_LEVELS[\"DEBUG\"] = 5] = \"DEBUG\";\n-})(LOG_LEVELS || (LOG_LEVELS = {}));\n-/** Default log level for the tool. */\n-var DEFAULT_LOG_LEVEL = LOG_LEVELS.INFO;\n-/** Write to the console for at INFO logging level */\n-var info = buildLogLevelFunction(function () { return console.info; }, LOG_LEVELS.INFO);\n-/** Write to the console for at ERROR logging level */\n-var error = buildLogLevelFunction(function () { return console.error; }, LOG_LEVELS.ERROR);\n-/** Write to the console for at DEBUG logging level */\n-var debug = buildLogLevelFunction(function () { return console.debug; }, LOG_LEVELS.DEBUG);\n-/** Write to the console for at LOG logging level */\n-// tslint:disable-next-line: no-console\n-var log = buildLogLevelFunction(function () { return console.log; }, LOG_LEVELS.LOG);\n-/** Write to the console for at WARN logging level */\n-var warn = buildLogLevelFunction(function () { return console.warn; }, LOG_LEVELS.WARN);\n-/** Build an instance of a logging function for the provided level. */\n-function buildLogLevelFunction(loadCommand, level) {\n-    /** Write to stdout for the LOG_LEVEL. */\n-    var loggingFunction = function () {\n-        var text = [];\n-        for (var _i = 0; _i < arguments.length; _i++) {\n-            text[_i] = arguments[_i];\n-        }\n-        runConsoleCommand.apply(void 0, tslib.__spreadArray([loadCommand, level], tslib.__read(text)));\n-    };\n-    /** Start a group at the LOG_LEVEL, optionally starting it as collapsed. */\n-    loggingFunction.group = function (text, collapsed) {\n-        if (collapsed === void 0) { collapsed = false; }\n-        var command = collapsed ? console.groupCollapsed : console.group;\n-        runConsoleCommand(function () { return command; }, level, text);\n-    };\n-    /** End the group at the LOG_LEVEL. */\n-    loggingFunction.groupEnd = function () {\n-        runConsoleCommand(function () { return console.groupEnd; }, level);\n-    };\n-    return loggingFunction;\n-}\n-/**\n- * Run the console command provided, if the environments logging level greater than the\n- * provided logging level.\n- *\n- * The loadCommand takes in a function which is called to retrieve the console.* function\n- * to allow for jasmine spies to still work in testing.  Without this method of retrieval\n- * the console.* function, the function is saved into the closure of the created logging\n- * function before jasmine can spy.\n- */\n-function runConsoleCommand(loadCommand, logLevel) {\n-    var text = [];\n-    for (var _i = 2; _i < arguments.length; _i++) {\n-        text[_i - 2] = arguments[_i];\n-    }\n-    if (getLogLevel() >= logLevel) {\n-        loadCommand().apply(void 0, tslib.__spreadArray([], tslib.__read(text)));\n-    }\n-    printToLogFile.apply(void 0, tslib.__spreadArray([logLevel], tslib.__read(text)));\n-}\n-/**\n- * Retrieve the log level from environment variables, if the value found\n- * based on the LOG_LEVEL environment variable is undefined, return the default\n- * logging level.\n- */\n-function getLogLevel() {\n-    var logLevelEnvValue = (process.env[\"LOG_LEVEL\"] || '').toUpperCase();\n-    var logLevel = LOG_LEVELS[logLevelEnvValue];\n-    if (logLevel === undefined) {\n-        return DEFAULT_LOG_LEVEL;\n-    }\n-    return logLevel;\n-}\n-/** All text to write to the log file. */\n-var LOGGED_TEXT = '';\n-/** Whether file logging as been enabled. */\n-var FILE_LOGGING_ENABLED = false;\n-/**\n- * The number of columns used in the prepended log level information on each line of the logging\n- * output file.\n- */\n-var LOG_LEVEL_COLUMNS = 7;\n-/**\n- * Enable writing the logged outputs to the log file on process exit, sets initial lines from the\n- * command execution, containing information about the timing and command parameters.\n- *\n- * This is expected to be called only once during a command run, and should be called by the\n- * middleware of yargs to enable the file logging before the rest of the command parsing and\n- * response is executed.\n- */\n-function captureLogOutputForCommand(argv) {\n-    if (FILE_LOGGING_ENABLED) {\n-        throw Error('`captureLogOutputForCommand` cannot be called multiple times');\n-    }\n-    /** The date time used for timestamping when the command was invoked. */\n-    var now = new Date();\n-    /** Header line to separate command runs in log files. */\n-    var headerLine = Array(100).fill('#').join('');\n-    LOGGED_TEXT += headerLine + \"\\nCommand: \" + argv.$0 + \" \" + argv._.join(' ') + \"\\nRan at: \" + now + \"\\n\";\n-    // On process exit, write the logged output to the appropriate log files\n-    process.on('exit', function (code) {\n-        LOGGED_TEXT += headerLine + \"\\n\";\n-        LOGGED_TEXT += \"Command ran in \" + (new Date().getTime() - now.getTime()) + \"ms\\n\";\n-        LOGGED_TEXT += \"Exit Code: \" + code + \"\\n\";\n-        /** Path to the log file location. */\n-        var logFilePath = path.join(getRepoBaseDir(), '.ng-dev.log');\n-        // Strip ANSI escape codes from log outputs.\n-        LOGGED_TEXT = LOGGED_TEXT.replace(/\\x1B\\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]/g, '');\n-        fs.writeFileSync(logFilePath, LOGGED_TEXT);\n-        // For failure codes greater than 1, the new logged lines should be written to a specific log\n-        // file for the command run failure.\n-        if (code > 1) {\n-            var logFileName = \".ng-dev.err-\" + now.getTime() + \".log\";\n-            console.error(\"Exit code: \" + code + \". Writing full log to \" + logFileName);\n-            fs.writeFileSync(path.join(getRepoBaseDir(), logFileName), LOGGED_TEXT);\n-        }\n-    });\n-    // Mark file logging as enabled to prevent the function from executing multiple times.\n-    FILE_LOGGING_ENABLED = true;\n-}\n-/** Write the provided text to the log file, prepending each line with the log level.  */\n-function printToLogFile(logLevel) {\n-    var text = [];\n-    for (var _i = 1; _i < arguments.length; _i++) {\n-        text[_i - 1] = arguments[_i];\n-    }\n-    var logLevelText = (LOG_LEVELS[logLevel] + \":\").padEnd(LOG_LEVEL_COLUMNS);\n-    LOGGED_TEXT += text.join(' ').split('\\n').map(function (l) { return logLevelText + \" \" + l + \"\\n\"; }).join('');\n-}\n-\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/** URL to the Github page where personal access tokens can be managed. */\n-var GITHUB_TOKEN_SETTINGS_URL = 'https://github.com/settings/tokens';\n-/** URL to the Github page where personal access tokens can be generated. */\n-var GITHUB_TOKEN_GENERATE_URL = 'https://github.com/settings/tokens/new';\n-/** Adds the provided token to the given Github HTTPs remote url. */\n-function addTokenToGitHttpsUrl(githubHttpsUrl, token) {\n-    var url$1 = new url.URL(githubHttpsUrl);\n-    url$1.username = token;\n-    return url$1.href;\n-}\n-/** Gets the repository Git URL for the given github config. */\n-function getRepositoryGitUrl(config, githubToken) {\n-    if (config.useSsh) {\n-        return \"git@github.com:\" + config.owner + \"/\" + config.name + \".git\";\n-    }\n-    var baseHttpUrl = \"https://github.com/\" + config.owner + \"/\" + config.name + \".git\";\n-    if (githubToken !== undefined) {\n-        return addTokenToGitHttpsUrl(baseHttpUrl, githubToken);\n-    }\n-    return baseHttpUrl;\n-}\n-/** Gets a Github URL that refers to a list of recent commits within a specified branch. */\n-function getListCommitsInBranchUrl(_a, branchName) {\n-    var remoteParams = _a.remoteParams;\n-    return \"https://github.com/\" + remoteParams.owner + \"/\" + remoteParams.repo + \"/commits/\" + branchName;\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -531,6 +301,40 @@ var GithubClient = /** @class */ (function (_super) {\n     return GithubClient;\n }(Octokit));\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** URL to the Github page where personal access tokens can be managed. */\n+var GITHUB_TOKEN_SETTINGS_URL = 'https://github.com/settings/tokens';\n+/** URL to the Github page where personal access tokens can be generated. */\n+var GITHUB_TOKEN_GENERATE_URL = 'https://github.com/settings/tokens/new';\n+/** Adds the provided token to the given Github HTTPs remote url. */\n+function addTokenToGitHttpsUrl(githubHttpsUrl, token) {\n+    var url$1 = new url.URL(githubHttpsUrl);\n+    url$1.username = token;\n+    return url$1.href;\n+}\n+/** Gets the repository Git URL for the given github config. */\n+function getRepositoryGitUrl(config, githubToken) {\n+    if (config.useSsh) {\n+        return \"git@github.com:\" + config.owner + \"/\" + config.name + \".git\";\n+    }\n+    var baseHttpUrl = \"https://github.com/\" + config.owner + \"/\" + config.name + \".git\";\n+    if (githubToken !== undefined) {\n+        return addTokenToGitHttpsUrl(baseHttpUrl, githubToken);\n+    }\n+    return baseHttpUrl;\n+}\n+/** Gets a Github URL that refers to a list of recent commits within a specified branch. */\n+function getListCommitsInBranchUrl(_a, branchName) {\n+    var remoteParams = _a.remoteParams;\n+    return \"https://github.com/\" + remoteParams.owner + \"/\" + remoteParams.repo + \"/commits/\" + branchName;\n+}\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -565,14 +369,10 @@ var GitClient = /** @class */ (function () {\n     /**\n      * @param githubToken The github token used for authentication, if provided.\n      * @param _config The configuration, containing the github specific configuration.\n-     * @param _projectRoot The full path to the root of the repository base.\n+     * @param baseDir The full path to the root of the repository base.\n      */\n-    function GitClient(githubToken, _config, _projectRoot) {\n-        if (_config === void 0) { _config = getConfig(); }\n-        if (_projectRoot === void 0) { _projectRoot = getRepoBaseDir(); }\n+    function GitClient(githubToken, config, baseDir) {\n         this.githubToken = githubToken;\n-        this._config = _config;\n-        this._projectRoot = _projectRoot;\n         /** Whether verbose logging of Git actions should be used. */\n         this.verboseLogging = true;\n         /** The OAuth scopes available for the provided Github token. */\n@@ -582,12 +382,12 @@ var GitClient = /** @class */ (function () {\n          * sanitizing the token from Git child process output.\n          */\n         this._githubTokenRegex = null;\n-        /** Short-hand for accessing the default remote configuration. */\n-        this.remoteConfig = this._config.github;\n-        /** Octokit request parameters object for targeting the configured remote. */\n-        this.remoteParams = { owner: this.remoteConfig.owner, repo: this.remoteConfig.name };\n-        /** Instance of the authenticated Github octokit API. */\n+        /** Instance of the Github octokit API. */\n         this.github = new GithubClient(this.githubToken);\n+        this.baseDir = baseDir || this.determineBaseDir();\n+        this.config = config || getConfig(this.baseDir);\n+        this.remoteConfig = this.config.github;\n+        this.remoteParams = { owner: this.remoteConfig.owner, repo: this.remoteConfig.name };\n         // If a token has been specified (and is not empty), pass it to the Octokit API and\n         // also create a regular expression that can be used for sanitizing Git command output\n         // so that it does not print the token accidentally.\n@@ -657,7 +457,7 @@ var GitClient = /** @class */ (function () {\n         // Note that we do not want to print the token if it is contained in the command. It's common\n         // to share errors with others if the tool failed, and we do not want to leak tokens.\n         printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n-        var result = child_process.spawnSync('git', args, tslib.__assign(tslib.__assign({ cwd: this._projectRoot, stdio: 'pipe' }, options), { \n+        var result = child_process.spawnSync('git', args, tslib.__assign(tslib.__assign({ cwd: this.baseDir, stdio: 'pipe' }, options), { \n             // Encoding is always `utf8` and not overridable. This ensures that this method\n             // always returns `string` as output instead of buffers.\n             encoding: 'utf8' }));\n@@ -733,6 +533,32 @@ var GitClient = /** @class */ (function () {\n         }\n         return new semver.SemVer(latestTag, semVerOptions);\n     };\n+    /** Gets the path of the directory for the repository base. */\n+    GitClient.prototype.getBaseDir = function () {\n+        var previousVerboseLoggingState = this.verboseLogging;\n+        this.setVerboseLoggingState(false);\n+        var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n+        this.setVerboseLoggingState(previousVerboseLoggingState);\n+        if (status !== 0) {\n+            throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n+                \"Was the command run from inside of the repo?\\n\\n\" +\n+                (\"ERROR:\\n \" + stderr));\n+        }\n+        return stdout.trim();\n+    };\n+    /** Retrieve a list of all files in the repostitory changed since the provided shaOrRef. */\n+    GitClient.prototype.allChangesFilesSince = function (shaOrRef) {\n+        if (shaOrRef === void 0) { shaOrRef = 'HEAD'; }\n+        return Array.from(new Set(tslib.__spreadArray(tslib.__spreadArray([], tslib.__read(gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=d', shaOrRef])))), tslib.__read(gitOutputAsArray(this.runGraceful(['ls-files', '--others', '--exclude-standard']))))));\n+    };\n+    /** Retrieve a list of all files currently staged in the repostitory. */\n+    GitClient.prototype.allStagedFiles = function () {\n+        return gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=ACM', '--staged']));\n+    };\n+    /** Retrieve a list of all files tracked in the repostitory. */\n+    GitClient.prototype.allFiles = function () {\n+        return gitOutputAsArray(this.runGraceful(['ls-files']));\n+    };\n     /**\n      * Assert the GitClient instance is using a token with permissions for the all of the\n      * provided OAuth scopes.\n@@ -778,8 +604,200 @@ var GitClient = /** @class */ (function () {\n             return scopes.split(',').map(function (scope) { return scope.trim(); });\n         });\n     };\n+    GitClient.prototype.determineBaseDir = function () {\n+        this.setVerboseLoggingState(false);\n+        var _a = this.runGraceful(['rev-parse', '--show-toplevel']), stdout = _a.stdout, stderr = _a.stderr, status = _a.status;\n+        if (status !== 0) {\n+            throw Error(\"Unable to find the path to the base directory of the repository.\\n\" +\n+                \"Was the command run from inside of the repo?\\n\\n\" +\n+                (\"ERROR:\\n \" + stderr));\n+        }\n+        this.setVerboseLoggingState(true);\n+        return stdout.trim();\n+    };\n     return GitClient;\n }());\n+/**\n+ * Takes the output from `GitClient.run` and `GitClient.runGraceful` and returns an array of strings\n+ * for each new line. Git commands typically return multiple output values for a command a set of\n+ * strings separated by new lines.\n+ *\n+ * Note: This is specifically created as a locally available function for usage as convience utility\n+ * within `GitClient`'s methods to create outputs as array.\n+ */\n+function gitOutputAsArray(gitCommandResult) {\n+    return gitCommandResult.stdout.split('\\n').map(function (x) { return x.trim(); }).filter(function (x) { return !!x; });\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Reexport of chalk colors for convenient access. */\n+var red = chalk.red;\n+var green = chalk.green;\n+var yellow = chalk.yellow;\n+var bold = chalk.bold;\n+var blue = chalk.blue;\n+/** Prompts the user with a confirmation question and a specified message. */\n+function promptConfirm(message, defaultValue) {\n+    if (defaultValue === void 0) { defaultValue = false; }\n+    return tslib.__awaiter(this, void 0, void 0, function () {\n+        return tslib.__generator(this, function (_a) {\n+            switch (_a.label) {\n+                case 0: return [4 /*yield*/, inquirer.prompt({\n+                        type: 'confirm',\n+                        name: 'result',\n+                        message: message,\n+                        default: defaultValue,\n+                    })];\n+                case 1: return [2 /*return*/, (_a.sent())\n+                        .result];\n+            }\n+        });\n+    });\n+}\n+/**\n+ * Supported levels for logging functions.\n+ *\n+ * Levels are mapped to numbers to represent a hierarchy of logging levels.\n+ */\n+var LOG_LEVELS;\n+(function (LOG_LEVELS) {\n+    LOG_LEVELS[LOG_LEVELS[\"SILENT\"] = 0] = \"SILENT\";\n+    LOG_LEVELS[LOG_LEVELS[\"ERROR\"] = 1] = \"ERROR\";\n+    LOG_LEVELS[LOG_LEVELS[\"WARN\"] = 2] = \"WARN\";\n+    LOG_LEVELS[LOG_LEVELS[\"LOG\"] = 3] = \"LOG\";\n+    LOG_LEVELS[LOG_LEVELS[\"INFO\"] = 4] = \"INFO\";\n+    LOG_LEVELS[LOG_LEVELS[\"DEBUG\"] = 5] = \"DEBUG\";\n+})(LOG_LEVELS || (LOG_LEVELS = {}));\n+/** Default log level for the tool. */\n+var DEFAULT_LOG_LEVEL = LOG_LEVELS.INFO;\n+/** Write to the console for at INFO logging level */\n+var info = buildLogLevelFunction(function () { return console.info; }, LOG_LEVELS.INFO);\n+/** Write to the console for at ERROR logging level */\n+var error = buildLogLevelFunction(function () { return console.error; }, LOG_LEVELS.ERROR);\n+/** Write to the console for at DEBUG logging level */\n+var debug = buildLogLevelFunction(function () { return console.debug; }, LOG_LEVELS.DEBUG);\n+/** Write to the console for at LOG logging level */\n+// tslint:disable-next-line: no-console\n+var log = buildLogLevelFunction(function () { return console.log; }, LOG_LEVELS.LOG);\n+/** Write to the console for at WARN logging level */\n+var warn = buildLogLevelFunction(function () { return console.warn; }, LOG_LEVELS.WARN);\n+/** Build an instance of a logging function for the provided level. */\n+function buildLogLevelFunction(loadCommand, level) {\n+    /** Write to stdout for the LOG_LEVEL. */\n+    var loggingFunction = function () {\n+        var text = [];\n+        for (var _i = 0; _i < arguments.length; _i++) {\n+            text[_i] = arguments[_i];\n+        }\n+        runConsoleCommand.apply(void 0, tslib.__spreadArray([loadCommand, level], tslib.__read(text)));\n+    };\n+    /** Start a group at the LOG_LEVEL, optionally starting it as collapsed. */\n+    loggingFunction.group = function (text, collapsed) {\n+        if (collapsed === void 0) { collapsed = false; }\n+        var command = collapsed ? console.groupCollapsed : console.group;\n+        runConsoleCommand(function () { return command; }, level, text);\n+    };\n+    /** End the group at the LOG_LEVEL. */\n+    loggingFunction.groupEnd = function () {\n+        runConsoleCommand(function () { return console.groupEnd; }, level);\n+    };\n+    return loggingFunction;\n+}\n+/**\n+ * Run the console command provided, if the environments logging level greater than the\n+ * provided logging level.\n+ *\n+ * The loadCommand takes in a function which is called to retrieve the console.* function\n+ * to allow for jasmine spies to still work in testing.  Without this method of retrieval\n+ * the console.* function, the function is saved into the closure of the created logging\n+ * function before jasmine can spy.\n+ */\n+function runConsoleCommand(loadCommand, logLevel) {\n+    var text = [];\n+    for (var _i = 2; _i < arguments.length; _i++) {\n+        text[_i - 2] = arguments[_i];\n+    }\n+    if (getLogLevel() >= logLevel) {\n+        loadCommand().apply(void 0, tslib.__spreadArray([], tslib.__read(text)));\n+    }\n+    printToLogFile.apply(void 0, tslib.__spreadArray([logLevel], tslib.__read(text)));\n+}\n+/**\n+ * Retrieve the log level from environment variables, if the value found\n+ * based on the LOG_LEVEL environment variable is undefined, return the default\n+ * logging level.\n+ */\n+function getLogLevel() {\n+    var logLevelEnvValue = (process.env[\"LOG_LEVEL\"] || '').toUpperCase();\n+    var logLevel = LOG_LEVELS[logLevelEnvValue];\n+    if (logLevel === undefined) {\n+        return DEFAULT_LOG_LEVEL;\n+    }\n+    return logLevel;\n+}\n+/** All text to write to the log file. */\n+var LOGGED_TEXT = '';\n+/** Whether file logging as been enabled. */\n+var FILE_LOGGING_ENABLED = false;\n+/**\n+ * The number of columns used in the prepended log level information on each line of the logging\n+ * output file.\n+ */\n+var LOG_LEVEL_COLUMNS = 7;\n+/**\n+ * Enable writing the logged outputs to the log file on process exit, sets initial lines from the\n+ * command execution, containing information about the timing and command parameters.\n+ *\n+ * This is expected to be called only once during a command run, and should be called by the\n+ * middleware of yargs to enable the file logging before the rest of the command parsing and\n+ * response is executed.\n+ */\n+function captureLogOutputForCommand(argv) {\n+    if (FILE_LOGGING_ENABLED) {\n+        throw Error('`captureLogOutputForCommand` cannot be called multiple times');\n+    }\n+    var git = GitClient.getInstance();\n+    /** The date time used for timestamping when the command was invoked. */\n+    var now = new Date();\n+    /** Header line to separate command runs in log files. */\n+    var headerLine = Array(100).fill('#').join('');\n+    LOGGED_TEXT += headerLine + \"\\nCommand: \" + argv.$0 + \" \" + argv._.join(' ') + \"\\nRan at: \" + now + \"\\n\";\n+    // On process exit, write the logged output to the appropriate log files\n+    process.on('exit', function (code) {\n+        LOGGED_TEXT += headerLine + \"\\n\";\n+        LOGGED_TEXT += \"Command ran in \" + (new Date().getTime() - now.getTime()) + \"ms\\n\";\n+        LOGGED_TEXT += \"Exit Code: \" + code + \"\\n\";\n+        /** Path to the log file location. */\n+        var logFilePath = path.join(git.baseDir, '.ng-dev.log');\n+        // Strip ANSI escape codes from log outputs.\n+        LOGGED_TEXT = LOGGED_TEXT.replace(/\\x1B\\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]/g, '');\n+        fs.writeFileSync(logFilePath, LOGGED_TEXT);\n+        // For failure codes greater than 1, the new logged lines should be written to a specific log\n+        // file for the command run failure.\n+        if (code > 1) {\n+            var logFileName = \".ng-dev.err-\" + now.getTime() + \".log\";\n+            console.error(\"Exit code: \" + code + \". Writing full log to \" + logFileName);\n+            fs.writeFileSync(path.join(git.baseDir, logFileName), LOGGED_TEXT);\n+        }\n+    });\n+    // Mark file logging as enabled to prevent the function from executing multiple times.\n+    FILE_LOGGING_ENABLED = true;\n+}\n+/** Write the provided text to the log file, prepending each line with the log level.  */\n+function printToLogFile(logLevel) {\n+    var text = [];\n+    for (var _i = 1; _i < arguments.length; _i++) {\n+        text[_i - 1] = arguments[_i];\n+    }\n+    var logLevelText = (LOG_LEVELS[logLevel] + \":\").padEnd(LOG_LEVEL_COLUMNS);\n+    LOGGED_TEXT += text.join(' ').split('\\n').map(function (l) { return logLevelText + \" \" + l + \"\\n\"; }).join('');\n+}\n \n /**\n  * @license\n@@ -1318,7 +1336,7 @@ class G3Module extends BaseModule {\n     }\n     getG3FileIncludeAndExcludeLists() {\n         var _a, _b, _c, _d;\n-        const angularRobotFilePath = path.join(getRepoBaseDir(), '.github/angular-robot.yml');\n+        const angularRobotFilePath = path.join(this.git.baseDir, '.github/angular-robot.yml');\n         if (!fs.existsSync(angularRobotFilePath)) {\n             debug('No angular robot configuration file exists, skipping.');\n             return null;\n@@ -2059,7 +2077,8 @@ function printValidationErrors(errors, print = error) {\n  */\n /** Validate commit message at the provided file path. */\n function validateFile(filePath, isErrorMode) {\n-    const commitMessage = fs.readFileSync(path.resolve(getRepoBaseDir(), filePath), 'utf8');\n+    const git = GitClient.getInstance();\n+    const commitMessage = fs.readFileSync(path.resolve(git.baseDir, filePath), 'utf8');\n     const { valid, errors } = validateCommitMessage(commitMessage);\n     if (valid) {\n         info(`${green('âˆš')}  Valid commit message`);\n@@ -2260,47 +2279,6 @@ function buildCommitMessageParser(localYargs) {\n         .command(ValidateRangeModule);\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * A list of all files currently in the repo which have been modified since the provided sha.\n- *\n- * git diff\n- * Deleted files (--diff-filter=d) are not included as they are not longer present in the repo\n- * and can not be checked anymore.\n- *\n- * git ls-files\n- * Untracked files (--others), which are not matched by .gitignore (--exclude-standard)\n- * as they are expected to become tracked files.\n- */\n-function allChangedFilesSince(sha) {\n-    if (sha === void 0) { sha = 'HEAD'; }\n-    var diffFiles = gitOutputAsArray(\"git diff --name-only --diff-filter=d \" + sha);\n-    var untrackedFiles = gitOutputAsArray(\"git ls-files --others --exclude-standard\");\n-    // Use a set to deduplicate the list as its possible for a file to show up in both lists.\n-    return Array.from(new Set(tslib.__spreadArray(tslib.__spreadArray([], tslib.__read(diffFiles)), tslib.__read(untrackedFiles))));\n-}\n-/**\n- * A list of all staged files which have been modified.\n- *\n- * Only added, created and modified files are listed as others (deleted, renamed, etc) aren't\n- * changed or available as content to act upon.\n- */\n-function allStagedFiles() {\n-    return gitOutputAsArray(\"git diff --staged --name-only --diff-filter=ACM\");\n-}\n-function allFiles() {\n-    return gitOutputAsArray(\"git ls-files\");\n-}\n-function gitOutputAsArray(cmd) {\n-    return exec(cmd, { cwd: getRepoBaseDir() }).split('\\n').map(function (x) { return x.trim(); }).filter(function (x) { return !!x; });\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -2351,6 +2329,7 @@ function checkFormatterConfig(key, config, errors) {\n class Formatter {\n     constructor(config) {\n         this.config = config;\n+        this.git = GitClient.getInstance();\n     }\n     /**\n      * Retrieve the command to execute the provided action, including both the binary\n@@ -2414,7 +2393,7 @@ class Buildifier extends Formatter {\n     constructor() {\n         super(...arguments);\n         this.name = 'buildifier';\n-        this.binaryFilePath = path.join(getRepoBaseDir(), 'node_modules/.bin/buildifier');\n+        this.binaryFilePath = path.join(this.git.baseDir, 'node_modules/.bin/buildifier');\n         this.defaultFileMatcher = ['**/*.bzl', '**/BUILD.bazel', '**/WORKSPACE', '**/BUILD'];\n         this.actions = {\n             check: {\n@@ -2459,7 +2438,7 @@ class ClangFormat extends Formatter {\n     constructor() {\n         super(...arguments);\n         this.name = 'clang-format';\n-        this.binaryFilePath = path.join(getRepoBaseDir(), 'node_modules/.bin/clang-format');\n+        this.binaryFilePath = path.join(this.git.baseDir, 'node_modules/.bin/clang-format');\n         this.defaultFileMatcher = ['**/*.{t,j}s'];\n         this.actions = {\n             check: {\n@@ -2674,16 +2653,19 @@ function buildFormatParser(localYargs) {\n     })\n         .command('all', 'Run the formatter on all files in the repository', args => args, ({ check }) => {\n         const executionCmd = check ? checkFiles : formatFiles;\n-        executionCmd(allFiles());\n+        const allFiles = GitClient.getInstance().allFiles();\n+        executionCmd(allFiles);\n     })\n         .command('changed [shaOrRef]', 'Run the formatter on files changed since the provided sha/ref', args => args.positional('shaOrRef', { type: 'string' }), ({ shaOrRef, check }) => {\n         const sha = shaOrRef || 'master';\n         const executionCmd = check ? checkFiles : formatFiles;\n-        executionCmd(allChangedFilesSince(sha));\n+        const allChangedFilesSince = GitClient.getInstance().allChangesFilesSince(sha);\n+        executionCmd(allChangedFilesSince);\n     })\n         .command('staged', 'Run the formatter on all staged files', args => args, ({ check }) => {\n         const executionCmd = check ? checkFiles : formatFiles;\n-        executionCmd(allStagedFiles());\n+        const allStagedFiles = GitClient.getInstance().allStagedFiles();\n+        executionCmd(allStagedFiles);\n     })\n         .command('files <files..>', 'Run the formatter on provided files', args => args.positional('files', { array: true, type: 'string' }), ({ check, files }) => {\n         const executionCmd = check ? checkFiles : formatFiles;\n@@ -2699,8 +2681,9 @@ function buildFormatParser(localYargs) {\n  * found in the LICENSE file at https://angular.io/license\n  */\n function verify() {\n+    const git = GitClient.getInstance();\n     /** Full path to NgBot config file */\n-    const NGBOT_CONFIG_YAML_PATH = path.resolve(getRepoBaseDir(), '.github/angular-robot.yml');\n+    const NGBOT_CONFIG_YAML_PATH = path.resolve(git.baseDir, '.github/angular-robot.yml');\n     /** The NgBot config file */\n     const ngBotYaml = fs.readFileSync(NGBOT_CONFIG_YAML_PATH, 'utf8');\n     try {\n@@ -3176,6 +3159,21 @@ const CheckoutCommandModule = {\n     describe: 'Checkout a PR from the upstream repo',\n };\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Runs an given command as child process. By default, child process\n+ * output will not be printed.\n+ */\n+function exec(cmd, opts) {\n+    return shelljs.exec(cmd, tslib.__assign(tslib.__assign({ silent: true }, opts), { async: false }));\n+}\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -4965,10 +4963,11 @@ function getGroupsFromYaml(pullApproveYamlRaw) {\n  * found in the LICENSE file at https://angular.io/license\n  */\n function verify$1() {\n+    const git = GitClient.getInstance();\n     /** Full path to PullApprove config file */\n-    const PULL_APPROVE_YAML_PATH = path.resolve(getRepoBaseDir(), '.pullapprove.yml');\n+    const PULL_APPROVE_YAML_PATH = path.resolve(git.baseDir, '.pullapprove.yml');\n     /** All tracked files in the repository. */\n-    const REPO_FILES = allFiles();\n+    const REPO_FILES = git.allFiles();\n     /** The pull approve config file. */\n     const pullApproveYamlRaw = fs.readFileSync(PULL_APPROVE_YAML_PATH, 'utf8');\n     /** All of the groups defined in the pullapprove yaml. */\n@@ -6787,9 +6786,10 @@ function builder$8(argv) {\n /** Yargs command handler for staging a release. */\n function handler$8(args) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n+        const git = GitClient.getInstance();\n         const config = getConfig();\n         const releaseConfig = getReleaseConfig(config);\n-        const projectDir = getRepoBaseDir();\n+        const projectDir = git.baseDir;\n         const task = new ReleaseTool(releaseConfig, config.github, args.githubToken, projectDir);\n         const result = yield task.run();\n         switch (result) {\n@@ -6916,7 +6916,8 @@ function hasLocalChanges() {\n  */\n function getSCMVersion(mode) {\n     if (mode === 'release') {\n-        const packageJsonPath = path.join(getRepoBaseDir(), 'package.json');\n+        const git = GitClient.getInstance();\n+        const packageJsonPath = path.join(git.baseDir, 'package.json');\n         const { version } = require(packageJsonPath);\n         return version;\n     }"
        },
        {
            "sha": "79286e4626064330338833dcba0d6c39c4df70b1",
            "filename": "dev-infra/ngbot/verify.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fngbot%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fngbot%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2Fverify.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -9,12 +9,13 @@ import {readFileSync} from 'fs';\n import {resolve} from 'path';\n import {parse as parseYaml} from 'yaml';\n \n-import {getRepoBaseDir} from '../utils/config';\n import {error, green, info, red} from '../utils/console';\n+import {GitClient} from '../utils/git/index';\n \n export function verify() {\n+  const git = GitClient.getInstance();\n   /** Full path to NgBot config file */\n-  const NGBOT_CONFIG_YAML_PATH = resolve(getRepoBaseDir(), '.github/angular-robot.yml');\n+  const NGBOT_CONFIG_YAML_PATH = resolve(git.baseDir, '.github/angular-robot.yml');\n \n   /** The NgBot config file */\n   const ngBotYaml = readFileSync(NGBOT_CONFIG_YAML_PATH, 'utf8');"
        },
        {
            "sha": "40c01b570d76ca50b3995cf15a0f2b691f1392fa",
            "filename": "dev-infra/pr/merge/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fpr%2Fmerge%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fpr%2Fmerge%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Findex.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n \n-import {getConfig, getRepoBaseDir} from '../../utils/config';\n+import {getConfig} from '../../utils/config';\n import {error, green, info, promptConfirm, red, yellow} from '../../utils/console';\n import {GithubApiRequestError} from '../../utils/git/github';\n import {GITHUB_TOKEN_GENERATE_URL} from '../../utils/git/github-urls';"
        },
        {
            "sha": "a78d0c572eedef885731978744f8ef52eadfc669",
            "filename": "dev-infra/pullapprove/verify.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fpullapprove%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Fpullapprove%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fverify.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -8,17 +8,17 @@\n import {readFileSync} from 'fs';\n import {resolve} from 'path';\n \n-import {getRepoBaseDir} from '../utils/config';\n import {debug, info} from '../utils/console';\n-import {allFiles} from '../utils/repo-files';\n+import {GitClient} from '../utils/git/index';\n import {logGroup, logHeader} from './logging';\n import {getGroupsFromYaml} from './parse-yaml';\n \n export function verify() {\n+  const git = GitClient.getInstance();\n   /** Full path to PullApprove config file */\n-  const PULL_APPROVE_YAML_PATH = resolve(getRepoBaseDir(), '.pullapprove.yml');\n+  const PULL_APPROVE_YAML_PATH = resolve(git.baseDir, '.pullapprove.yml');\n   /** All tracked files in the repository. */\n-  const REPO_FILES = allFiles();\n+  const REPO_FILES = git.allFiles();\n   /** The pull approve config file. */\n   const pullApproveYamlRaw = readFileSync(PULL_APPROVE_YAML_PATH, 'utf8');\n   /** All of the groups defined in the pullapprove yaml. */"
        },
        {
            "sha": "b156a065bea0910a7639db988d93ddcd7e03d8ae",
            "filename": "dev-infra/release/publish/cli.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Frelease%2Fpublish%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Frelease%2Fpublish%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fcli.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -8,9 +8,10 @@\n \n import {Arguments, Argv, CommandModule} from 'yargs';\n \n-import {getConfig, getRepoBaseDir} from '../../utils/config';\n+import {getConfig} from '../../utils/config';\n import {error, green, info, red, yellow} from '../../utils/console';\n import {addGithubTokenOption} from '../../utils/git/github-yargs';\n+import {GitClient} from '../../utils/git/index';\n import {getReleaseConfig} from '../config/index';\n \n import {CompletionState, ReleaseTool} from './index';\n@@ -27,9 +28,10 @@ function builder(argv: Argv): Argv<ReleasePublishOptions> {\n \n /** Yargs command handler for staging a release. */\n async function handler(args: Arguments<ReleasePublishOptions>) {\n+  const git = GitClient.getInstance();\n   const config = getConfig();\n   const releaseConfig = getReleaseConfig(config);\n-  const projectDir = getRepoBaseDir();\n+  const projectDir = git.baseDir;\n   const task = new ReleaseTool(releaseConfig, config.github, args.githubToken, projectDir);\n   const result = await task.run();\n "
        },
        {
            "sha": "695d395711461637de81d0ea85bc425d90276ab5",
            "filename": "dev-infra/release/stamping/env-stamp.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -7,8 +7,8 @@\n  */\n \n import {join} from 'path';\n+import {GitClient} from '../../utils/git/index';\n \n-import {getRepoBaseDir} from '../../utils/config';\n import {exec as _exec} from '../../utils/shelljs';\n \n export type EnvStampMode = 'snapshot'|'release';\n@@ -51,7 +51,8 @@ function hasLocalChanges() {\n  */\n function getSCMVersion(mode: EnvStampMode) {\n   if (mode === 'release') {\n-    const packageJsonPath = join(getRepoBaseDir(), 'package.json');\n+    const git = GitClient.getInstance();\n+    const packageJsonPath = join(git.baseDir, 'package.json');\n     const {version} = require(packageJsonPath);\n     return version;\n   }"
        },
        {
            "sha": "9213fc5fa77677426dd3cd281ccbce4d82b7d82c",
            "filename": "dev-infra/utils/config.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 16,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconfig.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -10,7 +10,7 @@ import {existsSync} from 'fs';\n import {dirname, join} from 'path';\n \n import {debug, error} from './console';\n-import {exec} from './shelljs';\n+import {GitClient} from './git/index';\n import {isTsNodeAvailable} from './ts-node';\n \n /** Configuration for Git client interactions. */\n@@ -64,11 +64,14 @@ let userConfig: {[key: string]: any}|null = null;\n  * Get the configuration from the file system, returning the already loaded\n  * copy if it is defined.\n  */\n-export function getConfig(): NgDevConfig {\n+export function getConfig(): NgDevConfig;\n+export function getConfig(baseDir?: string): NgDevConfig;\n+export function getConfig(baseDir?: string): NgDevConfig {\n   // If the global config is not defined, load it from the file system.\n   if (cachedConfig === null) {\n+    baseDir = baseDir || GitClient.getInstance().getBaseDir();\n     // The full path to the configuration file.\n-    const configPath = join(getRepoBaseDir(), CONFIG_FILE_PATH);\n+    const configPath = join(baseDir, CONFIG_FILE_PATH);\n     // Read the configuration and validate it before caching it for the future.\n     cachedConfig = validateCommonConfig(readConfigFile(configPath));\n   }\n@@ -141,18 +144,6 @@ export function assertNoErrors(errors: string[]) {\n   process.exit(1);\n }\n \n-/** Gets the path of the directory for the repository base. */\n-export function getRepoBaseDir() {\n-  const baseRepoDir = exec(`git rev-parse --show-toplevel`);\n-  if (baseRepoDir.code) {\n-    throw Error(\n-        `Unable to find the path to the base directory of the repository.\\n` +\n-        `Was the command run from inside of the repo?\\n\\n` +\n-        `ERROR:\\n ${baseRepoDir.stderr}`);\n-  }\n-  return baseRepoDir.trim();\n-}\n-\n /**\n  * Get the local user configuration from the file system, returning the already loaded copy if it is\n  * defined.\n@@ -163,8 +154,9 @@ export function getRepoBaseDir() {\n export function getUserConfig() {\n   // If the global config is not defined, load it from the file system.\n   if (userConfig === null) {\n+    const git = GitClient.getInstance();\n     // The full path to the configuration file.\n-    const configPath = join(getRepoBaseDir(), USER_CONFIG_FILE_PATH);\n+    const configPath = join(git.baseDir, USER_CONFIG_FILE_PATH);\n     // Set the global config object.\n     userConfig = readConfigFile(configPath, true);\n   }"
        },
        {
            "sha": "456d580e5bcc6e00864e09ed5b5b5fbc9271655f",
            "filename": "dev-infra/utils/console.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fconsole.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fconsole.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconsole.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -12,7 +12,7 @@ import {prompt} from 'inquirer';\n import {join} from 'path';\n import {Arguments} from 'yargs';\n \n-import {getRepoBaseDir} from './config';\n+import {GitClient} from './git/index';\n \n /** Reexport of chalk colors for convenient access. */\n export const red: typeof chalk = chalk.red;\n@@ -143,6 +143,8 @@ export function captureLogOutputForCommand(argv: Arguments) {\n   if (FILE_LOGGING_ENABLED) {\n     throw Error('`captureLogOutputForCommand` cannot be called multiple times');\n   }\n+\n+  const git = GitClient.getInstance();\n   /** The date time used for timestamping when the command was invoked. */\n   const now = new Date();\n   /** Header line to separate command runs in log files. */\n@@ -155,7 +157,7 @@ export function captureLogOutputForCommand(argv: Arguments) {\n     LOGGED_TEXT += `Command ran in ${new Date().getTime() - now.getTime()}ms\\n`;\n     LOGGED_TEXT += `Exit Code: ${code}\\n`;\n     /** Path to the log file location. */\n-    const logFilePath = join(getRepoBaseDir(), '.ng-dev.log');\n+    const logFilePath = join(git.baseDir, '.ng-dev.log');\n \n     // Strip ANSI escape codes from log outputs.\n     LOGGED_TEXT = LOGGED_TEXT.replace(/\\x1B\\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]/g, '');\n@@ -167,7 +169,7 @@ export function captureLogOutputForCommand(argv: Arguments) {\n     if (code > 1) {\n       const logFileName = `.ng-dev.err-${now.getTime()}.log`;\n       console.error(`Exit code: ${code}. Writing full log to ${logFileName}`);\n-      writeFileSync(join(getRepoBaseDir(), logFileName), LOGGED_TEXT);\n+      writeFileSync(join(git.baseDir, logFileName), LOGGED_TEXT);\n     }\n   });\n "
        },
        {
            "sha": "d44c3afaed2af53b9fd0d496f0e2f5c18b84b288",
            "filename": "dev-infra/utils/git/index.ts",
            "status": "modified",
            "additions": 77,
            "deletions": 11,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fgit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/dd4c3dba3f402c6db118dc950cd82d05fc2bd27d/dev-infra%2Futils%2Fgit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Findex.ts?ref=dd4c3dba3f402c6db118dc950cd82d05fc2bd27d",
            "patch": "@@ -10,7 +10,7 @@ import * as Octokit from '@octokit/rest';\n import {spawnSync, SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n import {Options as SemVerOptions, parse, SemVer} from 'semver';\n \n-import {getConfig, getRepoBaseDir} from '../config';\n+import {getConfig, GithubConfig, NgDevConfig} from '../config';\n import {debug, info, yellow} from '../console';\n import {DryRunError, isDryRun} from '../dry-run';\n import {GithubClient} from './github';\n@@ -83,7 +83,8 @@ export class GitClient<Authenticated extends boolean> {\n     GitClient.authenticated = new GitClient(token);\n   }\n \n-\n+  /** The configuration, containing the github specific configuration. */\n+  private config: NgDevConfig;\n   /** Whether verbose logging of Git actions should be used. */\n   private verboseLogging = true;\n   /** The OAuth scopes available for the provided Github token. */\n@@ -94,21 +95,27 @@ export class GitClient<Authenticated extends boolean> {\n    */\n   private _githubTokenRegex: RegExp|null = null;\n   /** Short-hand for accessing the default remote configuration. */\n-  remoteConfig = this._config.github;\n+  remoteConfig: GithubConfig;\n   /** Octokit request parameters object for targeting the configured remote. */\n-  remoteParams = {owner: this.remoteConfig.owner, repo: this.remoteConfig.name};\n-  /** Instance of the authenticated Github octokit API. */\n+  remoteParams: {owner: string, repo: string};\n+  /** Instance of the Github octokit API. */\n   github = new GithubClient(this.githubToken);\n+  /** The full path to the root of the repository base. */\n+  baseDir: string;\n \n   /**\n    * @param githubToken The github token used for authentication, if provided.\n    * @param _config The configuration, containing the github specific configuration.\n-   * @param _projectRoot The full path to the root of the repository base.\n+   * @param baseDir The full path to the root of the repository base.\n    */\n-  protected constructor(public githubToken:\n-                            Authenticated extends true? string: undefined,\n-                                                  private _config = getConfig(),\n-                                                  private _projectRoot = getRepoBaseDir()) {\n+  protected constructor(public githubToken: Authenticated extends true? string: undefined,\n+                                                                  config?: NgDevConfig,\n+                                                                  baseDir?: string) {\n+    this.baseDir = baseDir || this.determineBaseDir();\n+    this.config = config || getConfig(this.baseDir);\n+    this.remoteConfig = this.config.github;\n+    this.remoteParams = {owner: this.remoteConfig.owner, repo: this.remoteConfig.name};\n+\n     // If a token has been specified (and is not empty), pass it to the Octokit API and\n     // also create a regular expression that can be used for sanitizing Git command output\n     // so that it does not print the token accidentally.\n@@ -157,7 +164,7 @@ export class GitClient<Authenticated extends boolean> {\n     printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n \n     const result = spawnSync('git', args, {\n-      cwd: this._projectRoot,\n+      cwd: this.baseDir,\n       stdio: 'pipe',\n       ...options,\n       // Encoding is always `utf8` and not overridable. This ensures that this method\n@@ -249,6 +256,40 @@ export class GitClient<Authenticated extends boolean> {\n     return new SemVer(latestTag, semVerOptions);\n   }\n \n+  /** Gets the path of the directory for the repository base. */\n+  getBaseDir(): string {\n+    const previousVerboseLoggingState = this.verboseLogging;\n+    this.setVerboseLoggingState(false);\n+    const {stdout, stderr, status} = this.runGraceful(['rev-parse', '--show-toplevel']);\n+    this.setVerboseLoggingState(previousVerboseLoggingState);\n+    if (status !== 0) {\n+      throw Error(\n+          `Unable to find the path to the base directory of the repository.\\n` +\n+          `Was the command run from inside of the repo?\\n\\n` +\n+          `ERROR:\\n ${stderr}`);\n+    }\n+    return stdout.trim();\n+  }\n+\n+  /** Retrieve a list of all files in the repostitory changed since the provided shaOrRef. */\n+  allChangesFilesSince(shaOrRef = 'HEAD'): string[] {\n+    return Array.from(new Set([\n+      ...gitOutputAsArray(this.runGraceful(['diff', '--name-only', '--diff-filter=d', shaOrRef])),\n+      ...gitOutputAsArray(this.runGraceful(['ls-files', '--others', '--exclude-standard'])),\n+    ]));\n+  }\n+\n+  /** Retrieve a list of all files currently staged in the repostitory. */\n+  allStagedFiles(): string[] {\n+    return gitOutputAsArray(\n+        this.runGraceful(['diff', '--name-only', '--diff-filter=ACM', '--staged']));\n+  }\n+\n+  /** Retrieve a list of all files tracked in the repostitory. */\n+  allFiles(): string[] {\n+    return gitOutputAsArray(this.runGraceful(['ls-files']));\n+  }\n+\n   /**\n    * Assert the GitClient instance is using a token with permissions for the all of the\n    * provided OAuth scopes.\n@@ -293,4 +334,29 @@ export class GitClient<Authenticated extends boolean> {\n       return scopes.split(',').map(scope => scope.trim());\n     });\n   }\n+\n+  private determineBaseDir() {\n+    this.setVerboseLoggingState(false);\n+    const {stdout, stderr, status} = this.runGraceful(['rev-parse', '--show-toplevel']);\n+    if (status !== 0) {\n+      throw Error(\n+          `Unable to find the path to the base directory of the repository.\\n` +\n+          `Was the command run from inside of the repo?\\n\\n` +\n+          `ERROR:\\n ${stderr}`);\n+    }\n+    this.setVerboseLoggingState(true);\n+    return stdout.trim();\n+  }\n+}\n+\n+/**\n+ * Takes the output from `GitClient.run` and `GitClient.runGraceful` and returns an array of strings\n+ * for each new line. Git commands typically return multiple output values for a command a set of\n+ * strings separated by new lines.\n+ *\n+ * Note: This is specifically created as a locally available function for usage as convience utility\n+ * within `GitClient`'s methods to create outputs as array.\n+ */\n+function gitOutputAsArray(gitCommandResult: SpawnSyncReturns<string>): string[] {\n+  return gitCommandResult.stdout.split('\\n').map(x => x.trim()).filter(x => !!x);\n }"
        },
        {
            "sha": "b509e90fc0b572553a3d649956a466642d383122",
            "filename": "dev-infra/utils/repo-files.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 49,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/5332a4a9191e557d946eb6f3ccc623819462cf0f/dev-infra%2Futils%2Frepo-files.ts",
            "raw_url": "https://github.com/angular/angular/raw/5332a4a9191e557d946eb6f3ccc623819462cf0f/dev-infra%2Futils%2Frepo-files.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Frepo-files.ts?ref=5332a4a9191e557d946eb6f3ccc623819462cf0f",
            "patch": "@@ -1,49 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {getRepoBaseDir} from './config';\n-import {exec} from './shelljs';\n-\n-/**\n- * A list of all files currently in the repo which have been modified since the provided sha.\n- *\n- * git diff\n- * Deleted files (--diff-filter=d) are not included as they are not longer present in the repo\n- * and can not be checked anymore.\n- *\n- * git ls-files\n- * Untracked files (--others), which are not matched by .gitignore (--exclude-standard)\n- * as they are expected to become tracked files.\n- */\n-export function allChangedFilesSince(sha = 'HEAD') {\n-  const diffFiles = gitOutputAsArray(`git diff --name-only --diff-filter=d ${sha}`);\n-  const untrackedFiles = gitOutputAsArray(`git ls-files --others --exclude-standard`);\n-  // Use a set to deduplicate the list as its possible for a file to show up in both lists.\n-  return Array.from(new Set([...diffFiles, ...untrackedFiles]));\n-}\n-\n-/**\n- * A list of all staged files which have been modified.\n- *\n- * Only added, created and modified files are listed as others (deleted, renamed, etc) aren't\n- * changed or available as content to act upon.\n- */\n-export function allStagedFiles() {\n-  return gitOutputAsArray(`git diff --staged --name-only --diff-filter=ACM`);\n-}\n-\n-\n-\n-export function allFiles() {\n-  return gitOutputAsArray(`git ls-files`);\n-}\n-\n-\n-function gitOutputAsArray(cmd: string) {\n-  return exec(cmd, {cwd: getRepoBaseDir()}).split('\\n').map(x => x.trim()).filter(x => !!x);\n-}"
        }
    ],
    "stats": {
        "total": 1320,
        "additions": 882,
        "deletions": 438
    }
}