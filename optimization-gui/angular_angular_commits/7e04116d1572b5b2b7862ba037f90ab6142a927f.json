{
    "author": "alan-agius4",
    "message": "fix(bazel): enable dts bundling for Ivy packages (#42728)\n\nIt is now possible to bundle DTS files of Ivy libraries since the blocker https://github.com/microsoft/rushstack/issues/1029 has been addressed upstream.\n\nPR Close #42728",
    "sha": "7e04116d1572b5b2b7862ba037f90ab6142a927f",
    "files": [
        {
            "sha": "c8551e83a395ff80c5599e582cd86bdf03722122",
            "filename": "packages/bazel/src/ng_module.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/7e04116d1572b5b2b7862ba037f90ab6142a927f/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "raw_url": "https://github.com/angular/angular/raw/7e04116d1572b5b2b7862ba037f90ab6142a927f/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_module.bzl?ref=7e04116d1572b5b2b7862ba037f90ab6142a927f",
            "patch": "@@ -140,11 +140,7 @@ def _should_produce_dts_bundle(ctx):\n     Returns:\n       true when we should produce bundled dts.\n     \"\"\"\n-\n-    # At the moment we cannot use this with ngtsc compiler since it emits\n-    # import * as ___ from local modules which is not supported\n-    # see: https://github.com/Microsoft/web-build-tools/issues/1029\n-    return _is_view_engine_enabled(ctx) and getattr(ctx.attr, \"bundle_dts\", False)\n+    return getattr(ctx.attr, \"bundle_dts\", False)\n \n def _should_produce_r3_symbols_bundle(ctx):\n     \"\"\"Should we produce r3_symbols bundle."
        },
        {
            "sha": "a8b0f6e64d4fc9a97ae46386dc14d67e1717d59a",
            "filename": "packages/bazel/test/ng_package/core_package.spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 28,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/7e04116d1572b5b2b7862ba037f90ab6142a927f/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7e04116d1572b5b2b7862ba037f90ab6142a927f/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts?ref=7e04116d1572b5b2b7862ba037f90ab6142a927f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {ivyEnabled, obsoleteInIvy} from '@angular/private/testing';\n+import {obsoleteInIvy} from '@angular/private/testing';\n import {runfiles} from '@bazel/runfiles';\n import * as path from 'path';\n import * as shx from 'shelljs';\n@@ -69,22 +69,16 @@ describe('@angular/core ng_package', () => {\n     });\n \n     describe('typescript support', () => {\n-      if (ivyEnabled) {\n-        it('should have an index d.ts file', () => {\n-          expect(shx.cat('core.d.ts')).toContain(`export *`);\n-        });\n-\n-        it('should not have amd module names', () => {\n-          expect(shx.cat('public_api.d.ts')).not.toContain('<amd-module name');\n-        });\n-      } else {\n-        it('should have an index d.ts file', () => {\n-          expect(shx.cat('core.d.ts')).toContain('export declare');\n-        });\n-        it('should have an r3_symbols d.ts file', () => {\n-          expect(shx.cat('src/r3_symbols.d.ts')).toContain('export declare');\n-        });\n-      }\n+      it('should not have amd module names', () => {\n+        expect(shx.cat('core.d.ts')).not.toContain('<amd-module name');\n+      });\n+      it('should have an index d.ts file', () => {\n+        expect(shx.cat('core.d.ts')).toContain('export declare');\n+      });\n+      obsoleteInIvy('we no longer need to export r3_symbols')\n+          .it('should have an r3_symbols d.ts file', () => {\n+            expect(shx.cat('src/r3_symbols.d.ts')).toContain('export declare');\n+          });\n     });\n \n     obsoleteInIvy('metadata files are no longer needed or produced in Ivy')\n@@ -174,17 +168,10 @@ describe('@angular/core ng_package', () => {\n     });\n \n     describe('typings', () => {\n-      if (ivyEnabled) {\n-        const typingsFile = p`testing/index.d.ts`;\n-        it('should have a typings file', () => {\n-          expect(shx.cat(typingsFile)).toContain(`export * from './public_api';`);\n-        });\n-      } else {\n-        const typingsFile = p`testing/testing.d.ts`;\n-        it('should have a typings file', () => {\n-          expect(shx.cat(typingsFile)).toContain('export declare');\n-        });\n-      }\n+      const typingsFile = p`testing/testing.d.ts`;\n+      it('should have a typings file', () => {\n+        expect(shx.cat(typingsFile)).toContain('export declare');\n+      });\n \n       obsoleteInIvy(\n           'now that we don\\'t need metadata files, we don\\'t need these redirects to help resolve paths to them')"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 16,
        "deletions": 33
    }
}