{
    "author": "petebacondarwin",
    "message": "fix(compiler-cli): support namespaced query types in directives (#38959)\n\nPreviously directive \"queries\" that relied upon a namespaced type\n\n```ts\nqueries: {\n  'mcontent': new core.ContentChild('test2'),\n}\n```\n\ncaused an error to be thrown. This is now supported.\n\nPR Close #38959",
    "sha": "2736a43ecb6ed4282655b3ac5d5baf1afd1539b6",
    "files": [
        {
            "sha": "2505b3ef447917268571bcc0604e98ffd25b2f36",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/2736a43ecb6ed4282655b3ac5d5baf1afd1539b6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/2736a43ecb6ed4282655b3ac5d5baf1afd1539b6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=2736a43ecb6ed4282655b3ac5d5baf1afd1539b6",
            "patch": "@@ -463,12 +463,20 @@ export function extractQueriesFromDecorator(\n   }\n   reflectObjectLiteral(queryData).forEach((queryExpr, propertyName) => {\n     queryExpr = unwrapExpression(queryExpr);\n-    if (!ts.isNewExpression(queryExpr) || !ts.isIdentifier(queryExpr.expression)) {\n+    if (!ts.isNewExpression(queryExpr)) {\n       throw new FatalDiagnosticError(\n           ErrorCode.VALUE_HAS_WRONG_TYPE, queryData,\n           'Decorator query metadata must be an instance of a query type');\n     }\n-    const type = reflector.getImportOfIdentifier(queryExpr.expression);\n+    const queryType = ts.isPropertyAccessExpression(queryExpr.expression) ?\n+        queryExpr.expression.name :\n+        queryExpr.expression;\n+    if (!ts.isIdentifier(queryType)) {\n+      throw new FatalDiagnosticError(\n+          ErrorCode.VALUE_HAS_WRONG_TYPE, queryData,\n+          'Decorator query metadata must be an instance of a query type');\n+    }\n+    const type = reflector.getImportOfIdentifier(queryType);\n     if (type === null || (!isCore && type.from !== '@angular/core') ||\n         !QUERY_TYPES.has(type.name)) {\n       throw new FatalDiagnosticError("
        },
        {
            "sha": "2642e233be322bdcb65431f175d792bb58f22308",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2736a43ecb6ed4282655b3ac5d5baf1afd1539b6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2736a43ecb6ed4282655b3ac5d5baf1afd1539b6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=2736a43ecb6ed4282655b3ac5d5baf1afd1539b6",
            "patch": "@@ -3064,12 +3064,13 @@ runInEachFileSystem(os => {\n     it('should generate queries for directives', () => {\n       env.write(`test.ts`, `\n         import {Directive, ContentChild, ContentChildren, TemplateRef, ViewChild} from '@angular/core';\n+        import * as core from '@angular/core';\n \n         @Directive({\n           selector: '[test]',\n           queries: {\n             'mview': new ViewChild('test1'),\n-            'mcontent': new ContentChild('test2'),\n+            'mcontent': new core.ContentChild('test2'),\n           }\n         })\n         class FooCmp {"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 12,
        "deletions": 3
    }
}