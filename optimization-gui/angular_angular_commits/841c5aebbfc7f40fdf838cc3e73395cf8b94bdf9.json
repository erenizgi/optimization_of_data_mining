{
    "author": "gkalpak",
    "message": "build(docs-infra): ensure `ngsw.json` generation is correct and deterministic (#43686)\n\nAs explained in #43679, currently the generation of the `ngsw.json` SW\nmanifest is non-deterministic and often incorrect. Until we can update\nto an `@angular/service-worker` version that includes the fix from\nPR #43679, we temporarily work-around the issue by re-generating the\n`ngsw.json` manifest after `ng build` using the `ngsw-config` binary\nexposed by `@angular/service-worker`.\n\nNOTE:\nThis works around the issue, because the [FileSystem][1] class used by\nthe `ngsw-config` binary happens to be synchronous (unlike the\nimplementation provided by the Angular CLI), thus avoiding the race\nconditions described in #43679.\n\n[1]: https://github.com/angular/angular/blob/c721135e370b34c840756bcfb22c8119b4c8c452/packages/service-worker/cli/filesystem.ts#L15\n\nPR Close #43686",
    "sha": "841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9",
    "files": [
        {
            "sha": "c998831bb3c02ceb078796ef2968accf352b1cd7",
            "filename": "aio/ngsw-config.template.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9/aio%2Fngsw-config.template.json",
            "raw_url": "https://github.com/angular/angular/raw/841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9/aio%2Fngsw-config.template.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fngsw-config.template.json?ref=841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9",
            "patch": "@@ -14,6 +14,9 @@\n           \"/assets/js/*.js\",\n           \"/*.css\",\n           \"/*.js\",\n+          \"!/ngsw-worker.js\",\n+          \"!/safety-worker.js\",\n+          \"!/worker-basic.min.js\"\n         ],\n         \"urls\": [\n           \"https://fonts.googleapis.com/**\","
        },
        {
            "sha": "14e6bd0a8189532b1b3d01c4fa9b5f4a6527c7d3",
            "filename": "aio/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9/aio%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9/aio%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fpackage.json?ref=841c5aebbfc7f40fdf838cc3e73395cf8b94bdf9",
            "patch": "@@ -74,7 +74,7 @@\n     \"~~clean-generated\": \"node --eval \\\"require('shelljs').rm('-rf', 'src/generated')\\\"\",\n     \"pre~~build\": \"node scripts/build-ngsw-config\",\n     \"~~build\": \"ng build --configuration=stable\",\n-    \"post~~build\": \"yarn build-404-page\",\n+    \"post~~build\": \"yarn build-404-page && ngsw-config dist src/generated/ngsw-config.json\",\n     \"~~light-server\": \"light-server --bind=localhost --historyindex=/index.html --no-reload\"\n   },\n   \"//engines-comment\": \"Keep this in sync with /package.json and /aio/tools/examples/shared/package.json\","
        }
    ],
    "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
    }
}