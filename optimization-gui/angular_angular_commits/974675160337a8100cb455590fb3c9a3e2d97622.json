{
    "author": "gkalpak",
    "message": "build(zone.js): use `npm_package.pack` to build the Zone.js package (#40592)\n\nPreviously, we could not use `npm_package.pack` for building the Zone.js\npackage due to a bug in Windows. This bug has been fixed in version\n2.3.0 of `bazelbuild/rules_nodejs`.\n\nNow that we have updated `bazelbuild/rules_nodejs` to version 2.3.3\n(in #40581) we can replace `npm pack` with `npm_package.pack`.\n\nPR Close #40592",
    "sha": "974675160337a8100cb455590fb3c9a3e2d97622",
    "files": [
        {
            "sha": "41108f7088b6f642c75492507e2075fa6dce754d",
            "filename": "scripts/build/zone-js-builder.js",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/974675160337a8100cb455590fb3c9a3e2d97622/scripts%2Fbuild%2Fzone-js-builder.js",
            "raw_url": "https://github.com/angular/angular/raw/974675160337a8100cb455590fb3c9a3e2d97622/scripts%2Fbuild%2Fzone-js-builder.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fzone-js-builder.js?ref=974675160337a8100cb455590fb3c9a3e2d97622",
            "patch": "@@ -35,7 +35,7 @@ function buildZoneJsPackage(destPath) {\n   console.info(`${scriptPath}:`);\n   console.info('  Building zone.js npm package');\n   console.info('##############################');\n-  exec(`${bazelCmd} build //packages/zone.js:npm_package`);\n+  exec(`${bazelCmd} run //packages/zone.js:npm_package.pack`);\n \n   // Create the output directory.\n   const absDestPath = resolve(baseDir, destPath);\n@@ -46,12 +46,6 @@ function buildZoneJsPackage(destPath) {\n   const buildOutputDir = `${bazelBin}/packages/zone.js/npm_package`;\n   const distTargetDir = `${absDestPath}/zone.js`;\n \n-  // Also create an archive so we can test the package itself.\n-  // Currently, the `npm_package.pack` rule does not work on Windows, so run `npm pack` directly.\n-  //\n-  // TODO: Switch to `npm_package.pack`, once we upgrade to `bazelbuild/rules_nodejs` >=2.3.0.\n-  exec(`npm pack ${buildOutputDir}`, false, {cwd: baseDir});\n-\n   console.info(`# Copy npm_package artifacts to ${distTargetDir}`);\n   rm('-rf', distTargetDir);\n   cp('-R', buildOutputDir, distTargetDir);"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 1,
        "deletions": 7
    }
}