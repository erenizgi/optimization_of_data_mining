{
    "author": "gkalpak",
    "message": "ci: check that there are no unused contributor images (#41290)\n\nWhen a contributor was removed from `contributors.json`, the\ncorresponding image should also be removed from\n`aio/content/images/bios/`. However, this was often overlooked,\nresulting in unused images remaining in `aio/content/images/bios/`.\n\nThis commit adds a check to ensure that all images in\n`aio/content/images/bios/` are referenced in `contributors.json`.\n\nPR Close #41290",
    "sha": "80f11a9b86301f140ac04ce2988c384712d58ad3",
    "files": [
        {
            "sha": "895e880c26e645a9172323435f2e34d0cca2eff7",
            "filename": "aio/scripts/contributors/validate-data.js",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/80f11a9b86301f140ac04ce2988c384712d58ad3/aio%2Fscripts%2Fcontributors%2Fvalidate-data.js",
            "raw_url": "https://github.com/angular/angular/raw/80f11a9b86301f140ac04ce2988c384712d58ad3/aio%2Fscripts%2Fcontributors%2Fvalidate-data.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fcontributors%2Fvalidate-data.js?ref=80f11a9b86301f140ac04ce2988c384712d58ad3",
            "patch": "@@ -1,7 +1,7 @@\n #!/usr/bin/env node\n \n // Imports\n-const {existsSync, readFileSync, statSync} = require('fs');\n+const {readdirSync, readFileSync, statSync} = require('fs');\n const {join, resolve} = require('path');\n \n // Constants\n@@ -17,19 +17,29 @@ _main();\n // Functions - Definitions\n function _main() {\n   const contributors = JSON.parse(readFileSync(CONTRIBUTORS_PATH, 'utf8'));\n-\n-  // Check that there are no missing images.\n   const expectedImages = Object.keys(contributors)\n       .filter(key => !!contributors[key].picture)\n       .map(key => join(IMAGES_DIR, contributors[key].picture));\n-  const missingImages = expectedImages.filter(path => !existsSync(path));\n+  const existingImages = readdirSync(IMAGES_DIR)\n+      .filter(name => name !== '_no-one.jpg')\n+      .map(name => join(IMAGES_DIR, name));\n \n+  // Check that there are no missing images.\n+  const missingImages = expectedImages.filter(path => !existingImages.includes(path));\n   if (missingImages.length > 0) {\n     throw new Error(\n         'The following pictures are referenced in \\'contributors.json\\' but do not exist:' +\n         missingImages.map(path => `\\n  - ${path}`).join(''));\n   }\n \n+  // Check that there are no unused images.\n+  const unusedImages = existingImages.filter(path => !expectedImages.includes(path));\n+  if (unusedImages.length > 0) {\n+    throw new Error(\n+        'The following pictures are not referenced in \\'contributors.json\\' and should be deleted:' +\n+        unusedImages.map(path => `\\n  - ${path}`).join(''));\n+  }\n+\n   // Check that there are no images that exceed the size limit.\n   const tooLargeImages = expectedImages.filter(path => statSync(path).size > MAX_IMAGE_SIZE);\n   if (tooLargeImages.length > 0) {"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 14,
        "deletions": 4
    }
}