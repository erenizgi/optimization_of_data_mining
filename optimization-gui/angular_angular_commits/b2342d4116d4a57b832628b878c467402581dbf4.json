{
    "author": "atscott",
    "message": "feat(dev-infra): Add github links to caretaker checks (#39185)\n\nThis commit adds links to the PR/Issue for queries in the caretaker check.\n\nPR Close #39185",
    "sha": "b2342d4116d4a57b832628b878c467402581dbf4",
    "files": [
        {
            "sha": "664e8b539fa62a7d92c9e79cca4120ab06d9fa07",
            "filename": "dev-infra/caretaker/check/github.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 4,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/b2342d4116d4a57b832628b878c467402581dbf4/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/b2342d4116d4a57b832628b878c467402581dbf4/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcaretaker%2Fcheck%2Fgithub.ts?ref=b2342d4116d4a57b832628b878c467402581dbf4",
            "patch": "@@ -6,20 +6,25 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {alias, params, types} from 'typed-graphqlify';\n+import {alias, onUnion, params, types} from 'typed-graphqlify';\n \n import {bold, debug, info} from '../../utils/console';\n import {GitClient} from '../../utils/git';\n import {CaretakerConfig} from '../config';\n \n+/**\n+ * Cap the returned issues in the queries to an arbitrary 100. At that point, caretaker has a lot\n+ * of work to do and showing more than that isn't really useful.\n+ */\n+const MAX_RETURNED_ISSUES = 20;\n \n /** Retrieve the number of matching issues for each github query. */\n export async function printGithubTasks(git: GitClient, config?: CaretakerConfig) {\n   if (!config?.githubQueries?.length) {\n     debug('No github queries defined in the configuration, skipping.');\n     return;\n   }\n-  info.group(bold('Github Tasks'));\n+  info.group(bold(`Github Tasks`));\n   await getGithubInfo(git, config);\n   info.groupEnd();\n   info();\n@@ -28,7 +33,12 @@ export async function printGithubTasks(git: GitClient, config?: CaretakerConfig)\n /** Retrieve query match counts and log discovered counts to the console. */\n async function getGithubInfo(git: GitClient, {githubQueries: queries = []}: CaretakerConfig) {\n   /** The query object for graphql. */\n-  const graphQlQuery: {[key: string]: {issueCount: number}} = {};\n+  const graphQlQuery: {\n+    [key: string]: {\n+      issueCount: number,\n+      nodes: Array<{url: string}>,\n+    }\n+  } = {};\n   /** The Github search filter for the configured repository. */\n   const repoFilter = `repo:${git.remoteConfig.owner}/${git.remoteConfig.name}`;\n   queries.forEach(({name, query}) => {\n@@ -37,14 +47,37 @@ async function getGithubInfo(git: GitClient, {githubQueries: queries = []}: Care\n     graphQlQuery[queryKey] = params(\n         {\n           type: 'ISSUE',\n+          first: MAX_RETURNED_ISSUES,\n           query: `\"${repoFilter} ${query.replace(/\"/g, '\\\\\"')}\"`,\n         },\n-        {issueCount: types.number},\n+        {\n+          issueCount: types.number,\n+          nodes: [{...onUnion({\n+            PullRequest: {\n+              url: types.string,\n+            },\n+            Issue: {\n+              url: types.string,\n+            },\n+          })}],\n+        },\n     );\n   });\n   /** The results of the generated github query. */\n   const results = await git.github.graphql.query(graphQlQuery);\n   Object.values(results).forEach((result, i) => {\n     info(`${queries[i]?.name.padEnd(25)} ${result.issueCount}`);\n+    if (result.issueCount > 0) {\n+      const {owner, name: repo} = git.remoteConfig;\n+      const url = encodeURI(`https://github.com/${owner}/${repo}/issues?q=${queries[i]?.query}`);\n+      info.group(`${url}`);\n+      if (result.nodes.length === MAX_RETURNED_ISSUES && result.nodes.length < result.issueCount) {\n+        info(`(first ${MAX_RETURNED_ISSUES})`);\n+      }\n+      for (const node of result.nodes) {\n+        info(`- ${node.url}`);\n+      }\n+      info.groupEnd();\n+    }\n   });\n }"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 37,
        "deletions": 4
    }
}