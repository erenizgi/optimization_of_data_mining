{
    "author": "sonukapoor",
    "message": "refactor(core): move `injectAttributeImpl` to avoid cycles (#37085)\n\nThis commit moves the `injectAttributeImpl` and other dependent code\nto avoid circular dependencies.\n\nPR Close #37085",
    "sha": "be998e830b59af4236102de0431d6a121c96098d",
    "files": [
        {
            "sha": "3e9bf12faa630311eb1c38ab7f5ad11e33f0cb82",
            "filename": "goldens/circular-deps/packages.json",
            "status": "modified",
            "additions": 0,
            "deletions": 61,
            "changes": 61,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/goldens%2Fcircular-deps%2Fpackages.json",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/goldens%2Fcircular-deps%2Fpackages.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fcircular-deps%2Fpackages.json?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -176,57 +176,6 @@\n     \"packages/core/src/change_detection/differs/default_keyvalue_differ.ts\",\n     \"packages/core/src/change_detection/differs/keyvalue_differs.ts\"\n   ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/injectable.ts\",\n-    \"packages/core/src/di/jit/injectable.ts\",\n-    \"packages/core/src/di/jit/environment.ts\",\n-    \"packages/core/src/di/injector_compatibility.ts\",\n-    \"packages/core/src/di/injector.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/injectable.ts\",\n-    \"packages/core/src/di/jit/injectable.ts\",\n-    \"packages/core/src/di/jit/environment.ts\",\n-    \"packages/core/src/di/injector_compatibility.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/injectable.ts\",\n-    \"packages/core/src/di/jit/injectable.ts\",\n-    \"packages/core/src/di/jit/util.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/reflective_injector.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/reflective_injector.ts\",\n-    \"packages/core/src/di/reflective_provider.ts\",\n-    \"packages/core/src/di/metadata.ts\",\n-    \"packages/core/src/render3/instructions/di.ts\"\n-  ],\n   [\n     \"packages/core/src/di/injectable.ts\",\n     \"packages/core/src/di/jit/injectable.ts\"\n@@ -235,16 +184,6 @@\n     \"packages/core/src/di/injector_compatibility.ts\",\n     \"packages/core/src/di/injector.ts\"\n   ],\n-  [\n-    \"packages/core/src/di/injector_compatibility.ts\",\n-    \"packages/core/src/di/injector.ts\",\n-    \"packages/core/src/di/null_injector.ts\"\n-  ],\n-  [\n-    \"packages/core/src/di/injector_compatibility.ts\",\n-    \"packages/core/src/di/injector.ts\",\n-    \"packages/core/src/di/r3_injector.ts\"\n-  ],\n   [\n     \"packages/core/src/di/injector_token.ts\",\n     \"packages/core/src/di/injector.ts\""
        },
        {
            "sha": "8c01e0540f7075af162d8dbed725d125752d5bc0",
            "filename": "packages/core/src/core_render3_private_export.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -25,11 +25,11 @@ export {\n   SWITCH_COMPILE_INJECTABLE__POST_R3__ as ɵSWITCH_COMPILE_INJECTABLE__POST_R3__,\n } from './di/injectable';\n export {INJECTOR_IMPL__POST_R3__ as ɵINJECTOR_IMPL__POST_R3__} from './di/injector';\n-export {CREATE_ATTRIBUTE_DECORATOR__POST_R3__ as ɵCREATE_ATTRIBUTE_DECORATOR__POST_R3__} from './di/metadata';\n export {\n   NG_INJ_DEF as ɵNG_INJ_DEF,\n   NG_PROV_DEF as ɵNG_PROV_DEF,\n } from './di/interface/defs';\n+export {CREATE_ATTRIBUTE_DECORATOR__POST_R3__ as ɵCREATE_ATTRIBUTE_DECORATOR__POST_R3__} from './di/metadata_attr';\n export {createInjector as ɵcreateInjector} from './di/r3_injector';\n export {\n   SWITCH_IVY_ENABLED__POST_R3__ as ɵSWITCH_IVY_ENABLED__POST_R3__,"
        },
        {
            "sha": "7fa188001604f5d0d7b9d7dbe0fc0d7c0c35f1b0",
            "filename": "packages/core/src/di/jit/util.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -9,7 +9,8 @@\n import {CompilerFacade, getCompilerFacade, R3DependencyMetadataFacade, R3ResolvedDependencyType} from '../../compiler/compiler_facade';\n import {Type} from '../../interface/type';\n import {ReflectionCapabilities} from '../../reflection/reflection_capabilities';\n-import {Attribute, Host, Inject, Optional, Self, SkipSelf} from '../metadata';\n+import {Host, Inject, Optional, Self, SkipSelf} from '../metadata';\n+import {Attribute} from '../metadata_attr';\n \n let _reflect: ReflectionCapabilities|null = null;\n "
        },
        {
            "sha": "d3e9275f03ff1f1857edabda96e0d0118c7b3487",
            "filename": "packages/core/src/di/metadata.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 68,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -7,7 +7,6 @@\n  */\n \n import {makeParamDecorator} from '../util/decorators';\n-import {ɵɵinjectAttribute} from '../render3/instructions/di';\n \n \n /**\n@@ -229,70 +228,3 @@ export interface Host {}\n  * @publicApi\n  */\n export const Host: HostDecorator = makeParamDecorator('Host');\n-\n-\n-/**\n- * Type of the Attribute decorator / constructor function.\n- *\n- * @publicApi\n- */\n-export interface AttributeDecorator {\n-  /**\n-   * Parameter decorator for a directive constructor that designates\n-   * a host-element attribute whose value is injected as a constant string literal.\n-   *\n-   * @usageNotes\n-   *\n-   * Suppose we have an `<input>` element and want to know its `type`.\n-   *\n-   * ```html\n-   * <input type=\"text\">\n-   * ```\n-   *\n-   * The following example uses the decorator to inject the string literal `text` in a directive.\n-   *\n-   * {@example core/ts/metadata/metadata.ts region='attributeMetadata'}\n-   *\n-   * The following example uses the decorator in a component constructor.\n-   *\n-   * {@example core/ts/metadata/metadata.ts region='attributeFactory'}\n-   *\n-   */\n-  (name: string): any;\n-  new(name: string): Attribute;\n-}\n-\n-/**\n- * Type of the Attribute metadata.\n- *\n- * @publicApi\n- */\n-export interface Attribute {\n-  /**\n-   * The name of the attribute whose value can be injected.\n-   */\n-  attributeName: string;\n-}\n-\n-function CREATE_ATTRIBUTE_DECORATOR__PRE_R3__(): AttributeDecorator {\n-  return makeParamDecorator(\n-    'Attribute',\n-    (attributeName?: string) => ({attributeName}));\n-}\n-\n-export function CREATE_ATTRIBUTE_DECORATOR__POST_R3__(): AttributeDecorator {\n-  return makeParamDecorator(\n-    'Attribute',\n-    (attributeName?: string) =>\n-        ({attributeName, __NG_ELEMENT_ID__: () => ɵɵinjectAttribute(attributeName!)}));\n-}\n-\n-const CREATE_ATTRIBUTE_DECORATOR_IMPL = CREATE_ATTRIBUTE_DECORATOR__PRE_R3__;\n-\n-/**\n- * Attribute decorator and metadata.\n- *\n- * @Annotation\n- * @publicApi\n-*/\n-export const Attribute: AttributeDecorator = CREATE_ATTRIBUTE_DECORATOR_IMPL();"
        },
        {
            "sha": "bee9d66c42256585a222245161ee7cd7dc836ba9",
            "filename": "packages/core/src/di/metadata_attr.ts",
            "status": "added",
            "additions": 75,
            "deletions": 0,
            "changes": 75,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata_attr.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata_attr.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fmetadata_attr.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -0,0 +1,75 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ɵɵinjectAttribute} from '../render3/instructions/di_attr';\n+import {makeParamDecorator} from '../util/decorators';\n+\n+\n+/**\n+ * Type of the Attribute decorator / constructor function.\n+ *\n+ * @publicApi\n+ */\n+export interface AttributeDecorator {\n+  /**\n+   * Parameter decorator for a directive constructor that designates\n+   * a host-element attribute whose value is injected as a constant string literal.\n+   *\n+   * @usageNotes\n+   *\n+   * Suppose we have an `<input>` element and want to know its `type`.\n+   *\n+   * ```html\n+   * <input type=\"text\">\n+   * ```\n+   *\n+   * The following example uses the decorator to inject the string literal `text` in a directive.\n+   *\n+   * {@example core/ts/metadata/metadata.ts region='attributeMetadata'}\n+   *\n+   * The following example uses the decorator in a component constructor.\n+   *\n+   * {@example core/ts/metadata/metadata.ts region='attributeFactory'}\n+   *\n+   */\n+  (name: string): any;\n+  new(name: string): Attribute;\n+}\n+\n+/**\n+ * Type of the Attribute metadata.\n+ *\n+ * @publicApi\n+ */\n+export interface Attribute {\n+  /**\n+   * The name of the attribute whose value can be injected.\n+   */\n+  attributeName: string;\n+}\n+\n+function CREATE_ATTRIBUTE_DECORATOR__PRE_R3__(): AttributeDecorator {\n+  return makeParamDecorator('Attribute', (attributeName?: string) => ({attributeName}));\n+}\n+\n+export function CREATE_ATTRIBUTE_DECORATOR__POST_R3__(): AttributeDecorator {\n+  return makeParamDecorator(\n+      'Attribute',\n+      (attributeName?: string) =>\n+          ({attributeName, __NG_ELEMENT_ID__: () => ɵɵinjectAttribute(attributeName!)}));\n+}\n+\n+const CREATE_ATTRIBUTE_DECORATOR_IMPL = CREATE_ATTRIBUTE_DECORATOR__PRE_R3__;\n+\n+/**\n+ * Attribute decorator and metadata.\n+ *\n+ * @Annotation\n+ * @publicApi\n+ */\n+export const Attribute: AttributeDecorator = CREATE_ATTRIBUTE_DECORATOR_IMPL();"
        },
        {
            "sha": "857ca07c618004af957abbebb0d6d16b97e5d952",
            "filename": "packages/core/src/metadata.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fmetadata.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -12,7 +12,7 @@\n  */\n \n \n-export {Attribute} from './di/metadata';\n+export {Attribute, AttributeDecorator} from './di/metadata_attr';\n export {AfterContentChecked, AfterContentInit, AfterViewChecked, AfterViewInit, DoCheck, OnChanges, OnDestroy, OnInit} from './interface/lifecycle_hooks';\n export {ANALYZE_FOR_ENTRY_COMPONENTS, ContentChild, ContentChildDecorator, ContentChildren, ContentChildrenDecorator, Query, ViewChild, ViewChildDecorator, ViewChildren, ViewChildrenDecorator} from './metadata/di';\n export {Component, ComponentDecorator, Directive, DirectiveDecorator, HostBinding, HostBindingDecorator, HostListener, HostListenerDecorator, Input, InputDecorator, Output, OutputDecorator, Pipe, PipeDecorator} from './metadata/directives';"
        },
        {
            "sha": "3d4d86a11dad67614d798d16d847164902770b08",
            "filename": "packages/core/src/render3/instructions/all.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fall.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fall.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fall.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -31,6 +31,7 @@ export * from './change_detection';\n export * from './template';\n export * from './storage';\n export * from './di';\n+export * from './di_attr';\n export * from './element';\n export * from './element_container';\n export * from './get_current_view';"
        },
        {
            "sha": "3e84551a2892fb380f4e199ee416617c32d09b46",
            "filename": "packages/core/src/render3/instructions/di.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -9,7 +9,7 @@ import {InjectFlags, InjectionToken, resolveForwardRef} from '../../di';\n import {assertInjectImplementationNotEqual} from '../../di/inject_switch';\n import {ɵɵinject} from '../../di/injector_compatibility';\n import {Type} from '../../interface/type';\n-import {getOrCreateInjectable, injectAttributeImpl} from '../di';\n+import {getOrCreateInjectable} from '../di';\n import {TDirectiveHostNode} from '../interfaces/node';\n import {getCurrentTNode, getLView} from '../state';\n \n@@ -54,15 +54,6 @@ export function ɵɵdirectiveInject<T>(\n       tNode as TDirectiveHostNode, lView, resolveForwardRef(token), flags);\n }\n \n-/**\n- * Facade for the attribute injection from DI.\n- *\n- * @codeGenApi\n- */\n-export function ɵɵinjectAttribute(attrNameToInject: string): string|null {\n-  return injectAttributeImpl(getCurrentTNode()!, attrNameToInject);\n-}\n-\n /**\n  * Throws an error indicating that a factory function could not be generated by the compiler for a\n  * particular class."
        },
        {
            "sha": "cbaaf1f3f1a366396301f3f188ddb50b456e1469",
            "filename": "packages/core/src/render3/instructions/di_attr.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi_attr.ts",
            "raw_url": "https://github.com/angular/angular/raw/be998e830b59af4236102de0431d6a121c96098d/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi_attr.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fdi_attr.ts?ref=be998e830b59af4236102de0431d6a121c96098d",
            "patch": "@@ -0,0 +1,18 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {injectAttributeImpl} from '../di';\n+import {getCurrentTNode} from '../state';\n+\n+/**\n+ * Facade for the attribute injection from DI.\n+ *\n+ * @codeGenApi\n+ */\n+export function ɵɵinjectAttribute(attrNameToInject: string): string|null {\n+  return injectAttributeImpl(getCurrentTNode()!, attrNameToInject);\n+}"
        }
    ],
    "stats": {
        "total": 241,
        "additions": 99,
        "deletions": 142
    }
}