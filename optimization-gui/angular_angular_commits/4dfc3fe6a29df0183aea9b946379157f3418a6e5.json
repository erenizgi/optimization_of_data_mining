{
    "author": "AndrewKushnir",
    "message": "refactor(router): extract Router config utils to a separate file (#38229)\n\nThis commit refactors Router package to move config utils to a separate file for better\norganization and to resolve the problem with circular dependency issue.\n\nResolves #38212.\n\nPR Close #38229",
    "sha": "4dfc3fe6a29df0183aea9b946379157f3418a6e5",
    "files": [
        {
            "sha": "044cdcd7965e645d4cd4cac7e1e32ac6add46ebd",
            "filename": "packages/router/src/config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 106,
            "changes": 106,
            "blob_url": "https://github.com/angular/angular/blob/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fconfig.ts?ref=4dfc3fe6a29df0183aea9b946379157f3418a6e5",
            "patch": "@@ -9,9 +9,7 @@\n import {NgModuleFactory, NgModuleRef, Type} from '@angular/core';\n import {Observable} from 'rxjs';\n \n-import {EmptyOutletComponent} from './components/empty_outlet';\n import {ActivatedRouteSnapshot} from './router_state';\n-import {PRIMARY_OUTLET} from './shared';\n import {UrlSegment, UrlSegmentGroup} from './url_tree';\n \n \n@@ -490,107 +488,3 @@ export interface Route {\n export class LoadedRouterConfig {\n   constructor(public routes: Route[], public module: NgModuleRef<any>) {}\n }\n-\n-export function validateConfig(config: Routes, parentPath: string = ''): void {\n-  // forEach doesn't iterate undefined values\n-  for (let i = 0; i < config.length; i++) {\n-    const route: Route = config[i];\n-    const fullPath: string = getFullPath(parentPath, route);\n-    validateNode(route, fullPath);\n-  }\n-}\n-\n-function validateNode(route: Route, fullPath: string): void {\n-  if (!route) {\n-    throw new Error(`\n-      Invalid configuration of route '${fullPath}': Encountered undefined route.\n-      The reason might be an extra comma.\n-\n-      Example:\n-      const routes: Routes = [\n-        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n-        { path: 'dashboard',  component: DashboardComponent },, << two commas\n-        { path: 'detail/:id', component: HeroDetailComponent }\n-      ];\n-    `);\n-  }\n-  if (Array.isArray(route)) {\n-    throw new Error(`Invalid configuration of route '${fullPath}': Array cannot be specified`);\n-  }\n-  if (!route.component && !route.children && !route.loadChildren &&\n-      (route.outlet && route.outlet !== PRIMARY_OUTLET)) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': a componentless route without children or loadChildren cannot have a named outlet set`);\n-  }\n-  if (route.redirectTo && route.children) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': redirectTo and children cannot be used together`);\n-  }\n-  if (route.redirectTo && route.loadChildren) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': redirectTo and loadChildren cannot be used together`);\n-  }\n-  if (route.children && route.loadChildren) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': children and loadChildren cannot be used together`);\n-  }\n-  if (route.redirectTo && route.component) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': redirectTo and component cannot be used together`);\n-  }\n-  if (route.path && route.matcher) {\n-    throw new Error(\n-        `Invalid configuration of route '${fullPath}': path and matcher cannot be used together`);\n-  }\n-  if (route.redirectTo === void 0 && !route.component && !route.children && !route.loadChildren) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}'. One of the following must be provided: component, redirectTo, children or loadChildren`);\n-  }\n-  if (route.path === void 0 && route.matcher === void 0) {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': routes must have either a path or a matcher specified`);\n-  }\n-  if (typeof route.path === 'string' && route.path.charAt(0) === '/') {\n-    throw new Error(`Invalid configuration of route '${fullPath}': path cannot start with a slash`);\n-  }\n-  if (route.path === '' && route.redirectTo !== void 0 && route.pathMatch === void 0) {\n-    const exp =\n-        `The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`;\n-    throw new Error(`Invalid configuration of route '{path: \"${fullPath}\", redirectTo: \"${\n-        route.redirectTo}\"}': please provide 'pathMatch'. ${exp}`);\n-  }\n-  if (route.pathMatch !== void 0 && route.pathMatch !== 'full' && route.pathMatch !== 'prefix') {\n-    throw new Error(`Invalid configuration of route '${\n-        fullPath}': pathMatch can only be set to 'prefix' or 'full'`);\n-  }\n-  if (route.children) {\n-    validateConfig(route.children, fullPath);\n-  }\n-}\n-\n-function getFullPath(parentPath: string, currentRoute: Route): string {\n-  if (!currentRoute) {\n-    return parentPath;\n-  }\n-  if (!parentPath && !currentRoute.path) {\n-    return '';\n-  } else if (parentPath && !currentRoute.path) {\n-    return `${parentPath}/`;\n-  } else if (!parentPath && currentRoute.path) {\n-    return currentRoute.path;\n-  } else {\n-    return `${parentPath}/${currentRoute.path}`;\n-  }\n-}\n-\n-/**\n- * Makes a copy of the config and adds any default required properties.\n- */\n-export function standardizeConfig(r: Route): Route {\n-  const children = r.children && r.children.map(standardizeConfig);\n-  const c = children ? {...r, children} : {...r};\n-  if (!c.component && (children || c.loadChildren) && (c.outlet && c.outlet !== PRIMARY_OUTLET)) {\n-    c.component = EmptyOutletComponent;\n-  }\n-  return c;\n-}"
        },
        {
            "sha": "83b915fa3c89c5f978e3090fcfd9d9ac53475d88",
            "filename": "packages/router/src/router.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Frouter.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter.ts?ref=4dfc3fe6a29df0183aea9b946379157f3418a6e5",
            "patch": "@@ -11,7 +11,7 @@ import {Compiler, Injectable, Injector, isDevMode, NgModuleFactoryLoader, NgModu\n import {BehaviorSubject, EMPTY, Observable, of, Subject, SubscriptionLike} from 'rxjs';\n import {catchError, filter, finalize, map, switchMap, tap} from 'rxjs/operators';\n \n-import {QueryParamsHandling, Route, Routes, standardizeConfig, validateConfig} from './config';\n+import {QueryParamsHandling, Route, Routes} from './config';\n import {createRouterState} from './create_router_state';\n import {createUrlTree} from './create_url_tree';\n import {Event, GuardsCheckEnd, GuardsCheckStart, NavigationCancel, NavigationEnd, NavigationError, NavigationStart, NavigationTrigger, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, RoutesRecognized} from './events';\n@@ -28,6 +28,7 @@ import {ActivatedRoute, createEmptyState, RouterState, RouterStateSnapshot} from\n import {isNavigationCancelingError, navigationCancelingError, Params} from './shared';\n import {DefaultUrlHandlingStrategy, UrlHandlingStrategy} from './url_handling_strategy';\n import {containsTree, createEmptyUrlTree, UrlSerializer, UrlTree} from './url_tree';\n+import {standardizeConfig, validateConfig} from './utils/config';\n import {Checks, getAllRouteGuards} from './utils/preactivation';\n import {isUrlTree} from './utils/type_guards';\n "
        },
        {
            "sha": "4f2bda69759cdb150aa8faae48ecbbd6bfac3a71",
            "filename": "packages/router/src/router_config_loader.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Frouter_config_loader.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Frouter_config_loader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter_config_loader.ts?ref=4dfc3fe6a29df0183aea9b946379157f3418a6e5",
            "patch": "@@ -10,8 +10,9 @@ import {Compiler, InjectionToken, Injector, NgModuleFactory, NgModuleFactoryLoad\n import {from, Observable, of} from 'rxjs';\n import {map, mergeMap} from 'rxjs/operators';\n \n-import {LoadChildren, LoadedRouterConfig, Route, standardizeConfig} from './config';\n+import {LoadChildren, LoadedRouterConfig, Route} from './config';\n import {flatten, wrapIntoObservable} from './utils/collection';\n+import {standardizeConfig} from './utils/config';\n \n /**\n  * The [DI token](guide/glossary/#di-token) for a router configuration."
        },
        {
            "sha": "961ee3c54fe2575a4e8a50d9569c37cc6ab4090a",
            "filename": "packages/router/src/utils/config.ts",
            "status": "added",
            "additions": 115,
            "deletions": 0,
            "changes": 115,
            "blob_url": "https://github.com/angular/angular/blob/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Futils%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Fsrc%2Futils%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Futils%2Fconfig.ts?ref=4dfc3fe6a29df0183aea9b946379157f3418a6e5",
            "patch": "@@ -0,0 +1,115 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {EmptyOutletComponent} from '../components/empty_outlet';\n+import {Route, Routes} from '../config';\n+import {PRIMARY_OUTLET} from '../shared';\n+\n+export function validateConfig(config: Routes, parentPath: string = ''): void {\n+  // forEach doesn't iterate undefined values\n+  for (let i = 0; i < config.length; i++) {\n+    const route: Route = config[i];\n+    const fullPath: string = getFullPath(parentPath, route);\n+    validateNode(route, fullPath);\n+  }\n+}\n+\n+function validateNode(route: Route, fullPath: string): void {\n+  if (!route) {\n+    throw new Error(`\n+      Invalid configuration of route '${fullPath}': Encountered undefined route.\n+      The reason might be an extra comma.\n+\n+      Example:\n+      const routes: Routes = [\n+        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n+        { path: 'dashboard',  component: DashboardComponent },, << two commas\n+        { path: 'detail/:id', component: HeroDetailComponent }\n+      ];\n+    `);\n+  }\n+  if (Array.isArray(route)) {\n+    throw new Error(`Invalid configuration of route '${fullPath}': Array cannot be specified`);\n+  }\n+  if (!route.component && !route.children && !route.loadChildren &&\n+      (route.outlet && route.outlet !== PRIMARY_OUTLET)) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': a componentless route without children or loadChildren cannot have a named outlet set`);\n+  }\n+  if (route.redirectTo && route.children) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': redirectTo and children cannot be used together`);\n+  }\n+  if (route.redirectTo && route.loadChildren) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': redirectTo and loadChildren cannot be used together`);\n+  }\n+  if (route.children && route.loadChildren) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': children and loadChildren cannot be used together`);\n+  }\n+  if (route.redirectTo && route.component) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': redirectTo and component cannot be used together`);\n+  }\n+  if (route.path && route.matcher) {\n+    throw new Error(\n+        `Invalid configuration of route '${fullPath}': path and matcher cannot be used together`);\n+  }\n+  if (route.redirectTo === void 0 && !route.component && !route.children && !route.loadChildren) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}'. One of the following must be provided: component, redirectTo, children or loadChildren`);\n+  }\n+  if (route.path === void 0 && route.matcher === void 0) {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': routes must have either a path or a matcher specified`);\n+  }\n+  if (typeof route.path === 'string' && route.path.charAt(0) === '/') {\n+    throw new Error(`Invalid configuration of route '${fullPath}': path cannot start with a slash`);\n+  }\n+  if (route.path === '' && route.redirectTo !== void 0 && route.pathMatch === void 0) {\n+    const exp =\n+        `The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`;\n+    throw new Error(`Invalid configuration of route '{path: \"${fullPath}\", redirectTo: \"${\n+        route.redirectTo}\"}': please provide 'pathMatch'. ${exp}`);\n+  }\n+  if (route.pathMatch !== void 0 && route.pathMatch !== 'full' && route.pathMatch !== 'prefix') {\n+    throw new Error(`Invalid configuration of route '${\n+        fullPath}': pathMatch can only be set to 'prefix' or 'full'`);\n+  }\n+  if (route.children) {\n+    validateConfig(route.children, fullPath);\n+  }\n+}\n+\n+function getFullPath(parentPath: string, currentRoute: Route): string {\n+  if (!currentRoute) {\n+    return parentPath;\n+  }\n+  if (!parentPath && !currentRoute.path) {\n+    return '';\n+  } else if (parentPath && !currentRoute.path) {\n+    return `${parentPath}/`;\n+  } else if (!parentPath && currentRoute.path) {\n+    return currentRoute.path;\n+  } else {\n+    return `${parentPath}/${currentRoute.path}`;\n+  }\n+}\n+\n+/**\n+ * Makes a copy of the config and adds any default required properties.\n+ */\n+export function standardizeConfig(r: Route): Route {\n+  const children = r.children && r.children.map(standardizeConfig);\n+  const c = children ? {...r, children} : {...r};\n+  if (!c.component && (children || c.loadChildren) && (c.outlet && c.outlet !== PRIMARY_OUTLET)) {\n+    c.component = EmptyOutletComponent;\n+  }\n+  return c;\n+}"
        },
        {
            "sha": "76d32f3f5a1967cf107d1727f1baf631b9546a65",
            "filename": "packages/router/test/config.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Ftest%2Fconfig.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfc3fe6a29df0183aea9b946379157f3418a6e5/packages%2Frouter%2Ftest%2Fconfig.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fconfig.spec.ts?ref=4dfc3fe6a29df0183aea9b946379157f3418a6e5",
            "patch": "@@ -6,8 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {validateConfig} from '../src/config';\n import {PRIMARY_OUTLET} from '../src/shared';\n+import {validateConfig} from '../src/utils/config';\n \n describe('config', () => {\n   describe('validateConfig', () => {"
        }
    ],
    "stats": {
        "total": 229,
        "additions": 120,
        "deletions": 109
    }
}