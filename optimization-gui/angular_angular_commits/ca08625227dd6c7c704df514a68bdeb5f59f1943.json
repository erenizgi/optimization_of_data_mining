{
    "author": "literalpie",
    "message": "fix(animations): implement getPosition in browser animation builder (#39983)\n\nForward `getPosition` to `animation_group_player`.\n\nPR Close #39983",
    "sha": "ca08625227dd6c7c704df514a68bdeb5f59f1943",
    "files": [
        {
            "sha": "692f0b971c22c1ad912c3b03be1828bec637e09c",
            "filename": "packages/animations/src/players/animation_group_player.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_group_player.ts",
            "raw_url": "https://github.com/angular/angular/raw/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_group_player.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_group_player.ts?ref=ca08625227dd6c7c704df514a68bdeb5f59f1943",
            "patch": "@@ -148,12 +148,13 @@ export class AnimationGroupPlayer implements AnimationPlayer {\n   }\n \n   getPosition(): number {\n-    let min = 0;\n-    this.players.forEach(player => {\n-      const p = player.getPosition();\n-      min = Math.min(p, min);\n-    });\n-    return min;\n+    const longestPlayer =\n+        this.players.reduce((longestSoFar: AnimationPlayer|null, player: AnimationPlayer) => {\n+          const newPlayerIsLongest =\n+              longestSoFar === null || player.totalTime > longestSoFar.totalTime;\n+          return newPlayerIsLongest ? player : longestSoFar;\n+        }, null);\n+    return longestPlayer != null ? longestPlayer.getPosition() : 0;\n   }\n \n   beforeDestroy(): void {"
        },
        {
            "sha": "607a996b6a8a63ed61ab7e24dfd8e451635ace68",
            "filename": "packages/animations/src/players/animation_player.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts",
            "raw_url": "https://github.com/angular/angular/raw/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts?ref=ca08625227dd6c7c704df514a68bdeb5f59f1943",
            "patch": "@@ -124,6 +124,7 @@ export class NoopAnimationPlayer implements AnimationPlayer {\n   private _started = false;\n   private _destroyed = false;\n   private _finished = false;\n+  private _position = 0;\n   public parentPlayer: AnimationPlayer|null = null;\n   public readonly totalTime: number;\n   constructor(duration: number = 0, delay: number = 0) {\n@@ -184,9 +185,11 @@ export class NoopAnimationPlayer implements AnimationPlayer {\n     }\n   }\n   reset(): void {}\n-  setPosition(position: number): void {}\n+  setPosition(position: number): void {\n+    this._position = this.totalTime ? position * this.totalTime : 1;\n+  }\n   getPosition(): number {\n-    return 0;\n+    return this.totalTime ? this._position / this.totalTime : 1;\n   }\n \n   /** @internal */"
        },
        {
            "sha": "549eec5c28e14c923f83e333d19d9d8732199908",
            "filename": "packages/animations/test/animation_group_player_spec.ts",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Ftest%2Fanimation_group_player_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fanimations%2Ftest%2Fanimation_group_player_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Ftest%2Fanimation_group_player_spec.ts?ref=ca08625227dd6c7c704df514a68bdeb5f59f1943",
            "patch": "@@ -0,0 +1,41 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {fakeAsync} from '@angular/core/testing';\n+import {NoopAnimationPlayer} from '../src/animations';\n+import {AnimationGroupPlayer} from '../src/players/animation_group_player';\n+\n+\n+describe('AnimationGroupPlayer', () => {\n+  it('should getPosition of an empty group', fakeAsync(() => {\n+       const players: NoopAnimationPlayer[] = [];\n+       const groupPlayer = new AnimationGroupPlayer(players);\n+       expect(groupPlayer.getPosition()).toBe(0);\n+     }));\n+\n+  it('should getPosition of a single player in a group', fakeAsync(() => {\n+       const player = new NoopAnimationPlayer(5, 5);\n+       player.setPosition(0.2);\n+       const players = [player];\n+       const groupPlayer = new AnimationGroupPlayer(players);\n+       expect(groupPlayer.getPosition()).toBe(0.2);\n+     }));\n+\n+  it('should getPosition based on the longest player in the group', fakeAsync(() => {\n+       const longestPlayer = new NoopAnimationPlayer(5, 5);\n+       longestPlayer.setPosition(0.2);\n+       const players = [\n+         new NoopAnimationPlayer(1, 4),\n+         new NoopAnimationPlayer(4, 1),\n+         new NoopAnimationPlayer(7, 0),\n+         longestPlayer,\n+         new NoopAnimationPlayer(1, 1),\n+       ];\n+       const groupPlayer = new AnimationGroupPlayer(players);\n+       expect(groupPlayer.getPosition()).toBe(0.2);\n+     }));\n+});"
        },
        {
            "sha": "057b1b5d5568537b5187cf5b79733d4102173338",
            "filename": "packages/platform-browser/animations/src/animation_builder.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/ca08625227dd6c7c704df514a68bdeb5f59f1943/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts?ref=ca08625227dd6c7c704df514a68bdeb5f59f1943",
            "patch": "@@ -111,7 +111,7 @@ export class RendererAnimationPlayer implements AnimationPlayer {\n   }\n \n   getPosition(): number {\n-    return 0;\n+    return this._renderer.engine.players[+this.id]?.getPosition() ?? 0;\n   }\n \n   public totalTime = 0;"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 54,
        "deletions": 9
    }
}