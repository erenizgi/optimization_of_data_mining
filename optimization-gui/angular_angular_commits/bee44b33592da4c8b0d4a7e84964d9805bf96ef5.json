{
    "author": "atscott",
    "message": "Revert \"fix(router): ensure routerLinkActive updates when associated routerLinks change (#38349)\" (#38511)\n\nThis reverts commit e0e5c9f195460c7626c30248e7a79de9a2ebe377.\nFailures in Google tests were detected.\n\nPR Close #38511",
    "sha": "bee44b33592da4c8b0d4a7e84964d9805bf96ef5",
    "files": [
        {
            "sha": "8e88ac7b7cb6a7ea71097e34e6472d187bb184b1",
            "filename": "goldens/public-api/router/router.d.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts?ref=bee44b33592da4c8b0d4a7e84964d9805bf96ef5",
            "patch": "@@ -378,7 +378,7 @@ export declare class RouterEvent {\n     url: string);\n }\n \n-export declare class RouterLink implements OnChanges {\n+export declare class RouterLink {\n     fragment: string;\n     preserveFragment: boolean;\n     /** @deprecated */ set preserveQueryParams(value: boolean);\n@@ -394,7 +394,6 @@ export declare class RouterLink implements OnChanges {\n     };\n     get urlTree(): UrlTree;\n     constructor(router: Router, route: ActivatedRoute, tabIndex: string, renderer: Renderer2, el: ElementRef);\n-    ngOnChanges(changes: SimpleChanges): void;\n     onClick(): boolean;\n }\n \n@@ -430,7 +429,7 @@ export declare class RouterLinkWithHref implements OnChanges, OnDestroy {\n     target: string;\n     get urlTree(): UrlTree;\n     constructor(router: Router, route: ActivatedRoute, locationStrategy: LocationStrategy);\n-    ngOnChanges(changes: SimpleChanges): any;\n+    ngOnChanges(changes: {}): any;\n     ngOnDestroy(): any;\n     onClick(button: number, ctrlKey: boolean, metaKey: boolean, shiftKey: boolean): boolean;\n }"
        },
        {
            "sha": "58be39a05ac6690670b41f17167cc7eb4c352ebe",
            "filename": "packages/router/src/directives/router_link.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 18,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts",
            "raw_url": "https://github.com/angular/angular/raw/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts?ref=bee44b33592da4c8b0d4a7e84964d9805bf96ef5",
            "patch": "@@ -7,8 +7,8 @@\n  */\n \n import {LocationStrategy} from '@angular/common';\n-import {Attribute, Directive, ElementRef, HostBinding, HostListener, Input, isDevMode, OnChanges, OnDestroy, Renderer2, SimpleChanges} from '@angular/core';\n-import {Subject, Subscription} from 'rxjs';\n+import {Attribute, Directive, ElementRef, HostBinding, HostListener, Input, isDevMode, OnChanges, OnDestroy, Renderer2} from '@angular/core';\n+import {Subscription} from 'rxjs';\n \n import {QueryParamsHandling} from '../config';\n import {Event, NavigationEnd} from '../events';\n@@ -115,7 +115,7 @@ import {UrlTree} from '../url_tree';\n  * @publicApi\n  */\n @Directive({selector: ':not(a):not(area)[routerLink]'})\n-export class RouterLink implements OnChanges {\n+export class RouterLink {\n   /**\n    * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the `NavigationExtras`.\n    * @see {@link NavigationExtras#queryParams NavigationExtras#queryParams}\n@@ -167,9 +167,6 @@ export class RouterLink implements OnChanges {\n   private commands: any[] = [];\n   private preserve!: boolean;\n \n-  /** @internal */\n-  onChanges = new Subject<void>();\n-\n   constructor(\n       private router: Router, private route: ActivatedRoute,\n       @Attribute('tabindex') tabIndex: string, renderer: Renderer2, el: ElementRef) {\n@@ -178,13 +175,6 @@ export class RouterLink implements OnChanges {\n     }\n   }\n \n-  /** @nodoc */\n-  ngOnChanges(changes: SimpleChanges) {\n-    // This is subscribed to by `RouterLinkActive` so that it knows to update when there are changes\n-    // to the RouterLinks it's tracking.\n-    this.onChanges.next();\n-  }\n-\n   /**\n    * Commands to pass to {@link Router#createUrlTree Router#createUrlTree}.\n    *   - **array**: commands to pass to {@link Router#createUrlTree Router#createUrlTree}.\n@@ -308,9 +298,6 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n   // TODO(issue/24571): remove '!'.\n   @HostBinding() href!: string;\n \n-  /** @internal */\n-  onChanges = new Subject<void>();\n-\n   constructor(\n       private router: Router, private route: ActivatedRoute,\n       private locationStrategy: LocationStrategy) {\n@@ -349,9 +336,8 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n   }\n \n   /** @nodoc */\n-  ngOnChanges(changes: SimpleChanges): any {\n+  ngOnChanges(changes: {}): any {\n     this.updateTargetUrlAndHref();\n-    this.onChanges.next();\n   }\n   /** @nodoc */\n   ngOnDestroy(): any {"
        },
        {
            "sha": "209546d424d4e2b7cb6ad90e151ba6c99635b394",
            "filename": "packages/router/src/directives/router_link_active.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 24,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link_active.ts",
            "raw_url": "https://github.com/angular/angular/raw/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link_active.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link_active.ts?ref=bee44b33592da4c8b0d4a7e84964d9805bf96ef5",
            "patch": "@@ -7,8 +7,7 @@\n  */\n \n import {AfterContentInit, ChangeDetectorRef, ContentChildren, Directive, ElementRef, Input, OnChanges, OnDestroy, Optional, QueryList, Renderer2, SimpleChanges} from '@angular/core';\n-import {from, of, Subscription} from 'rxjs';\n-import {mergeAll} from 'rxjs/operators';\n+import {Subscription} from 'rxjs';\n \n import {Event, NavigationEnd} from '../events';\n import {Router} from '../router';\n@@ -80,13 +79,14 @@ import {RouterLink, RouterLinkWithHref} from './router_link';\n   exportAs: 'routerLinkActive',\n })\n export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit {\n+  // TODO(issue/24571): remove '!'.\n   @ContentChildren(RouterLink, {descendants: true}) links!: QueryList<RouterLink>;\n+  // TODO(issue/24571): remove '!'.\n   @ContentChildren(RouterLinkWithHref, {descendants: true})\n   linksWithHrefs!: QueryList<RouterLinkWithHref>;\n \n   private classes: string[] = [];\n-  private routerEventsSubscription: Subscription;\n-  private linkInputChangesSubscription?: Subscription;\n+  private subscription: Subscription;\n   public readonly isActive: boolean = false;\n \n   @Input() routerLinkActiveOptions: {exact: boolean} = {exact: false};\n@@ -95,7 +95,7 @@ export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit\n       private router: Router, private element: ElementRef, private renderer: Renderer2,\n       private readonly cdr: ChangeDetectorRef, @Optional() private link?: RouterLink,\n       @Optional() private linkWithHref?: RouterLinkWithHref) {\n-    this.routerEventsSubscription = router.events.subscribe((s: Event) => {\n+    this.subscription = router.events.subscribe((s: Event) => {\n       if (s instanceof NavigationEnd) {\n         this.update();\n       }\n@@ -104,23 +104,9 @@ export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit\n \n   /** @nodoc */\n   ngAfterContentInit(): void {\n-    // `of(null)` is used to force subscribe body to execute once immediately (like `startWith`).\n-    from([this.links.changes, this.linksWithHrefs.changes, of(null)])\n-        .pipe(mergeAll())\n-        .subscribe(_ => {\n-          this.update();\n-          this.subscribeToEachLinkOnChanges();\n-        });\n-  }\n-\n-  private subscribeToEachLinkOnChanges() {\n-    this.linkInputChangesSubscription?.unsubscribe();\n-    const allLinkChanges =\n-        [...this.links.toArray(), ...this.linksWithHrefs.toArray(), this.link, this.linkWithHref]\n-            .filter((link): link is RouterLink|RouterLinkWithHref => !!link)\n-            .map(link => link.onChanges);\n-    this.linkInputChangesSubscription =\n-        from(allLinkChanges).pipe(mergeAll()).subscribe(() => this.update());\n+    this.links.changes.subscribe(_ => this.update());\n+    this.linksWithHrefs.changes.subscribe(_ => this.update());\n+    this.update();\n   }\n \n   @Input()\n@@ -135,8 +121,7 @@ export class RouterLinkActive implements OnChanges, OnDestroy, AfterContentInit\n   }\n   /** @nodoc */\n   ngOnDestroy(): void {\n-    this.routerEventsSubscription.unsubscribe();\n-    this.linkInputChangesSubscription?.unsubscribe();\n+    this.subscription.unsubscribe();\n   }\n \n   private update(): void {"
        },
        {
            "sha": "3dbf4eaf686941aa539a5a5d5eb9a68f6fc6376d",
            "filename": "packages/router/test/regression_integration.spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 48,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bee44b33592da4c8b0d4a7e84964d9805bf96ef5/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fregression_integration.spec.ts?ref=bee44b33592da4c8b0d4a7e84964d9805bf96ef5",
            "patch": "@@ -14,54 +14,6 @@ import {RouterTestingModule} from '@angular/router/testing';\n \n describe('Integration', () => {\n   describe('routerLinkActive', () => {\n-    it('should update when the associated routerLinks change - #18469', fakeAsync(() => {\n-         @Component({\n-           template: `\n-          <a id=\"first-link\" [routerLink]=\"[firstLink]\" routerLinkActive=\"active\">{{firstLink}}</a>\n-          <div id=\"second-link\" routerLinkActive=\"active\">\n-            <a [routerLink]=\"[secondLink]\">{{secondLink}}</a>\n-          </div>\n-           `,\n-         })\n-         class LinkComponent {\n-           firstLink = 'link-a';\n-           secondLink = 'link-b';\n-\n-           changeLinks(): void {\n-             const temp = this.secondLink;\n-             this.secondLink = this.firstLink;\n-             this.firstLink = temp;\n-           }\n-         }\n-\n-         @Component({template: 'simple'})\n-         class SimpleCmp {\n-         }\n-\n-         TestBed.configureTestingModule({\n-           imports: [RouterTestingModule.withRoutes(\n-               [{path: 'link-a', component: SimpleCmp}, {path: 'link-b', component: SimpleCmp}])],\n-           declarations: [LinkComponent, SimpleCmp]\n-         });\n-\n-         const router: Router = TestBed.inject(Router);\n-         const fixture = createRoot(router, LinkComponent);\n-         const firstLink = fixture.debugElement.query(p => p.nativeElement.id === 'first-link');\n-         const secondLink = fixture.debugElement.query(p => p.nativeElement.id === 'second-link');\n-         router.navigateByUrl('/link-a');\n-         advance(fixture);\n-\n-         expect(firstLink.nativeElement.classList).toContain('active');\n-         expect(secondLink.nativeElement.classList).not.toContain('active');\n-\n-         fixture.componentInstance.changeLinks();\n-         fixture.detectChanges();\n-         advance(fixture);\n-\n-         expect(firstLink.nativeElement.classList).not.toContain('active');\n-         expect(secondLink.nativeElement.classList).toContain('active');\n-       }));\n-\n     it('should not cause infinite loops in the change detection - #15825', fakeAsync(() => {\n          @Component({selector: 'simple', template: 'simple'})\n          class SimpleCmp {"
        }
    ],
    "stats": {
        "total": 108,
        "additions": 15,
        "deletions": 93
    }
}