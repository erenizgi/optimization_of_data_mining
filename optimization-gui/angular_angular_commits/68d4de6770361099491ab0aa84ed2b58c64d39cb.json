{
    "author": "mhevery",
    "message": "refactor(core): Replace `ExpandoInstructions` with `HostBindingOpCodes` (#39301)\n\nThe `ExpandoInstructions` was unnecessarily convoluted way to solve the\nproblem of calling the `HostBindingFunction`s on components and\ndirectives. The code was complicated and hard to fallow.\n\nThe replacement is a simplified way to achieve the same thing, which\nis also more efficient in space and speed.\n\nPR Close #39301",
    "sha": "68d4de6770361099491ab0aa84ed2b58c64d39cb",
    "files": [
        {
            "sha": "0e7403b50277b0837bdfe5c2e4a53f2e03bde402",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -12,7 +12,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3037,\n-        \"main-es2015\": 448676,\n+        \"main-es2015\": 448085,\n         \"polyfills-es2015\": 52415\n       }\n     }"
        },
        {
            "sha": "8ff6309247fe702cd3399200c09cac74c05cc316",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -30,7 +30,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1485,\n-        \"main-es2015\": 136096,\n+        \"main-es2015\": 135506,\n         \"polyfills-es2015\": 37248\n       }\n     }\n@@ -39,7 +39,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 2289,\n-        \"main-es2015\": 242460,\n+        \"main-es2015\": 241945,\n         \"polyfills-es2015\": 36938,\n         \"5-es2015\": 751\n       }"
        },
        {
            "sha": "6442566db5c9f2505baa7f014797cbecfe6dd584",
            "filename": "packages/core/src/render3/VIEW_DATA.md",
            "status": "modified",
            "additions": 0,
            "deletions": 51,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2FVIEW_DATA.md",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2FVIEW_DATA.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2FVIEW_DATA.md?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -198,57 +198,6 @@ The above will create the following layout:\n | ...   | ...                 | ...\n \n \n-The `EXPANDO` section needs additional information for information stored in `TView.expandoInstructions`\n-\n-| Index | `TView.expandoInstructions` | Meaning\n-| ----: | ---------------------------:| -------\n-| 0     | -10                         | Negative numbers signify pointers to elements. In this case 10 (`<child>`)\n-| 1     | 2                           | Injector size. Number of values to skip to get to Host Bindings.\n-| 2     | Child.ɵcmp.hostBindings     | The function to call. (Only when `hostVars` is not `0`)\n-| 3     | Child.ɵcmp.hostVars         | Number of host bindings to process. (Only when `hostVars` is not `0`)\n-| 4     | Tooltip.ɵdir.hostBindings   | The function to call. (Only when `hostVars` is not `0`)\n-| 5     | Tooltip.ɵdir.hostVars       | Number of host bindings to process. (Only when `hostVars` is not `0`)\n-\n-The reason for this layout is to make the host binding update efficient using this pseudo code:\n-```typescript\n-let currentDirectiveIndex = -1;\n-let currentElementIndex = -1;\n-// This is global state which is used internally by hostBindings to know where the offset is\n-let bindingRootIndex = tView.expandoStartIndex;\n-for(var i = 0; i < tView.expandoInstructions.length; i++) {\n-  let instruction = tView.expandoInstructions[i];\n-  if (typeof instruction === 'number') {\n-    // Numbers are used to update the indices.\n-    if (instruction < 0) {\n-      // Negative numbers means that we are starting new EXPANDO block and need to update current element and directive index\n-      bindingRootIndex += BLOOM_OFFSET;\n-      currentDirectiveIndex = bindingRootIndex;\n-      currentElementIndex = -instruction;\n-    } else {\n-      bindingRootIndex += instruction;\n-    }\n-  } else {\n-    // We know that we are hostBinding function so execute it.\n-    instruction(currentDirectiveIndex, currentElementIndex);\n-    currentDirectiveIndex++;\n-  }\n-}\n-```\n-\n-The above code should execute as:\n-\n-| Instruction                 | `bindingRootIndex` | `currentDirectiveIndex`   | `currentElementIndex`\n-| ----------:                 | -----------------: | ----------------------:   | --------------------:\n-| (initial)                   | `11`               | `-1`                      | `-1`\n-| `-10`                       | `19`               | `\\* new Child() *\\ 19`    | `\\* <child> *\\ 10`\n-| `2`                         | `21`               | `\\* new Child() *\\ 19`    | `\\* <child> *\\ 10`\n-| `Child.ɵcmp.hostBindings`   | invoke with =>     | `\\* new Child() *\\ 19`    | `\\* <child> *\\ 10`\n-|                             | `21`               | `\\* new Tooltip() *\\ 20`  | `\\* <child> *\\ 10`\n-| `Child.ɵcmp.hostVars`       | `22`               | `\\* new Tooltip() *\\ 20`  | `\\* <child> *\\ 10`\n-| `Tooltip.ɵdir.hostBindings` | invoke with =>     | `\\* new Tooltip() *\\ 20`  | `\\* <child> *\\ 10`\n-|                             | `22`               | `21`                      | `\\* <child> *\\ 10`\n-| `Tooltip.ɵdir.hostVars`     | `22`               | `21`                      | `\\* <child> *\\ 10`\n-\n ## `EXPANDO` and Injection\n \n `EXPANDO` will also store the injection information for the element."
        },
        {
            "sha": "e27a6f9cdde498730d9e4f83993bde8c903b20dd",
            "filename": "packages/core/src/render3/component.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -16,9 +16,9 @@ import {assertComponentType} from './assert';\n import {getComponentDef} from './definition';\n import {diPublicInInjector, getOrCreateNodeInjectorForNode} from './di';\n import {registerPostOrderHooks} from './hooks';\n-import {addHostBindingsToExpandoInstructions, addToViewTree, CLEAN_PROMISE, createLView, createTView, getOrCreateTComponentView, getOrCreateTNode, growHostVarsSpace, initTNodeFlags, instantiateRootComponent, invokeHostBindingsInCreationMode, locateHostElement, markAsComponentHost, refreshView, renderView} from './instructions/shared';\n+import {addToViewTree, CLEAN_PROMISE, createLView, createTView, getOrCreateTComponentView, getOrCreateTNode, initTNodeFlags, instantiateRootComponent, invokeHostBindingsInCreationMode, locateHostElement, markAsComponentHost, refreshView, registerHostBindingOpCodes, renderView} from './instructions/shared';\n import {ComponentDef, ComponentType, RenderFlags} from './interfaces/definition';\n-import {TElementNode, TNode, TNodeType} from './interfaces/node';\n+import {TElementNode, TNodeType} from './interfaces/node';\n import {PlayerHandler} from './interfaces/player';\n import {domRendererFactory3, RElement, Renderer3, RendererFactory3} from './interfaces/renderer';\n import {CONTEXT, HEADER_OFFSET, LView, LViewFlags, RootContext, RootContextFlags, TVIEW, TViewType} from './interfaces/view';\n@@ -230,7 +230,9 @@ export function createRootComponent<T>(\n   // We want to generate an empty QueryList for root content queries for backwards\n   // compatibility with ViewEngine.\n   if (componentDef.contentQueries) {\n-    componentDef.contentQueries(RenderFlags.Create, component, rootLView.length - 1);\n+    const tNode = getCurrentTNode()!;\n+    ngDevMode && assertDefined(tNode, 'TNode expected');\n+    componentDef.contentQueries(RenderFlags.Create, component, tNode.directiveStart);\n   }\n \n   const rootTNode = getCurrentTNode()!;\n@@ -240,8 +242,9 @@ export function createRootComponent<T>(\n     setSelectedIndex(rootTNode.index);\n \n     const rootTView = rootLView[TVIEW];\n-    addHostBindingsToExpandoInstructions(rootTView, componentDef);\n-    growHostVarsSpace(rootTView, rootLView, componentDef.hostVars);\n+    registerHostBindingOpCodes(\n+        rootTView, rootTNode, rootLView, rootTNode.directiveStart, rootTNode.directiveEnd,\n+        componentDef);\n \n     invokeHostBindingsInCreationMode(componentDef, component);\n   }\n@@ -274,13 +277,12 @@ export function createRootContext(\n  * ```\n  */\n export function LifecycleHooksFeature(component: any, def: ComponentDef<any>): void {\n-  const rootTView = readPatchedLView(component)![TVIEW];\n-  const dirIndex = rootTView.data.length - 1;\n-\n-  // TODO(misko): replace `as TNode` with createTNode call. (needs refactoring to lose dep on\n-  // LNode).\n-  registerPostOrderHooks(\n-      rootTView, {directiveStart: dirIndex, directiveEnd: dirIndex + 1} as TNode);\n+  const lView = readPatchedLView(component)!;\n+  ngDevMode && assertDefined(lView, 'LView is required');\n+  const tView = lView[TVIEW];\n+  const tNode = getCurrentTNode()!;\n+  ngDevMode && assertDefined(tNode, 'TNode is required');\n+  registerPostOrderHooks(tView, tNode);\n }\n \n /**"
        },
        {
            "sha": "b7b41ac026aad2256d5227b638f6a3e134d8d9de",
            "filename": "packages/core/src/render3/hooks.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fhooks.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fhooks.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fhooks.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {AfterContentChecked, AfterContentInit, AfterViewChecked, AfterViewInit, DoCheck, OnChanges, OnDestroy, OnInit} from '../interface/lifecycle_hooks';\n-import {assertEqual, assertNotEqual} from '../util/assert';\n+import {assertDefined, assertEqual, assertNotEqual} from '../util/assert';\n import {assertFirstCreatePass} from './assert';\n import {NgOnChangesFeatureImpl} from './features/ng_onchanges_feature';\n import {DirectiveDef} from './interfaces/definition';\n@@ -77,6 +77,7 @@ export function registerPostOrderHooks(tView: TView, tNode: TNode): void {\n   // hooks for projected components and directives must be called *before* their hosts.\n   for (let i = tNode.directiveStart, end = tNode.directiveEnd; i < end; i++) {\n     const directiveDef = tView.data[i] as DirectiveDef<any>;\n+    ngDevMode && assertDefined(directiveDef, 'Expecting DirectiveDef');\n     const lifecycleHooks: AfterContentInit&AfterContentChecked&AfterViewInit&AfterViewChecked&\n         OnDestroy = directiveDef.type.prototype;\n     const {"
        },
        {
            "sha": "837d0b0a94c7fe74cf7b8fad12a6d82c98c71556",
            "filename": "packages/core/src/render3/i18n/i18n_parse.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -154,7 +154,7 @@ export function i18nStartFirstCreatePass(\n function createTNodeAndAddOpCode(\n     tView: TView, rootTNode: TNode|null, existingTNodes: TNode[], lView: LView,\n     createOpCodes: I18nCreateOpCodes, text: string|null, isICU: boolean): TNode {\n-  const i18nNodeIdx = allocExpando(tView, lView, 1);\n+  const i18nNodeIdx = allocExpando(tView, lView, 1, null);\n   let opCode = i18nNodeIdx << I18nCreateOpCode.SHIFT;\n   let parentTNode = getCurrentParentTNode();\n \n@@ -423,7 +423,7 @@ export function icuStart(\n   let bindingMask = 0;\n   const tIcu: TIcu = {\n     type: icuExpression.type,\n-    currentCaseLViewIndex: allocExpando(tView, lView, 1),\n+    currentCaseLViewIndex: allocExpando(tView, lView, 1, null),\n     anchorIdx,\n     cases: [],\n     create: [],\n@@ -596,7 +596,7 @@ function walkIcuTree(\n   let bindingMask = 0;\n   let currentNode = parentNode.firstChild;\n   while (currentNode) {\n-    const newIndex = allocExpando(tView, lView, 1);\n+    const newIndex = allocExpando(tView, lView, 1, null);\n     switch (currentNode.nodeType) {\n       case Node.ELEMENT_NODE:\n         const element = currentNode as Element;"
        },
        {
            "sha": "c7f4f469a59663f86615d6500863732638be676f",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 33,
            "changes": 66,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -22,7 +22,7 @@ import {SelectorFlags} from '../interfaces/projection';\n import {LQueries, TQueries} from '../interfaces/query';\n import {RComment, RElement, Renderer3, RendererFactory3, RNode} from '../interfaces/renderer';\n import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePrev, getTStylingRangePrevDuplicate, TStylingKey, TStylingRange} from '../interfaces/styling';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, ExpandoInstructions, FLAGS, HEADER_OFFSET, HookData, HOST, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, FLAGS, HEADER_OFFSET, HookData, HOST, HostBindingOpCodes, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n import {attachDebugObject} from '../util/debug_utils';\n import {getParentInjectorIndex, getParentInjectorView} from '../util/injector_utils';\n import {unwrapRNode} from '../util/view_utils';\n@@ -115,38 +115,38 @@ function nameSuffix(text: string|null|undefined): string {\n  */\n export const TViewConstructor = class TView implements ITView {\n   constructor(\n-      public type: TViewType,                                //\n-      public blueprint: LView,                               //\n-      public template: ComponentTemplate<{}>|null,           //\n-      public queries: TQueries|null,                         //\n-      public viewQuery: ViewQueriesFunction<{}>|null,        //\n-      public declTNode: ITNode|null,                         //\n-      public data: TData,                                    //\n-      public bindingStartIndex: number,                      //\n-      public expandoStartIndex: number,                      //\n-      public expandoInstructions: ExpandoInstructions|null,  //\n-      public firstCreatePass: boolean,                       //\n-      public firstUpdatePass: boolean,                       //\n-      public staticViewQueries: boolean,                     //\n-      public staticContentQueries: boolean,                  //\n-      public preOrderHooks: HookData|null,                   //\n-      public preOrderCheckHooks: HookData|null,              //\n-      public contentHooks: HookData|null,                    //\n-      public contentCheckHooks: HookData|null,               //\n-      public viewHooks: HookData|null,                       //\n-      public viewCheckHooks: HookData|null,                  //\n-      public destroyHooks: DestroyHookData|null,             //\n-      public cleanup: any[]|null,                            //\n-      public contentQueries: number[]|null,                  //\n-      public components: number[]|null,                      //\n-      public directiveRegistry: DirectiveDefList|null,       //\n-      public pipeRegistry: PipeDefList|null,                 //\n-      public firstChild: ITNode|null,                        //\n-      public schemas: SchemaMetadata[]|null,                 //\n-      public consts: TConstants|null,                        //\n-      public incompleteFirstPass: boolean,                   //\n-      public _decls: number,                                 //\n-      public _vars: number,                                  //\n+      public type: TViewType,\n+      public blueprint: LView,\n+      public template: ComponentTemplate<{}>|null,\n+      public queries: TQueries|null,\n+      public viewQuery: ViewQueriesFunction<{}>|null,\n+      public declTNode: ITNode|null,\n+      public data: TData,\n+      public bindingStartIndex: number,\n+      public expandoStartIndex: number,\n+      public hostBindingOpCodes: HostBindingOpCodes|null,\n+      public firstCreatePass: boolean,\n+      public firstUpdatePass: boolean,\n+      public staticViewQueries: boolean,\n+      public staticContentQueries: boolean,\n+      public preOrderHooks: HookData|null,\n+      public preOrderCheckHooks: HookData|null,\n+      public contentHooks: HookData|null,\n+      public contentCheckHooks: HookData|null,\n+      public viewHooks: HookData|null,\n+      public viewCheckHooks: HookData|null,\n+      public destroyHooks: DestroyHookData|null,\n+      public cleanup: any[]|null,\n+      public contentQueries: number[]|null,\n+      public components: number[]|null,\n+      public directiveRegistry: DirectiveDefList|null,\n+      public pipeRegistry: PipeDefList|null,\n+      public firstChild: ITNode|null,\n+      public schemas: SchemaMetadata[]|null,\n+      public consts: TConstants|null,\n+      public incompleteFirstPass: boolean,\n+      public _decls: number,\n+      public _vars: number,\n \n   ) {}\n "
        },
        {
            "sha": "d96ff9d380b474177b5ff8469b03253e6bbe80d6",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 140,
            "deletions": 172,
            "changes": 312,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -12,7 +12,7 @@ import {CUSTOM_ELEMENTS_SCHEMA, NO_ERRORS_SCHEMA, SchemaMetadata} from '../../me\n import {ViewEncapsulation} from '../../metadata/view';\n import {validateAgainstEventAttributes, validateAgainstEventProperties} from '../../sanitization/sanitization';\n import {Sanitizer} from '../../sanitization/sanitizer';\n-import {assertDefined, assertDomNode, assertEqual, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertLessThan, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n+import {assertDefined, assertDomNode, assertEqual, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n import {createNamedArrayType} from '../../util/named_array_type';\n import {initNgDevMode} from '../../util/ng_dev_mode';\n import {normalizeDebugBindingName, normalizeDebugBindingValue} from '../../util/ng_reflect';\n@@ -24,13 +24,13 @@ import {diPublicInInjector, getNodeInjectable, getOrCreateNodeInjectorForNode} f\n import {throwMultipleComponentError} from '../errors';\n import {executeCheckHooks, executeInitAndCheckHooks, incrementInitPhaseFlags} from '../hooks';\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS} from '../interfaces/container';\n-import {ComponentDef, ComponentTemplate, DirectiveDef, DirectiveDefListOrFactory, PipeDefListOrFactory, RenderFlags, ViewQueriesFunction} from '../interfaces/definition';\n-import {NodeInjectorFactory, NodeInjectorOffset} from '../interfaces/injector';\n-import {AttributeMarker, InitialInputData, InitialInputs, LocalRefExtractor, PropertyAliases, PropertyAliasValue, TAttributes, TConstantsOrFactory, TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeProviderIndexes, TNodeType, TProjectionNode} from '../interfaces/node';\n+import {ComponentDef, ComponentTemplate, DirectiveDef, DirectiveDefListOrFactory, HostBindingsFunction, PipeDefListOrFactory, RenderFlags, ViewQueriesFunction} from '../interfaces/definition';\n+import {NodeInjectorFactory} from '../interfaces/injector';\n+import {AttributeMarker, InitialInputData, InitialInputs, LocalRefExtractor, PropertyAliases, PropertyAliasValue, TAttributes, TConstantsOrFactory, TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode} from '../interfaces/node';\n import {isProceduralRenderer, RComment, RElement, Renderer3, RendererFactory3, RNode, RText} from '../interfaces/renderer';\n import {SanitizerFn} from '../interfaces/sanitization';\n import {isComponentDef, isComponentHost, isContentQueryHost, isRootView} from '../interfaces/type_checks';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, HostBindingOpCodes, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n import {assertPureTNodeType, assertTNodeType} from '../node_assert';\n import {updateTextNode} from '../node_manipulation';\n import {isInlineTemplate, isNodeMatchingSelectorList} from '../node_selector_matcher';\n@@ -53,72 +53,39 @@ import {attachLContainerDebug, attachLViewDebug, cloneToLViewFromTViewBlueprint,\n const _CLEAN_PROMISE = (() => Promise.resolve(null))();\n \n /**\n- * Process the `TView.expandoInstructions`. (Execute the `hostBindings`.)\n+ * Invoke `HostBindingsFunction`s for view.\n  *\n- * @param tView `TView` containing the `expandoInstructions`\n- * @param lView `LView` associated with the `TView`\n+ * This methods executes `TView.hostBindingOpCodes`. It is used to execute the\n+ * `HostBindingsFunction`s associated with the current `LView`.\n+ *\n+ * @param tView Current `TView`.\n+ * @param lView Current `LView`.\n  */\n-export function setHostBindingsByExecutingExpandoInstructions(tView: TView, lView: LView): void {\n-  ngDevMode && assertSame(tView, lView[TVIEW], '`LView` is not associated with the `TView`!');\n+export function processHostBindingOpCodes(tView: TView, lView: LView): void {\n+  const hostBindingOpCodes = tView.hostBindingOpCodes;\n+  if (hostBindingOpCodes === null) return;\n   try {\n-    const expandoInstructions = tView.expandoInstructions;\n-    if (expandoInstructions !== null) {\n-      let bindingRootIndex = tView.expandoStartIndex;\n-      let currentDirectiveIndex = -1;\n-      let currentElementIndex = -1;\n-      // TODO(misko): PERF It is possible to get here with `TView.expandoInstructions` containing no\n-      // functions to execute. This is wasteful as there is no work to be done, but we still need\n-      // to iterate over the instructions.\n-      // In example of this is in this test: `host_binding_spec.ts`\n-      // `fit('should not cause problems if detectChanges is called when a property updates', ...`\n-      // In the above test we get here with expando [0, 0, 1] which requires a lot of processing but\n-      // there is no function to execute.\n-      for (let i = 0; i < expandoInstructions.length; i++) {\n-        const instruction = expandoInstructions[i];\n-        if (typeof instruction === 'number') {\n-          if (instruction <= 0) {\n-            // Negative numbers mean that we are starting new EXPANDO block and need to update\n-            // the current element and directive index.\n-            currentElementIndex = ~instruction;\n-            setSelectedIndex(currentElementIndex);\n-\n-            // Injector block and providers are taken into account.\n-            const providerCount = (expandoInstructions[++i] as number);\n-            bindingRootIndex += NodeInjectorOffset.SIZE + providerCount;\n-\n-            currentDirectiveIndex = bindingRootIndex;\n-          } else {\n-            // This is either the injector size (so the binding root can skip over directives\n-            // and get to the first set of host bindings on this node) or the host var count\n-            // (to get to the next set of host bindings on this node).\n-            bindingRootIndex += instruction;\n-          }\n-        } else {\n-          // If it's not a number, it's a host binding function that needs to be executed.\n-          if (instruction !== null) {\n-            ngDevMode &&\n-                assertLessThan(\n-                    currentDirectiveIndex, TNodeProviderIndexes.CptViewProvidersCountShifter,\n-                    'Reached the max number of host bindings');\n-            setBindingRootForHostBindings(bindingRootIndex, currentDirectiveIndex);\n-            const hostCtx = lView[currentDirectiveIndex];\n-            instruction(RenderFlags.Update, hostCtx);\n-          }\n-          // TODO(misko): PERF Relying on incrementing the `currentDirectiveIndex` here is\n-          // sub-optimal. The implications are that if we have a lot of directives but none of them\n-          // have host bindings we nevertheless need to iterate over the expando instructions to\n-          // update the counter. It would be much better if we could encode the\n-          // `currentDirectiveIndex` into the `expandoInstruction` array so that we only need to\n-          // iterate over those directives which actually have `hostBindings`.\n-          currentDirectiveIndex++;\n-        }\n+    for (let i = 0; i < hostBindingOpCodes.length; i++) {\n+      const opCode = hostBindingOpCodes[i] as number;\n+      if (opCode < 0) {\n+        // Negative numbers are element indexes.\n+        setSelectedIndex(~opCode);\n+      } else {\n+        // Positive numbers are NumberTuple which store bindingRootIndex and directiveIndex.\n+        const directiveIdx = opCode;\n+        const bindingRootIndx = hostBindingOpCodes[++i] as number;\n+        const hostBindingFn = hostBindingOpCodes[++i] as HostBindingsFunction<any>;\n+        setBindingRootForHostBindings(bindingRootIndx, directiveIdx);\n+        const context = lView[directiveIdx];\n+        hostBindingFn(RenderFlags.Update, context);\n       }\n     }\n   } finally {\n     setSelectedIndex(-1);\n   }\n }\n \n+\n /** Refreshes all content queries declared by directives in a given view */\n function refreshContentQueries(tView: TView, lView: LView): void {\n   const contentQueries = tView.contentQueries;\n@@ -128,6 +95,7 @@ function refreshContentQueries(tView: TView, lView: LView): void {\n       const directiveDefIdx = contentQueries[i + 1];\n       if (directiveDefIdx !== -1) {\n         const directiveDef = tView.data[directiveDefIdx] as DirectiveDef<any>;\n+        ngDevMode && assertDefined(directiveDef, 'DirectiveDef not found.');\n         ngDevMode &&\n             assertDefined(directiveDef.contentQueries, 'contentQueries function should be defined');\n         setCurrentQueryIndex(queryStartIdx);\n@@ -279,32 +247,24 @@ export function createTNodeAtIndex(\n  * @param tView `TView` associated with `LView`\n  * @param lView The `LView` containing the blueprint to adjust\n  * @param numSlotsToAlloc The number of slots to alloc in the LView, should be >0\n+ * @param initialValue Initial value to store in blueprint\n  */\n-export function allocExpando(tView: TView, lView: LView, numSlotsToAlloc: number): number {\n+export function allocExpando(\n+    tView: TView, lView: LView, numSlotsToAlloc: number, initialValue: any): number {\n+  if (numSlotsToAlloc === 0) return -1;\n   if (ngDevMode) {\n-    assertGreaterThan(numSlotsToAlloc, 0, 'The number of slots to alloc should be greater than 0');\n+    assertFirstCreatePass(tView);\n+    assertSame(tView, lView[TVIEW], '`LView` must be associated with `TView`!');\n     assertEqual(tView.data.length, lView.length, 'Expecting LView to be same size as TView');\n     assertEqual(\n         tView.data.length, tView.blueprint.length, 'Expecting Blueprint to be same size as TView');\n     assertFirstUpdatePass(tView);\n   }\n   const allocIdx = lView.length;\n   for (let i = 0; i < numSlotsToAlloc; i++) {\n-    tView.blueprint.push(null);\n+    lView.push(initialValue);\n+    tView.blueprint.push(initialValue);\n     tView.data.push(null);\n-    lView.push(null);\n-  }\n-\n-  // We should only increment the expando start index if there aren't already directives\n-  // and injectors saved in the \"expando\" section\n-  if (!tView.expandoInstructions) {\n-    tView.expandoStartIndex += numSlotsToAlloc;\n-  } else {\n-    // Since we're adding the dynamic nodes into the expando section, we need to let the host\n-    // bindings know that they should skip x slots\n-    // FIXME(misko): Refactor `expandoInstructions` so that it does not rely on relative binding\n-    // offsets, but absolute values which Means we would not have to store it here.\n-    tView.expandoInstructions.push(numSlotsToAlloc);\n   }\n   return allocIdx;\n }\n@@ -454,7 +414,7 @@ export function refreshView<T>(\n       }\n     }\n \n-    setHostBindingsByExecutingExpandoInstructions(tView, lView);\n+    processHostBindingOpCodes(tView, lView);\n \n     // Refresh child component views.\n     const components = tView.components;\n@@ -653,7 +613,7 @@ export function createTView(\n   const consts = typeof constsOrFactory === 'function' ? constsOrFactory() : constsOrFactory;\n   const tView = blueprint[TVIEW as any] = ngDevMode ?\n       new TViewConstructor(\n-          type,\n+          type,        // type: TViewType,\n           blueprint,   // blueprint: LView,\n           templateFn,  // template: ComponentTemplate<{}>|null,\n           null,        // queries: TQueries|null\n@@ -662,24 +622,24 @@ export function createTView(\n           cloneToTViewData(blueprint).fill(null, bindingStartIndex),  // data: TData,\n           bindingStartIndex,                                          // bindingStartIndex: number,\n           initialViewLength,                                          // expandoStartIndex: number,\n-          null,   // expandoInstructions: ExpandoInstructions|null,\n-          true,   // firstCreatePass: boolean,\n-          true,   // firstUpdatePass: boolean,\n-          false,  // staticViewQueries: boolean,\n-          false,  // staticContentQueries: boolean,\n-          null,   // preOrderHooks: HookData|null,\n-          null,   // preOrderCheckHooks: HookData|null,\n-          null,   // contentHooks: HookData|null,\n-          null,   // contentCheckHooks: HookData|null,\n-          null,   // viewHooks: HookData|null,\n-          null,   // viewCheckHooks: HookData|null,\n-          null,   // destroyHooks: DestroyHookData|null,\n-          null,   // cleanup: any[]|null,\n-          null,   // contentQueries: number[]|null,\n-          null,   // components: number[]|null,\n-          typeof directives === 'function' ?\n-              directives() :\n-              directives,  // directiveRegistry: DirectiveDefList|null,\n+          null,                               // hostBindingOpCodes: HostBindingOpCodes,\n+          true,                               // firstCreatePass: boolean,\n+          true,                               // firstUpdatePass: boolean,\n+          false,                              // staticViewQueries: boolean,\n+          false,                              // staticContentQueries: boolean,\n+          null,                               // preOrderHooks: HookData|null,\n+          null,                               // preOrderCheckHooks: HookData|null,\n+          null,                               // contentHooks: HookData|null,\n+          null,                               // contentCheckHooks: HookData|null,\n+          null,                               // viewHooks: HookData|null,\n+          null,                               // viewCheckHooks: HookData|null,\n+          null,                               // destroyHooks: DestroyHookData|null,\n+          null,                               // cleanup: any[]|null,\n+          null,                               // contentQueries: number[]|null,\n+          null,                               // components: number[]|null,\n+          typeof directives === 'function' ?  //\n+              directives() :                  //\n+              directives,                     // directiveRegistry: DirectiveDefList|null,\n           typeof pipes === 'function' ? pipes() : pipes,  // pipeRegistry: PipeDefList|null,\n           null,                                           // firstChild: TNode|null,\n           schemas,                                        // schemas: SchemaMetadata[]|null,\n@@ -698,7 +658,7 @@ export function createTView(\n         data: blueprint.slice().fill(null, bindingStartIndex),\n         bindingStartIndex: bindingStartIndex,\n         expandoStartIndex: initialViewLength,\n-        expandoInstructions: null,\n+        hostBindingOpCodes: null,\n         firstCreatePass: true,\n         firstUpdatePass: true,\n         staticViewQueries: false,\n@@ -945,14 +905,14 @@ function initializeInputAndOutputAliases(tView: TView, tNode: TNode): void {\n \n   const start = tNode.directiveStart;\n   const end = tNode.directiveEnd;\n-  const defs = tView.data;\n+  const tViewData = tView.data;\n \n   const tNodeAttrs = tNode.attrs;\n   const inputsFromAttrs: InitialInputData = ngDevMode ? new TNodeInitialInputs() : [];\n   let inputsStore: PropertyAliases|null = null;\n   let outputsStore: PropertyAliases|null = null;\n   for (let i = start; i < end; i++) {\n-    const directiveDef = defs[i] as DirectiveDef<any>;\n+    const directiveDef = tViewData[i] as DirectiveDef<any>;\n     const directiveInputs = directiveDef.inputs;\n     // Do not use unbound attributes as inputs to structural directives, since structural\n     // directive inputs can only be set using microsyntax (e.g. `<div *dir=\"exp\">`).\n@@ -1146,10 +1106,15 @@ export function instantiateRootComponent<T>(tView: TView, lView: LView, def: Com\n   const rootTNode = getCurrentTNode()!;\n   if (tView.firstCreatePass) {\n     if (def.providersResolver) def.providersResolver(def);\n-    generateExpandoInstructionBlock(tView, rootTNode, 1);\n-    baseResolveDirective(tView, lView, def);\n-  }\n-  const directive = getNodeInjectable(lView, tView, lView.length - 1, rootTNode as TElementNode);\n+    const directiveIndex = allocExpando(tView, lView, 1, null);\n+    ngDevMode &&\n+        assertEqual(\n+            directiveIndex, rootTNode.directiveStart,\n+            'Because this is a root component the allocated expando should match the TNode component.');\n+    configureViewWithDirective(tView, rootTNode, lView, directiveIndex, def);\n+  }\n+  const directive =\n+      getNodeInjectable(lView, tView, rootTNode.directiveStart, rootTNode as TElementNode);\n   attachPatchData(directive, lView);\n   const native = getNativeByTNode(rootTNode, lView);\n   if (native) {\n@@ -1174,7 +1139,6 @@ export function resolveDirectives(\n     const exportsMap: ({[key: string]: number}|null) = localRefs === null ? null : {'': -1};\n \n     if (directiveDefs !== null) {\n-      let totalDirectiveHostVars = 0;\n       hasDirectives = true;\n       initTNodeFlags(tNode, tView.data.length, directiveDefs.length);\n       // When the same token is provided by several directives on the same node, some rules apply in\n@@ -1187,18 +1151,22 @@ export function resolveDirectives(\n         const def = directiveDefs[i];\n         if (def.providersResolver) def.providersResolver(def);\n       }\n-      generateExpandoInstructionBlock(tView, tNode, directiveDefs.length);\n       let preOrderHooksFound = false;\n       let preOrderCheckHooksFound = false;\n+      let directiveIdx = allocExpando(tView, lView, directiveDefs.length, null);\n+      ngDevMode &&\n+          assertSame(\n+              directiveIdx, tNode.directiveStart,\n+              'TNode.directiveStart should point to just allocated space');\n+\n       for (let i = 0; i < directiveDefs.length; i++) {\n         const def = directiveDefs[i];\n         // Merge the attrs in the order of matches. This assumes that the first directive is the\n         // component itself, so that the component has the least priority.\n         tNode.mergedAttrs = mergeHostAttrs(tNode.mergedAttrs, def.hostAttrs);\n \n-        baseResolveDirective(tView, lView, def);\n-\n-        saveNameToExportMap(tView.data!.length - 1, def, exportsMap);\n+        configureViewWithDirective(tView, tNode, lView, directiveIdx, def);\n+        saveNameToExportMap(directiveIdx, def, exportsMap);\n \n         if (def.contentQueries !== null) tNode.flags |= TNodeFlags.hasContentQuery;\n         if (def.hostBindings !== null || def.hostAttrs !== null || def.hostVars !== 0)\n@@ -1221,12 +1189,10 @@ export function resolveDirectives(\n           preOrderCheckHooksFound = true;\n         }\n \n-        addHostBindingsToExpandoInstructions(tView, def);\n-        totalDirectiveHostVars += def.hostVars;\n+        directiveIdx++;\n       }\n \n       initializeInputAndOutputAliases(tView, tNode);\n-      growHostVarsSpace(tView, lView, totalDirectiveHostVars);\n     }\n     if (exportsMap) cacheMatchingLocalNames(tNode, localRefs, exportsMap);\n   }\n@@ -1236,51 +1202,57 @@ export function resolveDirectives(\n }\n \n /**\n- * Add `hostBindings` to the `TView.expandoInstructions`.\n+ * Add `hostBindings` to the `TView.hostBindingOpCodes`.\n  *\n  * @param tView `TView` to which the `hostBindings` should be added.\n+ * @param tNode `TNode` the element which contains the directive\n+ * @param lView `LView` current `LView`\n+ * @param directiveIdx Directive index in view.\n+ * @param directiveVarsIdx Where will the directive's vars be stored\n  * @param def `ComponentDef`/`DirectiveDef`, which contains the `hostVars`/`hostBindings` to add.\n  */\n-export function addHostBindingsToExpandoInstructions(\n-    tView: TView, def: ComponentDef<any>|DirectiveDef<any>): void {\n+export function registerHostBindingOpCodes(\n+    tView: TView, tNode: TNode, lView: LView, directiveIdx: number, directiveVarsIdx: number,\n+    def: ComponentDef<any>|DirectiveDef<any>): void {\n   ngDevMode && assertFirstCreatePass(tView);\n-  const expando = tView.expandoInstructions!;\n-  // TODO(misko): PERF we are adding `hostBindings` even if there is nothing to add! This is\n-  // suboptimal for performance. `def.hostBindings` may be null,\n-  // but we still need to push null to the array as a placeholder\n-  // to ensure the directive counter is incremented (so host\n-  // binding functions always line up with the corrective directive).\n-  // This is suboptimal for performance. See `currentDirectiveIndex`\n-  //  comment in `setHostBindingsByExecutingExpandoInstructions` for more\n-  // details.  expando.push(def.hostBindings);\n-  expando.push(def.hostBindings);\n-  const hostVars = def.hostVars;\n-  if (hostVars !== 0) {\n-    expando.push(def.hostVars);\n+\n+  const hostBindings = def.hostBindings;\n+  if (hostBindings) {\n+    let hostBindingOpCodes = tView.hostBindingOpCodes;\n+    if (hostBindingOpCodes === null) {\n+      hostBindingOpCodes = tView.hostBindingOpCodes = [] as any as HostBindingOpCodes;\n+    }\n+    const elementIndx = ~tNode.index;\n+    if (lastSelectedElementIdx(hostBindingOpCodes) != elementIndx) {\n+      // Conditionally add select element so that we are more efficient in execution.\n+      // NOTE: this is strictly not necessary and it trades code size for runtime perf.\n+      // (We could just always add it.)\n+      hostBindingOpCodes.push(elementIndx);\n+    }\n+    hostBindingOpCodes.push(directiveIdx, directiveVarsIdx, hostBindings);\n   }\n }\n \n /**\n- * Grow the `LView`, blueprint and `TView.data` to accommodate the `hostBindings`.\n+ * Returns the last selected element index in the `HostBindingOpCodes`\n  *\n- * To support locality we don't know ahead of time how many `hostVars` of the containing directives\n- * we need to allocate. For this reason we allow growing these data structures as we discover more\n- * directives to accommodate them.\n+ * For perf reasons we don't need to update the selected element index in `HostBindingOpCodes` only\n+ * if it changes. This method returns the last index (or '0' if not found.)\n  *\n- * @param tView `TView` which needs to be grown.\n- * @param lView `LView` which needs to be grown.\n- * @param count Size by which we need to grow the data structures.\n+ * Selected element index are only the ones which are negative.\n  */\n-export function growHostVarsSpace(tView: TView, lView: LView, count: number) {\n-  ngDevMode && assertFirstCreatePass(tView);\n-  ngDevMode && assertSame(tView, lView[TVIEW], '`LView` must be associated with `TView`!');\n-  for (let i = 0; i < count; i++) {\n-    lView.push(NO_CHANGE);\n-    tView.blueprint.push(NO_CHANGE);\n-    tView.data.push(null);\n+function lastSelectedElementIdx(hostBindingOpCodes: HostBindingOpCodes): number {\n+  let i = hostBindingOpCodes.length;\n+  while (i > 0) {\n+    const value = hostBindingOpCodes[--i];\n+    if (typeof value === 'number' && value < 0) {\n+      return value;\n+    }\n   }\n+  return 0;\n }\n \n+\n /**\n  * Instantiate all the directives that were previously resolved on the current node.\n  */\n@@ -1321,7 +1293,6 @@ function instantiateAllDirectives(\n function invokeDirectivesHostBindings(tView: TView, lView: LView, tNode: TNode) {\n   const start = tNode.directiveStart;\n   const end = tNode.directiveEnd;\n-  const expando = tView.expandoInstructions!;\n   const firstCreatePass = tView.firstCreatePass;\n   const elementIndex = tNode.index;\n   const currentDirectiveIndex = getCurrentDirectiveIndex();\n@@ -1333,8 +1304,6 @@ function invokeDirectivesHostBindings(tView: TView, lView: LView, tNode: TNode)\n       setCurrentDirectiveIndex(dirIndex);\n       if (def.hostBindings !== null || def.hostVars !== 0 || def.hostAttrs !== null) {\n         invokeHostBindingsInCreationMode(def, directive);\n-      } else if (firstCreatePass) {\n-        expando.push(null);\n       }\n     }\n   } finally {\n@@ -1355,26 +1324,6 @@ export function invokeHostBindingsInCreationMode(def: DirectiveDef<any>, directi\n   }\n }\n \n-/**\n- * Generates a new block in TView.expandoInstructions for this node.\n- *\n- * Each expando block starts with the element index (turned negative so we can distinguish\n- * it from the hostVar count) and the directive count. See more in VIEW_DATA.md.\n- */\n-export function generateExpandoInstructionBlock(\n-    tView: TView, tNode: TNode, directiveCount: number): void {\n-  ngDevMode &&\n-      assertEqual(\n-          tView.firstCreatePass, true,\n-          'Expando block should only be generated on first create pass.');\n-\n-  const elementIndex = ~tNode.index;\n-  const providerStartIndex = tNode.providerIndexes & TNodeProviderIndexes.ProvidersStartIndexMask;\n-  const providerCount = tView.data.length - providerStartIndex;\n-  (tView.expandoInstructions || (tView.expandoInstructions = []))\n-      .push(elementIndex, providerCount, directiveCount);\n-}\n-\n /**\n  * Matches the current node against all available selectors.\n  * If a component is matched (at most one), it is returned in first position in the array.\n@@ -1450,15 +1399,15 @@ function cacheMatchingLocalNames(\n  * to their directive instances.\n  */\n function saveNameToExportMap(\n-    index: number, def: DirectiveDef<any>|ComponentDef<any>,\n+    directiveIdx: number, def: DirectiveDef<any>|ComponentDef<any>,\n     exportsMap: {[key: string]: number}|null) {\n   if (exportsMap) {\n     if (def.exportAs) {\n       for (let i = 0; i < def.exportAs.length; i++) {\n-        exportsMap[def.exportAs[i]] = index;\n+        exportsMap[def.exportAs[i]] = directiveIdx;\n       }\n     }\n-    if (isComponentDef(def)) exportsMap[''] = index;\n+    if (isComponentDef(def)) exportsMap[''] = directiveIdx;\n   }\n }\n \n@@ -1479,13 +1428,32 @@ export function initTNodeFlags(tNode: TNode, index: number, numberOfDirectives:\n   tNode.providerIndexes = index;\n }\n \n-function baseResolveDirective<T>(tView: TView, viewData: LView, def: DirectiveDef<T>) {\n-  tView.data.push(def);\n+/**\n+ * Setup directive for instantiation.\n+ *\n+ * We need to create a `NodeInjectorFactory` which is then inserted in both the `Blueprint` as well\n+ * as `LView`. `TView` gets the `DirectiveDef`.\n+ *\n+ * @param tView `TView`\n+ * @param tNode `TNode`\n+ * @param lView `LView`\n+ * @param directiveIndex Index where the directive will be stored in the Expando.\n+ * @param def `DirectiveDef`\n+ */\n+function configureViewWithDirective<T>(\n+    tView: TView, tNode: TNode, lView: LView, directiveIndex: number, def: DirectiveDef<T>): void {\n+  ngDevMode &&\n+      assertGreaterThanOrEqual(directiveIndex, HEADER_OFFSET, 'Must be in Expando section');\n+  tView.data[directiveIndex] = def;\n   const directiveFactory =\n       def.factory || ((def as {factory: Function}).factory = getFactoryDef(def.type, true));\n   const nodeInjectorFactory = new NodeInjectorFactory(directiveFactory, isComponentDef(def), null);\n-  tView.blueprint.push(nodeInjectorFactory);\n-  viewData.push(nodeInjectorFactory);\n+  tView.blueprint[directiveIndex] = nodeInjectorFactory;\n+  lView[directiveIndex] = nodeInjectorFactory;\n+\n+  registerHostBindingOpCodes(\n+      tView, tNode, lView, directiveIndex, allocExpando(tView, lView, def.hostVars, NO_CHANGE),\n+      def);\n }\n \n function addComponentLogic<T>(lView: LView, hostTNode: TElementNode, def: ComponentDef<T>): void {"
        },
        {
            "sha": "94e27e627fa37b0f5a742bbd1e43921349e62e96",
            "filename": "packages/core/src/render3/interfaces/node.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -409,11 +409,17 @@ export interface TNode {\n \n   /**\n    * Stores starting index of the directives.\n+   *\n+   * NOTE: The first directive is always component (if present).\n    */\n   directiveStart: number;\n \n   /**\n    * Stores final exclusive index of the directives.\n+   *\n+   * The area right behind the `directiveStart-directiveEnd` range is used to allocate the\n+   * `HostBindingFunction` `vars` (or null if no bindings.) Therefore `directiveEnd` is used to set\n+   * `LFrame.bindingRootIndex` before `HostBindingFunction` is executed.\n    */\n   directiveEnd: number;\n "
        },
        {
            "sha": "331da6090a9764d39e1198c4f850f6412e425295",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 64,
            "deletions": 8,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -427,11 +427,69 @@ export const enum PreOrderHookFlags {\n }\n \n /**\n- * Set of instructions used to process host bindings efficiently.\n+ * Stores a set of OpCodes to process `HostBindingsFunction` associated with a current view.\n+ *\n+ * In order to invoke `HostBindingsFunction` we need:\n+ * 1. 'elementIdx`: Index to the element associated with the `HostBindingsFunction`.\n+ * 2. 'directiveIdx`: Index to the directive associated with the `HostBindingsFunction`. (This will\n+ *    become the context for the `HostBindingsFunction` invocation.)\n+ * 3. `bindingRootIdx`: Location where the bindings for the `HostBindingsFunction` start. Internally\n+ *    `HostBindingsFunction` binding indexes start from `0` so we need to add `bindingRootIdx` to\n+ *    it.\n+ * 4. `HostBindingsFunction`: A host binding function to execute.\n+ *\n+ * The above information needs to be encoded into the `HostBindingOpCodes` in an efficient manner.\n+ *\n+ * 1. `elementIdx` is encoded into the `HostBindingOpCodes` as `~elementIdx` (so a negative number);\n+ * 2. `directiveIdx`\n+ * 3. `bindingRootIdx`\n+ * 4. `HostBindingsFunction` is passed in as is.\n+ *\n+ * The `HostBindingOpCodes` array contains:\n+ * - negative number to select the element index.\n+ * - followed by 1 or more of:\n+ *    - a number to select the directive index\n+ *    - a number to select the bindingRoot index\n+ *    - and a function to invoke.\n+ *\n+ * ## Example\n+ *\n+ * ```\n+ * const hostBindingOpCodes = [\n+ *   ~30,                               // Select element 30\n+ *   40, 45, MyDir.ɵdir.hostBindings    // Invoke host bindings on MyDir on element 30;\n+ *                                      // directiveIdx = 40; bindingRootIdx = 45;\n+ *   50, 55, OtherDir.ɵdir.hostBindings // Invoke host bindings on OtherDire on element 30\n+ *                                      // directiveIdx = 50; bindingRootIdx = 55;\n+ * ]\n+ * ```\n+ *\n+ * ## Pseudocode\n+ * ```\n+ * const hostBindingOpCodes = tView.hostBindingOpCodes;\n+ * if (hostBindingOpCodes === null) return;\n+ * for (let i = 0; i < hostBindingOpCodes.length; i++) {\n+ *   const opCode = hostBindingOpCodes[i] as number;\n+ *   if (opCode < 0) {\n+ *     // Negative numbers are element indexes.\n+ *     setSelectedIndex(~opCode);\n+ *   } else {\n+ *     // Positive numbers are NumberTuple which store bindingRootIndex and directiveIndex.\n+ *     const directiveIdx = opCode;\n+ *     const bindingRootIndx = hostBindingOpCodes[++i] as number;\n+ *     const hostBindingFn = hostBindingOpCodes[++i] as HostBindingsFunction<any>;\n+ *     setBindingRootForHostBindings(bindingRootIndx, directiveIdx);\n+ *     const context = lView[directiveIdx];\n+ *     hostBindingFn(RenderFlags.Update, context);\n+ *   }\n+ * }\n+ * ```\n  *\n- * See VIEW_DATA.md for more information.\n  */\n-export interface ExpandoInstructions extends Array<number|HostBindingsFunction<any>|null> {}\n+export interface HostBindingOpCodes extends Array<number|HostBindingsFunction<any>> {\n+  __brand__: 'HostBindingOpCodes';\n+  debug?: string[];\n+}\n \n /**\n  * Explicitly marks `TView` as a specific type in `ngDevMode`\n@@ -572,13 +630,11 @@ export interface TView {\n   firstChild: TNode|null;\n \n   /**\n-   * Set of instructions used to process host bindings efficiently.\n+   * Stores the OpCodes to be replayed during change-detection to process the `HostBindings`\n    *\n-   * See VIEW_DATA.md for more information.\n+   * See `HostBindingOpCodes` for encoding details.\n    */\n-  // TODO(misko): `expandoInstructions` should be renamed to `hostBindingsInstructions` since they\n-  // keep track of `hostBindings` which need to be executed.\n-  expandoInstructions: ExpandoInstructions|null;\n+  hostBindingOpCodes: HostBindingOpCodes|null;\n \n   /**\n    * Full registry of directives and components that may be found in this view."
        },
        {
            "sha": "14046b06732830dea79ae2d2edd0445c11f1d1cc",
            "filename": "packages/core/src/render3/query.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -570,7 +570,7 @@ function createTQuery(tView: TView, metadata: TQueryMetadata, nodeIndex: number)\n function saveContentQueryAndDirectiveIndex(tView: TView, directiveIndex: number) {\n   const tViewContentQueries = tView.contentQueries || (tView.contentQueries = []);\n   const lastSavedDirectiveIndex =\n-      tView.contentQueries.length ? tViewContentQueries[tViewContentQueries.length - 1] : -1;\n+      tViewContentQueries.length ? tViewContentQueries[tViewContentQueries.length - 1] : -1;\n   if (directiveIndex !== lastSavedDirectiveIndex) {\n     tViewContentQueries.push(tView.queries!.length - 1, directiveIndex);\n   }"
        },
        {
            "sha": "0d1b098faa53fa3751ca8aea86e8f54f22c38057",
            "filename": "packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 8,
            "deletions": 17,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -69,10 +69,10 @@\n     \"name\": \"addComponentLogic\"\n   },\n   {\n-    \"name\": \"addHostBindingsToExpandoInstructions\"\n+    \"name\": \"addToViewTree\"\n   },\n   {\n-    \"name\": \"addToViewTree\"\n+    \"name\": \"allocExpando\"\n   },\n   {\n     \"name\": \"allocLFrame\"\n@@ -86,9 +86,6 @@\n   {\n     \"name\": \"autoRegisterModuleById\"\n   },\n-  {\n-    \"name\": \"baseResolveDirective\"\n-  },\n   {\n     \"name\": \"callHook\"\n   },\n@@ -104,6 +101,9 @@\n   {\n     \"name\": \"concatStringsWithSpace\"\n   },\n+  {\n+    \"name\": \"configureViewWithDirective\"\n+  },\n   {\n     \"name\": \"createLFrame\"\n   },\n@@ -146,9 +146,6 @@\n   {\n     \"name\": \"findAttrIndexInNode\"\n   },\n-  {\n-    \"name\": \"generateExpandoInstructionBlock\"\n-  },\n   {\n     \"name\": \"generateInitialInputs\"\n   },\n@@ -206,9 +203,6 @@\n   {\n     \"name\": \"getTView\"\n   },\n-  {\n-    \"name\": \"growHostVarsSpace\"\n-  },\n   {\n     \"name\": \"hasTagAndTypeMatch\"\n   },\n@@ -284,9 +278,6 @@\n   {\n     \"name\": \"nativeAppendOrInsertBefore\"\n   },\n-  {\n-    \"name\": \"nativeInsertBefore\"\n-  },\n   {\n     \"name\": \"nextNgElementId\"\n   },\n@@ -305,6 +296,9 @@\n   {\n     \"name\": \"refreshView\"\n   },\n+  {\n+    \"name\": \"registerHostBindingOpCodes\"\n+  },\n   {\n     \"name\": \"rememberChangeHistoryAndInvokeOnChangesHook\"\n   },\n@@ -350,9 +344,6 @@\n   {\n     \"name\": \"setUpAttributes\"\n   },\n-  {\n-    \"name\": \"unwrapRNode\"\n-  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },"
        },
        {
            "sha": "b19e08aa6ccc924074c408e2a364686e678a0803",
            "filename": "packages/core/test/bundling/forms/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -698,15 +698,15 @@\n   {\n     \"name\": \"addComponentLogic\"\n   },\n-  {\n-    \"name\": \"addHostBindingsToExpandoInstructions\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n   {\n     \"name\": \"addToViewTree\"\n   },\n+  {\n+    \"name\": \"allocExpando\"\n+  },\n   {\n     \"name\": \"allocLFrame\"\n   },\n@@ -734,9 +734,6 @@\n   {\n     \"name\": \"baseElement\"\n   },\n-  {\n-    \"name\": \"baseResolveDirective\"\n-  },\n   {\n     \"name\": \"bindingUpdated\"\n   },\n@@ -785,6 +782,9 @@\n   {\n     \"name\": \"config\"\n   },\n+  {\n+    \"name\": \"configureViewWithDirective\"\n+  },\n   {\n     \"name\": \"connectableObservableDescriptor\"\n   },\n@@ -941,9 +941,6 @@\n   {\n     \"name\": \"fromArray\"\n   },\n-  {\n-    \"name\": \"generateExpandoInstructionBlock\"\n-  },\n   {\n     \"name\": \"generateInitialInputs\"\n   },\n@@ -1082,9 +1079,6 @@\n   {\n     \"name\": \"getTView\"\n   },\n-  {\n-    \"name\": \"growHostVarsSpace\"\n-  },\n   {\n     \"name\": \"handleError\"\n   },\n@@ -1421,6 +1415,9 @@\n   {\n     \"name\": \"registerDestroyHooksIfSupported\"\n   },\n+  {\n+    \"name\": \"registerHostBindingOpCodes\"\n+  },\n   {\n     \"name\": \"registerPostOrderHooks\"\n   },"
        },
        {
            "sha": "86f1cbb72764ba99fc9af9b6beaf276462cf7a31",
            "filename": "packages/core/test/bundling/hello_world/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -56,6 +56,9 @@\n   {\n     \"name\": \"_renderCompCount\"\n   },\n+  {\n+    \"name\": \"allocExpando\"\n+  },\n   {\n     \"name\": \"allocLFrame\"\n   },\n@@ -176,9 +179,6 @@\n   {\n     \"name\": \"nativeAppendOrInsertBefore\"\n   },\n-  {\n-    \"name\": \"nativeInsertBefore\"\n-  },\n   {\n     \"name\": \"nextNgElementId\"\n   },\n@@ -194,6 +194,9 @@\n   {\n     \"name\": \"refreshView\"\n   },\n+  {\n+    \"name\": \"registerHostBindingOpCodes\"\n+  },\n   {\n     \"name\": \"rememberChangeHistoryAndInvokeOnChangesHook\"\n   },\n@@ -224,16 +227,10 @@\n   {\n     \"name\": \"setSelectedIndex\"\n   },\n-  {\n-    \"name\": \"unwrapRNode\"\n-  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },\n   {\n     \"name\": \"viewAttachedToChangeDetector\"\n-  },\n-  {\n-    \"name\": \"ɵɵtext\"\n   }\n ]\n\\ No newline at end of file"
        },
        {
            "sha": "ac4e8100feac01e574025dbb660df301bfdf0920",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -920,9 +920,6 @@\n   {\n     \"name\": \"addComponentLogic\"\n   },\n-  {\n-    \"name\": \"addHostBindingsToExpandoInstructions\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n@@ -935,6 +932,9 @@\n   {\n     \"name\": \"advanceActivatedRouteNodeAndItsChildren\"\n   },\n+  {\n+    \"name\": \"allocExpando\"\n+  },\n   {\n     \"name\": \"allocLFrame\"\n   },\n@@ -965,9 +965,6 @@\n   {\n     \"name\": \"baseElement\"\n   },\n-  {\n-    \"name\": \"baseResolveDirective\"\n-  },\n   {\n     \"name\": \"bindingUpdated\"\n   },\n@@ -1016,6 +1013,9 @@\n   {\n     \"name\": \"config\"\n   },\n+  {\n+    \"name\": \"configureViewWithDirective\"\n+  },\n   {\n     \"name\": \"connectableObservableDescriptor\"\n   },\n@@ -1244,9 +1244,6 @@\n   {\n     \"name\": \"fromArray\"\n   },\n-  {\n-    \"name\": \"generateExpandoInstructionBlock\"\n-  },\n   {\n     \"name\": \"generateInitialInputs\"\n   },\n@@ -1427,9 +1424,6 @@\n   {\n     \"name\": \"getToken\"\n   },\n-  {\n-    \"name\": \"growHostVarsSpace\"\n-  },\n   {\n     \"name\": \"handleError\"\n   },\n@@ -1760,6 +1754,9 @@\n   {\n     \"name\": \"refreshView\"\n   },\n+  {\n+    \"name\": \"registerHostBindingOpCodes\"\n+  },\n   {\n     \"name\": \"registerPostOrderHooks\"\n   },"
        },
        {
            "sha": "ff13d11633a2baa491c5fb0e1fadd706a5eb0c2d",
            "filename": "packages/core/test/bundling/todo/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -176,15 +176,15 @@\n   {\n     \"name\": \"addComponentLogic\"\n   },\n-  {\n-    \"name\": \"addHostBindingsToExpandoInstructions\"\n-  },\n   {\n     \"name\": \"addToArray\"\n   },\n   {\n     \"name\": \"addToViewTree\"\n   },\n+  {\n+    \"name\": \"allocExpando\"\n+  },\n   {\n     \"name\": \"allocLFrame\"\n   },\n@@ -209,9 +209,6 @@\n   {\n     \"name\": \"attachPatchData\"\n   },\n-  {\n-    \"name\": \"baseResolveDirective\"\n-  },\n   {\n     \"name\": \"bindingUpdated\"\n   },\n@@ -242,6 +239,9 @@\n   {\n     \"name\": \"concatStringsWithSpace\"\n   },\n+  {\n+    \"name\": \"configureViewWithDirective\"\n+  },\n   {\n     \"name\": \"createDirectivesInstances\"\n   },\n@@ -323,9 +323,6 @@\n   {\n     \"name\": \"forwardRef\"\n   },\n-  {\n-    \"name\": \"generateExpandoInstructionBlock\"\n-  },\n   {\n     \"name\": \"generateInitialInputs\"\n   },\n@@ -431,9 +428,6 @@\n   {\n     \"name\": \"getTView\"\n   },\n-  {\n-    \"name\": \"growHostVarsSpace\"\n-  },\n   {\n     \"name\": \"handleError\"\n   },\n@@ -605,6 +599,9 @@\n   {\n     \"name\": \"refreshView\"\n   },\n+  {\n+    \"name\": \"registerHostBindingOpCodes\"\n+  },\n   {\n     \"name\": \"registerPostOrderHooks\"\n   },"
        },
        {
            "sha": "7248ccbd1fa4aa02824534f03097086cd78b35e5",
            "filename": "packages/core/test/render3/is_shape_of.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "raw_url": "https://github.com/angular/angular/raw/68d4de6770361099491ab0aa84ed2b58c64d39cb/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts?ref=68d4de6770361099491ab0aa84ed2b58c64d39cb",
            "patch": "@@ -119,7 +119,7 @@ const ShapeOfTView: ShapeOf<TView> = {\n   staticViewQueries: true,\n   staticContentQueries: true,\n   firstChild: true,\n-  expandoInstructions: true,\n+  hostBindingOpCodes: true,\n   directiveRegistry: true,\n   pipeRegistry: true,\n   preOrderHooks: true,"
        }
    ],
    "stats": {
        "total": 655,
        "additions": 308,
        "deletions": 347
    }
}