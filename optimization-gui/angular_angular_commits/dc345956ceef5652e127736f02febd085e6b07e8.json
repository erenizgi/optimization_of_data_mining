{
    "author": "mgechev",
    "message": "fix(devtools): show properly dynamically inserted content with DOM APIs (rangle/angular-devtools#828)\n\nFix rangle/angular-devtools#791\r\n\r\nBuild the render tree starting from the root node of the application.\r\nThis fix is applicable only for v12+ apps that are using the latest\r\ndebugging APIs.",
    "sha": "dc345956ceef5652e127736f02febd085e6b07e8",
    "files": [
        {
            "sha": "90191da352dedaa395943107eb450203bc86e185",
            "filename": "projects/ng-devtools-backend/src/lib/directive-forest/render-tree.spec.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/dc345956ceef5652e127736f02febd085e6b07e8/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/dc345956ceef5652e127736f02febd085e6b07e8/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.spec.ts?ref=dc345956ceef5652e127736f02febd085e6b07e8",
            "patch": "@@ -74,4 +74,28 @@ describe('render tree extraction', () => {\n     expect(rtree[0].children.length).toBe(1);\n     expect(rtree[0].children[0].children.length).toBe(0);\n   });\n+\n+  it('should go all the way to the root element to look up for nodes', () => {\n+    const rootNode = document.createElement('body');\n+    const siblingNode = document.createElement('section');\n+    const appNode = document.createElement('app');\n+    const childNode = document.createElement('div');\n+    const childComponentNode = document.createElement('child');\n+    rootNode.appendChild(appNode);\n+    rootNode.appendChild(siblingNode);\n+    appNode.appendChild(childNode);\n+    childNode.appendChild(childComponentNode);\n+\n+    const appComponent: any = {};\n+    const childComponent: any = {};\n+    const siblingComponent: any = {};\n+    componentMap.set(siblingNode, siblingComponent);\n+    componentMap.set(appNode, appComponent);\n+    componentMap.set(childComponentNode, childComponent);\n+\n+    const rtree = treeStrategy.build(appNode);\n+    expect(rtree[0].children.length).toBe(1);\n+    expect(rtree[0].children[0].children.length).toBe(0);\n+    expect(rtree[1].component?.instance).toBe(siblingComponent);\n+  });\n });"
        },
        {
            "sha": "9e639b47d0fc625e913adf79a76846a8c885cfdd",
            "filename": "projects/ng-devtools-backend/src/lib/directive-forest/render-tree.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/dc345956ceef5652e127736f02febd085e6b07e8/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/dc345956ceef5652e127736f02febd085e6b07e8/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fdirective-forest%2Frender-tree.ts?ref=dc345956ceef5652e127736f02febd085e6b07e8",
            "patch": "@@ -56,6 +56,11 @@ export class RTreeStrategy {\n   }\n \n   build(element: Element): ComponentTreeNode[] {\n+    // We want to start from the root element so that we can find components which are attached to the application ref\n+    // and which host elements have been inserted with DOM APIs.\n+    while (element.parentElement) {\n+      element = element.parentElement;\n+    }\n     const getComponent = (window as any).ng.getComponent as (element: Element) => {};\n     const getDirectives = (window as any).ng.getDirectives as (node: Node) => {}[];\n     const result = extractViewTree(element, [], getComponent, getDirectives);"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 29,
        "deletions": 0
    }
}