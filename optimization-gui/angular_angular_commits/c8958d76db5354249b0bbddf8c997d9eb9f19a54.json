{
    "author": "gkalpak",
    "message": "build(docs-infra): simplify updating dependencies in docs examples boilerplate (#38992)\n\nPreviously, when updating the dependency versions in\n`aio/tools/examples/shared/package.json` (which contains all\ndependencies used in docs examples projects), one had to manually go\nthrough all boilerplate directories and update the `package.json` files\nwith the same versions.\n\nThis commit simplifies this task by automating it via a Node.js script.\n\nPR Close #38992",
    "sha": "c8958d76db5354249b0bbddf8c997d9eb9f19a54",
    "files": [
        {
            "sha": "65c7f1d6e879b8f8f0cdf29fc5f0dbc6f6e9593e",
            "filename": "aio/tools/examples/UPDATING.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2FUPDATING.md",
            "raw_url": "https://github.com/angular/angular/raw/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2FUPDATING.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2FUPDATING.md?ref=c8958d76db5354249b0bbddf8c997d9eb9f19a54",
            "patch": "@@ -9,7 +9,7 @@ Follow these steps to update the examples to the latest versions of Angular (and\n \n - In the [shared/](./shared) folder, run `yarn` to update the dependencies in the [shared/node_modules/](./shared/node_modules) folder and the [shared/yarn.lock](./shared/yarn.lock) file.\n \n-- In the [shared/boilerplate/](./shared/boilerplate) folder, go through each sub-folder and update the dependency versions in all `package.json` files to match the ones in [shared/package.json](./shared/package.json).\n+- In the [shared/](./shared) folder, run `yarn sync-deps` to update the dependency versions of the `package.json` files in each sub-folder of [shared/boilerplate/](./shared/boilerplate) to match the ones in [shared/package.json](./shared/package.json).\n \n - Follow the steps in the following section to update the rest of the boilerplate files.\n "
        },
        {
            "sha": "ddc2cf36722c9096f8757388ea470d26c69cb2aa",
            "filename": "aio/tools/examples/shared/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json?ref=c8958d76db5354249b0bbddf8c997d9eb9f19a54",
            "patch": "@@ -8,7 +8,8 @@\n     \"protractor\": \"protractor\",\n     \"webdriver:update\": \"node ../../../../scripts/webdriver-manager-update.js\",\n     \"preinstall\": \"node ../../../../tools/yarn/check-yarn.js\",\n-    \"postinstall\": \"yarn webdriver:update\"\n+    \"postinstall\": \"yarn webdriver:update\",\n+    \"sync-deps\": \"node sync-boilerplate-dependencies\"\n   },\n   \"//engines-comment\": \"Keep this in sync with /package.json and /aio/package.json\",\n   \"engines\": {"
        },
        {
            "sha": "439c627fe93c0eae5b21fc93bf7595b37fdd9dcb",
            "filename": "aio/tools/examples/shared/sync-boilerplate-dependencies.js",
            "status": "added",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/angular/angular/blob/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2Fshared%2Fsync-boilerplate-dependencies.js",
            "raw_url": "https://github.com/angular/angular/raw/c8958d76db5354249b0bbddf8c997d9eb9f19a54/aio%2Ftools%2Fexamples%2Fshared%2Fsync-boilerplate-dependencies.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fsync-boilerplate-dependencies.js?ref=c8958d76db5354249b0bbddf8c997d9eb9f19a54",
            "patch": "@@ -0,0 +1,64 @@\n+#!/usr/bin/env node\n+\n+/**\n+ * Usage:\n+ * ```sh\n+ * node sync-boilerplate-dependencies\n+ * ```\n+ *\n+ * Updates the dependency versions of the top-level `package.json` files in each sub-folder of\n+ * `./boilerplate/` and `./boilerplate/viewengine/` to match the ones in `./package.json`.\n+ */\n+const fs = require('fs');\n+const path = require('path');\n+\n+\n+const BOILERPLATE_DIR = `${__dirname}/boilerplate`;\n+const VIEWENGINE_DIR = `${BOILERPLATE_DIR}/viewengine`;\n+const SHARED_PACKAGE_JSON_PATH = `${__dirname}/package.json`;\n+\n+const sharedPkgJson = loadJsonFile(SHARED_PACKAGE_JSON_PATH);\n+const boilerplatePkgJsonPaths = [\n+  ...collectPackageJsonFiles(BOILERPLATE_DIR),\n+  ...collectPackageJsonFiles(VIEWENGINE_DIR),\n+];\n+\n+boilerplatePkgJsonPaths.forEach(syncDependencies);\n+\n+// Helpers\n+function collectPackageJsonFiles(dirPath) {\n+  return fs.readdirSync(dirPath)\n+      .map(childName => `${dirPath}/${childName}`)\n+      .filter(childPath => fs.statSync(childPath).isDirectory())\n+      .map(subDirPath => `${subDirPath}/package.json`)\n+      .filter(pkgJsonPath => fs.existsSync(pkgJsonPath));\n+}\n+\n+function loadJsonFile(filePath) {\n+  return JSON.parse(fs.readFileSync(filePath, 'utf8'));\n+}\n+\n+function syncDependencies(boilerplatePkgJsonPath) {\n+  console.log(`Syncing '${path.relative(__dirname, boilerplatePkgJsonPath)}'...`);\n+\n+  const boilerplatePkgJson = loadJsonFile(boilerplatePkgJsonPath);\n+\n+  ['dependencies', 'devDependencies', 'peerDependencies']\n+    .filter(depsProp => boilerplatePkgJson.hasOwnProperty(depsProp))\n+    .forEach(depsProp => {\n+      const srcDeps = sharedPkgJson[depsProp];\n+      const dstDeps = boilerplatePkgJson[depsProp];\n+\n+      for (const dep of Object.keys(dstDeps)) {\n+        if (!srcDeps.hasOwnProperty(dep)) {\n+          throw new Error(\n+              `Unable to update dependency '${dep}' in '${boilerplatePkgJsonPath} > ${depsProp}'. ` +\n+              `The dependency is missing from '${SHARED_PACKAGE_JSON_PATH}'.`);\n+        }\n+\n+        dstDeps[dep] = srcDeps[dep];\n+      }\n+    });\n+\n+  fs.writeFileSync(boilerplatePkgJsonPath, `${JSON.stringify(boilerplatePkgJson, null, 2)}\\n`);\n+}"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 67,
        "deletions": 2
    }
}