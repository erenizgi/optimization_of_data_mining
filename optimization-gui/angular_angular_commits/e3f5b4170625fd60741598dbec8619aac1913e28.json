{
    "author": "bjarkler",
    "message": "fix(docs-infra): make pretty-printer compatible with Trusted Types (#42800)\n\nChange the PrettyPrinter interface to accept a TrustedHTML and patch\nprettify.js so that it makes use of that value without modification.\nUpdate all users of the service to produce, and pass in a TrustedHTML.\n\nPR Close #42800",
    "sha": "e3f5b4170625fd60741598dbec8619aac1913e28",
    "files": [
        {
            "sha": "c7b06996ec2b572dba784aad5a54ad291f364636",
            "filename": "aio/src/app/custom-elements/code/code-example.component.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.spec.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -33,7 +33,7 @@ describe('CodeExampleComponent', () => {\n   });\n \n   it('should be able to capture the code snippet provided in content', () => {\n-    expect(codeExampleComponent.aioCode.code.trim()).toBe('const foo = \"bar\";');\n+    expect(codeExampleComponent.aioCode.code.toString().trim()).toBe('const foo = \"bar\";');\n   });\n \n   it('should clean-up the projected code snippet once captured', () => {"
        },
        {
            "sha": "f77fbebbf0516dd24f3798cd716688318262af69",
            "filename": "aio/src/app/custom-elements/code/code-example.component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-example.component.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -1,5 +1,6 @@\n /* eslint-disable  @angular-eslint/component-selector */\n import { Component, HostBinding, ElementRef, ViewChild, Input, AfterViewInit } from '@angular/core';\n+import { fromInnerHTML } from 'app/shared/security';\n import { CodeComponent } from './code.component';\n \n /**\n@@ -87,7 +88,7 @@ export class CodeExampleComponent implements AfterViewInit {\n \n   ngAfterViewInit() {\n     const contentElem = this.content.nativeElement;\n-    this.aioCode.code = contentElem.innerHTML;\n+    this.aioCode.code = fromInnerHTML(contentElem);\n     contentElem.textContent = '';  // Remove DOM nodes that are no longer needed.\n   }\n }"
        },
        {
            "sha": "14c7a3de987bdace19e4732671b2f14608721b77",
            "filename": "aio/src/app/custom-elements/code/code-tabs.component.spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.spec.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -43,7 +43,7 @@ describe('CodeTabsComponent', () => {\n     expect(tabs[0].path).toBe('path-A');\n     expect(tabs[0].region).toBe('region-A');\n     expect(tabs[0].header).toBe('header-A');\n-    expect(tabs[0].code.trim()).toBe('Code example 1');\n+    expect(tabs[0].code.toString().trim()).toBe('Code example 1');\n \n     // Second code pane expectations\n     expect(tabs[1].class).toBe('class-B');\n@@ -53,7 +53,7 @@ describe('CodeTabsComponent', () => {\n     expect(tabs[1].path).toBe('path-B');\n     expect(tabs[1].region).toBe('region-B');\n     expect(tabs[1].header).toBe('header-B');\n-    expect(tabs[1].code.trim()).toBe('Code example 2');\n+    expect(tabs[1].code.toString().trim()).toBe('Code example 2');\n   });\n \n   it('should create the right number of tabs with the right labels and classes', () => {"
        },
        {
            "sha": "ec0e7ff2517a10ebb1a97929bededb465a4f9192",
            "filename": "aio/src/app/custom-elements/code/code-tabs.component.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode-tabs.component.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -1,10 +1,11 @@\n /* eslint-disable  @angular-eslint/component-selector */\n import { AfterViewInit, Component, ElementRef, Input, OnInit, QueryList, ViewChild, ViewChildren } from '@angular/core';\n+import { fromInnerHTML } from 'app/shared/security';\n import { CodeComponent } from './code.component';\n \n export interface TabInfo {\n   class: string;\n-  code: string;\n+  code: TrustedHTML;\n   path: string;\n   region: string;\n \n@@ -80,7 +81,7 @@ export class CodeTabsComponent implements OnInit, AfterViewInit {\n   private getTabInfo(tabContent: Element): TabInfo {\n     return {\n       class: tabContent.getAttribute('class') || '',\n-      code: tabContent.innerHTML,\n+      code: fromInnerHTML(tabContent),\n       path: tabContent.getAttribute('path') || '',\n       region: tabContent.getAttribute('region') || '',\n "
        },
        {
            "sha": "3b23618d9b7e9294470edef420bcb8fa50d17334",
            "filename": "aio/src/app/custom-elements/code/code.component.spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -8,18 +8,18 @@ import { Clipboard } from '@angular/cdk/clipboard';\n import { CodeComponent } from './code.component';\n import { CodeModule } from './code.module';\n import { Logger } from 'app/shared/logger.service';\n+import { htmlEscape } from 'safevalues';\n import { MockPrettyPrinter } from 'testing/pretty-printer.service';\n import { PrettyPrinter } from './pretty-printer.service';\n \n const oneLineCode = 'const foo = \"bar\";';\n \n-const smallMultiLineCode =\n-`&lt;hero-details&gt;\n-  &lt;h2&gt;Bah Dah Bing&lt;/h2&gt;\n-  &lt;hero-team&gt;\n-    &lt;h3&gt;NYC Team&lt;/h3&gt;\n-  &lt;/hero-team&gt;\n-&lt;/hero-details&gt;`;\n+const smallMultiLineCode = `<hero-details>\n+  <h2>Bah Dah Bing</h2>\n+  <hero-team>\n+    <h3>NYC Team</h3>\n+  </hero-team>\n+</hero-details>`;\n \n const bigMultiLineCode = `${smallMultiLineCode}\\n${smallMultiLineCode}\\n${smallMultiLineCode}`;\n \n@@ -73,7 +73,7 @@ describe('CodeComponent', () => {\n     it('should format a small multi-line code sample without linenums by default', () => {\n       hostComponent.setCode(smallMultiLineCode);\n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: false): ${smallMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: false): ${htmlEscape(smallMultiLineCode)}`);\n     });\n \n     it('should add line numbers to a small multi-line code sample when linenums is `true`', () => {\n@@ -82,7 +82,7 @@ describe('CodeComponent', () => {\n       fixture.detectChanges();\n \n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: true): ${smallMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: true): ${htmlEscape(smallMultiLineCode)}`);\n     });\n \n     it('should add line numbers to  a small multi-line code sample when linenums is `\\'true\\'`', () => {\n@@ -91,13 +91,13 @@ describe('CodeComponent', () => {\n       fixture.detectChanges();\n \n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: true): ${smallMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: true): ${htmlEscape(smallMultiLineCode)}`);\n     });\n \n     it('should format a big multi-line code without linenums by default', () => {\n       hostComponent.setCode(bigMultiLineCode);\n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: false): ${bigMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: false): ${htmlEscape(bigMultiLineCode)}`);\n     });\n \n     it('should add line numbers to a big multi-line code sample when linenums is `true`', () => {\n@@ -106,7 +106,7 @@ describe('CodeComponent', () => {\n       fixture.detectChanges();\n \n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: true): ${bigMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: true): ${htmlEscape(bigMultiLineCode)}`);\n     });\n \n     it('should add line numbers to  a big multi-line code sample when linenums is `\\'true\\'`', () => {\n@@ -115,7 +115,7 @@ describe('CodeComponent', () => {\n       fixture.detectChanges();\n \n       expect(getFormattedCode()).toBe(\n-          `Formatted code (language: auto, linenums: true): ${bigMultiLineCode}`);\n+          `Formatted code (language: auto, linenums: true): ${htmlEscape(bigMultiLineCode)}`);\n     });\n \n     it('should skip prettify if language is `\\'none\\'`', () => {\n@@ -124,7 +124,7 @@ describe('CodeComponent', () => {\n \n       fixture.detectChanges();\n \n-      expect(getFormattedCode()).toBe(bigMultiLineCode);\n+      expect(getFormattedCode()).toBe(htmlEscape(bigMultiLineCode).toString());\n     });\n   });\n \n@@ -247,7 +247,7 @@ describe('CodeComponent', () => {\n     it('should preserve newlines in the copied code', () => {\n       const clipboard = TestBed.inject(Clipboard);\n       const spy = spyOn(clipboard, 'copy');\n-      const expectedCode = smallMultiLineCode.trim().replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n+      const expectedCode = smallMultiLineCode.trim();\n       let actualCode;\n \n       hostComponent.setCode(smallMultiLineCode);\n@@ -314,7 +314,7 @@ class HostComponent implements AfterViewInit {\n \n   /** Changes the displayed code on the code component. */\n   setCode(code: string) {\n-    this.codeComponent.code = code;\n+    this.codeComponent.code = htmlEscape(code);\n   }\n }\n "
        },
        {
            "sha": "57bd816280260fb02df076255dfc559970459b49",
            "filename": "aio/src/app/custom-elements/code/code.component.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 11,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -5,6 +5,9 @@ import { PrettyPrinter } from './pretty-printer.service';\n import { MatSnackBar } from '@angular/material/snack-bar';\n import { Observable, of } from 'rxjs';\n import { tap } from 'rxjs/operators';\n+import { unwrapHtmlForSink } from 'safevalues';\n+import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n+import { fromOuterHTML } from 'app/shared/security';\n \n /**\n  * Formatted Code Block\n@@ -48,17 +51,19 @@ export class CodeComponent implements OnChanges {\n   private codeText: string;\n \n   /** Code that should be formatted with current inputs and displayed in the view. */\n-  set code(code: string) {\n+  set code(code: TrustedHTML) {\n     this._code = code;\n \n-    if (!this._code || !this._code.trim()) {\n+    if (!this._code.toString().trim()) {\n       this.showMissingCodeMessage();\n     } else {\n       this.formatDisplayedCode();\n     }\n   }\n-  get code(): string { return this._code; }\n-  _code: string;\n+  get code(): TrustedHTML {\n+    return this._code;\n+  }\n+  _code: TrustedHTML;\n \n   /** Whether the copy button should be shown. */\n   @Input() hideCopy: boolean;\n@@ -130,15 +135,18 @@ export class CodeComponent implements OnChanges {\n   /** Sets the message showing that the code could not be found. */\n   private showMissingCodeMessage() {\n     const src = this.path ? this.path + (this.region ? '#' + this.region : '') : '';\n-    const srcMsg = src ? ` for\\n${src}` : '.';\n-    this.setCodeHtml(`<p class=\"code-missing\">The code sample is missing${srcMsg}</p>`);\n+    const msg = `The code sample is missing${src ? ` for\\n${src}` : '.'}`;\n+    const el = document.createElement('p');\n+    el.className = 'code-missing';\n+    el.textContent = msg;\n+    this.setCodeHtml(fromOuterHTML(el));\n   }\n \n   /** Sets the innerHTML of the code container to the provided code string. */\n-  private setCodeHtml(formattedCode: string) {\n+  private setCodeHtml(formattedCode: TrustedHTML) {\n     // **Security:** Code example content is provided by docs authors and as such its considered to\n     // be safe for innerHTML purposes.\n-    this.codeContainer.nativeElement.innerHTML = formattedCode;\n+    this.codeContainer.nativeElement.innerHTML = unwrapHtmlForSink(formattedCode);\n   }\n \n   /** Gets the textContent of the displayed code element. */\n@@ -176,16 +184,18 @@ export class CodeComponent implements OnChanges {\n   }\n }\n \n-function leftAlign(text: string): string {\n+function leftAlign(text: TrustedHTML): TrustedHTML {\n   let indent = Number.MAX_VALUE;\n \n-  const lines = text.split('\\n');\n+  const lines = text.toString().split('\\n');\n   lines.forEach(line => {\n     const lineIndent = line.search(/\\S/);\n     if (lineIndent !== -1) {\n       indent = Math.min(lineIndent, indent);\n     }\n   });\n \n-  return lines.map(line => line.substr(indent)).join('\\n').trim();\n+  return htmlFromStringKnownToSatisfyTypeContract(\n+      lines.map(line => line.substr(indent)).join('\\n').trim(),\n+      'safe manipulation of existing trusted HTML');\n }"
        },
        {
            "sha": "bf59921a57fbaa300fe34a04eebf96d7bd4f9304",
            "filename": "aio/src/app/custom-elements/code/pretty-printer.service.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fpretty-printer.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fpretty-printer.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fpretty-printer.service.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -1,11 +1,12 @@\n import { Injectable } from '@angular/core';\n+import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n \n import { from, Observable } from 'rxjs';\n import { first, map, share } from 'rxjs/operators';\n \n import { Logger } from 'app/shared/logger.service';\n \n-type PrettyPrintOne = (code: string, language?: string, linenums?: number | boolean) => string;\n+type PrettyPrintOne = (code: TrustedHTML, language?: string, linenums?: number|boolean) => string;\n \n /**\n  * Wrapper around the prettify.js library\n@@ -46,13 +47,14 @@ export class PrettyPrinter {\n    *  - number: do display but start at the given number\n    * @returns Observable<string> - Observable of formatted code\n    */\n-  formatCode(code: string, language?: string, linenums?: number | boolean) {\n+  formatCode(code: TrustedHTML, language?: string, linenums?: number|boolean) {\n     return this.prettyPrintOne.pipe(\n       map(ppo => {\n         try {\n-          return ppo(code, language, linenums);\n+          return htmlFromStringKnownToSatisfyTypeContract(\n+              ppo(code, language, linenums), 'prettify.js modifies already trusted HTML inline');\n         } catch (err) {\n-          const msg = `Could not format code that begins '${code.substr(0, 50)}...'.`;\n+          const msg = `Could not format code that begins '${code.toString().substr(0, 50)}...'.`;\n           console.error(msg, err);\n           throw new Error(msg);\n         }"
        },
        {
            "sha": "22defcd8e313a8102b34908f134cfc75ed1a94cf",
            "filename": "aio/src/assets/js/prettify.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fassets%2Fjs%2Fprettify.js",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Fassets%2Fjs%2Fprettify.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fassets%2Fjs%2Fprettify.js?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -1,3 +1,5 @@\n+// Note that this version of prettify.js has been patched to be compatible with\n+// Trusted Types\n !function(){/*\n \n  Copyright (C) 2006 Google Inc.\n@@ -39,8 +41,8 @@ S=/^(DIR|FILE|array|vector|(de|priority_)?queue|(forward_)?list|stack|(const_)?(\n \"\\\"'\"]],[[\"tag\",/^^<\\/?[a-z](?:[\\w.:-]*\\w)?|\\/?>$/i],[\"atn\",/^(?!style[\\s=]|on)[a-z](?:[\\w:-]*\\w)?/i],[\"lang-uq.val\",/^=\\s*([^>\\'\\\"\\s]*(?:[^>\\'\\\"\\s\\/]|\\/(?=\\s)))/],[\"pun\",/^[=<>\\/]+/],[\"lang-js\",/^on\\w+\\s*=\\s*\\\"([^\\\"]+)\\\"/i],[\"lang-js\",/^on\\w+\\s*=\\s*\\'([^\\']+)\\'/i],[\"lang-js\",/^on\\w+\\s*=\\s*([^\\\"\\'>\\s]+)/i],[\"lang-css\",/^style\\s*=\\s*\\\"([^\\\"]+)\\\"/i],[\"lang-css\",/^style\\s*=\\s*\\'([^\\']+)\\'/i],[\"lang-css\",/^style\\s*=\\s*([^\\\"\\'>\\s]+)/i]]),[\"in.tag\"]);t(G([],[[\"atv\",/^[\\s\\S]+/]]),[\"uq.val\"]);t(y({keywords:H,\n hashComments:!0,cStyleComments:!0,types:S}),\"c cc cpp cxx cyc m\".split(\" \"));t(y({keywords:\"null,true,false\"}),[\"json\"]);t(y({keywords:P,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:S}),[\"cs\"]);t(y({keywords:O,cStyleComments:!0}),[\"java\"]);t(y({keywords:C,hashComments:!0,multiLineStrings:!0}),[\"bash\",\"bsh\",\"csh\",\"sh\"]);t(y({keywords:Q,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),[\"cv\",\"py\",\"python\"]);t(y({keywords:\"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END\",\n hashComments:!0,multiLineStrings:!0,regexLiterals:2}),[\"perl\",\"pl\",\"pm\"]);t(y({keywords:R,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),[\"rb\",\"ruby\"]);t(y({keywords:F,cStyleComments:!0,regexLiterals:!0}),[\"javascript\",\"js\",\"ts\",\"typescript\"]);t(y({keywords:\"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes\",hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,\n-regexLiterals:!0}),[\"coffee\"]);t(G([],[[\"str\",/^[\\s\\S]+/]]),[\"regex\"]);var Y=E.PR={createSimpleLexer:G,registerLangHandler:t,sourceDecorator:y,PR_ATTRIB_NAME:\"atn\",PR_ATTRIB_VALUE:\"atv\",PR_COMMENT:\"com\",PR_DECLARATION:\"dec\",PR_KEYWORD:\"kwd\",PR_LITERAL:\"lit\",PR_NOCODE:\"nocode\",PR_PLAIN:\"pln\",PR_PUNCTUATION:\"pun\",PR_SOURCE:\"src\",PR_STRING:\"str\",PR_TAG:\"tag\",PR_TYPE:\"typ\",prettyPrintOne:E.prettyPrintOne=function(a,d,f){f=f||!1;d=d||null;var b=document.createElement(\"div\");b.innerHTML=\"<pre>\"+a+\"</pre>\";\n-b=b.firstChild;f&&L(b,f,!0);M({j:d,m:f,h:b,l:1,a:null,i:null,c:null,g:null});return b.innerHTML},prettyPrint:E.prettyPrint=function(a,d){function f(){for(var b=E.PR_SHOULD_USE_CONTINUATION?c.now()+250:Infinity;p<t.length&&c.now()<b;p++){for(var d=t[p],l=g,m=d;m=m.previousSibling;){var n=m.nodeType,u=(7===n||8===n)&&m.nodeValue;if(u?!/^\\??prettify\\b/.test(u):3!==n||/\\S/.test(m.nodeValue))break;if(u){l={};u.replace(/\\b(\\w+)=([\\w:.%+-]+)/g,function(a,b,c){l[b]=c});break}}m=d.className;if((l!==g||r.test(m))&&\n+regexLiterals:!0}),[\"coffee\"]);t(G([],[[\"str\",/^[\\s\\S]+/]]),[\"regex\"]);var Y=E.PR={createSimpleLexer:G,registerLangHandler:t,sourceDecorator:y,PR_ATTRIB_NAME:\"atn\",PR_ATTRIB_VALUE:\"atv\",PR_COMMENT:\"com\",PR_DECLARATION:\"dec\",PR_KEYWORD:\"kwd\",PR_LITERAL:\"lit\",PR_NOCODE:\"nocode\",PR_PLAIN:\"pln\",PR_PUNCTUATION:\"pun\",PR_SOURCE:\"src\",PR_STRING:\"str\",PR_TAG:\"tag\",PR_TYPE:\"typ\",prettyPrintOne:E.prettyPrintOne=function(a,d,f){f=f||!1;d=d||null;var b=document.createElement(\"pre\");b.innerHTML=a;\n+f&&L(b,f,!0);M({j:d,m:f,h:b,l:1,a:null,i:null,c:null,g:null});return b.innerHTML},prettyPrint:E.prettyPrint=function(a,d){function f(){for(var b=E.PR_SHOULD_USE_CONTINUATION?c.now()+250:Infinity;p<t.length&&c.now()<b;p++){for(var d=t[p],l=g,m=d;m=m.previousSibling;){var n=m.nodeType,u=(7===n||8===n)&&m.nodeValue;if(u?!/^\\??prettify\\b/.test(u):3!==n||/\\S/.test(m.nodeValue))break;if(u){l={};u.replace(/\\b(\\w+)=([\\w:.%+-]+)/g,function(a,b,c){l[b]=c});break}}m=d.className;if((l!==g||r.test(m))&&\n !e.test(m)){n=!1;for(u=d.parentNode;u;u=u.parentNode)if(q.test(u.tagName)&&u.className&&r.test(u.className)){n=!0;break}if(!n){d.className+=\" prettyprinted\";n=l.lang;if(!n){var n=m.match(w),C;!n&&(C=V(d))&&z.test(C.tagName)&&(n=C.className.match(w));n&&(n=n[1])}if(y.test(d.tagName))u=1;else var u=d.currentStyle,x=v.defaultView,u=(u=u?u.whiteSpace:x&&x.getComputedStyle?x.getComputedStyle(d,null).getPropertyValue(\"white-space\"):0)&&\"pre\"===u.substring(0,3);x=l.linenums;(x=\"true\"===x||+x)||(x=(x=m.match(/\\blinenums\\b(?::(\\d+))?/))?\n x[1]&&x[1].length?+x[1]:!0:!1);x&&L(d,x,u);M({j:n,h:d,m:x,l:u,a:null,i:null,c:null,g:null})}}}p<t.length?E.setTimeout(f,250):\"function\"===typeof a&&a()}for(var b=d||document.body,v=b.ownerDocument||document,b=[b.getElementsByTagName(\"pre\"),b.getElementsByTagName(\"code\"),b.getElementsByTagName(\"xmp\")],t=[],n=0;n<b.length;++n)for(var l=0,m=b[n].length;l<m;++l)t.push(b[n][l]);var b=null,c=Date;c.now||(c={now:function(){return+new Date}});var p=0,w=/\\blang(?:uage)?-([\\w.]+)(?!\\S)/,r=/\\bprettyprint\\b/,\n e=/\\bprettyprinted\\b/,y=/pre|xmp/i,z=/^code$/i,q=/^(?:pre|code|xmp)$/i,g={};f()}},H=E.define;\"function\"===typeof H&&H.amd&&H(\"google-code-prettify\",[],function(){return Y})})();}()"
        },
        {
            "sha": "d274479ab5b93cb1df84e44059bcd26c6ff5c828",
            "filename": "aio/src/testing/pretty-printer.service.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Ftesting%2Fpretty-printer.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/e3f5b4170625fd60741598dbec8619aac1913e28/aio%2Fsrc%2Ftesting%2Fpretty-printer.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Ftesting%2Fpretty-printer.service.ts?ref=e3f5b4170625fd60741598dbec8619aac1913e28",
            "patch": "@@ -4,10 +4,15 @@\n // scope.\n \n import { of } from 'rxjs';\n+import { unwrapHtmlForSink } from 'safevalues';\n+import { htmlFromStringKnownToSatisfyTypeContract } from 'safevalues/unsafe/reviewed';\n \n export class MockPrettyPrinter {\n-  formatCode(code: string, language?: string, linenums?: number | boolean) {\n+  formatCode(code: TrustedHTML, language?: string, linenums?: number | boolean) {\n     const linenumsStr = (linenums === undefined) ? '' : `, linenums: ${linenums}`;\n-    return of(`Formatted code (language: ${language || 'auto'}${linenumsStr}): ${code}`);\n+    return of(htmlFromStringKnownToSatisfyTypeContract(\n+        `Formatted code (language: ${language || 'auto'}${linenumsStr}): ${\n+            unwrapHtmlForSink(code)}`,\n+        'safe transformation of existing TrustedHTML'));\n   }\n }"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 62,
        "deletions": 41
    }
}