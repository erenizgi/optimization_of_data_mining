{
    "author": "gkalpak",
    "message": "test(docs-infra): simplify `EventsComponent` tests and add more test cases (#36517)\n\nThis commit simplifies the tests of `EventsComponent` (by introducing a\n`createMockEvent()` helper and getting rid of the irrelevant `Event`\nfields) and adds tests for some more usecases. It also makes the tests\nmore robust by using Jasmine's `Clock` to mock the current date.\n\nPR Close #36517",
    "sha": "41bc2701c43a94fdf658dce9641304a18fc3f0f8",
    "files": [
        {
            "sha": "78a1247afe43e62af1f8900cc3686c3721aa5f9e",
            "filename": "aio/src/app/custom-elements/events/events.component.spec.ts",
            "status": "modified",
            "additions": 181,
            "deletions": 247,
            "changes": 428,
            "blob_url": "https://github.com/angular/angular/blob/41bc2701c43a94fdf658dce9641304a18fc3f0f8/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/41bc2701c43a94fdf658dce9641304a18fc3f0f8/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.spec.ts?ref=41bc2701c43a94fdf658dce9641304a18fc3f0f8",
            "patch": "@@ -1,22 +1,20 @@\n-import { EventsComponent } from './events.component';\n+import { Duration, Event, EventsComponent } from './events.component';\n import { EventsService } from './events.service';\n-import { Event } from './events.component';\n import { ReflectiveInjector } from '@angular/core';\n import { Subject } from 'rxjs';\n \n describe('EventsComponent', () => {\n   let component: EventsComponent;\n   let injector: ReflectiveInjector;\n-  let eventsService: TestEventService;\n+  let eventsService: TestEventsService;\n \n   beforeEach(() => {\n     injector = ReflectiveInjector.resolveAndCreate([\n       EventsComponent,\n-      {provide: EventsService, useClass: TestEventService },\n+      { provide: EventsService, useClass: TestEventsService },\n     ]);\n     eventsService = injector.get(EventsService) as any;\n     component = injector.get(EventsComponent);\n-    component.ngOnInit();\n   });\n \n   it('should have no pastEvents when first created', () => {\n@@ -27,269 +25,205 @@ describe('EventsComponent', () => {\n     expect(component.upcomingEvents).toBeUndefined();\n   });\n \n-  describe('ngOnInit', () => {\n-    it('should have 2 upcoming events', () => {\n-      eventsService.events.next([{\n-        'location': 'Oslo, Norway',\n-        'tooltip': 'ngVikings',\n-        'linkUrl': 'https://ngvikings.org/',\n-        'name': 'ngVikings',\n-        'date': {\n-          'start': '2099-07-25',\n-          'end': '2099-07-26'\n-        },\n-        'workshopsDate': {\n-          'start': '2099-07-27',\n-          'end': '2099-07-27'\n-        }\n-      },\n-      {\n-        'location': 'Salt Lake City, Utah',\n-        'tooltip': 'ng-conf',\n-        'linkUrl': 'https://ng-conf.org/',\n-        'name': 'ng-conf  ',\n-        'date': {\n-          'start': '2099-06-20',\n-          'end': '2099-06-20'\n-        }\n-      },\n-      {\n-        'location': 'Delhi, India',\n-        'tooltip': 'ngIndia',\n-        'linkUrl': 'https://www.ng-ind.com/',\n-        'name': 'ngIndia',\n-        'date': {\n-          'start': '2020-02-29',\n-          'end': '2020-02-29'\n-        }\n-      }]);\n-      expect(component.upcomingEvents.length).toEqual(2);\n+  describe('ngOnInit()', () => {\n+    beforeEach(() => {\n+      jasmine.clock().install();\n+      jasmine.clock().mockDate(new Date(2020, 5, 15, 23, 59, 59));\n+      component.ngOnInit();\n     });\n \n-    it('should have 4 past events', () => {\n+    afterEach(() => jasmine.clock().uninstall());\n+\n+    it('should separate past and upcoming events', () => {\n       eventsService.events.next([\n-      {\n-        'location': 'Salt Lake City, Utah',\n-        'tooltip': 'ng-conf',\n-        'linkUrl': 'https://ng-conf.org/',\n-        'name': 'ng-conf  ',\n-        'date': {\n-          'start': '2099-06-20',\n-          'end': '2099-06-20'\n-        }\n-      },\n-      {\n-        'location': 'Rome, Italy',\n-        'tooltip': 'NG Rome MMXIX - The Italian Angular Conference',\n-        'linkUrl': 'https://ngrome.io',\n-        'name': 'NG Rome MMXIX',\n-        'date': {\n-          'start': '2019-10-07',\n-          'end': '2019-10-07'\n-        },\n-        'workshopsDate': {\n-          'start': '2019-10-06',\n-          'end': '2019-10-06'\n-        }\n-      },\n-      {\n-        'location': 'London, UK',\n-        'tooltip': 'AngularConnect',\n-        'linkUrl': 'https://www.angularconnect.com/?utm_source=angular.io&utm_medium=referral',\n-        'name': 'AngularConnect',\n-        'date': {\n-          'start': '2019-09-19',\n-          'end': '2019-09-20'\n-        }\n-      },\n-      {\n-        'location': 'Berlin, Germany',\n-        'tooltip': 'NG-DE',\n-        'linkUrl': 'https://ng-de.org/',\n-        'name': 'NG-DE',\n-        'date': {\n-          'start': '2019-08-30',\n-          'end': '2019-08-31'\n-        },\n-        'workshopsDate': {\n-          'start': '2019-08-29',\n-          'end': '2019-08-29'\n-        }\n-      },\n-      {\n-        'location': 'Oslo, Norway',\n-        'tooltip': 'ngVikings',\n-        'linkUrl': 'https://ngvikings.org/',\n-        'name': 'ngVikings',\n-        'date': {\n-          'start': '2018-07-26',\n-          'end': '2018-07-26'\n-        },\n-        'workshopsDate': {\n-          'start': '2018-07-27',\n-          'end': '2018-07-27'\n-        }\n-      }]);\n-      expect(component.pastEvents.length).toEqual(4);\n+        createMockEvent(\n+            'Upcoming event 1',\n+            {start: '2020-06-16', end: '2020-06-17'},\n+            {start: '2020-06-18', end: '2020-06-18'}),\n+        createMockEvent(\n+            'Upcoming event 3',\n+            {start: '2222-01-01', end: '2222-01-02'}),\n+        createMockEvent(\n+            'Past event 2',\n+            {start: '2020-06-13', end: '2020-06-14'}),\n+        createMockEvent(\n+            'Upcoming event 2',\n+            {start: '2020-06-17', end: '2020-06-18'},\n+            {start: '2020-06-16', end: '2020-06-16'}),\n+        createMockEvent(\n+            'Past event 1',\n+            {start: '2020-05-30', end: '2020-05-31'}),\n+        createMockEvent(\n+            'Past event 3',\n+            {start: '2020-06-14', end: '2020-06-14'},\n+            {start: '2020-06-16', end: '2020-06-17'}),\n+      ]);\n+\n+      expect(component.pastEvents.map(evt => evt.name)).toEqual(jasmine.arrayWithExactContents(\n+          ['Past event 1', 'Past event 2', 'Past event 3']));\n+\n+      expect(component.upcomingEvents.map(evt => evt.name)).toEqual(jasmine.arrayWithExactContents(\n+          ['Upcoming event 1', 'Upcoming event 2', 'Upcoming event 3']));\n     });\n-  });\n \n-  describe('Getting event dates if no workshop date', () => {\n-    it('should return only conference date', () => {\n-      const datestring = component.getEventDates({\n-            'location': 'Salt Lake City, Utah',\n-            'tooltip': 'ng-conf',\n-            'linkUrl': 'https://ng-conf.org/',\n-            'name': 'ng-conf  ',\n-            'date': {\n-              'start': '2020-06-20',\n-              'end': '2020-06-20'\n-            }\n-          });\n-      expect(datestring).toEqual('June 20, 2020');\n+    it('should order past events in reverse chronological order (ignoring workshops dates)', () => {\n+      eventsService.events.next([\n+        createMockEvent(\n+            'Past event 2',\n+            {start: '1999-12-13', end: '1999-12-14'},\n+            {start: '1999-12-11', end: '1999-12-11'}),\n+        createMockEvent(\n+            'Past event 4',\n+            {start: '2020-01-16', end: '2020-01-17'},\n+            {start: '2020-01-14', end: '2020-01-15'}),\n+        createMockEvent(\n+            'Past event 3',\n+            {start: '2020-01-15', end: '2020-01-16'},\n+            {start: '2020-01-17', end: '2020-01-18'}),\n+        createMockEvent(\n+            'Past event 1',\n+            {start: '1999-12-12', end: '1999-12-15'}),\n+      ]);\n+\n+      expect(component.pastEvents.map(evt => evt.name)).toEqual(\n+          ['Past event 4', 'Past event 3', 'Past event 2', 'Past event 1']);\n     });\n \n-    it('should return only conference date with changing months if date is in two diffrent months', () => {\n-      const datestring = component.getEventDates({\n-        'location': 'Prague, Czech Republic',\n-        'tooltip': 'ReactiveConf',\n-        'linkUrl': 'https://reactiveconf.com/',\n-        'name': 'ReactiveConf',\n-        'date': {\n-          'start': '2019-10-30',\n-          'end': '2019-11-01'\n-        }\n-      });\n-      expect(datestring).toEqual('October 30 - November 1, 2019');\n+    it('should order upcoming events in chronological order (ignoring workshops dates)', () => {\n+      eventsService.events.next([\n+        createMockEvent(\n+            'Upcoming event 2',\n+            {start: '2020-12-13', end: '2020-12-14'},\n+            {start: '2020-12-11', end: '2020-12-11'}),\n+        createMockEvent(\n+            'Upcoming event 4',\n+            {start: '2021-01-16', end: '2021-01-17'},\n+            {start: '2021-01-14', end: '2021-01-15'}),\n+        createMockEvent(\n+            'Upcoming event 3',\n+            {start: '2021-01-15', end: '2021-01-16'},\n+            {start: '2021-01-17', end: '2021-01-18'}),\n+        createMockEvent(\n+            'Upcoming event 1',\n+            {start: '2020-12-12', end: '2020-12-15'}),\n+      ]);\n+\n+      expect(component.upcomingEvents.map(evt => evt.name)).toEqual(\n+          ['Upcoming event 1', 'Upcoming event 2', 'Upcoming event 3', 'Upcoming event 4']);\n     });\n \n-    it('should return only conference date with \"- lastdate\" if conference over multiple days', () => {\n-      const datestring = component.getEventDates({\n-        'location': 'London, UK',\n-        'tooltip': 'AngularConnect',\n-        'linkUrl': 'https://www.angularconnect.com/?utm_source=angular.io&utm_medium=referral',\n-        'name': 'AngularConnect',\n-        'date': {\n-          'start': '2019-09-19',\n-          'end': '2019-09-20'\n-        }\n-      });\n-      expect(datestring).toEqual('September 19-20, 2019');\n+    it('should treat ongoing events as upcoming', () => {\n+      eventsService.events.next([\n+        createMockEvent(\n+            'Ongoing event 1',\n+            {start: '2020-06-14', end: '2020-06-16'}),\n+        createMockEvent(\n+            'Ongoing event 2',\n+            {start: '2020-06-14', end: '2020-06-15'},\n+            {start: '2020-06-13', end: '2020-06-13'}),\n+      ]);\n+\n+      expect(component.pastEvents).toEqual([]);\n+      expect(component.upcomingEvents.map(evt => evt.name)).toEqual(jasmine.arrayWithExactContents(\n+          ['Ongoing event 1', 'Ongoing event 2']));\n     });\n   });\n \n-  describe('Getting event dates if workshop date', () => {\n-    it('should return conference date with different days, workshopdate', () => {\n-      const datestring = component.getEventDates({\n-            'location': 'Oslo, Norway',\n-            'tooltip': 'ngVikings',\n-            'linkUrl': 'https://ngvikings.org/',\n-            'name': 'ngVikings',\n-            'date': {\n-              'start': '2020-07-25',\n-              'end': '2020-07-26'\n-            },\n-            'workshopsDate': {\n-              'start': '2020-07-27',\n-              'end': '2020-07-27'\n-            }\n-          });\n-      expect(datestring).toEqual('July 25-26 (conference), July 27 (workshops), 2020');\n-    });\n+  describe('getEventDates()', () => {\n+    describe('(without workshops)', () => {\n+      it('should correctly format the main event date', () => {\n+        const testEvent = createMockEvent('Test', {start: '2020-06-20', end: '2020-06-20'});\n+        expect(component.getEventDates(testEvent)).toBe('June 20, 2020');\n+      });\n \n-    it('should return workshop date, conference date if workshop before conf date', () => {\n-      const datestring = component.getEventDates({\n-        'location': 'Rome, Italy',\n-        'tooltip': 'NG Rome MMXIX - The Italian Angular Conference',\n-        'linkUrl': 'https://ngrome.io',\n-        'name': 'NG Rome MMXIX',\n-        'date': {\n-          'start': '2019-10-07',\n-          'end': '2019-10-07'\n-        },\n-        'workshopsDate': {\n-          'start': '2019-10-06',\n-          'end': '2019-10-06'\n-        }\n+      it('should correctly format the main event date spanning mupliple days', () => {\n+        const testEvent = createMockEvent('Test', {start: '2019-09-19', end: '2019-09-21'});\n+        expect(component.getEventDates(testEvent)).toBe('September 19-21, 2019');\n       });\n-      expect(datestring).toEqual('October 6 (workshops), October 7 (conference), 2019');\n-    });\n \n-    it('should return workshop date, conference date if workshop before conference date', () => {\n-      const datestring = component.getEventDates({\n-        'location': 'Berlin, Germany',\n-        'tooltip': 'NG-DE',\n-        'linkUrl': 'https://ng-de.org/',\n-        'name': 'NG-DE',\n-        'date': {\n-          'start': '2019-08-30',\n-          'end': '2019-08-31'\n-        },\n-        'workshopsDate': {\n-          'start': '2019-08-29',\n-          'end': '2019-08-29'\n-        }\n+      it('should correctly format the main event date spanning mupliple months', () => {\n+        const testEvent = createMockEvent('Test', {start: '2019-10-30', end: '2019-11-01'});\n+        expect(component.getEventDates(testEvent)).toBe('October 30 - November 1, 2019');\n       });\n-      expect(datestring).toEqual('August 29 (workshops), August 30-31 (conference), 2019');\n     });\n \n-    it('should return only conference date, wokshop date if workshop after conference', () => {\n-      const datestring = component.getEventDates({\n-        'location': 'Oslo, Norway',\n-        'tooltip': 'ngVikings',\n-        'linkUrl': 'https://ngvikings.org/',\n-        'name': 'ngVikings',\n-        'date': {\n-          'start': '2018-07-26',\n-          'end': '2018-07-26'\n-        },\n-        'workshopsDate': {\n-          'start': '2018-07-27',\n-          'end': '2018-07-27'\n-        }\n+    describe('(with workshops)', () => {\n+      it('should correctly format event dates with workshops after main event', () => {\n+        const testEvent = createMockEvent(\n+            'Test',\n+            {start: '2020-07-25', end: '2020-07-26'},\n+            {start: '2020-07-27', end: '2020-07-27'});\n+\n+        expect(component.getEventDates(testEvent))\n+            .toBe('July 25-26 (conference), July 27 (workshops), 2020');\n       });\n-      expect(datestring).toEqual('July 26 (conference), July 27 (workshops), 2018');\n-    });\n \n-    it('should return conference date and workshop date with different days and months, starting with confrence date', () => {\n-      const datestring = component.getEventDates({\n-            'location': 'Oslo, Norway',\n-            'tooltip': 'ngVikings',\n-            'linkUrl': 'https://ngvikings.org/',\n-            'name': 'ngVikings',\n-            'date': {\n-              'start': '2020-07-30',\n-              'end': '2020-07-31'\n-            },\n-            'workshopsDate': {\n-              'start': '2020-08-01',\n-              'end': '2020-08-02'\n-            }\n-          });\n-      expect(datestring).toEqual('July 30-31 (conference), August 1-2 (workshops), 2020');\n-    });\n+      it('should correctly format event dates with workshops before main event', () => {\n+        const testEvent = createMockEvent(\n+            'Test',\n+            {start: '2019-10-07', end: '2019-10-07'},\n+            {start: '2019-10-06', end: '2019-10-06'});\n \n-    it('should return conference date and workshop date with different days and months, starting with workshopdate', () => {\n-      const datestring = component.getEventDates({\n-            'location': 'Oslo, Norway',\n-            'tooltip': 'ngVikings',\n-            'linkUrl': 'https://ngvikings.org/',\n-            'name': 'ngVikings',\n-            'date': {\n-              'start': '2020-08-01',\n-              'end': '2020-08-02'\n-            },\n-            'workshopsDate': {\n-              'start': '2020-07-30',\n-              'end': '2020-07-31'\n-            }\n-          });\n-      expect(datestring).toEqual('July 30-31 (workshops), August 1-2 (conference), 2020');\n-    });\n+        expect(component.getEventDates(testEvent))\n+            .toBe('October 6 (workshops), October 7 (conference), 2019');\n+      });\n+\n+      it('should correctly format event dates spanning multiple days', () => {\n+        const testEvent = createMockEvent(\n+            'Test',\n+            {start: '2019-08-30', end: '2019-08-31'},\n+            {start: '2019-08-28', end: '2019-08-29'});\n \n+        expect(component.getEventDates(testEvent))\n+            .toBe('August 28-29 (workshops), August 30-31 (conference), 2019');\n+      });\n+\n+      it('should correctly format event dates with workshops on different month before the main event',\n+        () => {\n+          const testEvent = createMockEvent(\n+              'Test',\n+              {start: '2020-08-01', end: '2020-08-02'},\n+              {start: '2020-07-30', end: '2020-07-31'});\n+\n+          expect(component.getEventDates(testEvent))\n+              .toBe('July 30-31 (workshops), August 1-2 (conference), 2020');\n+        });\n+\n+      it('should correctly format event dates with workshops on different month after the main event',\n+        () => {\n+          const testEvent = createMockEvent(\n+              'Test',\n+              {start: '2020-07-30', end: '2020-07-31'},\n+              {start: '2020-08-01', end: '2020-08-02'});\n+\n+          expect(component.getEventDates(testEvent))\n+              .toBe('July 30-31 (conference), August 1-2 (workshops), 2020');\n+        });\n+\n+      it('should correctly format event dates spanning multiple months', () => {\n+        const testEvent = createMockEvent(\n+            'Test',\n+            {start: '2020-07-31', end: '2020-08-01'},\n+            {start: '2020-07-30', end: '2020-08-01'});\n+\n+        expect(component.getEventDates(testEvent))\n+            .toBe('July 30 - August 1 (workshops), July 31 - August 1 (conference), 2020');\n+      });\n+    });\n   });\n-});\n \n-class TestEventService {\n-  events = new Subject<Event[]>();\n-}\n+  // Helpers\n+  class TestEventsService {\n+    events = new Subject<Event[]>();\n+  }\n+\n+  function createMockEvent(name: string, date: Duration, workshopsDate?: Duration): Event {\n+    return {\n+      name,\n+      location: '',\n+      linkUrl: '',\n+      date,\n+      workshopsDate,\n+    };\n+  }\n+});"
        },
        {
            "sha": "9c9555054e931f561350b850bbee73dbf951dbe7",
            "filename": "aio/src/app/custom-elements/events/events.component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/41bc2701c43a94fdf658dce9641304a18fc3f0f8/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/41bc2701c43a94fdf658dce9641304a18fc3f0f8/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fevents%2Fevents.component.ts?ref=41bc2701c43a94fdf658dce9641304a18fc3f0f8",
            "patch": "@@ -18,8 +18,8 @@ const MONTHS = [\n   'December',\n ];\n \n-type date = string; // of the format `YYYY-MM-DD`.\n-interface Duration {\n+export type date = string; // of the format `YYYY-MM-DD`.\n+export interface Duration {\n   start: date;\n   end: date;\n }"
        }
    ],
    "stats": {
        "total": 432,
        "additions": 183,
        "deletions": 249
    }
}