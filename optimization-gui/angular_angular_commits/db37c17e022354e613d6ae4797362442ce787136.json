{
    "author": "AndrewKushnir",
    "message": "refactor(core): remove NG_PROV_DEF_FALLBACK needed for IE10 only (#39090)\n\nThis commit removes a workaround previously used for IE 9 and 10 to identify whether InjectableDef\nwas defined on a given class instance. Since support for IE 9 and 10 is removed, this fallback is\nno longer needed.\n\nPR Close #39090",
    "sha": "db37c17e022354e613d6ae4797362442ce787136",
    "files": [
        {
            "sha": "c532b72f987e2fd64ad51cd1e6cdc122926230aa",
            "filename": "packages/core/src/di/interface/defs.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 24,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Fdefs.ts",
            "raw_url": "https://github.com/angular/angular/raw/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Fdefs.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Fdefs.ts?ref=db37c17e022354e613d6ae4797362442ce787136",
            "patch": "@@ -195,23 +195,15 @@ export function ɵɵdefineInjector(options: {factory: () => any, providers?: any\n  * @param type A type which may have its own (non-inherited) `ɵprov`.\n  */\n export function getInjectableDef<T>(type: any): ɵɵInjectableDef<T>|null {\n-  return getOwnDefinition(type, type[NG_PROV_DEF]) ||\n-      getOwnDefinition(type, type[NG_INJECTABLE_DEF]);\n+  return getOwnDefinition(type, NG_PROV_DEF) || getOwnDefinition(type, NG_INJECTABLE_DEF);\n }\n \n /**\n- * Return `def` only if it is defined directly on `type` and is not inherited from a base\n+ * Return definition only if it is defined directly on `type` and is not inherited from a base\n  * class of `type`.\n- *\n- * The function `Object.hasOwnProperty` is not sufficient to distinguish this case because in older\n- * browsers (e.g. IE10) static property inheritance is implemented by copying the properties.\n- *\n- * Instead, the definition's `token` is compared to the `type`, and if they don't match then the\n- * property was not defined directly on the type itself, and was likely inherited. The definition\n- * is only returned if the `type` matches the `def.token`.\n  */\n-function getOwnDefinition<T>(type: any, def: ɵɵInjectableDef<T>): ɵɵInjectableDef<T>|null {\n-  return def && def.token === type ? def : null;\n+function getOwnDefinition<T>(type: any, field: string): ɵɵInjectableDef<T>|null {\n+  return type.hasOwnProperty(field) ? type[field] : null;\n }\n \n /**\n@@ -223,10 +215,7 @@ function getOwnDefinition<T>(type: any, def: ɵɵInjectableDef<T>): ɵɵInjectab\n  *     scenario if we find the `ɵprov` on an ancestor only.\n  */\n export function getInheritedInjectableDef<T>(type: any): ɵɵInjectableDef<T>|null {\n-  // See `jit/injectable.ts#compileInjectable` for context on NG_PROV_DEF_FALLBACK.\n-  const def = type &&\n-      (type[NG_PROV_DEF] || type[NG_INJECTABLE_DEF] ||\n-       (type[NG_PROV_DEF_FALLBACK] && type[NG_PROV_DEF_FALLBACK]()));\n+  const def = type && (type[NG_PROV_DEF] || type[NG_INJECTABLE_DEF]);\n \n   if (def) {\n     const typeName = getTypeName(type);\n@@ -273,14 +262,6 @@ export function getInjectorDef<T>(type: any): ɵɵInjectorDef<T>|null {\n export const NG_PROV_DEF = getClosureSafeProperty({ɵprov: getClosureSafeProperty});\n export const NG_INJ_DEF = getClosureSafeProperty({ɵinj: getClosureSafeProperty});\n \n-// On IE10 properties defined via `defineProperty` won't be inherited by child classes,\n-// which will break inheriting the injectable definition from a grandparent through an\n-// undecorated parent class. We work around it by defining a fallback method which will be\n-// used to retrieve the definition. This should only be a problem in JIT mode, because in\n-// AOT TypeScript seems to have a workaround for static properties. When inheriting from an\n-// undecorated parent is no longer supported in v10, this can safely be removed.\n-export const NG_PROV_DEF_FALLBACK = getClosureSafeProperty({ɵprovFallback: getClosureSafeProperty});\n-\n // We need to keep these around so we can read off old defs if new defs are unavailable\n export const NG_INJECTABLE_DEF = getClosureSafeProperty({ngInjectableDef: getClosureSafeProperty});\n export const NG_INJECTOR_DEF = getClosureSafeProperty({ngInjectorDef: getClosureSafeProperty});"
        },
        {
            "sha": "702560897cbbf6034efa14fbb75257725f026edb",
            "filename": "packages/core/src/di/jit/injectable.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 11,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts?ref=db37c17e022354e613d6ae4797362442ce787136",
            "patch": "@@ -12,7 +12,7 @@ import {NG_FACTORY_DEF} from '../../render3/fields';\n import {getClosureSafeProperty} from '../../util/property';\n import {resolveForwardRef} from '../forward_ref';\n import {Injectable} from '../injectable';\n-import {NG_PROV_DEF, NG_PROV_DEF_FALLBACK} from '../interface/defs';\n+import {NG_PROV_DEF} from '../interface/defs';\n import {ClassSansProvider, ExistingSansProvider, FactorySansProvider, ValueProvider, ValueSansProvider} from '../interface/provider';\n \n import {angularCoreDiEnv} from './environment';\n@@ -40,16 +40,6 @@ export function compileInjectable(type: Type<any>, srcMeta?: Injectable): void {\n         return ngInjectableDef;\n       },\n     });\n-\n-    // On IE10 properties defined via `defineProperty` won't be inherited by child classes,\n-    // which will break inheriting the injectable definition from a grandparent through an\n-    // undecorated parent class. We work around it by defining a method which should be used\n-    // as a fallback. This should only be a problem in JIT mode, because in AOT TypeScript\n-    // seems to have a workaround for static properties. When inheriting from an undecorated\n-    // parent is no longer supported (v11 or later), this can safely be removed.\n-    if (!type.hasOwnProperty(NG_PROV_DEF_FALLBACK)) {\n-      (type as any)[NG_PROV_DEF_FALLBACK] = () => (type as any)[NG_PROV_DEF];\n-    }\n   }\n \n   // if NG_FACTORY_DEF is already defined on this class then don't overwrite it"
        },
        {
            "sha": "0bf195a2abb692ca3590e59b802c5f2bed370d84",
            "filename": "packages/core/test/bundling/forms/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms%2Fbundle.golden_symbols.json?ref=db37c17e022354e613d6ae4797362442ce787136",
            "patch": "@@ -356,9 +356,6 @@\n   {\n     \"name\": \"NG_PROV_DEF\"\n   },\n-  {\n-    \"name\": \"NG_PROV_DEF_FALLBACK\"\n-  },\n   {\n     \"name\": \"NG_VALIDATORS\"\n   },"
        },
        {
            "sha": "eee96403a7218c6ae3932f9e51737bb1835c404a",
            "filename": "packages/core/test/bundling/injection/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Finjection%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Finjection%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Finjection%2Fbundle.golden_symbols.json?ref=db37c17e022354e613d6ae4797362442ce787136",
            "patch": "@@ -38,9 +38,6 @@\n   {\n     \"name\": \"NG_PROV_DEF\"\n   },\n-  {\n-    \"name\": \"NG_PROV_DEF_FALLBACK\"\n-  },\n   {\n     \"name\": \"NOT_YET\"\n   },"
        },
        {
            "sha": "a05336e440f035be89eb43ddfc2623adabe485ca",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/db37c17e022354e613d6ae4797362442ce787136/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=db37c17e022354e613d6ae4797362442ce787136",
            "patch": "@@ -431,9 +431,6 @@\n   {\n     \"name\": \"NG_PROV_DEF\"\n   },\n-  {\n-    \"name\": \"NG_PROV_DEF_FALLBACK\"\n-  },\n   {\n     \"name\": \"NONE\"\n   },"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 6,
        "deletions": 44
    }
}