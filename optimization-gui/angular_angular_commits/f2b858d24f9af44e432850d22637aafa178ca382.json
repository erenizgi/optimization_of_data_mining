{
    "author": "dario-piotrowicz",
    "message": "refactor(animations): add unit test for leaving animated child (#44489)\n\nadd a new unit test to make sure that leaving elements queried via\na parent queried via animateChild are correctly removed\n\nnote: this tests the fix introduced in PR #44357\n\nPR Close #44489",
    "sha": "f2b858d24f9af44e432850d22637aafa178ca382",
    "files": [
        {
            "sha": "96c90f14776371820d9d29fb51da232905ea308d",
            "filename": "packages/core/test/animation/animation_query_integration_spec.ts",
            "status": "modified",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/f2b858d24f9af44e432850d22637aafa178ca382/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_query_integration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f2b858d24f9af44e432850d22637aafa178ca382/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_query_integration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_query_integration_spec.ts?ref=f2b858d24f9af44e432850d22637aafa178ca382",
            "patch": "@@ -3348,6 +3348,51 @@ describe('animation query tests', function() {\n       expect(pp.element.classList.contains('container')).toBeTruthy();\n       expect(pcp.element.classList.contains('item')).toBeTruthy();\n     });\n+\n+    it('should correctly remove a leaving element queried/animated by a parent queried via animateChild',\n+       fakeAsync(() => {\n+         @Component({\n+           selector: 'cmp',\n+           template: `\n+            <div class=\"grand-parent\" [@grandParentAnimation]=\"childPresent\">\n+              <div class=\"parent\" [@parentAnimation]=\"childPresent\">\n+              <div *ngIf=\"childPresent\" class=\"child\"></div>\n+              </div>\n+            </div>\n+          `,\n+           animations: [\n+             trigger(\n+                 'grandParentAnimation',\n+                 [transition('true <=> false', query('@parentAnimation', animateChild()))]),\n+             trigger(\n+                 'parentAnimation',\n+                 [transition(\n+                     'true => false', query(':leave.child', animate('.2s', style({opacity: 0}))))])\n+           ]\n+         })\n+         class Cmp {\n+           public childPresent = true;\n+         }\n+\n+         TestBed.configureTestingModule({declarations: [Cmp]});\n+\n+         const engine = TestBed.inject(ÉµAnimationEngine);\n+         const fixture = TestBed.createComponent(Cmp);\n+         const cmp = fixture.componentInstance;\n+         fixture.detectChanges();\n+\n+         let children = fixture.debugElement.nativeElement.querySelectorAll('.child');\n+         expect(children.length).toEqual(1);\n+\n+         cmp.childPresent = false;\n+         fixture.detectChanges();\n+         flushMicrotasks();\n+\n+         engine.players.forEach(player => player.finish());\n+\n+         children = fixture.debugElement.nativeElement.querySelectorAll('.child');\n+         expect(children.length).toEqual(0);\n+       }));\n   });\n \n   describe('animation control flags', () => {"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 45,
        "deletions": 0
    }
}