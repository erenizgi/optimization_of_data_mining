{
    "author": "gkalpak",
    "message": "build(docs-infra): take disambiguated doc paths into account when generating the sitemap (#41842)\n\nIn ##41788, the `disambiguateDocsPathsProcessor` was introduced to fix\nan issue with case-insensitively equal paths. This processor may alter\nthe paths of some docs and thus their final URL in the app.\n\nPreviously, both the `disambiguateDocPathsProcessor` and the\n`createSitemap` processor (which relies on the docs' computed paths to\ngenerate the sitemap file) were configured to run before the\n\"rendering-docs\" phase. However, this resulted in the\n`disambiguateDocPathsProcessor`'s running after `createSitemap`, which\nmeant that the sitemap did not include the updated doc paths.\n\nThis commit fixes it by ensuring that the\n`disambiguateDocPathsProcessor` is explicitly run before the\n`createSitemap` processor, so that the latter will be able to take into\naccount any changes made by the former.\n\nPR Close #41842",
    "sha": "2076bde100394b778771bcbece3db1313653c6a1",
    "files": [
        {
            "sha": "0a070a26bee702725c562298ddedb4e1d923b9af",
            "filename": "aio/tools/transforms/angular-base-package/processors/disambiguateDocPaths.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2076bde100394b778771bcbece3db1313653c6a1/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.js",
            "raw_url": "https://github.com/angular/angular/raw/2076bde100394b778771bcbece3db1313653c6a1/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.js?ref=2076bde100394b778771bcbece3db1313653c6a1",
            "patch": "@@ -18,7 +18,7 @@\n module.exports = function disambiguateDocPathsProcessor(log) {\n   return {\n     $runAfter: ['paths-computed'],\n-    $runBefore: ['rendering-docs'],\n+    $runBefore: ['rendering-docs', 'createSitemap'],\n     $process(docs) {\n       // Collect all the ambiguous docs, whose outputPath is are only different by casing.\n       const ambiguousDocMap = new Map();"
        },
        {
            "sha": "22eae728c14d6f1988b628133f3780525ca8ccbd",
            "filename": "aio/tools/transforms/angular-base-package/processors/disambiguateDocPaths.spec.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2076bde100394b778771bcbece3db1313653c6a1/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/2076bde100394b778771bcbece3db1313653c6a1/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fprocessors%2FdisambiguateDocPaths.spec.js?ref=2076bde100394b778771bcbece3db1313653c6a1",
            "patch": "@@ -22,6 +22,10 @@ describe('disambiguateDocPaths processor', () => {\n     expect(processor).toBeDefined();\n   });\n \n+  it('should be run before creating the sitemap', () => {\n+    expect(processor.$runBefore).toContain('createSitemap');\n+  });\n+\n   it('should create `disambiguator` documents for docs that have ambiguous outputPaths', () => {\n     const numDocs = docs.length;\n     processor.$process(docs);"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 5,
        "deletions": 1
    }
}