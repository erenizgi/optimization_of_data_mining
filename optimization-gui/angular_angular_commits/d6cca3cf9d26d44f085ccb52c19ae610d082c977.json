{
    "author": "alxhub",
    "message": "Revert \"build: generate alias locale data for closure locale (#42230)\" (#42583)\n\nThis reverts commit 044e0229bde8edb86e0d9e318bc358299ea6f814.\n\nPR Close #42583",
    "sha": "d6cca3cf9d26d44f085ccb52c19ae610d082c977",
    "files": [
        {
            "sha": "96d857c833da26e82f7514da455cc397d0653c03",
            "filename": "packages/common/locales/closure-locale.ts",
            "status": "modified",
            "additions": 1090,
            "deletions": 4886,
            "changes": 5976,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fclosure-locale.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fclosure-locale.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fclosure-locale.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977"
        },
        {
            "sha": "ea11843301a37370d4d3b46744f4fd27f0dbf43a",
            "filename": "packages/common/locales/generate-locales-tool/cldr-data.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fcldr-data.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fcldr-data.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fcldr-data.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977",
            "patch": "@@ -31,9 +31,6 @@ const CLDR_DATA_GLOBS = [\n /** Path to the CLDR available locales file. */\n const CLDR_AVAILABLE_LOCALES_PATH = 'cldr-core-37.0.0/availableLocales.json';\n \n-/** Path to the CLDR locale aliases file. */\n-const CLDR_LOCALE_ALIASES_PATH = 'cldr-core-37.0.0/supplemental/aliases.json';\n-\n /**\n  * Instance providing access to a locale's CLDR data. This type extends the `cldrjs`\n  * instance type with the missing `bundle` attribute property.\n@@ -48,13 +45,6 @@ export type CldrLocaleData = CldrStatic&{\n   }\n };\n \n-/**\n- * Possible reasons for an alias in the CLDR supplemental data. See:\n- * https://unicode.org/reports/tr35/tr35-info.html#Appendix_Supplemental_Metadata.\n- */\n-export type CldrLocaleAliasReason =\n-    'deprecated'|'overlong'|'macrolanguage'|'legacy'|'bibliographic';\n-\n /**\n  * Class that provides access to the CLDR data downloaded as part of\n  * the `@cldr_data` Bazel repository.\n@@ -87,16 +77,6 @@ export class CldrData {\n     return localeData;\n   }\n \n-  /**\n-   * Gets the CLDR language aliases.\n-   * http://cldr.unicode.org/index/cldr-spec/language-tag-equivalences.\n-   */\n-  getLanguageAliases():\n-      {[localeName: string]: {_reason: CldrLocaleAliasReason, _replacement: string}} {\n-    return require(`${this.cldrDataDir}/${CLDR_LOCALE_ALIASES_PATH}`)\n-        .supplemental.metadata.alias.languageAlias;\n-  }\n-\n   /** Gets a list of all locales CLDR provides data for. */\n   private _getAvailableLocales(): CldrLocaleData[] {\n     const allLocales ="
        },
        {
            "sha": "ee3117a92bea66d9382cfba1b154ca3587444b89",
            "filename": "packages/common/locales/generate-locales-tool/closure-locale-file.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 45,
            "changes": 64,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fclosure-locale-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fclosure-locale-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fclosure-locale-file.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977",
            "patch": "@@ -6,45 +6,35 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {CldrData, CldrLocaleData} from './cldr-data';\n+import {CldrStatic} from 'cldrjs';\n+\n+import {CldrData} from './cldr-data';\n import {fileHeader} from './file-header';\n import {BaseCurrencies} from './locale-base-currencies';\n import {generateLocale} from './locale-file';\n \n-interface ClosureLocale {\n-  /** Locale name to match with a Closure-supported locale. */\n-  closureLocaleName: string;\n-  /** Locale data. Can have a different locale name if this captures an aliased locale. */\n-  data: CldrLocaleData;\n-}\n-\n /**\n  * Generate a file that contains all locale to import for closure.\n  * Tree shaking will only keep the data for the `goog.LOCALE` locale.\n  */\n export function generateClosureLocaleFile(cldrData: CldrData, baseCurrencies: BaseCurrencies) {\n-  const locales: ClosureLocale[] =\n-      [...cldrData.availableLocales.map(data => ({closureLocaleName: data.locale, data}))];\n-  const aliases = cldrData.getLanguageAliases();\n+  const locales = cldrData.availableLocales;\n \n-  // We also generate locale data for aliases known within CLDR. Closure compiler does not\n-  // limit its locale identifiers to CLDR-canonical identifiers/or BCP47 identifiers.\n-  // To ensure deprecated/historical locale identifiers which are supported by Closure\n-  // can work with closure-compiled Angular applications, we respect CLDR locale aliases.\n-  for (const [aliasName, data] of Object.entries(aliases)) {\n-    // We skip bibliographic aliases as those have never been supported by Closure compiler.\n-    if (data._reason === 'bibliographic') {\n-      continue;\n-    }\n-\n-    const localeData = cldrData.getLocaleData(data._replacement);\n-\n-    // If CLDR does not provide data for the replacement locale, we skip this alias.\n-    if (localeData === null) {\n-      continue;\n-    }\n+  function generateLocaleConstant(localeData: CldrStatic): string {\n+    const locale = localeData.locale;\n+    const localeNameFormattedForJs = formatLocale(locale);\n+    return generateLocale(locale, localeData, baseCurrencies)\n+        .replace(`${fileHeader}\\n`, '')\n+        .replace('export default ', `export const locale_${localeNameFormattedForJs} = `)\n+        .replace('function plural', `function plural_${localeNameFormattedForJs}`)\n+        .replace(/,\\s+plural/, `, plural_${localeNameFormattedForJs}`)\n+        .replace(/\\s*const u = undefined;\\s*/, '');\n+  }\n \n-    locales.push({closureLocaleName: aliasName, data: localeData});\n+  function generateCase(localeName: string) {\n+    return `case '${localeName}':\\n` +\n+        `l = locale_${formatLocale(localeName)};\\n` +\n+        `break;\\n`;\n   }\n \n   return `${fileHeader}\n@@ -58,28 +48,12 @@ ${locales.map(locale => `${generateLocaleConstant(locale)}`).join('\\n')}\n let l: any;\n \n switch (goog.LOCALE) {\n-${locales.map(locale => generateCase(locale)).join('')}}\n+${locales.map(localeData => generateCase(localeData.locale)).join('')}}\n \n if (l) {\n   registerLocaleData(l);\n }\n `;\n-\n-  function generateLocaleConstant(locale: ClosureLocale): string {\n-    const localeNameFormattedForJs = formatLocale(locale.closureLocaleName);\n-    return generateLocale(locale.closureLocaleName, locale.data, baseCurrencies)\n-        .replace(`${fileHeader}\\n`, '')\n-        .replace('export default ', `export const locale_${localeNameFormattedForJs} = `)\n-        .replace('function plural', `function plural_${localeNameFormattedForJs}`)\n-        .replace(/,\\s+plural/, `, plural_${localeNameFormattedForJs}`)\n-        .replace(/\\s*const u = undefined;\\s*/, '');\n-  }\n-\n-  function generateCase(locale: ClosureLocale) {\n-    return `case '${locale.closureLocaleName}':\\n` +\n-        `l = locale_${formatLocale(locale.closureLocaleName)};\\n` +\n-        `break;\\n`;\n-  }\n }\n \n function formatLocale(locale: string): string {"
        },
        {
            "sha": "9fd8cf7e0863e58cd226b81190707e357731fb4a",
            "filename": "packages/common/locales/generate-locales-tool/locale-file.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-file.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977",
            "patch": "@@ -23,7 +23,7 @@ export function generateLocale(\n   return `${fileHeader}\n const u = undefined;\n \n-${getPluralFunction(localeData)}\n+${getPluralFunction(locale)}\n \n export default ${generateBasicLocaleString(locale, localeData, baseCurrencies)};\n `;"
        },
        {
            "sha": "656c095f8a64b72523c8bb56e6034e3887bd7839",
            "filename": "packages/common/locales/generate-locales-tool/locale-global-file.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-global-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-global-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Flocale-global-file.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977",
            "patch": "@@ -27,7 +27,7 @@ export function generateLocaleGlobalFile(\n     global.ng.common = global.ng.common || {};\n     global.ng.common.locales = global.ng.common.locales || {};\n     const u = undefined;\n-    ${getPluralFunction(localeData, false)}\n+    ${getPluralFunction(locale, false)}\n     global.ng.common.locales['${normalizeLocale(locale)}'] = ${data};\n   })(typeof globalThis !== 'undefined' && globalThis || typeof global !== 'undefined' && global || typeof window !== 'undefined' && window);\n     `;"
        },
        {
            "sha": "9cda1d629467871c91d8749e2e109152e2d0ae9d",
            "filename": "packages/common/locales/generate-locales-tool/plural-function.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fplural-function.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6cca3cf9d26d44f085ccb52c19ae610d082c977/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fplural-function.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Flocales%2Fgenerate-locales-tool%2Fplural-function.ts?ref=d6cca3cf9d26d44f085ccb52c19ae610d082c977",
            "patch": "@@ -5,7 +5,6 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {CldrLocaleData} from './cldr-data';\n \n // There are no types available for `cldr`.\n const cldr = require('cldr');\n@@ -15,13 +14,8 @@ const cldr = require('cldr');\n  * TODO(ocombe): replace \"cldr\" extractPluralRuleFunction with our own extraction using \"CldrJS\"\n  * because the 2 libs can become out of sync if they use different versions of the cldr database\n  */\n-export function getPluralFunction(localeData: CldrLocaleData, withTypes = true) {\n-  // We use the resolved bundle for extracting the plural function. This matches with the\n-  // lookup logic used by other extractions in the tool (using `cldrjs`), and also ensures\n-  // we follow the CLDR-specified bundle lookup algorithm. A language does not necessarily\n-  // resolve directly to a bundle CLDR provides data for.\n-  const bundleName = localeData.attributes.bundle;\n-  let fn = cldr.extractPluralRuleFunction(bundleName).toString();\n+export function getPluralFunction(locale: string, withTypes = true) {\n+  let fn = cldr.extractPluralRuleFunction(locale).toString();\n \n   const numberType = withTypes ? ': number' : '';\n   fn ="
        }
    ],
    "stats": {
        "total": 6074,
        "additions": 1113,
        "deletions": 4961
    }
}