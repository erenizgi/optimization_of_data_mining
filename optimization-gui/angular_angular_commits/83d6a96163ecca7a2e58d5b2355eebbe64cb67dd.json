{
    "author": "josephperrott",
    "message": "feat(dev-infra): prevent pr merges of features or breaking changes on rc (#41660)\n\nPrevent pull requests targeting `target: rc` from merging PRs with breaking\nchanges or features from being merged.\n\nPR Close #41660",
    "sha": "83d6a96163ecca7a2e58d5b2355eebbe64cb67dd",
    "files": [
        {
            "sha": "9bc6e766b564a771f029a32ad1dd003629be5c84",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/83d6a96163ecca7a2e58d5b2355eebbe64cb67dd/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/83d6a96163ecca7a2e58d5b2355eebbe64cb67dd/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=83d6a96163ecca7a2e58d5b2355eebbe64cb67dd",
            "patch": "@@ -3614,23 +3614,23 @@ function assertChangesAllowForTargetLabel(commits, label, config) {\n     var exemptedScopes = config.targetLabelExemptScopes || [];\n     /** List of commits which are subject to content requirements for the target label. */\n     commits = commits.filter(function (commit) { return !exemptedScopes.includes(commit.scope); });\n+    var hasBreakingChanges = commits.some(function (commit) { return commit.breakingChanges.length !== 0; });\n+    var hasFeatureCommits = commits.some(function (commit) { return commit.type === 'feat'; });\n     switch (label.pattern) {\n         case 'target: major':\n             break;\n         case 'target: minor':\n-            // Check if any commits in the pull request contains a breaking change.\n-            if (commits.some(function (commit) { return commit.breakingChanges.length !== 0; })) {\n+            if (hasBreakingChanges) {\n                 throw PullRequestFailure.hasBreakingChanges(label);\n             }\n             break;\n+        case 'target: rc':\n         case 'target: patch':\n         case 'target: lts':\n-            // Check if any commits in the pull request contains a breaking change.\n-            if (commits.some(function (commit) { return commit.breakingChanges.length !== 0; })) {\n+            if (hasBreakingChanges) {\n                 throw PullRequestFailure.hasBreakingChanges(label);\n             }\n-            // Check if any commits in the pull request contains a commit type of \"feat\".\n-            if (commits.some(function (commit) { return commit.type === 'feat'; })) {\n+            if (hasFeatureCommits) {\n                 throw PullRequestFailure.hasFeatureCommits(label);\n             }\n             break;"
        },
        {
            "sha": "1b2e8fa12d6b487592f0f65014676611b316b24e",
            "filename": "dev-infra/pr/merge/pull-request.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/83d6a96163ecca7a2e58d5b2355eebbe64cb67dd/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "raw_url": "https://github.com/angular/angular/raw/83d6a96163ecca7a2e58d5b2355eebbe64cb67dd/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts?ref=83d6a96163ecca7a2e58d5b2355eebbe64cb67dd",
            "patch": "@@ -200,23 +200,23 @@ function assertChangesAllowForTargetLabel(\n   const exemptedScopes = config.targetLabelExemptScopes || [];\n   /** List of commits which are subject to content requirements for the target label. */\n   commits = commits.filter(commit => !exemptedScopes.includes(commit.scope));\n+  const hasBreakingChanges = commits.some(commit => commit.breakingChanges.length !== 0);\n+  const hasFeatureCommits = commits.some(commit => commit.type === 'feat');\n   switch (label.pattern) {\n     case 'target: major':\n       break;\n     case 'target: minor':\n-      // Check if any commits in the pull request contains a breaking change.\n-      if (commits.some(commit => commit.breakingChanges.length !== 0)) {\n+      if (hasBreakingChanges) {\n         throw PullRequestFailure.hasBreakingChanges(label);\n       }\n       break;\n+    case 'target: rc':\n     case 'target: patch':\n     case 'target: lts':\n-      // Check if any commits in the pull request contains a breaking change.\n-      if (commits.some(commit => commit.breakingChanges.length !== 0)) {\n+      if (hasBreakingChanges) {\n         throw PullRequestFailure.hasBreakingChanges(label);\n       }\n-      // Check if any commits in the pull request contains a commit type of \"feat\".\n-      if (commits.some(commit => commit.type === 'feat')) {\n+      if (hasFeatureCommits) {\n         throw PullRequestFailure.hasFeatureCommits(label);\n       }\n       break;"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}