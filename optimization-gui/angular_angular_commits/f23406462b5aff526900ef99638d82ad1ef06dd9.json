{
    "author": "josephperrott",
    "message": "feat(dev-infra): create dry-run environment variable flag utils (#41387)\n\nCreate utility functions for adding a dry-run flag and checking the environment\nfor a dry run mode.\n\nPR Close #41387",
    "sha": "f23406462b5aff526900ef99638d82ad1ef06dd9",
    "files": [
        {
            "sha": "06421a4c26b7ca0d61e3c722580556a95e4dfa64",
            "filename": "dev-infra/utils/dry-run.ts",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/f23406462b5aff526900ef99638d82ad1ef06dd9/dev-infra%2Futils%2Fdry-run.ts",
            "raw_url": "https://github.com/angular/angular/raw/f23406462b5aff526900ef99638d82ad1ef06dd9/dev-infra%2Futils%2Fdry-run.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fdry-run.ts?ref=f23406462b5aff526900ef99638d82ad1ef06dd9",
            "patch": "@@ -0,0 +1,43 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Argv} from 'yargs';\n+\n+/**\n+ * Add a --dry-run flag to the available options for the yargs argv object.  When present, sets an\n+ * environment variable noting dry run mode.\n+ */\n+export function addDryRunFlag<T>(args: Argv<T>) {\n+  return args.option('dry-run' as 'dryRun', {\n+    type: 'boolean',\n+    default: false,\n+    description: 'Whether to do a dry run',\n+    coerce: (dryRun: boolean) => {\n+      if (dryRun) {\n+        process.env['DRY_RUN'] = '1';\n+      }\n+      return dryRun;\n+    }\n+  });\n+}\n+\n+/** Whether the current environment is in dry run mode. */\n+export function isDryRun(): boolean {\n+  return process.env['DRY_RUN'] !== undefined;\n+}\n+\n+/** Error to be thrown when a function or method is called in dryRun mode and shouldn't be. */\n+export class DryRunError extends Error {\n+  constructor() {\n+    super('Cannot call this function in dryRun mode.');\n+    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n+    // a limitation in down-leveling.\n+    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n+    Object.setPrototypeOf(this, DryRunError.prototype);\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 43,
        "deletions": 0
    }
}