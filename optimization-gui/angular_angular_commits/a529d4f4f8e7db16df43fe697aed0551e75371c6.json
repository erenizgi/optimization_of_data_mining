{
    "author": "JoostK",
    "message": "fix(core): do not retain dynamically compiled components and modules (#42003)\n\nThe JIT compiler has a mapping from component to the owning NgModule\nand tracks whether a certain NgModule class has been verified; these\nmaps causes any JIT compiled component and NgModule to be retained even\nif they are no longer referenced from anywhere else. This commit\nswitches the maps to `WeakMap` to allow garbage collecting any\ncomponents and NgModules that are no longer referenced elsewhere.\n\nFixes #19997\n\nPR Close #42003",
    "sha": "a529d4f4f8e7db16df43fe697aed0551e75371c6",
    "files": [
        {
            "sha": "3df72f8d8ef109837c331991027b73a0224e1670",
            "filename": "packages/core/src/render3/jit/module.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/a529d4f4f8e7db16df43fe697aed0551e75371c6/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts",
            "raw_url": "https://github.com/angular/angular/raw/a529d4f4f8e7db16df43fe697aed0551e75371c6/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts?ref=a529d4f4f8e7db16df43fe697aed0551e75371c6",
            "patch": "@@ -373,12 +373,12 @@ function getAnnotation<T>(type: any, name: string): T|null {\n  * NgModule the component belongs to. We keep the list of compiled components here so that the\n  * TestBed can reset it later.\n  */\n-let ownerNgModule = new Map<Type<any>, NgModuleType<any>>();\n-let verifiedNgModule = new Map<NgModuleType<any>, boolean>();\n+let ownerNgModule = new WeakMap<Type<any>, NgModuleType<any>>();\n+let verifiedNgModule = new WeakMap<NgModuleType<any>, boolean>();\n \n export function resetCompiledComponents(): void {\n-  ownerNgModule = new Map<Type<any>, NgModuleType<any>>();\n-  verifiedNgModule = new Map<NgModuleType<any>, boolean>();\n+  ownerNgModule = new WeakMap<Type<any>, NgModuleType<any>>();\n+  verifiedNgModule = new WeakMap<NgModuleType<any>, boolean>();\n   moduleQueue.length = 0;\n }\n "
        }
    ],
    "stats": {
        "total": 8,
        "additions": 4,
        "deletions": 4
    }
}