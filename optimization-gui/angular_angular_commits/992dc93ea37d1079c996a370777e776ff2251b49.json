{
    "author": "josephperrott",
    "message": "refactor(dev-infra): remove usages and dependency on shelljs (#42911)\n\nRemove usages of shelljs and instead use spawn/spawnSync.\n\nPR Close #42911",
    "sha": "992dc93ea37d1079c996a370777e776ff2251b49",
    "files": [
        {
            "sha": "3ef04bd319b80f7ad4a953cf1468d15032a83d4f",
            "filename": "dev-infra/benchmark/driver-utilities/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -10,10 +10,8 @@ ts_library(\n         \"//packages/benchpress\",\n         \"@npm//@types/node\",\n         \"@npm//@types/selenium-webdriver\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//node-uuid\",\n         \"@npm//protractor\",\n         \"@npm//selenium-webdriver\",\n-        \"@npm//shelljs\",\n     ],\n )"
        },
        {
            "sha": "a9043b9a2467a68ac3f662c8d69e575c6f210f2b",
            "filename": "dev-infra/benchmark/driver-utilities/perf_util.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fdriver-utilities%2Fperf_util.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {mkdir} from 'shelljs';\n+import {mkdirSync} from 'fs';\n \n export {verifyNoBrowserErrors} from './e2e_util';\n \n@@ -61,7 +61,9 @@ function createBenchpressRunner(): Runner {\n     runId = process.env.GIT_SHA + ' ' + runId;\n   }\n   const resultsFolder = './dist/benchmark_results';\n-  mkdir('-p', resultsFolder);\n+  mkdirSync(resultsFolder, {\n+    recursive: true,\n+  });\n   const providers: StaticProvider[] = [\n     SeleniumWebDriverAdapter.PROTRACTOR_PROVIDERS,\n     {provide: Options.FORCE_GC, useValue: globalOptions.forceGc},"
        },
        {
            "sha": "19a062e471e43a6aa6846581980c3ce60680c32b",
            "filename": "dev-infra/build-worker.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbuild-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fbuild-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbuild-worker.js?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -145,6 +145,9 @@ var GitCommandError = /** @class */ (function (_super) {\n         // we sanitize the command that will be part of the error message.\n         _super.call(this, \"Command failed: git \" + client.sanitizeConsoleOutput(args.join(' '))) || this;\n         _this.args = args;\n+        // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n+        // a limitation in down-leveling.\n+        // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n         Object.setPrototypeOf(_this, GitCommandError.prototype);\n         return _this;\n     }"
        },
        {
            "sha": "e0299445f8fd0c64a21c8d5b99d715fa362fe0c5",
            "filename": "dev-infra/commit-message/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -13,12 +13,10 @@ ts_library(\n         \"@npm//@types/git-raw-commits\",\n         \"@npm//@types/inquirer\",\n         \"@npm//@types/node\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//@types/yargs\",\n         \"@npm//conventional-commits-parser\",\n         \"@npm//git-raw-commits\",\n         \"@npm//inquirer\",\n-        \"@npm//shelljs\",\n         \"@npm//yargs\",\n     ],\n )"
        },
        {
            "sha": "1c5a82ea8576eb678d8938a39ad4e357268716fe",
            "filename": "dev-infra/format/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -10,11 +10,9 @@ ts_library(\n         \"//dev-infra/utils\",\n         \"@npm//@types/cli-progress\",\n         \"@npm//@types/node\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//@types/yargs\",\n         \"@npm//cli-progress\",\n         \"@npm//multimatch\",\n-        \"@npm//shelljs\",\n         \"@npm//yargs\",\n     ],\n )"
        },
        {
            "sha": "65930adadb9c6442b363144939f9997562e45f13",
            "filename": "dev-infra/format/formatters/base-formatter.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -10,7 +10,8 @@ import {GitClient} from '../../utils/git/git-client';\n import {FormatConfig} from '../config';\n \n // A callback to determine if the formatter run found a failure in formatting.\n-export type CallbackFunc = (file: string, code: number, stdout: string, stderr: string) => boolean;\n+export type CallbackFunc =\n+    (file: string, code: number|NodeJS.Signals, stdout: string, stderr: string) => boolean;\n \n // The actions a formatter can take.\n export type FormatterAction = 'check'|'format';"
        },
        {
            "sha": "3f49dc1b3c36c2b209c7602587cebc7c7937bcdc",
            "filename": "dev-infra/format/formatters/buildifier.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -26,14 +26,14 @@ export class Buildifier extends Formatter {\n     check: {\n       commandFlags: `${BAZEL_WARNING_FLAG} --lint=warn --mode=check --format=json`,\n       callback:\n-          (_: string, code: number, stdout: string) => {\n+          (_: string, code: number|NodeJS.Signals, stdout: string) => {\n             return code !== 0 || !(JSON.parse(stdout) as {success: string}).success;\n           },\n     },\n     format: {\n       commandFlags: `${BAZEL_WARNING_FLAG} --lint=fix --mode=fix`,\n       callback:\n-          (file: string, code: number, _: string, stderr: string) => {\n+          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n             if (code !== 0) {\n               error(`Error running buildifier on: ${file}`);\n               error(stderr);"
        },
        {
            "sha": "616849a5791ca10b1e3f3e5e4d2b9eeb709ed7b3",
            "filename": "dev-infra/format/formatters/clang-format.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fclang-format.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -26,14 +26,14 @@ export class ClangFormat extends Formatter {\n     check: {\n       commandFlags: `--Werror -n -style=file`,\n       callback:\n-          (_: string, code: number) => {\n+          (_: string, code: number|NodeJS.Signals) => {\n             return code !== 0;\n           },\n     },\n     format: {\n       commandFlags: `-i -style=file`,\n       callback:\n-          (file: string, code: number, _: string, stderr: string) => {\n+          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n             if (code !== 0) {\n               error(`Error running clang-format on: ${file}`);\n               error(stderr);"
        },
        {
            "sha": "f2969203c76e3a1e88961c2ddaf52afe176c9205",
            "filename": "dev-infra/format/formatters/prettier.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fprettier.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -7,8 +7,8 @@\n  */\n \n import {join} from 'path';\n-import {exec} from 'shelljs';\n \n+import {spawnSync} from '../../utils/child-process';\n import {error} from '../../utils/console';\n \n import {Formatter} from './base-formatter';\n@@ -27,21 +27,22 @@ export class Prettier extends Formatter {\n    * The configuration path of the prettier config, obtained during construction to prevent needing\n    * to discover it repeatedly for each execution.\n    */\n-  private configPath =\n-      this.config['prettier'] ? exec(`${this.binaryFilePath} --find-config-path .`).trim() : '';\n+  private configPath = this.config['prettier'] ?\n+      spawnSync(this.binaryFilePath, ['--find-config-path', '.']).stdout.trim() :\n+      '';\n \n   override actions = {\n     check: {\n       commandFlags: `--config ${this.configPath} --check`,\n       callback:\n-          (_: string, code: number, stdout: string) => {\n+          (_: string, code: number|NodeJS.Signals, stdout: string) => {\n             return code !== 0;\n           },\n     },\n     format: {\n       commandFlags: `--config ${this.configPath} --write`,\n       callback:\n-          (file: string, code: number, _: string, stderr: string) => {\n+          (file: string, code: number|NodeJS.Signals, _: string, stderr: string) => {\n             if (code !== 0) {\n               error(`Error running prettier on: ${file}`);\n               error(stderr);"
        },
        {
            "sha": "c10a27f9c9c77ee18b21a00c7462d865c39e0efc",
            "filename": "dev-infra/format/run-commands-parallel.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Frun-commands-parallel.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fformat%2Frun-commands-parallel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Frun-commands-parallel.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -9,8 +9,8 @@\n import {Bar} from 'cli-progress';\n import * as multimatch from 'multimatch';\n import {cpus} from 'os';\n-import {exec} from 'shelljs';\n \n+import {spawn, SpawnResult} from '../utils/child-process';\n import {info} from '../utils/console';\n \n import {Formatter, FormatterAction, getActiveFormatters} from './formatters/index';\n@@ -86,12 +86,11 @@ export function runFormatterInParallel(allFiles: string[], action: FormatterActi\n       // Get the file and formatter for the next command.\n       const {file, formatter} = nextCommand;\n \n-      exec(\n-          `${formatter.commandFor(action)} ${file}`,\n-          {async: true, silent: true},\n-          (code, stdout, stderr) => {\n+      const [spawnCmd, ...spawnArgs] = [...formatter.commandFor(action).split(' '), file];\n+      spawn(spawnCmd, spawnArgs, {suppressErrorOnFailingExitCode: true, mode: 'silent'})\n+          .then(({stdout, stderr, status}: SpawnResult) => {\n             // Run the provided callback function.\n-            const failed = formatter.callbackFor(action)(file, code, stdout, stderr);\n+            const failed = formatter.callbackFor(action)(file, status, stdout, stderr);\n             if (failed) {\n               failures.push({filePath: file, message: stderr});\n             }\n@@ -110,8 +109,7 @@ export function runFormatterInParallel(allFiles: string[], action: FormatterActi\n               progressBar.stop();\n               resolve(failures);\n             }\n-          },\n-      );\n+          });\n       // Mark the thread as in use as the command execution has been started.\n       threads[thread] = true;\n     }"
        },
        {
            "sha": "d9144b6a3210641d1657eaf37b24da2a3e63ece1",
            "filename": "dev-infra/misc/build-and-link/cli.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fmisc%2Fbuild-and-link%2Fcli.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -7,13 +7,13 @@\n  */\n \n import {green} from 'chalk';\n-import {lstatSync, stat, Stats} from 'fs';\n-import {isAbsolute, join, resolve} from 'path';\n+import {lstatSync} from 'fs';\n+import {resolve} from 'path';\n import {Arguments, Argv, CommandModule} from 'yargs';\n \n import {buildReleaseOutput} from '../../release/build/index';\n+import {spawn} from '../../utils/child-process';\n import {error, info, red} from '../../utils/console';\n-import {exec} from '../../utils/shelljs';\n \n \n /** Command line options. */\n@@ -52,8 +52,8 @@ async function handler({projectRoot}: Arguments<BuildAndLinkOptions>) {\n   info(green(` ✓  Built release output.`));\n \n   for (const {outputPath, name} of releaseOutputs) {\n-    exec(`yarn link --cwd ${outputPath}`);\n-    exec(`yarn link --cwd ${projectRoot} ${name}`);\n+    await spawn('yarn', ['link', '--cwd', outputPath]);\n+    await spawn('yarn', ['link', '--cwd', projectRoot, name]);\n   }\n \n   info(green(` ✓  Linked release packages in provided project.`));"
        },
        {
            "sha": "ff363be7b1391ee94e26dae1a2fd663a4433c4e8",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 140,
            "deletions": 132,
            "changes": 272,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -22,7 +22,6 @@ var conventionalCommitsParser = require('conventional-commits-parser');\n var gitCommits_ = require('git-raw-commits');\n var cliProgress = require('cli-progress');\n var os = require('os');\n-var shelljs = require('shelljs');\n var minimatch = require('minimatch');\n var ejs = require('ejs');\n var ora = require('ora');\n@@ -317,6 +316,9 @@ var GitCommandError = /** @class */ (function (_super) {\n         // we sanitize the command that will be part of the error message.\n         _super.call(this, \"Command failed: git \" + client.sanitizeConsoleOutput(args.join(' '))) || this;\n         _this.args = args;\n+        // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n+        // a limitation in down-leveling.\n+        // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n         Object.setPrototypeOf(_this, GitCommandError.prototype);\n         return _this;\n     }\n@@ -2440,6 +2442,113 @@ function buildCommitMessageParser(localYargs) {\n         .command(ValidateRangeModule);\n }\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Spawns a given command with the specified arguments inside an interactive shell. All process\n+ * stdin, stdout and stderr output is printed to the current console.\n+ *\n+ * @returns a Promise resolving on success, and rejecting on command failure with the status code.\n+ */\n+function spawnInteractive(command, args, options) {\n+    if (options === void 0) { options = {}; }\n+    return new Promise(function (resolve, reject) {\n+        var commandText = command + \" \" + args.join(' ');\n+        debug(\"Executing command: \" + commandText);\n+        var childProcess = child_process.spawn(command, args, tslib.__assign(tslib.__assign({}, options), { shell: true, stdio: 'inherit' }));\n+        childProcess.on('exit', function (status) { return status === 0 ? resolve() : reject(status); });\n+    });\n+}\n+/**\n+ * Spawns a given command with the specified arguments inside a shell. All process stdout\n+ * output is captured and returned as resolution on completion. Depending on the chosen\n+ * output mode, stdout/stderr output is also printed to the console, or only on error.\n+ *\n+ * @returns a Promise resolving with captured stdout and stderr on success. The promise\n+ *   rejects on command failure.\n+ */\n+function spawn(command, args, options) {\n+    if (options === void 0) { options = {}; }\n+    return new Promise(function (resolve, reject) {\n+        var commandText = command + \" \" + args.join(' ');\n+        var outputMode = options.mode;\n+        debug(\"Executing command: \" + commandText);\n+        var childProcess = child_process.spawn(command, args, tslib.__assign(tslib.__assign({}, options), { shell: true, stdio: 'pipe' }));\n+        var logOutput = '';\n+        var stdout = '';\n+        var stderr = '';\n+        // Capture the stdout separately so that it can be passed as resolve value.\n+        // This is useful if commands return parsable stdout.\n+        childProcess.stderr.on('data', function (message) {\n+            stderr += message;\n+            logOutput += message;\n+            // If console output is enabled, print the message directly to the stderr. Note that\n+            // we intentionally print all output to stderr as stdout should not be polluted.\n+            if (outputMode === undefined || outputMode === 'enabled') {\n+                process.stderr.write(message);\n+            }\n+        });\n+        childProcess.stdout.on('data', function (message) {\n+            stdout += message;\n+            logOutput += message;\n+            // If console output is enabled, print the message directly to the stderr. Note that\n+            // we intentionally print all output to stderr as stdout should not be polluted.\n+            if (outputMode === undefined || outputMode === 'enabled') {\n+                process.stderr.write(message);\n+            }\n+        });\n+        childProcess.on('exit', function (exitCode, signal) {\n+            var exitDescription = exitCode !== null ? \"exit code \\\"\" + exitCode + \"\\\"\" : \"signal \\\"\" + signal + \"\\\"\";\n+            var printFn = outputMode === 'on-error' ? error : debug;\n+            var status = statusFromExitCodeAndSignal(exitCode, signal);\n+            printFn(\"Command \\\"\" + commandText + \"\\\" completed with \" + exitDescription + \".\");\n+            printFn(\"Process output: \\n\" + logOutput);\n+            // On success, resolve the promise. Otherwise reject with the captured stderr\n+            // and stdout log output if the output mode was set to `silent`.\n+            if (status === 0 || options.suppressErrorOnFailingExitCode) {\n+                resolve({ stdout: stdout, stderr: stderr, status: status });\n+            }\n+            else {\n+                reject(outputMode === 'silent' ? logOutput : undefined);\n+            }\n+        });\n+    });\n+}\n+/**\n+ * Spawns a given command with the specified arguments inside a shell synchronously.\n+ *\n+ * @returns The command's stdout and stderr.\n+ */\n+function spawnSync(command, args, options) {\n+    if (options === void 0) { options = {}; }\n+    var commandText = command + \" \" + args.join(' ');\n+    debug(\"Executing command: \" + commandText);\n+    var _a = child_process.spawnSync(command, args, tslib.__assign(tslib.__assign({}, options), { encoding: 'utf8', shell: true, stdio: 'pipe' })), exitCode = _a.status, signal = _a.signal, stdout = _a.stdout, stderr = _a.stderr;\n+    /** The status of the spawn result. */\n+    var status = statusFromExitCodeAndSignal(exitCode, signal);\n+    if (status === 0 || options.suppressErrorOnFailingExitCode) {\n+        return { status: status, stdout: stdout, stderr: stderr };\n+    }\n+    throw new Error(stderr);\n+}\n+/**\n+ * Convert the provided exitCode and signal to a single status code.\n+ *\n+ * During `exit` node provides either a `code` or `signal`, one of which is guaranteed to be\n+ * non-null.\n+ *\n+ * For more details see: https://nodejs.org/api/child_process.html#child_process_event_exit\n+ */\n+function statusFromExitCodeAndSignal(exitCode, signal) {\n+    var _a;\n+    return (_a = exitCode !== null && exitCode !== void 0 ? exitCode : signal) !== null && _a !== void 0 ? _a : -1;\n+}\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -2644,7 +2753,9 @@ class Prettier extends Formatter {\n          * The configuration path of the prettier config, obtained during construction to prevent needing\n          * to discover it repeatedly for each execution.\n          */\n-        this.configPath = this.config['prettier'] ? shelljs.exec(`${this.binaryFilePath} --find-config-path .`).trim() : '';\n+        this.configPath = this.config['prettier'] ?\n+            spawnSync(this.binaryFilePath, ['--find-config-path', '.']).stdout.trim() :\n+            '';\n         this.actions = {\n             check: {\n                 commandFlags: `--config ${this.configPath} --check`,\n@@ -2747,9 +2858,11 @@ function runFormatterInParallel(allFiles, action) {\n             }\n             // Get the file and formatter for the next command.\n             const { file, formatter } = nextCommand;\n-            shelljs.exec(`${formatter.commandFor(action)} ${file}`, { async: true, silent: true }, (code, stdout, stderr) => {\n+            const [spawnCmd, ...spawnArgs] = [...formatter.commandFor(action).split(' '), file];\n+            spawn(spawnCmd, spawnArgs, { suppressErrorOnFailingExitCode: true, mode: 'silent' })\n+                .then(({ stdout, stderr, status }) => {\n                 // Run the provided callback function.\n-                const failed = formatter.callbackFor(action)(file, code, stdout, stderr);\n+                const failed = formatter.callbackFor(action)(file, status, stdout, stderr);\n                 if (failed) {\n                     failures.push({ filePath: file, message: stderr });\n                 }\n@@ -3376,21 +3489,6 @@ const CheckoutCommandModule = {\n     describe: 'Checkout a PR from the upstream repo',\n };\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Runs an given command as child process. By default, child process\n- * output will not be printed.\n- */\n-function exec(cmd, opts) {\n-    return shelljs.exec(cmd, tslib.__assign(tslib.__assign({ silent: true }, opts), { async: false }));\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -3494,7 +3592,9 @@ function discoverNewConflictsForPr(newPrNumber, updatedAfter) {\n                 if (err instanceof GitCommandError) {\n                     conflicts.push(pr);\n                 }\n-                throw err;\n+                else {\n+                    throw err;\n+                }\n             }\n             // Abort any outstanding rebase attempt.\n             git.runGraceful(['rebase', '--abort'], { stdio: 'ignore' });\n@@ -3504,7 +3604,7 @@ function discoverNewConflictsForPr(newPrNumber, updatedAfter) {\n         progressBar.stop();\n         info();\n         info(`Result:`);\n-        cleanUpGitState(previousBranchOrRevision);\n+        git.checkout(previousBranchOrRevision, true);\n         // If no conflicts are found, exit successfully.\n         if (conflicts.length === 0) {\n             info(`No new conflicting PRs found after #${newPrNumber} merging`);\n@@ -3519,17 +3619,6 @@ function discoverNewConflictsForPr(newPrNumber, updatedAfter) {\n         process.exit(1);\n     });\n }\n-/** Reset git back to the provided branch or revision. */\n-function cleanUpGitState(previousBranchOrRevision) {\n-    // Ensure that any outstanding rebases are aborted.\n-    exec(`git rebase --abort`);\n-    // Ensure that any changes in the current repo state are cleared.\n-    exec(`git reset --hard`);\n-    // Checkout the original branch from before the run began.\n-    exec(`git checkout ${previousBranchOrRevision}`);\n-    // Delete the generated branch.\n-    exec(`git branch -D ${tempWorkingBranch}`);\n-}\n \n /**\n  * @license\n@@ -5976,88 +6065,6 @@ const ReleaseNotesCommandModule = {\n     describe: 'Generate release notes',\n };\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Spawns a given command with the specified arguments inside an interactive shell. All process\n- * stdin, stdout and stderr output is printed to the current console.\n- *\n- * @returns a Promise resolving on success, and rejecting on command failure with the status code.\n- */\n-function spawnInteractive(command, args, options) {\n-    if (options === void 0) { options = {}; }\n-    return new Promise(function (resolve, reject) {\n-        var commandText = command + \" \" + args.join(' ');\n-        debug(\"Executing command: \" + commandText);\n-        var childProcess = child_process.spawn(command, args, tslib.__assign(tslib.__assign({}, options), { shell: true, stdio: 'inherit' }));\n-        childProcess.on('exit', function (status) { return status === 0 ? resolve() : reject(status); });\n-    });\n-}\n-/**\n- * Spawns a given command with the specified arguments inside a shell. All process stdout\n- * output is captured and returned as resolution on completion. Depending on the chosen\n- * output mode, stdout/stderr output is also printed to the console, or only on error.\n- *\n- * @returns a Promise resolving with captured stdout and stderr on success. The promise\n- *   rejects on command failure\n- */\n-function spawn(command, args, options) {\n-    if (options === void 0) { options = {}; }\n-    return new Promise(function (resolve, reject) {\n-        var commandText = command + \" \" + args.join(' ');\n-        var outputMode = options.mode;\n-        debug(\"Executing command: \" + commandText);\n-        var childProcess = child_process.spawn(command, args, tslib.__assign(tslib.__assign({}, options), { shell: true, stdio: 'pipe' }));\n-        var logOutput = '';\n-        var stdout = '';\n-        var stderr = '';\n-        // Capture the stdout separately so that it can be passed as resolve value.\n-        // This is useful if commands return parsable stdout.\n-        childProcess.stderr.on('data', function (message) {\n-            stderr += message;\n-            logOutput += message;\n-            // If console output is enabled, print the message directly to the stderr. Note that\n-            // we intentionally print all output to stderr as stdout should not be polluted.\n-            if (outputMode === undefined || outputMode === 'enabled') {\n-                process.stderr.write(message);\n-            }\n-        });\n-        childProcess.stdout.on('data', function (message) {\n-            stdout += message;\n-            logOutput += message;\n-            // If console output is enabled, print the message directly to the stderr. Note that\n-            // we intentionally print all output to stderr as stdout should not be polluted.\n-            if (outputMode === undefined || outputMode === 'enabled') {\n-                process.stderr.write(message);\n-            }\n-        });\n-        childProcess.on('exit', function (exitCode, signal) {\n-            var exitDescription = exitCode !== null ? \"exit code \\\"\" + exitCode + \"\\\"\" : \"signal \\\"\" + signal + \"\\\"\";\n-            var printFn = outputMode === 'on-error' ? error : debug;\n-            var status = statusFromExitCodeAndSignal(exitCode, signal);\n-            printFn(\"Command \\\"\" + commandText + \"\\\" completed with \" + exitDescription + \".\");\n-            printFn(\"Process output: \\n\" + logOutput);\n-            // On success, resolve the promise. Otherwise reject with the captured stderr\n-            // and stdout log output if the output mode was set to `silent`.\n-            if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-                resolve({ stdout: stdout, stderr: stderr, status: status });\n-            }\n-            else {\n-                reject(outputMode === 'silent' ? logOutput : undefined);\n-            }\n-        });\n-    });\n-}\n-/** Convert the provided exitCode and signal to a single status code. */\n-function statusFromExitCodeAndSignal(exitCode, signal) {\n-    return exitCode !== null ? exitCode : signal !== null ? signal : -1;\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -7655,20 +7662,17 @@ const ReleaseSetDistTagCommand = {\n  */\n function buildEnvStamp(mode) {\n     console.info(`BUILD_SCM_BRANCH ${getCurrentBranch()}`);\n-    console.info(`BUILD_SCM_COMMIT_SHA ${getCurrentSha()}`);\n-    console.info(`BUILD_SCM_HASH ${getCurrentSha()}`);\n+    console.info(`BUILD_SCM_COMMIT_SHA ${getCurrentBranchOrRevision()}`);\n+    console.info(`BUILD_SCM_HASH ${getCurrentBranchOrRevision()}`);\n     console.info(`BUILD_SCM_LOCAL_CHANGES ${hasLocalChanges()}`);\n     console.info(`BUILD_SCM_USER ${getCurrentGitUser()}`);\n     console.info(`BUILD_SCM_VERSION ${getSCMVersion(mode)}`);\n-    process.exit(0);\n-}\n-/** Run the exec command and return the stdout as a trimmed string. */\n-function exec$1(cmd) {\n-    return exec(cmd).trim();\n+    process.exit();\n }\n /** Whether the repo has local changes. */\n function hasLocalChanges() {\n-    return !!exec$1(`git status --untracked-files=no --porcelain`);\n+    const git = GitClient.get();\n+    return git.hasUncommittedChanges();\n }\n /**\n  * Get the version for generated packages.\n@@ -7677,30 +7681,34 @@ function hasLocalChanges() {\n  * In release mode, the version is based on the base package.json version.\n  */\n function getSCMVersion(mode) {\n+    const git = GitClient.get();\n     if (mode === 'release') {\n-        const git = GitClient.get();\n         const packageJsonPath = path.join(git.baseDir, 'package.json');\n         const { version } = require(packageJsonPath);\n         return version;\n     }\n     if (mode === 'snapshot') {\n-        const version = exec$1(`git describe --match [0-9]*.[0-9]*.[0-9]* --abbrev=7 --tags HEAD`);\n+        const version = git.run(['describe', '--match', '[0-9]*.[0-9]*.[0-9]*', '--abbrev=7', '--tags', 'HEAD'])\n+            .stdout.trim();\n         return `${version.replace(/-([0-9]+)-g/, '+$1.sha-')}${(hasLocalChanges() ? '.with-local-changes' : '')}`;\n     }\n     return '0.0.0';\n }\n-/** Get the current SHA of HEAD. */\n-function getCurrentSha() {\n-    return exec$1(`git rev-parse HEAD`);\n+/** Get the current branch or revision of HEAD. */\n+function getCurrentBranchOrRevision() {\n+    const git = GitClient.get();\n+    return git.getCurrentBranchOrRevision();\n }\n /** Get the currently checked out branch. */\n function getCurrentBranch() {\n-    return exec$1(`git symbolic-ref --short HEAD`);\n+    const git = GitClient.get();\n+    return git.run(['symbolic-ref', '--short', 'HEAD']).stdout.trim();\n }\n /** Get the current git user based on the git config. */\n function getCurrentGitUser() {\n-    const userName = exec$1(`git config user.name`);\n-    const userEmail = exec$1(`git config user.email`);\n+    const git = GitClient.get();\n+    let userName = git.runGraceful(['config', 'user.name']).stdout.trim() || 'Unknown User';\n+    let userEmail = git.runGraceful(['config', 'user.email']).stdout.trim() || 'unknown_email';\n     return `${userName} <${userEmail}>`;\n }\n \n@@ -8187,8 +8195,8 @@ function handler$e({ projectRoot }) {\n         }\n         info(chalk.green(` ✓  Built release output.`));\n         for (const { outputPath, name } of releaseOutputs) {\n-            exec(`yarn link --cwd ${outputPath}`);\n-            exec(`yarn link --cwd ${projectRoot} ${name}`);\n+            yield spawn('yarn', ['link', '--cwd', outputPath]);\n+            yield spawn('yarn', ['link', '--cwd', projectRoot, name]);\n         }\n         info(chalk.green(` ✓  Linked release packages in provided project.`));\n     });"
        },
        {
            "sha": "e88ed7eaeda4cd30e810357b9e1fe0920b5be0e7",
            "filename": "dev-infra/pr/discover-new-conflicts/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -11,7 +11,6 @@ ts_library(\n         \"//dev-infra/utils\",\n         \"@npm//@types/cli-progress\",\n         \"@npm//@types/node\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//@types/yargs\",\n         \"@npm//typed-graphqlify\",\n     ],"
        },
        {
            "sha": "08ee4e01cc7844315bc3001e624a64070772b31e",
            "filename": "dev-infra/pr/discover-new-conflicts/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 15,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -13,7 +13,6 @@ import {error, info} from '../../utils/console';\n import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n import {GitCommandError} from '../../utils/git/git-client';\n import {getPendingPrs} from '../../utils/github';\n-import {exec} from '../../utils/shelljs';\n \n \n /* Graphql schema for the response body for each pending PR. */\n@@ -125,8 +124,9 @@ export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfte\n     } catch (err) {\n       if (err instanceof GitCommandError) {\n         conflicts.push(pr);\n+      } else {\n+        throw err;\n       }\n-      throw err;\n     }\n     // Abort any outstanding rebase attempt.\n     git.runGraceful(['rebase', '--abort'], {stdio: 'ignore'});\n@@ -138,7 +138,7 @@ export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfte\n   info();\n   info(`Result:`);\n \n-  cleanUpGitState(previousBranchOrRevision);\n+  git.checkout(previousBranchOrRevision, true);\n \n   // If no conflicts are found, exit successfully.\n   if (conflicts.length === 0) {\n@@ -154,15 +154,3 @@ export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfte\n   error.groupEnd();\n   process.exit(1);\n }\n-\n-/** Reset git back to the provided branch or revision. */\n-export function cleanUpGitState(previousBranchOrRevision: string) {\n-  // Ensure that any outstanding rebases are aborted.\n-  exec(`git rebase --abort`);\n-  // Ensure that any changes in the current repo state are cleared.\n-  exec(`git reset --hard`);\n-  // Checkout the original branch from before the run began.\n-  exec(`git checkout ${previousBranchOrRevision}`);\n-  // Delete the generated branch.\n-  exec(`git branch -D ${tempWorkingBranch}`);\n-}"
        },
        {
            "sha": "7ab68b7d64bb808277e160a05d514e21b66031e9",
            "filename": "dev-infra/pullapprove/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -17,11 +17,9 @@ ts_library(\n         \"//dev-infra/utils\",\n         \"@npm//@types/minimatch\",\n         \"@npm//@types/node\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//@types/yaml\",\n         \"@npm//@types/yargs\",\n         \"@npm//minimatch\",\n-        \"@npm//shelljs\",\n         \"@npm//yaml\",\n         \"@npm//yargs\",\n     ],"
        },
        {
            "sha": "e8a7e40a650585793fb8617b3650e5e0cf709733",
            "filename": "dev-infra/release/stamping/env-stamp.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 20,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fstamping%2Fenv-stamp.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -9,8 +9,6 @@\n import {join} from 'path';\n import {GitClient} from '../../utils/git/git-client';\n \n-import {exec as _exec} from '../../utils/shelljs';\n-\n export type EnvStampMode = 'snapshot'|'release';\n \n /**\n@@ -25,22 +23,18 @@ export type EnvStampMode = 'snapshot'|'release';\n  */\n export function buildEnvStamp(mode: EnvStampMode) {\n   console.info(`BUILD_SCM_BRANCH ${getCurrentBranch()}`);\n-  console.info(`BUILD_SCM_COMMIT_SHA ${getCurrentSha()}`);\n-  console.info(`BUILD_SCM_HASH ${getCurrentSha()}`);\n+  console.info(`BUILD_SCM_COMMIT_SHA ${getCurrentBranchOrRevision()}`);\n+  console.info(`BUILD_SCM_HASH ${getCurrentBranchOrRevision()}`);\n   console.info(`BUILD_SCM_LOCAL_CHANGES ${hasLocalChanges()}`);\n   console.info(`BUILD_SCM_USER ${getCurrentGitUser()}`);\n   console.info(`BUILD_SCM_VERSION ${getSCMVersion(mode)}`);\n-  process.exit(0);\n-}\n-\n-/** Run the exec command and return the stdout as a trimmed string. */\n-function exec(cmd: string) {\n-  return _exec(cmd).trim();\n+  process.exit();\n }\n \n /** Whether the repo has local changes. */\n function hasLocalChanges() {\n-  return !!exec(`git status --untracked-files=no --porcelain`);\n+  const git = GitClient.get();\n+  return git.hasUncommittedChanges();\n }\n \n /**\n@@ -50,34 +44,38 @@ function hasLocalChanges() {\n  * In release mode, the version is based on the base package.json version.\n  */\n function getSCMVersion(mode: EnvStampMode) {\n+  const git = GitClient.get();\n   if (mode === 'release') {\n-    const git = GitClient.get();\n     const packageJsonPath = join(git.baseDir, 'package.json');\n     const {version} = require(packageJsonPath);\n     return version;\n   }\n   if (mode === 'snapshot') {\n-    const version = exec(`git describe --match [0-9]*.[0-9]*.[0-9]* --abbrev=7 --tags HEAD`);\n+    const version =\n+        git.run(['describe', '--match', '[0-9]*.[0-9]*.[0-9]*', '--abbrev=7', '--tags', 'HEAD'])\n+            .stdout.trim();\n     return `${version.replace(/-([0-9]+)-g/, '+$1.sha-')}${\n         (hasLocalChanges() ? '.with-local-changes' : '')}`;\n   }\n   return '0.0.0';\n }\n \n-/** Get the current SHA of HEAD. */\n-function getCurrentSha() {\n-  return exec(`git rev-parse HEAD`);\n+/** Get the current branch or revision of HEAD. */\n+function getCurrentBranchOrRevision() {\n+  const git = GitClient.get();\n+  return git.getCurrentBranchOrRevision();\n }\n \n /** Get the currently checked out branch. */\n function getCurrentBranch() {\n-  return exec(`git symbolic-ref --short HEAD`);\n+  const git = GitClient.get();\n+  return git.run(['symbolic-ref', '--short', 'HEAD']).stdout.trim();\n }\n \n /** Get the current git user based on the git config. */\n function getCurrentGitUser() {\n-  const userName = exec(`git config user.name`);\n-  const userEmail = exec(`git config user.email`);\n-\n+  const git = GitClient.get();\n+  let userName = git.runGraceful(['config', 'user.name']).stdout.trim() || 'Unknown User';\n+  let userEmail = git.runGraceful(['config', 'user.email']).stdout.trim() || 'unknown_email';\n   return `${userName} <${userEmail}>`;\n }"
        },
        {
            "sha": "901b3b9d36685ddc5253d0fca79374aabcf259e0",
            "filename": "dev-infra/tmpl-package.json",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Ftmpl-package.json",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Ftmpl-package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftmpl-package.json?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -33,7 +33,6 @@\n     \"protractor\": \"<from-root>\",\n     \"selenium-webdriver\": \"<from-root>\",\n     \"semver\": \"<from-root>\",\n-    \"shelljs\": \"<from-root>\",\n     \"ts-node\": \"<from-root>\",\n     \"tslib\": \"<from-root>\",\n     \"typed-graphqlify\": \"<from-root>\","
        },
        {
            "sha": "cc51124606a881f8e26ddb6d54c4b35ed3e4083e",
            "filename": "dev-infra/utils/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2FBUILD.bazel?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -21,12 +21,10 @@ ts_library(\n         \"@npm//@types/inquirer\",\n         \"@npm//@types/node\",\n         \"@npm//@types/semver\",\n-        \"@npm//@types/shelljs\",\n         \"@npm//@types/yargs\",\n         \"@npm//chalk\",\n         \"@npm//inquirer\",\n         \"@npm//semver\",\n-        \"@npm//shelljs\",\n         \"@npm//tslib\",\n         \"@npm//typed-graphqlify\",\n         \"@npm//yargs\","
        },
        {
            "sha": "809b39baefc10367319ddea674c4e042d7efc83d",
            "filename": "dev-infra/utils/child-process.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2Fchild-process.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2Fchild-process.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fchild-process.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -10,6 +10,7 @@ import {spawn as _spawn, SpawnOptions as _SpawnOptions, spawnSync as _spawnSync,\n import {debug, error} from './console';\n \n \n+/** Interface describing the options for spawning a process synchronously. */\n export interface SpawnSyncOptions extends Omit<_SpawnSyncOptions, 'shell'|'stdio'> {\n   /** Whether to prevent exit codes being treated as failures. */\n   suppressErrorOnFailingExitCode?: boolean;\n@@ -58,7 +59,7 @@ export function spawnInteractive(\n  * output mode, stdout/stderr output is also printed to the console, or only on error.\n  *\n  * @returns a Promise resolving with captured stdout and stderr on success. The promise\n- *   rejects on command failure\n+ *   rejects on command failure.\n  */\n export function spawn(\n     command: string, args: string[], options: SpawnOptions = {}): Promise<SpawnResult> {\n@@ -115,12 +116,12 @@ export function spawn(\n }\n \n /**\n- * Spawns a given command with the specified arguments inside a shell syncronously.\n+ * Spawns a given command with the specified arguments inside a shell synchronously.\n  *\n  * @returns The command's stdout and stderr.\n  */\n export function spawnSync(\n-    command: string, args: string[], options: SpawnOptions = {}): SpawnResult {\n+    command: string, args: string[], options: SpawnSyncOptions = {}): SpawnResult {\n   const commandText = `${command} ${args.join(' ')}`;\n   debug(`Executing command: ${commandText}`);\n \n@@ -137,9 +138,14 @@ export function spawnSync(\n   throw new Error(stderr);\n }\n \n-\n-\n-/** Convert the provided exitCode and signal to a single status code. */\n+/**\n+ * Convert the provided exitCode and signal to a single status code.\n+ *\n+ * During `exit` node provides either a `code` or `signal`, one of which is guaranteed to be\n+ * non-null.\n+ *\n+ * For more details see: https://nodejs.org/api/child_process.html#child_process_event_exit\n+ */\n function statusFromExitCodeAndSignal(exitCode: number|null, signal: NodeJS.Signals|null) {\n-  return exitCode !== null ? exitCode : signal !== null ? signal : -1;\n+  return exitCode ?? signal ?? -1;\n }"
        },
        {
            "sha": "e66f85ed1d9f65dd581969e1b855eed7bb232f13",
            "filename": "dev-infra/utils/git/git-client.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/992dc93ea37d1079c996a370777e776ff2251b49/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgit-client.ts?ref=992dc93ea37d1079c996a370777e776ff2251b49",
            "patch": "@@ -23,6 +23,10 @@ export class GitCommandError extends Error {\n     // accidentally leak the Github token that might be used in a command,\n     // we sanitize the command that will be part of the error message.\n     super(`Command failed: git ${client.sanitizeConsoleOutput(args.join(' '))}`);\n+\n+    // Set the prototype explicitly because in ES5, the prototype is accidentally lost due to\n+    // a limitation in down-leveling.\n+    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n     Object.setPrototypeOf(this, GitCommandError.prototype);\n   }\n }"
        },
        {
            "sha": "0040b4135bce5a96d2a36b72727b8ecc7933bb45",
            "filename": "dev-infra/utils/shelljs.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/d3b0d1e3fb410372a8c69dff1b945f14873511b9/dev-infra%2Futils%2Fshelljs.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3b0d1e3fb410372a8c69dff1b945f14873511b9/dev-infra%2Futils%2Fshelljs.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fshelljs.ts?ref=d3b0d1e3fb410372a8c69dff1b945f14873511b9",
            "patch": "@@ -1,17 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {exec as _exec, ExecOptions, ShellString} from 'shelljs';\n-\n-/**\n- * Runs an given command as child process. By default, child process\n- * output will not be printed.\n- */\n-export function exec(cmd: string, opts?: Omit<ExecOptions, 'async'>): ShellString {\n-  return _exec(cmd, {silent: true, ...opts, async: false});\n-}"
        }
    ],
    "stats": {
        "total": 436,
        "additions": 208,
        "deletions": 228
    }
}