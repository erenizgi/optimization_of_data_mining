{
    "author": "sonukapoor",
    "message": "fix(docs-infra): fix the backoff example (#38896)\n\nPreviously, the `backoff()` example did not work as intended. More\nspecifically, the `range(1, maxTries)` observable would complete\nimmediately after emitting the `maxTries`th value, causing the overall\nobservable to also complete. As a result, it would only make\n`maxTries - 1` attempts to recover from an error. More importantly, the\nouter observable would complete successfully instead of erroring.\n\nThis commit fixes the `backoff()` operator by ensuring it makes exactly\n`maxTries` attempts to recover and it propagates the actual error to the\nouter observable.\n\nThe test for this change is added in the next commit.\n\nPR Close #38896",
    "sha": "37297cfed74c5feddd3f8d3a3a19f7a4688632d8",
    "files": [
        {
            "sha": "677ed0b2a4844cb512569600a007815f13119534",
            "filename": "aio/content/examples/practical-observable-usage/src/backoff.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 11,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/37297cfed74c5feddd3f8d3a3a19f7a4688632d8/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts",
            "raw_url": "https://github.com/angular/angular/raw/37297cfed74c5feddd3f8d3a3a19f7a4688632d8/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts?ref=37297cfed74c5feddd3f8d3a3a19f7a4688632d8",
            "patch": "@@ -1,17 +1,18 @@\n // TODO: Add unit tests for this file.\n-import { pipe, range, timer, zip } from 'rxjs';\n+import { of, pipe, range, throwError, timer, zip } from 'rxjs';\n import { ajax } from 'rxjs/ajax';\n-import { retryWhen, map, mergeMap } from 'rxjs/operators';\n+import { map, mergeMap, retryWhen } from 'rxjs/operators';\n \n-function backoff(maxTries, ms) {\n- return pipe(\n-   retryWhen(attempts => zip(range(1, maxTries), attempts)\n-     .pipe(\n-       map(([i]) => i * i),\n-       mergeMap(i =>  timer(i * ms))\n-     )\n-   )\n- );\n+function backoff(maxTries, delay) {\n+  return pipe(\n+    retryWhen(attempts =>\n+      zip(range(1, maxTries + 1), attempts).pipe(\n+        mergeMap(([i, err]) => (i > maxTries) ? throwError(err) : of(i)),\n+        map(i => i * i),\n+        mergeMap(v => timer(v * delay)),\n+      ),\n+    ),\n+  );\n }\n \n ajax('/api/endpoint')"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 12,
        "deletions": 11
    }
}