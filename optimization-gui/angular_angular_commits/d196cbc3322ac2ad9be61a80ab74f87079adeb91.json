{
    "author": "JoostK",
    "message": "refactor(compiler): remove class related output AST types (#44411)\n\nThe Ivy compiler no longer generates classes so this commit removes\nthe supporting output nodes.\n\nPR Close #44411",
    "sha": "d196cbc3322ac2ad9be61a80ab74f87079adeb91",
    "files": [
        {
            "sha": "bd7a3b105524b0724791eacb64f0e71a2697e7fc",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -92,10 +92,6 @@ export class ExpressionTranslatorVisitor<TStatement, TExpression> implements o.E\n         stmt.leadingComments);\n   }\n \n-  visitDeclareClassStmt(_stmt: o.ClassStmt, _context: Context): never {\n-    throw new Error('Method not implemented.');\n-  }\n-\n   visitIfStmt(stmt: o.IfStmt, context: Context): TStatement {\n     return this.attachComments(\n         this.factory.createIfStatement("
        },
        {
            "sha": "6a920aa191ea95fb320c9d4f1b25ae4ef065ce3b",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -53,7 +53,7 @@ export * from './ml_parser/tags';\n export {ParseTreeResult, TreeError} from './ml_parser/parser';\n export {LexerRange} from './ml_parser/lexer';\n export * from './ml_parser/xml_parser';\n-export {ArrayType, DYNAMIC_TYPE, BinaryOperator, BinaryOperatorExpr, BuiltinType, BuiltinTypeName, ClassField, ClassMethod, ClassStmt, CommaExpr, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, Expression, ExpressionStatement, ExpressionType, ExpressionVisitor, ExternalExpr, ExternalReference, literalMap, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, MapType, NotExpr, NONE_TYPE, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, StatementVisitor, TaggedTemplateExpr, TemplateLiteral, TemplateLiteralElement, Type, TypeVisitor, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr, StmtModifier, Statement, STRING_TYPE, TypeofExpr, collectExternalReferences, jsDocComment, leadingComment, LeadingComment, JSDocComment, UnaryOperator, UnaryOperatorExpr, LocalizedString} from './output/output_ast';\n+export {ArrayType, DYNAMIC_TYPE, BinaryOperator, BinaryOperatorExpr, BuiltinType, BuiltinTypeName, CommaExpr, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, Expression, ExpressionStatement, ExpressionType, ExpressionVisitor, ExternalExpr, ExternalReference, literalMap, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, MapType, NotExpr, NONE_TYPE, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, StatementVisitor, TaggedTemplateExpr, TemplateLiteral, TemplateLiteralElement, Type, TypeVisitor, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr, StmtModifier, Statement, STRING_TYPE, TypeofExpr, collectExternalReferences, jsDocComment, leadingComment, LeadingComment, JSDocComment, UnaryOperator, UnaryOperatorExpr, LocalizedString} from './output/output_ast';\n export {EmitterVisitorContext} from './output/abstract_emitter';\n export {JitEvaluator} from './output/output_jit';\n export * from './parse_util';"
        },
        {
            "sha": "6443ffbae16495868f072636fc17c103101ce5b5",
            "filename": "packages/compiler/src/output/abstract_emitter.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -28,7 +28,6 @@ export class EmitterVisitorContext {\n   }\n \n   private _lines: _EmittedLine[];\n-  private _classes: o.ClassStmt[] = [];\n \n   constructor(private _indent: number) {\n     this._lines = [new _EmittedLine(_indent)];\n@@ -85,18 +84,6 @@ export class EmitterVisitorContext {\n     }\n   }\n \n-  pushClass(clazz: o.ClassStmt) {\n-    this._classes.push(clazz);\n-  }\n-\n-  popClass(): o.ClassStmt {\n-    return this._classes.pop()!;\n-  }\n-\n-  get currentClass(): o.ClassStmt|null {\n-    return this._classes.length > 0 ? this._classes[this._classes.length - 1] : null;\n-  }\n-\n   toSource(): string {\n     return this.sourceLines\n         .map(l => l.parts.length > 0 ? _createIndent(l.indent) + l.parts.join('') : '')\n@@ -226,8 +213,6 @@ export abstract class AbstractEmitterVisitor implements o.StatementVisitor, o.Ex\n     return null;\n   }\n \n-  abstract visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any;\n-\n   visitIfStmt(stmt: o.IfStmt, ctx: EmitterVisitorContext): any {\n     this.printLeadingComments(stmt, ctx);\n     ctx.print(stmt, `if (`);"
        },
        {
            "sha": "49bf50eda2870d66b3aaab9e58d29b6777f28050",
            "filename": "packages/compiler/src/output/abstract_js_emitter.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 57,
            "changes": 57,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -29,63 +29,6 @@ export abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n   constructor() {\n     super(false);\n   }\n-  override visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n-    ctx.pushClass(stmt);\n-    this._visitClassConstructor(stmt, ctx);\n-\n-    if (stmt.parent != null) {\n-      ctx.print(stmt, `${stmt.name}.prototype = Object.create(`);\n-      stmt.parent.visitExpression(this, ctx);\n-      ctx.println(stmt, `.prototype);`);\n-    }\n-    stmt.getters.forEach((getter) => this._visitClassGetter(stmt, getter, ctx));\n-    stmt.methods.forEach((method) => this._visitClassMethod(stmt, method, ctx));\n-    ctx.popClass();\n-    return null;\n-  }\n-\n-  private _visitClassConstructor(stmt: o.ClassStmt, ctx: EmitterVisitorContext) {\n-    ctx.print(stmt, `function ${stmt.name}(`);\n-    if (stmt.constructorMethod != null) {\n-      this._visitParams(stmt.constructorMethod.params, ctx);\n-    }\n-    ctx.println(stmt, `) {`);\n-    ctx.incIndent();\n-    if (stmt.constructorMethod != null) {\n-      if (stmt.constructorMethod.body.length > 0) {\n-        ctx.println(stmt, `var self = this;`);\n-        this.visitAllStatements(stmt.constructorMethod.body, ctx);\n-      }\n-    }\n-    ctx.decIndent();\n-    ctx.println(stmt, `}`);\n-  }\n-\n-  private _visitClassGetter(stmt: o.ClassStmt, getter: o.ClassGetter, ctx: EmitterVisitorContext) {\n-    ctx.println(\n-        stmt,\n-        `Object.defineProperty(${stmt.name}.prototype, '${getter.name}', { get: function() {`);\n-    ctx.incIndent();\n-    if (getter.body.length > 0) {\n-      ctx.println(stmt, `var self = this;`);\n-      this.visitAllStatements(getter.body, ctx);\n-    }\n-    ctx.decIndent();\n-    ctx.println(stmt, `}});`);\n-  }\n-\n-  private _visitClassMethod(stmt: o.ClassStmt, method: o.ClassMethod, ctx: EmitterVisitorContext) {\n-    ctx.print(stmt, `${stmt.name}.prototype.${method.name} = function(`);\n-    this._visitParams(method.params, ctx);\n-    ctx.println(stmt, `) {`);\n-    ctx.incIndent();\n-    if (method.body.length > 0) {\n-      ctx.println(stmt, `var self = this;`);\n-      this.visitAllStatements(method.body, ctx);\n-    }\n-    ctx.decIndent();\n-    ctx.println(stmt, `};`);\n-  }\n \n   override visitWrappedNodeExpr(ast: o.WrappedNodeExpr<any>, ctx: EmitterVisitorContext): any {\n     throw new Error('Cannot emit a WrappedNodeExpr in Javascript.');"
        },
        {
            "sha": "543ac9dd9d104b5c02acf71d6ba3b2a200758713",
            "filename": "packages/compiler/src/output/output_ast.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 99,
            "changes": 99,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -1058,70 +1058,6 @@ export class ReturnStatement extends Statement {\n   }\n }\n \n-export class AbstractClassPart {\n-  constructor(public type: Type|null = null, public modifiers: StmtModifier[] = []) {}\n-  hasModifier(modifier: StmtModifier): boolean {\n-    return this.modifiers.indexOf(modifier) !== -1;\n-  }\n-}\n-\n-export class ClassField extends AbstractClassPart {\n-  constructor(\n-      public name: string, type?: Type|null, modifiers?: StmtModifier[],\n-      public initializer?: Expression) {\n-    super(type, modifiers);\n-  }\n-  isEquivalent(f: ClassField) {\n-    return this.name === f.name;\n-  }\n-}\n-\n-\n-export class ClassMethod extends AbstractClassPart {\n-  constructor(\n-      public name: string|null, public params: FnParam[], public body: Statement[],\n-      type?: Type|null, modifiers?: StmtModifier[]) {\n-    super(type, modifiers);\n-  }\n-  isEquivalent(m: ClassMethod) {\n-    return this.name === m.name && areAllEquivalent(this.body, m.body);\n-  }\n-}\n-\n-\n-export class ClassGetter extends AbstractClassPart {\n-  constructor(\n-      public name: string, public body: Statement[], type?: Type|null, modifiers?: StmtModifier[]) {\n-    super(type, modifiers);\n-  }\n-  isEquivalent(m: ClassGetter) {\n-    return this.name === m.name && areAllEquivalent(this.body, m.body);\n-  }\n-}\n-\n-\n-export class ClassStmt extends Statement {\n-  constructor(\n-      public name: string, public parent: Expression|null, public fields: ClassField[],\n-      public getters: ClassGetter[], public constructorMethod: ClassMethod,\n-      public methods: ClassMethod[], modifiers?: StmtModifier[], sourceSpan?: ParseSourceSpan|null,\n-      leadingComments?: LeadingComment[]) {\n-    super(modifiers, sourceSpan, leadingComments);\n-  }\n-  override isEquivalent(stmt: Statement): boolean {\n-    return stmt instanceof ClassStmt && this.name === stmt.name &&\n-        nullSafeIsEquivalent(this.parent, stmt.parent) &&\n-        areAllEquivalent(this.fields, stmt.fields) &&\n-        areAllEquivalent(this.getters, stmt.getters) &&\n-        this.constructorMethod.isEquivalent(stmt.constructorMethod) &&\n-        areAllEquivalent(this.methods, stmt.methods);\n-  }\n-  override visitStatement(visitor: StatementVisitor, context: any): any {\n-    return visitor.visitDeclareClassStmt(this, context);\n-  }\n-}\n-\n-\n export class IfStmt extends Statement {\n   constructor(\n       public condition: Expression, public trueCase: Statement[],\n@@ -1144,7 +1080,6 @@ export interface StatementVisitor {\n   visitDeclareFunctionStmt(stmt: DeclareFunctionStmt, context: any): any;\n   visitExpressionStmt(stmt: ExpressionStatement, context: any): any;\n   visitReturnStmt(stmt: ReturnStatement, context: any): any;\n-  visitDeclareClassStmt(stmt: ClassStmt, context: any): any;\n   visitIfStmt(stmt: IfStmt, context: any): any;\n }\n \n@@ -1339,27 +1274,6 @@ export class AstTransformer implements StatementVisitor, ExpressionVisitor {\n         context);\n   }\n \n-  visitDeclareClassStmt(stmt: ClassStmt, context: any): any {\n-    const parent = stmt.parent!.visitExpression(this, context);\n-    const getters = stmt.getters.map(\n-        getter => new ClassGetter(\n-            getter.name, this.visitAllStatements(getter.body, context), getter.type,\n-            getter.modifiers));\n-    const ctorMethod = stmt.constructorMethod &&\n-        new ClassMethod(stmt.constructorMethod.name, stmt.constructorMethod.params,\n-                        this.visitAllStatements(stmt.constructorMethod.body, context),\n-                        stmt.constructorMethod.type, stmt.constructorMethod.modifiers);\n-    const methods = stmt.methods.map(\n-        method => new ClassMethod(\n-            method.name, method.params, this.visitAllStatements(method.body, context), method.type,\n-            method.modifiers));\n-    return this.transformStmt(\n-        new ClassStmt(\n-            stmt.name, parent, stmt.fields, getters, ctorMethod, methods, stmt.modifiers,\n-            stmt.sourceSpan),\n-        context);\n-  }\n-\n   visitIfStmt(stmt: IfStmt, context: any): any {\n     return this.transformStmt(\n         new IfStmt(\n@@ -1525,15 +1439,6 @@ export class RecursiveAstVisitor implements StatementVisitor, ExpressionVisitor\n     stmt.value.visitExpression(this, context);\n     return stmt;\n   }\n-  visitDeclareClassStmt(stmt: ClassStmt, context: any): any {\n-    stmt.parent!.visitExpression(this, context);\n-    stmt.getters.forEach(getter => this.visitAllStatements(getter.body, context));\n-    if (stmt.constructorMethod) {\n-      this.visitAllStatements(stmt.constructorMethod.body, context);\n-    }\n-    stmt.methods.forEach(method => this.visitAllStatements(method.body, context));\n-    return stmt;\n-  }\n   visitIfStmt(stmt: IfStmt, context: any): any {\n     stmt.condition.visitExpression(this, context);\n     this.visitAllStatements(stmt.trueCase, context);\n@@ -1557,10 +1462,6 @@ class _ReadVarVisitor extends RecursiveAstVisitor {\n     // Don't descend into nested functions\n     return stmt;\n   }\n-  override visitDeclareClassStmt(stmt: ClassStmt, context: any): any {\n-    // Don't descend into nested classes\n-    return stmt;\n-  }\n   override visitReadVarExpr(ast: ReadVarExpr, context: any): any {\n     if (ast.name) {\n       this.varNames.add(ast.name);"
        },
        {
            "sha": "862d4ef915fa659bfbce79ce099acf4df7d04016",
            "filename": "packages/compiler/src/output/output_jit.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts",
            "raw_url": "https://github.com/angular/angular/raw/d196cbc3322ac2ad9be61a80ab74f87079adeb91/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts?ref=d196cbc3322ac2ad9be61a80ab74f87079adeb91",
            "patch": "@@ -146,13 +146,6 @@ export class JitEmitterVisitor extends AbstractJsEmitterVisitor {\n     return super.visitDeclareFunctionStmt(stmt, ctx);\n   }\n \n-  override visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n-    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n-      this._evalExportedVars.push(stmt.name);\n-    }\n-    return super.visitDeclareClassStmt(stmt, ctx);\n-  }\n-\n   private _emitReferenceToExternal(ast: o.Expression, value: any, ctx: EmitterVisitorContext):\n       void {\n     let id = this._evalArgValues.indexOf(value);"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 1,
        "deletions": 183
    }
}