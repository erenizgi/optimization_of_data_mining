{
    "author": "crisbeto",
    "message": "feat(compiler): support nullish coalescing in templates (#41437)\n\nAdds support for nullish coalescing expressions inside of Angular templates (e.g. `{{ a ?? b ?? c}}`).\n\nFixes #36528.\n\nPR Close #41437",
    "sha": "ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
    "files": [
        {
            "sha": "50c4c56e25fdadbc08ef078a24ae3b88db7ee9a1",
            "filename": "packages/compiler-cli/linker/babel/src/ast/babel_ast_factory.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fast%2Fbabel_ast_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fast%2Fbabel_ast_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fast%2Fbabel_ast_factory.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -39,6 +39,7 @@ export class BabelAstFactory implements AstFactory<t.Statement, t.Expression> {\n     switch (operator) {\n       case '&&':\n       case '||':\n+      case '??':\n         return t.logicalExpression(operator, leftOperand, rightOperand);\n       default:\n         return t.binaryExpression(operator, leftOperand, rightOperand);"
        },
        {
            "sha": "c6413da7a7fe163818a71b0c3ee95dfc619f8c5a",
            "filename": "packages/compiler-cli/src/metadata/schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fmetadata%2Fschema.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fmetadata%2Fschema.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fmetadata%2Fschema.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -145,7 +145,7 @@ export function isMetadataSymbolicExpression(value: any): value is MetadataSymbo\n export interface MetadataSymbolicBinaryExpression {\n   __symbolic: 'binary';\n   operator: '&&'|'||'|'|'|'^'|'&'|'=='|'!='|'==='|'!=='|'<'|'>'|'<='|'>='|'instanceof'|'in'|'as'|\n-      '<<'|'>>'|'>>>'|'+'|'-'|'*'|'/'|'%'|'**';\n+      '<<'|'>>'|'>>>'|'+'|'-'|'*'|'/'|'%'|'**'|'??';\n   left: MetadataValue;\n   right: MetadataValue;\n }"
        },
        {
            "sha": "cc430f1f5f812f8f71fcebb04256f0bf70703f9c",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/api/ast_factory.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fast_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fast_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fast_factory.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -245,7 +245,7 @@ export type UnaryOperator = '+'|'-'|'!';\n  * The binary operators supported by the `AstFactory`.\n  */\n export type BinaryOperator =\n-    '&&'|'>'|'>='|'&'|'/'|'=='|'==='|'<'|'<='|'-'|'%'|'*'|'!='|'!=='|'||'|'+';\n+    '&&'|'>'|'>='|'&'|'/'|'=='|'==='|'<'|'<='|'-'|'%'|'*'|'!='|'!=='|'||'|'+'|'??';\n \n /**\n  * The original location of the start or end of a node created by the `AstFactory`."
        },
        {
            "sha": "1aea892ea326f021bd544a64b803dd4bce739b1f",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -34,6 +34,7 @@ const BINARY_OPERATORS = new Map<o.BinaryOperator, BinaryOperator>([\n   [o.BinaryOperator.NotIdentical, '!=='],\n   [o.BinaryOperator.Or, '||'],\n   [o.BinaryOperator.Plus, '+'],\n+  [o.BinaryOperator.NullishCoalesce, '??'],\n ]);\n \n export type RecordWrappedNodeExprFn<TExpression> = (expr: TExpression) => void;"
        },
        {
            "sha": "ebe0f3f0e3013e931f219daf4795467bbee2f679",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/typescript_ast_factory.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -47,6 +47,7 @@ const BINARY_OPERATORS: Record<BinaryOperator, ts.BinaryOperator> = {\n   '!==': ts.SyntaxKind.ExclamationEqualsEqualsToken,\n   '||': ts.SyntaxKind.BarBarToken,\n   '+': ts.SyntaxKind.PlusToken,\n+  '??': ts.SyntaxKind.QuestionQuestionToken,\n };\n \n const VAR_TYPES: Record<VariableDeclarationType, ts.NodeFlags> = {"
        },
        {
            "sha": "61a5535fe0e9e0952746ac767e03facc830f7859",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -41,6 +41,7 @@ const BINARY_OPS = new Map<string, ts.BinaryOperator>([\n   ['&&', ts.SyntaxKind.AmpersandAmpersandToken],\n   ['&', ts.SyntaxKind.AmpersandToken],\n   ['|', ts.SyntaxKind.BarToken],\n+  ['??', ts.SyntaxKind.QuestionQuestionToken],\n ]);\n \n /**"
        },
        {
            "sha": "718d7916154737a61710b62ceaed2e3b2d79e044",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/diagnostics_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -399,6 +399,19 @@ runInEachFileSystem(() => {\n \n         expect(messages).toEqual([]);\n       });\n+\n+      it('does not produce diagnostic for fallback value using nullish coalescing', () => {\n+        const messages = diagnose(`<div>{{ greet(name ?? 'Frodo') }}</div>`, `\n+        export class TestComponent {\n+          name: string | null;\n+\n+          greet(name: string) {\n+            return 'hello ' + name;\n+          }\n+        }`);\n+\n+        expect(messages).toEqual([]);\n+      });\n     });\n \n     it('computes line and column offsets', () => {"
        },
        {
            "sha": "b15735bb9060eacb87e7288d85a76c32573a13a7",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -50,6 +50,13 @@ describe('type check blocks', () => {\n         .toContain('(((ctx).a) ? ((ctx).b) : ((((ctx).c) ? ((ctx).d) : (((ctx).e)))))');\n   });\n \n+  it('should handle nullish coalescing operator', () => {\n+    expect(tcb('{{ a ?? b }}')).toContain('((((ctx).a)) ?? (((ctx).b)))');\n+    expect(tcb('{{ a ?? b ?? c }}')).toContain('(((((ctx).a)) ?? (((ctx).b))) ?? (((ctx).c)))');\n+    expect(tcb('{{ (a ?? b) + (c ?? e) }}'))\n+        .toContain('(((((ctx).a)) ?? (((ctx).b))) + ((((ctx).c)) ?? (((ctx).e))))');\n+  });\n+\n   it('should handle quote expressions as any type', () => {\n     const TEMPLATE = `<span [quote]=\"sql:expression\"></span>`;\n     expect(tcb(TEMPLATE)).toContain('null as any');"
        },
        {
            "sha": "6f08aa37b7545927875371c0a7f8aa940d78a0e8",
            "filename": "packages/compiler-cli/src/transformers/node_emitter.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fnode_emitter.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -672,6 +672,9 @@ export class NodeEmitterVisitor implements StatementVisitor, ExpressionVisitor {\n       case BinaryOperator.Or:\n         binaryOperator = ts.SyntaxKind.BarBarToken;\n         break;\n+      case BinaryOperator.NullishCoalesce:\n+        binaryOperator = ts.SyntaxKind.QuestionQuestionToken;\n+        break;\n       case BinaryOperator.Plus:\n         binaryOperator = ts.SyntaxKind.PlusToken;\n         break;"
        },
        {
            "sha": "5398bb0fea533a214fa3ea5faaa6e0c4258506ba",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/GOLDEN_PARTIAL.js",
            "status": "added",
            "additions": 164,
            "deletions": 0,
            "changes": 164,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FGOLDEN_PARTIAL.js?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,164 @@\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_interpolation.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyApp {\n+    constructor() {\n+        this.firstName = null;\n+        this.lastName = null;\n+        this.lastNameFallback = 'Baggins';\n+    }\n+}\n+MyApp.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyApp, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+MyApp.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyApp, selector: \"my-app\", ngImport: i0, template: `\n+    <div>Hello, {{ firstName ?? 'Frodo' }}!</div>\n+    <span>Your last name is {{ lastName ?? lastNameFallback ?? 'unknown' }}</span>\n+  `, isInline: true });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyApp, [{\n+        type: Component,\n+        args: [{\n+                selector: 'my-app',\n+                template: `\n+    <div>Hello, {{ firstName ?? 'Frodo' }}!</div>\n+    <span>Your last name is {{ lastName ?? lastNameFallback ?? 'unknown' }}</span>\n+  `\n+            }]\n+    }], null, null); })();\n+export class MyModule {\n+}\n+MyModule.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+MyModule.ɵmod = i0.ɵɵngDeclareNgModule({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, declarations: [MyApp] });\n+MyModule.ɵinj = i0.ɵɵngDeclareInjector({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [MyApp] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_interpolation.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyApp {\n+    firstName: string | null;\n+    lastName: string | null;\n+    lastNameFallback: string;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyApp, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<MyApp, \"my-app\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<MyModule, [typeof MyApp], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n+}\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_property.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyApp {\n+    constructor() {\n+        this.firstName = null;\n+        this.lastName = null;\n+        this.lastNameFallback = 'Baggins';\n+    }\n+}\n+MyApp.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyApp, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+MyApp.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyApp, selector: \"my-app\", ngImport: i0, template: `\n+    <div [title]=\"'Hello, ' + (firstName ?? 'Frodo') + '!'\"></div>\n+    <span [title]=\"'Your last name is ' + lastName ?? lastNameFallback ?? 'unknown'\"></span>\n+  `, isInline: true });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyApp, [{\n+        type: Component,\n+        args: [{\n+                selector: 'my-app',\n+                template: `\n+    <div [title]=\"'Hello, ' + (firstName ?? 'Frodo') + '!'\"></div>\n+    <span [title]=\"'Your last name is ' + lastName ?? lastNameFallback ?? 'unknown'\"></span>\n+  `\n+            }]\n+    }], null, null); })();\n+export class MyModule {\n+}\n+MyModule.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+MyModule.ɵmod = i0.ɵɵngDeclareNgModule({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, declarations: [MyApp] });\n+MyModule.ɵinj = i0.ɵɵngDeclareInjector({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [MyApp] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_property.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyApp {\n+    firstName: string | null;\n+    lastName: string | null;\n+    lastNameFallback: string;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyApp, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<MyApp, \"my-app\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<MyModule, [typeof MyApp], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n+}\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_host.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyApp {\n+    constructor() {\n+        this.firstName = null;\n+        this.lastName = null;\n+        this.lastNameFallback = 'Baggins';\n+    }\n+    logLastName(name) {\n+        console.log(name);\n+    }\n+}\n+MyApp.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyApp, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+MyApp.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyApp, selector: \"my-app\", host: { listeners: { \"click\": \"logLastName(lastName ?? lastNameFallback ?? 'unknown')\" }, properties: { \"attr.first-name\": \"'Hello, ' + (firstName ?? 'Frodo') + '!'\" } }, ngImport: i0, template: ``, isInline: true });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyApp, [{\n+        type: Component,\n+        args: [{\n+                selector: 'my-app',\n+                host: {\n+                    '[attr.first-name]': `'Hello, ' + (firstName ?? 'Frodo') + '!'`,\n+                    '(click)': `logLastName(lastName ?? lastNameFallback ?? 'unknown')`\n+                },\n+                template: ``\n+            }]\n+    }], null, null); })();\n+export class MyModule {\n+}\n+MyModule.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+MyModule.ɵmod = i0.ɵɵngDeclareNgModule({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, declarations: [MyApp] });\n+MyModule.ɵinj = i0.ɵɵngDeclareInjector({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [MyApp] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: nullish_coalescing_host.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyApp {\n+    firstName: string | null;\n+    lastName: string | null;\n+    lastNameFallback: string;\n+    logLastName(name: string): void;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyApp, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<MyApp, \"my-app\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<MyModule, [typeof MyApp], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n+}\n+"
        },
        {
            "sha": "94a9e45c039d7ad42ba1d0f2180441d0c7375019",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/TEST_CASES.json",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2FTEST_CASES.json?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,56 @@\n+{\n+  \"$schema\": \"../../test_case_schema.json\",\n+  \"cases\": [\n+    {\n+      \"description\": \"should handle nullish coalescing inside interpolations\",\n+      \"inputFiles\": [\n+        \"nullish_coalescing_interpolation.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"files\": [\n+            {\n+              \"expected\": \"nullish_coalescing_interpolation_template.js\",\n+              \"generated\": \"nullish_coalescing_interpolation.js\"\n+            }\n+          ],\n+          \"failureMessage\": \"Incorrect template\"\n+        }\n+      ]\n+    },\n+    {\n+      \"description\": \"should handle nullish coalescing inside property bindings\",\n+      \"inputFiles\": [\n+        \"nullish_coalescing_property.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"files\": [\n+            {\n+              \"expected\": \"nullish_coalescing_property_template.js\",\n+              \"generated\": \"nullish_coalescing_property.js\"\n+            }\n+          ],\n+          \"failureMessage\": \"Incorrect template\"\n+        }\n+      ]\n+    },\n+    {\n+      \"description\": \"should handle nullish coalescing inside host bindings\",\n+      \"inputFiles\": [\n+        \"nullish_coalescing_host.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"files\": [\n+            {\n+              \"expected\": \"nullish_coalescing_host_bindings.js\",\n+              \"generated\": \"nullish_coalescing_host.js\"\n+            }\n+          ],\n+          \"failureMessage\": \"Incorrect host bindings\"\n+        }\n+      ]\n+    }\n+  ]\n+}"
        },
        {
            "sha": "c7401612bc335b6b1e3a303297f13979ef6ad2ec",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_host.ts",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,23 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  selector: 'my-app',\n+  host: {\n+    '[attr.first-name]': `'Hello, ' + (firstName ?? 'Frodo') + '!'`,\n+    '(click)': `logLastName(lastName ?? lastNameFallback ?? 'unknown')`\n+  },\n+  template: ``\n+})\n+export class MyApp {\n+  firstName: string|null = null;\n+  lastName: string|null = null;\n+  lastNameFallback = 'Baggins';\n+\n+  logLastName(name: string) {\n+    console.log(name);\n+  }\n+}\n+\n+@NgModule({declarations: [MyApp]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "ce0fbb747ef8532b693e9127624a5b1b518b16b7",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_host_bindings.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host_bindings.js",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host_bindings.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_host_bindings.js?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,13 @@\n+hostBindings: function MyApp_HostBindings(rf, ctx) {\n+  if (rf & 1) {\n+    i0.ɵɵlistener(\"click\", function MyApp_click_HostBindingHandler() {\n+      let tmp_b_0 = null;\n+      let tmp_b_1 = null;\n+      return ctx.logLastName((tmp_b_0 = (tmp_b_1 = ctx.lastName) !== null && tmp_b_1 !== undefined ? tmp_b_1 : ctx.lastNameFallback) !== null && tmp_b_0 !== undefined ? tmp_b_0 : \"unknown\");\n+    });\n+  }\n+  if (rf & 2) {\n+    let tmp_b_0 = null;\n+    i0.ɵɵattribute(\"first-name\", \"Hello, \" + ((tmp_b_0 = ctx.firstName) !== null && tmp_b_0 !== undefined ? tmp_b_0 : \"Frodo\") + \"!\");\n+  }\n+}"
        },
        {
            "sha": "1e0903b78a877a19be6ea996ce7e7422f24e5784",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_interpolation.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,18 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  selector: 'my-app',\n+  template: `\n+    <div>Hello, {{ firstName ?? 'Frodo' }}!</div>\n+    <span>Your last name is {{ lastName ?? lastNameFallback ?? 'unknown' }}</span>\n+  `\n+})\n+export class MyApp {\n+  firstName: string|null = null;\n+  lastName: string|null = null;\n+  lastNameFallback = 'Baggins';\n+}\n+\n+@NgModule({declarations: [MyApp]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "af887ed333a0332f450634788557b82a64db89fa",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_interpolation_template.js",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation_template.js",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation_template.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_interpolation_template.js?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,19 @@\n+template: function MyApp_Template(rf, ctx) {\n+  if (rf & 1) {\n+    i0.ɵɵelementStart(0, \"div\");\n+    i0.ɵɵtext(1);\n+    i0.ɵɵelementEnd();\n+    i0.ɵɵelementStart(2, \"span\");\n+    i0.ɵɵtext(3);\n+    i0.ɵɵelementEnd();\n+  }\n+  if (rf & 2) {\n+    let tmp_0_0 = null;\n+    let tmp_1_0 = null;\n+    let tmp_1_1 = null;\n+    i0.ɵɵadvance(1);\n+    i0.ɵɵtextInterpolate1(\"Hello, \", (tmp_0_0 = ctx.firstName) !== null && tmp_0_0 !== undefined ? tmp_0_0 : \"Frodo\", \"!\");\n+    i0.ɵɵadvance(2);\n+    i0.ɵɵtextInterpolate1(\"Your last name is \", (tmp_1_0 = (tmp_1_1 = ctx.lastName) !== null && tmp_1_1 !== undefined ? tmp_1_1 : ctx.lastNameFallback) !== null && tmp_1_0 !== undefined ? tmp_1_0 : \"unknown\", \"\");\n+  }\n+}"
        },
        {
            "sha": "76ed5869c2c6ded2379fadf4fbf1ce6350694fec",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_property.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,18 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  selector: 'my-app',\n+  template: `\n+    <div [title]=\"'Hello, ' + (firstName ?? 'Frodo') + '!'\"></div>\n+    <span [title]=\"'Your last name is ' + lastName ?? lastNameFallback ?? 'unknown'\"></span>\n+  `\n+})\n+export class MyApp {\n+  firstName: string|null = null;\n+  lastName: string|null = null;\n+  lastNameFallback = 'Baggins';\n+}\n+\n+@NgModule({declarations: [MyApp]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "297595f0042fa2f39d6aca9634f8565fa7cc8aef",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/nullish_coalescing/nullish_coalescing_property_template.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property_template.js",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property_template.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Fnullish_coalescing%2Fnullish_coalescing_property_template.js?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -0,0 +1,14 @@\n+template: function MyApp_Template(rf, ctx) {\n+  if (rf & 1) {\n+    i0.ɵɵelement(0, \"div\", 0);\n+    i0.ɵɵelement(1, \"span\", 0);\n+  }\n+  if (rf & 2) {\n+    let tmp_0_0 = null;\n+    let tmp_1_0 = null;\n+    let tmp_1_1 = null;\n+    i0.ɵɵproperty(\"title\", \"Hello, \" + ((tmp_0_0 = ctx.firstName) !== null && tmp_0_0 !== undefined ? tmp_0_0 : \"Frodo\") + \"!\");\n+    i0.ɵɵadvance(1);\n+    i0.ɵɵproperty(\"title\", (tmp_1_0 = (tmp_1_1 = \"Your last name is \" + ctx.lastName) !== null && tmp_1_1 !== undefined ? tmp_1_1 : ctx.lastNameFallback) !== null && tmp_1_0 !== undefined ? tmp_1_0 : \"unknown\");\n+  }\n+}"
        },
        {
            "sha": "563cf3b2243eb919a2747ac98a774d7731fecc23",
            "filename": "packages/compiler/src/aot/static_reflector.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Faot%2Fstatic_reflector.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -672,6 +672,8 @@ export class StaticReflector implements CompileReflector {\n                     return left / right;\n                   case '%':\n                     return left % right;\n+                  case '??':\n+                    return left ?? right;\n                 }\n                 return null;\n               case 'if':"
        },
        {
            "sha": "d139217b1e9c059347cc58b96586efe5bd0e7328",
            "filename": "packages/compiler/src/compiler_util/expression_converter.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -399,6 +399,8 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       case '>=':\n         op = o.BinaryOperator.BiggerEquals;\n         break;\n+      case '??':\n+        return this.convertNullishCoalesce(ast, mode);\n       default:\n         throw new Error(`Unsupported operation ${ast.operation}`);\n     }\n@@ -683,7 +685,7 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n \n     let guardedExpression = this._visit(leftMostSafe.receiver, _Mode.Expression);\n     let temporary: o.ReadVarExpr = undefined!;\n-    if (this.needsTemporary(leftMostSafe.receiver)) {\n+    if (this.needsTemporaryInSafeAccess(leftMostSafe.receiver)) {\n       // If the expression has method calls or pipes then we need to save the result into a\n       // temporary variable to avoid calling stateful or impure code more than once.\n       temporary = this.allocateTemporary();\n@@ -728,6 +730,26 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n     return convertToStatementIfNeeded(mode, condition.conditional(o.literal(null), access));\n   }\n \n+  private convertNullishCoalesce(ast: cdAst.Binary, mode: _Mode): any {\n+    // Allocate the temporary variable before visiting the LHS and RHS, because they\n+    // may allocate temporary variables too and we don't want them to be reused.\n+    const temporary = this.allocateTemporary();\n+    const left: o.Expression = this._visit(ast.left, _Mode.Expression);\n+    const right: o.Expression = this._visit(ast.right, _Mode.Expression);\n+    this.releaseTemporary(temporary);\n+\n+    // Generate the following expression. It is identical to how TS\n+    // transpiles binary expressions with a nullish coalescing operator.\n+    // let temp;\n+    // (temp = a) !== null && temp !== undefined ? temp : b;\n+    return convertToStatementIfNeeded(\n+        mode,\n+        temporary.set(left)\n+            .notIdentical(o.NULL_EXPR)\n+            .and(temporary.notIdentical(o.literal(undefined)))\n+            .conditional(temporary, right));\n+  }\n+\n   // Given an expression of the form a?.b.c?.d.e then the left most safe node is\n   // the (a?.b). The . and ?. are left associative thus can be rewritten as:\n   // ((((a?.c).b).c)?.d).e. This returns the most deeply nested safe read or\n@@ -812,7 +834,7 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n   // Returns true of the AST includes a method or a pipe indicating that, if the\n   // expression is used as the target of a safe property or method access then\n   // the expression should be stored into a temporary variable.\n-  private needsTemporary(ast: cdAst.AST): boolean {\n+  private needsTemporaryInSafeAccess(ast: cdAst.AST): boolean {\n     const visit = (visitor: cdAst.AstVisitor, ast: cdAst.AST): boolean => {\n       return ast && (this._nodeMap.get(ast) || ast).visit(visitor);\n     };"
        },
        {
            "sha": "7346dd8609fb4492fb1e5f60e492970f2ec83fbe",
            "filename": "packages/compiler/src/expression_parser/lexer.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Flexer.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Flexer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Flexer.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -212,7 +212,7 @@ class _Scanner {\n       case chars.$CARET:\n         return this.scanOperator(start, String.fromCharCode(peek));\n       case chars.$QUESTION:\n-        return this.scanComplexOperator(start, '?', chars.$PERIOD, '.');\n+        return this.scanQuestion(start);\n       case chars.$LT:\n       case chars.$GT:\n         return this.scanComplexOperator(start, String.fromCharCode(peek), chars.$EQ, '=');\n@@ -348,6 +348,17 @@ class _Scanner {\n     return newStringToken(start, this.index, buffer + last);\n   }\n \n+  scanQuestion(start: number): Token {\n+    this.advance();\n+    let str: string = '?';\n+    // Either `a ?? b` or 'a?.b'.\n+    if (this.peek === chars.$QUESTION || this.peek === chars.$PERIOD) {\n+      str += this.peek === chars.$PERIOD ? '.' : '?';\n+      this.advance();\n+    }\n+    return newOperatorToken(start, this.index, str);\n+  }\n+\n   error(message: string, offset: number): Token {\n     const position: number = this.index + offset;\n     return newErrorToken("
        },
        {
            "sha": "4e4c2acaa89e976e25e05eeea918c07f4f10bb26",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -669,14 +669,25 @@ export class _ParseAST {\n   parseLogicalAnd(): AST {\n     // '&&'\n     const start = this.inputIndex;\n-    let result = this.parseEquality();\n+    let result = this.parseNullishCoalescing();\n     while (this.consumeOptionalOperator('&&')) {\n-      const right = this.parseEquality();\n+      const right = this.parseNullishCoalescing();\n       result = new Binary(this.span(start), this.sourceSpan(start), '&&', result, right);\n     }\n     return result;\n   }\n \n+  parseNullishCoalescing(): AST {\n+    // '??'\n+    const start = this.inputIndex;\n+    let result = this.parseEquality();\n+    while (this.consumeOptionalOperator('??')) {\n+      const right = this.parseEquality();\n+      result = new Binary(this.span(start), this.sourceSpan(start), '??', result, right);\n+    }\n+    return result;\n+  }\n+\n   parseEquality(): AST {\n     // '==','!=','===','!=='\n     const start = this.inputIndex;"
        },
        {
            "sha": "727c276c73b6cc5489571fd55eae6f08a1916496",
            "filename": "packages/compiler/src/output/abstract_emitter.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -510,6 +510,9 @@ export abstract class AbstractEmitterVisitor implements o.StatementVisitor, o.Ex\n       case o.BinaryOperator.BiggerEquals:\n         opStr = '>=';\n         break;\n+      case o.BinaryOperator.NullishCoalesce:\n+        opStr = '??';\n+        break;\n       default:\n         throw new Error(`Unknown operator ${ast.operator}`);\n     }"
        },
        {
            "sha": "4faa216c8f02abc78d577a80d3ac24138486b81e",
            "filename": "packages/compiler/src/output/output_ast.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -115,7 +115,8 @@ export enum BinaryOperator {\n   Lower,\n   LowerEquals,\n   Bigger,\n-  BiggerEquals\n+  BiggerEquals,\n+  NullishCoalesce,\n }\n \n export function nullSafeIsEquivalent<T extends {isEquivalent(other: T): boolean}>(\n@@ -254,6 +255,9 @@ export abstract class Expression {\n   cast(type: Type, sourceSpan?: ParseSourceSpan|null): Expression {\n     return new CastExpr(this, type, sourceSpan);\n   }\n+  nullishCoalesce(rhs: Expression, sourceSpan?: ParseSourceSpan|null): BinaryOperatorExpr {\n+    return new BinaryOperatorExpr(BinaryOperator.NullishCoalesce, this, rhs, null, sourceSpan);\n+  }\n \n   toStmt(): Statement {\n     return new ExpressionStatement(this, null);"
        },
        {
            "sha": "cfcbc43c91c47c96cc11d0500a2081fe1c672644",
            "filename": "packages/compiler/src/output/output_interpreter.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_interpreter.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -332,6 +332,8 @@ class StatementInterpreter implements o.StatementVisitor, o.ExpressionVisitor {\n         return lhs() > rhs();\n       case o.BinaryOperator.BiggerEquals:\n         return lhs() >= rhs();\n+      case o.BinaryOperator.NullishCoalesce:\n+        return lhs() ?? rhs();\n       default:\n         throw new Error(`Unknown operator ${ast.operator}`);\n     }"
        },
        {
            "sha": "664529f9ef13c38007c35db3d1e73bfa769811df",
            "filename": "packages/compiler/test/expression_parser/lexer_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Flexer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Flexer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Flexer_spec.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -255,6 +255,10 @@ function expectErrorToken(token: Token, index: any, end: number, message: string\n       it('should tokenize ?. as operator', () => {\n         expectOperatorToken(lex('?.')[0], 0, 2, '?.');\n       });\n+\n+      it('should tokenize ?? as operator', () => {\n+        expectOperatorToken(lex('??')[0], 0, 2, '??');\n+      });\n     });\n   });\n }"
        },
        {
            "sha": "f266911a2bc92ed843a76b7f49f339c2c5340c8e",
            "filename": "packages/compiler/test/expression_parser/parser_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -81,6 +81,8 @@ describe('parser', () => {\n     it('should parse expressions', () => {\n       checkAction('true && true');\n       checkAction('true || false');\n+      checkAction('null ?? 0');\n+      checkAction('null ?? undefined ?? 0');\n     });\n \n     it('should parse grouped expressions', () => {"
        },
        {
            "sha": "8d45e0541c1dbbcd66cb5aeee2e590da0e3d502c",
            "filename": "packages/core/test/acceptance/integration_spec.ts",
            "status": "modified",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -1929,6 +1929,67 @@ describe('acceptance integration tests', () => {\n     expect(() => fixture.detectChanges()).toThrowError('this error is expected');\n   });\n \n+  it('should handle nullish coalescing inside templates', () => {\n+    @Component({\n+      template: `\n+        <span [title]=\"'Your last name is ' + (lastName ?? lastNameFallback ?? 'unknown')\">\n+          Hello, {{ firstName ?? 'Frodo' }}!\n+          You are a Balrog: {{ falsyValue ?? true }}\n+        </span>\n+      `\n+    })\n+    class App {\n+      firstName: string|null = null;\n+      lastName: string|null = null;\n+      lastNameFallback = 'Baggins';\n+      falsyValue = false;\n+    }\n+\n+    TestBed.configureTestingModule({declarations: [App]});\n+    const fixture = TestBed.createComponent(App);\n+    fixture.detectChanges();\n+    const content = fixture.nativeElement.innerHTML;\n+\n+    expect(content).toContain('Hello, Frodo!');\n+    expect(content).toContain('You are a Balrog: false');\n+    expect(content).toContain(`<span title=\"Your last name is Baggins\">`);\n+  });\n+\n+  it('should handle nullish coalescing inside host bindings', () => {\n+    const logs: string[] = [];\n+\n+    @Directive({\n+      selector: '[some-dir]',\n+      host: {\n+        '[attr.first-name]': `'Hello, ' + (firstName ?? 'Frodo') + '!'`,\n+        '(click)': `logLastName(lastName ?? lastNameFallback ?? 'unknown')`\n+      }\n+    })\n+    class Dir {\n+      firstName: string|null = null;\n+      lastName: string|null = null;\n+      lastNameFallback = 'Baggins';\n+\n+      logLastName(name: string) {\n+        logs.push(name);\n+      }\n+    }\n+\n+    @Component({template: `<button some-dir>Click me</button>`})\n+    class App {\n+    }\n+\n+    TestBed.configureTestingModule({declarations: [App, Dir]});\n+    const fixture = TestBed.createComponent(App);\n+    fixture.detectChanges();\n+    const button = fixture.nativeElement.querySelector('button');\n+    button.click();\n+    fixture.detectChanges();\n+\n+    expect(button.getAttribute('first-name')).toBe('Hello, Frodo!');\n+    expect(logs).toEqual(['Baggins']);\n+  });\n+\n   describe('tView.firstUpdatePass', () => {\n     function isFirstUpdatePass() {\n       const lView = getLView();"
        }
    ],
    "stats": {
        "total": 490,
        "additions": 482,
        "deletions": 8
    }
}