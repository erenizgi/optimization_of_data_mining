{
    "author": "josephperrott",
    "message": "fix(dev-infra): use template strings for release note templates (#42224)\n\nUse template strings for release note templates rather than loading `ejs` files at runtime.\n\nPR Close #42224",
    "sha": "4ac55ca676769a54a76c5881d40109b556f497b7",
    "files": [
        {
            "sha": "b3ca5366348df2a5f623678205d0dc1c7b4fee2b",
            "filename": "dev-infra/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2FBUILD.bazel?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -44,7 +44,6 @@ pkg_npm(\n         \"index.bzl\",\n         \"//dev-infra/bazel:files\",\n         \"//dev-infra/benchmark:files\",\n-        \"//dev-infra/release/publish/release-notes/templates\",\n     ],\n     substitutions = {\n         # angular/angular should not consume it's own packages, so we use"
        },
        {
            "sha": "ad96619fc75aebe48ece4a9dccc2734b9c4a795e",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 176,
            "deletions": 2,
            "changes": 178,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -5857,6 +5857,180 @@ function buildDateStamp(date = new Date()) {\n     return [year, month, day].join('-');\n }\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+var changelogTemplate = `\n+<a name=\"<%- version %>\"></a>\n+# <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n+\n+<%_\n+const commitsInChangelog = commits.filter(includeInReleaseNotes());\n+for (const group of asCommitGroups(commitsInChangelog)) {\n+_%>\n+\n+### <%- group.title %>\n+| Commit | Description |\n+| -- | -- |\n+<%_\n+  for (const commit of group.commits) {\n+_%>\n+| <%- commit.shortHash %> | <%- commit.header %> |\n+<%_\n+  }\n+}\n+_%>\n+\n+<%_\n+const breakingChanges = commits.filter(contains('breakingChanges'));\n+if (breakingChanges.length) {\n+_%>\n+## Breaking Changes\n+\n+<%_\n+  for (const group of asCommitGroups(breakingChanges)) {\n+_%>\n+### <%- group.title %>\n+\n+<%_\n+    for (const commit of group.commits) {\n+_%>\n+<%- commit.breakingChanges[0].text %>\n+\n+<%_\n+    }\n+  }\n+}\n+_%>\n+\n+<%_\n+const deprecations = commits.filter(contains('deprecations'));\n+if (deprecations.length) {\n+_%>\n+## Deprecations\n+<%_\n+  for (const group of asCommitGroups(deprecations)) {\n+_%>\n+### <%- group.title %>\n+\n+<%_\n+    for (const commit of group.commits) {\n+_%>\n+<%- commit.deprecations[0].text %>\n+<%_\n+    }\n+  }\n+}\n+_%>\n+\n+<%_\n+const authors = commits.filter(unique('author')).map(c => c.author).sort();\n+if (authors.length === 1) {\n+_%>\n+## Special Thanks:\n+<%- authors[0]%>\n+<%_\n+}\n+if (authors.length > 1) {\n+_%>\n+## Special Thanks:\n+<%- authors.slice(0, -1).join(', ') %> and <%- authors.slice(-1)[0] %>\n+<%_\n+}\n+_%>\n+`;\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+var githubReleaseTemplate = `\n+<a name=\"<%- version %>\"></a>\n+# <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n+\n+<%_\n+const commitsInChangelog = commits.filter(includeInReleaseNotes());\n+for (const group of asCommitGroups(commitsInChangelog)) {\n+_%>\n+\n+### <%- group.title %>\n+| Commit | Description |\n+| -- | -- |\n+<%_\n+  for (const commit of group.commits) {\n+_%>\n+| <%- commit.shortHash %> | <%- commit.header %> |\n+<%_\n+  }\n+}\n+_%>\n+\n+<%_\n+const breakingChanges = commits.filter(contains('breakingChanges'));\n+if (breakingChanges.length) {\n+_%>\n+## Breaking Changes\n+\n+<%_\n+  for (const group of asCommitGroups(breakingChanges)) {\n+_%>\n+### <%- group.title %>\n+\n+<%_\n+    for (const commit of group.commits) {\n+_%>\n+<%- commit.breakingChanges[0].text %>\n+\n+<%_\n+    }\n+  }\n+}\n+_%>\n+\n+<%_\n+const deprecations = commits.filter(contains('deprecations'));\n+if (deprecations.length) {\n+_%>\n+## Deprecations\n+<%_\n+  for (const group of asCommitGroups(deprecations)) {\n+_%>\n+### <%- group.title %>\n+\n+<%_\n+    for (const commit of group.commits) {\n+_%>\n+<%- commit.deprecations[0].text %>\n+<%_\n+    }\n+  }\n+}\n+_%>\n+\n+<%_\n+const authors = commits.filter(unique('author')).map(c => c.author).sort();\n+if (authors.length === 1) {\n+_%>\n+## Special Thanks:\n+<%- authors[0]%>\n+<%_\n+}\n+if (authors.length > 1) {\n+_%>\n+## Special Thanks:\n+<%- authors.slice(0, -1).join(', ') %> and <%- authors.slice(-1)[0] %>\n+<%_\n+}\n+_%>\n+`;\n+\n /** Gets the path for the changelog file in a given project. */\n function getLocalChangelogFilePath(projectDir) {\n     return path.join(projectDir, changelogPath);\n@@ -5882,13 +6056,13 @@ class ReleaseNotes {\n     /** Retrieve the release note generated for a Github Release. */\n     getGithubReleaseEntry() {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n-            return ejs.renderFile(path.join(__dirname, 'templates/github-release.ejs'), yield this.generateRenderContext(), { rmWhitespace: true });\n+            return ejs.render(githubReleaseTemplate, yield this.generateRenderContext(), { rmWhitespace: true });\n         });\n     }\n     /** Retrieve the release note generated for a CHANGELOG entry. */\n     getChangelogEntry() {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n-            return ejs.renderFile(path.join(__dirname, 'templates/changelog.ejs'), yield this.generateRenderContext(), { rmWhitespace: true });\n+            return ejs.render(changelogTemplate, yield this.generateRenderContext(), { rmWhitespace: true });\n         });\n     }\n     /**"
        },
        {
            "sha": "0d756df255c2c0200241212327b2e77414d4f97b",
            "filename": "dev-infra/release/publish/release-notes/release-notes.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Frelease-notes.ts",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Frelease-notes.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Frelease-notes.ts?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {renderFile} from 'ejs';\n+import {render} from 'ejs';\n import {join} from 'path';\n import * as semver from 'semver';\n import {CommitFromGitLog} from '../../../commit-message/parse';\n@@ -17,6 +17,9 @@ import {DevInfraReleaseConfig, getReleaseConfig, ReleaseNotesConfig} from '../..\n import {changelogPath} from '../constants';\n import {RenderContext} from './context';\n \n+import changelogTemplate from './templates/changelog';\n+import githubReleaseTemplate from './templates/github-release';\n+\n /** Gets the path for the changelog file in a given project. */\n export function getLocalChangelogFilePath(projectDir: string): string {\n   return join(projectDir, changelogPath);\n@@ -45,16 +48,12 @@ export class ReleaseNotes {\n \n   /** Retrieve the release note generated for a Github Release. */\n   async getGithubReleaseEntry(): Promise<string> {\n-    return renderFile(\n-        join(__dirname, 'templates/github-release.ejs'), await this.generateRenderContext(),\n-        {rmWhitespace: true});\n+    return render(githubReleaseTemplate, await this.generateRenderContext(), {rmWhitespace: true});\n   }\n \n   /** Retrieve the release note generated for a CHANGELOG entry. */\n   async getChangelogEntry() {\n-    return renderFile(\n-        join(__dirname, 'templates/changelog.ejs'), await this.generateRenderContext(),\n-        {rmWhitespace: true});\n+    return render(changelogTemplate, await this.generateRenderContext(), {rmWhitespace: true});\n   }\n \n   /**"
        },
        {
            "sha": "af8c1453ddf3915ba1fe66dd322a308852ab4832",
            "filename": "dev-infra/release/publish/release-notes/templates/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/c03280fd54f399f8c4ce360fde37c419edd6a503/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/c03280fd54f399f8c4ce360fde37c419edd6a503/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2FBUILD.bazel?ref=c03280fd54f399f8c4ce360fde37c419edd6a503",
            "patch": "@@ -1,6 +0,0 @@\n-package(default_visibility = [\"//dev-infra:__subpackages__\"])\n-\n-filegroup(\n-    name = \"templates\",\n-    srcs = glob([\"*.ejs\"]),\n-)"
        },
        {
            "sha": "8b96d62531e357acb31a578087a36f4255b05720",
            "filename": "dev-infra/release/publish/release-notes/templates/changelog.ts",
            "status": "renamed",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fchangelog.ts",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fchangelog.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fchangelog.ts?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -1,3 +1,12 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+export default `\n <a name=\"<%- version %>\"></a>\n # <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n \n@@ -75,3 +84,4 @@ _%>\n <%_\n }\n _%>\n+`;",
            "previous_filename": "dev-infra/release/publish/release-notes/templates/changelog.ejs"
        },
        {
            "sha": "8b96d62531e357acb31a578087a36f4255b05720",
            "filename": "dev-infra/release/publish/release-notes/templates/github-release.ts",
            "status": "renamed",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fgithub-release.ts",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fgithub-release.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Frelease-notes%2Ftemplates%2Fgithub-release.ts?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -1,3 +1,12 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+export default `\n <a name=\"<%- version %>\"></a>\n # <%- version %><% if (title) { %> \"<%- title %>\"<% } %> (<%- dateStamp %>)\n \n@@ -75,3 +84,4 @@ _%>\n <%_\n }\n _%>\n+`;",
            "previous_filename": "dev-infra/release/publish/release-notes/templates/github-release.ejs"
        },
        {
            "sha": "b958bdb9c2fe0acd5e852b76042c08417fa93434",
            "filename": "dev-infra/release/publish/test/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/4ac55ca676769a54a76c5881d40109b556f497b7/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2FBUILD.bazel?ref=4ac55ca676769a54a76c5881d40109b556f497b7",
            "patch": "@@ -33,8 +33,5 @@ jasmine_node_test(\n     # enabled in NodeJS. TODO: Remove this with rules_nodejs 3.x where patching is optional.\n     # https://github.com/bazelbuild/rules_nodejs/commit/7d070ffadf9c3b41711382a4737b995f987c14fa.\n     args = [\"--nobazel_patch_module_resolver\"],\n-    data = [\n-        \"//dev-infra/release/publish/release-notes/templates\",\n-    ],\n     deps = [\":test_lib\"],\n )"
        }
    ],
    "stats": {
        "total": 221,
        "additions": 202,
        "deletions": 19
    }
}