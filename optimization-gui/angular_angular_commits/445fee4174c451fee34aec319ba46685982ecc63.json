{
    "author": "josephperrott",
    "message": "feat(dev-infra): update package version verification to allow for experimental version (#42898)\n\nThe angular-cli repo publishes experimental versioned packages in addition to standard\nversioned packages.  Both experimental and standard verions, based on the expected new\nversion provided are treated as valid and correct.\n\nPR Close #42898",
    "sha": "445fee4174c451fee34aec319ba46685982ecc63",
    "files": [
        {
            "sha": "b8493128065ccd36f0278b0e929a34c1cd04472a",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/445fee4174c451fee34aec319ba46685982ecc63/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/445fee4174c451fee34aec319ba46685982ecc63/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=445fee4174c451fee34aec319ba46685982ecc63",
            "patch": "@@ -6800,11 +6800,15 @@ class ReleaseAction {\n     /** Verify the version of each generated package exact matches the specified version. */\n     _verifyPackageVersions(version, packages) {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n+            /** Experimental equivalent version for packages created with the provided version. */\n+            const experimentalVersion = new semver.SemVer(`0.${version.major * 100 + version.minor}.${version.patch}`);\n             for (const pkg of packages) {\n                 const { version: packageJsonVersion } = JSON.parse(yield fs.promises.readFile(path.join(pkg.outputPath, 'package.json'), 'utf8'));\n-                if (version.compare(packageJsonVersion) !== 0) {\n+                const mismatchesVersion = version.compare(packageJsonVersion) !== 0;\n+                const mismatchesExperimental = experimentalVersion.compare(packageJsonVersion) !== 0;\n+                if (mismatchesExperimental && mismatchesVersion) {\n                     error(red('The built package version does not match the version being released.'));\n-                    error(`  Release Version:   ${version.version}`);\n+                    error(`  Release Version:   ${version.version} (${experimentalVersion.version})`);\n                     error(`  Generated Version: ${packageJsonVersion}`);\n                     throw new FatalReleaseActionError();\n                 }"
        },
        {
            "sha": "e040ef4c2a42a5141fcb441bd0804c42937ac0dc",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/445fee4174c451fee34aec319ba46685982ecc63/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/445fee4174c451fee34aec319ba46685982ecc63/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=445fee4174c451fee34aec319ba46685982ecc63",
            "patch": "@@ -508,13 +508,20 @@ export abstract class ReleaseAction {\n \n   /** Verify the version of each generated package exact matches the specified version. */\n   private async _verifyPackageVersions(version: semver.SemVer, packages: BuiltPackage[]) {\n+    /** Experimental equivalent version for packages created with the provided version. */\n+    const experimentalVersion =\n+        new semver.SemVer(`0.${version.major * 100 + version.minor}.${version.patch}`);\n     for (const pkg of packages) {\n       const {version: packageJsonVersion} =\n           JSON.parse(await fs.readFile(join(pkg.outputPath, 'package.json'), 'utf8')) as\n           {version: string, [key: string]: any};\n-      if (version.compare(packageJsonVersion) !== 0) {\n+\n+      const mismatchesVersion = version.compare(packageJsonVersion) !== 0;\n+      const mismatchesExperimental = experimentalVersion.compare(packageJsonVersion) !== 0;\n+\n+      if (mismatchesExperimental && mismatchesVersion) {\n         error(red('The built package version does not match the version being released.'));\n-        error(`  Release Version:   ${version.version}`);\n+        error(`  Release Version:   ${version.version} (${experimentalVersion.version})`);\n         error(`  Generated Version: ${packageJsonVersion}`);\n         throw new FatalReleaseActionError();\n       }"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 15,
        "deletions": 4
    }
}