{
    "author": "atscott",
    "message": "fix(compiler): recover from an incomplete open tag at the end of a file (#41054)\n\nThe compiler's parsing code has logic to recover from incomplete open\ntags (i.e. `<div`) but the recovery logic does not handle when the\nincomplete tag is terminated by an EOF. This commit updates the logic to\nallow for the EOF character to be interpreted as the end of the tag open\nso that the parser can continue processing. It will then fail to find\nthe end tag and recover by marking the open tag as incomplete.\n\nPart of https://github.com/angular/vscode-ng-language-service/issues/1140\n\nPR Close #41054",
    "sha": "736b1f9fd4d06934f32d5e94f6eeefb8d4edee99",
    "files": [
        {
            "sha": "6864d5a5505e4b347b022afcf764a09e8b981204",
            "filename": "packages/compiler/src/ml_parser/lexer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/736b1f9fd4d06934f32d5e94f6eeefb8d4edee99/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts",
            "raw_url": "https://github.com/angular/angular/raw/736b1f9fd4d06934f32d5e94f6eeefb8d4edee99/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts?ref=736b1f9fd4d06934f32d5e94f6eeefb8d4edee99",
            "patch": "@@ -523,7 +523,7 @@ class _Tokenizer {\n       tagName = openTagToken.parts[1];\n       this._attemptCharCodeUntilFn(isNotWhitespace);\n       while (this._cursor.peek() !== chars.$SLASH && this._cursor.peek() !== chars.$GT &&\n-             this._cursor.peek() !== chars.$LT) {\n+             this._cursor.peek() !== chars.$LT && this._cursor.peek() !== chars.$EOF) {\n         this._consumeAttributeName();\n         this._attemptCharCodeUntilFn(isNotWhitespace);\n         if (this._attemptCharCode(chars.$EQ)) {\n@@ -774,7 +774,8 @@ function isNotWhitespace(code: number): boolean {\n \n function isNameEnd(code: number): boolean {\n   return chars.isWhitespace(code) || code === chars.$GT || code === chars.$LT ||\n-      code === chars.$SLASH || code === chars.$SQ || code === chars.$DQ || code === chars.$EQ;\n+      code === chars.$SLASH || code === chars.$SQ || code === chars.$DQ || code === chars.$EQ ||\n+      code === chars.$EOF;\n }\n \n function isPrefixEnd(code: number): boolean {"
        },
        {
            "sha": "7d451b52eac6c2b4cda47007ed726535e6fd20ba",
            "filename": "packages/compiler/test/ml_parser/lexer_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/736b1f9fd4d06934f32d5e94f6eeefb8d4edee99/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/736b1f9fd4d06934f32d5e94f6eeefb8d4edee99/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts?ref=736b1f9fd4d06934f32d5e94f6eeefb8d4edee99",
            "patch": "@@ -234,6 +234,13 @@ import {ParseLocation, ParseSourceFile, ParseSourceSpan} from '../../src/parse_u\n       });\n \n       describe('tags', () => {\n+        it('terminated with EOF', () => {\n+          expect(tokenizeAndHumanizeSourceSpans('<div')).toEqual([\n+            [lex.TokenType.INCOMPLETE_TAG_OPEN, '<div'],\n+            [lex.TokenType.EOF, ''],\n+          ]);\n+        });\n+\n         it('after tag name', () => {\n           expect(tokenizeAndHumanizeSourceSpans('<div<span><div</span>')).toEqual([\n             [lex.TokenType.INCOMPLETE_TAG_OPEN, '<div'],"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}