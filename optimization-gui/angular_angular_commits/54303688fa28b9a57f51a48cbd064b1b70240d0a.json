{
    "author": "mhevery",
    "message": "refactor(core): Consistent use of  `HEADER_OFFSET` (in `ɵɵ*` instructions only) (#39233)\n\nIMPORTANT: `HEADER_OFFSET` should only be refereed to the in the `ɵɵ*` instructions to translate\ninstruction index into `LView` index. All other indexes should be in the `LView` index space and\nthere should be no need to refer to `HEADER_OFFSET` anywhere else.\n\nPR Close #39233",
    "sha": "54303688fa28b9a57f51a48cbd064b1b70240d0a",
    "files": [
        {
            "sha": "e9db1e512f051921e0c917ad87e4ebb881a2e531",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -21,7 +21,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1485,\n-        \"main-es2015\": 147242,\n+        \"main-es2015\": 146698,\n         \"polyfills-es2015\": 36571\n       }\n     }"
        },
        {
            "sha": "177bdae614566d0de289977038cb5b8dfacc6e71",
            "filename": "packages/core/src/render3/component.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -12,7 +12,6 @@ import {Type} from '../core';\n import {Injector} from '../di/injector';\n import {Sanitizer} from '../sanitization/sanitizer';\n import {assertDefined, assertIndexInRange} from '../util/assert';\n-\n import {assertComponentType} from './assert';\n import {getComponentDef} from './definition';\n import {diPublicInInjector, getOrCreateNodeInjectorForNode} from './di';\n@@ -173,12 +172,13 @@ export function createRootComponentView(\n     rNode: RElement|null, def: ComponentDef<any>, rootView: LView,\n     rendererFactory: RendererFactory3, hostRenderer: Renderer3, sanitizer?: Sanitizer|null): LView {\n   const tView = rootView[TVIEW];\n-  ngDevMode && assertIndexInRange(rootView, 0 + HEADER_OFFSET);\n-  rootView[0 + HEADER_OFFSET] = rNode;\n+  const index = HEADER_OFFSET;\n+  ngDevMode && assertIndexInRange(rootView, index);\n+  rootView[index] = rNode;\n   // '#host' is added here as we don't know the real host DOM name (we don't want to read it) and at\n   // the same time we want to communicate the the debug `TNode` that this is a special `TNode`\n   // representing a host element.\n-  const tNode = getOrCreateTNode(tView, 0, TNodeType.Element, '#host', null);\n+  const tNode: TElementNode = getOrCreateTNode(tView, index, TNodeType.Element, '#host', null);\n   const mergedAttrs = tNode.mergedAttrs = def.hostAttrs;\n   if (mergedAttrs !== null) {\n     computeStaticStyling(tNode, mergedAttrs, true);\n@@ -196,7 +196,7 @@ export function createRootComponentView(\n   const viewRenderer = rendererFactory.createRenderer(rNode, def);\n   const componentView = createLView(\n       rootView, getOrCreateTComponentView(def), null,\n-      def.onPush ? LViewFlags.Dirty : LViewFlags.CheckAlways, rootView[HEADER_OFFSET], tNode,\n+      def.onPush ? LViewFlags.Dirty : LViewFlags.CheckAlways, rootView[index], tNode,\n       rendererFactory, viewRenderer, sanitizer || null, null);\n \n   if (tView.firstCreatePass) {\n@@ -208,7 +208,7 @@ export function createRootComponentView(\n   addToViewTree(rootView, componentView);\n \n   // Store component view at node index, with node as the HOST\n-  return rootView[HEADER_OFFSET] = componentView;\n+  return rootView[index] = componentView;\n }\n \n /**\n@@ -237,8 +237,7 @@ export function createRootComponent<T>(\n   ngDevMode && assertDefined(rootTNode, 'tNode should have been already created');\n   if (tView.firstCreatePass &&\n       (componentDef.hostBindings !== null || componentDef.hostAttrs !== null)) {\n-    const elementIndex = rootTNode.index - HEADER_OFFSET;\n-    setSelectedIndex(elementIndex);\n+    setSelectedIndex(rootTNode.index);\n \n     const rootTView = rootLView[TVIEW];\n     addHostBindingsToExpandoInstructions(rootTView, componentDef);"
        },
        {
            "sha": "b9980d01767e4d9acddd0153d5f6c4398154b049",
            "filename": "packages/core/src/render3/component_ref.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent_ref.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -27,7 +27,7 @@ import {createLView, createTView, locateHostElement, renderView} from './instruc\n import {ComponentDef} from './interfaces/definition';\n import {TContainerNode, TElementContainerNode, TElementNode, TNode} from './interfaces/node';\n import {domRendererFactory3, RendererFactory3, RNode} from './interfaces/renderer';\n-import {LView, LViewFlags, TViewType} from './interfaces/view';\n+import {HEADER_OFFSET, LView, LViewFlags, TViewType} from './interfaces/view';\n import {MATH_ML_NAMESPACE, SVG_NAMESPACE} from './namespaces';\n import {createElementNode, writeDirectClass} from './node_manipulation';\n import {extractAttrsAndClassesFromSelector, stringifyCSSSelectorList} from './node_selector_matcher';\n@@ -192,7 +192,7 @@ export class ComponentFactory<T> extends viewEngine_ComponentFactory<T> {\n         }\n       }\n \n-      tElementNode = getTNode(rootTView, 0) as TElementNode;\n+      tElementNode = getTNode(rootTView, HEADER_OFFSET) as TElementNode;\n \n       if (projectableNodes !== undefined) {\n         const projection: (TNode|RNode[]|null)[] = tElementNode.projection = [];"
        },
        {
            "sha": "f16dd7e48e091124746a8eb8c8b3d7bd76341477",
            "filename": "packages/core/src/render3/context_discovery.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -14,7 +14,7 @@ import {LContext, MONKEY_PATCH_KEY_NAME} from './interfaces/context';\n import {TNode, TNodeFlags} from './interfaces/node';\n import {RElement, RNode} from './interfaces/renderer';\n import {CONTEXT, HEADER_OFFSET, HOST, LView, TVIEW} from './interfaces/view';\n-import {getComponentLViewByIndex, getNativeByTNodeOrNull, readPatchedData, unwrapRNode} from './util/view_utils';\n+import {getComponentLViewByIndex, readPatchedData, unwrapRNode} from './util/view_utils';\n \n \n "
        },
        {
            "sha": "f3b76d3ebec683b32fef67cb5fbd87510a989aca",
            "filename": "packages/core/src/render3/i18n/i18n_apply.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -65,7 +65,7 @@ export function setMaskBit(hasChange: boolean) {\n export function applyI18n(tView: TView, lView: LView, index: number) {\n   if (changeMaskCounter > 0) {\n     ngDevMode && assertDefined(tView, `tView should be defined`);\n-    const tI18n = tView.data[index + HEADER_OFFSET] as TI18n | I18nUpdateOpCodes;\n+    const tI18n = tView.data[index] as TI18n | I18nUpdateOpCodes;\n     // When `index` points to an `ɵɵi18nAttributes` then we have an array otherwise `TI18n`\n     const updateOpCodes: I18nUpdateOpCodes =\n         Array.isArray(tI18n) ? tI18n as I18nUpdateOpCodes : (tI18n as TI18n).update;\n@@ -195,8 +195,8 @@ export function applyMutableOpCodes(\n           // This code is used for ICU expressions only, since we don't support\n           // directives/components in ICUs, we don't need to worry about inputs here\n           setElementAttribute(\n-              renderer, getNativeByIndex(elementNodeIndex - HEADER_OFFSET, lView) as RElement, null,\n-              null, attrName, attrValue, null);\n+              renderer, getNativeByIndex(elementNodeIndex, lView) as RElement, null, null, attrName,\n+              attrValue, null);\n           break;\n         default:\n           throw new Error(`Unable to determine the type of mutate operation for \"${opCode}\"`);\n@@ -281,7 +281,7 @@ export function applyUpdateOpCodes(\n                 const propName = updateOpCodes[++j] as string;\n                 const sanitizeFn = updateOpCodes[++j] as SanitizerFn | null;\n                 const tNodeOrTagName = tView.data[nodeIndex] as TNode | string;\n-                ngDevMode && assertDefined(tNodeOrTagName, 'Expecting TNode or string');\n+                ngDevMode && assertDefined(tNodeOrTagName, 'Experting TNode or string');\n                 if (typeof tNodeOrTagName === 'string') {\n                   // IF we don't have a `TNode`, then we are an element in ICU (as ICU content does\n                   // not have TNode), in which case we know that there are no directives, and hence"
        },
        {
            "sha": "49f9e2c8a1a052446117419897c74813bec0f53c",
            "filename": "packages/core/src/render3/i18n/i18n_parse.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 27,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -132,7 +132,7 @@ export function i18nStartFirstCreatePass(\n     }\n   }\n \n-  tView.data[index + HEADER_OFFSET] = <TI18n>{\n+  tView.data[index] = <TI18n>{\n     create: createOpCodes,\n     update: updateOpCodes,\n   };\n@@ -247,11 +247,11 @@ export function i18nAttributesFirstPass(\n         // Even indexes are text (including bindings)\n         const hasBinding = !!value.match(BINDING_REGEXP);\n         if (hasBinding) {\n-          if (tView.firstCreatePass && tView.data[index + HEADER_OFFSET] === null) {\n+          if (tView.firstCreatePass && tView.data[index] === null) {\n             generateBindingUpdateOpCodes(updateOpCodes, value, previousElementIndex, attrName);\n           }\n         } else {\n-          const tNode = getTNode(tView, previousElementIndex - HEADER_OFFSET);\n+          const tNode = getTNode(tView, previousElementIndex);\n           // Set attributes for Elements only, for other types (like ElementContainer),\n           // only set inputs below\n           if (tNode.type & TNodeType.AnyRNode) {\n@@ -262,9 +262,7 @@ export function i18nAttributesFirstPass(\n           if (dataValue) {\n             setInputsForProperty(tView, lView, dataValue, attrName, value);\n             if (ngDevMode) {\n-              const element =\n-                  getNativeByIndex(previousElementIndex - HEADER_OFFSET, lView) as RElement |\n-                  RComment;\n+              const element = getNativeByIndex(previousElementIndex, lView) as RElement | RComment;\n               setNgReflectProperties(lView, element, tNode.type, dataValue, value);\n             }\n           }\n@@ -273,8 +271,8 @@ export function i18nAttributesFirstPass(\n     }\n   }\n \n-  if (tView.firstCreatePass && tView.data[index + HEADER_OFFSET] === null) {\n-    tView.data[index + HEADER_OFFSET] = updateOpCodes;\n+  if (tView.firstCreatePass && tView.data[index] === null) {\n+    tView.data[index] = updateOpCodes;\n   }\n }\n \n@@ -329,25 +327,6 @@ export function generateBindingUpdateOpCodes(\n   return mask;\n }\n \n-function getBindingMask(icuExpression: IcuExpression, mask = 0): number {\n-  mask = mask | toMaskBit(icuExpression.mainBinding);\n-  let match;\n-  for (let i = 0; i < icuExpression.values.length; i++) {\n-    const valueArr = icuExpression.values[i];\n-    for (let j = 0; j < valueArr.length; j++) {\n-      const value = valueArr[j];\n-      if (typeof value === 'string') {\n-        while (match = BINDING_REGEXP.exec(value)) {\n-          mask = mask | toMaskBit(parseInt(match[1], 10));\n-        }\n-      } else {\n-        mask = getBindingMask(value as IcuExpression, mask);\n-      }\n-    }\n-  }\n-  return mask;\n-}\n-\n \n /**\n  * Convert binding index to mask bit."
        },
        {
            "sha": "fd06bdfbb7a129cf03d57031e6ef00a424dd4d74",
            "filename": "packages/core/src/render3/instructions/advance.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fadvance.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fadvance.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fadvance.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -8,7 +8,7 @@\n import {assertGreaterThan} from '../../util/assert';\n import {assertIndexInDeclRange} from '../assert';\n import {executeCheckHooks, executeInitAndCheckHooks} from '../hooks';\n-import {FLAGS, HEADER_OFFSET, InitPhaseState, LView, LViewFlags, TView} from '../interfaces/view';\n+import {FLAGS, InitPhaseState, LView, LViewFlags, TView} from '../interfaces/view';\n import {getLView, getSelectedIndex, getTView, isInCheckNoChangesMode, setSelectedIndex} from '../state';\n \n \n@@ -42,7 +42,7 @@ export function ɵɵadvance(delta: number): void {\n \n export function selectIndexInternal(\n     tView: TView, lView: LView, index: number, checkNoChangesMode: boolean) {\n-  ngDevMode && assertIndexInDeclRange(lView, index + HEADER_OFFSET);\n+  ngDevMode && assertIndexInDeclRange(lView, index);\n \n   // Flush the initial hooks for elements in the view that have been added up to this point.\n   // PERF WARNING: do NOT extract this to a separate function without running benchmarks"
        },
        {
            "sha": "b03b4fdbf8f0548c65be06f2989373a07b086e0e",
            "filename": "packages/core/src/render3/instructions/element.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -83,7 +83,8 @@ export function ɵɵelementStart(\n   const renderer = lView[RENDERER];\n   const native = lView[adjustedIndex] = createElementNode(renderer, name, getNamespace());\n   const tNode = tView.firstCreatePass ?\n-      elementStartFirstCreatePass(index, tView, lView, native, name, attrsIndex, localRefsIndex) :\n+      elementStartFirstCreatePass(\n+          adjustedIndex, tView, lView, native, name, attrsIndex, localRefsIndex) :\n       tView.data[adjustedIndex] as TElementNode;\n   setCurrentTNode(tNode, true);\n "
        },
        {
            "sha": "cc550ae659c068a2f9aab1829e9fb0cac38cb9b0",
            "filename": "packages/core/src/render3/instructions/element_container.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Felement_container.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -72,7 +72,8 @@ export function ɵɵelementContainerStart(\n           'element containers should be created before any bindings');\n \n   const tNode = tView.firstCreatePass ?\n-      elementContainerStartFirstCreatePass(index, tView, lView, attrsIndex, localRefsIndex) :\n+      elementContainerStartFirstCreatePass(\n+          adjustedIndex, tView, lView, attrsIndex, localRefsIndex) :\n       tView.data[adjustedIndex] as TElementContainerNode;\n   setCurrentTNode(tNode, true);\n "
        },
        {
            "sha": "8557470809bd6ba167b5cf050ff6b55f3a7caa74",
            "filename": "packages/core/src/render3/instructions/i18n.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -49,15 +49,16 @@ export function ɵɵi18nStart(\n     index: number, messageIndex: number, subTemplateIndex: number = -1): void {\n   const tView = getTView();\n   const lView = getLView();\n+  const adjustedIndex = HEADER_OFFSET + index;\n   ngDevMode && assertDefined(tView, `tView should be defined`);\n   const message = getConstant<string>(tView.consts, messageIndex)!;\n   const parentTNode = getCurrentParentTNode() as TElementNode | null;\n   if (tView.firstCreatePass) {\n     i18nStartFirstCreatePass(\n-        tView, parentTNode === null ? 0 : parentTNode.index, lView, index, message,\n+        tView, parentTNode === null ? 0 : parentTNode.index, lView, adjustedIndex, message,\n         subTemplateIndex);\n   }\n-  const tI18n = tView.data[HEADER_OFFSET + index] as TI18n;\n+  const tI18n = tView.data[adjustedIndex] as TI18n;\n   const sameViewParentTNode = parentTNode === lView[T_HOST] ? null : parentTNode;\n   const parentRNode = getClosestRElement(tView, sameViewParentTNode, lView);\n   // If `parentTNode` is an `ElementContainer` than it has `<!--ng-container--->`.\n@@ -125,7 +126,7 @@ export function ɵɵi18nAttributes(index: number, attrsIndex: number): void {\n   const tView = getTView();\n   ngDevMode && assertDefined(tView, `tView should be defined`);\n   const attrs = getConstant<string[]>(tView.consts, attrsIndex)!;\n-  i18nAttributesFirstPass(lView, tView, index, attrs);\n+  i18nAttributesFirstPass(lView, tView, index + HEADER_OFFSET, attrs);\n }\n \n \n@@ -154,7 +155,7 @@ export function ɵɵi18nExp<T>(value: T): typeof ɵɵi18nExp {\n  * @codeGenApi\n  */\n export function ɵɵi18nApply(index: number) {\n-  applyI18n(getTView(), getLView(), index);\n+  applyI18n(getTView(), getLView(), index + HEADER_OFFSET);\n }\n \n /**"
        },
        {
            "sha": "ed2ed319876f1d8d04048d4be5ba1c20dd131bdd",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -676,18 +676,3 @@ export class LContainerDebug implements ILContainerDebug {\n     return toDebug(this._raw_lContainer[NEXT]);\n   }\n }\n-\n-/**\n- * Return an `LView` value if found.\n- *\n- * @param value `LView` if any\n- */\n-export function readLViewValue(value: any): LView|null {\n-  while (Array.isArray(value)) {\n-    // This check is not quite right, as it does not take into account `StylingContext`\n-    // This is why it is in debug, not in util.ts\n-    if (value.length >= HEADER_OFFSET - 1) return value as LView;\n-    value = value[HOST];\n-  }\n-  return null;\n-}"
        },
        {
            "sha": "612534414bdc17822b377afd7e7e14702e1113eb",
            "filename": "packages/core/src/render3/instructions/projection.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fprojection.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fprojection.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fprojection.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -8,7 +8,7 @@\n import {newArray} from '../../util/array_utils';\n import {TAttributes, TElementNode, TNode, TNodeFlags, TNodeType} from '../interfaces/node';\n import {ProjectionSlots} from '../interfaces/projection';\n-import {DECLARATION_COMPONENT_VIEW, T_HOST} from '../interfaces/view';\n+import {DECLARATION_COMPONENT_VIEW, HEADER_OFFSET, T_HOST} from '../interfaces/view';\n import {applyProjection} from '../node_manipulation';\n import {getProjectAsAttrValue, isNodeMatchingSelectorList, isSelectorInSelectorList} from '../node_selector_matcher';\n import {getLView, getTView, setCurrentTNodeAsNotParent} from '../state';\n@@ -120,7 +120,7 @@ export function ɵɵprojection(\n   const lView = getLView();\n   const tView = getTView();\n   const tProjectionNode =\n-      getOrCreateTNode(tView, nodeIndex, TNodeType.Projection, null, attrs || null);\n+      getOrCreateTNode(tView, HEADER_OFFSET + nodeIndex, TNodeType.Projection, null, attrs || null);\n \n   // We can't use viewData[HOST_NODE] because projection nodes can be nested in embedded views.\n   if (tProjectionNode.projection === null) tProjectionNode.projection = selectorIndex;"
        },
        {
            "sha": "53a38ab907e8b6338527f03efef8b7c1624e58e4",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 29,
            "changes": 61,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -12,7 +12,7 @@ import {CUSTOM_ELEMENTS_SCHEMA, NO_ERRORS_SCHEMA, SchemaMetadata} from '../../me\n import {ViewEncapsulation} from '../../metadata/view';\n import {validateAgainstEventAttributes, validateAgainstEventProperties} from '../../sanitization/sanitization';\n import {Sanitizer} from '../../sanitization/sanitizer';\n-import {assertDefined, assertDomNode, assertEqual, assertGreaterThan, assertIndexInRange, assertLessThan, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n+import {assertDefined, assertDomNode, assertEqual, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertLessThan, assertNotEqual, assertNotSame, assertSame, assertString} from '../../util/assert';\n import {createNamedArrayType} from '../../util/named_array_type';\n import {initNgDevMode} from '../../util/ng_dev_mode';\n import {normalizeDebugBindingName, normalizeDebugBindingValue} from '../../util/ng_reflect';\n@@ -214,12 +214,14 @@ export function getOrCreateTNode(\n export function getOrCreateTNode(\n     tView: TView, index: number, type: TNodeType, name: string|null, attrs: TAttributes|null):\n     TElementNode&TContainerNode&TElementContainerNode&TProjectionNode&TIcuContainerNode {\n+  ngDevMode && index !== 0 &&  // 0 are bogus nodes and they are OK. See `createContainerRef` in\n+                               // `view_engine_compatibility` for additional context.\n+      assertGreaterThanOrEqual(index, HEADER_OFFSET, 'TNodes can\\'t be in the LView header.');\n   // Keep this function short, so that the VM will inline it.\n   ngDevMode && assertPureTNodeType(type);\n-  const adjustedIndex = index + HEADER_OFFSET;\n-  let tNode = tView.data[adjustedIndex] as TNode;\n+  let tNode = tView.data[index] as TNode;\n   if (tNode === null) {\n-    tNode = createTNodeAtIndex(tView, adjustedIndex, type, name, attrs);\n+    tNode = createTNodeAtIndex(tView, index, type, name, attrs);\n     if (isInI18nBlock()) {\n       // If we are in i18n block then all elements should be pre declared through `Placeholder`\n       // See `TNodeType.Placeholder` and `LFrame.inI18n` for more context.\n@@ -234,22 +236,21 @@ export function getOrCreateTNode(\n     const parent = getCurrentParentTNode();\n     tNode.injectorIndex = parent === null ? -1 : parent.injectorIndex;\n     ngDevMode && assertTNodeForTView(tNode, tView);\n-    ngDevMode && assertEqual(index + HEADER_OFFSET, tNode.index, 'Expecting same index');\n+    ngDevMode && assertEqual(index, tNode.index, 'Expecting same index');\n   }\n   setCurrentTNode(tNode, true);\n   return tNode as TElementNode & TContainerNode & TElementContainerNode & TProjectionNode &\n       TIcuContainerNode;\n }\n \n export function createTNodeAtIndex(\n-    tView: TView, adjustedIndex: number, type: TNodeType, name: string|null,\n-    attrs: TAttributes|null) {\n+    tView: TView, index: number, type: TNodeType, name: string|null, attrs: TAttributes|null) {\n   const currentTNode = getCurrentTNodePlaceholderOk();\n   const isParent = isCurrentTNodeParent();\n   const parent = isParent ? currentTNode : currentTNode && currentTNode.parent;\n   // Parents cannot cross component boundaries because components will be used in multiple places.\n-  const tNode = tView.data[adjustedIndex] =\n-      createTNode(tView, parent as TElementNode | TContainerNode, type, adjustedIndex, name, attrs);\n+  const tNode = tView.data[index] =\n+      createTNode(tView, parent as TElementNode | TContainerNode, type, index, name, attrs);\n   // Assign a pointer to the first child node of a given view. The first node is not always the one\n   // at index 0, in case of i18n, index 0 can be the instruction `i18nStart` and the first node has\n   // the index 1 or more, so we can't just check node index.\n@@ -546,7 +547,7 @@ function executeTemplate<T>(\n     if (rf & RenderFlags.Update && lView.length > HEADER_OFFSET) {\n       // When we're updating, inherently select 0 so we don't\n       // have to generate that instruction for most update blocks.\n-      selectIndexInternal(tView, lView, 0, isInCheckNoChangesMode());\n+      selectIndexInternal(tView, lView, HEADER_OFFSET, isInCheckNoChangesMode());\n     }\n     templateFn(rf, context);\n   } finally {\n@@ -810,33 +811,36 @@ export function storeCleanupWithContext(\n  * @param tView `TView` to which this `TNode` belongs (used only in `ngDevMode`)\n  * @param tParent Parent `TNode`\n  * @param type The type of the node\n- * @param adjustedIndex The index of the TNode in TView.data, adjusted for HEADER_OFFSET\n+ * @param index The index of the TNode in TView.data, adjusted for HEADER_OFFSET\n  * @param tagName The tag name of the node\n  * @param attrs The attributes defined on this node\n  * @param tViews Any TViews attached to this node\n  * @returns the TNode object\n  */\n export function createTNode(\n     tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.Container,\n-    adjustedIndex: number, tagName: string|null, attrs: TAttributes|null): TContainerNode;\n+    index: number, tagName: string|null, attrs: TAttributes|null): TContainerNode;\n export function createTNode(\n     tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.Element|TNodeType.Text,\n-    adjustedIndex: number, tagName: string|null, attrs: TAttributes|null): TElementNode;\n+    index: number, tagName: string|null, attrs: TAttributes|null): TElementNode;\n export function createTNode(\n     tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.ElementContainer,\n-    adjustedIndex: number, tagName: string|null, attrs: TAttributes|null): TElementContainerNode;\n+    index: number, tagName: string|null, attrs: TAttributes|null): TElementContainerNode;\n export function createTNode(\n-    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.Icu,\n-    adjustedIndex: number, tagName: string|null, attrs: TAttributes|null): TIcuContainerNode;\n+    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.Icu, index: number,\n+    tagName: string|null, attrs: TAttributes|null): TIcuContainerNode;\n export function createTNode(\n     tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType.Projection,\n-    adjustedIndex: number, tagName: string|null, attrs: TAttributes|null): TProjectionNode;\n+    index: number, tagName: string|null, attrs: TAttributes|null): TProjectionNode;\n export function createTNode(\n-    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType, adjustedIndex: number,\n+    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType, index: number,\n     tagName: string|null, attrs: TAttributes|null): TNode;\n export function createTNode(\n-    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType, adjustedIndex: number,\n+    tView: TView, tParent: TElementNode|TContainerNode|null, type: TNodeType, index: number,\n     value: string|null, attrs: TAttributes|null): TNode {\n+  ngDevMode && index !== 0 &&  // 0 are bogus nodes and they are OK. See `createContainerRef` in\n+                               // `view_engine_compatibility` for additional context.\n+      assertGreaterThanOrEqual(index, HEADER_OFFSET, 'TNodes can\\'t be in the LView header.');\n   ngDevMode && assertNotSame(attrs, undefined, '\\'undefined\\' is not valid value for \\'attrs\\'');\n   ngDevMode && ngDevMode.tNode++;\n   ngDevMode && tParent && assertTNodeForTView(tParent, tView);\n@@ -845,7 +849,7 @@ export function createTNode(\n       new TNodeDebug(\n           tView,          // tView_: TView\n           type,           // type: TNodeType\n-          adjustedIndex,  // index: number\n+          index,          // index: number\n           null,           // insertBeforeIndex: null|-1|number|number[]\n           injectorIndex,  // injectorIndex: number\n           -1,             // directiveStart: number\n@@ -877,10 +881,10 @@ export function createTNode(\n           0 as any,       // styleBindings: TStylingRange;\n           ) :\n       {\n-        type: type,\n-        index: adjustedIndex,\n+        type,\n+        index,\n         insertBeforeIndex: null,\n-        injectorIndex: injectorIndex,\n+        injectorIndex,\n         directiveStart: -1,\n         directiveEnd: -1,\n         directiveStylingLast: -1,\n@@ -1213,13 +1217,12 @@ export function resolveDirectives(\n           // We will push the actual hook function into this array later during dir instantiation.\n           // We cannot do it now because we must ensure hooks are registered in the same\n           // order that directives are created (i.e. injection order).\n-          (tView.preOrderHooks || (tView.preOrderHooks = [])).push(tNode.index - HEADER_OFFSET);\n+          (tView.preOrderHooks || (tView.preOrderHooks = [])).push(tNode.index);\n           preOrderHooksFound = true;\n         }\n \n         if (!preOrderCheckHooksFound && (lifeCycleHooks.ngOnChanges || lifeCycleHooks.ngDoCheck)) {\n-          (tView.preOrderCheckHooks || (tView.preOrderCheckHooks = []))\n-              .push(tNode.index - HEADER_OFFSET);\n+          (tView.preOrderCheckHooks || (tView.preOrderCheckHooks = [])).push(tNode.index);\n           preOrderCheckHooksFound = true;\n         }\n \n@@ -1325,7 +1328,7 @@ function invokeDirectivesHostBindings(tView: TView, lView: LView, tNode: TNode)\n   const end = tNode.directiveEnd;\n   const expando = tView.expandoInstructions!;\n   const firstCreatePass = tView.firstCreatePass;\n-  const elementIndex = tNode.index - HEADER_OFFSET;\n+  const elementIndex = tNode.index;\n   const currentDirectiveIndex = getCurrentDirectiveIndex();\n   try {\n     setSelectedIndex(elementIndex);\n@@ -1373,7 +1376,7 @@ export function generateExpandoInstructionBlock(\n   // Important: In JS `-x` and `0-x` is not the same! If `x===0` then `-x` will produce `-0` which\n   // requires non standard math arithmetic and it can prevent VM optimizations.\n   // `0-0` will always produce `0` and will not cause a potential deoptimization in VM.\n-  const elementIndex = HEADER_OFFSET - tNode.index;\n+  const elementIndex = 0 - tNode.index;\n   const providerStartIndex = tNode.providerIndexes & TNodeProviderIndexes.ProvidersStartIndexMask;\n   const providerCount = tView.data.length - providerStartIndex;\n   (tView.expandoInstructions || (tView.expandoInstructions = []))\n@@ -2087,7 +2090,7 @@ export function setInputsForProperty(\n export function textBindingInternal(lView: LView, index: number, value: string): void {\n   ngDevMode && assertString(value, 'Value should be a string');\n   ngDevMode && assertNotSame(value, NO_CHANGE as any, 'value should not be NO_CHANGE');\n-  ngDevMode && assertIndexInRange(lView, index + HEADER_OFFSET);\n+  ngDevMode && assertIndexInRange(lView, index);\n   const element = getNativeByIndex(index, lView) as any as RText;\n   ngDevMode && assertDefined(element, 'native element should exist');\n   updateTextNode(lView[RENDERER], element, value);"
        },
        {
            "sha": "676ee4d92824c201de26f8f37f7f3967d756aeb2",
            "filename": "packages/core/src/render3/instructions/storage.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstorage.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstorage.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstorage.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -14,12 +14,11 @@ import {load} from '../util/view_utils';\n export function store<T>(tView: TView, lView: LView, index: number, value: T): void {\n   // We don't store any static data for local variables, so the first time\n   // we see the template, we should store as null to avoid a sparse array\n-  const adjustedIndex = index + HEADER_OFFSET;\n-  if (adjustedIndex >= tView.data.length) {\n-    tView.data[adjustedIndex] = null;\n-    tView.blueprint[adjustedIndex] = null;\n+  if (index >= tView.data.length) {\n+    tView.data[index] = null;\n+    tView.blueprint[index] = null;\n   }\n-  lView[adjustedIndex] = value;\n+  lView[index] = value;\n }\n \n /**\n@@ -34,5 +33,5 @@ export function store<T>(tView: TView, lView: LView, index: number, value: T): v\n  */\n export function ɵɵreference<T>(index: number) {\n   const contextLView = getContextLView();\n-  return load<T>(contextLView, index);\n+  return load<T>(contextLView, HEADER_OFFSET + index);\n }"
        },
        {
            "sha": "16ac4d3d7a80aabe4fda7a1bc810ffb8eaba4004",
            "filename": "packages/core/src/render3/instructions/styling.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstyling.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstyling.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fstyling.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -17,14 +17,13 @@ import {DirectiveDef} from '../interfaces/definition';\n import {AttributeMarker, TAttributes, TNode, TNodeFlags, TNodeType} from '../interfaces/node';\n import {RElement, Renderer3} from '../interfaces/renderer';\n import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePrev, getTStylingRangePrevDuplicate, TStylingKey, TStylingRange} from '../interfaces/styling';\n-import {HEADER_OFFSET, LView, RENDERER, TData, TView} from '../interfaces/view';\n+import {LView, RENDERER, TData, TView} from '../interfaces/view';\n import {applyStyling} from '../node_manipulation';\n import {getCurrentDirectiveDef, getLView, getSelectedIndex, getTView, incrementBindingIndex} from '../state';\n import {insertTStylingBinding} from '../styling/style_binding_list';\n import {getLastParsedKey, getLastParsedValue, parseClassName, parseClassNameNext, parseStyle, parseStyleNext} from '../styling/styling_parser';\n import {NO_CHANGE} from '../tokens';\n import {getNativeByIndex} from '../util/view_utils';\n-\n import {setDirectiveInputsWhichShadowsStyling} from './property';\n \n \n@@ -174,7 +173,7 @@ export function checkStylingProperty(\n     stylingFirstUpdatePass(tView, prop, bindingIndex, isClassBased);\n   }\n   if (value !== NO_CHANGE && bindingUpdated(lView, bindingIndex, value)) {\n-    const tNode = tView.data[getSelectedIndex() + HEADER_OFFSET] as TNode;\n+    const tNode = tView.data[getSelectedIndex()] as TNode;\n     updateStyling(\n         tView, tNode, lView, lView[RENDERER], prop,\n         lView[bindingIndex + 1] = normalizeSuffix(value, suffix), isClassBased, bindingIndex);\n@@ -204,7 +203,7 @@ export function checkStylingMap(\n   if (value !== NO_CHANGE && bindingUpdated(lView, bindingIndex, value)) {\n     // `getSelectedIndex()` should be here (rather than in instruction) so that it is guarded by the\n     // if so as not to read unnecessarily.\n-    const tNode = tView.data[getSelectedIndex() + HEADER_OFFSET] as TNode;\n+    const tNode = tView.data[getSelectedIndex()] as TNode;\n     if (hasStylingInputShadow(tNode, isClassBased) && !isInHostBindings(tView, bindingIndex)) {\n       if (ngDevMode) {\n         // verify that if we are shadowing then `TData` is appropriately marked so that we skip\n@@ -271,7 +270,8 @@ function stylingFirstUpdatePass(\n     // itself to the list.\n     // `getSelectedIndex()` should be here (rather than in instruction) so that it is guarded by the\n     // if so as not to read unnecessarily.\n-    const tNode = tData[getSelectedIndex() + HEADER_OFFSET] as TNode;\n+    const tNode = tData[getSelectedIndex()] as TNode;\n+    ngDevMode && assertDefined(tNode, 'TNode expected');\n     const isHostBindings = isInHostBindings(tView, bindingIndex);\n     if (hasStylingInputShadow(tNode, isClassBased) && tStylingKey === null && !isHostBindings) {\n       // `tStylingKey === null` implies that we are either `[style]` or `[class]` binding."
        },
        {
            "sha": "43e476ca6126c98a5c181ecf0b412042badf1466",
            "filename": "packages/core/src/render3/instructions/template.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftemplate.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -73,10 +73,10 @@ export function ɵɵtemplate(\n   const tView = getTView();\n   const adjustedIndex = index + HEADER_OFFSET;\n \n-  const tNode = tView.firstCreatePass ?\n-      templateFirstCreatePass(\n-          index, tView, lView, templateFn, decls, vars, tagName, attrsIndex, localRefsIndex) :\n-      tView.data[adjustedIndex] as TContainerNode;\n+  const tNode = tView.firstCreatePass ? templateFirstCreatePass(\n+                                            adjustedIndex, tView, lView, templateFn, decls, vars,\n+                                            tagName, attrsIndex, localRefsIndex) :\n+                                        tView.data[adjustedIndex] as TContainerNode;\n   setCurrentTNode(tNode, false);\n \n   const comment = lView[RENDERER].createComment(ngDevMode ? 'container' : '');"
        },
        {
            "sha": "0c9fad222ae971a2ec53d4650a8b42466d24b936",
            "filename": "packages/core/src/render3/instructions/text.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftext.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Ftext.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -35,7 +35,7 @@ export function ɵɵtext(index: number, value: string = ''): void {\n   ngDevMode && assertIndexInRange(lView, adjustedIndex);\n \n   const tNode = tView.firstCreatePass ?\n-      getOrCreateTNode(tView, index, TNodeType.Text, value, null) :\n+      getOrCreateTNode(tView, adjustedIndex, TNodeType.Text, value, null) :\n       tView.data[adjustedIndex] as TElementNode;\n \n   const textNative = lView[adjustedIndex] = createTextNode(lView[RENDERER], value);"
        },
        {
            "sha": "5d2d667a6f455e1cd8972fb65500071d7a0e838c",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -47,7 +47,13 @@ export const DECLARATION_COMPONENT_VIEW = 16;\n export const DECLARATION_LCONTAINER = 17;\n export const PREORDER_HOOK_FLAGS = 18;\n export const QUERIES = 19;\n-/** Size of LView's header. Necessary to adjust for it when setting slots.  */\n+/**\n+ * Size of LView's header. Necessary to adjust for it when setting slots.\n+ *\n+ * IMPORTANT: `HEADER_OFFSET` should only be referred to the in the `ɵɵ*` instructions to translate\n+ * instruction index into `LView` index. All other indexes should be in the `LView` index space and\n+ * there should be no need to refer to `HEADER_OFFSET` anywhere else.\n+ */\n export const HEADER_OFFSET = 20;\n \n "
        },
        {
            "sha": "0d33ad41f1a4691bee976469abfbc79990626118",
            "filename": "packages/core/src/render3/pipe.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 18,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -54,7 +54,7 @@ export function ɵɵpipe(index: number, pipeName: string): any {\n     const previousIncludeViewProviders = setIncludeViewProviders(false);\n     const pipeInstance = pipeFactory();\n     setIncludeViewProviders(previousIncludeViewProviders);\n-    store(tView, getLView(), index, pipeInstance);\n+    store(tView, getLView(), adjustedIndex, pipeInstance);\n     return pipeInstance;\n   } finally {\n     // we have to restore the injector implementation in finally, just in case the creation of the\n@@ -96,11 +96,12 @@ function getPipeDef(name: string, registry: PipeDefList|null): PipeDef<any> {\n  * @codeGenApi\n  */\n export function ɵɵpipeBind1(index: number, slotOffset: number, v1: any): any {\n+  const adjustedIndex = index + HEADER_OFFSET;\n   const lView = getLView();\n-  const pipeInstance = load<PipeTransform>(lView, index);\n+  const pipeInstance = load<PipeTransform>(lView, adjustedIndex);\n   return unwrapValue(\n       lView,\n-      isPure(lView, index) ?\n+      isPure(lView, adjustedIndex) ?\n           pureFunction1Internal(\n               lView, getBindingRoot(), slotOffset, pipeInstance.transform, v1, pipeInstance) :\n           pipeInstance.transform(v1));\n@@ -120,11 +121,12 @@ export function ɵɵpipeBind1(index: number, slotOffset: number, v1: any): any {\n  * @codeGenApi\n  */\n export function ɵɵpipeBind2(index: number, slotOffset: number, v1: any, v2: any): any {\n+  const adjustedIndex = index + HEADER_OFFSET;\n   const lView = getLView();\n-  const pipeInstance = load<PipeTransform>(lView, index);\n+  const pipeInstance = load<PipeTransform>(lView, adjustedIndex);\n   return unwrapValue(\n       lView,\n-      isPure(lView, index) ?\n+      isPure(lView, adjustedIndex) ?\n           pureFunction2Internal(\n               lView, getBindingRoot(), slotOffset, pipeInstance.transform, v1, v2, pipeInstance) :\n           pipeInstance.transform(v1, v2));\n@@ -145,14 +147,15 @@ export function ɵɵpipeBind2(index: number, slotOffset: number, v1: any, v2: an\n  * @codeGenApi\n  */\n export function ɵɵpipeBind3(index: number, slotOffset: number, v1: any, v2: any, v3: any): any {\n+  const adjustedIndex = index + HEADER_OFFSET;\n   const lView = getLView();\n-  const pipeInstance = load<PipeTransform>(lView, index);\n+  const pipeInstance = load<PipeTransform>(lView, adjustedIndex);\n   return unwrapValue(\n       lView,\n-      isPure(lView, index) ? pureFunction3Internal(\n-                                 lView, getBindingRoot(), slotOffset, pipeInstance.transform, v1,\n-                                 v2, v3, pipeInstance) :\n-                             pipeInstance.transform(v1, v2, v3));\n+      isPure(lView, adjustedIndex) ? pureFunction3Internal(\n+                                         lView, getBindingRoot(), slotOffset,\n+                                         pipeInstance.transform, v1, v2, v3, pipeInstance) :\n+                                     pipeInstance.transform(v1, v2, v3));\n }\n \n /**\n@@ -172,14 +175,15 @@ export function ɵɵpipeBind3(index: number, slotOffset: number, v1: any, v2: an\n  */\n export function ɵɵpipeBind4(\n     index: number, slotOffset: number, v1: any, v2: any, v3: any, v4: any): any {\n+  const adjustedIndex = index + HEADER_OFFSET;\n   const lView = getLView();\n-  const pipeInstance = load<PipeTransform>(lView, index);\n+  const pipeInstance = load<PipeTransform>(lView, adjustedIndex);\n   return unwrapValue(\n       lView,\n-      isPure(lView, index) ? pureFunction4Internal(\n-                                 lView, getBindingRoot(), slotOffset, pipeInstance.transform, v1,\n-                                 v2, v3, v4, pipeInstance) :\n-                             pipeInstance.transform(v1, v2, v3, v4));\n+      isPure(lView, adjustedIndex) ? pureFunction4Internal(\n+                                         lView, getBindingRoot(), slotOffset,\n+                                         pipeInstance.transform, v1, v2, v3, v4, pipeInstance) :\n+                                     pipeInstance.transform(v1, v2, v3, v4));\n }\n \n /**\n@@ -195,18 +199,19 @@ export function ɵɵpipeBind4(\n  * @codeGenApi\n  */\n export function ɵɵpipeBindV(index: number, slotOffset: number, values: [any, ...any[]]): any {\n+  const adjustedIndex = index + HEADER_OFFSET;\n   const lView = getLView();\n-  const pipeInstance = load<PipeTransform>(lView, index);\n+  const pipeInstance = load<PipeTransform>(lView, adjustedIndex);\n   return unwrapValue(\n       lView,\n-      isPure(lView, index) ?\n+      isPure(lView, adjustedIndex) ?\n           pureFunctionVInternal(\n               lView, getBindingRoot(), slotOffset, pipeInstance.transform, values, pipeInstance) :\n           pipeInstance.transform.apply(pipeInstance, values));\n }\n \n function isPure(lView: LView, index: number): boolean {\n-  return (<PipeDef<any>>lView[TVIEW].data[index + HEADER_OFFSET]).pure;\n+  return (<PipeDef<any>>lView[TVIEW].data[index]).pure;\n }\n \n /**"
        },
        {
            "sha": "d4e971dcf62a3f7e219f5de0f9d4b94476d8f168",
            "filename": "packages/core/src/render3/state.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fstate.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -6,11 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {assertDefined, assertEqual, assertNotEqual} from '../util/assert';\n+import {assertDefined, assertEqual, assertGreaterThanOrEqual, assertLessThan, assertNotEqual} from '../util/assert';\n import {assertLViewOrUndefined, assertTNodeForTView} from './assert';\n import {DirectiveDef} from './interfaces/definition';\n import {TNode, TNodeType} from './interfaces/node';\n-import {CONTEXT, DECLARATION_VIEW, LView, OpaqueViewState, TData, TVIEW, TView} from './interfaces/view';\n+import {CONTEXT, DECLARATION_VIEW, HEADER_OFFSET, LView, OpaqueViewState, TData, TVIEW, TView} from './interfaces/view';\n import {MATH_ML_NAMESPACE, SVG_NAMESPACE} from './namespaces';\n import {assertTNodeType} from './node_assert';\n import {getTNode} from './util/view_utils';\n@@ -458,13 +458,14 @@ export function enterDI(newView: LView, tNode: TNode) {\n  * @returns the previously active lView;\n  */\n export function enterView(newView: LView): void {\n+  ngDevMode && assertNotEqual(newView[0], newView[1] as any, '????');\n   ngDevMode && assertLViewOrUndefined(newView);\n   const newLFrame = allocLFrame();\n   if (ngDevMode) {\n     assertEqual(newLFrame.isParent, true, 'Expected clean LFrame');\n     assertEqual(newLFrame.lView, null, 'Expected clean LFrame');\n     assertEqual(newLFrame.tView, null, 'Expected clean LFrame');\n-    assertEqual(newLFrame.selectedIndex, 0, 'Expected clean LFrame');\n+    assertEqual(newLFrame.selectedIndex, -1, 'Expected clean LFrame');\n     assertEqual(newLFrame.elementDepthCount, 0, 'Expected clean LFrame');\n     assertEqual(newLFrame.currentDirectiveIndex, -1, 'Expected clean LFrame');\n     assertEqual(newLFrame.currentNamespace, null, 'Expected clean LFrame');\n@@ -498,7 +499,7 @@ function createLFrame(parent: LFrame|null): LFrame {\n     isParent: true,\n     lView: null!,\n     tView: null!,\n-    selectedIndex: 0,\n+    selectedIndex: -1,\n     contextLView: null!,\n     elementDepthCount: 0,\n     currentNamespace: null,\n@@ -551,7 +552,7 @@ export function leaveView() {\n   const oldLFrame = leaveViewLight();\n   oldLFrame.isParent = true;\n   oldLFrame.tView = null!;\n-  oldLFrame.selectedIndex = 0;\n+  oldLFrame.selectedIndex = -1;\n   oldLFrame.contextLView = null!;\n   oldLFrame.elementDepthCount = 0;\n   oldLFrame.currentDirectiveIndex = -1;\n@@ -599,6 +600,11 @@ export function getSelectedIndex() {\n  * run if and when the provided `index` value is different from the current selected index value.)\n  */\n export function setSelectedIndex(index: number) {\n+  ngDevMode && index !== -1 &&\n+      assertGreaterThanOrEqual(index, HEADER_OFFSET, 'Index must be past HEADER_OFFSET (or -1).');\n+  ngDevMode &&\n+      assertLessThan(\n+          index, instructionState.lFrame.lView.length, 'Can\\'t set index passed end of LView');\n   instructionState.lFrame.selectedIndex = index;\n }\n "
        },
        {
            "sha": "e081eb3a75067b594c11020fdb89ade90732057b",
            "filename": "packages/core/src/render3/util/discovery_utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -16,7 +16,7 @@ import {LContext} from '../interfaces/context';\n import {DirectiveDef} from '../interfaces/definition';\n import {TElementNode, TNode, TNodeProviderIndexes} from '../interfaces/node';\n import {isLView} from '../interfaces/type_checks';\n-import {CLEANUP, CONTEXT, DebugNode, FLAGS, HEADER_OFFSET, HOST, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../interfaces/view';\n+import {CLEANUP, CONTEXT, DebugNode, FLAGS, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../interfaces/view';\n \n import {stringifyForError} from './misc_utils';\n import {getLViewParent, getRootContext} from './view_traversal_utils';\n@@ -387,8 +387,8 @@ export function getDebugNode(element: Element): DebugNode|null {\n     const valueInLView = lView[nodeIndex];\n     // this means that value in the lView is a component with its own\n     // data. In this situation the TNode is not accessed at the same spot.\n-    const tNode = isLView(valueInLView) ? (valueInLView[T_HOST] as TNode) :\n-                                          getTNode(lView[TVIEW], nodeIndex - HEADER_OFFSET);\n+    const tNode =\n+        isLView(valueInLView) ? (valueInLView[T_HOST] as TNode) : getTNode(lView[TVIEW], nodeIndex);\n     ngDevMode &&\n         assertEqual(tNode.index, nodeIndex, 'Expecting that TNode at index is same as index');\n     debugNode = buildDebugNode(tNode, lView);"
        },
        {
            "sha": "75c9d23611d6cf370327a467b1a51c749189db26",
            "filename": "packages/core/src/render3/util/view_utils.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {assertDefined, assertDomNode, assertGreaterThan, assertIndexInRange, assertLessThan} from '../../util/assert';\n+import {assertDefined, assertDomNode, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertLessThan} from '../../util/assert';\n import {assertTNode, assertTNodeForLView} from '../assert';\n import {LContainer, TYPE} from '../interfaces/container';\n import {LContext, MONKEY_PATCH_KEY_NAME} from '../interfaces/context';\n@@ -78,7 +78,9 @@ export function unwrapLContainer(value: RNode|LView|LContainer): LContainer|null\n  * from any containers, component views, or style contexts.\n  */\n export function getNativeByIndex(index: number, lView: LView): RNode {\n-  return unwrapRNode(lView[index + HEADER_OFFSET]);\n+  ngDevMode && assertIndexInRange(lView, index);\n+  ngDevMode && assertGreaterThanOrEqual(index, HEADER_OFFSET, 'Expected to be past HEADER_OFFSET');\n+  return unwrapRNode(lView[index]);\n }\n \n /**\n@@ -120,16 +122,16 @@ export function getNativeByTNodeOrNull(tNode: TNode|null, lView: LView): RNode|n\n // fixme(misko): The return Type should be `TNode|null`\n export function getTNode(tView: TView, index: number): TNode {\n   ngDevMode && assertGreaterThan(index, -1, 'wrong index for TNode');\n-  ngDevMode && assertLessThan(index, tView.data.length - HEADER_OFFSET, 'wrong index for TNode');\n-  const tNode = tView.data[index + HEADER_OFFSET] as TNode;\n+  ngDevMode && assertLessThan(index, tView.data.length, 'wrong index for TNode');\n+  const tNode = tView.data[index] as TNode;\n   ngDevMode && tNode !== null && assertTNode(tNode);\n   return tNode;\n }\n \n /** Retrieves a value from any `LView` or `TData`. */\n export function load<T>(view: LView|TData, index: number): T {\n-  ngDevMode && assertIndexInRange(view, index + HEADER_OFFSET);\n-  return view[index + HEADER_OFFSET];\n+  ngDevMode && assertIndexInRange(view, index);\n+  return view[index];\n }\n \n export function getComponentLViewByIndex(nodeIndex: number, hostView: LView): LView {"
        },
        {
            "sha": "ad01f9b6169e0b5d65a153025d3d6a82e8873892",
            "filename": "packages/core/src/render3/view_engine_compatibility.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fview_engine_compatibility.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -391,8 +391,8 @@ export function createContainerRef(\n       } else {\n         // The TNode created here is bogus, in that it is not added to the TView. It is only created\n         // to allow us to create a dynamic Comment node.\n-        const commentTNode = createTNode(\n-            hostView[TVIEW], hostTNode.parent, TNodeType.Container, hostTNode.type, null, null);\n+        const commentTNode =\n+            createTNode(hostView[TVIEW], hostTNode.parent, TNodeType.Container, 0, null, null);\n         appendChild(hostView[TVIEW], hostView, commentNode, commentTNode);\n       }\n     }"
        },
        {
            "sha": "bcbce5a482c35d4cfeb5dc4fa39b7a854054485f",
            "filename": "packages/core/test/acceptance/i18n_spec.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 42,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -652,12 +652,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         const lViewDebug = lView.debug!;\n         fixture.detectChanges();\n         expect((fixture.nativeElement as Element).textContent).toEqual('just now');\n-        expect(lViewDebug.nodes.map(toTypeContent)).toEqual(['IcuContainer(<!--ICU 0:0-->)']);\n+        expect(lViewDebug.nodes.map(toTypeContent)).toEqual(['IcuContainer(<!--ICU 20:0-->)']);\n         // We want to ensure that the ICU container does not have any content!\n         // This is because the content is instance dependent and therefore can't be shared\n         // across `TNode`s.\n         expect(lViewDebug.nodes[0].children.map(toTypeContent)).toEqual([]);\n-        expect(fixture.nativeElement.innerHTML).toEqual('just now<!--ICU 0:0-->');\n+        expect(fixture.nativeElement.innerHTML).toEqual('just now<!--ICU 20:0-->');\n       });\n \n       it('should support multiple ICUs', () => {\n@@ -674,15 +674,15 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         `);\n         const lView = getComponentLView(fixture.componentInstance);\n         expect(lView.debug!.nodes.map(toTypeContent)).toEqual([\n-          'IcuContainer(<!--ICU 0:0-->)',\n-          'IcuContainer(<!--ICU 1:0-->)',\n+          'IcuContainer(<!--ICU 20:0-->)',\n+          'IcuContainer(<!--ICU 21:0-->)',\n         ]);\n         // We want to ensure that the ICU container does not have any content!\n         // This is because the content is instance dependent and therefore can't be shared\n         // across `TNode`s.\n         expect(lView.debug!.nodes[0].children.map(toTypeContent)).toEqual([]);\n         expect(fixture.nativeElement.innerHTML)\n-            .toEqual('just now<!--ICU 0:0-->Mr. Angular<!--ICU 1:0-->');\n+            .toEqual('just now<!--ICU 20:0-->Mr. Angular<!--ICU 21:0-->');\n       });\n     });\n   });\n@@ -778,19 +778,19 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         other {({{name}})}\n       }</div>`);\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>aucun <b>email</b>!<!--ICU 1:0--> - (Angular)<!--ICU 1:3--></div>`);\n+          .toEqual(`<div>aucun <b>email</b>!<!--ICU 21:0--> - (Angular)<!--ICU 21:3--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<div>4 <span title=\"Angular\">emails</span><!--ICU 1:0--> - (Angular)<!--ICU 1:3--></div>`);\n+              `<div>4 <span title=\"Angular\">emails</span><!--ICU 21:0--> - (Angular)<!--ICU 21:3--></div>`);\n \n       fixture.componentRef.instance.count = 0;\n       fixture.componentRef.instance.name = 'John';\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>aucun <b>email</b>!<!--ICU 1:0--> - (John)<!--ICU 1:3--></div>`);\n+          .toEqual(`<div>aucun <b>email</b>!<!--ICU 21:0--> - (John)<!--ICU 21:3--></div>`);\n     });\n \n     it('with custom interpolation config', () => {\n@@ -829,19 +829,19 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>aucun <b>email</b>!<!--ICU 1:0--></span>` +\n+              `<span>aucun <b>email</b>!<!--ICU 21:0--></span>` +\n               ` - ` +\n-              `<span>(Angular)<!--ICU 1:3--></span>` +\n+              `<span>(Angular)<!--ICU 21:3--></span>` +\n               `</div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>4 <span title=\"Angular\">emails</span><!--ICU 1:0--></span>` +\n+              `<span>4 <span title=\"Angular\">emails</span><!--ICU 21:0--></span>` +\n               ` - ` +\n-              `<span>(Angular)<!--ICU 1:3--></span>` +\n+              `<span>(Angular)<!--ICU 21:3--></span>` +\n               `</div>`);\n \n       fixture.componentRef.instance.count = 0;\n@@ -850,9 +850,9 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>aucun <b>email</b>!<!--ICU 1:0--></span>` +\n+              `<span>aucun <b>email</b>!<!--ICU 21:0--></span>` +\n               ` - ` +\n-              `<span>(John)<!--ICU 1:3--></span>` +\n+              `<span>(John)<!--ICU 21:3--></span>` +\n               `</div>`);\n     });\n \n@@ -867,7 +867,7 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         other {({{name}})}\n       }</span></div>`);\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div><span>(Angular)<!--ICU 0:0--></span><!--bindings={\n+          .toEqual(`<div><span>(Angular)<!--ICU 20:0--></span><!--bindings={\n   \"ng-reflect-ng-if\": \"true\"\n }--></div>`);\n \n@@ -886,7 +886,8 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       const fixture = initWithTemplate(AppComp, `<ng-container i18n>{name, select,\n         other {({{name}})}\n       }</ng-container>`);\n-      expect(fixture.nativeElement.innerHTML).toEqual(`(Angular)<!--ICU 1:0--><!--ng-container-->`);\n+      expect(fixture.nativeElement.innerHTML)\n+          .toEqual(`(Angular)<!--ICU 21:0--><!--ng-container-->`);\n     });\n \n     it('inside <ng-template>', () => {\n@@ -921,12 +922,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n                        other {animals}\n                      }!}\n       }</div>`);\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 1:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 21:1--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>4 animaux<!--nested ICU 0-->!<!--ICU 1:1--></div>`);\n+          .toEqual(`<div>4 animaux<!--nested ICU 0-->!<!--ICU 21:1--></div>`);\n     });\n \n     it('nested with interpolations in \"other\" blocks', () => {\n@@ -946,16 +947,16 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n                      }!}\n         other {other - {{count}}}\n       }</div>`);\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 1:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 21:1--></div>`);\n \n       fixture.componentRef.instance.count = 2;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>2 animaux<!--nested ICU 0-->!<!--ICU 1:1--></div>`);\n+          .toEqual(`<div>2 animaux<!--nested ICU 0-->!<!--ICU 21:1--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>autre - 4<!--ICU 1:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>autre - 4<!--ICU 21:1--></div>`);\n     });\n \n     it('should return the correct plural form for ICU expressions when using \"ro\" locale', () => {\n@@ -988,31 +989,31 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n             =other {lots of emails}\n           }`);\n \n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n \n       // Change detection cycle, no model changes\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 3;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 10;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 20;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 0;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n     });\n \n     it(`should return the correct plural form for ICU expressions when using \"es\" locale`, () => {\n@@ -1039,31 +1040,31 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n             =other {lots of emails}\n           }`);\n \n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n \n       // Change detection cycle, no model changes\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 3;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 10;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 20;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n \n       fixture.componentInstance.count = 0;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 0:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n     });\n \n     it('projection', () => {\n@@ -1158,12 +1159,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       const fixture = TestBed.createComponent(App);\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>ONE<!--ICU 1:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>ONE<!--ICU 21:0--></div><!--container--></my-cmp>');\n \n       fixture.componentRef.instance.count = 2;\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>OTHER<!--ICU 1:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>OTHER<!--ICU 21:0--></div><!--container--></my-cmp>');\n \n       // destroy component\n       fixture.componentInstance.condition = false;\n@@ -1175,7 +1176,7 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>ONE<!--ICU 1:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>ONE<!--ICU 21:0--></div><!--container--></my-cmp>');\n     });\n \n     it('with nested ICU expression and inside a container when creating a view via vcr.createEmbeddedView',\n@@ -1247,12 +1248,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n          fixture.detectChanges();\n          expect(fixture.debugElement.nativeElement.innerHTML)\n              .toBe(\n-                 '<my-cmp><div>2 animals<!--nested ICU 0-->!<!--ICU 1:1--></div><!--container--></my-cmp>');\n+                 '<my-cmp><div>2 animals<!--nested ICU 0-->!<!--ICU 21:1--></div><!--container--></my-cmp>');\n \n          fixture.componentRef.instance.count = 1;\n          fixture.detectChanges();\n          expect(fixture.debugElement.nativeElement.innerHTML)\n-             .toBe('<my-cmp><div>ONE<!--ICU 1:1--></div><!--container--></my-cmp>');\n+             .toBe('<my-cmp><div>ONE<!--ICU 21:1--></div><!--container--></my-cmp>');\n        });\n \n     it('with nested containers', () => {\n@@ -2369,13 +2370,13 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<child><div>Contenu enfant et projection depuis Parent<!--ICU 1:0--></div></child>`);\n+              `<child><div>Contenu enfant et projection depuis Parent<!--ICU 21:0--></div></child>`);\n \n       fixture.componentRef.instance.name = 'angular';\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<child><div>Contenu enfant et projection depuis Angular<!--ICU 1:0--></div></child>`);\n+              `<child><div>Contenu enfant et projection depuis Angular<!--ICU 21:0--></div></child>`);\n     });\n \n     it(`shouldn't project deleted projections in i18n blocks`, () => {"
        },
        {
            "sha": "2921d9a2e71e0fce8d48ea82c5676c3f60edc7fe",
            "filename": "packages/core/test/render3/i18n/i18n_insert_before_index_spec.ts",
            "status": "modified",
            "additions": 42,
            "deletions": 42,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -54,44 +54,44 @@ describe('addTNodeAndUpdateInsertBeforeIndex', () => {\n     describe('whose index is smaller than current nodes', () => {\n       it('should update the previous insertBeforeIndex', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20),\n           tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(19));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(20));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 19}),\n-          matchTNode({index: 21, insertBeforeIndex: 19}),\n-          matchTNode({index: 19, insertBeforeIndex: null}),\n+          matchTNode({index: 21, insertBeforeIndex: 20}),\n+          matchTNode({index: 22, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is already set', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20, 19),\n-          tPlaceholderElementNode(21, 19),\n-          tPlaceholderElementNode(19),\n+          tPlaceholderElementNode(22, 21),\n+          tPlaceholderElementNode(23, 21),\n+          tPlaceholderElementNode(21),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(18));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(20));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 19}),\n-          matchTNode({index: 21, insertBeforeIndex: 19}),\n-          matchTNode({index: 19, insertBeforeIndex: 18}),\n-          matchTNode({index: 18, insertBeforeIndex: null}),\n+          matchTNode({index: 22, insertBeforeIndex: 21}),\n+          matchTNode({index: 23, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is created after', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20, 15),\n-          tPlaceholderElementNode(21, 15),\n-          tPlaceholderElementNode(15),\n+          tPlaceholderElementNode(25, 20),\n+          tPlaceholderElementNode(26, 20),\n+          tPlaceholderElementNode(20),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(18));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(23));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 15}),\n-          matchTNode({index: 21, insertBeforeIndex: 15}),\n-          matchTNode({index: 15, insertBeforeIndex: null}),\n-          matchTNode({index: 18, insertBeforeIndex: null}),\n+          matchTNode({index: 25, insertBeforeIndex: 20}),\n+          matchTNode({index: 26, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: null}),\n+          matchTNode({index: 23, insertBeforeIndex: null}),\n         ]);\n       });\n     });\n@@ -116,44 +116,44 @@ describe('addTNodeAndUpdateInsertBeforeIndex', () => {\n     describe('whose index is smaller than current nodes', () => {\n       it('should update the previous insertBeforeIndex', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20),\n           tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(19));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(20));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 19}),\n-          matchTNode({index: 21, insertBeforeIndex: 19}),\n-          matchTNode({index: 19, insertBeforeIndex: null}),\n+          matchTNode({index: 21, insertBeforeIndex: 20}),\n+          matchTNode({index: 22, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is already set', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20, 19),\n-          tPlaceholderElementNode(21, 19),\n-          tPlaceholderElementNode(19),\n+          tPlaceholderElementNode(22, 21),\n+          tPlaceholderElementNode(23, 21),\n+          tPlaceholderElementNode(21),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(18));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(20));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 19}),\n-          matchTNode({index: 21, insertBeforeIndex: 19}),\n-          matchTNode({index: 19, insertBeforeIndex: 18}),\n-          matchTNode({index: 18, insertBeforeIndex: null}),\n+          matchTNode({index: 22, insertBeforeIndex: 21}),\n+          matchTNode({index: 23, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is created after', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20, 15),\n-          tPlaceholderElementNode(21, 15),\n-          tPlaceholderElementNode(15),\n+          tPlaceholderElementNode(25, 20),\n+          tPlaceholderElementNode(26, 20),\n+          tPlaceholderElementNode(20),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(18));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(23));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 15}),\n-          matchTNode({index: 21, insertBeforeIndex: 15}),\n-          matchTNode({index: 15, insertBeforeIndex: 18}),\n-          matchTNode({index: 18, insertBeforeIndex: null}),\n+          matchTNode({index: 25, insertBeforeIndex: 20}),\n+          matchTNode({index: 26, insertBeforeIndex: 20}),\n+          matchTNode({index: 20, insertBeforeIndex: 23}),\n+          matchTNode({index: 23, insertBeforeIndex: null}),\n         ]);\n       });\n     });"
        },
        {
            "sha": "339453a1b0134ecc0f9a11cb3d59c966bc832adb",
            "filename": "packages/core/test/render3/i18n/i18n_parse_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 19,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -45,7 +45,7 @@ describe('i18n_parse', () => {\n       // 21: Binding for ICU        |\n       //                   ----- EXPANDO -----\n       // 22: null                   | #text(before|)\n-      // 23: TIcu                   | <!-- ICU 0:0 -->\n+      // 23: TIcu                   | <!-- ICU 20:0 -->\n       // 24: null                   | currently selected ICU case\n       // 25: null                   | #text(caseA)\n       // 26: null                   | #text(otherCase)\n@@ -59,7 +59,7 @@ describe('i18n_parse', () => {\n         create: matchDebug([\n           'lView[22] = document.createText(\"before|\");',\n           'parent.appendChild(lView[22]);',\n-          'lView[23] = document.createComment(\"ICU 0:0\");',\n+          'lView[23] = document.createComment(\"ICU 20:0\");',\n           'parent.appendChild(lView[23]);',\n           'lView[27] = document.createText(\"|after\");',\n           'parent.appendChild(lView[27]);',\n@@ -95,22 +95,22 @@ describe('i18n_parse', () => {\n \n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('before|<!--ICU 0:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|<!--ICU 20:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 0:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 20:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|otherCase<!--ICU 0:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|otherCase<!--ICU 20:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 0:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 20:0-->|after');\n       });\n     });\n \n@@ -122,23 +122,23 @@ describe('i18n_parse', () => {\n       }`);\n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('<!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n         expect(fixture.host.innerHTML)\n-            .toEqual('<div>nestedOther<!--nested ICU 0--></div><!--ICU 0:0-->');\n+            .toEqual('<div>nestedOther<!--nested ICU 0--></div><!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 20:0-->');\n       });\n     });\n \n@@ -154,7 +154,7 @@ describe('i18n_parse', () => {\n       // 22: Binding for child ICU  |\n       // 23: Binding for child ICU  |\n       //                   ----- EXPANDO -----\n-      // 24: TIcu (parent)          | <!-- ICU 0:0 -->\n+      // 24: TIcu (parent)          | <!-- ICU 20:0 -->\n       // 25: null                   | currently selected ICU case\n       // 26: null                   | #text( parentA )\n       // 27: TIcu (child)           | <!-- nested ICU 0 -->\n@@ -170,7 +170,7 @@ describe('i18n_parse', () => {\n         }`);\n       expect(tI18n).toEqual(matchTI18n({\n         create: matchDebug([\n-          'lView[24] = document.createComment(\"ICU 0:0\");',\n+          'lView[24] = document.createComment(\"ICU 20:0\");',\n           'parent.appendChild(lView[24]);',\n         ]),\n         update: matchDebug([\n@@ -244,45 +244,46 @@ describe('i18n_parse', () => {\n \n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('<!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('0');\n         ɵɵi18nExp('value1');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentA nested0<!--nested ICU 0-->!<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML)\n+            .toEqual('parentA nested0<!--nested ICU 0-->!<!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('value1');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentA value1<!--nested ICU 0-->!<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentA value1<!--nested ICU 0-->!<!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('value2');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentOther<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentOther<!--ICU 20:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('value2');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentA value2<!--nested ICU 0-->!<!--ICU 0:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentA value2<!--nested ICU 0-->!<!--ICU 20:0-->');\n       });\n     });\n   });\n \n   function toT18n(text: string) {\n-    const tNodeIndex = 0;\n+    const tNodeIndex = HEADER_OFFSET;\n     fixture.enterView();\n     i18nStartFirstCreatePass(fixture.tView, 0, fixture.lView, tNodeIndex, text, -1);\n     fixture.leaveView();\n-    const tI18n = fixture.tView.data[tNodeIndex + HEADER_OFFSET] as TI18n;\n+    const tI18n = fixture.tView.data[tNodeIndex] as TI18n;\n     expect(tI18n).toEqual(matchTI18n({}));\n     return tI18n;\n   }"
        },
        {
            "sha": "cd72a4dec26ab09a5b4fc7101c27deca666f69aa",
            "filename": "packages/core/test/render3/i18n/i18n_spec.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 25,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -67,7 +67,7 @@ describe('Runtime i18n', () => {\n     const fixture = new TemplateFixture(\n         {create: createTemplate, update: updateTemplate, decls: nbDecls, consts: [messageOrAtrs]});\n     tView = fixture.hostView[TVIEW];\n-    return tView.data[index + HEADER_OFFSET] as TI18n;\n+    return tView.data[index] as TI18n | I18nUpdateOpCodes;\n   }\n \n   describe('i18nStart', () => {\n@@ -79,7 +79,7 @@ describe('Runtime i18n', () => {\n                         ɵɵelementStart(0, 'div');\n                         ɵɵi18nStart(index, 0);\n                         ɵɵelementEnd();\n-                      }, undefined, nbConsts, index) as TI18n;\n+                      }, undefined, nbConsts, HEADER_OFFSET + index) as TI18n;\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -100,7 +100,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -125,7 +125,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect((opCodes as any).update.debug).toEqual([\n         'if (mask & 0b1) { (lView[22] as Text).textContent = `Hello ${lView[i-1]}!`; }'\n@@ -150,7 +150,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -183,7 +183,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -205,7 +205,7 @@ describe('Runtime i18n', () => {\n       opCodes = getOpCodes(message, () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0, 1);\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, index + HEADER_OFFSET);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -223,7 +223,7 @@ describe('Runtime i18n', () => {\n       opCodes = getOpCodes(message, () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nStart(index, 0, 2);\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, index + HEADER_OFFSET);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n@@ -245,11 +245,11 @@ describe('Runtime i18n', () => {\n                         ɵɵelementStart(0, 'div');\n                         ɵɵi18nStart(index, 0);\n                         ɵɵelementEnd();\n-                      }, undefined, nbConsts, index) as TI18n;\n+                      }, undefined, nbConsts, HEADER_OFFSET + index) as TI18n;\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n-          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 1:0\");`,\n+          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 21:0\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n@@ -332,11 +332,11 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18n(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n-          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 1:0\");`,\n+          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 21:0\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n@@ -432,11 +432,11 @@ describe('Runtime i18n', () => {\n         consts: [attrs],\n       });\n       const tView = fixture.hostView[TVIEW];\n-      const opCodes = tView.data[index + HEADER_OFFSET] as I18nUpdateOpCodes;\n+      const opCodes = tView.data[HEADER_OFFSET + index] as I18nUpdateOpCodes;\n \n       expect(opCodes).toEqual([]);\n-      expect(\n-          (getNativeByIndex(0, fixture.hostView as LView) as any as Element).getAttribute('title'))\n+      expect((getNativeByIndex(HEADER_OFFSET, fixture.hostView as LView) as any as Element)\n+                 .getAttribute('title'))\n           .toEqual(message);\n     });\n \n@@ -449,7 +449,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nAttributes(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n         'if (mask & 0b1) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n@@ -465,7 +465,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nAttributes(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n         'if (mask & 0b11) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]} and ${lView[i-2]}, again ${lView[i-1]}!`); }',\n@@ -481,7 +481,7 @@ describe('Runtime i18n', () => {\n         ɵɵelementStart(0, 'div');\n         ɵɵi18nAttributes(index, 0);\n         ɵɵelementEnd();\n-      }, undefined, nbConsts, index);\n+      }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n         'if (mask & 0b1) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n@@ -631,14 +631,12 @@ describe('Runtime i18n', () => {\n \n   describe('i18nStartFirstCreatePass', () => {\n     let fixture: ViewFixture;\n-    let divTNode: TElementNode;\n     const DECLS = 20;\n     const VARS = 10;\n     beforeEach(() => {\n       fixture = new ViewFixture({decls: DECLS, vars: VARS});\n       fixture.enterView();\n       ɵɵelementStart(0, 'div');\n-      divTNode = getCurrentTNode() as TElementNode;\n     });\n \n     afterEach(ViewFixture.cleanUp);\n@@ -661,7 +659,8 @@ describe('Runtime i18n', () => {\n     }\n \n     it('should process text node with no siblings and no children', () => {\n-      i18nStartFirstCreatePass(fixture.tView, 0, fixture.lView, 1, 'Hello World!', -1);\n+      i18nStartFirstCreatePass(\n+          fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1, 'Hello World!', -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       // Expect that we only create the `Hello World!` text node and nothing else.\n       expect(ti18n.create).toEqual([\n@@ -672,7 +671,8 @@ describe('Runtime i18n', () => {\n     });\n \n     it('should process text with a child node', () => {\n-      i18nStartFirstCreatePass(fixture.tView, 0, fixture.lView, 1, 'Hello �#2��/#2�!', -1);\n+      i18nStartFirstCreatePass(\n+          fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1, 'Hello �#2��/#2�!', -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       expect(ti18n.create).toEqual([\n         i18nRangeOffsetOpcode(0), 'Hello ',  //\n@@ -689,7 +689,8 @@ describe('Runtime i18n', () => {\n     });\n \n     it('should process text with a child node that has text', () => {\n-      i18nStartFirstCreatePass(fixture.tView, 0, fixture.lView, 1, 'Hello �#2�World�/#2�!', -1);\n+      i18nStartFirstCreatePass(\n+          fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1, 'Hello �#2�World�/#2�!', -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       expect(ti18n.create).toEqual([\n         i18nRangeOffsetOpcode(0), 'Hello ',                      //\n@@ -708,7 +709,7 @@ describe('Runtime i18n', () => {\n \n     it('should process text with a child node that has text and with bindings', () => {\n       i18nStartFirstCreatePass(\n-          fixture.tView, 0, fixture.lView, 1,\n+          fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1,\n           '�0� �#2��1��/#2�!' /* {{salutation}} <b>{{name}}</b>! */, -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       expect(ti18n.create).toEqual([\n@@ -733,7 +734,8 @@ describe('Runtime i18n', () => {\n     });\n \n     it('should process text with a child template', () => {\n-      i18nStartFirstCreatePass(fixture.tView, 0, fixture.lView, 1, 'Hello �*2:1�World�/*2:1�!', -1);\n+      i18nStartFirstCreatePass(\n+          fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1, 'Hello �*2:1�World�/*2:1�!', -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       expect(ti18n.create.debug).toEqual([\n         'lView[50] = document.createText(\"Hello \");',"
        },
        {
            "sha": "c994820acedc4434bf1bb49df323334236464929",
            "filename": "packages/core/test/render3/instructions/shared_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fshared_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -10,7 +10,7 @@ import {createLView, createTNode, createTView} from '@angular/core/src/render3/i\n import {TNodeType} from '@angular/core/src/render3/interfaces/node';\n import {domRendererFactory3} from '@angular/core/src/render3/interfaces/renderer';\n import {HEADER_OFFSET, LViewFlags, TVIEW, TViewType} from '@angular/core/src/render3/interfaces/view';\n-import {enterView, getBindingRoot, getLView, setBindingIndex} from '@angular/core/src/render3/state';\n+import {enterView, getBindingRoot, getLView, setBindingIndex, setSelectedIndex} from '@angular/core/src/render3/state';\n \n \n \n@@ -43,9 +43,10 @@ export function enterViewWithOneDiv() {\n   const lView = createLView(\n       null, tView, null, LViewFlags.CheckAlways, null, null, domRendererFactory3, renderer, null,\n       null);\n-  lView[0 + HEADER_OFFSET] = div;\n-  tView.data[0 + HEADER_OFFSET] = tNode;\n+  lView[HEADER_OFFSET] = div;\n+  tView.data[HEADER_OFFSET] = tNode;\n   enterView(lView);\n+  setSelectedIndex(HEADER_OFFSET);\n }\n \n export function clearFirstUpdatePass() {"
        },
        {
            "sha": "2e5abdf4ab79057ffe086a5c82a3df39a65d7fea",
            "filename": "packages/core/test/render3/instructions/styling_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fstyling_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fstyling_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Fstyling_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -14,8 +14,6 @@ import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePre\n import {HEADER_OFFSET, TVIEW} from '@angular/core/src/render3/interfaces/view';\n import {getLView, leaveView, setBindingRootForHostBindings} from '@angular/core/src/render3/state';\n import {getNativeByIndex} from '@angular/core/src/render3/util/view_utils';\n-import {bypassSanitizationTrustStyle} from '@angular/core/src/sanitization/bypass';\n-import {ɵɵsanitizeStyle} from '@angular/core/src/sanitization/sanitization';\n import {keyValueArraySet} from '@angular/core/src/util/array_utils';\n import {ngDevModeResetPerfCounters} from '@angular/core/src/util/ng_dev_mode';\n import {getElementClasses, getElementStyles} from '@angular/core/testing/src/styling';\n@@ -28,7 +26,7 @@ describe('styling', () => {\n   afterEach(leaveView);\n \n   let div!: HTMLElement;\n-  beforeEach(() => div = getNativeByIndex(0, getLView()) as HTMLElement);\n+  beforeEach(() => div = getNativeByIndex(HEADER_OFFSET, getLView()) as HTMLElement);\n \n   it('should do set basic style', () => {\n     ɵɵstyleProp('color', 'red');"
        },
        {
            "sha": "8adc97ccdce9fa60fe1f5c128abf35903aa2c294",
            "filename": "packages/core/test/render3/listeners_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Flisteners_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Flisteners_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Flisteners_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -6,14 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n import {dispatchEvent} from '@angular/platform-browser/testing/src/browser_util';\n-\n import {ɵɵdefineComponent, ɵɵdefineDirective, ɵɵreference, ɵɵresolveBody, ɵɵresolveDocument} from '../../src/render3/index';\n import {ɵɵelement, ɵɵelementEnd, ɵɵelementStart, ɵɵgetCurrentView, ɵɵlistener, ɵɵtext} from '../../src/render3/instructions/all';\n import {RenderFlags} from '../../src/render3/interfaces/definition';\n import {GlobalTargetResolver} from '../../src/render3/interfaces/renderer';\n import {ɵɵrestoreView} from '../../src/render3/state';\n-\n import {getRendererFactory2} from './imported_renderer2';\n import {ComponentFixture, containerEl, createComponent, getDirectiveOnNode, renderToHtml, TemplateFixture} from './render_util';\n \n@@ -497,7 +496,7 @@ describe('event listeners', () => {\n               }\n \n               // testing only\n-              compInstance = getDirectiveOnNode(0);\n+              compInstance = getDirectiveOnNode(HEADER_OFFSET);\n             },\n         directives: [Comp]\n       });"
        },
        {
            "sha": "01964b9140154022b9349ccdc4a74fa714e2a7c9",
            "filename": "packages/core/test/render3/matchers_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -56,7 +56,7 @@ describe('render3 matchers', () => {\n   });\n   describe('matchTNode', () => {\n     const tView = createTView(TViewType.Root, null, null, 2, 3, null, null, null, null, null);\n-    const tNode = createTNode(tView, null, TNodeType.Element, 1, 'tagName', []);\n+    const tNode = createTNode(tView, null, TNodeType.Element, 0, 'tagName', []);\n \n     it('should match', () => {\n       expect(tNode).toEqual(matchTNode());"
        },
        {
            "sha": "586f29ce25ea2dc6c7555cfc9cecb449a2256093",
            "filename": "packages/core/test/render3/query_spec.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 27,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fquery_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {ElementRef, QueryList, TemplateRef, ViewContainerRef} from '@angular/core';\n+import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n \n import {AttributeMarker, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵProvidersFeature} from '../../src/render3/index';\n import {ɵɵdirectiveInject, ɵɵelement, ɵɵelementContainerEnd, ɵɵelementContainerStart, ɵɵelementEnd, ɵɵelementStart, ɵɵtemplate, ɵɵtext} from '../../src/render3/instructions/all';\n@@ -72,8 +73,8 @@ describe('query', () => {\n             ɵɵelementEnd();\n           }\n           if (rf & RenderFlags.Update) {\n-            child1 = getDirectiveOnNode(0);\n-            child2 = getDirectiveOnNode(1);\n+            child1 = getDirectiveOnNode(HEADER_OFFSET);\n+            child2 = getDirectiveOnNode(HEADER_OFFSET + 1);\n           }\n         },\n         2, 0, [Child], [],\n@@ -112,7 +113,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', 0);\n-                elToQuery = getNativeByIndex(0, getLView());\n+                elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n               }\n             },\n             1, 0, [Child], [],\n@@ -150,7 +151,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelementStart(0, 'div', 0);\n-                { otherChildInstance = getDirectiveOnNode(0, 1); }\n+                { otherChildInstance = getDirectiveOnNode(HEADER_OFFSET, 1); }\n                 ɵɵelementEnd();\n               }\n             },\n@@ -345,7 +346,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', null, 0);\n-                elToQuery = getNativeByIndex(0, getLView());\n+                elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                 ɵɵelement(2, 'div');\n               }\n             },\n@@ -384,7 +385,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', null, 0);\n-                elToQuery = getNativeByIndex(0, getLView());\n+                elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                 ɵɵelement(3, 'div');\n               }\n             },\n@@ -431,10 +432,10 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', null, 0);\n-                el1ToQuery = getNativeByIndex(0, getLView());\n+                el1ToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                 ɵɵelement(2, 'div');\n                 ɵɵelement(3, 'div', null, 1);\n-                el2ToQuery = getNativeByIndex(3, getLView());\n+                el2ToQuery = getNativeByIndex(HEADER_OFFSET + 3, getLView());\n               }\n             },\n             5, 0, [], [],\n@@ -471,7 +472,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', null, 0);\n-                elToQuery = getNativeByIndex(0, getLView());\n+                elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                 ɵɵelement(2, 'div');\n               }\n             },\n@@ -509,7 +510,7 @@ describe('query', () => {\n                function(rf: RenderFlags, ctx: any) {\n                  if (rf & RenderFlags.Create) {\n                    ɵɵelementContainerStart(0, null, 0);\n-                   elToQuery = getNativeByIndex(0, getLView());\n+                   elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                    ɵɵelementContainerEnd();\n                  }\n                },\n@@ -546,7 +547,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelementContainerStart(0, null, 0);\n-                elToQuery = getNativeByIndex(0, getLView());\n+                elToQuery = getNativeByIndex(HEADER_OFFSET, getLView());\n                 ɵɵelementContainerEnd();\n               }\n             },\n@@ -756,7 +757,7 @@ describe('query', () => {\n                 ɵɵelement(0, 'child', null, 0);\n               }\n               if (rf & RenderFlags.Update) {\n-                childInstance = getDirectiveOnNode(0);\n+                childInstance = getDirectiveOnNode(HEADER_OFFSET);\n               }\n             },\n             2, 0, [Child], [],\n@@ -843,7 +844,7 @@ describe('query', () => {\n                    ɵɵelement(0, 'div', 0, 1);\n                  }\n                  if (rf & RenderFlags.Update) {\n-                   childInstance = getDirectiveOnNode(0);\n+                   childInstance = getDirectiveOnNode(HEADER_OFFSET);\n                  }\n                },\n                2, 0, [Child], [],\n@@ -883,8 +884,8 @@ describe('query', () => {\n                 ɵɵelement(0, 'div', 0, 1);\n               }\n               if (rf & RenderFlags.Update) {\n-                child1Instance = getDirectiveOnNode(0, 0);\n-                child2Instance = getDirectiveOnNode(0, 1);\n+                child1Instance = getDirectiveOnNode(HEADER_OFFSET, 0);\n+                child2Instance = getDirectiveOnNode(HEADER_OFFSET, 1);\n               }\n             },\n             3, 0, [Child1, Child2], [],\n@@ -925,7 +926,7 @@ describe('query', () => {\n                 ɵɵelement(0, 'div', 0, 1);\n               }\n               if (rf & RenderFlags.Update) {\n-                childInstance = getDirectiveOnNode(0);\n+                childInstance = getDirectiveOnNode(HEADER_OFFSET);\n               }\n             },\n             3, 0, [Child], [],\n@@ -970,7 +971,7 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', 0, 1);\n-                div = getNativeByIndex(0, getLView());\n+                div = getNativeByIndex(HEADER_OFFSET, getLView());\n               }\n             },\n             2, 0, [Child], [],\n@@ -1007,10 +1008,10 @@ describe('query', () => {\n             function(rf: RenderFlags, ctx: any) {\n               if (rf & RenderFlags.Create) {\n                 ɵɵelement(0, 'div', 0, 1);\n-                div = getNativeByIndex(0, getLView());\n+                div = getNativeByIndex(HEADER_OFFSET, getLView());\n               }\n               if (rf & RenderFlags.Update) {\n-                childInstance = getDirectiveOnNode(0);\n+                childInstance = getDirectiveOnNode(HEADER_OFFSET);\n               }\n             },\n             3, 0, [Child], [],\n@@ -1570,8 +1571,8 @@ describe('query', () => {\n             }\n             if (rf & RenderFlags.Update) {\n               const lView = getLView();\n-              outInstance = load<QueryDirective>(lView, 1);\n-              inInstance = load<QueryDirective>(lView, 5);\n+              outInstance = load<QueryDirective>(lView, HEADER_OFFSET + 1);\n+              inInstance = load<QueryDirective>(lView, HEADER_OFFSET + 5);\n             }\n           },\n           10, 0, [QueryDirective], [], null, [], [], undefined, [\n@@ -1632,8 +1633,8 @@ describe('query', () => {\n             }\n             if (rf & RenderFlags.Update) {\n               const lView = getLView();\n-              outInstance = load<QueryDirective>(lView, 1);\n-              inInstance = load<QueryDirective>(lView, 3);\n+              outInstance = load<QueryDirective>(lView, HEADER_OFFSET + 1);\n+              inInstance = load<QueryDirective>(lView, HEADER_OFFSET + 3);\n             }\n           },\n           7, 0, [QueryDirective], [], null, [], [], undefined, [\n@@ -1692,8 +1693,8 @@ describe('query', () => {\n             }\n             if (rf & RenderFlags.Update) {\n               const lView = getLView();\n-              outInstance = load<QueryDirective>(lView, 1);\n-              inInstance = load<QueryDirective>(lView, 3);\n+              outInstance = load<QueryDirective>(lView, HEADER_OFFSET + 1);\n+              inInstance = load<QueryDirective>(lView, HEADER_OFFSET + 3);\n             }\n           },\n           7, 0, [QueryDirective], [], null, [], [], undefined, [\n@@ -1783,8 +1784,8 @@ describe('query', () => {\n                }\n                if (rf & RenderFlags.Update) {\n                  const lView = getLView();\n-                 shallowInstance = load<ShallowQueryDirective>(lView, 1);\n-                 deepInstance = load<DeepQueryDirective>(lView, 2);\n+                 shallowInstance = load<ShallowQueryDirective>(lView, HEADER_OFFSET + 1);\n+                 deepInstance = load<DeepQueryDirective>(lView, HEADER_OFFSET + 2);\n                }\n              },\n              8, 0, [ShallowQueryDirective, DeepQueryDirective], [], null, [], [], undefined, ["
        },
        {
            "sha": "4f44afc48b2c3a2874b062f67b75e7983d098be3",
            "filename": "packages/core/test/render3/render_util.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Frender_util.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -17,7 +17,6 @@ import {TConstants, TNodeType} from '@angular/core/src/render3/interfaces/node';\n import {enterView, getLView} from '@angular/core/src/render3/state';\n import {EMPTY_ARRAY} from '@angular/core/src/util/empty';\n import {stringifyElement} from '@angular/platform-browser/testing/src/browser_util';\n-\n import {SWITCH_CHANGE_DETECTOR_REF_FACTORY__POST_R3__ as R3_CHANGE_DETECTOR_REF_FACTORY} from '../../src/change_detection/change_detector_ref';\n import {Injector} from '../../src/di/injector';\n import {Type} from '../../src/interface/type';\n@@ -33,11 +32,10 @@ import {ComponentDef, ComponentTemplate, ComponentType, DirectiveDef, DirectiveT\n import {DirectiveDefList, DirectiveDefListOrFactory, DirectiveTypesOrFactory, HostBindingsFunction, PipeDef, PipeDefList, PipeDefListOrFactory, PipeTypesOrFactory} from '../../src/render3/interfaces/definition';\n import {PlayerHandler} from '../../src/render3/interfaces/player';\n import {domRendererFactory3, ProceduralRenderer3, RComment, RElement, Renderer3, RendererFactory3, RendererStyleFlags3, RNode, RText} from '../../src/render3/interfaces/renderer';\n-import {HEADER_OFFSET, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../../src/render3/interfaces/view';\n+import {HEADER_OFFSET, LView, LViewFlags, TVIEW, TViewType} from '../../src/render3/interfaces/view';\n import {destroyLView} from '../../src/render3/node_manipulation';\n import {getRootView} from '../../src/render3/util/view_traversal_utils';\n import {Sanitizer} from '../../src/sanitization/sanitizer';\n-\n import {getRendererFactory2} from './imported_renderer2';\n \n \n@@ -434,7 +432,7 @@ export function createDirective(\n \n /** Gets the directive on the given node at the given index */\n export function getDirectiveOnNode(nodeIndex: number, dirIndex: number = 0) {\n-  const directives = getDirectivesAtNodeIndex(nodeIndex + HEADER_OFFSET, getLView(), true);\n+  const directives = getDirectivesAtNodeIndex(nodeIndex, getLView(), true);\n   if (directives == null) {\n     throw new Error(`No directives exist on node in slot ${nodeIndex}`);\n   }"
        },
        {
            "sha": "96f0415814209fae45471ca4946cfe9fe080e5a1",
            "filename": "packages/core/test/render3/view_container_ref_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/54303688fa28b9a57f51a48cbd064b1b70240d0a/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fview_container_ref_spec.ts?ref=54303688fa28b9a57f51a48cbd064b1b70240d0a",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n import {ChangeDetectorRef, Component as _Component, ComponentFactoryResolver, ElementRef, QueryList, TemplateRef, ViewContainerRef, ViewRef} from '../../src/core';\n import {ViewEncapsulation} from '../../src/metadata';\n import {injectComponentFactoryResolver, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵlistener, ɵɵloadQuery, ɵɵqueryRefresh, ɵɵviewQuery} from '../../src/render3/index';\n@@ -14,9 +15,9 @@ import {RenderFlags} from '../../src/render3/interfaces/definition';\n import {RElement} from '../../src/render3/interfaces/renderer';\n import {getLView} from '../../src/render3/state';\n import {getNativeByIndex} from '../../src/render3/util/view_utils';\n-\n import {ComponentFixture, createComponent, TemplateFixture} from './render_util';\n \n+\n const Component: typeof _Component = function(...args: any[]): any {\n   // In test we use @Component for documentation only so it's safe to mock out the implementation.\n   return () => undefined;\n@@ -362,7 +363,7 @@ describe('ViewContainerRef', () => {\n                   ɵɵelement(0, 'div', 1, 0);\n                 }\n                 // testing only\n-                fooEl = getNativeByIndex(0, getLView()) as RElement;\n+                fooEl = getNativeByIndex(HEADER_OFFSET, getLView()) as RElement;\n               },\n           viewQuery:\n               function(rf: RenderFlags, ctx: any) {"
        }
    ],
    "stats": {
        "total": 627,
        "additions": 308,
        "deletions": 319
    }
}