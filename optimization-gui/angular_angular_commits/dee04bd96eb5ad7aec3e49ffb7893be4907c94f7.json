{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): move `component` out of `TemplateContext` (#43232)\n\nMove `component` out of the `TemplateContext` so the context can be\nreused for multiple components.\n\nRefs #42966\n\nPR Close #43232",
    "sha": "dee04bd96eb5ad7aec3e49ffb7893be4907c94f7",
    "files": [
        {
            "sha": "23a7777ba249504c248ef978ff41ed23b09be955",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/api/api.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts?ref=dee04bd96eb5ad7aec3e49ffb7893be4907c94f7",
            "patch": "@@ -21,7 +21,8 @@ export interface TemplateCheck<T extends ErrorCode> {\n   code: T;\n \n   /** Runs check and returns information about the diagnostics to be generated. */\n-  run(ctx: TemplateContext, template: TmplAstNode[]): NgTemplateDiagnostic<T>[];\n+  run(ctx: TemplateContext, component: ts.ClassDeclaration,\n+      template: TmplAstNode[]): NgTemplateDiagnostic<T>[];\n }\n \n /**\n@@ -36,7 +37,4 @@ export interface TemplateContext {\n    * in the template (it is not to query types outside the Angular component).\n    */\n   typeChecker: ts.TypeChecker;\n-\n-  /** The `@Component()` class from which the template was obtained. */\n-  component: ts.ClassDeclaration;\n }"
        },
        {
            "sha": "800c6081e67e3771f8f95ccd12eccf4313b5e428",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/checks/invalid_banana_in_box/index.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Finvalid_banana_in_box%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Finvalid_banana_in_box%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Finvalid_banana_in_box%2Findex.ts?ref=dee04bd96eb5ad7aec3e49ffb7893be4907c94f7",
            "patch": "@@ -21,9 +21,9 @@ import {TemplateCheck, TemplateContext} from '../../api';\n export class InvalidBananaInBoxCheck implements TemplateCheck<ErrorCode.INVALID_BANANA_IN_BOX> {\n   code: ErrorCode.INVALID_BANANA_IN_BOX = 8101;\n \n-  run(ctx: TemplateContext,\n+  run(ctx: TemplateContext, component: ts.ClassDeclaration,\n       template: TmplAstNode[]): NgTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] {\n-    const visitor = new BananaVisitor(ctx);\n+    const visitor = new BananaVisitor(ctx, component);\n \n     return visitor.getDiagnostics(template);\n   }\n@@ -32,7 +32,8 @@ export class InvalidBananaInBoxCheck implements TemplateCheck<ErrorCode.INVALID_\n class BananaVisitor extends TmplAstRecursiveVisitor {\n   private diagnostics: NgTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] = [];\n \n-  constructor(public readonly ctx: TemplateContext) {\n+  constructor(\n+      public readonly ctx: TemplateContext, private readonly component: ts.ClassDeclaration) {\n     super();\n   }\n \n@@ -48,7 +49,7 @@ class BananaVisitor extends TmplAstRecursiveVisitor {\n       const boundSyntax = boundEvent.sourceSpan.toString();\n       const expectedBoundSyntax = boundSyntax.replace(`(${name})`, `[(${name.slice(1, -1)})]`);\n       this.diagnostics.push(this.ctx.templateTypeChecker.makeTemplateDiagnostic(\n-          this.ctx.component, boundEvent.sourceSpan, ts.DiagnosticCategory.Warning,\n+          this.component, boundEvent.sourceSpan, ts.DiagnosticCategory.Warning,\n           ErrorCode.INVALID_BANANA_IN_BOX,\n           `In the two-way binding syntax the parentheses should be inside the brackets, ex. '${\n               expectedBoundSyntax}'. "
        },
        {
            "sha": "9305f1f2064a86451160aed9c38b1f1c97818f11",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/extended_template_checker.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/dee04bd96eb5ad7aec3e49ffb7893be4907c94f7/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts?ref=dee04bd96eb5ad7aec3e49ffb7893be4907c94f7",
            "patch": "@@ -13,13 +13,17 @@ import {TemplateDiagnostic, TemplateTypeChecker} from '../../api';\n import {ExtendedTemplateChecker, TemplateCheck, TemplateContext} from '../api';\n \n export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n+  private ctx: TemplateContext;\n+\n   constructor(\n-      private readonly templateTypeChecker: TemplateTypeChecker,\n-      private readonly typeChecker: ts.TypeChecker,\n-      private readonly templateChecks: TemplateCheck<ErrorCode>[]) {}\n+      templateTypeChecker: TemplateTypeChecker, typeChecker: ts.TypeChecker,\n+      private readonly templateChecks: TemplateCheck<ErrorCode>[]) {\n+    this.ctx = {templateTypeChecker: templateTypeChecker, typeChecker: typeChecker} as\n+        TemplateContext;\n+  }\n \n   getDiagnosticsForComponent(component: ts.ClassDeclaration): TemplateDiagnostic[] {\n-    const template = this.templateTypeChecker.getTemplate(component);\n+    const template = this.ctx.templateTypeChecker.getTemplate(component);\n     // Skip checks if component has no template. This can happen if the user writes a\n     // `@Component()` but doesn't add the template, could happen in the language service\n     // when users are in the middle of typing code.\n@@ -28,14 +32,8 @@ export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n     }\n     const diagnostics: TemplateDiagnostic[] = [];\n \n-    const ctx = {\n-      templateTypeChecker: this.templateTypeChecker,\n-      typeChecker: this.typeChecker,\n-      component\n-    } as TemplateContext;\n-\n     for (const check of this.templateChecks) {\n-      diagnostics.push(...deduplicateDiagnostics(check.run(ctx, template)));\n+      diagnostics.push(...deduplicateDiagnostics(check.run(this.ctx, component, template)));\n     }\n \n     return diagnostics;"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 16,
        "deletions": 19
    }
}