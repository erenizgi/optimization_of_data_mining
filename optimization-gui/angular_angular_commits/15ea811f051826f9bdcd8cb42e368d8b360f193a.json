{
    "author": "atscott",
    "message": "feat(router): Add `relativeLinkResolution` migration to update default value (#38698)\n\nThe default value for `relativeLinkResolution` is changing from 'legacy' to 'corrected'.\nThis migration updates `RouterModule` configurations that use the default value to\nnow specifically use 'legacy' to prevent breakages when updating.\n\nPR Close #38698",
    "sha": "15ea811f051826f9bdcd8cb42e368d8b360f193a",
    "files": [
        {
            "sha": "375fcd5920b6327230fb20245aab3fdac599a1a5",
            "filename": "packages/core/schematics/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2FBUILD.bazel?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -15,6 +15,7 @@ pkg_npm(\n         \"//packages/core/schematics/migrations/module-with-providers\",\n         \"//packages/core/schematics/migrations/move-document\",\n         \"//packages/core/schematics/migrations/navigation-extras-omissions\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/renderer-to-renderer2\",\n         \"//packages/core/schematics/migrations/static-queries\",\n         \"//packages/core/schematics/migrations/template-var-assignment\","
        },
        {
            "sha": "b4d86667f6b98881af08c9075068b91c4b31d57e",
            "filename": "packages/core/schematics/migrations.json",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations.json?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -49,6 +49,11 @@\n       \"version\": \"11.0.0-beta\",\n       \"description\": \"NavigationExtras omissions migration. In version 11, some unsupported properties were omitted from the `extras` parameter of the `Router.navigateByUrl` and `Router.createUrlTree` methods.\",\n       \"factory\": \"./migrations/navigation-extras-omissions/index\"\n+    },\n+    \"migration-v11-router-relative-link-resolution-default\": {\n+      \"version\": \"11.0.0-beta\",\n+      \"description\": \"The default value for `relativeLinkResolution` is changing from 'legacy' to 'corrected'.\\nThis migration updates `RouterModule` configurations that use the default value to \\nnow specifically use 'legacy' to prevent breakages when updating.\",\n+      \"factory\": \"./migrations/relative-link-resolution/index\"\n     }\n   }\n }"
        },
        {
            "sha": "217e7bc90d77c4f27ec1153943dfa23998c31cb2",
            "filename": "packages/core/schematics/migrations/google3/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -10,6 +10,8 @@ ts_library(\n         \"//packages/core/schematics/migrations/missing-injectable\",\n         \"//packages/core/schematics/migrations/missing-injectable/google3\",\n         \"//packages/core/schematics/migrations/navigation-extras-omissions\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution/google3\",\n         \"//packages/core/schematics/migrations/renderer-to-renderer2\",\n         \"//packages/core/schematics/migrations/static-queries\",\n         \"//packages/core/schematics/migrations/template-var-assignment\","
        },
        {
            "sha": "3725981830ae7fc023864e92fe95c996c2bdb196",
            "filename": "packages/core/schematics/migrations/google3/relativeLinkResolutionDefaultRule.ts",
            "status": "added",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FrelativeLinkResolutionDefaultRule.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FrelativeLinkResolutionDefaultRule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FrelativeLinkResolutionDefaultRule.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,48 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {RuleFailure, Rules} from 'tslint';\n+import * as ts from 'typescript';\n+\n+import {RelativeLinkResolutionCollector} from '../relative-link-resolution/collector';\n+import {TslintUpdateRecorder} from '../relative-link-resolution/google3/tslint_update_recorder';\n+import {RelativeLinkResolutionTransform} from '../relative-link-resolution/transform';\n+\n+export class Rule extends Rules.TypedRule {\n+  applyWithProgram(sourceFile: ts.SourceFile, program: ts.Program): RuleFailure[] {\n+    const typeChecker = program.getTypeChecker();\n+    const ruleName = this.ruleName;\n+    const sourceFiles = program.getSourceFiles().filter(\n+        s => !s.isDeclarationFile && !program.isSourceFileFromExternalLibrary(s));\n+    const updateRecorders = new Map<ts.SourceFile, TslintUpdateRecorder>();\n+    const relativeLinkResolutionCollector = new RelativeLinkResolutionCollector(typeChecker);\n+\n+    // Analyze source files by detecting all modules.\n+    sourceFiles.forEach(sourceFile => relativeLinkResolutionCollector.visitNode(sourceFile));\n+\n+    const {forRootCalls, extraOptionsLiterals} = relativeLinkResolutionCollector;\n+    const transformer = new RelativeLinkResolutionTransform(getUpdateRecorder);\n+    transformer.migrateRouterModuleForRootCalls(forRootCalls);\n+    transformer.migrateObjectLiterals(extraOptionsLiterals);\n+\n+    if (updateRecorders.has(sourceFile)) {\n+      return updateRecorders.get(sourceFile)!.failures;\n+    }\n+    return [];\n+\n+    /** Gets the update recorder for the specified source file. */\n+    function getUpdateRecorder(sourceFile: ts.SourceFile): TslintUpdateRecorder {\n+      if (updateRecorders.has(sourceFile)) {\n+        return updateRecorders.get(sourceFile)!;\n+      }\n+      const recorder = new TslintUpdateRecorder(ruleName, sourceFile);\n+      updateRecorders.set(sourceFile, recorder);\n+      return recorder;\n+    }\n+  }\n+}"
        },
        {
            "sha": "baed6ddb5a087cea1291523d57c1208e84d559ec",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/BUILD.bazel",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FBUILD.bazel?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,23 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"relative-link-resolution\",\n+    srcs = glob([\"**/*.ts\"]),\n+    tsconfig = \"//packages/core/schematics:tsconfig.json\",\n+    visibility = [\n+        \"//packages/core/schematics:__pkg__\",\n+        \"//packages/core/schematics/migrations/google3:__pkg__\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution/google3:__pkg__\",\n+        \"//packages/core/schematics/test:__pkg__\",\n+    ],\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/annotations\",\n+        \"//packages/compiler-cli/src/ngtsc/imports\",\n+        \"//packages/compiler-cli/src/ngtsc/partial_evaluator\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n+        \"//packages/core/schematics/utils\",\n+        \"@npm//@angular-devkit/schematics\",\n+        \"@npm//@types/node\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "3d99628992e7aad25c4e83a38ab6b31cb3862e7c",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/README.md",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2FREADME.md?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,33 @@\n+## relativeLinkResolution migration\n+\n+The default value for `relativeLinkResolution` is changing from 'legacy' to 'corrected'.\n+This migration updates `RouterModule` configurations that use the default value to \n+now specifically use 'legacy' to prevent breakages when updating.\n+\n+#### Before\n+```ts\n+import { NgModule } from '@angular/core';\n+import { RouterModule } from '@angular/router';\n+\n+@NgModule({\n+  imports: [\n+    RouterModule.forRoot(ROUTES),\n+  ]\n+})\n+export class AppModule {\n+}\n+```\n+\n+#### After\n+```ts\n+import { NgModule } from '@angular/core';\n+import { RouterModule } from '@angular/router';\n+\n+@NgModule({\n+  imports: [\n+    RouterModule.forRoot(ROUTES, {relativeLinkResolution: 'legacy'}),\n+  ]\n+})\n+export class AppModule {\n+}\n+```\n\\ No newline at end of file"
        },
        {
            "sha": "ee62dbc4a068b1e750d5a23fde42b3479a36415c",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/collector.ts",
            "status": "added",
            "additions": 87,
            "deletions": 0,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fcollector.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fcollector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fcollector.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,87 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as ts from 'typescript';\n+\n+import {isExtraOptions, isRouterModuleForRoot} from './util';\n+\n+\n+/**\n+ * Visitor that walks through specified TypeScript nodes and collects all\n+ * found ExtraOptions#RelativeLinkResolution assignments.\n+ */\n+export class RelativeLinkResolutionCollector {\n+  readonly forRootCalls: ts.CallExpression[] = [];\n+  readonly extraOptionsLiterals: ts.ObjectLiteralExpression[] = [];\n+\n+  constructor(private readonly typeChecker: ts.TypeChecker) {}\n+\n+  visitNode(node: ts.Node) {\n+    let forRootCall: ts.CallExpression|null = null;\n+    let literal: ts.ObjectLiteralExpression|null = null;\n+    if (isRouterModuleForRoot(this.typeChecker, node) && node.arguments.length > 0) {\n+      if (node.arguments.length === 1) {\n+        forRootCall = node;\n+      } else if (ts.isObjectLiteralExpression(node.arguments[1])) {\n+        literal = node.arguments[1] as ts.ObjectLiteralExpression;\n+      } else if (ts.isIdentifier(node.arguments[1])) {\n+        literal = this.getLiteralNeedingMigrationFromIdentifier(node.arguments[1] as ts.Identifier);\n+      }\n+    } else if (ts.isVariableDeclaration(node)) {\n+      literal = this.getLiteralNeedingMigration(node);\n+    }\n+\n+    if (literal !== null) {\n+      this.extraOptionsLiterals.push(literal);\n+    } else if (forRootCall !== null) {\n+      this.forRootCalls.push(forRootCall);\n+    } else {\n+      // no match found, continue iteration\n+      ts.forEachChild(node, n => this.visitNode(n));\n+    }\n+  }\n+\n+  private getLiteralNeedingMigrationFromIdentifier(id: ts.Identifier): ts.ObjectLiteralExpression\n+      |null {\n+    const symbolForIdentifier = this.typeChecker.getSymbolAtLocation(id);\n+    if (symbolForIdentifier === undefined) {\n+      return null;\n+    }\n+\n+    if (symbolForIdentifier.declarations.length === 0) {\n+      return null;\n+    }\n+\n+    const declarationNode = symbolForIdentifier.declarations[0];\n+    if (!ts.isVariableDeclaration(declarationNode) || declarationNode.initializer === undefined ||\n+        !ts.isObjectLiteralExpression(declarationNode.initializer)) {\n+      return null;\n+    }\n+\n+    return declarationNode.initializer;\n+  }\n+\n+  private getLiteralNeedingMigration(node: ts.VariableDeclaration): ts.ObjectLiteralExpression\n+      |null {\n+    if (node.initializer === undefined) {\n+      return null;\n+    }\n+\n+    // declaration could be `x: ExtraOptions = {}` or `x = {} as ExtraOptions`\n+    if (ts.isAsExpression(node.initializer) &&\n+        ts.isObjectLiteralExpression(node.initializer.expression) &&\n+        isExtraOptions(this.typeChecker, node.initializer.type)) {\n+      return node.initializer.expression;\n+    } else if (\n+        node.type !== undefined && ts.isObjectLiteralExpression(node.initializer) &&\n+        isExtraOptions(this.typeChecker, node.type)) {\n+      return node.initializer;\n+    }\n+\n+    return null;\n+  }\n+}"
        },
        {
            "sha": "1a2d4e6b789f3303ba8d5712e9c5c2ad415b2da4",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/google3/BUILD.bazel",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2FBUILD.bazel?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,13 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"google3\",\n+    srcs = glob([\"**/*.ts\"]),\n+    tsconfig = \"//packages/core/schematics:tsconfig.json\",\n+    visibility = [\"//packages/core/schematics/migrations/google3:__pkg__\"],\n+    deps = [\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n+        \"@npm//tslint\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "f36e06d5b3427a9ae78527b7f5158f2bd8492e75",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/google3/tslint_update_recorder.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2Ftslint_update_recorder.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2Ftslint_update_recorder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fgoogle3%2Ftslint_update_recorder.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,28 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Replacement, RuleFailure} from 'tslint';\n+import * as ts from 'typescript';\n+\n+import {UpdateRecorder} from '../update_recorder';\n+\n+export class TslintUpdateRecorder implements UpdateRecorder {\n+  failures: RuleFailure[] = [];\n+\n+  constructor(private ruleName: string, private sourceFile: ts.SourceFile) {}\n+\n+  updateNode(node: ts.Node, newText: string) {\n+    this.failures.unshift(new RuleFailure(\n+        this.sourceFile, node.getStart(), 0,\n+        'The relativeLinkResolution default is changing from `legacy` to `corrected`. To keep behavior consistent' +\n+            ' when the change is merged, specify `legacy` rather than using the default.',\n+        this.ruleName, Replacement.replaceFromTo(node.getStart(), node.getEnd(), `${newText}`)));\n+  }\n+\n+  commitUpdate() {}\n+}"
        },
        {
            "sha": "6c2f672c9e19046a56f73760ff4525b01d205fd2",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/index.ts",
            "status": "added",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,74 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Rule, SchematicsException, Tree} from '@angular-devkit/schematics';\n+import {relative} from 'path';\n+import * as ts from 'typescript';\n+import {getProjectTsConfigPaths} from '../../utils/project_tsconfig_paths';\n+import {createMigrationProgram} from '../../utils/typescript/compiler_host';\n+import {RelativeLinkResolutionCollector} from './collector';\n+import {RelativeLinkResolutionTransform} from './transform';\n+import {UpdateRecorder} from './update_recorder';\n+\n+/** Entry point for the v11 \"relativeLinkResolution RouterModule options\" schematic. */\n+export default function(): Rule {\n+  return (tree: Tree) => {\n+    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+    const basePath = process.cwd();\n+\n+    if (!buildPaths.length && !testPaths.length) {\n+      throw new SchematicsException(\n+          'Could not find any tsconfig file. Cannot update the \"relativeLinkResolution\" option for RouterModule');\n+    }\n+\n+    for (const tsconfigPath of [...buildPaths, ...testPaths]) {\n+      runRelativeLinkResolutionMigration(tree, tsconfigPath, basePath);\n+    }\n+  };\n+}\n+\n+function runRelativeLinkResolutionMigration(tree: Tree, tsconfigPath: string, basePath: string) {\n+  const {program} = createMigrationProgram(tree, tsconfigPath, basePath);\n+  const typeChecker = program.getTypeChecker();\n+  const relativeLinkResolutionCollector = new RelativeLinkResolutionCollector(typeChecker);\n+  const sourceFiles = program.getSourceFiles().filter(\n+      f => !f.isDeclarationFile && !program.isSourceFileFromExternalLibrary(f));\n+\n+  // Analyze source files by detecting all modules.\n+  sourceFiles.forEach(sourceFile => relativeLinkResolutionCollector.visitNode(sourceFile));\n+\n+  const {forRootCalls, extraOptionsLiterals} = relativeLinkResolutionCollector;\n+  const transformer = new RelativeLinkResolutionTransform(getUpdateRecorder);\n+  const updateRecorders = new Map<ts.SourceFile, UpdateRecorder>();\n+  transformer.migrateRouterModuleForRootCalls(forRootCalls);\n+  transformer.migrateObjectLiterals(extraOptionsLiterals);\n+\n+  // Walk through each update recorder and commit the update. We need to commit the\n+  // updates in batches per source file as there can be only one recorder per source\n+  // file in order to avoid shift character offsets.\n+  updateRecorders.forEach(recorder => recorder.commitUpdate());\n+\n+  /** Gets the update recorder for the specified source file. */\n+  function getUpdateRecorder(sourceFile: ts.SourceFile): UpdateRecorder {\n+    if (updateRecorders.has(sourceFile)) {\n+      return updateRecorders.get(sourceFile)!;\n+    }\n+    const treeRecorder = tree.beginUpdate(relative(basePath, sourceFile.fileName));\n+    const recorder: UpdateRecorder = {\n+      updateNode(node: ts.Node, newText: string) {\n+        treeRecorder.remove(node.getStart(), node.getWidth());\n+        treeRecorder.insertRight(node.getStart(), newText);\n+      },\n+      commitUpdate() {\n+        tree.commitUpdate(treeRecorder);\n+      }\n+    };\n+    updateRecorders.set(sourceFile, recorder);\n+    return recorder;\n+  }\n+}"
        },
        {
            "sha": "22798080ef5eb0d01ed82535eb8433931c0b2c23",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/transform.ts",
            "status": "added",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Ftransform.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,64 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as ts from 'typescript';\n+\n+import {UpdateRecorder} from './update_recorder';\n+\n+\n+const RELATIVE_LINK_RESOLUTION = 'relativeLinkResolution';\n+\n+export class RelativeLinkResolutionTransform {\n+  private printer = ts.createPrinter();\n+\n+  constructor(private getUpdateRecorder: (sf: ts.SourceFile) => UpdateRecorder) {}\n+\n+  /** Migrate the ExtraOptions#RelativeLinkResolution property assignments. */\n+  migrateRouterModuleForRootCalls(calls: ts.CallExpression[]) {\n+    calls.forEach(c => {\n+      this._updateCallExpressionWithoutExtraOptions(c);\n+    });\n+  }\n+\n+  migrateObjectLiterals(vars: ts.ObjectLiteralExpression[]) {\n+    vars.forEach(v => this._maybeUpdateLiteral(v));\n+  }\n+\n+  private _updateCallExpressionWithoutExtraOptions(callExpression: ts.CallExpression) {\n+    const args = callExpression.arguments;\n+    const emptyLiteral = ts.createObjectLiteral();\n+    const newNode = ts.updateCall(\n+        callExpression, callExpression.expression, callExpression.typeArguments,\n+        [args[0], this._getMigratedLiteralExpression(emptyLiteral)]);\n+    this._updateNode(callExpression, newNode);\n+  }\n+\n+  private _getMigratedLiteralExpression(literal: ts.ObjectLiteralExpression) {\n+    if (literal.properties.some(\n+            prop => ts.isPropertyAssignment(prop) &&\n+                prop.name.getText() === RELATIVE_LINK_RESOLUTION)) {\n+      // literal already defines a value for relativeLinkResolution. Skip it\n+      return literal;\n+    }\n+    const legacyExpression =\n+        ts.createPropertyAssignment(RELATIVE_LINK_RESOLUTION, ts.createStringLiteral('legacy'));\n+    return ts.updateObjectLiteral(literal, [...literal.properties, legacyExpression]);\n+  }\n+\n+  private _maybeUpdateLiteral(literal: ts.ObjectLiteralExpression) {\n+    const updatedLiteral = this._getMigratedLiteralExpression(literal);\n+    if (updatedLiteral !== literal) {\n+      this._updateNode(literal, updatedLiteral);\n+    }\n+  }\n+\n+  private _updateNode(node: ts.Node, newNode: ts.Node) {\n+    const newText = this.printer.printNode(ts.EmitHint.Unspecified, newNode, node.getSourceFile());\n+    const recorder = this.getUpdateRecorder(node.getSourceFile());\n+    recorder.updateNode(node, newText);\n+  }\n+}"
        },
        {
            "sha": "679626234643c26db76840c48ce5ed83191f8483",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/update_recorder.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fupdate_recorder.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fupdate_recorder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Fupdate_recorder.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,19 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+\n+/**\n+ * Update recorder interface that is used to transform source files in a non-colliding\n+ * way. Also this indirection makes it possible to re-use logic for both TSLint rules\n+ * and CLI devkit schematic updates.\n+ */\n+export interface UpdateRecorder {\n+  updateNode(node: ts.Node, newText: string): void;\n+  commitUpdate(): void;\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "d8a7c565624790175af05ced2516591ad202e8b2",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/util.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Futil.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,33 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+import {getImportOfIdentifier} from '../../utils/typescript/imports';\n+\n+/** Determine whether a node is a ModuleWithProviders type reference node without a generic type */\n+export function isRouterModuleForRoot(\n+    typeChecker: ts.TypeChecker, node: ts.Node): node is ts.CallExpression {\n+  if (!ts.isCallExpression(node) || !ts.isPropertyAccessExpression(node.expression) ||\n+      !ts.isIdentifier(node.expression.expression) || node.expression.name.text !== 'forRoot') {\n+    return false;\n+  }\n+  const imp = getImportOfIdentifier(typeChecker, node.expression.expression);\n+  return !!imp && imp.name === 'RouterModule' && imp.importModule === '@angular/router' &&\n+      !node.typeArguments;\n+}\n+\n+export function isExtraOptions(\n+    typeChecker: ts.TypeChecker, node: ts.Node): node is ts.TypeReferenceNode {\n+  if (!ts.isTypeReferenceNode(node) || !ts.isIdentifier(node.typeName)) {\n+    return false;\n+  }\n+\n+  const imp = getImportOfIdentifier(typeChecker, node.typeName);\n+  return imp !== null && imp.name === 'ExtraOptions' && imp.importModule === '@angular/router' &&\n+      !node.typeArguments;\n+}"
        },
        {
            "sha": "fc8cdb52e28357a30dc4c86d9f0eaa3b290264f2",
            "filename": "packages/core/schematics/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -13,6 +13,7 @@ ts_library(\n         \"//packages/core/schematics/migrations/module-with-providers\",\n         \"//packages/core/schematics/migrations/move-document\",\n         \"//packages/core/schematics/migrations/navigation-extras-omissions\",\n+        \"//packages/core/schematics/migrations/relative-link-resolution\",\n         \"//packages/core/schematics/migrations/renderer-to-renderer2\",\n         \"//packages/core/schematics/migrations/static-queries\",\n         \"//packages/core/schematics/migrations/template-var-assignment\","
        },
        {
            "sha": "c2f1202e9e590f92453235ebd116e57b2b3ac8b3",
            "filename": "packages/core/schematics/test/google3/relative_link_resolution_default_spec.ts",
            "status": "added",
            "additions": 202,
            "deletions": 0,
            "changes": 202,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Frelative_link_resolution_default_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Frelative_link_resolution_default_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Frelative_link_resolution_default_spec.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,202 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {readFileSync, writeFileSync} from 'fs';\n+import {dirname, join} from 'path';\n+import * as shx from 'shelljs';\n+import {Configuration, Linter} from 'tslint';\n+\n+describe('Google3 relativeLinkResolution TSLint rule', () => {\n+  const rulesDirectory =\n+      dirname(require.resolve('../../migrations/google3/relativeLinkResolutionDefaultRule'));\n+\n+  let tmpDir: string;\n+\n+  beforeEach(() => {\n+    tmpDir = join(process.env['TEST_TMPDIR']!, 'google3-test');\n+    shx.mkdir('-p', tmpDir);\n+    writeFile('tsconfig.json', JSON.stringify({compilerOptions: {module: 'es2015'}}));\n+  });\n+\n+  afterEach(() => shx.rm('-r', tmpDir));\n+\n+  function runTSLint(fix: boolean) {\n+    const program = Linter.createProgram(join(tmpDir, 'tsconfig.json'));\n+    const linter = new Linter({fix, rulesDirectory: [rulesDirectory]}, program);\n+    const config = Configuration.parseConfigFile({\n+      rules: {'relative-link-resolution-default': true},\n+    });\n+\n+    program.getRootFileNames().forEach(fileName => {\n+      linter.lint(fileName, program.getSourceFile(fileName)!.getFullText(), config);\n+    });\n+\n+    return linter;\n+  }\n+\n+  function writeFile(fileName: string, content: string) {\n+    writeFileSync(join(tmpDir, fileName), content);\n+  }\n+\n+  function getFile(fileName: string) {\n+    return readFileSync(join(tmpDir, fileName), 'utf8');\n+  }\n+\n+  it('should flag forRoot with no options', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+    `);\n+\n+    const linter = runTSLint(false);\n+    const failures = linter.getResult().failures.map(failure => failure.getFailure());\n+\n+    expect(failures.length).toBe(1);\n+    expect(failures[0])\n+        .toBe(\n+            'The relativeLinkResolution default is changing from `legacy` to `corrected`. To keep' +\n+            ' behavior consistent when the change is merged, specify `legacy` rather than using the default.');\n+  });\n+\n+  it('should migrate forRoot with no options', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], { relativeLinkResolution: \"legacy\" })`);\n+  });\n+\n+  it('should migrate options without relativeLinkResolution', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {useHash: true}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], { useHash: true, relativeLinkResolution: \"legacy\" })`);\n+  });\n+\n+  it('should not migrate options containing relativeLinkResolution', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {relativeLinkResolution: 'corrected'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], {relativeLinkResolution: 'corrected'})`);\n+  });\n+\n+  it('should migrate when options is a variable with AsExpression', () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions } from '@angular/router';\n+        const options = {useHash: true} as ExtraOptions;\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(\n+            `const options = { useHash: true, relativeLinkResolution: \"legacy\" } as ExtraOptions;`);\n+  });\n+\n+  it('should migrate when options is a variable', () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions } from '@angular/router';\n+        const options: ExtraOptions = {useHash: true};\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(\n+            `const options: ExtraOptions = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+  });\n+\n+  it('should migrate when options is a variable with no type', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { ExtraOptions, RouterModule } from '@angular/router';\n+\n+        const options = {useHash: true};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], options),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`const options = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+    expect(getFile('/index.ts')).toContain(`RouterModule.forRoot([], options)`);\n+  });\n+\n+  it('should migrate when aliased options is a variable', () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions as RouterExtraOptions } from '@angular/router';\n+        const options: RouterExtraOptions = {useHash: true};\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(\n+            `const options: RouterExtraOptions = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+  });\n+\n+  it('should migrate aliased RouterModule.forRoot', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule as AngularRouterModule} from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            AngularRouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`AngularRouterModule.forRoot([], { relativeLinkResolution: \"legacy\" }),`);\n+  });\n+});"
        },
        {
            "sha": "14d90303ef13896661a4826c61e281cfab2e0500",
            "filename": "packages/core/schematics/test/relative_link_resolution_spec.ts",
            "status": "added",
            "additions": 188,
            "deletions": 0,
            "changes": 188,
            "blob_url": "https://github.com/angular/angular/blob/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/15ea811f051826f9bdcd8cb42e368d8b360f193a/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts?ref=15ea811f051826f9bdcd8cb42e368d8b360f193a",
            "patch": "@@ -0,0 +1,188 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {getSystemPath, normalize, virtualFs} from '@angular-devkit/core';\n+import {TempScopedNodeJsSyncHost} from '@angular-devkit/core/node/testing';\n+import {HostTree} from '@angular-devkit/schematics';\n+import {SchematicTestRunner, UnitTestTree} from '@angular-devkit/schematics/testing';\n+import * as shx from 'shelljs';\n+\n+describe('initial navigation migration', () => {\n+  let runner: SchematicTestRunner;\n+  let host: TempScopedNodeJsSyncHost;\n+  let tree: UnitTestTree;\n+  let tmpDirPath: string;\n+  let previousWorkingDir: string;\n+\n+  beforeEach(() => {\n+    runner = new SchematicTestRunner('test', require.resolve('../migrations.json'));\n+    host = new TempScopedNodeJsSyncHost();\n+    tree = new UnitTestTree(new HostTree(host));\n+\n+    writeFile('/tsconfig.json', JSON.stringify({\n+      compilerOptions: {\n+        lib: ['es2015'],\n+      }\n+    }));\n+    writeFile('/angular.json', JSON.stringify({\n+      projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n+    }));\n+\n+    previousWorkingDir = shx.pwd();\n+    tmpDirPath = getSystemPath(host.root);\n+\n+    // Switch into the temporary directory path. This allows us to run\n+    // the schematic against our custom unit test tree.\n+    shx.cd(tmpDirPath);\n+  });\n+\n+  afterEach(() => {\n+    shx.cd(previousWorkingDir);\n+    shx.rm('-r', tmpDirPath);\n+  });\n+\n+  it('should migrate forRoot with no options', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], { relativeLinkResolution: \"legacy\" })`);\n+  });\n+\n+  it('should migrate options without relativeLinkResolution', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {useHash: true}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], { useHash: true, relativeLinkResolution: \"legacy\" })`);\n+  });\n+\n+  it('should not migrate options containing relativeLinkResolution', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {relativeLinkResolution: 'corrected'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`RouterModule.forRoot([], {relativeLinkResolution: 'corrected'})`);\n+  });\n+\n+  it('should migrate when options is a variable with AsExpression', async () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions } from '@angular/router';\n+        const options = {useHash: true} as ExtraOptions;\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(\n+            `const options = { useHash: true, relativeLinkResolution: \"legacy\" } as ExtraOptions;`);\n+  });\n+\n+  it('should migrate when options is a variable', async () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions } from '@angular/router';\n+        const options: ExtraOptions = {useHash: true};\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(\n+            `const options: ExtraOptions = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+  });\n+\n+  it('should migrate when options is a variable with no type', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { ExtraOptions, RouterModule } from '@angular/router';\n+\n+        const options = {useHash: true};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], options),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+    expect(tree.readContent('/index.ts')).toContain(`RouterModule.forRoot([], options)`);\n+  });\n+\n+  it('should migrate when aliased options is a variable', async () => {\n+    writeFile('/index.ts', `\n+        import { ExtraOptions as RouterExtraOptions } from '@angular/router';\n+        const options: RouterExtraOptions = {useHash: true};\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(\n+            `const options: RouterExtraOptions = { useHash: true, relativeLinkResolution: \"legacy\" };`);\n+  });\n+\n+  it('should migrate aliased RouterModule.forRoot', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule as AngularRouterModule} from '@angular/router';\n+        @NgModule({\n+          imports: [\n+            AngularRouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`AngularRouterModule.forRoot([], { relativeLinkResolution: \"legacy\" }),`);\n+  });\n+\n+  function writeFile(filePath: string, contents: string) {\n+    host.sync.write(normalize(filePath), virtualFs.stringToFileBuffer(contents));\n+  }\n+\n+  function runMigration() {\n+    return runner\n+        .runSchematicAsync('migration-v11-router-relative-link-resolution-default', {}, tree)\n+        .toPromise();\n+  }\n+});"
        }
    ],
    "stats": {
        "total": 821,
        "additions": 821,
        "deletions": 0
    }
}