{
    "author": "dylhunn",
    "message": "refactor(forms): Move FormControl to an overridden exported constructor. (#44316)\n\nThis implementation change was originally proposed as part of Typed Forms, and will have major consequences for that project as described in the design doc. Submitting it separately will greatly simplify the risk of landing Typed Forms. This change should have no visible impact on normal users of FormControl.\n\nSee the Typed Forms design doc here: https://docs.google.com/document/d/1cWuBE-oo5WLtwkLFxbNTiaVQGNk8ipgbekZcKBeyxxo.\n\nPR Close #44316",
    "sha": "cd5200ea6863445adce24c62f30e49940a926522",
    "files": [
        {
            "sha": "8b8668b7556fb1214ad06d0ad0126eee96328b20",
            "filename": "goldens/public-api/forms/forms.md",
            "status": "modified",
            "additions": 41,
            "deletions": 3,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/cd5200ea6863445adce24c62f30e49940a926522/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "raw_url": "https://github.com/angular/angular/raw/cd5200ea6863445adce24c62f30e49940a926522/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fforms%2Fforms.md?ref=cd5200ea6863445adce24c62f30e49940a926522",
            "patch": "@@ -297,22 +297,27 @@ export class FormBuilder {\n     static ɵprov: i0.ɵɵInjectableDeclaration<FormBuilder>;\n }\n \n-// @public\n-export class FormControl extends AbstractControl {\n-    constructor(formState?: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | FormControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null);\n+// @public (undocumented)\n+export interface FormControl extends AbstractControl {\n+    // (undocumented)\n     readonly defaultValue: any;\n+    // (undocumented)\n     patchValue(value: any, options?: {\n         onlySelf?: boolean;\n         emitEvent?: boolean;\n         emitModelToViewChange?: boolean;\n         emitViewToModelChange?: boolean;\n     }): void;\n+    // (undocumented)\n     registerOnChange(fn: Function): void;\n+    // (undocumented)\n     registerOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+    // (undocumented)\n     reset(formState?: any, options?: {\n         onlySelf?: boolean;\n         emitEvent?: boolean;\n     }): void;\n+    // (undocumented)\n     setValue(value: any, options?: {\n         onlySelf?: boolean;\n         emitEvent?: boolean;\n@@ -321,6 +326,15 @@ export class FormControl extends AbstractControl {\n     }): void;\n }\n \n+// @public\n+export const FormControl: FormControlCtor;\n+\n+// @public\n+export interface FormControlCtor {\n+    new (): FormControl;\n+    new (value: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | FormControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null): FormControl;\n+}\n+\n // @public\n export class FormControlDirective extends NgControl implements OnChanges, OnDestroy {\n     constructor(validators: (Validator | ValidatorFn)[], asyncValidators: (AsyncValidator | AsyncValidatorFn)[], valueAccessors: ControlValueAccessor[], _ngModelWarningConfig: string | null);\n@@ -344,6 +358,30 @@ export class FormControlDirective extends NgControl implements OnChanges, OnDest\n     static ɵfac: i0.ɵɵFactoryDeclaration<FormControlDirective, [{ optional: true; self: true; }, { optional: true; self: true; }, { optional: true; self: true; }, { optional: true; }]>;\n }\n \n+// @public\n+export class FormControlImpl extends AbstractControl {\n+    constructor(formState?: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | FormControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null);\n+    readonly defaultValue: any;\n+    patchValue(value: any, options?: {\n+        onlySelf?: boolean;\n+        emitEvent?: boolean;\n+        emitModelToViewChange?: boolean;\n+        emitViewToModelChange?: boolean;\n+    }): void;\n+    registerOnChange(fn: Function): void;\n+    registerOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+    reset(formState?: any, options?: {\n+        onlySelf?: boolean;\n+        emitEvent?: boolean;\n+    }): void;\n+    setValue(value: any, options?: {\n+        onlySelf?: boolean;\n+        emitEvent?: boolean;\n+        emitModelToViewChange?: boolean;\n+        emitViewToModelChange?: boolean;\n+    }): void;\n+}\n+\n // @public\n export class FormControlName extends NgControl implements OnChanges, OnDestroy {\n     constructor(parent: ControlContainer, validators: (Validator | ValidatorFn)[], asyncValidators: (AsyncValidator | AsyncValidatorFn)[], valueAccessors: ControlValueAccessor[], _ngModelWarningConfig: string | null);"
        },
        {
            "sha": "27e1133504fc2cbc42d5119463a9f7798f4183a7",
            "filename": "packages/forms/src/forms.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Fsrc%2Fforms.ts",
            "raw_url": "https://github.com/angular/angular/raw/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Fsrc%2Fforms.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fforms.ts?ref=cd5200ea6863445adce24c62f30e49940a926522",
            "patch": "@@ -43,7 +43,7 @@ export {NgSelectOption, SelectControlValueAccessor} from './directives/select_co\n export {SelectMultipleControlValueAccessor, ɵNgSelectMultipleOption} from './directives/select_multiple_control_value_accessor';\n export {AsyncValidator, AsyncValidatorFn, CheckboxRequiredValidator, EmailValidator, MaxLengthValidator, MaxValidator, MinLengthValidator, MinValidator, PatternValidator, RequiredValidator, ValidationErrors, Validator, ValidatorFn} from './directives/validators';\n export {FormBuilder} from './form_builder';\n-export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlOptions, FormControlStatus, FormGroup} from './model';\n+export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlCtor, FormControlImpl, FormControlOptions, FormControlStatus, FormGroup} from './model';\n export {NG_ASYNC_VALIDATORS, NG_VALIDATORS, Validators} from './validators';\n export {VERSION} from './version';\n "
        },
        {
            "sha": "014e57f538efaf88b0419ba89e2b25afd189baa9",
            "filename": "packages/forms/src/model.ts",
            "status": "modified",
            "additions": 82,
            "deletions": 11,
            "changes": 93,
            "blob_url": "https://github.com/angular/angular/blob/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "raw_url": "https://github.com/angular/angular/raw/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fmodel.ts?ref=cd5200ea6863445adce24c62f30e49940a926522",
            "patch": "@@ -161,9 +161,9 @@ export interface AbstractControlOptions {\n export interface FormControlOptions extends AbstractControlOptions {\n   /**\n    * @description\n-   * Whether to use the initial value used to construct the FormControl as its default value as\n-   * well. If this option is false or not provided, the default value of a FormControl is `null`.\n-   * When a FormControl is {@link FormControl#reset} without an explicit value, its value reverts to\n+   * Whether to use the initial value used to construct the {@link FormControl} as its default value\n+   * as well. If this option is false or not provided, the default value of a FormControl is `null`.\n+   * When a FormControl is reset without an explicit value, its value reverts to\n    * its default value.\n    */\n   initialValueIsDefault?: boolean;\n@@ -1177,7 +1177,6 @@ export abstract class AbstractControl {\n       this._updateOn = opts.updateOn!;\n     }\n   }\n-\n   /**\n    * Check to see if parent has been marked artificially dirty.\n    *\n@@ -1189,6 +1188,74 @@ export abstract class AbstractControl {\n   }\n }\n \n+export interface FormControl extends AbstractControl {\n+  readonly defaultValue: any;\n+  /** @internal */\n+  _onChange: Function[];\n+  /** @internal */\n+  _pendingValue: any;\n+  /** @internal */\n+  _pendingChange: boolean;\n+  setValue(value: any, options?: {\n+    onlySelf?: boolean,\n+    emitEvent?: boolean,\n+    emitModelToViewChange?: boolean,\n+    emitViewToModelChange?: boolean\n+  }): void;\n+  patchValue(value: any, options?: {\n+    onlySelf?: boolean,\n+    emitEvent?: boolean,\n+    emitModelToViewChange?: boolean,\n+    emitViewToModelChange?: boolean\n+  }): void;\n+  reset(formState?: any, options?: {onlySelf?: boolean, emitEvent?: boolean}): void;\n+  /** @internal */\n+  _updateValue(): void;\n+  /**  @internal */\n+  _anyControls(condition: Function): boolean;\n+  /** @internal */\n+  _allControlsDisabled(): boolean;\n+  registerOnChange(fn: Function): void;\n+  /** @internal */\n+  _unregisterOnChange(fn: Function): void;\n+  registerOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+  /** @internal */\n+  _unregisterOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+  /** @internal */\n+  _forEachChild(cb: Function): void;\n+  /** @internal */\n+  _syncPendingControls(): boolean;\n+}\n+\n+/**\n+ * Various available constructors for `FormControl`.\n+ * Do not use this interface directly. Instead, use `FormControl`:\n+ * ```\n+ * const fc = new FormControl('foo');\n+ * ```\n+ */\n+export interface FormControlCtor {\n+  /**\n+   * Construct a FormControl with no initial value or validators.\n+   */\n+  new(): FormControl;\n+\n+  /**\n+   * Creates a new `FormControl` instance.\n+   *\n+   * @param formState Initializes the control with an initial value,\n+   * or an object that defines the initial value and disabled state.\n+   *\n+   * @param validatorOrOpts A synchronous validator function, or an array of\n+   * such functions, or an `FormControlOptions` object that contains validation functions\n+   * and a validation trigger.\n+   *\n+   * @param asyncValidator A single async validator or array of async validator functions\n+   */\n+  new(value: any, validatorOrOpts?: ValidatorFn|ValidatorFn[]|FormControlOptions|null,\n+      asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null): FormControl;\n+}\n+\n /**\n  * Tracks the value and validation status of an individual form control.\n  *\n@@ -1210,7 +1277,7 @@ export abstract class AbstractControl {\n  * ```ts\n  * const control = new FormControl('some value');\n  * console.log(control.value);     // 'some value'\n- *```\n+ * ```\n  *\n  * The following example initializes the control with a form state object. The `value`\n  * and `disabled` keys are required in this case.\n@@ -1283,10 +1350,8 @@ export abstract class AbstractControl {\n  * console.log(control.value); // 'Drew'\n  * console.log(control.status); // 'DISABLED'\n  * ```\n- *\n- * @publicApi\n  */\n-export class FormControl extends AbstractControl {\n+export class FormControlImpl extends AbstractControl {\n   /**\n    * The default value of this FormControl, used whenever the control is reset without an explicit\n    * value. See {@link FormControlOptions#initialValueIsDefault} for more information on configuring\n@@ -1296,14 +1361,14 @@ export class FormControl extends AbstractControl {\n   public readonly defaultValue: any = null;\n \n   /** @internal */\n-  _onChange: Array<Function> = [];\n+  _onChange: Function[] = [];\n \n   /**\n    * This field holds a pending value that has not yet been applied to the form's value.\n    * It is `any` because the value is untyped.\n    * @internal\n    */\n-  _pendingValue: any;\n+  _pendingValue!: any;\n \n   /** @internal */\n   _pendingChange: boolean = false;\n@@ -1315,7 +1380,7 @@ export class FormControl extends AbstractControl {\n    * or an object that defines the initial value and disabled state.\n    *\n    * @param validatorOrOpts A synchronous validator function, or an array of\n-   * such functions, or an `AbstractControlOptions` object that contains validation functions\n+   * such functions, or a `FormControlOptions` object that contains validation functions\n    * and a validation trigger.\n    *\n    * @param asyncValidator A single async validator or array of async validator functions\n@@ -1526,6 +1591,12 @@ export class FormControl extends AbstractControl {\n   }\n }\n \n+/**\n+ * @overriddenImplementation The constructor for FormControl is decoupled from its implementation.\n+ * This allows us to provide multiple constructor signatures.\n+ */\n+export const FormControl: FormControlCtor = FormControlImpl as FormControlCtor;\n+\n /**\n  * Tracks the value and validity state of a group of `FormControl` instances.\n  *"
        },
        {
            "sha": "8b684a35a2e21c6acc3fd8375ddeb2976b9cbc5b",
            "filename": "packages/forms/test/form_control_spec.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cd5200ea6863445adce24c62f30e49940a926522/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_control_spec.ts?ref=cd5200ea6863445adce24c62f30e49940a926522",
            "patch": "@@ -1527,5 +1527,24 @@ describe('FormControl', () => {\n       });\n     });\n   });\n+\n+  describe('can be extended', () => {\n+    // We don't technically support extending Forms classes, but people do it anyway.\n+    // We need to make sure that there is some way to extend them to avoid causing breakage.\n+\n+    class FCExt extends FormControl {\n+      constructor(formState?: any|{\n+        value?: any;\n+        disabled?: boolean;\n+      }, ...args: any) {\n+        super(formState, ...args);\n+      }\n+    }\n+\n+    it('should perform basic FormControl operations', () => {\n+      const nc = new FCExt({value: 'foo'});\n+      nc.setValue('bar');\n+    });\n+  });\n });\n })();"
        }
    ],
    "stats": {
        "total": 158,
        "additions": 143,
        "deletions": 15
    }
}