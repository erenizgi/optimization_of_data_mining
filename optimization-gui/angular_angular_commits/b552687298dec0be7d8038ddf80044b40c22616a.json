{
    "author": "AleksanderBodurri",
    "message": "feat(devtools): Allow ctrl/meta click to select/deselect multiple frames",
    "sha": "b552687298dec0be7d8038ddf80044b40c22616a",
    "files": [
        {
            "sha": "63120b0353c9d2123a751caa46ce8bea82550784",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/frame-selector/frame-selector.component.html",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.html",
            "raw_url": "https://github.com/angular/angular/raw/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.html?ref=b552687298dec0be7d8038ddf80044b40c22616a",
            "patch": "@@ -1,19 +1,26 @@\n <mat-card class=\"bar-graph-container\">\n-  <p class=\"txt-frames\">{{ selectionLabel }} / {{ (graphData$ | async)?.length }}</p>\n-  <button mat-icon-button (click)=\"move.emit(-1)\" [disabled]=\"startFrameIndex <= 0\">\n+  <p class=\"txt-frames\" matTooltip=\"{{ selectionLabel }} / {{ (graphData$ | async)?.length }}\">\n+    {{ selectionLabel }} / {{ (graphData$ | async)?.length }}\n+  </p>\n+  <button mat-icon-button (click)=\"move(-1)\" [disabled]=\"startFrameIndex <= 0 || selectedFrameIndexes.size > 1\">\n     <mat-icon>chevron_left</mat-icon>\n   </button>\n \n   <cdk-virtual-scroll-viewport #barContainer orientation=\"horizontal\" [itemSize]=\"itemWidth\" class=\"bar-container\">\n     <div\n       *cdkVirtualFor=\"let d of graphData$ | async; let i = index\"\n       [ngStyle]=\"d.style\"\n-      [class.selected]=\"i >= startFrameIndex && i <= endFrameIndex\"\n-      (click)=\"handleFrameSelection(i)\"\n+      class=\"frame-bar\"\n+      [class.selected]=\"selectedFrameIndexes.has(i)\"\n+      (click)=\"handleFrameSelection(i, $event)\"\n     ></div>\n   </cdk-virtual-scroll-viewport>\n \n-  <button mat-icon-button (click)=\"move.emit(1)\" [disabled]=\"endFrameIndex >= (graphData$ | async)?.length - 1\">\n+  <button\n+    mat-icon-button\n+    (click)=\"move(1)\"\n+    [disabled]=\"endFrameIndex >= (graphData$ | async)?.length - 1 || selectedFrameIndexes.size > 1\"\n+  >\n     <mat-icon>chevron_right</mat-icon>\n   </button>\n </mat-card>"
        },
        {
            "sha": "b0e9c0aaa0b43c6ade196f6cb5174dea230c9da3",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/frame-selector/frame-selector.component.scss",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.scss",
            "raw_url": "https://github.com/angular/angular/raw/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.scss",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.scss?ref=b552687298dec0be7d8038ddf80044b40c22616a",
            "patch": "@@ -12,7 +12,7 @@\n     line-height: 50px;\n     padding: 0px;\n     margin: 0px 10px;\n-    width: 35px;\n+    width: 150px;\n     text-align: center;\n     overflow: hidden;\n     text-overflow: ellipsis;\n@@ -34,8 +34,17 @@\n       display: none;\n     }\n \n-    .selected {\n-      border: 2px solid #ffc400;\n+    .frame-bar {\n+      margin-left: 2.5px;\n+      margin-right: 2.5px;\n+      margin-top: 2px;\n+\n+      &.selected {\n+        margin-left: 0.5px;\n+        margin-right: 0.5px;\n+        margin-top: 0;\n+        border: 2px solid #ffc400;\n+      }\n     }\n   }\n "
        },
        {
            "sha": "f9837ba170eebf8ec4205adf7822c80d465ac927",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/frame-selector/frame-selector.component.ts",
            "status": "modified",
            "additions": 77,
            "deletions": 29,
            "changes": 106,
            "blob_url": "https://github.com/angular/angular/blob/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Fframe-selector%2Fframe-selector.component.ts?ref=b552687298dec0be7d8038ddf80044b40c22616a",
            "patch": "@@ -4,7 +4,7 @@ import { Observable, Subscription } from 'rxjs';\n import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';\n import { TabUpdate } from '../../../../tab-update';\n \n-const ITEM_WIDTH = 29;\n+const ITEM_WIDTH = 30;\n \n @Component({\n   selector: 'ng-frame-selector',\n@@ -13,17 +13,11 @@ const ITEM_WIDTH = 29;\n })\n export class FrameSelectorComponent implements OnInit, OnDestroy {\n   @ViewChild('barContainer') barContainer: ElementRef;\n-  @Input() set startFrame(value: number) {\n-    this.startFrameIndex = value;\n-    this._ensureVisible(value);\n-  }\n-  @Input() set endFrame(value: number) {\n-    this.endFrameIndex = value;\n-  }\n   @Input() set graphData$(graphData: Observable<GraphNode[]>) {\n     this._graphData$ = graphData;\n     this._graphDataSubscription = this._graphData$.subscribe((items) =>\n       setTimeout(() => {\n+        this.frameCount = items.length;\n         this.viewport.scrollToIndex(items.length);\n       })\n     );\n@@ -33,12 +27,14 @@ export class FrameSelectorComponent implements OnInit, OnDestroy {\n     return this._graphData$;\n   }\n \n-  @Output() move = new EventEmitter<number>();\n-  @Output() selectFrames = new EventEmitter<{ start: number; end: number }>();\n+  @Output() selectFrames = new EventEmitter<{ indexes: number[] }>();\n+\n   @ViewChild(CdkVirtualScrollViewport) viewport: CdkVirtualScrollViewport;\n \n-  startFrameIndex: number;\n-  endFrameIndex: number;\n+  startFrameIndex = -1;\n+  endFrameIndex = -1;\n+  selectedFrameIndexes = new Set<number>();\n+  frameCount: number;\n \n   get itemWidth(): number {\n     return ITEM_WIDTH;\n@@ -47,9 +43,6 @@ export class FrameSelectorComponent implements OnInit, OnDestroy {\n   private _graphData$: Observable<GraphNode[]>;\n   private _graphDataSubscription: Subscription;\n   private _tabUpdateSubscription: Subscription;\n-  private _keydownCallback: (e: KeyboardEvent) => void;\n-  private _keyupCallback: (e: KeyboardEvent) => void;\n-  private _shiftDown = false;\n \n   constructor(private _tabUpdate: TabUpdate) {}\n \n@@ -62,8 +55,6 @@ export class FrameSelectorComponent implements OnInit, OnDestroy {\n         });\n       }\n     });\n-    window.addEventListener('keydown', (this._keydownCallback = (e: KeyboardEvent) => (this._shiftDown = e.shiftKey)));\n-    window.addEventListener('keyup', (this._keyupCallback = (e: KeyboardEvent) => (this._shiftDown = e.shiftKey)));\n   }\n \n   ngOnDestroy(): void {\n@@ -73,26 +64,83 @@ export class FrameSelectorComponent implements OnInit, OnDestroy {\n     if (this._graphDataSubscription) {\n       this._graphDataSubscription.unsubscribe();\n     }\n-    window.removeEventListener('keydown', this._keydownCallback);\n-    window.removeEventListener('keyup', this._keyupCallback);\n   }\n \n   get selectionLabel(): string {\n-    if (this.startFrameIndex !== this.endFrameIndex) {\n-      return `${this.startFrameIndex + 1}-${this.endFrameIndex + 1}`;\n+    if (this.startFrameIndex === this.endFrameIndex) {\n+      return `${this.startFrameIndex + 1}`;\n     }\n-    return `${this.startFrameIndex + 1}`;\n+\n+    return this._smartJoinIndexLabels([...this.selectedFrameIndexes]);\n   }\n \n-  handleFrameSelection(idx: number): void {\n-    if (!this._shiftDown) {\n-      this.startFrameIndex = this.endFrameIndex = idx;\n+  private _smartJoinIndexLabels(indexArray: number[]): string {\n+    const sortedIndexes = indexArray.sort((a, b) => a - b);\n+\n+    const groups: number[][] = [];\n+    let prev: number | null = null;\n+\n+    for (const index of sortedIndexes) {\n+      // First iteration: create initial group and set prev variable to the first index\n+      if (prev === null) {\n+        groups.push([index]);\n+        prev = index;\n+        continue;\n+      }\n+\n+      // If current index is consecutive with the previous, group them, otherwise start a new group\n+      if (prev + 1 === index) {\n+        groups[groups.length - 1].push(index);\n+      } else {\n+        groups.push([index]);\n+      }\n+\n+      prev = index;\n+    }\n+\n+    return groups\n+      .filter((group) => group.length > 0)\n+      .map((group) => (group.length === 1 ? group[0] + 1 : `${group[0] + 1}-${group[group.length - 1] + 1}`))\n+      .join(', ');\n+  }\n+\n+  move(value: number): void {\n+    const newVal = this.startFrameIndex + value;\n+    this.selectedFrameIndexes = new Set([newVal]);\n+    if (newVal > -1 && newVal < this.frameCount) {\n+      this._selectFrames({ indexes: this.selectedFrameIndexes });\n+    }\n+  }\n+\n+  private _selectFrames({ indexes }: { indexes: Set<number> }): void {\n+    const sortedIndexes = [...indexes].sort((a, b) => a - b);\n+    this.startFrameIndex = sortedIndexes[0];\n+    this.endFrameIndex = sortedIndexes[sortedIndexes.length - 1];\n+    this._ensureVisible(this.startFrameIndex);\n+    this.selectFrames.emit({ indexes: sortedIndexes });\n+  }\n+\n+  handleFrameSelection(idx: number, event: MouseEvent): void {\n+    const { shiftKey, ctrlKey, metaKey } = event;\n+\n+    if (shiftKey) {\n+      const [start, end] = [Math.min(this.startFrameIndex, idx), Math.max(this.endFrameIndex, idx)];\n+      this.selectedFrameIndexes = new Set(Array.from(Array(end - start + 1), (_, index) => index + start));\n+    } else if (ctrlKey || metaKey) {\n+      if (this.selectedFrameIndexes.has(idx)) {\n+        if (this.selectedFrameIndexes.size === 1) {\n+          return; // prevent deselection when only one frame is selected\n+        }\n+\n+        this.selectedFrameIndexes.delete(idx);\n+      } else {\n+        this.selectedFrameIndexes.add(idx);\n+      }\n     } else {\n-      const start = Math.min(this.startFrameIndex, idx);\n-      this.endFrameIndex = Math.max(this.startFrameIndex, this.endFrameIndex, idx);\n-      this.startFrameIndex = start;\n+      this.selectedFrameIndexes = new Set([idx]);\n     }\n-    this.selectFrames.emit({ start: this.startFrameIndex, end: this.endFrameIndex });\n+\n+    this._selectFrames({ indexes: this.selectedFrameIndexes });\n   }\n \n   private _ensureVisible(index: number): void {"
        },
        {
            "sha": "edbc6a29def6f0146497c6ab0a321a943d591403",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.html",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "raw_url": "https://github.com/angular/angular/raw/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html?ref=b552687298dec0be7d8038ddf80044b40c22616a",
            "patch": "@@ -19,19 +19,16 @@\n \n   <ng-frame-selector\n     [class.hidden]=\"!hasFrames\"\n-    (move)=\"move($event)\"\n-    (selectFrames)=\"selectFrames($event)\"\n     [graphData$]=\"graphData$\"\n-    [startFrame]=\"startFrame\"\n-    [endFrame]=\"endFrame\"\n+    (selectFrames)=\"selectFrames($event)\"\n   ></ng-frame-selector>\n \n-  <p class=\"info\" *ngIf=\"hasFrames && startFrame < 0\">\n+  <p class=\"info\" *ngIf=\"hasFrames && frame\">\n     Select a bar to preview a particular change detection cycle.\n   </p>\n \n   <ng-timeline-visualizer\n-    *ngIf=\"hasFrames && startFrame >= 0\"\n+    *ngIf=\"hasFrames && frame\"\n     [visualizationMode]=\"visualizationMode\"\n     [frame]=\"frame\"\n     [changeDetection]=\"changeDetection\""
        },
        {
            "sha": "1803492dc593567d58eda9678e5512dcc3f2ec5a",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 17,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/b552687298dec0be7d8038ddf80044b40c22616a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts?ref=b552687298dec0be7d8038ddf80044b40c22616a",
            "patch": "@@ -37,8 +37,6 @@ export class TimelineComponent implements OnDestroy {\n   @Output() exportProfile = new EventEmitter<void>();\n \n   visualizationMode = VisualizationMode.BarGraph;\n-  startFrame = -1;\n-  endFrame = -1;\n   changeDetection = false;\n   frame: ProfilerFrame | null = null;\n \n@@ -49,6 +47,10 @@ export class TimelineComponent implements OnDestroy {\n   visualizing = false;\n   graphData$ = this._graphDataSubject.asObservable().pipe(share());\n \n+  selectFrames({ indexes }: { indexes: number[] }): void {\n+    this.frame = mergeFrames(indexes.map((index) => this._allRecords[index]));\n+  }\n+\n   get hasFrames(): boolean {\n     return this._allRecords.length > 0;\n   }\n@@ -58,19 +60,6 @@ export class TimelineComponent implements OnDestroy {\n     return Math.floor(60 / 2 ** multiplier);\n   }\n \n-  move(value: number): void {\n-    const newVal = this.startFrame + value;\n-    if (newVal > -1 && newVal < this._allRecords.length) {\n-      this.selectFrames({ start: newVal, end: newVal });\n-    }\n-  }\n-\n-  selectFrames(range: { start: number; end: number }): void {\n-    this.startFrame = range.start;\n-    this.endFrame = range.end;\n-    this.frame = mergeFrames(this._allRecords.slice(range.start, range.end + 1));\n-  }\n-\n   getColorByFrameRate(framerate: number): string {\n     if (framerate >= 60) {\n       return '#4db6ac';\n@@ -125,8 +114,6 @@ export class TimelineComponent implements OnDestroy {\n     const backgroundColor = this.getColorByFrameRate(this.estimateFrameRate(record.duration));\n \n     const style = {\n-      'margin-left': '1px',\n-      'margin-right': '1px',\n       background: `-webkit-linear-gradient(bottom, ${backgroundColor} ${colorPercentage}%, transparent ${colorPercentage}%)`,\n       cursor: 'pointer',\n       'min-width': '25px',"
        }
    ],
    "stats": {
        "total": 168,
        "additions": 108,
        "deletions": 60
    }
}