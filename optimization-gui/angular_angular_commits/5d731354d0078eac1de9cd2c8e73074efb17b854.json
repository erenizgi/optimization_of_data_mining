{
    "author": "JoostK",
    "message": "perf(compiler-cli): only generate template context declaration when used (#39321)\n\nThe variable declaration for a template context is only needed when it\nis referenced from somewhere, so the TCB operation to generate the\ndeclaration is marked as optional.\n\nPR Close #39321",
    "sha": "5d731354d0078eac1de9cd2c8e73074efb17b854",
    "files": [
        {
            "sha": "7297da50f04be8ce60a3812b290b4ec3d936ebd9",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/5d731354d0078eac1de9cd2c8e73074efb17b854/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/5d731354d0078eac1de9cd2c8e73074efb17b854/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=5d731354d0078eac1de9cd2c8e73074efb17b854",
            "patch": "@@ -194,9 +194,8 @@ class TcbTemplateContextOp extends TcbOp {\n     super();\n   }\n \n-  get optional() {\n-    return false;\n-  }\n+  // The declaration of the context variable is only needed when the context is actually referenced.\n+  readonly optional = true;\n \n   execute(): ts.Identifier {\n     // Allocate a template ctx variable and declare it with an 'any' type. The type of this variable"
        },
        {
            "sha": "f81ac384695b2a835b4160dee2b09db80607dd91",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/5d731354d0078eac1de9cd2c8e73074efb17b854/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/5d731354d0078eac1de9cd2c8e73074efb17b854/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=5d731354d0078eac1de9cd2c8e73074efb17b854",
            "patch": "@@ -763,13 +763,13 @@ describe('type check blocks', () => {\n \n       it('generates a references var when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain('var _t2 = (_t1 as any as core.TemplateRef<any>);');\n+        expect(block).toContain('var _t1 = (_t2 as any as core.TemplateRef<any>);');\n       });\n \n       it('generates a reference var when disabled', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, checkTemplateBodies: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n-        expect(block).toContain('var _t2 = (_t1 as any as core.TemplateRef<any>);');\n+        expect(block).toContain('var _t1 = (_t2 as any as core.TemplateRef<any>);');\n       });\n     });\n \n@@ -913,8 +913,8 @@ describe('type check blocks', () => {\n       it('should trace references to an <ng-template> when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n         expect(block).toContain(\n-            'var _t4 = (_t3 as any as core.TemplateRef<any>); ' +\n-            '\"\" + (((_t4).value2));');\n+            'var _t3 = (_t4 as any as core.TemplateRef<any>); ' +\n+            '\"\" + (((_t3).value2));');\n       });\n \n       it('should use any for reference types when disabled', () => {"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 6,
        "deletions": 7
    }
}