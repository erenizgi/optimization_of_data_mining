{
    "author": "petebacondarwin",
    "message": "build(docs-infra): target webcontainers for stackblitz \"live-example\" links (#44041)\n\nThis commit changes the Stackblitz live examples to create \"webcontainer\" projects on Stackblitz.\nThis approach supports the new Angular v13 packaging formats but webcontainers are not supported on some browers. So this is a temporary solution.\n\nPR Close #44041",
    "sha": "8020457ce213de2675daf58be2f972e8284a7670",
    "files": [
        {
            "sha": "13299eb38912abf6418d6da273bb48667addb47d",
            "filename": "aio/tools/stackblitz-builder/builder.mjs",
            "status": "modified",
            "additions": 18,
            "deletions": 35,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/8020457ce213de2675daf58be2f972e8284a7670/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs",
            "raw_url": "https://github.com/angular/angular/raw/8020457ce213de2675daf58be2f972e8284a7670/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs?ref=8020457ce213de2675daf58be2f972e8284a7670",
            "patch": "@@ -41,19 +41,6 @@ export class StackblitzBuilder {\n     }\n   }\n \n-  _addDependencies(config, postData) {\n-    // Extract npm package dependencies\n-    const exampleType = this._getExampleType(config.basePath);\n-    const packageJson = this._getBoilerplatePackageJson(exampleType) || this._getBoilerplatePackageJson('cli');\n-    const exampleDependencies = packageJson.dependencies;\n-\n-    // Add unit test packages from devDependencies for unit test examples\n-    const devDependencies = packageJson.devDependencies;\n-    (config.devDependencies || []).forEach(dep => exampleDependencies[dep] = devDependencies[dep]);\n-\n-    postData.dependencies = JSON.stringify(exampleDependencies);\n-  }\n-\n   _getExampleType(exampleDir) {\n     const configPath = `${exampleDir}/example-config.json`;\n     const configSrc = fs.existsSync(configPath) && fs.readFileSync(configPath, 'utf-8').trim();\n@@ -103,7 +90,9 @@ export class StackblitzBuilder {\n     try {\n       const config = this._initConfigAndCollectFileNames(configFileName);\n       const postData = this._createPostData(config, configFileName);\n-      this._addDependencies(config, postData);\n+\n+      this._addStackblitzrc(postData);\n+\n       const html = this._createStackblitzHtml(config, postData);\n       fs.writeFileSync(outputFileName, html, 'utf-8');\n       if (altFileName) {\n@@ -159,9 +148,19 @@ export class StackblitzBuilder {\n     }\n   }\n \n+  _addStackblitzrc(postData) {\n+    postData['project[files][.stackblitzrc]'] = JSON.stringify({\n+      installDependencies: true,\n+      startCommand: 'turbo start',\n+      env: {\n+        ENABLE_CJS_IMPORTS: true\n+      }\n+    });\n+  }\n+\n   _createBaseStackblitzHtml(config) {\n     const file = `?file=${this._getPrimaryFile(config)}`;\n-    const action = `https://run.stackblitz.com/api/angular/v1${file}`;\n+    const action = `https://stackblitz.com/run${file}`;\n \n     return `\n       <!DOCTYPE html><html lang=\"en\"><body>\n@@ -232,25 +231,14 @@ export class StackblitzBuilder {\n \n       content = regionExtractor()(content, extn.substr(1)).contents;\n \n-      postData[`files[${relativeFileName}]`] = content;\n+      postData[`project[files][${relativeFileName}]`] = content;\n     });\n \n-    // Stackblitz defaults to ViewEngine unless `\"enableIvy\": true`\n-    // So if there is a tsconfig.json file and there is no `enableIvy` property, we need to\n-    // explicitly set it.\n-    const tsConfigJSON = postData['files[tsconfig.json]'];\n-    if (tsConfigJSON !== undefined) {\n-      const tsConfig = json5.parse(tsConfigJSON);\n-      if (tsConfig.angularCompilerOptions.enableIvy === undefined) {\n-        tsConfig.angularCompilerOptions.enableIvy = true;\n-        postData['files[tsconfig.json]'] = JSON.stringify(tsConfig, null, 2);\n-      }\n-    }\n-\n     const tags = ['angular', 'example', ...config.tags || []];\n-    tags.forEach((tag, ix) => postData[`tags[${ix}]`] = tag);\n+    tags.forEach((tag, ix) => postData[`project[tags][${ix}]`] = tag);\n \n-    postData.description = `Angular Example - ${config.description}`;\n+    postData['project[description]'] = `Angular Example - ${config.description}`;\n+    postData['project[template]'] = 'node';\n \n     return postData;\n   }\n@@ -309,14 +297,9 @@ export class StackblitzBuilder {\n \n     const defaultExcludes = [\n       '!**/e2e/**/*.*',\n-      '!**/package.json',\n       '!**/example-config.json',\n       '!**/.editorconfig',\n       '!**/wallaby.js',\n-      '!**/karma-test-shim.js',\n-      '!**/karma.conf.js',\n-      '!**/test.ts',\n-      '!**/tsconfig.app.json',\n       '!**/*stackblitz.*'\n     ];\n "
        }
    ],
    "stats": {
        "total": 53,
        "additions": 18,
        "deletions": 35
    }
}