{
    "author": "josephperrott",
    "message": "fix(dev-infra): update type castings for JSON.parse usage (#40710)\n\nUpdate usages of JSON.parse to be cast as specific types.\n\nPR Close #40710",
    "sha": "cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
    "files": [
        {
            "sha": "9f52e50cd05809038d4ab2b78f80ebb22fac78ef",
            "filename": "dev-infra/format/formatters/buildifier.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbuildifier.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -28,7 +28,7 @@ export class Buildifier extends Formatter {\n       commandFlags: `${BAZEL_WARNING_FLAG} --lint=warn --mode=check --format=json`,\n       callback:\n           (_: string, code: number, stdout: string) => {\n-            return code !== 0 || !JSON.parse(stdout)['success'];\n+            return code !== 0 || !(JSON.parse(stdout) as {success: string}).success;\n           },\n     },\n     format: {"
        },
        {
            "sha": "757a4b279e0e5e392f4abcc7786549f9e15d959b",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -2391,7 +2391,7 @@ class Buildifier extends Formatter {\n             check: {\n                 commandFlags: `${BAZEL_WARNING_FLAG} --lint=warn --mode=check --format=json`,\n                 callback: (_, code, stdout) => {\n-                    return code !== 0 || !JSON.parse(stdout)['success'];\n+                    return code !== 0 || !JSON.parse(stdout).success;\n                 },\n             },\n             format: {"
        },
        {
            "sha": "16cb0d5b667f7f8ff56e6e5c35373ade77666ec5",
            "filename": "dev-infra/release/build/build.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fbuild%2Fbuild.spec.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -50,7 +50,7 @@ describe('ng-dev release build', () => {\n     expect(writeSpy).toHaveBeenCalledTimes(1);\n \n     const jsonText = writeSpy.calls.mostRecent().args[0] as string;\n-    const parsed = JSON.parse(jsonText);\n+    const parsed = JSON.parse(jsonText) as releaseConfig.BuiltPackage[];\n \n     expect(parsed).toEqual([\n       {name: '@angular/pkg1', outputPath: 'dist/pkg1'},"
        },
        {
            "sha": "2ffd33b4b4b75d4e3f8ba07bb87c7d86c823d449",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -82,7 +82,8 @@ export abstract class ReleaseAction {\n   /** Updates the version in the project top-level `package.json` file. */\n   protected async updateProjectVersion(newVersion: semver.SemVer) {\n     const pkgJsonPath = join(this.projectDir, packageJsonPath);\n-    const pkgJson = JSON.parse(await fs.readFile(pkgJsonPath, 'utf8'));\n+    const pkgJson =\n+        JSON.parse(await fs.readFile(pkgJsonPath, 'utf8')) as {version: string, [key: string]: any};\n     pkgJson.version = newVersion.format();\n     // Write the `package.json` file. Note that we add a trailing new line\n     // to avoid unnecessary diff. IDEs usually add a trailing new line.\n@@ -558,7 +559,8 @@ export abstract class ReleaseAction {\n   private async _verifyPackageVersions(version: semver.SemVer, packages: BuiltPackage[]) {\n     for (const pkg of packages) {\n       const {version: packageJsonVersion} =\n-          JSON.parse(await fs.readFile(join(pkg.outputPath, 'package.json'), 'utf8'));\n+          JSON.parse(await fs.readFile(join(pkg.outputPath, 'package.json'), 'utf8')) as\n+          {version: string, [key: string]: any};\n       if (version.compare(packageJsonVersion) !== 0) {\n         error(red('The built package version does not match the version being released.'));\n         error(`  Release Version:   ${version.version}`);"
        },
        {
            "sha": "3c9cfbe8f7071b376a68641b8cb6611f73b273ea",
            "filename": "dev-infra/release/publish/external-commands.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -64,7 +64,7 @@ export async function invokeReleaseBuildCommand(): Promise<BuiltPackage[]> {\n     info(green('  âœ“   Built release output for all packages.'));\n     // The `ng-dev release build` command prints a JSON array to stdout\n     // that represents the built release packages and their output paths.\n-    return JSON.parse(stdout.trim());\n+    return JSON.parse(stdout.trim()) as BuiltPackage[];\n   } catch (e) {\n     spinner.stop();\n     error(e);"
        },
        {
            "sha": "3802d6653eec1455e86e37f03c22afdad1fb7c8f",
            "filename": "dev-infra/release/publish/test/cut-next-prerelease.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcut-next-prerelease.spec.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -49,7 +49,7 @@ describe('cut next pre-release action', () => {\n     await expectStagingAndPublishWithoutCherryPick(action, 'master', '10.2.0-next.0', 'next');\n \n     const pkgJsonContents = readFileSync(join(action.testTmpDir, packageJsonPath), 'utf8');\n-    const pkgJson = JSON.parse(pkgJsonContents);\n+    const pkgJson = JSON.parse(pkgJsonContents) as {version: string, [key: string]: any};\n     expect(pkgJson.version).toBe('10.2.0-next.0', 'Expected version to not have changed.');\n   });\n "
        },
        {
            "sha": "5db34f82c3e011cdc918718d76efd5d8a5c3f01b",
            "filename": "dev-infra/release/versioning/version-branches.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fversion-branches.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -35,7 +35,8 @@ export async function getVersionOfBranch(\n     repo: GithubRepoWithApi, branchName: string): Promise<semver.SemVer> {\n   const {data} = await repo.api.repos.getContents(\n       {owner: repo.owner, repo: repo.name, path: '/package.json', ref: branchName});\n-  const {version} = JSON.parse(Buffer.from(data.content, 'base64').toString());\n+  const {version} = JSON.parse(Buffer.from(data.content, 'base64').toString()) as\n+      {version: string, [key: string]: any};\n   const parsedVersion = semver.parse(version);\n   if (parsedVersion === null) {\n     throw Error(`Invalid version detected in following branch: ${branchName}.`);"
        },
        {
            "sha": "f6eae504f9d25de6c0651708ebbbc505b88e0b3c",
            "filename": "dev-infra/ts-circular-dependencies/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Findex.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -93,7 +93,7 @@ export function main(\n     info(yellow(`   Please rerun with \"--warnings\" to inspect unresolved imports.`));\n   }\n \n-  const expected: Golden = JSON.parse(readFileSync(goldenFile, 'utf8'));\n+  const expected = JSON.parse(readFileSync(goldenFile, 'utf8')) as Golden;\n   const {fixedCircularDeps, newCircularDeps} = compareGoldens(actual, expected);\n   const isMatching = fixedCircularDeps.length === 0 && newCircularDeps.length === 0;\n "
        },
        {
            "sha": "28f1ca4e1a9177f4c3ed884360161716f438f56f",
            "filename": "modules/playground/e2e_test/sourcemap/sourcemap_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/modules%2Fplayground%2Fe2e_test%2Fsourcemap%2Fsourcemap_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/modules%2Fplayground%2Fe2e_test%2Fsourcemap%2Fsourcemap_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fplayground%2Fe2e_test%2Fsourcemap%2Fsourcemap_spec.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -42,7 +42,6 @@ describe('sourcemaps', function() {\n           Buffer.from(content.substring(index + marker.length), 'base64').toString('utf8');\n \n       const decoder = new SourceMapConsumer(JSON.parse(sourceMapData) as RawSourceMap);\n-\n       const originalPosition = decoder.originalPositionFor({line: errorLine, column: errorColumn});\n       const sourceCodeLines = readFileSync(require.resolve('../../src/sourcemap/index.ts'), {\n                                 encoding: 'UTF-8'"
        },
        {
            "sha": "9eb5c0b7ba36f4c3aa6835ce857b6b610c69c87a",
            "filename": "packages/bazel/test/ng_package/common_package.spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -112,12 +112,14 @@ describe('@angular/common ng_package', () => {\n     }\n     // https://github.com/angular/common-builds/blob/master/package.json\n     it('/', () => {\n-      const actual = JSON.parse(fs.readFileSync('package.json', {encoding: 'utf-8'})) as PackageJson;\n+      const actual =\n+          JSON.parse(fs.readFileSync('package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('./bundles/common.umd.js');\n     });\n     // https://github.com/angular/common-builds/blob/master/http/package.json\n     it('/http', () => {\n-      const actual = JSON.parse(fs.readFileSync('http/package.json', {encoding: 'utf-8'})) as PackageJson;\n+      const actual =\n+          JSON.parse(fs.readFileSync('http/package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('../bundles/common-http.umd.js');\n       expect(actual['es2015']).toEqual('../fesm2015/http.js');\n       expect(actual['module']).toEqual('../fesm2015/http.js');\n@@ -132,7 +134,8 @@ describe('@angular/common ng_package', () => {\n     // https://github.com/angular/common-builds/blob/master/http/testing/package.json\n     it('/http/testing', () => {\n       const actual =\n-          JSON.parse(fs.readFileSync('http/testing/package.json', {encoding: 'utf-8'})) as PackageJson;\n+          JSON.parse(fs.readFileSync('http/testing/package.json', {encoding: 'utf-8'})) as\n+          PackageJson;\n       expect(actual['main']).toEqual('../../bundles/common-http-testing.umd.js');\n       expect(actual['es2015']).toEqual('../../fesm2015/http/testing.js');\n       expect(actual['module']).toEqual('../../fesm2015/http/testing.js');"
        },
        {
            "sha": "9fecaa33a3fcaeaf75b6af5681cc4a972773e4af",
            "filename": "packages/benchpress/src/webdriver/chrome_driver_extension.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fchrome_driver_extension.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fchrome_driver_extension.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fchrome_driver_extension.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -86,7 +86,9 @@ export class ChromeDriverExtension extends WebDriverExtension {\n         .then((entries) => {\n           const events: PerfLogEvent[] = [];\n           entries.forEach((entry: any) => {\n-            const message = (JSON.parse(entry['message']) as {message: any})['message'];\n+            const message =\n+                (JSON.parse(entry['message']) as\n+                 {message: {method: string, params: PerfLogEvent}})['message'];\n             if (message['method'] === 'Tracing.dataCollected') {\n               events.push(message['params']);\n             }"
        },
        {
            "sha": "5da139a7e819139eeb00e4245d100033e9fd5048",
            "filename": "packages/benchpress/src/webdriver/ios_driver_extension.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fios_driver_extension.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fios_driver_extension.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbenchpress%2Fsrc%2Fwebdriver%2Fios_driver_extension.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -44,7 +44,9 @@ export class IOsDriverExtension extends WebDriverExtension {\n         .then((entries) => {\n           const records: any[] = [];\n           entries.forEach((entry: any) => {\n-            const message = (JSON.parse(entry['message']) as {message: any})['message'];\n+            const message =\n+                (JSON.parse(entry['message']) as\n+                 {message: {method: string, params: PerfLogEvent}})['message'];\n             if (message['method'] === 'Timeline.eventRecorded') {\n               records.push(message['params']['record']);\n             }"
        },
        {
            "sha": "6fc2657ba79dcbf6fbc6174f95d6199becb04ad5",
            "filename": "packages/benchpress/test/reporter/json_file_reporter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Ftest%2Freporter%2Fjson_file_reporter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/packages%2Fbenchpress%2Ftest%2Freporter%2Fjson_file_reporter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbenchpress%2Ftest%2Freporter%2Fjson_file_reporter_spec.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -50,7 +50,7 @@ import {Injector, JsonFileReporter, MeasureValues, Options, SampleDescription} f\n                  [mv(0, 0, {'a': 3, 'b': 6}), mv(1, 1, {'a': 5, 'b': 9})]);\n          const regExp = /somePath\\/someId_\\d+\\.json/;\n          expect(loggedFile['filename'].match(regExp) != null).toBe(true);\n-         const parsedContent = JSON.parse(loggedFile['content']) as any;\n+         const parsedContent = JSON.parse(loggedFile['content']) as {[key: string]: any};\n          expect(parsedContent).toEqual({\n            'description': {\n              'id': 'someId',"
        },
        {
            "sha": "777bce97c1721a10f9eb1b1039553a03053f041e",
            "filename": "tools/ts-api-guardian/lib/main.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/tools%2Fts-api-guardian%2Flib%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbdb5e208e3411cdb021e23f3602f8478ddd48c2/tools%2Fts-api-guardian%2Flib%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fts-api-guardian%2Flib%2Fmain.ts?ref=cbdb5e208e3411cdb021e23f3602f8478ddd48c2",
            "patch": "@@ -86,7 +86,8 @@ export function discoverAllEntrypoints(dirPath: string) {\n \n   // Get all typings file locations from package.json files\n   for (const packageJson of packageJsons) {\n-    const packageJsonObj = JSON.parse(fs.readFileSync(packageJson, {encoding: 'utf8'})) as any;\n+    const packageJsonObj =\n+        JSON.parse(fs.readFileSync(packageJson, {encoding: 'utf8'})) as {typings: string};\n     const typings = packageJsonObj.typings;\n     if (typings) {\n       entryPoints.push(path.join(path.dirname(packageJson), typings));"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 27,
        "deletions": 17
    }
}