{
    "author": "kyliau",
    "message": "test(language-service): Make project service a singleton (#39308)\n\nConstructing a project service is expensive. Making it a singleton could\nspeed up tests considerably.\n\nOn my MacBook Pro, test execution went from 24.4s to 14.5s (~40% improvement).\n\nPR Close #39308",
    "sha": "1b21350e1719428b8d0c3280add470d1b395e2af",
    "files": [
        {
            "sha": "b28c13335aa2d3136d5137bc100cba39c232a298",
            "filename": "packages/language-service/ivy/test/mock_host.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 11,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/1b21350e1719428b8d0c3280add470d1b395e2af/packages%2Flanguage-service%2Fivy%2Ftest%2Fmock_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/1b21350e1719428b8d0c3280add470d1b395e2af/packages%2Flanguage-service%2Fivy%2Ftest%2Fmock_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fmock_host.ts?ref=1b21350e1719428b8d0c3280add470d1b395e2af",
            "patch": "@@ -69,24 +69,32 @@ export const host: ts.server.ServerHost = {\n   },\n };\n \n+/**\n+ * Constructing a project service is expensive (~2.5s on MacBook Pro), so it\n+ * should be a singleton service shared throughout all tests.\n+ */\n+let projectService: ts.server.ProjectService;\n+\n /**\n  * Create a ConfiguredProject and an actual program for the test project located\n  * in packages/language-service/test/project. Project creation exercises the\n  * actual code path, but a mock host is used for the filesystem to intercept\n  * and modify test files.\n  */\n export function setup() {\n-  const projectService = new ts.server.ProjectService({\n-    host,\n-    logger,\n-    cancellationToken: ts.server.nullCancellationToken,\n-    useSingleInferredProject: true,\n-    useInferredProjectPerProjectRoot: true,\n-    typingsInstaller: ts.server.nullTypingsInstaller,\n-  });\n-  // Opening APP_COMPONENT forces a new ConfiguredProject to be created based\n-  // on the tsconfig.json in the test project.\n-  projectService.openClientFile(APP_COMPONENT);\n+  if (!projectService) {\n+    projectService = new ts.server.ProjectService({\n+      host,\n+      logger,\n+      cancellationToken: ts.server.nullCancellationToken,\n+      useSingleInferredProject: true,\n+      useInferredProjectPerProjectRoot: true,\n+      typingsInstaller: ts.server.nullTypingsInstaller,\n+    });\n+    // Opening APP_COMPONENT forces a new ConfiguredProject to be created based\n+    // on the tsconfig.json in the test project.\n+    projectService.openClientFile(APP_COMPONENT);\n+  }\n   const project = projectService.findProject(TSCONFIG);\n   if (!project) {\n     throw new Error(`Failed to create project for ${TSCONFIG}`);"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 19,
        "deletions": 11
    }
}