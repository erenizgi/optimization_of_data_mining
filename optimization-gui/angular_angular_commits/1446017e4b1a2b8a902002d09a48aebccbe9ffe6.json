{
    "author": "dgp1130",
    "message": "refactor(compiler-cli): call factories directly from extended template checker (#44391)\n\nRefs #42966.\n\nThis moves extended template check factory invocations into the checker itself, where it can provide a more consistent API contract. Factories are called with compiler options and may return a `TemplateCheck` or `undefined` if the current options do not support that check. This allows `nullishCoalescingNotNullable` to disable itself when `strictNullChecks` is disabled without throwing errors. This gives extended template diagnostics a stronger abstraction model to define their behavior with.\n\nPR Close #44391",
    "sha": "1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
    "files": [
        {
            "sha": "1c893b282df0823ff97bcf5e3779fe758b9de879",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -29,7 +29,7 @@ import {aliasTransformFactory, CompilationMode, declarationTransformFactory, Dec\n import {TemplateTypeCheckerImpl} from '../../typecheck';\n import {OptimizeFor, TemplateTypeChecker, TypeCheckingConfig} from '../../typecheck/api';\n import {ExtendedTemplateCheckerImpl} from '../../typecheck/extended';\n-import {ExtendedTemplateChecker, TemplateCheck} from '../../typecheck/extended/api';\n+import {ExtendedTemplateChecker} from '../../typecheck/extended/api';\n import {factory as invalidBananaInBoxFactory} from '../../typecheck/extended/checks/invalid_banana_in_box';\n import {factory as NullishCoalescingNotNullableFactory} from '../../typecheck/extended/checks/nullish_coalescing_not_nullable';\n import {getSourceFileOrNull, isDtsPath, toUnredirectedSourceFile} from '../../util/src/typescript';\n@@ -1067,12 +1067,9 @@ export class NgCompiler {\n         reflector, this.adapter, this.incrementalCompilation, scopeRegistry, typeCheckScopeRegistry,\n         this.delegatingPerfRecorder);\n \n-    const templateChecks: TemplateCheck<ErrorCode>[] = [invalidBananaInBoxFactory.create()];\n-    if (this.options.strictNullChecks) {\n-      templateChecks.push(NullishCoalescingNotNullableFactory.create());\n-    }\n-    const extendedTemplateChecker =\n-        new ExtendedTemplateCheckerImpl(templateTypeChecker, checker, templateChecks);\n+    const diagnosticFactories = [invalidBananaInBoxFactory, NullishCoalescingNotNullableFactory];\n+    const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n+        templateTypeChecker, checker, diagnosticFactories, this.options);\n \n     return {\n       isCore,"
        },
        {
            "sha": "e84bab1fe0f15f77b121392a82e13993bcfe984c",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2FBUILD.bazel?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -7,6 +7,7 @@ ts_library(\n     ),\n     visibility = [\"//packages/compiler-cli/src/ngtsc:__subpackages__\"],\n     deps = [\n+        \"//packages/compiler-cli/src/ngtsc/core:api\",\n         \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\","
        },
        {
            "sha": "8b2ad8e1b5e1decd84919ed89e64bb95759368ae",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/api/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2FBUILD.bazel?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -8,6 +8,7 @@ ts_library(\n     visibility = [\"//packages/compiler-cli/src/ngtsc:__subpackages__\"],\n     deps = [\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/core:api\",\n         \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"@npm//typescript\","
        },
        {
            "sha": "45f8b57e8e23a7eecb1d57130327e6fadfd728bf",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/api/api.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fapi%2Fapi.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -9,6 +9,7 @@\n import {AST, ASTWithSource, RecursiveAstVisitor, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstBoundText, TmplAstContent, TmplAstElement, TmplAstIcu, TmplAstNode, TmplAstRecursiveVisitor, TmplAstReference, TmplAstTemplate, TmplAstText, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n import ts from 'typescript';\n \n+import {NgCompilerOptions} from '../../../core/api';\n import {ErrorCode, ExtendedTemplateDiagnosticName} from '../../../diagnostics';\n import {NgTemplateDiagnostic, TemplateTypeChecker} from '../../api';\n \n@@ -49,7 +50,7 @@ export interface TemplateCheckFactory<\n > {\n   code: Code;\n   name: Name;\n-  create(): TemplateCheck<Code>;\n+  create(options: NgCompilerOptions): TemplateCheck<Code>|null;\n }\n \n /**"
        },
        {
            "sha": "58d4c7597cec59fdc615d3b1379b18f49b9fa29c",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/checks/nullish_coalescing_not_nullable/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2FBUILD.bazel?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -6,6 +6,7 @@ ts_library(\n     visibility = [\"//packages/compiler-cli/src/ngtsc:__subpackages__\"],\n     deps = [\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/core:api\",\n         \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\","
        },
        {
            "sha": "fcf8a12144ad8e2063a7e012456cf0219e0fd71e",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/checks/nullish_coalescing_not_nullable/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fchecks%2Fnullish_coalescing_not_nullable%2Findex.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -9,6 +9,7 @@\n import {AST, Binary, TmplAstNode} from '@angular/compiler';\n import ts from 'typescript';\n \n+import {NgCompilerOptions} from '../../../../core/api';\n import {ErrorCode, ExtendedTemplateDiagnosticName} from '../../../../diagnostics';\n import {NgTemplateDiagnostic, SymbolKind} from '../../../api';\n import {TemplateCheckFactory, TemplateCheckWithVisitor, TemplateContext} from '../../api';\n@@ -55,5 +56,12 @@ export const factory: TemplateCheckFactory<\n     ExtendedTemplateDiagnosticName.NULLISH_COALESCING_NOT_NULLABLE> = {\n   code: ErrorCode.NULLISH_COALESCING_NOT_NULLABLE,\n   name: ExtendedTemplateDiagnosticName.NULLISH_COALESCING_NOT_NULLABLE,\n-  create: () => new NullishCoalescingNotNullableCheck(),\n+  create: (options: NgCompilerOptions) => {\n+    // Require `strictNullChecks` to be enabled.\n+    if (options.strictNullChecks === false) {\n+      return null;\n+    }\n+\n+    return new NullishCoalescingNotNullableCheck();\n+  },\n };"
        },
        {
            "sha": "d0360ae33270e73564706a3c2fa33b1e3343021b",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/extended_template_checker.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -8,18 +8,24 @@\n \n import ts from 'typescript';\n \n-import {ErrorCode} from '../../../diagnostics';\n+import {NgCompilerOptions} from '../../../core/api';\n+import {ErrorCode, ExtendedTemplateDiagnosticName} from '../../../diagnostics';\n import {TemplateDiagnostic, TemplateTypeChecker} from '../../api';\n-import {ExtendedTemplateChecker, TemplateCheck, TemplateContext} from '../api';\n+import {ExtendedTemplateChecker, TemplateCheck, TemplateCheckFactory, TemplateContext} from '../api';\n \n export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n-  private ctx: TemplateContext;\n+  private readonly ctx: TemplateContext;\n+  private readonly templateChecks: TemplateCheck<ErrorCode>[];\n \n   constructor(\n       templateTypeChecker: TemplateTypeChecker, typeChecker: ts.TypeChecker,\n-      private readonly templateChecks: TemplateCheck<ErrorCode>[]) {\n+      templateCheckFactories:\n+          readonly TemplateCheckFactory<ErrorCode, ExtendedTemplateDiagnosticName>[],\n+      options: NgCompilerOptions) {\n     this.ctx = {templateTypeChecker: templateTypeChecker, typeChecker: typeChecker} as\n         TemplateContext;\n+    this.templateChecks = templateCheckFactories.map((factory) => factory.create(options))\n+                              .filter((check): check is TemplateCheck<ErrorCode> => check !== null);\n   }\n \n   getDiagnosticsForComponent(component: ts.ClassDeclaration): TemplateDiagnostic[] {"
        },
        {
            "sha": "bcab49d77272327e0d53fa3ad0a28d6b9d246c54",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/test/checks/invalid_banana_in_box/invalid_banana_in_box_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Finvalid_banana_in_box%2Finvalid_banana_in_box_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Finvalid_banana_in_box%2Finvalid_banana_in_box_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Finvalid_banana_in_box%2Finvalid_banana_in_box_spec.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -36,7 +36,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(1);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n@@ -56,7 +57,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(0);\n     });\n@@ -74,7 +76,8 @@ runInEachFileSystem(() => {\n          const sf = getSourceFileOrError(program, fileName);\n          const component = getClass(sf, 'TestCmp');\n          const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-             templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory.create()]);\n+             templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory],\n+             {} /* options */);\n          const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n          expect(diags.length).toBe(0);\n        });\n@@ -96,7 +99,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [invalidBananaInBoxFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(2);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);"
        },
        {
            "sha": "88fed5ac00734d9f6b5a655add5b1933517cfc53",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/test/checks/nullish_coalescing_not_nullable/nullish_coalescing_not_nullable_spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 12,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Fnullish_coalescing_not_nullable%2Fnullish_coalescing_not_nullable_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Fnullish_coalescing_not_nullable%2Fnullish_coalescing_not_nullable_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Fchecks%2Fnullish_coalescing_not_nullable%2Fnullish_coalescing_not_nullable_spec.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -25,6 +25,15 @@ runInEachFileSystem(() => {\n           .toBe(ExtendedTemplateDiagnosticName.NULLISH_COALESCING_NOT_NULLABLE);\n     });\n \n+    it('should return a check if `strictNullChecks` is enabled', () => {\n+      expect(nullishCoalescingNotNullableFactory.create({strictNullChecks: true})).toBeDefined();\n+      expect(nullishCoalescingNotNullableFactory.create({})).not.toBeNull();  // Defaults enabled.\n+    });\n+\n+    it('should not return a check if `strictNullChecks` is disabled', () => {\n+      expect(nullishCoalescingNotNullableFactory.create({strictNullChecks: false})).toBeNull();\n+    });\n+\n     it('should produce nullish coalescing warning', () => {\n       const fileName = absoluteFrom('/main.ts');\n       const {program, templateTypeChecker} = setup([{\n@@ -37,8 +46,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(),\n-          [nullishCoalescingNotNullableFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(1);\n       expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n@@ -58,8 +67,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(),\n-          [nullishCoalescingNotNullableFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(0);\n     });\n@@ -76,8 +85,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(),\n-          [nullishCoalescingNotNullableFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(0);\n     });\n@@ -105,8 +114,8 @@ runInEachFileSystem(() => {\n          const sf = getSourceFileOrError(program, fileName);\n          const component = getClass(sf, 'TestCmp');\n          const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-             templateTypeChecker, program.getTypeChecker(),\n-             [nullishCoalescingNotNullableFactory.create()]);\n+             templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+             {} /* options */);\n          const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n          expect(diags.length).toBe(1);\n          expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n@@ -138,8 +147,8 @@ runInEachFileSystem(() => {\n       const sf = getSourceFileOrError(program, fileName);\n       const component = getClass(sf, 'TestCmp');\n       const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-          templateTypeChecker, program.getTypeChecker(),\n-          [nullishCoalescingNotNullableFactory.create()]);\n+          templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+          {} /* options */);\n       const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n       expect(diags.length).toBe(0);\n     });\n@@ -163,8 +172,8 @@ runInEachFileSystem(() => {\n          const sf = getSourceFileOrError(program, fileName);\n          const component = getClass(sf, 'TestCmp');\n          const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-             templateTypeChecker, program.getTypeChecker(),\n-             [nullishCoalescingNotNullableFactory.create()]);\n+             templateTypeChecker, program.getTypeChecker(), [nullishCoalescingNotNullableFactory],\n+             {} /* options */);\n          const diags = extendedTemplateChecker.getDiagnosticsForComponent(component);\n          expect(diags.length).toBe(0);\n        });"
        },
        {
            "sha": "17511407c452d4052219f668ddf1c0363c7947d4",
            "filename": "packages/compiler-cli/test/ngtsc/extended_template_diagnostics_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 19,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1446017e4b1a2b8a902002d09a48aebccbe9ffe6/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts?ref=1446017e4b1a2b8a902002d09a48aebccbe9ffe6",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import ts from 'typescript';\n+\n import {ErrorCode, ngErrorCode} from '../../src/ngtsc/diagnostics';\n import {runInEachFileSystem} from '../../src/ngtsc/file_system/testing';\n import {getSourceCodeForDiagnostic, loadStandardTestFiles} from '../../src/ngtsc/testing';\n@@ -122,24 +123,5 @@ runInEachFileSystem(() => {\n       expect(diags[0].code).toBe(ngErrorCode(ErrorCode.NULLISH_COALESCING_NOT_NULLABLE));\n       expect(getSourceCodeForDiagnostic(diags[0])).toBe('bar ?? \"foo\"');\n     });\n-\n-    it(`should not produce nullish coalescing not nullable warning with strictNullChecks disabled`,\n-       () => {\n-         env.tsconfig(\n-             {_extendedTemplateDiagnostics: true, strictTemplates: true, strictNullChecks: false});\n-         env.write('test.ts', `\n-              import {Component} from '@angular/core';\n-              @Component({\n-                selector: 'test',\n-                template: '{{ bar ?? \"foo\" }}',\n-              })\n-              export class TestCmp {\n-                bar: string = undefined;\n-              }\n-            `);\n-\n-         const diags = env.driveDiagnostics();\n-         expect(diags.length).toBe(0);\n-       });\n   });\n });"
        }
    ],
    "stats": {
        "total": 106,
        "additions": 58,
        "deletions": 48
    }
}