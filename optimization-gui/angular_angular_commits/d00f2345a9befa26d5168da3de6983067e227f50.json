{
    "author": "petebacondarwin",
    "message": "refactor(compiler): expose token parts in Text nodes (#43132)\n\nWhen it was tokenized, text content is split into parts that can include\ninterpolations and encoded entities tokens.\n\nTo make this information available to downstream processing, this commit\nadds these tokens to the `Text` AST nodes, with suitable processing.\n\nPR Close #43132",
    "sha": "d00f2345a9befa26d5168da3de6983067e227f50",
    "files": [
        {
            "sha": "7bb07f9b7bdd4fc6e2fdc356072b6817144fb1dc",
            "filename": "packages/compiler/src/i18n/extractor_merger.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fi18n%2Fextractor_merger.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fi18n%2Fextractor_merger.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fi18n%2Fextractor_merger.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -396,12 +396,12 @@ class _Visitor implements html.Visitor {\n           if (nodes.length == 0) {\n             translatedAttributes.push(new html.Attribute(\n                 attr.name, '', attr.sourceSpan, undefined /* keySpan */, undefined /* valueSpan */,\n-                undefined /* i18n */));\n+                undefined /* valueTokens */, undefined /* i18n */));\n           } else if (nodes[0] instanceof html.Text) {\n             const value = (nodes[0] as html.Text).value;\n             translatedAttributes.push(new html.Attribute(\n                 attr.name, value, attr.sourceSpan, undefined /* keySpan */,\n-                undefined /* valueSpan */, undefined /* i18n */));\n+                undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */));\n           } else {\n             this._reportError(\n                 el,"
        },
        {
            "sha": "a8abcc80a612b205f19d65f0872c645602ac69f0",
            "filename": "packages/compiler/src/ml_parser/ast.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fast.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fast.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -9,6 +9,7 @@\n import {AstPath} from '../ast_path';\n import {I18nMeta} from '../i18n/i18n_ast';\n import {ParseSourceSpan} from '../parse_util';\n+import {Token} from './lexer';\n \n interface BaseNode {\n   sourceSpan: ParseSourceSpan;\n@@ -23,7 +24,8 @@ export abstract class NodeWithI18n implements BaseNode {\n }\n \n export class Text extends NodeWithI18n {\n-  constructor(public value: string, sourceSpan: ParseSourceSpan, i18n?: I18nMeta) {\n+  constructor(\n+      public value: string, sourceSpan: ParseSourceSpan, public tokens: Token[], i18n?: I18nMeta) {\n     super(sourceSpan, i18n);\n   }\n   override visit(visitor: Visitor, context: any): any {\n@@ -55,8 +57,8 @@ export class ExpansionCase implements BaseNode {\n export class Attribute extends NodeWithI18n {\n   constructor(\n       public name: string, public value: string, sourceSpan: ParseSourceSpan,\n-      readonly keySpan: ParseSourceSpan|undefined, public valueSpan?: ParseSourceSpan,\n-      i18n?: I18nMeta) {\n+      readonly keySpan: ParseSourceSpan|undefined, public valueSpan: ParseSourceSpan|undefined,\n+      public valueTokens: Token[]|undefined, i18n: I18nMeta|undefined) {\n     super(sourceSpan, i18n);\n   }\n   override visit(visitor: Visitor, context: any): any {"
        },
        {
            "sha": "57045ee8dcc9fefef2383d74530fceda12dead5c",
            "filename": "packages/compiler/src/ml_parser/html_whitespaces.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fhtml_whitespaces.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fhtml_whitespaces.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fhtml_whitespaces.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -8,6 +8,7 @@\n \n import * as html from './ast';\n import {NGSP_UNICODE} from './entities';\n+import {Token, TokenType} from './lexer';\n import {ParseTreeResult} from './parser';\n \n export const PRESERVE_WS_ATTR_NAME = 'ngPreserveWhitespaces';\n@@ -74,8 +75,13 @@ export class WhitespaceVisitor implements html.Visitor {\n         (context.prev instanceof html.Expansion || context.next instanceof html.Expansion);\n \n     if (isNotBlank || hasExpansionSibling) {\n-      return new html.Text(\n-          replaceNgsp(text.value).replace(WS_REPLACE_REGEXP, ' '), text.sourceSpan, text.i18n);\n+      // Process the whitespace in the tokens of this Text node\n+      const tokens = text.tokens.map(\n+          token => token.type === TokenType.TEXT ? createTextTokenAfterWhitespaceProcessing(token) :\n+                                                   token);\n+      // Process the whitespace of the value of this Text node\n+      const value = processWhitespace(text.value);\n+      return new html.Text(value, text.sourceSpan, tokens, text.i18n);\n     }\n \n     return null;\n@@ -94,6 +100,14 @@ export class WhitespaceVisitor implements html.Visitor {\n   }\n }\n \n+function createTextTokenAfterWhitespaceProcessing(token: Token): Token {\n+  return new Token(token.type, [processWhitespace(token.parts[0])], token.sourceSpan);\n+}\n+\n+function processWhitespace(text: string): string {\n+  return replaceNgsp(text).replace(WS_REPLACE_REGEXP, ' ');\n+}\n+\n export function removeWhitespaces(htmlAstWithErrors: ParseTreeResult): ParseTreeResult {\n   return new ParseTreeResult(\n       html.visitAll(new WhitespaceVisitor(), htmlAstWithErrors.rootNodes),"
        },
        {
            "sha": "6e1028422a64aff73222af9c5906b3282992e995",
            "filename": "packages/compiler/src/ml_parser/icu_ast_expander.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 11,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Ficu_ast_expander.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Ficu_ast_expander.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Ficu_ast_expander.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -102,14 +102,15 @@ function _expandPluralForm(ast: html.Expansion, errors: ParseError[]): html.Elem\n     errors.push(...expansionResult.errors);\n \n     return new html.Element(\n-        `ng-template`, [new html.Attribute(\n-                           'ngPluralCase', `${c.value}`, c.valueSourceSpan, undefined /* keySpan */,\n-                           undefined /* valueSpan */, undefined /* i18n */)],\n+        `ng-template`,\n+        [new html.Attribute(\n+            'ngPluralCase', `${c.value}`, c.valueSourceSpan, undefined /* keySpan */,\n+            undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */)],\n         expansionResult.nodes, c.sourceSpan, c.sourceSpan, c.sourceSpan);\n   });\n   const switchAttr = new html.Attribute(\n       '[ngPlural]', ast.switchValue, ast.switchValueSourceSpan, undefined /* keySpan */,\n-      undefined /* valueSpan */, undefined /* i18n */);\n+      undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */);\n   return new html.Element(\n       'ng-container', [switchAttr], children, ast.sourceSpan, ast.sourceSpan, ast.sourceSpan);\n }\n@@ -123,21 +124,23 @@ function _expandDefaultForm(ast: html.Expansion, errors: ParseError[]): html.Ele\n     if (c.value === 'other') {\n       // other is the default case when no values match\n       return new html.Element(\n-          `ng-template`, [new html.Attribute(\n-                             'ngSwitchDefault', '', c.valueSourceSpan, undefined /* keySpan */,\n-                             undefined /* valueSpan */, undefined /* i18n */)],\n+          `ng-template`,\n+          [new html.Attribute(\n+              'ngSwitchDefault', '', c.valueSourceSpan, undefined /* keySpan */,\n+              undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */)],\n           expansionResult.nodes, c.sourceSpan, c.sourceSpan, c.sourceSpan);\n     }\n \n     return new html.Element(\n-        `ng-template`, [new html.Attribute(\n-                           'ngSwitchCase', `${c.value}`, c.valueSourceSpan, undefined /* keySpan */,\n-                           undefined /* valueSpan */, undefined /* i18n */)],\n+        `ng-template`,\n+        [new html.Attribute(\n+            'ngSwitchCase', `${c.value}`, c.valueSourceSpan, undefined /* keySpan */,\n+            undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */)],\n         expansionResult.nodes, c.sourceSpan, c.sourceSpan, c.sourceSpan);\n   });\n   const switchAttr = new html.Attribute(\n       '[ngSwitch]', ast.switchValue, ast.switchValueSourceSpan, undefined /* keySpan */,\n-      undefined /* valueSpan */, undefined /* i18n */);\n+      undefined /* valueSpan */, undefined /* valueTokens */, undefined /* i18n */);\n   return new html.Element(\n       'ng-container', [switchAttr], children, ast.sourceSpan, ast.sourceSpan, ast.sourceSpan);\n }"
        },
        {
            "sha": "aff1358588eb6a31e73a52334db4c4d0e95a5c68",
            "filename": "packages/compiler/src/ml_parser/parser.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -216,21 +216,23 @@ class _TreeBuilder {\n   }\n \n   private _consumeText(token: lex.Token) {\n+    const tokens = [token];\n     const startSpan = token.sourceSpan;\n     let text = token.parts[0];\n     if (text.length > 0 && text[0] === '\\n') {\n       const parent = this._getParentElement();\n       if (parent != null && parent.children.length === 0 &&\n           this.getTagDefinition(parent.name).ignoreFirstLf) {\n         text = text.substring(1);\n+        tokens[0] = {type: token.type, sourceSpan: token.sourceSpan, parts: [text]};\n       }\n     }\n \n-    // For now recombine text, interpolation and entity tokens\n     while (this._peek.type === lex.TokenType.INTERPOLATION ||\n            this._peek.type === lex.TokenType.TEXT ||\n            this._peek.type === lex.TokenType.ENCODED_ENTITY) {\n       token = this._advance();\n+      tokens.push(token);\n       if (token.type === lex.TokenType.INTERPOLATION) {\n         // For backward compatibility we decode HTML entities that appear in interpolation\n         // expressions. This is arguably a bug, but it could be a considerable breaking change to\n@@ -248,8 +250,8 @@ class _TreeBuilder {\n       const endSpan = token.sourceSpan;\n       this._addToParent(new html.Text(\n           text,\n-          new ParseSourceSpan(\n-              startSpan.start, endSpan.end, startSpan.fullStart, startSpan.details)));\n+          new ParseSourceSpan(startSpan.start, endSpan.end, startSpan.fullStart, startSpan.details),\n+          tokens));\n     }\n   }\n \n@@ -372,16 +374,17 @@ class _TreeBuilder {\n \n     // Consume the attribute value\n     let value = '';\n+    const valueTokens: lex.Token[] = [];\n     let valueStartSpan: ParseSourceSpan|undefined = undefined;\n     let valueEnd: ParseLocation|undefined = undefined;\n     if (this._peek.type === lex.TokenType.ATTR_VALUE_TEXT) {\n       valueStartSpan = this._peek.sourceSpan;\n       valueEnd = this._peek.sourceSpan.end;\n-      // For now recombine text, interpolation and entity tokens\n       while (this._peek.type === lex.TokenType.ATTR_VALUE_TEXT ||\n              this._peek.type === lex.TokenType.ATTR_VALUE_INTERPOLATION ||\n              this._peek.type === lex.TokenType.ENCODED_ENTITY) {\n-        let valueToken = this._advance();\n+        const valueToken = this._advance();\n+        valueTokens.push(valueToken);\n         if (valueToken.type === lex.TokenType.ATTR_VALUE_INTERPOLATION) {\n           // For backward compatibility we decode HTML entities that appear in interpolation\n           // expressions. This is arguably a bug, but it could be a considerable breaking change to\n@@ -408,7 +411,8 @@ class _TreeBuilder {\n     return new html.Attribute(\n         fullName, value,\n         new ParseSourceSpan(attrName.sourceSpan.start, attrEnd, attrName.sourceSpan.fullStart),\n-        attrName.sourceSpan, valueSpan);\n+        attrName.sourceSpan, valueSpan, valueTokens.length > 0 ? valueTokens : undefined,\n+        undefined);\n   }\n \n   private _getParentElement(): html.Element|null {"
        },
        {
            "sha": "818ae726cedbc0acaf1df5678801fda0607d5046",
            "filename": "packages/compiler/test/ml_parser/ast_spec_utils.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -52,12 +52,16 @@ class _Humanizer implements html.Visitor {\n   }\n \n   visitAttribute(attribute: html.Attribute, context: any): any {\n-    const res = this._appendContext(attribute, [html.Attribute, attribute.name, attribute.value]);\n+    const valueTokens = attribute.valueTokens ?? [];\n+    const res = this._appendContext(attribute, [\n+      html.Attribute, attribute.name, attribute.value, ...valueTokens.map(token => token.parts)\n+    ]);\n     this.result.push(res);\n   }\n \n   visitText(text: html.Text, context: any): any {\n-    const res = this._appendContext(text, [html.Text, text.value, this.elDepth]);\n+    const res = this._appendContext(\n+        text, [html.Text, text.value, this.elDepth, ...text.tokens.map(token => token.parts)]);\n     this.result.push(res);\n   }\n "
        },
        {
            "sha": "adb6d5db909b8885a16f8b02fac4860a5086c826",
            "filename": "packages/compiler/test/ml_parser/html_parser_spec.ts",
            "status": "modified",
            "additions": 117,
            "deletions": 67,
            "changes": 184,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -24,31 +24,31 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n     describe('parse', () => {\n       describe('text nodes', () => {\n         it('should parse root level text nodes', () => {\n-          expect(humanizeDom(parser.parse('a', 'TestComp'))).toEqual([[html.Text, 'a', 0]]);\n+          expect(humanizeDom(parser.parse('a', 'TestComp'))).toEqual([[html.Text, 'a', 0, ['a']]]);\n         });\n \n         it('should parse text nodes inside regular elements', () => {\n           expect(humanizeDom(parser.parse('<div>a</div>', 'TestComp'))).toEqual([\n-            [html.Element, 'div', 0], [html.Text, 'a', 1]\n+            [html.Element, 'div', 0], [html.Text, 'a', 1, ['a']]\n           ]);\n         });\n \n         it('should parse text nodes inside <ng-template> elements', () => {\n           expect(humanizeDom(parser.parse('<ng-template>a</ng-template>', 'TestComp'))).toEqual([\n-            [html.Element, 'ng-template', 0], [html.Text, 'a', 1]\n+            [html.Element, 'ng-template', 0], [html.Text, 'a', 1, ['a']]\n           ]);\n         });\n \n         it('should parse CDATA', () => {\n           expect(humanizeDom(parser.parse('<![CDATA[text]]>', 'TestComp'))).toEqual([\n-            [html.Text, 'text', 0]\n+            [html.Text, 'text', 0, ['text']]\n           ]);\n         });\n \n         it('should normalize line endings within CDATA', () => {\n           const parsed = parser.parse('<![CDATA[ line 1 \\r\\n line 2 ]]>', 'TestComp');\n           expect(humanizeDom(parsed)).toEqual([\n-            [html.Text, ' line 1 \\n line 2 ', 0],\n+            [html.Text, ' line 1 \\n line 2 ', 0, [' line 1 \\n line 2 ']],\n           ]);\n           expect(parsed.errors).toEqual([]);\n         });\n@@ -76,8 +76,8 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n           expect(humanizeDom(parser.parse('<link rel=\"author license\" href=\"/about\">', 'TestComp')))\n               .toEqual([\n                 [html.Element, 'link', 0],\n-                [html.Attribute, 'rel', 'author license'],\n-                [html.Attribute, 'href', '/about'],\n+                [html.Attribute, 'rel', 'author license', ['author license']],\n+                [html.Attribute, 'href', '/about', ['/about']],\n               ]);\n         });\n \n@@ -106,19 +106,19 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n         it('should close void elements on text nodes', () => {\n           expect(humanizeDom(parser.parse('<p>before<br>after</p>', 'TestComp'))).toEqual([\n             [html.Element, 'p', 0],\n-            [html.Text, 'before', 1],\n+            [html.Text, 'before', 1, ['before']],\n             [html.Element, 'br', 1],\n-            [html.Text, 'after', 1],\n+            [html.Text, 'after', 1, ['after']],\n           ]);\n         });\n \n         it('should support optional end tags', () => {\n           expect(humanizeDom(parser.parse('<div><p>1<p>2</div>', 'TestComp'))).toEqual([\n             [html.Element, 'div', 0],\n             [html.Element, 'p', 1],\n-            [html.Text, '1', 2],\n+            [html.Text, '1', 2, ['1']],\n             [html.Element, 'p', 1],\n-            [html.Text, '2', 2],\n+            [html.Text, '2', 2, ['2']],\n           ]);\n         });\n \n@@ -200,12 +200,12 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n                      'TestComp')))\n               .toEqual([\n                 [html.Element, 'p', 0],\n-                [html.Text, '\\n', 1],\n+                [html.Text, '\\n', 1, ['\\n']],\n                 [html.Element, 'textarea', 0],\n                 [html.Element, 'pre', 0],\n-                [html.Text, '\\n', 1],\n+                [html.Text, '\\n', 1, ['\\n']],\n                 [html.Element, 'listing', 0],\n-                [html.Text, '\\n', 1],\n+                [html.Text, '\\n', 1, ['\\n']],\n               ]);\n         });\n \n@@ -214,28 +214,28 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n           parsed = parser.parse('<title> line 1 \\r\\n line 2 </title>', 'TestComp');\n           expect(humanizeDom(parsed)).toEqual([\n             [html.Element, 'title', 0],\n-            [html.Text, ' line 1 \\n line 2 ', 1],\n+            [html.Text, ' line 1 \\n line 2 ', 1, [' line 1 \\n line 2 ']],\n           ]);\n           expect(parsed.errors).toEqual([]);\n \n           parsed = parser.parse('<script> line 1 \\r\\n line 2 </script>', 'TestComp');\n           expect(humanizeDom(parsed)).toEqual([\n             [html.Element, 'script', 0],\n-            [html.Text, ' line 1 \\n line 2 ', 1],\n+            [html.Text, ' line 1 \\n line 2 ', 1, [' line 1 \\n line 2 ']],\n           ]);\n           expect(parsed.errors).toEqual([]);\n \n           parsed = parser.parse('<div> line 1 \\r\\n line 2 </div>', 'TestComp');\n           expect(humanizeDom(parsed)).toEqual([\n             [html.Element, 'div', 0],\n-            [html.Text, ' line 1 \\n line 2 ', 1],\n+            [html.Text, ' line 1 \\n line 2 ', 1, [' line 1 \\n line 2 ']],\n           ]);\n           expect(parsed.errors).toEqual([]);\n \n           parsed = parser.parse('<span> line 1 \\r\\n line 2 </span>', 'TestComp');\n           expect(humanizeDom(parsed)).toEqual([\n             [html.Element, 'span', 0],\n-            [html.Text, ' line 1 \\n line 2 ', 1],\n+            [html.Text, ' line 1 \\n line 2 ', 1, [' line 1 \\n line 2 ']],\n           ]);\n           expect(parsed.errors).toEqual([]);\n         });\n@@ -262,8 +262,22 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n         it('should parse attributes on regular elements case sensitive', () => {\n           expect(humanizeDom(parser.parse('<div kEy=\"v\" key2=v2></div>', 'TestComp'))).toEqual([\n             [html.Element, 'div', 0],\n-            [html.Attribute, 'kEy', 'v'],\n-            [html.Attribute, 'key2', 'v2'],\n+            [html.Attribute, 'kEy', 'v', ['v']],\n+            [html.Attribute, 'key2', 'v2', ['v2']],\n+          ]);\n+        });\n+\n+        it('should parse attributes containing interpolation', () => {\n+          expect(humanizeDom(parser.parse('<div foo=\"1{{message}}2\"></div>', 'TestComp'))).toEqual([\n+            [html.Element, 'div', 0],\n+            [html.Attribute, 'foo', '1{{message}}2', ['1'], ['{{', 'message', '}}'], ['2']]\n+          ]);\n+        });\n+\n+        it('should parse attributes containing encoded entities', () => {\n+          expect(humanizeDom(parser.parse('<div foo=\"&amp;\"></div>', 'TestComp'))).toEqual([\n+            [html.Element, 'div', 0],\n+            [html.Attribute, 'foo', '&', [''], ['&', '&amp;'], ['']],\n           ]);\n         });\n \n@@ -303,7 +317,10 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n                   html.Element, 'div', 0, '<div foo=\"{{&amp;}}\"></div>', '<div foo=\"{{&amp;}}\">',\n                   '</div>'\n                 ],\n-                [html.Attribute, 'foo', '{{&}}', 'foo=\"{{&amp;}}\"']\n+                [\n+                  html.Attribute, 'foo', '{{&}}', [''], ['{{', '&amp;', '}}'], [''],\n+                  'foo=\"{{&amp;}}\"'\n+                ]\n               ]);\n         });\n \n@@ -312,7 +329,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n               parser.parse('<div key=\"  \\r\\n line 1 \\r\\n   line 2  \"></div>', 'TestComp');\n           expect(humanizeDom(result)).toEqual([\n             [html.Element, 'div', 0],\n-            [html.Attribute, 'key', '  \\n line 1 \\n   line 2  '],\n+            [html.Attribute, 'key', '  \\n line 1 \\n   line 2  ', ['  \\n line 1 \\n   line 2  ']],\n           ]);\n           expect(result.errors).toEqual([]);\n         });\n@@ -327,22 +344,22 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n         it('should parse attributes on svg elements case sensitive', () => {\n           expect(humanizeDom(parser.parse('<svg viewBox=\"0\"></svg>', 'TestComp'))).toEqual([\n             [html.Element, ':svg:svg', 0],\n-            [html.Attribute, 'viewBox', '0'],\n+            [html.Attribute, 'viewBox', '0', ['0']],\n           ]);\n         });\n \n         it('should parse attributes on <ng-template> elements', () => {\n           expect(humanizeDom(parser.parse('<ng-template k=\"v\"></ng-template>', 'TestComp')))\n               .toEqual([\n                 [html.Element, 'ng-template', 0],\n-                [html.Attribute, 'k', 'v'],\n+                [html.Attribute, 'k', 'v', ['v']],\n               ]);\n         });\n \n         it('should support namespace', () => {\n           expect(humanizeDom(parser.parse('<svg:use xlink:href=\"Port\" />', 'TestComp'))).toEqual([\n             [html.Element, ':svg:use', 0],\n-            [html.Attribute, ':xlink:href', 'Port'],\n+            [html.Attribute, ':xlink:href', 'Port', ['Port']],\n           ]);\n         });\n \n@@ -379,23 +396,23 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n           expect(humanizeDom(parsed)).toEqual([\n             [html.Element, 'div', 0],\n-            [html.Text, 'before', 1],\n+            [html.Text, 'before', 1, ['before']],\n             [html.Expansion, 'messages.length', 'plural', 1],\n             [html.ExpansionCase, '=0', 2],\n             [html.ExpansionCase, '=1', 2],\n-            [html.Text, 'after', 1],\n+            [html.Text, 'after', 1, ['after']],\n           ]);\n           const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n           expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-            [html.Text, 'You have ', 0],\n+            [html.Text, 'You have ', 0, ['You have ']],\n             [html.Element, 'b', 0],\n-            [html.Text, 'no', 1],\n-            [html.Text, ' messages', 0],\n+            [html.Text, 'no', 1, ['no']],\n+            [html.Text, ' messages', 0, [' messages']],\n           ]);\n \n           expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-            [html.Text, 'One {{message}}', 0]\n+            [html.Text, 'One {{message}}', 0, ['One '], ['{{', 'message', '}}'], ['']]\n           ]);\n         });\n \n@@ -417,20 +434,20 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              expect(humanizeDom(parsed)).toEqual([\n                [html.Element, 'div', 0],\n-               [html.Text, '\\n  ', 1],\n+               [html.Text, '\\n  ', 1, ['\\n  ']],\n                [html.Expansion, '\\n    messages.length', 'plural', 1],\n                [html.ExpansionCase, '=0', 2],\n                [html.ExpansionCase, '=1', 2],\n-               [html.Text, '\\n', 1],\n+               [html.Text, '\\n', 1, ['\\n']],\n              ]);\n              const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n              expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-               [html.Text, 'You have \\nno\\n messages', 0],\n+               [html.Text, 'You have \\nno\\n messages', 0, ['You have \\nno\\n messages']],\n              ]);\n \n              expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-               [html.Text, 'One {{message}}', 0]\n+               [html.Text, 'One {{message}}', 0, ['One '], ['{{', 'message', '}}'], ['']]\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -450,20 +467,20 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              expect(humanizeDom(parsed)).toEqual([\n                [html.Element, 'div', 0],\n-               [html.Text, '\\n  ', 1],\n+               [html.Text, '\\n  ', 1, ['\\n  ']],\n                [html.Expansion, '\\r\\n    messages.length', 'plural', 1],\n                [html.ExpansionCase, '=0', 2],\n                [html.ExpansionCase, '=1', 2],\n-               [html.Text, '\\n', 1],\n+               [html.Text, '\\n', 1, ['\\n']],\n              ]);\n              const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n              expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-               [html.Text, 'You have \\nno\\n messages', 0],\n+               [html.Text, 'You have \\nno\\n messages', 0, ['You have \\nno\\n messages']],\n              ]);\n \n              expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-               [html.Text, 'One {{message}}', 0]\n+               [html.Text, 'One {{message}}', 0, ['One '], ['{{', 'message', '}}'], ['']]\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -487,20 +504,20 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              expect(humanizeDom(parsed)).toEqual([\n                [html.Element, 'div', 0],\n-               [html.Text, '\\n  ', 1],\n+               [html.Text, '\\n  ', 1, ['\\n  ']],\n                [html.Expansion, '\\n    messages.length', 'plural', 1],\n                [html.ExpansionCase, '=0', 2],\n                [html.ExpansionCase, '=1', 2],\n-               [html.Text, '\\n', 1],\n+               [html.Text, '\\n', 1, ['\\n']],\n              ]);\n              const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n              expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-               [html.Text, 'You have \\nno\\n messages', 0],\n+               [html.Text, 'You have \\nno\\n messages', 0, ['You have \\nno\\n messages']],\n              ]);\n \n              expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-               [html.Text, 'One {{message}}', 0]\n+               [html.Text, 'One {{message}}', 0, ['One '], ['{{', 'message', '}}'], ['']]\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -520,20 +537,20 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              expect(humanizeDom(parsed)).toEqual([\n                [html.Element, 'div', 0],\n-               [html.Text, '\\n  ', 1],\n+               [html.Text, '\\n  ', 1, ['\\n  ']],\n                [html.Expansion, '\\r\\n    messages.length', 'plural', 1],\n                [html.ExpansionCase, '=0', 2],\n                [html.ExpansionCase, '=1', 2],\n-               [html.Text, '\\n', 1],\n+               [html.Text, '\\n', 1, ['\\n']],\n              ]);\n              const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n              expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-               [html.Text, 'You have \\nno\\n messages', 0],\n+               [html.Text, 'You have \\nno\\n messages', 0, ['You have \\nno\\n messages']],\n              ]);\n \n              expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-               [html.Text, 'One {{message}}', 0]\n+               [html.Text, 'One {{message}}', 0, ['One '], ['{{', 'message', '}}'], ['']]\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -566,7 +583,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n           expect(humanizeDom(new ParseTreeResult(firstCase.expression, []))).toEqual([\n             [html.Expansion, 'p.gender', 'select', 0],\n             [html.ExpansionCase, 'male', 1],\n-            [html.Text, ' ', 0],\n+            [html.Text, ' ', 0, [' ']],\n           ]);\n         });\n \n@@ -594,10 +611,10 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              const expansion = parsed.rootNodes[0] as html.Expansion;\n              expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n-               [html.Text, 'zero \\n       ', 0],\n+               [html.Text, 'zero \\n       ', 0, ['zero \\n       ']],\n                [html.Expansion, '\\n         p.gender', 'select', 0],\n                [html.ExpansionCase, 'male', 1],\n-               [html.Text, '\\n     ', 0],\n+               [html.Text, '\\n     ', 0, ['\\n     ']],\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -623,10 +640,10 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              const expansion = parsed.rootNodes[0] as html.Expansion;\n              expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n-               [html.Text, 'zero \\n       ', 0],\n+               [html.Text, 'zero \\n       ', 0, ['zero \\n       ']],\n                [html.Expansion, '\\r\\n         p.gender', 'select', 0],\n                [html.ExpansionCase, 'male', 1],\n-               [html.Text, '\\n     ', 0],\n+               [html.Text, '\\n     ', 0, ['\\n     ']],\n              ]);\n \n              expect(parsed.errors).toEqual([]);\n@@ -652,10 +669,10 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n              const expansion = parsed.rootNodes[0] as html.Expansion;\n              expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n-               [html.Text, 'zero \\n       ', 0],\n+               [html.Text, 'zero \\n       ', 0, ['zero \\n       ']],\n                [html.Expansion, '\\r\\n         p.gender', 'select', 0],\n                [html.ExpansionCase, 'male', 1],\n-               [html.Text, '\\n     ', 0],\n+               [html.Text, '\\n     ', 0, ['\\n     ']],\n              ]);\n \n \n@@ -724,11 +741,11 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n                   '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>\\na\\n</div>',\n                   '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>', '</div>'\n                 ],\n-                [html.Attribute, '[prop]', 'v1', '[prop]=\"v1\"'],\n-                [html.Attribute, '(e)', 'do()', '(e)=\"do()\"'],\n-                [html.Attribute, 'attr', 'v2', 'attr=\"v2\"'],\n+                [html.Attribute, '[prop]', 'v1', ['v1'], '[prop]=\"v1\"'],\n+                [html.Attribute, '(e)', 'do()', ['do()'], '(e)=\"do()\"'],\n+                [html.Attribute, 'attr', 'v2', ['v2'], 'attr=\"v2\"'],\n                 [html.Attribute, 'noValue', '', 'noValue'],\n-                [html.Text, '\\na\\n', 1, '\\na\\n'],\n+                [html.Text, '\\na\\n', 1, ['\\na\\n'], '\\na\\n'],\n               ]);\n         });\n \n@@ -749,25 +766,58 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n                      '{{&amp;}}' +\n                          '{{&#x25BE;}}' +\n                          '{{&#9662;}}' +\n+                         '{{&unknown;}}' +\n                          '{{&amp (no semi-colon)}}' +\n+                         '{{&#xyz; (invalid hex)}}' +\n                          '{{&#25BE; (invalid decimal)}}',\n                      'TestComp')))\n               .toEqual([[\n                 html.Text,\n                 '{{&}}' +\n                     '{{\\u25BE}}' +\n                     '{{\\u25BE}}' +\n+                    '{{&unknown;}}' +\n                     '{{&amp (no semi-colon)}}' +\n+                    '{{&#xyz; (invalid hex)}}' +\n                     '{{&#25BE; (invalid decimal)}}',\n                 0,\n+                [''],\n+                ['{{', '&amp;', '}}'],\n+                [''],\n+                ['{{', '&#x25BE;', '}}'],\n+                [''],\n+                ['{{', '&#9662;', '}}'],\n+                [''],\n+                ['{{', '&unknown;', '}}'],\n+                [''],\n+                ['{{', '&amp (no semi-colon)', '}}'],\n+                [''],\n+                ['{{', '&#xyz; (invalid hex)', '}}'],\n+                [''],\n+                ['{{', '&#25BE; (invalid decimal)', '}}'],\n+                [''],\n                 '{{&amp;}}' +\n                     '{{&#x25BE;}}' +\n                     '{{&#9662;}}' +\n+                    '{{&unknown;}}' +\n                     '{{&amp (no semi-colon)}}' +\n+                    '{{&#xyz; (invalid hex)}}' +\n                     '{{&#25BE; (invalid decimal)}}',\n               ]]);\n         });\n \n+        it('should support interpolations in text', () => {\n+          expect(\n+              humanizeDomSourceSpans(parser.parse('<div> pre {{ value }} post </div>', 'TestComp')))\n+              .toEqual([\n+                [html.Element, 'div', 0, '<div> pre {{ value }} post </div>', '<div>', '</div>'],\n+                [\n+                  html.Text, ' pre {{ value }} post ', 1, [' pre '], ['{{', ' value ', '}}'],\n+                  [' post '], ' pre {{ value }} post '\n+                ],\n+              ]);\n+        });\n+\n         it('should not set the end source span for void elements', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><br></div>', 'TestComp'))).toEqual([\n             [html.Element, 'div', 0, '<div><br></div>', '<div>', '</div>'],\n@@ -812,10 +862,10 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n                   html.Element, 'input', 0, '<input type=\"text\" />', '<input type=\"text\" />',\n                   '<input type=\"text\" />'\n                 ],\n-                [html.Attribute, 'type', 'text', 'type=\"text\"'],\n-                [html.Text, '\\n\\n\\n  ', 0, ''],\n+                [html.Attribute, 'type', 'text', ['text'], 'type=\"text\"'],\n+                [html.Text, '\\n\\n\\n  ', 0, ['\\n\\n\\n  '], ''],\n                 [html.Element, 'span', 0, '<span>\\n</span>', '<span>', '</span>'],\n-                [html.Text, '\\n', 1, ''],\n+                [html.Text, '\\n', 1, ['\\n'], ''],\n               ]);\n         });\n \n@@ -828,9 +878,9 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n               .toEqual([\n                 [html.Element, 'div', 0, '<div><li>A<li>B</div>', '<div>', '</div>'],\n                 [html.Element, 'li', 1, '<li>', '<li>', null],\n-                [html.Text, 'A', 2, 'A'],\n+                [html.Text, 'A', 2, ['A'], 'A'],\n                 [html.Element, 'li', 1, '<li>', '<li>', null],\n-                [html.Text, 'B', 2, 'B'],\n+                [html.Text, 'B', 2, ['B'], 'B'],\n               ]);\n         });\n \n@@ -868,7 +918,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n       describe('visitor', () => {\n         it('should visit text nodes', () => {\n           const result = humanizeDom(parser.parse('text', 'TestComp'));\n-          expect(result).toEqual([[html.Text, 'text', 0]]);\n+          expect(result).toEqual([[html.Text, 'text', 0, ['text']]]);\n         });\n \n         it('should visit element nodes', () => {\n@@ -878,7 +928,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n         it('should visit attribute nodes', () => {\n           const result = humanizeDom(parser.parse('<div id=\"foo\"></div>', 'TestComp'));\n-          expect(result).toContain([html.Attribute, 'id', 'foo']);\n+          expect(result).toContain([html.Attribute, 'id', 'foo', ['foo']]);\n         });\n \n         it('should visit all nodes', () => {\n@@ -986,7 +1036,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n             expect(humanizeNodes(rootNodes, true)).toEqual([\n               [html.Element, 'div', 0, '<div class=\"hi\" sty', '<div class=\"hi\" sty', null],\n-              [html.Attribute, 'class', 'hi', 'class=\"hi\"'],\n+              [html.Attribute, 'class', 'hi', ['hi'], 'class=\"hi\"'],\n               [html.Attribute, 'sty', '', 'sty'],\n               [html.Element, 'span', 0, '<span></span>', '<span>', '</span>'],\n             ]);\n@@ -1001,7 +1051,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n \n             expect(humanizeNodes(rootNodes, true)).toEqual([\n               [html.Element, 'div', 0, '<div ', '<div ', null],\n-              [html.Text, '\"', 0, '\"'],\n+              [html.Text, '\"', 0, ['\"'], '\"'],\n               [html.Element, 'span', 0, '<span></span>', '<span>', '</span>'],\n             ]);\n "
        },
        {
            "sha": "4d1062a9c8bc56aa7f20bf40cab34d8c3e10c697",
            "filename": "packages/compiler/test/ml_parser/html_whitespaces_spec.ts",
            "status": "modified",
            "additions": 63,
            "deletions": 24,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_whitespaces_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_whitespaces_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_whitespaces_spec.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import * as html from '../../src/ml_parser/ast';\n+import {NGSP_UNICODE} from '../../src/ml_parser/entities';\n import {HtmlParser} from '../../src/ml_parser/html_parser';\n import {PRESERVE_WS_ATTR_NAME, removeWhitespaces} from '../../src/ml_parser/html_whitespaces';\n import {TokenizeOptions} from '../../src/ml_parser/lexer';\n@@ -52,77 +53,115 @@ import {humanizeDom} from './ast_spec_utils';\n       expect(parseAndRemoveWS('<div><span>foo</span>&ngsp;<span>bar</span></div>')).toEqual([\n         [html.Element, 'div', 0],\n         [html.Element, 'span', 1],\n-        [html.Text, 'foo', 2],\n-        [html.Text, ' ', 1],\n+        [html.Text, 'foo', 2, ['foo']],\n+        [html.Text, ' ', 1, [''], [NGSP_UNICODE, '&ngsp;'], ['']],\n         [html.Element, 'span', 1],\n-        [html.Text, 'bar', 2],\n+        [html.Text, 'bar', 2, ['bar']],\n       ]);\n     });\n \n     it('should replace multiple whitespaces with one space', () => {\n-      expect(parseAndRemoveWS('\\n\\n\\nfoo\\t\\t\\t')).toEqual([[html.Text, ' foo ', 0]]);\n-      expect(parseAndRemoveWS('   \\n foo  \\t ')).toEqual([[html.Text, ' foo ', 0]]);\n+      expect(parseAndRemoveWS('\\n\\n\\nfoo\\t\\t\\t')).toEqual([[html.Text, ' foo ', 0, [' foo ']]]);\n+      expect(parseAndRemoveWS('   \\n foo  \\t ')).toEqual([[html.Text, ' foo ', 0, [' foo ']]]);\n     });\n \n     it('should not replace &nbsp;', () => {\n-      expect(parseAndRemoveWS('&nbsp;')).toEqual([[html.Text, '\\u00a0', 0]]);\n+      expect(parseAndRemoveWS('&nbsp;')).toEqual([\n+        [html.Text, '\\u00a0', 0, [''], ['\\u00a0', '&nbsp;'], ['']]\n+      ]);\n     });\n \n     it('should not replace sequences of &nbsp;', () => {\n-      expect(parseAndRemoveWS('&nbsp;&nbsp;foo&nbsp;&nbsp;')).toEqual([\n-        [html.Text, '\\u00a0\\u00a0foo\\u00a0\\u00a0', 0]\n-      ]);\n+      expect(parseAndRemoveWS('&nbsp;&nbsp;foo&nbsp;&nbsp;')).toEqual([[\n+        html.Text,\n+        '\\u00a0\\u00a0foo\\u00a0\\u00a0',\n+        0,\n+        [''],\n+        ['\\u00a0', '&nbsp;'],\n+        [''],\n+        ['\\u00a0', '&nbsp;'],\n+        ['foo'],\n+        ['\\u00a0', '&nbsp;'],\n+        [''],\n+        ['\\u00a0', '&nbsp;'],\n+        [''],\n+      ]]);\n     });\n \n     it('should not replace single tab and newline with spaces', () => {\n-      expect(parseAndRemoveWS('\\nfoo')).toEqual([[html.Text, '\\nfoo', 0]]);\n-      expect(parseAndRemoveWS('\\tfoo')).toEqual([[html.Text, '\\tfoo', 0]]);\n+      expect(parseAndRemoveWS('\\nfoo')).toEqual([[html.Text, '\\nfoo', 0, ['\\nfoo']]]);\n+      expect(parseAndRemoveWS('\\tfoo')).toEqual([[html.Text, '\\tfoo', 0, ['\\tfoo']]]);\n     });\n \n     it('should preserve single whitespaces between interpolations', () => {\n-      expect(parseAndRemoveWS(`{{fooExp}} {{barExp}}`)).toEqual([\n-        [html.Text, '{{fooExp}} {{barExp}}', 0],\n-      ]);\n+      expect(parseAndRemoveWS(`{{fooExp}} {{barExp}}`)).toEqual([[\n+        html.Text,\n+        '{{fooExp}} {{barExp}}',\n+        0,\n+        [''],\n+        ['{{', 'fooExp', '}}'],\n+        [' '],\n+        ['{{', 'barExp', '}}'],\n+        [''],\n+      ]]);\n       expect(parseAndRemoveWS(`{{fooExp}}\\t{{barExp}}`)).toEqual([\n-        [html.Text, '{{fooExp}}\\t{{barExp}}', 0],\n+        [\n+          html.Text,\n+          '{{fooExp}}\\t{{barExp}}',\n+          0,\n+          [''],\n+          ['{{', 'fooExp', '}}'],\n+          ['\\t'],\n+          ['{{', 'barExp', '}}'],\n+          [''],\n+        ],\n       ]);\n       expect(parseAndRemoveWS(`{{fooExp}}\\n{{barExp}}`)).toEqual([\n-        [html.Text, '{{fooExp}}\\n{{barExp}}', 0],\n+        [\n+          html.Text,\n+          '{{fooExp}}\\n{{barExp}}',\n+          0,\n+          [''],\n+          ['{{', 'fooExp', '}}'],\n+          ['\\n'],\n+          ['{{', 'barExp', '}}'],\n+          [''],\n+        ],\n       ]);\n     });\n \n     it('should preserve whitespaces around interpolations', () => {\n       expect(parseAndRemoveWS(` {{exp}} `)).toEqual([\n-        [html.Text, ' {{exp}} ', 0],\n+        [html.Text, ' {{exp}} ', 0, [' '], ['{{', 'exp', '}}'], [' ']]\n       ]);\n     });\n \n     it('should preserve whitespaces around ICU expansions', () => {\n       expect(parseAndRemoveWS(`<span> {a, b, =4 {c}} </span>`, {tokenizeExpansionForms: true}))\n           .toEqual([\n             [html.Element, 'span', 0],\n-            [html.Text, ' ', 1],\n+            [html.Text, ' ', 1, [' ']],\n             [html.Expansion, 'a', 'b', 1],\n             [html.ExpansionCase, '=4', 2],\n-            [html.Text, ' ', 1],\n+            [html.Text, ' ', 1, [' ']],\n           ]);\n     });\n \n     it('should preserve whitespaces inside <pre> elements', () => {\n       expect(parseAndRemoveWS(`<pre><strong>foo</strong>\\n<strong>bar</strong></pre>`)).toEqual([\n         [html.Element, 'pre', 0],\n         [html.Element, 'strong', 1],\n-        [html.Text, 'foo', 2],\n-        [html.Text, '\\n', 1],\n+        [html.Text, 'foo', 2, ['foo']],\n+        [html.Text, '\\n', 1, ['\\n']],\n         [html.Element, 'strong', 1],\n-        [html.Text, 'bar', 2],\n+        [html.Text, 'bar', 2, ['bar']],\n       ]);\n     });\n \n     it('should skip whitespace trimming in <textarea>', () => {\n       expect(parseAndRemoveWS(`<textarea>foo\\n\\n  bar</textarea>`)).toEqual([\n         [html.Element, 'textarea', 0],\n-        [html.Text, 'foo\\n\\n  bar', 1],\n+        [html.Text, 'foo\\n\\n  bar', 1, ['foo\\n\\n  bar']],\n       ]);\n     });\n \n@@ -131,7 +170,7 @@ import {humanizeDom} from './ast_spec_utils';\n          expect(parseAndRemoveWS(`<div ${PRESERVE_WS_ATTR_NAME}><img> <img></div>`)).toEqual([\n            [html.Element, 'div', 0],\n            [html.Element, 'img', 1],\n-           [html.Text, ' ', 1],\n+           [html.Text, ' ', 1, [' ']],\n            [html.Element, 'img', 1],\n          ]);\n        });"
        },
        {
            "sha": "cbd51c1c6c579bc323aeea67bb8e144bb2798835",
            "filename": "packages/compiler/test/ml_parser/icu_ast_expander_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Ficu_ast_expander_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d00f2345a9befa26d5168da3de6983067e227f50/packages%2Fcompiler%2Ftest%2Fml_parser%2Ficu_ast_expander_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Ficu_ast_expander_spec.ts?ref=d00f2345a9befa26d5168da3de6983067e227f50",
            "patch": "@@ -29,9 +29,9 @@ import {humanizeNodes} from './ast_spec_utils';\n         [html.Attribute, '[ngPlural]', 'messages.length'],\n         [html.Element, 'ng-template', 1],\n         [html.Attribute, 'ngPluralCase', '=0'],\n-        [html.Text, 'zero', 2],\n+        [html.Text, 'zero', 2, ['zero']],\n         [html.Element, 'b', 2],\n-        [html.Text, 'bold', 3],\n+        [html.Text, 'bold', 3, ['bold']],\n       ]);\n     });\n \n@@ -47,8 +47,8 @@ import {humanizeNodes} from './ast_spec_utils';\n         [html.Attribute, '[ngSwitch]', 'p.gender'],\n         [html.Element, 'ng-template', 3],\n         [html.Attribute, 'ngSwitchCase', 'male'],\n-        [html.Text, 'm', 4],\n-        [html.Text, ' ', 2],\n+        [html.Text, 'm', 4, ['m']],\n+        [html.Text, ' ', 2, [' ']],\n       ]);\n     });\n \n@@ -88,10 +88,10 @@ import {humanizeNodes} from './ast_spec_utils';\n         [html.Attribute, '[ngSwitch]', 'person.gender'],\n         [html.Element, 'ng-template', 1],\n         [html.Attribute, 'ngSwitchCase', 'male'],\n-        [html.Text, 'm', 2],\n+        [html.Text, 'm', 2, ['m']],\n         [html.Element, 'ng-template', 1],\n         [html.Attribute, 'ngSwitchDefault', ''],\n-        [html.Text, 'default', 2],\n+        [html.Text, 'default', 2, ['default']],\n       ]);\n     });\n \n@@ -105,7 +105,7 @@ import {humanizeNodes} from './ast_spec_utils';\n         [html.Attribute, '[ngSwitch]', 'a'],\n         [html.Element, 'ng-template', 3],\n         [html.Attribute, 'ngSwitchCase', '=4'],\n-        [html.Text, 'c', 4],\n+        [html.Text, 'c', 4, ['c']],\n       ]);\n     });\n "
        }
    ],
    "stats": {
        "total": 364,
        "additions": 240,
        "deletions": 124
    }
}