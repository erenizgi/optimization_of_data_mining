{
    "author": "crisbeto",
    "message": "fix(compiler): handle case-sensitive CSS custom properties (#41380)\n\nCurrently we normalize all CSS property names in the `StylingBuilder` which breaks custom properties, because they're case-sensitive. These changes add a check so that custom properties aren't normalized.\n\nFixes #41364.\n\nPR Close #41380",
    "sha": "e112e320bf6c2b60e8ecea46f80bcaec593c65b7",
    "files": [
        {
            "sha": "eea4fe75ad24d2a5bb57d9d9fabdf47dd803c753",
            "filename": "packages/compiler/src/render3/view/styling_builder.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/e112e320bf6c2b60e8ecea46f80bcaec593c65b7/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fstyling_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/e112e320bf6c2b60e8ecea46f80bcaec593c65b7/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fstyling_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fstyling_builder.ts?ref=e112e320bf6c2b60e8ecea46f80bcaec593c65b7",
            "patch": "@@ -219,7 +219,11 @@ export class StylingBuilder {\n     if (isEmptyExpression(value)) {\n       return null;\n     }\n-    name = normalizePropName(name);\n+    // CSS custom properties are case-sensitive so we shouldn't normalize them.\n+    // See: https://www.w3.org/TR/css-variables-1/#defining-variables\n+    if (!isCssCustomProperty(name)) {\n+      name = hyphenate(name);\n+    }\n     const {property, hasOverrideFlag, suffix: bindingSuffix} = parseProperty(name);\n     suffix = typeof suffix === 'string' && suffix.length !== 0 ? suffix : bindingSuffix;\n     const entry:\n@@ -607,6 +611,10 @@ function getStylePropInterpolationExpression(interpolation: Interpolation) {\n   }\n }\n \n-function normalizePropName(prop: string): string {\n-  return hyphenate(prop);\n+/**\n+ * Checks whether property name is a custom CSS property.\n+ * See: https://www.w3.org/TR/css-variables-1\n+ */\n+function isCssCustomProperty(name: string): boolean {\n+  return name.startsWith('--');\n }"
        },
        {
            "sha": "2013613a9ab6ef71ddbe1a0fe6da17e268d1fec3",
            "filename": "packages/core/test/acceptance/styling_spec.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/e112e320bf6c2b60e8ecea46f80bcaec593c65b7/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e112e320bf6c2b60e8ecea46f80bcaec593c65b7/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts?ref=e112e320bf6c2b60e8ecea46f80bcaec593c65b7",
            "patch": "@@ -294,6 +294,29 @@ describe('styling', () => {\n       const header = fixture.nativeElement.querySelector('h1') as HTMLElement;\n       expect(getComputedStyle(header).getPropertyValue('width')).toEqual('100px');\n     });\n+\n+    it('should support case-sensitive css variables', () => {\n+      // This test only works in browsers which support CSS variables.\n+      if (!supportsCssVariables) {\n+        return;\n+      }\n+\n+      @Component({\n+        template: `\n+          <div [style.--MyVar]=\"'100px'\">\n+            <span style=\"width: var(--MyVar)\">CONTENT</span>\n+          </div>\n+        `\n+      })\n+      class Cmp {\n+      }\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+      const fixture = TestBed.createComponent(Cmp);\n+      fixture.detectChanges();\n+\n+      const span = fixture.nativeElement.querySelector('span') as HTMLElement;\n+      expect(getComputedStyle(span).getPropertyValue('width')).toEqual('100px');\n+    });\n   });\n \n   modifiedInIvy('shadow bindings include static portion')"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 34,
        "deletions": 3
    }
}