{
    "author": "devversion",
    "message": "refactor(bazel): compatibility with `rules_nodejs` v4.0.0 (#42760)\n\nThis commit applies changes to `@angular/bazel` which are necessary\nto support the Bazel NodeJS rules v4.0.0. The Bazel NodeJS rules\nno longer support the `_tslibrary` option for the `LinkablePackageInfo`\nprovider and therefore we need to stop using it. Due to this removal,\nwe also need to add two new attributes called `package_name` and\n`package_path` so that the API of `ng_module` matches `ts_library`.\n\nNote: This is denoted as `refactor` as we currently are not able to\nmerge feature commits into patch branches, but we want the tooling\nto not diverge significantly between the patch and next branch. It is\nplanned to update the merge tooling to allow for such changes to land.\n\nPR Close #42760",
    "sha": "9da68a77e612d8f9e8ecdc9f77a43444d0e95461",
    "files": [
        {
            "sha": "bd20218a7f23d13a9ef3e80399fbaa50c3b598b2",
            "filename": "packages/bazel/src/ng_module.bzl",
            "status": "modified",
            "additions": 19,
            "deletions": 3,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/9da68a77e612d8f9e8ecdc9f77a43444d0e95461/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "raw_url": "https://github.com/angular/angular/raw/9da68a77e612d8f9e8ecdc9f77a43444d0e95461/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_module.bzl?ref=9da68a77e612d8f9e8ecdc9f77a43444d0e95461",
            "patch": "@@ -682,13 +682,13 @@ def _ng_module_impl(ctx):\n         # once it is no longer needed.\n     ])\n \n-    if ctx.attr.module_name:\n+    if ctx.attr.package_name:\n         path = \"/\".join([p for p in [ctx.bin_dir.path, ctx.label.workspace_root, ctx.label.package] if p])\n         ts_providers[\"providers\"].append(LinkablePackageInfo(\n-            package_name = ctx.attr.module_name,\n+            package_name = ctx.attr.package_name,\n+            package_path = ctx.attr.package_path,\n             path = path,\n             files = ts_providers[\"typescript\"][\"es5_sources\"],\n-            _tslibrary = True,\n         ))\n \n     return ts_providers_dict_to_struct(ts_providers)\n@@ -750,6 +750,22 @@ NG_MODULE_ATTRIBUTES = {\n         doc = \"Private API to control production of performance metric JSON files\",\n     ),\n     \"_supports_workers\": attr.bool(default = True),\n+\n+    # Matches the API of the `ts_library` rule from `@bazel/typescript`.\n+    # https://github.com/bazelbuild/rules_nodejs/blob/398d351a3f2a9b2ebf6fc31fb5882cce7eedfd7b/packages/typescript/internal/build_defs.bzl#L435-L446.\n+    \"package_name\": attr.string(\n+        doc = \"\"\"The package name that the linker will link this `ng_module` output as.\n+    If `package_path` is set, the linker will link this package under `<package_path>/node_modules/<package_name>`.\n+    If `package_path` is not set, the package will be linked in the top-level workspace node_modules folder.\"\"\",\n+    ),\n+\n+    # Matches the API of the `ts_library` rule from `@bazel/typescript`.\n+    # https://github.com/bazelbuild/rules_nodejs/blob/398d351a3f2a9b2ebf6fc31fb5882cce7eedfd7b/packages/typescript/internal/build_defs.bzl#L435-L446.\n+    \"package_path\": attr.string(\n+        doc = \"\"\"The package path in the workspace that the linker will link this `ng_module` output to.\n+    If `package_path` is set, the linker will link this package under `<package_path>/node_modules/<package_name>`.\n+    If `package_path` is not set, the package will be linked in the top-level workspace node_modules folder.\"\"\",\n+    ),\n }\n \n NG_MODULE_RULE_ATTRS = dict(dict(COMMON_ATTRIBUTES, **NG_MODULE_ATTRIBUTES), **{"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 19,
        "deletions": 3
    }
}